<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>7.3. Includes do Make do projeto de documentação do FreeBSD</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Primer do Projeto de Documentação do FreeBSD para novos colaboradores" /><link rel="up" href="doc-build.html" title="Chapter 7. O processo de construção da documentação" /><link rel="prev" href="ch07s02.html" title="7.2. Entendendo Makefiles na árvore da documentação" /><link rel="next" href="the-website.html" title="Chapter 8. O Website" /><link rel="copyright" href="legalnotice.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">7.3. Includes do <span class="application">Make</span> do projeto de documentação 
      do FreeBSD</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch07s02.html">Prev</a> </td><th width="60%" align="center">Chapter 7. O processo de construção da 
    documentação</th><td width="20%" align="right"> <a accesskey="n" href="the-website.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="make-includes"></a>7.3. Includes do <span class="application">Make</span> do projeto de documentação 
      do FreeBSD</h2></div></div></div><p>Isto é melhor explicado pela inspeção 
      no código.  Aqui estão os arquivos include do 
      sistema:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>O <code class="filename">doc.project.mk</code> é o 
	  principal arquivo include do projeto, que inclui todos os 
	  arquivos includes necessários.</p></li><li class="listitem"><p>O <code class="filename">doc.subdir.mk</code> controla a
	  navegação na árvore de 
	  documentação durante 
	  o processo de construção e 
	  instalação.</p></li><li class="listitem"><p>O <code class="filename">doc.install.mk</code> fornece as 
	  variáveis que afetam a propriedade e a 
	  instalação de documentos.</p></li><li class="listitem"><p>O <code class="filename">doc.docbook.mk</code> é 
	  incluído se o <code class="varname">DOCFORMAT</code> 
	  for <code class="literal">docbook</code> e se a variável 
	  <code class="varname">DOC</code> estiver definida.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68501072"></a>7.3.1. <code class="filename">doc.project.mk</code></h3></div></div></div><p>Por inspeção:</p><pre class="programlisting">DOCFORMAT?=	docbook
MAINTAINER?=	doc@FreeBSD.org

PREFIX?=	/usr/local
PRI_LANG?=	en_US.ISO8859-1

.if defined(DOC)
.if ${DOCFORMAT} == "docbook"
.include "doc.docbook.mk"
.endif
.endif

.include "doc.subdir.mk"
.include "doc.install.mk"</pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68502608"></a>7.3.1.1. Variáveis</h4></div></div></div><p>As variáveis <code class="varname">DOCFORMAT</code> e 
	  <code class="varname">MAINTAINER</code> serão atribuídas
	  com valores padrão, se o valor das mesmas não 
	  tiver sido definido no arquivo Makefile do documento.</p><p>O <code class="varname">PREFIX</code> define o caminho no
	  qual os <a class="link" href="tools.html" title="Chapter 2. Ferramentas">aplicativos de 
	  construção da documentação</a> 
	  estão instalados.  Para uma instalação 
	  normal através de pacotes e/ou ports, este caminho 
	  será sempre <code class="filename">/usr/local</code>.</p><p>A variável <code class="varname">PRI_LANG</code> deve ser 
	  configurada para refletir o idioma e a 
	  codificação nativa dos usuários aos 
	  quais os documentos se destinam.  O Inglês Americano 
	  (US English) é o padrão.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">A variável <code class="varname">PRI_LANG</code> de 
	    maneira alguma afeta quais documentos serão, 
	    ou que poderão, ser compilados.  Sua 
	    função principal é criar links para 
	    os documentos referenciados com maior frequência no 
	    diretório raiz de instalação da 
	    documentação do FreeBSD.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68512336"></a>7.3.1.2. Condicionais</h4></div></div></div><p>A linha <code class="literal">.if defined(DOC)</code> é 
	  um exemplo da condicional do <span class="application">make</span>
	  , como em outros programas, define o comportamento se 
	  alguma condição é verdadeira ou se 
	  é falsa.  <code class="literal">defined</code> é uma 
	  função que retorna se uma dada 
	  variável está definida ou não.</p><p>A seguir, <code class="literal">.if ${DOCFORMAT} == "docbook"
	  </code>, testa se a variável <code class="varname">DOCFORMAT
	  </code> é <code class="literal">"docbook"</code>, e neste 
	  caso, inclue o <code class="filename">doc.docbook.mk</code>.</p><p>Os dois <code class="literal">.endif</code>s fecham as duas 
	  condicionais anteriores, marcando o fim da sua 
	  aplicação.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68517456"></a>7.3.2. doc.subdir.mk</h3></div></div></div><p>Este arquivo é muito longo para ser explicado por 
	inspeção, você deve ser capaz de 
	interpretá-lo com o conhecimento adquirido nos 
	capítulos anteriores, e com a pequena ajuda dada 
	aqui.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68518608"></a>7.3.2.1. Variáveis</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">SUBDIR</code> é a lista de 
	      subdiretórios nos quais o processo de 
	      construção deve ser executado.</p></li><li class="listitem"><p><code class="varname">ROOT_SYMLINKS</code> são os nomes
	      dos diretórios que devem ser linkados para a 
	      raíz de instalação do documento 
	      a partir da sua localização atual, se o 
	      idioma atual for o idioma primário (especificado
	      por <code class="varname">PRI_LANG</code>).</p></li><li class="listitem"><p>O <code class="varname">COMPAT_SYMLINK</code> já foi 
	      descrito na seção <a class="link" href="ch07s02.html#sub-make" title="7.2.1. Makefiles de Subdiretórios">Makefiles de subdiretório
	      </a>.</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68523856"></a>7.3.2.2. Targets e Macros</h4></div></div></div><p>As dependências são descritas por
	  <code class="literal">target:
	  dependência1 dependência2 ...
	  </code>, nas quais, para construir o 
	  <code class="literal">target</code>, você necessita 
	  primeiramente construir as dependências 
	  informadas.</p><p>Depois desta descrição, 
	  instruções de como construir o target podem 
	  ser passadas, no caso do processo de conversão 
	  entre o target e estas dependências não 
	  tiver sido previamente definido, ou se esta 
	  conversão em particular não for a mesma 
	  que a definida pelo método padrão de 
	  conversão.</p><p>A dependência especial <code class="literal">.USE</code> 
	  define o equivalente a uma macro.</p><pre class="programlisting">_SUBDIRUSE: .USE
.for entry in ${SUBDIR}
	@${ECHO} "===&gt; ${DIRPRFX}${entry}"
	@(cd ${.CURDIR}/${entry} &amp;&amp; \
	${MAKE} ${.TARGET:S/realpackage/package/:S/realinstall/install/} DIRPRFX=${DIRPRFX}${entry}/ )
.endfor</pre><p>No código acima, <code class="buildtarget">_SUBDIRUSE
	  </code> é agora uma macro, a qual irá 
	  executar determinados comandos quando for listada como 
	  dependência.</p><p>O que define esta macro a parte de outros targets? 
	  Basicamente, ela é executada <span class="emphasis"><em>após
	  </em></span> as instruções passadas no 
	  processo de construção por ser uma 
	  dependência para o mesmo, e ela não 
	  configura o <code class="varname">.TARGET</code>, que é a
	  variável que contém o nome do target atual 
	  que está sendo construído.</p><pre class="programlisting">clean: _SUBDIRUSE
	rm -f ${CLEANFILES}</pre><p>No código acima, o <code class="buildtarget">clean</code>
	  irá usar a macro <code class="buildtarget">_SUBDIRUSE</code>
	  depois de ter executado a instrução
	  <code class="command">rm -f ${CLEANFILES}</code>.  De fato, isto causa
	  uma limpeza (<code class="buildtarget">clean</code>) na 
	  árvore de diretórios, deletando os arquivos 
	  construídos enquanto vai 
	  <span class="emphasis"><em>descendo</em></span> pelos subdiretórios, 
	  e não quando vai na direção 
	  oposta.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68536016"></a>7.3.2.2.1. Targets fornecidos</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="buildtarget">install</code> e
		<code class="buildtarget">package</code>, ambos descem pela
		árvore de diretórios executando a sua
		versão real dentro dos subdiretórios.  
		(<code class="buildtarget">realinstall</code> e 
		<code class="buildtarget">realpackage</code> 
		respectivamente).</p></li><li class="listitem"><p>O <code class="buildtarget">clean</code> remove os 
		arquivos criados pelo processo de 
		compilação (e também desce na 
		árvore de diretórios).  
		O <code class="buildtarget">cleandir</code> faz a mesma 
		coisa, e também remove o diretório 
		de objetos se este existir.</p></li></ul></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68541136"></a>7.3.2.3. Mais Condicionais</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">exists</code> é outra 
	      função condicional que retorna verdadeiro
	      se o arquivo informado existir.</p></li><li class="listitem"><p><code class="literal">empty</code> retorna verdadeiro se a 
	      variável informada estiver vazia.</p></li><li class="listitem"><p><code class="literal">target</code> retorna verdadeiro se o 
	      target informado ainda não existir.</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68545360"></a>7.3.2.4. Construção de Looping no 
	  <code class="command">make (.for)</code></h4></div></div></div><p>O <code class="literal">.for</code> fornece uma maneira de 
	  repetir instruções definidas para cada 
	  elemento separado por espaço em uma variável.
	  Ele faz isso atribuíndo uma variável para 
	  conter o elemento atual da lista que está sendo 
	  examinada.</p><pre class="programlisting">_SUBDIRUSE: .USE
.for entry in ${SUBDIR}
	@${ECHO} "===&gt; ${DIRPRFX}${entry}"
	@(cd ${.CURDIR}/${entry} &amp;&amp; \
	${MAKE} ${.TARGET:S/realpackage/package/:S/realinstall/install/} DIRPRFX=${DIRPRFX}${entry}/ )
.endfor</pre><p>No código acima, se <code class="varname">SUBDIR</code> 
	  estiver vazia, nenhuma ação será 
	  executada; se ela possuir um ou mais elementos, as 
	  instruções entre o <code class="literal">.for</code> e 
	  o <code class="literal">.endfor</code> serão repetidas para 
	  cada elemento, com o <code class="varname">entry</code>
	  sendo substituído com o valor do elemento
	  atual.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch07s02.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="doc-build.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="the-website.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">7.2. Entendendo <code class="filename">Makefile</code>s na árvore da 
      documentação </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 8. O Website</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Este, e outros documentos, podem ser obtidos em
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Para perguntas sobre FreeBSD, leia a
    <a href="http://www.FreeBSD.org/docs.html">documentação</a> antes de contatar
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Para perguntas sobre esta documentação, envie e-mail para
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>