<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>5. Preparando a atualização</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Construa Seu Próprio Servidor de Atualização do FreeBSD" /><link rel="up" href="index.html" title="Construa Seu Próprio Servidor de Atualização do FreeBSD" /><link rel="prev" href="Configuration.html" title="4. Instalação &amp; Configuração" /><link rel="next" href="patch.html" title="6. Compilando um patch" /><link rel="copyright" href="trademarks.html" title="Nota Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. Preparando a atualização</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="Configuration.html">Anterior</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="patch.html">Próxima</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="build"></a>5. Preparando a atualização</h2></div></div></div><p>O primeiro passo é executar o
      <code class="filename">scripts/make.sh</code>.  Isto irá compilar alguns
      binários, criar diretórios, e gerar uma chave de assinatura
      RSA usada para aprovar as compilações.  Neste passo, uma senha
      deverá ser fornecida para terminar a criação da chave de
      assinatura.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh scripts/make.sh</code></strong>
cc -O2 -fno-strict-aliasing -pipe   findstamps.c  -o findstamps
findstamps.c: In function 'usage':
findstamps.c:45: warning: incompatible implicit declaration of built-in function 'exit'
cc -O2 -fno-strict-aliasing -pipe   unstamp.c  -o unstamp
install findstamps ../bin
install unstamp ../bin
rm -f findstamps unstamp
Generating RSA private key, 4096 bit long modulus
................................................................................++
...................++
e is 65537 (0x10001)

Public key fingerprint:
27ef53e48dc869eea6c3136091cc6ab8589f967559824779e855d58a2294de9e

Encrypting signing key for root
enter aes-256-cbc encryption password:
Verifying - enter aes-256-cbc encryption password:</pre><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Anote a impressão digital (fingerprint) da chave gerada.  
	Ela é necessária no
        <code class="filename">/etc/freebsd-update.conf</code> para as
        atualizações de binários.</p></div><p>Neste ponto, nós estamos prontos para a etapa de
      compilação.</p><div class="informalexample"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/local/freebsd-update-server</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sh scripts/init.sh amd64 7.2-RELEASE</code></strong></pre></div><p>A seguir está um exemplo de uma execução
      <span class="emphasis"><em>inicial</em></span>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh scripts/init.sh amd64 7.2-RELEASE</code></strong>
Mon Aug 24 16:04:36 PDT 2009 Starting fetch for FreeBSD/amd64 7.2-RELEASE
/usr/local/freebsd-update-server/work/7.2-RELE100% of  588 MB  359 kBps 00m00s
Mon Aug 24 16:32:38 PDT 2009 Verifying disc1 hash for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:32:44 PDT 2009 Extracting components for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:34:05 PDT 2009 Constructing world+src image for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:35:57 PDT 2009 Extracting world+src for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 23:36:24 UTC 2009 Building world for FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:31:29 UTC 2009 Distributing world for FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:32:36 UTC 2009 Building and distributing kernels for FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:44:44 UTC 2009 Constructing world components for FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:44:56 UTC 2009 Distributing source for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:46:18 PDT 2009 Moving components into staging area for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:46:33 PDT 2009 Identifying extra documentation for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:47:13 PDT 2009 Extracting extra docs for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:47:18 PDT 2009 Indexing release for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:50:44 PDT 2009 Indexing world0 for FreeBSD/amd64 7.2-RELEASE

Files built but not released:
Files released but not built:
Files which differ by more than contents:
Files which differ between release and build:
kernel|generic|/GENERIC/hptrr.ko
kernel|generic|/GENERIC/kernel
src|sys|/sys/conf/newvers.sh
world|base|/boot/loader
world|base|/boot/pxeboot
world|base|/etc/mail/freebsd.cf
world|base|/etc/mail/freebsd.submit.cf
world|base|/etc/mail/sendmail.cf
world|base|/etc/mail/submit.cf
world|base|/lib/libcrypto.so.5
world|base|/usr/bin/ntpq
world|base|/usr/lib/libalias.a
world|base|/usr/lib/libalias_cuseeme.a
world|base|/usr/lib/libalias_dummy.a
world|base|/usr/lib/libalias_ftp.a
...</pre><p>Em seguida, a compilação da base do sistema será feita 
      novamente, com os patches.  Uma explicação mais detalhada pode 
      ser encontrada em <code class="filename">scripts/build.subr</code>.</p><div xmlns="" class="warning"><h3 class="admontitle">Atenção: </h3><p xmlns="http://www.w3.org/1999/xhtml">Durante a segunda compilação, o serviço de network time
        protocol, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> será desligado.  De acordo com 
	Colin Percival, Chefe de Segurança emérito do FreeBSD, "o <a class="link" href="http://svnweb.freebsd.org/base/user/cperciva/freebsd-update-build/" target="_top">freebsd-update-server</a>
	compila códigos necessários para identificar os
	<code class="literal">timestamps</code>, os quais são armazenadas em 
	arquivos, de modo que estes últimos podem ser ignorados quando
	estivermos comparando compilações diferentes para determinar 
	quais arquivos precisam ser atualizados.  Esta procura por
	<code class="literal">timestamp</code> funciona realizando duas
	compilações separadas por 400 dias e comparando os
	resultados."</p></div><pre class="screen">Mon Aug 24 17:54:07 PDT 2009 Extracting world+src for FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 00:54:34 UTC 2010 Building world for FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 01:49:42 UTC 2010 Distributing world for FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 01:50:50 UTC 2010 Building and distributing kernels for FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 02:02:56 UTC 2010 Constructing world components for FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 02:03:08 UTC 2010 Distributing source for FreeBSD/amd64 7.2-RELEASE
Tue Sep 28 19:04:31 PDT 2010 Moving components into staging area for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:04:46 PDT 2009 Extracting extra docs for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:04:51 PDT 2009 Indexing world1 for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:08:04 PDT 2009 Locating build stamps for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:19 PDT 2009 Cleaning staging area for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:19 PDT 2009 Preparing to copy files into staging area for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:20 PDT 2009 Copying data files into staging area for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 12:16:57 PDT 2009 Copying metadata files into staging area for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 12:16:59 PDT 2009 Constructing metadata index and tag for FreeBSD/amd64 7.2-RELEASE

Files found which include build stamps:
kernel|generic|/GENERIC/hptrr.ko
kernel|generic|/GENERIC/kernel
world|base|/boot/loader
world|base|/boot/pxeboot
world|base|/etc/mail/freebsd.cf
world|base|/etc/mail/freebsd.submit.cf
world|base|/etc/mail/sendmail.cf
world|base|/etc/mail/submit.cf
world|base|/lib/libcrypto.so.5
world|base|/usr/bin/ntpq
world|base|/usr/include/osreldate.h
world|base|/usr/lib/libalias.a
world|base|/usr/lib/libalias_cuseeme.a
world|base|/usr/lib/libalias_dummy.a
world|base|/usr/lib/libalias_ftp.a
...</pre><p>Finalmente, a compilação termina.</p><pre class="screen">Values of build stamps, excluding library archive headers:
v1.2 (Aug 25 2009 00:40:36)
v1.2 (Aug 25 2009 00:38:22)
@(#)FreeBSD 7.2-RELEASE #0: Tue Aug 25 00:38:29 UTC 2009
FreeBSD 7.2-RELEASE #0: Tue Aug 25 00:38:29 UTC 2009
    root@server.myhost.com:/usr/obj/usr/src/sys/GENERIC
7.2-RELEASE
Mon Aug 24 23:55:25 UTC 2009
Mon Aug 24 23:55:25 UTC 2009
##### built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
##### built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
##### built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
##### built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
Mon Aug 24 23:46:47 UTC 2009
ntpq 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 (1)
 * Copyright (c) 1992-2009 The FreeBSD Project.
Mon Aug 24 23:46:47 UTC 2009
Mon Aug 24 23:55:40 UTC 2009
Aug 25 2009
ntpd 4.2.4p5-a Mon Aug 24 23:55:52 UTC 2009 (1)
ntpdate 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 (1)
ntpdc 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 (1)
Tue Aug 25 00:21:21 UTC 2009
Tue Aug 25 00:21:21 UTC 2009
Tue Aug 25 00:21:21 UTC 2009
Mon Aug 24 23:46:47 UTC 2009

FreeBSD/amd64 7.2-RELEASE initialization build complete.  Please
review the list of build stamps printed above to confirm that
they look sensible, then run
# sh -e approve.sh amd64 7.2-RELEASE
to sign the release.</pre><p>Se tudo estiver correto, aprove a compilação.  Maiores
      informações sobre como determinar se o processo finalizou com 
      sucesso podem ser encontradas no arquivo chamado 
      <code class="filename">USAGE</code>, distribuído com o código fonte.  
      Execute o <code class="filename">scripts/approve.sh</code>.  Isto irá 
      assinar a versão, e mover os seus componentes para uma área de 
      preparo adequada para a transferência para o servidor de
      distribuição.</p><div class="informalexample"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/local/freebsd-update-server</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sh scripts/mountkey.sh</code></strong></pre></div><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh -e scripts/approve.sh amd64 7.2-RELEASE</code></strong>
Wed Aug 26 12:50:06 PDT 2009 Signing build for FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to patch source directories for FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to upload staging area for FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Updating databases for FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Cleaning staging area for FreeBSD/amd64 7.2-RELEASE</pre><p>Depois que o processo de aprovação tiver sido finalizado,
      o processo de transferência pode ser iniciado.</p><div class="informalexample"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/local/freebsd-update-server</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sh scripts/upload.sh amd64 7.2-RELEASE</code></strong></pre></div><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">No caso do código de atualização precisar ser transferido
	novamente para o servidor de distribuição, isto poderá ser
	feito entrando-se no diretório público de distribuição da
	versão desejada e atualizando os atributos do arquivo
        <span class="emphasis"><em>uploaded</em></span>.</p><div xmlns="http://www.w3.org/1999/xhtml" class="informalexample"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/local/freebsd-update-server/pub/7.2-RELEASE/amd64</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>touch -t 200801010101.01 uploaded</code></strong></pre></div></div><p>Os arquivos transferidos precisam ficar na raiz do servidor 
      web para que as atualizações sejam distribuídas.  A exata 
      configuração dependerá do servidor web utilizado.  Para o 
      servidor web <span class="application">Apache</span>, por favor, 
      consulte a seção <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/network-apache.html" target="_top">Configuração do
      servidor Apache</a> do Handbook.</p><p>Atualize o <code class="literal">KeyPrint</code> e o
      <code class="literal">ServerName</code> no arquivo
      <code class="filename">/etc/freebsd-update.conf</code>, e efetue as
      atualizações de acordo com os procedimentos descritos na seção 
      <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/updating-freebsdupdate.html" target="_top">Atualização 
      do FreeBSD</a> do Handbook.</p><div xmlns="" class="important"><h3 class="admontitle">Importante: </h3><p xmlns="http://www.w3.org/1999/xhtml">Para o <span class="application">Servidor de Atualização do FreeBSD</span> funcionar corretamente, é preciso que 
	estejam compiladas a versão <span class="emphasis"><em>atual</em></span> e 
	a versão <span class="emphasis"><em>alvo</em></span>  para a qual você deseja
	se atualizar.  Isto é necessário para que o sistema determine 
	quais são os arquivos que diferem entre as versões.  Por 
	exemplo, para atualizar o FreeBSD da versão 7.1-RELEASE 
	para a versão 7.2-RELEASE, será necessário que você compile e
	transfira os arquivos de ambas as versões para o seu servidor
	de atualização.</p></div><p>Para referência, segue um exemplo de log completo da 
      execução do 
      <a class="link" href="init.txt" target="_top"><code class="filename">init.sh</code></a>
      .</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="Configuration.html">Anterior</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="patch.html">Próxima</a></td></tr><tr><td width="40%" align="left" valign="top">4. Instalação &amp; Configuração </td><td width="20%" align="center"><a accesskey="h" href="index.html">Principal</a></td><td width="40%" align="right" valign="top"> 6. Compilando um patch</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Este, e outros documentos, podem ser obtidos em
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Para perguntas sobre FreeBSD, leia a
    <a href="http://www.FreeBSD.org/docs.html">documentação</a> antes de contatar
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Para perguntas sobre esta documentação, envie e-mail para
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>