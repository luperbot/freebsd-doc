<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>10.8. Argomenti Avanzati</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuale di FreeBSD" /><link rel="up" href="linuxemu.html" title="Capitolo 10. Compatibilità con i Binari di Linux" /><link rel="prev" href="sapr3.html" title="10.7. Installazione di SAP® R/3®" /><link rel="next" href="system-administration.html" title="Parte III. Amministrazione del Sistema" /><link rel="copyright" href="legalnotice.html" title="Nota Legale" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">10.8. Argomenti Avanzati</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="sapr3.html">Indietro</a> </td><th width="60%" align="center">Capitolo 10. Compatibilità con i Binari di Linux</th><td width="20%" align="right"> <a accesskey="n" href="system-administration.html">Avanti</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-advanced"></a>10.8. Argomenti Avanzati</h2></div></div></div><p>Se sei curioso di come funziona la compatibilità con i binari
      di Linux, questa è la sezione da leggere.  Molto di ciò
      che segue è basato pesantemente su una email scritta a <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat" target="_top">mailing list di chiacchiere su FreeBSD</a>
      da Terry Lambert <code class="email">&lt;<a xmlns="" class="email" href="mailto:tlambert@primenet.com">tlambert@primenet.com</a>&gt;</code> (ID del messaggio:
      <code class="literal">&lt;199906020108.SAA07001@usr09.primenet.com&gt;</code>).</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82303440"></a>10.8.1. Come Funziona?</h3></div></div></div><a id="idp82304080" class="indexterm"></a><p>FreeBSD ha una astrazione chiamata un <span class="quote">«<span class="quote">loader della classe di
        esecuzione</span>»</span>.  Questo ` un cuneo nella chiamata di sistema
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a>.</p><p>Cosa succede è che FreeBSD ha una lista di loader,
        piuttosto che un singolo loader con un ritorno nel loader
        <code class="literal">#!</code>, per lanciare qualunque inteprete o script
        della shell.</p><p>Storicamente, l'unico loader nella piattaforma <span class="trademark">UNIX</span>® esaminava il
        numero magico (generalmente i primi 4 o 8 byte del file) per vedere se
        il binario fosse conosciuto dal sistema e, nel caso, invocava il loader
        del binario.</p><p>Se non era un tipo di binario per il sistea, la chiamata
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> ritornava un errore, e la shell tentava di avviare
        eseguendolo come comando della shell.</p><p>L'assunzione era un default, <span class="quote">«<span class="quote">qualunque fosse la
        shell</span>»</span>.</p><p>Più tardi, è stato fatto un hack per <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> per
        esaminare i primi due caratteri.  Se erano <code class="literal">:\n</code>,
        allora invocava la shell <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a> (crediamo sia stata SCO a fare per
        prima questo hack).</p><p>Ciò che ora fa FreeBSD è scorrere una lista di
        loader, con un loader <code class="literal">#!</code> generico che riconosce
        gli interpreti dai caratteri che seguono lo spazio successivo vicino
        alla fine, seguito da un ritorno a <code class="filename">/bin/sh</code>.</p><a id="idp82313552" class="indexterm"></a><p>Per il supporto alle ABI di Linux, FreeBSD vede il numero magico
        come un binario ELF (a questo punto non fa distinzione tra FreeBSD,
        <span class="trademark">Solaris</span>&#8482;, Linux, o qualunque altro SO che ha un tipo di immagine
        ELF).</p><a id="idp82314832" class="indexterm"></a><p>Il loader di ELF cerca un <span class="emphasis"><em>marchio</em></span>
        specializzato, che ` una sezione di commento nell'immagine ELF e
        che non è presente sui binari ELF SVR4/<span class="trademark">Solaris</span>&#8482;.</p><p>I binari di Linux, per funzionare, devono essere
        <span class="emphasis"><em>marchiati</em></span> come tipo <code class="literal">Linux</code>
        da <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>brandelf -t Linux file</code></strong></pre><p>Quando viene fatto questo, il loader ELF vedrà il marchio
        di <code class="literal">Linux</code> sul file.</p><a id="idp82320208" class="indexterm"></a><p>Quando il loader ELF vede il marchio di <code class="literal">Linux</code>,
        il loader sostituisce un puntatore nella struttura
        <code class="literal">proc</code>.
        Tutte le chiamate di sistema sono indicizzate attraverso questo
        puntatore (in un sistema <span class="trademark">UNIX</span>® tradizionale questo sarebbe l'array di
        strutture <code class="literal">sysent[]</code>, contentente le chiamate di
        sistema).
        In aggiunta;, il processo è etichettato per un trattamento
        speciale del vettore trappola per il codice del segnale di lancio,
        e molti altri (minori) aggiustamenti che sono gestiti dal modulo Linux
        del kernel.</p><p>Il vettore delle chiamate di sistema di Linux contiene, tra le
        altre cose, una lista di valori <code class="literal">sysent[]</code> i cui
        indirizzi risiedono nel modulo del kernel.</p><p>Quando una chiamata di sistema è fatta dal binario di
        Linux, il codice trappola derefereizia il puntatore alla funzione della
        chiamata di sistema dalla struttura <code class="literal">proc</code>, e prende
        i punti di ingresso delle chiamate di sistema di Linux, non di
        FreeBSD.</p><p>In più, la modalità Linux
        <span class="emphasis"><em>ridefinisce la root</em></span> dinamicamente; questo, in
        effetti, è quello che fa l'opzione <code class="option">union</code> al
        montaggio del file system (<span class="emphasis"><em>non</em></span> il tipo di file
        system <code class="literal">unionfs</code>!).  Un tentativo viene prima fatto per
        cercare il file nella directory
        <code class="filename">/compat/linux/original-path</code>,
        <span class="emphasis"><em>quindi</em></span>, solo se fallisce, la ricerca ` fatta
        nella directory
        <code class="filename">/original-path</code>.
        Questo assicura che possano funzionare i binari che per richiedono altri
        binari (p.e., la toolchain di Linux può funzionare tutta sotto il
        supporto ABI di Linux).  Questo significa anche che i binari di Linux
        possono caricare ed eseguire binari di FreeBSD, se non sono presenti i
        corrispondenti binari di Linux, e che puoi mettere un comando
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=uname&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">uname</span>(1)</span></a> nell'albero della directory
        <code class="filename">/compat/linux</code> per essere
        sicuro che i binari di Linux non possano capire che non stanno girando
        sotto Linux.</p><p>In effeti c'è un kernel Linux nel kernel FreeBSD;
        le varie funzioni sottostanti che implementano tutti i servizi forniti
        dal kernel sono identiche sia nelle definizioni delle tabelle delle
        chiamate di sistema di FreeBSD che di Linux: le operazioni sul file
        system,
        le operazioni nella memoria virtuale, la consegna dei segnali, le IPC
        System V, ecc...  L'unica differenza è che i binari di
        FreeBSD prendono le funzioni <span class="emphasis"><em>colla</em></span> di FreeBSD, e i
        binari di Linux prendono le funzioni <span class="emphasis"><em>colla</em></span> di Linux
        (molti dei vecchi SO hanno solo le loro funzioni
        <span class="emphasis"><em>colla</em></span>: gli indirizzi delle funzioni in un array di
        strutture <code class="literal">sysent[]</code> statico globale, invece che
        indirizzi di funzioni dereferenziate da un puntatore inizializzato
        dinamicamente nella struttura <code class="literal">proc</code> del processo che
        fa la chiamata).</p><p>Qual è la ABI nativa per FreeBSD?  Non importa.
        Essenzialmente l'unica differenza è che (attualmente: questo
        potrebbe facilmente essere cambiato in distribuzioni future, e
        probabilmente sarà fatto) le funzioni <span class="emphasis"><em>colla</em></span>
        di FreeBSD sono collegate staticamente nel kernel, e le funzioni
        <span class="emphasis"><em>colla</em></span> di Linux possono essere collegate
        staticamente o vi si può accedere attraverso un modulo del
        kernel.</p><p>Si, ma è davvero emulazione?  No.  è
        implementazione delle ABI, non emulazione.  Non è
        coinvolto nessun emulatore (o simulatore, per evitare la prossima
        domanda).</p><p>Allora perché talvolta viene chiamata
        <span class="quote">«<span class="quote">emulazione Linux</span>»</span>?  Per rendere difficile vendere FreeBSD!
        Seriamente, è perché l'implementazione storica è
        stata fatta in un momento in cui non c'era altro termine per descrivere
        ciò che stava succedendo; dire che FreeBSD lanciava i binari di
        Linux non era vero, se non compilavi il codice o caricavi un modulo,
        e c'era bisogno di un termine per descrivere cosa veniva
        caricato- da qui <span class="quote">«<span class="quote">l'emulatore Linux</span>»</span>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sapr3.html">Indietro</a> </td><td width="20%" align="center"><a accesskey="u" href="linuxemu.html">Risali</a></td><td width="40%" align="right"> <a accesskey="n" href="system-administration.html">Avanti</a></td></tr><tr><td width="40%" align="left" valign="top">10.7. Installazione di <span class="trademark">SAP</span>® <span class="trademark">R/3</span>® </td><td width="20%" align="center"><a accesskey="h" href="index.html">Partenza</a></td><td width="40%" align="right" valign="top"> Parte III. Amministrazione del Sistema</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Questo, ed altri documenti, possono essere scaricati da
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Per domande su FreeBSD, leggi la
    <a href="http://www.FreeBSD.org/docs.html">documentazione</a> prima di contattare
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Per domande su questa documentazione, invia una e-mail a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>