<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>8.3. Compilare ed installare un Kernel Custom</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuale di FreeBSD" /><link rel="up" href="kernelconfig.html" title="Capitolo 8. Configurazione del Kernel di FreeBSD" /><link rel="prev" href="kernelconfig-custom-kernel.html" title="8.2. Perchè creare un kernel custom?" /><link rel="next" href="kernelconfig-config.html" title="8.4. Il File di Configurazione" /><link rel="copyright" href="legalnotice.html" title="Nota Legale" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">8.3. Compilare ed installare un Kernel Custom</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kernelconfig-custom-kernel.html">Indietro</a> </td><th width="60%" align="center">Capitolo 8. Configurazione del Kernel di FreeBSD</th><td width="20%" align="right"> <a accesskey="n" href="kernelconfig-config.html">Avanti</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-building"></a>8.3. Compilare ed installare un Kernel Custom</h2></div></div></div><a id="idp80510800" class="indexterm"></a><p>Per prima cosa, facciamo un breve giro nella directory
      di compilazione del kernel.  Tutte le directory menzionate
      saranno relative alla directory principale
      <code class="filename">/usr/src/sys</code>, che è accessibile
      attraverso il path <code class="filename">/sys</code>.  Ci sono
      un certo numero di sottodirectory qua che rappresentano
      parti differenti del kernel, ma la più importante
      per i nostri scopi è
      <code class="filename">arch/conf</code>,
      dove editerai il tuo file
      di configurazione del kernel, e <code class="filename">compile</code>,
      che è l'area di passaggio dove il tuo kernel sarè
      compilato.  <em class="replaceable"><code>arch</code></em> rappresenta uno
      fra <code class="filename">i386</code>, <code class="filename">alpha</code>,
      <code class="filename">amd64</code>, <code class="filename">ia64</code>,
      <code class="filename">powerpc</code>, <code class="filename">sparc64</code>,
      o <code class="filename">pc98</code> (un tipo di sviluppo alternativo
      di hardware PC in Giappone).  Tutto ciò che è
      all'interno di particolare directory di architettura ha a che fare
      solo con quell'architettura; il resto è codice
      indipendente dalla macchina, comune a tutte le piattaforme
      sulle quali FreeBSD potrebbe potenzialmente essere portato.
      Nota l'organizzazione logica della struttura dele directory,
      con ogni device supportato, file system e opzioni nelle proprie
      sottodirectory.</p><p>Questo capitolo assume che tu stia usando la architettura
      i386 negli esempi.  Se questo non è il caso, fai gli appropriati
      aggiustamenti per correggere i percorsi alla tua architettura.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Se <span class="emphasis"><em>non</em></span> c'è una directory
        <code class="filename">/usr/src/sys</code> sul tuo sistema,
        significa che i sorgenti del kernel non sono stati installati.
        Il modo più semplice per farlo è eseguire
        <code class="command">sysinstall</code>
        come <code class="systemitem">root</code>, scegliendo
        <span class="guimenuitem">Configure</span>, poi
        <span class="guimenuitem">Distributions</span>, poi
        <span class="guimenuitem">src</span>, poi <span class="guimenuitem">base</span>
        e <span class="guimenuitem">sys</span>.  Se hai un'avversione
        verso <span class="application">sysinstall</span> e hai accesso
        ad un CDROM <span class="quote">«<span class="quote">ufficiale</span>»</span> FreeBSD, allora puoi installare
        i sorgenti dalla linea di comando:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /cdrom</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /usr/src/sys</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /usr/src/sys /sys</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cat /cdrom/src/ssys.[a-d]* | tar -xzvf -</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cat /cdrom/src/sbase.[a-d]* | tar -xzvf -</code></strong></pre></div><p>Quindi, entra nella directory
      <code class="filename">arch/conf</code>
      e copia il file di configurazione del kernel con il nome
      che vuoi dare al kernel.  Ad esempio:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/i386/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC MYKERNEL</code></strong></pre><p>Tradizionalmente, questo nome è tutto in lettere
      maiuscole e, se stai mantenendo molte macchine FreeBSD con hardware
      differente, è una buona idea dargli il nome della macchina.
      Noi lo chiamemeremo <code class="filename">MYKERNEL</code> a titolo di
      esempio.</p><div xmlns="" class="tip"><h3 class="admontitle">Suggerimento: </h3><p xmlns="http://www.w3.org/1999/xhtml">Conservare il tuo file di configurazione del kernel
        direttamente sotto <code class="filename">/usr/src</code> può
        essere una cattiva idea.  Se stai incontrando problemi
        puoi essere tentato di cancellare <code class="filename">/usr/src
        </code> e partire da zero.  Dopo averlo fatto,
        di solito ci vogliono pochi secondi per realizzare
        che hai appena cancellato il tuo file di configurazione del
        kernel.  Inoltre, non editare <code class="filename">GENERIC</code>
        direttamente, dato che potrebbe essere sovrascritto
        la prossima volta che <a class="link" href="cutting-edge.html" title="Capitolo 23. Lo Stato dell'Arte">
        aggiorni i tuoi sorgenti</a>, e le tue modifiche
        andranno perse.</p><p xmlns="http://www.w3.org/1999/xhtml">Piuttosto tieni il tuo file di configurazione
        del kernel da qualche altra parte, e crea un link simbolico
        al file nella directory <code class="filename">i386
        </code>.</p><p xmlns="http://www.w3.org/1999/xhtml">Ad esempio:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/i386/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /root/kernels</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC /root/kernels/MYKERNEL</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /root/kernels/MYKERNEL</code></strong></pre></div><p>Ora edita <code class="filename">MYKERNEL</code> con il tuo
      editor favorito.  Se stai partendo da zero, il solo editor
      disponibile sa` probabilmente <span class="application">vi</span>,
      che è troppo complesso per essere spiegato in questa sede,
      ma è trattato estesamente in molti libri nella
      <a class="link" href="bibliography.html" title="Appendice B. Bibliografia">bibliografia</a>.  Comunque,
      FreeBSD offre un semplice editor chiamato <span class="application">ee
      </span> che, se sei un principiante, dovrebbe essere
      il tuo editor favorito.  Sentiti libero di cambiare le linee
      di commento in cima al file di configurazione per riflettere
      le tue configurazioni o i cambiamenti che hai fatto rispetto a
      <code class="filename">GENERIC</code>.</p><a id="idp80547536" class="indexterm"></a><p>Se hai compilato un kernel sotto <span class="trademark">SunOS</span>&#8482; o qualche altro
      sistema BSD, gran parte di questo file ti sarà noto.
      Se stai arrivando da qualche altro sistema operativo tipo
      DOS, d'altro canto, il file di configurazione
      <code class="filename">GENERIC</code> ti potrebbe sembrare troppo
      complesso, così è meglio che segui le descrizioni
      della sezione <a class="link" href="kernelconfig-config.html" title="8.4. Il File di Configurazione">File di
      Configurazione</a> attentamente.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Se tu <a class="link" href="cutting-edge.html" title="Capitolo 23. Lo Stato dell'Arte">sincronizzi il tuo albero dei sorgenti
        </a> con i più recenti sorgenti del progetto  FreeBSD,
        accertati sempre di controllare il file
        <code class="filename">/usr/src/UPDATING</code> prima di eseguire
        una qualsiasi operazione di aggiornamento.
        <code class="filename">/usr/src/UPDATING</code> viene aggiornato
        con ogni versione dei sorgenti di FreeBSD, e quindi è
        più aggiornato di questo manuale.</p></div><p>A questo punto devi compilare i sorgenti del kernel.</p><div class="procedure"><a id="idp80556368"></a><div class="procedure-title">Procedura 8.1. Compilare il Kernel</div><ol class="procedure" type="1"><li class="step"><p>Entra nella directory <code class="filename">/usr/src</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong></pre></li><li class="step"><p>Compila il kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make buildkernel KERNCONF=MYKERNEL</code></strong></pre></li><li class="step"><p>Installa il nuovo kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make installkernel KERNCONF=MYKERNEL</code></strong></pre></li></ol></div><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si richede la presenza dell'intera struttura dei sorgenti
        di FreeBSD per compilare il kernel.
      </p></div><div xmlns="" class="tip"><h3 class="admontitle">Suggerimento: </h3><p xmlns="http://www.w3.org/1999/xhtml">Di default, quando compili un kernel custom, anche
        <span class="emphasis"><em>tutti</em></span> i moduli del kernel sono
        ricompilati.  Se vuoi aggiornare il kernel in modo spiccio
        o se vuoi compilare solo alcuni moduli, dovresti editare
        <code class="filename">/etc/make.conf</code> prima di iniziare
        la compilazione del kernel:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">MODULES_OVERRIDE = linux acpi sound/sound sound/driver/ds1 ntfs</pre><p xmlns="http://www.w3.org/1999/xhtml">Questa variabile contiene una lista dei moduli che saranno
        ricompilati.</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">WITHOUT_MODULES = linux acpi sound/sound sound/driver/ds1 ntfs</pre><p xmlns="http://www.w3.org/1999/xhtml">Questa variabile contiene una lista dei moduli che saranno
        esclusi dal processo di compilazione.  Per altre variabili che potresti
        trovare utili per il processo di compilazione del kernel, consulta la
        pagina man <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">make.conf</span>(5)</span></a>.</p></div><a id="idp80571344" class="indexterm"></a><p>Il nuovo kernel sarà copiato nella directory
      <code class="filename">/boot/kernel</code>
      come <code class="filename">/boot/kernel/kernel</code> e il kernel
      precedente sarà copiato in <code class="filename">
      /boot/kernel.old/kernel</code>.  Ora, riavvia il sistema
      e riparti per usare il tuo nuovo kernel.  Se qualcosa
      va storto, ci sono alcune istruzioni di
      <a class="link" href="kernelconfig-trouble.html" title="8.5. Se Qualcosa Va Male">troubleshooting</a>
      alla fine del capitolo che puoi trovare utili.
      Accertati di leggere la sezione in cui si spiega
      cosa fare in caso il tuo nuovo kernel
      <a class="link" href="kernelconfig-trouble.html#kernelconfig-noboot">non faccia il boot</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Altri file relativi al processo di boot, come il boot
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> e la configurazione sono conservati in
        <code class="filename">/boot/</code>.  Moduli di terze parti o custom
        possono essere piazzati in <code class="filename">/boot/kernel/
        </code>, anche se gli utenti dovrebbero avere conoscenza
        del fatto che tenere i moduli sincronizzati col kernel compilato
        è molto importante.  I moduli non creati per
        interagire col kernel compilato possono risultare in
        instabilità o comportamenti anomali.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kernelconfig-custom-kernel.html">Indietro</a> </td><td width="20%" align="center"><a accesskey="u" href="kernelconfig.html">Risali</a></td><td width="40%" align="right"> <a accesskey="n" href="kernelconfig-config.html">Avanti</a></td></tr><tr><td width="40%" align="left" valign="top">8.2. Perchè creare un kernel custom? </td><td width="20%" align="center"><a accesskey="h" href="index.html">Partenza</a></td><td width="40%" align="right" valign="top"> 8.4. Il File di Configurazione</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Questo, ed altri documenti, possono essere scaricati da
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Per domande su FreeBSD, leggi la
    <a href="http://www.FreeBSD.org/docs.html">documentazione</a> prima di contattare
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Per domande su questa documentazione, invia una e-mail a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>