<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>25.10. Clock Synchronization with NTP</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="network-servers.html" title="Rozdzia³ 25. Network Servers" /><link rel="prev" href="network-samba.html" title="25.9. File and Print Services for Microsoft(R) Windows(R) clients (Samba)" /><link rel="next" href="firewalls.html" title="Rozdzia³ 26. Firewalls" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">25.10. Clock Synchronization with NTP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-samba.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 25. Network Servers</th><td width="20%" align="right"> <a accesskey="n" href="firewalls.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ntp"></a>25.10. Clock Synchronization with NTP</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Hukins</span></span>. </span></div></div></div><a id="idp94824656" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94825168"></a>25.10.1. Overview</h3></div></div></div><p>Over time, a computer's clock is prone to drift.  The
	Network Time Protocol (NTP) is one way to ensure your clock stays
	accurate.</p><p>Many Internet services rely on, or greatly benefit from,
	computers' clocks being accurate.  For example, a web server
	may receive requests to send a file if it has been modified since a
	certain time.  In a local area network environment, it is
	essential that computers sharing files from the same file
	server have synchronized clocks so that file timestamps stay
	consistent.  Services such as <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> also rely on
	an accurate system clock to run commands at the specified
	times.</p><a id="idp94827472" class="indexterm"></a><p>FreeBSD ships with the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> <acronym class="acronym">NTP</acronym> server which can be used to query
	other <acronym class="acronym">NTP</acronym>
	servers to set the clock on your machine or provide time
	services to others.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94830928"></a>25.10.2. Choosing Appropriate NTP Servers</h3></div></div></div><a id="idp94831568" class="indexterm"></a><p>In order to synchronize your clock, you will need to find
	one or more <acronym class="acronym">NTP</acronym> servers to use.  Your network
	administrator or ISP may have set up an NTP server for this
	purpose-check their documentation to see if this is the
	case.  There is an <a class="link" href="http://ntp.isc.org/bin/view/Servers/WebHome" target="_top">online
	list of publicly accessible NTP servers</a> which you can
	use to find an NTP server near to you.  Make sure you are
	aware of the policy for any servers you choose, and ask for
	permission if required.</p><p>Choosing several unconnected NTP servers is a good idea in
	case one of the servers you are using becomes unreachable or
	its clock is unreliable.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> uses the responses it
	receives from other servers intelligently-it will favor
	unreliable servers less than reliable ones.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94835664"></a>25.10.3. Configuring Your Machine</h3></div></div></div><a id="idp94836304" class="indexterm"></a><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94837456"></a>25.10.3.1. Basic Configuration</h4></div></div></div><a id="idp94838096" class="indexterm"></a><p>If you only wish to synchronize your clock when the
	  machine boots up, you can use <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a>.  This may be
	  appropriate for some desktop machines which are frequently
	  rebooted and only require infrequent synchronization, but
	  most machines should run <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a>.</p><p>Using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> at boot time is also a good idea
	  for machines that run <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a>.  The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a>
	  program changes the clock gradually, whereas <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a>
	  sets the clock, no matter how great the difference between a
	  machine's current clock setting and the correct time.</p><p>To enable <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> at boot time, add
	  <code class="literal">ntpdate_enable="YES"</code> to
	  <code class="filename">/etc/rc.conf</code>.  You will also need to
	  specify all servers you wish to synchronize with and any
	  flags to be passed to <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> in
	  <code class="varname">ntpdate_flags</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94855632"></a>25.10.3.2. General Configuration</h4></div></div></div><a id="idp94856272" class="indexterm"></a><p>NTP is configured by the
	  <code class="filename">/etc/ntp.conf</code> file in the format
	  described in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a>.  Here is a simple
	  example:</p><pre class="programlisting">server ntplocal.example.com prefer
server timeserver.example.org
server ntp2a.example.net

driftfile /var/db/ntp.drift</pre><p>The <code class="literal">server</code> option specifies which
	  servers are to be used, with one server listed on each line.
	  If a server is specified with the <code class="literal">prefer</code>
	  argument, as with <code class="systemitem">ntplocal.example.com</code>, that server is
	  preferred over other servers.  A response from a preferred
	  server will be discarded if it differs significantly from
	  other servers' responses, otherwise it will be used without
	  any consideration to other responses.  The
	  <code class="literal">prefer</code> argument is normally used for NTP
	  servers that are known to be highly accurate, such as those
	  with special time monitoring hardware.</p><p>The <code class="literal">driftfile</code> option specifies which
	  file is used to store the system clock's frequency offset.
	  The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> program uses this to automatically
	  compensate for the clock's natural drift, allowing it to
	  maintain a reasonably correct setting even if it is cut off
	  from all external time sources for a period of time.</p><p>The <code class="literal">driftfile</code> option specifies which
	  file is used to store information about previous responses
	  from the NTP servers you are using.  This file contains
	  internal information for NTP.  It should not be modified by
	  any other process.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94868304"></a>25.10.3.3. Controlling Access to Your Server</h4></div></div></div><p>By default, your NTP server will be accessible to all
	  hosts on the Internet.  The <code class="literal">restrict</code>
	  option in <code class="filename">/etc/ntp.conf</code> allows you to
	  control which machines can access your server.</p><p>If you want to deny all machines from accessing your NTP
	  server, add the following line to
	  <code class="filename">/etc/ntp.conf</code>:</p><pre class="programlisting">restrict default ignore</pre><p>If you only want to allow machines within your own
	  network to synchronize their clocks with your server, but
	  ensure they are not allowed to configure the server or used
	  as peers to synchronize against, add</p><pre class="programlisting">restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</pre><p>instead, where <code class="systemitem">192.168.1.0</code> is
	  an IP address on your network and <code class="systemitem">255.255.255.0</code> is your network's
	  netmask.</p><p><code class="filename">/etc/ntp.conf</code> can contain multiple
	  <code class="literal">restrict</code> options.  For more details, see
	  the <code class="literal">Access Control Support</code> subsection of
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94884176"></a>25.10.4. Running the NTP Server</h3></div></div></div><p>To ensure the NTP server is started at boot time, add the
	line <code class="literal">ntpd_enable="YES"</code> to
	<code class="filename">/etc/rc.conf</code>.  If you wish to pass
	additional flags to <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a>, edit the
	<code class="varname">ntpd_flags</code> parameter in
	<code class="filename">/etc/rc.conf</code>.</p><p>To start the server without rebooting your machine, run
	<code class="command">ntpd</code> being sure to specify any additional
	parameters from <code class="varname">ntpd_flags</code> in
	<code class="filename">/etc/rc.conf</code>.  For example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ntpd -p /var/run/ntpd.pid</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94894288"></a>25.10.5. Using ntpd with a Temporary Internet
	Connection</h3></div></div></div><p>The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> program does not need a permanent
	connection to the Internet to function properly.  However, if
	you have a temporary connection that is configured to dial out
	on demand, it is a good idea to prevent NTP traffic from
	triggering a dial out or keeping the connection alive.  If you
	are using user PPP, you can use <code class="literal">filter</code>
	directives in <code class="filename">/etc/ppp/ppp.conf</code>.  For
	example:</p><pre class="programlisting"> set filter dial 0 deny udp src eq 123
 # Prevent NTP traffic from initiating dial out
 set filter dial 1 permit 0 0
 set filter alive 0 deny udp src eq 123
 # Prevent incoming NTP traffic from keeping the connection open
 set filter alive 1 deny udp dst eq 123
 # Prevent outgoing NTP traffic from keeping the connection open
 set filter alive 2 permit 0/0 0/0</pre><p>For more details see the <code class="literal">PACKET
	FILTERING</code> section in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> and the examples in
	<code class="filename">/usr/share/examples/ppp/</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some Internet access providers block low-numbered ports,
	  preventing NTP from functioning since replies never
	  reach your machine.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94900048"></a>25.10.6. Further Information</h3></div></div></div><p>Documentation for the NTP server can be found in
	<code class="filename">/usr/share/doc/ntp/</code> in HTML
	format.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-samba.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="network-servers.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="firewalls.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">25.9. File and Print Services for <span class="trademark">Microsoft</span>(R) <span class="trademark">Windows</span>(R) clients (Samba) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> Rozdzia³ 26. Firewalls</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>