<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>14.9. OpenSSL</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="security.html" title="Rozdzia³ 14. Security" /><link rel="prev" href="kerberos5.html" title="14.8. Kerberos5" /><link rel="next" href="ipsec.html" title="14.10. VPN over IPsec" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.9. OpenSSL</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kerberos5.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 14. Security</th><td width="20%" align="right"> <a accesskey="n" href="ipsec.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="openssl"></a>14.9. OpenSSL</h2></div><div><span class="authorgroup">Written by: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp86644560" class="indexterm"></a><p>One feature that many users overlook is the
      <span class="application">OpenSSL</span> toolkit included
      in FreeBSD.  <span class="application">OpenSSL</span> provides an
      encryption transport layer on top of the normal communications
      layer; thus allowing it to be intertwined with many network
      applications and services.</p><p>Some uses of <span class="application">OpenSSL</span> may include
      encrypted authentication of mail clients, web based transactions
      such as credit card payments and more.  Many ports such as
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/apache13-ssl/pkg-descr">www/apache13-ssl</a>, and
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/mail/sylpheed-claws/pkg-descr">mail/sylpheed-claws</a>
      will offer compilation support for building with
      <span class="application">OpenSSL</span>.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">In most cases the Ports Collection will attempt to build
	the <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/openssl/pkg-descr">security/openssl</a> port
	unless the <code class="varname">WITH_OPENSSL_BASE</code> make variable
	is explicitly set to <span class="quote">"<span class="quote">yes</span>"</span>.</p></div><p>The version of <span class="application">OpenSSL</span> included
      in FreeBSD supports Secure Sockets Layer v2/v3 (SSLv2/SSLv3),
      Transport Layer Security v1 (TLSv1) network security protocols
      and can be used as a general cryptographic library.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">While <span class="application">OpenSSL</span> supports the
	<acronym class="acronym">IDEA</acronym> algorithm, it is disabled by default
	due to United States patents.  To use it, the license should
	be reviewed and, if the restrictions are acceptable, the
	<code class="varname">MAKE_IDEA</code> variable must be set in
	<code class="filename">make.conf</code>.</p></div><p>One of the most common uses of
      <span class="application">OpenSSL</span> is to provide certificates for
      use with software applications.  These certificates ensure
      that the credentials of the company or individual are valid
      and not fraudulent.  If the certificate in question has
      not been verified by one of the several <span class="quote">"<span class="quote">Certificate Authorities</span>"</span>,
      or <acronym class="acronym">CA</acronym>s, a warning is usually produced.  A
      Certificate Authority is a company, such as <a class="link" href="http://www.verisign.com" target="_top">VeriSign</a>, which will
      sign certificates in order to validate credentials of individuals
      or companies.  This process has a cost associated with it and
      is definitely not a requirement for using certificates; however,
      it can put some of the more paranoid users at ease.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86668368"></a>14.9.1. Generating Certificates</h3></div></div></div><a id="idp86669008" class="indexterm"></a><p>To generate a certificate, the following command is
	available:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -new -nodes -out req.pem -keyout cert.pem</code></strong>
Generating a 1024 bit RSA private key
................++++++
.......................................++++++
writing new private key to 'cert.pem'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:<strong class="userinput"><code>US</code></strong>
State or Province Name (full name) [Some-State]:<strong class="userinput"><code>PA</code></strong>
Locality Name (eg, city) []:<strong class="userinput"><code>Pittsburgh</code></strong>
Organization Name (eg, company) [Internet Widgits Pty Ltd]:<strong class="userinput"><code>My Company</code></strong>
Organizational Unit Name (eg, section) []:<strong class="userinput"><code>Systems Administrator</code></strong>
Common Name (eg, YOUR name) []:<strong class="userinput"><code>localhost.example.org</code></strong>
Email Address []:<strong class="userinput"><code>trhodes@FreeBSD.org</code></strong>

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:<strong class="userinput"><code>SOME PASSWORD</code></strong>
An optional company name []:<strong class="userinput"><code>Another Name</code></strong></pre><p>Notice the response directly after the
	<span class="quote">"<span class="quote">Common Name</span>"</span> prompt shows a domain name.
	This prompt requires a server name to be entered for
	verification purposes; placing anything	but a domain name
	would yield a useless certificate.  Other options, for
	instance expire time, alternate encryption algorithms, etc.
	are available.  A complete list may be obtained by viewing
	the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=openssl&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">openssl</span>(1)</span></a> manual page.</p><p>Two files should now exist in
	the directory in which the aforementioned command was issued.
	The certificate request, <code class="filename">req.pem</code>, may be
	sent to a certificate authority who will validate the credentials
	that you entered, sign the request and return the certificate to
	you.  The second file created will be named <code class="filename">cert.pem</code>
	and is the private key for the certificate and should be
	protected at all costs; if this falls in the hands of others it
	can be used to impersonate you (or your server).</p><p>In cases where a signature from a <acronym class="acronym">CA</acronym> is
	not required, a self signed certificate can be created.  First,
	generate the <acronym class="acronym">RSA</acronym> key:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl dsaparam -rand -genkey -out myRSA.key 1024</code></strong></pre><p>Next, generate the <acronym class="acronym">CA</acronym> key:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl gendsa -des3 -out myca.key myRSA.key</code></strong></pre><p>Use this key to create the certificate:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -new -x509 -days 365 -key myca.key -out new.crt</code></strong></pre><p>Two new files should appear in the directory: a certificate
	authority signature file, <code class="filename">myca.key</code> and the
	certificate itself, <code class="filename">new.crt</code>.  These should
	be placed in a directory, preferably under
	<code class="filename">/etc</code>, which is readable
	only by <code class="systemitem">root</code>.  Permissions of 0700 should be fine for this and
	they can be set with the <code class="command">chmod</code>
	utility.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86693840"></a>14.9.2. Using Certificates, an Example</h3></div></div></div><p>So what can these files do?  A good use would be to
	encrypt connections to the <span class="application">Sendmail</span>
	<acronym class="acronym">MTA</acronym>.  This would dissolve the use of clear
	text authentication for users who send mail via the local
	<acronym class="acronym">MTA</acronym>.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">This is not the best use in the world as some
	  <acronym class="acronym">MUA</acronym>s will present the user with an
	  error if they have not installed the certificate locally.
	  Refer to the documentation included with the software for
	  more information on certificate installation.</p></div><p>The following lines should be placed inside the
	local <code class="filename">.mc</code> file:</p><pre class="programlisting">dnl SSL Options
define(`confCACERT_PATH',`/etc/certs')dnl
define(`confCACERT',`/etc/certs/new.crt')dnl
define(`confSERVER_CERT',`/etc/certs/new.crt')dnl
define(`confSERVER_KEY',`/etc/certs/myca.key')dnl
define(`confTLS_SRV_OPTIONS', `V')dnl</pre><p>Where <code class="filename">/etc/certs/</code>
	is the directory to be used for storing the certificate
	and key files locally.  The last few requirements are a rebuild
	of the local <code class="filename">.cf</code> file.  This is easily
	achieved by typing <code class="command">make</code>
	<em class="parameter"><code>install</code></em> within the
	<code class="filename">/etc/mail</code>
	directory.  Follow that up with <code class="command">make</code>
	<em class="parameter"><code>restart</code></em> which should start the
	<span class="application">Sendmail</span> daemon.</p><p>If all went well there will be no error messages in the
	<code class="filename">/var/log/maillog</code> file and
	<span class="application">Sendmail</span> will show up in the process
	list.</p><p>For a simple test, simply connect to the mail server
	using the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnet&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">telnet</span>(1)</span></a> utility:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>telnet example.com 25</code></strong>
Trying 192.0.34.166...
Connected to <code class="systemitem">example.com</code>.
Escape character is '^]'.
220 <code class="systemitem">example.com</code> ESMTP Sendmail 8.12.10/8.12.10; Tue, 31 Aug 2004 03:41:22 -0400 (EDT)
<strong class="userinput"><code>ehlo example.com</code></strong>
250-example.com Hello example.com [192.0.34.166], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH LOGIN PLAIN
250-STARTTLS
250-DELIVERBY
250 HELP
<strong class="userinput"><code>quit</code></strong>
221 2.0.0 <code class="systemitem">example.com</code> closing connection
Connection closed by foreign host.</pre><p>If the <span class="quote">"<span class="quote">STARTTLS</span>"</span> line appears in the output
	then everything is working correctly.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kerberos5.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="ipsec.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">14.8. <span class="application">Kerberos5</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 14.10. VPN over IPsec</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>