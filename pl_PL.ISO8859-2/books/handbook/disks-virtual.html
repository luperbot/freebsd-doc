<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>17.13. Network, Memory, and File-Backed File Systems</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="disks.html" title="Rozdzia³ 17. Storage" /><link rel="prev" href="backup-basics.html" title="17.12. Backup Basics" /><link rel="next" href="snapshots.html" title="17.14. File System Snapshots" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">17.13. Network, Memory, and File-Backed File Systems</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="backup-basics.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 17. Storage</th><td width="20%" align="right"> <a accesskey="n" href="snapshots.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-virtual"></a>17.13. Network, Memory, and File-Backed File Systems</h2></div><div><span class="authorgroup">Reorganized and enhanced by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp89097296" class="indexterm"></a><a id="idp89097808" class="indexterm"></a><p>Aside from the disks you physically insert into your computer:
      floppies, CDs, hard drives, and so forth; other forms of disks
      are understood by FreeBSD - the <em class="firstterm">virtual
      disks</em>.</p><a id="idp89099728" class="indexterm"></a><a id="idp89100240" class="indexterm"></a><a id="idp89100752" class="indexterm"></a><p>These include network file systems such as the <a class="link" href="network-nfs.html" title="25.3. Network File System (NFS)">Network File System</a> and Coda, memory-based
      file systems and
      file-backed file systems.</p><p>According to the FreeBSD version you run, you will have to use
      different tools for creation and use of file-backed and
      memory-based file systems.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">Use <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a> to allocate device nodes transparently for the
	user.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-mdconfig"></a>17.13.1. File-Backed File System</h3></div></div></div><a id="idp89109840" class="indexterm"></a><p>The utility <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a> is used to configure and enable
	memory disks, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a>, under FreeBSD.  To use
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a>, you have to load <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> module or to add
	the support in your kernel configuration file:</p><pre class="programlisting">device md</pre><p>The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a> command supports three kinds of
	memory backed virtual disks: memory disks allocated with
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=malloc&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">malloc</span>(9)</span></a>, memory disks using a file or swap space as
	backing.  One possible use is the mounting of floppy
	or CD images kept in files.</p><p>To mount an existing file system image:</p><div class="example"><a id="idp89121488"></a><div class="example-title">Przyk³ad 17.4. Using <code class="command">mdconfig</code> to Mount an Existing File System
	  Image</div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t vnode -f diskimage -u 0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/md0 /mnt</code></strong></pre></div></div><br class="example-break" /><p>To create a new file system image with <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a>:</p><div class="example"><a id="idp89125456"></a><div class="example-title">Przyk³ad 17.5. Creating a New File-Backed Disk with <code class="command">mdconfig</code></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=newimage bs=1k count=5k</code></strong>
5120+0 records in
5120+0 records out
<code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t vnode -f newimage -u 0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -w md0 auto</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs md0a</code></strong>
/dev/md0a: 5.0MB (10224 sectors) block size 16384, fragment size 2048
        using 4 cylinder groups of 1.25MB, 80 blks, 192 inodes.
super-block backups (for fsck -b #) at:
 160, 2720, 5280, 7840
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/md0a /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df /mnt</code></strong>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0a       4710    4  4330     0%    /mnt</pre></div></div><br class="example-break" /><p>If you do not specify the unit number with the
	<code class="option">-u</code> option, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a> will use the
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> automatic allocation to select an unused device.
	The name of the allocated unit will be output on stdout like
	<code class="filename">md4</code>.  For more details about
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a>, please refer to the manual page.</p><p>The utility <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a> is very useful, however it
	asks many command lines to create a file-backed file system.
	FreeBSD also comes with a tool called <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdmfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdmfs</span>(8)</span></a>,
	this program configures a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> disk using
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a>, puts a UFS file system on it using
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a>, and mounts it using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>.  For example,
	if you want to create and mount the same file system image as
	above, simply type the following:</p><div class="example"><a id="idp89144400"></a><div class="example-title">Przyk³ad 17.6. Configure and Mount a File-Backed Disk with <code class="command">mdmfs</code></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=newimage bs=1k count=5k</code></strong>
5120+0 records in
5120+0 records out
<code class="prompt">#</code> <strong class="userinput"><code>mdmfs -F newimage -s 5m md0 /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df /mnt</code></strong>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0        4718    4  4338     0%    /mnt</pre></div></div><br class="example-break" /><p>If you use the option <code class="option">md</code> without unit
	number, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdmfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdmfs</span>(8)</span></a> will use <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> auto-unit feature to
	automatically select an unused device.  For more details
	about <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdmfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdmfs</span>(8)</span></a>, please refer to the manual page.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-md-freebsd5"></a>17.13.2. Memory-Based File System</h3></div></div></div><a id="idp89156176" class="indexterm"></a><p>For a
	memory-based file system the <span class="quote">"<span class="quote">swap backing</span>"</span>
	should normally be used.  Using swap backing does not mean
	that the memory disk will be swapped out to disk by default,
	but merely that the memory disk will be allocated from a
	memory pool which can be swapped out to disk if needed.  It is
	also possible to create memory-based disk which are
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=malloc&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">malloc</span>(9)</span></a> backed, but using malloc backed memory disks,
	especially large ones, can result in a system panic if the
	kernel runs out of memory.</p><div class="example"><a id="idp89158864"></a><div class="example-title">Przyk³ad 17.7. Creating a New Memory-Based Disk with
	  <code class="command">mdconfig</code></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t swap -s 5m -u 1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U md1</code></strong>
/dev/md1: 5.0MB (10240 sectors) block size 16384, fragment size 2048
        using 4 cylinder groups of 1.27MB, 81 blks, 192 inodes.
        with soft updates
super-block backups (for fsck -b #) at:
 160, 2752, 5344, 7936
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/md1 /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df /mnt</code></strong>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md1        4718    4  4338     0%    /mnt</pre></div></div><br class="example-break" /><div class="example"><a id="idp89171536"></a><div class="example-title">Przyk³ad 17.8. Creating a New Memory-Based Disk with
	  <code class="command">mdmfs</code></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdmfs -s 5m md2 /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df /mnt</code></strong>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md2        4846    2  4458     0%    /mnt</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89174480"></a>17.13.3. Detaching a Memory Disk from the System</h3></div></div></div><a id="idp89175120" class="indexterm"></a><p>When a memory-based or file-based file system
	is not used, you should release all resources to the system.
	The first thing to do is to unmount the file system, then use
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a> to detach the disk from the system and release
	the resources.</p><p>For example to detach and free all resources used by
	<code class="filename">/dev/md4</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -d -u 4</code></strong></pre><p>It is possible to list information about configured
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> devices in using the command <code class="command">mdconfig
	-l</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="backup-basics.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="snapshots.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">17.12. Backup Basics </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 17.14. File System Snapshots</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>