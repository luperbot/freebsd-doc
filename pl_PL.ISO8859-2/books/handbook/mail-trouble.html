<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>24.5. Troubleshooting</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="mail.html" title="Rozdzia³ 24. Electronic Mail" /><link rel="prev" href="mail-changingmta.html" title="24.4. Changing Your Mail Transfer Agent" /><link rel="next" href="mail-advanced.html" title="24.6. Advanced Topics" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">24.5. Troubleshooting</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mail-changingmta.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 24. Electronic Mail</th><td width="20%" align="right"> <a accesskey="n" href="mail-advanced.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-trouble"></a>24.5. Troubleshooting</h2></div></div></div><a id="idp92923600" class="indexterm"></a><div class="qandaset"><a id="idp92924752"></a><dl><dt>24.5.1. <a href="mail-trouble.html#idp92925008">Why do I have to use the FQDN for hosts on my site?</a></dt><dt>24.5.2. <a href="mail-trouble.html#idp92939984">sendmail says mail
	  loops back to myself</a></dt><dt>24.5.3. <a href="mail-trouble.html#idp92945744">How can I run a mail server on a dial-up PPP host?</a></dt><dt>24.5.4. <a href="mail-trouble.html#idp93006800">Why do I keep getting Relaying
	    Denied errors when sending mail from other
	    hosts?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp92925008"></a><a id="idp92925264"></a><p><strong>24.5.1.</strong></p></td><td align="left" valign="top"><p>Why do I have to use the FQDN for hosts on my site?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>You will probably find that the host is actually in a
	  different domain; for example, if you are in
	  <code class="systemitem">foo.bar.edu</code> and you wish to reach
	  a host called <code class="systemitem">mumble</code> in the <code class="systemitem">bar.edu</code> domain, you will have to
	  refer to it by the fully-qualified domain name, <code class="systemitem">mumble.bar.edu</code>, instead of just
	  <code class="systemitem">mumble</code>.</p><p>Traditionally, this was allowed by BSD BIND<a id="idp92933456" class="indexterm"></a> resolvers.
	  However the current version of <span class="application">BIND</span>
	  that ships with FreeBSD no longer provides default abbreviations
	  for non-fully qualified domain names other than the domain you
	  are in. So an unqualified host <code class="systemitem">mumble</code> must
	  either be found as <code class="systemitem">mumble.foo.bar.edu</code>, or it will be searched
	  for in the root domain.</p><p>This is different from the previous behavior, where the
	  search continued across <code class="systemitem">mumble.bar.edu</code>, and <code class="systemitem">mumble.edu</code>. Have a look at RFC 1535
	  for why this was considered bad practice, or even a security
	  hole.</p><p>As a good workaround, you can place the line:</p><pre class="programlisting">search foo.bar.edu bar.edu</pre><p>instead of the previous:</p><pre class="programlisting">domain foo.bar.edu</pre><p>into your <code class="filename">/etc/resolv.conf</code>.  However, make
	  sure that the search order does not go beyond the
	  <span class="quote">"<span class="quote">boundary between local and public administration</span>"</span>,
	  as RFC 1535 calls it.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp92939984"></a><a id="idp92940240"></a><p><strong>24.5.2.</strong></p></td><td align="left" valign="top"><p><span class="application">sendmail</span> says <span class="errorname">mail
	  loops back to myself</span></p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>This is answered in the
	<span class="application">sendmail</span> FAQ as follows:</p><pre class="programlisting">I'm getting these error messages:

553 MX list for domain.net points back to relay.domain.net
554 &lt;user@domain.net&gt;... Local configuration error

How can I solve this problem?

You have asked mail to the domain (e.g., domain.net) to be
forwarded to a specific host (in this case, relay.domain.net)
by using an MX<a id="idp92942800" class="indexterm"></a>
record, but the relay machine does not recognize
itself as domain.net. Add domain.net to /etc/mail/local-host-names
[known as /etc/sendmail.cw prior to version 8.10]
(if you are using FEATURE(use_cw_file)) or add <span class="quote">"<span class="quote">Cw domain.net</span>"</span>
to /etc/mail/sendmail.cf.</pre><p>The <span class="application">sendmail</span> FAQ can be found at
	  <code class="uri"><a class="uri" href="http://www.sendmail.org/faq/" target="_top">http://www.sendmail.org/faq/</a></code> and is
	  recommended reading if you want to do any
	  <span class="quote">"<span class="quote">tweaking</span>"</span> of your mail setup.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp92945744"></a><a id="idp92946000"></a><p><strong>24.5.3.</strong></p></td><td align="left" valign="top"><p>How can I run a mail server on a dial-up PPP<a id="idp92946512" class="indexterm"></a> host?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>You want to connect a FreeBSD box on a LAN to the
	  Internet.  The FreeBSD box will be a mail gateway for the LAN.
	  The PPP connection is non-dedicated.</p><p>There are at least two ways to do this.  One way is to use
	  UUCP<a id="idp92989392" class="indexterm"></a>.</p><p>Another way is to get a full-time Internet server to provide secondary
	  MX<a id="idp92990288" class="indexterm"></a>
	  services for your domain.  For example, if your company's domain is
	  <code class="systemitem">example.com</code> and your Internet service provider has
	  set <code class="systemitem">example.net</code> up to provide secondary MX services
	  to your domain:</p><pre class="programlisting">example.com.          MX        10      example.com.
                      MX        20      example.net.</pre><p>Only one host should be specified as the final recipient
	  (add <code class="literal">Cw example.com</code> in
	  <code class="filename">/etc/mail/sendmail.cf</code> on <code class="systemitem">example.com</code>).</p><p>When the sending <code class="command">sendmail</code> is trying to
	  deliver the mail it will try to connect to you (<code class="systemitem">example.com</code>) over the modem
	  link.  It will most likely time out because you are not online.
	  The program <span class="application">sendmail</span> will automatically deliver it to the
	  secondary MX site, i.e. your Internet provider (<code class="systemitem">example.net</code>).  The secondary MX
	  site will then periodically try to connect to
	  your host and deliver the mail to the primary MX host (<code class="systemitem">example.com</code>).</p><p>You might want to use something like this as a login
	  script:</p><pre class="programlisting">#!/bin/sh
# Put me in /usr/local/bin/pppmyisp
( sleep 60 ; /usr/sbin/sendmail -q ) &amp;
/usr/sbin/ppp -direct pppmyisp</pre><p>If you are going to create a separate login script for a
	  user you could use <code class="command">sendmail -qRexample.com</code>
	  instead in the script above. This will force all mail in your
	  queue for <code class="systemitem">example.com</code> to be processed immediately.</p><p>A further refinement of the situation is as follows:</p><p>Message stolen from the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isp" target="_top">FreeBSD Internet service provider's mailing list</a>.</p><pre class="programlisting">&gt; we provide the secondary MX for a customer. The customer connects to
&gt; our services several times a day automatically to get the mails to
&gt; his primary MX (We do not call his site when a mail for his domains
&gt; arrived). Our sendmail sends the mailqueue every 30 minutes. At the
&gt; moment he has to stay 30 minutes online to be sure that all mail is
&gt; gone to the primary MX.
&gt;
&gt; Is there a command that would initiate sendmail to send all the mails
&gt; now? The user has not root-privileges on our machine of course.

In the <span class="quote">"<span class="quote">privacy flags</span>"</span> section of sendmail.cf, there is a
definition Opgoaway,restrictqrun

Remove restrictqrun to allow non-root users to start the queue processing.
You might also like to rearrange the MXs. We are the 1st MX for our
customers like this, and we have defined:

# If we are the best MX for a host, try directly instead of generating
# local config error.
OwTrue

That way a remote site will deliver straight to you, without trying
the customer connection.  You then send to your customer.  Only works for
<span class="quote">"<span class="quote">hosts</span>"</span>, so you need to get your customer to name their mail
machine <span class="quote">"<span class="quote">customer.com</span>"</span> as well as
<span class="quote">"<span class="quote">hostname.customer.com</span>"</span> in the DNS.  Just put an A record in
the DNS for <span class="quote">"<span class="quote">customer.com</span>"</span>.</pre></td></tr><tr class="question"><td align="left" valign="top"><a id="idp93006800"></a><a id="idp93007056"></a><p><strong>24.5.4.</strong></p></td><td align="left" valign="top"><p>Why do I keep getting <span class="errorname">Relaying
	    Denied</span> errors when sending mail from other
	    hosts?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>In default FreeBSD installations,
 	    <span class="application">sendmail</span> is configured to only
 	    send mail from the host it is running on.  For example, if
	    a <acronym class="acronym">POP</acronym> server is available, then users
	    will be able to check mail from school, work, or other
	    remote locations but they still will not be able to send
	    outgoing emails from outside locations.  Typically, a few
	    moments after the attempt, an email will be sent from
	    <span class="application">MAILER-DAEMON</span> with a
	    <span class="errorname">5.7 Relaying Denied</span> error
	    message.</p><p>There are several ways to get around this.  The most
 	    straightforward solution is to put your ISP's address in
 	    a relay-domains file at
 	    <code class="filename">/etc/mail/relay-domains</code>.  A quick way
 	    to do this would be:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo "your.isp.example.com" &gt; /etc/mail/relay-domains</code></strong></pre><p>After creating or editing this file you must restart
  	    <span class="application">sendmail</span>.  This works great if
  	    you are a server administrator and do not wish to send mail
  	    locally, or would like to use a point and click
  	    client/system on another machine or even another ISP.  It
  	    is also very useful if you only have one or two email
  	    accounts set up.  If there is a large number of addresses
  	    to add, you can simply open this file in your favorite
  	    text editor and then add the domains, one per line:</p><pre class="programlisting">your.isp.example.com
other.isp.example.net
users-isp.example.org
www.example.org</pre><p>Now any mail sent through your system, by any host in
	    this list (provided the user has an account on your
	    system), will succeed.  This is a very nice way to allow
	    users to send mail from your system remotely without
	    allowing people to send SPAM through your system.</p></td></tr></tbody></table></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mail-changingmta.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="mail.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="mail-advanced.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">24.4. Changing Your Mail Transfer Agent </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 24.6. Advanced Topics</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>