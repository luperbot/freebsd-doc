<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>14.8. Kerberos5</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="security.html" title="Rozdzia³ 14. Security" /><link rel="prev" href="kerberosIV.html" title="14.7. KerberosIV" /><link rel="next" href="openssl.html" title="14.9. OpenSSL" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.8. <span class="application">Kerberos5</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kerberosIV.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 14. Security</th><td width="20%" align="right"> <a accesskey="n" href="openssl.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kerberos5"></a>14.8. <span class="application">Kerberos5</span></h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tillman</span> <span class="surname">Hodgson</span></span>. </span></div><div><span class="authorgroup">Based on a contribution by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Mark</span> <span class="surname">Murray</span></span>. </span></div></div></div><p>Every FreeBSD release beyond FreeBSD-5.1 includes support
      only for <span class="application">Kerberos5</span>.  Hence
      <span class="application">Kerberos5</span> is the only version
      included, and its configuration is similar in many aspects
      to that of <span class="application">KerberosIV</span>.  The following
      information only applies to
      <span class="application">Kerberos5</span> in post FreeBSD-5.0
      releases.  Users who wish to use the
      <span class="application">KerberosIV</span> package may install the
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/krb4/pkg-descr">security/krb4</a> port.</p><p><span class="application">Kerberos</span> is a network add-on
      system/protocol that allows users to authenticate themselves
      through the services of a secure server.  Services such as remote
      login, remote copy, secure inter-system file copying and other
      high-risk tasks are made considerably safer and more
      controllable.</p><p><span class="application">Kerberos</span> can be described as an
      identity-verifying proxy system.  It can also be described as a
      trusted third-party authentication system.
      <span class="application">Kerberos</span> provides only one
      function - the secure authentication of users on the network.
      It does not provide authorization functions (what users are
      allowed to do) or auditing functions (what those users did).
      After a client and server have used
      <span class="application">Kerberos</span> to prove their identity, they
      can also encrypt all of their communications to assure privacy
      and data integrity as they go about their business.</p><p>Therefore it is highly recommended that
      <span class="application">Kerberos</span> be used with other security
      methods which provide authorization and audit services.</p><p>The following instructions can be used as a guide on how to set
      up <span class="application">Kerberos</span> as distributed for FreeBSD.
      However, you should refer to the relevant manual pages for a complete
      description.</p><p>For purposes of demonstrating a <span class="application">Kerberos</span>
      installation, the various name spaces will be handled as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <acronym class="acronym">DNS</acronym> domain (<span class="quote">"<span class="quote">zone</span>"</span>)
	  will be example.org.</p></li><li class="listitem"><p>The <span class="application">Kerberos</span> realm will be
	  EXAMPLE.ORG.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">Please use real domain names when setting up
	<span class="application">Kerberos</span> even if you intend to run
	it internally.  This avoids <acronym class="acronym">DNS</acronym> problems
	and assures inter-operation with other
	<span class="application">Kerberos</span> realms.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86406736"></a>14.8.1. History</h3></div></div></div><a id="idp86407376" class="indexterm"></a><p><span class="application">Kerberos</span> was created by
	<acronym class="acronym">MIT</acronym> as a solution to network security problems.
	The <span class="application">Kerberos</span> protocol uses strong
	cryptography so that a client can prove its identity to a server
	(and vice versa) across an insecure network connection.</p><p><span class="application">Kerberos</span> is both the name of a
	network authentication protocol and an adjective to describe
	programs that implement the program
	(<span class="application">Kerberos</span> telnet, for example).  The
	current version of the protocol is version 5, described in
	<acronym class="acronym">RFC</acronym> 1510.</p><p>Several free implementations of this protocol are available,
	covering a wide range of operating systems.  The Massachusetts
	Institute of Technology (<acronym class="acronym">MIT</acronym>), where
	<span class="application">Kerberos</span> was originally developed,
	continues to develop their <span class="application">Kerberos</span>
	package.  It is commonly used in the <acronym class="acronym">US</acronym>
	as a cryptography product, as such it
	has historically been affected by <acronym class="acronym">US</acronym> export
	regulations.  The <acronym class="acronym">MIT</acronym>
	<span class="application">Kerberos</span> is available as a port
	(<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/krb5/pkg-descr">security/krb5</a>).  Heimdal
	<span class="application">Kerberos</span> is another version 5
	implementation, and was explicitly developed outside of the
	<acronym class="acronym">US</acronym> to avoid export
	regulations (and is thus often included in non-commercial <span class="trademark">UNIX</span>(R)
	variants).  The Heimdal <span class="application">Kerberos</span>
	distribution is available as a port
	(<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/heimdal/pkg-descr">security/heimdal</a>), and a
	minimal installation of it is included in the base FreeBSD
	install.</p><p>In order to reach the widest audience, these instructions assume
	the use of the Heimdal distribution included in FreeBSD.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86417744"></a>14.8.2. Setting up a Heimdal <acronym class="acronym">KDC</acronym></h3></div></div></div><a id="idp86418768" class="indexterm"></a><p>The Key Distribution Center (<acronym class="acronym">KDC</acronym>) is the
	centralized authentication service that
	<span class="application">Kerberos</span> provides - it is the
	computer that issues <span class="application">Kerberos</span> tickets.
	The <acronym class="acronym">KDC</acronym> is considered <span class="quote">"<span class="quote">trusted</span>"</span> by
	all other computers in the <span class="application">Kerberos</span>
	realm, and thus has heightened security concerns.</p><p>Note that while running the <span class="application">Kerberos</span>
	server requires very few computing resources, a dedicated machine
	acting only as a <acronym class="acronym">KDC</acronym> is recommended for security
	reasons.</p><p>To begin setting up a <acronym class="acronym">KDC</acronym>, ensure that your
	<code class="filename">/etc/rc.conf</code> file contains the correct
	settings to act as a <acronym class="acronym">KDC</acronym> (you may need to adjust
	paths to reflect your own system):</p><pre class="programlisting">kerberos5_server_enable="YES"
kadmind5_server_enable="YES"</pre><p>Next we will set up your <span class="application">Kerberos</span>
	config file, <code class="filename">/etc/krb5.conf</code>:</p><pre class="programlisting">[libdefaults]
    default_realm = EXAMPLE.ORG
[realms]
    EXAMPLE.ORG = {
        kdc = kerberos.example.org
        admin_server = kerberos.example.org
    }
[domain_realm]
    .example.org = EXAMPLE.ORG</pre><p>Note that this <code class="filename">/etc/krb5.conf</code> file implies
	that your <acronym class="acronym">KDC</acronym> will have the fully-qualified
	hostname of <code class="systemitem">kerberos.example.org</code>.
	You will need to add a CNAME (alias) entry to your zone file to
	accomplish this if your <acronym class="acronym">KDC</acronym> has a different
	hostname.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">For large networks with a properly configured
	  <acronym class="acronym">BIND</acronym> <acronym class="acronym">DNS</acronym> server, the
	  above example could be trimmed to:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">[libdefaults]
      default_realm = EXAMPLE.ORG</pre><p xmlns="http://www.w3.org/1999/xhtml">With the following lines being appended to the
	  <code class="systemitem">example.org</code> zonefile:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">_kerberos._udp      IN  SRV     01 00 88 kerberos.example.org.
_kerberos._tcp      IN  SRV     01 00 88 kerberos.example.org.
_kpasswd._udp       IN  SRV     01 00 464 kerberos.example.org.
_kerberos-adm._tcp  IN  SRV     01 00 749 kerberos.example.org.
_kerberos           IN  TXT     EXAMPLE.ORG</pre></div><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">For clients to be able to find the
          <span class="application">Kerberos</span> services, you
          <span class="emphasis"><em>must</em></span> have either a fully configured
          <code class="filename">/etc/krb5.conf</code> or a minimally configured
          <code class="filename">/etc/krb5.conf</code> <span class="emphasis"><em>and</em></span> a
          properly configured DNS server.</p></div><p>Next we will create the <span class="application">Kerberos</span>
	database.  This database contains the keys of all principals encrypted
	with a master password.  You are not
	required to remember this password, it will be stored in a file
	(<code class="filename">/var/heimdal/m-key</code>).  To create the master
	key, run <code class="command">kstash</code> and enter a password.</p><p>Once the master key has been created, you can initialize the
	database using the <code class="command">kadmin</code> program with the
	<code class="literal">-l</code> option (standing for <span class="quote">"<span class="quote">local</span>"</span>).
	This option instructs <code class="command">kadmin</code> to modify the
	database files directly rather than going through the
	<code class="command">kadmind</code> network service.  This handles the
	chicken-and-egg problem of trying to connect to the database
	before it is created.  Once you have the <code class="command">kadmin</code>
	prompt, use the <code class="command">init</code> command to create your
	realms initial database.</p><p>Lastly, while still in <code class="command">kadmin</code>, create your
	first principal using the <code class="command">add</code> command.  Stick
	to the defaults options for the principal for now, you can always
	change them later with the <code class="command">modify</code> command.
	Note that you can use the <code class="literal">?</code> command at any
	prompt to see the available options.</p><p>A sample database creation session is shown below:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kstash</code></strong>
Master key: <strong class="userinput"><code>xxxxxxxx</code></strong>
Verifying password - Master key: <strong class="userinput"><code>xxxxxxxx</code></strong>

<code class="prompt">#</code> <strong class="userinput"><code>kadmin -l</code></strong>
kadmin&gt; <strong class="userinput"><code>init EXAMPLE.ORG</code></strong>
Realm max ticket life [unlimited]:
kadmin&gt; <strong class="userinput"><code>add tillman</code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Attributes []:
Password: <strong class="userinput"><code>xxxxxxxx</code></strong>
Verifying password - Password: <strong class="userinput"><code>xxxxxxxx</code></strong></pre><p>Now it is time to start up the <acronym class="acronym">KDC</acronym> services.
	Run <code class="command">/etc/rc.d/kerberos start</code> and
	<code class="command">/etc/rc.d/kadmind start</code> to bring up the
	services.  Note that you will not have any kerberized daemons running
	at this point but you should be able to confirm the that the
	<acronym class="acronym">KDC</acronym> is functioning by obtaining and listing a
	ticket for the principal (user) that you just created from the
	command-line of the <acronym class="acronym">KDC</acronym> itself:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>k5init tillman</code></strong>
tillman@EXAMPLE.ORG's Password:

<code class="prompt">%</code> <strong class="userinput"><code>k5list</code></strong>
Credentials cache: FILE:<code class="filename">/tmp/krb5cc_500</code>
	Principal: tillman@EXAMPLE.ORG

  Issued           Expires          Principal
Aug 27 15:37:58  Aug 28 01:37:58  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86463440"></a>14.8.3. <span class="application">Kerberos</span> enabling a server with
	  Heimdal services</h3></div></div></div><a id="idp86464336" class="indexterm"></a><p>First, we need a copy of the <span class="application">Kerberos</span>
	  configuration file, <code class="filename">/etc/krb5.conf</code>.  To do
	  so, simply copy it over to the client computer from the
	  <acronym class="acronym">KDC</acronym> in a secure fashion (using network utilities,
	  such as <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a>, or physically via a
	  floppy disk).</p><p>Next you need a <code class="filename">/etc/krb5.keytab</code> file.
	  This is the major difference between a server providing
	  <span class="application">Kerberos</span> enabled daemons and a
	  workstation - the server must have a
	  <code class="filename">keytab</code> file.  This file
	  contains the servers host key, which allows it and the
	  <acronym class="acronym">KDC</acronym> to verify each others identity.  It
	  must be transmitted to the server in a secure fashion, as the
	  security of the server can be broken if the key is made public.
	  This explicitly means that transferring it via a clear text
	  channel, such as <acronym class="acronym">FTP</acronym>, is a very bad idea.</p><p>Typically, you transfer to the <code class="filename">keytab</code>
	  to the server using the <code class="command">kadmin</code> program.
	  This is handy because you also need to create the host principal
	  (the <acronym class="acronym">KDC</acronym> end of the
	  <code class="filename">krb5.keytab</code>) using
	  <code class="command">kadmin</code>.</p><p>Note that you must have already obtained a ticket and that this
	  ticket must be allowed to use the <code class="command">kadmin</code>
	  interface in the <code class="filename">kadmind.acl</code>.  See the section
	  titled <span class="quote">"<span class="quote">Remote administration</span>"</span> in the Heimdal info
	  pages (<code class="command">info heimdal</code>) for details on designing
	  access control lists.  If you do not want to enable remote
	  <code class="command">kadmin</code> access, you can simply securely connect
	  to the <acronym class="acronym">KDC</acronym> (via local console,
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> or <span class="application">Kerberos</span>
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnet&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">telnet</span>(1)</span></a>) and perform administration locally
	  using <code class="command">kadmin -l</code>.</p><p>After installing the <code class="filename">/etc/krb5.conf</code> file,
	  you can use <code class="command">kadmin</code> from the
	  <span class="application">Kerberos</span> server.  The
	  <code class="command">add --random-key</code> command will let you add the
	  servers host principal, and the <code class="command">ext</code> command
	  will allow you to extract the servers host principal to its own
	  keytab.  For example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt;<strong class="userinput"><code> add --random-key host/myserver.example.org</code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Attributes []:
kadmin&gt;<strong class="userinput"><code> ext host/myserver.example.org</code></strong>
kadmin&gt;<strong class="userinput"><code> exit</code></strong></pre><p>Note that the <code class="command">ext</code> command (short for
	  <span class="quote">"<span class="quote">extract</span>"</span>) stores the extracted key in
	  <code class="filename">/etc/krb5.keytab</code> by default.</p><p>If you do not have <code class="command">kadmind</code> running on the
	  <acronym class="acronym">KDC</acronym> (possibly for security reasons) and thus
	  do not have access to <code class="command">kadmin</code> remotely, you
	  can add the host principal
	  (<code class="systemitem">host/myserver.EXAMPLE.ORG</code>) directly on the
	  <acronym class="acronym">KDC</acronym> and then extract it to a temporary file
	  (to avoid over-writing the <code class="filename">/etc/krb5.keytab</code>
	  on the <acronym class="acronym">KDC</acronym>) using something like this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt;<strong class="userinput"><code> ext --keytab=/tmp/example.keytab host/myserver.example.org</code></strong>
kadmin&gt;<strong class="userinput"><code> exit</code></strong></pre><p>You can then securely copy the keytab to the server
	  computer (using <code class="command">scp</code> or a floppy, for
	  example).  Be sure to specify a non-default keytab name
	  to avoid over-writing the keytab on the
	  <acronym class="acronym">KDC</acronym>.</p><p>At this point your server can communicate with the
	  <acronym class="acronym">KDC</acronym> (due to its <code class="filename">krb5.conf</code>
	  file) and it can prove its own identity (due to the
	  <code class="filename">krb5.keytab</code> file).  It is now ready for
	  you to enable some <span class="application">Kerberos</span> services.
	  For this example we will enable the <code class="command">telnet</code>
	  service by putting a line like this into your
	  <code class="filename">/etc/inetd.conf</code> and then restarting the
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> service with
	  <code class="command">/etc/rc.d/inetd restart</code>:</p><pre class="programlisting">telnet    stream  tcp     nowait  root    /usr/libexec/telnetd  telnetd -a user</pre><p>The critical bit is that the <code class="command">-a</code>
	  (for authentication) type is set to user.  Consult the
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">telnetd</span>(8)</span></a> manual page for more details.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86504016"></a>14.8.4. <span class="application">Kerberos</span> enabling a client with Heimdal</h3></div></div></div><a id="idp86504912" class="indexterm"></a><p>Setting up a client computer is almost trivially easy.  As
	  far as <span class="application">Kerberos</span> configuration goes,
	  you only need the <span class="application">Kerberos</span>
	  configuration file, located at <code class="filename">/etc/krb5.conf</code>.
	  Simply securely copy it over to the client computer from the
	  <acronym class="acronym">KDC</acronym>.</p><p>Test your client computer by attempting to use
	  <code class="command">kinit</code>, <code class="command">klist</code>, and
	  <code class="command">kdestroy</code> from the client to obtain, show, and
	  then delete a ticket for the principal you created above.  You
	  should also be able to use <span class="application">Kerberos</span>
	  applications to connect to <span class="application">Kerberos</span>
	  enabled servers, though if that does not work and obtaining a
	  ticket does the problem is likely with the server and not with
	  the client or the <acronym class="acronym">KDC</acronym>.</p><p>When testing an application like <code class="command">telnet</code>,
	  try using a packet sniffer (such as <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a>)
	  to confirm that your password is not sent in the clear.  Try
	  using <code class="command">telnet</code> with the <code class="literal">-x</code>
	  option, which encrypts the entire data stream (similar to
	  <code class="command">ssh</code>).</p><p>The core <span class="application">Kerberos</span> client applications
	  (traditionally named <code class="command">kinit</code>,
	  <code class="command">klist</code>, <code class="command">kdestroy</code>, and
	  <code class="command">kpasswd</code>) are installed in
	  the base FreeBSD install. Note that FreeBSD versions prior to 5.0
	  renamed them to <code class="command">k5init</code>,
	  <code class="command">k5list</code>, <code class="command">k5destroy</code>,
	  <code class="command">k5passwd</code>, and <code class="command">k5stash</code>
	  (though it is typically only used once).</p><p>Various non-core <span class="application">Kerberos</span> client
	  applications are also installed by default.  This is where the
	  <span class="quote">"<span class="quote">minimal</span>"</span> nature of the base Heimdal installation is
	  felt: <code class="command">telnet</code> is the only
	  <span class="application">Kerberos</span> enabled service.</p><p>The Heimdal port adds some of the missing client applications:
	  <span class="application">Kerberos</span> enabled versions of
	  <code class="command">ftp</code>, <code class="command">rsh</code>,
	  <code class="command">rcp</code>, <code class="command">rlogin</code>, and a few
	  other less common programs. The <acronym class="acronym">MIT</acronym> port also
	  contains a full suite of <span class="application">Kerberos</span>
	  client applications.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86527056"></a>14.8.5. User configuration files: <code class="filename">.k5login</code> and <code class="filename">.k5users</code></h3></div></div></div><a id="idp86528336" class="indexterm"></a><a id="idp86529232" class="indexterm"></a><p>Users within a realm typically have their
	  <span class="application">Kerberos</span> principal (such as
	  <code class="systemitem">tillman@EXAMPLE.ORG</code>) mapped to a local
	  user account (such as a local account named
	  <code class="systemitem">tillman</code>).  Client applications such as
	  <code class="command">telnet</code> usually do not require a user name
	  or a principal.</p><p>Occasionally, however, you want to grant access to a local
	  user account to someone who does not have a matching
	  <span class="application">Kerberos</span> principal.  For example,
	  <code class="systemitem">tillman@EXAMPLE.ORG</code> may need access to the
	  local user account <code class="systemitem">webdevelopers</code>.  Other
	  principals may also need access to that local account.</p><p>The <code class="filename">.k5login</code> and
	  <code class="filename">.k5users</code> files, placed in a users home
	  directory, can be used similar to a powerful combination of
	  <code class="filename">.hosts</code> and <code class="filename">.rhosts</code>,
	  solving this problem. For example, if a
	  <code class="filename">.k5login</code> with the following
	  contents:</p><pre class="screen">tillman@example.org
jdoe@example.org</pre><p>Were to be placed into the home directory of the local user
	  <code class="systemitem">webdevelopers</code> then both principals listed
	  would have access to that account without requiring a shared
	  password.</p><p>Reading the manual pages for these commands is recommended.
	  Note that the <code class="command">ksu</code> manual page covers
	  <code class="filename">.k5users</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86551504"></a>14.8.6. <span class="application">Kerberos</span> Tips, Tricks, and Troubleshooting</h3></div></div></div><a id="idp86552400" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>When using either the Heimdal or <acronym class="acronym">MIT</acronym>
	      <span class="application">Kerberos</span> ports ensure that your
	      <code class="envar">PATH</code> environment variable lists the
	      <span class="application">Kerberos</span> versions of the client
	      applications before the system versions.</p></li><li class="listitem"><p>Do all the computers in your realm have synchronized
	      time settings?  If not, authentication may fail.
	      <a class="xref" href="network-ntp.html" title="25.10. Clock Synchronization with NTP">Sekcja 25.10, "Clock Synchronization with NTP"</a> describes how to synchronize
	      clocks using <acronym class="acronym">NTP</acronym>.</p></li><li class="listitem"><p><acronym class="acronym">MIT</acronym> and Heimdal inter-operate nicely.
	      Except for <code class="command">kadmin</code>, the protocol for
	      which is not standardized.</p></li><li class="listitem"><p>If you change your hostname, you also need to change your
	      <code class="systemitem">host/</code> principal and update your keytab.
	      This also applies to special keytab entries like the
	      <code class="systemitem">www/</code> principal used for Apache's
	      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/mod_auth_kerb/pkg-descr">www/mod_auth_kerb</a>.</p></li><li class="listitem"><p>All hosts in your realm must be resolvable (both forwards
	      and reverse) in <acronym class="acronym">DNS</acronym> (or
	      <code class="filename">/etc/hosts</code> as a minimum).  CNAMEs
	      will work, but the A and PTR records must be correct and in
	      place. The error message is not very intuitive:
	      <span class="errorname">Kerberos5 refuses authentication because Read req
	      failed: Key table entry not found</span>.</p></li><li class="listitem"><p>Some operating systems that may being acting as clients
	      to your <acronym class="acronym">KDC</acronym> do not set the permissions
	      for <code class="command">ksu</code> to be setuid
	      <code class="systemitem">root</code>.  This means that
	      <code class="command">ksu</code> does not work, which is a good
	      security idea but annoying. This is not a
	      <acronym class="acronym">KDC</acronym> error.</p></li><li class="listitem"><p>With <acronym class="acronym">MIT</acronym>
	      <span class="application">Kerberos</span>, if you want to allow a
	      principal to have a ticket life longer than the default ten
	      hours, you must use <code class="command">modify_principal</code> in
	      <code class="command">kadmin</code> to change the maxlife of both the
	      principal in question and the <code class="systemitem">krbtgt</code>
	      principal.  Then the principal can use the
	      <code class="literal">-l</code> option with <code class="command">kinit</code>
	      to request a ticket with a longer lifetime.</p></li><li class="listitem"><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">If you run a packet sniffer on your
	      <acronym class="acronym">KDC</acronym> to add in troubleshooting and then
	      run <code class="command">kinit</code> from a workstation, you will
	      notice that your <acronym class="acronym">TGT</acronym> is sent
	      immediately upon running <code class="command">kinit</code> -
	      even before you type your password!  The explanation is
	      that the <span class="application">Kerberos</span> server freely
	      transmits a <acronym class="acronym">TGT</acronym> (Ticket Granting
	      Ticket) to any unauthorized request;  however, every
	      <acronym class="acronym">TGT</acronym> is encrypted in a key derived from
	      the user's password.  Therefore, when a user types their
	      password it is not being sent to the <acronym class="acronym">KDC</acronym>,
	      it is being used to decrypt the <acronym class="acronym">TGT</acronym> that
	      <code class="command">kinit</code> already obtained. If the decryption
	      process results in a valid ticket with a valid time stamp,
	      the user has valid <span class="application">Kerberos</span>
	      credentials.  These credentials include a session key for
	      establishing secure communications with the
	      <span class="application">Kerberos</span> server in the future, as
	      well as the actual ticket-granting ticket, which is actually
	      encrypted with the <span class="application">Kerberos</span>
	      server's own key.  This second layer of encryption is
	      unknown to the user, but it is what allows the
	      <span class="application">Kerberos</span> server to verify
	      the authenticity of each <acronym class="acronym">TGT</acronym>.</p></div></li><li class="listitem"><p>If you want to use long ticket lifetimes (a week, for
	      example) and you are using <span class="application">OpenSSH</span>
	      to connect to the machine where your ticket is stored, make
	      sure that <span class="application">Kerberos</span>
	      <code class="option">TicketCleanup</code> is set to <code class="literal">no</code>
	      in your <code class="filename">sshd_config</code> or else your tickets
	      will be deleted when you log out.</p></li><li class="listitem"><p>Remember that host principals can have a longer ticket
	      lifetime as well.  If your user principal has a lifetime of a
	      week but the host you are connecting to has a lifetime of nine
	      hours, you will have an expired host principal in your cache
	      and the ticket cache will not work as expected.</p></li><li class="listitem"><p>When setting up a <code class="filename">krb5.dict</code> file to
	    prevent specific bad passwords from being used (the manual page
	    for <code class="command">kadmind</code> covers this briefly), remember
	    that it only applies to principals that have a password policy
	    assigned to them.  The <code class="filename">krb5.dict</code> files
	    format is simple: one string per line.  Creating a symbolic
	    link to <code class="filename">/usr/share/dict/words</code> might be
	    useful.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86587472"></a>14.8.7. Differences with the <acronym class="acronym">MIT</acronym> port</h3></div></div></div><p>The major difference between the <acronym class="acronym">MIT</acronym>
	  and Heimdal installs relates to the <code class="command">kadmin</code>
	  program which has a different (but equivalent) set of commands
	  and uses a different protocol.  This has a large implications
	  if your <acronym class="acronym">KDC</acronym> is <acronym class="acronym">MIT</acronym> as you
	  will not be able to use the Heimdal <code class="command">kadmin</code>
	  program to administer your <acronym class="acronym">KDC</acronym> remotely
	  (or vice versa, for that matter).</p><p>The client applications may also take slightly different
	  command line options to accomplish the same tasks.  Following
	  the instructions on the <acronym class="acronym">MIT</acronym>
	  <span class="application">Kerberos</span> web site
	  (<code class="uri"><a class="uri" href="http://web.mit.edu/Kerberos/www/" target="_top">http://web.mit.edu/Kerberos/www/</a></code>)
	  is recommended. Be careful of path issues: the
	  <acronym class="acronym">MIT</acronym> port installs into
	  <code class="filename">/usr/local/</code> by default, and the
	  <span class="quote">"<span class="quote">normal</span>"</span> system applications may be run instead
	  of <acronym class="acronym">MIT</acronym> if your <code class="envar">PATH</code>
	  environment variable lists the system directories first.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">With the <acronym class="acronym">MIT</acronym>
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/krb5/pkg-descr">security/krb5</a> port
	  that is provided by FreeBSD, be sure to read the
	  <code class="filename">/usr/local/share/doc/krb5/README.FreeBSD</code>
	  file installed by the port if you want to understand why logins
	  via <code class="command">telnetd</code> and <code class="command">klogind</code>
	  behave somewhat oddly.  Most importantly, correcting the
	  <span class="quote">"<span class="quote">incorrect permissions on cache file</span>"</span> behavior
	  requires that the <code class="command">login.krb5</code> binary be used
	  for authentication so that it can properly change ownership for
	  the forwarded credentials.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86602576"></a>14.8.8. Mitigating limitations found in <span class="application">Kerberos</span></h3></div></div></div><a id="idp86603472" class="indexterm"></a><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86604624"></a>14.8.8.1. <span class="application">Kerberos</span> is an all-or-nothing approach</h4></div></div></div><p>Every service enabled on the network must be modified to
	    work with <span class="application">Kerberos</span> (or be otherwise
	    secured against network attacks) or else the users credentials
	    could be stolen and re-used.  An example of this would be
	    <span class="application">Kerberos</span> enabling all remote shells
	    (via <code class="command">rsh</code> and <code class="command">telnet</code>, for
	    example) but not converting the <acronym class="acronym">POP3</acronym> mail
	    server which sends passwords in plain text.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86607952"></a>14.8.8.2. <span class="application">Kerberos</span> is intended for single-user workstations</h4></div></div></div><p>In a multi-user environment,
	    <span class="application">Kerberos</span> is less secure.
	    This is because it stores the tickets in the
	    <code class="filename">/tmp</code> directory, which is readable by all
	    users.  If a user is sharing a computer with several other
	    people simultaneously (i.e. multi-user), it is possible that
	    the user's tickets can be stolen (copied) by another
	    user.</p><p>This can be overcome with the <code class="literal">-c</code>
	    filename command-line option or (preferably) the
	    <code class="envar">KRB5CCNAME</code> environment variable, but this
	    is rarely done. In principal, storing the ticket in the users
	    home directory and using simple file permissions can mitigate
	    this problem.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86615504"></a>14.8.8.3. The KDC is a single point of failure</h4></div></div></div><p>By design, the <acronym class="acronym">KDC</acronym> must be as secure as
	    the master password database is contained on it.  The
	    <acronym class="acronym">KDC</acronym> should have absolutely no other
	    services running on it and should be physically secured.  The
	    danger is high because <span class="application">Kerberos</span>
	    stores all passwords encrypted with the same key (the
	    <span class="quote">"<span class="quote">master</span>"</span> key), which in turn is stored as a file
	    on the <acronym class="acronym">KDC</acronym>.</p><p>As a side note, a compromised master key is not quite as
	    bad as one might normally fear.  The master key is only used
	    to encrypt the <span class="application">Kerberos</span> database
	    and as a seed for the random number generator.  As long as
	    access to your <acronym class="acronym">KDC</acronym> is secure, an attacker
	    cannot do much with the master key.</p><p>Additionally, if the <acronym class="acronym">KDC</acronym> is unavailable
	    (perhaps due to a denial of service attack or network problems)
	    the network services are unusable as authentication can not be
	    performed, a recipe for a denial-of-service attack.  This can
	    alleviated with multiple <acronym class="acronym">KDC</acronym>s (a single
	    master and one or more slaves) and with careful implementation
	    of secondary or fall-back authentication
	    (<acronym class="acronym">PAM</acronym> is excellent for this).</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86621264"></a>14.8.8.4. <span class="application">Kerberos</span> Shortcomings</h4></div></div></div><p><span class="application">Kerberos</span> allows users, hosts
	    and services to authenticate between themselves.  It does not
	    have a mechanism to authenticate the <acronym class="acronym">KDC</acronym>
	    to the users, hosts or services.  This means that a trojanned
	    <code class="command">kinit</code> (for example) could record all user
	    names and passwords.  Something like
	    <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/tripwire/pkg-descr">security/tripwire</a> or
	    other file system integrity checking tools can alleviate
	    this.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86628432"></a>14.8.9. Resources and further information</h3></div></div></div><a id="idp86629072" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.faqs.org/faqs/Kerberos-faq/general/preamble.html" target="_top">
	    The <span class="application">Kerberos</span> FAQ</a></p></li><li class="listitem"><p><a class="link" href="http://web.mit.edu/Kerberos/www/dialogue.html" target="_top">Designing
	    an Authentication System: a Dialog in Four Scenes</a></p></li><li class="listitem"><p><a class="link" href="http://www.ietf.org/rfc/rfc1510.txt?number=1510" target="_top">RFC 1510,
	    The <span class="application">Kerberos</span> Network Authentication Service
	    (V5)</a></p></li><li class="listitem"><p><a class="link" href="http://web.mit.edu/Kerberos/www/" target="_top"><acronym class="acronym">MIT</acronym>
	    <span class="application">Kerberos</span> home page</a></p></li><li class="listitem"><p><a class="link" href="http://www.pdc.kth.se/heimdal/" target="_top">Heimdal
	  <span class="application">Kerberos</span> home page</a></p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kerberosIV.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="openssl.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">14.7. <span class="application">KerberosIV</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 14.9. OpenSSL</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>