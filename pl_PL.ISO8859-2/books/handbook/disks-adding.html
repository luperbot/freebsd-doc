<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>17.3. Adding Disks</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="disks.html" title="Rozdzia³ 17. Storage" /><link rel="prev" href="disks-naming.html" title="17.2. Device Names" /><link rel="next" href="raid.html" title="17.4. RAID" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">17.3. Adding Disks</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="disks-naming.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 17. Storage</th><td width="20%" align="right"> <a accesskey="n" href="raid.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-adding"></a>17.3. Adding Disks</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">David</span> <span class="surname">O'Brien</span></span>. </span></div></div></div><a id="idp88241232" class="indexterm"></a><p>Lets say we want to add a new SCSI disk to a machine that
      currently only has a single drive.  First turn off the computer
      and install the drive in the computer following the instructions
      of the computer, controller, and drive manufacturer.  Due to the
      wide variations of procedures to do this, the details are beyond
      the scope of this document.</p><p>Login as user <code class="systemitem">root</code>.  After you have installed the
      drive, inspect <code class="filename">/var/run/dmesg.boot</code> to ensure the new
      disk was found.  Continuing with our example, the newly added drive will
      be <code class="filename">da1</code> and we want to mount it on
      <code class="filename">/1</code> (if you are adding an IDE drive, the device name
      will be <code class="filename">ad1</code>).</p><a id="idp88249424" class="indexterm"></a><a id="idp88249936" class="indexterm"></a><a id="idp88250448" class="indexterm"></a><p>FreeBSD runs on IBM-PC compatible computers, therefore it must
      take into account the PC BIOS partitions.  These are different
      from the traditional BSD partitions.  A PC disk has up to four
      BIOS partition entries.  If the disk is going to be truly
      dedicated to FreeBSD, you can use the
      <span class="emphasis"><em>dedicated</em></span> mode.  Otherwise, FreeBSD will
      have to live within one of the PC BIOS partitions.  FreeBSD
      calls the PC BIOS partitions <span class="emphasis"><em>slices</em></span> so as
      not to confuse them with traditional BSD partitions.  You may
      also use slices on a disk that is dedicated to FreeBSD, but used
      in a computer that also has another operating system installed.
      This is a good way to avoid confusing the <code class="command">fdisk</code> utility of
      other, non-FreeBSD operating systems.</p><p>In the slice case the drive will be added as
      <code class="filename">/dev/da1s1e</code>.  This is read as: SCSI disk,
      unit number 1 (second SCSI disk), slice 1 (PC BIOS partition 1),
      and <code class="filename">e</code> BSD partition.  In the dedicated
      case, the drive will be added simply as
      <code class="filename">/dev/da1e</code>.</p><p>Due to the use of 32-bit integers to store the number of sectors,
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a> is
      limited to 2^32-1 sectors per disk or 2TB in most cases.  The
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fdisk&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">fdisk</span>(8)</span></a> format allows a starting sector of no more than
      2^32-1 and a length of no more than 2^32-1, limiting partitions to
      2TB and disks to 4TB in most cases.  The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sunlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sunlabel</span>(8)</span></a> format
      is limited to 2^32-1 sectors per partition and 8 partitions for
      a total of 16TB. For larger disks, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gpt&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gpt</span>(8)</span></a> partitions may be
      used.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88282832"></a>17.3.1. Using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a></h3></div></div></div><a id="idp88284112" class="indexterm"></a><a id="idp88285392" class="indexterm"></a><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Navigating <span class="application">Sysinstall</span></strong></p><p>You may use <code class="command">sysinstall</code> to
	    partition and label a new disk using its easy to use menus.
	    Either login as user <code class="systemitem">root</code> or use the
	    <code class="command">su</code> command.  Run
	    <code class="command">sysinstall</code> and enter the
	    <code class="literal">Configure</code> menu.  Within the
	    <code class="literal">FreeBSD Configuration Menu</code>, scroll down and
	    select the <code class="literal">Fdisk</code> option.</p></li><li class="step"><p class="title"><strong><span class="application">fdisk</span> Partition Editor</strong></p><p>Once inside <span class="application">fdisk</span>, typing <strong class="userinput"><code>A</code></strong> will
	    use the entire disk for FreeBSD.  When asked if you want to
	    <span class="quote">"<span class="quote">remain cooperative with any future possible operating
	      systems</span>"</span>, answer <code class="literal">YES</code>.  Write the
	    changes to the disk using <strong class="userinput"><code>W</code></strong>.  Now exit the
	    FDISK editor by typing <strong class="userinput"><code>q</code></strong>.  Next you will be
	    asked about the <span class="quote">"<span class="quote">Master Boot Record</span>"</span>.  Since you are adding a
	    disk to an already running system, choose
	    <code class="literal">None</code>.</p></li><li class="step"><p class="title"><strong>Disk Label Editor</strong></p><a id="idp88295888" class="indexterm"></a><p>Next, you need to exit <span class="application">sysinstall</span>
            and start it again.  Follow the directions above, although this
            time choose the <code class="literal">Label</code> option. This will
	    enter the <code class="literal">Disk Label Editor</code>.  This
	    is where you will create the traditional BSD partitions.  A
	    disk can have up to eight partitions, labeled
	    <code class="literal">a-h</code>.
	    A few of the partition labels have special uses.  The
	    <code class="literal">a</code> partition is used for the root partition
	    (<code class="filename">/</code>).  Thus only your system disk (e.g,
	    the disk you boot from) should have an <code class="literal">a</code>
	    partition.  The <code class="literal">b</code> partition is used for
	    swap partitions, and you may have many disks with swap
	    partitions.  The <code class="literal">c</code> partition addresses the
	    entire disk in dedicated mode, or the entire FreeBSD slice in
	    slice mode.  The other partitions are for general use.</p><p><span class="application">sysinstall</span>'s Label editor
	    favors the <code class="literal">e</code>
	    partition for non-root, non-swap partitions.  Within the
	    Label editor, create a single file system by typing
	    <strong class="userinput"><code>C</code></strong>.  When prompted if this will be a FS
	    (file system) or swap, choose <code class="literal">FS</code> and type in a
	    mount point (e.g, <code class="filename">/mnt</code>).  When adding a
	    disk in post-install mode, <span class="application">sysinstall</span>
	    will not create entries
	    in <code class="filename">/etc/fstab</code> for you, so the mount point
	    you specify is not important.</p><p>You are now ready to write the new label to the disk and
	    create a file system on it.  Do this by typing
	    <strong class="userinput"><code>W</code></strong>.  Ignore any errors from
	    <span class="application">sysinstall</span> that
	    it could not mount the new partition.  Exit the Label Editor
	    and <span class="application">sysinstall</span> completely.</p></li><li class="step"><p class="title"><strong>Finish</strong></p><p>The last step is to edit <code class="filename">/etc/fstab</code>
	    to add an entry for your new disk.</p></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88315344"></a>17.3.2. Using Command Line Utilities</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88315984"></a>17.3.2.1. Using Slices</h4></div></div></div><p>This setup will allow your disk to work correctly with
	  other operating systems that might be installed on your
	  computer and will not confuse other operating systems'
	  <code class="command">fdisk</code> utilities.  It is recommended
	  to use this method for new disk installs.  Only use
	  <code class="literal">dedicated</code> mode if you have a good reason
	  to do so!</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/dev/da1 bs=1k count=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>fdisk -BI da1</code></strong> #Initialize your new disk
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -B -w -r da1s1 auto</code></strong> #Label it.
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -e da1s1</code></strong> # Edit the bsdlabel just created and add any partitions.
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/da1s1e</code></strong> # Repeat this for every partition you created.
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/da1s1e /1</code></strong> # Mount the partition(s)
<code class="prompt">#</code> <strong class="userinput"><code>vi /etc/fstab</code></strong> # Add the appropriate entry/entries to your <code class="filename">/etc/fstab</code>.</pre><p>If you have an IDE disk, substitute <code class="filename">ad</code>
	  for <code class="filename">da</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88325968"></a>17.3.2.2. Dedicated</h4></div></div></div><a id="idp88326608" class="indexterm"></a><p>If you will not be sharing the new drive with another operating
	  system, you may use the <code class="literal">dedicated</code> mode.  Remember
	  this mode can confuse Microsoft operating systems; however, no damage
	  will be done by them.  IBM's <span class="trademark">OS/2</span>(R) however, will
	  <span class="quote">"<span class="quote">appropriate</span>"</span> any partition it finds which it does not
	  understand.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/dev/da1 bs=1k count=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -Brw da1 auto</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -e da1</code></strong>				# create the `e' partition
<code class="prompt">#</code> <strong class="userinput"><code>newfs -d0 /dev/da1e</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>vi /etc/fstab</code></strong>				# add an entry for /dev/da1e
<code class="prompt">#</code> <strong class="userinput"><code>mount /1</code></strong></pre><p>An alternate method is:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/dev/da1 count=2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel /dev/da1 | bsdlabel -BrR da1 /dev/stdin</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/da1e</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>vi /etc/fstab</code></strong>					# add an entry for /dev/da1e
<code class="prompt">#</code> <strong class="userinput"><code>mount /1</code></strong></pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="disks-naming.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="raid.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">17.2. Device Names </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 17.4. RAID</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>