<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>14.12. File System Access Control Lists</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="security.html" title="Rozdzia³ 14. Security" /><link rel="prev" href="openssh.html" title="14.11. OpenSSH" /><link rel="next" href="security-portaudit.html" title="14.13. Monitoring Third Party Security Issues" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.12. File System Access Control Lists</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="openssh.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 14. Security</th><td width="20%" align="right"> <a accesskey="n" href="security-portaudit.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="fs-acl"></a>14.12. File System Access Control Lists</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp87015248" class="indexterm"></a><p>In conjunction with file system enhancements like snapshots, FreeBSD 5.0
      and later offers the security of File System Access Control Lists
      (<acronym class="acronym">ACLs</acronym>).</p><p>Access Control Lists extend the standard <span class="trademark">UNIX</span>(R)
      permission model in a highly compatible (<span class="trademark">POSIX</span>(R).1e) way.  This feature
      permits an administrator to make use of and take advantage of a
      more sophisticated security model.</p><p>To enable <acronym class="acronym">ACL</acronym> support for <acronym class="acronym">UFS</acronym>
      file systems, the following:</p><pre class="programlisting">options UFS_ACL</pre><p>must be compiled into the kernel.  If this option has
      not been compiled in, a warning message will be displayed
      when attempting to mount a file system supporting <acronym class="acronym">ACLs</acronym>.
      This option is included in the <code class="filename">GENERIC</code> kernel.
      <acronym class="acronym">ACLs</acronym> rely on extended attributes being enabled on
      the file system.  Extended attributes are natively supported in the next generation
      <span class="trademark">UNIX</span>(R) file system, <acronym class="acronym">UFS2</acronym>.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">A higher level of administrative overhead is required to
      configure extended attributes on <acronym class="acronym">UFS1</acronym> than on
      <acronym class="acronym">UFS2</acronym>.  The performance of extended attributes
      on <acronym class="acronym">UFS2</acronym> is also substantially higher.  As a
      result, <acronym class="acronym">UFS2</acronym> is generally recommended in preference
      to <acronym class="acronym">UFS1</acronym> for use with access control lists.</p></div><p><acronym class="acronym">ACLs</acronym> are enabled by the mount-time administrative
      flag, <code class="option">acls</code>, which may be added to <code class="filename">/etc/fstab</code>.
      The mount-time flag can also be automatically set in a persistent manner using
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a> to modify a superblock <acronym class="acronym">ACLs</acronym> flag in the
      file system header.  In general, it is preferred to use the superblock flag
      for several reasons:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The mount-time <acronym class="acronym">ACLs</acronym> flag cannot be changed by a
	remount (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> <code class="option">-u</code>), only by means of a complete
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=umount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">umount</span>(8)</span></a> and fresh <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>.  This means that
	<acronym class="acronym">ACLs</acronym> cannot be enabled on the root file system after boot.
	It also means that you cannot change the disposition of a file system once
	it is in use.</p></li><li class="listitem"><p>Setting the superblock flag will cause the file system to always be
	mounted with <acronym class="acronym">ACLs</acronym> enabled even if there is not an
	<code class="filename">fstab</code> entry or if the devices re-order.  This prevents
	accidental mounting of the file system without <acronym class="acronym">ACLs</acronym>
	enabled, which can result in <acronym class="acronym">ACLs</acronym> being improperly enforced,
	and hence security problems.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">We may change the <acronym class="acronym">ACLs</acronym> behavior to allow the flag to
      be enabled without a complete fresh <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>, but we consider it desirable to
      discourage accidental mounting without <acronym class="acronym">ACLs</acronym> enabled, because you
      can shoot your feet quite nastily if you enable <acronym class="acronym">ACLs</acronym>, then disable
      them, then re-enable them without flushing the extended attributes.  In general, once
      you have enabled <acronym class="acronym">ACLs</acronym> on a file system, they should not be disabled,
      as the resulting file protections may not be compatible with those intended by the
      users of the system, and re-enabling <acronym class="acronym">ACLs</acronym> may re-attach the previous
      <acronym class="acronym">ACLs</acronym> to files that have since had their permissions changed,
      resulting in other unpredictable behavior.</p></div><p>File systems with <acronym class="acronym">ACLs</acronym> enabled will show a <code class="literal">+</code>
      (plus) sign in their permission settings when viewed.  For example:</p><pre class="programlisting">drwx------  2 robert  robert  512 Dec 27 11:54 private
drwxrwx---+ 2 robert  robert  512 Dec 23 10:57 directory1
drwxrwx---+ 2 robert  robert  512 Dec 22 10:20 directory2
drwxrwx---+ 2 robert  robert  512 Dec 27 11:57 directory3
drwxr-xr-x  2 robert  robert  512 Nov 10 11:54 public_html</pre><p>Here we see that the <code class="filename">directory1</code>,
      <code class="filename">directory2</code>, and <code class="filename">directory3</code>
      directories are all taking advantage of <acronym class="acronym">ACLs</acronym>.  The
      <code class="filename">public_html</code> directory is not.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87066704"></a>14.12.1. Making Use of <acronym class="acronym">ACL</acronym>s</h3></div></div></div><p>The file system <acronym class="acronym">ACL</acronym>s can be viewed by the
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getfacl&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">getfacl</span>(1)</span></a> utility.  For instance, to view the
	<acronym class="acronym">ACL</acronym> settings on the <code class="filename">test</code>
	file, one would use the command:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>getfacl test</code></strong>
	#file:test
	#owner:1001
	#group:1001
	user::rw-
	group::r--
	other::r--</pre><p>To change the <acronym class="acronym">ACL</acronym> settings on this file,
	invoke the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=setfacl&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">setfacl</span>(1)</span></a> utility.  Observe:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>setfacl -k test</code></strong></pre><p>The <code class="option">-k</code> flag will remove all of the
	currently defined <acronym class="acronym">ACL</acronym>s from a file or file
	system.  The more preferable method would be to use
	<code class="option">-b</code> as it leaves the basic fields required for
	<acronym class="acronym">ACL</acronym>s to work.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>setfacl -m u:trhodes:rwx,group:web:r--,o::--- test</code></strong></pre><p>In the aforementioned command, the <code class="option">-m</code>
	option was used to modify the default <acronym class="acronym">ACL</acronym>
	entries.  Since there were no pre-defined entries, as they were
	removed by the previous command, this will restore the default
	options and assign the options listed.  Take care to notice that
	if you add a user or group which does not exist on the system,
	an <span class="errorname">Invalid argument</span> error will be printed
	to <code class="filename">stdout</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="openssh.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="security-portaudit.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">14.11. OpenSSH </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 14.13. Monitoring Third Party Security Issues</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>