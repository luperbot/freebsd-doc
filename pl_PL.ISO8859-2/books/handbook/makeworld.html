<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>21.4. Rebuilding "world"</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="cutting-edge.html" title="Rozdzia³ 21. The Cutting Edge" /><link rel="prev" href="synching.html" title="21.3. Synchronizing Your Source" /><link rel="next" href="small-lan.html" title="21.5. Tracking for Multiple Machines" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">21.4. Rebuilding <span class="quote">"<span class="quote">world</span>"</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="synching.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 21. The Cutting Edge</th><td width="20%" align="right"> <a accesskey="n" href="small-lan.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="makeworld"></a>21.4. Rebuilding <span class="quote">"<span class="quote">world</span>"</span></h2></div></div></div><a id="idp90381264" class="indexterm"></a><p>Once you have synchronized your local source tree against a
      particular version of FreeBSD (FreeBSD-STABLE, FreeBSD-CURRENT, and so on)
      you can then use the source
      tree to rebuild the system.</p><div xmlns="" class="warning"><h3 class="admontitle">Make a Backup: </h3><p xmlns="http://www.w3.org/1999/xhtml">It cannot be stressed enough how important it is to make a
	backup of your system <span class="emphasis"><em>before</em></span> you do this.
	While rebuilding the world is (as long as you follow these
	instructions) an easy task to do, there will inevitably be times
	when you make mistakes, or when mistakes made by others in the
	source tree render your system unbootable.</p><p xmlns="http://www.w3.org/1999/xhtml">Make sure you have taken a backup.  And have a fixit floppy or
	bootable CD at
	hand.  You will probably never have to use it, but it is better to be
	safe than sorry!</p></div><div xmlns="" class="warning"><h3 class="admontitle">Subscribe to the Right Mailing List: </h3><a xmlns="http://www.w3.org/1999/xhtml" id="idp90385232" class="indexterm"></a><p xmlns="http://www.w3.org/1999/xhtml">The FreeBSD-STABLE and FreeBSD-CURRENT branches are, by their
	nature, <span class="emphasis"><em>in development</em></span>.  People that
	contribute to FreeBSD are human, and mistakes occasionally
	happen.</p><p xmlns="http://www.w3.org/1999/xhtml">Sometimes these mistakes can be quite harmless, just causing
	your system to print a new diagnostic warning.  Or the change may
	be catastrophic, and render your system unbootable or destroy your
	file systems (or worse).</p><p xmlns="http://www.w3.org/1999/xhtml">If problems like these occur, a <span class="quote">"<span class="quote">heads up</span>"</span> is
        posted to the appropriate mailing list, explaining the nature of
	the problem and which systems it affects.  And an <span class="quote">"<span class="quote">all
	clear</span>"</span> announcement is posted when the problem has been
	solved.</p><p xmlns="http://www.w3.org/1999/xhtml">If you try to track FreeBSD-STABLE or FreeBSD-CURRENT and do
	not read the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable" target="_top">FreeBSD-STABLE mailing list</a> or the
	<a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">FreeBSD-CURRENT mailing list</a> respectively, then you are
	asking for trouble.</p></div><div xmlns="" class="warning"><h3 class="admontitle">Do not use <code xmlns="http://www.w3.org/1999/xhtml" class="command">make world</code>: </h3><p xmlns="http://www.w3.org/1999/xhtml">A lot of older documentation recommends using
	<code class="command">make world</code> for this.  Doing that skips
	some important steps and should only be used if you are
	sure of what you are doing.  For almost all circumstances
	<code class="command">make world</code> is the wrong thing to do, and
	the procedure described here should be used instead.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90395984"></a>21.4.1. The Canonical Way to Update Your System</h3></div></div></div><p>To update your system, you should check
	<code class="filename">/usr/src/UPDATING</code> for any pre-buildworld steps
	necessary for your version of the sources and then use the following
	procedure:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make buildworld</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildkernel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installkernel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>reboot</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">There are a few rare cases when an extra run of
	  <code class="command">mergemaster -p</code> is needed before the
	  <code class="buildtarget">buildworld</code> step.  These are
	  described in <code class="filename">UPDATING</code>.  In general,
	  though, you can safely omit this step if you are not
	  updating across one or more major FreeBSD versions.</p></div><p>After <code class="buildtarget">installkernel</code> finishes
	successfully, you should boot in single user mode
	(i.e. using <code class="command">boot -s</code> from the loader
	prompt).  Then run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mergemaster -p</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mergemaster</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>reboot</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Read Further Explanations: </h3><p xmlns="http://www.w3.org/1999/xhtml">The sequence described above is only a short resume to
	  help you getting started.  You should however read the
	  following sections to clearly understand each step, especially
	  if you want to use a custom kernel configuration.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90408528"></a>21.4.2. Read <code class="filename">/usr/src/UPDATING</code></h3></div></div></div><p>Before you do anything else, read
	<code class="filename">/usr/src/UPDATING</code> (or the equivalent file
	wherever you have a copy of the source code).  This file should
	contain important information about problems you might encounter, or
	specify the order in which you might have to run certain commands.
	If <code class="filename">UPDATING</code> contradicts something you read here,
	<code class="filename">UPDATING</code> takes precedence.</p><div xmlns="" class="important"><h3 class="admontitle">Wa¿ne: </h3><p xmlns="http://www.w3.org/1999/xhtml">Reading <code class="filename">UPDATING</code> is not an acceptable
	  substitute for subscribing to the correct mailing list, as described
	  previously.  The two requirements are complementary, not
	  exclusive.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90412240"></a>21.4.3. Check <code class="filename">/etc/make.conf</code></h3></div></div></div><a id="idp90413136" class="indexterm"></a><p>Examine the files
	<code class="filename">/usr/share/examples/etc/make.conf</code>
	and
	<code class="filename">/etc/make.conf</code>.  The first contains some
	default defines - most of which are commented out.  To
	make use of them when you rebuild your system from source, add
	them to <code class="filename">/etc/make.conf</code>.  Keep in mind that
	anything you add to <code class="filename">/etc/make.conf</code> is also
	used every time you run <code class="command">make</code>, so it is a good
	idea to set them to something sensible for your system.</p><p>A typical user will probably want to copy the
	<code class="varname">CFLAGS</code> and
	<code class="varname">NO_PROFILE</code> lines found in
	<code class="filename">/usr/share/examples/etc/make.conf</code>
	to
	<code class="filename">/etc/make.conf</code> and uncomment them.</p><p>Examine the other definitions (<code class="varname">COPTFLAGS</code>,
	<code class="varname">NOPORTDOCS</code> and so
	on) and decide if they are relevant to you.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90427856"></a>21.4.4. Update the Files in <code class="filename">/etc</code></h3></div></div></div><p>The <code class="filename">/etc</code> directory contains a large part
	of your system's configuration information, as well as scripts
	that are run at system startup.  Some of these scripts change from
	version to version of FreeBSD.</p><p>Some of the configuration files are also used in the day to
	day running of the system.  In particular,
	<code class="filename">/etc/group</code>.</p><p>There have been occasions when the installation part of
        <code class="command">make installworld</code> has expected certain usernames or groups
	to exist.  When performing an upgrade it is likely that these
	users or groups did not exist. This caused problems when upgrading.
	In some cases <code class="command">make buildworld</code> will check to see if
	these users or groups exist.</p><p>An example of this is when the
	<code class="systemitem">smmsp</code> user was added.  Users had the
	installation process fail for them when
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mtree&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mtree</span>(8)</span></a> was trying to create
	<code class="filename">/var/spool/clientmqueue</code>.</p><p>The solution is to run <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> in
	pre-buildworld mode by providing the <code class="option">-p</code> option.
	This will compare only those files that are essential for the success
	of <code class="buildtarget">buildworld</code> or
	<code class="buildtarget">installworld</code>.  If your old version of
	<code class="command">mergemaster</code> does not support <code class="option">-p</code>,
	use the new version in the source tree when running for the first
	time:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/usr.sbin/mergemaster</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>./mergemaster.sh -p</code></strong></pre><div xmlns="" class="tip"><h3 class="admontitle">Podpowied¼: </h3><p xmlns="http://www.w3.org/1999/xhtml">If you are feeling particularly paranoid, you can check your
	  system to see which files are owned by the group you are
	  renaming or deleting:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>find / -group GID -print</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">will show all files owned by group
	  <em class="replaceable"><code>GID</code></em> (which can be either a group name
	  or a numeric group ID).</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="makeworld-singleuser"></a>21.4.5. Drop to Single User Mode</h3></div></div></div><a id="idp90445904" class="indexterm"></a><p>You may want to compile the system in single user mode.  Apart
	from the obvious benefit of making things go slightly faster,
	reinstalling the system will touch a lot of important system
	files, all the standard system binaries, libraries, include files
	and so on.  Changing these on a running system (particularly if
	you have active users on the system at the time) is asking for
	trouble.</p><a id="idp90446800" class="indexterm"></a><p>Another method is to compile the system in multi-user mode, and
        then drop into single user mode for the installation.  If you would
        like to do it this way, simply hold off on the following steps until
        the build has completed.  You can postpone dropping to single user
	mode until you have to <code class="buildtarget">installkernel</code> or
	<code class="buildtarget">installworld</code>.</p><p>As the superuser, you can execute:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown now</code></strong></pre><p>from a running system, which will drop it to single user
	mode.</p><p>Alternatively, reboot the system, and at the boot prompt,
        select the <span class="quote">"<span class="quote">single user</span>"</span> option.  The system will then boot
	single user.  At the shell prompt you should then run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>fsck -p</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -u /</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -a -t ufs</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>swapon -a</code></strong></pre><p>This checks the file systems, remounts <code class="filename">/</code>
	read/write, mounts all the other UFS file systems referenced in
	<code class="filename">/etc/fstab</code> and then turns swapping on.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">If your CMOS clock is set to local time and not to GMT
	    (this is true if the output of the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=date&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">date</span>(1)</span></a> command
	    does not show the correct time and zone),
            you may also need to run the following command:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>adjkerntz -i</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">This will make sure that your local time-zone settings
            get set up correctly - without this, you may later run into some
            problems.
          </p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90462544"></a>21.4.6. Remove <code class="filename">/usr/obj</code></h3></div></div></div><p>As parts of the system are rebuilt they are placed in
	directories which (by default) go under
	<code class="filename">/usr/obj</code>.  The directories shadow those under
	<code class="filename">/usr/src</code>.</p><p>You can speed up the <code class="command">make buildworld</code> process, and
	possibly save yourself some dependency headaches by removing this
	directory as well.</p><p>Some files below <code class="filename">/usr/obj</code> may have the
	immutable flag set (see <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a> for more information)
	which must be removed first.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/obj</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chflags -R noschg *</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -rf *</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="cutting-edge-compilebase"></a>21.4.7. Recompile the Base System</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90470352"></a>21.4.7.1. Saving the Output</h4></div></div></div><p>It is a good idea to save the output you get from running
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> to another file.  If something goes wrong you will
	  have a copy of the error message.  While this might not help you
	  in diagnosing what has gone wrong, it can help others if you post
	  your problem to one of the FreeBSD mailing lists.</p><p>The easiest way to do this is to use the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=script&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">script</span>(1)</span></a>
	  command, with a parameter that specifies the name of the file to
	  save all output to.  You would do this immediately before
	  rebuilding the world, and then type <strong class="userinput"><code>exit</code></strong>
	  when the process has finished.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>script /var/tmp/mw.out</code></strong>
Script started, output file is /var/tmp/mw.out
<code class="prompt">#</code> <strong class="userinput"><code>make TARGET</code></strong>
<span class="emphasis"><em>... compile, compile, compile ...</em></span>
<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong>
Script done, ...</pre><p>If you do this, <span class="emphasis"><em>do not</em></span> save the output
	  in <code class="filename">/tmp</code>.  This directory may be cleared
	  next time you reboot.  A better place to store it is in
	  <code class="filename">/var/tmp</code> (as in the previous example) or
	  in <code class="systemitem">root</code>'s home directory.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="make-buildworld"></a>21.4.7.2. Compile the Base System</h4></div></div></div><p>You must be in the <code class="filename">/usr/src</code>
	  directory:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong></pre><p>(unless, of course, your source code is elsewhere, in which
	  case change to that directory instead).</p><a id="idp90490064" class="indexterm"></a><p>To rebuild the world you use the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> command.  This
          command reads instructions from the <code class="filename">Makefile</code>,
          which describes how the programs that comprise FreeBSD should be
          rebuilt, the order in which they should be built, and so on.</p><p>The general format of the command line you will type is as
	  follows:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make -x -DVARIABLE target</code></strong></pre><p>In this example, <code class="option">-<em class="replaceable"><code>x</code></em></code>
	  is an option that you would pass to <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>.  See the
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> manual page for an example of the options you can
	  pass.</p><p><code class="option">-D<em class="replaceable"><code>VARIABLE</code></em></code>
	  passes a variable to the <code class="filename">Makefile</code>.  The
	  behavior of the <code class="filename">Makefile</code> is controlled by
	  these variables.  These are the same variables as are set in
	  <code class="filename">/etc/make.conf</code>, and this provides another
	  way of setting them.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make -DNO_PROFILE target</code></strong></pre><p>is another way of specifying that profiled libraries should
	  not be built, and corresponds with the</p><pre class="programlisting">NO_PROFILE=    true 	#    Avoid compiling profiled libraries</pre><p>line in <code class="filename">/etc/make.conf</code>.</p><p><em class="replaceable"><code>target</code></em> tells <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> what
	  you want to do.  Each <code class="filename">Makefile</code> defines a
	  number of different <span class="quote">"<span class="quote">targets</span>"</span>, and your choice of
	  target determines what happens.</p><p>Some targets are listed in the
	  <code class="filename">Makefile</code>, but are not meant for you to run.
	  Instead, they are used by the build process to break out the
	  steps necessary to rebuild the system into a number of
	  sub-steps.</p><p>Most of the time you will not need to pass any parameters to
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>, and so your command like will look like
	    this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make target</code></strong></pre><p>Where <em class="replaceable"><code>target</code></em> will be one of
	  many build options.  The first target should always be
	  <code class="varname">buildworld</code>.</p><p>As the names imply, <code class="buildtarget">buildworld</code>
	  builds a complete new tree under <code class="filename">/usr/obj</code>,
	  and <code class="buildtarget">installworld</code>, another target, installs this tree on
	  the current machine.</p><p>Having separate options is very useful for two reasons.  First, it allows you
	  to do the build safe in the knowledge that no components of
	  your running system will be affected.  The build is
	  <span class="quote">"<span class="quote">self hosted</span>"</span>.  Because of this, you can safely
	  run <code class="buildtarget">buildworld</code> on a machine running
	  in multi-user mode with no fear of ill-effects.  It is still
	  recommended that you run the
	  <code class="buildtarget">installworld</code> part in single user
	  mode, though.</p><p>Secondly, it allows you to use NFS mounts to upgrade
	  multiple machines on your network.  If you have three machines,
	  <code class="systemitem">A</code>, <code class="systemitem">B</code> and <code class="systemitem">C</code> that you want to upgrade, run <code class="command">make
	  buildworld</code> and <code class="command">make installworld</code> on
	  <code class="systemitem">A</code>.  <code class="systemitem">B</code> and <code class="systemitem">C</code> should then NFS mount <code class="filename">/usr/src</code>
	  and <code class="filename">/usr/obj</code> from <code class="systemitem">A</code>, and you can then run
	  <code class="command">make installworld</code> to install the results of
	  the build on <code class="systemitem">B</code> and <code class="systemitem">C</code>.</p><p>Although the <code class="buildtarget">world</code> target still exists,
	  you are strongly encouraged not to use it.</p><p>Run</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make buildworld</code></strong></pre><p>It is possible to specify a <code class="option">-j</code> option to
          <code class="command">make</code> which will cause it to spawn several
          simultaneous processes.  This is most useful on multi-CPU machines.
          However, since much of the compiling process is IO bound rather
          than CPU bound it is also useful on single CPU machines.</p><p>On a typical single-CPU machine you would run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make -j4 buildworld</code></strong></pre><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> will then have up to 4 processes running at any one
	  time.  Empirical evidence posted to the mailing lists shows this
	  generally gives the best performance benefit.</p><p>If you have a multi-CPU machine and you are using an SMP
	  configured kernel try values between 6 and 10 and see how they speed
	  things up.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90530512"></a>21.4.7.3. Timings</h4></div></div></div><a id="idp90531152" class="indexterm"></a><p>Many factors influence the build time, but fairly recent
          machines may only take a one or two hours to build
          the FreeBSD-STABLE tree, with no tricks or shortcuts used during the
          process.  A FreeBSD-CURRENT tree will take somewhat longer.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90533200"></a>21.4.8. Compile and Install a New Kernel</h3></div></div></div><a id="idp90533840" class="indexterm"></a><p>To take full advantage of your new system you should recompile the
	kernel.  This is practically a necessity, as certain memory structures
	may have changed, and programs like <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a> will
	fail to work until the kernel and source code versions are the
	same.</p><p>The simplest, safest way to do this is to build and install a
	kernel based on <code class="filename">GENERIC</code>.  While
	<code class="filename">GENERIC</code> may not have all the necessary devices
	for your system, it should contain everything necessary to boot your
	system back to single user mode.  This is a good test that the new
	system works properly.  After booting from
	<code class="filename">GENERIC</code> and verifying that your system works you
	can then build a new kernel based on your normal kernel	configuration
	file.</p><p>On FreeBSD it is important to <a class="link" href="makeworld.html#make-buildworld" title="21.4.7.2. Compile the Base System">build world</a> before building a
        new kernel.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">If you want to build a custom kernel, and already have a configuration
	file, just use <code class="literal">KERNCONF=MYKERNEL</code>
	like this:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildkernel KERNCONF=MYKERNEL</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installkernel KERNCONF=MYKERNEL</code></strong></pre></div><p>Note that if you have raised <code class="literal">kern.securelevel</code>
	above 1 <span class="emphasis"><em>and</em></span> you have set either the
	<code class="literal">noschg</code> or similar flags to your kernel binary, you
	might find it necessary to drop into single user mode to use
	<code class="buildtarget">installkernel</code>.  Otherwise you should be able
	to run both these commands from multi user mode without
	problems.  See <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a> for details about
	<code class="literal">kern.securelevel</code> and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a> for details
	about the various file flags.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90555344"></a>21.4.9. Reboot into Single User Mode</h3></div></div></div><a id="idp90555984" class="indexterm"></a><p>You should reboot into single user mode to test the new kernel
	works.  Do this by following the instructions in
	<a class="xref" href="makeworld.html#makeworld-singleuser" title="21.4.5. Drop to Single User Mode">Sekcja 21.4.5, "Drop to Single User Mode"</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="make-installworld"></a>21.4.10. Install the New System Binaries</h3></div></div></div><p>If you were building a version of FreeBSD recent enough to have
	used <code class="command">make buildworld</code> then you should now use
	<code class="buildtarget">installworld</code> to install the new system
	binaries.</p><p>Run</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">If you specified variables on the <code class="command">make
	    buildworld</code> command line, you must specify the same
	  variables in the <code class="command">make installworld</code> command
	  line.  This does not necessarily hold true for other options;
	  for example, <code class="option">-j</code> must never be used with
	  <code class="buildtarget">installworld</code>.</p><p xmlns="http://www.w3.org/1999/xhtml">For example, if you ran:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make -DNO_PROFILE buildworld</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">you must install the results with:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make -DNO_PROFILE installworld</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">otherwise it would try to install profiled libraries that
	  had not been built during the <code class="command">make buildworld</code>
	  phase.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90571472"></a>21.4.11. Update Files Not Updated by <code class="command">make installworld</code></h3></div></div></div><p>Remaking the world will not update certain directories (in
	particular, <code class="filename">/etc</code>, <code class="filename">/var</code> and
	<code class="filename">/usr</code>) with new or changed configuration files.</p><p>The simplest way to update these files is to use
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a>, though it is possible to do it manually
        if you would prefer to do that.  Regardless of which way you
	choose, be sure to make a backup of <code class="filename">/etc</code> in
	case anything goes wrong.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mergemaster"></a>21.4.11.1. <code class="command">mergemaster</code></h4></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp90578256" class="indexterm"></a><p>The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> utility is a Bourne script that will
        aid you in determining the differences between your configuration files
        in <code class="filename">/etc</code>, and the configuration files in
        the source tree <code class="filename">/usr/src/etc</code>. This is
        the recommended solution for keeping the system configuration files up to date
        with those located in the source tree.</p><p>To begin simply type <code class="command">mergemaster</code> at your prompt, and
        watch it start going.  <code class="command">mergemaster</code> will then build a
        temporary root environment, from <code class="filename">/</code> down, and populate
        it with various system configuration files.  Those files are then compared
        to the ones currently installed in your system.  At this point, files that
        differ will be shown in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> format, with the <code class="option">+</code> sign
        representing added or modified lines, and <code class="option">-</code> representing
        lines that will be either removed completely, or replaced with a new line.
        See the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> manual page for more information about the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a>
        syntax and how file differences are shown.</p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> will then show you each file that displays variances,
        and at this point you will have the option of either deleting the new file (referred
        to as the temporary file), installing the temporary file in its unmodified state,
        merging the temporary file with the currently installed file, or viewing the
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> results again.</p><p>Choosing to delete the temporary file will tell <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> that we
        wish to keep our current file unchanged, and to delete the new version.
        This option is not recommended, unless you see no
        reason to change the current file.  You can get help at any time by
        typing <span class="keycap"><strong>?</strong></span> at the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> prompt.  If the user
        chooses to skip a file, it will be presented again after all other files
        have been dealt with.</p><p>Choosing to install the unmodified temporary file will replace the
        current file with the new one.  For most unmodified files, this is the best
        option.</p><p>Choosing to merge the file will present you with a text editor,
        and the contents of both files.  You can now merge them by
        reviewing both files side by side on the screen, and choosing parts from
        both to create a finished product.  When the files are compared side by side,
        the <span class="keycap"><strong>l</strong></span> key will select the left contents and the
        <span class="keycap"><strong>r</strong></span> key will select contents from your right.
        The final output will be a file consisting of both parts, which can then be
        installed.  This option is customarily used for files where settings have been
        modified by the user.</p><p>Choosing to view the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> results again will show you the file differences
        just like <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> did before prompting you for an option.</p><p>After <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> is done with the system files you will be
        prompted for other options.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> may ask if you want to rebuild
        the password file and will finish up with an option to
        remove left-over temporary files.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90599504"></a>21.4.11.2. Manual Update</h4></div></div></div><p>If you wish to do the update manually, however,
        you cannot just copy over the files from
	<code class="filename">/usr/src/etc</code> to <code class="filename">/etc</code> and
	have it work.  Some of these files must be <span class="quote">"<span class="quote">installed</span>"</span>
	first.  This is because the <code class="filename">/usr/src/etc</code>
	directory <span class="emphasis"><em>is not</em></span> a copy of what your
	<code class="filename">/etc</code> directory should look like.  In addition,
	there are files that should be in <code class="filename">/etc</code> that are
	not in <code class="filename">/usr/src/etc</code>.</p><p>If you are using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> (as recommended),
        you can skip forward to the <a class="link" href="makeworld.html#cutting-edge-rebooting" title="21.4.12. Rebooting">next
	section</a>.</p><p>The simplest way to do this by hand is to install the
	files into a new directory, and then work through them looking
	for differences.</p><div xmlns="" class="warning"><h3 class="admontitle">Backup Your Existing <code xmlns="http://www.w3.org/1999/xhtml" class="filename">/etc</code>: </h3><p xmlns="http://www.w3.org/1999/xhtml">Although, in theory, nothing is going to touch this directory
	  automatically, it is always better to be sure.  So copy your
	  existing <code class="filename">/etc</code> directory somewhere safe.
	  Something like:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp -Rp /etc /etc.old</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml"><code class="option">-R</code> does a recursive copy, <code class="option">-p</code>
	  preserves times, ownerships on files and suchlike.</p></div><p>You need to build a dummy set of directories to install the new
	<code class="filename">/etc</code> and other files into.
	<code class="filename">/var/tmp/root</code> is a reasonable choice, and
	there are a number of subdirectories required under this as
	well.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /var/tmp/root</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/etc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make DESTDIR=/var/tmp/root distrib-dirs distribution</code></strong></pre><p>This will build the necessary directory structure and install the
	files.  A lot of the subdirectories that have been created under
	<code class="filename">/var/tmp/root</code> are empty and should be deleted.
	The simplest way to do this is to:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /var/tmp/root</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>find -d . -type d | xargs rmdir 2&gt;/dev/null</code></strong></pre><p>This will remove all empty directories.  (Standard error is
        redirected to <code class="filename">/dev/null</code> to prevent the warnings
        about the directories that are not empty.)</p><p><code class="filename">/var/tmp/root</code> now contains all the files that
	should be placed in appropriate locations below
	<code class="filename">/</code>.  You now have to go through each of these
	files, determining how they differ with your existing files.</p><p>Note that some of the files that will have been installed in
	<code class="filename">/var/tmp/root</code> have a leading <span class="quote">"<span class="quote">.</span>"</span>.  At the
	time of writing the only files like this are shell startup files in
	<code class="filename">/var/tmp/root/</code> and
	<code class="filename">/var/tmp/root/root/</code>, although there may be others
	(depending on when you are reading this).  Make sure you use
	<code class="command">ls -a</code> to catch them.</p><p>The simplest way to do this is to use <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> to compare the
	two files:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>diff /etc/shells /var/tmp/root/etc/shells</code></strong></pre><p>This will show you the differences between your
	<code class="filename">/etc/shells</code> file and the new
	<code class="filename">/var/tmp/root/etc/shells</code> file.  Use these to decide whether to
	merge in changes that you have made or whether to copy over your old
	file.</p><div xmlns="" class="tip"><h3 class="admontitle">Name the New Root Directory
	  (<code xmlns="http://www.w3.org/1999/xhtml" class="filename">/var/tmp/root</code>) with a Time Stamp, so You Can
	  Easily Compare Differences Between Versions: </h3><p xmlns="http://www.w3.org/1999/xhtml">Frequently rebuilding the world means that you have to update
	<code class="filename">/etc</code> frequently as well, which can be a bit of
	  a chore.</p><p xmlns="http://www.w3.org/1999/xhtml">You can speed this process up by keeping a copy of the last set
	  of changed files that you merged into <code class="filename">/etc</code>.
	  The following procedure gives one idea of how to do this.</p><div xmlns="http://www.w3.org/1999/xhtml" class="procedure"><ol class="procedure" type="1"><li class="step"><p>Make the world as normal.  When you want to update
	      <code class="filename">/etc</code> and the other directories, give the
	      target directory a name based on the current date.  If you were
	      doing this on the 14th of February 1998 you could do the
	      following:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /var/tmp/root-19980214</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/etc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make DESTDIR=/var/tmp/root-19980214 \
    distrib-dirs distribution</code></strong></pre></li><li class="step"><p>Merge in the changes from this directory as outlined
	      above.</p><p><span class="emphasis"><em>Do not</em></span> remove the
	      <code class="filename">/var/tmp/root-19980214</code> directory when you
	      have finished.</p></li><li class="step"><p>When you have downloaded the latest version of the source
	      and remade it, follow step 1.  This will give you a new
	      directory, which might be called
	      <code class="filename">/var/tmp/root-19980221</code> (if you wait a week
	      between doing updates).</p></li><li class="step"><p>You can now see the differences that have been made in the
	      intervening week using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> to create a recursive diff
	      between the two directories:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /var/tmp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>diff -r root-19980214 root-19980221</code></strong></pre><p>Typically, this will be a much smaller set of differences
	      than those between
	      <code class="filename">/var/tmp/root-19980221/etc</code> and
	      <code class="filename">/etc</code>.  Because the set of differences is
	      smaller, it is easier to migrate those changes across into your
	      <code class="filename">/etc</code> directory.</p></li><li class="step"><p>You can now remove the older of the two
	      <code class="filename">/var/tmp/root-*</code> directories:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rm -rf /var/tmp/root-19980214</code></strong></pre></li><li class="step"><p>Repeat this process every time you need to merge in changes
	      to <code class="filename">/etc</code>.</p></li></ol></div><p xmlns="http://www.w3.org/1999/xhtml">You can use <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=date&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">date</span>(1)</span></a> to automate the generation of the
	  directory names:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /var/tmp/root-`date "+%Y%m%d"`</code></strong></pre></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="cutting-edge-rebooting"></a>21.4.12. Rebooting</h3></div></div></div><p>You are now done.  After you have verified that everything appears
	to be in the right place you can reboot the system.  A simple
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=shutdown&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">shutdown</span>(8)</span></a> should do it:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90666960"></a>21.4.13. Finished</h3></div></div></div><p>You should now have successfully upgraded your FreeBSD system.
	Congratulations.</p><p>If things went slightly wrong, it is easy to rebuild a particular
        piece of the system.  For example, if you accidentally deleted
        <code class="filename">/etc/magic</code> as part of the upgrade or merge of
        <code class="filename">/etc</code>, the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=file&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">file</span>(1)</span></a> command will stop working.
        In this case, the fix would be to run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/usr.bin/file</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make all install</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90671696"></a>21.4.14. Questions</h3></div></div></div><div class="qandaset"><a id="idp90672336"></a><dl><dt>21.4.14.1. <a href="makeworld.html#idp90672592">Do I need to re-make the world for every change?</a></dt><dt>21.4.14.2. <a href="makeworld.html#idp90679248">My compile failed with lots of signal 11 (or other signal
	      number) errors.  What has happened?</a></dt><dt>21.4.14.3. <a href="makeworld.html#idp90686800">Can I remove /usr/obj when I have
	      finished?</a></dt><dt>21.4.14.4. <a href="makeworld.html#idp90691280">Can interrupted builds be resumed?</a></dt><dt>21.4.14.5. <a href="makeworld.html#idp90706768">How can I speed up making the world?</a></dt><dt>21.4.14.6. <a href="makeworld.html#idp90733520">What do I do if something goes wrong?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp90672592"></a><a id="idp90672848"></a><p><strong>21.4.14.1.</strong></p></td><td align="left" valign="top"><p>Do I need to re-make the world for every change?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>There is no easy answer to this one, as it depends on the
	      nature of the change.  For example, if you just ran <span class="application">CVSup</span>, and
	      it has shown the following files as being updated:</p><pre class="screen"><code class="filename">src/games/cribbage/instr.c</code>
<code class="filename">src/games/sail/pl_main.c</code>
<code class="filename">src/release/sysinstall/config.c</code>
<code class="filename">src/release/sysinstall/media.c</code>
<code class="filename">src/share/mk/bsd.port.mk</code></pre><p>it probably is not worth rebuilding the entire world.
	      You could just go to the appropriate sub-directories and
	      <code class="command">make all install</code>, and that's about it.  But
	      if something major changed, for example
	      <code class="filename">src/lib/libc/stdlib</code> then you should either
	      re-make the world, or at least those parts of it that are
	      statically linked (as well as anything else you might have added
	      that is statically linked).</p><p>At the end of the day, it is your call.  You might be happy
	      re-making the world every fortnight say, and let changes
	      accumulate over that fortnight.  Or you might want to re-make
	      just those things that have changed, and be confident you can
	      spot all the dependencies.</p><p>And, of course, this all depends on how often you want to
	      upgrade, and whether you are tracking FreeBSD-STABLE or
	      FreeBSD-CURRENT.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp90679248"></a><a id="idp90679504"></a><p><strong>21.4.14.2.</strong></p></td><td align="left" valign="top"><p>My compile failed with lots of signal 11<a id="idp90680016" class="indexterm"></a> (or other signal
	      number) errors.  What has happened?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>This is normally indicative of hardware problems.
	      (Re)making the world is an effective way to stress test your
	      hardware, and will frequently throw up memory problems.  These
	      normally manifest themselves as the compiler mysteriously dying
	      on receipt of strange signals.</p><p>A sure indicator of this is if you can restart the make and
	      it dies at a different point in the process.</p><p>In this instance there is little you can do except start
	      swapping around the components in your machine to determine
	      which one is failing.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp90686800"></a><a id="idp90687056"></a><p><strong>21.4.14.3.</strong></p></td><td align="left" valign="top"><p>Can I remove <code class="filename">/usr/obj</code> when I have
	      finished?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>The short answer is yes.</p><p><code class="filename">/usr/obj</code> contains all the object files
	      that were produced during the compilation phase.  Normally, one
	      of the first steps in the <code class="command">make buildworld</code> process is to
	      remove this directory and start afresh.  In this case, keeping
	      <code class="filename">/usr/obj</code> around after you have finished
	      makes little sense, and will free up a large chunk of disk space
	      (currently about 340 MB).</p><p>However, if you know what you are doing you can have
	      <code class="command">make buildworld</code> skip this step.  This will make subsequent
	      builds run much faster, since most of sources will not need to
	      be recompiled.  The flip side of this is that subtle dependency
	      problems can creep in, causing your build to fail in odd ways.
	      This frequently generates noise on the FreeBSD mailing lists,
	      when one person complains that their build has failed, not
	      realizing that it is because they have tried to cut
	      corners.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp90691280"></a><a id="idp90691536"></a><p><strong>21.4.14.4.</strong></p></td><td align="left" valign="top"><p>Can interrupted builds be resumed?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>This depends on how far through the process you got before
	      you found a problem.</p><p><span class="emphasis"><em>In general</em></span> (and this is not a hard and
	      fast rule) the <code class="command">make buildworld</code> process builds new
	      copies of essential tools (such as <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gcc&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">gcc</span>(1)</span></a>, and
	      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>) and the system libraries.  These tools and
	      libraries are then installed.  The new tools and libraries are
	      then used to rebuild themselves, and are installed again. The
	      entire system (now including regular user programs, such as
		<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> or <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=grep&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">grep</span>(1)</span></a>) is then rebuilt with the new
	      system files.</p><p>If you are at the last stage, and you know it (because you
	      have looked through the output that you were storing) then you
	      can (fairly safely) do:</p><pre class="screen"><span class="emphasis"><em>... fix the problem ...</em></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make -DNO_CLEAN all</code></strong></pre><p>This will not undo the work of the previous
	      <code class="command">make buildworld</code>.</p><p>If you see the message:</p><pre class="screen">--------------------------------------------------------------
Building everything..
--------------------------------------------------------------</pre><p>in the <code class="command">make buildworld</code> output then it is
	      probably fairly safe to do so.</p><p>If you do not see that message, or you are not sure, then it
	      is always better to be safe than sorry, and restart the build
	      from scratch.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp90706768"></a><a id="idp90707024"></a><p><strong>21.4.14.5.</strong></p></td><td align="left" valign="top"><p>How can I speed up making the world?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Run in single user mode.</p></li><li class="listitem"><p>Put the <code class="filename">/usr/src</code> and
		  <code class="filename">/usr/obj</code> directories on separate
		  file systems held on separate disks.  If possible, put these
		  disks on separate disk controllers.</p></li><li class="listitem"><p>Better still, put these file systems across multiple
		  disks using the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a> (concatenated disk
		  driver) device.</p></li><li class="listitem"><p>Turn off profiling (set <span class="quote">"<span class="quote">NO_PROFILE=true</span>"</span> in
		  <code class="filename">/etc/make.conf</code>).  You almost certainly
		  do not need it.</p></li><li class="listitem"><p>Also in <code class="filename">/etc/make.conf</code>, set
		  <code class="varname">CFLAGS</code> to something like <code class="option">-O
		  -pipe</code>.  The optimization <code class="option">-O2</code> is much
		  slower, and the optimization difference between
		  <code class="option">-O</code> and <code class="option">-O2</code> is normally
		  negligible.  <code class="option">-pipe</code> lets the compiler use
		  pipes rather than temporary files for communication, which
		  saves disk access (at the expense of memory).</p></li><li class="listitem"><p>Pass the <code class="option">-j<em class="replaceable"><code>n</code></em></code> option to <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> to
		  run multiple processes in parallel.  This usually helps
		  regardless of whether you have a single or a multi processor
		  machine.</p></li><li class="listitem"><p>The file system holding
		  <code class="filename">/usr/src</code> can be mounted (or remounted)
		  with the <code class="option">noatime</code> option.  This prevents the
		  file system from recording the file access time.  You probably
		  do not need this information anyway.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -u -o noatime /usr/src</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Ostrze¿enie: </h3><p xmlns="http://www.w3.org/1999/xhtml">The example assumes <code class="filename">/usr/src</code> is
		      on its own file system.  If it is not (if it is a part of
		      <code class="filename">/usr</code> for example) then you will
		      need to use that file system mount point, and not
		      <code class="filename">/usr/src</code>.</p></div></li><li class="listitem"><p>The file system holding <code class="filename">/usr/obj</code> can
		  be mounted (or remounted) with the <code class="option">async</code>
		  option.  This causes disk writes to happen asynchronously.
		  In other words, the write completes immediately, and the
		  data is written to the disk a few seconds later.  This
		  allows writes to be clustered together, and can be a
		  dramatic performance boost.</p><div xmlns="" class="warning"><h3 class="admontitle">Ostrze¿enie: </h3><p xmlns="http://www.w3.org/1999/xhtml">Keep in mind that this option makes your file system
		    more fragile.  With this option there is an increased
		    chance that, should power fail, the file system will be in
		    an unrecoverable state when the machine restarts.</p><p xmlns="http://www.w3.org/1999/xhtml">If <code class="filename">/usr/obj</code> is the only thing on
		    this file system then it is not a problem.  If you have
		    other, valuable data on the same file system then ensure
		    your backups are fresh before you enable this
		    option.</p></div><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -u -o async /usr/obj</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Ostrze¿enie: </h3><p xmlns="http://www.w3.org/1999/xhtml">As above, if <code class="filename">/usr/obj</code> is not on
		    its own file system, replace it in the example with the
		    name of the appropriate mount point.</p></div></li></ul></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp90733520"></a><a id="idp90733776"></a><p><strong>21.4.14.6.</strong></p></td><td align="left" valign="top"><p>What do I do if something goes wrong?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Make absolutely sure your environment has no
              extraneous cruft from earlier builds.  This is simple
              enough.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chflags -R noschg /usr/obj/usr</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -rf /usr/obj/usr</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make cleandir</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make cleandir</code></strong></pre><p>Yes, <code class="command">make cleandir</code> really should
              be run twice.</p><p>Then restart the whole process, starting
              with <code class="command">make buildworld</code>.</p><p>If you still have problems, send the error and the
              output of <code class="command">uname -a</code> to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">Ogólna lista dyskusyjna FreeBSD</a>.
              Be prepared to answer other questions about your
              setup!</p></td></tr></tbody></table></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="synching.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="cutting-edge.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="small-lan.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">21.3. Synchronizing Your Source </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 21.5. Tracking for Multiple Machines</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>