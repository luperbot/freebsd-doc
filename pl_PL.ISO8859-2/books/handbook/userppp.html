<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>23.2. Using User PPP</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="ppp-and-slip.html" title="Rozdzia³ 23. PPP and SLIP" /><link rel="prev" href="ppp-and-slip.html" title="Rozdzia³ 23. PPP and SLIP" /><link rel="next" href="ppp.html" title="23.3. Using Kernel PPP" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">23.2. Using User PPP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ppp-and-slip.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 23. PPP and SLIP</th><td width="20%" align="right"> <a accesskey="n" href="ppp.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="userppp"></a>23.2. Using User PPP</h2></div><div><span class="authorgroup">Updated and enhanced by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Brian</span> <span class="surname">Somers</span></span>. </span></div><div><span class="authorgroup">With input from <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Nik</span> <span class="surname">Clayton</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Dirk</span> <span class="surname">Frömberg</span></span> i <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Peter</span> <span class="surname">Childs</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91754192"></a>23.2.1. User PPP</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91754832"></a>23.2.1.1. Assumptions</h4></div></div></div><p>This document assumes you have the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An account with an Internet Service Provider (ISP)<a id="ppp-isp" class="indexterm"></a> which
	      you connect to using PPP<a id="ppp-ppp2" class="indexterm"></a>.</p></li><li class="listitem"><p>You have a modem or
	      other device connected to your system and configured
	      correctly which allows you to connect to your ISP.</p></li><li class="listitem"><p>The dial-up number(s) of your ISP.</p></li><li class="listitem"><p>Your login name<a id="ppp-login" class="indexterm"></a> and password<a id="ppp-password" class="indexterm"></a>. (Either a
	      regular <span class="trademark">UNIX</span>(R)<a id="ppp-unix" class="indexterm"></a> style login and password pair, or a
	      PAP<a id="ppp-pap" class="indexterm"></a> or CHAP<a id="ppp-chap" class="indexterm"></a>
	      login and password pair.)</p></li><li class="listitem"><p>The IP address of one or more name servers<a id="ppp-nameserver" class="indexterm"></a>.
	      Normally, you will be given two IP addresses by your ISP to
	      use for this.  If they have not given you at least one, then
	      you can use the <code class="command">enable dns</code> command in
	      <code class="filename">ppp.conf</code> and
	      <span class="application">ppp</span> will set the name servers for
	      you.  This feature depends on your ISPs PPP implementation
              supporting DNS negotiation.</p></li></ul></div><p>The following information may be supplied by your ISP, but
	  is not completely necessary:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The IP address of your ISP's gateway.  The gateway is
	      the machine to which you will connect and will be set up as
	      your <span class="emphasis"><em>default route</em></span>.  If you do not have
	      this information, we can make one up and your ISP's PPP
	      server will tell us the correct value when we connect.</p><p>This IP number is referred to as
	      <code class="literal">HISADDR</code> by
	      <span class="application">ppp</span>.</p></li><li class="listitem"><p>The netmask you should use.  If your ISP has not
	      provided you with one, you can safely use <code class="systemitem">255.255.255.255</code>.</p></li><li class="listitem"><p>If your ISP provides you with a static IP address<a id="ppp-static-ip" class="indexterm"></a> and
	      hostname, you can enter it.  Otherwise, we simply let the
	      peer assign whatever IP address it sees fit.</p></li></ul></div><p>If you do not have any of the required information, contact
	  your ISP.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">Throughout this section, many of the examples showing
	    the contents of configuration files are numbered by line.
	    These numbers serve to aid in the presentation and
	    discussion only and are not meant to be placed in the actual
	    file.  Proper indentation with tab and space characters is
	    also important.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91778256"></a>23.2.1.2. Automatic <span class="application">PPP</span> Configuration</h4></div></div></div><a id="idp91779280" class="indexterm"></a><p>Both <code class="command">ppp</code> and <code class="command">pppd</code>
	  (the kernel level implementation of PPP) use the configuration
	  files located in the <code class="filename">/etc/ppp</code> directory.
          Examples for user ppp can be found in
          <code class="filename">/usr/share/examples/ppp/</code>.</p><p>Configuring <code class="command">ppp</code> requires that you edit a
	  number of files, depending on your requirements.  What you put
	  in them depends to some extent on whether your ISP allocates IP
	  addresses statically (i.e., you get given one IP address, and
	  always use that one) or dynamically (i.e., your IP address
	  changes each time you connect to your ISP).</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-staticIP"></a>23.2.1.2.1. PPP and Static IP Addresses</h5></div></div></div><a id="idp91783632" class="indexterm"></a><p>You will need to edit the
	    <code class="filename">/etc/ppp/ppp.conf</code> configuration file.  It
            should look similar to the example below.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">Lines that end in a <code class="literal">:</code> start in
	      the first column (beginning of the line)- all other
	      lines should be indented as shown using spaces or
	      tabs.</p></div><pre class="programlisting">1     default:
2       set log Phase Chat LCP IPCP CCP tun command
3       ident user-ppp VERSION (built COMPILATIONDATE)
4       set device /dev/cuaa0
5       set speed 115200
6       set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \
7                 \"\" AT OK-AT-OK ATE1Q0 OK \\dATDT\\T TIMEOUT 40 CONNECT"
8       set timeout 180
9       enable dns
10
11    provider:
12      set phone "(123) 456 7890"
13      set authname foo
14      set authkey bar
15      set login "TIMEOUT 10 \"\" \"\" gin:--gin: \\U word: \\P col: ppp"
16      set timeout 300
17      set ifaddr <em class="replaceable"><code>x.x.x.x</code></em> <em class="replaceable"><code>y.y.y.y</code></em> 255.255.255.255 0.0.0.0
18      add default HISADDR</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">Line 1:</span></dt><dd><p>Identifies the default entry.  Commands in this
		  entry are executed automatically when ppp is run.</p></dd><dt><span class="term">Line 2:</span></dt><dd><p>Enables logging parameters.  When the configuration
		  is working satisfactorily, this line should be reduced
                  to saying

	          </p><pre class="programlisting">set log phase tun</pre><p>

                  in order to avoid excessive log file sizes.</p></dd><dt><span class="term">Line 3:</span></dt><dd><p>Tells PPP how to identify itself to the peer.
                  PPP identifies itself to the peer if it has any trouble
                  negotiating and setting up the link, providing information
                  that the peers administrator may find useful when
                  investigating such problems.</p></dd><dt><span class="term">Line 4:</span></dt><dd><p>Identifies the device to which the modem is
		  connected.  <code class="filename">COM1</code> is
		  <code class="filename">/dev/cuaa0</code> and
		  <code class="filename">COM2</code> is
		  <code class="filename">/dev/cuaa1</code>.</p></dd><dt><span class="term">Line 5:</span></dt><dd><p>Sets the speed you want to connect at.  If 115200
		  does not work (it should with any reasonably new modem),
		  try 38400 instead.</p></dd><dt><span class="term">Line 6 &amp; 7:</span></dt><dd><p>The dial string.  User PPP<a id="idp91806928" class="indexterm"></a> uses an expect-send
		  syntax similar to the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">chat</span>(8)</span></a> program.  Refer to
		  the manual page for information on the features of this
		  language.</p><p>Note that this command continues onto the next line
                   for readability.  Any command in
                   <code class="filename">ppp.conf</code> may do this if the last
                   character on the line is a ``\'' character.</p></dd><dt><span class="term">Line 8:</span></dt><dd><p>Sets the idle timeout for the link.  180 seconds
		  is the default, so this line is purely cosmetic.</p></dd><dt><span class="term">Line 9:</span></dt><dd><p>Tells PPP to ask the peer to confirm the local
		  resolver settings.  If you run a local name server, this
                  line should be commented out or removed.</p></dd><dt><span class="term">Line 10:</span></dt><dd><p>A blank line for readability.  Blank lines are ignored
		by PPP.</p></dd><dt><span class="term">Line 11:</span></dt><dd><p>Identifies an entry for a provider called
		  <span class="quote">"<span class="quote">provider</span>"</span>.  This could be changed
                    to the name of your <acronym class="acronym">ISP</acronym> so
                    that later you can use the <code class="option">load ISP</code>
                    to start the connection.</p></dd><dt><span class="term">Line 12:</span></dt><dd><p>Sets the phone number for this provider.  Multiple
		  phone numbers may be specified using the colon
		  (<code class="literal">:</code>) or pipe character
		  (<code class="literal">|</code>)as a separator.  The difference
		  between the two separators is described in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>.
		  To summarize, if you want to rotate through the numbers,
		  use a colon.  If you want to always attempt to dial the
		  first number first and only use the other numbers if the
		  first number fails, use the pipe character.  Always
		  quote the entire set of phone numbers as shown.</p><p>You must enclose the phone number in quotation marks
		(<code class="literal">"</code>) if there is any intention on using
		spaces in the phone number.  This can cause a simple, yet
		subtle error.</p></dd><dt><span class="term">Line 13 &amp; 14:</span></dt><dd><p>Identifies the user name and password.  When
                  connecting using a <span class="trademark">UNIX</span>(R) style login prompt, these
                  values are referred to by the <code class="command">set
                  login</code> command using the \U and \P
                  variables.  When connecting using PAP or CHAP, these
                  values are used at authentication time.</p></dd><dt><span class="term">Line 15:</span></dt><dd><p>If you are using PAP or CHAP, there will be no login
		  at this point, and this line should be commented out or
		  removed.  See <a class="link" href="userppp.html#userppp-PAPnCHAP" title="23.2.1.2.12. PAP and CHAP Authentication">PAP and CHAP
		  authentication</a> for further details.</p><p>The login string is of the same chat-like syntax as
		  the dial string.  In this example, the string works for
		  a service whose login session looks like this:</p><pre class="screen">J. Random Provider
login: <em class="replaceable"><code>foo</code></em>
password: <em class="replaceable"><code>bar</code></em>
protocol: ppp</pre><p>You will need to alter this script to suit your
		  own needs.  When you write this script for the first
		  time, you should ensure that you have enabled
		  <span class="quote">"<span class="quote">chat</span>"</span> logging so you can determine if
		  the conversation is going as expected.</p></dd><dt><span class="term">Line 16:</span></dt><dd><p>Sets the default idle timeout<a id="idp91834448" class="indexterm"></a> (in seconds) for the
		  connection.  Here, the connection will be closed
		  automatically after 300 seconds of inactivity.  If you
		  never want to timeout, set this value to zero or use
                  the <code class="option">-ddial</code> command line switch.</p></dd><dt><span class="term">Line 17:</span></dt><dd><p>Sets the interface addresses.  The string
		  <em class="replaceable"><code>x.x.x.x</code></em> should be
		  replaced by the IP address that your provider has
		  allocated to you.  The string
		  <em class="replaceable"><code>y.y.y.y</code></em> should be
		  replaced by the IP address that your ISP<a id="idp91837648" class="indexterm"></a> indicated
		  for their gateway (the machine to which you
		  connect).  If your ISP has not given you a gateway
		  address, use <code class="systemitem">10.0.0.2/0</code>.  If you need to
		  use a <span class="quote">"<span class="quote">guessed</span>"</span> address, make sure that
		  you create an entry in
		  <code class="filename">/etc/ppp/ppp.linkup</code> as per the
		  instructions for <a class="link" href="userppp.html#userppp-dynamicIP" title="23.2.1.2.2. PPP and Dynamic IP Addresses">PPP and Dynamic IP
		  addresses</a>.  If this line is omitted,
		  <code class="command">ppp</code> cannot run in
		  <code class="option">-auto</code> mode.</p></dd><dt><span class="term">Line 18:</span></dt><dd><p>Adds a default route to your ISP's gateway.  The
		  special word <code class="literal">HISADDR</code> is replaced with
		  the gateway address specified on line 17.  It is
		  important that this line appears after line 17,
		  otherwise <code class="literal">HISADDR</code> will not yet be
		  initialized.</p><p>If you do not wish to run ppp in <code class="option">-auto</code>,
		  this line should be moved to the
                  <code class="filename">ppp.linkup</code> file.</p></dd></dl></div><p>It is not necessary to add an entry to
	    <code class="filename">ppp.linkup</code> when you have a static IP
	    address and are running ppp in <code class="option">-auto</code> mode as your
            routing table entries are already correct before you connect.
            You may however wish to create an entry to invoke programs after
            connection.  This is explained later with the sendmail
            example.</p><p>Example configuration files can be found in the
	    <code class="filename">/usr/share/examples/ppp/</code> directory.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-dynamicIP"></a>23.2.1.2.2. PPP and Dynamic IP Addresses</h5></div></div></div><a id="idp91851728" class="indexterm"></a><a id="idp91852496" class="indexterm"></a><p>If your service provider does not assign static IP
	    addresses, <code class="command">ppp</code> can be configured to
	    negotiate the local and remote addresses.  This is done by
	    <span class="quote">"<span class="quote">guessing</span>"</span> an IP address and allowing
	    <code class="command">ppp</code> to set it up correctly using the IP
	    Configuration Protocol (IPCP) after connecting.  The
	    <code class="filename">ppp.conf</code> configuration is the same as
	    <a class="link" href="userppp.html#userppp-staticIP" title="23.2.1.2.1. PPP and Static IP Addresses">PPP and Static IP
	    Addresses</a>, with the following change:</p><pre class="programlisting">17      set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.255</pre><p>Again, do not include the line number, it is just for
	    reference.  Indentation of at least one space is
	    required.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Line 17:</span></dt><dd><p>The number after the <code class="literal">/</code> character
		  is the number of bits of the address that ppp will
		  insist on.  You may wish to use IP numbers more
		  appropriate to your circumstances, but the above example
		  will always work.</p><p>The last argument (<code class="literal">0.0.0.0</code>) tells
		  PPP to start negotiations using address <code class="systemitem">0.0.0.0</code> rather than <code class="systemitem">10.0.0.1</code> and is necessary for some
                  ISPs.  Do not use <code class="literal">0.0.0.0</code> as the first
                  argument to <code class="command">set ifaddr</code> as it prevents
                  PPP from setting up an initial route in
                  <code class="option">-auto</code> mode.</p></dd></dl></div><p>If you are not running in <code class="option">-auto</code> mode, you
	    will need to create an entry in
            <code class="filename">/etc/ppp/ppp.linkup</code>.
	    <code class="filename">ppp.linkup</code> is used after a connection has
	    been established.  At this point, <code class="command">ppp</code> will
	    have assigned the interface addresses and it will now be
	    possible to add the routing table entries:</p><pre class="programlisting">1     provider:
2      add default HISADDR</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">Line 1:</span></dt><dd><p>On establishing a connection,
		  <code class="command">ppp</code> will look for an entry in
		  <code class="filename">ppp.linkup</code> according to the
		  following rules: First, try to match the same label
		  as we used in <code class="filename">ppp.conf</code>.  If
		  that fails, look for an entry for the IP address of
		  our gateway.  This entry is a four-octet IP style
		  label.  If we still have not found an entry, look
		  for the <code class="literal">MYADDR</code> entry.</p></dd><dt><span class="term">Line 2:</span></dt><dd><p>This line tells <code class="command">ppp</code> to add a
		  default route that points to
		  <code class="literal">HISADDR</code>.
		  <code class="literal">HISADDR</code> will be replaced with the
		  IP number of the gateway as negotiated by the
		  IPCP.</p></dd></dl></div><p>See the <code class="literal">pmdemand</code> entry in the files
	    <code class="filename">/usr/share/examples/ppp/ppp.conf.sample</code>
	    and
	    <code class="filename">/usr/share/examples/ppp/ppp.linkup.sample</code>
	    for a detailed example.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91896784"></a>23.2.1.2.3. Receiving Incoming Calls</h5></div></div></div><a id="idp91897424" class="indexterm"></a><p>When you configure <span class="application">ppp</span> to
	    receive incoming calls on a machine connected to a LAN, you
	    must decide if you wish to forward packets to the LAN.  If you
	    do, you should allocate the peer an IP number from your LAN's
	    subnet, and use the command <code class="command">enable proxy</code> in
	    your <code class="filename">/etc/ppp/ppp.conf</code> file.  You should
	    also confirm that the <code class="filename">/etc/rc.conf</code> file
	    contains the following:</p><pre class="programlisting">gateway_enable="YES"</pre></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91900624"></a>23.2.1.2.4. Which getty?</h5></div></div></div><p><a class="link" href="dialup.html" title="22.4. Dial-in Service">Configuring FreeBSD for Dial-up
	      Services</a> provides a good description on enabling
	      dial-up services using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getty&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">getty</span>(8)</span></a>.</p><p>An alternative to <code class="command">getty</code> is <a class="link" href="http://www.leo.org/~doering/mgetty/index.html" target="_top">mgetty</a>,
	      a smarter version of <code class="command">getty</code> designed
	      with dial-up lines in mind.</p><p>The advantages of using <code class="command">mgetty</code> is
	      that it actively <span class="emphasis"><em>talks</em></span> to modems,
	      meaning if port is turned off in
	      <code class="filename">/etc/ttys</code> then your modem will not answer
	      the phone.</p><p>Later versions of <code class="command">mgetty</code> (from
	      0.99beta onwards) also support the automatic detection of
	      PPP streams, allowing your clients script-less access to
	      your server.</p><p>Refer to <a class="link" href="userppp.html#userppp-mgetty" title="23.2.1.2.10. mgetty and AutoPPP">Mgetty and
	      AutoPPP</a> for more information on
	      <code class="command">mgetty</code>.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91908304"></a>23.2.1.2.5. <span class="application">PPP</span> Permissions</h5></div></div></div><p>The <code class="command">ppp</code> command must normally be
	      run as the <code class="systemitem">root</code> user.  If however,
	      you wish to allow <code class="command">ppp</code> to run in
	      server mode as a normal user by executing
	      <code class="command">ppp</code> as described below, that user
	      must be given permission to run <code class="command">ppp</code>
	      by adding them to the <code class="systemitem">network</code> group
	      in <code class="filename">/etc/group</code>.</p><p>You will also need to give them access to one or more
	      sections of the configuration file using the
	      <code class="command">allow</code> command:</p><pre class="programlisting">allow users fred mary</pre><p>If this command is used in the <code class="literal">default</code>
	      section, it gives the specified users access to
	      everything.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91923024"></a>23.2.1.2.6. PPP Shells for Dynamic-IP Users</h5></div></div></div><a id="idp91923664" class="indexterm"></a><p>Create a file called
	      <code class="filename">/etc/ppp/ppp-shell</code> containing the
	      following:</p><pre class="programlisting">#!/bin/sh
IDENT=`echo $0 | sed -e 's/^.*-\(.*\)$/\1/'`
CALLEDAS="$IDENT"
TTY=`tty`

if [ x$IDENT = xdialup ]; then
        IDENT=`basename $TTY`
fi

echo "PPP for $CALLEDAS on $TTY"
echo "Starting PPP for $IDENT"

exec /usr/sbin/ppp -direct $IDENT</pre><p>This script should be executable.  Now make a symbolic
	      link called <code class="filename">ppp-dialup</code> to this script
	      using the following commands:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ln -s ppp-shell /etc/ppp/ppp-dialup</code></strong></pre><p>You should use this script as the
	      <span class="emphasis"><em>shell</em></span> for all of your dialup users.
	      This is an example from <code class="filename">/etc/passwd</code>
	      for a dialup PPP user with username
	      <code class="systemitem">pchilds</code> (remember do not directly edit
	      the password file, use <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vipw&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">vipw</span>(8)</span></a>).</p><pre class="programlisting">pchilds:*:1011:300:Peter Childs PPP:/home/ppp:/etc/ppp/ppp-dialup</pre><p>Create a <code class="filename">/home/ppp</code> directory that
	      is world readable containing the following 0 byte
	      files:</p><pre class="screen">-r--r--r--   1 root     wheel           0 May 27 02:23 .hushlogin
-r--r--r--   1 root     wheel           0 May 27 02:22 .rhosts</pre><p>which prevents <code class="filename">/etc/motd</code> from being
	      displayed.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91940176"></a>23.2.1.2.7. PPP Shells for Static-IP Users</h5></div></div></div><a id="idp91940816" class="indexterm"></a><p>Create the <code class="filename">ppp-shell</code> file as above,
	      and for each account with statically assigned IPs create a
	      symbolic link to <code class="filename">ppp-shell</code>.</p><p>For example, if you have three dialup customers,
	      <code class="systemitem">fred</code>, <code class="systemitem">sam</code>, and
	      <code class="systemitem">mary</code>, that you route class C networks
	      for, you would type the following:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ln -s /etc/ppp/ppp-shell /etc/ppp/ppp-fred</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /etc/ppp/ppp-shell /etc/ppp/ppp-sam</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /etc/ppp/ppp-shell /etc/ppp/ppp-mary</code></strong></pre><p>Each of these users dialup accounts should have their
	      shell set to the symbolic link created above (for example,
	      <code class="systemitem">mary</code>'s shell should be
	      <code class="filename">/etc/ppp/ppp-mary</code>).</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91948496"></a>23.2.1.2.8. Setting Up <code class="filename">ppp.conf</code> for Dynamic-IP Users</h5></div></div></div><p>The <code class="filename">/etc/ppp/ppp.conf</code> file should
	      contain something along the lines of:</p><pre class="programlisting">default:
  set debug phase lcp chat
  set timeout 0

ttyd0:
  set ifaddr 203.14.100.1 203.14.100.20 255.255.255.255
  enable proxy

ttyd1:
  set ifaddr 203.14.100.1 203.14.100.21 255.255.255.255
  enable proxy</pre><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">The indenting is important.</p></div><p>The <code class="literal">default:</code> section is loaded for
	      each session.  For each dialup line enabled in
	      <code class="filename">/etc/ttys</code> create an entry similar to
	      the one for <code class="literal">ttyd0:</code> above.  Each line
	      should get a unique IP address from your pool of IP
	      addresses for dynamic users.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91953360"></a>23.2.1.2.9. Setting Up <code class="filename">ppp.conf</code> for Static-IP
	      Users</h5></div></div></div><p>Along with the contents of the sample
	      <code class="filename">/usr/share/examples/ppp/ppp.conf</code>
	      above you should add a section for each of the
	      statically assigned dialup users.  We will continue with
	      our <code class="systemitem">fred</code>, <code class="systemitem">sam</code>,
	      and <code class="systemitem">mary</code> example.</p><pre class="programlisting">fred:
  set ifaddr 203.14.100.1 203.14.101.1 255.255.255.255

sam:
  set ifaddr 203.14.100.1 203.14.102.1 255.255.255.255

mary:
  set ifaddr 203.14.100.1 203.14.103.1 255.255.255.255</pre><p>The file <code class="filename">/etc/ppp/ppp.linkup</code>
	      should also contain routing information for each static
	      IP user if required.  The line below would add a route
	      for the <code class="systemitem">203.14.101.0</code>
	      class C via the client's ppp link.</p><pre class="programlisting">fred:
  add 203.14.101.0 netmask 255.255.255.0 HISADDR

sam:
  add 203.14.102.0 netmask 255.255.255.0 HISADDR

mary:
  add 203.14.103.0 netmask 255.255.255.0 HISADDR</pre></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-mgetty"></a>23.2.1.2.10. <code class="command">mgetty</code> and AutoPPP</h5></div></div></div><a id="idp91976400" class="indexterm"></a><a id="idp91977296" class="indexterm"></a><a id="idp91977808" class="indexterm"></a><p>Configuring and compiling <code class="command">mgetty</code>
	      with the <code class="literal">AUTO_PPP</code> option enabled
	      allows <code class="command">mgetty</code> to detect the LCP phase
	      of PPP connections and automatically spawn off a ppp
	      shell.  However, since the default login/password
	      sequence does not occur it is necessary to authenticate
	      users using either PAP or CHAP.</p><p>This section assumes the user has successfully
	      configured, compiled, and installed a version of
	      <code class="command">mgetty</code> with the
	      <code class="literal">AUTO_PPP</code> option (v0.99beta or
	      later).</p><p>Make sure your
	      <code class="filename">/usr/local/etc/mgetty+sendfax/login.config</code>
	      file has the following in it:</p><pre class="programlisting">/AutoPPP/ -     -		      /etc/ppp/ppp-pap-dialup</pre><p>This will tell <code class="command">mgetty</code> to run the
	      <code class="filename">ppp-pap-dialup</code> script for detected
	      PPP connections.</p><p>Create a file called
	      <code class="filename">/etc/ppp/ppp-pap-dialup</code> containing the
	      following (the file should be executable):</p><pre class="programlisting">#!/bin/sh
exec /usr/sbin/ppp -direct pap$IDENT</pre><p>For each dialup line enabled in
	      <code class="filename">/etc/ttys</code>, create a corresponding entry
	      in <code class="filename">/etc/ppp/ppp.conf</code>.  This will
	      happily co-exist with the definitions we created
	      above.</p><pre class="programlisting">pap:
  enable pap
  set ifaddr 203.14.100.1 203.14.100.20-203.14.100.40
  enable proxy</pre><p>Each user logging in with this method will need to have
	      a username/password in
	      <code class="filename">/etc/ppp/ppp.secret</code> file, or
	      alternatively add the following option to authenticate users
	      via PAP from the <code class="filename">/etc/passwd</code> file.</p><pre class="programlisting">enable passwdauth</pre><p>If you wish to assign some users a static IP number,
	      you can specify the number as the third argument in
	      <code class="filename">/etc/ppp/ppp.secret</code>.  See
	      <code class="filename">/usr/share/examples/ppp/ppp.secret.sample</code>
	      for examples.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91993168"></a>23.2.1.2.11. MS Extensions</h5></div></div></div><a id="idp91993808" class="indexterm"></a><a id="idp91994320" class="indexterm"></a><a id="idp91994832" class="indexterm"></a><p>It is possible to configure PPP to supply DNS and
	      NetBIOS nameserver addresses on demand.</p><p>To enable these extensions with PPP version 1.x, the
	      following lines might be added to the relevant section of
	      <code class="filename">/etc/ppp/ppp.conf</code>.</p><pre class="programlisting">enable msext
set ns 203.14.100.1 203.14.100.2
set nbns 203.14.100.5</pre><p>And for PPP version 2 and above:</p><pre class="programlisting">accept dns
set dns 203.14.100.1 203.14.100.2
set nbns 203.14.100.5</pre><p>This will tell the clients the primary and secondary
	      name server addresses, and a NetBIOS nameserver host.</p><p>In version 2 and above, if the
	      <code class="literal">set dns</code> line is omitted, PPP will use the
	      values found in <code class="filename">/etc/resolv.conf</code>.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-PAPnCHAP"></a>23.2.1.2.12. PAP and CHAP Authentication</h5></div></div></div><a id="idp92000720" class="indexterm"></a><a id="idp92001232" class="indexterm"></a><p>Some ISPs set their system up so that the authentication
	    part of your connection is done using either of the PAP or
	    CHAP authentication mechanisms.  If this is the case, your ISP
	    will not give a <code class="prompt">login:</code> prompt when you
	    connect, but will start talking PPP immediately.</p><p>PAP is less secure than CHAP, but security is not normally
	    an issue here as passwords, although being sent as plain text
	    with PAP, are being transmitted down a serial line only.
	    There is not much room for crackers to
	    <span class="quote">"<span class="quote">eavesdrop</span>"</span>.</p><p>Referring back to the <a class="link" href="userppp.html#userppp-staticIP" title="23.2.1.2.1. PPP and Static IP Addresses">PPP
	    and Static IP addresses</a> or <a class="link" href="userppp.html#userppp-dynamicIP" title="23.2.1.2.2. PPP and Dynamic IP Addresses">PPP and Dynamic IP addresses</a>
	    sections, the following alterations must be made:</p><pre class="programlisting">13      set authname <em class="replaceable"><code>MyUserName</code></em>
14      set authkey <em class="replaceable"><code>MyPassword</code></em>
15      set login</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">Line 13:</span></dt><dd><p>This line specifies your PAP/CHAP user name.  You
		  will need to insert the correct value for
		  <em class="replaceable"><code>MyUserName</code></em>.</p></dd><dt><span class="term">Line 14:</span></dt><dd><p>This line specifies your PAP/CHAP password<a id="idp92013392" class="indexterm"></a>.  You
		  will need to insert the correct value for
		  <em class="replaceable"><code>MyPassword</code></em>.  You may want to
		  add an additional line, such as:</p><pre class="programlisting">16      accept PAP</pre><p>or</p><pre class="programlisting">16      accept CHAP</pre><p>to make it obvious that this is the intention, but
		  PAP and CHAP are both accepted by default.</p></dd><dt><span class="term">Line 15:</span></dt><dd><p>Your ISP will not normally require that you log into
		  the server if you are using PAP or CHAP.  You must
		  therefore disable your <span class="quote">"<span class="quote">set login</span>"</span>
		  string.</p></dd></dl></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92022608"></a>23.2.1.2.13. Changing Your <code class="command">ppp</code> Configuration on the
	    Fly</h5></div></div></div><p>It is possible to talk to the <code class="command">ppp</code>
	    program while it is running in the background, but only if a
	    suitable diagnostic port has been set up.  To do this, add the
	    following line to your configuration:</p><pre class="programlisting">set server /var/run/ppp-tun<em class="replaceable"><code>%d</code></em> DiagnosticPassword 0177</pre><p>This will tell PPP to listen to the specified
	    <span class="trademark">UNIX</span>(R) domain socket, asking clients for the specified
	    password before allowing access.  The
	    <code class="literal">%d</code> in the name is replaced with the
	    <code class="filename">tun</code> device number that is in
	    use.</p><p>Once a socket has been set up, the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pppctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pppctl</span>(8)</span></a>
	    program may be used in scripts that wish to manipulate the
	    running program.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-nat"></a>23.2.1.3. Using PPP Network Address Translation Capability</h4></div></div></div><a id="idp92029008" class="indexterm"></a><p>PPP has ability to use internal NAT without kernel diverting
         capabilities. This functionality may be enabled by the following
         line in <code class="filename">/etc/ppp/ppp.conf</code>:</p><pre class="programlisting">nat enable yes</pre><p>Alternatively, PPP NAT may be enabled by command-line
         option <code class="literal">-nat</code>. There is also
         <code class="filename">/etc/rc.conf</code> knob named
         <code class="literal">ppp_nat</code>, which is enabled by default.</p><p>If you use this feature, you may also find useful
         the following <code class="filename">/etc/ppp/ppp.conf</code> options
         to enable incoming connections forwarding:</p><pre class="programlisting">nat port tcp 10.0.0.2:ftp ftp
nat port tcp 10.0.0.2:http http</pre><p>or do not trust the outside at all</p><pre class="programlisting">nat deny_incoming yes</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="userppp-final"></a>23.2.1.4. Final System Configuration</h4></div></div></div><a id="idp92039504" class="indexterm"></a><p>You now have <code class="command">ppp</code> configured, but there
	  are a few more things to do before it is ready to work.  They
	  all involve editing the <code class="filename">/etc/rc.conf</code>
	  file.</p><p>Working from the top down in this file, make sure the
	  <code class="literal">hostname=</code> line is set, e.g.:</p><pre class="programlisting">hostname="foo.example.com"</pre><p>If your ISP has supplied you with a static IP address and
	  name, it is probably best that you use this name as your host
	  name.</p><p>Look for the <code class="literal">network_interfaces</code> variable.
	  If you want to configure your system to dial your ISP on demand,
	  make sure the <code class="filename">tun0</code> device is added to
	  the list, otherwise remove it.</p><pre class="programlisting">network_interfaces="lo0 tun0"
ifconfig_tun0=</pre><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <code class="literal">ifconfig_tun0</code> variable should be
	    empty, and a file called
	    <code class="filename">/etc/start_if.tun0</code> should be created.
	    This file should contain the line:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">ppp -auto mysystem</pre><p xmlns="http://www.w3.org/1999/xhtml">This script is executed at network configuration time,
	    starting your ppp daemon in automatic mode.  If you have a LAN
	    for which this machine is a gateway, you may also wish to use
	    the <code class="option">-alias</code> switch.  Refer to the manual page
	    for further details.</p></div><p>Make sure that the router program is set to <code class="literal">NO</code> with
	  the following line in your
	  <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">router_enable="NO"</pre><a id="idp92061264" class="indexterm"></a><p>It is important that the <code class="command">routed</code> daemon is
	  not started, as
	  <code class="command">routed</code> tends to delete the default routing
	  table entries created by <code class="command">ppp</code>.</p><p>It is probably worth your while ensuring that the
	  <code class="literal">sendmail_flags</code> line does not include the
	  <code class="option">-q</code> option, otherwise
	  <code class="command">sendmail</code> will attempt to do a network lookup
	  every now and then, possibly causing your machine to dial out.
	  You may try:</p><pre class="programlisting">sendmail_flags="-bd"</pre><a id="idp92065872" class="indexterm"></a><p>The downside of this is that you must force
	  <code class="command">sendmail</code> to re-examine the mail queue
	  whenever the ppp link is up by typing:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/sbin/sendmail -q</code></strong></pre><p>You may wish to use the <code class="command">!bg</code> command in
	  <code class="filename">ppp.linkup</code> to do this automatically:</p><pre class="programlisting">1     provider:
2       delete ALL
3       add 0 0 HISADDR
4       !bg sendmail -bd -q30m</pre><a id="idp92069968" class="indexterm"></a><p>If you do not like this, it is possible to set up a
	  <span class="quote">"<span class="quote">dfilter</span>"</span> to block SMTP traffic.  Refer to the
	  sample files for further details.</p><p>All that is left is to reboot the machine.  After rebooting,
	  you can now either type:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ppp</code></strong></pre><p>and then <code class="command">dial provider</code> to start the PPP
	  session, or, if you want <code class="command">ppp</code> to establish
	  sessions automatically when there is outbound traffic (and
	  you have not created the <code class="filename">start_if.tun0</code>
	  script), type:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ppp -auto provider</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92075216"></a>23.2.1.5. Summary</h4></div></div></div><p>To recap, the following steps are necessary when setting up
	  ppp for the first time:</p><p>Client side:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Ensure that the <code class="filename">tun</code> device is
	      built into your kernel.</p></li><li class="step"><p>Ensure that the
	      <code class="filename">tunN</code> device
	      file is available in the <code class="filename">/dev</code>
	      directory.</p></li><li class="step"><p>Create an entry in
	      <code class="filename">/etc/ppp/ppp.conf</code>.  The
	      <code class="filename">pmdemand</code> example should suffice for
	      most ISPs.</p></li><li class="step"><p>If you have a dynamic IP address, create an entry in
	      <code class="filename">/etc/ppp/ppp.linkup</code>.</p></li><li class="step"><p>Update your <code class="filename">/etc/rc.conf</code>
	      file.</p></li><li class="step"><p>Create a <code class="filename">start_if.tun0</code> script if
	      you require demand dialing.</p></li></ol></div><p>Server side:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Ensure that the <code class="filename">tun</code> device is
	      built into your kernel.</p></li><li class="step"><p>Ensure that the
	      <code class="filename">tunN</code> device
	      file is available in the <code class="filename">/dev</code>
	      directory.</p></li><li class="step"><p>Create an entry in <code class="filename">/etc/passwd</code>
	      (using the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vipw&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">vipw</span>(8)</span></a> program).</p></li><li class="step"><p>Create a profile in this users home directory that runs
	      <code class="command">ppp -direct direct-server</code> or
	      similar.</p></li><li class="step"><p>Create an entry in
	      <code class="filename">/etc/ppp/ppp.conf</code>.  The
	      <code class="filename">direct-server</code> example should
	      suffice.</p></li><li class="step"><p>Create an entry in
	      <code class="filename">/etc/ppp/ppp.linkup</code>.</p></li><li class="step"><p>Update your <code class="filename">/etc/rc.conf</code>
	      file.</p></li></ol></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ppp-and-slip.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="ppp-and-slip.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="ppp.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">Rozdzia³ 23. PPP and SLIP </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 23.3. Using Kernel PPP</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>