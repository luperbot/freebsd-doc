<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>22.6. Setting Up the Serial Console</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="serialcomms.html" title="Rozdzia³ 22. Serial Communications" /><link rel="prev" href="dialout.html" title="22.5. Dial-out Service" /><link rel="next" href="ppp-and-slip.html" title="Rozdzia³ 23. PPP and SLIP" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">22.6. Setting Up the Serial Console</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="dialout.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 22. Serial Communications</th><td width="20%" align="right"> <a accesskey="n" href="ppp-and-slip.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="serialconsole-setup"></a>22.6. Setting Up the Serial Console</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Kazutaka</span> <span class="surname">YOKOTA</span></span>. </span></div><div><span class="authorgroup">Based on a document by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Bill</span> <span class="surname">Paul</span></span>. </span></div></div></div><a id="idp91612624" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-intro"></a>22.6.1. Introduction</h3></div></div></div><p>FreeBSD has the ability to boot on a system with only
	a dumb terminal on a serial port as a console.  Such a configuration
	should be useful for two classes of people:  system administrators who
	wish to install FreeBSD on machines that have no keyboard or monitor
	attached, and developers who want to debug the kernel or device
	drivers.</p><p>As described in <a class="xref" href="boot.html" title="Rozdzia³ 12. The FreeBSD Booting Process">Rozdzia³ 12, <em>The FreeBSD Booting Process</em></a>, FreeBSD employs a three stage
	bootstrap.  The first two stages are in the boot block code which is
	stored at the beginning of the FreeBSD slice on the boot disk.  The
	boot block will then load and run the boot loader
	(<code class="filename">/boot/loader</code>) as the third stage code.</p><p>In order to set up the serial console you must configure the boot
	block code, the boot loader code and the kernel.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-howto-fast"></a>22.6.2. Serial Console Configuration, Terse Version</h3></div></div></div><p>This section assumes that you are using the default setup
	and just want a fast overview of setting up the serial
	console.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Connect the serial cable to COM1 and the controlling
	    terminal.</p></li><li class="step"><p>To see all boot messages on the serial console, issue
	    the following command while logged in as the superuser:</p><pre class="screen"><code class="prompt">#</code> echo 'console="comconsole"' &gt;&gt; /boot/loader.conf</pre></li><li class="step"><p>Edit <code class="filename">/etc/ttys</code> and change
	    <code class="literal">off</code> to <code class="literal">on</code> and
	    <code class="literal">dialup</code> to <code class="literal">vt100</code> for the
	    <code class="literal">ttyd0</code> entry.  Otherwise a password will not be
	    required to connect via the serial console, resulting in a
	    potential security hole.</p></li><li class="step"><p>Reboot the system to see if the changes took effect.</p></li></ol></div><p>If a different configuration is required, a more in depth
	configuration explanation exists in
	<a class="xref" href="serialconsole-setup.html#serialconsole-howto" title="22.6.3. Serial Console Configuration">Sekcja 22.6.3, "Serial Console Configuration"</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-howto"></a>22.6.3. Serial Console Configuration</h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Prepare a serial cable.</p><a id="idp91626576" class="indexterm"></a><p>You will need either a null-modem cable or a standard serial
	    cable and a null-modem adapter.  See <a class="xref" href="serial.html#serial-cables-ports" title="22.2.2. Cables and Ports">Sekcja 22.2.2, "Cables and Ports"</a> for
	    a discussion on serial cables.</p></li><li class="step"><p>Unplug your keyboard.</p><p>Most PC systems probe for the keyboard during the Power-On
	    Self-Test (POST) and will generate an error if the keyboard is not
	    detected.  Some machines complain loudly about the lack of a
	    keyboard and will not continue to boot until it is plugged
	    in.</p><p>If your computer complains about the error, but boots anyway,
	    then you do not have to do anything special.  (Some machines with
	    Phoenix BIOS installed merely say <span class="errorname">Keyboard
	      failed</span> and continue to boot normally.)</p><p>If your computer refuses to boot without a keyboard attached
	    then you will have to configure the BIOS so that it ignores this
	    error (if it can).  Consult your motherboard's manual for details
	    on how to do this.</p><div xmlns="" class="tip"><h3 class="admontitle">Podpowied¼: </h3><p xmlns="http://www.w3.org/1999/xhtml">Set the keyboard to <span class="quote">"<span class="quote">Not installed</span>"</span> in the
	      BIOS setup.  You will still
	      be able to use your keyboard.  All this does is tell the BIOS
	      not to probe for a keyboard at power-on.  Your BIOS should not
	      complain if the keyboard is absent.  You can leave the
	      keyboard plugged in even with this flag set to <span class="quote">"<span class="quote">Not
	      installed</span>"</span> and the keyboard will still work.</p></div><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">If your system has a <span class="trademark">PS/2</span>(R) mouse, chances are very good  that
	      you may have to unplug your mouse as well as your keyboard.
	      This is because <span class="trademark">PS/2</span>(R) mice share some hardware with the keyboard
	      and leaving the mouse plugged in can fool the keyboard probe
	      into thinking the keyboard is still there.  It is said that a
	      Gateway 2000 Pentium 90 MHz system with an AMI BIOS that behaves
	      this way.  In general, this is not a problem since the mouse is
	      not much good without the keyboard anyway.</p></div></li><li class="step"><p>Plug a dumb terminal into <code class="filename">COM1</code>
	    (<code class="filename">sio0</code>).</p><p>If you do not have a dumb terminal, you can use an old PC/XT
	    with a modem program, or the serial port on another <span class="trademark">UNIX</span>(R) box.  If
	    you do not have a <code class="filename">COM1</code>
	    (<code class="filename">sio0</code>), get one.  At this time, there is
	    no way to select a port other than <code class="filename">COM1</code>
	    for the boot blocks without recompiling the boot blocks.  If you
	    are already using <code class="filename">COM1</code> for another
	    device, you will have to temporarily remove that device and
	    install a new boot block and kernel once you get FreeBSD up and
	    running. (It is assumed that <code class="filename">COM1</code> will
	    be available on a file/compute/terminal server anyway; if you
	    really need <code class="filename">COM1</code> for something else
	    (and you cannot switch that something else to
	    <code class="filename">COM2</code> (<code class="filename">sio1</code>)),
	    then you probably should not even be bothering with all this in
	    the first place.)</p></li><li class="step"><p>Make sure the configuration file of your kernel has
	    appropriate flags set for <code class="filename">COM1</code>
	    (<code class="filename">sio0</code>).</p><p>Relevant flags are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">0x10</code></span></dt><dd><p>Enables console support for this unit.  The other
		  console flags are ignored unless this is set. Currently, at
		  most one unit can have console support;  the first one (in
		  config file order) with this flag set is preferred.  This
		  option alone will not make the serial port the console.  Set
		  the following flag or use the <code class="option">-h</code> option
		  described below, together with this flag.</p></dd><dt><span class="term"><code class="literal">0x20</code></span></dt><dd><p>Forces this unit to be the console (unless there is
		  another higher priority console), regardless of the
		  <code class="option">-h</code> option discussed below.
		  The flag <code class="literal">0x20</code> must be used
		  together with the <code class="option">0x10</code> flag.</p></dd><dt><span class="term"><code class="literal">0x40</code></span></dt><dd><p>Reserves this unit (in conjunction with
		  <code class="literal">0x10</code>) and makes the unit
		  unavailable for normal access.  You should not set
		  this flag to the serial port unit which you want to
		  use as the serial console.  The only use of this
		  flag is to designate the unit for kernel remote
		  debugging.  See <a class="link" href="../../../../doc/pl_PL.ISO8859-2/books/developers-handbook/index.html" target="_top">The
		  Developer's Handbook</a> for more information on
		  remote debugging.</p></dd></dl></div><p>Example:</p><pre class="programlisting">device sio0 at isa? port IO_COM1 flags 0x10 irq 4</pre><p>See the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sio&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">sio</span>(4)</span></a> manual page for more details.</p><p>If the flags were not set, you need to run UserConfig (on a
	    different console) or recompile the kernel.</p></li><li class="step"><p>Create <code class="filename">boot.config</code> in the root directory
	    of the <code class="literal">a</code> partition on the boot drive.</p><p>This file will instruct the boot block code how you would like
	    to boot the system.  In order to activate the serial console, you
	    need one or more of the following options-if you want
	    multiple options, include them all on the same line:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-h</code></span></dt><dd><p>Toggles internal and serial consoles.  You can use this
		  to switch console devices.  For instance, if you boot from
		  the internal (video) console, you can use
		  <code class="option">-h</code> to direct the boot loader and the kernel
		  to use the serial port as its console device. Alternatively,
		  if you boot from the serial port, you can use the
		  <code class="option">-h</code> to tell the boot loader and the kernel
		  to use the video display as the console instead.</p></dd><dt><span class="term"><code class="option">-D</code></span></dt><dd><p>Toggles single and dual console configurations.  In the
		  single configuration the console will be either the internal
		  console (video display) or the serial port, depending on the
		  state of the <code class="option">-h</code> option above.  In the dual
		  console configuration, both the video display  and the
		  serial port will become the console at the same time,
		  regardless of the state of the <code class="option">-h</code> option.
		  However, note that the dual console configuration takes  effect
		  only during the boot block is running.  Once the boot loader
		  gets control, the console specified by the
		  <code class="option">-h</code> option becomes the only console.</p></dd><dt><span class="term"><code class="option">-P</code></span></dt><dd><p>Makes the boot block probe the keyboard.  If no keyboard
		  is found, the <code class="option">-D</code> and <code class="option">-h</code>
		  options are automatically set.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">Due to space constraints in the current version of the
		    boot blocks, the <code class="option">-P</code> option is capable of
		    detecting extended keyboards only.  Keyboards with less
		    than 101 keys (and without F11 and F12  keys) may not be
		    detected.  Keyboards on some laptop computers may not be
		    properly found because of this limitation.  If this is
		    the case with your system, you have to abandon using
		    the <code class="option">-P</code> option.  Unfortunately there is no
		    workaround for this problem.</p></div></dd></dl></div><p>Use either the <code class="option">-P</code> option to select the
	    console automatically, or the <code class="option">-h</code> option to
	    activate the serial console.</p><p>You may include other options described in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=boot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">boot</span>(8)</span></a> as
	    well.</p><p>The options, except for <code class="option">-P</code>, will be passed to
	    the boot loader (<code class="filename">/boot/loader</code>).  The boot
	    loader will determine which of the internal video or the serial
	    port should become the console by examining the state of the
	    <code class="option">-h</code> option alone.  This means that if you specify
	    the <code class="option">-D</code> option but not the <code class="option">-h</code>
	    option in <code class="filename">/boot.config</code>, you can use the
	    serial port as the console only during the boot block;  the boot
	    loader will use the internal video display as the console.</p></li><li class="step"><p>Boot the machine.</p><p>When you start your FreeBSD box, the boot blocks will echo the
	    contents of <code class="filename">/boot.config</code> to the console.  For
	    example:</p><pre class="screen">/boot.config: -P
Keyboard: no</pre><p>The second line appears only if you put <code class="option">-P</code> in
	    <code class="filename">/boot.config</code> and indicates presence/absence
	    of the keyboard.  These messages go to either serial or internal
	    console, or both, depending on the option in
	    <code class="filename">/boot.config</code>.</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Options</th><th align="left">Message goes to</th></tr></thead><tbody><tr><td>none</td><td>internal console</td></tr><tr><td><code class="option">-h</code></td><td>serial console</td></tr><tr><td><code class="option">-D</code></td><td>serial and internal consoles</td></tr><tr><td><code class="option">-Dh</code></td><td>serial and internal consoles</td></tr><tr><td><code class="option">-P</code>, keyboard present</td><td>internal console</td></tr><tr><td><code class="option">-P</code>, keyboard absent</td><td>serial console</td></tr></tbody></table></div><p>After the above messages, there will be a small pause before
	    the boot blocks continue loading the boot loader and before any
	    further messages printed to the console.  Under normal
	    circumstances, you do not need to interrupt the boot blocks, but
	    you may want to do so in order to make sure things are set up
	    correctly.</p><p>Hit any key, other than <span class="keycode">Enter</span>, at the console to
	    interrupt the boot process.  The boot blocks will then prompt you
	    for further action.  You should now see something like:</p><pre class="screen">&gt;&gt; FreeBSD/i386 BOOT
Default: 0:ad(0,a)/boot/loader
boot:</pre><p>Verify the above message appears on either the serial or
	    internal console or both, according to the options you put in
	    <code class="filename">/boot.config</code>.  If the message appears in the
	    correct console, hit <span class="keycode">Enter</span> to continue the boot
	    process.</p><p>If you want the serial console but you do not see the prompt
	    on the serial terminal, something is wrong with your settings.  In
	    the meantime, you enter <code class="option">-h</code> and hit Enter/Return
	    (if possible) to tell the boot block (and then the boot loader and
	    the kernel) to choose the serial port for the console. Once the
	    system is up, go back and check what went wrong.</p></li></ol></div><p>After the boot loader is loaded and you are in the third stage of
	the boot process you can still switch between the internal console and
	the serial console by setting appropriate environment variables in the
	boot loader.  See <a class="xref" href="serialconsole-setup.html#serialconsole-loader" title="22.6.6. Changing Console from the Boot Loader">Sekcja 22.6.6, "Changing Console from the Boot Loader"</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-summary"></a>22.6.4. Summary</h3></div></div></div><p>Here is the summary of various settings discussed in this section
	and the console eventually selected.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91718096"></a>22.6.4.1. Case 1: You Set the Flags to 0x10 for
	  <code class="filename">sio0</code></h4></div></div></div><pre class="programlisting">device sio0 at isa? port IO_COM1 flags 0x10 irq 4</pre><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th align="left">Options in /boot.config</th><th align="left">Console during boot blocks</th><th align="left">Console during boot loader</th><th align="left">Console in kernel</th></tr></thead><tbody><tr><td>nothing</td><td>internal</td><td>internal</td><td>internal</td></tr><tr><td><code class="option">-h</code></td><td>serial</td><td>serial</td><td>serial</td></tr><tr><td><code class="option">-D</code></td><td>serial and internal</td><td>internal</td><td>internal</td></tr><tr><td><code class="option">-Dh</code></td><td>serial and internal</td><td>serial</td><td>serial</td></tr><tr><td><code class="option">-P</code>, keyboard present</td><td>internal</td><td>internal</td><td>internal</td></tr><tr><td><code class="option">-P</code>, keyboard absent</td><td>serial and internal</td><td>serial</td><td>serial</td></tr></tbody></table></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91736528"></a>22.6.4.2. Case 2: You Set the Flags to 0x30 for sio0</h4></div></div></div><pre class="programlisting">device sio0 at isa? port IO_COM1 flags 0x30 irq 4</pre><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th align="left">Options in /boot.config</th><th align="left">Console during boot blocks</th><th align="left">Console during boot loader</th><th align="left">Console in kernel</th></tr></thead><tbody><tr><td>nothing</td><td>internal</td><td>internal</td><td>serial</td></tr><tr><td><code class="option">-h</code></td><td>serial</td><td>serial</td><td>serial</td></tr><tr><td><code class="option">-D</code></td><td>serial and internal</td><td>internal</td><td>serial</td></tr><tr><td><code class="option">-Dh</code></td><td>serial and internal</td><td>serial</td><td>serial</td></tr><tr><td><code class="option">-P</code>, keyboard present</td><td>internal</td><td>internal</td><td>serial</td></tr><tr><td><code class="option">-P</code>, keyboard absent</td><td>serial and internal</td><td>serial</td><td>serial</td></tr></tbody></table></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-tips"></a>22.6.5. Tips for the Serial Console</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91768016"></a>22.6.5.1. Setting a Faster Serial Port Speed</h4></div></div></div><p>By default, the serial port settings are: 9600 baud, 8
	  bits, no parity, and 1 stop bit.  If you wish to change the speed, you
	  need to recompile at least the boot blocks.  Add the following line
	  to <code class="filename">/etc/make.conf</code> and compile new boot
	  blocks:</p><pre class="programlisting">BOOT_COMCONSOLE_SPEED=19200</pre><p>See <a class="xref" href="serialconsole-setup.html#serialconsole-com2" title="22.6.5.2. Using Serial Port Other Than sio0 for the Console">Sekcja 22.6.5.2, "Using Serial Port Other Than <code class="filename">sio0</code> for
	  the Console"</a> for detailed
	  instructions about building and installing new boot blocks.</p><p>If the serial console is configured in some other way than by
	  booting with <code class="option">-h</code>, or if the serial console used by
	  the kernel is different from the one used by the boot blocks, then
	  you must also add the following option to the kernel configuration
	  file and compile a new kernel:</p><pre class="programlisting">options CONSPEED=19200</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-com2"></a>22.6.5.2. Using Serial Port Other Than <code class="filename">sio0</code> for
	  the Console</h4></div></div></div><p>Using a port other than <code class="filename">sio0</code> as the
	  console requires some recompiling.  If you want to use another
	  serial port for whatever reasons, recompile the boot blocks, the
	  boot loader and the kernel as follows.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Get the kernel source. (See <a class="xref" href="cutting-edge.html" title="Rozdzia³ 21. The Cutting Edge">Rozdzia³ 21, <em>The Cutting Edge</em></a>)</p></li><li class="step"><p>Edit <code class="filename">/etc/make.conf</code> and set
	      <code class="literal">BOOT_COMCONSOLE_PORT</code> to the address of the
	      port you want to use (0x3F8, 0x2F8, 0x3E8 or 0x2E8).  Only
	      <code class="filename">sio0</code> through
	      <code class="filename">sio3</code> (<code class="filename">COM1</code>
	      through <code class="filename">COM4</code>) can be used;  multiport
	      serial cards will not work.  No interrupt setting is
	      needed.</p></li><li class="step"><p>Create a custom kernel configuration file and add
	      appropriate flags for the serial port you want to use. For
	      example, if you want to make <code class="filename">sio1</code>
	      (<code class="filename">COM2</code>) the console:</p><pre class="programlisting">device sio1 at isa? port IO_COM2 flags 0x10 irq 3</pre><p>or</p><pre class="programlisting">device sio1 at isa? port IO_COM2 flags 0x30 irq 3</pre><p>The console flags for the other serial ports should not be
	      set.</p></li><li class="step"><p>Recompile and install the boot blocks and the boot loader:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /sys/boot</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make clean</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong></pre></li><li class="step"><p>Rebuild and install the kernel.</p></li><li class="step"><p>Write the boot blocks to the boot disk with
		<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a> and boot from the new kernel.</p></li></ol></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-ddb"></a>22.6.5.3. Entering the DDB Debugger from the Serial Line</h4></div></div></div><p>If you wish to drop into the kernel debugger from the serial
	  console (useful for remote diagnostics, but also dangerous if you
	  generate a spurious BREAK on the serial port!) then you should
	  compile your kernel with the following options:</p><pre class="programlisting">options BREAK_TO_DEBUGGER
options DDB</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91789776"></a>22.6.5.4. Getting a Login Prompt on the Serial Console</h4></div></div></div><p>While this is not required, you may wish to get a
	  <span class="emphasis"><em>login</em></span> prompt over the serial line, now that you
	  can see boot messages and can enter the kernel debugging session
	  through the serial console.  Here is how to do it.</p><p>Open the file <code class="filename">/etc/ttys</code> with an editor
	  and locate the lines:</p><pre class="programlisting">ttyd0 "/usr/libexec/getty std.9600" unknown off secure
ttyd1 "/usr/libexec/getty std.9600" unknown off secure
ttyd2 "/usr/libexec/getty std.9600" unknown off secure
ttyd3 "/usr/libexec/getty std.9600" unknown off secure</pre><p><code class="literal">ttyd0</code> through <code class="literal">ttyd3</code>
	  corresponds to <code class="filename">COM1</code> through
	  <code class="filename">COM4</code>.  Change <code class="literal">off</code> to
	  <code class="literal">on</code> for the desired port.  If you have changed the
	  speed of the serial port, you need to change
	  <code class="literal">std.9600</code> to match the current setting, e.g.
	  <code class="literal">std.19200</code>.</p><p>You may also want to change the terminal type from
	  <code class="literal">unknown</code> to the actual type of your serial
	  terminal.</p><p>After editing the file, you must <code class="command">kill -HUP 1</code>
	  to make this change take effect.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-loader"></a>22.6.6. Changing Console from the Boot Loader</h3></div></div></div><p>Previous sections described how to set up the serial console by
	tweaking the boot block.  This section shows that you can specify the
	console by entering some commands and environment variables in the
	boot loader.  As the boot loader is invoked at the third stage of the
	boot process, after the boot block, the settings in the boot loader
	will override the settings in the boot block.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91806928"></a>22.6.6.1. Setting Up the Serial Console</h4></div></div></div><p>You can easily specify the boot loader and the kernel to use the
	  serial console by writing just one line in
	  <code class="filename">/boot/loader.rc</code>:</p><pre class="programlisting">set console="comconsole"</pre><p>This will take effect regardless of the settings in the boot
	  block discussed in the previous section.</p><p>You had better put the above line as the first line of
	  <code class="filename">/boot/loader.rc</code> so as to see boot messages  on
	  the serial console as early as possible.</p><p>Likewise, you can specify the internal console as:</p><pre class="programlisting">set console="vidconsole"</pre><p>If you do not set the boot loader environment variable
	  <code class="envar">console</code>, the boot loader, and subsequently the
	  kernel, will use whichever console indicated by the
	  <code class="option">-h</code> option in the  boot block.</p><p>In versions 3.2 or later, you may specify the console in
	  <code class="filename">/boot/loader.conf.local</code> or
	  <code class="filename">/boot/loader.conf</code>, rather than in
	  <code class="filename">/boot/loader.rc</code>.  In this method your
	  <code class="filename">/boot/loader.rc</code> should look like:</p><pre class="programlisting">include /boot/loader.4th
start</pre><p>Then, create <code class="filename">/boot/loader.conf.local</code>  and
	  put the following line there.</p><pre class="programlisting">console=comconsole</pre><p>or</p><pre class="programlisting">console=vidconsole</pre><p>See <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a> for more information.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">At the moment, the boot loader has no option equivalent to the
	    <code class="option">-P</code> option in the boot block, and there is no
	    provision to automatically select the internal console and the
	    serial console based on the presence of the keyboard.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91818832"></a>22.6.6.2. Using a Serial Port Other Than <code class="filename">sio0</code> for
	  the Console</h4></div></div></div><p>You need to recompile the boot loader to use a serial port other
	  than <code class="filename">sio0</code> for the serial console. Follow the
	  procedure described in <a class="xref" href="serialconsole-setup.html#serialconsole-com2" title="22.6.5.2. Using Serial Port Other Than sio0 for the Console">Sekcja 22.6.5.2, "Using Serial Port Other Than <code class="filename">sio0</code> for
	  the Console"</a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-caveats"></a>22.6.7. Caveats</h3></div></div></div><p>The idea here is to allow people to set up dedicated servers  that
	require no graphics hardware or attached keyboards.  Unfortunately,
	while most systems will let you boot without a keyboard, there
	are quite a few that will not let you boot without a graphics adapter.
	Machines with AMI BIOSes can be configured to  boot with no graphics
	adapter installed simply by changing the <span class="quote">"<span class="quote">graphics adapter</span>"</span> setting in
	the CMOS configuration to <span class="quote">"<span class="quote">Not installed.</span>"</span></p><p>However, many machines do not support this option and will refuse
	to boot if you have no display hardware in the system.  With these
	machines, you will have to leave some kind of graphics card plugged in,
	(even if it is just a junky mono board) although you will not have to
	attach a monitor. You might also try installing an AMI
	BIOS.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="dialout.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="serialcomms.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="ppp-and-slip.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">22.5. Dial-out Service </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> Rozdzia³ 23. PPP and SLIP</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>