<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>26.4. The OpenBSD Packet Filter (PF) and ALTQ</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="firewalls.html" title="Rozdzia³ 26. Firewalls" /><link rel="prev" href="firewalls-apps.html" title="26.3. Firewall Packages" /><link rel="next" href="firewalls-ipf.html" title="26.5. The IPFILTER (IPF) Firewall" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">26.4. The OpenBSD Packet Filter (PF) and
      <acronym class="acronym">ALTQ</acronym></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="firewalls-apps.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 26. Firewalls</th><td width="20%" align="right"> <a accesskey="n" href="firewalls-ipf.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-pf"></a>26.4. The OpenBSD Packet Filter (PF) and
      <acronym class="acronym">ALTQ</acronym></h2></div></div></div><a id="idp94949200" class="indexterm"></a><p>As of July 2003 the OpenBSD firewall software application
      known as <acronym class="acronym">PF</acronym> was ported to FreeBSD and was made
      available in the FreeBSD Ports Collection; the first release that
      contained <acronym class="acronym">PF</acronym> as an integrated part of the
      base system was FreeBSD 5.3 in November 2004.
      <acronym class="acronym">PF</acronym> is a complete, fully featured firewall
      that has optional support for <acronym class="acronym">ALTQ</acronym> (Alternate
      Queuing).  <acronym class="acronym">ALTQ</acronym> provides Quality of Service
      (<acronym class="acronym">QoS</acronym>) bandwidth shaping that allows
      guaranteeing bandwidth to different services based on filtering
      rules.  The OpenBSD Project does an outstanding job of
      maintaining the PF User's Guide that it will not be made part of
      this handbook firewall section as that would just be duplicated
      effort.</p><p>More info can be found at the PF for FreeBSD web site: <code class="uri"><a class="uri" href="http://pf4freebsd.love2party.net/" target="_top">http://pf4freebsd.love2party.net/</a></code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94962384"></a>26.4.1. Enabling PF</h3></div></div></div><p>PF is included in the basic FreeBSD install for versions newer
	than 5.3 as a separate run time loadable module.  The system
	will dynamically load the PF kernel loadable module when the
	rc.conf statement <code class="literal">pf_enable="YES"</code> is used.
	The loadable module was created with <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pflog&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pflog</span>(4)</span></a> logging
	enabled.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">The module assumes the presence of <code class="literal">options
	    INET</code> and <code class="literal">device bpf</code>.  Unless
	  <code class="literal">NOINET6</code> for FreeBSD prior to 6.0-RELEASE and
	  <code class="literal">NO_INET6</code> for later releases (for example in
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">make.conf</span>(5)</span></a>) was defined during the build, it also
	  requires<code class="literal">options INET6</code>.</p></div><p>Once the kernel module is loaded or the kernel is statically
	built with PF support, it is possible to enable or disable
	<span class="application">pf</span> with the <code class="command">pfctl</code>
	command.</p><p>This example demonstrates how to enable
	<span class="application">pf</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pfctl -e</code></strong></pre><p>The <code class="command">pfctl</code> command provides a way to work
	with the <span class="application">pf</span> firewall. It is a good
	idea to check the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pfctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pfctl</span>(8)</span></a> manual page to find out more
	information about using it.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94973136"></a>26.4.2. Kernel options</h3></div></div></div><a id="idp94973776" class="indexterm"></a><a id="idp94974928" class="indexterm"></a><a id="idp94976080" class="indexterm"></a><p>It is not a mandatory requirement that you enable PF by
	compiling the following options into the FreeBSD kernel.  It is
	only presented here as background information.  Compiling PF
	into the kernel causes the loadable module to never be
	used.</p><p>Sample kernel config PF option statements are in the
	<code class="filename">/usr/src/sys/conf/NOTES</code> kernel source and
	are reproduced here:</p><pre class="programlisting">device pf
device pflog
device pfsync</pre><p><code class="literal">device pf</code> enables support for the
	<span class="quote">"<span class="quote">Packet Filter</span>"</span> firewall.</p><p><code class="literal">device pflog</code> enables the optional
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pflog&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pflog</span>(4)</span></a> pseudo network device which can be used to log
	traffic to a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> descriptor.  The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pflogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pflogd</span>(8)</span></a> daemon
	can be used to store the logging information to disk.</p><p><code class="literal">device pfsync</code> enables the optional
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pfsync&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pfsync</span>(4)</span></a> pseudo network device that is used to monitor
	<span class="quote">"<span class="quote">state changes</span>"</span>.  As this is not part of the
	loadable module one has to build a custom kernel to use
	it.</p><p>These settings will take effect only after you have built
	and installed a kernel with them set.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94985168"></a>26.4.3. Available rc.conf Options</h3></div></div></div><p>You need the following statements in
	<code class="filename">/etc/rc.conf</code> to activate PF at boot
	time:</p><pre class="programlisting">pf_enable="YES"                 # Enable PF (load module if required)
pf_rules="/etc/pf.conf"         # rules definition file for pf
pf_flags=""                     # additional flags for pfctl startup
pflog_enable="YES"              # start pflogd(8)
pflog_logfile="/var/log/pflog"  # where pflogd should store the logfile
pflog_flags=""                  # additional flags for pflogd startup</pre><p>If you have a LAN behind this firewall and have to forward
	packets for the computers in the LAN or want to do NAT, you
	have to enable the following option as well:</p><pre class="programlisting">gateway_enable="YES"            # Enable as LAN gateway</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94992080"></a>26.4.4. Enabling <acronym class="acronym">ALTQ</acronym></h3></div></div></div><p><acronym class="acronym">ALTQ</acronym> is only available by compiling the
	options into the FreeBSD Kernel.  <acronym class="acronym">ALTQ</acronym> is not
	supported by all of the available network card drivers.	 Please
	see the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=altq&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">altq</span>(4)</span></a> manual page for a list of drivers that are
	supported in your release of FreeBSD.  The following options will
	enable <acronym class="acronym">ALTQ</acronym> and add additional
	functionality.</p><pre class="programlisting">options         ALTQ
options         ALTQ_CBQ        # Class Bases Queuing (CBQ)
options         ALTQ_RED        # Random Early Detection (RED)
options         ALTQ_RIO        # RED In/Out
options         ALTQ_HFSC       # Hierarchical Packet Scheduler (HFSC)
options         ALTQ_PRIQ       # Priority Queuing (PRIQ)
options         ALTQ_NOPCC      # Required for SMP build</pre><p><code class="literal">options ALTQ</code> enables the
	<acronym class="acronym">ALTQ</acronym> framework.</p><p><code class="literal">options ALTQ_CBQ</code> enables Class Based
	Queuing (<acronym class="acronym">CBQ</acronym>).  <acronym class="acronym">CBQ</acronym>
	allows you to divide a connection's bandwidth into different
	classes or queues to prioritize traffic based on filter
	rules.</p><p><code class="literal">options ALTQ_RED</code> enables Random Early
	Detection (<acronym class="acronym">RED</acronym>).  <acronym class="acronym">RED</acronym> is
	used to avoid network congestion.  <acronym class="acronym">RED</acronym> does
	this by measuring the length of the queue and comparing it to
	the minimum and maximum thresholds for the queue.  If the
	queue is over the maximum all new packets will be dropped.
	True to its name, <acronym class="acronym">RED</acronym> drops packets from
	different connections randomly.</p><p><code class="literal">options ALTQ_RIO</code> enables Random Early
	Detection In and Out.</p><p><code class="literal">options ALTQ_HFSC</code> enables the
	Hierarchical Fair Service Curve Packet Scheduler.  For more
	information about <acronym class="acronym">HFSC</acronym> see: <code class="uri"><a class="uri" href="http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html" target="_top">http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html</a></code>.</p><p><code class="literal">options ALTQ_PRIQ</code> enables Priority
	Queuing (<acronym class="acronym">PRIQ</acronym>).  <acronym class="acronym">PRIQ</acronym>
	will always pass traffic that is in a higher queue
	first.</p><p><code class="literal">options ALTQ_NOPCC</code> enables
	<acronym class="acronym">SMP</acronym> support for <acronym class="acronym">ALTQ</acronym>.
	This option is required on <acronym class="acronym">SMP</acronym>
	systems.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95006032"></a>26.4.5. Creating Filtering Rules</h3></div></div></div><p>The Packet Filter reads its configuration rules from the
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pf.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">pf.conf</span>(5)</span></a> file and it modifies, drops or passes packets
	according to the rules or definitions specified there.  The FreeBSD
	installation comes with a default
	<code class="filename">/etc/pf.conf</code> which contains useful examples
	and explanations.</p><p>Although FreeBSD has its own <code class="filename">/etc/pf.conf</code>
	the syntax is the same as one used in OpenBSD.  A great
	resource for configuring the <span class="application">pf</span>
	firewall has been written by OpenBSD team and is available at
	<code class="uri"><a class="uri" href="http://www.openbsd.org/faq/pf/" target="_top">http://www.openbsd.org/faq/pf/</a></code>.</p><div xmlns="" class="warning"><h3 class="admontitle">Ostrze¿enie: </h3><p xmlns="http://www.w3.org/1999/xhtml">When browsing the pf user's guide, please keep in mind that
     different versions of FreeBSD contain different versions of pf.  The
     <span class="application">pf</span> firewall in FreeBSD 5.X is at the level
     of OpenBSD version 3.5 and in FreeBSD 6.X is at the level of OpenBSD
     version 3.7.</p></div><p>The <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pf" target="_top">Lista dyskusyjna zapory Packet Filter we FreeBSD</a> is a good place to ask questions about
	configuring and running the <span class="application">pf</span>
	firewall.  Do not forget to check the mailing list archives
	before asking questions.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="firewalls-apps.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="firewalls.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="firewalls-ipf.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">26.3. Firewall Packages </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 26.5. The IPFILTER (IPF) Firewall</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>