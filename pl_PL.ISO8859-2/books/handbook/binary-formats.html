<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>3.12. Formaty binarne</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="basics.html" title="Rozdzia³ 3. Podstawy Uniksa" /><link rel="prev" href="basics-devices.html" title="3.11. Urz±dzenia i pliki urz±dzeñ" /><link rel="next" href="basics-more-information.html" title="3.13. Wiêcej informacji" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3.12. Formaty binarne</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="basics-devices.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 3. Podstawy Uniksa</th><td width="20%" align="right"> <a accesskey="n" href="basics-more-information.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="binary-formats"></a>3.12. Formaty binarne</h2></div><div><span class="authorgroup">T³umaczy³ <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Cezary</span> <span class="surname">Morga</span></span>. </span></div></div></div><p>By zrozumieæ czemu FreeBSD u¿ywa formatu <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=elf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">elf</span>(5)</span></a>, musimy wpierw
      poznaæ trzy obecnie <span class="quote">"<span class="quote">dominujace</span>"</span> formaty plików wykonywalnych
      w systemach <span class="trademark">UNIX</span>(R):</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=a.out&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">a.out</span>(5)</span></a></p><p>Najstarszy i najbardziej <span class="quote">"<span class="quote">klasyczny</span>"</span> format w Uniksie.
          Wykorzystuje krótki nag³ówek z magicznym numerem na samym pocz±tku,
          czêsto wykorzystywanym do okre¶lenia rodzaju pliku (szczegó³owy opis
          dostêpny jest w <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=a.out&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">a.out</span>(5)</span></a>). Na plik sk³adaj± siê trzy segmenty:
          .text, .data i .bss oraz tablice symboli i ci±gów tekstowych.</p></li><li class="listitem"><p><acronym class="acronym">COFF</acronym></p><p>Format obiektowy pochodz±cy z SVR3. W tym formacie sekcja tablic
          w wchodzi ju¿ w sk³ad nag³ówka, tak wiêc mo¿liwe jest zawarcie w pliku
          wiêcej sekcji ni¿ tylko .text, .data i .bss.</p></li><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=elf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">elf</span>(5)</span></a></p><p>Nastêpca <acronym class="acronym">COFF</acronym> zawieraj±cy wiele dodatkowych
          sekcji o 32- b±d¼ nawet 64-bitowych warto¶ciach. Jednym, acz wielkim
          minusem jest fakt, i¿ przy projektowaniu formatu <acronym class="acronym">ELF</acronym>
          równie¿ za³o¿ono, ¿e na ka¿d± architekturê sprzêtow± bêdzie istnia³
          tylko jeden interfejs ABI. Okaza³o siê natomiast, i¿ takie za³o¿enie
          jest b³êdne nawet w ¶wiecie komercyjnych SYSV (z którego pochodz±
          przynajmniej trzy ABI: SVR4, Solaris i SCO).</p><p>Sposobem na rozwi±zanie tego problemu we FreeBSD s± narzêdzia
          do <span class="emphasis"><em>metkowania</em></span> plików wykonywalnych
          <acronym class="acronym">ELF</acronym> informacjami, z którymi ABI jest on zgodny.
          Wiêcej informacji dostêpnych jest w podrêczniku systemowym
          <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>.</p></li></ul></div><p>System FreeBSD pochodzi z <span class="quote">"<span class="quote">klasycznego</span>"</span> obozu.
      Wykorzystywa³ on zatem format <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=a.out&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">a.out</span>(5)</span></a> - technologiê
      wypróbowan± w wielu pokoleniach systemów BSD i z powodzeniem
      stosowan± a¿ do ga³êzi 3.X. Mimo, ¿e skompilowanie i uruchomienie
      w sposób natywny plików binarnych <acronym class="acronym">ELF</acronym> (a tak¿e
      j±dra) by³o mo¿liwe we FreeBSD ju¿ od pewnego czasu, Projekt
      oficjalnie opiera³ siê przed migracj± do formatu <acronym class="acronym">ELF</acronym>
      jako podstawowego. Dlaczego? Otó¿, gdy obóz linuksowy wykona³ ten
      bolesny krok ku <acronym class="acronym">ELF</acronym> nie uda³o siê tak ³atwo uciec
      od formatu <code class="filename">a.out</code>. Wynika³o to przede wszystkim
      z faktu, i¿ niezbyt elastyczny plan migracji bazowa³ na mechanizmie
      wspó³dzielonych bibliotek, których modyfikacja nastrêcza³a wielu
      trudno¶ci zarówno producentom sprzêtu jak i projektantom. Dopiero od
      momentu gdy narzêdzia dostêpne dla <acronym class="acronym">ELF</acronym> zaoferowa³y
      sposób rozwi±zania problemu ze wspó³dzielonymi bibliotekami, zaczê³y
      byæ postrzegane ogólnie jako <span class="quote">"<span class="quote">droga do przodu</span>"</span>, a tym
      samym koszty migracji mog³y zostaæ uznane za niezbêdne do poniesienia.
      Mechanizm wspó³dzielonych bibliotek FreeBSD w du¿ej mierze przypomina
      mechanizm z <span class="trademark">SunOS</span>TM Sun'a i jako taki jest bardzo ³atwy w u¿yciu.</p><p>Sk±d wiêc tyle ró¿nych formatów?</p><p>W zamierzch³ych czasach do dyspozycji by³ prosty sprzêt komputerowy.
      Ów prosty sprzêt obs³ugiwa³ ma³y, prosty system. St±d te¿ format
      <code class="filename">a.out</code>by³ ca³kowicie odpowiednim do prezentacji
      plików binarnych w tym prostym systemie (PDP-11). Gdy <span class="trademark">UNIX</span>(R) zosta³
      przeniesiony z tego prostego systemu na platformy typu Motorola 68k czy
      VAXen, zachowany zosta³ format <code class="filename">a.out</code>, zdecydowanie
      wystarcz±jacy dla wczesnych wersji Uniksa.</p><p>Pewien czas pó¼niej, jaki¶ bystry in¿ynier sprzêtowy stwierdzi³
      ¿e gdyby potrafi³ zmusiæ oprogramowanie do robienia kilku obskurnych
      sztuczek, wówczas móg³by pozbyæ siê kilku bramek z uk³adu scalonego
      i zmusiæ CPU do szybszej pracy. Pomimo, ¿e format <code class="filename">a.out</code>
      potrafi³ wspó³pracowaæ z tym nowym rodzajem sprzêtu (zwanego wówczas
      <acronym class="acronym">RISC</acronym>) to mimo wszystko nie by³ najlepszym do tego
      formatem. Dlatego te¿ rozpoczêto prace nad innymi formatami binarnymi,
      które mia³y osi±gn±æ lepsze wyniki ni¿ ograniczony, prosty <code class="filename">a.out</code>
      móg³ zaoferowaæ. Stworzone zosta³y <acronym class="acronym">COFF</acronym>,
      <acronym class="acronym">ECOFF</acronym> oraz kilka mniej znanych formatów, nim powsta³
      <acronym class="acronym">ELF</acronym>.</p><p>Kolejnym problemem okaza³ siê wzrost rozmiarów programów przy
      wzglêdnie ma³ej pojemno¶ci dysków oraz pamiêci fizycznych, a tak¿e
      zwiêkszeniu stopnia skomplikowania pamiêci wirtualnej VM. Tak te¿
      narodzi³a siê koncepcja wspó³dzielonych bibliotek. Mimo, ¿e ów postêp
      osi±gniêty by³ przy pomocy formatu <code class="filename">a.out</code> zakres
      jego przydatno¶ci by³ stale rozci±gany, wraz z ka¿d± now± funkcj±.
      Pojawi³a siê konieczno¶æ dynamicznego wczytywanie pewnych rzeczy ju¿
      w trakcie uruchamiania programu czy zapisywania czê¶ci programu zaraz
      po wykonaniu kodu init w pamiêci lub przestrzeni wymiany. Równie¿ jêzyki
      programowania stawa³y siê coraz bardziej wyrafinowane. Wiele poprawek
      wprowadzonych do formatu <code class="filename">a.out</code> umo¿liwia³y realizacjê
      kolejnych funkcji, przy czym z regu³y dzia³a³y one tylko przez pewien czas.
      Niestety, format a.out sta³ siê z czasem niezdolny do rozwi±zywania wszystkich
      problemów bez wci±¿ rozrastaj±cego siê narzutu w kodzie i poziomu skomplikowania.
      Mimo, ¿e <acronym class="acronym">ELF</acronym> potrafi³ rozwi±zaæ wiele z ówczesnych problemów,
      zmiana formatu binarnego, który generalnie dzia³a³, wci±¿ by³a wielk± uci±¿liwo¶ci±.
      Dlatego te¿ <acronym class="acronym">ELF</acronym> musia³ poczekaæ a¿ bardziej bolesnym okaza³o
      siê pozostanie przy <code class="filename">a.out</code> ni¿ przej¶cie
      do <acronym class="acronym">ELF</acronym>.</p><p>Wraz z up³ywem czasu, narzêdzia kompilacyjne, z których FreeBSD wywodzi
      w³asne narzêdzia (przede wszystkim assembler i loader), wyewoluowa³y w dwa
      równoleg³e projekty. Odmiana FreeBSD da³a wspó³dzielone biblioteki oraz poprawki
      kilku b³êdów. Ludzie z GNU, którzy oryginalnie napisali te programy,
      przepisali je na nowo i dodali proste kompilatory wskro¶ne, pozwalaj±ce na
      pracê w ró¿nych formatach. Nowy pakiet narzêdzi GNU
      (<span class="application">binutils</span>) wspiera kompilowanie wskro¶ne,
      format <acronym class="acronym">ELF</acronym>, wspó³dzielone biblioteki, rozszerzenia
      C++, itp. Dodatkowo, wielu producentów sprzêtu przygotowuje binaria
      <acronym class="acronym">ELF</acronym>. Jest to zatem dobra rzecz dla FreeBSD, ¿e
      je obs³uguje.</p><p>Format <acronym class="acronym">ELF</acronym> oferuje wiêksz± rozszerzalno¶æ niz
      <code class="filename">a.out</code>. Narzêdzia <acronym class="acronym">ELF</acronym> s± lepiej
      przygotowywane i oferuj± kompilacjê wskro¶n±, co jest istotne dla wielu
      programistów. Co prawda <acronym class="acronym">ELF</acronym> mo¿e byæ trochê wolniejszy
      ni¿ <code class="filename">a.out</code>, jednak¿e próba pomiaru mo¿e byæ trudna.
      Istnieje równie¿ wiele innych szczegó³ów ró¿nych dla obydwu formatów,
      m.in. sposób mapowania stron, obs³ugi kodu init itp. Co prawda,
      ¿adne z nich nie jest istotne, jednak¿e ró¿nice istniej±. Z czasem,
      wsparcie dla <code class="filename">a.out</code> zostanie wstrzymane z jadra
      <code class="filename">GENERIC</code> i ostatecznie usuniête z j±dra gdy tylko
      zniknie potrzeba obs³ugi programów <code class="filename">a.out</code>.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="basics-devices.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="basics.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="basics-more-information.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">3.11. Urz±dzenia i pliki urz±dzeñ </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 3.13. Wiêcej informacji</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>