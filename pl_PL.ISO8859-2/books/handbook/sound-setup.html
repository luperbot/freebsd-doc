<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>7.2. Setting Up the Sound Card</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="multimedia.html" title="Rozdzia³ 7. Multimedia" /><link rel="prev" href="multimedia.html" title="Rozdzia³ 7. Multimedia" /><link rel="next" href="sound-mp3.html" title="7.3. MP3 Audio" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">7.2. Setting Up the Sound Card</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="multimedia.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 7. Multimedia</th><td width="20%" align="right"> <a accesskey="n" href="sound-mp3.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="sound-setup"></a>7.2. Setting Up the Sound Card</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Moses</span> <span class="surname">Moore</span></span>. </span></div><div><span class="authorgroup">Enhanced for FreeBSD 5.X by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-device"></a>7.2.1. Configuring the System</h3></div></div></div><a id="idp80163792" class="indexterm"></a><a id="idp80164304" class="indexterm"></a><a id="idp80164816" class="indexterm"></a><p>Before you begin, you should know the model of the card you
      have, the chip it uses, and whether it is a PCI or ISA card.
      FreeBSD supports a wide variety of both PCI and ISA cards.
      Check the supported audio devices list of the <a class="link" href="http://www.FreeBSD.org/releases/10.1R/hardware.html" target="_top">Hardware Notes</a> to see if
      your card is supported.  This document will also mention which
      driver supports your card.</p><a id="idp80166352" class="indexterm"></a><p>To use your sound device, you will need to load the proper
      device driver.  This may be accomplished in one of two ways.
      The easiest way is to simply load a kernel module for your sound
      card with <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a> which can either be done from the
      command line:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_emu10k1</code></strong></pre><p>or by adding the appropriate line to the file
      <code class="filename">/boot/loader.conf</code> like this:</p><pre class="programlisting">snd_emu10k1_load="YES"</pre><p>These examples are for a Creative <span class="trademark">SoundBlaster</span>(R) Live! sound
      card.  Other available loadable sound modules are listed in
      <code class="filename">/boot/defaults/loader.conf</code>.
      If you are not sure which driver to use, you may try to load
      the <code class="filename">snd_driver</code> module:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_driver</code></strong></pre><p>This is a metadriver loading the most common device drivers
      at once.  This speeds up the search for the correct driver.  It
      is also possible to load all sound drivers via the
      <code class="filename">/boot/loader.conf</code> facility.</p><p>If you wish to find out the driver selected for your
      soundcard after loading the <code class="filename">snd_driver</code>
      metadriver, you may check the <code class="filename">/dev/sndstat</code>
      file with the <code class="command">cat /dev/sndstat</code>
      command.</p><p>A second method is to statically
      compile in support for your sound card in your kernel.  The
      section below provides the information you need to add support
      for your hardware in this manner.  For more information about
      recompiling your kernel, please see <a class="xref" href="kernelconfig.html" title="Rozdzia³ 8. Konfiguracja j±dra FreeBSD">Rozdzia³ 8, <em>Konfiguracja j±dra FreeBSD</em></a>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80184784"></a>7.2.1.1. Configuring a Custom Kernel with Sound Support</h4></div></div></div><p>The first thing to do is adding the generic audio driver
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sound&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">sound</span>(4)</span></a> to the kernel, for that you will need to
	add the following line to the kernel configuration file:</p><pre class="programlisting">device sound</pre><p>Then we have to add the support for our sound card.
	Therefore, we need to know which driver supports the card.
	Check the supported audio devices list of the <a class="link" href="http://www.FreeBSD.org/releases/10.1R/hardware.html" target="_top">Hardware Notes</a>, to
	determine the correct driver for your sound card.  For
	example, a Creative <span class="trademark">SoundBlaster</span>(R) Live! sound card is
	supported by the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_emu10k1&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_emu10k1</span>(4)</span></a> driver.  To add the support
	for this card, use the following:</p><pre class="programlisting">device snd_emu10k1</pre><p>Be sure to read the manual page of the driver for the
	syntax to use.  Information regarding the syntax of sound
	drivers in the kernel configuration can also be found in the
	<code class="filename">/usr/src/sys/conf/NOTES</code> file.</p><p>Non-PnP ISA cards may require you to provide the kernel
	with information on the sound card settings (IRQ, I/O port,
	etc).  This is done via the
	<code class="filename">/boot/device.hints</code> file.  At system boot,
	the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> will read this file and pass the settings
	to the kernel.  For example, an old
	Creative <span class="trademark">SoundBlaster</span>(R) 16 ISA non-PnP card will use the
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a> driver in conjunction with snd_sb16(4).  For this card the following lines have to be added to
	the kernel configuration file:</p><pre class="programlisting">device snd_sbc
device snd_sb16</pre><p>as well as the following in
	<code class="filename">/boot/device.hints</code>:</p><pre class="programlisting">hint.sbc.0.at="isa"
hint.sbc.0.port="0x220"
hint.sbc.0.irq="5"
hint.sbc.0.drq="1"
hint.sbc.0.flags="0x15"</pre><p>In this case, the card uses the <code class="literal">0x220</code>
	I/O port and the IRQ <code class="literal">5</code>.</p><p>The syntax used in the
	<code class="filename">/boot/device.hints</code> file is covered in the
	sound driver manual page.  On FreeBSD 4.X, these settings
	are directly written in the kernel configuration file.</p><p>The settings shown above are the defaults.  In some
	cases, you may need to change the IRQ or the other settings to
	match your card.  See the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a> manual page for more
	information.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-testing"></a>7.2.2. Testing the Sound Card</h3></div></div></div><p>After rebooting with the modified kernel, or after loading
      the required module, the sound card should appear in your system
      message buffer (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a>) as something like:</p><pre class="screen">pcm0: &lt;Intel ICH3 (82801CA)&gt; port 0xdc80-0xdcbf,0xd800-0xd8ff irq 5 at device 31.5 on pci0
pcm0: [GIANT-LOCKED]
pcm0: &lt;Cirrus Logic CS4205 AC97 Codec&gt;</pre><p>The status of the sound card may be checked via the
      <code class="filename">/dev/sndstat</code> file:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat /dev/sndstat</code></strong>
FreeBSD Audio Driver (newpcm)
Installed devices:
pcm0: &lt;Intel ICH3 (82801CA)&gt; at io 0xd800, 0xdc80 irq 5 bufsz 16384
kld snd_ich (1p/2r/0v channels duplex default)</pre><p>The output from your system may vary.  If no
      <code class="filename">pcm</code> devices show up, go back and review
      what was done earlier.  Go through your kernel
      configuration file again and make sure the correct
      device is chosen.  Common problems are listed in <a class="xref" href="sound-setup.html#troubleshooting" title="7.2.2.1. Common Problems">Sekcja 7.2.2.1, "Common Problems"</a>.</p><p>If all goes well, you should now have a functioning sound
      card.  If your CD-ROM or DVD-ROM drive is properly coupled to
      your sound card, you can put a CD in the drive and play it
      with <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cdcontrol&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cdcontrol</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cdcontrol -f /dev/acd0 play 1</code></strong></pre><p>Various applications, such as <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/audio/workman/pkg-descr">audio/workman</a> can provide a friendlier
      interface.  You may want to install an application such as
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/audio/mpg123/pkg-descr">audio/mpg123</a> to listen to
      MP3 audio files.  A quick way to test the card is sending data
      to the <code class="filename">/dev/dsp</code>, like this:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cat filename &gt; /dev/dsp</code></strong></pre><p>where <em class="replaceable"><code>filename</code></em> can be any file.
      This command line should produce some noise, confirming the
      sound card is actually working.</p><p>Sound card mixer levels can be changed via the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mixer&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mixer</span>(8)</span></a>
      command.  More details can be found in the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mixer&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mixer</span>(8)</span></a> manual
      page.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="troubleshooting"></a>7.2.2.1. Common Problems</h4></div></div></div><a id="idp80219984" class="indexterm"></a><a id="idp80220496" class="indexterm"></a><a id="idp80221008" class="indexterm"></a><a id="idp80221520" class="indexterm"></a><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Error</th><th>Solution</th></tr></thead><tbody><tr><td><span class="errorname">unsupported subdevice XX</span></td><td><p>One or more of the device nodes was not created
	        correctly.  Repeat the steps above.</p></td></tr><tr><td><span class="errorname">sb_dspwr(XX) timed out</span></td><td><p>The I/O port is not set correctly.</p></td></tr><tr><td><span class="errorname">bad irq XX</span></td><td><p>The IRQ is set incorrectly.  Make sure that
  	        the set IRQ and the sound IRQ are the same.</p></td></tr><tr><td><span class="errorname">xxx: gus pcm not attached, out of memory</span></td><td><p>There is not enough available memory to use
                the device.</p></td></tr><tr><td><span class="errorname">xxx: can't open /dev/dsp!</span></td><td><p>Check with <code class="command">fstat | grep dsp</code>
                if another application is holding the device open.
                Noteworthy troublemakers are <span class="application">esound</span> and <span class="application">KDE</span>'s sound
                support.</p></td></tr></tbody></table></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-multiple-sources"></a>7.2.3. Utilizing Multiple Sound Sources</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Munish</span> <span class="surname">Chopra</span></span>. </span></div></div></div><p>It is often desirable to have multiple sources of sound that
      are able to play simultaneously, such as when
      <span class="application">esound</span> or
      <span class="application">artsd</span> do not support sharing of the
      sound device with a certain application.</p><p>FreeBSD lets you do this through <span class="emphasis"><em>Virtual Sound
      Channels</em></span>, which can be set with the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
      facility.  Virtual channels allow you to multiplex your sound
      card's playback channels by mixing sound in the kernel.</p><p>To set the number of virtual channels, there are two sysctl
      knobs which, if you are the <code class="systemitem">root</code> user, can
      be set like this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.pcm0.vchans=4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.maxautovchans=4</code></strong></pre><p>The above example allocates four virtual channels, which is a
      practical number for everyday use.  <code class="varname">hw.snd.pcm0.vchans</code>
      is the number of virtual channels <code class="filename">pcm0</code> has, and is configurable
      once a device has been attached.
      <code class="literal">hw.snd.maxautovchans</code> is the number of virtual channels
      a new audio device is given when it is attached using
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>.  Since the <code class="filename">pcm</code> module
      can be loaded independently of the hardware drivers,
      <code class="varname">hw.snd.maxautovchans</code> can store how many
      virtual channels any devices which are attached later will be
      given.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">You cannot change the number of virtual channels for a
	device while it is in use.  First close any programs using the
	device, such as music players or sound daemons.</p></div><p>If you are not using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a>, you will have to point
      your applications at
      <code class="filename">/dev/dsp0</code>.<em class="replaceable"><code>x</code></em>,
      where <em class="replaceable"><code>x</code></em> is 0 to 3 if
      <code class="varname">hw.snd.pcm.0.vchans</code> is set to 4 as in the
      above example.  On a system using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a>, the above will
      automatically be allocated transparently to the user.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80262096"></a>7.2.4. Setting Default Values for Mixer Channels</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Josef</span> <span class="surname">El-Rayes</span></span>. </span></div></div></div><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">This is only supported in FreeBSD 5.3-RELEASE and later.</p></div><p>The default values for the different mixer channels are
      hardcoded in the sourcecode of the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> driver.  There are
      a lot of different applications and daemons that allow
      you to set values for the mixer they remember and set
      each time they are started, but this is not a clean
      solution, we want to have default values at the driver
      level.  This is accomplished by defining the appropriate
      values in <code class="filename">/boot/device.hints</code>. E.g.:</p><pre class="programlisting">hint.pcm.0.vol="100"</pre><p>This will set the volume channel to a default value of
      100, when the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> module is loaded.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="multimedia.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="multimedia.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="sound-mp3.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">Rozdzia³ 7. Multimedia </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 7.3. MP3 Audio</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>