<?xml version="1.0" encoding="iso-8859-2"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>Mosty filtruj±ce</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="description" content="Czêstokroæ zdarza siê, ¿e trzeba podzieliæ jedn± sieæ fizyczn± (np. Ethernet) na dwa oddzielne segmenty, nie tworz±c przy tym podsieci, a oba segmenty po³±czyæ ze sob± ruterem. Urz±dzenie ³±cz±ce w ten sposób dwie sieci nazywane jest mostem. Komputer z FreeBSD posiadaj±cy dwa interfejsy sieciowe mo¿e z powodzeniem pracowaæ jako most. Zadaniem mostu jest analizowanie adresów MAC (adresów ethernetowych) nale¿±cych do urz±dzeñ przy³±czonych do obu interefejsów sieciowych, a nastêpnie przekazywaniu danych pomiêdzy obiema sieciami tylko wtedy, gdy nadawca i odbiorca nale¿± do innych segmentów. Pod wieloma wzglêdami most przypomina prze³±cznik ethernetowy wyposa¿ony w jedynie dwa porty." /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div xml:lang="pl" class="article" lang="pl"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69014352"></a>Mosty filtruj±ce</h1></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Alex</span> <span class="surname">Dupre</span></h3><div class="affiliation"><div class="address"><p><code class="email">&lt;<a xmlns="" class="email" href="mailto:sysadmin@alexdupre.com">sysadmin@alexdupre.com</a>&gt;</code></p></div></div></div></div></div><div>Zmiana: <a href="https://svnweb.freebsd.org/changeset/doc/"><span class="svnref"></span></a></div><div>   autorstwa .</div><div><div xmlns="http://www.w3.org/1999/xhtml" class="abstract"><div class="abstract-title">Abstrakt</div><p>Czêstokroæ zdarza siê, ¿e trzeba podzieliæ jedn± sieæ fizyczn±
        (np. Ethernet) na dwa oddzielne segmenty, nie tworz±c przy tym
	podsieci, a oba segmenty po³±czyæ ze sob± ruterem. Urz±dzenie
	³±cz±ce w ten sposób dwie sieci nazywane jest mostem. Komputer z
	FreeBSD posiadaj±cy dwa interfejsy sieciowe mo¿e z powodzeniem
	pracowaæ jako most.</p><p>Zadaniem mostu jest analizowanie adresów <acronym class="acronym">MAC</acronym>
        (adresów ethernetowych) nale¿±cych do urz±dzeñ przy³±czonych do obu
	interefejsów sieciowych, a nastêpnie przekazywaniu danych pomiêdzy
	obiema sieciami tylko wtedy, gdy nadawca i odbiorca nale¿± do
	innych segmentów. Pod wieloma wzglêdami most przypomina prze³±cznik
	ethernetowy wyposa¿ony w jedynie dwa porty.</p></div></div></div><hr /></div><div class="toc"><div class="toc-title">Spis tre¶ci</div><dl class="toc"><dt><span class="sect1"><a href="#filtering-bridges-why">1. Dlaczego korzysta siê z mostów filtruj±cych?</a></span></dt><dt><span class="sect1"><a href="#filtering-bridges-how">2. Instalacja</a></span></dt><dt><span class="sect1"><a href="#filtering-bridges-finalprep">3. Przygotowanie do pracy</a></span></dt><dt><span class="sect1"><a href="#filtering-bridges-enabling">4. Uruchamianie mostu</a></span></dt><dt><span class="sect1"><a href="#filtering-bridges-ipfirewall">5. Konfiguracja firewalla</a></span></dt><dt><span class="sect1"><a href="#filtering-bridges-contributors">6. Podziêkowania</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filtering-bridges-why"></a>1. Dlaczego korzysta siê z mostów filtruj±cych?</h2></div></div></div><p>Dziêki obni¿aj±cym siê kosztom szerokopasmowych po³±czeñ
      internetowych (xDSL), jak równie¿ z powodu niewielkiej liczby dostêpnych
      adresów IPv4, coraz czê¶ciej zdarza siê, ¿e firmy dysponuj± sta³ym
      po³±czeniem z Internetem, nie posiadaj±c przy tym zbyt wielu adresów IP.
      W takiej sytuacji przydatne jest stosowanie firewalla filtruj±cego
      pakiety wysy³ane do Internetu i z niego nadchodz±ce. Mo¿e siê jednak
      zdarzyæ, ¿e filtrowania pakietów na poziomie rutera nie da siê
      zrealizowaæ, na przyk³ad ze wzglêdu na podzia³ sieci,
      lub dlatego, ¿e to dostawca us³ug interentowych jest w³a¶cicielem
      rutera, b±d¼ te¿ sam ruter nie umo¿liwia takiego rozwi±zania. Wtedy
      w³a¶nie wskazane jest skorzystanie z mostu filtruj±cego.</p><p>Firewall bêd±cy jednocze¶nie mostem mo¿e byæ wstawiony pomiêdzy
      ruter xDSL a koncentrator/prze³±cznik ethernetowy. Jego konfiguracja
      nie wymaga zajmowania siê numeracj± IP.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filtering-bridges-how"></a>2. Instalacja</h2></div></div></div><p>W FreeBSD w³±czenie funkcji mostu nie jest trudnym przedsiêwziêciem.
      Pocz±wszy od wydania 4.5 owe funkcje mog± byæ do³±czone jako modu³y, nie
      trzeba wiêc przebudowywaæ j±dra, co jest znacznym udogodnieniem.
      Poni¿ej opisujê obydwa sposoby.</p><div xmlns="" class="important"><h3 class="admontitle">Wa¿ne: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="emphasis"><em>Nie nale¿y</em></span> postêpowaæ wed³ug obu poni¿szych
        przepisów: skorzystanie z jednego z nich
	<span class="emphasis"><em>wyklucza</em></span> korzystanie z drugiego. Wybór powinien
	zale¿eæ od w³asnych potrzeb i mo¿liwo¶ci.</p></div><p>Przed rozpoczêciem nale¿y upewniæ siê, ¿e dysponujemy przynajmniej
      dwiema kartami sieciowymi zdolnymi do pracy w trybie po¶redniczenia
      zarówno przy odbiorze, jak i nadawaniu; karty bêd± wysy³aæ pakiety
      opatrzone niekoniecznie ich w³asnymi adresami. Co wiêcej, by osi±gn±æ
      dobr± wydajno¶æ, powinny byæ to karty PCI obs³uguj±ce zarz±dzanie
      magistral±. Do takich nale¿± karty Intel EtherExpress Pro, a tak¿e
      karty 3Com z serii 3c9xx. Dla uproszczenia konfiguracji firewalla
      po¿ytecznym okazaæ siê mo¿e posiadanie kart dwóch ró¿nych producentów
      (korzystaj±cych z innych sterowników), by ³atwiej by³o odró¿niæ
      interfejs pod³±czony do rutera od interfejsu po³±czonego z sieci±
      wewnêtrzn±.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="filtering-bridges-kernel"></a>2.1. Konfigurowanie j±dra</h3></div></div></div><p>Pierwsza z metod jest starsza, lecz sprawdzona. Na pocz±tek
        nale¿y dodaæ nastêpuj±ce wiersze do pliku konfiguracyjnego
	j±dra:</p><pre class="programlisting">options BRIDGE
options IPFIREWALL
options IPFIREWALL_VERBOSE</pre><p>Pierwszy wiersz w³±cza do j±dra obs³ugê mostu, drugi obs³ugê
        firewalla, a trzeci funkcje rejestruj±ce firewalla.</p><p>Teraz trzeba skompilowaæ i zainstalowaæ nowe j±dro. Szczegó³owy
        opis tych czynno¶ci znale¼æ mo¿na w Podrêczniku FreeBSD, w czê¶ci
	"<a class="link" href="../../books/handbook/kernelconfig-building.html" target="_top">Building
	and Installing a Custom Kernel</a>".</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="filtering-bridges-modules"></a>2.2. £adowanie modu³ów</h3></div></div></div><p>Ta metoda instalacji jest nowsza i prostsza, polega jedynie
        na dodaniu poni¿szego wiersza do
	<code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">bridge_load="YES"</pre><p>W efekcie podczas ³adowania systemu wraz z j±drem zostanie
        za³adowany modu³ <code class="filename">bridge.ko</code>. Nie trzeba dodawaæ
	analogicznego wiersza dla modu³u <code class="filename">ipfw.ko</code>, gdy¿
	zostanie on za³adowany automatycznie po wykonaniu czynno¶ci
	opisanych w nastêpnej czê¶ci.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filtering-bridges-finalprep"></a>3. Przygotowanie do pracy</h2></div></div></div><p>Przed ponownym uruchomieniem systemu oraz za³adowaniem nowego j±dra
      lub modu³ów (w zale¿no¶ci od wybranej metody instalacji), trzeba
      jeszcze dokonaæ kilku zmian w pliku konfiguracyjnym
      <code class="filename">/etc/rc.conf</code>. Domy¶ln± regu³± firewalla jest
      zatrzymywanie wszystkich pakietów IP. Zaczniemy od skonfigurowania
      firewalla <code class="option">otwartego</code>, by sprawdziæ jego dzia³anie przy
      wy³±czonym filtrowaniu (dziêki temu maszyna bêdzie mog³a utrzymaæ
      po³±czenie z sieci±, co jest niezbêdne w przypadku, gdy konfiguracja
      przeprowadzana jest poprzez sieæ).
      W pliku <code class="filename">/etc/rc.conf</code> nale¿y umie¶ciæ poni¿sze
      wpisy:</p><pre class="programlisting">firewall_enable="YES"
firewall_type="open"
firewall_quiet="YES"
firewall_logging="YES"</pre><p>Pierwszy wiersz powoduje uruchomienie firewalla (³adowany jest
      modu³ <code class="filename">ipfw.ko</code>, je¶li nie zosta³ wkompilowany do
      j±dra), w drugim ustawiany jest
      <code class="option">otwarty</code> tryb jego pracy (zgodnie z opisem w
      <code class="filename">/etc/rc.firewall</code>). Nastêpny wiersz nakazuje nie
      pokazywaæ ³adowanych regu³, a w ostatnim w³±czane jest
      rejestrowanie.</p><p>Interfejsy sieciowe s± najczê¶ciej skonfigurowane tak, ¿e tylko
      jedna z kart sieciowych ma przypisany adres IP, jednak¿e most dzia³a
      tak samo równie¿ wtedy, gdy adresy przypisane s± do obu kart lub nie s±
      przypisane do ¿adnej z nich. W tym ostatnim przypadku (brak IP) maszyna
      pe³ni±ca rolê mostu bêdzie jeszcze bardziej ukryta, gdy¿ nie bêdzie
      dostêpna z sieci; dostêp do niej mo¿liwy bêdzie poprzez konsolê lub
      trzeci interfejs sieciowy odseparowany od mostu. Niekiedy dostêp do
      sieci potrzebny jest programom uruchamianym podczas
      ³adowania systemu, na przyk³ad do okre¶lenia nazwy domeny. W takiej
      sytuacji adres IP nale¿y przydzieliæ interfejsowi zewnêtrznemu (czyli
      temu, który po³±czony jest z Internetem, gdzie znajduje siê serwer
      <acronym class="acronym">DNS</acronym>), poniewa¿ most bêdzie uruchomiony dopiero w
      koñcowej fazie uruchamiania systemu. Oznacza to, ¿e interfejs
      <code class="filename">fxp0</code> (jak w przyk³adzie) musi byæ uwzglêdniony
      w sekcji ifconfig pliku <code class="filename">/etc/rc.conf</code>, w
      przeciwieñstwie do interfejsu <code class="filename">xl0</code>.
      Przydzielanie adresów IP obu kartom sieciowym nie ma raczej sensu,
      chyba, ¿e podczas uruchamiania systemu programy potrzebuj± dostêpu
      do obu segmentów sieci.</p><p>Nale¿y mieæ na uwadze, ¿e w sieci IP opartej na Ethernecie dzia³aj±
      w rzeczywisto¶ci dwa protoko³y: jednym jest oczywi¶cie IP, drugim
      jest <acronym class="acronym">ARP</acronym>. Zadaniem protoko³u <acronym class="acronym">ARP</acronym>
      jest przekszta³cenie adresu IP stacji na jej adres ethernetowy (adres
      <acronym class="acronym">MAC</acronym>). By mo¿liwa by³a komunikacja miêdzy dwoma
      stacjami znajduj±cymi siê po dwóch stronach mostu, pakiety
      <acronym class="acronym">ARP</acronym> musz± byæ przekazywane przez most. Protokó³
      <acronym class="acronym">ARP</acronym> nie jest sk³adnikiem warstwy IP, poniewa¿
      jest u¿ywany tylko wtedy, gdy IP dzia³a w sieci Ethernet. Filtrowanie
      pakietów przez firewall w FreeBSD dotyczy warstwy IP, wiêc pakiety
      innego typu (w tym tak¿e <acronym class="acronym">ARP</acronym>) bêd± przekazywane
      dalej bez filtrowania, nawet je¶li konfiguracja firewalla nakazuje
      blokowanie wszystkiego.</p><p>Mo¿na ju¿ uruchomiæ system ponownie i korzystaæ z niego jak
      dotychczas. Pojawi± siê nowe komunikaty dotycz±ce mostu i firewalla,
      most jednak nie bêdzie jeszcze pracowaæ, natomiast firewall bêdzie
      dzia³aæ w trybie <code class="option">otwartym</code>, bez jakiegokolwiek
      blokowania.</p><p>Je¶li pojawi± siê jakiekolwiek problemy, nale¿y siê z nimi
      uporaæ przed przyst±pieniem do kolejnego etapu pracy.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filtering-bridges-enabling"></a>4. Uruchamianie mostu</h2></div></div></div><p>Uruchomienie mostu polega na wykonaniu nastêpuj±cej sekwencji
      poleceñ (nazwy przyk³adowych interfejsów sieciowych
      <code class="filename">fxp0</code> i <code class="filename">xl0</code> nale¿y
      zast±piæ nazwami w³asnych interfejsów):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl net.link.ether.bridge_cfg=fxp0:0,xl0:0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl net.link.ether.bridge_ipfw=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl net.link.ether.bridge=1</code></strong></pre><p>Pierwsze polecenie wskazuje interfejsy obs³ugiwane przez most,
      drugie w³±cza firewalla, wreszcie trzecie polecenie w³±cza sam
      most.</p><p>Tak skonfigurowana maszyna mo¿e zostaæ w³±czona miêdzy dwie grupy
      po³±czonych w sieæ komputerów bez zak³ócania ich wzajemnej komunikacji.
      Je¶li to siê powiedzie, mo¿na dodaæ do pliku
      <code class="filename">/etc/sysctl.conf</code> wpisy
      <code class="literal">net.link.ether.[co¶]=[co¶]</code>
      zgodne z powy¿szymi, by zosta³y uwzglêdnione przy ³adowaniu systemu.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filtering-bridges-ipfirewall"></a>5. Konfiguracja firewalla</h2></div></div></div><p>Nastêpnym krokiem jest przygotowanie regu³ firewalla,
      zabezpieczaj±cych sieæ wewnêtrzn±. Wi±¿e siê to z pewnymi utrudnieniami,
      gdy¿ nie wszystkie mo¿liwo¶ci firewalla mog± byæ wykorzystywane w
      przypadku pakietów przechodz±cych przez most. Trzeba te¿ wiedzieæ, ¿e
      miêdzy pakietami przekazywanymi, a odbieranymi przez maszynê lokaln±
      jest pewna ró¿nica. Pakiety przychodz±ce przechodz± przez firewall
      tylko raz, a nie dwa razy jak w zwyk³ych warunkach. Mówi±c dok³adniej,
      s± one filtrowane tylko przy odbiorze, tak wiêc regu³y zawieraj±ce
      <code class="option">out</code> lub <code class="option">xmit</code> bêd± bezu¿yteczne.
      Ja osobi¶cie u¿ywam starszej sk³adni <code class="option">in via</code>, któr±
      rozs±dniej siê czyta. Trzeba równie¿ pamiêtaæ, ¿e filtruj±c pakiety
      przechodz±ce przez most, mo¿na u¿ywaæ tylko poleceñ
      <code class="option">pass</code> lub <code class="option">drop</code>. Bardziej wymy¶lne
      polecenia, jak <code class="option">divert</code>, <code class="option">forward</code> czy
      <code class="option">reject</code> s± niedozwolone. Mo¿na z nich korzystaæ tylko
      w odniesieniu do pakietów wysy³anych przez maszynê mostu lub do niej
      przychodz±cych (je¶li oczywi¶cie ma ona adres IP).</p><p>Nowo¶ci± w FreeBSD 4.0 jest filtrowanie z utrzymywaniem stanu. Jest
      ono znacznym u³atwieniem obs³ugi komunikacji przez
      <acronym class="acronym">UDP</acronym>, polegaj±cej najczê¶ciej na wys³aniu ¿±dania, a
      za chwilê odebraniu odpowiedzi, z takimi samymi adresami IP i numerami
      portów (przy czym nadawca i odbiorca s± oczywi¶cie zamienieni
      miejscami). Praktycznie nie da siê potraktowaæ takiej wymiany jako
      pojedynczej sesji,
      pos³uguj±c siê firewallem nie przechowuj±cym informacji o stanie
      po³±czenia. Jednak¿e gdy firewall potrafi <span class="quote">"<span class="quote">zapamiêtaæ</span>"</span>
      wychodz±cy pakiet <acronym class="acronym">UDP</acronym> i zezwoliæ na odpowied¼ w
      ci±gu kilku nastêpnych minut, wówczas zarz±dzanie komunikacj±
      <acronym class="acronym">UDP</acronym> staje siê dziecinnie proste. Jak to zrobiæ,
      pokazuje poni¿szy przyk³ad. Podobnie mo¿na traktowaæ pakiety
      <acronym class="acronym">TCP</acronym>, chroni to przed niektórymi atakami przez
      uniemo¿liwienie dzia³ania oraz innymi figlami, prowadzi jednak do
      szybkiego rozrastania siê tablicy stanów.</p><p>Spójrzmy na przyk³adow± konfiguracjê. Zwróæmy uwagê, ¿e na pocz±tku
      pliku <code class="filename">/etc/rc.firewall</code> umieszczono domy¶lne regu³y
      dla interfejsu pseudosieci <code class="filename">lo0</code>, nie trzeba
      siê wiêc ju¿ nimi przejmowaæ. Inne regu³y powinny byæ umieszczone w
      oddzielnym pliku (np. <code class="filename">/etc/rc.firewall.local</code>),
      który by³by do³±czany podczas ³adowania systemu dziêki zmianie
      w pliku <code class="filename">/etc/rc.conf</code> tego wiersza, w którym
      typ firewalla by³ zdefiniowany jako <code class="option">otwarty</code>:</p><pre class="programlisting">firewall_type="/etc/rc.firewall.local"</pre><div xmlns="" class="important"><h3 class="admontitle">Wa¿ne: </h3><p xmlns="http://www.w3.org/1999/xhtml">Nale¿y tu podaæ <span class="emphasis"><em>pe³n±</em></span> ¶cie¿kê, w przeciwnym
        razie plik nie zostanie za³adowany, co grozi utrat± dostêpu do
	sieci.</p></div><p>Na potrzeby przyk³adu przyjmujemy, ¿e interfejs
      <code class="filename">fxp0</code> po³±czony jest z Internetem, natomiast
      <code class="filename">xl0</code> z sieci± wewnêtrzn±
      (<acronym class="acronym">LAN</acronym>). Adres IP maszyny mostu to
      <code class="systemitem">1.2.3.4</code> (w rzeczywisto¶ci dostawca
      us³ug interenetowych nie móg³by przydzieliæ adresu klasy A, jednak
      ¶wietnie nadaje siê on jako przyk³ad).</p><pre class="programlisting"># Szybkie przepuszczanie pakietów, których stan zosta³ zapamiêtany
add check-state

# Blokada sieci z RFC 1918
add drop all from 10.0.0.0/8 to any in via fxp0
add drop all from 172.16.0.0/12 to any in via fxp0
add drop all from 192.168.0.0/16 to any in via fxp0

# Maszyna bêd±ca mostem mo¿e wysy³aæ co tylko zechce
# (je¶li maszyna nie ma adresu IP, pomiñ poni¿sze wiersze)
add pass tcp from 1.2.3.4 to any setup keep-state
add pass udp from 1.2.3.4 to any keep-state
add pass ip from 1.2.3.4 to any

# Stacje sieci wewnêtrznej mog± wysy³aæ co tylko zechc±
add pass tcp from any to any in via xl0 setup keep-state
add pass udp from any to any in via xl0 keep-state
add pass ip from any to any in via xl0

# Protokó³ TCP
# Przepuszczanie SSH
add pass tcp from any to any 22 in via fxp0 setup keep-state
# Przepuszczanie SMTP jedynie do serwera poczty
add pass tcp from any to relay 25 in via fxp0 setup keep-state
# Informacje o obszarach mog± byæ przesy³ane tylko przez podrzêdny
# serwer nazw [dns2.nic.it]
add pass tcp from 193.205.245.8 to ns 53 in via fxp0 setup keep-state
# Przepuszczanie zapytañ ident - takie rozwi±zanie jest lepsze
# ni¿ oczekiwanie na przekroczenie czasu
add pass tcp from any to any 113 in via fxp0 setup keep-state
# Przepuszczenie zakresu portów dynamicznych
add pass tcp from any to any 49152-65535 in via fxp0 setup keep-state

# Protokó³ UDP
# Przepuszczanie zapytañ DNS jedynie do serwera DNS
add pass udp from any to ns 53 in via fxp0 keep-state
# Przepuszczenie zakresu portów dynamicznych
add pass udp from any to any 49152-65535 in via fxp0 keep-state

# Protokó³ ICMP
# Przepuszczanie 'pingów'
add pass icmp from any to any icmptypes 8 keep-state
# Przepuszczanie komunikatów o b³êdach generowanych przez 'traceroute'
add pass icmp from any to any icmptypes 3
add pass icmp from any to any icmptypes 11

# Wszystko inne jest podejrzane
add drop log all from any to any</pre><p>Czytelnicy maj±cy ju¿ do¶wiadczenie z konfiguracj± firewalla mog±
      zwróciæ uwagê na brak pewnych rzeczy. W szczególno¶ci, brakuje regu³
      zapobiegaj±cych podszywaniu siê. Rzeczywi¶cie, w¶ród powy¿szych regu³
      <span class="emphasis"><em>nie by³o</em></span> takiej:</p><pre class="programlisting">add deny all from 1.2.3.4/8 to any in via fxp0</pre><p>Nakazuje ona odrzucanie pakietów, które nadchodz± z zewn±trz, a
      udaj±, ¿e s± z sieci wewnêtrznej. Jest to zwykle stosowane w celu
      zabezpieczenia siê przed próbami prze¶lizniêcia siê przez filtrowanie,
      polegaj±cymi na tworzeniu fa³szywych pakietów, wygl±daj±cych jak
      wys³ane z sieci wewnêtrznej. K³opot w tym, ¿e jest
      <span class="emphasis"><em>co najmniej</em></span> jedna stacja po³±czona z interfejsem
      zewnêtrznym, której nie mo¿na zignorowaæ: jest ni± ruter. Zwykle
      jednak ochrona przed podszywaniem siê realizowana jest przez
      dostawcê us³ug internetowych na jego ruterze, nie trzeba siê wiêc
      tym przejmowaæ.</p><p>Ostatnia regu³a jest bardzo podobna do regu³y przyjmowanej
      domy¶lnie, czyli odrzucania wszystkiego, co nie jest ¶ci¶le dozwolone.
      Jest jednak ró¿nica: wszystko, co jest podejrzane, jest
      rejestrowane.</p><p>Dwie regu³y odpowiedzialne s± za przekazywanie pakietów
      <acronym class="acronym">SMTP</acronym> i <acronym class="acronym">DNS</acronym> do serwera poczty i
      serwera nazw, o ile takowe serwery s±. Zestaw regu³ powinien byæ
      oczywi¶cie dostosowany do w³asnych potrzeb, tutaj pokazany jest tylko
      pewien przyk³ad (sk³adnia regu³ jest dok³adnie opisana w dokumentacji
      systemowej <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>). Trzeba mieæ na uwadze, ¿e aby poprawnie
      dzia³a³y
      <span class="quote">"<span class="quote">relay</span>"</span> i <span class="quote">"<span class="quote">ns</span>"</span>, wymagane jest, by zapytania
      DNS dzia³a³y <span class="emphasis"><em>zanim</em></span> pracê rozpoczyna most. Dziêki
      temu mo¿na te¿ siê przekonaæ, czy adres IP zosta³ przypisany do
      w³a¶ciwiej karty sieciowej. Alternatywnym rozwi±zaniem jest
      wpisanie adresu IP zamiast nazwy stacji (jest to jedyna mo¿liwo¶æ
      w przypadku, gdy maszyna nie ma adresu IP).</p><p>Osoby, które ju¿ kiedy¶ mia³y pewne do¶wiadczenia z konfiguracj±
      firewalla, przyzwyczajone s± zapewne do regu³ <code class="option">reset</code>
      lub <code class="option">forward</code> dla pakietów ident (port
      <acronym class="acronym">TCP</acronym> o numerze 113). Niestety, w przypadku mostu
      takie rozwi±zanie nie wchodzi w grê, najlepiej jest po prostu
      przepu¶ciæ owe pakiety do ich adresata. Jest to stosunkowo niegro¼ne,
      gdy adresat ma wy³±czon± us³ugê ident. Mo¿na tak¿e blokowaæ po³±czenia
      z portem 113, co powoduje pewne problemy np. z us³ug±
      <acronym class="acronym">IRC</acronym> (poniewa¿ zapytanie ident musi przekroczyæ
      czas oczekiwania).</p><p>Niezrozumia³a mo¿e wydaæ siê obecno¶æ oddzielnych regu³, z
      których jedne zezwalaja na wysy³anie maszynie bêd±cej mostem, drugie
      natomiast stacjom sieci wewnêtrznej. Jest tak dlatego, ¿e pakiety
      wysy³ane przez maszynê lokaln± docieraj± do filtra inn± drog± ni¿
      pakiety wys³ane z sieci wewnêtrznej. Te ostatnie musz± przej¶æ przez
      most, natomiast pakiety wys³ane lokalnie trafiaj± na stos IP maszyny.
      Osobne zestawy regu³ obs³uguj± obydwa przypadki. Z kolei regu³y
      zawieraj±ce <code class="literal">in via fxp0</code>
      odnosz± siê do obu rodzajów pakietów. Mówi±c ogólnie, pisz±c regu³y
      <code class="option">in via</code> trzeba zrobiæ wyj±tek dla pakietów wysy³anych
      z lokalnej maszyny, poniewa¿ one nie przysz³y przez ¿aden z
      interfejsów.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filtering-bridges-contributors"></a>6. Podziêkowania</h2></div></div></div><p>Du¿a czê¶æ niniejszego artyku³u zaczerpniêta zosta³a ze starego
      dokumentu o mostach autorstwa Nicka Sayera. Inspiracj± by³o równie¿
      wprowadzenie do tematyki mostów napisane przez Steve'a Petersona.</p><p>Bardzo dziêkujê Luigiemu Rizzo za implementacjê kodu mostu w
      FreeBSD, jak równie¿ za czas po¶wiêcony na odpowiedzi na moje
      pytania.</p><p>Dziêkujê te¿ Tomowi Rhodesowi, który zechcia³ przyjrzeæ siê
      mojemu t³umaczeniu tego artyku³u z w³oskiego (w takim jêzyku napisany
      by³ orygina³) na angielski.</p></div></div></body></html>