<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>2. NanoBSD Anleitung</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Einführung in NanoBSD" /><link rel="up" href="index.html" title="Einführung in NanoBSD" /><link rel="prev" href="index.html" title="Einführung in NanoBSD" /><link rel="next" href="ix01.html" title="Stichwortverzeichnis" /><link rel="copyright" href="trademarks.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2. NanoBSD Anleitung</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="index.html">Zurück</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ix01.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="howto"></a>2. NanoBSD Anleitung</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="design"></a>2.1. Das Design von NanoBSD</h3></div></div></div><p>Sobald das Abbild auf dem Medium verfügbar ist, kann
	<span class="application">NanoBSD</span> gebootet werden.  Der
	Massenspeicher ist standardmäßig in drei Teile
	unterteilt:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Zwei Abbild Partitionen: <code class="literal">code#1</code> und
	    <code class="literal">code#2</code>.</p></li><li class="listitem"><p>Die Partition der Konfigurationsdatei, welche zur
	    Laufzeit unter dem <code class="filename">/cfg</code> Verzeichnis gemountet
	    werden kann.</p></li></ul></div><p>Diese Partitionen sind im Allgemeinen read-only.</p><p>Die <code class="filename">/etc</code> und
	<code class="filename">/var</code> Verzeichnisse sind
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> (malloc) Speicher.</p><p>Die Partition der Konfigurationsdatei besteht unter dem
	<code class="filename">/cfg</code> Verzeichnis.  Sie
	enthält Dateien für das <code class="filename">/etc</code> Verzeichnis und wird
	direkt nach dem Botten read-only eingehangen, weshalb es
	erforderlich ist geänderte Dateien von <code class="filename">/etc</code> zurück nach <code class="filename">/cfg</code> zu kopieren falls die
	Änderungen nach einem Neustart bestehen bleiben
	sollen.</p><div class="example"><a id="idp63723472"></a><div class="example-title">Beispiel 1. Dauerhafte Änderungen in
	  <code class="filename">/etc/resolv.conf</code> vornehmen</div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>vi /etc/resolv.conf</code></strong>
[...]
<code class="prompt">#</code> <strong class="userinput"><code>mount /cfg</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp /etc/resolv.conf /cfg</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>umount /cfg</code></strong></pre></div></div><br class="example-break" /><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Die <code class="filename">/cfg</code>
	  Partition sollte nur während des Bootvorgangs und zu
	  Änderungen an den Konfigurationsdateien gemountet
	  werden.</p><p xmlns="http://www.w3.org/1999/xhtml">Die <code class="filename">/cfg</code>
	  Partition jederzeit gemountet zu haben ist keine gute Idee,
	  besonders wenn das <span class="application">NanoBSD</span> System
	  auf einem Massenspeicher betrieben wird, der eventuell druch
	  eine große Anzahl von Schreiboperationen nachteilig
	  beeinträchtigt wird (z. B. wenn der Dateisystem-Syncer den
	  Speicher mit Daten überflutet).</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63739600"></a>2.2. Ein NanoBSD Abbild erstellen</h3></div></div></div><p>Ein <span class="application">NanoBSD</span> Abbild wird über
	ein einfaches <code class="filename">nanobsd.sh</code> Shell-Skript
	gebaut, das sich unter <code class="filename">/usr/src/tools/tools/nanobsd</code>
	befindet.  Das Skript erstellt ein Abbild, welches dann
	mittels <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dd&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">dd</span>(1)</span></a> auf einen Massenspeicher kopiert werden
	kann.</p><p>Die folgenden Kommandos sind notwendig um ein
	<span class="application">NanoBSD</span> Abbild zu erstellen:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/tools/tools/nanobsd</code></strong> <a id="nbsd-cd"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>sh nanobsd.sh</code></strong> <a id="nbsd-sh"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/obj/nanobsd.full</code></strong> <a id="nbsd-cd2"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>dd if=_.disk.full of=/dev/da0 bs=64k</code></strong> <a id="nbsd-dd"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#nbsd-cd"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Wechsel in das Basisverzeichnis des
	    <span class="application">NanoBSD</span> Skripts.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#nbsd-sh"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Den Bauprozess starten.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#nbsd-cd2"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Wechsel in das Verzeichnis, in dem  das gebaute Abbild
	    liegt.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#nbsd-dd"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p><span class="application">NanoBSD</span> auf einem
	    Massenspeicher installieren.</p></td></tr></table></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63794896"></a>2.3. Ein NanoBSD Abbild anpassen</h3></div></div></div><p>Dies ist wahrscheinlich das wichtigste und interessanteste
	Merkmal von <span class="application">NanoBSD</span>.  Hierbei
	werden Sie auch die meiste Zeit mit der Entwicklung von
	<span class="application">NanoBSD</span> verbringen.</p><p>Der Aufruf des folgenden Kommandos wird
	<code class="filename">nanobsd.sh</code> dazu zwingen, seine
	Konfiguration aus <code class="filename">myconf.nano</code> aus dem
	aktuellen Verzeichnis zu lesen:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh nanobsd.sh -c myconf.nano</code></strong></pre><p>Die Anpassung wird auf zwei Arten geschehen:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Konfigurations-Optionen</p></li><li class="listitem"><p>Benutzerdefinierte Funktionen</p></li></ul></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63808976"></a>2.3.1. Konfigurations-Optionen</h4></div></div></div><p>Durch Konfigurationseinstellungen ist es möglich
	  Optionen zu übergeben, die sowohl die
	  <code class="buildtarget">buildworld</code> und
	  <code class="buildtarget">installworld</code> Phasen des
	  <span class="application">NanoBSD</span> Bauprozesses betreffen,
	  sowie interne Optionen, die den Haupt-Bauprozess von
	  <span class="application">NanoBSD</span> beeinflussen. Durch diese
	  Optionen ist es möglich, das System so zu reduzieren, dass
	  es mit wenig Platz, etwa 64 MB auskommt. Sie können die
	  Konfigurationsdateien dazu nutzten FreeBSD noch weiter zu
	  trimmen, bis es nur noch aus dem Kernel und zwei oder drei
	  Dateien im Userland besteht.</p><p>Die Konfigurationsdatei besteht aus
	  Konfigurations-Optionen, welche die Standardwerte
	  überschreiben.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">NANO_NAME</code> &#8212; Name des Build
	      (wird verwendet, um die workdir Namen zu
	      konstruieren).</p></li><li class="listitem"><p><code class="literal">NANO_SRC</code> &#8212; Pfad zum
	      Quelltextverzeichnis, das für den Bau des Abbilds
	      verwendet wird.</p></li><li class="listitem"><p><code class="literal">NANO_KERNEL</code> &#8212; Name der
	      Kernelkonfigurationsdatei, die für den Bau des Kernels
	      verwendet wird.</p></li><li class="listitem"><p><code class="literal">CONF_BUILD</code> &#8212; Optionen für
	      die <code class="buildtarget">buildworld</code> Phase des
	      Bauprozesses.</p></li><li class="listitem"><p><code class="literal">CONF_INSTALL</code> &#8212; Optionen
	      für die <code class="buildtarget">installworld</code> Phase
	      des Bauprozesses.</p></li><li class="listitem"><p><code class="literal">CONF_WORLD</code> &#8212; Optionen für
	      die <code class="buildtarget">buildworld</code> und
	      <code class="buildtarget">installworld</code> Phasen des
	      Bauprozesses.</p></li><li class="listitem"><p><code class="literal">FlashDevice</code> &#8212; Definiert den
	      zu benutzenden Medientyp.  Überprüfen Sie die
	      Datei <code class="filename">FlashDevice.sub</code> für
	      weitere Informationen.</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63855696"></a>2.3.2. Benutzerdefinierte Funktionen</h4></div></div></div><p>Mit Hilfe von Shell-Funktionen in der
	  Konfigurationsdatei besteht die Möglichkeit zur
	  Feinabstimmung von <span class="application">NanoBSD</span>.  Das
	  folgende Beispiel illustriert das Grundmodell von
	  benutzerdefinierten Funktionen:</p><pre class="programlisting">cust_foo () (
	echo "bar=baz" &gt; \
		${NANO_WORLDDIR}/etc/foo
)
customize_cmd cust_foo</pre><p>Ein besseres Beispiel für eine Anpassung ist folgende,
	  welche die Standardgröße des <code class="filename">/etc</code> Verzeichnisses von 5 MB
	  auf 30 MB ändert:</p><pre class="programlisting">cust_etc_size () (
	cd ${NANO_WORLDDIR}/conf
	echo 30000 &gt; default/etc/md_size
)
customize_cmd cust_etc_size</pre><p>Es gibt ein paar vordefinierte Standardfunktionen die
	  Sie nutzen können:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">cust_comconsole</code> &#8212;
	      Deaktiviert <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getty&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">getty</span>(8)</span></a> auf den VGA Geräten (den
	      <code class="filename">/dev/ttyv*</code> Gerätedateien) und
	      ermöglicht die Nutzung der seriellen Schnittstelle COM1
	      als Systemkonsole.</p></li><li class="listitem"><p><code class="literal">cust_allow_ssh_root</code> &#8212;
	      Erlaubt es <code class="systemitem">root</code> sich über
	      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> anzumelden.</p></li><li class="listitem"><p><code class="literal">cust_install_files</code> &#8212;
	      Installiert Dateien aus dem <code class="filename">nanobsd/Files</code>
	      Verzeichnis, das einige nützliche Skripte für die
	      Systemverwaltung enthält.</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63896144"></a>2.3.3. Pakete hinzufügen</h4></div></div></div><p>Durch benutzerdefinierte Funktionen können Pakete zum
	  <span class="application">NanoBSD</span> Abbild hinzugefügt
	  werden.  Die nachfolgende Funktion installiert alle Pakete
	  aus
	  <code class="filename">/usr/src/tools/tools/nanobsd/packages</code>:</p><pre class="programlisting">install_packages () (
mkdir -p ${NANO_WORLDDIR}/packages
cp /usr/src/tools/tools/nanobsd/packages/* ${NANO_WORLDDIR}/packages
chroot ${NANO_WORLDDIR} sh -c 'cd packages; pkg_add -v *;cd ..;'
rm -rf ${NANO_WORLDDIR}/packages
)
customize_cmd install_packages</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63902032"></a>2.3.4. Beispiel einer Konfigurationsdatei</h4></div></div></div><p>Ein komplettes Beispiel für eine Konfigurationsdatei
	  zum Erstellen eines benutzerdefinierten
	  <span class="application">NanoBSD</span> Abbilds könnte folgende
	  sein:</p><pre class="programlisting">NANO_NAME=custom
NANO_SRC=/usr/src
NANO_KERNEL=MYKERNEL
NANO_IMAGES=2

CONF_BUILD='
NO_KLDLOAD=YES
NO_NETGRAPH=YES
NO_PAM=YES
'

CONF_INSTALL='
NO_ACPI=YES
NO_BLUETOOTH=YES
NO_CVS=YES
NO_FORTRAN=YES
NO_HTML=YES
NO_LPR=YES
NO_MAN=YES
NO_SENDMAIL=YES
NO_SHAREDOCS=YES
NO_EXAMPLES=YES
NO_INSTALLLIB=YES
NO_CALENDAR=YES
NO_MISC=YES
NO_SHARE=YES
'

CONF_WORLD='
NO_BIND=YES
NO_MODULES=YES
NO_KERBEROS=YES
NO_GAMES=YES
NO_RESCUE=YES
NO_LOCALES=YES
NO_SYSCONS=YES
NO_INFO=YES
'

FlashDevice SanDisk 1G

cust_nobeastie() (
	touch ${NANO_WORLDDIR}/boot/loader.conf
	echo "beastie_disable=\"YES\"" &gt;&gt; ${NANO_WORLDDIR}/boot/loader.conf
)

customize_cmd cust_comconsole
customize_cmd cust_install_files
customize_cmd cust_allow_ssh_root
customize_cmd cust_nobeastie</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63915856"></a>2.4. NanoBSD aktualisieren</h3></div></div></div><p>The Update-Prozess von <span class="application">NanoBSD</span>
	ist relativ einfach:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Erstellen Sie ein neues
	    <span class="application">NanoBSD</span> Abbild.</p></li><li class="step"><p>Laden Sie das neue Abbild in eine unbenutzte Partition
	    eines laufenden <span class="application">NanoBSD</span>
	    Systems.</p><p>Der wichtigste Unterschied dieses Schrittes zur ersten
	    <span class="application">NanoBSD</span> Installation besteht
	    darin, das jetzt anstatt der Datei
	    <code class="filename">_.disk.full</code> (enthält ein Abbild der
	    gesamten Platte) die Datei
	    <code class="filename">_.disk.image</code> (enthält ein Abbild
	    einer einzelnen System-Partition) installiert wird.</p></li><li class="step"><p>Neustart, um das System von der neu installierten
	    Partition zu starten.</p></li><li class="step"><p>Wenn alles gut geht, ist die Aktualisierung
	    abgeschlossen.</p></li><li class="step"><p>Wenn etwas schief läuft, starten Sie wieder in die
	    vorherige Partition (die das alte, funktionierende Abbild
	    enthält) um die System-Funktionalität so schnell wie
	    möglich wieder herzustellen. Beheben Sie alle Probleme
	    des neu gebauten Abbilds, und wiederholen Sie den
	    Vorgang.</p></li></ol></div><p>Um das neue Abbild auf das laufende
	<span class="application">NanoBSD</span> System zu installieren, ist
	es möglich, entweder das <code class="filename">updatep1</code> oder
	<code class="filename">updatep2</code> Skript im <code class="filename">/root</code> Verzeichnis zu verwenden,
	je nachdem, von welcher Partition das aktuelle System
	läuft.</p><p>In Abhängigkeit davon welche Dienste der Host, der das
	<span class="application">NanoBSD</span> Abbild anbietet, und welche
	Art von Transfer bevorzugt wird, bestehen eine von drei zu
	prüfenden Möglichkeiten:</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63955024"></a>2.4.1. Verwendung von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ftp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ftp</span>(1)</span></a></h4></div></div></div><p>Wenn die Übertragungsgeschwindigkeit an erster
	  Stelle steht, verwenden Sie dieses Beispiel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ftp myhost
get _.disk.image "| sh updatep1"</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63972688"></a>2.4.2. Verwendung von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a></h4></div></div></div><p>Wenn eine sichere Übertragung bevorzugt wird,
	  sollten Sie die Verwendung dieses Beispiels in Betracht
	  ziehen:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ssh myhost cat _.disk.image.gz | zcat | sh updatep1</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63979344"></a>2.4.3. Verwendung von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=nc&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">nc</span>(1)</span></a></h4></div></div></div><p>Verwenden Sie dieses Beispiel, wenn auf dem Remote-Host
	  kein <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ftpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ftpd</span>(8)</span></a> oder <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> Dienst läuft:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Zunächst öffnen Sie eine TCP-Listener auf dem Host
	      der das Abbild bereitstellt und zum Client
	      sendet:</p><pre class="screen">myhost<code class="prompt">#</code> <strong class="userinput"><code>nc -l 2222 &lt; _.disk.image</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Stellen Sie sicher das der benutzte Port nicht
		blockiert wird, um eingehende Verbindungen, vom
		<span class="application">NanoBSD</span> Host durch die
		Firewall, zu ermöglichen.</p></div></li><li class="step"><p>Verbinden Sie sich zum Host der das Abbild
	      bereitstellt und führen Sie das
	      <code class="filename">updatep1</code> Skript aus:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>nc myhost 2222 | sh updatep1</code></strong></pre></li></ol></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="index.html">Zurück</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ix01.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">Einführung in NanoBSD </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> Stichwortverzeichnis</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>