<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>Kapitel 10. Kernel-Fehlersuche</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Developers' Handbook" /><link rel="up" href="kernel.html" title="Teil III. Kernel" /><link rel="prev" href="kernelbuild-new.html" title="9.2. Einen Kernel auf die &#8222;neue&#8220; Art und Weise bauen" /><link rel="next" href="kerneldebug-gdb.html" title="10.2. Fehlersuche in einem Speicherauszug nach einem Kernel-Absturz mit kgdb" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Kapitel 10. Kernel-Fehlersuche</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kernelbuild-new.html">Zurück</a> </td><th width="60%" align="center">Teil III. Kernel</th><td width="20%" align="right"> <a accesskey="n" href="kerneldebug-gdb.html">Weiter</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="kerneldebug"></a>Kapitel 10. Kernel-Fehlersuche</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Paul</span> <span class="surname">Richards</span></span>, <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Jörg</span> <span class="surname">Wunsch</span></span> und <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Robert</span> <span class="surname">Watson</span></span>. </span></div><div><span class="authorgroup">Übersetzt von <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Fabian</span> <span class="surname">Ruch</span></span>. </span></div></div></div><div class="toc"><div class="toc-title">Inhaltsverzeichnis</div><dl class="toc"><dt><span class="sect1"><a href="kerneldebug.html#kerneldebug-obtain">10.1. Besorgen eines Speicherauszugs nach einem
      Kernel-Absturz (Kernel-Crash-Dump)</a></span></dt><dt><span class="sect1"><a href="kerneldebug-gdb.html">10.2. Fehlersuche in einem Speicherauszug nach einem
      Kernel-Absturz mit <code class="command">kgdb</code></a></span></dt><dt><span class="sect1"><a href="kerneldebug-ddd.html">10.3. Fehlersuche in einem Speicherauszug nach einem Absturz mit
      DDD</a></span></dt><dt><span class="sect1"><a href="kerneldebug-online-ddb.html">10.4. Online-Kernel-Fehlersuche mit DDB</a></span></dt><dt><span class="sect1"><a href="kerneldebug-online-gdb.html">10.5. Online-Kernel-Fehlersuche mit GDB auf einem entfernten
      System</a></span></dt><dt><span class="sect1"><a href="kerneldebug-console.html">10.6. Fehlersuche bei einem Konsolen-Treiber</a></span></dt><dt><span class="sect1"><a href="kerneldebug-deadlocks.html">10.7. Fehlersuche bei Deadlocks</a></span></dt><dt><span class="sect1"><a href="kerneldebug-options.html">10.8. Glossar der Kernel-Optionen zur Fehlersuche</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kerneldebug-obtain"></a>10.1. Besorgen eines Speicherauszugs nach einem
      Kernel-Absturz (Kernel-Crash-Dump)</h2></div></div></div><p>Wenn ein Entwicklungs-Kernel (z.B. FreeBSD-CURRENT) wie zum
      Beispiel ein Kernel unter Extrembedingungen (z.B. sehr hohe
      Belastungsraten (Load), eine äußerst hohe Anzahl an
      gleichzeitigen Benutzern, Hunderte <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>s usw.)
      eingesetzt oder eine neue Funktion oder ein neuer
      Gerätetreiber in FreeBSD-STABLE verwendet wird (z.B.
      <acronym class="acronym">PAE</acronym>), tritt manchmal eine Kernel-Panic ein.
      In einem solchen Fall zeigt dieses Kapitel, wie dem Absturz
      nützliche Informationen entnommen werden
      können.</p><p>Bei Kernel-Panics ist ein Neustart unvermeidlich. Nachdem
      ein System neu gestartet wurde, ist der Inhalt des
      physikalischen Speichers (<acronym class="acronym">RAM</acronym>), genauso wie
      jedes Bit, das sich vor der Panic auf dem Swap-Gerät
      befand, verloren. Um die Bits im physikalischen Speicher zu
      erhalten, zieht der Kernel Nutzen aus dem Swap-Gerät als
      vorübergehenden Ablageort, wo die Bits, welche sich im RAM
      befinden, auch nach einem Neustart nach einem Absturz
      verfügbar sind. Durch diese Vorgehensweise kann ein
      Kernel-Abbild, wenn FreeBSD nach einem Absturz startet, abgezogen
      und mit der Fehlersuche begonnen werden.</p><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ein Swap-Gerät, das als Ausgabegerät
	(Dump-Device) konfiguriert wurde, verhält sich immer noch
	wie ein Swap-Gerät. Die Ausgabe auf
	Nicht-Swap-Geräte (wie zum Beispiel Bänder oder
	CDRWs) wird zur Zeit nicht unterstützt. Ein
	<span class="quote">&#8222;<span class="quote">Swap-Gerät</span>&#8220;</span> ist gleichbedeutend mit einer
	<span class="quote">&#8222;<span class="quote">Swap-Partition</span>&#8220;</span>.</p></div><p>Es stehen verschiedene Arten von Speicherabzügen zur
      Verfügung: komplette Speicherabzüge (full memory dumps), welche
      den gesamten Inhalt des physischen Speichers beinhalten, Miniauszüge
      (minidumps), die nur die gerade verwendeten Speicherseiten des Kernels
      enthalten (FreeBSD 6.2 und höhere Versionen) und Textauszüge
      (textdumps), welche geskriptete oder Debugger-Ausgaben enthalten
      (FreeBSD 7.1 und höher).  Miniauszüge sind der Standardtyp
      der Abzüge seit FreeBSD 7.0 und fangen in den meisten Fällen
      alle nötigen Informationen ein, die in einem kompletten
      Kernel-Speicherabzug enthalten sind, da die meisten Probleme nur durch
      den Zustand des Kernels isoliert werden können.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="config-dumpdev"></a>10.1.1. Konfigurieren des Ausgabegeräts</h3></div></div></div><p>Bevor der Kernel den Inhalt seines physikalischen
	Speichers auf einem Ausgabegerät ablegt, muss ein solches
	konfiguriert werden. Ein Ausgabegerät wird durch Benutzen
	des <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dumpon&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dumpon</span>(8)</span></a>-Befehls festgelegt, um dem Kernel
	mitzuteilen, wohin die Speicherauszüge bei einem
	Kernel-Absturz gesichert werden sollen. Das
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dumpon&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dumpon</span>(8)</span></a>-Programm muss aufgerufen werden, nachdem die
	Swap-Partition mit <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=swapon&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">swapon</span>(8)</span></a> konfiguriert wurde. Dies
	wird normalerweise durch Setzen der
	<code class="varname">dumpdev</code>-Variable in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> auf den
	Pfad des Swap-Geräts (der empfohlene Weg, um einen
	Kernel-Speicherauszug zu entnehmen) bewerkstelligt, oder über
	<code class="literal">AUTO</code>, um die erste konfigurierte Swap-Partition
	zu verwenden. In HEAD ist die Standardeinstellung für
        <code class="varname">dumpdev</code> <code class="filename">AUTO</code> und
        änderte sich in den RELENG_*-Zweigen (mit Ausnahme von
        RELENG_7, bei dem <code class="literal">AUTO</code> beibehalten wurde) auf
        <code class="literal">NO</code>.  In FreeBSD 9.0-RELEASE und späteren
        Versionen fragt <span class="application">bsdinstall</span>, ob
        Speicherauszüge für das Zielsystem während des
        Installationsvorgangs aktiviert werden sollen.</p><div xmlns="" class="tip"><h3 class="admontitle">Tipp: </h3><p xmlns="http://www.w3.org/1999/xhtml">Vergleichen Sie <code class="filename">/etc/fstab</code> oder
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=swapinfo&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">swapinfo</span>(8)</span></a> für eine Liste der
	  Swap-Geräte.</p></div><div xmlns="" class="important"><h3 class="admontitle">Wichtig: </h3><p xmlns="http://www.w3.org/1999/xhtml">Stellen Sie sicher, dass das in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>
	  festgelegte <code class="varname">dumpdir</code> vor einem
	  Kernel-Absturz vorhanden ist.</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /var/crash</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 700 /var/crash</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">Denken Sie auch daran, dass der Inhalt von
	  <code class="filename">/var/crash</code> heikel ist und sehr
	  wahrscheinlich vertrauliche Informationen wie
	  Passwörter enthält.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="extract-dump"></a>10.1.2. Entnehmen eines Kernel-Speicherauszugs
	(Kernel-Dump)</h3></div></div></div><p>Sobald ein Speicherauszug auf ein Ausgabegerät
	geschrieben wurde, muss er entnommen werden, bevor das
	Swap-Gerät eingehängt wird. Um einen Speicherauszug
	aus einem Ausgabegerät zu entnehmen, benutzen Sie das
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=savecore&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">savecore</span>(8)</span></a>-Programm. Falls <code class="varname">dumpdev</code> in
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> gesetzt wurde, wird <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=savecore&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">savecore</span>(8)</span></a>
	automatisch beim ersten Start in den Multiuser-Modus nach dem
	Absturz und vor dem Einhängen des Swap-Geräts
	aufgerufen. Der Speicherort des entnommenen Kernels ist im
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>-Wert <code class="varname">dumpdir</code>,
	standardmäßig <code class="filename">/var/crash</code>,
	festgelegt und der Dateiname wird
	<code class="filename">vmcore.0</code> sein.</p><p>In dem Fall, dass bereits eine Datei mit dem Namen
	<code class="filename">vmcore.0</code> in
	<code class="filename">/var/crash</code> (oder auf was auch immer
	<code class="varname">dumpdir</code> gesetzt ist) vorhanden ist,
	erhöht der Kernel die angehängte Zahl bei jedem
	Absturz um eins und verhindert damit, dass ein vorhandener
	<code class="filename">vmcore</code> (z.B.
	<code class="filename">vmcore.1</code>) überschrieben wird.
	Während der Fehlersuche, möchten Sie höchst
	wahrscheinlich den <code class="filename">vmcore</code> mit der
	höchsten Version in <code class="filename">/var/crash</code>
	benutzen, wenn Sie den passenden <code class="filename">vmcore</code>
	suchen.</p><div xmlns="" class="tip"><h3 class="admontitle">Tipp: </h3><p xmlns="http://www.w3.org/1999/xhtml">Falls Sie einen neuen Kernel testen, aber einen anderen
	  starten müssen, um Ihr System wieder in Gang zu
	  bringen, starten Sie es nur in den Singleuser-Modus, indem
	  Sie das <code class="option">-s</code>-Flag an der
	  Boot-Eingabeaufforderung benutzen, und nehmen dann folgende
	  Schritte vor:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>fsck -p</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -a -t ufs</code></strong>       # make sure /var/crash is writable
<code class="prompt">#</code> <strong class="userinput"><code>savecore /var/crash /dev/ad0s1b</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong>                  # exit to multi-user</pre><p xmlns="http://www.w3.org/1999/xhtml">Dies weist <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=savecore&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">savecore</span>(8)</span></a> an, einen
	  Kernel-Speicherauszug aus <code class="filename">/dev/ad0s1b</code>
	  zu entnehmen und den Inhalt in
	  <code class="filename">/var/crash</code> abzulegen. Vergessen Sie
	  nicht sicherzustellen, dass das Zielverzeichnis
	  <code class="filename">/var/crash</code> genug freien Speicherplatz
	  für den Speicherauszug zur Verfügung hat.
	  Vergessen Sie auch nicht, den korrekten Pfad des
	  Swap-Geräts anzugeben, da es sehr wahrscheinlich anders
	  als <code class="filename">/dev/ad0s1b</code> lautet!</p></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kernelbuild-new.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="kernel.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="kerneldebug-gdb.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">9.2. Einen Kernel auf die <span class="quote">&#8222;<span class="quote">neue</span>&#8220;</span> Art und Weise
      bauen </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> 10.2. Fehlersuche in einem Speicherauszug nach einem
      Kernel-Absturz mit <code class="command">kgdb</code></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>