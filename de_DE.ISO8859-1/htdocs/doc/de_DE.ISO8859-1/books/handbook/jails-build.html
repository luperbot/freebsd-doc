<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>16.4. Einrichtung und Verwaltung von Jails</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Das FreeBSD-Handbuch" /><link rel="up" href="jails.html" title="Kapitel 16. Jails" /><link rel="prev" href="jails-intro.html" title="16.3. Einführung" /><link rel="next" href="jails-tuning.html" title="16.5. Feinabstimmung und Administration" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">16.4. Einrichtung und Verwaltung von Jails</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="jails-intro.html">Zurück</a> </td><th width="60%" align="center">Kapitel 16. Jails</th><td width="20%" align="right"> <a accesskey="n" href="jails-tuning.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-build"></a>16.4. Einrichtung und Verwaltung von Jails</h2></div></div></div><p>Einige Administratoren unterscheiden zwei verschiedene
      Jail-Arten:  <span class="quote">&#8222;<span class="quote">Komplette</span>&#8220;</span> Jails, die ein echtes
      FreeBSD darstellen und Jails für einen bestimmten
      <span class="quote">&#8222;<span class="quote">Dienst</span>&#8220;</span>, die nur einer bestimmten Anwendung
      oder einem Dienst (der möglicherweise mit besonderen
      Privilegien laufen soll) gewidmet sind.  Dies ist aber nur
      eine konzeptuelle Unterscheidung, die Einrichtung einer
      Jail bleibt davon gänzlich unberührt.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setenv D /hier/ist/die/jail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p $D</code></strong> <a id="jailpath"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildworld</code></strong> <a id="jailbuildworld"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld DESTDIR=$D</code></strong> <a id="jailinstallworld"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make distribution DESTDIR=$D</code></strong> <a id="jaildistrib"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>mount -t devfs devfs $D/dev</code></strong> <a id="jaildevfs"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#jailpath"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Das Festlegen des Installationsorts für das Jail
	  eignet sich am besten als Startpunkt.  Hier wird sich die
	  Jail innerhalb des Host-Dateisystems befinden.  Eine gute
	  Möglichkeit wäre etwa <code class="filename">/usr/jail/name_der_jail</code>,
	  wobei <em class="replaceable"><code>name_der_jail</code></em> den Hostname
	  darstellt, über den die Jail identifiziert werden
	  soll.  Das Dateisystem unterhalb von <code class="filename">/usr/</code> stellt normalerweise
	  aussreichend Platz für eine Jail zur Verfügung
	  (bedenken Sie, dass eine <span class="quote">&#8222;<span class="quote">komplette</span>&#8220;</span> Jail
	  ein Replikat einer jeden Datei der Standardinstallation des
	  FreeBSD-Basissystems enthält.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jailbuildworld"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Wenn Sie bereits ihre Systemanwendungen mittels
          <code class="command">make world</code> oder <code class="command">make buildworld</code>
          neu erstellt haben, können Sie diesen Schritt überspringen
          und die Systemanwendungen in die neue Jail installieren.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jailinstallworld"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Dieser Befehl wird den Verzeichnisbaum mit allen
	  notwendigen Binärdateien, Bibliotheken, Manualpages
	  usw. erstellen.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildistrib"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Der <code class="buildtarget">distribution</code>-Befehl
	  lässt <span class="application">make</span> alle
	  benötigten Konfigurationsdateien installieren, es
	  werden also alle installierbaren Dateien aus
	  <code class="filename">/usr/src/etc/</code> in
	  das Verzeichnis <code class="filename">/etc</code>
	  der Jail installiert (also nach <code class="filename">$D/etc/</code>).</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildevfs"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Das Einhängen des <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a>-Dateisystems
	  innerhalb der Jail ist nicht unbedingt notwendig.
	  Allerdings benötigt fast jede Anwendung Zugriff auf
	  wenigstens ein Gerät.  Es ist daher sehr wichtig,
	  den Zugriff auf Devices aus der Jail heraus zu
	  kontrollieren, da unsaubere Einstellungen es einem
	  Angreifer erlauben könnten, in das System einzudringen.
	  Die Kontrolle über <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> erfolgt durch die in
	  den Manualpages <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> und <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs.conf</span>(5)</span></a>
	  beschriebenen Regeln.</p></td></tr></table></div><p>Ist eine Jail einmal erst erstellt, kann sie durch
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> gestartet werden.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> benötigt
      zwingend mindestens vier Argumente, die im Abschnitt <a class="xref" href="jails-intro.html#jails-what" title="16.3.1. Was ist eine Jail?">Abschnitt 16.3.1, &#8222;Was ist eine Jail?&#8220;</a> des Handbuchs beschrieben sind.  Weitere
      Argumente sind möglich, um beispielsweise die Jail mit den
      Berechtigungen eines bestimmten Benutzers laufen zu lassen.  Das
      Argument <code class="option"><em class="replaceable"><code>command</code></em></code>
      hängt vom Typ der Jail ab; für ein <span class="emphasis"><em>virtuelles
      System</em></span> ist <code class="filename">/etc/rc</code> eine gute
      Wahl, da dies dem Startvorgang eines echten FreeBSD-Systems
      entspricht.  Bei einer <span class="emphasis"><em>Service</em></span>-Jail
      hängt dieses von der Art des Dienstes ab, der in der Jail
      laufen soll.</p><p>Jails werden häufig mit dem Betriebssystem gestartet,
      da der <code class="filename">rc</code>-Mechanismus von FreeBSD dafür
      eine einfach zu realisierende Möglichkeit bietet.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Eine Liste der Jails, die mit dem Betriebssystem
	  gestartet werden sollen, wird in die Datei <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>
	  geschrieben:</p><pre class="programlisting">jail_enable="YES"   # Set to NO to disable starting of any jails
jail_list="<em class="replaceable"><code>www</code></em>"     # Space separated list of names of jails</pre><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Die Namen der Jails in der
	    <code class="varname">jail_list</code> sollten nur alphanumerische
	    Zeichen enthalten.</p></div></li><li class="step"><p>Für jede Jail in der <code class="varname">jail_list</code>
	  sollten in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> einige Einstellungen
	  vorgenommen werden:</p><pre class="programlisting">jail_<em class="replaceable"><code>www</code></em>_rootdir="/usr/jail/www"     # jail's root directory
jail_<em class="replaceable"><code>www</code></em>_hostname="<em class="replaceable"><code>www</code></em>.example.org"  # jail's hostname
jail_<em class="replaceable"><code>www</code></em>_ip="192.168.0.10"           # jail's IP address
jail_<em class="replaceable"><code>www</code></em>_devfs_enable="YES"          # mount devfs in the jail
jail_<em class="replaceable"><code>www</code></em>_devfs_ruleset="<em class="replaceable"><code>www_ruleset</code></em>" # devfs ruleset to apply to jail</pre><p>Beim Start einer in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> konfigurierten Jail
	  wird das <code class="filename">/etc/rc</code>-Skript der Jail (das
	  "annimmt", dass es sich in einem kompletten System befindet)
	  aufgerufen.  Für Service-Jails sollten die Startskripte
	  der Jail durch das Setzen der Option
	  <code class="varname">jail_<em class="replaceable"><code>jailname</code></em>_exec_start</code>
	  entsprechend angepasst werden.</p><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Eine vollständige Liste der Optionen findet sich
	    in der Manualpage zu <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>.</p></div></li></ol></div><p>Das <code class="filename">/etc/rc.d/jail</code>-Skript kann
      zum manuellen Starten und Stoppen der Jail genutzt werden,
      wenn ein Eintrag in <code class="filename">rc.conf</code> angelegt
      wurde:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/jail start www</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/jail stop www</code></strong></pre><p>Es gibt momentan keinen sauberen Weg, eine <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> zu
      stoppen.  Dies liegt daran, dass die Kommandos zum sauberen
      Herunterfahren eines Systems innerhalb einer Jail nicht
      ausgeführt werden können.  Der beste Weg eine Jail zu
      beenden ist es daher, innerhalb der Jail den folgenden Befehl
      auszuführen (alternativ können Sie auch <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a>
      von außerhalb der Jail aufrufen):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh /etc/rc.shutdown</code></strong></pre><p>Weitere Informationen zu diesem Thema finden Sie in der
      Manualpage <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jails-intro.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="jails.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="jails-tuning.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">16.3. Einführung </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> 16.5. Feinabstimmung und Administration</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>