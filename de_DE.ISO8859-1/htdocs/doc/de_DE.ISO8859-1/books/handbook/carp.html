<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>33.11. CARP - Common Address Redundancy Protocol</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Das FreeBSD-Handbuch" /><link rel="up" href="advanced-networking.html" title="Kapitel 33. Weiterführende Netzwerkthemen" /><link rel="prev" href="network-ipv6.html" title="33.10. IPv6 &#8211; Internet Protocol Version 6" /><link rel="next" href="appendices.html" title="Teil V. Anhang" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">33.11. CARP - Common Address Redundancy Protocol</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-ipv6.html">Zurück</a> </td><th width="60%" align="center">Kapitel 33. Weiterführende Netzwerkthemen</th><td width="20%" align="right"> <a accesskey="n" href="appendices.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="carp"></a>33.11. CARP - Common Address Redundancy Protocol</h2></div><div><span class="authorgroup">Beigetragen von <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Aktualisiert von <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Allan</span> <span class="surname">Jude</span></span>. </span></div></div></div><a id="idp93545168" class="indexterm"></a><a id="idp93545936" class="indexterm"></a><p>Das <span class="foreignphrase"><em class="foreignphrase">Common Address Redundancy
	Protocol</em></span> (<acronym class="acronym">CARP</acronym>) erlaubt es,
      mehreren Rechnern die gleiche <acronym class="acronym">IP</acronym>-Adresse
      zuzuweisen und <span class="emphasis"><em>Hochverfügbarkeit</em></span>
      bereitzustellen.  Das bedeutet, dass ein oder mehrere Rechner
      ausfallen können und die anderen Rechner transparent
      einspringen, ohne das der Benutzer etwas von einem Ausfall
      mitbekommt.  Neben der gemeinsamen
      <acronym class="acronym">IP</acronym>-Adresse, haben die jeweiligen Rechner auch
      eine eindeutige <acronym class="acronym">IP</acronym>-Adresse zur Verwaltung und
      Konfiguration, wie in den folgenden Beispielen zu sehen
      ist.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="carp-ha"></a>33.11.1. Hochverfügbarkeit mit <acronym class="acronym">CARP</acronym></h3></div></div></div><p><acronym class="acronym">CARP</acronym> wird häufig verwendet, um einen
	oder mehrere Dienste hochverfügbar zu machen.  Dieses Beispiel
	konfiguriert eine Failover-Unterstützung mit drei Servern (mit
	jeweils eigener, eindeutiger <acronym class="acronym">IP</acronym>-Adresse),
	die alle den gleichen Web-Inhalt anbieten.  Die Lastverteilung
	dieser Maschinen wird dabei über <span class="foreignphrase"><em class="foreignphrase">Round
	  Robin</em></span> <acronym class="acronym">DNS</acronym> konfiguriert.
	Mit Ausnahme des Hostnamens und der
	<acronym class="acronym">IP</acronym>-Management-Adresse sind Master- und
	Backup-Maschinen identisch konfiguriert.  Die Server müssen
	die gleiche Konfiguration und die gleichen Dienste aktiviert
	haben.  Tritt ein Failover auf, können Anfragen an den Dienst
	mit der gemeinsam genutzten <acronym class="acronym">IP</acronym>-Adresse nur
	dann richtig beantwortet werden, wenn der Backup-Server
	Zugriff auf denselben Inhalt hat.  Die Backup-Maschine verfügt
	über zwei zusätzliche <acronym class="acronym">CARP</acronym>-Schnittstellen,
	eine für jede <acronym class="acronym">IP</acronym>-Adresse des
	Master-Content-Servers.  Sobald ein Fehler auftritt, übernimmt
	der Backup-Server die <acronym class="acronym">IP</acronym>-Adresse des
	ausgefallenen Master-Servers.  Die Benutzer werden einen
	Dienstausfall überhaupt nicht bemerken.</p><p>Dieses Beispiel benutzt zwei verschiedene Master namens
	<code class="systemitem">hosta.example.org</code> und
	<code class="systemitem">hostb.example.org</code> mit einem
	gemeinsamen Backup namens
	<code class="systemitem">hostc.example.org</code>.</p><p>Jede virtuelle <acronym class="acronym">IP</acronym>-Adresse hat eine
	eindeutige Identifikationsnummer, die als
	<span class="foreignphrase"><em class="foreignphrase">Virtual Host Identification</em></span>
	(<acronym class="acronym">VHID</acronym>) bekannt ist.  Alle Maschinen, die
	sich eine <acronym class="acronym">IP</acronym>-Adresse teilen, verwenden die
	gleiche <acronym class="acronym">VHID</acronym>.  Die <acronym class="acronym">VHID</acronym>
	für jede einzelne <acronym class="acronym">IP</acronym>-Adresse muss,
	entsprechend der Broadcast-Domäne der Netzwerkschnittstelle,
	eindeutig sein.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="carp-10x"></a>33.11.2. <acronym class="acronym">CARP</acronym> mit FreeBSD 10 (und neuer)
        benutzen</h3></div></div></div><p>Unterstützung für <acronym class="acronym">CARP</acronym> erhalten Sie
	durch das Laden des Kernelmoduls <code class="filename">carp.ko</code>
	in <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">carp_load="YES"</pre><p>Das <acronym class="acronym">CARP</acronym>-Modul kann auch, wie in <a class="xref" href="kernelconfig.html" title="Kapitel 9. Konfiguration des FreeBSD-Kernels">Kapitel 9, <em>Konfiguration des FreeBSD-Kernels</em></a> beschrieben, direkt in den FreeBSD
	Kernel eingebunden werden:</p><pre class="programlisting">device  carp</pre><p>Hostname, <acronym class="acronym">IP</acronym>-Management-Adresse,
	Subnetzmaske, gemeinsame <acronym class="acronym">IP</acronym>-Adresse und
	<acronym class="acronym">VHID</acronym> werden durch das Hinzufügen in
	<code class="filename">/etc/rc.conf</code> gesetzt.  Dieses Beispiel
	ist für <code class="systemitem">hosta.example.org</code>:</p><pre class="programlisting">hostname="hosta.example.org"
ifconfig_em0="inet <code class="systemitem">192.168.1.3</code> netmask 255.255.255.0"
ifconfig_em0_alias0="vhid 1 pass testpass alias <code class="systemitem">192.168.1.50</code>/32"</pre><p>Beispiel für
        <code class="systemitem">hostb.example.org</code>:</p><pre class="programlisting">hostname="hostb.example.org"
ifconfig_em0="inet <code class="systemitem">192.168.1.4</code> netmask 255.255.255.0"
ifconfig_em0_alias0="vhid 2 pass testpass alias <code class="systemitem">192.168.1.51</code>/32"</pre><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Achten Sie unbedingt darauf, dass die durch die Option
	  <code class="option">pass</code> an <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> übergebenen
	  Passwörter auf beiden Systemen identisch sind, da
	  <code class="filename">carp</code>-Geräte nur mit Systemen
	  kommunizieren können, die über ein korrektes Passwort
	  verfügen.</p></div><p>Die dritte Maschine,
	<code class="systemitem">hostc.example.org</code> ist so
	konfiguriert, das sie aktiviert wird, wenn eines der beiden
	zuvor konfigurierten Systeme ausfällt.  Diese Maschine ist mit
	zwei <acronym class="acronym">CARP</acronym> <acronym class="acronym">VHID</acronym>s
	konfiguriert, eine für jede virtuelle
	<acronym class="acronym">IP</acronym>-Adresse der beiden Master-Server.  Die
	Option <code class="option">advskew</code> (<acronym class="acronym">CARP</acronym>
	advertising skew) wird gesetzt, um sicherzustellen, dass sich
	der Backup-Server später ankündigt wie der Master-Server.
	<code class="option">advskew</code> steuert die Rangfolge für den Fall
	das mehrere Backup-Server zur Verfügung stehen.  Passen Sie
	die Konfiguration in <code class="filename">/etc/rc.conf</code>
	an:</p><pre class="programlisting">hostname="hostc.example.org"
ifconfig_em0="inet <code class="systemitem">192.168.1.5</code> netmask 255.255.255.0"
ifconfig_em0_alias0="vhid 1 advskew 100 pass testpass alias <code class="systemitem">192.168.1.50</code>/32"
ifconfig_em1_alias0="vhid 2 advskew 100 pass testpass alias <code class="systemitem">192.168.1.51</code>/32"</pre><p>Durch die zwei konfigurierten <acronym class="acronym">CARP</acronym>
	<acronym class="acronym">VHID</acronym>s ist
	<code class="systemitem">hostc.example.org</code> in der Lage
	festzustellen, wenn einer der Master-Server nicht mehr
	reagiert.  Wenn der Master-Server sich später ankündigt als
	der Backup-Server, übernimmt der Backup-Server die gemeinsame
	<acronym class="acronym">IP</acronym>-Adresse, bis der Master-Server erneut
	verfügbar ist.</p><p><span class="foreignphrase"><em class="foreignphrase">Preemption</em></span> ist
	standardmäßig deaktiviert.  Wird
	<span class="foreignphrase"><em class="foreignphrase">Preemption</em></span> aktiviert, kann es
	vorkommen, dass <code class="systemitem">hostc.example.org</code> die
	virtuelle <acronym class="acronym">IP</acronym>-Adresse nicht wieder an den
	Master-Server zurückgibt.  Der Administrator kann jedoch den
	Backup-Server dazu zwingen, die übernommene
	<acronym class="acronym">IP</acronym>-Adresse wieder an den Master-Server
	zurückzugeben:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig em0 vhid 1 state
backup</code></strong></pre><p>An dieser Stelle muss entweder das Netzwerk neu gestartet,
	oder die Maschine neu gebootet werden, um
	<acronym class="acronym">CARP</acronym> zu aktivieren.</p><p>Die Funktionalität von <acronym class="acronym">CARP</acronym> kann, wie
	in der Manualpage <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=carp&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">carp</span>(4)</span></a> beschrieben, über verschiedene
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> Parameter kontrolliert werden.  Mit dem Einsatz
	von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> können weitere Aktionen zu
	<acronym class="acronym">CARP</acronym>-Ereignissen ausgelöst werden.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="carp-9x"></a>33.11.3. <acronym class="acronym">CARP</acronym> mit FreeBSD 9 (und älter)
        benutzen</h3></div></div></div><p>Unterstützung für <acronym class="acronym">CARP</acronym> erhalten Sie
	durch das Laden des Kernelmoduls <code class="filename">carp.ko</code>
	in <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">if_carp_load="YES"</pre><p><acronym class="acronym">CARP</acronym> kann auch direkt in den Kernel
	eingebunden werden.  Diese Prozedur wird in <a class="xref" href="kernelconfig.html" title="Kapitel 9. Konfiguration des FreeBSD-Kernels">Kapitel 9, <em>Konfiguration des FreeBSD-Kernels</em></a> beschrieben:</p><pre class="programlisting">device    carp</pre><p>Die <acronym class="acronym">CARP</acronym>-Schnittstellen selbst können
	mittels <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> erstellt werden:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig carp0
create</code></strong></pre><p>Konfigurieren Sie Hostnamen,
	<acronym class="acronym">IP</acronym>-Management-Adresse, die gemeinsam
	genutzte <acronym class="acronym">IP</acronym>-Adresse und die
	<acronym class="acronym">VHID</acronym>, indem Sie die erforderlichen Zeilen
	in <code class="filename">/etc/rc.conf</code> hinzufügen.  Hierzu ein
	Beispiel für
	<code class="systemitem">hosta.example.org</code>:</p><pre class="programlisting">hostname="hosta.example.org"
ifconfig_fxp0="inet <code class="systemitem">192.168.1.3</code> netmask 255.255.255.0"
cloned_interfaces="carp0"
ifconfig_carp0="vhid 1 pass testpass <code class="systemitem">192.168.1.50</code>/24"</pre><p>Beispiel für
	<code class="systemitem">hostb.example.org</code>:</p><pre class="programlisting">hostname="hostb.example.org"
ifconfig_fxp0="inet <code class="systemitem">192.168.1.4</code> netmask 255.255.255.0"
cloned_interfaces="carp0"
ifconfig_carp0="vhid 2 pass testpass <code class="systemitem">192.168.1.51</code>/24"</pre><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="foreignphrase"><em class="foreignphrase">Preemption</em></span> ist im GENERIC
	  FreeBSD Kernel deaktiviert.  Haben Sie jedoch
	  <span class="foreignphrase"><em class="foreignphrase">Preemption</em></span> in einem
	  angepassten Kernel aktiviert, dass
	  <code class="systemitem">hostc.example.org</code> die virtuelle
	  <acronym class="acronym">IP</acronym>-Adresse nicht wieder an den
	  Master-Server zurückgibt.  Der Administrator kann jedoch den
	  Backup-Server dazu zwingen, die übernommene
	  <acronym class="acronym">IP</acronym>-Adresse wieder an den Master-Server
	  zurückzugeben:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig carp0 down &amp;&amp; ifconfig carp0 up</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">Dieser Befehl muss auf dem
	  <code class="filename">carp</code>-Gerät ausgeführt werden, dass dem
	  betroffenen System zugeordnet ist.</p></div><p>An dieser Stelle muss entweder das Netzwerk neu gestartet,
	oder die Maschine neu gebootet werden, um
	<acronym class="acronym">CARP</acronym> zu aktivieren.</p><p>Die Funktionalität von <acronym class="acronym">CARP</acronym> kann, wie
	in der Manualpage <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=carp&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">carp</span>(4)</span></a> beschrieben, über verschiedene
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> Parameter kontrolliert werden.  Mit dem Einsatz
	von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devd</span>(8)</span></a> können weitere Aktionen zu
	<acronym class="acronym">CARP</acronym>-Ereignissen ausgelöst werden.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-ipv6.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="appendices.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">33.10. IPv6 &#8211; Internet Protocol Version 6 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> Teil V. Anhang</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>