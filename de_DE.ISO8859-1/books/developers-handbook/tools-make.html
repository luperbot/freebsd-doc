<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>2.5. Make</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Developers' Handbook" /><link rel="up" href="tools.html" title="Kapitel 2. Werkzeuge zur Programmierung" /><link rel="prev" href="tools-compiling.html" title="2.4. Kompilieren mit dem cc" /><link rel="next" href="debugging.html" title="2.6. Debuggen" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2.5. Make</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="tools-compiling.html">Zurück</a> </td><th width="60%" align="center">Kapitel 2. Werkzeuge zur Programmierung</th><td width="20%" align="right"> <a accesskey="n" href="debugging.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="tools-make"></a>2.5. Make</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64612048"></a>2.5.1. Was ist <code class="command">make</code>?</h3></div></div></div><p>Wenn Sie an einem einfachen Programm mit nur einer oder
	zwei Quelltextdateien arbeiten, ist die Eingabe von</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc file1.c file2.c</code></strong></pre><p>zwar nicht aufwendig, wird aber mit zunehmender Anzahl
	der Quelltextdateien sehr lästig&#8212;und auch das
	Kompilieren kann eine Weile dauern.</p><p>Eine Möglichkeit dies zu umgehen besteht in der
	Verwendung von Objektdateien, wobei man nur die
	Quelltextdateien neu kompiliert, die verändert wurden. So
	könnten wir etwa folgendes erhalten:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc file1.o file2.o</code></strong> &#8230; <strong class="userinput"><code>file37.c</code></strong> &#8230;</pre><p>falls wir seit dem letzten Kompiliervorgang nur die Datei
	<code class="filename">file37.c</code> verändert haben. Dadurch
	könnte der Kompiliervorgang um einiges beschleunigt
	werden, es muß jedoch immer noch alles von Hand
	eingegeben werden.</p><p>Oder wir könnten uns ein Shell Skript schreiben.
	Dieses würde jedoch alles immer wieder neu kompilieren,
	was bei einem großen Projekt sehr ineffizient
	wäre.</p><p>Was ist, wenn wir hunderte von Quelltextdateien
	hätten? Was ist, wenn wir in einem Team mit anderen
	Leuten arbeiten würden, die vergessen uns Bescheid zu
	sagen, falls sie eine der Quelltextdateien verändert
	haben, die wir ebenfalls benutzen?</p><p>Vielleicht könnten wir beide Lösungen
	kombinieren und etwas wie ein Shell Skript schreiben, welches
	eine Art magische Regel enthalten würde, die feststellt,
	welche Quelltextdateien neu kompiliert werden müssten.
	Alles was wir bräuchten wäre ein Programm, das diese
	Regeln verstehen könnte, da diese Aufgabe etwas zu
	kompliziert für eine Shell ist.</p><p>Dieses Programm heißt <code class="command">make</code>. Es
	liest eine Datei namens <em class="firstterm">makefile</em>,
	welche ihm sagt, wie unterschiedliche Dateien voneinander
	abhängen, und berechnet, welche Dateien neu kompiliert
	werden müssen und welche nicht. Zum Beispiel könnte
	eine Regel etwas sagen wie <span class="quote">&#8222;<span class="quote">wenn
	<code class="filename">fromboz.o</code> älter als
	<code class="filename">fromboz.c</code> ist, bedeutet dies, daß
	jemand die Datei <code class="filename">fromboz.c</code> verändert
	haben muß, und diese daher neu kompiliert werden
	muß.</span>&#8220;</span> Das makefile enthält außerdem
	Regeln die make sagen, <span class="emphasis"><em>wie</em></span> die
	Quelltextdatei neu kompiliert werden muß, was dieses
	Tool noch sehr viel mächtiger macht.</p><p>Makefiles werden normalerweise im selben Verzeichnis
	wie die Quelltextdateien abgelegt, zu denen sie gehören,
	und kann <code class="filename">makefile</code>,
	<code class="filename">Makefile</code> oder
	<code class="filename">MAKEFILE</code> heißen. Die meisten
	Programmierer verwenden den Namen
	<code class="filename">Makefile</code>, da diese Schreibweise
	dafür sorgt, daß die Datei gut lesbar ganz oben in
	der Verzeichnisliste aufgeführt wird.

	<a href="#ftn.idp64690512" class="footnote" id="idp64690512"><sup class="footnote">[6]</sup></a>
      </p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64694992"></a>2.5.2. Beispielhafte Verwendung von <code class="command">make</code></h3></div></div></div><p>Hier ist eine sehr einfache make Datei:</p><pre class="programlisting">foo: foo.c
	cc -o foo foo.c</pre><p>Sie besteht aus zwei Zeilen, einer
	Abhängigkeitszeile und einer Erzeugungszeile.</p><p>Die Abhängigkeitszeile hier besteht aus dem Namen
	des Programms (auch <em class="firstterm">Ziel</em> genannt),
	gefolgt von einem Doppelpunkt und einem Leerzeichen, und
	anschließend dem Namen der Quelltextdatei. Wenn
	<code class="command">make</code> diese Zeile liest überprüft
	es die Existenz von <code class="filename">foo</code>; falls diese
	Datei existiert vergleicht es das Datum der letzten
	Änderung von <code class="filename">foo</code> mit der von
	<code class="filename">foo.c</code>. Falls <code class="filename">foo</code>
	nicht existiert, oder älter als
	<code class="filename">foo.c</code> ist, liest es die Erzeugungszeile
	um herauszufinden, was zu tun ist. Mit anderen Worten, dies
	ist die Regel die festlegt, wann <code class="filename">foo.c</code>
	neu kompiliert werden muß.</p><p>Die Erzeugungszeile beginnt mit einem <span class="token">tab</span>
	(drücken Sie dazu die <span class="keycap"><strong>tab</strong></span>-Taste) gefolgt
	von dem Befehl, mit dem Sie <code class="filename">foo</code> manuell
	erzeugen würden. Wenn <code class="filename">foo</code> veraltet
	ist, oder nicht existiert, führt <code class="command">make</code>
	diesen Befehl aus, um die Datei zu erzeugen. Mit anderen
	Worten, dies ist die Regel die make sagt, wie
	<code class="filename">foo.c</code> kompiliert werden muß.</p><p>Wenn Sie also <strong class="userinput"><code>make</code></strong> eingeben wird
	dieses sicherstellen, daß <code class="filename">foo</code> bzgl.
	Ihrer letzten Änderungen an <code class="filename">foo.c</code>
	auf dem neuesten Stand ist. Dieses Prinzip kann auf
	<code class="filename">Makefile</code>s mit hunderten von
	Zielen&#8212;es ist bei FreeBSD praktisch möglich, das
	gesamte Betriebssystem zu kompilieren, indem man nur
	<strong class="userinput"><code>make world</code></strong> im richtigen Verzeichnis
	eingibt!</p><p>Eine weitere nützliche Eigenschaft der makefiles
	ist, daß die Ziele keine Programme sein müssen. Wir
	könnten zum Beispiel eine make Datei haben, die wie folgt
	aussieht:</p><pre class="programlisting">foo: foo.c
	cc -o foo foo.c

install:
	cp foo /home/me</pre><p>Wir können make sagen welches Ziel wir erzeugt haben
	wollen, indem wir etwas wie folgt eingeben:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>make target</code></strong></pre><p><code class="command">make</code> wird dann nur dieses Ziel
	beachten und alle anderen ignorieren. Wenn wir zum Beispiel
	<strong class="userinput"><code>make foo</code></strong> mit dem obigen makefile
	eingeben, dann wird make das Ziel
	<code class="buildtarget">install</code> ignorieren.</p><p>Wenn wir nur <strong class="userinput"><code>make</code></strong> eingeben wird
	make immer nur nach dem ersten Ziel suchen und danach mit dem
	Suchen aufhören. Wenn wir hier also nur
	<strong class="userinput"><code>make</code></strong> eingegeben hätten, würde
	es nur zu dem Ziel <code class="buildtarget">foo</code> gehen,
	gegebenenfalls <code class="filename">foo</code> neu kompilieren, und
	danach einfach aufhören, ohne das Ziel
	<code class="buildtarget">install</code> zu beachten.</p><p>Beachten Sie, daß das <code class="buildtarget">install</code>-Ziel
	von nichts anderem abhängt! Dies bedeutet, daß der
	Befehl in der nachfolgenden Zeile immer ausgeführt wird,
	wenn wir dieses Ziel mittels <strong class="userinput"><code>make
	install</code></strong> aufrufen. In diesem Fall wird die Datei
	<code class="filename">foo</code> in das Heimatverzeichnis des
	Benutzers kopiert. Diese Vorgehensweise wird häufig bei
	makefiles von Anwendungen benutzt, damit die Anwendung nach
	erfolgreicher Kompilierung in das richtige Verzeichnis
	installiert werden kann.</p><p>Dieser Teil ist etwas schwierig zu erklären. Wenn
	Sie immer noch nicht so richtig verstanden haben, wie
	<code class="command">make</code> funktioniert, wäre es das Beste,
	sie erstellen sich selber ein einfaches Programm wie
	<span class="quote">&#8222;<span class="quote">hello world</span>&#8220;</span> und eine make Datei wie die weiter
	oben angegebene, und experimentieren damit selber ein bißchen
	herum. Als nächstes könnten Sie mehrere
	Quelltextdateien verwenden, oder in Ihrer Quelltextdatei eine
	Header-Datei includen. Der Befehl <code class="command">touch</code> ist
	an dieser Stelle ganz hilfreich&#8212;er verändert das
	Datum einer Datei, ohne das Sie diese extra editieren
	müssen.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64758992"></a>2.5.3. Make und include-Dateien</h3></div></div></div><p>C-Code beginnt häufig mit einer Liste von Dateien,
	die included werden sollen, zum Beispiel stdio.h. Manche
	dieser Dateien sind include-Dateien des Systems, andere
	gehören zum aktuellen Projekt, an dem Sie gerade
	arbeiten:</p><pre class="programlisting">#include &lt;stdio.h&gt;
#include "foo.h"

int main(....</pre><p>Um sicherzustellen, daß diese Datei neu kompiliert
	wird, wenn <code class="filename">foo.h</code> verändert wurde,
	müssen Sie diese Datei Ihrem
	<code class="filename">Makefile</code> hinzufügen:</p><pre class="programlisting">foo: foo.c foo.h</pre><p>Sobald Ihr Projekt größer wird und Sie mehr
	und mehr eigene include-Dateien verwalten müssen wird es
	nur noch sehr schwer möglich sein, die Übersicht
	über alle include-Dateien und Dateien, die von diesen
	abhängen, beizubehalten. Falls Sie eine include-Datei
	verändern, jedoch das erneute Kompilieren aller Dateien,
	die von dieser Datei abhängen, vergessen, werden die
	Folgen verheerend sein. Der <code class="command">gcc</code> besitzt
	eine Option, bei der er Ihre Dateien analysiert und eine Liste
	aller include-Dateien und deren Abhängigkeiten erstellt:
	<code class="option">-MM</code>.</p><p>Wenn Sie das Folgende zu Ihrem Makefile
	hinzufügen:</p><pre class="programlisting">depend:
	gcc -E -MM *.c &gt; .depend</pre><p>und <strong class="userinput"><code>make depend</code></strong> ausführen,
	wird die Datei <code class="filename">.depend</code> mit einer Liste
	von Objekt-Dateien, C-Dateien und den include-Dateien
	auftauchen:</p><pre class="programlisting">foo.o: foo.c foo.h</pre><p>Falls Sie <code class="filename">foo.h</code> verändern
	werden beim nächsten Aufruf von <code class="command">make</code>
	alle Dateien, die von <code class="filename">foo.h</code>
	abhängen, neu kompiliert.</p><p>Vergessen Sie nicht jedes mal
	<code class="command">make depend</code> aufzurufen, wenn Sie eine
	include-Datei zu einer Ihrer Dateien hinzugefügt
	haben.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64788048"></a>2.5.4. FreeBSD Makefiles</h3></div></div></div><p>Makefiles können eher schwierig zu schreiben sein.
	Glücklicherweise kommen BSD-basierende Systeme wie
	FreeBSD mit einigen sehr mächtigen solcher Dateien als
	Teil des Systems daher. Ein sehr gutes Beispiel dafür ist
	das FreeBSD Portssystem. Hier ist der grundlegende Teil eines
	typischen <code class="filename">Makefile</code>s des
	Portssystems:</p><pre class="programlisting">MASTER_SITES=   ftp://freefall.cdrom.com/pub/FreeBSD/LOCAL_PORTS/
DISTFILES=      scheme-microcode+dist-7.3-freebsd.tgz

.include &lt;bsd.port.mk&gt;</pre><p>Wenn wir jetzt in das Verzeichnis dieses Ports wechseln
	und <strong class="userinput"><code>make</code></strong> aufrufen, passiert das
	Folgende:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Es wird überprüft, ob sich der Quelltext
	    für diesen Port bereits auf Ihrem System
	    befindet.</p></li><li class="step"><p>Falls dies nicht der Fall ist wird eine
	    FTP-Verbindung zu der URL in <span class="symbol">MASTER_SITES</span>
	    aufgebaut und der Quelltext heruntergeladen.</p></li><li class="step"><p>Die Checksumme für den Quelltext wird berechnet
	    und mit der schon bekannten und für sicher und gut
	    empfundenen verglichen. Damit wird sichergestellt,
	    daß der Quelltext bei der Übertragung nicht
	    beschädigt wurde.</p></li><li class="step"><p>Sämtliche Anpassungen, die nötig sind,
	    damit der Quelltext unter FreeBSD funktioniert, werden
	    vorgenommen&#8212;dieser Vorgang wird auch
	    <em class="firstterm">patchen</em> genannt.</p></li><li class="step"><p>Alle speziellen Konfigurationen, die am Quelltext
	    nötig sind, werden vorgenommen. (Viele <span class="trademark">UNIX</span>®
	    Programmdistributionen versuchen herauszufinden, auf
	    welcher <span class="trademark">UNIX</span>®-Version sie kompiliert werden sollen und
	    welche optionalen <span class="trademark">UNIX</span>®-Features vorhanden sind&#8212;an
	    dieser Stelle erhalten sie die Informationen im FreeBSD
	    Ports Szenario).</p></li><li class="step"><p>Der Quelltext für das Programm wird kompiliert.
	    Im Endeffekt wechseln wir in das Verzeichnis, in das der
	    Quelltext entpackt wurde, und rufen
	    <code class="command">make</code> auf&#8212;die eigene make-Datei
	    des Programms besitzt die nötigen Informationen um
	    dieses zu bauen.</p></li><li class="step"><p>Wir haben jetzt eine kompilierte Version des
	    Programmes. Wenn wir wollen können wir dieses jetzt
	    testen; wenn wir überzeugt vom Programm sind,
	    können wir <strong class="userinput"><code>make install</code></strong>
	    eingeben. Dadurch werden das Programm sowie alle
	    zugehörigen Dateien an die richtige Stelle kopiert;
	    es wird auch ein Eintrag in der
	    <span class="database">Paketdatenbank</span> erzeugt, sodaß
	    der Port sehr einfach wieder deinstalliert werden kann,
	    falls wir unsere Meinung über dieses geändert
	    haben.</p></li></ol></div><p>Ich glaube jetzt werden Sie mit mir übereinstimmen,
	daß dies ziemlich eindrucksvoll für ein Skript mit
	vier Zeilen ist!</p><p>Das Geheimnis liegt in der letzten Zeile, die
	<code class="command">make</code> anweist, in das makefile des Systems
	mit dem Namen <code class="filename">bsd.port.mk</code> zu sehen. Man
	kann diese Zeile zwar leicht übersehen, aber hierher
	kommt all das klevere Zeugs&#8212;jemand hat ein makefile
	geschrieben, welches <code class="command">make</code> anweist, alle
	weiter oben beschriebenen Schritte durchzuführen (neben
	vielen weiteren Dingen, die ich nicht angesprochen habe,
	einschließlich der Behandlung sämtlicher Fehler,
	die auftreten könnten) und jeder kann darauf
	zurückgreifen, indem er eine einzige Zeile in seine
	eigene make-Datei einfügt!</p><p>Falls Sie einen Blick in die makefiles des Systems werfen
	möchten, finden Sie diese in
	<code class="filename">/usr/share/mk</code>. Es ist aber wahrscheinlich
	besser, wenn Sie damit noch warten, bis Sie ein bißchen mehr
	Praxiserfahrung mit makefiles gesammelt haben, da die dortigen
	makefiles sehr kompliziert sind (und wenn Sie sich diese
	ansehen sollten Sie besser eine Kanne starken Kaffee
	griffbereit haben!)</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64841040"></a>2.5.5. Fortgeschrittene Verwendung von
	<code class="command">make</code></h3></div></div></div><p><code class="command">Make</code> ist ein sehr mächtiges
	Werkzeug und kann noch sehr viel mehr als die gezeigten
	einfachen Beispiele weiter oben. Bedauerlicherweise gibt es
	mehrere verschiedene Versionen von <code class="command">make</code>,
	und sie alle unterscheiden sich beträchtlich voneinander.
	Der beste Weg herauszufinden was sie können ist
	wahrscheinlich deren Dokumentation zu lesen&#8212;hoffentlich
	hat diese Einführung Ihnen genügend Grundkenntnisse
	vermitteln können, damit Sie dies tun können.</p><p>Die Version von make, die in FreeBSD enthalten ist, ist
	<span class="application">Berkeley make</span>; es gibt eine
	Anleitung dazu in
	<code class="filename">/usr/share/doc/psd/12.make</code>. Um sich diese
	anzusehen, müssen Sie</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>zmore paper.ascii.gz</code></strong></pre><p>in diesem Verzeichnis ausführen.</p><p>Viele Anwendungen in den Ports verwenden
	<span class="application">GNU make</span>, welches einen sehr guten
	Satz an <span class="quote">&#8222;<span class="quote">info</span>&#8220;</span>-Seiten mitbringt. Falls Sie
	irgendeinen dieser Ports installiert haben wurde
	<span class="application">GNU make</span> automatisch als
	<code class="command">gmake</code> mit installiert. Es ist auch als
	eigenständiger Port und Paket verfügbar.</p><p>Um sich die Info-Seiten für
	<span class="application">GNU make</span> anzusehen müssen Sie
	die Datei <code class="filename">dir</code> in
	<code class="filename">/usr/local/info</code> um einen entsprechenden
	Eintrag erweitern. Dies beinhaltet das Einfügen einer
	Zeile wie</p><pre class="programlisting"> * Make: (make).                 The GNU Make utility.</pre><p>in die Datei. Nachdem Sie dies getan haben können
	Sie <strong class="userinput"><code>info</code></strong> eingeben und dann den
	Menüeintrag <span class="guimenuitem">make</span>
	auswählen (oder Sie können in
	<span class="application">Emacs</span> die Tastenkombination
	<strong class="userinput"><code>C-h i</code></strong> verwenden).</p></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp64690512" class="footnote"><p><a href="#idp64690512" class="para"><sup class="para">[6] </sup></a>Verwenden Sie nicht <code class="filename">MAKEFILE</code> mit
	    lauter Großbuchstaben, da diese Schreibweise
	    häufig für Dokumentationsdateien wie
	    <code class="filename">README</code> benutzt wird.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="tools-compiling.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="tools.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="debugging.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">2.4. Kompilieren mit dem <code class="command">cc</code> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> 2.6. Debuggen</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>