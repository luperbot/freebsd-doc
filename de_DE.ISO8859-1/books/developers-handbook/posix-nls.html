<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>4.2. Lokalisierte Nachrichten mit POSIX.1 Native Language Support (NLS)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Developers' Handbook" /><link rel="up" href="l10n.html" title="Kapitel 4. Lokalisierung und Internationalisierung - L10N und I18N" /><link rel="prev" href="l10n.html" title="Kapitel 4. Lokalisierung und Internationalisierung - L10N und I18N" /><link rel="next" href="policies.html" title="Kapitel 5. Vorgaben und Richtlinien für das Quelltextverzeichnis" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.2. Lokalisierte Nachrichten mit POSIX.1 Native Language
      Support (NLS)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="l10n.html">Zurück</a> </td><th width="60%" align="center">Kapitel 4. Lokalisierung und Internationalisierung - L10N und
    I18N</th><td width="20%" align="right"> <a accesskey="n" href="policies.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="posix-nls"></a>4.2. Lokalisierte Nachrichten mit POSIX.1 Native Language
      Support (NLS)</h2></div><div><span class="authorgroup">Beigetragen von <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Gábor</span> <span class="surname">Kövesdán</span></span>. </span></div></div></div><p>Über die Basisfunktionen von I18N hinaus, wie das Bereitstellen
      von verschiedenen Eingabecodierungen oder die diversen nationalen
      Konventionen, zum Beispiel die verschiedenen Dezimalpunkte, ist es
      auf einem höheren Level von I18N möglich, die Ausgabe
      von Programmen zu lokalisieren.  Ein Weg dies zu tun besteht in der
      Nutzung der POSIX.1 NLS-Funktionen von FreeBSD.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="nls-catalogs"></a>4.2.1. Organisation von lokalisierten Mitteilungen in Katalog
          Dateien</h3></div></div></div><p>POSIX.1 NLS basiert auf Katalogdateien, welche die lokalisierten
      Mitteilungen in der entsprechenden Codierung enthalten.  Die
      Mitteilungen sind in Sets organisiert und jede Mitteilung ist
      durch eine eindeutige Zahl in dem jeweiligen Set identifiziert.
      Die Katalogdateien werden nach der Lokale, von den jeweiligen
      lokalisierten Mitteilungen, die sie enthalten, gefolgt von der
      <code class="literal">.msg</code> Endung benannt. Zum Beispiel werden die
      ungarischen Mitteilungen für das ISO8859-2  Encoding in
      einer Datei mit dem Dateinamen <code class="filename">hu_HU.ISO8859-2</code>
      gespeichert.</p><p>Diese Katalogdateien sind normale Textdateien, welche die
      nummerierten Mitteilungen enthalten.  Es ist möglich
      Kommentare in die Dateien zu schreiben, indem Sie ein
      <code class="literal">$</code>-Zeichen an den Anfang der Zeile setzen.
      Das Setzen von Grenzen wird ebenfalls durch spezielle Kommentare
      möglich wobei das Schlüsselwort <code class="literal">set</code>
      direkt nach dem <code class="literal">$</code>-Zeichen folgen muss.  Dem
      Schlüsselwort <code class="literal">set</code> folgt dann die Set-Nummer.
      Ein Beispiel:</p><pre class="programlisting">$set 1</pre><p>Der aktuelle Mitteilungseintrag startet mit der
      Mitteilungsnummer gefolgt von der lokalisierten Nachricht.  Die
      bekannten Modifikatoren von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=printf&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">printf</span>(3)</span></a> werden akzeptiert:</p><pre class="programlisting">15 "File not found: %s\n"</pre><p>Die Katalogdateien müssen in binärer Form vorliegen,
      bevor sie von einem Programm benutzt werden können.  Dies wird
      mit dem <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gencat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">gencat</span>(1)</span></a> Tool durchgeführt.  Das erste Argument
      ist der Dateiname des kompilierten Katalogs und die weiteren
      Argumente sind die Eingabekataloge.  Die lokalisierten
      Mitteilungen können auf mehrere Katalogdateien aufgeteilt
      sein.  Danach werden dann alle auf einmal mit dem <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gencat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">gencat</span>(1)</span></a>
      Tool kompiliert.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="nls-using"></a>4.2.2. Nutzung der Katalogdateien im Quellcode</h3></div></div></div><p>Das Benutzen der Katalogdateien ist einfach.  Um die
        relevante Funktion zu nutzen, muss <code class="filename">nl_types.h</code> in die Quelldatei
        eingefügt werden.  Bevor ein Katalog benutzt werden
        kann, muss er mit <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=catopen&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">catopen</span>(3)</span></a> geöffnet werden.
        Die Funktion hat 2 Argumente.  Der erste Parameter ist der
        Name des installierten und kompilierten Katalogs.  Normalerweise
        wird der Name des Programmes, zum Beispiel
        <span class="application">grep</span>, genutzt.  Dieser Name wird
        zum Suchen der kompilierten Katalogdatei benutzt.  Der Aufruf
        von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=catopen&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">catopen</span>(3)</span></a> sucht nach dieser Datei in <code class="filename">/usr/share/nls/locale/catname</code>
        und in <code class="filename">/usr/local/share/nls/locale/catname</code>,
        wobei <code class="literal">locale</code> die gesetzte Lokale und
        <code class="literal">catname</code> der Katalogname ist.  Der zweite
        Parameter ist eine Konstante, die zwei Werte haben kann:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">NL_CAT_LOCALE</code>, hat die Bedeutung,
            dass die benutzte Katalogdatei auf
            <code class="envar">LC_MESSAGES</code> basiert.</p></li><li class="listitem"><p><code class="literal">0</code>, hat die Bedeutung, dass
            <code class="envar">LANG</code> benutzt wird, um die Katalogdatei
            zu öffnen.
          </p></li></ul></div><p>Der <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=catopen&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">catopen</span>(3)</span></a> Aufruf gibt einen Katalogidentifizierer
        vom Type <code class="literal">nl_catd</code> zurück.  Sehen Sie in der
        Manualpage nach, um eine Liste mit möglichen Fehlercodes
        zu erhalten.</p><p>Nach dem Öffnen eines Katalogs, kann <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=catgets&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">catgets</span>(3)</span></a>
        benutzt werden, um Mitteilungen zu erhalten.  Der erste
        Parameter ist der Katalogidentifizierer, der von
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=catopen&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">catopen</span>(3)</span></a> zurück gegeben wurde, das zweite ist die
        Nummer des Sets, das dritte die Nummer der Mitteilung und das
        vierte ist eine Fallbackmitteilung, die angezeigt wird,
        falls die gewünschte Mitteilung in der Katalogdatei
        nicht verfügbar ist.</p><p>Nach der Nutzung der Katalogdatei, muss sie mit dem
        Kommando <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=catclose&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">catclose</span>(3)</span></a>, geschlossen werden.  Es besitzt
        ein Argument, die Katalog ID.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="nls-example"></a>4.2.3. Ein Beispiel aus der Praxis</h3></div></div></div><p>Das folgende Beispiel zeigt einen einfachen Weg wie man
          NLS-Kataloge flexibel nutzen kann.</p><p>Die nachfolgenden Zeilen müssen in eine allgemeine
          Headerdatei, die in allen Quelldateien vorhanden ist, die
          lokalisierte Mitteilungen benutzen, eingefügt werden:</p><pre class="programlisting">
#ifdef WITHOUT_NLS
#define getstr(n)         nlsstr[n]
#else
#include &lt;nl_types.h&gt;

extern nl_catd            catalog;
#define getstr(n)         catgets(catalog, 1, n, nlsstr[n])
#endif

extern char              *nlsstr[];
        </pre><p>Als nächstes fügen Sie die folgenden Zeilen
	  in den globalen Deklarationsteil der Hauptquelldatei ein:</p><pre class="programlisting">
#ifndef WITHOUT_NLS
#include &lt;nl_types.h&gt;
nl_catd   catalog;
#endif

/*
* Default messages to use when NLS is disabled or no catalog
* is found.
*/
char    *nlsstr[] = {
        "",
/* 1*/  "some random message",
/* 2*/  "some other message"
};
	</pre><p>Als nächstes kommt der Code der den Katalog
	  öffnet, liest und schließt:</p><pre class="programlisting">
#ifndef WITHOUT_NLS
 catalog = catopen("myapp", NL_CAT_LOCALE);
#endif

...

printf(getstr(1));

...

#ifndef WITHOUT_NLS
 catclose(catalog);
#endif
	</pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67862608"></a>4.2.3.1. Reduzierung von zu lokalisierenden Zeichenketten</h4></div></div></div><p>Es gibt einen guten Weg, Zeichenketten die lokaliesert
	    werden müssen, durch den Einsatz von
	    <span class="application">libc</span>-Fehlermeldungen zu reduzieren.
	    Dadurch vermeidet man Duplikate und erstellt gleiche Meldungen
	    für häufige Fehlermeldungen, die bei vielen
	    Programmen auftreten können.</p><p>Als erstes ist hier ein Beispiel, dass keine
	    <span class="application">libc</span>-Fehlermeldungen benutzt:</p><pre class="programlisting">
#include &lt;err.h&gt;
...
if (!S_ISDIR(st.st_mode))
 err(1, "argument is not a directory");
	  </pre><p>Dies kann so abgeändert werden, dass eine
	    Fehlermeldung durch Auslesen der Variabel <code class="varname">errno</code>
	    ausgegeben wird.  Die Fehlermeldung wird entsprechend dem Beispiel
	    ausgegeben:</p><pre class="programlisting">
#include &lt;err.h&gt;
#include &lt;errno.h&gt;
...
if (!S_ISDIR(st.st_mode)) {
 errno = ENOTDIR;
 err(1, NULL);
}
	  </pre><p>In diesem Beispiel wurde die benutzerdefinierte
	    Zeichenkette entfernt. Übersetzer haben weniger Arbeit,
	    wenn sie ein Programm lokalisieren und die Benutzer sehen die
	    übliche <span class="quote">&#8222;<span class="quote">"Not a directory"</span>&#8220;</span>
	    Fehlermeldung, wenn dieser Fehler auftritt.  Diese Meldung wird
	    ihnen wahrscheinlich vertraut erscheinen.  Bitte beachten Sie,
	    dass es notwendig ist,
	    <code class="filename">errno.h</code>
	    hinzuzufügen um einen direkten Zugriff auf
	    <code class="varname">errno</code> zu haben.</p><p>Es lohnt sich darauf hinzuweisen, dass es Fälle gibt,
	    in denen <code class="varname">errno</code> automatisch aufgerufen wird,
	    so dass es nicht notwendig ist, es explizit zu tun:</p><pre class="programlisting">
#include &lt;err.h&gt;
...
if ((p = malloc(size)) == NULL)
 err(1, NULL);
	  </pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="nls-mk"></a>4.2.4. Benutzung von <code class="filename">bsd.nls.mk</code></h3></div></div></div><p>Das Benutzen von Katalogdateien setzt einige sich
	  wiederholende Schritte, wie das kompilieren und installieren
	  der Kataloge, voraus.  Um diese Schritte zu vereinfachen,
	  stellt <code class="filename">bsd.nls.mk</code> einige Makros zur
	  Verfügung. Es ist nicht notwendig
	  <code class="filename">bsd.nls.mk</code> explizit hinein zu kopieren,
	  es wird automatisch aus den allgemeinen Makefiles wie
	  <code class="filename">bsd.prog.mk</code> oder
	  <code class="filename">bsd.lib.mk</code> gezogen.</p><p>Normalerweise reicht es, <code class="varname">NLSNAME</code> zu
	  definieren, die den Namen des Kataloges als erstes
	  Argument von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=catopen&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">catopen</span>(3)</span></a> enthalten sollte und die
	  Katalogdateien in <code class="varname">NLS</code> ohne ihre Endung
	  <code class="literal">.msg</code> auflistet.  Hier ist ein Beispiel, das
	  es ermöglicht, NLS mit dem obigen Code zu deaktivieren.
	  Die <code class="varname">WITHOUT_NLS</code> Variable von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>
	  muss so definiert werden, dass das Programm ohne
	  NLS-Unterstützung gebaut wird.</p><pre class="programlisting">
.if !defined(WITHOUT_NLS)
NLS=     es_ES.ISO8859-1
NLS+=    hu_HU.ISO8859-2
NLS+=    pt_BR.ISO8859-1
.else
CFLAGS+= -DWITHOUT_NLS
.endif
	</pre><p>Normalerweise werden die Katalogdateien in dem
	  <code class="filename">nls</code>-Unterverzeichnis
	  abgelegt.  Dies ist der Standard von
	  <code class="filename">bsd.nls.mk</code>.  Es ist möglich, mit der
	  <code class="varname">NLSSRCDIR</code>-Variablen von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> diese zu
	  überschreiben.  Der Standardname der vorkompilierten
	  Katalogdateien folgt den Namenskonventionen, wie oben beschrieben.
	  Er kann durch die <code class="varname">NLSNAME</code>-Variablen
	  überschrieben werden.  Es gibt noch weitere Optionen, um
	  eine Feinabstimmung zur Verarbeitung der Katalogdateien
	  zu erreichen.  Da sie nicht notwendig sind, werden sie hier
	  nicht weiter beschrieben.  Weitere Informationen über
	  <code class="filename">bsd.nls.mk</code> finden Sie in der Datei selbst.
	  Der Text ist kurz und leicht zu verstehen.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="l10n.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="l10n.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="policies.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">Kapitel 4. Lokalisierung und Internationalisierung - L10N und
    I18N </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> Kapitel 5. Vorgaben und Richtlinien für das
    Quelltextverzeichnis</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>