<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>9.5. Erstellen und Installation eines angepassten Kernels</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Das FreeBSD-Handbuch" /><link rel="up" href="kernelconfig.html" title="Kapitel 9. Konfiguration des FreeBSD-Kernels" /><link rel="prev" href="kernelconfig-modules.html" title="9.4. Kerneltreiber, Subsysteme und Module" /><link rel="next" href="kernelconfig-config.html" title="9.6. Die Kernelkonfigurationsdatei" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">9.5. Erstellen und Installation eines angepassten
      Kernels</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kernelconfig-modules.html">Zurück</a> </td><th width="60%" align="center">Kapitel 9. Konfiguration des FreeBSD-Kernels</th><td width="20%" align="right"> <a accesskey="n" href="kernelconfig-config.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-building"></a>9.5. Erstellen und Installation eines angepassten
      Kernels</h2></div></div></div><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Sie benötigen den kompletten Quellcodebaum, um den
	Kernel zu bauen.</p></div><a id="idp73575248" class="indexterm"></a><p>Zuerst erläutern wir die Verzeichnisstruktur, in der der
      Kernel gebaut wird.  Die im Folgenden genannten Verzeichnisse sind
      relativ zum Verzeichnis
      <code class="filename">/usr/src/sys</code>
      angegeben, das Sie auch über den Pfad
      <code class="filename">/sys</code> erreichen können.  Es existieren
      mehrere Unterverzeichnisse, die bestimmte Teile des Kernels
      darstellen, aber die für uns wichtigsten sind
      <code class="filename">arch/conf</code>, in dem
      Sie die Konfigurationsdatei für den angepassten Kernel
      erstellen werden, und <code class="filename">compile</code>, in dem der Kernel
      gebaut wird.  <em class="replaceable"><code>arch</code></em> kann entweder
      <code class="filename">i386</code>,
      <code class="filename">amd64</code>, <code class="filename">ia64</code>,
      <code class="filename">powerpc</code>, <code class="filename">sparc64</code> oder
      <code class="filename">pc98</code> (eine in Japan beliebte Architektur) sein.
      Alles in diesen Verzeichnissen ist nur für die jeweilige
      Architektur relevant.  Der Rest des Codes ist
      maschinenunabhängig und für alle
      Plattformen, auf die FreeBSD portiert werden kann, gleich.
      Beachten Sie die Verzeichnisstruktur, die jedem unterstützten
      Gerät, jedem Dateisystem und jeder Option ein eigenes
      Verzeichnis zuordnet.</p><p>Die Beispiele in diesem Kapitel verwenden ein
      i386-System.  Wenn Sie ein anderes System benutzen,
      passen Sie bitte die Pfade entsprechend der Architektur
      des Systems an.</p><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Falls Sie kein <code class="filename">/usr/src/</code>-Verzeichnis
      vorfinden (oder dieses leer ist), so sind die Quellen nicht
      installiert.  Der einfachste Weg, dies nachzuholen, ist die
      Verwendung von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=csup&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">csup</span>(1)</span></a>, wie in <a class="xref" href="synching.html" title="26.6. Synchronisation der Quellen">Abschnitt 26.6, &#8222;Synchronisation der Quellen&#8220;</a>
      beschrieben ist. Falls nicht vorhanden, sollten Sie auch noch
      einen symbolischen Link auf <code class="filename">/usr/src/sys/</code>
      anlegen:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ln -s /usr/src/sys /sys</code></strong></pre></div><p>Als nächstes wechseln sie in das Verzeichnis
      <code class="filename">arch/conf</code>
      und kopieren die Konfigurationsdatei
      <code class="filename">GENERIC</code> in eine Datei, die den
      Namen Ihres Kernels trägt.  Zum Beispiel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/i386/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC MYKERNEL</code></strong></pre><p>Traditionell ist der Name des Kernels immer in Großbuchstaben.
      Wenn Sie mehrere FreeBSD mit unterschiedlicher Hardware warten, ist
      es nützlich, wenn Sie Konfigurationsdatei nach dem Hostnamen der
      Maschinen benennen.  Im Beispiel verwenden wir den Namen
      <code class="filename">MYKERNEL</code>.</p><div xmlns="" class="tip"><h3 class="admontitle">Tipp: </h3><p xmlns="http://www.w3.org/1999/xhtml">Es ist nicht zu empfehlen die Konfigurationsdatei direkt
        unterhalb von <code class="filename">/usr/src</code> abzuspeichern.
	Wenn Sie Probleme haben, könnten Sie der Versuchung
	erliegen, <code class="filename">/usr/src</code>
	einfach zu löschen und wieder von vorne anzufangen.
	Wenn Sie so vorgehen, werden Sie kurz darauf merken,
	dass Sie soeben Ihre Kernelkonfigurationsdatei
	gelöscht haben.</p><p xmlns="http://www.w3.org/1999/xhtml">Editieren Sie immer eine Kopie von <code class="filename">GENERIC</code>.
	Änderungen an <code class="filename">GENERIC</code> können
	verloren gehen, wenn der
	<a class="link" href="updating-upgrading.html" title="Kapitel 26. FreeBSD aktualisieren">Quellbaum aktualisiert</a>
	wird.</p><p xmlns="http://www.w3.org/1999/xhtml">Sie sollten die Konfigurationsdatei an anderer Stelle
	aufheben und im Verzeichnis
	<code class="filename">i386</code>
	einen Link auf die Datei erstellen.</p><p xmlns="http://www.w3.org/1999/xhtml">Beispiel:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/i386/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /root/kernels</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC /root/kernels/MYKERNEL</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /root/kernels/MYKERNEL</code></strong></pre></div><p>Jetzt editieren Sie
      <code class="filename">MYKERNEL</code> mit einem
      Texteditor Ihres Vertrauens.  Wenn Sie gerade neu anfangen, ist Ihnen
      vielleicht nur der <span class="application">vi</span> Editor bekannt,
      der allerdings zu komplex ist, um hier erklärt zu werden.
      Er wird aber in vielen Büchern aus der <a class="link" href="bibliography.html" title="Anhang B. Bibliografie">
	Bibliographie</a> gut erklärt.  FreeBSD bietet aber auch
      einen leichter zu benutzenden Editor, den <span class="application">ee</span>
      an, den Sie, wenn Sie Anfänger sind, benutzen sollten.  Sie
      können die Kommentare am Anfang der Konfigurationsdatei
      ändern, um die Änderungen gegenüber
      <code class="filename">GENERIC</code> zu dokumentieren.</p><a id="idp73611344" class="indexterm"></a><p>Falls Sie schon einmal einen Kernel unter <span class="trademark">SunOS</span>&#8482; oder einem
      anderen BSD kompiliert haben, werden Sie diese Konfigurationsdatei
      bereits kennen.  Wenn Sie mit einem anderen Betriebssystem wie DOS
      vertraut sind, könnte die <code class="filename">GENERIC</code>
      Konfigurationsdatei Sie verschrecken.  In diesen Fall sollten Sie
      den Beschreibungen im Abschnitt über die
      <a class="link" href="kernelconfig-config.html" title="9.6. Die Kernelkonfigurationsdatei">Konfigurationsdatei</a>
      langsam und vorsichtig folgen.</p><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Wenn Sie die <a class="link" href="updating-upgrading.html" title="Kapitel 26. FreeBSD aktualisieren">FreeBSD Quellen
          synchronisieren</a>, sollten Sie immer, bevor Sie etwas
	verändern, <code class="filename">/usr/src/UPDATING</code>
	durchlesen.  Diese Datei enthält alle wichtigen Informationen,
	die Sie beim Aktualisieren beachten müssen.
        Da <code class="filename">/usr/src/UPDATING</code> immer zu Ihrer Version
	der FreeBSD Quellen passt, sind die Informationen dort genauer,
	als in diesem Handbuch.</p></div><p>Nun müssen Sie die Kernelquellen kompilieren.</p><div class="procedure"><a id="idp73616080"></a><div class="procedure-title">Prozedur 9.1. Den Kernel bauen</div><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Sie benötigen den kompletten Quellcodebaum, um den
	  Kernel zu bauen.</p></div><ol class="procedure" type="1"><li class="step"><p>Wechseln Sie in das Verzeichnis <code class="filename">/usr/src</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong></pre></li><li class="step"><p>Kompilieren Sie den neuen Kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make buildkernel KERNCONF=MYKERNEL</code></strong></pre></li><li class="step"><p>Installieren Sie den neuen Kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make installkernel KERNCONF=MYKERNEL</code></strong></pre></li></ol></div><div xmlns="" class="tip"><h3 class="admontitle">Tipp: </h3><p xmlns="http://www.w3.org/1999/xhtml">In der Voreinstellung werden beim Bau eines angepassten
	Kernels stets <span class="emphasis"><em>alle</em></span> Kernelmodule neu gebaut.
	Wollen Sie Ihren Kernel schneller bauen oder nur bestimmte
	Module bauen, sollten Sie <code class="filename">/etc/make.conf</code>
	anpassen, bevor Sie Ihren Kernel bauen:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">MODULES_OVERRIDE = linux acpi sound/sound sound/driver/ds1 ntfs</pre><p xmlns="http://www.w3.org/1999/xhtml">Wenn Sie diese Variable setzen, werden ausschließlich
	die hier angegebenen Module gebaut (und keine anderen).</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">WITHOUT_MODULES = linux acpi sound ntfs</pre><p xmlns="http://www.w3.org/1999/xhtml">Durch das Setzen dieser Variable werden werden alle
	Module auf oberster Ebene bis auf die angegebenen gebaut.  Weitere
	Variablen, die beim Bau eines Kernels von Interesse sein könnten,
	finden Sie in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">make.conf</span>(5)</span></a>.</p></div><a id="idp73639504" class="indexterm"></a><p>Der neue Kernel wird im Verzeichnis
      <code class="filename">/boot/kernel</code>, genauer
      unter <code class="filename">/boot/kernel/kernel</code> abgelegt,
      während der alte Kernel nach
      <code class="filename">/boot/kernel.old/kernel</code> verschoben wird.
      Um den neuen Kernel zu benutzen, sollten Sie Ihren Rechner
      jetzt neu starten.  Falls etwas schief geht, sehen Sie
      bitte in dem Abschnitt zur <a class="link" href="kernelconfig-trouble.html" title="9.7. Wenn etwas schiefgeht">
      Fehlersuche</a> am Ende dieses Kapitels nach.  Dort sollten Sie
      auch unbedingt den Abschnitt lesen, der erklärt, was zu tun
      ist, <a class="link" href="kernelconfig-trouble.html#kernelconfig-noboot">wenn der neue Kernel nicht
      startet</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Im Verzeichnis <code class="filename">/boot</code> werden andere
	Dateien, die zum Systemstart benötigt werden, wie der
	Boot-Loader (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>) und dessen Konfiguration, abgelegt.
	Module von Fremdherstellern oder angepasste Module
	werden in <code class="filename">/boot/kernel</code>
	abgelegt.  Beachten Sie bitte, dass diese Module immer
	zu dem verwendeten Kernel passen müssen.  Module,
	die nicht zu dem verwendeten Kernel passen,
	gefährden die Stabilität des Systems.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kernelconfig-modules.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="kernelconfig.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="kernelconfig-config.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">9.4. Kerneltreiber, Subsysteme und Module </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> 9.6. Die Kernelkonfigurationsdatei</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>