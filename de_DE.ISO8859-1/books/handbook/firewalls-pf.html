<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>32.4. Paket Filter (PF) von OpenBSD und ALTQ</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Das FreeBSD-Handbuch" /><link rel="up" href="firewalls.html" title="Kapitel 32. Firewalls" /><link rel="prev" href="firewalls-apps.html" title="32.3. Firewallpakete" /><link rel="next" href="firewalls-ipf.html" title="32.5. Die IPFILTER-Firewall (IPF)" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">32.4. Paket Filter (PF) von OpenBSD und
      <acronym class="acronym">ALTQ</acronym></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="firewalls-apps.html">Zurück</a> </td><th width="60%" align="center">Kapitel 32. Firewalls</th><td width="20%" align="right"> <a accesskey="n" href="firewalls-ipf.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-pf"></a>32.4. Paket Filter (PF) von OpenBSD und
      <acronym class="acronym">ALTQ</acronym></h2></div><div><span class="authorgroup">Revised and updated by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">John</span> <span class="surname">Ferrell</span></span>. </span></div></div></div><a id="idp91098832" class="indexterm"></a><p>Im Juli 2003 wurde <acronym class="acronym">PF</acronym>, die
      Standard-Firewall von OpenBSD, nach FreeBSD portiert und in die
      FreeBSD-Ports-Sammlung aufgenommen.  2004 war <acronym class="acronym">PF</acronym> in
      FreeBSD 5.3 Teil des Basissystems.  Bei <acronym class="acronym">PF</acronym>
      handelt es sich um eine komplette, vollausgestattete Firewall,
      die optional auch <acronym class="acronym">ALTQ</acronym> (Alternatives
      Queuing) unterstützt.  <acronym class="acronym">ALTQ</acronym> bietet Ihnen
      <span class="foreignphrase"><em class="foreignphrase">Quality of Service</em></span>
      (<acronym class="acronym">QoS</acronym>)-Bandbreitenformung.</p><p>Das OpenBSD-Projekt leistet bereits hervorragende
      Dokumentationsarbeit mit der <a class="link" href="http://www.openbsd.org/faq/pf/" target="_top">PF FAQ</a>.  Aus diesem Grund
      konzentriert sich dieser Handbuchabschnitt nur auf diejenigen
      Besonderheiten von <acronym class="acronym">PF</acronym>, die FreeBSD betreffen, sowie ein
      paar allgemeine Informationen hinsichtlich der Verwendung.  Genauere
      Informationen zum Einsatz erhalten Sie in der <a class="link" href="http://www.openbsd.org/faq/pf/" target="_top">PF FAQ</a>.</p><p>Weitere Informationen zu <acronym class="acronym">PF</acronym> für FreeBSD finden
      Sie unter <code class="uri"><a class="uri" href="http://pf4freebsd.love2party.net/" target="_top">http://pf4freebsd.love2party.net/</a></code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91110480"></a>32.4.1. Verwendung der PF-Kernelmodule</h3></div></div></div><p>Um die PF Kernel Module zu laden, fügen Sie folgende
        Zeile in ihre <code class="filename">/etc/rc.conf</code> ein:</p><pre class="programlisting">pf_enable="YES"</pre><p>Danach starten Sie das Startup Script um die Module
        zu laden:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/pf start</code></strong></pre><p>Das PF Modul wird nicht geladen, falls es die Ruleset
        Konfigurationsdatei nicht findet.  Standardmässig befindet
        sich diese Datei in <code class="filename">/etc/pf.conf</code>.  Falls das
        PF Ruleset sich an einem anderen Platz befindet, können Sie das
        durch Hinzufügen einer Zeile ähnlich der folgenden, in
        ihrer <code class="filename">/etc/rc.conf</code> ändern:</p><pre class="programlisting">pf_rules="<em class="replaceable"><code>/path/to/pf.conf</code></em>"</pre><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ein Beispiel für die Datei <code class="filename">pf.conf</code>
		  finden Sie im Verzeichnis <code class="filename">/usr/share/examples/pf/</code>.</p></div><p>Das <acronym class="acronym">PF</acronym>-Modul kann auch manuell über die
        Kommandozeile geladen werden:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload pf.ko</code></strong></pre><p>Protokollierungsfunktionen für PF werden durch das Modul
        <code class="literal">pflog.ko</code> zur Verfügung gestellt und
        können durch folgenden Eintrag in der
        <code class="filename">/etc/rc.conf</code> aktiviert werden:</p><pre class="programlisting">pflog_enable="YES"</pre><p>Danach starten Sie das Startup Script, um das Modul
        zu laden:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/pflog start</code></strong></pre><p>Falls Sie noch weitere Features für
        <acronym class="acronym">PF</acronym> benötigen, müssen Sie diese in den
        Kernel einbauen.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91155536"></a>32.4.2. PF Kernel-Optionen</h3></div></div></div><a id="idp91156176" class="indexterm"></a><a id="idp91157328" class="indexterm"></a><a id="idp91158480" class="indexterm"></a><p>Es ist nicht zwingend nötig, dass Sie
        <acronym class="acronym">PF</acronym>-Unterstützung in den FreeBSD-Kernel
        kompilieren.  Sie werden dies tun müssen, um eine von PFs
        fortgeschritteneren Eigenschaften nutzen zu können, die nicht als
        Kernelmodul verfügbar ist.  Genauer handelt es sich dabei um
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pfsync&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pfsync</span>(4)</span></a>, ein Pseudo-Gerät, welches bestimmte
        Änderungen der <acronym class="acronym">PF</acronym>-Zustandstabelle offenlegt.
        Es kann mit <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=carp&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">carp</span>(4)</span></a> kombiniert werden, um ausfallsichere
        Firewalls mit <acronym class="acronym">PF</acronym> zu realisieren.  Weitere
        Informationen zu <acronym class="acronym">CARP</acronym> erhalten Sie in
        <a class="xref" href="carp.html" title="33.11. CARP - Common Address Redundancy Protocol">Abschnitt 33.11, &#8222;CARP - Common Address Redundancy Protocol&#8220;</a> des Handbuchs.</p><p>Die Kernelkonfigurationsoptionen von <acronym class="acronym">PF</acronym> befinden
        sich in <code class="filename">/usr/src/sys/conf/NOTES</code> und sind im
        Folgenden wiedergegeben:</p><pre class="programlisting">device pf
device pflog
device pfsync</pre><p>Die Option <code class="literal">device pf</code> aktiviert die
        Unterstützung für die <span class="quote">&#8222;<span class="quote">Packet
        Filter</span>&#8220;</span>-Firewall (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pf</span>(4)</span></a>).</p><p>Die Option <code class="literal">device pflog</code> aktiviert das optionale
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pflog&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pflog</span>(4)</span></a>-Pseudonetzwerkgerät, das zum Protokollieren
        des Datenverkehrs über einen <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a>-Deskriptor
        dient.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pflogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pflogd</span>(8)</span></a> ist in der Lage, diese Protokolldateien
        auf Ihre Platte zu speichern.</p><p>Die Option <code class="literal">device pfsync</code> aktiviert das optionale
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pfsync&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pfsync</span>(4)</span></a>-Pseudonetzwerkgerät für die
        Überwachung von <span class="quote">&#8222;<span class="quote">Statusänderungen</span>&#8220;</span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91172560"></a>32.4.3. Verfügbare rc.conf-Optionen</h3></div></div></div><p>Die	folgenden <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>-Einträge konfigurieren
        <acronym class="acronym">PF</acronym> und <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pflog&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pflog</span>(4)</span></a> beim Systemstart:</p><pre class="programlisting">pf_enable="YES"                 # PF aktivieren (Modul, wenn nötig, aktivieren)
pf_rules="/etc/pf.conf"         # Datei mit Regeldefinitionen für pf
pf_flags=""                     # zusätzliche Parameter für den Start von pfctl
pflog_enable="YES"              # starte pflogd(8)
pflog_logfile="/var/log/pflog"  # wo soll pflogd die Protokolldatei speichern
pflog_flags=""                  # zusätzliche Parameter für den Start von pflogd</pre><p>Wenn Sie ein lokales Netzwerk hinter dieser Firewall betreiben
        und Pakete für dessen Rechner weiterleiten oder NAT verwenden
        wollen, benötigen Sie zusätzlich die folgende Option:</p><pre class="programlisting">gateway_enable="YES"            # LAN Gateway aktivieren</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91176784"></a>32.4.4. Filterregeln erstellen</h3></div></div></div><p><acronym class="acronym">PF</acronym> liest seine konfigurierten Regeln aus
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pf.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">pf.conf</span>(5)</span></a> (standardmässig <code class="filename">/etc/pf.conf</code>)
        und modifiziert, verwirft oder lässt Pakete passieren anhand der
        Regeln oder Definitionen, die in dieser Datei gespeichert sind.  FreeBSD
        enthält dazu nach der Installation mehrere Beispieldateien, die
        in <code class="filename">/usr/share/examples/pf/</code> abgelegt sind.
        Für eine ausführliche Behandlung des
        <acronym class="acronym">PF</acronym>-Regelwerks lesen Sie bitte die <a class="link" href="http://www.openbsd.org/faq/pf/" target="_top">PF FAQ</a>.</p><div xmlns="" class="warning"><h3 class="admontitle">Warnung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Beim Lesen der <a class="link" href="http://www.openbsd.org/faq/pf/" target="_top">PF FAQ</a> wollten Sie
          darauf achten, dass verschiedene Versionen von FreeBSD auch
          unterschiedliche Versionen von PF enthalten.
	  FreeBSD 8.<em class="replaceable"><code>X</code></em> (und älter)
          FreeBSD-Versionen benutzen <acronym class="acronym">PF</acronym> aus OpenBSD 4.1.
	  FreeBSD 9.<em class="replaceable"><code>X</code></em> (und neuer) benutzen
	  hingegen <acronym class="acronym">PF</acronym> aus OpenBSD 4.5.</p></div><p>Die <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pf" target="_top">FreeBSD packet filter mailing list</a> ist eine erste Anlaufstelle für
        Fragen zur Konfiguration und dem Einsatz der <acronym class="acronym">PF</acronym>
        Firewall.  Vergessen Sie nicht, vorher die Mailinglistenarchive zu
        durchsuchen, bevor Sie dort eine Frage stellen!</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91188944"></a>32.4.5. Arbeiten mit PF</h3></div></div></div><p>Benutzen Sie <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pfctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pfctl</span>(8)</span></a>, um <acronym class="acronym">PF</acronym> zu steuern.
        Unten finden Sie ein paar nützliche Befehle (lesen Sie auch die
        Manualpage zu <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pfctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pfctl</span>(8)</span></a>, um alle verfügbaren Optionen
        nachzuschlagen):</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Befehl</th><th>Zweck</th></tr></thead><tbody><tr><td><code class="command">pfctl -e</code></td><td>PF aktivieren</td></tr><tr><td><code class="command">pfctl -d</code></td><td>PF deaktivieren</td></tr><tr><td><code class="command">pfctl -F all -f /etc/pf.conf</code></td><td>Alle Filterregeln zurücksetzen (NAT, Filter, Zustand,
                Tabelle, etc.) und erneut aus der Datei
                <code class="filename">/etc/pf.conf</code> auslesen</td></tr><tr><td><code class="command">pfctl -s [ rules | nat |
                states ]</code></td><td>Bericht über die Filterregeln, NAT-Regeln, oder
                Zustandstabellen</td></tr><tr><td><code class="command">pfctl -vnf /etc/pf.conf</code></td><td>überprüft <code class="filename">/etc/pf.conf</code> auf
                Fehler, lädt aber das Regelwerk nicht neu</td></tr></tbody></table></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91206864"></a>32.4.6. <acronym class="acronym">ALTQ</acronym> aktivieren</h3></div></div></div><p><acronym class="acronym">ALTQ</acronym> muss vor der Verwendung in den
        FreeBSD-Kernel kompiliert werden.  Beachten Sie, dass
        <acronym class="acronym">ALTQ</acronym> nicht von allen verfügbaren
        Netzwerkkartentreibern unterstützt wird.  Sehen Sie daher
        zuerst in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=altq&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">altq</span>(4)</span></a> nach, ob Ihre Netzwerkkarte diese
        Funktion unter Ihrer FreeBSD-Version unterstützt.</p><p>Die	folgenden Kerneloptionen aktivieren <acronym class="acronym">ALTQ</acronym>
        sowie alle Zusatzfunktionen:</p><pre class="programlisting">options         ALTQ
options         ALTQ_CBQ        # Class Bases Queuing (CBQ)
options         ALTQ_RED        # Random Early Detection (RED)
options         ALTQ_RIO        # RED In/Out
options         ALTQ_HFSC       # Hierarchical Packet Scheduler (HFSC)
options         ALTQ_PRIQ       # Priority Queuing (PRIQ)
options         ALTQ_NOPCC      # Wird von SMP benötigt</pre><p><code class="literal">options ALTQ</code> aktiviert das
	<acronym class="acronym">ALTQ</acronym>-Framework.</p><p><code class="literal">options ALTQ_CBQ</code> aktiviert das
        <span class="emphasis"><em>Class Based Queuing</em></span> (<acronym class="acronym">CBQ</acronym>).
        <acronym class="acronym">CBQ</acronym> erlaubt es, die Bandbreite einer Verbindung in
        verschiedene Klassen oder Warteschlangen zu unterteilen, um die
        Priorität von Datenpaketen basierend auf Filterregeln zu
        ändern.</p><p><code class="literal">options ALTQ_RED</code> aktiviert
        <span class="emphasis"><em>Random Early Detection</em></span>
        (<acronym class="acronym">RED</acronym>).  <acronym class="acronym">RED</acronym> wird
        zur Vermeidung einer Netzwerkverstopfung verwendet.  Dazu
        ermittelt <acronym class="acronym">RED</acronym> die Größe der
        Warteschlange und vergleicht diesen Wert mit den minimalen
        und maximalen Grenzwerten der Warteschlange.  Ist die
        Warteschlange größer als das erlaubte Maximum,
        werden alle neuen Pakete verworfen.  Getreu seinem Namen
        verwirft <acronym class="acronym">RED</acronym> Pakete unterschiedlicher
        Verbindungen nach dem Zufallsprinzip.</p><p><code class="literal">options ALTQ_RIO</code> aktiviert
        <span class="emphasis"><em>Random Early Detection In and	Out</em></span>.</p><p><code class="literal">options ALTQ_HFSC</code> aktiviert den
        <span class="emphasis"><em>Hierarchical Fair Service Curve</em></span>-Paketplaner.
        Weitere Informationen zu <acronym class="acronym">HFSC</acronym> finden Sie
        unter <code class="uri"><a class="uri" href="http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html" target="_top">http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html</a></code>.</p><p><code class="literal">options ALTQ_PRIQ</code> aktiviert
        <span class="emphasis"><em>Priority Queuing</em></span> (<acronym class="acronym">PRIQ</acronym>).
        <acronym class="acronym">PRIQ</acronym>	lässt Verkehr einer Warteschlange mit
        höherer Priorität zuerst durch.</p><p><code class="literal">options ALTQ_NOPCC</code> aktiviert die
        <acronym class="acronym">SMP</acronym> Unterstützung von
        <acronym class="acronym">ALTQ</acronym>.  Diese Option ist nur auf
        <acronym class="acronym">SMP</acronym>-System erforderlich.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="firewalls-apps.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="firewalls.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="firewalls-ipf.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">32.3. Firewallpakete </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> 32.5. Die IPFILTER-Firewall (IPF)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>