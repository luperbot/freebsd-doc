<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>15.6. TCP-Wrapper</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Das FreeBSD-Handbuch" /><link rel="up" href="security.html" title="Kapitel 15. Sicherheit" /><link rel="prev" href="one-time-passwords.html" title="15.5. Einmalpasswörter" /><link rel="next" href="kerberos5.html" title="15.7. Kerberos5" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">15.6. TCP-Wrapper</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="one-time-passwords.html">Zurück</a> </td><th width="60%" align="center">Kapitel 15. Sicherheit</th><td width="20%" align="right"> <a accesskey="n" href="kerberos5.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="tcpwrappers"></a>15.6. TCP-Wrapper</h2></div><div><span class="authorgroup">Beigetragen von <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp78542288" class="indexterm"></a><p>Wahrscheinlich hat jeder, der <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> kennt,
      schon mal von den TCP-Wrappern gehört.  Die
      wenigsten erkennen den vollen Nutzen der TCP-Wrapper
      in einer Netzumgebung.  Es scheint, dass die meisten
      Leute Netzverbindungen mit einer Firewall absichern
      wollen.  Auch wenn eine Firewall ein mächtiges
      Instrument ist, gibt es Sachen, die eine Firewall
      nicht kann.  Eine Firewall kann beispielsweise keine
      Nachricht an den Verbindungsursprung senden.  Genau
      das und mehr können aber die
      <acronym class="acronym">TCP</acronym>-Wrapper.  Im Folgenden werden
      die Funktionen der <acronym class="acronym">TCP</acronym>-Wrapper
      und Beispiele für deren Konfiguration vorgestellt.</p><p>Die <acronym class="acronym">TCP</acronym>-Wrapper erweitern die
      Steuerungsmöglichkeiten, die <span class="application">inetd</span>
      über die Dienste unter seiner Kontrolle hat.
      Beispielsweise können Verbindungen protokolliert,
      Nachrichten zurückgesandt oder nur interne Verbindungen
      angenommen werden.  Die <acronym class="acronym">TCP</acronym>-Wrapper
      bieten nicht nur eine weitere Sicherheitsschicht, die
      teilweise auch von Firewalls geboten wird, sie bieten
      darüber hinaus Funktionen zur Steuerung von
      Verbindungen, die eine Firewall nicht bietet.</p><p>Die erweiterten Funktionen der
      <acronym class="acronym">TCP</acronym>-Wrapper sind kein Firewall-Ersatz.
      Sie sollten zusammen mit einer Firewall und anderen
      Sicherheitsvorkehrungen eingesetzt werden.  Die
      <acronym class="acronym">TCP</acronym>-Wrapper sind eine weitere
      Sicherheitsschicht zum Schutz eines Systems.</p><p>Da die Wrapper die Funktion von <span class="application">inetd</span>
      erweitern, wird im Folgenden vorausgesetzt, dass Sie den
      Abschnitt über die
      <a class="link" href="network-inetd.html" title="31.2. Der inetd &#8222;Super-Server&#8220;">inetd-Konfiguration</a>
      schon gelesen haben.</p><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Streng genommen handelt es sich bei den von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>
        gestarteten Programmen nicht um <span class="quote">&#8222;<span class="quote">Daemonen</span>&#8220;</span>.  Da
        sich diese Bezeichnung aber eingebürgert hat, wird sie auch
        in diesem Abschnitt verwendet.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78551120"></a>15.6.1. TCP-Wrapper einrichten</h3></div></div></div><p>Um die <acronym class="acronym">TCP</acronym>-Wrapper unter FreeBSD
        zu benutzen, muss nur der <span class="application">inetd</span>
        aus <code class="filename">rc.conf</code> mit den voreingestellten
        Optionen <code class="option">-Ww</code> gestartet werden.
        Die Konfigurationsdatei <code class="filename">/etc/hosts.allow</code>
        darf keine Fehler enthalten; falls doch, werden die
        Fehler mit <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> protokolliert.</p><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Im Gegensatz zu anderen Implementationen der
          <acronym class="acronym">TCP</acronym>-Wrapper wird vom Gebrauch
          der Datei <code class="filename">hosts.deny</code> abgeraten.
          Die Konfiguration sollte sich vollständig in der
          Datei <code class="filename">/etc/hosts.allow</code> befinden.</p></div><p>In der einfachsten Konfiguration werden Dienste
        abhängig vom Inhalt der Datei
        <code class="filename">/etc/hosts.allow</code> erlaubt oder
        gesperrt.  Unter FreeBSD wird in der Voreinstellung
        jeder von <span class="application">inetd</span> gestartete Dienst
        erlaubt.  Sehen wir uns zunächst die Grundkonfiguration
        an.</p><p>Eine Konfigurationszeile ist wie folgt aufgebaut:
        <code class="literal">Dienst : Adresse : Aktion</code>.
        <code class="literal">Dienst</code> ist der von <span class="application">inetd</span>
        gestartete Dienst (auch Daemon genannt).  Die
        <code class="literal">Adresse</code> kann ein gültiger
        Rechnername, eine <acronym class="acronym">IP</acronym>-Adresse oder
        eine IPv6-Adresse in Klammern
        (<code class="literal">[</code> <code class="literal">]</code>) sein.
        Der Wert <code class="literal">allow</code> im Feld
        <code class="literal">Aktion</code> erlaubt Zugriffe, der Wert
        <code class="literal">deny</code> verbietet Zugriffe.
        Die Zeilen in <code class="filename">hosts.allow</code>
        werden für jede Verbindung der Reihe nach
        abgearbeitet.  Trifft eine Zeile auf eine Verbindung
        zu, wird die entsprechende Aktion ausgeführt
        und die Abarbeitung ist beendet.</p><p>Es gibt noch weitere Konfigurationsoptionen, die
        gleich erläutert werden.  Das bisher Gesagte
        reicht, um eine einfache Regel aufzustellen.  Wenn
        Sie einkommende <acronym class="acronym">POP</acronym>3-Verbindungen
        für den Dienst
        <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/mail/qpopper/pkg-descr">mail/qpopper</a>
        erlauben wollen, erweitern Sie
        <code class="filename">hosts.allow</code> um die nachstehende Zeile:</p><pre class="programlisting"># This line is required for POP3 connections:
qpopper : ALL : allow</pre><p>Nachdem Sie die Zeile hinzugefügt haben, muss der
        <span class="application">inetd</span> neu gestartet werden.  Sie
        können dazu das Kommando <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> verwenden
        oder <code class="command">/etc/rc.d/inetd restart</code>
        ausführen.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78575184"></a>15.6.2. Erweiterte Konfiguration der TCP-Wrapper</h3></div></div></div><p>Die <acronym class="acronym">TCP</acronym>-Wrapper besitzen
	weitere Optionen, die bestimmen, wie Verbindungen
	behandelt werden.  In einigen Fällen ist es
	gut, wenn bestimmten Rechnern oder Diensten eine
	Nachricht geschickt wird.  In anderen Fällen
	soll vielleicht der Verbindungsaufbau protokolliert
	oder eine E-Mail an einen Administrator versandt
	werden.  Oder ein Dienst soll nur für das
	lokale Netz bereitstehen.  Dies alles ist mit so genannten
	Wildcards, Metazeichen und der Ausführung externer
	Programme möglich und wird in den nächsten
	zwei Abschnitten erläutert.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78576592"></a>15.6.2.1. Externe Kommandos ausführen</h4></div></div></div><p>Stellen Sie sich vor, eine Verbindung soll
	  verhindert werden und gleichzeitig soll demjenigen,
	  der die Verbindung aufgebaut hat, eine Nachricht
	  geschickt werden.  Auf welche Art müssen
	  die <acronym class="acronym">TCP</acronym>-Wrapper konfiguriert werden?
	  Die Option <code class="option">twist</code> führt beim
	  Verbindungsaufbau ein Kommando aus.  In der Datei
	  <code class="filename">hosts.allow</code> ist ein Beispiel
	  für diese Option enthalten:</p><pre class="programlisting"># Alle anderen Dienste sind geschützt
ALL : ALL \
        : severity auth.info \
        : twist /bin/echo "You are not welcome to use %d from %h."</pre><p>Für jeden Dienst, der nicht vorher in
	  der Datei <code class="filename">hosts.allow</code> konfiguriert
	  wurde, wird die Meldung <span class="quote">&#8222;<span class="quote">You are not allowed to use
	  <code class="literal">daemon</code> from
	  <code class="literal">hostname</code>.</span>&#8220;</span> zurückgegegeben.
	  Dies ist besonders nützlich, wenn Sie die
	  Gegenstelle sofort benachrichtigen wollen, nachdem
	  die Verbindung getrennt wurde.  Beachten Sie, dass
	  der Text der Meldung in Anführungszeichen
	  (<code class="literal">"</code>) stehen <span class="emphasis"><em>muss</em></span>,
	  es gibt keine Ausnahmen zu dieser Regel.</p><div xmlns="" class="warning"><h3 class="admontitle">Warnung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ein so konfigurierter Server ist anfällig
	    für Denial-of-Service-Angriffe.  Ein Angreifer
	    kann die gesperrten Dienste mit Verbindungsanfragen
	    überfluten.</p></div><p>Um einem Denial-of-Service-Angriff zu entgehen,
	  benutzen Sie die Option <code class="option">spawn</code>.
	  Wie die Option <code class="option">twist</code> verbietet die Option
	  <code class="option">spawn</code> die Verbindung und führt
	  externe Kommandos aus.  Allerdings sendet die
	  Option <code class="option">spawn</code> der Gegenstelle
	  keine Rückmeldung.  Sehen Sie sich die
	  nachstehende Konfigurationsdatei an:</p><pre class="programlisting"># Verbindungen von example.com sind gesperrt:
ALL : .example.com \
	: spawn (/bin/echo %a from %h attempted to access %d &gt;&gt; \
	  /var/log/connections.log) \
	: deny</pre><p>Damit sind Verbindungen von der Domain
	  <code class="systemitem">*.example.com</code> gesperrt.
	  Jeder Verbindungsaufbau wird zudem in der Datei
	  <code class="filename">/var/log/connections.log</code>
	  protokolliert.  Das Protokoll enthält den
	  Rechnernamen, die <acronym class="acronym">IP</acronym>-Adresse
	  und den Dienst, der angesprochen wurde.</p><p>In der Konfigurationsdatei wurde beispielsweise
	  das Metazeichen <code class="literal">%a</code> verwendet.  Es gibt weitere
	  Metazeichen, die in der Hilfeseite <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a>
	  beschrieben werden.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78588368"></a>15.6.2.2. Wildcards</h4></div></div></div><p>Bisher verwendeten die Beispiele immer die
	  Wildcard <code class="literal">ALL</code>.  Es gibt andere Wildcards,
	  welche die Funktionalität ein bisschen erweitern.  Die Wildcard
	  <code class="literal">ALL</code> passt beispielsweise auf
	  jeden Dienst, jede Domain oder jede
	  <acronym class="acronym">IP</acronym>-Adresse.  Eine andere
	  Wildcard ist <code class="literal">PARANOID</code>.  Sie passt
	  auf jeden Rechner, dessen <acronym class="acronym">IP</acronym>-Adresse
	  möglicherweise gefälscht ist.  Dies ist dann
	  der Fall, wenn der Verbindungsaufbau von einer
	  <acronym class="acronym">IP</acronym>-Adresse erfolgt, die nicht
	  zu dem übermittelten Rechnernamen passt.  Das folgende
	  Beispiel sollte das ganze etwas klarer werden lassen:
	  </p><pre class="programlisting"># Block possibly spoofed requests to sendmail:
sendmail : PARANOID : deny</pre><p>In diesem Beispiel werden alle Verbindungen zu
	  <code class="command">sendmail</code> verboten, die von einer
	  <acronym class="acronym">IP</acronym>-Adresse ausgehen, die nicht zum
	  Rechnernamen passt.</p><div xmlns="" class="caution"><h3 class="admontitle">Achtung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Die Wildcard <code class="literal">PARANOID</code>
	    kann einen Dienst unbrauchbar machen, wenn der
	    Client oder der Server eine fehlerhafte
	    <acronym class="acronym">DNS</acronym>-Konfiguration besitzt.
	    Seien Sie daher besonders vorsichtig, wenn Sie diese Wildcard
	    in Ihre Konfiguration aufnehmen wollen.</p></div><p>Weiteres über Wildcards und deren Funktion
	  lesen Sie bitte in der Hilfeseite <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a>
	  nach.</p><p>
	  Damit die gezeigten Beispiele funktionieren, müssen
	  Sie die erste Konfigurationszeile in der Datei
	  <code class="filename">hosts.allow</code> auskommentieren.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="one-time-passwords.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="kerberos5.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">15.5. Einmalpasswörter </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> 15.7. <span class="application">Kerberos5</span></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>