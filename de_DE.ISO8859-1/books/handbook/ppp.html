<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>29.3. Kernel-PPP</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Das FreeBSD-Handbuch" /><link rel="up" href="ppp-and-slip.html" title="Kapitel 29. PPP und SLIP" /><link rel="prev" href="userppp.html" title="29.2. User-PPP" /><link rel="next" href="ppp-troubleshoot.html" title="29.4. Probleme bei PPP-Verbindungen" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.3. Kernel-PPP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="userppp.html">Zurück</a> </td><th width="60%" align="center">Kapitel 29. PPP und SLIP</th><td width="20%" align="right"> <a accesskey="n" href="ppp-troubleshoot.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ppp"></a>29.3. Kernel-PPP</h2></div><div><span class="authorgroup">Teile wurden ursprünglich beigetragen von <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Gennady B.</span> <span class="surname">Sorokopud</span></span> und <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Robert</span> <span class="surname">Huff</span></span>. </span></div></div></div><div xmlns="" class="warning"><h3 class="admontitle">Warnung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Der folgende Abschnitt ist ausschließlich
	für FreeBSD 7.X relevant und gültig.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87802960"></a>29.3.1. Einrichtung von Kernel-PPP</h3></div></div></div><a id="idp87803600" class="indexterm"></a><p>Bevor Sie PPP auf Ihrem Computer einrichten, sollten Sie
        dafür sorgen, dass <code class="command">pppd</code> im Verzeichnis <code class="filename">/usr/sbin</code> vorhanden ist und <code class="filename">/etc/ppp</code> existiert.</p><p><code class="command">pppd</code> kann auf zweierlei Weise arbeiten:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Als <span class="quote">&#8222;<span class="quote">Client</span>&#8220;</span> &#8211; Sie möchten
	    Ihren Rechner mit einem Netz verbinden, indem Sie eine
	    serielle PPP-Verbindung aufbauen.</p></li><li class="listitem"><p>Als <span class="quote">&#8222;<span class="quote">Server</span>&#8220;</span><a id="idp87829712" class="indexterm"></a> &#8211; Ihr Rechner ist in
	    ein Netzwerk eingebunden und stellt die PPP-Verbindung
	    für andere Rechner im Netzwerk her.</p></li></ol></div><p>In beiden Fällen werden Sie eine Datei mit den
	benötigten Optionen erstellen müssen
	(<code class="filename">/etc/ppp/options</code> oder,
	wenn mehr als ein Benutzer PPP verwendet,
	<code class="filename">~/.ppprc</code>).</p><p>Sie benötigen außerdem eine Software
	(vorzugsweise <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/comms/kermit/pkg-descr">comms/kermit</a>), mit der
        Sie seriell per Modem wählen und eine Verbindung zu dem
	entfernten Host aufbauen können.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87832912"></a>29.3.2. Verwendung von <code class="command">pppd</code> als Client</h3></div><div><span class="authorgroup">Basierend auf Informationen von <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Trev</span> <span class="surname">Roydhouse</span></span>. </span></div></div></div><a id="idp87835856" class="indexterm"></a><a id="idp87837008" class="indexterm"></a><p>Die folgende Datei <code class="filename">/etc/ppp/options</code>
        kann für einen Verbindungsaufbau mit PPP zu einem Cisco
	Terminalserver verwendet werden.</p><pre class="programlisting">crtscts         # enable hardware flow control
modem           # modem control line
noipdefault     # remote PPP server must supply your IP address
                # if the remote host does not send your IP during IPCP
                # negotiation, remove this option
passive         # wait for LCP packets
domain ppp.foo.com      # put your domain name here

:<em class="replaceable"><code>remote_ip</code></em>      # put the IP of remote PPP host here
                # it will be used to route packets via PPP link
                # if you didn't specified the noipdefault option
                # change this line to <em class="replaceable"><code>local_ip</code></em>:<em class="replaceable"><code>remote_ip</code></em>

defaultroute    # put this if you want that PPP server will be your
                # default router</pre><p>Um eine Verbindung herzustellen, sollten Sie:</p><a id="idp87840208" class="indexterm"></a><a id="idp87840720" class="indexterm"></a><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Mit <span class="application">Kermit</span> (oder einem
	    anderen Modemprogramm) den entfernten Host anwählen
	    und Ihren Benutzernamen sowie Ihr Passwort (oder was
	    sonst nötig ist, um PPP auf dem entfernten Host
	    zu aktivieren) eingeben.</p></li><li class="step"><p><span class="application">Kermit</span> beenden
	    (ohne die Verbindung abzubrechen).</p></li><li class="step"><p>Folgendes eingeben:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/sbin/pppd /dev/tty01 19200</code></strong></pre><p>Achten Sie darauf, dass sie eine geeignete Geschwindigkeit
	    wählen und das richtige Device verwenden.</p></li></ol></div><p>Nun ist Ihr Computer mit Hilfe von PPP verbunden.  Wenn
	die Verbindung nicht funktionieren sollte, können Sie
	die Option <code class="option">debug</code> in die Datei
	<code class="filename">/etc/ppp/options</code> eintragen und die Ausgaben
	auf der Konsole beobachten, um die Fehler zu finden.</p><p>Das folgende Skript <code class="filename">/etc/ppp/pppup</code>
	führt alle 3 Schritte automatisch aus:</p><pre class="programlisting">#!/bin/sh
pgrep -l pppd
pid=`pgrep pppd`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
pgrep -l kermit
pid=`pgrep kermit`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.dial
pppd /dev/tty01 19200</pre><a id="idp87848272" class="indexterm"></a><p><code class="filename">/etc/ppp/kermit.dial</code> ist
	ein <span class="application">Kermit</span>-Skript
	das den Einwählvorgang und alle notwendigen Autorisationen auf
	dem entfernten Host durchführt (ein Beispiel für ein
	solches Skript ist im Anhang zu diesem Dokument zu finden).</p><p>Verwenden Sie das folgende Skript
	<code class="filename">/etc/ppp/pppdown</code>, um die PPP-Verbindung
	abzubrechen:</p><pre class="programlisting">#!/bin/sh
pid=`pgrep pppd`
if [ X${pid} != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill -TERM ${pid}
fi

pgrep -l kermit
pid=`pgrep kermit`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

/sbin/ifconfig ppp0 down
/sbin/ifconfig ppp0 delete
kermit -y /etc/ppp/kermit.hup
/etc/ppp/ppptest</pre><p>Prüfen Sie, ob <span class="application">pppd</span> immer
        noch läuft, indem Sie
        <code class="filename">/usr/etc/ppp/ppptest</code> ausführen.
        Dieses Skript sollte folgendermaßen aussehen:</p><pre class="programlisting">#!/bin/sh
pid=`pgrep pppd`
if [ X${pid} != "X" ] ; then
        echo 'pppd running: PID=' ${pid-NONE}
else
        echo 'No pppd running.'
fi
set -x
netstat -n -I ppp0
ifconfig ppp0</pre><p>Um die Modemverbindung abzubrechen, können Sie das Skript
	<code class="filename">/etc/ppp/kermit.hup</code> verwenden, das Folgendes
	enthalten sollte:</p><pre class="programlisting">set line /dev/tty01	; put your modem device here
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
echo \13
exit</pre><p>Hier ist eine alternative Methode, bei der <code class="command">chat</code>
	an Stelle von <span class="application">Kermit</span> eingesetzt wird:</p><p>Die folgenden beiden Dateien reichen aus, um eine
        Verbindung über <code class="command">pppd</code> herzustellen.</p><p><code class="filename">/etc/ppp/options</code>:</p><pre class="programlisting">/dev/cuad1 115200

crtscts		# enable hardware flow control
modem		# modem control line
connect "/usr/bin/chat -f /etc/ppp/login.chat.script"
noipdefault	# remote PPP serve must supply your IP address
	        # if the remote host doesn't send your IP during
                # IPCP negotiation, remove this option
passive         # wait for LCP packets
domain &lt;your.domain&gt;	# put your domain name here

:		# put the IP of remote PPP host here
	        # it will be used to route packets via PPP link
                # if you didn't specified the noipdefault option
                # change this line to <em class="replaceable"><code>local_ip</code></em>:<em class="replaceable"><code>remote_ip</code></em>;

defaultroute	# put this if you want that PPP server will be
	        # your default router</pre><p><code class="filename">/etc/ppp/login.chat.script</code>:</p><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Die folgenden Angaben sollten in einer Zeile stehen.</p></div><pre class="programlisting">ABORT BUSY ABORT 'NO CARRIER' "" AT OK ATDT<em class="replaceable"><code>phone.number</code></em>
  CONNECT "" TIMEOUT 10 ogin:-\\r-ogin: <em class="replaceable"><code>login-id</code></em>
  TIMEOUT 5 sword: <em class="replaceable"><code>password</code></em></pre><p>Wenn diese Dateien richtig installiert und modifiziert sind,
	müssen Sie <code class="command">pppd</code>, nur noch wie folgt
	starten:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pppd</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87866448"></a>29.3.3. Verwendung von <code class="command">pppd</code> als Server</h3></div></div></div><p><code class="filename">/etc/ppp/options</code> sollte etwa Folgendes
	enthalten:</p><pre class="programlisting">crtscts                         # Hardware flow control
netmask 255.255.255.0           # netmask (not required)
192.114.208.20:192.114.208.165  # IP's of local and remote hosts
                                # local ip must be different from one
                                # you assigned to the Ethernet (or other)
                                # interface on your machine.
                                # remote IP is IP address that will be
                                # assigned to the remote machine
domain ppp.foo.com              # your domain
passive                         # wait for LCP
modem                           # modem line</pre><p>Das folgende Skript <code class="filename">/etc/ppp/pppserv</code>
	lässt <span class="application">pppd</span> als Server zu arbeiten:</p><pre class="programlisting">#!/bin/sh
pgrep -l pppd
pid=`pgrep pppd`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
pgrep -l kermit
pid=`pgrep kermit`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

# reset ppp interface
ifconfig ppp0 down
ifconfig ppp0 delete

# enable autoanswer mode
kermit -y /etc/ppp/kermit.ans

# run ppp
pppd /dev/tty01 19200</pre><p>Verwenden Sie das Skript<code class="filename">/etc/ppp/pppservdown</code>,
	um den Server zu beenden:</p><pre class="programlisting">#!/bin/sh
pgrep -l pppd
pid=`pgrep pppd`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
pgrep -l kermit
pid=`pgrep kermit`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi
ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.noans</pre><p>Mit dem <span class="application">Kermit</span>-Skript
	(<code class="filename">/etc/ppp/kermit.ans</code>) lässt sich
	die Funktion Ihres Modems, automatisch zu antworten, ein- bzw.
	ausschalten.  Es sollte folgendermaßen aussehen:</p><pre class="programlisting">set line /dev/tty01
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
inp 5 OK
echo \13
out ATS0=1\13   ; change this to out ATS0=0\13 if you want to disable
                ; autoanswer mode
inp 5 OK
echo \13
exit</pre><p>Ein Skript namens <code class="filename">/etc/ppp/kermit.dial</code> wird
	für die Einwahl und Authentifizierung am entfernten Host verwendet.
	Sie müssen es noch an Ihre lokalen Gegebenheiten anpassen.
	Geben Sie in diesem Skript Ihren Benutzernamen und Ihr Passwort ein.
	In Abhängigkeit von der Reaktion Ihres Modems und des
	entfernten Hosts, werden Sie auch noch die <code class="literal">input</code>
	Anweisungen verändern müssen.</p><pre class="programlisting">;
; put the com line attached to the modem here:
;
set line /dev/tty01
;
; put the modem speed here:
;
set speed 19200
set file type binary            ; full 8 bit file xfer
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none
set modem hayes
set dial hangup off
set carrier auto                ; Then SET CARRIER if necessary,
set dial display on             ; Then SET DIAL if necessary,
set input echo on
set input timeout proceed
set input case ignore
def \%x 0                       ; login prompt counter
goto slhup

:slcmd                          ; put the modem in command mode
echo Put the modem in command mode.
clear                           ; Clear unread characters from input buffer
pause 1
output +++                      ; hayes escape sequence
input 1 OK\13\10                ; wait for OK
if success goto slhup
output \13
pause 1
output at\13
input 1 OK\13\10
if fail goto slcmd              ; if modem doesn't answer OK, try again

:slhup                          ; hang up the phone
clear                           ; Clear unread characters from input buffer
pause 1
echo Hanging up the phone.
output ath0\13                  ; hayes command for on hook
input 2 OK\13\10
if fail goto slcmd              ; if no OK answer, put modem in command mode

:sldial                         ; dial the number
pause 1
echo Dialing.
output atdt9,550311\13\10               ; put phone number here
assign \%x 0                    ; zero the time counter

:look
clear                           ; Clear unread characters from input buffer
increment \%x                   ; Count the seconds
input 1 {CONNECT }
if success goto sllogin
reinput 1 {NO CARRIER\13\10}
if success goto sldial
reinput 1 {NO DIALTONE\13\10}
if success goto slnodial
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if &lt; \%x 60 goto look
else goto slhup

:sllogin                        ; login
assign \%x 0                    ; zero the time counter
pause 1
echo Looking for login prompt.

:slloop
increment \%x                   ; Count the seconds
clear                           ; Clear unread characters from input buffer
output \13
;
; put your expected login prompt here:
;
input 1 {Username: }
if success goto sluid
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if &lt; \%x 10 goto slloop         ; try 10 times to get a login prompt
else goto slhup                 ; hang up and start again if 10 failures

:sluid
;
; put your userid here:
;
output ppp-login\13
input 1 {Password: }
;
; put your password here:
;
output ppp-password\13
input 1 {Entering SLIP mode.}
echo
quit

:slnodial
echo \7No dialtone.  Check the telephone line!\7
exit 1

; local variables:
; mode: csh
; comment-start: "; "
; comment-start-skip: "; "
; end:</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="userppp.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="ppp-and-slip.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="ppp-troubleshoot.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">29.2. User-PPP </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> 29.4. Probleme bei <acronym class="acronym">PPP</acronym>-Verbindungen</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>