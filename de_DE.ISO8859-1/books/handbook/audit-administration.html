<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>18.5. Administration des Audit-Subsystems</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Das FreeBSD-Handbuch" /><link rel="up" href="audit.html" title="Kapitel 18. Security Event Auditing" /><link rel="prev" href="audit-config.html" title="18.4. Die Konfiguration des Audit" /><link rel="next" href="disks.html" title="Kapitel 19. Speichermedien" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">18.5. Administration des Audit-Subsystems</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="audit-config.html">Zurück</a> </td><th width="60%" align="center">Kapitel 18. Security Event Auditing</th><td width="20%" align="right"> <a accesskey="n" href="disks.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="audit-administration"></a>18.5. Administration des Audit-Subsystems</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80660688"></a>18.5.1. Audit-Pfade betrachten</h3></div></div></div><p>Audit-Pfade werden im binären BSM-Format
	gespeichert, daher benötigen Sie spezielle Werkzeuge, um
	derartige Dateien zu ändern oder Sie in Textdateien zu
	konvertieren. Der
	Befehl <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=praudit&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">praudit</span>(1)</span></a> wandelt alle Pfad-Dateien in ein
	einfaches Textformat um. Der Befehl <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=auditreduce&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">auditreduce</span>(1)</span></a> kann
	genutzt werden, um die Pfad-Dateien für Analyse, Ausdruck,
	Archivierung oder andere Zwecke zu reduzieren.  Eine Reihe von
	Auswahl-Parametern werden von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=auditreduce&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">auditreduce</span>(1)</span></a> unterstützt,
	einschliesslich Ereignistyp, Ereignisklasse, Benutzer, Datum
	oder Uhrzeit des Ereignisses und den Dateipfad oder das
	Objekt, mit dem gearbeitet wurde.</p><p>Das Dienstprogramm <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=praudit&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">praudit</span>(1)</span></a> schreibt zum Beispiel
	den gesamten Inhalt einer angegebenen Audit-Protokolldatei in
	eine simple Textdatei:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>praudit /var/audit/AUDITFILE</code></strong></pre><p><code class="filename"><em class="replaceable"><code>AUDITFILE</code></em></code>
	ist hier die zu schreibende Protokolldatei.</p><p>Audit-Pfade bestehen aus einer Reihe von Datensätzen, die
	wiederum aus Kürzeln (token) gebildet werden, die von
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=praudit&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">praudit</span>(1)</span></a> fortlaufend zeilenweise ausgegeben werden.
	Jedes Kürzel ist von einem bestimmten Typ, z.B.  enthält
	<code class="literal">header</code> einen audit-Datensatz-Header oder
	<code class="literal">path</code> enthält einen Dateipfad von einer
	Suche. Hier ein Beispiel eines
	<code class="literal">execve</code>-Ereignisses:</p><pre class="programlisting">header,133,10,execve(2),0,Mon Sep 25 15:58:03 2006, + 384 msec
exec arg,finger,doug
path,/usr/bin/finger
attribute,555,root,wheel,90,24918,104944
subject,robert,root,wheel,root,wheel,38439,38032,42086,128.232.9.100
return,success,0
trailer,133</pre><p>Dieser Audit stellt einen erfolgreichen
	<code class="literal">execve</code>-Aufruf dar, in welchem der Befehl
	<code class="literal">finger doug</code> ausgeführt wurde. Das
	Kürzel des Argumentes enthält die Befehlszeile,
	welche die Shell an den Kernel weiterleitet. Das Kürzel
	<code class="literal">path</code> enthält den Pfad zur
	ausführbaren Datei (wie vom Kernel wahrgenommen). Das
	Kürzel <code class="literal">attribute</code> beschreibt die
	Binärdatei (insbesondere den Datei-Modus, der genutzt
	werden kann, um zu bestimmen, ob setuid auf die Applikation
	angewendet wurde). Das Kürzel <code class="literal">subject</code>
	beschreibt den untergeordneten Prozess und speichert daher in
	Aufeinanderfolge Audit-Benutzer-ID, effektive Benutzer-ID und
	Gruppen-ID, wirkliche Benutzer-ID und Grppen-ID, Process-ID,
	Session- ID, Port-ID und Anmelde-Adresse. Beachten Sie, dass
	Audit-Benutzer-ID und wirkliche Benutzer-ID abweichen: Der Benutzer
	<code class="systemitem">robert</code> wurde zum Benutzer
	<code class="systemitem">root</code>, bevor er diesen Befehl
	ausführte, aber er wird auditiert mit dem
	ursprünglich authentifizierten Benutzer. Schließlich zeigt
	das Kürzel <code class="literal">return</code> die erfolgreiche
	Ausführung an und <code class="literal">trailer</code> schließt
	den Datensatz ab.</p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=praudit&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">praudit</span>(1)</span></a> unterstützt auch die Ausgabe im
	<acronym class="acronym">XML</acronym>-Format (die sie über die Option
	<code class="option">-x</code> auswählen können).</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80683984"></a>18.5.2. Audit-Pfade reduzieren</h3></div></div></div><p>Da Audit-Protokolldateien sehr groß sein können,
	wird ein Administrator höchstwahrscheinlich eine Auswahl
	an Datensätzen verwenden, wie z.B. alle Datensätze
	zu einem bestimmten Benutzer:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>auditreduce -u trhodes /var/audit/AUDITFILE | praudit</code></strong></pre><p>Dies wird alle Audit-Datensätze des Benutzers
	<code class="systemitem">trhodes</code> auswählen,
	die in
	<code class="filename"><em class="replaceable"><code>AUDITFILE</code></em></code>
	gespeichert sind.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80687440"></a>18.5.3. Delegation von Rechten für Audit-Reviews</h3></div></div></div><p>Mitglieder der Gruppe <code class="systemitem">audit</code> haben die Erlaubnis,
	Audit-Pfade in <code class="filename">/var/audit</code> zu lesen;
	standardmässig ist diese Gruppe leer, daher
	kann nur der Benutzer <code class="systemitem">root</code> die Audit-Pfade
	lesen. Benutzer können der Gruppe
	<code class="systemitem">audit</code> hinzugefügt werden, um
	Rechte für Audit-Reviews zu gewähren. Da die
	Fähigkeit, Inhalte von Audit-Protokolldateien zu verfolgen,
	tiefgreifende Einblicke in das Verhalten von Benutzern und
	Prozessen erlaubt, wird empfohlen, dass die Gewährung von
	Rechten für Audit-Reviews mit Bedacht erfolgt.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80694864"></a>18.5.4. Aktive Überwachung mittles Audit-Pipes</h3></div></div></div><p>Audit-Pipes sind nachgebildete (geklonte)
	Pseudo-Geräte im Dateisystem des Gerätes, welche es
	Applikationen erlauben, die laufenden Audit-Datensätze
	anzuzapfen. Dies ist vorrangig für Autoren von Intrusion
	Detection Software und Systemüberwachungsprogrammen von
	Bedeutung. Allerdings ist für den Administrator das
	Audit-Pipe-Gerät ein angenehmer Weg, aktive
	Überwachung zu gestatten, ohne Gefahr von Problemen durch
	Besitzerrechte der Audit-Pfad-Datei oder Unterbrechung des
	Stroms von Ereignissen durch Log-Rotation. Um den laufenden
	Audit-Ereignisstrom zu verfolgen, geben Sie bitte folgende
	Befehlszeile ein:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>praudit /dev/auditpipe</code></strong></pre><p>In der Voreinstellung kann nur der Benutzer
	<code class="systemitem">root</code> auf die
	Audit-Pipe-Geräte-Knotenpunkte zugreifen. Um sie allen
	Mitgliedern der Gruppe <code class="systemitem">audit</code>
	zugänglich zu machen, fügen Sie eine
	<code class="literal">devfs</code>-Regel in
	<code class="filename">devfs.rules</code> hinzu:</p><pre class="programlisting">add path 'auditpipe*' mode 0440 group audit</pre><p>Lesen Sie  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs.rules</span>(5)</span></a> für weitere
	Informationen, wie das devfs-Dateisystem konfiguriert
	wird.</p><div xmlns="" class="warning"><h3 class="admontitle">Warnung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Es ist sehr leicht, Rückmeldungszyklen von
	  Audit-Ereignissen hervorzurufen, in welcher das Betrachten
	  des Resultates eines Audit-Ereignisses in die Erzeugung von
	  mehr Audit-Ereignissen mündet. Wenn zum Beispiel der gesamte
	  Netzwerk-I/O auditiert wird, während <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=praudit&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">praudit</span>(1)</span></a> in
	  einer SSH-Sitzung gestartet wurde, dann wird ein
	  kontinuierlicher, mächtiger Strom von Audit-Ereignissen
	  erzeugt, da jedes ausgegebene Ereignis wiederum neue
	  Ereignisse erzeugt. Es ist anzuraten, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=praudit&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">praudit</span>(1)</span></a> an
	  einem Audit-Pipe-Gerät nur von Sitzungen anzuwenden (ohne
	  feingranuliertes I/O-Auditing), um dies zu vermeiden.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80703056"></a>18.5.5. Rotation von Audit-Pfad-Dateien</h3></div></div></div><p>Audit-Pfade werden nur vom Kernel geschrieben und nur
	vom Audit-Daemon <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a> verwaltet.  Administratoren
	sollten nicht versuchen, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newsyslog.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">newsyslog.conf</span>(5)</span></a> oder andere
	Werkzeuge zu benutzen, um Audit-Protokolldateien direkt zu
	rotieren. Stattdessen sollte das <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=audit&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">audit</span>(8)</span></a>
	Management-Werkzeug benutzt werden, um die Auditierung zu
	beenden, das Audit-System neu zu konfigurieren und eine
	Log-Rotation durchzuführen. Der folgende Befehl veranlasst den
	Audit-Daemon, eine neue Protokolldatei anzulegen und dem
	Kernel zu signalisieren, die neue Datei zu nutzen. Die alte
	Datei wird beendet und umbenannt.  Ab diesem Zeitpunkt kann
	sie vom Administrator bearbeitet werden.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>audit -n</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Warnung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Falls der <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a>-Daemon gegenwärtig nicht läuft,
	  wird dieser Befehl scheitern und eine Fehlermeldung wird
	  ausgegeben.</p></div><p>Das Hinzufügen der folgenden Zeile in
	<code class="filename">/etc/crontab</code> wird die Log-Rotation alle
	zwölf Stunden durch <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> erzwingen:</p><pre class="programlisting">0     */12       *       *       *       root    /usr/sbin/audit -n</pre><p>Die Änderung wird wirksam, sobald Sie die neue
	<code class="filename">/etc/crontab</code> gespeichert haben.</p><p>Die automatische Rotation der Audit-Pfad-Datei in
	Abhängigkeit von der Dateigröße ist möglich
	durch die Angabe der Option <code class="option">filesz</code> in
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=audit_control&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">audit_control</span>(5)</span></a>.  Dieser Vorgang ist im Abschnitt
	Konfigurationsdateien dieses Kapitels beschrieben.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80717392"></a>18.5.6. Komprimierung von Audit-Pfaden</h3></div></div></div><p>Da Audit-Pfad-Dateien sehr groß werden können,
	ist es oft wünschenswert, Pfade zu komprimieren oder
	anderweitig zu archivieren, sobald sie vom Audit-Daemon
	geschlossen wurden. Das Skript
	<code class="filename">audit_warn</code> kann genutzt werden, um
	angepasste Aktionen für eine Vielzahl von audit-bezogenen
	Ereignissen auszuführen, einschliesslich der sauberen
	Beendigung von Audit-Pfaden, wenn diese geschlossen werden.
	Zum Beispiel kann man die folgenden Zeilen in das
	<code class="filename">audit_warn</code>-Skript aufnehmen, um
	Audit-Pfade beim Beenden zu komprimieren:</p><pre class="programlisting">#
# Compress audit trail files on close.
#
if [ "$1" = closefile ]; then
        gzip -9 $2
fi</pre><p>Andere Archivierungsaktivitäten können das
	Kopieren zu einem zentralen Server, die Löschung der alten
	Pfad-Dateien oder die Reduzierung des alten Audit-Pfades durch
	Entfernung nicht benötigter Datensätze
	einschliessen. Das Skript wird nur dann ausgeführt, wenn
	die Audit-Pfad-Dateien sauber beendet wurden, daher wird es
	nicht auf Pfaden laufen, welche durch ein unsauberes Herunterfahren
	des Systems nicht beendet wurden.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="audit-config.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="audit.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="disks.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">18.4. Die Konfiguration des Audit </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> Kapitel 19. Speichermedien</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>