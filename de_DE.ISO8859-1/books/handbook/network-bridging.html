<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>33.6. LAN-Kopplung mit einer Bridge</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Das FreeBSD-Handbuch" /><link rel="up" href="advanced-networking.html" title="Kapitel 33. Weiterführende Netzwerkthemen" /><link rel="prev" href="network-bluetooth.html" title="33.5. Bluetooth" /><link rel="next" href="network-aggregation.html" title="33.7. Link-Aggregation und Failover" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">33.6. LAN-Kopplung mit einer Bridge</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-bluetooth.html">Zurück</a> </td><th width="60%" align="center">Kapitel 33. Weiterführende Netzwerkthemen</th><td width="20%" align="right"> <a accesskey="n" href="network-aggregation.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-bridging"></a>33.6. LAN-Kopplung mit einer Bridge</h2></div><div><span class="authorgroup">Geschrieben von <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Andrew</span> <span class="surname">Thompson</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92936144"></a>33.6.1. Einführung</h3></div></div></div><a id="idp92936784" class="indexterm"></a><a id="idp92937552" class="indexterm"></a><p>Manchmal ist es nützlich, ein physikalisches Netzwerk
	(wie ein Ethernetsegment) in zwei separate Netzwerke
	aufzuteilen, ohne gleich IP-Subnetze zu erzeugen, die über
	einen Router miteinander verbunden sind.  Ein Gerät, das
	zwei Netze auf diese Weise verbindet, wird als
	<span class="emphasis"><em>Bridge</em></span> bezeichnet.  Jedes FreeBSD-System
	mit zwei Netzwerkkarten kann als Bridge fungieren.</p><p>Die Bridge arbeitet, indem sie die MAC Layeradressen
	(Ethernet Adressen) der Geräte in ihren
	Netzwerksegmenten lernt.  Der Verkehr wird nur dann zwischen
	zwei Segmenten weitergeleitet, wenn sich Sender und
	Empfänger in verschiedenen Netzwerksegmenten
	befinden.</p><p>In vielerlei Hinsicht entspricht eine Bridge daher einem
        Ethernet-Switch mit sehr wenigen Ports.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92939984"></a>33.6.2. Situationen, in denen <span class="emphasis"><em>Bridging</em></span>
	angebracht ist</h3></div></div></div><p>Es gibt zahlreiche Situationen, in denen der Einsatz
	einer Bridge sinnvoll ist:</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92941392"></a>33.6.2.1. Verbinden von Netzwerken</h4></div></div></div><p>Die Hauptaufgabe einer Bridge ist die Verbindung von zwei
	  oder mehreren Netzwerksegmenten zu einem gemeinsamen Netzwerk.
	  Es ist oft sinnvoller, eine hostbasierte Bridge anstelle
	  normaler Netzwerkkomponenten (wie Kabelverbindungen),
	  Firewalls oder Pseudonetzwerken über die
	  Schnittstelle einer virtuellen Maschine einzusetzen.
	  Eine Bridge kann außerdem ein drahtloses Gerät mit
	  einem Kabelnetzwerk verbinden.  Diese Fähigkeit der
	  Bridge wird als <span class="foreignphrase"><em class="foreignphrase">HostAP-Modus</em></span>
	  bezeichnet.  Die Bridge agiert in diesem Fall als
	  Access Point für das drahtlose Gerät.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92943056"></a>33.6.2.2. Filtering/Traffic Shaping Firewall</h4></div></div></div><a id="idp92943696" class="indexterm"></a><a id="idp92944464" class="indexterm"></a><p>Häufig kommt es vor, dass Firewallfunktionen
	  benötigt werden, ohne dass Routing oder
	  <span class="foreignphrase"><em class="foreignphrase">Network Adress Translation</em></span>
	  (NAT) verwendet werden soll.</p><p>Ein Beispiel dafür wäre ein kleines Unternehmen,
	  das über DSL oder ISDN an seinen ISP angebunden ist.  Es
	  verfügt über 13 weltweit erreichbare IP-Adressen,
	  sein Netzwerk besteht aus 10 Rechnern.  In dieser Situation
	  ist der Einsatz von Subnetzen sowie einer routerbasierten
	  Firewall schwierig.</p><a id="idp92946384" class="indexterm"></a><a id="idp92947152" class="indexterm"></a><a id="idp92947920" class="indexterm"></a><p>Eine brigdebasierte Firewall kann konfiguriert und in den
	  ISDN/DSL-Downstreampfad ihres Routers eingebunden werden, ohne
	  dass Sie sich um IP-Adressen kümmern müssen.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92949200"></a>33.6.2.3. Netzwerküberwachung</h4></div></div></div><p>Eine Bridge kann zwei Netzwerksegmente miteinander
	  verbinden und danach alle Ethernet-Rahmen überprüfen,
	  die zwischen den beiden Netzwerksegmenten ausgetauscht werden.
	  Dazu verwendet man entweder <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a>/<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a> auf
	  dem Netzgerät der Bridge oder schickt Kopien aller
	  Rahmen an ein zusätzliches Netzgerät (den sogenannten
	  <span class="foreignphrase"><em class="foreignphrase">Span Port</em></span>).</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92952400"></a>33.6.2.4. Layer 2-VPN</h4></div></div></div><p>Zwei Ethernetnetzwerke können über einen IP-Link
	  miteinander verbunden werden, indem Sie die beiden Netzwerke
	  über einen EtherIP-Tunnel koppeln oder eine
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tap&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">tap</span>(4)</span></a>-basierte Lösung wie OpenVPN einsetzen.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92954320"></a>33.6.2.5. Layer 2-Redundanz</h4></div></div></div><p>Die Systeme eines Netzwerks können redundant
	  miteinander verbunden sein.  In diesem Fall verwenden Sie das
	  <span class="foreignphrase"><em class="foreignphrase">Spanning Tree Protocol</em></span>, um
	  redundante Pfade zu blockieren.  Damit ein Ethernetnetzwerk
	  korrekt arbeitet, darf immer nur ein aktiver Pfad zwischen
	  zwei Geräten des Netzwerks existieren.  Aufgabe des
	  Spanning Tree Protocols ist es daher, Schleifen zu entdecken
	  und redundante Links in den Status
	  <span class="emphasis"><em>blockiert</em></span> zu versetzen.  Fällt ein
	  aktiver Link aus, so berechnet das Protokoll einen neuen
	  Pfad.  Dazu wird ein blockierter Pfad in den Status
	  <span class="emphasis"><em>aktiv</em></span> versetzt, damit alle Systeme des
	  Netzwerks wieder miteinander kommunizieren können.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92956752"></a>33.6.3. Kernelkonfiguration</h3></div></div></div><p>Dieser Abschnitt beschreibt nur die
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=if_bridge&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">if_bridge</span>(4)</span></a>-Bridge-Implementierung.  Ein
	Netgraph-Bridge-Treiber ist ebenfalls verfügbar, wird
	hier aber nicht behandelt.  Lesen Sie die Manualpage
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_bridge&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_bridge</span>(4)</span></a>, wenn Sie diesen Treiber einsetzen
	wollen.</p><p>Bei diesem Treiber handelt es sich um ein
	Kernelmodul, das von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> automatisch geladen
	wird, wenn ein Bridge-Interface erzeugt wird.  Alternativ ist
	es aber auch möglich, die Unterstützung für
	den Treiber in Ihren Kernel zu kompilieren.  Dazu fügen
	Sie die Zeile <code class="literal">device if_bridge</code> in Ihre
	Kernelkonfigurationsdatei ein und bauen danach den Kernel
	neu.</p><p>Paketfilter können mit allen Firewallpaketen verwendet
	werden, die das <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pfil&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">pfil</span>(9)</span></a>-Framework benutzen.  Die Firewall
	kann dabei entweder als Kernelmodul geladen oder in den Kernel
	kompiliert werden.</p><p>Eine Bridge kann auch als <span class="foreignphrase"><em class="foreignphrase">Traffic
	Shaper</em></span> verwendet werden, wenn Sie
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=altq&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">altq</span>(4)</span></a> oder <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dummynet&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">dummynet</span>(4)</span></a> einsetzen.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92964688"></a>33.6.4. Die LAN-Kopplung aktivieren</h3></div></div></div><p>Eine Bridge wird durch das Klonen von Schnittstellen
	erzeugt.  Um eine Bridge zu erzeugen, verwenden Sie den Befehl
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.  Ist der Bridge-Treiber nicht in Ihren Kernel
	kompiliert, wird er automatisch geladen.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge create</code></strong>
bridge0
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0</code></strong>
bridge0: flags=8802&lt;BROADCAST,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        id 00:00:00:00:00:00 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:00:00:00:00:00 priority 0 ifcost 0 port 0</pre><p>Im obigen Beispiel wird die Bridge erzeugt und erhält
	automatisch eine zufällig generierte Ethernet-Adresse
	zugewiesen.  Die Parameter <code class="literal">maxaddr</code> sowie
	<code class="literal">timeout</code> legen fest, wie viele MAC-Adressen
	die Bridge in ihrer Forward-Tabelle halten kann beziehungsweise
	wie viele Sekunden jeder Eintrag erhalten bleiben soll, nachdem
	er zuletzt verwendet wurde.  Die restlichen Parameter sind
	für die Konfiguration von Spanning Tree notwendig.</p><p>Im nächsten Schritt werden die Schnittstellen, die
	die Bridge verbinden soll, zugewiesen.  Damit die Bridge
	Datenpakete weiterleiten kann, müssen sowohl die Bridge
	als auch die Schnittstellen (der zu verbindenden
	Netzwerksegmente) aktiviert sein:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm fxp0 addm fxp1 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp0 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp1 up</code></strong></pre><p>Danach ist die Bridge in der Lage, Ethernet-Rahmen zwischen
	den Schnittstellen <code class="filename">fxp0</code> und
	<code class="filename">fxp1</code> weiterzuleiten.  Um diese
	Konfiguration beim Systemstart automatisch zu aktivieren,
	müssen Sie folgende Einträge in die Datei
	<code class="filename">/etc/rc.conf</code> aufnehmen:</p><pre class="programlisting">cloned_interfaces="bridge0"
ifconfig_bridge0="addm fxp0 addm fxp1 up"
ifconfig_fxp0="up"
ifconfig_fxp1="up"</pre><p>Benötigen Sie für die Bridge eine IP-Adresse,
	müssen Sie diese der Schnittstelle der Bridge zuweisen
	(und nicht einer der Schnittstellen der gekoppelten
	Netzwerksegmente).  Dabei können Sie die IP-Adresse
	sowohl statisch als auch dynamisch über DHCP
	zuweisen:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 inet 192.168.0.1/24</code></strong></pre><p>Sie können der Bridge-Schnittstelle auch eine
	IPv6-Adresse zuweisen.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92984528"></a>33.6.5. Firewalls</h3></div></div></div><a id="idp92985168" class="indexterm"></a><p>Nachdem ein Paketfilter aktiviert wurde, können
	Datenpakete, die von den Schnittstellen der gekoppelten
	Netzwerksegmente gesendet und empfangen werden, über
	die Bridge weitergeleitet oder nach bestimmten Regeln
	gefiltert oder auch komplett geblockt werden.  Ist die
	Richtung des Paketflusses wichtig, ist es am besten, eine
	Firewall auf den Schnittstellen der einzelnen
	Netzwerksegmente einzurichten und nicht auf der Bridge
	selbst.</p><p>Eine Bridge verfügt über verschiedene Optionen,
	über die Sie die Weiterleitung von Nicht-IP- und
	ARP-Paketen sowie den Einsatz von Layer 2-Firewalls
	(mit IPFW) steuern können.  Lesen Sie die Manualpage
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=if_bridge&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">if_bridge</span>(4)</span></a>, wenn Sie diese Funktionen
	benötigen.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92987600"></a>33.6.6. Spanning Tree</h3></div></div></div><p>Der Bridge-Treiber implementiert das <span class="foreignphrase"><em class="foreignphrase">Rapid
	Spanning Tree Protocol</em></span> (RSTP oder 802.1w), das
	abwärtskompatibel zum veralteten <span class="foreignphrase"><em class="foreignphrase">Spanning
	Tree Protocol</em></span> (STP) ist.  Spanning Tree
	dient dazu, Schleifen in einer Netzwerktopologie zu entdecken
	und zu entfernen.  RSTP arbeitet dabei schneller als das
	veraltete STP.  RSTP tauscht Informationen mit
	benachbarten Switchen aus, um Pakete korrekt weiterzuleiten
	und eine Schleifenbildung zu verhindern.</p><p>FreeBSD unterstützt die Betriebsmode RSTP sowie STP,
	von denen RSTP als Standardmodus voreingestellt ist.</p><p>Spanning Tree kann auf den Schnittstellen der
	durch die Bridge verbundenen Netzwerksegmente über die
	Option <code class="literal">stp</code> aktiviert werden.  Für eine
	Bridge, die die Schnittstellen <code class="filename">fxp0</code> und
	<code class="filename">fxp1</code> verbindet, aktivieren Sie STP wie
	folgt:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 stp fxp0 stp fxp1</code></strong>
bridge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether d6:cf:d5:a0:94:6d
        id 00:01:02:4b:d4:50 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:01:02:4b:d4:50 priority 32768 ifcost 0 port 0
        member: fxp0 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 3 priority 128 path cost 200000 proto rstp
                role designated state forwarding
        member: fxp1 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role designated state forwarding</pre><p>Diese Bridge hat die Spanning-Tree-ID
	<code class="literal">00:01:02:4b:d4:50</code> und die Priorität
	<code class="literal">32768</code>.  Da diese ID mit der
	<code class="literal">Root-ID</code> identisch ist, handelt es sich um die
	Root-Bridge dieses Netzwerks.</p><p>Auf einer anderen Bridge des Netzwerks ist Spanning Tree
	ebenfalls aktiviert:</p><pre class="screen">bridge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        id 00:13:d4:9a:06:7a priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:01:02:4b:d4:50 priority 32768 ifcost 400000 port 4
        member: fxp0 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role root state forwarding
        member: fxp1 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 5 priority 128 path cost 200000 proto rstp
                role designated state forwarding</pre><p>Die Zeile <code class="literal">root id 00:01:02:4b:d4:50 priority 32768
	ifcost 400000 port 4</code> zeigt an, dass die Root-Bridge wie
	im obigen Beispiel die ID <code class="literal">00:01:02:4b:d4:50</code>
	hat.  Die Pfadkosten hin zur Root-Bridge betragen
	<code class="literal">400000</code>, wobei der Pfad zur Root-Bridge
	über <code class="literal">Port 4</code> geht (der wiederum
	der Schnittstelle <code class="filename">fxp0</code>
	entspricht).</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93001552"></a>33.6.7. Fortgeschrittene Funktionen</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93002192"></a>33.6.7.1. Den Datenfluss rekonstruieren</h4></div></div></div><p>Die Bridge unterstützt den Monitormodus.  Dabei
	  werden alle Pakete verworfen, nachdem sie von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a>
	  verarbeitet wurden.  In diesem Modus erfolgt keine weitere
	  Bearbeitung und auch keine Weiterleitung von Datenpaketen.
	  Es ist daher möglich, die Eingabe von zwei oder mehr
	  Netzwerkschnittstellen in einen einzigen gemeinsamen
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a>-Stream zu vereinen.  Ein solcher Datenstrom
	  ist beispielsweise nützlich, um den Datenverkehr für
	  ""network taps"" zu rekonstruieren, die ihre RX/TX-Signale
	  über verschiedene Schnittstellen senden.</p><p>Um die Eingabe von vier Netzwerkschnittstellen in einzigen
	  gemeinsamen Datenstrom zu vereinen, geben Sie Folgendes
	  ein:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm fxp0 addm fxp1 addm fxp2 addm fxp3 monitor up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tcpdump -i bridge0</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93007184"></a>33.6.7.2. Span Ports</h4></div></div></div><p>Eine Kopie jedes Ethernet-Rahmens, der an der Bridge
	  ankommt, wird über einen festgelegten
	  <span class="foreignphrase"><em class="foreignphrase">Span Port</em></span> verschickt.
	  Auf einer Bridge können
	  beliebig viele Span Ports festgelegt werden.  Wird
	  eine Schnittstelle als Span Port konfiguriert, kann
	  sie nicht mehr als normaler Bridge-Port verwendet werden.
	  Eine derartige Konfiguration ist beispielsweise sinnvoll,
	  um den Datenverkehr, der in einem Netzwerk über die
	  Bridge läuft, auf einen Rechner zu übertragen,
	  der mit einem Span Port der Bridge verbunden
	  ist.</p><p>Um eine Kopie aller Ethernet-Rahmen über die
	  Schnittstelle <code class="filename">fxp4</code> zu verschicken,
	  geben Sie Folgendes ein:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 span fxp4</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93010512"></a>33.6.7.3. Private Schnittstellen</h4></div></div></div><p>Eine private Schnittstelle leitet keine Daten an einen
	  Port weiter, bei dem es sich ebenfalls um eine private
	  Schnittstelle handelt.  Der Datenverkehr wird dabei komplett
	  blockiert, auch Ethernet-Rahmen und ARP-Pakete werden nicht
	  weitergeleitet.  Wollen Sie hingegen nur spezifische
	  Datenpakete blockieren, sollten Sie eine Firewall
	  einsetzen.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93011664"></a>33.6.7.4. Schnittstellen als <span class="foreignphrase"><em class="foreignphrase">sticky</em></span>
	  kennzeichnen</h4></div></div></div><p>Wenn die Schnittstelle eines über eine Bridge
	  verbundenen Netzwerksegments als
	  <span class="foreignphrase"><em class="foreignphrase">sticky</em></span> gekennzeichnet wird,
	  werden alle dynamisch gelernten Adressen als statische Adressen
	  behandelt, sobald sie in den Forward-Cache der Bridge
	  aufgenommen wurden.  Sticky-Einträge werden niemals aus
	  dem Cache entfernt oder ersetzt.  Selbst dann nicht, wenn die
	  Adresse von einer anderen Schnittstelle verwendet wird.  Sie
	  können dadurch die Vorteile statischer Adresseinträge
	  nutzen, ohne die Forward-Tabelle vor dem Einsatz der Bridge
	  mit statischen Einträgen füllen zu müssen.
	  Clients, die sich in einem bestimmten von der Bridge
	  verwalteten Segmente befinden, können dabei nicht in ein
	  anderes Segment wechseln.</p><p>Ein weiteres Beispiel für den Einsatz von
	  Sticky-Adressen wäre die Kombination einer Bridge mit
	  mehreren VLANs, um einen Router zu konfigurieren, der in
	  in der Lage ist, einzelne Kundennetzwerke voneinander zu
	  trennen, ohne IP-Adressbereiche zu verschwenden.  Für das
	  folgende Beispiel nehmen wir an, dass sich der Client
	  <code class="systemitem">CustomerA</code> im VLAN
	  <code class="literal">vlan100</code> und der Client
	  <code class="systemitem">CustomerB</code> im VLAN
	  <code class="literal">vlan101</code> befinden.  Die Bridge hat die
	  IP-Adresse <code class="systemitem">192.168.0.1</code> und ist
	  als Internet-Router konfiguriert.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm vlan100 sticky vlan100 addm vlan101 sticky vlan101</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 inet 192.168.0.1/24</code></strong></pre><p>Beide Clients sehen <code class="systemitem">192.168.0.1</code> als Ihr Default-Gateway.
	  Da der Brücken-Cache <span class="emphasis"><em>sticky</em></span> ist,
	  sind Sie nicht dazu in der Lage, die MAC-Adresse des
	  anderen Kunden zu spoofen und dessen Datenverkehr
	  abzufangen.</p><p>Sie können die Kommunikation zwischen den VLANs
	  vollständig unterbinden, wenn Sie private Schnittstellen
	  (oder eine Firewall) einsetzen:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 private vlan100 private vlan101</code></strong></pre><p>Die Kunden sind nun komplett voneinander isoliert und
	  der komplette <code class="systemitem">/24</code>-Adressbereich
	  kann zugewiesen werden, ohne dass Sie Subnetze einsetzen
	  müssen.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93029840"></a>33.6.7.5. Adressen-Limitierung</h4></div></div></div><p>Die maximale mögliche Anzahl an eindeutigen
	  MAC-Adressen hinter einer Schnittstelle kann festgelegt werden.
	  Sobald das Limit erreicht ist, werden Pakete mit einer
	  unbekannten Quell-Adresse solange verworfen, bis ein
	  existierender Eintrag gelöscht wird oder
	  abläuft.</p><p>Das folgende Beispiel setzt die maximale Anzahl von
	  Netzgeräten für
	  <code class="systemitem">CustomerA</code> für
	  das VLAN <code class="literal">vlan100</code> auf 10.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 ifmaxaddr vlan100 10</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93033168"></a>33.6.7.6. SNMP-Monitoring</h4></div></div></div><p>Die Schnittstelle der Bridge sowie die STP-Parameter
	  können durch den bereits im Basissystem enthaltenen
	  SNMP-Daemon überwacht werden.  Die exportierten
	  Bridge-MIBs entsprechen den IETF-Standards, daher können
	  Sie einen beliebigen SNMP-Client oder ein beliebiges
	  Monitoring-Werkzeug einsetzen, um die benötigten Daten
	  zu erhalten.</p><p>Auf dem Rechner, auf dem die Bridge konfiguriert ist,
	  aktivieren Sie die Zeile
	  <code class="literal">begemotSnmpdModulePath."bridge" = "/usr/lib/snmp_bridge.so"</code>
	  in der Datei <code class="filename">/etc/snmp.config</code> und starten
	  danach den <span class="application">bsnmpd</span>-Daemon.
	  Eventuell benötigen Sie noch weitere
	  Konfigurationsparameter wie Community-Namen und
	  Zugriffslisten.  Die Konfiguration dieser Parameter wird
	  in den Manualpages <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsnmpd&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">bsnmpd</span>(1)</span></a> sowie <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snmp_bridge&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">snmp_bridge</span>(3)</span></a>
	  beschrieben.</p><p>Die folgenden Beispiele verwenden das Softwarepaket
	  <span class="application">Net-SNMP</span> (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/net-snmp/pkg-descr">net-mgmt/net-snmp</a>), um die Bridge
	  abzufragen.  Alternativ können Sie dafür auch den
	  Port <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/bsnmptools/pkg-descr">net-mgmt/bsnmptools</a>
	  einsetzen.  Auf dem SNMP-Client fügen Sie danach die
	  folgenden Zeilen in die Datei
	  <code class="filename">$HOME/.snmp/snmp.conf</code> ein, um die
	  MIB-Definitionen der Bridge in
	  <span class="application">Net-SNMP</span> zu importieren:</p><pre class="programlisting">mibdirs +/usr/share/snmp/mibs
mibs +BRIDGE-MIB:RSTP-MIB:BEGEMOT-MIB:BEGEMOT-BRIDGE-MIB</pre><p>Um eine einzelne Bridge über den IETF BRIDGE-MIB
	  (RFC4188) zu überwachen, geben Sie Folgendes ein:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>snmpwalk -v 2c -c public bridge1.example.com mib-2.dot1dBridge</code></strong>
BRIDGE-MIB::dot1dBaseBridgeAddress.0 = STRING: 66:fb:9b:6e:5c:44
BRIDGE-MIB::dot1dBaseNumPorts.0 = INTEGER: 1 ports
BRIDGE-MIB::dot1dStpTimeSinceTopologyChange.0 = Timeticks: (189959) 0:31:39.59 centi-seconds
BRIDGE-MIB::dot1dStpTopChanges.0 = Counter32: 2
BRIDGE-MIB::dot1dStpDesignatedRoot.0 = Hex-STRING: 80 00 00 01 02 4B D4 50
...
BRIDGE-MIB::dot1dStpPortState.3 = INTEGER: forwarding(5)
BRIDGE-MIB::dot1dStpPortEnable.3 = INTEGER: enabled(1)
BRIDGE-MIB::dot1dStpPortPathCost.3 = INTEGER: 200000
BRIDGE-MIB::dot1dStpPortDesignatedRoot.3 = Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedCost.3 = INTEGER: 0
BRIDGE-MIB::dot1dStpPortDesignatedBridge.3 = Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedPort.3 = Hex-STRING: 03 80
BRIDGE-MIB::dot1dStpPortForwardTransitions.3 = Counter32: 1
RSTP-MIB::dot1dStpVersion.0 = INTEGER: rstp(2)</pre><p>Der Wert der Variable
	  <code class="literal">dot1dStpTopChanges.0</code> ist hier 2, die
	  STP-Topologie der Bridge wurde also bereits zweimal
	  geändert.  Unter einer Änderung versteht man dabei
	  die Anpassung eines oder mehrerer Links und die Kalkulation
	  eines neuen Baums.  Der Wert der Variable
	  <code class="literal">dot1dStpTimeSinceTopologyChange.0</code> gibt an,
	  wann dies zuletzt geschah.</p><p>Um mehrere Bridge-Schnittstellen zu überwachen,
	  können Sie den privaten BEGEMOT-BRIDGE-MIB
	  einsetzen:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>snmpwalk -v 2c -c public bridge1.example.com</code></strong>
enterprises.fokus.begemot.begemotBridge
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName."bridge0" = STRING: bridge0
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName."bridge2" = STRING: bridge2
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress."bridge0" = STRING: e:ce:3b:5a:9e:13
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress."bridge2" = STRING: 12:5e:4d:74:d:fc
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts."bridge0" = INTEGER: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts."bridge2" = INTEGER: 1
...
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange."bridge0" = Timeticks: (116927) 0:19:29.27 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange."bridge2" = Timeticks: (82773) 0:13:47.73 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges."bridge0" = Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges."bridge2" = Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot."bridge0" = Hex-STRING: 80 00 00 40 95 30 5E 31
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot."bridge2" = Hex-STRING: 80 00 00 50 8B B8 C6 A9</pre><p>Um die über den
	  <code class="literal">mib-2.dot1dBridge</code>-Subtree überwachte
	  Bridge-Schnittstelle zu ändern, geben Sie Folgendes
	  ein:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>snmpset -v 2c -c private bridge1.example.com</code></strong>
BEGEMOT-BRIDGE-MIB::begemotBridgeDefaultBridgeIf.0 s bridge2</pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-bluetooth.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="network-aggregation.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">33.5. Bluetooth </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> 33.7. Link-Aggregation und Failover</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>