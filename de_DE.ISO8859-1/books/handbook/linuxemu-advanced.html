<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>11.7. Weiterführende Themen</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Das FreeBSD-Handbuch" /><link rel="up" href="linuxemu.html" title="Kapitel 11. Linux-Binärkompatibilität" /><link rel="prev" href="linuxemu-oracle.html" title="11.6. Oracle® installieren" /><link rel="next" href="system-administration.html" title="Teil III. Systemadministration" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">11.7. Weiterführende Themen</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="linuxemu-oracle.html">Zurück</a> </td><th width="60%" align="center">Kapitel 11. Linux-Binärkompatibilität</th><td width="20%" align="right"> <a accesskey="n" href="system-administration.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-advanced"></a>11.7. Weiterführende Themen</h2></div></div></div><p>Wenn Sie sich fragen, wie die Linux-Binärkompatibilität
      unter FreeBSD realisiert wurde, sollten Sie diesen Abschnitt lesen.
      Der Großteil der folgenden Informationen stammt aus einer
      E-Mail, die von Terry Lambert (<code class="email">&lt;<a xmlns="" class="email" href="mailto:tlambert@primenet.com">tlambert@primenet.com</a>&gt;</code>)
      an die FreeBSD-Chat-Mailingliste
      (<code class="email">&lt;<a xmlns="" class="email" href="mailto:freebsd-chat@FreeBSD.org">freebsd-chat@FreeBSD.org</a>&gt;</code>) geschrieben wurde
      (Message ID: <code class="literal">&lt;199906020108.SAA07001@usr09.primenet.com&gt;</code>).</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76105936"></a>11.7.1. Wie funktioniert es?</h3></div></div></div><a id="idp76106576" class="indexterm"></a><p>FreeBSD verfügt über eine <span class="quote">&#8222;<span class="quote">execution class
	loader</span>&#8220;</span> genannte Abstraktion.  Dabei handelt es sich um einen
	Eingriff in den <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> Systemaufruf.</p><p>FreeBSD verfügt über eine Liste von Ladern, anstelle
	eines einzigen, auf <code class="literal">#!</code>
	zurückgreifenden Laders, um Shell-Interpreter oder Shell-Skripte
	auszuführen.</p><p>Historisch gesehen untersuchte der einzige, auf
	UNIX-Plattformen vorhandene Lader die "magische Zahl"
	(in der Regel die ersten 4 oder 8 Bytes der Datei), um
	festzustellen, ob der Binärtyp dem System bekannt war.
	War dies der Fall, wurde der Binärlader aufgerufen.</p><p>Wenn es sich nicht um den zum System gehörigen Binärtyp
        handelte, gab <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> einen Fehler zurück,
	und die Shell versuchte stattdessen, die Datei als Shell-Befehl
	auszuführen.</p><p>Dabei wurde als Standardeinstellung <span class="quote">&#8222;<span class="quote">was auch immer die
        aktuelle Shell ist</span>&#8220;</span> festgelegt.</p><p>Später wurde ein Hack in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> eingefügt,
	der die zwei ersten Zeichen untersuchte.  Wenn diese
	<code class="literal">:\n</code> entsprachen,
	wurde stattdessen die <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a>-Shell aufgerufen
	(wir glauben, dass dies zuerst von SCO umgesetzt wurde).</p><p>FreeBSD versucht heute eine Liste von Ladern, unter denen
	sich ein allgemeiner Lader für Interpreter befindet.  Der
	auszuführende Interpreter wird im ersten, durch
	Leerzeichen getrennten Feld, der <code class="literal">#!</code>-Zeile
	angegeben.  Lässt sich der Interpreter nicht ermitteln,
	wird auf <code class="filename">/bin/sh</code> zurückgegriffen.</p><a id="idp76115280" class="indexterm"></a><p>Für die Linux ABI-Unterstützung erkennt FreeBSD
        die magische Zahl als ELF-Binärdatei (Zu diesem Zeitpunkt wird
	nicht zwischen FreeBSD, <span class="trademark">Solaris</span>&#8482;, Linux oder anderen Systemen
	unterschieden, die über ELF-Binärdateien
	verfügen.).</p><a id="idp76116560" class="indexterm"></a><p>Der ELF-Lader sucht nach einer speziellen
	<span class="emphasis"><em>Kennzeichnung</em></span>, die aus einem Kommentarabschnitt
	in der ELF-Datei besteht, und die in SVR4/<span class="trademark">Solaris</span>&#8482; ELF
	Binärdateien nicht vorhanden ist.</p><p>Damit Linux-Binärdateien (unter FreeBSD) funktionieren,
	müssen sie als <code class="literal"> Linux</code>
	<span class="emphasis"><em>gekennzeichnet</em></span> werden, und zwar durch
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>brandelf -t Linux file</code></strong></pre><p>Nachdem dies geschehen ist, erkennt der ELF-Lader die
	<code class="literal">Linux</code>-Kennzeichnung der Datei.</p><a id="idp76130128" class="indexterm"></a><p>Wenn der ELF-Lader die <code class="literal">Linux</code>-Kennzeichnung
	sieht, wird ein Zeiger in der <code class="literal">proc</code>-Struktur
	ersetzt.  Alle Systemaufrufe werden durch diesen Zeiger indiziert
	(in einem traditionellen <span class="trademark">UNIX</span>® System wäre das ein
	<code class="literal">sysent[]</code>-Strukturfeld, das die Systemaufrufe
	enthält).  Der Prozess wird weiterhin speziell gekennzeichnet,
	so dass der Trap-vector im Signal-trampoline-code eine spezielle
	Behandlung erfährt und das Linux-Kernelmodul verschiedene
	kleinere Korrekturen vornehmen kann.</p><p>Der Linux-Systemaufrufvektor enthält neben anderen
	Dingen eine Liste der <code class="literal">sysent[]</code>-Einträge,
	deren Adressen sich im Kernelmodul befinden.</p><p>Wenn ein Linux-Programm einen Systemaufruf ausführt,
        dereferenziert die Trap-Behandlungsroutine den Zeiger auf die
	Eintrittspunkte für die Systemaufrufe und erhält damit die
	Linux-Eintrittspunkte und nicht die FreeBSD-Eintrittspunkte.</p><p>Zusätzlich <span class="emphasis"><em>verändert</em></span> der
	Linuxmodus die Systempfade dynamisch; genauso, wie dies die
	Option <code class="option">union</code> beim Einbinden von Dateisystemen
	macht (Achtung: <span class="emphasis"><em>nicht</em></span> das Dateisystem unionfs!).
	Zuerst wird die Datei im Verzeichnis <code class="filename">/compat/linux/Originalpfad</code>
	gesucht, <span class="emphasis"><em>danach</em></span>, wenn sie dort nicht gefunden
	wurde, wird sie im FreeBSD-Verzeichnis
	<code class="filename">/Originalpfad</code>
	gesucht.  Dadurch wird sichergestellt, dass
	Binärdateien, die zur Ausführung andere
	Binärdateien benötigen, ausgeführt
	werden können (so dass alle Linux-Werkzeuge unter der
	ABI laufen).  Dies bedeutet auch,
	dass Linux-Binärdateien FreeBSD-Binärdateien
	laden und ausführen können, wenn keine passenden
	Linux-Binärdateien vorhanden sind.  Ein in
	<code class="filename">/compat/linux</code> plaziertes <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=uname&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">uname</span>(1)</span></a> kann
	damit Linux-Programmen vorgaukeln, dass sie auf einem Linux-System
	laufen.</p><p>Im Endeffekt gibt es einen Linux-Kernel innerhalb des
        FreeBSD-Kernels.  Die Sprungtabellen für Linux-
	beziehungsweise FreeBSD-Systemaufrufe verweisen allerdings auf
	dieselben Funktionen, die Kerneldienste wie Dateisystemoperationen,
	Operationen für den virtuellen Speicher,
	Signalübermittlung und System V IPC bereitstellen,
	Der einzige Unterschied ist, dass Binärdateien unter FreeBSD
	FreeBSD-<span class="emphasis"><em>glue</em></span>-Funktionen verwenden.
	Linux-Binärdateien hingegen verwenden die
	Linux-<span class="emphasis"><em>glue</em></span>-Funktionen. Die meisten
	älteren Betriebssysteme hatten ihre eigenen
	<span class="emphasis"><em>glue</em></span>-Funktionen: Funktionsadressen
	in einem globalen, statischen <code class="literal">sysent[]</code>
	Strukturfeld an Stelle von Funktionsadressen,  die durch
	einen dynamisch initialisierten Zeiger aus der
	<code class="literal">proc</code> Struktur, die den Aufruf gemacht hatte,
	dereferenziert wurden.</p><p>Welche ist die echte FreeBSD-ABI?  Das spielt keine Rolle.
	Grundsätzlich ist der einzige Unterschied (zurzeit
	ist das so; dies könnte sich in zukünftigen
	Versionen leicht ändern und wird sich wahrscheinlich
	auch ändern), dass die
	FreeBSD-<span class="emphasis"><em>glue</em></span>-Funktionen statisch in
	den Kernel gelinkt sind, und dass die
	Linux-<span class="emphasis"><em>glue</em></span>-Funktionen statisch gelinkt
	oder über ein Modul eingebunden werden können.</p><p>Ja, aber ist das wirkliche eine Emulation? Nein.  Es ist eine
	Implementierung eines ABIs, keine Emulation.  Es ist kein Emulator
	(oder Simulator, um der nächsten Frage zuvorzukommen)
	beteiligt.</p><p>Warum wird es manchmal <span class="quote">&#8222;<span class="quote">Linux-Emulation</span>&#8220;</span> genannt?
	Um es schwerer zu machen, FreeBSD zu verkaufen.  Wirklich, das kommt
	daher, weil dies zu einer Zeit implemtiert wurde,
	in der es kein anderes Wort
	(als Emulation) gab, das beschrieb, was vor sich ging.
	Wenn der Kernel nicht entsprechend konfiguriert wurde oder das
	Modul geladen wurde, war es falsch zu behaupten, FreeBSD würde
	Linux-Binärprogramme ausführen.  Man benötigte
	ein Wort, das beschrieb, was da geladen
	wurde &#8211; daher <span class="quote">&#8222;<span class="quote">Der Linux-Emulator</span>&#8220;</span>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="linuxemu-oracle.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="linuxemu.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="system-administration.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">11.6. <span class="trademark">Oracle</span>® installieren </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> Teil III. Systemadministration</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>