<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>15.4. Creación y gestión de jaulas</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="jails.html" title="Capítulo 15. Jaulas" /><link rel="prev" href="jails-intro.html" title="15.3. Introducción" /><link rel="next" href="jails-tuning.html" title="15.5. Administración y personalización a fondo" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">15.4. Creación y gestión de jaulas</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="jails-intro.html">Anterior</a> </td><th width="60%" align="center">Capítulo 15. Jaulas</th><td width="20%" align="right"> <a accesskey="n" href="jails-tuning.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-build"></a>15.4. Creación y gestión de jaulas</h2></div></div></div><p>Algunos administradores dividen las jaulas en dos tipos:
      jaulas <span class="quote">&#8220;<span class="quote">completas</span>&#8221;</span>, que recrean un sistema FreeBSD
      real, y jaulas <span class="quote">&#8220;<span class="quote">de servicio</span>&#8221;</span>, que son aquellas
      que están dedicadas a una sola aplicación o
      servicio, en muchos casos ejecutándose sin privilegios.  Se
      trata de una división exclusivamente conceptual, por lo
      que el proceso de generación de una jaula no se ve
      afectado por ella.  La página de manual <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>
      explica claramente el procedimiento a seguir para generar una
      jaula:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setenv D /aquí/está/la/jaula</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p $D</code></strong> <a id="jailpath"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make world DESTDIR=$D</code></strong> <a id="jailworld"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd etc/</code></strong> <a href="#ftn.idp76818000" class="footnote" id="idp76818000"><sup class="footnote">[9]</sup></a>
<code class="prompt">#</code> <strong class="userinput"><code>make distribution DESTDIR=$D</code></strong> <a id="jaildistrib"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>mount_devfs devfs $D/dev</code></strong> <a id="jaildevfs"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#jailpath"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>El mejor punto de partida es la elección del punto
	  del sistema de ficheros del servidor donde estará
	  físicamente ubicada la jaula.  <code class="filename">/usr/jail/nombredelajaula</code>
	  es un buen sitio.   <em class="replaceable"><code>nombredelajaula</code></em>
	  es el nombre de máquina que identifica a la jaula.  El
	  sistema de ficheros <code class="filename">/usr/</code> suele tener espacio
	    suficiente para albergar el sistema de ficheros de la jaula que,
	    cuando se trata de jaulas <span class="quote">&#8220;<span class="quote">completas</span>&#8221;</span>, es
	    esencialmente lo necesario para alojar todos y cada uno de
	    los sistemas de ficheros en una instalación del sistema
	    base por omisión de FreeBSD.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jailworld"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Este comando creará el contenido necesario
	  (binarios, bibliotecas, páginas de manual, etc.) y
	  lo copiará al <span class="quote">&#8220;<span class="quote">subárbol</span>&#8221;</span> elegido
	  como ubicación física de la jaula.  Todo se
	  hace al típico estilo FreeBSD: se compila todo y luego
	  se instala en la ruta de destino.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildistrib"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Al pasar el <span class="quote">&#8220;<span class="quote">target</span>&#8221;</span>
	  <code class="buildtarget">distribution</code> a
	  <span class="application">make</span> se instalan todos los ficheros
	  de configuración necesarios.  En pocas palabras,
	  instala cada fichero instalable que haya en
	  <code class="filename">/usr/src/etc/</code> en el
	  directorio <code class="filename">/etc</code> de la
	  jaula, es decir, en
	  <code class="filename">$D/etc/</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildevfs"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>No es imprescindible montar el sistema de ficheros
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> dentro de la jaula aunque por otra parte
	  (casi) todas las aplicaciones necesitan acceso al menos
	  a un dispositivo, dependiendo esto del propósito
	  de la aplicación.  Es muy importante el control del
	  acceso a dispositivos desde la jaula, puesto que una
	  configuración descuidada puede permitir que un
	  atacante haga de las suyas.  El control sobre <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a>
	  se gestiona mediante reglas que se detallan en las
	  páginas de manual <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> y <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs.conf</span>(5)</span></a>.</p></td></tr></table></div><p>Una vez instalada la jaula puede arrancarla mediante
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> usa los cuatro argumentos que
      se detallan en la <a class="xref" href="jails-intro.html#jails-what" title="15.3.1. Qué es una jaula">Sección 15.3.1, &#8220;Qué es una jaula&#8221;</a>.  Puede pasarle otros argumentos
      además de estos, por ejemplo para ejecutar procesos
      enjaulados bajo los permisos de un usuario específico.  El
      argumento <code class="option"><em class="replaceable"><code>comando</code></em></code>
      depende del tipo de jaula; si se trata de un
      <span class="emphasis"><em>virtual system</em></span> <code class="filename">/etc/rc</code>
      es una buena elección, puesto que ejecutará la
      secuencia de arranque de un sistema FreeBSD real.  Si se trata
      de una jaula <span class="emphasis"><em>de servicio</em></span> depende del
      servicio o aplicación que se quiera ejecutar mediante
      la jaula.</p><p>Con frecuencia las jaulas se arrancan durante el arranque del
      servidor que las aloja;  el sistema <code class="filename">rc</code> de
      FreeBSD permite hacerlo de un modo muy sencillo.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Puede crear una lista de jaulas que quiera arrancar
	  en el inicio del sistema en el fichero
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>:</p><pre class="programlisting">jail_enable="YES"   # Ponga NO si quiere desactivar el arranque de jaulas
jail_list="<em class="replaceable"><code>www</code></em>"     # Lista de nombres de jaulas separados por espacios</pre></li><li class="step"><p>Tendrá que añadir parámetros
	  específicos para cada jaula al fichero
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>:</p><pre class="programlisting">jail_<em class="replaceable"><code>www</code></em>_rootdir="/usr/jail/www"     # directorio raiz de la jaula
jail_<em class="replaceable"><code>www</code></em>_hostname="<em class="replaceable"><code>www</code></em>.example.org"  # nombre de máquina de la jaula
jail_<em class="replaceable"><code>www</code></em>_ip="192.168.0.10"           # dirección IP de la jaula
jail_<em class="replaceable"><code>www</code></em>_devfs_enable="YES"          # montar devfs en la jaula
jail_<em class="replaceable"><code>www</code></em>_devfs_ruleset="<em class="replaceable"><code>www_ruleset</code></em>" # reglas a aplicar a devfs dentro de la jaula</pre><p>El arranque de jaulas por omisión que se
	  configure en <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> ejecutará el script
	  <code class="filename">/etc/rc</code> de la jaula y asumirá
	  que es un sistema virtual completo.  Si se trata de una
	  jaula de servicio el comando de arranque por omisión
	  tendrá que cambiarse configurando la opción
	  <code class="varname">jail_<em class="replaceable"><code>nombredejaula</code></em>_exec_start</code>
	  según convenga.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si quiere consultar la lista completa de opciones
	    consulte la página de manual
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>.</p></div></li></ol></div><p>Puede arrancar o parar a mano una jaula mediante el script
      <code class="filename">/etc/rc.d/jail</code> siempre y cuando la jaula
      aparezca en <code class="filename">rc.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/jail start www</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/jail stop www</code></strong></pre><p>De momento no hay una forma limpia de apagar una jaula
      (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>) debido a que los comandos que se usan normalmente
      para producir un apagado limpio del sistema no pueden usarse
      dentro de una jaula.  La mejor forma de parar una jaula es
      ejecutar el siguiente comando desde dentro de la propia jaula
      o bien mediante <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a> desde fuera:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh /etc/rc.shutdown</code></strong></pre><p>Para más información consulte la página
      de manual <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>.</p><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp76818000" class="footnote"><p><a href="#idp76818000" class="para"><sup class="para">[9] </sup></a>Este paso
no es necesario en FreeBSD 6.0 y versiones posteriores.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jails-intro.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="jails.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="jails-tuning.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">15.3. Introducción </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 15.5. Administración y personalización a fondo</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>