<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>27.5. Depuración de Problemas</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="mail.html" title="Capítulo 27. Correo Electrónico" /><link rel="prev" href="mail-changingmta.html" title="27.4. Sustitución del Agente de Transferencia de Correo" /><link rel="next" href="mail-advanced.html" title="27.6. Conceptos Avanzados" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">27.5. Depuración de Problemas</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mail-changingmta.html">Anterior</a> </td><th width="60%" align="center">Capítulo 27. Correo Electrónico</th><td width="20%" align="right"> <a accesskey="n" href="mail-advanced.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-trouble"></a>27.5. Depuración de Problemas</h2></div></div></div><a id="idp81287376" class="indexterm"></a><div class="qandaset"><a id="idp81288528"></a><dl><dt>27.5.1. <a href="mail-trouble.html#idp81288784">?Por qué tengo que utilizar el FQDN para las
          máquinas de mi organización?</a></dt><dt>27.5.2. <a href="mail-trouble.html#idp81307856">sendmail dice mail
	  loops back to myself (el correo vuelve a mis manos)</a></dt><dt>27.5.3. <a href="mail-trouble.html#idp81314256">?Cómo puedo ejecutar un servidor de correo
          utilizando una máquina que se conecta a internet
              mediante modem analógico (dial-up) ?</a></dt><dt>27.5.4. <a href="mail-trouble.html#idp81334864">?Por qué me siguen saliendo mensajes de error
            del tipo Relaying Denied cuando se trata
	    de enviar correo proveniente de otras máquinas?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp81288784"></a><a id="idp81289040"></a><p><strong>27.5.1.</strong></p></td><td align="left" valign="top"><p>?Por qué tengo que utilizar el FQDN para las
          máquinas de mi organización?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Probablemente se deba a que la máquina de correo se
          encuentra en un dominio diferente; si por ejemplo la
          máquina de correo se encuentra en <code class="systemitem">foo.bar.edu</code>
          y se desea alcanzar una máquina llamada
          <code class="systemitem">mumble</code> en el dominio
          <code class="systemitem">bar.edu</code> se tiene que referir a
          ella mediante un nombre de dominio completo
          (<span class="quote">&#8220;<span class="quote">fully-quailified domain name</span>&#8221;</span> o FQDN), en éste
          caso <code class="systemitem">mumble.bar.edu</code> en lugar de
          referirse a ella simplemente como <code class="systemitem">mumble</code>.</p><p>Tradicionalmente, la referencia incompleta era posible
          utilizando <span class="quote">&#8220;<span class="quote">resolvers</span>&#8221;</span> de BSD BIND<a id="idp81302224" class="indexterm"></a>.
	  No obstante la versión de <span class="application">BIND</span>
          que en la actualidad se ofrece con FreeBSD ya no permite por defecto
          el uso de dichas abreviaturas salvo para aquellas máquinas
          que pertenecen al dominio al que su sistema pertenezca.
          Una máquina como <code class="systemitem">mumble</code> será buscada
          como <code class="systemitem">mumble.foo.bar.edu</code> o la
          búsqueda será redireccionada al servidor de dominio
          raíz del DNS.</p><p>Esto es distinto a lo que ocurría en versiones anteriores
          de BIND, donde la búsqueda se producía a través
          de <code class="systemitem">mumble.bar.edu</code> y de
          <code class="systemitem">mumble.edu</code>.  Se recomienda
          consultar a la RFC 1535 para conocer el motivo que se considerara
          una práctica errónea o incluso un agujero de
          seguridad.</p><p>Una buena solución a este problema puede ser
         incluír la siguiente línea

          </p><pre class="programlisting">search foo.bar.edu bar.edu</pre><p>

          en lugar de

          </p><pre class="programlisting">domain foo.bar.edu</pre><p>

          dentro del fichero <code class="filename">/etc/resolv.conf</code>.
          No obstante se debe asegurar de que el orden de
	  búsqueda no se expande más allá del
	  <span class="quote">&#8220;<span class="quote">límite entre la administración local y la administración pública</span>&#8221;</span>,
	  tal y como se le denomina en la RFC 1535.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp81307856"></a><a id="idp81308112"></a><p><strong>27.5.2.</strong></p></td><td align="left" valign="top"><p><span class="application">sendmail</span> dice <span class="errorname">mail
	  loops back to myself</span> (el correo vuelve a mis manos)</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Esta pregunta se responde en las FAQ de
	<span class="application">sendmail</span> de la siguiente forma:</p><pre class="programlisting">Estoy obteniendo los siguientes mensajes de error:

553 MX list for domain.net points back to relay.domain.net
554 &lt;user@domain.net&gt;... Local configuration error

¿Cómo puedo solucionar esto?

Usted ha especificado que el correo para el dominio (por ejemplo,
para el dominio dominio.net) sea reenviado a una máquina determinada
(en este caso relay.dominio.net), para lo que se utiliza un registro
de DNS de tipo MX<a id="idp81310928" class="indexterm"></a>,
pero la máquina que actúa de relay no se
reconoce a sí misma como perteneciente al dominio dominio.net.
Se debe añadir dominio.net al fichero /etc/mail/local-host-names,
que recibe el nombre de /etc/sendmail.cw en versiones de sendmail previas
a la 8.10.  Se puede utilizar la macro FEATURE(use_cw_file) para indicar
dónde se encuentra el fichero local-host-names; también se
puede añadir <span class="quote">&#8220;<span class="quote">Cw dominio.net</span>&#8221;</span> directamente
al fichero <code class="filename">/etc/mail/sendmail.cf</code>
         </pre><p>Las FAQ de <span class="application">sendmail</span> se pueden
          encontrar en <code class="uri"><a class="uri" href="http://www.sendmail.org/faq/" target="_top">http://www.sendmail.org/faq/</a></code> y son de lectura
          obligada si se quiere depurar el comportamiento y la
	  configuración de <span class="application">sendmail</span>.
	</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp81314256"></a><a id="idp81314512"></a><p><strong>27.5.3.</strong></p></td><td align="left" valign="top"><p>?Cómo puedo ejecutar un servidor de correo
          utilizando una máquina que se conecta a internet
              mediante modem analógico (dial-up) ?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Se quiere conectar una máquina FreeBSD dentro de una LAN a
	  Internet.  La máquina FreeBSD será una pasarela de
          correo para dicha LAN.  La conexión mediante PPP<a id="idp81315792" class="indexterm"></a> no es
	  dedicada.</p><p>Existen al menos dos formas distintas de hacerlo.  Una de ellas
          consiste en utilizar UUCP<a id="idp81316816" class="indexterm"></a>.</p><p>Otra forma consiste en hacerse con un servidor de internet a
          tiempo completo para proporcionar servicios de agente de transporte
          secundario para nuestro dominio.  Si por ejemplo el dominio de
          nuestra compañía es <code class="systemitem">ejemplo.com</code>, nuestro proveedor de acceso
          a internet puede instalar lo siguiente en el DNS:</p><pre class="programlisting">ejemplo.com.          MX        10      ejemplo.com.
                      MX        20      ejemplo.net.</pre><p>Nótese que el agente de correo primario es nuestro
           dominio, ejemplo.com, y además se encuentra configurado
           un agente de transporte secundario en la máquina
           ejemplo.net.  En este caso sólamente se debe especificar
           una máquina como receptor final de correo
           (añadiendo <code class="literal">Cw ejemplo.com</code>) al fichero
           <code class="filename">/etc/mail/sendmail.cf</code> de la máquina
           <code class="systemitem">example.com</code>)</p><p>Cuando el <code class="command">sendmail</code> que está enviando
          el correo trata de entregar dicho correo primero intentará
          conectarse con nosotros (<code class="systemitem">ejemplo.com</code>) utilizando el enlace de
          modem.  Lo más probable es que la operación termine
          después de un tiempo de espera debido a que el enlace modem
          esté caído.
          La aplicación <span class="application">sendmail</span>
          automáticamente entregará el correo al servidor
          especificado como agente de transporte de correo secundario
          (segundo registro MX)<a id="idp81322192" class="indexterm"></a>, es decir, entregará el correo a
          nuestro proveedor de servicios de internet (<code class="systemitem">ejemplo.net</code>).  El sitio MX secundario
          tratará de conectarse con nuestra máquina de una forma
          periódica con el objeto de entregar el correo a la
          máquina que actúa como agente servidor de correo
          primario (<code class="systemitem">ejemplo.com</code>).</p><p>Puede ser de mucha utilidad un script de <span class="quote">&#8220;<span class="quote">login</span>&#8221;</span>
          como el que se muestra a continuación:</p><pre class="programlisting">#!/bin/sh
# Ponme en /usr/local/bin/pppmiconexion
( sleep 60 ; /usr/sbin/sendmail -q ) &amp;
/usr/sbin/ppp -direct pppmiconexion</pre><p>Si vamos a crear un script de <span class="quote">&#8220;<span class="quote">login</span>&#8221;</span> separado para
          un usuario determinado se puede utilizar
	  <code class="command">sendmail -qRejemplo.com</code> en lugar del script
          anterior.  Esto obliga a que se procesen
          de forma inmediata todos los correos que se encuentren en la cola de
          <code class="systemitem">ejemplo.com</code>.</p><p>Vamos a dar una vuelta más de tuerca a la
          situación:</p><p>Mensaje robado a la <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-isp" target="_top">lista de correo de Proveedores de Servicios de Internet en FreeBSD</a>.</p><pre class="programlisting">
&gt; Nosotros proporcionamos servicio de MX secundario a un cliente nuestro.
&gt; El cliente se conecta a nuestro servidor varias veces al día
&gt; de  forma automática para recoger sus correos para almacenarlos en
&gt; su servidor MX primario (nosotros no llamamos a su organización
&gt; justo cuando nos llega un correo suyo).
&gt; Nuestro sendmail envía la cola de correos cada 30 minutos. En
&gt; estos momentos nuestro cliente tiene que estar al menos 30 minutos
&gt; conectado para asegurarnos de que todo su correo ha sido enviado al
&gt; servidor MX primario.
&gt;
&gt; ?Existe algún comando que permita indicar a sendmail que
&gt; envíe todos los correos de la cola cuando quiera el cliente?
&gt; El cliente no tiene permisos de superusuario en la máquina que
&gt; alberga nuestro agente de transporte, por supuesto.

En la sección de <span class="quote">&#8220;<span class="quote">privacy flags</span>&#8221;</span> del fichero sendmail.cf
existe una definición como ésta:
Opgoaway,restrictqrun

Basta con eliminar restrictqrun para permitir que usuarios sin permisos de
superusuario arranquen el procesamiento de la cola.
Sería conveniente además que reordenaran los registros MX.
Nosotros somos el primer MX para nuestros clientes.
Además de esto hay que especificar:

# Si somos el mejor MX para una determinada máquina, intenta
# utilizarnos directamente en vez de generar un error de
# configuración local.
OwTrue

en el archivo de configuración de <span class="application">sendmail</span>.
Mediante la configuración anterior,
una organización remota entregará sus correos directamente a
usted, sin necesidad de intentar conectarse primero a través de
la conexión del cliente.  La etiqueta "OwTrue" se necesita para evitar
que <span class="application">sendmail</span> genere un mensaje de error.
A continuación ustedes se encargan de entregar el
correo a su(s) respectivo(s) cliente(s) tal como vienen haciendo.

Esta configuración sólo funciona para
<span class="quote">&#8220;<span class="quote">máquinas individuales</span>&#8221;</span>,
de tal forma que se necesita que el cliente especifique su servidor de correo
mediante entradas de tipo A en el DNS.  En concreto se necesita una entrada de
tipo A en el DNS para el dominio del cliente (<span class="quote">&#8220;<span class="quote">cliente.com</span>&#8221;</span>).
</pre></td></tr><tr class="question"><td align="left" valign="top"><a id="idp81334864"></a><a id="idp81335120"></a><p><strong>27.5.4.</strong></p></td><td align="left" valign="top"><p>?Por qué me siguen saliendo mensajes de error
            del tipo <span class="errorname">Relaying Denied</span> cuando se trata
	    de enviar correo proveniente de otras máquinas?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>En las instalaciones del sistema FreeBSD por defecto
 	    <span class="application">sendmail</span> se configura para enviar
            correo sólamente desde la máquina en la cual
            se está ejecutando.  Por ejemplo si un servidor
            <acronym class="acronym">POP</acronym> está disponible los usuarios
            serán capaces de consultar su correo desde la universidad,
            el trabajo u otras localizaciones remotas, pero dichos usuarios
            podrán enviar correo desde dichas ubicaciones.
            Es habitual que unos instantes después del envío
            del correo dichos usuarios reciban un mensaje proveniente del
	    <span class="application">MAILER-DAEMON</span> con un error como
	    <span class="errorname">5.7 Relaying Denied</span>.</p><p>Existen varias formas de solventar este problema.  La
            más sencilla consiste en escribir la dirección
            IP de su proveedor de servicios dentro del fichero
 	    <code class="filename">/etc/mail/relay-domains</code>.  Una forma
            rápida de hacerlo sería:
 	  </p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo "un.isp.ficticio.com" &gt; /etc/mail/relay-domains</code></strong></pre><p>Después de crear o editar dicho fichero se debe
            reiniciar <span class="application">sendmail</span>.  Esto funciona
  	    perfectamente si usted es el administrador del servidor y no
            desea enviar correo localmente o si prefiere utilizar un cliente
            de correo o cualquier otro sistema en otra máquina distinta
            a la que alberga el servidor de correo.  Es muy útil sobre
            todo cuando sólamente se tienen una o dos direcciones de
            correo eletrónico.  Si hay en liza un gran número de
            direcciones de correo, edite el fichero anterior con su editor de
            texto favorito y añada uno a uno los correspondientes
            dominios.</p><pre class="programlisting">un.isp.ficticio.com
otro.isp.ficticio.net
y.otro.isp.ficticio.org
www.ejemplo.org</pre><p>Ahora, cualquier correo enviado a través de su sistema
            por cualquier máquina que se encuentre en este fichero
            (siempre y cuando el usuario tenga una cuenta en nuestro sistema)
            podrá ser enviado con éxito.
	    Es una manera elegante de permitir a los usuarios enviar
            correo eletrónico desde nuestro servidor de correo sin
            permitir al resto del mundo que haga lo mismo (lo que se conoce
            como SPAM).</p></td></tr></tbody></table></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mail-changingmta.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="mail.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="mail-advanced.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">27.4. Sustitución del Agente de Transferencia de Correo </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 27.6. Conceptos Avanzados</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>