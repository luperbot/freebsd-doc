<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>29.13. Traducción de direcciones de red</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="advanced-networking.html" title="Capítulo 29. Networking avanzado" /><link rel="prev" href="network-ntp.html" title="29.12. NTP" /><link rel="next" href="network-inetd.html" title="29.14. El &#8220;Superservidor&#8221; inetd" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.13. Traducción de direcciones de red</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-ntp.html">Anterior</a> </td><th width="60%" align="center">Capítulo 29. Networking avanzado</th><td width="20%" align="right"> <a accesskey="n" href="network-inetd.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-natd"></a>29.13. Traducción de direcciones de red</h2></div><div><span class="authorgroup">Escrito por <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-natoverview"></a>29.13.1. Overview</h3></div></div></div><a id="idp84060368" class="indexterm"></a><p>El dæmon de FreeBSD que se encarga de traducir direcciones de
        red,  más conocido como <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a>, es un dæmon que
        acepta paquetes IP, modifica la dirección IP fuente de dichos
        paquetes y los reinyecta en el flujo de paquetes IP de salida.
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> ejecuta este proceso modificando la dirección de
        origen y el puerto de tal forma que cuando se reciben paquetes de
        contestación <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> es capaz de determinar el destino
        real y reenviar el paquete a dicho destino.</p><a id="idp84064080" class="indexterm"></a><a id="idp84064592" class="indexterm"></a><p>El uso más común de NAT es para Compartir la
        Conexión a Internet.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-natsetup"></a>29.13.2. Configuración</h3></div></div></div><p>Debido al pequeño espacio de direccionamiento que se
        encuentra actualmente disponible en IPv4 y debido también al
        gran aumento que se está produciendo en cuanto a número
        de usuarios de líneas de conexión a Internet de alta
        velocidad como cable o DSL la gente necesita utilizar cada vez
        más la salida de Compartición de
        Conexión a Internet.  La característica de poder conectar
        varios computadores a través de una única conexión
        y una única dirección IP hacen de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> una
	elección razonable.</p><p>Cada vez con más frecuencia un usuario típico
        dispone de una máquina conectada mediante cable o DSL pero
        desearía utilizar dicha máquina como un <span class="quote">&#8220;<span class="quote">
	router</span>&#8221;</span> de acceso para el resto de los ordenadores de su red
        de área local.</p><p>Para poder hacerlo la máquina (FreeBSD por supuesto) debe
         configurarse para actuar como pasarela.  Debe tener al menos dos
         tarjetas de red, una para conectarse a la red de área local y
         la otra para conectarse con el <span class="quote">&#8220;<span class="quote">router</span>&#8221;</span> de acceso a
         Internet.  Todas las máquinas de la LAN se conectan entre
         sí mediante un <span class="quote">&#8220;<span class="quote">hub</span>&#8221;</span> o un <span class="quote">&#8220;<span class="quote">
	 switch</span>&#8221;</span>.</p><div class="mediaobject"><img src="advanced-networking/natd.png" alt="Topología de la Red" /></div><p>Una configuración como esta se utiliza frecuentemente para
        compartir el acceso a Internet.  Una de las máquinas de la
        <acronym class="acronym">LAN</acronym> está realmente conectada a Internet.
        El resto de las máquinas acceden a Internet utilizando como
        <span class="quote">&#8220;<span class="quote">pasarela</span>&#8221;</span> la máquina inicial.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-natdkernconfiguration"></a>29.13.3. Configuración</h3></div></div></div><a id="idp84078928" class="indexterm"></a><p>Se deben añadir las siguientes opciones al fichero de
        configuración del núcleo:</p><pre class="programlisting">options IPFIREWALL
options IPDIVERT</pre><p>Además, según se prefiera, se pueden añadir
        también las siguientes:</p><pre class="programlisting">options IPFIREWALL_DEFAULT_TO_ACCEPT
options IPFIREWALL_VERBOSE</pre><p>Lo que viene a continuación se tiene que definir en
        <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">gateway_enable="YES"
firewall_enable="YES"
firewall_type="OPEN"
natd_enable="YES"
natd_interface="<em class="replaceable"><code>fxp0</code></em>"
natd_flags=""</pre><div class="informaltable"><table border="0"><colgroup><col /><col /></colgroup><tbody><tr><td>gateway_enable="YES"</td><td>Configura la máquina para que actúe como
	        <span class="quote">&#8220;<span class="quote">router</span>&#8221;</span> o pasarela de red.  Se puede conseguir
                  lo mismo ejecutando
                <code class="command">sysctl net.inet.ip.forwarding=1</code>.</td></tr><tr><td>firewall_enable="YES"</td><td>Activa las reglas de cortafuegos que se encuentran
               definidas por defecto en
               <code class="filename">/etc/rc.firewall</code> y que entran en
               funcionamiento en el arranque del sistema.</td></tr><tr><td>firewall_type="OPEN"</td><td>Especifica un conjunto de reglas de cortafuegos que
                permite el acceso a todos los paquetes que se reciban.
                Consulte <code class="filename">/etc/rc.firewall</code> para obtener
                información sobre el resto de tipos de reglas que se
                pueden configurar.</td></tr><tr><td>natd_interface="fxp0"</td><td>Indica qué interfaz se utiliza para reenviar
                paquetes (la interfaz que se conecta a Internet).</td></tr><tr><td>natd_flags=""</td><td>Define cualesquiera otras opciones que se deseen
                proporcionar a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> en tiempo de arranque.</td></tr></tbody></table></div><p>Si se definen las opciones anteriores, en el arranque del sistema
        el fichero <code class="filename">/etc/rc.conf</code> configurará las
        variables de tal forma que se ejecutaría
        <code class="command">natd -interface fxp0</code>.  Evidentemente esta orden
        también se puede ejecutar de forma manual.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">También es posible utilizar un fichero de
	  configuración para <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> en caso de que deseemos
          especificar muchos parámetros de arranque. Tendremos que
          declarar la ubicación del fichero de configuración
	  mediante la inclusión de lo siguiente en
          <code class="filename">/etc/rc.conf</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">natd_flags="-f /etc/natd.conf"</pre><p xmlns="http://www.w3.org/1999/xhtml">El fichero <code class="filename">/etc/natd.conf</code> debe contener una
          lista de opciones de configuración una opción por
          línea.  Por ejemplo, en el caso que se comenta en la siguiente
          sección se utilizaría un fichero de
          configuración con la siguiente información:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">redirect_port tcp 192.168.0.2:6667 6667
redirect_port tcp 192.168.0.3:80 80</pre><p xmlns="http://www.w3.org/1999/xhtml">Para obtener más información sobre el fichero de
          configuración se puede consultar la opción
          <code class="option">-f</code> que se describe en la página del manual de
          <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a>.</p></div><p>Cada máquina (y cada interfaz) que se encuentra conectada
        a la LAN debe poseer una dirección IP perteneciente al espacio
        de direcciones IP privado tal y como se define en <a class="link" href="ftp://ftp.isi.edu/in-notes/rfc1918.txt" target="_top">RFC 1918</a> y debe
        poseer como pasarela por defecto la dirección IP de la
        interfaz interna (la interfaz que se conecta a la LAN) de la
        máquina que ejecuta
            <span class="application">natd</span>.</p><p>Por ejemplo los clientes <code class="systemitem">A</code> y
        <code class="systemitem">B</code> se encuentran en la LAN utilizando las direcciones
        IP <code class="systemitem">Â192.168.0.2</code> y
        <code class="systemitem">192.168.0.3</code>, respectivamente.  La
        máquina que ejecuta <span class="application">natd</span> posee la
        dirección IP <code class="systemitem">192.168.0.1</code> en la interfaz que se conecta a la
        LAN.  El <span class="quote">&#8220;<span class="quote">router</span>&#8221;</span> por defecto tanto de <code class="systemitem">A</code>
        omo de <code class="systemitem">B</code> se establece al valor
        <code class="systemitem">192.168.0.1</code>.  La interfaz externa de la
	máquina que ejecuta <span class="application">natd</span>, la interfaz
        que se conecta con Internet, no necesita de ninguna
        especial en relación con el tema que estamos tratando en esta
        sección.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-natdport-redirection"></a>29.13.4. Redirección de puertos</h3></div></div></div><p>El incoveniente que se presenta con la utilización de
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> es que los clientes de la LAN no son accesibles desde
        Internet.  Dichos clientes pueden establecer conexiones con el
        exterior pero no pueden recibir intentos de conexión desde
        pueden recibir intentos de conexion desde Internet.  Esto supone un
        gran problema cuando se quieren ejecutar servicios de acceso global
        en una o varias máquinas de la red LAN.  Una forma sencilla de
        solucionar parcialmente este problemma consiste en redirigir
        determinados puertos en el servidor <span class="application">natd</span>
	hacia determinadas máquinas de la LAN.</p><p>Supongamos por ejemplo que en <code class="systemitem">A</code> se ejecuta un
        servidor de IRC y que en <code class="systemitem">B</code> se ejecuta un servidor
        web.  Para que funcione lo que hemos comentado anteriormente se tienen
        que redirigir las conexiones recibidas en los puertos 6667 (IRC) y
        80 (web) a dichas máquinas, respectivamente.</p><p>Se debe pasar la opción <code class="option">-redirect_port</code> a
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> con los valores apropiados.  La sintaxis es como
        sigue:</p><pre class="programlisting">  -redirect_port proto IPdestino:PUERTOdestino[-PUERTOdestino]
                 [aliasIP:]aliasPUERTO[-aliasPUERTO]
		 [IPremota[:PUERTOremoto[-PUERTOremoto]]]</pre><p>Continuando con el ejemplo anterior los valores serían:</p><pre class="programlisting">    -redirect_port tcp 192.168.0.2:6667 6667
    -redirect_port tcp 192.168.0.3:80 80</pre><p>
        Esto redirigirá los puertos <span class="emphasis"><em>tcp</em></span> adecuados
            a las máquinas situadas en la LAN.</p><p>La opción <code class="option">-redirect_port</code> se puede
        utilizar para indicar rangos de puertos en vez de puertos
        individuales.  Por ejemplo, <em class="replaceable"><code>tcp
        192.168.0.2:2000-3000 2000-3000</code></em> redirige todas las
        conexiones recibidas desde los puertos 2000 al 3000 a los puertos
        puertos 2000 a 3000 de la máquina
            <code class="systemitem">A</code>.</p><p>Estas opciones se pueden utilizar cuando se ejecute
        directamente <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> se pueden situar en la variable
        <code class="literal">natd_flags=""</code> en
        <code class="filename">/etc/rc.conf</code> y también se pueden pasar
        mediante un archivo de configuración.</p><p>Para obtener más información sobre opciones de
        configuración por favor consulte <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a></p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-natdaddress-redirection"></a>29.13.5. Redirección de direcciones</h3></div></div></div><a id="idp84130896" class="indexterm"></a><p>La redirección de direcciones es una característica
        útil si se dispone de varias direcciones IP pero todas ellas se
        ubican en una única máquina.  Gracias a esto
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> puede asignar a cada cliente de la red LAN su propia
        dirección IP externa.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=natd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">natd</span>(8)</span></a> reescribe los paquetes que
        salen de la red LAN con la dirección IP externa adecuada y
        redirige todo el tráfico recibido de vuelta al cliente en
        función de la dirección IP de destino: esto se conoce
        como NAT estático.  Por ejemplo las direcciones IP
        <code class="systemitem">128.1.1.1</code>,
        <code class="systemitem">128.1.1.2</code> y
        <code class="systemitem">128.1.1.3</code> pertenecen al <span class="quote">&#8220;<span class="quote">
        router</span>&#8221;</span> <span class="application">natd</span>.
        <code class="systemitem">128.1.1.1</code> se puede utilizar como la
        dirección IP externa del
        <span class="application">natd</span>, mientras que
        <code class="systemitem">128.1.1.2</code> y
        <code class="systemitem">128.1.1.3</code> se redirigen a los
            clientes <code class="systemitem">A</code> y <code class="systemitem">B</code>, respectivamente.</p><p>La sintaxis de la opción
            <code class="option">-redirect_address</code> es la siguiente:</p><pre class="programlisting">-redirect_address IPlocal IPpública</pre><div class="informaltable"><table border="0"><colgroup><col /><col /></colgroup><tbody><tr><td>IPlocal</td><td>La dirección IP interna del cliente de la LAN.</td></tr><tr><td>IPpública</td><td>La dirección IP externa que se corresponde con un
                determinado cliente de la LAN.</td></tr></tbody></table></div><p>En nuestro ejemplo esta opción se especificaría de la
        siguiente forma:</p><pre class="programlisting">-redirect_address 192.168.0.2 128.1.1.2
-redirect_address 192.168.0.3 128.1.1.3</pre><p>De forma semejante a la opción
        <code class="option">-redirect_port</code> estos argumentos se pueden especificar
        directamente sobre la variable
        <code class="literal">natd_flags=""</code> del fichero
        <code class="filename">/etc/rc.conf</code> o también se pueden pasar
        vía archivo de configuración de
        <span class="application">natd</span>.  Si se utiliza redirección
        de direcciones ya no es necesario utilizar redirección de
        puertos ya que todos los paquetes que se reciben en una determinada
        dirección IP son redirigidos a la máquina
        especificada.</p><p>Las direcciones IP externas de la máquina que ejecuta
        <span class="application">natd</span> se deben activar y deben formar
        parte de un alias configurado sobre la interfaz externa que se conecta
        a Internet.  Consulte <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> para aprender a
        hacerlo.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-ntp.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="network-inetd.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">29.12. NTP </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 29.14. El <span class="quote">&#8220;<span class="quote">Superservidor</span>&#8221;</span> <span class="application">
      inetd</span></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>