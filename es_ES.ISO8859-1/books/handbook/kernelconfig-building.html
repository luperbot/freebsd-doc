<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>8.5. Compilación e instalación de un kernel personalizado</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="kernelconfig.html" title="Capítulo 8. Configuración del kernel de FreeBSD" /><link rel="prev" href="kernelconfig-modules.html" title="8.4. Controladores del kernel, subsistemas y módulos" /><link rel="next" href="kernelconfig-config.html" title="8.6. El fichero de configuración" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">8.5. Compilación e instalación de un kernel personalizado</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kernelconfig-modules.html">Anterior</a> </td><th width="60%" align="center">Capítulo 8. Configuración del kernel de FreeBSD</th><td width="20%" align="right"> <a accesskey="n" href="kernelconfig-config.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-building"></a>8.5. Compilación e instalación de un kernel personalizado</h2></div></div></div><a id="idp72322256" class="indexterm"></a><p>En primer lugar, hagamos un breve recorrido por el directorio
      donde se lleva a cabo la compilación del kernel.  Todos los
      directorios mencionados hacen referencia al directorio principal,
      que es <code class="filename">/usr/src/sys</code>, al que también
      podemos acceder desde <code class="filename">/sys</code>.  Existen gran
      cantidad de subdirectorios que representan diferentes partes del
      kernel, pero el más importante para lo que deseamos hacer son
      <code class="filename">arch</code> y
      <code class="filename">/conf</code>, que es donde se llevara a cabo la
      edición del fichero de configuración y la
      compilación propiamente dicha del mismo,
      el punto de partida para la personalización del kernel. El
      directorio <code class="filename">arch</code>
      representa la arquitectura del sistema, por lo que puede ser
      <code class="filename">i386</code>, <code class="filename">alpha</code>,
      <code class="filename">amd64</code>, <code class="filename">ia64</code>,
      <code class="filename">powerpc</code>, <code class="filename">sparc64</code> o
      <code class="filename">pc98</code> (una arquitectura alternativa, similar a PC
      y muy popular en Japón).  Todo lo que existe dentro de un
      directorio de una arquitectura en particular, es específico
      para dicha arquitectura; el resto del código es común
      para todas las plataformas en las que FreeBSD puede funcionar.
      Observe la organización lógica de la estructura
      de los directorios, con cada dispositivo utilizable en el sistema,
      sistema de ficheros y opciones, cada cosa en su propio
      subdirectorio.</p><p>A lo largo de este capítulo asumiremos que está
       utilizando la arquitectura i386, puesto que sobre ella son los
       ejemplos que vamos a ir exponiendo.  Si no es este su caso debe
       hacer los cambios adecuados a su arquitectura de hardware en las
       rutas que vayamos utilizando.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si <span class="emphasis"><em>no existe</em></span> el directorio
        <code class="filename">/usr/src/sys</code> en su sistema quiere
        decir que no están instaladas las fuentes del
	kernel.  La forma más sencilla de tenerlas es
        mediante <code class="command">/stand/sysinstall</code>.  Como
        usuario <code class="systemitem">root</code> seleccione
        <code class="literal">Configure</code>, luego
        <code class="literal">Distributions</code>, después
        <code class="literal">src</code> y finalmente <code class="literal">sys</code>.
        Si no le gusta mucho
        <span class="application">sysinstall</span> y tiene acceso a un
        CDROM <span class="quote">&#8220;<span class="quote">oficial</span>&#8221;</span> de FreeBSD puede
        instalar las fuentes por medio de la siguiente línea
        de órdenes:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong> /cdrom
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p</code></strong> <code class="filename">/usr/src/sys</code>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s</code></strong> /usr/src/sys /sys
<code class="prompt">#</code> <strong class="userinput"><code>cat /cdrom/sys/ssys.[a-d]* | tar -xzvf</code></strong></pre></div><p>Ahora vaya al al directorio
      <code class="filename">arch/conf</code>
      y copie el fichero de configuración <code class="filename">GENERIC</code>
      con el nombre que desee.  Por ejemplo:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/i386/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC MIKERNEL</code></strong></pre><p>Por tradición el nombre se escribe con mayúsuculas y
      si tiene varias maquinas FreeBSD, con diferente hardware es recomendable
      darle a cada kernel el mismo nombre que la máquina en la que va
      a ejecutarse.  En este ejemplo usaremos el nombre de
      <code class="filename">MIKERNEL</code> .</p><div xmlns="" class="tip"><h3 class="admontitle">Sugerencia: </h3><p xmlns="http://www.w3.org/1999/xhtml">Guardar su fichero de configuración directamente bajo
        el directorio <code class="filename">/usr/src</code>, puede que no sea una
        idea muy astuta.  Si empieza a tener problemas puede ser muy tentador
        borrar <code class="filename">/usr/src</code> y comenzar desde cero.
        Cinco segundos después de haber hecho esto se dará
        cuenta de que ha eliminado el fichero de configuración de
        su kernel, en el que quizás llevaba horas trabajando.</p><p xmlns="http://www.w3.org/1999/xhtml">Le proponemos una alternativa: guardar su fichero de configuración
        cualquier otro sitio y crear un enlace simbólico al fichero
        que hay en el directorio <code class="filename">i386</code>.</p><p xmlns="http://www.w3.org/1999/xhtml">Por ejemplo:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/i386/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /root/kernels</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC /root/kernels/MIKERNEL</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /root/kernels/MIKERNEL</code></strong></pre></div><p>Ahora edite el fichero de configuración
      <code class="filename">MIKERNEL</code> con su editor de textos favorito.
      Si se trata de una instalación reciente probablemente el
      único editor disponible sea <span class="application">vi</span>,
      del cual es complicado explicar su uso detallado en este
      documento, pero existen bastantes libros que detallan su uso; puede
      ver algunos en la <a class="link" href="bibliography.html" title="Capítulo 31. Bibliografía">bibliografía</a>.
      FreeBSD dispone de un editor de uso muy sencillo, llamado
      <span class="application">ee</span>; si es usted principiante le será
      de mucha ayuda.  Cambie los comentarios al principio del fichero
      con algo que refleje los cambios realizados o al menos para
      diferenciarlo del fichero <code class="filename">GENERIC</code>.</p><p>Si ha compilado un kernel en <span class="trademark">SunOS</span>&#8482; o algún otro sistema operativo
      BSD seguramente la mayor parte de fichero le será muy
      familiar.  Si viene usted de otros sistemas
      operativos como DOS, el fichero <code class="filename">GENERIC</code> puede
      parecerle intimidante, así que siga las instrucciones descritas
      en <a class="link" href="kernelconfig-config.html" title="8.6. El fichero de configuración">El Fichero de Configuración
      </a> detenidamente y con sumo cuidado.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Asegúrese siempre de verificar el fichero
        <code class="filename">/usr/src/UPDATING</code> antes de realizar cualquier
        actualización del sistema si ha
        <a class="link" href="cutting-edge.html" title="Capítulo 23. Lo último de lo último">sincronizado sus fuentes</a>
        para disponer de la última versión de los mismos.
        En el fichero <code class="filename">/usr/src/UPDATING</code> está toda
        la información importante sobre las actualizaciones.
        Al distribuirse con FreeBSD dicha información deberá
        estar más actualizada que la que hay en este mismo
	texto.</p></div><p>Ahora es momento de llevar a cabo la compilación del
      código fuente del kernel.</p><div class="procedure"><a id="idp72361936"></a><div class="procedure-title">Procedimiento 8.1. Compilación del kernel</div><ol class="procedure" type="1"><li class="step"><p>Vaya al directorio <code class="filename">/usr/src</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong></pre></li><li class="step"><p>Compile el kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make buildkernel KERNCONF=MIKERNEL</code></strong></pre></li><li class="step"><p>Instale el nuevo kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make installkernel KERNCONF=MIKERNEL</code></strong></pre></li></ol></div><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Es imprescindible que disponga del código fuente completo de FreeBSD
        para poder compilar el kernel.</p></div><div xmlns="" class="tip"><h3 class="admontitle">Sugerencia: </h3><p xmlns="http://www.w3.org/1999/xhtml">Por omisión, si compila un kernel personalizado
	<span class="emphasis"><em>todos</em></span> los módulos del kernel
	serán recompilados también.  Si quiere
	que la actualización de su kernel sea mucho más
	rápida o compilar solamente ciertos módulos
	personalizados, edite kernel modules will be rebuilt as well.
	<code class="filename">/etc/make.conf</code> antes de compilar el
	kernel:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">MODULES_OVERRIDE = linux acpi sound/sound sound/driver/ds1 ntfs</pre><p xmlns="http://www.w3.org/1999/xhtml">Esta variable crea una lista de módulos listos para
      ser compilados, sin tocar los demás.</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">WITHOUT_MODULES = linux acpi sound/sound sound/driver/ds1 ntfs</pre><p xmlns="http://www.w3.org/1999/xhtml">Esta variable crea una lista de módulos que serán
        excluidos del proceso de compilación.  Hay otras variables que
	pueden resultarle útiles durante este proceso; consulte la
	página de manual de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">make.conf</span>(5)</span></a>.</p></div><a id="idp72381136" class="indexterm"></a><p>El nuevo kernel se copiará al directorio raíz
      como <code class="filename">/kernel</code> y el kernel viejo tendrá
      el nombre de <code class="filename">/kernel.old</code>.  Ahora
      reinicie su sistema para poder probar su nuevo kernel.  En caso de que se
      presente algun problema hay algunos consejos para la <a class="link" href="kernelconfig-trouble.html" title="8.7. Qué hacer si algo va mal">resolución de problemas</a> al
      final de este capítulo.  Asegúrese de leer la sección
      que explica cómo recuperar el sistema en caso de que su kernel <a class="link" href="kernelconfig-trouble.html#kernelconfig-noboot">no quiera arrancar</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ciertos ficheros relacionados con el proceso de
	arranque, como <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>y su configuración,
	se guardan en <code class="filename">/boot</code>.  Los módulos
	personalizados o de terceros se suelen guardar en
	<code class="filename">/boot/kernel</code>,
	aunque debe tener presente que es muy importante que
	los módulos y el kernel estén
	sincronizados.  Si intenta usar módulos con un
	kernel para el que no están destinados puede
	haber errores o incluso producirse intesatabilidades.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kernelconfig-modules.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="kernelconfig.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="kernelconfig-config.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">8.4. Controladores del kernel, subsistemas y módulos </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 8.6. El fichero de configuración</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>