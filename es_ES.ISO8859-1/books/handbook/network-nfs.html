<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>29.6. NFS</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="advanced-networking.html" title="Capítulo 29. Networking avanzado" /><link rel="prev" href="network-bridging.html" title="29.5. Puenteado" /><link rel="next" href="network-diskless.html" title="29.7. Ejecución sin disco duro" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.6. NFS</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-bridging.html">Anterior</a> </td><th width="60%" align="center">Capítulo 29. Networking avanzado</th><td width="20%" align="right"> <a accesskey="n" href="network-diskless.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-nfs"></a>29.6. NFS</h2></div><div><span class="authorgroup">Reorganizado y ampliado por <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Escrito por <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Bill</span> <span class="surname">Swingle</span></span>. </span></div></div></div><a id="idp82471248" class="indexterm"></a><p>FreeBSD soporta diversos sistemas de ficheros, uno de los
      cuales es el Sistema de Ficheros en Red, tambíen conocido
      por su acrónimo en inglés <acronym class="acronym">NFS</acronym>.
      <acronym class="acronym">NFS</acronym> permite compartir directorios y ficheros a
      través de la red.  Los usuarios del sistema <acronym class="acronym">
      NFS</acronym> pueden acceder a ficheros que se encuentran
      físicamente en máquinas remotas de una forma
      transparente, como si se tratara de ficheros locales.</p><p>He aquí algunos los beneficios más destacados que
      <acronym class="acronym">NFS</acronym> proporciona:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Las estaciones de trabajo locales utilizan menos espacio de
          disco debido a que los datos se encuentran centralizados en un
          único lugar pero pueden ser accedidos y modificados por
          varios usuarios, de tal forma que no es necesario replicar la
          información.</p></li><li class="listitem"><p>Los usuarios no necesitan disponer de un directorio <span class="quote">&#8220;<span class="quote">
	  home</span>&#8221;</span> en cada una de las máquinas de la
          organización.  Los directorios <span class="quote">&#8220;<span class="quote">home</span>&#8221;</span> pueden
          crearse en el servidor de <acronym class="acronym">NFS</acronym> para posteriormente
	  poder acceder a ellos desde cualquier máquina a través
          de la infraestrutura de red.</p></li><li class="listitem"><p>También se pueden compartir a través de la red
          dispositivos de almacenamiento como disqueteras, CDROM y unidades
          ZIP.  Esto puede reducir la inversión en dichos dispositivos
          y mejorar el aprovechamiento del hardware existente en la
          organización.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82482256"></a>29.6.1. Cómo funciona <acronym class="acronym">NFS</acronym></h3></div></div></div><p>El sistema <acronym class="acronym">NFS</acronym> está dividido al menos en
        dos partes principales: un servidor y uno o más clientes.
        Los clientes acceden de forma remota a los datos que se encuentran
        almacenados en el servidor.  Para que el sistema funcione
        correctamente se deben configurar y ejecutar unos cuantos
        procesos.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">En FreeBSD 5.X se ha reemplazado <span class="application">
          portmap</span> por <span class="application">rpcbind</span>.
          de esta forma para los ejemplos que vamos a comentar a
          continuación se recuerda que en FreeBSD 5.X se debe reemplazar
          cualquier instancia de <span class="application">portmap</span> por
          <span class="application">rpcbind</span>.</p></div><p>El servidor de <acronym class="acronym">NFS</acronym> debe ejecutar los siguientes
        dæmones:</p><a id="idp82507344" class="indexterm"></a><a id="idp82508496" class="indexterm"></a><a id="idp82509392" class="indexterm"></a><a id="idp82510288" class="indexterm"></a><div class="informaltable"><table border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Dæmon</th><th>Descripción</th></tr></thead><tbody><tr><td><span class="application">nfsd</span></td><td>El dæmon<acronym class="acronym">NFS</acronym>, que atiende
                peticiones de clientes <acronym class="acronym">NFS</acronym>.</td></tr><tr><td><span class="application">mountd</span></td><td>El dæmon de montaje de <acronym class="acronym">NFS</acronym>,
                que transporta las peticiones que <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=nfsd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">nfsd</span>(8)</span></a> realiza.</td></tr><tr><td><span class="application">portmap</span></td><td> El dæmon portmapper permite que los clientes
                <acronym class="acronym">NFS</acronym> puedan descubrir qué puerto
                está utilizando el servidor de
                <acronym class="acronym">NFS</acronym>.</td></tr></tbody></table></div><p>El cliente también puede ejecutar un dæmon conocido ,
        como <span class="application">nfsiod</span>.  El dæmon
        <span class="application">nfsiod</span> atiende las peticiones provinientes
        del servidor <acronym class="acronym">NFS</acronym>.  Este dæmon  es opcional y
	sirve para mejorar el rendimiento pero no es necesario para el
        funcionamiento correcto del sistema.  Se recomienda consultar
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=nfsiod&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">nfsiod</span>(8)</span></a> para obtener más información.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-configuring-nfs"></a>29.6.2. Configuración de <acronym class="acronym">NFS</acronym></h3></div></div></div><a id="idp82524496" class="indexterm"></a><p>La configuración de <acronym class="acronym">NFS</acronym> es un proceso
        relativamente sencillo.  Para que los procesos anteriormente descritos
        se ejecuten en tiempo de arranque del sistema, basta con realizar
        paqueñas modificaciones en <code class="filename">/etc/rc.conf</code>.
        </p><p>En <code class="filename">/etc/rc.conf</code> del servidor de
        <acronym class="acronym">NFS</acronym> se deben configurar las siguientes opciones:</p><pre class="programlisting">portmap_enable="YES"
nfs_server_enable="YES"
mountd_flags="-r"</pre><p><span class="application">mountd</span> se ejecuta
        automáticamente cuando se activa el servidor
        <acronym class="acronym">NFS</acronym>.</p><p>En el cliente debemos asegurarnos de que se encuentra activada la
        activada la siguiente opción dentro de <code class="filename">
        /etc/rc.conf</code>:</p><pre class="programlisting">nfs_client_enable="YES"</pre><p>El archivo <code class="filename">/etc/exports</code> especifica los
        directorios o sistemas de ficheros que <acronym class="acronym">NFS</acronym> exporta
        al exterior.  Cada línea dentro de <code class="filename">
	/etc/exports/</code> especifia un sistema de ficheros y qué
        máquinas tienen derechos de acceso sobre dicho sistema.
        Además de los derechos de acceso se pueden definir otras
        opciones de acceso, tales como solo lectura o lectura y escritura.
        Existen multitud de opciones que pueden definirse sobre un directorio
        exportable pero en este manual sólo se van a comentar unas
        pocas.  Consulte <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exports&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">exports</span>(5)</span></a> para obtener una descripción
        más detallada.</p><p>Aquí se muestran algunos ejemplos de entradas para
        <code class="filename">/etc/exports</code>:</p><a id="idp82542032" class="indexterm"></a><p>El siguiente ejemplo proporciona una idea de cómo exportar
        sistemas de ficheros, aunque los parámetros pueden diferir
        dependiendo de su entorno y su configuración de red.  En dicho
        ejemplo, se  exporta el directorio <code class="filename">/cdromm</code> a tres
        máquinas que se encuentran en el mismo dominio que el servidor
        (de ahí que no se especifique ningún nombre de dominio
        para cada máquina) o que pueden estar dadas de alta en
        <code class="filename">/etc/hosts</code>.  En cualquier caso la opción
        <code class="option">-ro</code> configura el sistema de ficheros de red como
        <span class="quote">&#8220;<span class="quote">sólo lectura</span>&#8221;</span> (<span class="quote">&#8220;<span class="quote">read-only</span>&#8221;</span>).
	Con esta opción los sistemas remotos no serán capaces
        de realizar cambios sobre el sistema de ficheros exportados.</p><pre class="programlisting">/cdrom -ro host1 host2 host3</pre><p>La siguiente línea exporta el directorio
        <code class="filename">/home</code> a tres máquinas utilizando
        direcciones IP.  Esto resulta útil cuando disponemos de una red
        privada pero no disponemos de ningún servidor de
        <acronym class="acronym">DNS</acronym> configurado.  También se podría
        configurar <code class="filename">/etc/hosts</code> para que resolviera
        nombres de máquinas internos; consulte <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts</span>(5)</span></a> para
        obtener más información al respecto.  La opción
        <code class="option">-alldirs</code> permite que los subdirectorios del
        directorio <code class="filename">/home</code> tambíen se puedan utilizar
        como puntos de montaje.  En otras palabras, esto permite que los
        clientes puedan trabajar sobre los subdirectorios en los que
        estén realmente interesados.</p><pre class="programlisting">/home  -alldirs  10.0.0.2 10.0.0.3 10.0.0.4</pre><p>La siguiente línea exporta el directorio
        <code class="filename">/a</code> de tal forma que puedan acceder a dicho
        directorio dos máquinas situadas en distintos dominios.  La
        opción  <code class="option">-maproot=root</code> permite que el usuario
        <code class="systemitem">root</code> de la máquina cliente modifique los
        datos del sistema de ficheros en red como si fuera el usuario
        <code class="systemitem">root</code> del servidor.  Si no se especifica la
        opción <code class="option">-maproot=root</code> el usuario
        <code class="systemitem">root</code> del cliente puede no poseer los permisos
        necesarios para realizar modificaciones en el sistema de
	ficheros.</p><pre class="programlisting">/a  -maproot=root  host.example.com box.example.org</pre><p>Para que un cliente pueda acceder al sistema de ficheros exportado
        debe poseer permisos para ello.  Debemos asegurarnos de que el cliente
        se encuentra listado en <code class="filename">/etc/exports</code>.</p><p>Dentro de <code class="filename">/etc/exports</code> cada línea
        representa información de exportación de un sistema de
        ficheros para un determinado conjunto de máquinas.  Una
        máquina sólo  puede aparecer una vez dentro de un
        sistema de ficheros exportable y el archivo sólo puede tener
        una única entrada por defecto.  Por ejemplo, si suponemos que
        <code class="filename">/usr</code> es un único sistema de ficheros la
        siguiente configuración de <code class="filename">/etc/exports</code>
        sería incorrecta:</p><pre class="programlisting">/usr/src   client
/usr/ports client</pre><p>Existe un sistema de ficheros, concretamente
        <code class="filename">/usr</code>, que posee dos líneas con reglas de
        exportación para la misma máquina,
        <code class="systemitem">client</code>. El formato correcto para esta
        situación sería el siguiente:</p><pre class="programlisting">/usr/src /usr/ports  client</pre><p>Las propiedades de un sistemas de ficheros que se exporta al
        exterior deben aparecer agrupadas bajo la misma línea.
        Líneas que no poseen ningún cliente se tratan como si
        tuvieran una única máquina.  Esto limita la forma en que
        pueden configurarse la exportaciones de sistemas de ficheros pero para
        la mayoría de la gente no suele ser un problema.</p><p>El ejemplo que se muestra a continuación es una muestra de
        una lista de exportación correcta, donde <code class="filename">
        /usr</code> y <code class="filename">/exports</code> son sistemas de
        ficheros locales:</p><pre class="programlisting"># Exportar src y ports a cliente01 y cliente02, pero
# solo el cliente01 tiene acceso root
/usr/src /usr/ports -maproot=root    cliente01
/usr/src /usr/ports               cliente02
# Las maquinas cliente tienen acceso root y pueden montar todo lo que aparezca
# en /exports.  Cualquier sistema puede montar /exports/obj en modo
# solo lectura
/exports -alldirs -maproot=root      cliente01 cliente02
/exports/obj -ro</pre><p>Se debe reiniciar el dæmon <span class="application">mountd</span>
        siempre que se modifique el contenido del archivo
        <code class="filename">/etc/exports</code> para que los cambios surtan efecto.
        Esto se realiza enviando la señal HUP al proceso
        <code class="command">mountd</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP `cat /var/run/mountd.pid`</code></strong></pre><p>También se puede reiniciar FreeBSD para que se cargue la
        nueva configuración pero este mecanismo no resulta necesario
        si se ejecutan las órdenes como
        <code class="systemitem">root</code>, que ponen el servidor de
        <acronym class="acronym">NFS</acronym> de nuevo en funcionamiento.</p><p>En el servidor de <acronym class="acronym">NFS</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmap</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>nfsd -u -t -n 4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mountd -r</code></strong></pre><p>En el cliente de <acronym class="acronym">NFS</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>nfsiod -n 4</code></strong></pre><p>En este punto todo debería estar preparado para
        poder anclar el sistema de ficheros remoto en la máquina
        cliente.  En los siguientes ejemplos el nombre del servidor es
        <code class="systemitem">server</code> y el punto de montaje temporal utilizado
        por el cliente es <code class="systemitem">client</code>.  Si se desea montar el
        sistema de ficheros de forma temporal o simplemente comprobar que la
        configuración funciona sin problemas se puede ejecutar una
        orden como la que se muestra a continuación con permisos
        de <code class="systemitem">root</code> en la máquina cliente:</p><a id="idp82594256" class="indexterm"></a><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount server:/home /mnt</code></strong></pre><p>Esta orden ancla el directorio
        <code class="filename">/home</code> del servidor en el directorio
        <code class="filename">/mnt</code> del cliente.  Si todo funciona correctamente
        debería poder entrar en el directorio
        <code class="filename">/mnt</code> del cliente y ver todos los ficheros que se
        encuentran en el directorio <code class="filename">/home</code> del servidor.
        </p><p>Si queremos anclar automáticamente un sistema de ficheros
        remoto cuando la máquina está arrancando se puede
        añadir una línea como la siguiente dentro de
        <code class="filename">/etc/fstab</code>:</p><pre class="programlisting">servidor:/home	/mnt	nfs	rw	0	0</pre><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> comenta todas las opciones disponibles.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82600656"></a>29.6.3. Usos prácticos</h3></div></div></div><p>El protocolo <acronym class="acronym">NFS</acronym> tiene múltiples  usos
        prácticos.  Los más típicos se enumeran a
        continuación:</p><a id="idp82602064" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Compartición de la unidad de CDROM entre varias
            máquinas.  Esto resulta ser más barato y una forma
            más conveniente para instalar software en varias
            máquinas.</p></li><li class="listitem"><p>En grandes redes puede ser más adecuado configurar un
            servidor central de <acronym class="acronym">NFS</acronym> en el cual se
            almacenen todos los <span class="quote">&#8220;<span class="quote">homes</span>&#8221;</span> de los distintos
            usuarios.  Estos directorios se pueden exportar a través de
            la red de tal forma que los usuarios pueden trabajar con el mismo
            directorio independientemente de la máquina que utilicen.
            </p></li><li class="listitem"><p>Varias máquinas pueden poseer el directorio
            <code class="filename">/usr/ports/distfiles</code> compartido.  De
            este modo cuando necesitemos instalar un port en varias
            máquinas, se puede acceder rápidamente a las fuentes
            sin necesidad de bajarlas una vez para cada máquina.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-amd"></a>29.6.4. Anclajes automáticos usando <span class="application">amd</span></h3></div><div><span class="authorgroup">Escrito por <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Wylie</span> <span class="surname">Stilwell</span></span>. </span></div><div><span class="authorgroup">Reescrito por <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div></div></div><a id="idp82615888" class="indexterm"></a><a id="idp82616400" class="indexterm"></a><p>El dæmon <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> (<span class="quote">&#8220;<span class="quote">the automatic mounter
        daemon</span>&#8221;</span>, o dæmon de montaje automático)
	automáticamente ancla un sistema de ficheros remoto cuando se
        tiene que acceder a un fichero perteneciente a dicho sistema. Los
	sistemas de ficheros que permanecen inactivos durante un determinado
        periodo de tiempo son automáticamente desmontados por el mismo
        dæmon.  Este dæmon proporciona una alternativa sencilla a
        la utilización de los montajes permanentes que normalmente se
        especifican a través del fichero <code class="filename">
        /etc/fstab</code>.</p><p><span class="application">amd</span> trabaja actuando como un servidor
        servidor de NFS para los directorios
        <code class="filename">/host</code> y <code class="filename">/net</code>.  Cuando se
        accede a algún fichero ubicado bajo estos directorios
        <span class="application">amd</span> busca el punto de montaje remoto y
        automáticamente lo monta.  El directorio <code class="filename">
        /net</code> se utiliza para anclar sistemas de ficheros remotos
        especificados mediante direcciones IP, mientras que el directorio
        <code class="filename">/host</code> almacena aquellos sistemas de ficheros
        remotos que han sido especificados mediante un nombre de
        máquina.</p><p><span class="application">amd</span> detecta cualquier intento
        de acceder a un fichero dentro del directorio
	<code class="filename">/host/foobar/usr</code> y se encarga de montar
        el sistema de ficheros remoto (<code class="filename">/usr</code>)
        en la máquina, en caso de que no estuviera ya
        anclado.</p><div class="example"><a id="idp82627024"></a><div class="example-title">Ejemplo 29.1. Anclaje de una exportación utilizando
          <span class="application">amd</span></div><div class="example-contents"><p><code class="command">showmount</code> muestra los
          puntos de montaje que posee una máquina remota. Por ejemplo
          para conocer los montajes de un máquina llamada
          <code class="systemitem">foobar</code>, se puede utilizar:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>showmount -e foobar</code></strong>
Exports list on foobar:
/usr                               10.10.10.0
/a                                 10.10.10.0
<code class="prompt">%</code> <strong class="userinput"><code>cd /host/foobar/usr</code></strong></pre></div></div><br class="example-break" /><p>Como se observa en el ejemplo,
        <code class="command">showmount</code> muestra el directorio
        <code class="filename">/usr</code>
        como una exportación.  Cuando se cambia el directorio actual
        al directorio <code class="filename">/host/foobar/usr</code> el dæmon
        <span class="application">amd</span> intenta resolver el nombre
        <code class="systemitem">foobar</code> y automáticamente ancla el sistema
        de ficheros remoto.</p><p>El dæmon <span class="application">amd</span> se puede ejecutar
        a partir de los scripts de inicio, utilizando la siguiente
        línea del archivo de configuración
        <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">amd_enable="YES"</pre><p>Además, <span class="application">amd</span> soporta opciones
        adicionales que pueden definirse mediante la variable
      <code class="varname">amd_flags</code>. Por defecto, la variable
        <code class="varname">amd_flags</code> posee las siguientes opciones:</p><pre class="programlisting">amd_flags="-a /.amd_mnt -l syslog /host /etc/amd.map /net /etc/amd.map"</pre><p>El archivo <code class="filename">/etc/amd.map</code> define las opciones
        por defecto con las cuales se anclan los sistemas de ficheros
        remotos. El archivo <code class="filename">/etc/amd.conf</code> define algunas
        características avanzadas para el dæmon
        <span class="application">amd</span>.</p><p>Se ruega consultar las páginas del manual de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> y
        de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">amd.conf</span>(5)</span></a> para obtener más información.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-nfs-integration"></a>29.6.5. Problemas de integración con otras plataformas</h3></div><div><span class="authorgroup">Escrito por  <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">John</span> <span class="surname">Lind</span></span>. </span></div></div></div><p>Determinados adaptadores Ethernet para sistemas basados en
        el bus ISA poseen restricciones que pueden producir serios problemas
        de red, en particular con el protocolo NFS.  Estos problemas no son
        específicos de FreeBSD, pero los sistemas FreeBSD se ven
        afectados por ellos.</p><p>El problema surge casi siempre cuando el sistema (FreeBSD)
        está empotrado dentro de una red compuesta por estaciones de
        trabajo de alto rendimiento, como por ejemplo estaciones de Silicon
        Graphics y de Sun Microsystems.  El montaje del sistema de ficheros
        remoto suele funcionar perfectamente y algunas operaciones sobre el
        el sistema de ficheros pueden tener éxito pero de repente el
        el servidor que no responde a las peticiones del cliente, aunque
        peticiones y respuestas de otros clientes funcionan con normalidad y
        se continúan procesando.  Esto sucede en los sistemas clientes,
        tanto en sistemas FreeBSD como en otras estaciones de trabajo.
        En muchos sistemas, lo único que se puede hacer es resetear
        la máquina de forma abrupta, ya que el bloqueo producido por el
        protocolo NFS no se puede solucionar.</p><p>Aunque la solución <span class="quote">&#8220;<span class="quote">correcta</span>&#8221;</span> consiste en
        obtener un adaptador Ethernet con mayor rendimiento y capacidad,
        todavía se puede aplicar un parche sencillo que puede llegar a
        permitir un funcionamiento sin problemas. Si el sistema FreeBSD
        actúa como servidor de <span class="emphasis"><em>NFS</em></span> se puede
        incluír la opción <code class="option">w=1024</code> cuando el
        ejecute una petición de montaje sobre dicho servidor.  Si FreeBSD
        dicho servidor. Si FreeBSD actúa como cliente de
        <span class="emphasis"><em>NFS</em></span>, se puede ejecutar <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> con el
        parámetro <code class="option">-r=1024</code>.  Estas opciones se pueden
        especificar en el <code class="filename">/etc/fstab</code> del cliente para que
	entren en funcionamiento cuando se realicen montajes
        automáticos y también se puede utilizar el
	parámetro <code class="option">-o</code> de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> cuando se
        realicen montajes manuales.</p><p>Resulta apropiado resaltar que existe un problema totalmente
        distinto que algunas veces se confunde con el que acabamos de
        describir, que aparece cuando el servidor y los clientes se encuentran
        en redes diferentes. Si nos encontramos en esta situación
        debemos <span class="emphasis"><em>asegurarnos</em></span> de que nuestros <span class="quote">&#8220;<span class="quote">
	routers</span>&#8221;</span> están encaminando correctamente los paquetes
        UDP que genera el protocolo <acronym class="acronym">NFS</acronym> pues en caso
	contrario el sistema no funcionará, independientemente de los
        ajustes que se realicen en el cliente o en el servidor.</p><p>En los siguientes ejemplos <code class="systemitem">fastws</code> es el nombre de
        una estación de trabajo de altas prestaciones y <code class="systemitem">
	freebox</code> es el nombre de un sistema FreeBSD con un adaptador
        Ethernet de bajas prestaciones.  Se pretende además exportar el
        directorio <code class="filename">/sfcompartido</code> (ver <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exports&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">exports</span>(5)</span></a>) y
        el directorio <code class="filename">/projecto</code>.  Tenga en cuenta que en
        cualquier caso puede resultar útil definir opciones adicionales
        a las que que se muestran en el siguiente ejemplo, como pueden ser
        <code class="option">hard</code>, <code class="option">soft</code> o
        <code class="option">bg</code>.  Esto dependerá de la aplicación
        que utilice el sistema de ficheros remoto.</p><p>Ejemplos de configuración para el sistema FreeBSD
        (<code class="systemitem">freebox</code>) que actúa como cliente.
        Configuración del archivo
        <code class="filename">/etc/fstab</code> de
        <code class="systemitem">freebox</code>:</p><pre class="programlisting">fastws:/sfcompartido /projecto nfs rw,-r=1024 0 0</pre><p>Orden de ejecución manual para
        <code class="systemitem">freebox</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -t nfs -o -r=1024 fastws:/sfcompartido /projecto</code></strong></pre><p>Ejemplos de configuración para el sistema FreeBSD que
        actúa como servidor. Configuración de
        <code class="filename">/etc/fstab</code> de <code class="systemitem">fastws</code>:</p><pre class="programlisting">freebox:/sfcompartido /projecto nfs rw,-w=1024 0 0</pre><p>Orden de ejecución manual para
        <code class="systemitem">fastws</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -t nfs -o -w=1024 freebox:/sfcompartido /projecto</code></strong></pre><p>Casi cualquier adaptador Ethernet de 16 bits permite operar sin
        operar sin las restricciones anteriores sobre el tamaño de
        lectura o escritura especificado por defecto.</p><p>Por si alguien estuviera interesado a continuación se
        muestra el error que aparece en estos casos, lo cual explica por
        qué decimos que el error resulta irrecuperable.  NFS trabaja
        típicamente con un tamaño de <span class="quote">&#8220;<span class="quote">bloque</span>&#8221;</span>
        de 8 K (aunque se pueden producir fragmentos de menor
        tamaño).  Debido a que el máximo tamaño de los
        paquetes Ethernet se encuentra alrededor de los 1500 bytes el
        <span class="quote">&#8220;<span class="quote">bloque</span>&#8221;</span> de NFS se trocea en varios paquetes Ethernet
        aunque desde el punto de vista del protocolo NFS se trata como si
        fuese un único paquete.  Los trozos deben reensamblarse en el
        destino y se debe enviar una <span class="emphasis"><em>confirmación</em></span>
        para el bloque recibido.  Las estaciones de trabajo de altas
	prestaciones pueden soltar paquetes NFS de forma contínua uno
        después de otro, lo más juntos posible.  Por otro lado
        en las tarjetas de red más pequeñas y de menor
        capacidad puede ocurrir que un paquete recien llegado a la tarjeta
        sobreescriba información perteneciente a un paquete anterior
        antes de que llegue a ser transmitido completamente, de tal forma que
	al recibirse el bloque NFS no puede ser ni reconstruido ni
        ni reconocido.  Como resultado de este proceso la máquina
        tratará de enviar el mismo paquete transcurridos unos instantes
        de espera, pero se tratarán de enviar de nuevo los 8 K
        que constituyen un bloque NFS, y de esta forma se repetirá el
        el proceso, así hasta el infinito.</p><p>Si se mantiene el tamaño del bloque por debajo del
        tamaño de paquete máximo de Ethernet, podemos asegurar
        que cualquier paquete Ethernet transporta un bloque NFS, el cual
        puede asentirse individualmente, evitando así la
        explosión de paquetes y el eventual bloqueo del sistema.</p><p>Desbordamientos circulares del <span class="quote">&#8220;<span class="quote">buffer</span>&#8221;</span> (<span class="quote">&#8220;<span class="quote">
        overruns</span>&#8221;</span>) pueden producirse si nos encontramos con una
        estación de trabajo de altas prestaciones que envía
        contínuamente mucho tráfico a un sistema convencional,
	pero con tarjetas Ethernet de buena calidad, estos desbordamientos
        resultan altamente improbables para el caso de los tamaños de
	bloque por defecto generados por el sistema NFS.  Cuando se produce un
        desbordamiento, las unidades afectadas se retransmiten, y
        existe una gran probabilidad de que se reciban, se reensamblen
        y se confirmen.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-bridging.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="network-diskless.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">29.5. Puenteado </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 29.7. Ejecución sin disco duro</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>