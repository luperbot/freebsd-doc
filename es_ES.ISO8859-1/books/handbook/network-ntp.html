<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>29.12. NTP</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="advanced-networking.html" title="Capítulo 29. Networking avanzado" /><link rel="prev" href="network-dns.html" title="29.11. DNS" /><link rel="next" href="network-natd.html" title="29.13. Traducción de direcciones de red" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.12. NTP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-dns.html">Anterior</a> </td><th width="60%" align="center">Capítulo 29. Networking avanzado</th><td width="20%" align="right"> <a accesskey="n" href="network-natd.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ntp"></a>29.12. NTP</h2></div><div><span class="authorgroup">Escrito por <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Hukins</span></span>. </span></div></div></div><a id="idp83971408" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83971920"></a>29.12.1. Resumen</h3></div></div></div><p>Según pasa el tiempo el reloj de un computador está
        expuesto a ligeros desplazamientos.  NTP (Protocolo de Hora
        en Red, en inglés <span class="quote">&#8220;<span class="quote">Network Time Protocol</span>&#8221;</span>) es
        un protocolo que permite asegurar la exactitud de nuestro reloj.</p><p>Existen varios servicios de internet que confían y se pueden
        beneficiar de relojes de computadores precisos.  Por ejemplo un
        servidor web puede recibir peticiones de un determinado fichero si ha
        sido modificado posteriormente a una determinada fecha u hora.
        Servicios como <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> ejecutan órdenes en determinados
        instantes.  Si el reloj no se encuentra ajustado estas órdenes
        pueden ejecutarse fuera de la hora prevista.</p><a id="idp83974608" class="indexterm"></a><p>FreeBSD viene con el servidor NTP <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> que se puede utilizar
        para preguntar a otros servidores NTP, de tal forma que podemos
        ajustar nuestro reloj según la hora de otros servidores e
        incluso proporcionar servicio de hora nosotros mismos.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83977040"></a>29.12.2. Elección de los servidores de hora adecuados</h3></div></div></div><a id="idp83977680" class="indexterm"></a><p>Para sincronizar nuestro reloj necesitamos comunicarnos con uno o
         más servidores NTP.  El administrador de nuestra red o nuestro
         proveedor de servicios de Internet muy posiblemente hayan configurado
         algún servidor NTP para estos propósitos.  Consulte la
         documentación de que disponga.  Existe una <a class="link" href="http://www.eecis.udel.edu/~mills/ntp/servers.html" target="_top">lista de
         servidores NTP públicamente accesibles</a> que se pueden
         utilizar para buscar un servidor NTP que se encuentre
         geográficamente próximo.  Asegúrese de que conoce
         la política de uso de estos servidores públicos ya que
	 en algunos casos es necesario pedir permiso al administrador antes de
         de poder utilizarlos, principalmente por motivos
         estadísticos.</p><p>Le recomendamos seleccionar servidores NTP que no se encuentren
        conectados entre sí por si alguno de los servidores que use
	sea inaccesible o su reloj se averíe. <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> utiliza las
        respuestas que recibe de otros servidores de una forma inteligente.
        servidores de una forma inteligente (Tiene a hacer más caso a
        los más fiables.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83989456"></a>29.12.3. Configuración de la máquina</h3></div></div></div><a id="idp83990096" class="indexterm"></a><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83991248"></a>29.12.3.1. Configuración básica</h4></div></div></div><a id="idp83991888" class="indexterm"></a><p>Si sólamente deseamos sincronizar nuestro reloj cuando
          se arranca la máquina se puede utilizar <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a>.
          Esto puede ser adecuado en algunas máquinas de escritorio que
          se reinician frecuentemente y donde la sincronización no suele
          ser un objetivo prioritario pero normalmente la mayoría de las
          máquinas deberían ejecutar <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a>.</p><p>La utilización de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> en tiempo de arranque
          es también una buena idea incluso para las máquinas que
          ejecutan <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a>.  El programa <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> modifica el reloj de
          forma gradual, mientras que <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> ajusta directamente el
          reloj sin importar que tamaño tenga la diferencia de tiempo
          existente entre la máquina y el servidor de tiempo de
          referencia.</p><p>Para activar <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> en tiempo de arranque, añada
	  <code class="literal">ntpdate_enable="YES"</code> al fichero
	  <code class="filename">/etc/rc.conf</code>.  También es necesario
          especificar todos los servidores que deseamos utilizar para
          realizar el proceso de sincronización y cualquier
          parámetro que deseemos pasar a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a>
          utilizando la variable <code class="varname">ntpdate_flags</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84005200"></a>29.12.3.2. Configuración general</h4></div></div></div><a id="idp84005840" class="indexterm"></a><p>NTP se configura mediante el archivo
	  <code class="filename">/etc/ntp.conf</code> utilizando el formato descrito en
          <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a>.  A continuación se muestra un sencillo
          ejemplo:</p><pre class="programlisting">server ntplocal.ejemplo.com prefer
server timeserver.ejemplo.org
server ntp2a.ejemplo.net

driftfile /var/db/ntp.drift</pre><p>La opción <code class="literal">server</code> especifica qué
          servidores se van a utilizar, especificando un servidor por
          línea.  Si se especifica un servidor con el argumento
          <code class="literal">prefer</code>, como en <code class="systemitem">ntplocal.ejemplo.com</code> dicho servidor se prefiere
          sobre los demás.  No obstante la respuesta de su servidor
          preferido se descartará si difiere sustancialmente de la
          respuesta recibida por parte del resto de los servidores
          especificados; en caso contrario sólo se tendrá en
          cuenta la respuesta del servidor preferido sin importar la
	  información suministrada por el resto.  El argumento
          <code class="literal">prefer</code> se utiliza normalmente en servidores NTP
          altamente precisos, como aquellos que poseen hardware de tiempo
          específico.</p><p>La opción <code class="literal">driftfile</code> especifica
	  qué fichero se utiliza para almacenar el desplazamiento de
          la fracuencia de reloj de la máquina.  El programa
          <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> utiliza este valor para automáticamente
          compensar el desvío que experimenta de forma natural el reloj
          de la máquina, permitiendo mantener una precisión
          acotada incluso cuando se pierde la comunicación con el resto
          de referencias externas.</p><p>La opción <code class="literal">driftfile</code> especifica
	  qué fichero se utiliza para almacenar la información
          sobre espuestas anteriores de servidores NTP.  Este fichero
          contiene información útil para la implementación
          de NTP.  No debería ser modificada por ningún otro
          proceso.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84013776"></a>29.12.3.3. Control de acceso al servidor NTP</h4></div></div></div><p>Por defecto nuestro servidor de NTP puede ser accedido por
          cualquier máquina de Internet.  La opción
          <code class="literal">restrict</code> se puede utilizar para controlar
          controlar qué máquinas pueden acceder al
          servicio.</p><p>Si queremos denegar el acceso a todas las máquinas
          existentes basta con añadir la siguiente línea a
	  <code class="filename">/etc/ntp.conf</code>:</p><pre class="programlisting">restrict default ignore</pre><p>Si sólo queremos permitir el acceso al servicio de hora
          a las máquinas de nuestra red y al menos tiempo nos queremos
          asegurar de que dichos clientes no pueden a su vez configurar la
          hora del servidor o utilizarse ellos mismos como nuevos servidores
          de hora basta con añadir lo siguiente en lugar de lo
          anterior:</p><pre class="programlisting">restrict 192.168.1.0 mask 255.255.255.0 notrust nomodify notrap</pre><p>donde <code class="systemitem">192.168.1.0</code> es la
          dirección IP de nuestra red y <code class="systemitem">255.255.255.0</code> es la máscara de
	  red.</p><p><code class="filename">/etc/ntp.conf</code> puede contener varias
          opciones de tipo <code class="literal">restrict</code>.  Para más
          detalles consulte la sección <code class="literal">Soporte de Control de
          Acceso</code> de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84025168"></a>29.12.4. Ejecución del servidor de NTP</h3></div></div></div><p>Para asegurarnos de que el servidor de NTP se ejecuta en tiempo de
        arranque se debe añadir la línea <code class="literal">
        xntpd_enable="YES"</code> al fichero
	<code class="filename">/etc/rc.conf</code>.  Si deseamos pasar opciones
        adicionales a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> se puede modificar la variable
        <code class="varname">xntpd_flags</code> del fichero
	<code class="filename">/etc/rc.conf</code>.</p><p>Para ejecutar el servidor sin reiniciar la máquina ejecute
	<code class="command">ntpd</code> junto con todos aquellos parámetros que
        haya especificado en la variable de arranque
        <code class="varname">xntpd_flags</code> del fichero
	<code class="filename">/etc/rc.conf</code>.  Por ejemplo:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ntpd -p /var/run/ntpd.pid</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Bajo FreeBSD 5.X se han renombrado algunas opciones del
          fichero <code class="filename">/etc/rc.conf</code>.  Se debe reemplazar
          cualquier aparición <code class="literal">xntpd</code> por
          por <code class="literal">ntpd</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84037200"></a>29.12.5. Utilización de ntpd junto con una conexión temporal
        a Internet</h3></div></div></div><p>El programa <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> no necesita una conexión
        permanente a Internet para poder funcionar correctamente.  No obstante
        si la conexión a Internet se encuentra configurada con
        marcación bajo demanda es una buena idea impedir que el
        tráfico de NTP lance una marcación automática o
        que mantenga la conexión viva.  Si se utiliza el PPP de
        entorno de usuario se pueden utilizar las directivas
        <code class="literal">filter</code> dentro del fichero
        <code class="filename">/etc/ppp/ppp.conf</code> para evitar esto. Por
        ejemplo:</p><pre class="programlisting"> set filter dial 0 deny udp src eq 123
 # Evita que el trÃ¡fico NTP inice una llamada saliente
 set filter dial 1 permit 0 0
 set filter alive 0 deny udp src eq 123
 Evita que el trÃ¡ficoNTP entrante mantenga abierta la conexiÃ³n
 set filter alive 1 deny udp dst eq 123
 Evita que el trÃ¡fico NTP saliente mantenga abierta la conexiÃ³n
 set filter alive 2 permit 0/0 0/0</pre><p>Para ás detalles consulte la sección
        <code class="literal">PACKET FILTERING</code> de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> y los ejemplos que
        se encuentran en
	<code class="filename">/usr/share/examples/ppp/</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Algunos proveedores de acceso a Internet bloquean paquetes que
          utilizan números de puertos bajos impidiendo que los paquetes
          de vuelta alcancen nuestra máquina.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84055376"></a>29.12.6. Información adicional</h3></div></div></div><p>Hay documentación sobre el servidor NTP en formato HTML en
        <code class="filename">/usr/share/doc/ntp/</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-dns.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="network-natd.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">29.11. DNS </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 29.13. Traducción de direcciones de red</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>