<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>25.3. Uso de Kernel PPP</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="ppp-and-slip.html" title="Capítulo 25. PPP y SLIP" /><link rel="prev" href="userppp.html" title="25.2. Uso de User PPP" /><link rel="next" href="pppoe.html" title="25.4. Uso de PPP sobre Ethernet (PPPoE)" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">25.3. Uso de Kernel PPP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="userppp.html">Anterior</a> </td><th width="60%" align="center">Capítulo 25. PPP y SLIP</th><td width="20%" align="right"> <a accesskey="n" href="pppoe.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ppp"></a>25.3. Uso de Kernel PPP</h2></div><div><span class="authorgroup">Partes originalmente desarrolladas por  <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Gennady B.</span> <span class="surname">Sorokopud</span></span> y <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Robert</span> <span class="surname">Huff</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80558416"></a>25.3.1. Configurando Kernel PPP</h3></div></div></div><a id="idp80559056" class="indexterm"></a><p>Antes de comenzar a configurar PPP en su maquina,
        asegurese de <code class="command">pppd</code> se localiza en
        <code class="filename">/usr/sbin</code> y de que existe el directorio
        <code class="filename">/etc/ppp</code>.</p><p><code class="command">pppd</code> puede trabajar de dos maneras</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Como un <span class="quote">&#8220;<span class="quote">cliente</span>&#8221;</span> &#8212; cuando desea conectar
	    su maquina al mundo exterior utilizando PPP, por medio de una
	    conexión serial o bien una línea de modem.</p></li><li class="listitem"><a id="idp80567888" class="indexterm"></a><p>como un <span class="quote">&#8220;<span class="quote">servidor</span>&#8221;</span> &#8212; cuando su maquina esta
	    conectada a una red y es utilizada para que otras maquinas se
	    conecten utilizando ppp.</p></li></ol></div><p>En ambos casos, será necesario configurar un
        fichero de opciones (<code class="filename">/etc/ppp/options</code> o bien
        <code class="filename">~/.ppprc</code> si se cuenta con más de un
        usuario que utilizará ppp en la misma maquina.</p><p>También deberá de contar con un software para
        hacer la conexión por medio de módem (de
        preferencia kermit), de manera que pueda hacer la conexión
        con un host remoto.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80571344"></a>25.3.2. Uso de <code class="command">pppd</code> como Cliente</h3></div><div><span class="authorgroup">Basedo en información provista por <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Trev</span> <span class="surname">Roydhouse</span></span>. </span></div></div></div><a id="idp80574288" class="indexterm"></a><a id="idp80575056" class="indexterm"></a><p>El siguiente archivo de configuración
        <code class="filename">/etc/ppp/options</code> puede utilizarse para
        realizar la conexión a una terminal CISCO, por medio
        de PPP.</p><pre class="programlisting">crtscts         # habilita el flujo de controls de hardware
modem           # línea de control del modem
noipdefault     # el servidor PPP remoto asignará la dirección IP
                # si el servidor no envia una dirección IP durante IPCP
                # remueva esta opción.
passive         # espere por los paquetes LCP
domain ppp.foo.com      # escriba su nombre de dominio aqui

:&lt;remote_ip&gt;    # escriba la IP del host remoto aqui
                # este será utilizado para el ruteo de paquetes por medio
                # de PPP, si no especifica esta opción, cambie la
                # línea a quedar  &lt;local_ip&gt;:&lt;remote_ip&gt;

defaultroute    # establezca esta opción si el servidor su ruteador
                # por default</pre><p>Para conectarse:</p><a id="idp80577104" class="indexterm"></a><a id="idp80577616" class="indexterm"></a><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Realice el llamado al host remoto, utilizando kermit
	    (o cualquier otra aplicación de este tipo), ingrese su
	    nombre de usuario y contraseña (o cualquier info que
	    sea necesaria para habilitar PPP en el host remoto).</p></li><li class="step"><p>Salga de kermit (sin colgar la línea).</p></li><li class="step"><p>Ingrese lo siguiente:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/src/usr.sbin/pppd.new/pppd /dev/tty01 19200</code></strong></pre><p>Asegurese de utilizar el dispositivo y la velocidad adecuados.</p></li></ol></div><p>Ahora su computadora esta conectada por medio de PPP. Si la
        conexión falla, puede añadir la opción
        <code class="option">debug</code> en el fichero <code class="filename">/etc/ppp/options</code>
        de tal forma que pueda verificar la que esta ocurriendo y pueda
        resolver el problema.</p><p>El siguiente script; <code class="filename">/etc/ppp/pppup</code>
        realizará los 3 pasos de forma automática:</p><pre class="programlisting">#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.dial
pppd /dev/tty01 19200</pre><a id="idp80584528" class="indexterm"></a><p>El fichero <code class="filename">/etc/ppp/kermit.dial</code> es un
        script de kermit, uqe realiza el marcado y negocia la
        autorización necesaria con el host remoto (un ejemplo de
        este script se encuentra al final de este documento).</p><p>Utilice el siguiente script, llamado
        <code class="filename">/etc/ppp/pppdown</code> para desconectar la
        línea PPP:</p><pre class="programlisting">#!/bin/sh
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ X${pid} != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill -TERM ${pid}
fi

ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

/sbin/ifconfig ppp0 down
/sbin/ifconfig ppp0 delete
kermit -y /etc/ppp/kermit.hup
/etc/ppp/ppptest</pre><p>Verifique que su PPP aun se esta ejecutando, por medio de
	    <code class="filename">/usr/etc/ppp/ppptest</code>, que deberá verse
	    algo similar a esto:</p><pre class="programlisting">#!/bin/sh
pid=`ps ax| grep pppd |grep -v grep|awk '{print $1;}'`
if [ X${pid} != "X" ] ; then
        echo 'pppd running: PID=' ${pid-NONE}
else
        echo 'No pppd running.'
fi
set -x
netstat -n -I ppp0
ifconfig ppp0</pre><p>Para colgar el módem, ejecute
	<code class="filename">/etc/ppp/kermit.hup</code>, que deberá
	contener:</p><pre class="programlisting">set line /dev/tty01	; aqui va el dispositivo del modem
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
echo \13
exit</pre><p>He aqui un metodo alterno, donde se utiliza <code class="command">chat</code>
	    en lugar de utilizar <code class="command">kermit</code>.</p><p>Los siguientes dos ficheros deben ser suficiente, para realizar
        una conexión por medio de <code class="command">pppd</code>.</p><pre class="programlisting">/dev/cuaa1 115200

crtscts		# habilita el control de flujo por medio de hardware
modem		# línea de control del módem
connect "/usr/bin/chat -f /etc/ppp/login.chat.script"
noipdefault	# el servidor remoto debe asignar la dirección IP.
	        # si el servidor no asigna una IP durante la negociación
                # IPCP , remueva esta línea y espere por los
passive         # paquetes LCP
domain &lt;your.domain&gt;	# aqui va su dominio

:		# escriba la IP del host remoto aqui
                # si no ha especificado la opción noipdefault
                # cambie esta línea a quedar &lt;local_ip&gt;:&lt;remote_ip&gt;

defaultroute	# escriba esto, si desea que el servidor PPP sea su
	            # router por default</pre><p><code class="filename">/etc/ppp/login.chat.script</code>:</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Lo siguiente debe ir en una sola línea.</p></div><pre class="programlisting">ABORT BUSY ABORT 'NO CARRIER' "" AT OK ATDT&lt;numero.de.telefono&gt;
  CONNECT "" TIMEOUT 10 ogin:-\\r-ogin: &lt;nombre.usuario&gt;
  TIMEOUT 5 sword: &lt;contraseña&gt;</pre><p>Una vez que estos ficheros han sido modificados correctamente e
        instalados, todo lo que necesita es ejecutar el comando
	    <code class="command">pppd</code>, algo como:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pppd</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80603472"></a>25.3.3. Uso de <code class="command">pppd</code> como Servidor</h3></div></div></div><p>El fichero <code class="filename">/etc/ppp/options</code> debe
        contener algo similar a lo siguiente:</p><pre class="programlisting">crtscts   # control de flujo por Hardware
netmask 255.255.255.0           # mascara de red (no es requisito)
192.114.208.20:192.114.208.165  # direcciones ip del host local y remoto
                                # la dirección ip local debe ser
                                # diferente a la que le haya asignado a su
                                # dispositivo de red ethernet (u otro)
                                # la dirección ip remota que será
                                # asignada a la maquina remota
domain ppp.foo.com              # su dominio
passive                         # espera por LCP
modem                           # línea de modem</pre><p>El siguiengte script, llamado <code class="filename">/etc/ppp/pppserv</code>
        habilitará <span class="application">pppd</span>, para que actue como
        servidor:</p><pre class="programlisting">#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

# reset ppp interface
ifconfig ppp0 down
ifconfig ppp0 delete

# enable autoanswer mode
kermit -y /etc/ppp/kermit.ans

# run ppp
pppd /dev/tty01 19200</pre><p>Utilice el script <code class="filename">/etc/ppp/pppservdown</code>
        para detener el servidor:</p><pre class="programlisting">#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi
ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.noans</pre><p>El siguiente script de kermit
	    (<code class="filename">/etc/ppp/kermit.ans</code>) habilita/deshabilita
	    el modo de autorespuesta en su módem. Y debe verse algo similar
	    a lo siguiente:</p><pre class="programlisting">set line /dev/tty01
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
inp 5 OK
echo \13
out ATS0=1\13   ; cambiar esto a quedar out ATS0=0\13 si desea deshabilitar el modo
                ; de autorespuesta
inp 5 OK
echo \13
exit</pre><p>Un script llamado <code class="filename">/etc/ppp/kermit.dial</code> es
        utilizado para llamar y autentificarse en un host remoto. Es
        necesario que edite este fichero, de acuerdo a sus necesidades.
        Escriba su nombre de usuario (login) y contraseña (password)
        en este fichero, también será necesario cambiar su
        metodo de conexión, de acuerdo a lo que se ajuste a sus
        necesidades.</p><pre class="programlisting">;
; ingrese el dispositivo que esta apuntando a su módem:
;
set line /dev/tty01
;
; escriba la velocidad del módem:
;
set speed 19200
set file type binary            ; full 8 bit file xfer
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none
set modem hayes
set dial hangup off
set carrier auto                ; Posteriormente SET CARRIER si es necesario
set dial display on             ; despues SET DIAL si es necesario
set input echo on
set input timeout proceed
set input case ignore
def \%x 0
goto slhup

:slcmd                          ; cambio a modo de comando
echo Put the modem in command mode.
clear                           ; Limpieza del buffer de entrada
pause 1
output +++
input 1 OK\13\10                ; esperar para OK
if success goto slhup
output \13
pause 1
output at\13
input 1 OK\13\10
if fail goto slcmd              ; si el modem no responde Ok, intentar de nuevo

:slhup                          ; colgar el teléfono
clear                           ; Limpieza del buffer de entrada
pause 1
echo Hanging up the phone.
output ath0\13
input 2 OK\13\10
if fail goto slcmd              ; si no hay un OK como respuesta, poner el modem en modo de comando

:sldial                         ; marcar el numero telefonico
pause 1
echo Dialing.
output atdt9,550311\13\10               ; escriba el numero de telefono
assign \%x 0                    ; asignar cero al contador

:look
clear                           ; Limpieza del buffer de entrada
increment \%x                   ; Conteo de segundos
input 1 {CONNECT }
if success goto sllogin
reinput 1 {NO CARRIER\13\10}
if success goto sldial
reinput 1 {NO DIALTONE\13\10}
if success goto slnodial
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if &lt; \%x 60 goto look
else goto slhup

:sllogin                        ; login
assign \%x 0                    ; asignar cero al contador
pause 1
echo Looking for login prompt.

:slloop
increment \%x                   ; Conteo de segundos
clear                           ; Limpieza del buffer de entrada
output \13
;
; escriba su login prompt aqui:
;
input 1 {Username: }
if success goto sluid
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if &lt; \%x 10 goto slloop         ; intentar 10 veces para obtener un login
else goto slhup                 ; colgar y empezar de nuevo si a la decima falla

:sluid
;
; escriba su nombre de usuario:
;
output ppp-login\13
input 1 {Password: }
;
; escriba su contraseña:
;
output ppp-password\13
input 1 {Entering SLIP mode.}
echo
quit

:slnodial
echo \7No dialtone.  Check the telephone line!\7
exit 1

; local variables:
; mode: csh
; comment-start: "; "
; comment-start-skip: "; "
; end:</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="userppp.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="ppp-and-slip.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="pppoe.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">25.2. Uso de User PPP </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 25.4. Uso de <span class="application">PPP</span> sobre Ethernet (PPPoE)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>