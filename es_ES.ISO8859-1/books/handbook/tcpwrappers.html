<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>14.6. TCP Wrappers</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="security.html" title="Capítulo 14. Seguridad" /><link rel="prev" href="one-time-passwords.html" title="14.5. Contraseñas de un solo uso" /><link rel="next" href="kerberosIV.html" title="14.7. KerberosIV" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.6. TCP Wrappers</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="one-time-passwords.html">Anterior</a> </td><th width="60%" align="center">Capítulo 14. Seguridad</th><td width="20%" align="right"> <a accesskey="n" href="kerberosIV.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="tcpwrappers"></a>14.6. TCP Wrappers</h2></div><div><span class="authorgroup">Escrito por: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp75430864" class="indexterm"></a><p>Cualquiera que esté familiarizado con <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>
      probablemente haya oído hablar de
      <acronym class="acronym">TCP</acronym> Wrappers, pero poca gente parece comprender
      completamente su utilidad en un entorno de red.  Parece que
      todos quieren instalar un cortafuegos para manejar conexiones
      de red.  Aunque un cortafuegos tiene una amplia variedad de
      usos hay cosas que un cortafuegos no es capaz de gestionar,
      como el envío de texto como respuesta al creador de la
      conexión.  El software <acronym class="acronym">TCP</acronym> hace esto
      y más.  En las siguientes secciones se explicarán
      unas cuantas opciones de
      <acronym class="acronym">TCP</acronym> Wrappers y, cuando sea necesario, se
      mostrarán ejemplos de configuraciones.</p><p>El software <acronym class="acronym">TCP</acronym> Wrappers extiende
      las habilidades de <code class="command">inetd</code> para ofrecer
      soporte para cada servidor dæmon bajo su control.
      Utilizando este método es posible proveer soporte de
      logs, devolver mensajes a conexiones, permitir a un dæmon
      aceptar solamente conexiones internas, etc.  Aunque algunas de estas
      opciones pueden conseguirse gracias a un cortafuegos, no sólo
      añadirá una capa extra de seguridad, sino que irá
      más allá del nivel de control ue un cortafuegos
      puede ofrecerle.</p><p>Las brillantes capacidades de <acronym class="acronym">TCP</acronym> Wrappers
      no deben considerarse una alternativa a un buen cortafuegos.
      <acronym class="acronym">TCP</acronym> Wrappers puede usarse conjuntamente con un
      cortafuegos u otro sistema de de seguridad, pues ofrece una capa
      extra de protección para el sistema.</p><p>Ya que es una extensión de la configuración
      de <code class="command">inetd</code>, se da por hecho que el lector ha
      leído la sección
      <a class="link" href="network-inetd.html" title="29.14. El &#8220;Superservidor&#8221; inetd">configuración de inetd</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Aunque los programas ejecutados por <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> no son
        exactamente <span class="quote">&#8220;<span class="quote">dæmons</span>&#8221;</span> tradicionalmente han
        recibido ese nombre.  Dæmon es, por tanto, el término
        que usaremos en esta sección.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75443408"></a>14.6.1. Configuración inicial</h3></div></div></div><p>El único requisito para usar
        <acronym class="acronym">TCP</acronym> Wrappers en FreeBSD es que el servidor
        <code class="command">inetd</code> se inicie desde
        <code class="filename">rc.conf</code> con la opción
        <code class="option">-Ww</code>  (es la configuración
        por defecto).  Por descontado, se presupone que
        <code class="filename">/etc/hosts.allow</code> estará correctamente
        configurado, pero <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> enviará mensajes
        a los logs del sistema si no es así.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">A diferencia de otras implementaciones de <acronym class="acronym">TCP</acronym>
          Wrappers, se ha dejado de usar
          <code class="filename">hosts.deny</code>.  Todas las opciones de
          configuración deben ir en
          <code class="filename">/etc/hosts.allow</code>.</p></div><p>En la configuración más simple las
        políticas de conexión de dæmons están
        configuradas ya sea a permitir o bloquear, dependiendo de
        las opciones en <code class="filename">/etc/hosts.allow</code>.
        La configuración por defecto en FreeBSD consiste en
        permitir una conexión a cada dæmon iniciado por
        <code class="command">inetd</code>.  Es posible modificar esta
        configuración, pero explicaremos cómo hacerlo
        después de exponer la configuración
        básica.</p><p>La configuración básica tiene la estructura
        <code class="literal">dæmon : dirección : acción</code>,
        donde <code class="literal">dæmon</code> es el nombre de dæmon
        que inicia <code class="command">inetd</code>.  La
        <code class="literal">dirección</code> puede ser un nombre
        de equipo válido, una dirección IP o
        IPv6 encerrada en corchetes ([ ]).  El campo
        acción puede ser permitir o denegar para el
        dar el acceso apropiado.  Tenga presente que la
        configuración funciona en base a la primera
        regla cuya semántica concuerde;
        esto significa que el fichero de configuración se
        lee en orden ascendente hasta que concuerde una regla.
        Cuando se encuentra una concordancia se aplica la regla
        y el proceso se detendrá.</p><p>Existen muchas otras opciones pero estas se
        explican en una sección posterior.  Una línea
        de configuración simple puede generarse mediante datos
        así de simples.  Por ejemplo, para permitir conexiones
        <acronym class="acronym">POP</acronym>3 mediante el dæmon
        <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/mail/qpopper/pkg-descr">mail/qpopper</a>, añada
        las siguientes líneas a
        <code class="filename">hosts.allow</code>:</p><pre class="programlisting"># This line is required for POP3 connections:
qpopper : ALL : allow</pre><p>Despues de añadir esta línea tendrá que
        reiniciar <code class="command">inetd</code>.  Use <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> o use el
        parámetro <em class="parameter"><code>restart</code></em> de
        <code class="filename">/etc/rc.d/inetd</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75456720"></a>14.6.2. Configuración avanzada</h3></div></div></div><p>Las opciones avanzadas de <acronym class="acronym">TCP</acronym> Wrappers
        le permiten un mayor control sobre la gestión de
	conexiones.  En algunos casos puede convenir el enío de
	un comentario a ciertos equipos o conexiones de dæmons.
        En otros casos, quizás se deba registrar una entrada en
        un log o enviar un correo al administrador.  Otro tipo de
        situaciones pueden requerir el uso de un servicio
        solamente para conexiones locales.  Todo esto es posible gracias
        al uso de unas opciones de configuración conocidas
        como <code class="literal">comodines</code>, caracteres de expansión
        y ejecución de órdenes externas.  Las siguientes dos
        secciones intentarán cubrir estas situaciones.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75479120"></a>14.6.2.1. Órdenes externas</h4></div></div></div><p>Imaginemos una situación en la que una
          conexión debe ser denegada pero se debe mandar un motivo
          a quien intentó establecer esa conexión.
          ?Cómo? Mediante la opción
          <code class="option">twist</code>.  Ante un intento de conexión se
          invoca a <code class="option">twist</code>, que ejecuta una orden de shell
          o un <span class="quote">&#8220;<span class="quote">script</span>&#8221;</span>.  Tiene un ejemplo en el fichero
          <code class="filename">hosts.allow</code>:</p><pre class="programlisting"># The rest of the daemons are protected.
ALL : ALL \
        : severity auth.info \
        : twist /bin/echo "No se permite utilizar %d desde %h."</pre><p>Este ejemplo muestra que el mensaje,
          <span class="quote">&#8220;<span class="quote">No se permite utilizar <code class="literal">dæmon</code>
          desde <code class="literal">nombre de equipo</code>.</span>&#8221;</span> se
          enviará en el caso de cualquier dæmon no configurado
          previamente en el fichero de acceso.
          Esto es extremadamente útil para enviar una respuesta
          al creador de la conexión justo después de
          que la conexión establecida es rechazada.  Observe que
          cualquier mensaje que se desee enviar <span class="emphasis"><em>debe ir</em></span>
          entre comillas <code class="literal">"</code>; esta regla no tiene
          excepciones.</p><div xmlns="" class="warning"><h3 class="admontitle">Aviso: </h3><p xmlns="http://www.w3.org/1999/xhtml"> Es posible lanzar un ataque de denegación
            de servicio al servidor si un atacante o grupo de
            atacantes pueden llegar a sobrecargar estos dæmons
            con peticiones de conexión.</p></div><p>Otra posibilidad en estos casos es usar la opción
          <code class="option">spawn</code>.  Igual que <code class="option">twist</code>,
          <code class="option">spawn</code> niega implícitamente la
          conexión, y puede usarse para ejecutar órdenes de
          shell externos o <span class="quote">&#8220;<span class="quote">scripts</span>&#8221;</span>.  A diferencia de
          <code class="option">twist</code>, <code class="option">spawn</code> no
          enviará una respuesta al origen de la conexión.
          Veamos un ejemplo; observe la siguiente línea de
          configuración:</p><pre class="programlisting"># No permitimos conexiones desde ejemplo.com:
ALL : .ejemplo.com \
	: spawn (/bin/echo %a desde %h intento acceder a %d &gt;&gt; \
	  /var/log/connections.log) \
	: deny</pre><p>Esto denegará todos los intentos de conexión
          desde el dominio <code class="systemitem">*.ejemplo.com</code>;
          simultáneamente creará una entrada con
          el nombre del equipo, dirección <acronym class="acronym">IP</acronym>
          y el dæmon al que intentó conectarse al fichero
          <code class="filename">/var/log/connections.log</code>.</p><p>Además de la sustitución de caracteres ya
          expuesta más arriba (por ejemplo  %a) existen unas
          cuantas más.  Si quiere ver la lista completa consulte
          la página de manual <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75495504"></a>14.6.2.2. Opciones comodín</h4></div></div></div><p>Hasta ahora se ha usado <code class="literal">ALL</code> en todos
          los ejemplos, pero hay otras opciones interesantes para
          extender un poco más la funcionalidad.  Por ejemplo,
          <code class="literal">ALL</code> puede usarse para concordar con cualquier
          instancia ya sea un dæmon, dominio o
          dirección <acronym class="acronym">IP</acronym>.  Otro comodín
          es <code class="literal">PARANOID</code>, que puede utilizarse para
          concordar con cualquier equipo que presente una
          dirección <acronym class="acronym">IP</acronym> que pueda estar
          falsificada.  En otras palabras, <code class="literal">paranoid</code>
          puede usarse para definir una acción a tomar
          siempre que tenga lugar una conexión desde una
          dirección  <acronym class="acronym">IP</acronym> que difiera de su
          nombre de equipo.  Quizás todo se vea más claro
	  con el siguiente ejemplo:</p><pre class="programlisting"># Bloquear peticiones posiblemente falsificadas a sendmail:
sendmail : PARANOID : deny</pre><p>En ese ejemplo todas las peticiones de conexión
          a <code class="command">sendmail</code> que tengan una
          dirección <acronym class="acronym">IP</acronym> que varíe
          de su nombre de equipo serán denegadas.</p><div xmlns="" class="caution"><h3 class="admontitle">Atención: </h3><p xmlns="http://www.w3.org/1999/xhtml">Utilizando <code class="literal">PARANOID</code> puede bloquear el
	    acceso a servidores si el cliente o el servidor
            tiene una configuración de
            <acronym class="acronym">DNS</acronym> incorrecta.  Recomendamos al
            administrador la máxima cautela en su uso.</p></div><p>Consulte <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a> si quiere saber más
	  sobre los comodines y sus posibilidades de uso.</p><p>Si quiere que cualquiera de los ejemplos citados
	  funcione debe comentar la primera línea de
          <code class="filename">hosts.allow</code> (tal y como se dijo
          al principio de la sección.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="one-time-passwords.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="kerberosIV.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">14.5. Contraseñas de un solo uso </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 14.7. <span class="application">KerberosIV</span></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>