<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>第 10 章 升级一个 port</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter 手册" /><link rel="up" href="index.html" title="FreeBSD Porter 手册" /><link rel="prev" href="testing-tinderbox.html" title="9.5. Tinderbox" /><link rel="next" href="moved-and-updating-files.html" title="10.2. UPDATING 和 MOVED 文件" /><link rel="copyright" href="trademarks.html" title="法律声明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 10 章 升级一个 port</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="testing-tinderbox.html">上一页</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="moved-and-updating-files.html">下一页</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="port-upgrading"></a>第 10 章 升级一个 port</h1></div></div></div><div class="toc"><div class="toc-title">目录</div><dl class="toc"><dt><span class="sect1"><a href="port-upgrading.html#cvs-diff">10.1. 使用 CVS 制作补丁</a></span></dt><dt><span class="sect1"><a href="moved-and-updating-files.html">10.2. UPDATING 和 MOVED 文件</a></span></dt></dl></div><p>如果您发现某个 port 相对原作者所发布的版本已经过时，
	则首先需要确认的是您的 port 是最新的。 您可以在 FreeBSD FTP 镜像的
	<code class="filename">ports/ports-current</code> 目录中找到它们。
	但是， 如果您正在使用较多的 port， 则可能使用
	<span class="application">CVSup</span> 来保持 Ports Collection 最新更为简单， 这在
	<a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/synching.html#CVSUP-CONFIG" target="_top">使用手册</a>
	中进行了介绍。 此外， 这样做也有助于保持 port 依赖关系的正确性。</p><p>下一步是检查是否已经有在等待的更新。 要完成这项工作，
	可以采用下列两种方法之一。 有一个用于搜索
	<a class="link" href="http://www.FreeBSD.org/cgi/query-pr-summary.cgi?query" target="_top">
	FreeBSD 问题报告 (PR) 数据库</a> (也被称作
	<code class="literal">GNATS</code>)。 在下拉框中选择 <code class="literal">ports</code>，
	然后输入 port 的名字。</p><p>但是， 有些时候人们会忘记将避免混淆的 port 的名字放到 Synopsis 字段中。
	这种时候， 您可以试试看 <a class="link" href="portsmon.html" title="14.6. FreeBSD 的 Ports 追踪系统">
	FreeBSD Ports 监视系统</a> (也被叫做
	<code class="literal">portsmon</code>)。 这个系统会尝试按照 port 的名字来进行分类。
	要搜索和某个特定 port 有关的 PR， 可以使用 <a class="link" href="http://portsmon.FreeBSD.org/portoverview.py" target="_top">
	port概览</a>。</p><p>如果没有候审的 PR， 下一步是给 port 的维护者写信， 这可以通过执行
	<code class="command">make maintainer</code> 看到。 这个人可能正在进行升级工作，
	或者由于某种理由暂时没有升级 (例如， 新版本有稳定性问题)；
	一般您不希望重复他们的工作。 注意没有维护者的 port 的维护者会显示为
	<code class="literal">ports@FreeBSD.org</code>， 这是一般性 port 问题的邮件列表，
	因此发邮件给它一般没什么意义。</p><p>如果维护者要求您去完成升级， 或者没有维护者，
	您就有机会通过自行完成升级来帮助 FreeBSD 了！ 请使用基本系统提供的
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> 命令来完成相关的工作。</p><p>如果只修改一个文件， 可以直接使用 <code class="command">diff</code>
	来生成补丁， 将需要修改的文件复制成 <em class="replaceable"><code>something.orig</code></em>，
	并将改动放进 <em class="replaceable"><code>something</code></em>，
	接着生成补丁：</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>/usr/bin/diff something.orig something &gt; something.diff</code></strong></pre></div><p>如果不是这样的话， 则您应使用 <code class="command">cvs diff</code>
	的方法 (<a class="xref" href="port-upgrading.html#cvs-diff" title="10.1. 使用 CVS 制作补丁">第 10.1 节 “使用 CVS 制作补丁”</a>)， 或将目录整个复制到另一个目录，
	并使用 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> 比较两个目录时在目录中递归产生的输出结果
	(例如， 如果您修改后的 port 目录的名字是
	<code class="filename">superedit</code> 而原始文件的目录是
	<code class="filename">superedit.bak</code>， 则应保存
	<code class="command">diff -ruN superedit.bak superedit</code> 的结果)。
	一致式 (unified) 或 上下文式 (context) diff 都是可以的，
	但一般来说 port committer 会更喜欢一致式 diff。
	请注意这里使用的选项 <code class="literal">-N</code>， 它的目的是强制 diff
	正确地处理出现新文件， 或老文件被删除的情形。 在把 diff 发给我们之前，
	请再次检查输出， 以便确认每一个修改都是有意义的。 (特别注意，
	在对比目录之前要用 <code class="command">make clean</code> 清理一下)。</p><p>为了简化常用的补丁文件操作， 您可以使用
	<code class="filename">/usr/ports/Tools/scripts/patchtool.py</code>。
	使用之前， 请首先阅读
	<code class="filename">/usr/ports/Tools/scripts/README.patchtool</code>。</p><p>如果 port 目前还无人维护， 而且您自己经常使用它，
	请考虑自荐为它的维护者。 FreeBSD 有超过 4000 个没有维护者的 port，
	而这正是最需要志愿人员的领域。
	(要了解关于维护者的任务描述， 请参见
	<a class="link" href="../../../../doc/en_US.ISO8859-1/books/developers-handbook/policies.html#POLICIES-MAINTAINER" target="_top">
	开发手册中的相关部分</a>。)</p><p>将 diff 发送给我们的最佳方式是通过 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=send-pr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">send-pr</span>(1)</span></a> (category 一栏写
	<code class="literal">ports</code>)。 如果您正维护那个 port，
	请务必在 synopsis 的开头写上 <code class="literal">[maintainer update]</code>，
	并将您的 PR 的 <span class="quote">“<span class="quote">Class</span>”</span> 设置为 <code class="literal">maintainer-update</code>。
	反之， 您的 PR 的 <span class="quote">“<span class="quote">Class</span>”</span> 就应该是
	<code class="literal">change-request</code>。 请在信中逐个提及每一个删除或增加的文件，
	因为这些都必须明确地在使用 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cvs&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cvs</span>(1)</span></a> 进行 commit 时明确地指定。
	如果 diff 超过了 20K， 请考虑压缩并对其进行 uuencode；
	否则， 简单地将其原样加入 PR 即可。</p><p>在您 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=send-pr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">send-pr</span>(1)</span></a> 之前， 请再次阅读 Problem
	Reports 一文中的
	<a class="link" href="../../../../doc/en_US.ISO8859-1/articles/problem-reports/pr-writing.html" target="_top">
	如何撰写问题报告</a> 小节；
	它给出了丰富的关于如何撰写更好的问题报告的介绍。</p><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">如果您的更新是由于安全考虑， 或修复已经 commit 的 port
	  中的严重问题， 请通知 Ports 管理团队 <code class="email">&lt;<a xmlns="" class="email" href="mailto:portmgr@FreeBSD.org">portmgr@FreeBSD.org</a>&gt;</code> 来申请立即重建和分发您的 port
	  的 package。 否则， 不愿怀疑的使用 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pkg_add&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a> 的用户，
	  可能会在未来数周之内继续通过使用 <code class="command">pkg_add -r</code>
	  安装旧版本。</p></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">再次强调， 请使用 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> 而非 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=shar&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">shar</span>(1)</span></a> 来发送现有
	  port 的更新！ 这可以帮助 ports committer 理解需要修改的内容。</p></div><p>现在您已经了解了所需的所有操作， 您可能会像要阅读在
	<a class="xref" href="keeping-up.html" title="第 14 章 保持同步">第 14 章 <em>保持同步</em></a> 中关于如何保持最新的描述。</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="cvs-diff"></a>10.1. 使用 CVS 制作补丁</h2></div></div></div><p>如果可能的话， 请提交<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cvs&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cvs</span>(1)</span></a> diff；
	  这种情形要比直接比较 <span class="quote">“<span class="quote">新、旧</span>”</span> 目录要容易处理。
	  此外， 这种方法也让您更容易看出到底改了什么，
	  并在其他人更新了 Ports Collection 时容易合并这些改动，
	  在提交之前， 这可以减少维护补丁所需的工作。</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd ~/my_wrkdir</code></strong> <a id="my-wrkdir"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">%</code> <strong class="userinput"><code>cvs -d R_CVSROOT co pdnsd</code></strong> <a id="R-CVSROOT"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span> <a id="module-name"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
<code class="prompt">%</code> <strong class="userinput"><code>cd ~/my_wrkdir/pdnsd</code></strong></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#my-wrkdir"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>当然， 这可以是您指定的任意目录；
	      联编 port 并不局限于
	      <code class="filename">/usr/ports/</code>
	      的子目录。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#R-CVSROOT"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>R_CVSROOT 是任何一个公共的 cvs 镜像服务器， 您可以在 <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/cvsup.html" target="_top">FreeBSD 使用手册</a>
	      中挑选一个。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#module-name"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>pdnsd 是 port 的模块名字； 通常说来它和 port 的名字一样，
	      不过也有些例外， 特别是那些本地化类别 (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/german/selfhtml/pkg-descr">german/selfhtml</a>
	      对应的模块名字是 de-selfhtml)； 您可以通过 <a class="link" href="../../../../cgi/cvsweb.cgi/ports" target="_top">cvsweb 界面</a>
	      查询， 或者也可以指定完整路径， 例如在我们这个例子中是
	      <code class="filename">ports/dns/pdnsd</code>。</p></td></tr></table></div><p>在工作目录中， 您可以像往常一样进行任何更改。
	  如果您添加或删除了文件， 则需要告诉
	  <code class="command">cvs</code> 来追踪这些改动：</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs add new_file</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cvs remove deleted_file</code></strong></pre><p>请反复检查 <a class="xref" href="porting-testing.html" title="3.4. 测试 port">第 3.4 节 “测试 port”</a> 列出的事项并使用
	  <a class="xref" href="porting-portlint.html" title="3.5. 用 portlint 来检查 port">第 3.5 节 “用 <code class="command">portlint</code> 来检查 port”</a> 进行检查。</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs status</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cvs update</code></strong> <a id="cvs-update"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#cvs-update"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>这会合并 CVS 中其他人做的改动和您的补丁；
	      在这个过程中， 您需要仔细观察输出。
	      文件名前面的那个字母会显示做了什么， 请参阅
	      <a class="xref" href="port-upgrading.html#table-cvs-up" title="表 10.1. cvs update 文件名前字母前缀的含义">表 10.1 “cvs update 文件名前字母前缀的含义”</a> 中给出的说明。</p></td></tr></table></div><div class="table"><a id="table-cvs-up"></a><div class="table-title">表 10.1. cvs update 文件名前字母前缀的含义</div><div class="table-contents"><table summary="cvs update 文件名前字母前缀的含义" width="100%" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td>U</td><td>文件更新无误。</td></tr><tr><td>P</td><td>文件更新无误 (通常只有在使用远程代码库时才会看到)。</td></tr><tr><td>M</td><td>文件有本地修改， 并合并成功而未产生任何冲突。</td></tr><tr><td>C</td><td>文件有本地修改， 进行了合并并产生了冲突。</td></tr></tbody></table></div></div><br class="table-break" /><p>如果您在执行
	  <code class="literal">cvs update</code> 时某些文件出现了 <code class="literal">C</code>，
	  则说明有其他人在 CVS 中做了修改， 而 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cvs&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cvs</span>(1)</span></a> 无法将这些改动与您本地的改动进行合并。
	  不过， 无论如何， 最好都检查一下合并的结果，
	  因为 <code class="command">cvs</code> 并不知道 port 应该是什么样子，
	  因此它所做的合并无论是否产生了冲突，
	  都有可能 (并且并不罕见) 产生没有意义的结果。</p><p>最后一步是以 CVS 中的文件为基础生成 unified <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a>：</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs diff -uN &gt; ../`basename ${PWD}`.diff</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">指定 <code class="option">-N</code> 十分重要，
	    因为它确保了添加或删除的文件也出现在补丁中。
	    补丁将包含删除的文件， 在打上补丁时，
	    这些文件会被清空， 所以最好在 PR 中提醒 committer
	    删除它们。</p></div><p>根据 <a class="xref" href="port-upgrading.html" title="第 10 章 升级一个 port">第 10 章 <em>升级一个 port</em></a> 的指导提交您的补丁。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="testing-tinderbox.html">上一页</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="moved-and-updating-files.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">9.5. Tinderbox </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 10.2. UPDATING 和 MOVED 文件</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文档和其它文档可从这里下载：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>如果对于FreeBSD有问题，请先阅读
    <a href="http://www.FreeBSD.org/docs.html">文档</a>，如不能解决再联系
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    关于本文档的问题请发信联系
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>