<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>6.11. 使用 Java</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter 手册" /><link rel="up" href="special.html" title="第 6 章 特殊情况" /><link rel="prev" href="using-kde.html" title="6.10. 使用 KDE" /><link rel="next" href="using-php.html" title="6.12. Web 应用， Apache 和 PHP" /><link rel="copyright" href="trademarks.html" title="法律声明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.11. 使用 Java</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="using-kde.html">上一页</a> </td><th width="60%" align="center">第 6 章 特殊情况</th><td width="20%" align="right"> <a accesskey="n" href="using-php.html">下一页</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-java"></a>6.11. 使用 Java</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="java-variables"></a>6.11.1. 变量定义</h3></div></div></div><p>如果您的 port 需要 Java™ 开发包 (JDK™) 来完成联编、
	支持运行， 甚至完成解开源代码包这样的工作，
	就应该定义 <code class="varname">USE_JAVA</code>。</p><p>在 Ports Collection 中有许多不同的 JDK， 它们的版本各不相同，
	或是来自不同的供应商。 如果您的 port 必须使用其中的某个特定的版本，
	也可以予以定义。 最新的稳定版本是
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/java/jdk16/pkg-descr">java/jdk16</a>。</p><div class="table"><a id="idp68773712"></a><div class="table-title">表 6.14. 用到 Java 的 port 可以使用的变量</div><div class="table-contents"><table summary="用到 Java 的 port 可以使用的变量" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>变量</th><th>意义</th></tr></thead><tbody><tr><td><code class="varname">USE_JAVA</code></td><td>只有定义它才能使其它变量生效。</td></tr><tr><td><code class="varname">JAVA_VERSION</code></td><td>用空格分开的适合 port 使用的 Java 版本。
		可选的 <code class="literal">"+"</code> 可以用于指定某个范围的版本 (可以用：
		<code class="literal">1.5[+] 1.6[+] 1.7[+]
		</code>)。</td></tr><tr><td><code class="varname">JAVA_OS</code></td><td>用空格分开的适应 port 的 JDK port 操作系统类型 (可以用： <code class="literal">native
		linux</code>)。</td></tr><tr><td><code class="varname">JAVA_VENDOR</code></td><td>用空格分开的适应 port 的 JDK port 供应商
		(可以用： <code class="literal">freebsd bsdjava sun
		openjdk</code>)。</td></tr><tr><td><code class="varname">JAVA_BUILD</code></td><td>设置这个变量表示所选的 JDK port 应被列入 port 的联编依赖关系。</td></tr><tr><td><code class="varname">JAVA_RUN</code></td><td>设置这个变量表示所选的 JDK port 应被列入 port 的运行环境依赖关系。</td></tr><tr><td><code class="varname">JAVA_EXTRACT</code></td><td>设置这个变量表示所选的 JDK port 应被列入 port 的解压缩支持依赖关系。</td></tr></tbody></table></div></div><br class="table-break" /><p>下面是在设置了 <code class="varname">USE_JAVA</code> 之后，
	port 能够从系统中获得的配置：</p><div class="table"><a id="idp68788560"></a><div class="table-title">表 6.15. 向使用了 Java 的 port 提供的变量</div><div class="table-contents"><table summary="向使用了 Java 的 port 提供的变量" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>变量</th><th>值</th></tr></thead><tbody><tr><td><code class="varname">JAVA_PORT</code></td><td>JDK port 的名字 (例如
		<code class="literal">'java/diablo-jdk16'</code>)。</td></tr><tr><td><code class="varname">JAVA_PORT_VERSION</code></td><td>JDK port 的完整版本 (例如
		<code class="literal">'1.6.0'</code>)。 如果您只需要版本号的前两位， 则可用
		<code class="varname">${JAVA_PORT_VERSION:C/^([0-9])\.([0-9])(.*)$/\1.\2/}</code>。</td></tr><tr><td><code class="varname">JAVA_PORT_OS</code></td><td>所用 JDK port 的操作系统 (例如
		<code class="literal">'native'</code>)。</td></tr><tr><td><code class="varname">JAVA_PORT_VENDOR</code></td><td>所用 JDK port 的供应商 (例如
		<code class="literal">'freebsd'</code>)。</td></tr><tr><td><code class="varname">JAVA_PORT_OS_DESCRIPTION</code></td><td>所用 JDK port 操作系统的描述
		(例如 <code class="literal">'Native'</code>)。</td></tr><tr><td><code class="varname">JAVA_PORT_VENDOR_DESCRIPTION</code></td><td>所用 JDK port 供应商的描述 (例如
		<code class="literal">'FreeBSD Foundation'</code>)。</td></tr><tr><td><code class="varname">JAVA_HOME</code></td><td>JDK 的安装目录 (例如
		<code class="filename">'/usr/local/diablo-jdk1.6.0'</code>)。</td></tr><tr><td><code class="varname">JAVAC</code></td><td>所用 Java 编译器的完整路径 (例如
		<code class="filename">'/usr/local/diablo-jdk1.6.0/bin/javac'</code>)。
		</td></tr><tr><td><code class="varname">JAR</code></td><td>所用 <code class="command">jar</code> 工具的完整路径 (例如
		<code class="filename">'/usr/local/diablo-jdk1.6.0/bin/jar'</code> 或
		<code class="filename">'/usr/local/bin/fastjar'</code>)。</td></tr><tr><td><code class="varname">APPLETVIEWER</code></td><td>所用 <code class="command">appletviewer</code> 工具的完整路径 (例如
		<code class="filename">'/usr/local/diablo-jdk1.6.0/bin/appletviewer'</code>)。</td></tr><tr><td><code class="varname">JAVA</code></td><td>所用 <code class="command">java</code> 执行文件的完整路径。
		您应使用它来执行 Java 程序 (例如
		<code class="filename">'/usr/local/diablo-jdk1.6.0/bin/java'</code>)。</td></tr><tr><td><code class="varname">JAVADOC</code></td><td>所用 <code class="command">javadoc</code> 工具的完整路径。</td></tr><tr><td><code class="varname">JAVAH</code></td><td>所用 <code class="command">javah</code> 程序的完整路径。</td></tr><tr><td><code class="varname">JAVAP</code></td><td>所用 <code class="command">javap</code> 程序的完整路径。</td></tr><tr><td><code class="varname">JAVA_KEYTOOL</code></td><td>所用 <code class="command">keytool</code> 工具的完整路径。</td></tr><tr><td><code class="varname">JAVA_N2A</code></td><td>所用 <code class="command">native2ascii</code> 工具的完整路径。</td></tr><tr><td><code class="varname">JAVA_POLICYTOOL</code></td><td>所用 <code class="command">policytool</code> 程序的完整路径。</td></tr><tr><td><code class="varname">JAVA_SERIALVER</code></td><td>所用 <code class="command">serialver</code> 程序的完整路径。</td></tr><tr><td><code class="varname">RMIC</code></td><td>所用 RMI 桩/架 生成器，
		<code class="command">rmic</code> 的完整路径。</td></tr><tr><td><code class="varname">RMIREGISTRY</code></td><td>所用 RMI 注册表程序，
		<code class="command">rmiregistry</code> 的完整路径。</td></tr><tr><td><code class="varname">RMID</code></td><td>所用 RMI 服务程序 <code class="command">rmid</code> 的完整路径。</td></tr><tr><td><code class="varname">JAVA_CLASSES</code></td><td>所用 JDK 类文件目录的完整路径。
		<code class="filename">${JAVA_HOME}/jre/lib/rt.jar</code>。</td></tr></tbody></table></div></div><br class="table-break" /><p>您可以使用 <code class="literal">java-debug</code> make target
	以获取用于调试 port 的信息。 大多数前述变量的值皆会予以呈现。</p><p>此外， 还会定义下述常量， 以确保所有的
	Java port 均以一致之方式安装：</p><div class="table"><a id="idp68873424"></a><div class="table-title">表 6.16. 为使用 Java 的 port 定义的常量</div><div class="table-contents"><table summary="为使用 Java 的 port 定义的常量" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>常量</th><th>值</th></tr></thead><tbody><tr><td><code class="varname">JAVASHAREDIR</code></td><td>所有 Java 相关资料的安装根目录。
		默认值： <code class="filename">${PREFIX}/share/java</code>.
	      </td></tr><tr><td><code class="varname">JAVAJARDIR</code></td><td>用以安装 JAR 文件的目录。 默认值：
		<code class="filename">${JAVASHAREDIR}/classes</code>。</td></tr><tr><td><code class="varname">JAVALIBDIR</code></td><td>其它 port 安装的 JAR 文件所在的目录。 默认值：
		<code class="filename">${LOCALBASE}/share/java/classes</code>。</td></tr></tbody></table></div></div><br class="table-break" /><p>相关的项也会定义在
	<code class="varname">PLIST_SUB</code> (在
	<a class="xref" href="plist.html#plist-sub" title="7.1. 根据 make 变量对 pkg-plist 进行修改">第 7.1 节 “根据 make 变量对 <code class="filename">pkg-plist</code> 进行修改”</a> 中进行介绍) 和
	<code class="varname">SUB_LIST</code> 中。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="java-building-with-ant"></a>6.11.2. 采用 Ant 进行联编</h3></div></div></div><p>如果 port 采用 Apache Ant 进行联编，
	  则需要定义 <code class="varname">USE_ANT</code>。 如是， 则 Ant
	  将作为 子-make 命令来使用。 如果 port 未定义 <code class="literal">do-build</code>
	  target， 则将默认依 <code class="varname">MAKE_ENV</code>、
	  <code class="varname">MAKE_ARGS</code> 和 <code class="varname">ALL_TARGET</code>。
	  的设置执行 Ant。 这类似于 <a class="xref" href="building.html" title="6.3. 联编机制">第 6.3 节 “联编机制”</a> 中介绍的关于
	  <code class="varname">USE_GMAKE</code> 的机制。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="java-best-practices"></a>6.11.3. 最佳实践</h3></div></div></div><p>如果您正移植某个 Java 库， 您的 port 应把
	  JAR 文件安装到 <code class="filename">${JAVAJARDIR}</code>， 而其它文件则应放在
	  <code class="filename">${JAVASHAREDIR}/${PORTNAME}</code> 下
	  (除了文档， 参见下文)。 要减少打包文件的尺寸，
	  您可以直接在 <code class="filename">Makefile</code> 中引用这些 JAR 文件，
	  具体做法是使用下面的语句 (此处的 <code class="filename">myport.jar</code>
	  是作为 port 一部分安装的 JAR 文件的名字)：</p><pre class="programlisting">PLIST_FILES+= %%JAVAJARDIR%%/myport.jar</pre><p>移植 Java 应用程序时， port 通常会希望将所有文件安装到同一目录
	  (包括其依赖的 JAR)。 这时强烈建议使用
	  <code class="filename">${JAVASHAREDIR}/${PORTNAME}</code>。
	  移植软件的开发人员， 可以自行决定是否将所依赖的其它 JAR 安装到此目录，
	  或直接使用已经装好的那些
	  (来自 <code class="filename">${JAVAJARDIR}</code>)。</p><p>无论您正制作哪一类的 port (库或者应用程序)，
	  附加的文档都应安装到和其它 port
	  <a class="link" href="install.html#install-documentation" title="5.14.4. 安装附加的文档">同样的位置</a>。
	  已经知道， JavaDoc 会根据 JDK 版本的不同而产生不同的文件。
	  对于那些不打算强制使用某一特定版本 JDK 的 port 而言，
	  这无疑提高了制作装箱单
	  (<code class="filename">pkg-plist</code>) 的难度。 这是为什么强烈建议使用
	  <code class="varname">PORTDOCS</code> 宏的原因。 更进一步， 即使您能够预测
	  <code class="command">javadoc</code> 将要生成的文件， 所需的
	  <code class="filename">pkg-plist</code> 的尺寸， 也是鼓吹使用
	  <code class="varname">PORTDOCS</code> 的一大理由。</p><p><code class="varname">DATADIR</code> 的默认值是
	  <code class="filename">${PREFIX}/share/${PORTNAME}</code>。
	  对 Java port 而言将 <code class="varname">DATADIR</code> 改为
	  <code class="filename">${JAVASHAREDIR}/${PORTNAME}</code> 是一个好主意。
	  当然， <code class="varname">DATADIR</code> 会自动加到
	  <code class="varname">PLIST_SUB</code> 中 (在 <a class="xref" href="plist.html#plist-sub" title="7.1. 根据 make 变量对 pkg-plist 进行修改">第 7.1 节 “根据 make 变量对 <code class="filename">pkg-plist</code> 进行修改”</a> 有所介绍) 因此您可以在
	  <code class="filename">pkg-plist</code> 中直接使用
	  <code class="literal">%%DATADIR%%</code>。</p><p>撰写本文时， 对是应该从源代码联编， 还是直接安装预编译的
	  Java ports 安装包并没有明确的规定。 尽管如此， <a class="link" href="http://www.freebsd.org/java/" target="_top">FreeBSD Java Project</a>
	  的开发人员仍鼓励移植软件的开发者在不麻烦的情况下尽可能从源代码完成联编。</p><p>本节中所介绍的全部特性， 均是在 <code class="filename">bsd.java.mk</code>
	  中实现的。 如果您感觉自己的 port 需要更为复杂的 Java 支持，
	  请首先参阅 <a class="link" href="http://www.freebsd.org/cgi/cvsweb.cgi/ports/Mk/bsd.java.mk" target="_top">
	  bsd.java.mk CVS 日志</a>， 因为通常撰文介绍最新特性需要一些时间。
	  此外， 如果您认为所缺少的支持对许多其它 Java port 亦属有益，
	  请在 <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-java" target="_top">FreeBSD Java 语言邮件列表</a> 对其进行讨论。</p><p>在 PR 中的 <code class="literal">java</code> 类别，
	  主要是用于 FreeBSD Java project 移植 JDK 本身之用。
	  因而， 提交您的 Java port 时， 应归入
	  <code class="literal">ports</code> 类别， 除非您正尝试解决的问题是 JDK
	  实现本身或 <code class="filename">bsd.java.mk</code> 的。</p><p>类似地， 您应参考 <a class="xref" href="makefile-categories.html" title="5.3. 分类">第 5.3 节 “分类”</a> 中所详述的关于
	  <code class="varname">CATEGORIES</code> 在 Java port 中的使用规则。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="using-kde.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="special.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="using-php.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">6.10. 使用 KDE </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 6.12. Web 应用， Apache 和 PHP</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文档和其它文档可从这里下载：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>如果对于FreeBSD有问题，请先阅读
    <a href="http://www.FreeBSD.org/docs.html">文档</a>，如不能解决再联系
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    关于本文档的问题请发信联系
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>