<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>第 7 章 高级 pkg-plist 用法</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter 手册" /><link rel="up" href="index.html" title="FreeBSD Porter 手册" /><link rel="prev" href="ch06s25.html" title="6.25. 依赖内核源代码的 Ports" /><link rel="next" href="plist-cleaning.html" title="7.2. 空目录" /><link rel="copyright" href="trademarks.html" title="法律声明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 7 章 高级 <code class="filename">pkg-plist</code> 用法</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch06s25.html">上一页</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="plist-cleaning.html">下一页</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist"></a>第 7 章 高级 <code class="filename">pkg-plist</code> 用法</h1></div></div></div><div class="toc"><div class="toc-title">目录</div><dl class="toc"><dt><span class="sect1"><a href="plist.html#plist-sub">7.1. 根据 make 变量对 <code class="filename">pkg-plist</code> 进行修改</a></span></dt><dt><span class="sect1"><a href="plist-cleaning.html">7.2. 空目录</a></span></dt><dt><span class="sect1"><a href="plist-config.html">7.3. 配置文件</a></span></dt><dt><span class="sect1"><a href="plist-dynamic.html">7.4. 动态装箱单与静态装箱单的对比</a></span></dt><dt><span class="sect1"><a href="plist-autoplist.html">7.5. 装箱单 (package list) 的自动化制作</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="plist-sub"></a>7.1. 根据 make 变量对 <code class="filename">pkg-plist</code> 进行修改</h2></div></div></div><p>某些 port， 特别是 <code class="literal">p5-</code> port，
	  会需要根据配置选项 (或对于 <code class="literal">p5-</code> port 而言，
	  <code class="literal">perl</code> 的版本) 来修改它们的 <code class="filename">pkg-plist</code>。
	  为简化这一工作， 在
	  <code class="filename">pkg-plist</code> 中的 <code class="literal">%%OSREL%%</code>、
	  <code class="literal">%%PERL_VER%%</code>， 以及
	  <code class="literal">%%PERL_VERSION%%</code> 将自动进行相应的替换。
	  其中， <code class="literal">%%OSREL%%</code> 的值是操作系统以数值表示的版本 (例如
	  <code class="literal">4.9</code>)。 <code class="literal">%%PERL_VERSION%%</code> 和
	  <code class="literal">%%PERL_VER%%</code> 是 <code class="command">perl</code> 的完整版本号 (例如
	  <code class="literal">5.8.9</code>)。许多其它与 port 文档文件有关的
	  <code class="literal">%%变量%%</code> 在 <a class="link" href="install.html#install-documentation" title="5.14.4. 安装附加的文档">相应章节</a> 中进行了介绍。</p><p>如果您还需要进行其它的替换， 可以通过将
	  <code class="varname">PLIST_SUB</code> 变量设置为一组
	  <code class="literal">变量=值</code>
	  对来实现。 其中， <code class="literal">%%VAR%%</code>
	  表示在 <code class="filename">pkg-plist</code> 中将被
	  <em class="replaceable"><code>值</code></em> 替换的那些文字。</p><p>举例来说， 如果 port 需要把很多文件放到和版本有关的目录中，
	  可以在 <code class="filename">Makefile</code> 中按照类似下面的例子：</p><pre class="programlisting">OCTAVE_VERSION= 2.0.13
PLIST_SUB=      OCTAVE_VERSION=${OCTAVE_VERSION}</pre><p>并在 <code class="filename">pkg-plist</code> 中将具体的版本替换为
	  <code class="literal">%%OCTAVE_VERSION%%</code>。 这样， 在升级 port 时，
	  就不需要再到 <code class="filename">pkg-plist</code> 中修改那几十 (或者，
	  有时甚至是上百) 行的内容了。</p><p>如果您的 port 需要根据一定的配置来有条件地安装一些文件，
	  通常的做法是在 <code class="filename">pkg-plist</code> 中列出这些文件时，
	  在对应行的开头加上 <code class="literal">%%TAG%%</code>，
	  并将 <code class="literal">TAG</code> 写到 <code class="filename">Makefile</code>
	  中的 <code class="varname">PLIST_SUB</code> 变量中， 根据需要替换掉， 或替换为
	  <code class="literal">@comment</code>， 后者表示让打包工具忽略这行：</p><pre class="programlisting">.if defined(WITH_X11)
PLIST_SUB+=	X11=""
.else
PLIST_SUB+=	X11="@comment "
.endif</pre><p>与之对应， 在 <code class="filename">pkg-plist</code> 中：</p><pre class="programlisting">%%X11%%bin/foo-gui</pre><p>这一替换过程 (以及加入 <a class="link" href="makefile-manpages.html" title="5.9. 联机手册">联机手册</a> 的过程)，
	  会在 <code class="buildtarget">pre-install</code> 和
	  <code class="buildtarget">do-install</code> 两个 target 之间， 通过读取
	  <code class="filename">PLIST</code> 并写入
	  <code class="filename">TMPPLIST</code>
	  (默认情况下， 是：
	  <code class="filename">WRKDIR/.PLIST.mktmp</code>) 来完成。
	  因此， 如果您的 port 动态生成 <code class="filename">PLIST</code>，
	  就需要在 <code class="buildtarget">pre-install</code> 之前完成。
	  另外， 如果您的 port 需要编辑所生成的文件， 则需要在
	  <code class="buildtarget">post-install</code> 中操作名为
	  <code class="filename">TMPPLIST</code> 的那个文件。</p><p>另一种可行的修改装箱单的方法，
	  则是根据 <code class="varname">PLIST_FILES</code> 和
	  <code class="varname">PLIST_DIRS</code> 这两个变量的设置来进行。
	  它们的值会作为目录名连同 <code class="filename">PLIST</code>
	  的内容一起写入 <code class="filename">TMPPLIST</code>。
	  在 <code class="varname">PLIST_FILES</code>
	  和 <code class="varname">PLIST_DIRS</code> 中列出的名字， 会经历前面所介绍的
	  <code class="literal">%%变量%%</code>
	  替换过程。 除此之外， 在 <code class="varname">PLIST_FILES</code>
	  中列出的文件， 会不加任何修改第出现在最终的装箱单中，
	  而 <code class="literal">@dirrm</code> 将作为前缀加到 <code class="varname">PLIST_DIRS</code>
	  所列的名字之前。 为了达到目的， <code class="varname">PLIST_FILES</code> 和
	  <code class="varname">PLIST_DIRS</code> 必须在写
	  <code class="filename">TMPPLIST</code> 之前，
	  也就是在 <code class="buildtarget">pre-install</code> 或更早的阶段进行设置。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch06s25.html">上一页</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="plist-cleaning.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">6.25. 依赖内核源代码的 Ports </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 7.2. 空目录</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文档和其它文档可从这里下载：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>如果对于FreeBSD有问题，请先阅读
    <a href="http://www.FreeBSD.org/docs.html">文档</a>，如不能解决再联系
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    关于本文档的问题请发信联系
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>