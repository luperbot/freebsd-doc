<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>12.6. 在 bsd.port.mk 之后写一些内容</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter 手册" /><link rel="up" href="porting-dads.html" title="第 12 章 该做什么和不该做什么" /><link rel="prev" href="freebsd-versions.html" title="12.5. __FreeBSD_version 值" /><link rel="next" href="dads-sh-exec.html" title="12.7. 在 wrapper 脚本中使用 exec 语句" /><link rel="copyright" href="trademarks.html" title="法律声明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">12.6. 在 <code class="filename">bsd.port.mk</code> 之后写一些内容</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="freebsd-versions.html">上一页</a> </td><th width="60%" align="center">第 12 章 该做什么和不该做什么</th><td width="20%" align="right"> <a accesskey="n" href="dads-sh-exec.html">下一页</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dads-after-port-mk"></a>12.6. 在 <code class="filename">bsd.port.mk</code> 之后写一些内容</h2></div></div></div><p>不要在 <code class="literal">.include
	    &lt;bsd.port.mk&gt;</code> 这行之后增加任何内容。
	  这通常可以通过在您的 <code class="filename">Makefile</code>
	  中间的某处引用 <code class="filename">bsd.port.pre.mk</code>，
	  并在结尾的地方引用
	  <code class="filename">bsd.port.post.mk</code> 来避免。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">只能够采用
	    <code class="filename">bsd.port.pre.mk</code>/<code class="filename">bsd.port.post.mk</code> 或
	    <code class="filename">bsd.port.mk</code> 两种写法之一；
	    任何时候都不要同时使用两种写法。</p></div><p><code class="filename">bsd.port.pre.mk</code> 只定义了很少的变量，
	  它们可以在 <code class="filename">Makefile</code>
	  中用于进行一些测试， 而 <code class="filename">bsd.port.post.mk</code>
	  则定义了所有其它的变量。</p><p>下面是一些由 <code class="filename">bsd.port.pre.mk</code>
	  定义的比较重要的变量 (这并不是一份完整的列表，
	  您可以阅读 <code class="filename">bsd.port.mk</code> 以获得全部变量的名字)。</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>变量</th><th>描述</th></tr></thead><tbody><tr><td><code class="varname">ARCH</code></td><td>由 <code class="command">uname
		    -m</code> 输出得到的硬件架构的名字
		  (例如， <code class="literal">i386</code>)</td></tr><tr><td><code class="varname">OPSYS</code></td><td>由 <code class="command">uname -s</code> 返回的操作系统类型 (例如，
		  <code class="literal">FreeBSD</code>)</td></tr><tr><td><code class="varname">OSREL</code></td><td>操作系统的版本号 (例如
		  <code class="literal">2.1.5</code> 或
		  <code class="literal">2.2.7</code>)</td></tr><tr><td><code class="varname">OSVERSION</code></td><td>操作系统的版本号的数值形式； 它等于
		  <a class="link" href="freebsd-versions.html" title="12.5. __FreeBSD_version 值"><code class="literal">__FreeBSD_version</code></a>。</td></tr><tr><td><code class="varname">PORTOBJFORMAT</code></td><td>系统默认的执行文件格式
		  (<code class="literal">elf</code> 或 <code class="literal">aout</code>；
		  请注意， <span class="quote">“<span class="quote">现代的</span>”</span> FreeBSD 版本中，
		  <code class="literal">aout</code> 已在淘汰之列。)</td></tr><tr><td><code class="varname">LOCALBASE</code></td><td><span class="quote">“<span class="quote">local</span>”</span> 目录的根 (例如，
		  <code class="literal">/usr/local/</code>)</td></tr><tr><td><code class="varname">PREFIX</code></td><td>port 应被安装到哪里 (参见 <a class="link" href="porting-prefix.html" title="9.4. PREFIX (安装时的顶级目录名) 和 DESTDIR">关于
		    <code class="varname">PREFIX</code> 的更多说明</a>)。</td></tr></tbody></table></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">如果您需要定义
	    <code class="varname">USE_IMAKE</code>， <code class="varname">USE_X_PREFIX</code>， 或
	    <code class="varname">MASTERDIR</code> 这些变量， 则应在引用
	    <code class="filename">bsd.port.pre.mk</code> 之前完成。</p></div><p>下面是一些在引用
	  <code class="filename">bsd.port.pre.mk</code> 之后可以进行的判断：</p><pre class="programlisting"># 如果 perl5 已经在系统中提供， 则不必编译 lang/perl5
.if ${OSVERSION} &gt; 300003
BROKEN= perl is in system
.endif

# ELF 只使用一个 shlib 版本
.if ${PORTOBJFORMAT} == "elf"
TCL_LIB_FILE=  ${TCL_LIB}.${SHLIB_MAJOR}
.else
TCL_LIB_FILE=  ${TCL_LIB}.${SHLIB_MAJOR}.${SHLIB_MINOR}
.endif

# 软件会自动为 ELF 创建符号链接， 但 a.out 则需要另行创建
post-install:
.if ${PORTOBJFORMAT} == "aout"
       ${LN} -sf liblinpack.so.1.0 ${PREFIX}/lib/liblinpack.so
.endif</pre><p>您还记得应该在
	  <code class="literal">BROKEN=</code> 和
	  <code class="literal">TCL_LIB_FILE=</code> 后面使用制表符，
	  而不是空格， 对吧？ :-)</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="freebsd-versions.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="porting-dads.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="dads-sh-exec.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">12.5. __FreeBSD_version 值 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 12.7. 在 wrapper 脚本中使用 <code class="function">exec</code> 语句</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文档和其它文档可从这里下载：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>如果对于FreeBSD有问题，请先阅读
    <a href="http://www.FreeBSD.org/docs.html">文档</a>，如不能解决再联系
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    关于本文档的问题请发信联系
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>