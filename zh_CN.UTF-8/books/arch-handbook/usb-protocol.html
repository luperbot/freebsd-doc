<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>13.5. USB驱动程序的协议信息</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 系统结构手册" /><link rel="up" href="usb.html" title="第 13 章 USB设备" /><link rel="prev" href="usb-devprobe.html" title="13.4. 设备的探测和连接" /><link rel="next" href="newbus.html" title="第 14 章 Newbus" /><link rel="copyright" href="trademarks.html" title="法律声明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">13.5. USB驱动程序的协议信息</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="usb-devprobe.html">上一页</a> </td><th width="60%" align="center">第 13 章 USB设备</th><td width="20%" align="right"> <a accesskey="n" href="newbus.html">下一页</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-protocol"></a>13.5. USB驱动程序的协议信息</h2></div></div></div><p>USB规范没有定义除默认管道外其他管道上使用的协议。这方面的信息
      可以从各种来源获得。最准确的来源是USB主页[1]上的开发者部分。从这些
      页面上可以得到数目不断增长的设备类的规范。这些规范指定从驱动程序
      角度看起来兼容设备应当怎样，它需要提供的基本功能和通信通道上使用的
      协议。USB规范[2]包括了集中器类的描述。人机界面设备(HID)的类规范已经
      创建出来，以迎合对键盘、数字输入板、条形码阅读器、按钮、旋钮(手柄knob)、
      开关等的要求。另一个例子是用于大容量存储设备的类规范。设备类的完整列表
      参看USB主页[1]的开发者部分。</p><p>然而, 许多设备的协议信息还没有被公布。关于所用协议的信息
      可能可以从制造设备的公司获得。一些公司会在给你规范之前要求你签署
      保密协议(Non-Disclosure Agreement, NDA)。大多数情况下，这会阻止
      将驱动程序开放源代码。</p><p>另一个信息的很好来源是Linux驱动程序源代码，因为很多公司已经
      开始为他们的设备提供Linux下的驱动程序。联系那些驱动程序作者询问
      他们的信息来源总是一个好主意。</p><p>例子：人机界面设备。人机界面设备，如键盘、鼠标、数字输入板、
      按钮、拨号盘等的规范被其他设备类规范引用，并在很多设备中使用。
      </p><p>例如，音频扬声器提供到数模转换器的端点，可能还提供额外管道
      用于麦克风。它们也为设备前面的按钮和拨号盘在单独的接口中提供HID
      端点。监视器控制类也是如此。通过可用的内核和用户空间的库，与HID
      类驱动程序或通用驱动程序一起可以简单直接地创建对这些接口的支持。
      另一个设备可以作为在一个配置中的多个接口由不同的设备驱动程序驱动
      的例子，这个设备是一种便宜的键盘，带有老的鼠标接口。为了避免在
      设备中为USB集中器包括一个硬件而导致的成本上升，制造商将从键盘背面的
      PS/2端口接收到的鼠标数据与来自键盘的按键组合成在同一个配置中的
      两个单独的接口。鼠标和键盘驱动程序各自连接到适当的接口，并分配到
      两个独立端点的管道. </p><a id="idp72645456" class="indexterm"></a><p>例子：固件下载。已经开发出来的许多设备是基于通用目的处理器，
      并将额外的USB核心加入其中。由于驱动程序的开发和USB设备的固件仍然
      非常新，许多设备需要在连接(connect)之后下载固件。</p><p>下面的步骤非常简明直接。设备通过供应商和产品ID标识自身。第一
      个驱动程序探测并连接到它，并将固件下载到其中。此后设备自己软复位，
      驱动程序分离。短暂的暂停之后设备宣布它在总线上的存在。设备将改变
      其供应商/产品/版本的ID以反映其提供有固件的事实，因此另一个驱动程序
      将探测它并连接(attach)到它。</p><p>这些类型的设备的一个例子是基于EZ-USB的ActiveWire I/O板。这个
      芯片有一个通用固件下载器。下载到ActiveWire板子上的固件改变版本ID。
      然后它将执行EZ-USB芯片的USB部分的软复位，从USB总线上断开，并再次
      重新连接。</p><p>例子：大容量存储设备。对大容量存储设备的支持主要围绕现有的
      协议构建。Iomega USB Zip驱动器是基于SCSI版本的驱动器。SCSI命令和
      状态信息被包装到块中，在大块(bulk)管道上传输到/来自设备，在USB线
      上模拟SCSI控制器。ATAPI和UFI命令以相似的方式被支持。</p><a id="idp72647760" class="indexterm"></a><p>大容量存储规范支持两种不同类型的对命令块的包装。最初的尝试
      基于通过默认管道发送命令和状态信息，使用大块传输在host和设备之间
      移动数据。在经验基础上设计出另一种方法，这种方法基于包装命令和
      状态块，并在大块out和in端点上发送它们。规范精确地指定了何时必须
      发生什么，以及在碰到错误条件的情况下应该做什么。为这些设备编写
      驱动程序的最大挑战是协调基于USB的协议，让它适合已有的对大容量存储设备
      的支持。CAM提供了钩子，以相当直接了当的方式来完成这个。ATAPI就
      没有这么简单了，因为历史上IDE接口从未有过多种不同的表现方式。
      </p><p>来自Y-E Data的对USB软盘的支持也不是那么直观，因为设计了一套
      新的命令集。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="usb-devprobe.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="usb.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="newbus.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">13.4. 设备的探测和连接 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 第 14 章 Newbus</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文档和其它文档可从这里下载：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>如果对于FreeBSD有问题，请先阅读
    <a href="http://www.FreeBSD.org/docs.html">文档</a>，如不能解决再联系
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    关于本文档的问题请发信联系
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>