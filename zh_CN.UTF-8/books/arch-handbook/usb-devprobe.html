<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>13.4. 设备的探测和连接</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 系统结构手册" /><link rel="up" href="usb.html" title="第 13 章 USB设备" /><link rel="prev" href="usb-dev.html" title="13.3. USB设备信息" /><link rel="next" href="usb-protocol.html" title="13.5. USB驱动程序的协议信息" /><link rel="copyright" href="trademarks.html" title="法律声明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">13.4. 设备的探测和连接</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="usb-dev.html">上一页</a> </td><th width="60%" align="center">第 13 章 USB设备</th><td width="20%" align="right"> <a accesskey="n" href="usb-protocol.html">下一页</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-devprobe"></a>13.4. 设备的探测和连接</h2></div></div></div><a id="idp72638288" class="indexterm"></a><p>集中器(hub)通知新设备已连接后，服务层给端口加电(switch on)，
      为设备提供100mA的电流。
      此时设备处于其默认状态，并监听设备地址0。服务层会通过默认
      管道继续检取各种描述符。此后它将向设备发送Set Address请求，将设备
      从默认设备地址(地址0)移开。可能有多个设备驱动程序支持此设备。例如，
      一个调制解调器可能通过AT兼容接口支持ISDN TA。然而，特定型号的ISDN
      适配器的驱动程序可能提供对此设备的更好支持。为了支持这样的灵活性，
      探测会返回优先级，指示他们的支持级别。支持产品的特定版本会具有最高
      优先级，通用驱动程序具有最低优先级。如果一个配置内有多个接口，也可能
      多个驱动程序会连接到一个设备。每个驱动程序只需支持所有接口的一个子集。
      </p><p>为新连接的设备探测驱动程序时，首先探测设备特定的驱动程序。
      如果没有发现，则探测代码在所有支持的配置上重复探测过程，直到
      在一个配置中连接到一个驱动程序。为了支持不同接口上使用多个驱动
      程序的设备，探测会在一个配置中的所有尚未被驱动程序声明(claim)的
      接口上重复进行。超出集中器功率预算的配置会被忽略。连接期间，驱动
      程序应当把设备初始化到适当状态，但不能复位，因为那样会使得设备将
      它自己从总线上断开，并重新启动探测过程。为了避免消耗不必要的带宽，
      不应当在连接时声明中断管道，而应当延迟分配管道，直到打开文件并真的
      使用数据。当关闭文件时，管道也应当被再次关闭，尽管设备可能仍然
      连接着。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72639824"></a>13.4.1. 设备断开连接(disconnect)和分离(detach)</h3></div></div></div><a id="idp72640464" class="indexterm"></a><p>设备驱动程序与设备进行任何事务期间，应当预期会接收到错误。
        USB的设计支持并鼓励设备在任何点及时断开连接。驱动程序应当确保
	当设备不在时做正确的事情。</p><p>此外，断开连接(disconnect)后又重新连接(reconnect)的设备不会
        被重新连接(reattach)为相同的设备实例。
        将来当更多的设备支持序列号（参看设备描述符），
	或开发出其他定义设备标识的方法的时候，这种情况可能会改变。
	</p><p>设备断开连接是由集中器在传递到集中器驱动程序的中断包中发
        信号通知(signal)的。状态改变信息指示哪个端口发现了连接改变。
        连接到那个端口上的设备的所有设备驱动程序共用的设备分离方法被调用，
        结构被彻底清理。如果端口状态指示同时一个设备已经连接(connect)到那个
	端口，则探测和连接设备的过程将被启动。设备复位将在集中器上产生
        一个断开-连接序列，并将按上面所述进行处理。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="usb-dev.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="usb.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="usb-protocol.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">13.3. USB设备信息 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 13.5. USB驱动程序的协议信息</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文档和其它文档可从这里下载：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>如果对于FreeBSD有问题，请先阅读
    <a href="http://www.FreeBSD.org/docs.html">文档</a>，如不能解决再联系
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    关于本文档的问题请发信联系
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>