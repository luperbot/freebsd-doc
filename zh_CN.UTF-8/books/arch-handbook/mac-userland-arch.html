<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>6.8. 应用层体系结构</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 系统结构手册" /><link rel="up" href="mac.html" title="第 6 章 TrustedBSD MAC 框架" /><link rel="prev" href="mac-entry-point-reference.html" title="6.7. MAC策略入口函数参考" /><link rel="next" href="mac-conclusion.html" title="6.9. 小结" /><link rel="copyright" href="trademarks.html" title="法律声明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.8. 应用层体系结构</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mac-entry-point-reference.html">上一页</a> </td><th width="60%" align="center">第 6 章 TrustedBSD MAC 框架</th><td width="20%" align="right"> <a accesskey="n" href="mac-conclusion.html">下一页</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-userland-arch"></a>6.8. 应用层体系结构</h2></div></div></div><p>TrustedBSD MAC 框架包含了一组策略无关的组成元素，包括管理抽象标记的 MAC 接口库，
      对系统信任状管理体系的修改, 为用户分配 MAC 标记提供支持的 login 库函数，
      以及若干负责维护和更新内核对象(进程、文件和网络接口等)安全标记的工具。
      不久，将有更多关于应用层体系结构的详细信息被包含进来。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-userland-labels"></a>6.8.1. 策略无关的标记管理 API</h3></div></div></div><p>TrustedBSD MAC 提供的大量库函数和系统调用，允许应用程序使用一种统一的、策略无关的接口来处理对象的 MAC 标记。
       如此，应用程序可以轻松管理各种策略的标记，无需为增加对某个特定策略的支持而重新编码。许多通用工具，比如
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>，<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> 和 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a>，使用这些策略无关的接口查询网络结构、文件和进程的标记信息。
       这些 API 也被用于支持 MAC 管理工具，比如，<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getfmac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">getfmac</span>(8)</span></a>，<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getpmac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">getpmac</span>(8)</span></a>， <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=setfmac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">setfmac</span>(8)</span></a>， <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=setfsmac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">setfsmac</span>(8)</span></a>，和 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=setpmac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">setpmac</span>(8)</span></a>。
       MAC API的设计细节可参考 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">mac</span>(3)</span></a>.</p><p>应用程序处理的 MAC 标记有两种存在形式：内部形式，用来返回和设置进程和对象的标记（<code class="literal">mac_t</code>）；
	基于 C 字符串的外部形式，作为标记在配置文件中的存放形式，用于向用户显示或者由用户输入。
       每一个 MAC 标记由一组标记元素组成，其中每个元素是一个形如（名字，值）的二元组。
       内核中的每个策略模块分别被指定一个特定的名字，由它们对标记中与该名字对应的值采用其策略特有的方式进行解析。
       采用外部形式表示的标记，其标记元素表示为名字 <code class="literal">/</code> 值，元素之间以逗号分隔。
	应用程序可以使用 MAC 框架提供的 API 将一个安全标记在内部形式和文本形式之间进行转换。
       每当向内核查询某个对象的安全标记时，内部形式的标记必须针对所需的元素集合作好内部标记存储准备。
       为此，通常采用下面两种方式之一：使用 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac_prepare&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">mac_prepare</span>(3)</span></a> 和一个包含所需标记元素的任意列表；或者，
       使用从<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">mac.conf</span>(5)</span></a> 配置文件中加载缺省元素集合的某个系统调用。在对象级别设置缺省标记，将允许应用程序在不确定
	系统是否采用相关策略的情况下，也能向用户返回与对象相关联的有意义的安全标记。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">目前的 MAC 库不支持直接修改内部形式的标记元素，所有的修改必须按照下列的步骤进行：
       将内部形式的标记转换成文本字符串，对字符串进行编辑，最后将其转换成内部形式标记。如果应用程序的作者证明确实有需要，
       可以在将来的版本中加入对内部形式标记进行直接修改的接口。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mac-userland-credentials"></a>6.8.2. 为用户指定标记</h3></div></div></div><p>用户上下文管理的标记接口，
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=setusercontext&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">setusercontext</span>(3)</span></a>
        ，的行为已经被修改为，从
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a>
        中查询与某个用户登录类别相关联的 MAC 安全标记。
        当 <code class="literal">LOGIN_SETALL</code>
        被设置，或者当 <code class="literal">LOGIN_SETMAC</code>
        被明确指定时，这些安全标记将和其他用户上下文参数一起被设置。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">可以预期，在今后的某个版本中，FreeBSD 将把 MAC 标记从
      <code class="filename">login.conf</code> 的用户类别数据库中抽出，为其维护一个独立的数据库。
      不过在此前后，<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=setusercontext&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">setusercontext</span>(3)</span></a> API应该保持不变。</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mac-entry-point-reference.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="mac.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="mac-conclusion.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">6.7. MAC策略入口函数参考 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 6.9. 小结</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文档和其它文档可从这里下载：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>如果对于FreeBSD有问题，请先阅读
    <a href="http://www.FreeBSD.org/docs.html">文档</a>，如不能解决再联系
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    关于本文档的问题请发信联系
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>