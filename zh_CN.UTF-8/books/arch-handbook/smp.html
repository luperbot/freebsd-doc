<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>第 8 章 SMPng 设计文档</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 系统结构手册" /><link rel="up" href="kernel.html" title="部分 I. 内核" /><link rel="prev" href="vm-tuning.html" title="7.6. 调整FreeBSD的虚拟内存系统" /><link rel="next" href="smp-lock-fundamentals.html" title="8.2. 基本工具与上锁的基础知识" /><link rel="copyright" href="trademarks.html" title="法律声明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 8 章 SMPng 设计文档</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="vm-tuning.html">上一页</a> </td><th width="60%" align="center">部分 I. 内核</th><td width="20%" align="right"> <a accesskey="n" href="smp-lock-fundamentals.html">下一页</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="smp"></a>第 8 章 SMPng 设计文档</h2></div><div><span class="authorgroup">写作：<span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">John</span> <span class="surname">Baldwin</span></span> 和 <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Robert</span> <span class="surname">Watson</span></span>. </span></div><div><span class="authorgroup">翻译：<span xmlns="http://www.w3.org/1999/xhtml" class="author"></span>. </span></div><div><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">版权 © 2002, 2004-2005 John Baldwin, Robert Watson</p></div></div></div><div class="toc"><div class="toc-title">目录</div><dl class="toc"><dt><span class="sect1"><a href="smp.html#smp-intro">8.1. 绪论</a></span></dt><dt><span class="sect1"><a href="smp-lock-fundamentals.html">8.2. 基本工具与上锁的基础知识</a></span></dt><dt><span class="sect1"><a href="smp-design.html">8.3. 架构与设计概览</a></span></dt><dt><span class="sect1"><a href="smp-lock-strategies.html">8.4. 特定数据的锁策略</a></span></dt><dt><span class="sect1"><a href="smp-implementation-notes.html">8.5. 实现说明</a></span></dt><dt><span class="sect1"><a href="smp-misc.html">8.6. 其它话题</a></span></dt><dt><span class="glossary"><a href="smp.html#smp-glossary">术语表</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="smp-intro"></a>8.1. 绪论</h2></div></div></div><a id="idp70907216" class="indexterm"></a><a id="idp70907856" class="indexterm"></a><p>这份文档对目前 SMPng 架构的设计与实现进行了介绍。
      它首先介绍了基本的原语和相关工具， 其后是关于
      FreeBSD 内核的同步与执行模型， 接下来讨论了具体系统中的锁策略，
      并描述了在各个子系统中引入细粒度的同步和实现并行化的步骤，
      最后是详细的实现说明， 用以解释最初做出某些设计决策的动机，
      并使读者了解使用特定的原语所可能产生的重大影响。</p><p>这份文档仍在撰写当中， 并将不断更新以反映与 SMPng
      项目有关的最新设计与实现的情况。 其中有许多小节目前还只是提纲，
      但我们会逐渐为其充实内容。 关于这份文档的更新和建议，
      请发给文档编辑。</p><a id="idp70909136" class="indexterm"></a><p>SMPng 的目标是使内核能够并发执行。 基本上，
      内核是一个很大而复杂的程序。 要让内核能够多线程地执行，
      我们需要使用某些其它多线程程序在实现时所用到的工具，
      这包括互斥体(mutex)、 共享/排他锁(shared/exclusive lock)、
      信号量(semaphores) 和条件变量(condition variable)。
      如果希望了解它们以及其它 SMP 术语，
      请参阅本文的 <a class="xref" href="smp.html#smp-glossary" title="术语表">术语表</a> 一节。</p></div><div class="glossary"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="smp-glossary"></a>术语表</h2></div></div></div><dl><dt><a id="smp-glossary-atomic"></a><span class="glossterm">原子</span></dt><dd class="glossdef"><p>当遵循适当的访问协议时， 如果一操作的效果对其它所有 CPU
	  均可见， 则称其为原子操作。 狭义的原子操作是机器直接提供的。
	  就更高的抽象层次而言， 如果结构体的多个成员由一个锁保护，
	  则如果对它们的操作都是在上锁后、 解锁前进行的，
	  也可以称其为原子操作。</p><p>参见操作.</p></dd><dt><a id="smp-glossary-block"></a><span class="glossterm">阻塞</span></dt><dd class="glossdef"><p>线程等待锁、 资源或条件时被阻塞。
	  这一术语也因此被赋予了太多的意涵。</p><p>参见休眠.</p></dd><dt><a id="smp-glossary-critical-section"></a><span class="glossterm">临界区</span></dt><dd class="glossdef"><p>不允许发生抢占的代码段。 使用
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=critical_enter&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">critical_enter</span>(9)</span></a> API 来表示进入和退出临界区。</p></dd><dt><a id="smp-glossary-MD"></a><span class="glossterm">MD</span></dt><dd class="glossdef"><p>表示与机器/平台有关。</p><p>参见MI.</p></dd><dt><a id="smp-glossary-memory-operation"></a><span class="glossterm">内存操作</span></dt><dd class="glossdef"><p>内存操作包括读或写内存中的指定位置。</p></dd><dt><a id="smp-glossary-MI"></a><span class="glossterm">MI</span></dt><dd class="glossdef"><p>表示与机器/平台无关。</p><p>参见MD.</p></dd><dt><a id="smp-glossary-operation"></a><span class="glossterm">操作</span></dt><dd><p>见内存操作.</p></dd><dt><a id="smp-glossary-primary-interrupt-context"></a><span class="glossterm">主中断上下文</span></dt><dd class="glossdef"><p>主中断上下文表示当发生中断时所执行的那段代码。
	  这些代码可以直接运行某个中断处理程序， 或调度一异步终端线程，
	  以便为给定的中断源执行中断处理程序。</p></dd><dt><span class="glossterm">实时内核线程</span></dt><dd class="glossdef"><p>一种高优先级的内核线程。 目前，
	  只有中断线程属于实时优先级的内核线程。</p><p>参见线程.</p></dd><dt><a id="smp-glossary-sleep"></a><span class="glossterm">休眠</span></dt><dd class="glossdef"><p>当进程由条件变量或通过 <code class="function">msleep</code> 或
	  <code class="function">tsleep</code> 阻塞并进入休眠队列时， 称其进入休眠状态。</p><p>参见阻塞.</p></dd><dt><a id="smp-glossary-sleepable-lock"></a><span class="glossterm">可休眠锁</span></dt><dd class="glossdef"><p>可休眠锁是一种在进程休眠时仍可持有的锁。
	  锁管理器 (lockmgr) 锁和 sx 锁是目前 FreeBSD 中仅有的可休眠锁。
	  最终， 某些 sx 锁， 例如 allproc (全部进程) 和 proctree (进程树)
	  锁将成为不可休眠锁。</p><p>参见休眠.</p></dd><dt><a id="smp-glossary-thread"></a><span class="glossterm">线程</span></dt><dd class="glossdef"><p>由 struct thread 所表达的内核线程。 线程可以持有锁，
	  并拥有独立的执行上下文。</p></dd><dt><a id="smp-glossary-wait-channel"></a><span class="glossterm">等待通道</span></dt><dd class="glossdef"><p>线程可以在其上休眠的内核虚拟地址。</p></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="vm-tuning.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="kernel.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="smp-lock-fundamentals.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">7.6. 调整FreeBSD的虚拟内存系统 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 8.2. 基本工具与上锁的基础知识</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文档和其它文档可从这里下载：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>如果对于FreeBSD有问题，请先阅读
    <a href="http://www.FreeBSD.org/docs.html">文档</a>，如不能解决再联系
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    关于本文档的问题请发信联系
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>