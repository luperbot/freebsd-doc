<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>20.2. A Z állományrendszer (ZFS)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="filesystems.html" title="20. fejezet - Támogatott állományrendszerek" /><link rel="prev" href="filesystems.html" title="20. fejezet - Támogatott állományrendszerek" /><link rel="next" href="vinum-vinum.html" title="21. fejezet - A Vinum kötetkezelõ" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">20.2. A Z állományrendszer (ZFS)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="filesystems.html">Vissza</a> </td><th width="60%" align="center">20. fejezet - Támogatott állományrendszerek</th><td width="20%" align="right"> <a accesskey="n" href="vinum-vinum.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filesystems-zfs"></a>20.2. A Z állományrendszer (ZFS)</h2></div></div></div><p>A <span class="trademark">Sun</span>TM Z állományrendszere egy új,
      közös tárolási módszeren
      nyugvó technológia.  Ez annyit jelent a
      gyakorlatban, hogy mindig csak annyi helyet foglal, amennyire az
      adatoknak közvetlenül szüksége van.
      Emellett úgy alakították ki, hogy az adatok
      épségét minél inkább
      védje, ezért például
      megtalálhatjuk benne a pillanatképek
      készítését, a másolatok
      létrehozását és az adatok
      sértetlenségének
      ellenõrzését.  Továbbá egy
      <acronym class="acronym">RAID</acronym>-Z néven bemutatott új
      replikációs modellt is támogat.  A
      <acronym class="acronym">RAID</acronym>-Z alapvetõen a
      <acronym class="acronym">RAID</acronym>-5 megoldásához
      hasonlít, azonban írás során
      keletkezõ hibák ellen igyekszik védelmet
      nyújtani.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91556816"></a>20.2.1. A ZFS finomhangolása</h3></div></div></div><p>A <acronym class="acronym">ZFS</acronym> funkcióit
	megvalósító alrendszer
	alapértelmezés szerint meglehetõsen sok
	erõforrást kíván, ezért nem
	árt a legjobb hatékonyságra behangolnunk a
	mindennapokban felmerülõ igények mentén.
	Mivel ez még egy fejlesztés és
	tesztelés alatt álló része a
	FreeBSD-nek, elképzelhetõ, hogy ez a jövõben
	változik, viszont jelen pillanatban a következõ
	lépéseket javasoljuk.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91558224"></a>20.2.1.1. Memória</h4></div></div></div><p>Hasznos, ha a rendszerünkben legalább
	  1 GB memória található, de
	  inkább 2 vagy több az ajánlott.  Az itt
	  szereplõ példákban ehelyett azonban
	  mindenhol csupán 1 GB-ot
	  feltételezünk.</p><p>Néhányaknak sikerült
	  1 GB-nál kevesebb központi
	  memóriával is használni ezt az
	  állományrendszert, azonban ilyenkor nagyon
	  könnyen elõfordulhat, hogy komolyabb terhelés
	  esetén a FreeBSD a memória elfogyása miatt
	  egyszerûen összeomlik.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91559760"></a>20.2.1.2. A rendszermag beállításai</h4></div></div></div><p>A rendszermag konfigurációs
	  állományából javasolt
	  eltávolítani az összes nem használt
	  meghajtót és funkciót.  A legtöbb
	  meghajtó egyébként is
	  elérhetõ modul formájában, és
	  a <code class="filename">/boot/loader.conf</code>
	  állományon keresztül minden gond
	  nélkül betölthetõek.</p><p>Az <span class="trademark">i386</span>TM architektúránál
	  szükségünk lesz az alábbi
	  konfigurációs beállítás
	  megadására, majd a rendszermag
	  újrafordítására, végül
	  a rendszer újraindítására:</p><pre class="programlisting">options 	KVA_PAGES=512</pre><p>Ezzel az opcióval a rendszermag
	  címterét növeljük meg, aminek
	  eredményeképpen a <code class="varname">vm.kvm_size</code>
	  változót immáron az eredetileg
	  1 GB-os (<acronym class="acronym">PAE</acronym> használata
	  esetén pedig 2 GB-os) határ felé
	  tudjuk állítani.  Az itt megadandó
	  értéket úgy tudjuk meghatározni,
	  ha a beállítani kívánt
	  méret MB-okban számolt
	  értékét elosztjuk néggyel.  A
	  példában tehát az <code class="literal">512</code>
	  egy 2 GB nagyságú címteret ad
	  meg.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91568208"></a>20.2.1.3. A rendszertöltõ
	  beállításai</h4></div></div></div><p>A <code class="filename">kmem</code> címterét az
	  összes FreeBSD által ismert architektúra
	  esetében érdemes megnövelnünk.  A
	  teszteléshez használt rendszeren 1 GB
	  fizikai memória állt rendelkezésre, itt a
	  <code class="filename">/boot/loader.conf</code>
	  állományban a következõ
	  értékek megadásával minden
	  remekül mûködött:</p><pre class="programlisting">vm.kmem_size="330M"
vm.kmem_size_max="330M"
vfs.zfs.arc_max="40M"
vfs.zfs.vdev.cache.size="5M"</pre><p>A ZFS finomhangolásával kapcsolatos
	  további javasolatokat a <code class="uri"><a class="uri" href="http://wiki.freebsd.org/ZFSTuningGuide" target="_top">http://wiki.freebsd.org/ZFSTuningGuide</a></code>
	  címen olvashatunk.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91571536"></a>20.2.2. A <acronym class="acronym">ZFS</acronym> használata</h3></div></div></div><p>A Z állományrendszerhez létezik egy
	olyan mechanizmus, amelyen keresztül már a FreeBSD
	indítása során el tudjuk végezni a
	közös tárolók
	csatlakoztatását:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 'zfs_enable="YES"' &gt;&gt; /etc/rc.conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/zfs start</code></strong></pre><p>A leírás fennmaradó
	  részében feltételezzük, hogy
	  három <acronym class="acronym">SCSI</acronym>-lemezünk van,
	  amelyeket rendre a
	  <code class="filename">da0</code>,
	  <code class="filename">da1</code>
	  és
	  <code class="filename">da2</code>
	  eszközök formájában tudunk
	  elérni.  Az <acronym class="acronym">IDE</acronym> lemezek
	  tulajdonosainak értelemszerûen itt majd az
	  <code class="filename">ad</code>
	  eszközneveket kell használniuk a
	  <acronym class="acronym">SCSI</acronym>-eszközök hivatkozásai
	  helyett.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91582032"></a>20.2.2.1. Egyetlen közös tároló
	  használata</h4></div></div></div><p>A <code class="command">zpool</code> kiadásával
	  egyetlen lemezen is létre tudunk hozni egy
	  egyszerû, nem redundáns <acronym class="acronym">ZFS</acronym>
	  partíciót:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool create minta /dev/da0</code></strong></pre><p>Az új közös tárterület a
	  <code class="command">df</code> parancs
	  felhasználásával rögtön
	  láthatóvá válik:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235230  1628718    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032846 48737598     2%    /usr
minta        17547136       0 17547136     0%    /minta</pre><p>A parancs kimenetében tisztán
	  láthatjuk, hogy a <code class="literal">minta</code> nevû
	  tároló nem csak egyszerûen
	  elkészült, hanem egyúttal
	  <span class="emphasis"><em>csatolódott</em></span>.  Innentõl
	  már a többi állományrendszerhez
	  hasonlóan tetszõlegesen elérhetõ, az
	  alábbi példához hasonlóan
	  állományok hozhatóak rajta létre
	  vagy listázható a tartalma:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /minta</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>touch proba</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls -al</code></strong>
total 4
drwxr-xr-x   2 root  wheel    3 Aug 29 23:15 .
drwxr-xr-x  21 root  wheel  512 Aug 29 23:12 ..
-rw-r--r--   1 root  wheel    0 Aug 29 23:15 proba</pre><p>Sajnos azonban ez a tároló még ki sem
	  használja a <acronym class="acronym">ZFS</acronym> által
	  felkínált lehetõségeket.
	  Ezért most hozzunk létre egy
	  állományrendszert ezen a tárolón
	  belül és engedélyezzük rajta a
	  tömörítést:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create minta/tomoritett</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=gzip minta/tomoritett</code></strong></pre><p>A <code class="literal">minta/tomoritett</code> most már egy
	  tömörített Z állományrendszer.
	  Próbáljuk ki mit tud, és másoljunk
	  néhány nagyobb méretû
	  állományt a <code class="filename">/minta/tomoritett</code>
	  könyvtárba.</p><p>Ezután a tömörítés
	  akár ki is kapcsolható:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=off minta/tomoritett</code></strong></pre><p>Az állományrendszer
	  leválasztásához adjuk ki a lenti parancsot,
	  majd ellenõrizzük az eredményét a
	  <code class="command">df</code> használatával:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs umount minta/tomoritett</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235232  1628716    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032864 48737580     2%    /usr
minta        17547008       0 17547008     0%    /minta</pre><p>Tegyük ismét elérhetõvé
	  és csatlakoztassuk újra az
	  állományrendszert, majd nézzük meg
	  az eredményt a <code class="command">df</code> paranccsal:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs mount minta/tomoritett</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
minta               17547008       0 17547008     0%    /minta
minta/tomoritett    17547008       0 17547008     0%    /minta/tomoritett</pre><p>A közös terület és az
	  állományrendszer mellesleg a
	  <code class="command">mount</code> parancs kimenetébõl is
	  megfigyelhetõ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
/dev/ad0s1a on / (ufs, local)
devfs on /dev (devfs, local)
/dev/ad0s1d on /usr (ufs, local, soft-updates)
minta on /minta (zfs, local)
minta/tomoritett on /minta/tomoritett (zfs, local)</pre><p>Látható, hogy a létrehozásuk
	  után a Z állományrendszerek teljesen
	  hétköznapi módon viselkednek, de
	  természetesen további lehetõségek is
	  elérhetõek hozzájuk.  A következõ
	  példában <code class="literal">adat</code> néven
	  készítünk egy új
	  állományrendszert.  Mivel ide majd nagyon fontos
	  állományokat akarunk elhelyezni,
	  állítsuk be, hogy minden adatblokkból
	  két példány legyen:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create minta/adat</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set copies=2 minta/adat</code></strong></pre><p>A <code class="command">df</code> újbóli
	  kiadásával most már látható
	  is ez az állományrendszer és annak
	  tárfoglalása:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
minta               17547008       0 17547008     0%    /minta
minta/tomoritett    17547008       0 17547008     0%    /minta/tomoritett
minta/adat          17547008       0 17547008     0%    /minta/adat</pre><p>Vegyük észre, hogy a közös
	  területen levõ állományrendszerek
	  mindegyikén ugyanannyi szabad terület van.  A
	  <code class="command">df</code> segítségével a
	  késõbbiekben remekül megfigyelhetõ lesz,
	  hogy az egyes állományrendszerek mindig csak
	  annyi területet foglalnak el a közös
	  területbõl, amennyire abban a pillanatban
	  ténylegesen szükségünk van.  A Z
	  állományrendszerek esetén megszûnik
	  a partíciók és kötetek fogalma,
	  és több állományrendszer
	  tárolódik egyazon közös
	  területen.  Ha már nem akarjuk használni,
	  egyszerûen csak töröljük le az
	  állományrendszereket és ezt a
	  közös tárolót:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs destroy minta/tomoritett</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs destroy minta/adat</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool destroy minta</code></strong></pre><p>Nyilván tapasztalhattunk már, hogy a
	  lemezeink olykor menthetetlenül meghibásodnak.
	  Amikor egy lemezes meghajtó tönkremegy, a rajta
	  tárolt adatok általában elvesznek.  Az
	  ilyen jellegû kellemetlenségek
	  elkerülésének egyik módja az
	  ún.  <acronym class="acronym">RAID</acronym>-tömbök
	  építése.  A következõ
	  szakaszban bemutatjuk, hogy a Z
	  állományrendszerek esetén hogyan tudunk
	  ilyen tömböket készíteni.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91620048"></a>20.2.2.2. <acronym class="acronym">RAID</acronym>-Z tömbök</h4></div></div></div><p>Korábban már utaltunk rá, hogy ebben
	  a szakaszban három <acronym class="acronym">SCSI</acronym>-lemez,
	  vagyis a <code class="filename">da0</code>,
	  <code class="filename">da1</code> és
	  <code class="filename">da2</code> eszközök
	  használatát feltételezzük (vagy
	  természetesen <code class="filename">ad0</code> és
	  így tovább, ha IDE-lemezeket használunk).
	  Egy <acronym class="acronym">RAID</acronym>-Z formátumú
	  közös tároló
	  készítéséhez a következõ
	  parancsot kell kiadni:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool create tarolo raidz da0 da1 da2</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">A <span class="trademark">Sun</span>TM ajánlása szerint egy
	    <acronym class="acronym">RAID</acronym>-Z konfigurációban
	    legalább három, legfeljebb kilenc lemezt
	    javasolt alkalmazni.  Ha egyetlen közös
	    tárolóban esetleg tíznél
	    több lemezt szeretnénk felhasználni,
	    akkor érdemes inkább kisebb
	    <acronym class="acronym">RAID</acronym>-Z csoportokra felosztani ezeket.  Ha
	    viszont csak két lemezünk van, de
	    továbbra is redundanciára lenne
	    szükségünk, hozzunk helyette létre
	    egy <acronym class="acronym">ZFS</acronym> tükrözést.
	    Ezzel kapcsolatban részletesebben a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a> man
	    oldalon keresztül
	    tájékozódhatunk.</p></div><p>Ennek hatására tehát keletkezik egy
	  <code class="literal">tarolo</code> nevû Z-tároló.
	  Ez a korábbiakhoz hasonló módon
	  ellenõrizhetõ is a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> és
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=df&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">df</span>(1)</span></a> parancsokon keresztül.  Természetesen
	  az iménti listába további
	  lemezeszközök tetszõlegesen felvehetõek.
	  Most hozzunk létre ezen a közös
	  területen egy <code class="literal">felhasznalok</code> nevû
	  állományrendszert, ahová majd a
	  felhasználók adatait fogjuk tenni:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create tarolo/felhasznalok</code></strong></pre><p>Miután ezzel megvagyunk, az imént
	  létrehozott állományrendszerre nyugodtan
	  beállíthatunk tömörítést
	  és biztonsági másolatokat.  Ebben az
	  alábbi parancsok lesznek a
	  segítségünkre:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set copies=2 tarolo/felhasznalok</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=gzip tarolo/felhasznalok</code></strong></pre><p>Ezt követõen költöztessük
	  át a felhasználókat, vagyis másoljuk
	  át az adataikat ide és hozzuk létre a
	  megfelelõ szimbolikus linkeket:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp -rp /home/* /tarolo/felhasznalok</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -rf /home /usr/home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /tarolo/felhasznalok /home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /tarolo/felhasznalok /usr/home</code></strong></pre><p>A felhasználók adatai immáron a
	  frissen létrehozott <code class="filename">/tarolo/felhasznalok</code>
	  állományrendszeren tárolódnak.
	  Próbáljuk ki, hozzunk létre egy új
	  felhasználót és jelentkezzünk be
	  vele.</p><p>Készítsünk most egy
	  pillanatképet is, amelyet aztán késõbb
	  szükség esetén vissza tudunk
	  állítani:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot tarolo/felhasznalok@08-08-30</code></strong></pre><p>A <code class="literal">snapshot</code> csak valós
	  állományrendszerekkel mûködik,
	  könyvtárakra vagy állományokra nem.
	  A nevében a <code class="literal">@</code> karakter
	  választja el egymástól a
	  hozzá tartozó címkét az
	  állományrendszer vagy kötet
	  nevétõl.  Ha netalán a
	  felhasználói könyvtárak
	  valamiért megsérültek volna, a
	  következõ paranccsal
	  állíthatóak vissza:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs rollback tarolo/felhasznalok@08-08-30</code></strong></pre><p>Az adott idõpontban aktív
	  pillanatképeket az adott állományrendszer
	  <code class="filename">.zfs/snapshot</code>
	  könyvtárában találhatjuk meg.
	  Például az elõbb készített
	  pillanatkép az alábbi paranccsal
	  nézhetõ meg:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls /tarolo/felhasznalok/.zfs/snapshot</code></strong></pre><p>Ha ebbõl elindulunk, akkor pillanatok alatt
	  írható egy olyan szkript, amely a
	  felhasználók adatairól havonta
	  készít egy pillanatképet.  Ilyenkor
	  azonban fontos számításba vennünk,
	  hogy az idõvel felgyülemlõ pillanatképek
	  rengeteg helyet el tudnak foglalni.  A korábbi
	  pillanatkép így távolítható
	  el:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs destroy tarolo/felhasznalok@08-08-30</code></strong></pre><p>Miután alaposan kipróbáltuk a
	  <code class="filename">/tarolo/felhasznalok</code>
	  néven létrehozott
	  állományrendszerünket,
	  állítsuk be véglegesen ez eddigi
	  <code class="filename">/home</code>
	  állományrendszer helyére:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set mountpoint=/home tarolo/felhasznalok</code></strong></pre><p>Ekkor a <code class="command">df</code> és
	  <code class="command">mount</code> parancsok használatával
	  meggyõzõdhetünk róla, hogy ezt az
	  állományrendszert innentõl már
	  valóban a <code class="filename">/home</code>
	  könyvtárnak tekintjük:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
/dev/ad0s1a on / (ufs, local)
devfs on /dev (devfs, local)
/dev/ad0s1d on /usr (ufs, local, soft-updates)
tarolo on /tarolo (zfs, local)
tarolo/felhasznalok on /home (zfs, local)
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem          1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a           2026030  235240  1628708    13%    /
devfs                       1       1        0   100%    /dev
/dev/ad0s1d          54098308 1032826 48737618     2%    /usr
tarolo               26320512       0 26320512     0%    /tarolo
tarolo/felhasznalok  26320512       0 26320512     0%    /home</pre><p>Ezzel lényegében befejeztük a
	  <acronym class="acronym">RAID</acronym>-Z tömb
	  konfigurációját.  Az
	  állományrendszerek állapotára
	  vonatkozóan a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a>
	  alkalmazásával akár naponta
	  kérhetünk ellenõrzést:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 'daily_status_zfs_enable="YES"' &gt;&gt; /etc/periodic.conf</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91669200"></a>20.2.2.3. A <acronym class="acronym">RAID</acronym>-Z
	  helyreállítása</h4></div></div></div><p>Minden szoftveres <acronym class="acronym">RAID</acronym>
	  implementáció kínál valamilyen
	  megoldást az állapotának
	  ellenõrzésére, ez alól
	  tulajdonképpen a <acronym class="acronym">ZFS</acronym> sem
	  kivétel.  A <acronym class="acronym">RAID</acronym>-Z
	  eszközök állapota a következõ
	  paranccsal kérdezhetõ le:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status -x</code></strong></pre><p>Ezt az üzenetet láthatjuk, amikor minden
	  tároló kifogástalanul mûködik
	  és semmilyen probléma sincs:</p><pre class="screen">all pools are healthy</pre><p>Ha viszont valamilyen gond lenne valamelyik lemezzel,
	  például leállt, akkor az elõbbi
	  parancs eredménye ehhez lesz hasonló:</p><pre class="screen">  pool: tarolo
 state: DEGRADED
status: One or more devices has been taken offline by the administrator.
	Sufficient replicas exist for the pool to continue functioning in a
	degraded state.
action: Online the device using 'zpool online' or replace the device with
	'zpool replace'.
 scrub: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	tarolo      DEGRADED     0     0     0
	  raidz1    DEGRADED     0     0     0
	    da0     ONLINE       0     0     0
	    da1     OFFLINE      0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>A válasz szerint az eszközt az
	  adminisztrátor állította le.  Ez
	  ennél a példánál valóban
	  igaz.  Lemezeket a következõ módon lehet
	  leállítani:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool offline tarolo da1</code></strong></pre><p>Így miután leállítottuk a
	  rendszert, a <code class="filename">da1</code> eszköz
	  cserélhetõ.  A rendszer soron következõ
	  indításakor ezzel a paranccsal tudjuk jelezni
	  logikailag is a lemez cseréjét:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool replace tarolo da1</code></strong></pre><p>Nézzük meg újra a tömb
	  állapotát, de ezúttal a <code class="option">-x</code>
	  kapcsoló megadása nélkül, mivel csak
	  így fogjuk látni:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status tarolo</code></strong>
 pool: tarolo
 state: ONLINE
 scrub: resilver completed with 0 errors on Sat Aug 30 19:44:11 2008
config:

	NAME        STATE     READ WRITE CKSUM
	tarolo      ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>A példa szerint minden megfelelõen
	  mûködik.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91679696"></a>20.2.2.4. Az adatok ellenõrzése</h4></div></div></div><p>Elõzetesen már szó esett róla,
	  hogy a <acronym class="acronym">ZFS</acronym> képes a tárolt
	  adatok sértetlenségének
	  ellenõrzésére.  Az új
	  állományrendszerek
	  létrehozásánál ez a
	  lehetõség automatikusan aktiválódik,
	  de tetszés szerint letiltható:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set checksum=off tarolo/felhasznalok</code></strong></pre><p>Ez a lépés viszont nem
	  feltétlenül jó döntés, mivel az
	  adatintegritás megtartásához
	  felhasznált ellenõrzõ összegek nagyon
	  kevés helyet foglalnak és meglehetõsen
	  hasznosak.  Emellett semmilyen észlelhetõ
	  lassulást nem okoznak az állományrendszer
	  használata során.  Ha engedélyezzük,
	  a <acronym class="acronym">ZFS</acronym> ilyen ellenõrzõ
	  összegek segítségével folyamatosan
	  figyelni tudja az adatok épségét.  Ezt az
	  ellenõrzést a <code class="literal">scrub</code> paranccsal
	  válthatjuk ki.  Nézzük meg
	  például a <code class="literal">tarolo</code>
	  esetében:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool scrub tarolo</code></strong></pre><p>Ez a vizsgálat a tárolt adatok
	  mennyiségétõl függõen nagyon
	  sokáig is eltarthat, illetve rengeteg
	  lemezmûveletet foglal magában, ezért
	  egyszerre csak egy ilyen futtatása javasolt.
	  Miután befejezõdött, a tároló
	  állapota az eredményének megfelelõen
	  frissül, amelyet közvetlenül utána le is
	  kérdezhetünk:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status tarolo</code></strong>
 pool: tarolo
 state: ONLINE
 scrub: scrub completed with 0 errors on Sat Aug 30 19:57:37 2008
config:

	NAME        STATE     READ WRITE CKSUM
	tarolo      ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>A példában látható az
	  utolsó ellenõrzés ideje.  Ezen
	  lehetõség használatával
	  hosszú idõn keresztül szavatolni tudjuk az
	  adataink épségét.</p><p>A Z állományrendszerrel kapcsolatos
	  további beállítási
	  lehetõségekrõl a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=zfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">zfs</span>(8)</span></a> és
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a> man oldalakon olvashatunk.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="filesystems.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="filesystems.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="vinum-vinum.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">20. fejezet - Támogatott állományrendszerek </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 21. fejezet - A Vinum kötetkezelõ</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>