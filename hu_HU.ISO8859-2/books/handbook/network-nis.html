<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>29.4. Hálózati információs rendszer (NIS/YP)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="network-servers.html" title="29. fejezet - Hálózati szerverek" /><link rel="prev" href="network-nfs.html" title="29.3. A hálózati állományrendszer (NFS)" /><link rel="next" href="network-dhcp.html" title="29.5. A hálózat automatikus beállítása (DHCP)" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.4. Hálózati információs rendszer
      (NIS/YP)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-nfs.html">Vissza</a> </td><th width="60%" align="center">29. fejezet - Hálózati szerverek</th><td width="20%" align="right"> <a accesskey="n" href="network-dhcp.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-nis"></a>29.4. Hálózati információs rendszer
      (NIS/YP)</h2></div><div><span class="authorgroup">Írta: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Swingle</span>, <span class="firstname">Bill</span></span>. </span></div><div><span class="authorgroup">Írta: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Ogren</span>, <span class="firstname">Eric</span></span> és <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Erdelhoff</span>, <span class="firstname">Udo</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97260624"></a>29.4.1. Mi ez?</h3></div></div></div><a id="idp97261264" class="indexterm"></a><a id="idp97261776" class="indexterm"></a><a id="idp97262288" class="indexterm"></a><a id="idp97262800" class="indexterm"></a><a id="idp97263312" class="indexterm"></a><a id="idp97263824" class="indexterm"></a><a id="idp97268560" class="indexterm"></a><p>A hálózati információs
	szolgáltatást (Network Information Service, avagy
	<acronym class="acronym">NIS</acronym>) a Sun
	Microsystems fejlesztette ki a <span class="trademark">UNIX</span>(R) (eredetileg <span class="trademark">SunOS</span>TM)
	rendszerek központosított
	karbantartásához.  Mostanra már
	lényegében ipari szabvánnyá
	nõtte ki magát, hiszen az összes nagyobb
	<span class="trademark">UNIX</span>(R)-szerû rendszer (a <span class="trademark">Solaris</span>TM, HP-UX, <span class="trademark">AIX</span>(R), Linux,
	NetBSD, OpenBSD, FreeBSD stb.) támogatja a <acronym class="acronym">NIS</acronym>
	használatát.</p><a id="idp97272784" class="indexterm"></a><p>A <acronym class="acronym">NIS</acronym>
	régebben sárga oldalak (Yellow Pages) néven
	volt ismert, de a különbözõ jogi
	problémák miatt késõbb ezt a Sun
	megváltoztatta.  A régi elnevezést
	(és a yp rövidítést) azonban
	még napjainkban is lehet néhol
	látni.</p><a id="idp97274832" class="indexterm"></a><p>Ez egy RPC alapján mûködõ,
	kliens/szerver felépítésû rendszer,
	amely az egy NIS tartomány belül levõ
	számítógépek számára
	teszi lehetõvé ugyanazon konfigurációs
	állományok használatát.
	Segítségével a rendszergazda a NIS
	klienseket a lehetõ legkevesebb adat
	hozzáadásával,
	eltávolításával vagy
	módosításával képes egyetlen
	helyrõl beállítani.</p><a id="idp97276496" class="indexterm"></a><p>Hasonló a <span class="trademark">Windows NT</span>(R) tartományaihoz,
	és habár a belsõ implementációt
	tekintve már akadnak köztük jelentõs
	eltérések is, az alapvetõ funkciók
	szintjén mégis összevethetõek.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97278032"></a>29.4.2. A témához tartozó fogalmak és
	programok</h3></div></div></div><p>A NIS telepítése számos fogalom
	és fontos felhasználói program kerül
	elõ FreeBSD-n, akár egy NIS szervert akarunk
	beállítani, akár csak egy NIS
	klienst:</p><a id="idp97279056" class="indexterm"></a><a id="idp97279696" class="indexterm"></a><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Fogalom</th><th>Leírás</th></tr></thead><tbody><tr><td>NIS tartománynév</td><td>A NIS központi szerverei és az
		összes hozzájuk tartozó kliens
		(beleértve az alárendelt szervereket)
		rendelkezik egy NIS tartománynévvel.
		Hasonló a <span class="trademark">Windows NT</span>(R) által
		használt tartománynevekhez, de a NIS
		tartománynevei semmilyen kapcsolatban nem
		állnak a névfeloldással.</td></tr><tr><td><span class="application">rpcbind</span></td><td>Az <acronym class="acronym">RPC</acronym> (Remote Procedure Call, a
		NIS által használt egyik
		hálózati protokoll)
		engedélyezéséhez lesz rá
		szükségünk.  Ha az
		<span class="application">rpcbind</span> nem fut, akkor sem
		NIS szervert, sem pedig NIS klienst nem tudunk
		mûködtetni.</td></tr><tr><td><span class="application">ypbind</span></td><td>A NIS klienst <span class="quote">"<span class="quote">köti össze</span>"</span> a
		hozzá tartozó NIS szerverrel.  A NIS
		tartománynevet a rendszertõl veszi,
		és az <acronym class="acronym">RPC</acronym>
		használatával csatlakozik a szerverhez.
		Az <span class="application">ypbind</span> a NIS
		környezet kliens és szerver közti
		kommunikációjának magját
		alkotja.  Ha az <span class="application">ypbind</span>
		leáll a kliens gépén, akkor nem
		tudjuk elérni a NIS szervert.</td></tr><tr><td><span class="application">ypserv</span></td><td>Csak a NIS szervereken szabad futnia, mivel ez maga
		a NIS szerver programja.  Ha az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a>
		leáll, akkor a szerver nem lesz képes
		tovább kiszolgálni a NIS
		kéréseket (szerencsére az
		alárendelt szerverek képesek
		átvenni ezeket).  A NIS bizonyos
		változatai (de nem az, amelyik a FreeBSD-ben is
		megjelenik) nem próbálnak meg más
		szerverekhez csatlakozni, ha bedöglik az
		aktuális használt szerver.  Ezen gyakran
		egyedül csak a szervert képviselõ
		program (vagy akár az egész szerver)
		újraindítása segíthet,
		illetve az <span class="application">ypbind</span>
		újraindítása a kliensen.</td></tr><tr><td><span class="application">rpc.yppasswdd</span></td><td>Ez egy olyan program, amelyet csak a NIS
		központi szerverein kell csak futtatni.  Ez a
		démon a NIS kliensek számára a NIS
		jelszavaik megváltoztatását teszi
		lehetõvé.  Ha ez a démon nem fut,
		akkor a felhasználók csak úgy
		tudják megváltoztatni a jelszavukat, ha
		bejelentkeznek a központi NIS szerverre.</td></tr></tbody></table></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97307088"></a>29.4.3. Hogyan mûködik?</h3></div></div></div><p>A NIS környezetekben háromféle gép
	létezik: a központi szerverek, az alárendelt
	szerverek és a kliensek.  A szerverek képezik a
	gépek konfigurációs
	információinak központi
	tárhelyét.  A központi szerverek
	tárolják ezen információk hiteles
	másolatát, míg ezt az alárendelt
	szerverek redundánsan tükrözik.  A kliensek a
	szerverekre támaszkodnak ezen információk
	beszerzéséhez.</p><p>Sok állomány tartalma megosztható ezen
	a módon.  Például a
	<code class="filename">master.passwd</code>, a <code class="filename">group</code>
	és <code class="filename">hosts</code> állományokat
	meg szokták osztani NFS-en.  Amikor a kliensen
	futó valamelyik programnak olyan
	információra lenne szüksége, amely
	általában ezekben az állományokban
	nála megtalálható lenne, akkor helyette a
	NIS szerverhez fordul.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97309648"></a>29.4.3.1. A gépek típusai</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a id="idp97310800" class="indexterm"></a><p>A <span class="emphasis"><em>központi NIS szerver</em></span>.  Ez
	      a szerver, amely leginkább a <span class="trademark">Windows NT</span>(R)
	      elsõdleges
	      tartományvezérlõjéhez
	      hasonlítható tartja karban az összes,
	      NIS kliensek által használt
	      állományt.  A <code class="filename">passwd</code>,
	      <code class="filename">group</code>, és összes
	      többi ehhez hasonló állomány
	      ezen a központi szerveren található
	      meg.</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Egy gép akár több NIS
		tartományban is lehet központi szerver.
		Ezzel a lehetõséggel viszont itt most nem
		foglalkozunk, mivel most csak egy viszonylag kis
		méretû NIS környezetet
		feltételezünk.</p></div></li><li class="listitem"><a id="idp97319376" class="indexterm"></a><p>Az <span class="emphasis"><em>alárendelt NIS
	      szerverek</em></span>.  A <span class="trademark">Windows NT</span>(R) tartalék
	      tartományvezérlõihez
	      hasonlítanak, és az alárendelt NIS
	      szerverek feladata a központi NIS szerveren
	      tárolt adatok másolatainak
	      karbantartása.  Az alárendelt NIS szerverek
	      a redundancia megvalósításában
	      segítenek, aminek leginkább a fontosabb
	      környezetekben van szerepe.  Emellett a központi
	      szerver terhelésének
	      kiegyenlítését is elvégzik.  A
	      NIS kliensek elsõként mindig ahhoz a NIS
	      szerverhez csatlakoznak, amelytõl elõször
	      választ kapnak, legyen akár az egy
	      alárendelt szerver.</p></li><li class="listitem"><a id="idp97322192" class="indexterm"></a><p>A <span class="emphasis"><em>NIS kliensek</em></span>.  A NIS kliensek,
	      hasonlóan a <span class="trademark">Windows NT</span>(R)
	      munkaállomásokhoz, a NIS szerveren (amely a
	      <span class="trademark">Windows NT</span>(R) munkaállomások esetében a
	      tartományvezérlõ) keresztül
	      jelentkeznek be.</p></li></ul></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97334096"></a>29.4.4. A NIS/YP használata</h3></div></div></div><p>Ebben a szakaszban egy példa NIS környezetet
	állítunk be.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97335248"></a>29.4.4.1. Tervezés</h4></div></div></div><p>Tegyük fel, hogy egy aprócska egyetemi labor
	  rendszergazdái vagyunk.  A labor, mely 15 FreeBSD-s
	  gépet tudhat magáénak, jelen pillanatban
	  még semmilyen központosított
	  adminisztráció nem létezik.  Mindegyik
	  gép saját <code class="filename">/etc/passwd</code>
	  és <code class="filename">/etc/master.passwd</code>
	  állománnyal rendelkezik.  Ezeket az
	  állományokat saját kezûleg kell
	  szinkronban tartani.  Tehát ha most felveszünk egy
	  felhasználót a laborhoz, akkor az
	  <code class="command">adduser</code> parancsot mind a 15 gépen ki
	  kell adni.  Egyértelmû, hogy ez így nem
	  maradhat, ezért úgy döntöttük,
	  hogy a laborban NIS-t fogunk használni, és
	  két gépet kinevezünk szervernek.</p><p>Az iméntieknek megfelelõen a labor most
	  valahogy így néz ki:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>A gép neve</th><th>IP-cím</th><th>A gép szerepe</th></tr></thead><tbody><tr><td><code class="systemitem">ellington</code></td><td><code class="systemitem">10.0.0.2</code></td><td>központi NIS</td></tr><tr><td><code class="systemitem">coltrane</code></td><td><code class="systemitem">10.0.0.3</code></td><td>alárendelt NIS</td></tr><tr><td><code class="systemitem">basie</code></td><td><code class="systemitem">10.0.0.4</code></td><td>tanszéki munkaállomás</td></tr><tr><td><code class="systemitem">bird</code></td><td><code class="systemitem">10.0.0.5</code></td><td>kliensgép</td></tr><tr><td><code class="systemitem">cli[1-11]</code></td><td><code class="systemitem">10.0.0.[6-17]</code></td><td>a többi kliensgép</td></tr></tbody></table></div><p>Ha még nincs tapasztalatunk a NIS rendszerek
	  összeállításában, akkor
	  elõször jó ötlet lehet
	  végiggondolni, miként is akarjuk
	  kialakítani.  A hálózatunk
	  méretétõl függetlenül is akadnak
	  olyan döntések, amelyeket mindenképpen meg
	  kell hoznunk.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97359696"></a>29.4.4.1.1. A NIS tartománynév
	    megválasztása</h5></div></div></div><a id="idp97360336" class="indexterm"></a><p>Ez nem az a <span class="quote">"<span class="quote">tartománynév</span>"</span>,
	    amit megszokhattunk.  Ennek a pontos neve <span class="quote">"<span class="quote">NIS
	    tartománynév</span>"</span>.  Amikor a kliensek
	    kérnek valamilyen információt, akkor
	    megadják annak a NIS tartománynak a
	    nevét is, amelynek részei.  Így tud egy
	    hálózaton több szerver arról
	    dönteni, hogy melyikük melyik kérést
	    válaszolja meg.  A NIS által használt
	    tartománynévre tehát inkább
	    úgy érdemes gondolni, mint egy valamilyen
	    módon összetartozó gépek
	    közös nevére.</p><p>Elõfordul, hogy egyes szervezetek az interneten is
	    nyilvántartott tartománynevüket
	    választják NIS tartománynévnek.
	    Ez alapvetõen nem ajánlott, mivel a
	    hálózati problémák
	    felderítése közben
	    félreértéseket szülhet.  A NIS
	    tartománynévnek a hálózatunkon
	    belül egyedinek kell lennie, és lehetõleg
	    minél jobban írja le az általa
	    csoportba sorolt gépeket.  Például a
	    Kis Kft.  üzleti osztályát tegyük a
	    <span class="quote">"<span class="quote">kis-uzlet</span>"</span> NIS tartományba.  Ebben a
	    példában most a
	    <code class="literal">proba-tartomany</code> nevet
	    választottuk.</p><a id="idp97363920" class="indexterm"></a><p>A legtöbb operációs rendszer azonban
	    (köztük a <span class="trademark">SunOS</span>TM) a NIS tartománynevet
	    használja internetes
	    tartománynévként is.  Ha a
	    hálózatunkon egy vagy több ilyen
	    gép is található, akkor a NIS
	    tartomány nevének az internetes
	    tartománynevet <span class="emphasis"><em>kell</em></span>
	    megadnunk.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97365840"></a>29.4.4.1.2. A szerverek fizikai elvárásai</h5></div></div></div><p>Nem árt néhány dolgot fejben
	    tartani, amikor a NIS szervernek használt
	    gépet kiválasztjuk.  Az egyik ilyen
	    szerencsétlen dolog az a szintû
	    függõség, ami a NIS kliensek felõl
	    megfigyelhetõ a szerverek felé.  Ha egy kliens
	    nem tudja a NIS tartományon belül felvenni a
	    kapcsolatot valamelyik szerverrel, akkor az a gép
	    könnyen megbízhatatlanná válhat.
	    Felhasználói- és
	    csoportinformációk nélkül a
	    legtöbb rendszer egy idõre le is merevedik.  Ennek
	    figyelembevételével tehát olyan
	    gépet kell szervernek választanunk, amelyet
	    nem kell gyakran újraindítani, és nem
	    végzünk rajta semmilyen komoly munkát.  A
	    célnak legjobban megfelelõ NIS szerverek
	    valójában olyan gépek, amelyek
	    egyedüli feladata csak a NIS kérések
	    kiszolgálása.  Ha a hálózatunk
	    nem annyira leterhelt, akkor még a NIS szerver
	    mellett más programokat is futtathatunk, de ne
	    feledjük, hogy ha a NIS szolgáltatás
	    megszûnik, akkor az az <span class="emphasis"><em>összes</em></span>
	    NIS kliensen éreztetni fogja kedvezõtlen
	    hatását.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97367632"></a>29.4.4.2. A NIS szerverek</h4></div></div></div><p>A NIS rendszerben tárolt összes
	  információ általános
	  példánya egyetlen gépen
	  található meg, amelyet a központi NIS
	  szervernek hívunk.  Az információk
	  tárolására szánt adatbázis
	  pedig NIS táblázatoknak (NIS map) nevezzük.
	  FreeBSD alatt ezek a táblázatok a
	  <code class="filename">/var/yp/tartománynév</code>
	  könyvtárban találhatóak, ahol a
	  <code class="filename">tartománynév</code>
	  a kiszolgált NIS tartományt nevezi meg.
	  Egyetlen NIS szerver egyszerre akár több
	  tartományt is kiszolgálhat, így itt
	  több könyvtár is található,
	  minden támogatott tartományhoz egy.  Minden
	  tartomány saját, egymástól
	  független táblázatokkal rendelkezik.</p><p>A központi és alárendelt NIS szerverek
	  az <code class="command">ypserv</code> démon
	  segítségével dolgozzák fel a NIS
	  kéréseket.  Az <code class="command">ypserv</code>
	  felelõs a NIS kliensektõl befutó
	  kérések fogadásáért,
	  és a kért tartomány valamint
	  táblázat nevébõl meghatározza
	  az adatbázisban tárolt állományt,
	  majd innen visszaküldi a hozzá tartozó
	  adatot a kliensnek.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97370576"></a>29.4.4.2.1. A központi NIS szerver
	    beállítása</h5></div></div></div><a id="idp97371216" class="indexterm"></a><p>A központi NIS szerver
	    beállítása viszonylag
	    magától értetõdõ, de a
	    nehézségét az igényeink
	    szabják meg.  A FreeBSD alapból támogatja
	    a NIS használatát.  Ezért
	    mindössze annyit kell tennünk, hogy a
	    következõ sorokat betesszük az
	    <code class="filename">/etc/rc.conf</code> állományba,
	    és a FreeBSD gondoskodik a többirõl.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><pre class="programlisting">nisdomainname="proba-tartomany"</pre><p>
		Ez a sor adja meg a hálózati
		beállítások (vagy
		például az
		újraindítás) során a NIS
		tartomány nevét, amely a korábbiak
		szerint itt most a
		<code class="literal">proba-tartomany</code>.</p></li><li class="step"><pre class="programlisting">nis_server_enable="YES"</pre><p>
		Ezzel utasítjuk a FreeBSD-t, hogy a
		hálózati alkalmazások
		következõ indításakor a NIS
		szervert is aktiválja.</p></li><li class="step"><pre class="programlisting">nis_yppasswdd_enable="YES"</pre><p>
		Ezzel engedélyezzük az
		<code class="command">rpc.yppasswdd</code> démont, amely a
		korábban említettek szerint
		lehetõvé teszi a felhasználók
		számára, hogy a közvetlenül a
		kliensekrõl változtassák meg a NIS
		jelszavukat.</p></li></ol></div><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">A konkrét NIS
	      beállításainktól
	      függõen további bejegyzések
	      felvételére is szükségünk
	      lehet.  Erre késõbb még <a class="link" href="network-nis.html#network-nis-server-is-client" title="29.4.10. NIS szerverek, melyek egyben NIS kliensek">az olyan NIS
	      szervereknél, amelyek egyben NIS kliensek</a>,
	      vissza fogunk térni.</p></div><p>Miután ezeket beállítottuk,
	    rendszeradminisztrátorként adjuk ki az
	    <code class="command">/etc/netstart</code> parancsot.  Az
	    <code class="filename">/etc/rc.conf</code> állományban
	    szereplõ adatok alapján mindent
	    beállít magától.  Még
	    mielõtt inicializálnánk a NIS
	    táblázatokat, indítsuk el
	    manuálisan az <span class="application">ypserv</span>
	    démont:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/ypserv start</code></strong></pre></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97385680"></a>29.4.4.2.2. A NIS táblázatok
	    inicializálása</h5></div></div></div><a id="idp97386320" class="indexterm"></a><p>A <span class="emphasis"><em>NIS táblázatok</em></span>
	    lényegében a <code class="filename">/var/yp</code>
	    könyvtárban tárolt adatbázisok.  A
	    központi NIS szerver <code class="filename">/etc</code>
	    könyvtárában található
	    konfigurációs
	    állományokból
	    állítódnak elõ, egyetlen
	    kivétellel: ez az
	    <code class="filename">/etc/master.passwd</code>
	    állomány.  Ennek megvan a maga oka, hiszen nem
	    akarjuk a <code class="systemitem">root</code> és az összes
	    többi fontosabb felhasználóhoz
	    tartozó jelszót az egész NIS
	    tartománnyal megosztani.  Ennek megfelelõen a
	    NIS táblázatok
	    inicializálásához a
	    következõt kell tennünk:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp /etc/master.passwd /var/yp/master.passwd</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /var/yp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>vi master.passwd</code></strong></pre><p>El kell távolítanunk az összes
	    rendszerszintû (<code class="systemitem">bin</code>,
	    <code class="systemitem">tty</code>, <code class="systemitem">kmem</code>,
	    <code class="systemitem">games</code>, stb), és minden olyan
	    egyéb hozzáférést, amelyeket nem
	    akarjuk közvetíteni a NIS kliensek felé
	    (például a <code class="systemitem">root</code> és
	    minden más nullás, vagyis
	    rendszeradminisztrátori azonosítóval
	    ellátott hozzáférést).</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Gondoskodjunk róla, hogy az
	      <code class="filename">/var/yp/master.passwd</code>
	      állomány sem a csoport, sem pedig
	      bárki más számára nem
	      olvasható (600-as engedély)!  Ennek
	      beállításához
	      használjuk az <code class="command">chmod</code> parancsot,
	      ha szükséges.</p></div><a id="idp97425872" class="indexterm"></a><p>Ha végeztünk, akkor már
	    tényleg itt az ideje inicializálni NIS
	    táblázatainkat.  A FreeBSD erre egy
	    <code class="command">ypinit</code> nevû szkriptet ajánl
	    fel (errõl a saját man oldalán tudhatunk
	    meg többet).  Ez a szkript egyébként a
	    legtöbb <span class="trademark">UNIX</span>(R) típusú
	    operációs rendszeren
	    megtalálható, de nem az összesen.  A
	    Digital UNIX/Compaq Tru64 UNIX rendszereken ennek a neve
	    <code class="command">ypsetup</code>.  Mivel most a központi NIS
	    szerver táblázatait hozzuk létre,
	    azért az <code class="command">ypinit</code> szkriptnek
	    át kell adnunk a <code class="option">-m</code> opciót
	    is.  A NIS táblázatok
	    elõállításánál
	    feltételezzük, hogy a fentebb ismertetett
	    lépéseket már megtettük, majd
	    kiadjuk ezt a parancsot:</p><pre class="screen">ellington<code class="prompt">#</code> <strong class="userinput"><code>ypinit -m proba-tartomany</code></strong>
Server Type: MASTER Domain: proba-tartomany
Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.
Do you want this procedure to quit on non-fatal errors? [y/n: n] <strong class="userinput"><code>n</code></strong>
Ok, please remember to go back and redo manually whatever fails.
If you don't, something might not work.
At this point, we have to construct a list of this domains YP servers.
rod.darktech.org is already known as master server.
Please continue to add any slave servers, one per line. When you are
done with the list, type a &lt;control D&gt;.
master server   :  ellington
next host to add:  <strong class="userinput"><code>coltrane</code></strong>
next host to add:  <strong class="userinput"><code>^D</code></strong>
The current list of NIS servers looks like this:
ellington
coltrane
Is this correct?  [y/n: y] <strong class="userinput"><code>y</code></strong>

[ .. a táblázatok generálása .. ]

NIS Map update completed.
ellington has been setup as an YP master server without any errors.</pre><p>Az üzenetek fordítása:</p><pre class="screen">A szerver típusa: KÖZPONTI, tartomány: proba-tartomany
Az YP szerver létrehozásához meg kell válaszolni néhány kérdést az
eljárás megkezdése elõtt.
Szeretnénk, ha az eljárás megszakadna a nem végzetes hibák esetén is? [i/n: n] <strong class="userinput"><code>n</code></strong>
Rendben, akkor ne felejtsük el manuálisan kijavítani a hibát, ha
valamivel gond lenne.  Ha nem tesszük meg, akkor elõfordulhat, hogy
valami nem fog rendesen mûködni.  Most össze kell állítanunk egy listát
a tartomány YP szervereirõl.
Jelenleg a rod.darktech.org a központi szerver.
Kérjünk, adjon meg további alárendelt szervereket, soronként egyet.
Amikor ezt befejeztük, a &lt;control D&gt; lenyomásával tudunk
kilépni.
központi szerver : ellington
következõ gép    : <strong class="userinput"><code>coltrane</code></strong>
következõ gép    : <strong class="userinput"><code>^D</code></strong>
A NIS szerverek listája jelenleg a következõ:
ellington
coltrane
Ez megfelelõ?  [i/n: i] <strong class="userinput"><code>i</code></strong>

[ .. a táblázatok generálása .. ]

A NIS táblázatok sikeressen frissültek.
Az elligon szervert minden hiba nélkül sikerült központi szerverként
beállítani.</pre><p>Az <code class="command">ypinit</code> a
	    <code class="filename">/var/yp/Makefile.dist</code>
	    állományból létrehozza a
	    <code class="filename">/var/yp/Makefile</code>
	    állományt.  Amennyiben ez
	    létrejött, az állomány
	    feltételezi, hogy csak FreeBSD-s gépek
	    részvételével akarunk
	    kialakítani egy egyszerveres NIS környezetet.
	    Mivel a <code class="literal">proba-tartomany</code> még egy
	    alárendelt szervert is tartalmaz, ezért
	    át kell írnunk a
	    <code class="filename">/var/yp/Makefile</code>
	    állományt:</p><pre class="screen">ellington<code class="prompt">#</code> <strong class="userinput"><code>vi /var/yp/Makefile</code></strong></pre><p>Ezt a sort kell megjegyzésbe tennünk:</p><pre class="programlisting">NOPUSH = "True"</pre><p>(ha még nem lenne úgy).</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97438544"></a>29.4.4.2.3. Az alárendelt NIS szerverek
	    beállítása</h5></div></div></div><a id="idp97439184" class="indexterm"></a><p>Az alárendelt NIS szerverek
	    beállítása még a
	    központinál is egyszerûbb.
	    Jelentkezzünk be az alárendelt szerverre
	    és az eddigieknek megfelelõen írjuk
	    át az <code class="filename">/etc/rc.conf</code>
	    állományt.  Az egyetlen
	    különbség ezúttal csupán
	    annyi lesz, hogy az <code class="command">ypinit</code>
	    lefuttatásakor a <code class="option">-s</code> opciót
	    kell megadnunk (mint slave, vagyis alárendelt).  A
	    <code class="option">-s</code> opció használatához
	    a központi NIS szerver nevét is át kell
	    adnunk, ezért a konkrét parancs valahogy
	    így fog kinézni:</p><pre class="screen">coltrane<code class="prompt">#</code> <strong class="userinput"><code>ypinit -s ellington proba-tartomany</code></strong>

Server Type: SLAVE Domain: test-domain Master: ellington

Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.

Do you want this procedure to quit on non-fatal errors? [y/n: n]  <strong class="userinput"><code>n</code></strong>

Ok, please remember to go back and redo manually whatever fails.
If you don't, something might not work.
There will be no further questions. The remainder of the procedure
should take a few minutes, to copy the databases from ellington.
Transferring netgroup...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byuser...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byhost...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring group.bygid...
ypxfr: Exiting: Map successfully transferred
Transferring group.byname...
ypxfr: Exiting: Map successfully transferred
Transferring services.byname...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.byname...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.byname...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring netid.byname...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring ypservers...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byname...
ypxfr: Exiting: Map successfully transferred

coltrane has been setup as an YP slave server without any errors.
Don't forget to update map ypservers on ellington.</pre><p>Most már lennie kell egy
	    <code class="filename">/var/yp/proba-tartomany</code> nevû
	    könyvtárunknak is.  A központi NIS szerver
	    táblázatainak másolata itt fognak
	    tárolódni.  Ezeket soha ne felejtsük el
	    frissen tartani.  Az alárendelt szervereken a
	    következõ <code class="filename">/etc/crontab</code>
	    bejegyzések pontosan ezt a feladatot
	    látják el:</p><pre class="programlisting">20      *       *       *       *       root   /usr/libexec/ypxfr passwd.byname
21      *       *       *       *       root   /usr/libexec/ypxfr passwd.byuid</pre><p>Ez a két sor gondoskodik róla, hogy az
	    alárendelt szerverek ne felejtsék el
	    egyeztetni a táblázataikat a központi
	    szerver táblázataival.  Ezek a
	    bejegyzések nem nélkülözhetetlenek a
	    megfelelõ mûködéshez, mivel a
	    központi szerver automatikusan feltölti az
	    alárendelt szerverekre a létrejött
	    változásokat.  Mivel azonban a jelszavak
	    létfontosságúak a szervertõl
	    függõ rendszerek számára,
	    ezért ajánlott explicit módon is
	    elõírni a frissítést.  Ez a
	    forgalmasabb hálózatokon nagyobb
	    jelentõséggel bír, mivel ott a
	    táblázatok frissítése nem mindig
	    fejezõdik be rendesen.</p><p>Most pedig futassuk le a
	    <code class="command">/etc/netstart</code> parancsot az
	    alárendelt szervereken is, amivel így elindul
	    a NIS szerver.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97446992"></a>29.4.4.3. A NIS kliensek</h4></div></div></div><p>A NIS kliens az <code class="command">ypbind</code> démon
	  segítségével egy kötésnek
	  (bind) nevezett kapcsolatot épít ki egy adott
	  NIS szerverrel.  Az <code class="command">ypbind</code> ellenõrzi a
	  rendszer alapértelmezett tartományát (ezt
	  a <code class="command">domainname</code> paranccsal
	  állítottunk be), majd RPC
	  kéréseket kezd szórni a helyi
	  hálózaton.  Ezek a kérések annak a
	  tartománynak a nevét tartalmazzák,
	  amelyhez az <code class="command">ypbind</code> megpróbál
	  kötést létrehozni.  Ha az adott
	  tartomány kiszolgálására
	  beállított szerver észleli ezeket a
	  kéréseket, akkor válaszol az
	  <code class="command">ypbind</code> démonnak, amely pedig
	  feljegyzi a szerver címét.  Ha több szerver
	  is elérhetõ (például egy
	  központi és több alárendelt), akkor az
	  <code class="command">ypbind</code> az elsõként
	  válaszoló címét fogja
	  rögzíteni.  Innentõl kezdve a kliens
	  közvetlenül ennek a szervernek fogja küldeni a
	  NIS kéréseit.  Az <code class="command">ypbind</code>
	  idõnként <span class="quote">"<span class="quote">megpingeli</span>"</span> a szervert,
	  hogy meggyõzõdjön az
	  elérhetõségérõl.  Ha az
	  <code class="command">ypbind</code> egy adott idõn belül nem
	  kap választ a ping kéréseire, akkor
	  megszünteti a kötést a tartományhoz
	  és nekilát keresni egy másik
	  szervert.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97488464"></a>29.4.4.3.1. A NIS kliensek beállítása</h5></div></div></div><a id="idp97489104" class="indexterm"></a><p>Egy FreeBSD-s gépet NIS kliensként
	    meglehetõsen egyszerûen lehet
	    beállítani.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Nyissuk meg az <code class="filename">/etc/rc.conf</code>
		állományt és a NIS
		tartománynév
		beállításához, valamint az
		<code class="command">ypbind</code>
		elindításához a
		következõket írjuk bele:</p><pre class="programlisting">nisdomainname="proba-tartomany"
nis_client_enable="YES"</pre></li><li class="step"><p>A NIS szerveren található jelszavak
		importálásához
		távolítsuk el az összes
		felhasználói
		hozzáférést az
		<code class="filename">/etc/master.passwd</code>
		állományunkból és a
		<code class="command">vipw</code>
		segítségével adjuk hozzá az
		alábbi sort az állomány
		végéhez:</p><pre class="programlisting">+:::::::::</pre><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ez a sor beenged bárkit a
		  rendszerünkre, akinek a NIS szervereken van
		  érvényes
		  hozzáférése.  A NIS klienseket
		  ezzel a sorral sokféle módon tudjuk
		  állítani.  A <a class="link" href="network-nis.html#network-netgroups" title="29.4.7. A hálózati csoportok alkalmazása">hálózati
		  csoportokról szóló
		  szakaszban</a> találunk majd errõl
		  több információt.  A téma
		  mélyebb megismeréséhez az
		  O'Reilly <code class="literal">Managing NFS and NIS</code>
		  címû könyvét
		  ajánljuk.</p></div><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Legalább helyi
		  hozzáférést (vagyis amit nem
		  NIS-en keresztül importálunk) azonban
		  mindenképpen hagyjunk meg az
		  <code class="filename">/etc/master.passwd</code>
		  állományunkban, és ez a
		  hozzáférés legyen a
		  <code class="systemitem">wheel</code> csoport tagja.  Ha valami
		  gond lenne a NIS használatával, akkor
		  ezen a hozzáférésen
		  keresztül tudunk a gépre
		  távolról bejelentkezni, majd innen
		  <code class="systemitem">root</code> felhasználóra
		  váltva megoldani a felmerült
		  problémákat.</p></div></li><li class="step"><p>A NIS szerverrõl az összes
		lehetséges csoport-bejegyzést az
		<code class="filename">/etc/group</code>
		állományban így tudjuk
		importálni:</p><pre class="programlisting">+:*::</pre></li></ol></div><p>Miután elvégeztük ezeket a
	    lépéseket, képesek leszünk
	    futtatni az <code class="command">ypcat passwd</code> parancsot,
	    és látni a NIS szerver jelszavakat
	    tartalmazó táblázatát.</p></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97501776"></a>29.4.5. A NIS biztonsága</h3></div></div></div><p>Általában tetszõleges távoli
	felhasználó küldhet RPC
	kéréseket az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a> számára
	és kérheti le a NIS táblázatok
	tartalmát, feltéve, hogy ismeri a tartomány
	nevét.  Az ilyen hitelesítés
	nélküli mûveletek ellen az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a>
	úgy védekezik, hogy tartalmaz egy
	<span class="quote">"<span class="quote">securenets</span>"</span> nevû lehetõséget,
	amellyel az elérhetõségüket tudjuk
	leszûkíteni gépek egy csoportjára.  Az
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a> indításakor ezeket az
	információkat a
	<code class="filename">/var/yp/securenets</code>
	állományból próbálja meg
	betölteni.</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Az elérési útvonala megadható
	  a <code class="option">-p</code> opció
	  használatával.  Ez az állomány
	  olyan bejegyzéseket tartalmaz, amelyekben egy
	  hálózati cím és tõle
	  láthatatlan karakterekkel elválasztva egy
	  hálózati maszk szerepel.  A <span class="quote">"<span class="quote">#</span>"</span>
	  karakterrel kezdõdõ sorokat megjegyzésnek
	  nyilvánítjuk.  Egy minta securenets
	  állomány valahogy így nézne
	  ki:</p></div><pre class="programlisting"># Engedélyezzük önmagunkról a csatlakozást -- kell!
127.0.0.1     255.255.255.255
# Engedélyezzük a 192.168.128.0 hálózatról érkezõ csatlakozásokat:
192.168.128.0 255.255.255.0
# Engedélyezzük a laborban található 10.0.0.0 és 10.0.15.255 közti
# címekkel rendelkezõ gépek csatlakozását:
10.0.0.0      255.255.240.0</pre><p>Ha az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a> olyan címrõl kap
	kérést, amely illeszkedik az elõírt
	címek valamelyikére, akkor a szokásos
	módon feldolgozza azt.  Ellenkezõ esetben a
	kérést figyelmen kívül hagyja
	és egy figyelmeztetést vesz fel hozzá a
	naplóba.  Ha a <code class="filename">/var/yp/securenets</code>
	állomány nem létezik, akkor az
	<code class="command">ypserv</code> tetszõleges géprõl
	engedélyezi a csatlakozást.</p><p>Az <code class="command">ypserv</code> lehetõséget ad a
	Wietse Venema által fejlesztett <span class="application">TCP
	Wrapper</span> csomag használatára is.
	Ezzel a rendszergazda a <code class="filename">/var/yp/securenets</code>
	állomány helyett a <span class="application">TCP
	Wrapper</span> konfigurációs
	állományai alapján képes
	szabályozni az elérhetõséget.</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Miközben mind a két módszer
	  nyújt valamilyen fajta védelmet, de a
	  privilegizált portok teszteléséhez
	  hasonlóan az <span class="quote">"<span class="quote">IP
	  álcázásával</span>"</span> (IP spoofing)
	  sebezhetõek.  Ezért az összes NIS-hez
	  tartozó forgalmat tûzfallal kell
	  blokkolnunk.</p><p xmlns="http://www.w3.org/1999/xhtml">Az <code class="filename">/var/yp/securenets</code>
	  állományt használó szerverek nem
	  képesek az elavult TCP/IP
	  implementációkat használó
	  érvényes klienseket rendesen kiszolgálni.
	  Egyes ilyen implementációk a címben a
	  géphez tartozó biteket nullára
	  állítják az
	  üzenetszóráshoz, és/vagy
	  ezért az üzenetszóráshoz
	  használt cím kiszámításakor
	  nem tudja észleli a hálózati maszkot.  A
	  legtöbb ilyen probléma megoldható a kliens
	  konfigurációjának
	  megváltoztatásával, míg más
	  problémák megoldása a
	  kérdéses kliensek
	  nyugdíjazását
	  kívánják meg, vagy a
	  <code class="filename">/var/yp/securenets</code>
	  használatának elhagyását.</p><p xmlns="http://www.w3.org/1999/xhtml">Egy régebbi TCP/IP implementációval
	  üzemelõ szerveren pedig a
	  <code class="filename">/var/yp/securenets</code> állomány
	  használata kifejezetten rossz ötlet, és a
	  hálózatunk nagy részében
	  képes használhatatlanná tenni a NIS
	  funkcióit.</p><a xmlns="http://www.w3.org/1999/xhtml" id="idp97518800" class="indexterm"></a><p xmlns="http://www.w3.org/1999/xhtml">A <span class="application">TCP Wrapper</span> csomag
	  alkalmazása a NIS szerverünk
	  válaszadáshoz szükséges
	  idejét is segít csökkenteni.  Az ilyenkor
	  jelentkezõ plusz késlekedés mellesleg
	  elég nagy lehet ahhoz, hogy a klienseknél
	  idõtúllépés következzen be,
	  különösen a terheltebb
	  hálózatokon vagy a lassú NIS szerverek
	  esetében.  Ha egy vagy több kliensünk is
	  ilyen tüneteket mutat, akkor érdemes a
	  kérdéses kliens rendszereket alárendelt
	  NIS szerverekké alakítani és
	  önmagukhoz rendelni.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97520336"></a>29.4.6. Egyes felhasználók
	bejelentkezésének
	megakadályozása</h3></div></div></div><p>A laborunkban van egy <code class="systemitem">basie</code> nevû
	gép, amely a tanszék egyetlen
	munkaállomása.  Ezt a gépet nem akarjuk
	kivenni a NIS tartományból, de a központi NIS
	szerver <code class="filename">passwd</code> állománya
	mégis egyaránt tartalmazza a hallgatók
	és az oktatók eléréseit.  Mit lehet
	ilyenkor tenni?</p><p>Adott felhasználók esetében le tudjuk
	tiltani a bejelentkezést a gépen még
	olyankor is, ha léteznek a NIS
	adatbázisában.  Ehhez mindössze a kliensen az
	<code class="filename">/etc/master.passwd</code> állomány
	végére be kell tennünk egy
	<code class="literal">-felhasználónév</code>
	sort, ahol a
	<em class="replaceable"><code>felhasználónév</code></em>
	annak a felhasználónak a neve, akit nem akarunk
	beengedni a gépre.  Ezt leginkább a
	<code class="command">vipw</code> használatán keresztül
	érdemes megtennünk, mivel a <code class="command">vipw</code>
	az <code class="filename">/etc/master.passwd</code>
	állomány alapján végez némi
	ellenõrzést, valamint a szerkesztés
	befejeztével magától
	újragenerálja a jelszavakat tároló
	adatbázist.  Például, ha a
	<code class="systemitem">bill</code> nevû felhasználót
	ki akarjuk tiltani a <code class="systemitem">basie</code> nevû
	géprõl, akkor:</p><pre class="screen">basie<code class="prompt">#</code> <strong class="userinput"><code>vipw</code></strong>
<strong class="userinput"><code>[vegyük fel a -bill sort a végére, majd lépjünk ki]</code></strong>
vipw: rebuilding the database...
vipw: done

basie<code class="prompt">#</code> <strong class="userinput"><code>cat /etc/master.passwd</code></strong>

root:[jelszó]:0:0::0:0:The super-user:/root:/bin/csh
toor:[jelszó]:0:0::0:0:The other super-user:/root:/bin/sh
daemon:*:1:1::0:0:Owner of many system processes:/root:/sbin/nologin
operator:*:2:5::0:0:System &amp;:/:/sbin/nologin
bin:*:3:7::0:0:Binaries Commands and Source,,,:/:/sbin/nologin
tty:*:4:65533::0:0:Tty Sandbox:/:/sbin/nologin
kmem:*:5:65533::0:0:KMem Sandbox:/:/sbin/nologin
games:*:7:13::0:0:Games pseudo-user:/usr/games:/sbin/nologin
news:*:8:8::0:0:News Subsystem:/:/sbin/nologin
man:*:9:9::0:0:Mister Man Pages:/usr/share/man:/sbin/nologin
bind:*:53:53::0:0:Bind Sandbox:/:/sbin/nologin
uucp:*:66:66::0:0:UUCP pseudo-user:/var/spool/uucppublic:/usr/libexec/uucp/uucico
xten:*:67:67::0:0:X-10 daemon:/usr/local/xten:/sbin/nologin
pop:*:68:6::0:0:Post Office Owner:/nonexistent:/sbin/nologin
nobody:*:65534:65534::0:0:Unprivileged user:/nonexistent:/sbin/nologin
+:::::::::
-bill

basie<code class="prompt">#</code></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-netgroups"></a>29.4.7. A hálózati csoportok
	alkalmazása</h3></div><div><span class="authorgroup">Készítette: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Erdelhoff</span>, <span class="firstname">Udo</span></span>. </span></div></div></div><a id="idp97535696" class="indexterm"></a><p>Az elõzõ szakaszban ismertetett módszer
	viszonylag jól mûködik olyan esetekben, amikor
	nagyon kevés felhasználóra és/vagy
	számítógépre kell alkalmaznunk
	speciális megszorításokat.  A nagyobb
	hálózatokban szinte <span class="emphasis"><em>biztos</em></span>,
	hogy elfelejtünk kizárni egyes
	felhasználókat az érzékeny
	gépekrõl, vagy az összes gépen
	egyenként kell ehhez a megfelelõ
	beállításokat elvégezni, és
	ezzel lényegében elvesztjük a NIS
	legfontosabb elõnyét, vagyis a
	<span class="emphasis"><em>központosított</em></span>
	karbantarthatóságot.</p><p>A NIS fejlesztõi erre a problémára a
	<span class="emphasis"><em>hálózati csoportokat</em></span>
	létrehozásával válaszoltak.  A
	céljuk és mûködésük
	szempontjából leginkább a <span class="trademark">UNIX</span>(R)-os
	állományrendszerekben található
	csoportokhoz mérhetõek.  A legnagyobb
	eltérés a numerikus azonosítók
	hiányában mutatkozik meg, valamint a
	hálózati csoportokat a
	felhasználókon kívül további
	hálózati csoportok megadásával is ki
	lehet alakítani.</p><p>A hálózati csoportok a nagyobb, bonyolultabb,
	többszáz felhasználós
	hálózatok számára jöttek
	létre.  Egy részrõl ez nagyon jó
	dolog, különösen akkor, ha egy ilyen helyzettel
	kell szembenéznünk.  Másrészrõl
	ez a mértékû bonyolultság szinte
	teljesen lehetetlenné teszi a hálózati
	csoportok egyszerû bemutatását.  A szakasz
	további részében használt
	példa is ezt a problémát igyekszik
	illusztrálni.</p><p>Tételezzük fel, hogy laborunkban a NIS sikeres
	bevezetése felkeltette a fõnökeink
	figyelmét.  Így a következõ feladatunk
	az lett, hogy terjesszük ki a NIS tartományt az
	egyetemen található néhány
	másik gépre is.  Az alábbi két
	táblázatban az új
	felhasználók és az új
	számítógép neveit találjuk,
	valamint a rövid leírásukat.</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Felhasználók nevei</th><th>Leírás</th></tr></thead><tbody><tr><td><code class="systemitem">alpha</code>,
		<code class="systemitem">beta</code></td><td>az IT tanszék hétköznapi
		dolgozói</td></tr><tr><td><code class="systemitem">charlie</code>,
		<code class="systemitem">delta</code></td><td>az IT tanszék újdonsült
		dolgozói</td></tr><tr><td><code class="systemitem">echo</code>,
		<code class="systemitem">foxtrott</code>, <code class="systemitem">golf</code>,
		...</td><td>átlagos dolgozók</td></tr><tr><td><code class="systemitem">able</code>,
		<code class="systemitem">baker</code>, ...</td><td>ösztöndíjasok</td></tr></tbody></table></div><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Gépek nevei</th><th>Leírás</th></tr></thead><tbody><tr><td><code class="systemitem">haboru</code>, <code class="systemitem">halal</code>,
		<code class="systemitem">ehseg</code>, <code class="systemitem">szennyezes</code></td><td>A legfontosabb szervereink.  Csak az IT
		tanszék dolgozói férhetnek
		hozzájuk.</td></tr><tr><td><code class="systemitem">buszkeseg</code>,
		<code class="systemitem">kapzsisag</code>, <code class="systemitem">irigyseg</code>,
		<code class="systemitem">harag</code>, <code class="systemitem">bujasag</code>,
		<code class="systemitem">lustasag</code></td><td>Kevésbé fontos szerverek.  Az IT
		tankszék összes tagja el tudja érni
		ezeket a gépeket.</td></tr><tr><td><code class="systemitem">egy</code>, <code class="systemitem">ketto</code>,
		<code class="systemitem">harom</code>, <code class="systemitem">negy</code>,
		...</td><td>Átlagos munkaállomások.
		Egyedül csak a <span class="emphasis"><em>valódi</em></span>
		dolgozók jelentkezhetnek be ezekre a
		gépekre.</td></tr><tr><td><code class="systemitem">szemetes</code></td><td>Egy nagyon régi gép, semmi
		értékes adat nincs rajta.  Akár
		még az öszöndíjasok is
		nyúzhatják.</td></tr></tbody></table></div><p>Ha ezeket az igényeket úgy
	próbáljuk meg teljesíteni, hogy a
	felhasználókat egyenként blokkoljuk, akkor
	minden rendszer <code class="filename">passwd</code>
	állományába külön fel kell
	vennünk a
	<code class="literal">-felhasználó</code>
	sorokat a letiltott felhasználókhoz.  Ha csak
	egyetlen bejegyzést is kihagyunk, akkor könnyen
	bajunk származhat belõle.  Ez a rendszer kezdeti
	beállítása során még
	talán nem okoz gondot, de az új
	felhasználókat <span class="emphasis"><em>biztosan</em></span> el
	fogjuk felejteni felvenni a megfelelõ csoportokba.
	Elvégre Murphy is optimista volt.</p><p>A hálózati csoportok használata ilyen
	helyzetekben számos elõnyt rejt.  Nem kell az egyes
	felhasználókat külön felvenni, egy
	felhasználót felveszünk valamelyik csoportba
	vagy csoportokba, és a csoportok összes
	tagjának egyszerre tudjuk tiltani vagy
	engedélyezni a hozzáféréseket.  Ha
	hozzáadunk egy új gépet a
	hálózatunkhoz, akkor mindössze a
	hálózati csoportok bejelentkezési
	korlátozásait kell beállítani.  Ha
	új felhasználót veszünk fel, akkor a
	felhasználót kell vennünk egy vagy több
	hálózati csoportba.  Ezek a
	változtatások függetlenek
	egymástól, és nincs szükség
	<span class="quote">"<span class="quote">minden felhasználó és minden
	gép összes
	kombinációjára</span>"</span>.  Ha a NIS
	beállításainkat elõzetesen
	körültekintõen megterveztük, akkor egyetlen
	központi konfigurációs
	állományt kell módosítani a
	gépek elérésének
	engedélyezéséhez vagy
	tiltásához.</p><p>Az elsõ lépés a hálózati
	csoportokat tartalmazó NIS táblázat
	inicializálása.  A FreeBSD <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypinit&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypinit</span>(8)</span></a> programja
	alapértelmezés szerint nem hozza létre ezt
	a táblázatot, de ha készítünk
	egy ilyet, akkor a NIS implementációja
	képes kezelni.  Egy ilyen üres
	táblázat
	elkészítéséhez ennyit kell
	begépelni:</p><pre class="screen">ellington<code class="prompt">#</code> <strong class="userinput"><code>vi /var/yp/netgroup</code></strong></pre><p>Ezután elkezdhetjük felvenni a tartalmát.
	A példánk szerint legalább négy
	hálózati csoportot kell csinálnunk: az IT
	dolgozóinak, az IT új dolgozóinak, a
	normál dolgozóknak és az
	öszöndíjasoknak.</p><pre class="programlisting">IT_DOLG       (,alpha,proba-tartomany)    (,beta,proba-tartomany)
IT_UJDOLG     (,charlie,proba-tartomany)  (,delta,proba-tartomany)
FELHASZNALO   (,echo,proba-tartomany)     (,foxtrott,proba-tartomany) \
              (,golf,proba-tartomany)
OSZTONDIJAS   (,able,proba-tartomany)     (,baker,proba-tartomany)</pre><p>Az <code class="literal">IT_DOLG</code>, <code class="literal">IT_UJDOLG</code>
	stb.  a hálózati csoportok nevei lesznek.  Minden
	egyes zárójelezett csoport egy vagy több
	felhasználói hozzáférést
	tartalmaz.  A csoportokban szereplõ három mezõ
	a következõ:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Azon gépek neve, amelykre a következõ
	    elemek érvényesek.  Ha itt nem adunk meg
	    neveket, akkor a bejegyzés az összes
	    gépre vonatkozik.  Ha megadjuk egy gép
	    nevét, akkor jutalmunk a teljes
	    sötétség, a rettegetés és
	    totális megtébolyodás.</p></li><li class="listitem"><p>A csoporthoz tartozó
	    hozzáférés neve.</p></li><li class="listitem"><p>A hozzáféréshez
	    kapcsolódó NIS tartomány.  A csoportba
	    más NIS tartományokból is át
	    tudunk hozni hozzáféréseket, ha
	    netalán éppen olyan szerencsétlenek
	    lennénk, hogy több NIS tartományt is
	    felügyelnünk kell.</p></li></ol></div><p>A mezõk mindegyike tartalmazhat
	dzsókerkaraktereket.  Errõl részletesebben a
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=netgroup&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">netgroup</span>(5)</span></a> man oldalon olvashatunk.</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><a xmlns="http://www.w3.org/1999/xhtml" id="idp97615824" class="indexterm"></a><p xmlns="http://www.w3.org/1999/xhtml">A hálózati csoportoknak lehetõleg ne
	  adjunk 8 karakternél hosszabb nevet,
	  különösen abban az esetben, ha a NIS
	  tartományban más operációs
	  rendszereket is használunk.  A nevekben eltérnek
	  a kis- és nagybetûk.  Ha a hálózati
	  csoportokat nevét nagybetûkkel írjuk, akkor
	  könnyen különbséget tudunk tenni a
	  felhasználók, gépek és
	  hálózati csoportok nevei
	  között.</p><p xmlns="http://www.w3.org/1999/xhtml">Egyes (nem FreeBSD alapú) NIS kliensek nem
	  képesek kezelni a nagyon sok bejegyzést
	  tartalmazó hálózati csoportokat.
	  Például a <span class="trademark">SunOS</span>TM néhány
	  korábbi verziója fennakad rajta, ha egy
	  hálózati csoport 15
	  <span class="emphasis"><em>bejegyzésnél</em></span> többet
	  tartalmaz.  Az ilyen korlátozások alól
	  úgy tudunk kibújni, ha 15
	  felhasználónként újabb
	  hálózati csoportokat hozunk létre,
	  amelyekkel az eredeti hálózati csoportot
	  építjük fel:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">NAGYCSP1  (,joe1,tartomany)  (,joe2,tartomany)  (,joe3,tartomany) [...]
NAGYCSP2  (,joe16,tartomany)  (,joe17,tartomany) [...]
NAGYCSP3  (,joe31,tartomany)  (,joe32,tartomany)
NAGYCSOPORT  NAGYCSP1 NAGYCSP2 NAGYCSP3</pre><p xmlns="http://www.w3.org/1999/xhtml">Ugyanez a folyamat javasolt olyan esetekben is, ahol 225
	  felhasználónál többre lenne
	  szükség egyetlen hálózati csoporton
	  belül.</p></div><p>Az így létrehozott új NIS
	táblázat szétküldése
	meglehetõsen könnyû feladat:</p><pre class="screen">ellington<code class="prompt">#</code> <strong class="userinput"><code>cd /var/yp</code></strong>
ellington<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong></pre><p>Ez a parancs létrehoz három NIS
	táblázatot: <code class="filename">netgroup</code>,
	<code class="filename">netgroup.byhost</code> és
	<code class="filename">netgroup.byuser</code>.  Az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypcat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ypcat</span>(1)</span></a>
	paranccsal ellenõrizni is tudjuk az új NIS
	táblázatainkat:</p><pre class="screen">ellington<code class="prompt">%</code> <strong class="userinput"><code>ypcat -k netgroup</code></strong>
ellington<code class="prompt">%</code> <strong class="userinput"><code>ypcat -k netgroup.byhost</code></strong>
ellington<code class="prompt">%</code> <strong class="userinput"><code>ypcat -k netgroup.byuser</code></strong></pre><p>Az elsõ parancs kimenete a
	<code class="filename">/var/yp/netgroup</code> állomány
	tartalmára emlékeztethet minket.  A második
	parancsnak nincs semmilyen kimenete, hacsak nem adtunk meg
	valamilyen gépfüggõ hálózati
	csoportot.  A harmadik parancs a hálózati
	csoportokat listázza ki a
	felhasználókhoz.</p><p>A kliensek beállítása tehát
	nagyon egyszerû.  A <code class="systemitem">haboru</code> nevû
	szerver beállításához
	indítsuk el a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vipw&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">vipw</span>(8)</span></a> programot, és
	cseréljük a</p><pre class="programlisting">+:::::::::</pre><p>sort erre:</p><pre class="programlisting">+@IT_DOLG:::::::::</pre><p>Innentõl kezdve kizárólag csak az
	<code class="literal">IT_DOLG</code> csoportban található
	felhasználók fognak bekerülni a
	<code class="systemitem">haboru</code> jelszó
	adatbázisába, és csak ezek a
	felhasználók tudnak ide bejelentkezni.</p><p>Sajnos ez a korlátozás a
	parancsértelmezõ <code class="literal">~</code>
	funkciójára és összes olyan rutinra is
	vonatkozik, amelyet a felhasználói nevek és
	azok numerikus azonosító között
	képez le.  Más szóval a <code class="command">cd
	~felhasználó</code>
	parancs nem fog mûködni, és az <code class="command">ls
	-l</code> parancs kimenetében a
	felhasználói nevek helyett csak numerikus
	azonosítók jelennek meg, továbbá
	a<code class="command">find .  -user joe -print</code> <span class="errorname">No such
	user</span> (<span class="errorname">Nincs ilyen
	felhasználó</span>) hibát fog
	visszaadni.  Ez úgy tudjuk megjavítani, ha
	úgy importáljuk a szerverre az összes
	felhasználó bejegyzését, hogy
	<span class="emphasis"><em>közben tiltjuk a
	hozzáférésüket</em></span>.</p><p>Ehhez vegyünk fel egy újabb sort az
	<code class="filename">/etc/master.passwd</code>
	állományba.  A sor valahogy így fog
	kinézni:</p><p><code class="literal">+:::::::::/sbin/nologin</code>, amely annyit
	tesz, hogy <span class="quote">"<span class="quote">importáljuk az összes
	bejegyzést, de a hozzájuk tartozó
	parancsértelmezõ a
	<code class="filename">/sbin/nologin</code> legyen</span>"</span>.  A
	<code class="literal">passwd</code> állományban
	tetszõleges mezõ tartalmát le tudjuk úgy
	cserélni, ha megadunk neki egy alapértelmezett
	értéket az <code class="filename">/etc/master.passwd</code>
	állományban.</p><div xmlns="" class="warning"><h3 class="admontitle">Figyelem: </h3><p xmlns="http://www.w3.org/1999/xhtml">Vigyázzunk, hogy a
	  <code class="literal">+:::::::::/sbin/nologin</code> sort az
	  <code class="literal">+@IT_DOLG:::::::::</code> sor után
	  írjuk.  Ha nem így teszünk, akkor a
	  NIS-bõl importált összes
	  felhasználói hozzáférés a
	  <code class="filename">/sbin/nologin</code>
	  parancsértelmezõt kapja.</p></div><p>Miután elvégeztük ezt a
	változtatást, minden újabb dolgozó
	felvétele után csupán egyetlen
	táblázatot kell megváltoztatnunk.  Ugyanezt
	a taktikát követhetjük a kevésbé
	fontosabb szerverek esetében is, hogy ha a helyi
	<code class="filename">/etc/master.passwd</code>
	állományukban a korábbi
	<code class="literal">+:::::::::</code> bejegyzést valami
	ilyesmivel helyettesítjük:</p><pre class="programlisting">+@IT_DOLG:::::::::
+@IT_UJDOLG:::::::::
+:::::::::/sbin/nologin</pre><p>Az egyszerû munkaállomások
	esetében pedig ezekre a sorokra lesz
	szükségünk:</p><pre class="programlisting">+@IT_DOLG:::::::::
+@FELHASZNALOK:::::::::
+:::::::::/sbin/nologin</pre><p>Minden remekül üzemel egészen addig,
	amíg néhány hét múlva
	ismét változik a házirend: az IT
	tanszékre ösztöndíjasok érkeznek.
	Az IT ösztöndíjasai a
	munkaállomásokat és a kevésbé
	fontosabb szervereket tudják használni.  Az
	új IT dolgozók már a központi
	szerverekre is bejelentkezhetnek.  Így tehát
	létrehozunk egy új hálózati
	csoportot <code class="literal">IT_OSZTONDIJAS</code> néven, majd
	felvesszük ide az új IT
	ösztöndíjasokat, és nekilátunk
	végigzongorázni az összes gép
	összes konfigurációs
	állományát...  Ahogy azonban egy
	régi mondás is tartja: <span class="quote">"<span class="quote">A
	központosított tervezésben ejtett
	hibák teljes káoszhoz vezetnek</span>"</span>.</p><p>A NIS az ilyen helyzeteket úgy igyekszik
	elkerülni, hogy megengedi újabb
	hálózati csoportok
	létrehozását más
	hálózati csoportokból.  Egyik ilyen
	lehetõség a szerep alapú
	hálózati csoportok kialakítása.
	Például, ha a fontosabb szerverek
	bejelentkezési korlátozásai
	számára hozzunk létre egy
	<code class="literal">NAGYSRV</code> nevû csoportot, valamint egy
	másik hálózati csoportot
	<code class="literal">KISSRV</code> néven a kevésbé
	fontosabb szerverekhez, végül
	<code class="literal">MUNKA</code> néven egy harmadik
	hálózati csoportot a
	munkaállomásokhoz.  Mindegyik ilyen
	hálózati csoport tartalmazza azokat a csoportokat,
	amelyek engedélyezik a gépek
	elérését.  A hálózati
	csoportok leírását tartalmazó NIS
	táblázat most valahogy így fog
	kinézni:</p><pre class="programlisting">NAGYSRV  IT_DOLG IT_UJDOLG
KISSRV   IT_DOLG IT_UJDOLG IT_OSZTONDIJAS
MUNKA    IT_DOLG IT_OSZTONDIJAS FELHASZNALOK</pre><p>A bejelentkezési megszorítások ilyen
	típusú megadása viszonylag jól
	mûködik, hogy ha azonos korlátozások
	alá esõ gépek csoportjait akarjuk
	felírni.  Bánatunk ez a kivétel, és
	nem a szabály.  Az esetek nagy
	többségében ugyanis a bejelentkezésre
	vonatkozó korlátozásokat
	gépenként kell egyesével megadni.</p><p>A hálózati csoportok gépfüggõ
	megadása tehát az iménti házirendhez
	társuló igények
	kielégítésének egyik módja.
	Ebben a forgatókönyvben az
	<code class="filename">/etc/master.passwd</code> állomány
	minden számítógépen két
	<span class="quote">"<span class="quote">+</span>"</span>-os sorral kezdõdik.
	Közülük az elsõ a gépen
	engedélyezett hozzáféréseket
	tartalmazó hálózati csoportra vonatkozik, a
	második pedig az összes többi
	hozzáféréshez az
	<code class="filename">/sbin/nologin</code> parancsértelmezõt
	kapcsolja hozzá.  Itt jó ötlet, ha a
	gép nevének
	<span class="quote">"<span class="quote">VÉGIG-NAGYBETûS</span>"</span>
	változatát adjuk meg a hozzá tartozó
	hálózati csoport nevének:</p><pre class="programlisting">+@<em class="replaceable"><code>GÉPNÉV</code></em>:::::::::
+:::::::::/sbin/nologin</pre><p>Miután elvégeztük ezt a feladatot minden
	egyes gépen, az <code class="filename">/etc/master.passwd</code>
	állomány helyi változatait soha
	többé nem kell módosítanunk.  Az
	összes többi változtatást a NIS
	táblázaton keresztül tudjuk keresztül
	vinni.  Íme a felvázolt
	forgatókönyvhöz tartozó
	hálózati csoportok
	kiépítésének egyik lehetséges
	változata, egy-két finomsággal
	kiegészítve:</p><pre class="programlisting"># Elõször a felhasználók csoportjait adjuk meg:
IT_DOLG         (,alpha,proba-tartomany)    (,beta,proba-tartomany)
IT_UJDOLG       (,charlie,proba-tartomany)  (,delta,proba-tartomany)
TANSZ1          (,echo,proba-tartomany)     (,foxtrott,proba-tartomany)
TANSZ2          (,golf,proba-taromany)      (,hotel,proba-tartomany)
TANSZ3          (,india,proba-taromany)     (,juliet,proba-tartomany)
IT_OSZTONDIJAS  (,kilo,proba-tartomany)     (,lima,proba-tartomany)
D_OSZTONDIJAS   (,able,proba-tartomany)     (,baker,proba-tartomany)
#
# Most pedig hozzunk létre csoportokat szerepek szerint:
FELHASZNALOK     TANSZ1   TANSZ2          TANSZ3
NAGYSRV          IT_DOLG  IT_UJDOLG
KISSRV           IT_DOLG  IT_UJDOLG       IT_OSZTONDIJAS
MUNKA            IT_DOLG  IT_OSZTONDIJAS  FELHASZNALOK
#
# Következzenek a speciális feladatokhoz tartozó csoportok:
# Az echo és a golf tudja elérni a vírusvédelemért felelõs gépet:
VEDELEM          IT_DOLG  (,echo,proba-tartomany)  (,golf,proba-tartomany)
#
# Gép alapú hálózati csoportok
# A fõ szervereink:
HABORU      NAGYSRV
EHSEG       NAGYSRV
# Az india nevû felhasználó hozzá szeretné ehhez férni:
SZENNYEZES  NAGYSRV  (,india,proba-tartomany)
#
# Ez valóban fontos és komolyan szabályoznunk kell:
HALAL       IT_DOLG
#
# Az elõbb említett vírusvédelmi gép:
EGY         VEDELEM
#
# Egyetlen felhasználóra korlátozzuk le ezt a gépet:
KETTO       (,hotel,proba-tartomany)
# [...és itt folytatódik a többi csoporttal]</pre><p>Ha a felhasználói
	hozzáféréseinket valamilyen
	adatbázisban tároljuk, akkor a
	táblázat elsõ részét
	akár az adatbázis lekérdezésein
	keresztül is elõ tudjuk állítani.  Ezzel
	a módszerrel az új felhasználók
	automatikusan hozzáférnek a
	gépekhez.</p><p>Legyünk viszont óvatosak: nem mindig javasolt
	gépeken alapuló hálózati csoportokat
	készíteni.  Ha a hallgatói laborokba
	egyszerre több tucat vagy akár több száz
	azonos konfigurációjú gépet
	telepítünk, akkor a gép alapú
	csoportok helyett inkább szerep alapú csoportokat
	építsünk fel, mivel így a NIS
	táblázatok méretét egy
	elfogadható méreten tudjuk tartani.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97682768"></a>29.4.8. Amit feltétlenül észben kell
	tartanunk</h3></div></div></div><p>Még mindig akad néhány olyan dolog,
	amit másképpen kell csinálnunk
	azután, hogy most már NIS környezetben
	vagyunk.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Amikor egy új felhasználót akarunk
	    felvenni a laborba, akkor <span class="emphasis"><em>csak</em></span> a
	    központi NIS szerverre kell felvennünk, és
	    <span class="emphasis"><em>újra kell generáltatnunk a NIS
	    táblázatokat</em></span>.  Ha ezt
	    elfelejtjük megtenni, akkor az új
	    felhasználó a központi NIS szerveren
	    kívül sehova sem lesz képes
	    bejelentkezni.  Például, ha fel akarjuk venni
	    a <code class="systemitem">jsmith</code> nevû
	    felhasználót a laborba, akkor ezt kell
	    tennünk:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw useradd jsmith</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /var/yp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make proba-tartomany</code></strong></pre><p>Vagy a <code class="command">pw useradd jsmith</code> parancs
	    helyett az <code class="command">adduser jsmith</code> parancsot is
	    használhatjuk.</p></li><li class="listitem"><p><span class="emphasis"><em>A rendszergazdai szintû
	    hozzáféréseket ne tároljuk a NIS
	    táblázatokban</em></span>.  Olyan
	    gépekre egyáltalán ne is
	    küldjünk olyan karbantartáshoz
	    használt hozzáféréseket,
	    amelynek a felhasználói hivatalosan nem is
	    férhetnének hozzájuk.</p></li><li class="listitem"><p><span class="emphasis"><em>A központi NIS szervert és az
	    alárendelt szervereket óvjuk minél
	    jobban, és igyekezzünk minimalizálni a
	    kieséseiket</em></span>.  Ha valaki feltöri vagy
	    egyszerûen csak kikapcsolja ezeket a gépeket,
	    akkor ezzel lényegében mindenkit
	    megakadályoz abban, hogy be tudjon jelentkezni a
	    laborban.</p><p>Ezek a központosított
	    vezérlésû rendszerek legfõbb
	    gyengeségei.  Ha nem védjük kellõen
	    a NIS szervereinket, akkor azzal nagyon ellenséget
	    szerezhetünk magunknak!</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97692624"></a>29.4.9. Kompatibilitás a NIS elsõ
	változatával</h3></div></div></div><p>A FreeBSD-ben megtalálható
	<span class="application">ypserv</span> szolgáltatás
	valamennyire képes ellátni a NIS elsõ
	változatát használó klienseket is.
	A FreeBSD NIS implementációja csak a NIS v2
	protokollt használja, azonban mivel más
	implementációk kompatibilisek
	kívánnak maradni a régebbi rendszerekkel,
	ismerik a v1 protokollt is.  Az ilyen rendszerekhez
	tartozó <span class="application">ypbind</span> démonok
	még olyankor is megpróbálnak v1-es NIS
	szerverekhez kötést létrehozni, amikor
	valójában nincs is rá
	szükségük (és gyakran még akkor
	is ilyet keresnek, amikor az üzenetükre már
	válaszolt egy v2-es szerver).
	Hozzátennénk, hogy bár az
	<span class="application">ypserver</span> ezen változata a
	normál klienshívásokat képes
	feldolgozni, a táblázatokat már nem tudja
	átküldeni a v1-es klienseknek.  Ebbõl
	következik, hogy a központi vagy alárendelt
	szerverek nem tudnak együttmûködni olyan NIS
	szerverekkel, amelyek csak a v1-es protokollt beszélik.
	Szerencsére ilyen szervereket manapság már
	alig használnak.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-nis-server-is-client"></a>29.4.10. NIS szerverek, melyek egyben NIS kliensek</h3></div></div></div><p>Óvatosan kell bánnunk az
	<span class="application">ypserv</span>
	elindításával olyan többszerveres
	tartományokban, ahol a szerverek maguk is NIS kliensek.
	Alapvetõen nincs abban semmi kivetnivaló, ha a
	szervereket saját magukhoz kötjük ahelyett,
	hogy engednénk nekik a kötési
	kérések küldését és
	így egymáshoz kötnénk ezeket.
	Különös hibák tudnak származni
	olyan helyzetekben, amikor az egyik szerver leáll,
	miközben a többiek pedig függenek tõle.
	Végül is ilyenkor minden kliens szépen
	kivárja a szükséges idõt, aztán
	megpróbál más szerverekhez
	kötõdni, de az itt fellépõ
	késlekedés jelentõs mennyiségû
	lehet, és ez a hibajelenség ismét
	fennállhat, mivel elõfordulhat, hogy a szerverek
	megint egymáshoz kapcsolódnak.</p><p>A klienst úgy tudjuk egy adott szerverhez kötni,
	ha az <code class="command">ypbind</code> parancsot a <code class="option">-S</code>
	beállítással indítjuk.  Ha mindezt
	nem akarjuk manuálisan megtenni a NIS szerver minden
	egyes újraindításakor, akkor vegyük
	fel a következõ sorokat az
	<code class="filename">/etc/rc.conf</code>
	állományba:</p><pre class="programlisting">nis_client_enable="YES"	# elindítjuk a klienst is
nis_client_flags="-S <em class="replaceable"><code>NIS tartomány</code></em>,<em class="replaceable"><code>szerver</code></em>"</pre><p>Részletesebb lásd az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypbind&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypbind</span>(8)</span></a> man
	oldalát.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97700688"></a>29.4.11. A jelszavak formátuma</h3></div></div></div><a id="idp97701328" class="indexterm"></a><p>A NIS rendszerek kiépítése során
	az emberek leggyakrabban a jelszavak formátumával
	kapcsolatban tapasztalnak nehézségeket.  Ha a
	szerverünk DES titkosítású jelszavakat
	használ, akkor csak olyan klienseket fog tudni
	támogatni, amelyek szintén így
	kódolják ezeket.  Például, ha a
	hálózaton vannak <span class="trademark">Solaris</span>TM rendszerû NIS
	klienseink, akkor szinte biztos, hogy DES
	titkosítást kell használnunk.</p><p>A szerverek és a kliensek által
	használt formátumokat az
	<code class="filename">/etc/login.conf</code> állományba
	tekintve deríthetjük ki.  Ha a gépek
	többségén a DES titkosítást
	látjuk, akkor a <code class="literal">default</code>
	osztálynak egy ilyen bejegyzést kell
	tartalmaznia:</p><pre class="programlisting">default:\
	:passwd_format=des:\
	:copyright=/etc/COPYRIGHT:\
	[a többit most nem mutatjuk]</pre><p>A <code class="literal">passwd_format</code> tulajdonság
	további lehetséges értékei lehetnek
	a <code class="literal">blf</code> és az <code class="literal">md5</code>
	(melyek rendre a Blowfish és MD5
	titkosítású jelszavakat adják
	meg).</p><p>Ha változtattunk valamit az
	<code class="filename">/etc/login.conf</code> állományban,
	akkor a bejelentkezési tulajdonságok
	adatbázisát is újra kell generálni,
	melyet <code class="systemitem">root</code>
	felhasználóként a következõ
	módon tehetünk meg:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Az <code class="filename">/etc/master.passwd</code>
	  állományban jelenlevõ jelszavak
	  formátuma azonban nem frissítõdik
	  egészen addig, amíg a felhasználók
	  a bejelentkezési adatbázis
	  újragenerálása
	  <span class="emphasis"><em>után</em></span> meg nem
	  változtatják a jelszavaikat.</p></div><p>Úgy tudjuk még biztosítani, hogy a
	jelszavak megfelelõ formátumban
	kódolódjanak, ha az
	<code class="filename">/etc/auth.conf</code> állományban
	megkeressük a <code class="literal">crypt_default</code> sort,
	amelyben a választható
	jelszóformátumok
	felhasználásái sorrendjét
	találhatjuk meg.  Itt tehát mindössze annyit
	kell tennünk, hogy a kiszemelt formátumot a lista
	elejére tesszük.  Például, ha a DES
	titkosítású jelszavakat akarunk
	használni, akkor ez a bejegyzés így fog
	kinézni:</p><pre class="programlisting">crypt_default	=	des blf md5</pre><p>Ha a fenti lépéseket követjük az
	összes FreeBSD alapú NIS szervernél és
	kliensnél, akkor biztosra mehetünk abban, hogy a
	hálózatunkon belül ugyanazt a
	jelszóformátumot fogják használni.
	Ha gondunk akadna a NIS kliensek
	hitelesítésével, akkor itt érdemes
	kezdeni a hiba felderítését.  Ne
	felejtsük: ha egy NIS szervert egy heterogén
	hálózatba akarunk telepíteni, akkor
	valószínûleg az összes rendszeren a DES
	titkosítást kell választani, mivel
	általában ez a közös nevezõ ebben a
	tekintetben.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-nfs.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="network-servers.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="network-dhcp.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">29.3. A hálózati állományrendszer
      (NFS) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 29.5. A hálózat automatikus
      beállítása (DHCP)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>