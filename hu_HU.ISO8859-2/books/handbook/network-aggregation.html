<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>31.6. Linkek összefûzése és hibatûrése</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="advanced-networking.html" title="31. fejezet - Egyéb haladó hálózati témák" /><link rel="prev" href="network-bridging.html" title="31.5. Hálózati hidak" /><link rel="next" href="network-diskless.html" title="31.7. Lemez nélküli mûködés" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.6. Linkek összefûzése és
      hibatûrése</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-bridging.html">Vissza</a> </td><th width="60%" align="center">31. fejezet - Egyéb haladó hálózati
    témák</th><td width="20%" align="right"> <a accesskey="n" href="network-diskless.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-aggregation"></a>31.6. Linkek összefûzése és
      hibatûrése</h2></div><div><span class="authorgroup">Írta: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Thompson</span>, <span class="firstname">Andrew</span></span>. </span></div></div></div><a id="idp100541904" class="indexterm"></a><a id="idp100542416" class="indexterm"></a><a id="idp100542928" class="indexterm"></a><a id="idp100543440" class="indexterm"></a><a id="idp100543952" class="indexterm"></a><a id="idp100544464" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100545104"></a>31.6.1. Bevezetés</h3></div></div></div><p>A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> felület lehetõvé teszi, hogy
	több hálózati felületet egyetlen
	virtuális felületként fûzzünk
	össze, és ezzel egy hibatûrõ és
	nagysebességû összeköttetést
	alakítsunk ki.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100547024"></a>31.6.2. Mûködési módok</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">failover</span></dt><dd><p>Csak az elsõdlegesként kijelölt porton
	    keresztül fogad és küld adatokat.  Amikor
	    ez az elsõdleges port elérhetetlenné
	    válik, a következõ aktív portot
	    fogja használni.  Az elsõként felvett
	    felület válik automatikusan az elsõdleges
	    porttá, és az utána felvett összes
	    többit pedig csak hiba esetén
	    használjuk.</p></dd><dt><span class="term"><span class="trademark">Cisco</span>(R) Fast <span class="trademark">EtherChannel</span>(R)</span></dt><dd><p>A <span class="trademark">Cisco</span>(R) Fast <span class="trademark">EtherChannel</span>(R) (FEC) technológia
	    támogatása.  Ez egy statikus
	    beállítás, és nem egyezteti az
	    összefûzést a többiekkel vagy a linkek
	    felügyeletéhez nem vált kereteket.  Ha a
	    switch támogatja az LACP használatát,
	    akkor inkább azt válasszuk.</p><p>A <acronym class="acronym">FEC</acronym> a kimenõ forgalmat a
	    fejlécekben szereplõ protokollok alapján
	    számolt hasítókóddal
	    próbálja szétosztani az aktív
	    portok között, és tetszõleges
	    aktív porton fogad beérkezõ adatokat.  Az
	    említett hasítókódban egy
	    Ethernetes forrás- és célcím
	    szerepel, valamint ha elérhetõ, akkor egy VLAN
	    címke, illetve az IPv4/IPv6 forrás- és
	    célcím.</p></dd><dt><span class="term">LACP</span></dt><dd><p>Az <span class="trademark">IEEE</span>(R) 802.3ad Link Aggregation Control Protocol (LACP)
	    és a Marker Protcol támogatása.  Az
	    LACP megpróbálja egyeztetni a többi
	    géppel az összefûzhetõ linkeket egy
	    vagy több csoportban (Link Aggregated Group, LAG).
	    Mindegyik ilyen csoportban ugyanolyan sebességû
	    portokat találunk, full-duplex
	    mûködési módban.  A forgalmat
	    így a legnagyobb összsebességgel
	    rendelkezõ csoportban megtalálható portok
	    között osztja el, ami a legtöbb esetben az
	    összes portot magában foglaló csoport.  A
	    fizikai konnektivitás megváltozása
	    esetén a linkek összefûzõdése
	    igen gyorsan alkalmazkodik az új
	    konfigurációhoz.</p><p>Az <acronym class="acronym">LACP</acronym> a kimenõ forgalmat az
	    aktív portok között osztja szét
	    fejlécekben szereplõ protokollok alapján
	    számolt hasítókóddal, és
	    bármelyik aktív portról fogad
	    bejövõ forgalmat.  A
	    hasítókódban megtalálható
	    az Ethernetes forrás- és célcím,
	    valamint ha elérhetõ, akkor a VLAN címke,
	    illetve az IPv4/IPv6 forrás- és
	    célcímek.</p></dd><dt><span class="term">Loadbalance</span></dt><dd><p>Ez a <span class="emphasis"><em>FEC</em></span> mód másik
	    neve.</p></dd><dt><span class="term">Round-Robin</span></dt><dd><p>A kimenõ forgalmat egy körkörös
	    (Round-Robin) elvû ütemezõvel osztja
	    szét az aktív portok között
	    és tetszõleges aktív portról fogad
	    bejövõ forgalmat.  Ez a mûködési
	    mód megsérti az Ethernet keretek
	    rendezését és csak nagy
	    körültekintés mellett alkalmazzuk.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100563664"></a>31.6.3. Példák</h3></div></div></div><div class="example"><a id="networking-lacp-aggregation-cisco"></a><div class="example-title">31.1. példa - LACP alapú összefûzés egy <span class="trademark">Cisco</span>(R)
	  switch-csel</div><div class="example-contents"><p>Ebben a példában egy FreeBSD-s gép
	  két felületét kapcsoljuk össze
	  switch-csel egy egyszerû
	  terhelés-kiegyenlítéssel és
	  hibatûréssel beállított linken
	  keresztül.  Mivel az Ethernet keretek sorrendje
	  döntõ fontosságú, ezért a
	  két állomás között egyazon
	  fizikai linken zajló forgalom maximális
	  sebességét az adott felület
	  kapacitása korlátozza.  A küldési
	  algoritmus a lehetõ legtöbb információ
	  alapján próbálja egymástól
	  megkülönböztetni a forgalmakat és
	  elosztani ezeket a rendelkezésre álló
	  felületek között.</p><p>A <span class="trademark">Cisco</span>(R) switch-en vegyünk fel a
	  <em class="replaceable"><code>FastEthernet0/1</code></em> és
	  <em class="replaceable"><code>FastEthernet0/2</code></em>
	  interfészeket az <em class="replaceable"><code>1</code></em> csoportba
	  (channel group):</p><pre class="screen"><strong class="userinput"><code>interface FastEthernet0/1
 channel-group 1 mode active
 channel-protocol lacp</code></strong>
!
<strong class="userinput"><code>interface FastEthernet0/2
 channel-group 1 mode active
 channel-protocol lacp</code></strong></pre><p>A FreeBSD-s gépen pedig a
	  <em class="replaceable"><code>fxp0</code></em> és
	  <em class="replaceable"><code>fxp1</code></em> használatával
	  hozzunk létre a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> interfészt:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 up laggproto lacp laggport fxp0 laggport fxp1</code></strong></pre><p>Ellenõrizzük a felület
	  állapotát:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0</code></strong></pre><p>A <span class="emphasis"><em>ACTIVE</em></span> jelzésû, vagyis
	  aktív állapotú portok az
	  összefûzéshez kialakított csoport azon
	  tagjai, amelyeknél felépült a kapcsolat a
	  távoli switch felé és készen
	  állnak a küldésre és
	  fogadásra.  Ha az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> programtól
	  részletesebb kimenetet kérünk, akkor
	  láthatjuk a csoportok azonosítóit
	  is:</p><pre class="screen">lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
        media: Ethernet autoselect
        status: active
        laggproto lacp
        laggport: fxp1 flags=1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;
        laggport: fxp0 flags=1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;</pre><p>A <strong class="userinput"><code>show lacp neighbor</code></strong> paranccsal
	  kérdezhetjük le a portok
	  állapotát:</p><pre class="screen">switch# show lacp neighbor
Flags:  S - Device is requesting Slow LACPDUs
        F - Device is requesting Fast LACPDUs
        A - Device is in Active mode       P - Device is in Passive mode

Channel group 1 neighbors

Partner's information:

                  LACP port                        Oper    Port     Port
Port      Flags   Priority  Dev ID         Age     Key     Number   State
Fa0/1     SA      32768     0005.5d71.8db8  29s    0x146   0x3      0x3D
Fa0/2     SA      32768     0005.5d71.8db8  29s    0x146   0x4      0x3D</pre><p>Részletesebb kijelzést a <strong class="userinput"><code>show
	    lacp neighbor detail</code></strong> paranccsal kaphatunk.</p></div></div><br class="example-break" /><div class="example"><a id="networking-lagg-failover"></a><div class="example-title">31.2. példa - A hibatûrés
	  beállítása</div><div class="example-contents"><p>A hibatûrési mód arra alkalmas, hogy
	  amikor az elsõdleges porton elvesztjük a
	  kapcsolatot, helyette egy másodlagos interfész
	  használatára tudunk áttérni.
	  Hozzuk létre és állítsuk be a
	  <em class="replaceable"><code>lagg0</code></em> interfészt, ahol az
	  <em class="replaceable"><code>fxp0</code></em> legyen a
	  fõinterfész, az <em class="replaceable"><code>fxp1</code></em>
	  pedig a tartalék interfész:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 up laggproto failover laggport fxp0 laggport fxp1</code></strong></pre><p>Az így létrejövõ interfész
	  nagyjából az alábbi lesz, ahol
	  eltérés a <acronym class="acronym">MAC</acronym>-cím
	  és az eszköz neve:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0</code></strong>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
        media: Ethernet autoselect
        status: active
        laggproto failover
        laggport: fxp1 flags=0&lt;&gt;
        laggport: fxp0 flags=5&lt;MASTER,ACTIVE&gt;</pre><p>A forgalom kezdetben az <em class="replaceable"><code>fxp0</code></em>
	  felületen keresztül érkezik és
	  távozik.  Ha az <em class="replaceable"><code>fxp0</code></em>
	  felületen valamiért megszakadna a kapcsolat,
	  helyette az <em class="replaceable"><code>fxp1</code></em> lesz az
	  aktív link.  Ha késõbb helyreáll a
	  kapcsolat az elsõdleges felületen, akkor újra
	  az lesz aktív link.</p></div></div><br class="example-break" /><div class="example"><a id="networking-lagg-wired-and-wireless"></a><div class="example-title">31.3. példa - Hibatûrés beállítása
	  vezetékes és vezeték nélküli
	  hálózatok között</div><div class="example-contents"><p>Hordozható számítógépek
	  használata esetén általában
	  érdemesebb a vezeték nélküli
	  kapcsolatot másodlagos interfészként
	  beállítani, így csak akkor
	  használja a rendszer, ha vezetékes
	  hálózat nem érhetõ el.  A
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> segítségével egyetlen
	  IP-címmel tudjuk használni mind a két
	  interfészt: a teljesítmény és
	  biztonságosság miatt elsõsorban a
	  vezetékes hálózatot használjuk,
	  miközben megmarad a lehetõség az adatok
	  továbbítására a vezeték
	  nélküli kapcsolaton keresztül is.</p><p>A beállítás során a
	  vezeték nélküli interfész
	  <acronym class="acronym">MAC</acronym>-címét úgy kell
	  módosítanunk, hogy megegyezzen a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a>
	  címével.  A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> interfész a
	  saját <acronym class="acronym">MAC</acronym>-címét az
	  elsõdleges interfésztõl örökli,
	  amely jelen esetünkben a vezetékes
	  interfész lesz.</p><p>A most következõ példában a
	  vezetékes hálózatunk lesz az
	  elsõdleges interfész
	  (<em class="replaceable"><code>bge0</code></em>), míg a vezeték
	  nélküli (<em class="replaceable"><code>wlan0</code></em>) a
	  másodlagos.  A <em class="replaceable"><code>wlan0</code></em>
	  interfészt az <em class="replaceable"><code>iwn0</code></em>
	  interfészbõl hoztuk létre, és a
	  vezetékes kapcsolat
	  <acronym class="acronym">MAC</acronym>-címét
	  állítjuk be neki.  Elsõ
	  lépésként tehát le kell
	  kérdeznünk a vezetékes interfész
	  <acronym class="acronym">MAC</acronym>-címét:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bge0</code></strong>
bge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	options=19b&lt;RXCSUM,TXCSUM,VLAN_MTU,VLAN_HWTAGGING,VLAN_HWCSUM,TSO4&gt;
	ether 00:21:70:da:ae:37
	inet6 fe80::221:70ff:feda:ae37%bge0 prefixlen 64 scopeid 0x2
	nd6 options=29&lt;PERFORMNUD,IFDISABLED,AUTO_LINKLOCAL&gt;
	media: Ethernet autoselect (1000baseT &lt;full-duplex&gt;)
	status: active</pre><p>A <em class="replaceable"><code>bge0</code></em> helyett
	  természetesen a saját vezetékes
	  hálózati interfészünket kell
	  megadni, és az <code class="literal">ether</code> kezdetû
	  sorban is saját kártyánk
	  <acronym class="acronym">MAC</acronym>-címe fog megjelenni.
	  Ezután már meg is tudjuk változtatni az
	  <em class="replaceable"><code>iwn0</code></em> címét:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig iwn0 ether 00:21:70:da:ae:37</code></strong></pre><p>Aktiváljuk a vezeték nélküli
	  interfészt, de ne állítsunk be neki
	  semmilyen IP-címet:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig wlan0 create wlandev iwn0 ssid wlan_hálózat up</code></strong></pre><p>Hozzuk létre a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> interfészt a
	  <em class="replaceable"><code>bge0</code></em> mint elsõdleges
	  interfész megadásával, valamint a
	  <em class="replaceable"><code>wlan0</code></em> legyen a szükség
	  esetén használható
	  tartalék:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 up laggproto failover laggport bge0 laggport wlan0</code></strong></pre><p>Az így létrehozott interfész
	  nagyjából így fog megjelenni, egyedüli
	  fontosabb eltérések a
	  <acronym class="acronym">MAC</acronym>-címek és az
	  eszközök nevei:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0</code></strong>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:21:70:da:ae:37
        media: Ethernet autoselect
        status: active
        laggproto failover
        laggport: wlan0 flags=0&lt;&gt;
        laggport: bge0 flags=5&lt;MASTER,ACTIVE&gt;</pre><p>Hogy ne kelljen a rendszer minden egyes
	  indítása után ezt a mûveletet
	  megismételni, vegyük fel a következõ
	  sorokat az <code class="filename">/etc/rc.conf</code>
	  állományba:</p><pre class="programlisting">ifconfig_bge0="up"
ifconfig_iwn0="ether 00:21:70:da:ae:37"
wlans_iwn0="wlan0"
ifconfig_wlan0="WPA"
cloned_interfaces="lagg0"
ifconfig_lagg0="laggproto failover laggport bge0 laggport wlan0 DHCP"
</pre></div></div><br class="example-break" /></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-bridging.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="network-diskless.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">31.5. Hálózati hidak </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 31.7. Lemez nélküli mûködés</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>