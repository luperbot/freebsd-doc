<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>29.10. Az órák egyeztetése az NTP használatával</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="network-servers.html" title="29. fejezet - Hálózati szerverek" /><link rel="prev" href="network-samba.html" title="29.9. Állomány- és nyomtatási szolgáltatások Microsoft(R) Windows(R) kliensek számára (Samba)" /><link rel="next" href="network-syslogd.html" title="29.11. Távoli gépek naplózása syslogd használatával" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.10. Az órák egyeztetése az NTP
      használatával</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-samba.html">Vissza</a> </td><th width="60%" align="center">29. fejezet - Hálózati szerverek</th><td width="20%" align="right"> <a accesskey="n" href="network-syslogd.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ntp"></a>29.10. Az órák egyeztetése az NTP
      használatával</h2></div><div><span class="authorgroup">Készítette: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Hukins</span>, <span class="firstname">Tom</span></span>. </span></div></div></div><a id="idp98466512" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98467024"></a>29.10.1. Áttekintés</h3></div></div></div><p>Idõvel a számítógép
	órája hajlamos elmászni.  A
	hálózati idõ protokoll (Network Time
	Protocol, NTP) az egyik módja az óránk
	pontosan tartásának.</p><p>Rengeteg internetes szolgáltatás
	elvárja vagy éppen elõnyben
	részesíti a számítógép
	órájának pontosságát.
	Például egy webszervertõl
	megkérdezhetik, hogy egy állományt adott
	ideje módosítottak-e.  A helyi
	hálózatban az egyazon
	állományszerveren megosztott
	állományok ellentmondásmentes
	dátumozása érdekében szinte
	elengedhetetlen az órák
	szinkronizálása.  Az olyan
	szolgáltatások, mint a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> is komolyan
	építkeznek a pontosan járó
	rendszerórára, amikor egy adott pillanatban kell
	lefuttatniuk parancsokat.</p><a id="idp98469200" class="indexterm"></a><p>A FreeBSD alapból az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> <acronym class="acronym">NTP</acronym> szervert tartalmazza, amellyel
	más <acronym class="acronym">NTP</acronym>
	szerverek segítségével tudjuk
	beállítani gépünk
	óráját, vagy éppen idõvel
	kapcsolatos információkat szolgáltatni
	másoknak.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98472784"></a>29.10.2. A megfelelõ NTP szerverek
	kiválasztása</h3></div></div></div><a id="idp98473424" class="indexterm"></a><p>Az óránk egyeztetéséhez egy vagy
	több <acronym class="acronym">NTP</acronym>
	szerverre lesz szükségünk.  Elõfordulhat,
	hogy a hálózati rendszergazdánk vagy az
	internet-szolgáltatónk már
	beállított egy ilyen szervert erre a célra.
	Ezzel kapcsolatban olvassuk el a megfelelõ
	leírásokat.  A <a class="link" href="http://ntp.isc.org/bin/view/Servers/WebHome" target="_top">nyilvánosan
	elérhetõ NTP szerverekrõl készült
	egy lista</a>, ahonnan könnyedén ki tudjuk
	keresni a számunkra leginkább megfelelõ
	(hozzánk legközelebbi) szervert.  Ne hagyjuk
	figyelmen kívül a szerverre vonatkozó
	házirendet és kérjünk engedélyt
	a használatához, amennyiben ez
	szükséges.</p><p>Több, egymással közvetlen kapcsolatban nem
	álló NTP szerver
	választásával járunk jól, ha
	netalán az egyikük váratlanul
	elérhetetlenné vagy az órája
	pontatlanná válna.  Az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> a visszakapott
	válaszokat intelligensen használja fel, mivel
	esetükben a megbízható szervereket
	részesíti elõnyben.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98477392"></a>29.10.3. A gépünk
	beállítása</h3></div></div></div><a id="idp98478032" class="indexterm"></a><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98479184"></a>29.10.3.1. Alapvetõ beállítások</h4></div></div></div><a id="idp98479824" class="indexterm"></a><p>Ha a számítógépünk
	  indításakor akarjuk egyeztetni az
	  óránkat, akkor erre az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> nevû
	  programot használhatjuk.  Ez olyan asztali gépek
	  számára megfelelõ választás,
	  amelyeket gyakran indítanak újra és csak
	  idõnként kell szinkronizálnunk.  A
	  legtöbb gépnek viszont az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a>
	  használatára van szüksége.</p><p>Az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> elindítása olyan
	  esetekben is hasznos, ahol az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> is fut.  Az
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> az órát fokozatosan
	  állítja, ellenben az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> az
	  eltérés mértékétõl
	  és irányától függetlenül
	  egyszerûen átállítja a gép
	  óráját a pontos idõre.</p><p>Az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> elindítását
	  úgy tudjuk engedélyezni a rendszer
	  indításakor, ha az
	  <code class="filename">/etc/rc.conf</code> állományba
	  berakjuk az <code class="literal">ntpdate_enable="YES"</code> sort.
	  Emellett még <code class="varname">ntpdate_flags</code>
	  változóban meg kell adnunk az alkalmazott
	  beállítások mellett azokat a szervereket,
	  amelyekkel szinkronizálni akarunk.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98488272"></a>29.10.3.2. Általános
	  beállítások</h4></div></div></div><a id="idp98497232" class="indexterm"></a><p>Az NTP az <code class="filename">/etc/ntp.conf</code>
	  állományon keresztül
	  állítható, amelyek
	  felépítését az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a>
	  man oldal tárgyalja.  Íme erre egy egyszerû
	  példa:</p><pre class="programlisting">server ntplocal.minta.com prefer
server timeserver.minta.org
server ntp2a.minta.net

driftfile /var/db/ntp.drift</pre><p>A <code class="literal">server</code> beállítás
	  adja meg az egyeztetéshez használt szervereket,
	  soronként egyet.  Ha egy szerver mellett szerepel
	  még a <code class="literal">prefer</code> paraméter is,
	  ahogy azt a példában a <code class="systemitem">ntplocal.minta.com</code> mellett
	  láthattuk, akkor a többivel szemben azt a szervert
	  fogjuk elõnyben részesíteni.  Az így
	  kiemelt szervertõl érkezõ választ
	  abban az esetben viszont eldobjuk, hogy a többi
	  szervertõl kapott válasz jelentõs
	  mértékben eltér tõle.  Minden
	  más esetben a õ válasza lesz a
	  mérvadó.  A <code class="literal">prefer</code>
	  paramétert általában olyan NTP
	  szerverekhez használják, amelyek
	  közismerten nagy pontosságúak, tehát
	  például külön erre a célra
	  szánt felügyeleti eszközt is
	  tartalmaznak.</p><p>A <code class="literal">driftfile</code>
	  beállítással azt az
	  állományt adjuk meg, amiben a rendszeróra
	  frekvencia eltolódásait tároljuk.  Az
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> program ezzel ellensúlyozza automatikusan
	  az óra természetes
	  elmászását, ezáltal
	  lehetõvé téve, hogy egy viszonylag pontos
	  idõt kapjuk még abban az esetben is, amikor egy
	  kis idõre külsõ idõforrások
	  nélkül maradnánk.</p><p>A <code class="literal">driftfile</code>
	  beállítással egyben azt az
	  állományt jelöljük ki, amely az NTP
	  szervertõl kapott korábbi válaszokat
	  tárolja.  Ez az NTP mûködéséhez
	  szükséges belsõ adatokat tartalmaz,
	  ezért semmilyen más programnak nem szabad
	  módosítania.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98505040"></a>29.10.3.3. A szerverünk elérésének
	  szabályozása</h4></div></div></div><p>Alapértelmezés szerint az NTP
	  szerverünket bárki képes elérni az
	  interneten.  Az <code class="filename">/etc/ntp.conf</code>
	  állományban szereplõ
	  <code class="literal">restrict</code> beállítás
	  segítségével azonban meg tudjuk mondani,
	  milyen gépek érhetik el a
	  szerverünket.</p><p>Ha az NTP szerverünk felé mindenféle
	  próbálkozást el akarunk utasítani,
	  akkor az <code class="filename">/etc/ntp.conf</code>
	  állományba a következõ sort kell
	  felvennünk:</p><pre class="programlisting">restrict default ignore</pre><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ezzel egyben azonban a helyi
	    beállításainkban szereplõ
	    szerverek elérését is
	    megakadályozzuk.  Ha külsõ NTP szerverekkel
	    is szeretnénk szinkronizálni, akkor itt is
	    engedélyezünk kell ezeket.  Errõl
	    bõvebben lásd az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a> man
	    oldalon.</p></div><p>Ha csak a belsõ hálózatunkban levõ
	  gépek számára szeretnénk
	  elérhetõvé tenni az órák
	  egyeztetését, de sem a szerver
	  állapotának
	  módosítását nem
	  engedélyezzük, sem pedig azt, hogy a vele
	  egyenrangú szerverekkel szinkronizáljon, akkor
	  az iménti helyett a</p><pre class="programlisting">restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</pre><p>sort írjuk bele, ahol a <code class="systemitem">192.168.1.0</code> a belsõ
	  hálózatunk IP-címe és a <code class="systemitem">255.255.255.0</code> a
	  hozzá tartozó hálózati
	  maszk.</p><p>Az <code class="filename">/etc/ntp.conf</code> több
	  <code class="literal">restrict</code> típusú
	  beállítást is tartalmazhat.  Ennek
	  részleteirõl az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a> man oldalon, az
	  <code class="literal">Access Control Support</code> címû
	  szakaszban olvashatunk.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98518736"></a>29.10.4. Az NTP futtatása</h3></div></div></div><p>Úgy tudjuk az NTP szervert elindítani a
	rendszerünkkel együtt, ha az
	<code class="filename">/etc/rc.conf</code> állományban
	szerepeltetjük az <code class="literal">ntpd_enable="YES"</code>
	sort.  Ha az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> számára további
	beállításokat is át akarunk adni,
	akkor az <code class="filename">/etc/rc.conf</code>
	állományban adjuk meg az
	<code class="varname">ntpd_flags</code> paramétert.</p><p>Ha a gépünk újraindítása
	nélkül akarjuk elindítani a szerver, akkor az
	<code class="command">ntpd</code> parancsot adjuk ki az
	<code class="filename">/etc/rc.conf</code> állományban a
	<code class="varname">ntpd_flags</code> változóhoz megadott
	paraméterekkel.  Mint például:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ntpd -p /var/run/ntpd.pid</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98524752"></a>29.10.5. Az ntpd használati idõleges internet
	csatlakozással</h3></div></div></div><p>Az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> program megfelelõ
	mûködéséhez nem szükséges
	állandó internet kapcsolat.  Ha azonban
	igény szerinti tárcsázással
	építjünk fel ideiglenes kapcsolatot, akkor
	érdemes letiltani az NTP forgalmát, nehogy
	feleslegesen aktiválja vagy tartsa életben a
	vonalat.  Ha PPP típusú kapcsolatunk van, akkor az
	<code class="filename">/etc/ppp/ppp.conf</code> állományban
	a <code class="literal">filter</code> direktívával tudjuk
	ezt leszabályozni.  Például:</p><pre class="programlisting"> set filter dial 0 deny udp src eq 123
 # Nem engedjük az NTP által küldött adatoknak, hogy tárcsázást
 # kezdeményezzenek:
 set filter dial 1 permit 0 0
 set filter alive 0 deny udp src eq 123
 # Nem engedjük az NTP adatainak, hogy fenntartsák a kapcsolatot:
 set filter alive 1 deny udp dst eq 123
 set filter alive 2 permit 0/0 0/0</pre><p>Mindenezekrõl részletesebb
	felvilágosítást a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> man oldal
	<code class="literal">PACKET FILTERING</code> címû
	szakaszában és a
	<code class="filename">/usr/share/examples/ppp/</code>
	könyvtárban található
	példákban kaphatunk.</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Egyes internet-szolgáltatók
	  blokkolják az alacsonyabb portokat, ezáltal az
	  NTP nem használható, mivel a válaszok nem
	  fogják elérni a gépünket.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98534736"></a>29.10.6. További olvasnivalók</h3></div></div></div><p>Az NTP szerver dokumentációja HTML
	formátumban a <code class="filename">/usr/share/doc/ntp/</code>
	könyvtárban található.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-samba.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="network-servers.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="network-syslogd.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">29.9. Állomány- és nyomtatási
      szolgáltatások <span class="trademark">Microsoft</span>(R) <span class="trademark">Windows</span>(R) kliensek
      számára (Samba) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 29.11. Távoli gépek naplózása
      <code class="command">syslogd</code> használatával</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>