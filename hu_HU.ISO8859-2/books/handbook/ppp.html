<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>27.3. A rendszerszintû PPP alkalmazása</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="ppp-and-slip.html" title="27. fejezet - A PPP és a SLIP" /><link rel="prev" href="userppp.html" title="27.2. A felhasználói PPP alkalmazása" /><link rel="next" href="ppp-troubleshoot.html" title="27.4. PPP kapcsolatok hibaelhárítása" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">27.3. A rendszerszintû PPP alkalmazása</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="userppp.html">Vissza</a> </td><th width="60%" align="center">27. fejezet - A PPP és a SLIP</th><td width="20%" align="right"> <a accesskey="n" href="ppp-troubleshoot.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ppp"></a>27.3. A rendszerszintû PPP alkalmazása</h2></div><div><span class="authorgroup">Egyes részeit készítette:
	    <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Sorokopud</span>, <span class="firstname">Gennady B.</span></span> és <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Huff</span>, <span class="firstname">Robert</span></span>. </span></div></div></div><div xmlns="" class="warning"><h3 class="admontitle">Figyelem: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ez a szakasz csak FreeBSD 7.<em class="replaceable"><code>X</code></em>
	esetén érvényes.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95532112"></a>27.3.1. A rendszerszintû PPP
	beállítása</h3></div></div></div><a id="idp95532752" class="indexterm"></a><p>Mielõtt a gépünkön nekikezdünk a
	PPP beállításának,
	ellenõrizzük, hogy a <code class="command">pppd</code>
	megtalálható a <code class="filename">/usr/sbin</code> könyvtárban
	és az <code class="filename">/etc/ppp</code>
	könyvtár létezik.</p><p>A <code class="command">pppd</code> két módban
	képes mûködni:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="quote">"<span class="quote">kliensként</span>"</span> - a
	    gépünket soros vonali vagy modemes PPP
	    kapcsolaton keresztül csatlakoztatjuk a
	    külvilághoz</p></li><li class="listitem"><p><span class="quote">"<span class="quote">szerverként</span>"</span> - a
	    számítógépünk egy
	    hálózat része, ahol a többieket a
	    PPP<a id="idp95538256" class="indexterm"></a> használatával kapcsoljuk össze</p></li></ol></div><p>Mind a két esetben egy konfigurációs
	állomány tartalmát kell
	összeállítanunk (ez az
	<code class="filename">/etc/ppp/options</code> vagy a
	<code class="filename">~/.ppprc</code>, ha a gépünkön
	több felhasználó is PPP-t akar
	használni).</p><p>Egy modemes vagy soros vonali szoftverre is
	szükségünk lesz (ez többnyire a <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/comms/kermit/pkg-descr">comms/kermit</a>), amellyel távoli
	gépeket tudunk felhívni és
	feléjük kapcsolatot felépíteni.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95541584"></a>27.3.2. A <code class="command">pppd</code> mint kliens</h3></div><div><span class="authorgroup">Az alapjául szolgáló
	      információkat adta: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Roydhouse</span>, <span class="firstname">Trev</span></span>. </span></div></div></div><a id="idp95544400" class="indexterm"></a><a id="idp95545552" class="indexterm"></a><p>A most következõ
	<code class="filename">/etc/ppp/options</code> állománnyal
	egy Cisco terminál szerverhez tudunk kapcsolódni
	egy PPP vonalon keresztül.</p><pre class="programlisting">crtscts         # a hardveres forgalomirányítás engedélyezése
modem           # modem vezérlõvonal
noipdefault     # a távoli PPP szervernek kell IP-címet adnia
                # ha az IPCP alapú egyeztetés során a távoli gép nem küld
                # nekünk IP-címet, akkor vegyük ki ezt a beállítást
passive         # LCP csomagokat várunk
domain ppp.ize.com      # ide írjuk be a hálózati nevünket

:<em class="replaceable"><code>távoli_ip</code></em>    # ide kell írni a távoli PPP szerver IP-címét
                # a PPP kapcsolaton keresztül erre fogjuk továbbküldeni a csomagokat
                # ha nem adtuk meg "noipdefault" beállítást, akkor ezt a sort
                # írjuk át <em class="replaceable"><code>helyi_ip</code></em>:<em class="replaceable"><code>távoli_ip</code></em> alakúra

defaultroute    # adjuk meg ezt a sort is, ha a PPP szerverünket egyben az
                # alapértelmezett átjárónak is be akarjuk állítani</pre><p>Így kapcsolódunk:</p><a id="idp95548880" class="indexterm"></a><a id="idp95549392" class="indexterm"></a><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Tárcsázzuk a távoli gépet a
	    <span class="application">Kermit</span> (vagy bármilyen
	    más modemes program)
	    elindításával, majd adjuk meg a
	    felhasználói nevünket és
	    jelszavunkat (vagy bármi mást, amivel a
	    távoli gépen engedélyezni tudjuk a PPP
	    használatát).</p></li><li class="step"><p>Lépjünk ki a
	    <span class="application">Kermit</span> programból
	    (anélkül, hogy bontanánk a
	    vonalat).</p></li><li class="step"><p>Írjuk be a következõket:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/sbin/pppd /dev/tty01 19200</code></strong></pre><p>Ne felejtsük el megadni a megfelelõ
	    sebességet és eszközt.</p></li></ol></div><p>A számítógépünk most
	már PPP-n keresztül csatlakozik.  Ha valamilyen
	okból nem sikerülne felépíteni a
	kapcsolatot, akkor vegyük fel a <code class="option">debug</code>
	beállítást is az
	<code class="filename">/etc/ppp/options</code> állományba,
	majd a konzolra érkezõ üzenetek
	segítségével próbáljuk meg
	felderíteni a probléma okát.</p><p>Az alábbi <code class="filename">/etc/ppp/pppup</code> szkript
	mind a három fázist automatikussá
	teszi:</p><pre class="programlisting">#!/bin/sh
pgrep -l pppd
pid=`pgrep pppd`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
pgrep -l kermit
pid=`pgrep kermit`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.dial
pppd /dev/tty01 19200</pre><a id="idp95561296" class="indexterm"></a><p>Az <code class="filename">/etc/ppp/kermit.dial</code> egy olyan
	<span class="application">Kermit</span> szkript, amivel
	tárcsázni tudunk és a távoli
	gépen elvégezni az összes
	szükséges hitelesítést (a
	leírás végén találhatunk is
	egy ilyen szkriptet példaként).</p><p>Az alábbi <code class="filename">/etc/ppp/pppdown</code>
	szkripttel tudjuk bontani a PPP vonalat:</p><pre class="programlisting">#!/bin/sh
pid=`pgrep pppd`
if [ X${pid} != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill -TERM ${pid}
fi

pgrep -l kermit
pid=`pgrep kermit`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

/sbin/ifconfig ppp0 down
/sbin/ifconfig ppp0 delete
kermit -y /etc/ppp/kermit.hup
/etc/ppp/ppptest</pre><p>A <code class="filename">/usr/etc/ppp/ppptest</code>
	elindításával ellenõrizni tudjuk, hogy
	a <code class="command">pppd</code> még mindig fut.  Ez valahogy
	így néz ki:</p><pre class="programlisting">#!/bin/sh
pid=`pgrep pppd`
if [ X${pid} != "X" ] ; then
        echo 'pppd running: PID=' ${pid-NONE}
else
        echo 'No pppd running.'
fi
set -x
netstat -n -I ppp0
ifconfig ppp0</pre><p>A vonal bontásához az
	<code class="filename">/etc/ppp/kermit.hup</code> szkriptet kell
	elindítanunk, amiben a következõ
	szerepelnek:</p><pre class="programlisting">set line /dev/tty01	; ide írjuk be a saját modemünket
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
echo \13
exit</pre><p>A <code class="command">kermit</code> helyett a
	<code class="command">chat</code> programot is
	használhatjuk:</p><p>A következõ két állomány
	már elég egy kapcsolat
	létrehozásához <code class="command">pppd</code>
	használatával:</p><p><code class="filename">/etc/ppp/options</code>:</p><pre class="programlisting">/dev/cuad1 115200

crtscts		# a hardveres forgalomirányítás engedélyezése
modem		# modemes vezérlõvonal
connect "/usr/bin/chat -f /etc/ppp/login.chat.script"
noipdefault	# a távoli PPP kiszolgálónak adnia kell egy IP-címet
	        # ha a távoli gép nem küldi az IP-címünk az IPCP alapú egyeztetés során
                # akkor távolítsuk el ezt a beállítást
passive         # LCP csomagokat várunk
domain <em class="replaceable"><code>sajat.tartomany</code></em>	# ide írjuk be a saját tartománynevünket

:		# a távoli PPP kiszolgáló IP-címét tegyük ide
	        # ezen keresztül fogjuk továbbküldeni a PPP kapcsolaton áthaladó csomagokat
                # nem adtuk meg a "noipdefault" beállítást, akkor ezt
                # sort írjuk át <em class="replaceable"><code>helyi_ip</code></em>:<em class="replaceable"><code>távoli_ip</code></em> alakúra

defaultroute	# ez a sor akkor kell, ha a PPP szerver lesz az
	        # alapértelmezett átjárónk is</pre><p><code class="filename">/etc/ppp/login.chat.script</code>:</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">A most következõt egyetlen sorba kell
	  írnunk.</p></div><pre class="programlisting">ABORT BUSY ABORT 'NO CARRIER' "" AT OK ATDT<em class="replaceable"><code>telefon.szám</code></em>
  CONNECT "" TIMEOUT 10 ogin:-\\r-ogin: <em class="replaceable"><code>bejelentkezési-azonosító</code></em>
  TIMEOUT 5 sword: <em class="replaceable"><code>jelszó</code></em></pre><p>Miután ezeket telepítettük és a
	megfelelõképpen módosítottuk,
	már csak a <code class="command">pppd</code> parancsot kell
	kiadnunk, valahogy így:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pppd</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95579728"></a>27.3.3. A <code class="command">pppd</code> mint szerver</h3></div></div></div><p>Az <code class="filename">/etc/ppp/options</code>
	állományban nagyjából a
	következõknek kell szerepelnie:</p><pre class="programlisting">crtscts                         # hardveres forgalomirányítás
netmask 255.255.255.0           # hálózati maszk (nem kötelezõ)
192.114.208.20:192.114.208.165  # a helyi és távoli gépek IP-címei
                                # a helyi IP-nek el kell térnie az Ethernet
                                # (vagy más egyéb) felülethez tartozó címtõl.
                                # a távoli IP a távoli géphez rendelt IP-cím
domain ppp.ize.com              # a saját tartományunk
passive                         # az LCP csomagok várása
modem                           # modemes vonal</pre><p>Az alábbi <code class="filename">/etc/ppp/pppserv</code>
	szkript a <span class="application">pppd</span> démont
	szervernek állítja be:</p><pre class="programlisting">#!/bin/sh
pgrep -l pppd
pid=`pgrep pppd`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
pgrep -l kermit
pid=`pgrep kermit`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

# reset ppp interface
ifconfig ppp0 down
ifconfig ppp0 delete

# enable autoanswer mode
kermit -y /etc/ppp/kermit.ans

# run ppp
pppd /dev/tty01 19200</pre><p>A szerver leállítására a
	következõ <code class="filename">/etc/ppp/pppservdown</code>
	szkriptet kell használnunk:</p><pre class="programlisting">#!/bin/sh
pgrep -l pppd
pid=`pgrep pppd`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
pgrep -l kermit
pid=`pgrep kermit`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi
ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.noans</pre><p>A következõ <span class="application">Kermit</span>
	szkript (<code class="filename">/etc/ppp/kermit.ans</code>)
	engedélyezi vagy tiltja le a modem automatikus
	válaszadását.  Körülbelül
	így épül fel:</p><pre class="programlisting">set line /dev/tty01
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
inp 5 OK
echo \13
out ATS0=1\13   ; "ATS0=0\13"-ra írjuk át, ha le akarjuk tiltani az
                ; automatikus válaszadást
inp 5 OK
echo \13
exit</pre><p>Az <code class="filename">/etc/ppp/kermit.dial</code>
	elnevezésû szkriptet használhatjuk arra, hogy
	tárcsázzunk távoli gépeket és
	hitelesítsük magunkat rajtuk.  Írjuk
	át az igényeinknek megfelelõen, tegyük
	bele a bejelentkezéshez szükséges
	azonosítót és jelszót, illetve a
	modemünk és a távoli gép
	válaszai szerint módosítsuk az
	<code class="literal">input</code> utasításokat.</p><pre class="programlisting">;
; írjuk ide azt a com vonalat, amire a modemünk csatlakozik:
;
set line /dev/tty01
;
; ide kerül a modem sebessége:
;
set speed 19200
set file type binary            ; teljes 8 bites állomány-átvitel
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none
set modem hayes
set dial hangup off
set carrier auto                ; adjuk meg a SET CARRIER utasítást is, ha kell
set dial display on             ; adjuk meg a SET DIAL utasítást is, ha kell
set input echo on
set input timeout proceed
set input case ignore
def \%x 0                       ; a bejelentkezés számlálója
goto slhup

:slcmd                          ; tegyük a modemet parancs módba
echo Tegyuk a modemet parancs modba.
clear                           ; töröljük a be nem olvasott karaktereket a bemeneti pufferbõl
pause 1
output +++                      ; a Hayes-féle helyettesítési szekvenciák használata
input 1 OK\13\10                ; várjuk meg az OK jelzést
if success goto slhup
output \13
pause 1
output at\13
input 1 OK\13\10
if fail goto slcmd              ; ha a modem nem válaszol OK-val, akkor próbálkozzunk újra

:slhup                          ; bontsuk a vonalat
clear                           ; töröljük ki a be nem olvasott karaktereket a bemeneti pufferbõl
pause 1
echo A vonal bontasa.
output ath0\13                  ; a kapcsolat létrejöttét jelzõ Hayes-parancs
input 2 OK\13\10
if fail goto slcmd              ; ha nincs OK válasz, akkor tegyük a modemet parancs módba

:sldial                         ; tárcsázzuk a számot
pause 1
echo Dialing.
output atdt9,550311\13\10       ; ide írjuk a telefonszámot
assign \%x 0                    ; nullázzuk le az idõzítõt

:look
clear                           ; töröljük az olvasatlan karaktereket a bemeneti pufferbõl
increment \%x                   ; számoljuk a másodperceket
input 1 {CONNECT }
if success goto sllogin
reinput 1 {NO CARRIER\13\10}
if success goto sldial
reinput 1 {NO DIALTONE\13\10}
if success goto slnodial
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if &lt; \%x 60 goto look
else goto slhup

:sllogin                        ; bejelentkezés
assign \%x 0                    ; nullázzuk le az idõzítõt
pause 1
echo A bejelentkezes keresese.

:slloop
increment \%x                   ; számoljuk a másodperceket
clear                           ; töröljük az olvasatlan karaktereket a bemeneti pufferbõl
output \13
;
; ide írjuk be a várható bejelentkezési sablont:
;
input 1 {Felhasznaloi nev: }
if success goto sluid
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if &lt; \%x 10 goto slloop      ; tízszer próbálkozzunk a bejelentkezéssel
else goto slhup                 ; 10 sikertelen próbálkozás után bontsuk a vonalat és kezdjük újra

:sluid
;
; ide írjuk be a felhasználói azonosítónkat:
;
output ppp-login\13
input 1 {Jelszo: }
;
; ide tegyük a hozzá tartozó jelszót:
;
output ppp-password\13
input 1 {Atvaltas SLIP modba.}
echo
quit

:slnodial
echo \7Nincs vonal.  Ellenorizzuk a telefonvonalat!\7
exit 1

; local variables:
; mode: csh
; comment-start: "; "
; comment-start-skip: "; "
; end:</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="userppp.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="ppp-and-slip.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="ppp-troubleshoot.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">27.2. A felhasználói PPP alkalmazása </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 27.4. <acronym class="acronym">PPP</acronym> kapcsolatok
      hibaelhárítása</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>