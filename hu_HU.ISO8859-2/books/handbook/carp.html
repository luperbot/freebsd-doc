<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>31.13. A Közös cím redundancia protokoll (CARP)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="advanced-networking.html" title="31. fejezet - Egyéb haladó hálózati témák" /><link rel="prev" href="network-atm.html" title="31.12. Az Aszinkron adatátviteli mód (ATM)" /><link rel="next" href="appendices.html" title="V. rész - Függelék" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.13. A Közös cím redundancia protokoll
      (CARP)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-atm.html">Vissza</a> </td><th width="60%" align="center">31. fejezet - Egyéb haladó hálózati
    témák</th><td width="20%" align="right"> <a accesskey="n" href="appendices.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="carp"></a>31.13. A Közös cím redundancia protokoll
      (CARP)</h2></div><div><span class="authorgroup">Írta: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Rhodes</span>, <span class="firstname">Tom</span></span>. </span></div></div></div><a id="idp101425232" class="indexterm"></a><a id="idp101425744" class="indexterm"></a><p>A Közös cím redundancia protokoll (Common
      Address Redundancy Protocol, avagy <acronym class="acronym">CARP</acronym>)
      segítségével több gép
      képes egyazon <acronym class="acronym">IP</acronym>-címen osztozni.
      Bizonyos konfigurációkban ez a terhelés
      elosztására
      (terhelés-kiegyenlítésre) vagy a
      rendelkezésre állás
      növelésére (hibatûrésre)
      alkalmazható.  A benne szereplõ gépek
      akár eltérõ <acronym class="acronym">IP</acronym>-címmel
      is rendelkezhetnek, ahogy azt majd a példában is
      láthatjuk.</p><p>A <acronym class="acronym">CARP</acronym> támogatásának
      engedélyezéséhez a FreeBSD rendszermagját
      a következõ beállítással kell
      újrafordítanunk:</p><pre class="programlisting">device	carp</pre><p>A <acronym class="acronym">CARP</acronym> által biztosított
      lehetõségek ezután már
      elérhetõek, és számos
      <code class="command">sysctl</code> változón keresztül
      állíthatóak:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Változó</th><th>Leírás</th></tr></thead><tbody><tr><td><code class="varname">net.inet.carp.allow</code></td><td>A beérkezõ <acronym class="acronym">CARP</acronym>
	      csomagok elfogadása.  Alapértelmezés
	      szerint engedélyezett.</td></tr><tr><td><code class="varname">net.inet.carp.preempt</code></td><td>Ezzel a beállítással az adott
	      gépen az összes <acronym class="acronym">CARP</acronym>
	      felület leáll, ha közülük
	      bármelyik is
	      mûködésképtelenné
	      válik.  Alapértelmezés szerint
	      tiltott.</td></tr><tr><td><code class="varname">net.inet.carp.log</code></td><td>A <code class="literal">0</code> értékkel
	      kikapcsoljuk a naplózást.  Az
	      <code class="literal">1</code> értékkel a rossz
	      <acronym class="acronym">CARP</acronym> csomagok
	      naplózását engedélyezzük.
	      Az ettõl nagyobb értékek esetén
	      pedig a <acronym class="acronym">CARP</acronym> felületek
	      változásait naplózzuk.  Az
	      alapértelmezett értéke az
	      <code class="literal">1</code>.</td></tr><tr><td><code class="varname">net.inet.carp.arpbalance</code></td><td>Az <acronym class="acronym">ARP</acronym> protokoll
	      segítségével próbálja
	      meg a helyi hálózati forgalmat
	      mentesíteni a terheléstõl.
	      Alapértelmezés szerint tiltott.</td></tr><tr><td><code class="varname">net.inet.carp.suppress_preempt</code></td><td>Ez a változó
	      írásvédett, és a
	      megszakítás elnyomásának
	      állapotát mutatja.  A
	      megszakítás elnyomható, ha a
	      felület egyik linkje nem mûködik.  A
	      <code class="literal">0</code> érték arra utal, hogy a
	      megszakítást nem nyomták el.  Minden
	      probléma növeli ennek a
	      változónak az
	      értékét.</td></tr></tbody></table></div><p>A <acronym class="acronym">CARP</acronym> eszközök maguk az
      <code class="command">ifconfig</code> paranccsal
      készíthetõek el:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig carp0 create</code></strong></pre><p>Egy valós környezetben az ilyen felületeknek
      egy <acronym class="acronym">VHID</acronym> néven ismert egyedi
      azonosítóval kell rendelkezniük.  Ez a
      <acronym class="acronym">VHID</acronym> vagy más néven a
      virtuális gépazonosító (azaz Virtual
      Host Identification) fogja a gépünket a
      hálózat többi elemétõl
      megkülönböztetni.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp101451216"></a>31.13.1. A CARP felhasználása a rendelkezésre
	állás javításában</h3></div></div></div><p>A <acronym class="acronym">CARP</acronym> használatának egyik
	módja, ahogy arra már korábban is utaltunk,
	a szerverek rendelkezésre állásának
	feljavítása.  Ebben a példában
	három géppel fogunk hibatûrést
	biztosítani, melyik mindegyike egyedi
	<acronym class="acronym">IP</acronym>-címmel rendelkezik és
	ugyanazt a webes tartalmat szolgáltatják.  A
	gépeket egy Round Robin rendszerû
	(körbejáró) névfeloldással
	együtt használjuk.  A tartalék
	gépünknek lesz még további két
	<acronym class="acronym">CARP</acronym> felülete, külön a szerver
	<acronym class="acronym">IP</acronym>-címeihez tartozó egyes webes
	tartalmakhoz.  Amikor valami meghibásodik, a
	tartalék szerver átveszi a meghibásodott
	gép <acronym class="acronym">IP</acronym>-címét.  Ilyenkor
	a hiba teljesen észrevétlen marad a
	felhasználók számára.  A
	tartalék szerveren a többi szerverrel egyezõ
	tartalomnak és szolgáltatásoknak kell
	megjelennie, hogy bármikor át tudja
	tõlük venni a forgalmat.</p><p>A hálózati neveiktõl és a
	virtuális azonosítóiktól eltekintve
	a két gépet ugyanúgy kell
	beállítani.  Ebben a példában a
	gépeket most az <code class="systemitem">a-gep.minta.org</code>
	és <code class="systemitem">b-gep.minta.org</code> nevekkel
	láttuk el.  Elõször is a
	<acronym class="acronym">CARP</acronym>
	beállításához el kell
	helyeznünk a megfelelõ hivatkozásokat az
	<code class="filename">rc.conf</code> állományban.  Az
	<code class="systemitem">a-gep.minta.org</code> esetében az
	<code class="filename">rc.conf</code> állomány a
	következõ sorokat tartalmazza:</p><pre class="programlisting">hostname="a-gep.minta.org"
ifconfig_fxp0="inet 192.168.1.3 netmask 255.255.255.0"
cloned_interfaces="carp0"
ifconfig_carp0="vhid 1 pass testpass 192.168.1.50/24"</pre><p>Miközben a <code class="systemitem">b-gep.minta.org</code> az
	<code class="filename">rc.conf</code> állományában
	ezeket adjuk meg:</p><pre class="programlisting">hostname="b-gep.minta.org"
ifconfig_fxp0="inet 192.168.1.4 netmask 255.255.255.0"
cloned_interfaces="carp0"
ifconfig_carp0="vhid 2 pass testpass 192.168.1.51/24"</pre><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Nagyon fontos, hogy az <code class="command">ifconfig</code> parancs
	  <code class="literal">pass</code> paraméterével megadott
	  jelszavak megegyezzenek.  A <code class="filename">carp</code>
	  eszközök csak a megfelelõ jelszót
	  birtokló gépeket fogadják el.  A
	  virtuális gépazonosítónak azonban
	  minden esetben el kell térnie.</p></div><p>A harmadik, <code class="systemitem">szolgaltato.minta.org</code>
	címmel rendelkezõ gépet fogjuk
	felkészíteni az elõbbi gépek
	meghibásodására felkészíteni.
	Ennek a gépnek két <code class="filename">carp</code>
	eszközre lesz szüksége, melyek az egyes
	gépeket kezelik.  Az ehhez illeszkedõ sorok valahogy
	így fognak kinézni az <code class="filename">rc.conf</code>
	állományban:</p><pre class="programlisting">hostname="szolgaltato.minta.org"
ifconfig_fxp0="inet 192.168.1.5 netmask 255.255.255.0"
cloned_interfaces="carp0 carp1"
ifconfig_carp0="vhid 1 advskew 100 pass testpass 192.168.1.50/24"
ifconfig_carp1="vhid 2 advskew 100 pass testpass 192.168.1.51/24"</pre><p>Két <code class="filename">carp</code> eszköz
	használatával a
	<code class="systemitem">szolgaltato.minta.org</code> képes
	észlelni és átvenni bármelyik olyan
	gép <acronym class="acronym">IP</acronym>-címét, amely nem
	válaszol.</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Az alap FreeBSD rendszermag használata esetén
	  <span class="emphasis"><em>elõfordulhat</em></span>, hogy a
	  megszakítás (a <span class="quote">"<span class="quote">preemption</span>"</span>
	  opció) engedélyezett.  Amennyiben így
	  lenne, a <code class="systemitem">szolgaltato.minta.org</code> nem fogja
	  minden esetben fogja rendesen visszaadni az
	  <acronym class="acronym">IP</acronym>-címet az eredeti
	  tulajdonosának.  Ilyenkor a rendszergazdának
	  kell ezt manuálisan megtennie.  Tehát a
	  következõ parancsot kell kiadnia a
	  <code class="systemitem">szolgaltato.minta.org</code> gépen:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig carp0 down &amp;&amp; ifconfig carp0 up</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">Ezt az adott géphez tartozó
	  <code class="filename">carp</code> felülettel kell
	  megcsinálni.</p></div><p>Innentõl a <acronym class="acronym">CARP</acronym> már teljesen
	engedélyezhetõ és készen áll a
	tesztelésre.  A teszteléshez vagy a
	hálózati rendszert kell
	újraindítani, vagy a gépeket.</p><p>További információkat a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=carp&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">carp</span>(4)</span></a>
	man oldalán találhatunk.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-atm.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="appendices.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">31.12. Az Aszinkron adatátviteli mód (ATM) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> V. rész - Függelék</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>