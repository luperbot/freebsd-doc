<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>30.4. Az OpenBSD csomagszûrõje (PF) és az ALTQ</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="firewalls.html" title="30. fejezet - Tûzfalak" /><link rel="prev" href="firewalls-apps.html" title="30.3. Tûzfalak" /><link rel="next" href="firewalls-ipf.html" title="30.5. Az IPFILTER (IPF) tûzfal" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">30.4. Az OpenBSD csomagszûrõje (PF) és az
      <acronym class="acronym">ALTQ</acronym></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="firewalls-apps.html">Vissza</a> </td><th width="60%" align="center">30. fejezet - Tûzfalak</th><td width="20%" align="right"> <a accesskey="n" href="firewalls-ipf.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-pf"></a>30.4. Az OpenBSD csomagszûrõje (PF) és az
      <acronym class="acronym">ALTQ</acronym></h2></div><div><span class="authorgroup">Átnézte és
	    aktualizálta:<span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Ferrell</span>, <span class="firstname">John</span></span>. </span></div></div></div><a id="idp98616912" class="indexterm"></a><p>2003 júliusában az OpenBSD <acronym class="acronym">PF</acronym>
      néven ismert csomagszûrõjét
      átírták FreeBSD-re és
      elérhetõvé tették a FreeBSD
      Portgyûjteményének részeként.  A
      <acronym class="acronym">PF</acronym> programot beépítetten
      tartalmazó elsõ kiadás pedig 2004
      novemberében a FreeBSD 5.3 volt.  A <acronym class="acronym">PF</acronym>
      egy teljes, mindentudó tûzfal, amely támogatja
      az ún.  <acronym class="acronym">ALTQ</acronym> (Alternate Queuing, vagyis
      a <span class="quote">"<span class="quote">váltóbesorolás</span>"</span>)
      megoldást.  Az <acronym class="acronym">ALTQ</acronym> lehetõvé
      teszi a sávszélesség
      korlátozását a szolgáltatás
      minõsége (Quality of Service, <acronym class="acronym">QoS</acronym>)
      alapján.</p><p>Az OpenBSD Projekt kiváló munkát
      végez a PF <a class="link" href="http://www.openbsd.org/faq/pf/" target="_top">felhasználói
	útmutatójának</a>
      karbantartásával.  A kézikönyv ezen
      szakasza ezért elsõsorban azzal foglalkozik, hogyan
      kell a <acronym class="acronym">PF</acronym>-et FreeBSD alatt használni,
      miközben igyekszik egy általános
      összefoglalást adni a témáról.  A
      részletesebb információkkal kapcsolatban
      azonban feltétlenül nézzük meg a
      felhasználói útmutatót.</p><p>A <code class="uri"><a class="uri" href="http://pf4freebsd.love2party.net/" target="_top">http://pf4freebsd.love2party.net/</a></code>
      címen olvashatunk többet arról (angolul), hogy
      a <acronym class="acronym">PF</acronym>-et hogyan használjunk
      FreeBSD-n.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98623696"></a>30.4.1. A PF rendszermagmodulok használata</h3></div></div></div><p>A <acronym class="acronym">PF</acronym> modul
	betöltéséhez a következõ sort kell
	felvennünk az <code class="filename">/etc/rc.conf</code>
	állományba:</p><pre class="programlisting">pf_enable="YES"</pre><p>Ezt követõen futtassuk le a
	hozzá tartozó rendszerindító
	szkriptet:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/pf start</code></strong></pre><p>A <acronym class="acronym">PF</acronym> modul abban az esetben nem fog
	betöltõdni, ha nem találja a szabályokat
	tartalmazó konfigurációs
	állományt.  Ez alapértelmezés
	szerint az <code class="filename">/etc/pf.conf</code>
	állomány.  Ha a szabályok
	leírása rendszerünkön máshol
	található, akkor az
	<code class="filename">/etc/rc.conf</code> állományban a
	következõ módon adhatjuk meg annak pontos
	helyét:</p><pre class="programlisting">pf_rules="<em class="replaceable"><code>/elérési/út/pf.conf</code></em>"</pre><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">A FreeBSD 7.0 kiadással a minta
	  <code class="filename">pf.conf</code> állomány az
	  <code class="filename">/etc</code>
	  könyvtárból átkerült a
	  <code class="filename">/usr/share/examples/pf</code>
	  könyvtárba.  A FreeBSD 7.0 elõtti
	  kiadásokban alapértelmezés szerint
	  található egy <code class="filename">pf.conf</code>
	  állomány az <code class="filename">/etc</code>
	  könyvtárban.</p></div><p>A <acronym class="acronym">PF</acronym> modul parancssorból
	akár kézzel is betölthetõ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload pf.ko</code></strong></pre><p>A <acronym class="acronym">PF</acronym> mûködésének
	naplózását a <code class="literal">pflog.ko</code>
	teszi lehetõvé, amelyet az alábbi sor
	hozzáadásával engedélyezhetünk
	az <code class="filename">/etc/rc.conf</code>
	állományban:</p><pre class="programlisting">pflog_enable="YES"</pre><p>A modul betöltését a
	hozzá tartozó rendszerindító szkript
	segítségével kérhetjük:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/pflog start</code></strong></pre><p>Ha a <acronym class="acronym">PF</acronym> többi
	funkcióját is használni szeretnénk,
	akkor ehhez egy új rendszermagot kell fordítanunk
	<acronym class="acronym">PF</acronym> támogatással.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98646736"></a>30.4.2. A PF rendszermagbeli
	beállításai</h3></div></div></div><a id="idp98647376" class="indexterm"></a><a id="idp98648656" class="indexterm"></a><a id="idp98649808" class="indexterm"></a><p>Noha egyáltalán nem szükséges
	beépítenünk a <acronym class="acronym">PF</acronym>
	támogatását a rendszermagba, abban az
	esetben mégis szükségünk lehet
	rá, amikor a <acronym class="acronym">PF</acronym> olyan komolyabb
	lehetõségeit szeretnénk kiaknázni,
	amelyek már nem részei a modulnak.  Ilyen
	például a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pfsync&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pfsync</span>(4)</span></a>, amely a
	<acronym class="acronym">PF</acronym> által használt
	állapottáblázatok bizonyos
	változásainak megjelenítésére
	alkalmas pszeudoeszköz.  A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=carp&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">carp</span>(4)</span></a>
	megoldásával párosítva így
	akár hibatûrõ tûzfalak is
	kialakíthatóak a <acronym class="acronym">PF</acronym>-fel.  A
	<acronym class="acronym">CARP</acronym> megoldásáról a
	kézikönyvben bõvebb ismertetést a <a class="xref" href="carp.html" title="31.13. A Közös cím redundancia protokoll (CARP)">31.13. szakasz - A Közös cím redundancia protokoll
      (CARP)</a> ad.</p><p>A <acronym class="acronym">PF</acronym> rendszermag
	konfigurációs beállításai a
	<code class="filename">/usr/src/sys/conf/NOTES</code>
	állományban találhatóak:</p><pre class="programlisting">device pf
device pflog
device pfsync</pre><p>A <code class="literal">device pf</code>
	beállítás engedélyezi a
	csomagszûrõ tûzfalat (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pf</span>(4)</span></a>).</p><p>A <code class="literal">device pflog</code> megadásával
	keletkezik egy <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pflog&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pflog</span>(4)</span></a> pszeudo hálózati
	eszköz, amellyel egy <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> eszközre
	érkezõ forgalmat tudunk naplózni.
	Ezután a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pflogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pflogd</span>(8)</span></a> démon
	használható tõle származó
	naplózott adatok
	rögzítésére.</p><p>A <code class="literal">device pfsync</code> engedélyezi a
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pfsync&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pfsync</span>(4)</span></a> pszeudo hálózati eszköz
	létrejöttét, amely az ún.
	<span class="quote">"<span class="quote">állapotváltások</span>"</span>
	megfigyelésére alkalmas.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98676304"></a>30.4.3. Az <code class="filename">rc.conf</code> állományban
	elérhetõ beállítások</h3></div></div></div><p>A következõ <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>
	beállítások aktiválják a
	rendszerindítás során a
	<acronym class="acronym">PF</acronym> és a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pflog&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pflog</span>(4)</span></a>
	használatát:</p><pre class="programlisting">pf_enable="YES"                 # a PF engedélyezése (a modul betöltése, ha kell)
pf_rules="/etc/pf.conf"         # a pf szabályait tartalmazó állomány
pf_flags=""                     # a pfctl indításához szükséges további paraméterek
pflog_enable="YES"              # a pflogd(8) elindítása
pflog_logfile="/var/log/pflog"  # hol tartsa a pflogd az naplóit
pflog_flags=""                  # a pflogd indításához szükséges paraméterek</pre><p>Ha a tûzfalunk mögött egy helyi
	hálózat is meghúzódik, akkor az ott
	levõ gépek számára valamilyen
	módon tudnunk kell továbbítani a csomagokat
	vagy címfordítást kell végezni,
	így ez is mindenképpen kelleni fog:</p><pre class="programlisting">gateway_enable="YES"            # az átjáró funkciók engedélyezése</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98693456"></a>30.4.4. A szûrési szabályok
	megfogalmazása</h3></div></div></div><p>A <acronym class="acronym">PF</acronym> a beállításait
	a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pf.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">pf.conf</span>(5)</span></a> állomány tárolja (amely
	alapértelmezés szerint az
	<code class="filename">/etc/pf.conf</code> helyen
	található), és az ebben
	található szabályok alapján
	módosítja, dobja el vagy éppen engedi
	át a csomagokat.  A FreeBSD rendszerünkben ehhez
	találhatunk néhány példát a
	<code class="filename">/usr/share/examples/pf/</code>
	könyvtárban.  A <acronym class="acronym">PF</acronym> által
	használt szabályokról minden
	részletre kiterjedõen a PF <a class="link" href="http://www.openbsd.org/faq/pf/" target="_top">felhasználói
	  útmutatójában</a> olvashatunk.</p><div xmlns="" class="warning"><h3 class="admontitle">Figyelem: </h3><p xmlns="http://www.w3.org/1999/xhtml">A PF <a class="link" href="http://www.openbsd.org/faq/pf/" target="_top">felhasználói
	    útmutatójának</a>
	  olvasásakor ne feledkezzünk meg róla, hogy
	  a különbözõ FreeBSD verziók
	  különbözõ <acronym class="acronym">PF</acronym>
	  verziókat tartalmaznak.  A
	  FreeBSD 7.<em class="replaceable"><code>X</code></em> és
	  késõbbi változatok az OpenBSD 4.1
	  kiadásában szereplõ <acronym class="acronym">PF</acronym>
	  változatot tartalmazzák.</p></div><p>A <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-pf" target="_top">FreeBSD packet filter levelezési lista</a> remek hely a <acronym class="acronym">PF</acronym> tûzfal
	beállításával és
	futtatásával kapcsolatos kérdésekre.
	A kérdezés elõtt azonban ne felejtsük el
	alaposan átnézni az archívumot!</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98705360"></a>30.4.5. A PF használata</h3></div></div></div><p>A <acronym class="acronym">PF</acronym> a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pfctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pfctl</span>(8)</span></a>
	segítségével vezérelhetõ.  Az
	alábbiakban ezzel kapcsolatban most összefoglalunk
	néhány hasznos parancsot (de ne felejtsük el
	megnézni a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pfctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pfctl</span>(8)</span></a> man oldalon
	található többi lehetõséget
	sem):</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Parancs</th><th>Leírás</th></tr></thead><tbody><tr><td><code class="command">pfctl -e</code></td><td>A PF engedélyezése</td></tr><tr><td><code class="command">pfctl -d</code></td><td>A PF tiltása</td></tr><tr><td><code class="command">pfctl -F all -f /etc/pf.conf</code></td><td>Az összes (címfordítási,
		szûrési, állapottartási stb.)
		szabály törlése, és az
		<code class="filename">/etc/pf.conf</code> állomány
		újratöltése</td></tr><tr><td><code class="command">pfctl -s [ rules | nat | state ]</code></td><td>A szûrési (<code class="literal">rules</code>),
		címfordítási
		(<code class="literal">nat</code>) és
		állapottartási (<code class="literal">state</code>)
		információk
		lekérdezése</td></tr><tr><td><code class="command">pfctl -vnf /etc/pf.conf</code></td><td>Az <code class="filename">/etc/pf.conf</code>
		állomány ellenõrzése a benne
		levõ szabályok betöltése
		nélkül</td></tr></tbody></table></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98748752"></a>30.4.6. Az <acronym class="acronym">ALTQ</acronym>
	engedélyezése</h3></div></div></div><p>Az <acronym class="acronym">ALTQ</acronym> kizárólag csak
	úgy használható, ha a
	konfigurációs beállításokon
	keresztül beépítjük a FreeBSD
	rendszermagjába.  Az <acronym class="acronym">ALTQ</acronym>
	alkalmazását nem minden hálózati
	kártya meghajtója támogatja, ezért
	ezt a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=altq&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">altq</span>(4)</span></a> man oldalon ellenõrizzük.</p><p>A következõ rendszermag
	konfigurációs beállításokkal
	engedélyezhetjük az <acronym class="acronym">ALTQ</acronym>
	használatát és bõvíthetjük
	azt további lehetõségekkel:</p><pre class="programlisting">options         ALTQ
options         ALTQ_CBQ        # osztályozás alapú besorolás (Class Bases Queuing, CBQ)
options         ALTQ_RED        # véletlen korai észlelés (Random Early Detection, RED)
options         ALTQ_RIO        # RED befele/kifele
options         ALTQ_HFSC       # hiearchikus csomagütemezõ (Hierarchical Packet Scheduler, HFSC)
options         ALTQ_PRIQ       # prioritásos besorolás (Priority Queuing, PRIQ)
options         ALTQ_NOPCC      # az SMP esetén kell</pre><p>Az <code class="literal">options ALTQ</code> az
	<acronym class="acronym">ALTQ</acronym> rendszert engedélyezi.</p><p>Az <code class="literal">options ALTQ_CBQ</code> engedélyezi a
	osztályozás alapú besorolást
	(<span class="emphasis"><em>Class Based Queuing</em></span>,
	<acronym class="acronym">CBQ</acronym>).  A <acronym class="acronym">CBQ</acronym>
	használatával a kapcsolatunkhoz tartozó
	sávszélességet
	különbözõ osztályokra vagy sorokra
	tudjuk bontani és a szûrési
	szabályoknak megfelelõen osztályozni
	segítségükkel a forgalmat.</p><p>Az <code class="literal">options ALTQ_RED</code> a véletlen
	korai észlelés (<span class="emphasis"><em>Random Early
	Detection</em></span>, <acronym class="acronym">RED</acronym>)
	használatát engedélyezi.  A
	<acronym class="acronym">RED</acronym> a hálózati forgalomban
	keletkezõ torlódások
	elkerülésére alkalmas.  A
	<acronym class="acronym">RED</acronym> ezt a problémát úgy
	oldja meg, hogy méri a sorok hosszát és
	összeveti a hozzá tartozó minimális
	és maximális
	küszöbértékekkel.  Ha a sor hossza
	meghaladja a számára elõírt
	maximális értéket, akkor az új
	csomagokat eldobja.  Nevéhez hûen a
	<acronym class="acronym">RED</acronym> az eldobásra ítélt
	csomagokat véletlenszerûen választja
	ki.</p><p>Az <code class="literal">options ALTQ_RIO</code> engedélyezi a
	<acronym class="acronym">RED</acronym> használatát mind a
	két irányba, tehát be- és
	kifelé.</p><p>Az <code class="literal">options ALTQ_HFSC</code> a pártatlan
	hierachikus szolgáltatási görbe alapú
	csomagütemezõt (<span class="emphasis"><em>Hierarchical Fair Service
	Curve Packet Scheduler</em></span>, <acronym class="acronym">HFSC</acronym>)
	engedélyezi.  Vele kapcsolatban a <code class="uri"><a class="uri" href="http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html" target="_top">http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html</a></code>
	címen találhatunk bõvebben
	olvasnivalót (angolul).</p><p>Az <code class="literal">options ALTQ_PRIQ</code> a prioritásos
	besorolást (<span class="emphasis"><em>Priority Queuing</em></span>,
	<acronym class="acronym">PRIQ</acronym>) teszi elérhetõvé.  A
	<acronym class="acronym">PRIQ</acronym> mindig elsõként a nagyobb
	értékû sorban levõ forgalmat
	továbbítja.</p><p>Az <code class="literal">options ALTQ_NOPCC</code> az
	<acronym class="acronym">ALTQ</acronym> <acronym class="acronym">SMP</acronym>, vagyis
	többprocesszoros támogatását adja meg.
	Ilyen típusú rendszerekben ez
	kötelezõ.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="firewalls-apps.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="firewalls.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="firewalls-ipf.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">30.3. Tûzfalak </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 30.5. Az IPFILTER (IPF) tûzfal</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>