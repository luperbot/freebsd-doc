<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>31.7. Lemez nélküli mûködés</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="advanced-networking.html" title="31. fejezet - Egyéb haladó hálózati témák" /><link rel="prev" href="network-aggregation.html" title="31.6. Linkek összefûzése és hibatûrése" /><link rel="next" href="network-isdn.html" title="31.8. ISDN" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.7. Lemez nélküli mûködés</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-aggregation.html">Vissza</a> </td><th width="60%" align="center">31. fejezet - Egyéb haladó hálózati
    témák</th><td width="20%" align="right"> <a accesskey="n" href="network-isdn.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-diskless"></a>31.7. Lemez nélküli mûködés</h2></div><div><span class="authorgroup">Frissítette: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Dock`es</span>, <span class="firstname">Jean-François</span></span>. </span></div><div><span class="authorgroup">Átdolgozta és javította:
	    <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Dupre</span>, <span class="firstname">Alex</span></span>. </span></div></div></div><a id="idp100683984" class="indexterm"></a><a id="idp100684496" class="indexterm"></a><p>A FreeBSD képes hálózaton keresztül
      elindulni és helyi lemez nélkül egy
      <acronym class="acronym">NFS</acronym> szerver által megosztott
      állományrendszer csatlakoztatásával
      mûködni.  Ehhez a szabványos
      konfigurációs állományok
      módosításán kívül semmi
      másra nincs szükségünk.  Egy ilyen
      rendszert viszonylag könnyû beállítani,
      mivel az összes hozzávaló szinte készen
      elérhetõ:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Rögtön adott legalább két
	  módszer, ha a rendszermagot hálózaton
	  keresztül akarjuk betölteni:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><acronym class="acronym">PXE</acronym>: az <span class="trademark">Intel</span>(R) által
	      fejlesztett Preboot eXecution Environment
	      (<span class="quote">"<span class="quote">indítás elõtti
	      végrehajtási környezet</span>"</span>)
	      nevû rendszer a hálózati
	      kártyákba vagy alaplapokba
	      épített ROM
	      segítségével teszi
	      lehetõvé az intelligens
	      rendszerindítást.  A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a> man
	      oldalán olvashatunk errõl
	      részletesebben.</p></li><li class="listitem"><p>Az <span class="application">Etherboot</span> port
	      (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/etherboot/pkg-descr">net/etherboot</a>) olyan
	      ROM-ba programozható kódot
	      készít, amellyel rendszermagokat tudunk
	      hálózaton keresztül betölteni.  Ez
	      a kód egyaránt felhasználható
	      egy hálózati rendszerindító
	      PROM beégetéséhez, vagy
	      betölthetõ a helyi floppy (esetleg
	      merev)lemezrõl, illetve <span class="trademark">MS-DOS</span>(R) rendszer
	      alól.  Elég sok hálózati
	      kártya támogatja ezt a módot.</p></li></ul></div></li><li class="listitem"><p>Egy mintaszkript
	  (<code class="filename">/usr/share/examples/diskless/clone_root</code>)
	  is próbálja megkönnyíteni a
	  szerveren a munkaállomás
	  rendszerindító
	  állományrendszerének
	  létrehozását és
	  karbantartását.  Ezt a szkriptet
	  valószínûleg némileg
	  módosítani kell, de így is sokat
	  segít az elindulásban.</p></li><li class="listitem"><p>Az <code class="filename">/etc</code> könyvtárban
	  található szabványos
	  rendszerindításhoz használt
	  állományok, amelyekkel a lemez
	  nélküli indulást lehet detektálni
	  és segíteni.</p></li><li class="listitem"><p>A lapozás, amennyiben szükséges,
	  <acronym class="acronym">NFS</acronym> vagy helyi lemez
	  segítségével oldható meg.</p></li></ul></div><p>Számos módon állíthatunk be egy
      lemez nélküli munkaállomást.  Rengeteg
      részbõl tevõdik össze, és ezek
      legtöbbje remekül testreszabható az
      igényeinknek.  A továbbiakban egy teljes rendszer
      összeállításának
      lehetséges variációit ismertetjük,
      különös hangsúlyt fektetünk arra, hogy
      egyszerûek és a hagyományos FreeBSD
      indítószkriptekkel kompatibilisek maradjanak.  A
      bemutatandó rendszer a következõ
      jellemzõkkel bír:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A lemez nélküli munkaállomások
	  megosztott <code class="filename">/</code> és
	  <code class="filename">/usr</code> állományrendszereket
	  használnak.</p><p>A rendszer indításához
	  használt gyökér
	  állományrendszer a szabvány FreeBSD-s
	  gyökér (ez általában a
	  szerveré), ahol néhány
	  állományt felülírtunk a lemez
	  nélküli mûködéshez vagy
	  azért, mert egyszerûen az adott
	  munkaállomáshoz tartozik.</p><p>A gyökér azon részeit, amelyeket
	  írhatóvá kívánunk tenni,
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> alapú állományrendszerekkel
	  lapoljuk felül.  Ilyenkor azonban bármilyen rajtuk
	  ejtett változtatás a rendszer
	  újraindításával elveszik.</p></li><li class="listitem"><p>A rendszermagot vagy az
	  <span class="application">Etherboot</span> vagy a
	  <acronym class="acronym">PXE</acronym> használatával
	  küldessük át és töltsük be,
	  mivel egyes helyzetekben ezekre szükség
	  lesz.</p></li></ul></div><div xmlns="" class="caution"><h3 class="admontitle">Figyelem: </h3><p xmlns="http://www.w3.org/1999/xhtml">A bemutatott rendszer nem biztonságos.
	Helyezzük a hálózatunk egy jól
	védett részére, és a többi
	gép ne tekintse megbízhatónak.</p></div><p>A szakaszban szereplõ összes
      információt a FreeBSD 5.2.1-RELEASE
      változatával teszteltük.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100710608"></a>31.7.1. Háttérinformációk</h3></div></div></div><p>A lemez nélküli munkaállomások
	beállítása egyszerre adja magát
	és könnyen is elvéthetõ.  Az
	elkövetett hibákat olykor számos okból
	kifolyólag nehéz felismerni.
	Például:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A fordítási idõben megadott
	    beállítások mást
	    eredményeznek futási idõben.</p></li><li class="listitem"><p>A hibaüzenetek gyakran titokzatosak vagy esetleg
	    teljesen el is maradnak.</p></li></ul></div><p>Ezért ha valamennyire tisztában vagyunk a
	háttérben zajló folyamatokkal, akkor sokkal
	több eséllyel leszünk képesek megoldani
	a menet közben felmerülõ
	problémákat.</p><p>A rendszernek a sikeres felkapaszkodáshoz több
	mûveletet is végre kell hajtania:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A gépnek szüksége van olyan
	    induló paraméterekhez, mint
	    például az IP-cím, a
	    végrehajtható állomány neve, a
	    szerver neve, a gyökér elérési
	    útja.  Ezeket a <acronym class="acronym">DHCP</acronym> vagy a BOOTP
	    protokollok használatával adhatjuk meg.  A
	    <acronym class="acronym">DHCP</acronym> a BOOTP kompatibilis
	    kiterjesztése, ezért ugyanazokat a portokat
	    és alapvetõ csomagformátumot
	    alkalmazza.</p><p>A rendszerüket kizárólag BOOTP
	    használatával is beállíthatjuk.
	    A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bootpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bootpd</span>(8)</span></a> szerver az alap FreeBSD rendszer
	    része.</p><p>A <acronym class="acronym">DHCP</acronym> azonban rengeteg elõnnyel
	    rendelkezik a BOOTP protokollal szemben
	    (áttekinthetõbb konfigurációs
	    állományok, a <acronym class="acronym">PXE</acronym>
	    használatának lehetõsége, illetve
	    sok minden más, ami nem csak a lemez
	    nélküli mûködéshez kellhet),
	    ezért itt alapvetõen egy DHCP alapú
	    konfigurációt mutatunk be, de ahol
	    megoldható, megemlítjük a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bootpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bootpd</span>(8)</span></a>
	    esetén alkalmas példákat is.  A
	    mintaként szolgáló
	    konfiguráció az <span class="application">ISC
	    DHCP</span> szoftvercsomagot használja (a
	    tesztszerverre ennek a 3.0.1.r12 verzióját
	    telepítetük fel).</p></li><li class="listitem"><p>A gépnek egy vagy több programot kell a
	    saját memóriájába
	    áttöltenie.  Erre vagy a <acronym class="acronym">TFTP</acronym>
	    vagy pedig az <acronym class="acronym">NFS</acronym> alkalmas.  A
	    <acronym class="acronym">TFTP</acronym> és az <acronym class="acronym">NFS</acronym>
	    között sok helyen fordítási
	    idõben tudunk választani.  Gyakori
	    hibaforrás a protokollhoz rosszul megadott
	    állománynevek használata: a
	    <acronym class="acronym">TFTP</acronym> általában az
	    összes állományt a szerverrõl
	    egyetlen könyvtárból tölti
	    át, ezért arra számít, hogy a
	    neveiket ehhez viszonyítva adjuk meg.  Az
	    <acronym class="acronym">NFS</acronym> használata során
	    azonban abszolút elérési utakat kell
	    megadnunk.</p></li><li class="listitem"><p>A rendszer indítását
	    lehetõvé tevõ közbensõ
	    programokat és a rendszermagot valahogy
	    inicializálni kell és elindítani.  Ezen
	    a területen több fontos változat kapott
	    helyet:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>A <acronym class="acronym">PXE</acronym> a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a>
		kódját fogja betölteni, ez
		lényegében a FreeBSD betöltõ
		harmadik fokozatának egy módosított
		változata.  A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> a
		mûködéséhez
		szükséges paramétereket a rendszer
		indításakor kapja meg, majd a
		vezérlés átadása elõtt
		ezeket a rendszermag környezetében hagyja.
		Ebben az esetben akár a
		<code class="filename">GENERIC</code> rendszermag is
		használható.</p></li><li class="listitem"><p>Az <span class="application">Etherboot</span> kevesebb
		elõkészítéssel
		közvetlenül magát a rendszermagot
		tölti be.  Ehhez azonban egy saját
		rendszermagot kell építeni,
		külön
		beállításokkal.</p></li></ul></div><p>A <acronym class="acronym">PXE</acronym> és az
	    <span class="application">Etherboot</span> egyaránt
	    jól használható.  Mivel azonban a
	    rendszermagok általában a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>
	    kódjára hagyják a munka legnagyobb
	    részét, ezért ahol lehetséges, a
	    <acronym class="acronym">PXE</acronym> megoldását
	    érdemes alkalmazni.</p><p>Tehát ha az alaplapi <acronym class="acronym">BIOS</acronym>
	    és a hálózati kártya is
	    támogatja a <acronym class="acronym">PXE</acronym>
	    használatát, akkor válasszunk
	    inkább azt.</p></li><li class="listitem"><p>Végezetül a gépnek valamilyen
	    módon hozzá kell tudnia férnie az
	    állományrendszerekhez.  Erre többnyire az
	    <acronym class="acronym">NFS</acronym> jöhet szóba.</p></li></ul></div><p>A további részleket lásd a
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diskless&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">diskless</span>(8)</span></a> man oldalon.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100742736"></a>31.7.2. Beállítási
	útmutató</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100743376"></a>31.7.2.1. Beállítás a <span class="application">ISC
	  DHCP</span> használatával</h4></div></div></div><a id="idp100744400" class="indexterm"></a><p>Az <span class="application">ISC DHCP</span> szervere
	    képes a BOOTP és <acronym class="acronym">DHCP</acronym>
	    kéréseket is megválaszolni.</p><p>Az <span class="application">ISC DHCP 3.0</span> nem az
	    alaprendszer része, ezért a
	    használatához elõször
	    telepítenünk kell a <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/isc-dhcp30-server/pkg-descr">net/isc-dhcp30-server</a> portot vagy a
	    neki megfelelõ csomagot.</p><p>Ahogy feltelepítettük, le kell futtatnunk az
	    <span class="application">ISC DHCP</span>
	    konfigurációs állományát
	    (ezt általában
	    <code class="filename">/usr/local/etc/dhcpd.conf</code> néven
	    találjuk meg).  A most következõ,
	    megjegyzésekkel kiegészített
	    példában egy <code class="systemitem">margaux</code>
	    nevû gép az
	    <span class="application">Etherboot</span>, valamint egy
	    <code class="systemitem">corbieres</code> nevû gép
	    <acronym class="acronym">PXE</acronym> használatával akar
	    kapcsolódni:</p><pre class="programlisting">
default-lease-time 600;
max-lease-time 7200;
authoritative;

option domain-name "minta.com";
option domain-name-servers 192.168.4.1;
option routers 192.168.4.1;

subnet 192.168.4.0 netmask 255.255.255.0 {
  use-host-decl-names on; <a id="co-dhcp-host-name"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
  option subnet-mask 255.255.255.0;
  option broadcast-address 192.168.4.255;

  host margaux {
    hardware ethernet 01:23:45:67:89:ab;
    fixed-address margaux.minta.com;
    next-server 192.168.4.4; <a id="co-dhcp-next-server"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
    filename "/data/misc/kernel.diskless"; <a id="co-dhcp-filename"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
    option root-path "192.168.4.4:/data/misc/diskless"; <a id="co-dhcp-root-path"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
  }
  host corbieres {
    hardware ethernet 00:02:b3:27:62:df;
    fixed-address corbieres.minta.com;
    next-server 192.168.4.4;
    filename "pxeboot";
    option root-path "192.168.4.4:/data/misc/diskless";
  }
}
</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-dhcp-host-name"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Ez a beállítás arra
		utasítja a <span class="application">dhcpd</span>
		démont, hogy a lemez nélküli
		gép hálózati neveként a
		<code class="literal">host</code> deklarációban
		megadott értéket küldje el.  Ezt
		úgyis meg lehet csinálni, hogy
		felvesszünk egy <code class="literal">option host-name
		margaux </code>
		részt a <code class="literal">host</code>
		deklarációk közé.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-dhcp-next-server"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>A <code class="literal">next-server</code> direktíva a
		betöltõ vagy a rendszermag
		betöltéséért felelõs
		<acronym class="acronym">TFTP</acronym> vagy <acronym class="acronym">NFS</acronym>
		szervert jelöli ki (alapértelmezés
		szerint ez megegyezik a <acronym class="acronym">DHCP</acronym>
		szerverrel).</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-dhcp-filename"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>A <code class="literal">filename</code> direktíva azt
		az állományt adja meg, amelyet az
		<span class="application">Etherboot</span> vagy a
		<acronym class="acronym">PXE</acronym> a következõ
		végrehajtási lépésben
		betölt.  Ezt a kiválasztott átviteli
		módnak megfelelõen kell megadni.  Az
		<span class="application">Etherboot</span>
		lefordítható az <acronym class="acronym">NFS</acronym>
		vagy a <acronym class="acronym">TFTP</acronym>
		használatával is.  A FreeBSD port
		alapból az <acronym class="acronym">NFS</acronym>
		támogatását tartalmazza.  A
		<acronym class="acronym">PXE</acronym> a <acronym class="acronym">TFTP</acronym>
		protokollt használja, ezért itt
		relatív állományneveket adunk meg
		(ez persze a <acronym class="acronym">TFTP</acronym> szerver
		beállításaitól függ, de
		általában ez a jellemzõ).  Sõt,
		a <acronym class="acronym">PXE</acronym> a <code class="filename">pxeboot</code>
		állományt tölti be, nem is a
		rendszermagot.  Léteznek további
		érdekes lehetõségek is, mint
		például a <code class="filename">pxeboot</code>
		állomány betöltése a FreeBSD
		CD-jén található <code class="filename">/boot</code>
		könyvtárból (mivel a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a>
		a <code class="filename">GENERIC</code> rendszermagot
		képes betölteni, ezért a
		<acronym class="acronym">PXE</acronym> használatával
		akár egy távoli
		CD-meghajtóról is indíthatjuk a
		rendszert).</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-dhcp-root-path"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>A <code class="literal">root-path</code> opció a
		rendszer indításához
		használt gyökér
		állományrendszert nevezi meg, amelyet
		többnyire az <acronym class="acronym">NFS</acronym>
		jelölési módszere szerint kell
		megadni.  A <acronym class="acronym">PXE</acronym> használata
		során el lehet hagyni a gép
		IP-címét egészen addig, amíg
		nem engedélyezzük a rendszermagban a BOOTP
		beállítást.  Az
		<acronym class="acronym">NFS</acronym> szerver ekkor megegyzik a
		<acronym class="acronym">TFTP</acronym> szerverrel.</p></td></tr></table></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100773328"></a>31.7.2.2. Beállítás a BOOTP
	  használatával</h4></div></div></div><a id="idp100773968" class="indexterm"></a><p>Itt a <span class="application">bootpd</span> (egyetlen
	    kliensre korlátozott)
	    beállítását láthatjuk.
	    Ezt az <code class="filename">/etc/bootptab</code>
	    állományba tegyük.</p><p>Ne feledjük, hogy a BOOTP
	    használatához az
	    <span class="application">Etherboot</span> portot a
	    <code class="literal">NO_DHCP_SUPPORT</code>
	    beállítással kell fordítanunk,
	    miközben a <acronym class="acronym">PXE</acronym> esetében kell
	    a <acronym class="acronym">DHCP</acronym>.  Egyébként a
	    <span class="application">bootpd</span> egyedüli
	    nyilvánvaló elõnye csupán annyi,
	    hogy az alaprendszer része.</p><pre class="programlisting">
.def100:\
  :hn:ht=1:sa=192.168.4.4:vm=rfc1048:\
  :sm=255.255.255.0:\
  :ds=192.168.4.1:\
  :gw=192.168.4.1:\
  :hd="/tftpboot":\
  :bf="/kernel.diskless":\
  :rp="192.168.4.4:/data/misc/diskless":

margaux:ha=0123456789ab:tc=.def100
</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100783568"></a>31.7.2.3. A rendszer elõkészítése az
	  <span class="application">Etherboot</span>
	  számára</h4></div></div></div><a id="idp100784592" class="indexterm"></a><p>Az <a class="link" href="http://etherboot.sourceforge.net" target="_top">Etherboot
	  honlapján </a> találhatunk egy <a class="link" href="http://etherboot.sourceforge.net/doc/html/userman/t1.html" target="_top">
	  minden részletre kiterjedõ
	  dokumentációt (angolul)</a>, amely
	  elsõsorban ugyan a Linux típusú rendszerek
	  számára íródott, de ettõl
	  függetlenül még hasznos
	  információkat tartalmaz.  A továbbiakban
	  csak annyit szeretnénk körvonalazni, hogy az
	  <span class="application">Etherboot</span> miként
	  bírható mûködésre FreeBSD
	  rendszerekkel.</p><p>Elõször telepítenünk kell a
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/etherboot/pkg-descr">net/etherboot</a> csomagot
	  vagy portot.</p><p>Az <span class="application">Etherboot</span>
	  beállítását (vagyis a
	  <acronym class="acronym">TFTP</acronym> használatának
	  megadását az <acronym class="acronym">NFS</acronym> helyett) az
	  <span class="application">Etherboot</span> forrását
	  tartalmazó könyvtárban
	  található <code class="filename">Config</code>
	  állomány megfelelõ
	  átírásával tudjuk megtenni.</p><p>Itt most floppyról fogjuk indítani a
	  rendszert.  A többi módszerrel (PROM vagy <span class="trademark">MS-DOS</span>(R)
	  program) kapcsolatban olvassuk el az
	  <span class="application">Etherboot</span>
	  dokumentációját.</p><p>A rendszerindító lemez
	  elkészítéséhez tegyünk egy
	  lemezt annak a gépnek a meghajtójába,
	  ahová az <span class="application">Etherboot</span>
	  felkerült.  Váltsunk az
	  <span class="application">Etherboot</span>
	  könyvtárán belül az
	  <code class="filename">src</code> alkönyvtárba és
	  gépeljük be:</p><pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>gmake bin32/eszköztípus.fd0</code></strong>
</pre><p>Az <em class="replaceable"><code>eszköztípus</code></em> a
	  lemez nélküli munkaállomás Ethernet
	  kártyájától függ.  Az
	  ugyanebben a könyvtárban található
	  <code class="filename">NIC</code> állományból
	  tudjuk kiolvasni, hogy az adott kártyához melyik
	  <em class="replaceable"><code>eszköztípus</code></em>
	  tartozik.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100796368"></a>31.7.2.4. A rendszer indítása <acronym class="acronym">PXE</acronym>
	  használatával</h4></div></div></div><p>Alapértelmezés szerint a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a>
	  betöltõ a rendszermagot <acronym class="acronym">NFS</acronym>-en
	  keresztül tölti be.  Ha az
	  <code class="filename">/etc/make.conf</code> állományban
	  a <code class="literal">LOADER_TFTP_SUPPORT</code>
	  beállítást adjuk meg, akkor
	  <acronym class="acronym">TFTP</acronym> támogatással is
	  lefordítható.  Ezzel kapcsolatban a
	  <code class="filename">/usr/share/examples/etc/make.conf</code>
	  állományban található
	  megjegyzéseket érdemes elolvasnunk.</p><p>A <code class="filename">make.conf</code> állományban
	  még további két másik hasznos
	  opciót is találhatunk a soros vonali konzollal
	  üzemelõ lemez nélküli gépek
	  számára: az egyik a
	  <code class="literal">BOOT_PXELDR_PROBE_KEYBOARD</code>, a másik
	  pedig a <code class="literal">BOOT_PXELDR_ALWAYS_SERIAL</code>.</p><p>A gép indításakor úgy tudjuk
	  beüzemelni a <acronym class="acronym">PXE</acronym>
	  használatát, ha a BIOS
	  beállításai között a
	  <code class="literal">Boot from network</code> opciót
	  választjuk ki, vagy a gép bekapcsolása
	  után lenyomjuk hozzá a megfelelõ
	  funkcióbillentyût.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100803664"></a>31.7.2.5. A <acronym class="acronym">TFTP</acronym> és
	  <acronym class="acronym">NFS</acronym> szerverek
	  beállítása</h4></div></div></div><a id="idp100805072" class="indexterm"></a><a id="idp100806224" class="indexterm"></a><p>Ha a <acronym class="acronym">PXE</acronym> vagy az
	  <span class="application">Etherboot</span> a <acronym class="acronym">TFTP</acronym>
	  protokollt használja, akkor az
	  állományszerveren a
	  <span class="application">tftpd</span> démont kell
	  elindítani:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Készítsünk egy
	      könyvtárat, ahonnan majd a
	      <span class="application">tftpd</span> küldi az
	      állományokat, például legyen
	      ez a <code class="filename">/tftpboot</code>.</p></li><li class="step"><p>Vegyük fel a következõ sort az
	      <code class="filename">/etc/inetd.conf</code>
	      állományunkba:</p><pre class="programlisting">tftp	dgram	udp	wait	root	/usr/libexec/tftpd	tftpd -l -s /tftpboot</pre><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">A tapasztalat szerint egyes <acronym class="acronym">PXE</acronym>
		verziók a <acronym class="acronym">TFTP</acronym>
		<acronym class="acronym">TCP</acronym> alapú
		változatát használják.
		Ebben az esetben vegyünk fel még egy
		második sort is, ahol a <code class="literal">dgram
		udp</code> részt <code class="literal">stream
		tcp</code>-re cseréljük.</p></div></li><li class="step"><p>Mondjuk meg az <span class="application">inetd</span>
	      démonnak, hogy olvassa újra a
	      konfigurációs
	      állományát.  Az alábbi parancs
	      megfelelõ mûködéséhez Az
	      <code class="option">inetd_enable="YES"</code> sornak szerepelnie
	      kell az <code class="filename">/etc/rc.conf</code>
	      állományban:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/inetd restart</code></strong></pre></li></ol></div><p>A <code class="filename">tftpboot</code> könyvtárat
	  bárhova rakhatjuk a szerveren.  Viszont az
	  <code class="filename">inetd.conf</code> és
	  <code class="filename">dhcpd.conf</code> állományokban
	  ezt ne felejtsük fel megadni.</p><p>Minden esetben engedélyeznünk kell az
	  <acronym class="acronym">NFS</acronym> használatát és
	  vele együtt exportálni az <acronym class="acronym">NFS</acronym>
	  szerverrõl elérni kívánt
	  állományrendszereket.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Az <code class="filename">/etc/rc.conf</code>
	      állományba tegyük bele a
	      következõt:</p><pre class="programlisting">nfs_server_enable="YES"</pre></li><li class="step"><p>Az <code class="filename">/etc/exports</code>
	      állományban a lemez nélküli
	      rendszereknek szánt
	      gyökérkönyvtárat tegyük
	      elérhetõvé (a példában
	      írjuk át a kötet csatlakozási
	      pontját és a <em class="replaceable"><code>margaux
	      corbieres</code></em> helyére
	      állítsuk be a saját lemez
	      nélküli munkaállomásaink
	      neveit:</p><pre class="programlisting"><em class="replaceable"><code>/data/misc</code></em> -alldirs -ro <em class="replaceable"><code>margaux corbieres</code></em></pre></li><li class="step"><p>Kérjük meg a
	      <span class="application">mountd</span> démont, hogy
	      olvassa újra a konfigurációs
	      állományát.  Elõfordulhat
	      azonban, hogy ehhez elõször az
	      <acronym class="acronym">NFS</acronym> szolgáltatást kell
	      engedélyezni az <code class="filename">/etc/rc.conf</code>
	      állományból és
	      újraindítani a gépet.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/mountd restart</code></strong></pre></li></ol></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100841552"></a>31.7.2.6. Lemez nélküli rendszermag
	  fordítása</h4></div></div></div><a id="idp100842192" class="indexterm"></a><p>Ha az <span class="application">Etherboot</span>
	  használata mellett döntünk, akkor a lemez
	  nélküli kliensek számára a
	  rendszermagot a következõ
	  beállítások használatával
	  kell újrafordítani (a megszokottak
	  mellett):</p><pre class="programlisting">
options     BOOTP          # BOOTP-n keresztül kérünk IP-címet és hálózati nevet
options     BOOTP_NFSROOT  # a BOOTP-tõl kapott információk alapján csatoljuk a gyökeret NFS-en keresztül
</pre><p>Ezek mellett valószínûleg
	  szükségünk lesz a
	  <code class="literal">BOOTP_NFSV3</code>, <code class="literal">BOOT_COMPAT</code>
	  és <code class="literal">BOOTP_WIRED_TO</code>
	  beállítások megadására is
	  (lásd a <code class="filename">NOTES</code>
	  állományt).</p><p>A beállítások nevei
	  régrõl származnak és némileg
	  félrevezetõek lehetnek, mivel
	  valójában semmit sem változtatnak a
	  rendszermagban levõ <acronym class="acronym">DHCP</acronym> vagy a BOOTP
	  rutinok használatában (egyébként
	  meg lehet adni vagy az egyik vagy a másik protokoll
	  kizárólágos használatát
	  is).</p><p>Fordítsuk le a rendszermagot (lásd <a class="xref" href="kernelconfig.html" title="8. fejezet - A FreeBSD rendszermag testreszabása">8. fejezet - <em>A FreeBSD rendszermag testreszabása</em></a>), és másoljuk a
	  <code class="filename">dhcpd.conf</code> állományban
	  megadott helyre.</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Amikor a <acronym class="acronym">PXE</acronym> protokollt
	    használjuk, a rendszermagot nem fontos az
	    imént felsorolt paraméterekkel
	    fordítanunk (habár ajánlatos).  Az
	    engedélyezésükkel több
	    <acronym class="acronym">DHCP</acronym> kérés keletkezik a
	    rendszermag elindulása közben, ezért
	    kisebb a kockázata annak, hogy a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a>
	    által bizonyos esetekben megszerzett és az
	    új értékek között valamilyen
	    ellentmondás jön létre.  A
	    használatuk egyik elõnye, hogy így
	    mellékhatásként a
	    hálózati nevünket is megkapjuk.
	    Ellenkezõ esetben erre is találnunk kellene
	    valamilyen módot, például fenntartani
	    egy-egy <code class="filename">rc.conf</code> állományt
	    minden kliensen.</p></div><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Az <span class="application">Etherboot</span> csak akkor lesz
	    képes betölteni a rendszermagot, ha device
	    hinteket is beépítünk.  Ezt a
	    következõ beállítással tudjuk
	    megoldani (errõl bõvebben lásd a
	    <code class="filename">NOTES</code> állomány
	    megjegyzéseit):</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">hints		"GENERIC.hints"</pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100857424"></a>31.7.2.7. A rendszerindító
	  állományrendszer
	  elõkészítése</h4></div></div></div><a id="idp100858192" class="indexterm"></a><p>A <code class="filename">dhcpd.conf</code> állomány
	  <code class="literal">root-path</code>
	  beállításának megfelelõen
	  hozzunk létre a rendszer
	  indítására alkalmas gyökér
	  állományrendszert.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100860624"></a>31.7.2.7.1. Az állományrendszer
	    feltöltése a <code class="command">make world</code>
	    paranccsal</h5></div></div></div><p>Ezzel a módszerrel a <code class="envar">DESTDIR</code>
	    könyvtárba pillanatok alatt telepíteni
	    tudunk egy teljes szûz rendszert (és nem csak a
	    rendszerindító
	    állományrendszert).  Ehhez mindössze csak
	    annyit kell tenni, hogy lefuttatjuk a következõ
	    szkriptet:</p><pre class="programlisting">#!/bin/sh
export DESTDIR=/data/misc/diskless
mkdir -p ${DESTDIR}
cd /usr/src; make buildworld &amp;&amp; make buildkernel
make installworld &amp;&amp; make installkernel
cd /usr/src/etc; make distribution</pre><p>Miután végzett, már csak a
	    <code class="envar">DESTDIR</code> könyvtárban
	    található <code class="filename">/etc/rc.conf</code>
	    és <code class="filename">/etc/fstab</code>
	    állományokat kell az igényeinkhez
	    igazítani.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100864720"></a>31.7.2.8. A lapozóterület
	  beállítása</h4></div></div></div><p>Amennyiben szükséges, a szerveren
	  található lapozóállományt
	  <acronym class="acronym">NFS</acronym>-en keresztül el tudjuk
	  érni.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100866128"></a>31.7.2.8.1. Lapozás <acronym class="acronym">NFS</acronym>-sel</h5></div></div></div><p>A rendszermag maga nem támogatja az
	    <acronym class="acronym">NFS</acronym> alapú lapozás
	    engedélyezését a rendszer
	    indításakor.  A
	    lapozóállományt ezért a
	    rendszerindító szkripteken keresztül
	    aktiváljuk, amelyekben csatlakoztatunk egy
	    írható állományrendszert, ahol
	    létrehozzuk és engedélyezzük a
	    lapozóállományt.  Tetszõleges
	    méretû lapozóállományt
	    például így tudunk
	    készíteni:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/a/lapozóállomány/helye bs=1k count=1 oseek=100000</code></strong></pre><p>Az engedélyezéséhez pedig a
	    következõ sort kell felvenni az
	    <code class="filename">rc.conf</code>
	    állományba:</p><pre class="programlisting">swapfile=<em class="replaceable"><code>/a/lapozóállomány/helye</code></em></pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100874704"></a>31.7.2.9. Egyéb problémák</h4></div></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100875344"></a>31.7.2.9.1. Írásvédett
	    <code class="filename">/usr</code> használata</h5></div></div></div><a id="idp100876368" class="indexterm"></a><p>Ha a lemez nélküli
	      munkaállomáson X szervert akarunk futtatni,
	      akkor az <span class="application">XDM</span>
	      konfigurációs állományait
	      kicsit módosítanunk kell, mert
	      alapértelmezés szerint a
	      <code class="filename">/usr</code> könyvtárban hozza
	      létre a naplókat.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100878800"></a>31.7.2.9.2. Nem FreeBSD-s szerver használata</h5></div></div></div><p>Amikor a rendszer indításához
	    használt állományrendszert nem egy FreeBSD
	    alapú számítógépen
	    tároljuk, akkor elõször ezt egy FreeBSD-s
	    gépen kell elkészíteni, majd a
	    <code class="command">tar</code> vagy <code class="command">cpio</code>
	    segítségével átmásolni a
	    megfelelõ helyre.</p><p>Ilyen helyzetekben gyakran gondok adódhatnak
	    olyan speciális állományokkal, mint
	    például amelyek a <code class="filename">/dev</code>
	    könyvtárban találhatóak, mivel a
	    fõ- és aleszközazonosítók
	    tárolására szánt méret
	    különbözhet.  Ezt úgy oldhatjuk meg,
	    ha exportálunk egy könyvtárat a nem FreeBSD
	    alapú szerveren, ezt csatlakoztatjuk a FreeBSD-s
	    gépen, majd a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a>
	    segítségével a
	    eszközleírókat a
	    felhasználó számára
	    észrevétlen módon foglaljuk le.</p></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-aggregation.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="network-isdn.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">31.6. Linkek összefûzése és
      hibatûrése </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 31.8. ISDN</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>