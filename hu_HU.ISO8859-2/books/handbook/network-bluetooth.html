<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>31.4. Bluetooth</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="advanced-networking.html" title="31. fejezet - Egyéb haladó hálózati témák" /><link rel="prev" href="network-wireless.html" title="31.3. Vezeték nélküli hálózatok" /><link rel="next" href="network-bridging.html" title="31.5. Hálózati hidak" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.4. Bluetooth</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-wireless.html">Vissza</a> </td><th width="60%" align="center">31. fejezet - Egyéb haladó hálózati
    témák</th><td width="20%" align="right"> <a accesskey="n" href="network-bridging.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-bluetooth"></a>31.4. Bluetooth</h2></div><div><span class="authorgroup">Írta: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Lucistnik</span>, <span class="firstname">Pav</span></span>. </span></div></div></div><a id="idp100247376" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100247888"></a>31.4.1. Bevezetés</h3></div></div></div><p>A Bluetooth egy olyan vezeték nélküli
	technológia, amellyel a 2,4 GHz-es
	frekvenciatartományban tudunk személyi
	hálózatokat létrehozni 10 méteren
	belül.  Az ilyen típusú
	hálózatok általában alkalmi
	jelleggel keletkeznek különféle
	hordozható eszközök, mint például
	mobiltelefonok, kézi
	számítógépek és laptopok
	között.  Eltérõen más
	népszerû vezeték nélküli
	technológiáktól, például a
	wi-fitõl, a Bluetooth magasabb szintû
	szolgáltási profilokat is felajánl:
	FTP-szerû állományszervereket, az
	állományok áttolását, hang
	átküldését, soros vonali
	emulációt és még sok minden
	mást.</p><p>A FreeBSD-ben megvalósított Bluetooth
	protokollkészlet a Netgraph rendszerre
	építkezik (lásd <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=netgraph&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">netgraph</span>(4)</span></a>).  A
	Bluetooth alapú USB-s hardverzárak széles
	körét támogatja az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_ubt</span>(4)</span></a>
	meghajtó.  A Broadcom BCM2033 chipre
	épített Bluetooth eszközöket az
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ubtbcmfw&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ubtbcmfw</span>(4)</span></a> és az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_ubt</span>(4)</span></a> meghajtók
	támogatják.  A 3Com Bluetooth PC Card 3CRWB60-A
	eszközt az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_bt3c&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_bt3c</span>(4)</span></a> meghajtó
	támogatja.  A soros és UART alapú Bluetooth
	eszközöket a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sio&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">sio</span>(4)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_h4&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_h4</span>(4)</span></a> és
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hcseriald&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">hcseriald</span>(8)</span></a> ismeri.  Ebben a szakaszban a Bluetooth
	alapú USB-s hardverzárak használatát
	mutatjuk be.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100259792"></a>31.4.2. Az eszköz csatlakoztatása</h3></div></div></div><p>Alapértelmezés szerint a Bluetooth
	eszközmeghajtók modulként
	érhetõek el.  Az eszköz csatlakoztatása
	elõtt a megfelelõ meghajtót be kell
	töltenünk a rendszermagba:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload ng_ubt</code></strong></pre><p>Ha a Bluetooth eszköz már a rendszer
	indításakor is jelen van, akkor a modult az
	<code class="filename">/boot/loader.conf</code> állományon
	keresztül is betölthetjük:</p><pre class="programlisting">ng_ubt_load="YES"</pre><p>Dugjuk be az USB-s hardverzárunkat.  Az
	alábbihoz hasonló kimenet fog keletkezni a
	konzolon (vagy a rendszernaplóban):</p><pre class="screen">ubt0: vendor 0x0a12 product 0x0001, rev 1.10/5.25, addr 2
ubt0: Interface 0 endpoints: interrupt=0x81, bulk-in=0x82, bulk-out=0x2
ubt0: Interface 1 (alt.config 5) endpoints: isoc-in=0x83, isoc-out=0x3,
      wMaxPacketSize=49, nframes=6, buffer size=294</pre><p>Az <code class="filename">/etc/rc.d/bluetooth</code> szkript fogja
	végezni a Bluetooth használatához
	szükséges protokollkészlet
	elindítását és
	leállítását.  Jó ötlet
	leállítani az eszköz
	eltávolítása elõtt, de ha elhagyjuk,
	(általában) nem okoz végzetes hibát.
	Az indításkor a következõ kimenetet
	kapjuk:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/bluetooth start ubt0</code></strong>
BD_ADDR: 00:02:72:00:d4:1a
Features: 0xff 0xff 0xf 00 00 00 00 00
&lt;3-Slot&gt; &lt;5-Slot&gt; &lt;Encryption&gt; &lt;Slot offset&gt;
&lt;Timing accuracy&gt; &lt;Switch&gt; &lt;Hold mode&gt; &lt;Sniff mode&gt;
&lt;Park mode&gt; &lt;RSSI&gt; &lt;Channel quality&gt; &lt;SCO link&gt;
&lt;HV2 packets&gt; &lt;HV3 packets&gt; &lt;u-law log&gt; &lt;A-law log&gt; &lt;CVSD&gt;
&lt;Paging scheme&gt; &lt;Power control&gt; &lt;Transparent SCO data&gt;
Max. ACL packet size: 192 bytes
Number of ACL packets: 8
Max. SCO packet size: 64 bytes
Number of SCO packets: 8</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100265552"></a>31.4.3. Host Controller Interface (HCI)</h3></div></div></div><a id="idp100266192" class="indexterm"></a><p>A Host Controller Interface (HCI) egy parancsfelületet
	nyújt a mûködési sáv
	vezérlõjéhez (baseband controller) és
	az összeköttetések kezelõjéhez
	(link manager), valamint hozzáférést a
	hardverállapot és -vezérlõ
	regiszterekhez.  Ez a felület egy egységes
	módszert szolgáltat a Bluetooth
	mûködési sávjához tartozó
	tulajdonságok eléréséhez.  Az
	eszközön üzemelõ HCI réteg a
	Bluetooth hardverben található HCI firmware-rel
	vált adatokat és parancsokat.  A Host Controller
	Transport Layer (vagyis a fizikai busz) meghajtója mind a
	két HCI réteget és a kettejük
	közti információcserét is
	elérhetõvé teszi.</p><p>Az egyes Bluetooth eszközökhöz
	létrejön egy-egy <span class="emphasis"><em>hci</em></span>
	típusú Netgraph-beli csomópont.  Ez a HCI
	csomópont általában a Bluetooth
	eszközmeghajtó csomópontjához
	(lefelé) és az L2CAP csomóponthoz
	(felfelé) csatlakozik.  Az összes HCI mûveletet
	a HCI csomóponton kell elvégezni és nem az
	eszközmeghajtóhoz tartozón.  A HCI
	csomópont alapértelmezett neve a
	<span class="quote">"<span class="quote">devicehci</span>"</span>.  Ezekrõl többet az
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_hci&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_hci</span>(4)</span></a> man oldalán tudhatunk meg.</p><p>Az egyik legáltalánosabb feladat a Bluetooth
	eszközök esetében a közelben levõ
	további eszközök felderítése.
	Ezt a mûveletet
	<span class="emphasis"><em>tudakozódásnak</em></span>
	(<span class="quote">"<span class="quote">inquiry</span>"</span>) nevezik.  A tudakozódást
	és az összes többi HCI-hez
	kapcsolódó mûveletet a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hccontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">hccontrol</span>(8)</span></a>
	segédprogrammal tudjuk elvégezni.  A lentebb
	látható példa azt mutatja meg, hogyan
	tudunk Bluetooth eszközöket keresni egy adott
	távolságon belül.  Az elérhetõ
	eszközök listáját néhány
	másodpercen alatt megkapjuk.  A távoli azonban
	eszközök csak akkor fognak válaszolni, ha
	<span class="emphasis"><em>felderíthetõ</em></span>
	(<span class="quote">"<span class="quote">discoverable</span>"</span>) módban vannak.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci inquiry</code></strong>
Inquiry result, num_responses=1
Inquiry result #0
       BD_ADDR: 00:80:37:29:19:a4
       Page Scan Rep. Mode: 0x1
       Page Scan Period Mode: 00
       Page Scan Mode: 00
       Class: 52:02:04
       Clock offset: 0x78ef
Inquiry complete. Status: No error [00]</pre><p>A <code class="literal">BD_ADDR</code> a Bluetooth eszköz egyedi
	címe, hasonló a hálózati
	kártyák MAC-címéhez.  Erre a
	címre lesz szükség ahhoz, hogy a
	továbbiakban kommunikálni tudjunk az
	eszközzel.  Emberek számára
	értelmezhetõ nevet is hozzá tudunk rendelni a
	BD_ADDR címhez.  Az
	<code class="filename">/etc/bluetooth/hosts</code> állomány
	tartalmazza a Bluetooth eszközökre vonatkozó
	információkat.  A következõ
	példában azt láthatjuk, hogyan tudunk
	beszédesebb nevet adni egy távoli
	eszköznek:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci remote_name_request 00:80:37:29:19:a4</code></strong>
BD_ADDR: 00:80:37:29:19:a4
Name: Pav T39-ese</pre><p>Amikor tudakozódni kezdünk a távoli
	Bluetooth eszközök jelenléte felõl, a
	gépünket <span class="quote">"<span class="quote">sajat.gep.nev (ubt0)</span>"</span>
	néven fogják látni.  Ez a helyi
	eszközhöz rendelt név bármikor
	megváltoztatható.</p><p>A Bluetooth rendszer lehetõség ad pont-pont
	(természetesen csak két Bluetooth egység
	között) vagy pont-multipont típusú
	kapcsolatok kiépítésére.  A
	pont-multipont kapcsolat esetén a kapcsolaton több
	Bluetooth eszköz osztozik.  A most következõ
	példában megláthatjuk, hogyan kell az
	aktív mûködési sávban
	lekérdezni a helyi eszköz létrejött
	kapcsolatait:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci read_connection_list</code></strong>
Remote BD_ADDR    Handle Type Mode Role Encrypt Pending Queue State
00:80:37:29:19:a4     41  ACL    0 MAST    NONE       0     0 OPEN</pre><p>A <span class="emphasis"><em>kapcsolat azonosítója</em></span>
	(connection handle) akkor hasznos, amikor egy sávbeli
	kapcsolatot akarunk lezárni.  Ezt általában
	nem kell kézzel megcsinálni.  A rendszer
	magától lezárja az inaktív
	sávbeli kapcsolatokat.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>hccontrol -n ubt0hci disconnect 41</code></strong>
Connection handle: 41
Reason: Connection terminated by local host [0x16]</pre><p>A <code class="command">hccontrol help</code> paranccsal tudjuk
	lekérdezni az elérhetõ HCI parancsokat.  A
	legtöbb HCI parancs végrehajtásához
	nem kellenek rendszeradminisztrátori
	jogosultságok.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100284112"></a>31.4.4. Logical Link Control and Adaptation Protocol
	(L2CAP)</h3></div></div></div><a id="idp100284752" class="indexterm"></a><p>A Logical Link Control and Adaptation Protocol (L2CAP) a
	kapcsolat-orientált és a kapcsolat
	nélküli adatszolgáltatásokért
	felelõs a felsõbb rétegek felé, valamit
	támogatja a protokollok
	többszörözését, a darabolást
	és az összerakást.  Az L2CAP a magasabb
	szintû protokollok és az alkalmazások
	számára egészen 64 kilobyte
	méretig lehetõvé teszi az adatcsomagok
	küldését és
	fogadását.</p><p>A L2CAP a <span class="emphasis"><em>csatorna</em></span> (channel)
	fogalmára építkezik.  A csatorna egy
	logikai kapcsolatot képvisel a mûködési
	sávon belüli kapcsolat felett.  Mindegyik
	csatornához egyetlen protokoll kötõdik, egy a
	többhöz alapon.  Több csatorna is tarthozhat
	ugyanahhoz a protokollhoz, de egy csatornán nem
	használhatunk több protokollt.  A csatornákon
	keresztül érkezõ L2CAP csomagok ezután a
	megfelelõ felsõbb rétegbeli protokollokhoz
	kerülnek.  Több csatorna osztozhat ugyanazon a
	sávbeli kapcsolaton.</p><p>Minden Bluetooth eszközhöz létrejön
	egy <span class="emphasis"><em>l2cap</em></span> típusú
	Netgraph-csomópont.  Az L2CAP csomópont
	általában egy Bluetooth HCI csomóponthoz
	(lefelé) és egy Bluetooth sockethez
	(felfelé) kapcsolódik.  Az L2CAP csomópont
	alapértelmezett neve <span class="quote">"<span class="quote">devicel2cap</span>"</span>.
	Errõl részletesebben az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_l2cap&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_l2cap</span>(4)</span></a> man oldal
	világosít fel minket.</p><p>Ezen a szinten hasznos parancsnak bizonyulhat az
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=l2ping&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">l2ping</span>(8)</span></a>, amivel más eszközöket tudunk
	pingelni.  Elõfordulhat, hogy egyes Bluetooth
	implementációk nem válaszolnak semmilyen
	feléjük küldött adatra, így az
	alábbi példában is szereplõ <code class="literal">0
	bytes</code> teljesen normális.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>l2ping -a 00:80:37:29:19:a4</code></strong>
0 bytes from 0:80:37:29:19:a4 seq_no=0 time=48.633 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=1 time=37.551 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=2 time=28.324 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=3 time=46.150 ms result=0</pre><p>Az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=l2control&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">l2control</span>(8)</span></a> segédprogram
	használható az L2CAP csomópontok
	különbözõ mûveleteinek
	kivitelezésére.  Ebben a példában a
	helyi eszközhöz tartozó logikai kapcsolatokat
	(csatornák) és sávokat
	kérdezzük le:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>l2control -a 00:02:72:00:d4:1a read_channel_list</code></strong>
L2CAP channels:
Remote BD_ADDR     SCID/ DCID   PSM  IMTU/ OMTU State
00:07:e0:00:0b:ca    66/   64     3   132/  672 OPEN
<code class="prompt">%</code> <strong class="userinput"><code>l2control -a 00:02:72:00:d4:1a read_connection_list</code></strong>
L2CAP connections:
Remote BD_ADDR    Handle Flags Pending State
00:07:e0:00:0b:ca     41 O           0 OPEN</pre><p>Másik ugyanilyen diagnosztikai eszköz a
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=btsockstat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">btsockstat</span>(1)</span></a>.  Ha a viselkedését
	tekintjük, akkor leginkább a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=netstat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">netstat</span>(1)</span></a>
	programra hasonlít, de a Bluetooth
	hálózatban megjelenõ adatszerkezetekkel
	dolgozik.  Az alábbi példa az iménti
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=l2control&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">l2control</span>(8)</span></a> parancs kimenetében szereplõ
	logikai kapcsolatokat mutatja:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>btsockstat</code></strong>
Active L2CAP sockets
PCB      Recv-Q Send-Q Local address/PSM       Foreign address   CID   State
c2afe900      0      0 00:02:72:00:d4:1a/3     00:07:e0:00:0b:ca 66    OPEN
Active RFCOMM sessions
L2PCB    PCB      Flag MTU   Out-Q DLCs State
c2afe900 c2b53380 1    127   0     Yes  OPEN
Active RFCOMM sockets
PCB      Recv-Q Send-Q Local address     Foreign address   Chan DLCI State
c2e8bc80      0    250 00:02:72:00:d4:1a 00:07:e0:00:0b:ca 3    6    OPEN</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100302288"></a>31.4.5. Az RFCOMM protokoll</h3></div></div></div><a id="idp100302928" class="indexterm"></a><p>Az RFCOMM protokoll a soros portok
	emulációját valósítja meg az
	L2CAP protokollon keresztül.  A protokoll az ETSI TS 07.10.
	RFCOMM szabványán alapszik, és egy
	egyszerû átviteli protokoll, amelyet a 9 tûs
	RS-232 (EIATIA-232-E) soros portok
	emulációjára készítettek fel.
	Az RFCOMM protokoll legfeljebb 60 kapcsolat (RFCOMM csatorna)
	párhuzamos használatát támogatja
	két Bluetooth eszköz között.</p><p>Az RFCOMM számára a teljes
	kommunikációs útvonal két
	különbözõ eszközön futó
	alkalmazást (kommunikációs
	végpontot) és köztük levõ
	kommunikációs szegments foglalja magában.
	Az RFCOMM az adott eszközön a soros portot
	használó alkalmazások részére
	készült.  A kommunikációs szegmens az
	egyik eszköztõl a másikig vezetõ Bluetooth
	alapú összeköttetés (közvetlen
	kapcsolat).</p><p>Közvetlen kapcsolat esetén az RFCOMM csak az
	eszközök közti kapcsolattal foglalkozik, valamint
	hálózati kapcsolat esetén az eszköz
	és a modem közti kapcsolattal.  Az RFCOMM más
	konfigurációkat is támogat,
	például olyan modulokat, amelyek az egyik oldalon
	a Bluetooth vezeték nélküli
	technológián keresztül kommunikálnak,
	míg a másik oldalon egy vonalas felületet
	nyújtanak.</p><p>A FreeBSD-ben az RFCOMM protokollt Bluetooth foglalatok
	rétegében valósították
	meg.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100305104"></a>31.4.6. Az eszközök
	párosítása</h3></div></div></div><a id="idp100305744" class="indexterm"></a><p>Alapértelmezés szerint a Bluetooth
	kommunikáció nem hitelesítõdik
	és bármelyik eszköz képes
	bármelyik másikkal felvenni a kapcsolatot.  Egy
	Bluetooth eszköz (például egy mobiltelefon)
	egy adott szolgáltatáshoz igényelhet
	hitelesítést (például
	betárcsázáshoz).  A Bluetooth alapú
	hitelesítés többnyire <span class="emphasis"><em>PIN
	kódokkal</em></span> történik.  A PIN
	kód egy legfeljebb 16 karakterbõl álló
	ASCII karakterlánc.  A felhasználóknak mind
	a két eszközön ugyanazt a PIN kódot kell
	megadniuk.  Miután megadtuk a PIN kódot, az
	eszközök létrehoznak hozzájuk egy
	<span class="emphasis"><em>összekötettésbeli kulcsot</em></span>
	(link key).  Ezután ezt a kulcsot vagy az
	eszközökön tároljuk vagy pedig valamilyen
	tartós tárolón.  A következõ
	alkalommal mind a két eszközt ezt a korábban
	elkészített kulcsot fogja használni.  Ezt
	az eljárást nevezik
	<span class="emphasis"><em>párosításnak</em></span>
	(pairing).  Ha valamelyik eszköz elveszti az
	össszeköttetés kulcsát, akkor a
	párosítást meg kell
	ismételni.</p><p>A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a> démon felelõs az összes
	Bluetooth alapú hitelesítési
	kérés lekezeléséért.  Az
	alapértelmezett konfigurációs
	állománya az
	<code class="filename">/etc/bluetooth/hcsecd.conf</code>.
	Például így tudjuk benne egy
	mobiltelefonhoz megadni az <span class="quote">"<span class="quote">1234</span>"</span> PIN
	kódot:</p><pre class="programlisting">device {
        bdaddr  00:80:37:29:19:a4;
        name    "Pav T39-ese";
        key     nokey;
        pin     "1234";
      }</pre><p>Semmilyen korlátozás nincs a PIN
	kódokra (a méretüktõl eltekintve).
	Egyes eszközökbe (például a Bluetooth
	fejhallgatók) elõre rögzített PIN
	kódot építettek bele.  A
	<code class="option">-d</code> kapcsoló hatására a
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a> démont az elõtérben lehet
	futtatni, így könnyebben láthatjuk mi
	történik.  A távoli eszközt
	állítsuk be a párosítás
	elfogadására és kezdeményezzünk
	felé egy Bluetooth kapcsolatot.  A távoli
	eszköznek erre azt kell válaszolnia, hogy elfogadta
	a párosítást, majd kérni fogja a PIN
	kódot.  Adjuk meg ugyanazt a PIN kódot, mint amit
	a <code class="filename">hcsecd.conf</code> állományba is
	beírtunk.  Most már a gépünk és
	a távoli eszköz párban vannak.  A
	párosítást a távoli
	eszközrõl is kezdeményezhetjük.</p><p>A FreeBSD 5.5, 6.1 és újabb
	változataiban az <code class="filename">/etc/rc.conf</code>
	állományba a következõ sort kell
	felvenni a <span class="application">hcsecd</span> automatikus
	indításához:</p><pre class="programlisting">hcsecd_enable="YES"</pre><p>Ez pedig a <span class="application">hcsecd</span> démon
	által generált kimenetre példa:</p><pre class="programlisting">hcsecd[16484]: Got Link_Key_Request event from 'ubt0hci', remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name 'Pav's T39', link key doesn't exist
hcsecd[16484]: Sending Link_Key_Negative_Reply to 'ubt0hci' for remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Got PIN_Code_Request event from 'ubt0hci', remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name 'Pav's T39', PIN code exists
hcsecd[16484]: Sending PIN_Code_Reply to 'ubt0hci' for remote bdaddr 0:80:37:29:19:a4</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100351952"></a>31.4.7. Service Discovery Protocol (SDP)</h3></div></div></div><a id="idp100356816" class="indexterm"></a><p>A Service Discovery Protocol (SDP)
	segítségével a kliens alkalmazások
	képes felderíteni, hogy a szerver
	alkalmazások részérõl milyen
	szolgáltatások érhetõek el, valamint
	ezek a szolgáltatások milyen
	tulajdonságokkal rendelkeznek.  A
	szolgáltatások tulajdonsági
	közé soroljuk többek között a
	felajánlott szolgáltatás
	típusát vagy osztályát, illetve a
	szolgáltatás kihasználásához
	szükséges mechanizmusra vagy protokollra
	vonatkozó információkat.</p><p>Az SDP az SDP szerver és az SDP kliens közti
	kommunikációt foglalja magában.  A szerver
	karbantart egy listát azokról a
	szolgáltatási rekordokról, amelyek a
	szerverhez tartozó szolgáltatások
	jellemzõit írják le.  Mindegyik ilyen
	szolgáltatási rekord egyetlen
	szolgáltatás adatait tartalmazza.  A kliensek egy
	SDP kéréssel ezeket a szolgáltatási
	rekordokat kérhetik el az SDP szervertõl.
	Amennyiben a kliens, vagy a hozzá tartozó
	alkalmazás a szolgáltatás használata
	mellett dönt, akkor a szolgáltatás
	használatához a megfelelõ
	szolgáltató felé nyitnia kell egy
	külön kapcsolatot.  Az SDP csak a
	szolgáltatások és azok
	tulajdonságainak felderítéséhez ad
	segítséget, de semmilyen eszközt nem
	tartalmaz a felhasználásukra.</p><p>Általában az SDP kliensek
	általában valamilyen számunkra kellõ
	tulajdonság alapján keresnek
	szolgáltatásokat.  Ráadásul
	adódhatnak olyan alkalmak is, amikor a
	szolgáltatások elõzetes ismerete
	nélkül szeretnénk felderíteni a
	rendelkezésre álló
	szolgáltatások típusait.  A
	felajánlott szolgáltatások ilyen
	típusú feldolgozását nevezzük
	<span class="emphasis"><em>böngészésnek</em></span>
	(browsing).</p><p>Az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> Bluetooth SDP szerver és a
	parancssoros <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sdpcontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sdpcontrol</span>(8)</span></a> kliens az alap FreeBSD
	telepítés része.  Az alábbi
	példában egy SDP böngészési
	kérést adunk ki:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sdpcontrol -a 00:01:03:fc:6e:ec browse</code></strong>
Record Handle: 00000000
Service Class ID List:
        Service Discovery Server (0x1000)
Protocol Descriptor List:
        L2CAP (0x0100)
                Protocol specific parameter #1: u/int/uuid16 1
                Protocol specific parameter #2: u/int/uuid16 1

Record Handle: 0x00000001
Service Class ID List:
        Browse Group Descriptor (0x1001)

Record Handle: 0x00000002
Service Class ID List:
        LAN Access Using PPP (0x1102)
Protocol Descriptor List:
        L2CAP (0x0100)
        RFCOMM (0x0003)
                Protocol specific parameter #1: u/int8/bool 1
Bluetooth Profile Descriptor List:
        LAN Access Using PPP (0x1102) ver. 1.0
</pre><p>és így tovább.  Mindegyik
	szolgáltatáshoz hozzátartozik a
	tulajdonságok egy listája (például
	RFCOMM csatorna).  Lehetséges, hogy
	szolgáltatástól függõen bizonyos
	tulajdonságokat kell figyelnünk.  Egyes Bluetooth
	implementációk nem támogatják a
	szolgáltatások
	böngészését és ezért egy
	üres listát adnak vissza.  Ebben az esetben egy
	konkrét szolgáltatásra tudunk
	rákeresni.  A következõ példában
	az OBEX Object Push (OPUSH) szolgáltatást
	keressük:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sdpcontrol -a 00:01:03:fc:6e:ec search OPUSH</code></strong></pre><p>FreeBSD alatt az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> szerverrel tudunk
	szolgáltatásokat felajánlani a Bluetooth
	klienseknek.  A FreeBSD 5.5, 6.1 vagy késõbbi
	változataiban ehhez a következõ sort kell
	megadnunk az <code class="filename">/etc/rc.conf</code>
	állományban:</p><pre class="programlisting">sdpd_enable="YES"</pre><p>Ezután az <span class="application">sdpd</span>
	démon így indítható el:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/sdpd start</code></strong></pre><p>A távoli kliensek részére Bluetooth
	szolgáltatásokat felajánlani
	kívánó helyi szerver alkalmazásoknak
	regisztrálniuk kell magukat a helyi SDP
	démonnál.  Például az egyik ilyen
	alkalmazás az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a>, és
	elindítása után regisztrálni fogja a
	Bluetooth LAN szolgáltatást a helyi SDP
	démonnál.</p><p>A helyi SDP szerveren regisztrált
	szolgáltatásokat a helyi vezérlési
	csatornán keresztül egy <code class="literal">browse</code>
	kéréssel tudjuk lekérdezni:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sdpcontrol -l browse</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100373840"></a>31.4.8. A betárcsázós hálózati
	és a PPP hálózati
	hozzáférési (LAN) profilok</h3></div></div></div><p>A betárcsázós hálózati
	(Dial-Up Networking, DUN) profil leggyakrabban a modemek
	és mobiltelefonok között tûnik fel.  Ez a
	profil a következõ forgatókönyveket
	dolgozza fel:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A számítógépünkkel egy
	    mobiltelefont vagy modemet vezeték
	    nélküli modemként használunk,
	    amivel az internethez vagy más
	    hálózatokhoz csatlakozunk
	    betárcsázással.</p></li><li class="listitem"><p>A számítógépünkkel egy
	    mobiltelefonon vagy modemen keresztül fogadunk
	    adathívásokat.</p></li></ul></div><p>A PPP hálózati
	hozzáférési (LAN) profil a
	következõ helyezetekben alkalmazható:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>LAN hozzáférés egyetlen Bluetooth
	    eszközhöz</p></li><li class="listitem"><p>LAN hozzáférés több Bluetooth
	    eszközhöz</p></li><li class="listitem"><p>Két gép összekötése (a
	    soros vonali kapcsolat emulációval PPP-n
	    keresztül)</p></li></ul></div><p>FreeBSD alatt mind a két profilt a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> és
	az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> valósítja meg - egy
	olyan wrapper eszköz, amely az RFCOMM Bluetooth
	kapcsolatokat a PPP számára is
	értelmessé alakítja át.
	Mielõtt még bármelyik profilt
	elkezdenénk használni, egy új PPP
	címkét kell létrehozni az
	<code class="filename">/etc/ppp/ppp.conf</code>
	állományban.  Erre példát az
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> man oldalon találhatunk.</p><p>A következõ példában az
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> programot fogjuk használni arra, hogy
	egy RFCOMM típusú kapcsolatot nyissunk a
	00:80:37:29:19:a4 címmel rendelkezõ távoli
	Bluetooth eszköz felé.  A tényleges RFCOMM
	csatorna számát SDP-n keresztül a
	távoli eszköztõl kapjuk.  Az RFCOMM csatorna
	kézzel is megadható, és ilyen esetekben az
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> nem fog SDP kérést
	küldeni.  A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sdpcontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sdpcontrol</span>(8)</span></a> használatával
	tudjuk lekérdezni a távoli eszközön
	létrejött RFCOMM csatornát.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rfcomm_pppd -a 00:80:37:29:19:a4 -c -C dun -l rfcomm-dialup</code></strong></pre><p>A PPP hálózati elérés (LAN)
	szolgáltatás beindításához
	futni kell a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> szervernek.  A helyi
	hálózaton keresztül csatlakozó
	kliensekhez létre kell hozni egy új
	bejegyzést az <code class="filename">/etc/ppp/ppp.conf</code>
	állományban.  Az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> man oldalon
	találhatunk erre példákat.
	Végezetül indítsuk el az RFCOMM PPP szervert
	egy érvényes RFCOMM csatornaszámmal.  Az
	RFCOMM PPP szerver ekkor automatikusan regisztrálja a
	Bluetooth LAN szolgáltatást a helyi SDP
	démonnál.  A következõ
	példában megmutatjuk, hogyan lehet
	elindítani egy RFCOMM PPP szervert:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rfcomm_pppd -s -C 7 -l rfcomm-server</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100394192"></a>31.4.9. Az OBEX Object Push (OPUSH) profil</h3></div></div></div><a id="idp100394832" class="indexterm"></a><p>Az OBEX egy széles körben alkalmazott protokoll
	a mobileszközök közti egyszerû
	állományvitelre.  Legfõképpen az
	infravörös kommunikációban
	alkalmazzák, ahol a laptopok vagy PDA-k közti
	általános állományátvitelre
	használják, illetve
	névjegykártyák vagy
	naptárbejegyzések
	átküldésére mobiltelefonok
	között és egyéb PIM alkalmazást
	futtató eszközök esetében.</p><p>Az OBEX szervert és klienst egy külsõ
	csomag, az <span class="application">obexapp</span>
	valósítja meg, amelyet az <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/comms/obexapp/pkg-descr">comms/obexapp</a> portból
	érhetünk el.</p><p>Az OBEX kliens használható objektumok
	áttolására vagy
	lehúzására az OBEX szerverhez.  Ez az
	objektum lehet például egy
	névjegykártya vagy egy megbeszélt
	találkozó.  Az OBEX kliens SDP-n keresztül
	tud magának RFCOMM csatornaszámot szerezni.  Ezt
	úgy tehetjük meg, ha a szolgáltatás
	neve helyett egy RFCOMM csatorna számát adjuk meg.
	A támogatott szolgáltatások: IrMC, FTRN
	és OPUSH.  Számként RFCOMM csatorna is
	megadható.  Az alábbi példában egy
	OBEX munkamenetet láthatunk, ahol az eszköz
	információs objektumát húzzuk le a
	mobiltelefonról és egy új objektumot (egy
	névjegykártyát) tolunk fel a telefon
	könyvtárába.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>obexapp -a 00:80:37:29:19:a4 -C IrMC</code></strong>
obex&gt; get telecom/devinfo.txt devinfo-t39.txt
Success, response: OK, Success (0x20)
obex&gt; put new.vcf
Success, response: OK, Success (0x20)
obex&gt; di
Success, response: OK, Success (0x20)</pre><p>Az OBEX objektumok tologatásának
	támogatásához az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> szervernek
	kell futnia.  Továbbá a beérkezõ
	objektumok tárolásához létre kell
	hoznunk még egy könyvtárat is.  Ez az
	könyvtár alapértelmezés szerint a
	<code class="filename">/var/spool/obex</code>.  Végül
	indítsuk el az OBEX szervert egy érvényes
	RFCOMM csatorna számának
	megadásával.  Az OBEX szerver ezután
	automatikusan regisztrálja az <span class="quote">"<span class="quote">OBEX Object
	Push</span>"</span> nevû szolgáltatást a helyi SDP
	démonnál.  Ebben a példában
	láthatjuk az OBEX szerver
	indítását:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>obexapp -s -C 10</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100401488"></a>31.4.10. Soros vonali profil (SPP)</h3></div></div></div><p>A soros vonali profil (Serial Port Profile, SPP)
	használatával RS232 (vagy ahhoz hasonló)
	vonali adatátvitelt tudunk emulálni.  Ez a profil
	a régebben fejlesztett alkalmazásokkal
	birkózik meg, és a Bluetooth
	technológiával valódi kábel helyett
	egy virtuális soros portot képez le.</p><p>Az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_sppd&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rfcomm_sppd</span>(1)</span></a> segédprogram ezt a soros
	vonali profilt valósítja meg.  Így egy
	pszeudo terminált tudunk virtuális soros
	portként használni.  Ha nem adunk meg RFCOMM
	csatornát, akkor az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_sppd&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rfcomm_sppd</span>(1)</span></a> képes
	SDP-n keresztül kérni egyet magának a
	távoli eszköztõl.  Ha ezt felül
	kívánjuk bírálni, akkor a
	parancssorban megadhatunk akár egy konkrét RFCOMM
	csatornát is.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rfcomm_sppd -a 00:07:E0:00:0B:CA -t /dev/ttyp6</code></strong>
rfcomm_sppd[94692]: Starting on /dev/ttyp6...</pre><p>Miután csatlakoztunk, a pszeudo terminált
	tudjuk soros portként használni:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cu -l ttyp6</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100415184"></a>31.4.11. Hibaelhárítás</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100415824"></a>31.4.11.1. Nem tudunk csatlakozni a távoli
	  eszközzel</h4></div></div></div><p>Egyes Bluetooth eszközök nem
	  támogatják a szerepek cseréjét
	  (role switch).  Alapértelmezés szerint amikor a
	  FreeBSD elfogad egy új kapcsolatot,
	  megpróbál rajta szerepet cserélni
	  és mesterré válni.  Azok az
	  eszközök, amelyek ezt nem támogatják,
	  nem lesznek képesek emiatt csatlakozni.  Ez a
	  szerepváltás az új kapcsolatok
	  felépítése során zajlik le,
	  ezért egy távoli eszköztõl nem lehet
	  megtudni, hogy ismeri-e ezt a lehetõséget.  A
	  helyi oldalon a következõ HCI opcióval lehet
	  kikapcsolni a szerepcserét:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>hccontrol -n ubt0hci write_node_role_switch 0</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100417872"></a>31.4.11.2. Valami nem megy.  Lehet látni valahogy, pontosan
	  mi is történik?</h4></div></div></div><p>Persze, igen.  Egy külsõ csomag, a
	  <span class="application">hcidump</span>
	  segítségével, amely a <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/comms/hcidump/pkg-descr">comms/hcidump</a> portból
	  érhetõ el.  A <span class="application">hcidump</span>
	  segédprogram a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a> programhoz
	  hasonlítható.  Ezzel lehet a Bluetooth csomagok
	  tartalmát megnézni a terminálon vagy
	  elmenteni ezeket egy állományba.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-wireless.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="network-bridging.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">31.3. Vezeték nélküli
      hálózatok </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 31.5. Hálózati hidak</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>