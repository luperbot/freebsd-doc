<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>15.4. A jailek létrehozása és vezérlése</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="jails.html" title="15. fejezet - A jail alrendszer" /><link rel="prev" href="jails-intro.html" title="15.3. Bevezetés" /><link rel="next" href="jails-tuning.html" title="15.5. Finomhangolás és karbantartás" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">15.4. A jailek létrehozása és
      vezérlése</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="jails-intro.html">Vissza</a> </td><th width="60%" align="center">15. fejezet - A jail alrendszer</th><td width="20%" align="right"> <a accesskey="n" href="jails-tuning.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-build"></a>15.4. A jailek létrehozása és
      vezérlése</h2></div></div></div><p>Egyes rendszergazdák a jaileket a következõ
      két típusba sorolják: <span class="quote">"<span class="quote">teljes</span>"</span>
      jail, mely egy valódi FreeBSD rendszerre emlékeztet,
      és a <span class="quote">"<span class="quote">szolgáltatás</span>"</span> jail, mely
      egyetlen, feltehetõen kiemelt jogokkal futó
      alkalmazás vagy szolgáltatás
      számára van elõkészítve.  Ez a
      besorolás csupán fogalmi szintû, a jail
      felépítésének módját nem
      befolyásolja.  A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> man oldal részletesen
      ismerteti a jailek létrehozását:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setenv D /itt/lesz/a/jail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p $D</code></strong> <a id="jailpath"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildworld</code></strong> <a id="jailbuildworld"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld DESTDIR=$D</code></strong> <a id="jailinstallworld"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make distribution DESTDIR=$D</code></strong> <a id="jaildistrib"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>mount -t devfs devfs $D/dev</code></strong> <a id="jaildevfs"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#jailpath"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Érdemes elõször a jail helyét
	  megválasztani.  Itt fog fizikailag helyet foglalni a
	  befogadó rendszer
	  állományrendszerén belül a jail.
	  Jó választás lehet erre a <code class="filename">/usr/jail/jailnév</code>,
	  ahol a <em class="replaceable"><code>jailnév</code></em> a jailt
	  azonosító rendszernév.  A <code class="filename">/usr/</code>
	  állományrendszeren általában
	  elegendõ hely jut a jail
	  állományrendszerének, ami egy
	  <span class="quote">"<span class="quote">teljes</span>"</span> jail esetén
	  lényegében a FreeBSD alaprendszer
	  alapértelmezett telepítésében
	  megtalálható összes állomány
	  másolatát tartalmazza.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jailbuildworld"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Ha korábban már a <code class="command">make
	  world</code> vagy a <code class="command">make buildworld</code>
	  parancs segítségével
	  újrafordítottuk az alaprendszert, akkor ezt a
	  lépést ki is hagyhatjuk és
	  telepítsük az új alaprendszert
	  közvetlenül az új jailbe.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jailinstallworld"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Ez a parancs fogja felmásolni a jail fizikai
	  helyének választott
	  könyvtár-részfába a
	  mûködéshez szükséges programokat,
	  függvénykönyvtárakat, man oldalakat
	  és így tovább.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildistrib"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>A <span class="application">make</span>
	  paramétereként megadott
	  <code class="buildtarget">distribution</code> cél gondoskodik
	  az összes szükséges
	  konfigurációs állomány
	  felmásolásáról.  Magyarán
	  szólva, átmásolja az összes
	  telepíhetõ állományt a <code class="filename">/usr/src/etc/</code>
	  könyvtárból a jail <code class="filename">/etc</code>
	  alkönyvtárába, vagyis a <code class="filename">$D/etc/</code>
	  könyvtárba.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildevfs"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>A jaileken belül a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a>
	  csatlakoztatása nem kötelezõ.
	  Másrészt azonban majdnem mindegyik
	  alkalmazás, a feladatától
	  függõen, legalább egy eszközhöz
	  hozzá akar férni.  Nagyon fontos, hogy a
	  kezünkbe vegyük a eszközök
	  hozzáférésének
	  irányítását a jaileken belül,
	  mivel a helytelen beállítások
	  révén a támadók csúnya
	  dolgokat tudnak majd mûvelni.  A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a>
	  mûködését a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> és
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs.conf</span>(5)</span></a> man oldalakon is ismertetett
	  szabályrendszerek
	  irányítják.</p></td></tr></table></div><p>Ahogy a jailt telepítettük, a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>
      segédprogrammal tudjuk elindítani.  A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>
      négy kötelezõ paramétert vár,
      melyekre a <a class="xref" href="jails-intro.html#jails-what" title="15.3.1. Mi is az a jail?">15.3.1. szakasz - Mi is az a jail?</a>ban ki is
      térünk.  Más paramétereket is
      megadhatunk, például azt, hogy az elzárt
      program egy adott felhasználó jogaival fusson.  A
      <code class="option"><em class="replaceable"><code>command</code></em></code>
      paraméter használata a jail
      típusától függ: egy
      <span class="emphasis"><em>virtuális rendszer</em></span> esetében a
      <code class="filename">/etc/rc</code> jó választásnak
      bizonyulhat, mivel ennek segítségével egy
      valódi FreeBSD rendszerindítási
      folyamatát játszhatjuk le.  Amennyiben elzárt
      <span class="emphasis"><em>szolgáltatás</em></span>ról van
      szól, az adott szolgáltatástól vagy
      alkalmazástól függ.</p><p>A jaileket gyakran már a rendszerindítás
      során elindítják, amit a FreeBSD
      <code class="filename">rc</code> mechanizmusa nagyban meg is
      könnyít.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>A rendszer indítása során
	  aktiválandó jailek listáját
	  vegyük hozzá a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>
	  állományhoz:</p><pre class="programlisting">jail_enable="YES"   # Ide NO-t írjunk, ha ki akarjuk kapcsolni
jail_list="<em class="replaceable"><code>www</code></em>"     # Szóközzel elválasztva soroljuk fel a jaileket</pre><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">A <code class="varname">jail_list</code>
	    értékeként felsorolt jailek nevei csak
	    betûket és számjegyeket
	    tartalmazhatnak.</p></div></li><li class="step"><p>A <code class="varname">jail_list</code>-ben szereplõ
	  összes jailt meg kell adnunk az ezeket
	  leíró <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>-beli
	  beállításokat:</p><pre class="programlisting">jail_<em class="replaceable"><code>www</code></em>_rootdir="/usr/jail/www"     # a jail gyökérkönyvtára
jail_<em class="replaceable"><code>www</code></em>_hostname="<em class="replaceable"><code>www</code></em>.example.org"  # a jail neve
jail_<em class="replaceable"><code>www</code></em>_ip="192.168.0.10"           # a jail IP-címe
jail_<em class="replaceable"><code>www</code></em>_devfs_enable="YES"          # legyen-e devfs a jailen belül
jail_<em class="replaceable"><code>www</code></em>_devfs_ruleset="<em class="replaceable"><code>www_ruleset</code></em>" # az alkalmazott devfs szabályrendszer</pre><p>Az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> állományban szereplõ
	  jailek esetén a <code class="filename">/etc/rc</code> szkript
	  fut le, tehát feltételezi, hogy az így
	  megadott jail egy teljes virtuális rendszer.  A
	  szolgáltatások jailbe foglalásához
	  meg kell változtatnunk a jail alapértelmezett
	  parancsát is.  Ezt a
	  <code class="varname">jail_<em class="replaceable"><code>jailnév</code></em>_exec_start</code>
	  opció megfelelõ
	  beállításával tudjuk
	  megtenni.</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Az összes itt elérhetõ opciót a
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> man oldalon találhatjuk meg.</p></div></li></ol></div><p>Ha léteznek a megfelelõ bejegyzések az
      <code class="filename">rc.conf</code> állományban, akkor az
      <code class="filename">/etc/rc.d/jail</code> szkript is
      használható arra, hogy a jaileket kézzel
      indítsuk el vagy állítsuk le:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/jail start www</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/jail stop www</code></strong></pre><p>A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> leállítására jelen
      pillanatban még nem érhetõ el szabályos
      módszer.  Ez azért van, mert a szabályos
      rendszerleállítást elvégzõ
      parancsok nem használhatóak a jailen belül.
      Emiatt a jaileket a legtisztábban úgy tudjuk
      leállítani, ha kiadjuk az alábbi parancsot
      magában a jailben vagy pedig a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a>
      segédprogrammal a jailen kívülrõl:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh /etc/rc.shutdown</code></strong></pre><p>Errõl a témáról többet a
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> man oldalon olvashatunk.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jails-intro.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="jails.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="jails-tuning.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">15.3. Bevezetés </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 15.5. Finomhangolás és karbantartás</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>