<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>18.16. A lemezpartíciók titkosítása</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="disks.html" title="18. fejezet - Háttértárak" /><link rel="prev" href="quotas.html" title="18.15. Az állományrendszerek kvótái" /><link rel="next" href="swap-encrypting.html" title="18.17. A lapozóterület titkosítása" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">18.16. A lemezpartíciók
      titkosítása</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="quotas.html">Vissza</a> </td><th width="60%" align="center">18. fejezet - Háttértárak</th><td width="20%" align="right"> <a accesskey="n" href="swap-encrypting.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-encrypting"></a>18.16. A lemezpartíciók
      titkosítása</h2></div><div><span class="authorgroup">Írta: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Green</span>, <span class="firstname">Lucky</span></span>. </span></div></div></div><a id="idp91082576" class="indexterm"></a><p>A FreeBSD kitûnõ futásközbeni
      védelmet ajánl fel az adatok illetéktelen
      hozzáférése ellen.  Az
      állományok engedélyei és a
      kötelezõ
      hozzáférés-vezérlés (Mandatory
      Access Control, MAC, lásd <a class="xref" href="mac.html" title="16. fejezet - Kötelezõ hozzáférés-vezérlés (MAC)">16. fejezet - <em>Kötelezõ
    hozzáférés-vezérlés (MAC)</em></a>)
      segítenek megvédeni érzékeny
      adatainkat az illéktelenek ellen az operációs
      rendszer futása és a
      számítógép mûködése
      során.  Azonban az operációs rendszerben
      kezelt engedélyek teljesen hatástalanok abban az
      esetben, ha a támadó fizikailag is képes
      hozzáférni a
      számítógépünkhöz,
      eltávolítani a merevlemezt és egy
      másik operációs rendszer
      segítségével kielemezni a rajta
      található fontos adatainkat.</p><p>Függetlenül attól, hogy a
      támadó valójában miként is
      férkõzött hozzá a
      merevlemezünkhöz, vagy miként kapcsolta le a
      számítógépünket, a FreeBSD
      megtalálható <span class="application">GEOM alapú
      lemeztitkosítás (gbde)</span> és a
      <code class="command">geli</code> titkosítási alrendszer
      egyaránt képes védelmet nyújtani a
      számítógépen található
      állományrendszerek számára az
      értékes adatok után kutató igen
      motivált betörõk ellen.  A csupán egyes
      állományokra kiterjedõ körmönfont
      titkosítási módszerekkel szemben a
      <code class="command">gbde</code> és a <code class="command">geli</code> az
      egész állományrendszert
      észrevétlen módon titkosítja.
      Titkosítatlan adat nem is kerül a merevlemezre.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91086416"></a>18.16.1. A lemez titkosítása a
	<span class="application">gbde</span>
	használatával</h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Váljunk <code class="systemitem">root</code>
	    felhasználóvá</strong></p><p>A <span class="application">gbde</span>
	    beállításához
	    rendszeradminisztrátori jogosultságokra lesz
	    szükségünk.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>su -</code></strong>
Password:</pre></li><li class="step"><p class="title"><strong>Adjuk hozzá a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">gbde</span>(4)</span></a>
	    támogatását a rendszermag
	    konfigurációs
	    állományához</strong></p><p>Tegyük a következõ sort a rendszermag
	    beállításait tartalmazó
	    állományba:</p><p><code class="literal">options GEOM_BDE</code></p><p>Fordítsuk újra a rendszermagot a <a class="xref" href="kernelconfig.html" title="8. fejezet - A FreeBSD rendszermag testreszabása">8. fejezet - <em>A FreeBSD rendszermag testreszabása</em></a>ben leírtak szerint.</p><p>Indítsuk el a
	    számítógépet az új
	    rendszermaggal.</p></li><li class="step"><p>A rendszermag újrafordítása helyett
	    a <code class="command">kldload</code> paranccsal is
	    betölthetjük a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">gbde</span>(4)</span></a>
	    modulját:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload geom_bde</code></strong></pre></li></ol></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91101648"></a>18.16.1.1. A titkosított merevlemez
	elõkészítése</h4></div></div></div><p>A következõ példa azt feltételezi,
	hogy a rendszerünkhöz egy új merevlemezt adunk
	hozzá, amin egyetlen titkosított
	partíció foglal helyet.  Ezt a
	partíciót a <code class="filename">/private</code>
	könyvtárba fogjuk csatlakoztatni.  A
	<span class="application">gbde</span> használható a
	<code class="filename">/home</code> és a
	<code class="filename">/var/mail</code>
	titkosítására is, de ennek
	megvalósítása olyan bonyolult
	utasításokat igényel, amelyek
	meghaladják ennek a bevezetésnek a
	kereteit.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Az új merevlemez
	    hozzáadása</strong></p><p>A <a class="xref" href="disks-adding.html" title="18.3. Lemezek hozzáadása">18.3. szakasz - Lemezek hozzáadása</a>ban bemutatottak szerint
	    adjuk hozzá a rendszerünkhöz az új
	    merevlemezt.  A példában az új lemez
	    partícióját a
	    <code class="filename">/dev/ad4s1c</code> néven fogjuk
	    tudni elérni.  A
	    <code class="filename">/dev/ad0s1*</code>
	    eszközök a példában szereplõ
	    FreeBSD rendszer szabványos partícióit
	    jelölik.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls /dev/ad*</code></strong>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4</pre></li><li class="step"><p class="title"><strong>Hozzunk létre egy könyvtárat a gbde
	    zárolásainak
	    tárolásához</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /etc/gbde</code></strong></pre><p>A <span class="application">gbde</span>nek azért van
	    szüksége a zárolásokat
	    rögzítõ állományokra, hogy
	    hozzá tudjon férni a titkosított
	    partíciókhoz.  Amennyiben ezt nem tudja
	    megtenni, a <span class="application">gbde</span>
	    anélkül nem lesz képes visszafejteni a
	    titkosított partíciókon tárolt
	    adatokat, hogy az ezeket elérni akaró
	    szoftvereknek ne kelljen jelentõsebb
	    mértékben manuálisan beavatkoznia.
	    Mindegyik titkosított partíció
	    külön zároló állományt
	    használ.</p></li><li class="step"><p class="title"><strong>A gbde partíció
	    inicializálása</strong></p><p>A <span class="application">gbde</span> által
	    használt partíciókat használatuk
	    elõtt inicializálni kell.  Ezt a mûveletet
	    azonban csak egyszer kell elvégezni:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gbde init /dev/ad4s1c -i -L /etc/gbde/ad4s1c.lock</code></strong></pre><p>A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> ekkor elindít egy
	    szövegszerkesztõt és benne egy sablon
	    segítségével be tudjuk
	    állítani a különbözõ
	    konfigurációs értékeket.  Az
	    UFS1 vagy UFS2 használata esetén
	    állítsuk a szektorméretet
	    2048-ra:</p><pre class="programlisting">$FreeBSD: src/sbin/gbde/template.txt,v 1.1 2002/10/20 11:16:13 phk Exp $
#
# Sector size is the smallest unit of data which can be read or written.
# Making it too small decreases performance and decreases available space.
# Making it too large may prevent filesystems from working.  512 is the
# minimum and always safe.  For UFS, use the fragment size
#
sector_size     =       2048
[...]
</pre><p>A megjegyzés fordítása:</p><pre class="programlisting">A szektorméret az adatok írásának és olvasásának legkisebb egysége.  Ha
túlságosan kicsire választjuk meg, akkor csökken a teljesítmény és csökken a
rendelkezésre álló hely.  Ha viszont túlságosan nagyra hagyjuk, akkor azzal
akadályozzuk az állományrendszerek munkáját.  512 a legkisebb érték, amely mindig
megbízható.  Az UFS esetén használjuk a fragmensek méretét.</pre><p>A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> kétszer is rá fog
	    kérdeni az adatok titkosítására
	    használt jelmondatra.  A jelmondatnak
	    természetesen mind a kétszer ugyanannak kell
	    lennie.  A <span class="application">gbde</span>
	    védelmének hatékonysága teljesen
	    mértékben az általunk választott
	    jelmondat minõségétõl függ
	    <a href="#ftn.idp91129424" class="footnote" id="idp91129424"><sup class="footnote">[10]</sup></a>.</p><p>A <code class="command">gbde init</code> parancs létrehoz
	    egy zároló állományt a
	    <span class="application">gbde</span> partícióhoz,
	    amely ebben a példában az
	    <code class="filename">/etc/gbde/ad4s1c.lock</code> néven
	    keletkezett.  A <span class="application">gbde</span>
	    zároló állományainak
	    <span class="quote">"<span class="quote">.lock</span>"</span> névre kell
	    végzõdniük, mivel az
	    <code class="filename">/etc/rc.d/gbde</code>
	    indítószkript csak ebben az esetben
	    észleli rendesen.</p><div xmlns="" class="caution"><h3 class="admontitle">Figyelem: </h3><p xmlns="http://www.w3.org/1999/xhtml">A <span class="application">gbde</span> zároló
	      állományait a titkosított
	      partíciók tartalmával együtt
	      <span class="emphasis"><em>kell</em></span> lementeni.  Miközben a
	      zároló állomány
	      törlése nem tudja megakadályozni, hogy
	      az elszánt támadó visszafejtse a
	      <span class="application">gbde</span> által
	      titkosított partíciót, addig a
	      zároló állomány
	      nélkül a jogos tulajdonos órási
	      mennyiségû munka befektetése
	      nélkül képtelen lesz
	      hozzáférni a rajta levõ adatokhoz.  Ez
	      utóbbitól egyébként a
	      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> és a rendszer tervezõje is
	      totálisan elhatárolja magát.</p></div></li><li class="step"><p class="title"><strong>A titkosított partíció
	    illesztése a rendszermaghoz</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c.lock</code></strong></pre><p>Ekkor a titkosított partíció
	    illesztéséhez a rendszer kérni fogja az
	    inicializálás során választott
	    jelmondatot.  Ezután az új titkosított
	    eszköz megjelenik a <code class="filename">/dev</code>
	    könyvtárban
	    <code class="filename">/dev/eszköznév.bde</code>
	    néven:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls /dev/ad*</code></strong>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4        /dev/ad4s1c.bde</pre></li><li class="step"><p class="title"><strong>Állományrendszer
	    kialakítása egy titkosított
	    eszközön</strong></p><p>Ahogy sikerült a titkosított eszközt
	    illeszteni a rendszermaghoz, létre is tudunk hozni
	    egy állományrendszert rajta.  Erre a
	    célra a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a> remekül
	    használható.  Mivel egy új UFS2
	    állományrendszerek
	    inicializálása sokkal gyorsabb a régi
	    UFS1 állományrendszerek
	    inicializálásánál, ezért
	    a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a> használata esetén az
	    <code class="option">-O2</code> beállítás
	    megadása ajánlott.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U -O2 /dev/ad4s1c.bde</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a> parancsot egy illesztett
	      <span class="application">gbde</span> partíción
	      kell végrehajtani, amit onnan ismerhetünk meg,
	      hogy az eszköz nevében szerepel a
	      <code class="filename">*.bde</code>
	      kiterjesztés.</p></div></li><li class="step"><p class="title"><strong>A titkosított partíció
	    csatlakoztatása</strong></p><p>Hozzunk létre egy csatlakozási pontot a
	    titkosított állományrendszer
	    számára.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /privát</code></strong></pre><p>Csatlakoztassuk a titkosított
	    állományrendszert.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/ad4s1c.bde /privát</code></strong></pre></li><li class="step"><p class="title"><strong>Ellenõrizzük a titkosított
	    állományrendszer
	    mûködõképességét</strong></p><p>A titkosított állományrendszert
	    most már látja a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=df&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">df</span>(1)</span></a> program és
	    készen áll a használatra.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>df -H</code></strong>
Filesystem        Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a      1037M    72M   883M     8%    /
/devfs            1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f       8.1G    55K   7.5G     0%    /home
/dev/ad0s1e      1037M   1.1M   953M     0%    /tmp
/dev/ad0s1d       6.1G   1.9G   3.7G    35%    /usr
/dev/ad4s1c.bde   150G   4.1K   138G     0%    /private</pre></li></ol></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91170384"></a>18.16.1.2. Létezõ titkosított
	állományrendszerek csatlakoztatása</h4></div></div></div><p>A rendszer minden egyes indítása után
	az összes titkosított
	állományrendszert tényleges
	használata elõtt újra illeszteni kell a
	rendszermaghoz, ellenõrizni az épségét
	és csatlakoztatni.  Az ehhez szükséges
	parancsokat <code class="systemitem">root</code>
	felhasználóként kell kiadni.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>A gbde partíció illesztése a
	    rendszermaghoz</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c.lock</code></strong></pre><p>A <span class="application">gbde</span> partíció
	    inicializálása során megadott
	    jelmondatot kell megadnunk a mûvelet
	    elvégzéséhez.</p></li><li class="step"><p class="title"><strong>Az állományrendszer
	    épségének
	    ellenõrzése</strong></p><p>Mivel a titkosított
	    állományrendszerek az automatikus
	    csatlakoztatáshoz még nem
	    szerepeltethetõek az <code class="filename">/etc/fstab</code>
	    állományban, ezért az ilyen
	    állományrendszereket csatlakoztatásuk
	    elõtt manuálisan ellenõriztetni kell a
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> lefuttatásával.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>fsck -p -t ffs /dev/ad4s1c.bde</code></strong></pre></li><li class="step"><p class="title"><strong>A titkosított állományrendszer
	    csatlakoztatása</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/ad4s1c.bde /privát</code></strong></pre><p>A titkosított állományrendszer most
	    már készen áll a
	    használatra.</p></li></ol></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91184464"></a>18.16.1.2.1. A titkosított partíciók
	    önálló csatlakoztatása</h5></div></div></div><p>Lehet írni olyan szkriptet, amely a
	    titkosított partíciókat
	    magától illeszti, ellenõrzi és
	    csatlakoztatja, de biztonsági
	    megfontolásokból semmi esetben sem szabad
	    tartalmaznia a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> jelszavát.  Ehelyett azt
	    javasoljuk, hogy az ilyen szkripteknek külön meg
	    kelljen adni a jelszót konzolon vagy az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a>
	    használatán keresztül.</p><p>De használhatjuk a mellékelt
	    <code class="filename">rc.d</code> szkriptet is.  A szkript
	    paramétereit az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>
	    állományon keresztül adhatjuk meg,
	    például:</p><pre class="programlisting">gbde_autoattach_all="YES"
gbde_devices="ad4s1c"
gbde_lockdir="/etc/gbde"</pre><p>Ilyenkor a <span class="application">gbde</span> által
	    használt jelmondatot a rendszer
	    indításakor kell megadni.  Miután
	    begépeltük a megfelelõ jelmondatot, a
	    titkosított <span class="application">gbde</span>
	    partíció magától
	    csatlakoztatásra kerül.  Ez akkor lehet hasznos,
	    ha a <span class="application">gbde</span>
	    megoldását hordozható
	    számítógépeken
	    alkalmazzuk.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91191120"></a>18.16.1.3. A gbde által alkalmazott titkosítási
	  módszerek</h4></div></div></div><p>A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> a szektorok tartalmát 128 bites
	  AES használatával CBC módban
	  titkosítja.  A lemezen található minden
	  egyes szektort eltérõ AES kulccsal kódolja.
	  A <span class="application">gbde</span> kriptográfiai
	  felépítését, valamint mindazt,
	  hogy az egyes szektorok kulcsai miként
	  származtathatóak a felhasználó
	  által megadott jelmondatból, a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">gbde</span>(4)</span></a> man
	  oldalán olvashatjuk.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91194192"></a>18.16.1.4. Kompatibilitási problémák</h4></div></div></div><p>A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a> nem kompatibilis a
	  <span class="application">gbde</span> által
	  titkosított eszközökkel.  A
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a> indítása elõtt minden
	  <code class="filename">*.bde</code>
	  eszközt ki kell iktatni a rendszermagból,
	  különben az eszközök keresése
	  során össze fog omlani.  A
	  példánkban használt titkosított
	  eszközt a következõ paranccsal kell
	  lekapcsolni:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gbde detach /dev/ad4s1c</code></strong></pre><p>Továbbá megjegyezzük azt is, hogy a
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vinum&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">vinum</span>(4)</span></a> nem használja a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=geom&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">geom</span>(4)</span></a> alrendszert,
	  ezért a <span class="application">gbde</span>
	  alkalmazása során nem használhatunk
	  <span class="application">Vinum</span>-köteteket.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91205584"></a>18.16.2. A lemezek titkosítása a
	<code class="command">geli</code> használatával</h3></div><div><span class="authorgroup">Írta: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Gerzo</span>, <span class="firstname">Daniel</span></span>. </span></div></div></div><p>A FreeBSD 6.0 változatától kezdve egy
	új kriptográfiai GEOM osztály is a
	rendelkezésünkre áll, melyet pillanatnyilag
	Pawel Jakub Dawidek fejleszt.  A <code class="command">geli</code> segédprogram
	némileg különbözõ a
	<code class="command">gbde</code> megoldásától
	- más lehetõségeket kínál
	fel és a titkosítást is egy
	eltérõ séma mentén
	valósítja meg.</p><p>A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> legfontosabb jellemzõi a
	következõk:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=crypto&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">crypto</span>(9)</span></a> keretrendszerét használja
	    - tehát ha rendelkezünk
	    kriptográfiai hardverrel, akkor a
	    <code class="command">geli</code> automatikusan használni
	    fogja.</p></li><li class="listitem"><p>Több kriptográfiai algoritmust is ismer
	    (melyek jelenleg az AES, Blowfish és a 3DES).</p></li><li class="listitem"><p>Segítségével a
	    rendszerindításhoz használt
	    (gyökér) partíció is
	    titkosítható.  Ilyenkor a
	    szükséges jelmondatot a rendszer
	    indításakor kell megadni.</p></li><li class="listitem"><p>Két független kulcsot (például
	    egy <span class="quote">"<span class="quote">kulcsot</span>"</span> és egy <span class="quote">"<span class="quote">céges
	    kulcsot</span>"</span>) is használhatunk vele.</p></li><li class="listitem"><p>A <code class="command">geli</code> gyors - egyszerûen
	    csak szektorról szektorra titkosít.</p></li><li class="listitem"><p>Lehetõvé teszi a mesterkulcsok
	    mentését is
	    visszaállítását.  Ha a
	    felhasználó véletlenül
	    megsemmisítené a kulcsát, akkor a
	    biztonsági mentésbõl
	    helyreállított kulcsok
	    segítségével vissza tudjuk szerezni az
	    adatainkat is.</p></li><li class="listitem"><p>Segítségével a lemezeket
	    véletlenszerû, egyszeri jelszavakkal is
	    illeszthetjük - ez különösen
	    fontos lapozóterületek és ideiglenes
	    állományrendszerek esetében.</p></li></ul></div><p>A <code class="command">geli</code> által
	felkínált lehetõségekrõl a
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> man oldalán találhatunk
	többet.</p><p>A következõ lépések
	bemutatják, hogyan lehet a FreeBSD rendszermagjában
	engedélyezni a <code class="command">geli</code>
	támogatását, és hogyan lehet
	létrehozni és használni egy
	<code class="command">geli</code> titkosítással
	rendelkezõ adathordozót.</p><p>A <code class="command">geli</code> alkalmazásához
	legalább a FreeBSD 6.0-RELEASE vagy késõbbi
	változatára van szükségünk.
	Mivel a rendszermagot is módosítanunk kell,
	ezért rendszeradminisztrátori jogosultságok
	kellenek a mûveletek
	elvégzéséhez.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>A <code class="command">geli</code>
	    támogatásának hozzáadása
	    a rendszermaghoz</strong></p><p>Vegyük hozzá a következõ sorokat a
	    rendszermag beállításait
	    tartalmazó állományhoz:</p><pre class="programlisting">options GEOM_ELI
device crypto</pre><p>Fordítsuk újra a rendszermagot a <a class="xref" href="kernelconfig.html" title="8. fejezet - A FreeBSD rendszermag testreszabása">8. fejezet - <em>A FreeBSD rendszermag testreszabása</em></a>ben leírtak szerint.</p><p>Betölthetjük a <code class="command">geli</code>
	    modulját is a rendszer indításakor.
	    Ehhez a következõ sort kell betenni a
	    <code class="filename">/boot/loader.conf</code>
	    állományba:</p><pre class="programlisting">geom_eli_load="YES"</pre><p>A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> most már használható
	    a rendszermagban.</p></li><li class="step"><p class="title"><strong>A mesterkulcs legenerálása</strong></p><p>A most következõ példában egy
	    kulcsot tartalmazó állomány
	    létrehozását illusztráljuk, amit
	    a <code class="filename">/privát</code>
	    könyvtárba csatlakoztatott titkosított
	    adathordozó mesterkulcsához fogunk
	    használni.  A kulcs állomány a
	    mesterkulcs titkosításához
	    felhasznált véletlenszerû adatot fogja
	    tartalmazni, valamint rajta kívül még a
	    mesterkulcsot egy jelmondattal is védjük.  Az
	    adathordozó szektormérete 4 kilobyte-os
	    lesz.  Emellett még bemutatjuk, hogyan kell
	    illeszteni egy <code class="command">geli</code>-adathordozót,
	    állományrendszert létrehozni rajta,
	    csatlakoztatni, dolgozni vele és lekapcsolni.</p><p>A nagyobb teljesítmény
	    érdekében javasolt nagyobb
	    szektorméretet választani (mint
	    például 4 kilobyte).</p><p>A mesterkulcsot egy jelmondattal fogjuk védeni
	    és a kulcsok készítéséhez
	    használt adatforrás a
	    <code class="filename">/dev/random</code> lesz.  A
	    <code class="filename">/dev/da2.eli</code>, amelyet mit csak
	    adathordozónak fogunk csak hívni, szektorainak
	    mérete 4 kilobyte lesz.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/random of=/root/da2.key bs=64 count=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>geli init -s 4096 -K /root/da2.key /dev/da2</code></strong>
Enter new passphrase:
Reenter new passphrase:</pre><p>Nem kötelezõ egyszerre használni a
	    jelmondatot és a kulcs állományt.  A
	    mesterkulcs elzárásának
	    bebiztosítására bármelyik
	    módszer alkalmas.</p><p>Ha a kulcs állomány a <span class="quote">"<span class="quote">-</span>"</span>
	    paraméterrel adjuk meg, akkor a szabványos
	    bemenetrõl olvassa be a program.  Ez a példa
	    több kulcs használatát mutatja be.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat kulcs1 kulcs2 kulcs3 | geli init -K - /dev/da2</code></strong></pre></li><li class="step"><p class="title"><strong>Az adathordozó illesztése a
	    generált kulccsal</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>geli attach -k /root/da2.key /dev/da2</code></strong>
Enter passphrase:</pre><p>Az új titkosítatlan eszköz neve
	  <code class="filename">/dev/da2.eli</code>
	    lesz.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls /dev/da2*</code></strong>
/dev/da2  /dev/da2.eli</pre></li><li class="step"><p class="title"><strong>Az új állományrendszer
	    kialakítása</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/random of=/dev/da2.eli bs=1m</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/da2.eli</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/da2.eli /privát</code></strong></pre><p>A titkosított állományrendszer most
	    már <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=df&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">df</span>(1)</span></a> számára is
	    látszik és használható:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>df -H</code></strong>
Filesystem     Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a    248M    89M   139M    38%    /
/devfs         1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f    7.7G   2.3G   4.9G    32%    /usr
/dev/ad0s1d    989M   1.5M   909M     0%    /tmp
/dev/ad0s1e    3.9G   1.3G   2.3G    35%    /var
/dev/da2.eli   150G   4.1K   138G     0%    /private</pre></li><li class="step"><p class="title"><strong>Az adathordozó leválasztása
	    és lekapcsolása</strong></p><p>Miután befejeztük a munkát a
	    titkosított partíción, és a
	    <code class="filename">/privát</code>
	    partícióra már nincs tovább
	    szükségünk, érdemes
	    leválasztanunk és kiiktatnunk a
	    <code class="command">geli</code> titkosítású
	    partíciót a rendszermagból.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>umount /privát</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>geli detach da2.eli</code></strong></pre></li></ol></div><p>A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> használatáról
	bõvebben a saját man oldalán
	tájékozódhatunk.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91258064"></a>18.16.2.1. A <code class="filename">geli</code> <code class="filename">rc.d</code>
	  szkriptjének használata</h4></div></div></div><p>A <code class="command">geli</code> mellett találhatunk egy
	  saját <code class="filename">rc.d</code> szkriptet, amely
	  jelentõsen leegyszerûsíti a
	  <code class="command">geli</code> használatát.  A
	  <code class="command">geli</code> például így
	  paraméterezhetõ az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>
	  állományon keresztül:</p><pre class="programlisting">geli_devices="da2"
geli_da2_flags="-p -k /root/da2.key"</pre><p>Ennek segítségével a
	  <code class="filename">/dev/da2</code> eszközt
	  <code class="command">geli</code> adathordozóként
	  állítjuk be a <code class="filename">/root/da2.key</code>
	  állományban található mesterkulcs
	  felhasználásával, de az
	  illesztéskor a <code class="command">geli</code> nem kér
	  jelmondatot (ezt csak akkor fogja tenni, ha a <code class="literal">geli
	  init</code> parancs kiadásához
	  hozzátesszük a <code class="option">-P</code>
	  beállítást).  A rendszer
	  leállítása elõtt pedig a
	  <code class="command">geli</code> adathordozó így
	  automatikusan leválasztásra kerül.</p><p>Az <code class="filename">rc.d</code>
	  beállításával kapcsolatos
	  tudnivalókat a kézikönyv <a class="link" href="configtuning-rcd.html" title="11.7. Az rc használata FreeBSD alatt">rc.d</a> szkriptekrõl
	  szóló szakaszában ismerhetjük
	  meg.</p></div></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp91129424" class="footnote"><p><a href="#idp91129424" class="para"><sup class="para">[10] </sup></a>A könnyen megjegyezhetõ ám
		mégis biztonságos jelmondatok
		megválasztásához a <a class="link" href="http://world.std.com/~reinhold/diceware.html" target="_top">Diceware
		Passphrase</a> honlapján találunk egy
		kis segítséget
		(angolul).</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="quotas.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="swap-encrypting.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">18.15. Az állományrendszerek
      kvótái </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 18.17. A lapozóterület titkosítása</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>