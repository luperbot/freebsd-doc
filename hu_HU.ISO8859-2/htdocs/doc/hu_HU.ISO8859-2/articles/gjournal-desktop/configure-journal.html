<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>4. A naplózás beállítása</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Naplózó UFS használata asztali számítógépeken" /><link rel="up" href="index.html" title="Naplózó UFS használata asztali számítógépeken" /><link rel="prev" href="reserve-space.html" title="3. A FreeBSD telepítése során elvégzendõ lépések" /><link rel="next" href="troubleshooting-gjournal.html" title="5. A naplózás használata során felmerülõ hibák kezelése" /><link rel="copyright" href="trademarks.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. A naplózás
      beállítása</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="reserve-space.html">Vissza</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="troubleshooting-gjournal.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configure-journal"></a>4. A naplózás
      beállítása</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="running-gjournal"></a>4.1. A <code class="command">gjournal</code> futtatása</h3></div></div></div><p>A naplózást nagyon könnyû lesz
	beállítani miután már
	elõkészítettük az ehhez
	szükséges partíciókat.
	Váltsunk át egyfelhasználós
	módba, tehát jelentkezzünk be
	<code class="systemitem">root</code> felhasználóként
	és gépeljük be:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown now</code></strong></pre><p>Ezután az <span class="keycap"><strong>Enter</strong></span> billentyû
	lenyomásával megkapjuk az alapértelmezett
	parancsértelmezõt.  Válasszuk le azokat a
	partíciókat, amelyeken engedélyezni
	kívánjuk a naplózást.  Ezek a
	példánkban a <code class="filename">/usr</code> és
	<code class="filename">/var</code> partíciók voltak:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>umount /usr /var</code></strong></pre><p>Töltsük be a naplózáshoz
	szükséges modult:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal load</code></strong></pre><p>Most pedig a korábbi feljegyzéseink
	alapján állapítsuk meg melyik
	naplóhoz melyik partíciót fogjuk rendelni.
	A példánkban a <code class="filename">/usr</code>
	csatlakozási ponthoz az <code class="filename">ad0s1f</code> eszköz tartozik,
	és ennek a naplója az <code class="filename">ad0s1g</code> eszköz lesz,
	miközben a <code class="filename">/var</code> ponthoz az <code class="filename">ad0s1d</code> eszközt
	rendeltük, és ezt az <code class="filename">ad0s1h</code> eszközön
	naplózzuk.  Ennek megfelelõen a következõ
	parancsokat kell kiadnunk:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal label ad0s1f ad0s1g</code></strong>

GEOM_JOURNAL: Journal 2948326772: ad0s1f contains data.
GEOM_JOURNAL: Journal 2948326772: ad0s1g contains journal.

<code class="prompt">#</code> <strong class="userinput"><code>gjournal label ad0s1d ad0s1h</code></strong>

GEOM_JOURNAL: Journal 3193218002: ad0s1d contains data.
GEOM_JOURNAL: Journal 3193218002: ad0s1h contains journal.</pre><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">A <code class="command">gjournal</code> hibát fog jelezni, ha
	  bármelyik partíció utolsó szektora
	  már használatban van.  Ilyen helyzetekben az
	  <code class="option">-f</code> kapcsoló
	  segítségével
	  felülírásra tudjuk
	  kényszeríteni a parancsot, mint
	  például:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal label -f ad0s1d ad0s1h</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">Mivel most telepítettük a rendszerünket,
	  elég kicsi a valószínûsége,
	  hogy így bármit is ténylegesen
	  felülírnánk.</p></div><p>Létrejött két új eszköz,
	név szerint az <code class="filename">ad0s1d.journal</code> és az
	<code class="filename">ad0s1f.journal</code>.  Ezek
	képviselik azokat a <code class="filename">/var</code> és
	<code class="filename">/usr</code> partíciókat, amelyeket
	valójában csatlakoztatnunk kell.  A
	csatlakoztatásuk elõtt azonban
	állítsuk be hozzájuk a
	naplózást és tiltsuk le a Soft Updates
	használatát:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tunefs -J enable -n disable ad0s1d.journal</code></strong>

tunefs: gjournal set
tunefs: soft updates cleared

<code class="prompt">#</code> <strong class="userinput"><code>tunefs -J enable -n disable ad0s1f.journal</code></strong>

tunefs: gjournal set
tunefs: soft updates cleared</pre><p>Ezt követõen parancssorból csatlakoztassuk
	az új eszközöket a nekik megfelelõ pontokra
	(itt most már használhatjuk az
	<code class="option">async</code> beállítást):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -o async /dev/ad0s1d.journal /var</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -o async /dev/ad0s1f.journal /usr</code></strong></pre><p>Nyissuk meg az <code class="filename">/etc/fstab</code>
	állományt, és az elõbbiek szerint
	javítsuk ki a <code class="filename">/usr</code> és a
	<code class="filename">/var</code> állományrendszerekhez
	tartozó bejegyzéseket:</p><pre class="programlisting">/dev/ad0s1f.journal     /usr            ufs     rw,async      2       2
/dev/ad0s1d.journal     /var            ufs     rw,async      2       2</pre><div xmlns="" class="warning"><h3 class="admontitle">Figyelem: </h3><p xmlns="http://www.w3.org/1999/xhtml">Figyelmesen ellenõrizzük a bejegyzéseket,
	  mert ha hibásan adjuk meg ezeket, akkor az
	  újraindítás után gondok lehetnek a
	  rendszer indításával!</p></div><p>Végezetül gondoskodjunk róla, hogy a
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gjournal&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gjournal</span>(8)</span></a> modul minden egyes indítás
	során betöltõdjön.  Ehhez nyissuk meg a
	<code class="filename">/boot/loader.conf</code> állományt
	és adjuk hozzá a következõ sort:</p><pre class="programlisting">geom_journal_load="YES"</pre><p>Gratulálunk, sikeresen beállítottuk a
	rendszerünkön a naplózást!  Innen vagy az
	<strong class="userinput"><code>exit</code></strong> begépelésével
	lépjünk vissza a többfelhasználós
	módba, vagy egy újraindítással
	próbáljuk ki a konfiguráció
	eredményét (mi ezt javasoljuk).  A
	rendszerindítás során a
	következõhöz hasonló üzeneteket kell
	majd látnunk:</p><pre class="screen">ad0: 76293MB XEC XE800JD-00HBC0 08.02D08 at ata0-master SATA150
GEOM_JOURNAL: Journal 2948326772: ad0s1g contains journal.
GEOM_JOURNAL: Journal 3193218002: ad0s1h contains journal.
GEOM_JOURNAL: Journal 3193218002: ad0s1d contains data.
GEOM_JOURNAL: Journal ad0s1d clean.
GEOM_JOURNAL: Journal 2948326772: ad0s1f contains data.
GEOM_JOURNAL: Journal ad0s1f clean.</pre><p>Szabálytalan leállások esetén az
	iménti üzenetek némileg változhatnak,
	például:</p><pre class="screen">GEOM_JOURNAL: Journal ad0s1d consistent.</pre><p>Ez általában arra utal, hogy a
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gjournal&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gjournal</span>(8)</span></a> a naplóterületen tárolt
	információk segítségével
	helyreállította az
	állományrendszert.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="gjournal-new"></a>4.2. A naplózás engedélyezése
	frissen létrehozott partíciókon</h3></div></div></div><p>Míg az elõbbiekben tárgyalt
	megoldást leginkább olyan partíciók
	esetén alkalmazhatjuk, amelyek már eleve
	tartalmaznak adatokat, addig egy újonnan
	létrehozott partíciót némileg
	könnyebb naplózással ellátni, mivel
	ilyenkor az adat- és a naplóterület egyazon
	partíción is kialakítható.
	Például most tegyük fel, hogy
	hozzáadtunk egy újabb lemezt a
	rendszerünkhöz, amelyen
	készítettünk egy új <code class="filename">/dev/ad1s1d</code> nevû
	partíciót.  A napló
	létrehozása ekkor csupán ennyi:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal label ad1s1d</code></strong></pre><p>A napló mérete alapértelmezés
	szerint 1 GB lesz, amelyet viszont a <code class="option">-s</code>
	opció használatával tetszés szerint
	átállíthatunk.  Az értéket
	megadhatjuk byte-okban, vagy a <code class="literal">K</code>,
	<code class="literal">M</code>, illetve <code class="literal">G</code>
	hozzáfûzésével kilobyte-okban,
	megabyte-okban, illetve gigabyte-okban is.  Arra azonban
	figyeljünk, hogy a <code class="command">gjournal</code> nem enged
	túlságosan kis méretû naplót
	létrehozni.</p><p>Például egy 2 GB méretû
	napló az alábbi paranccsal hozható
	létre:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal label -s 2G ad1s1d</code></strong></pre><p>Mellé hozzunk létre egy
	állományrendszert az új
	partíción, ahol a <code class="option">-J</code>
	kapcsolóval engedélyezzük a
	naplózást:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>newfs -J /dev/ad1s1d.journal</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="configure-kernel"></a>4.3. A naplózás támogatásának
	beépítése a rendszermagba</h3></div></div></div><p>Amennyiben nem kívánjuk betölteni a
	<code class="literal">geom_journal</code> modult,
	lehetõségünk van közvetlenül a
	rendszermagba beépíteni a
	hozzá tartozó funkcionalitást.  Ehhez
	nyissunk meg (vagy hozzunk létre) egy saját
	rendszermag-konfigurációs állományt,
	és vegyük fel benne a következõ két
	sort:</p><pre class="programlisting">options UFS_GJOURNAL # Megjegyzés: Ez része a GENERIC rendszermagnak
options GEOM_JOURNAL # Ezt se felejtsük ki</pre><p>A <a class="link" href="../../../../doc/hu_HU.ISO8859-2/books/handbook/kernelconfig.html" target="_top">FreeBSD
	kézikönyvben</a> szereplõ
	utasítások mentén fordítsuk le
	és telepítsük az új
	rendszermagot.</p><p>Ha korábban használtuk volna a modult, akkor
	ezzel együtt ne felejtsük el kivenni a
	<code class="filename">/boot/loader.conf</code>
	állományból sem a
	hozzá tartozó sort.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="reserve-space.html">Vissza</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="troubleshooting-gjournal.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">3. A FreeBSD telepítése során
      elvégzendõ lépések </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 5. A naplózás használata során
      felmerülõ hibák kezelése</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>