<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>20.3. カーネル PPP の利用</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="ppp-and-slip.html" title="第20章 PPP と SLIP" /><link rel="prev" href="userppp.html" title="20.2. ユーザ ppp の利用" /><link rel="next" href="pppoe.html" title="20.4. PPP オーバイーサネット (PPPoE) の利用" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">20.3. カーネル PPP の利用</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="userppp.html">戻る</a>〓</td><th width="60%" align="center">第20章 PPP と SLIP</th><td width="20%" align="right">〓<a accesskey="n" href="pppoe.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ppp"></a>20.3. カーネル PPP の利用</h2></div></div></div><p><span class="emphasis"><em>原作: Gennady B. Sorokopud <code class="email">&lt;<a xmlns="" class="email" href="mailto:gena@NetVision.net.il">gena@NetVision.net.il</a>&gt;</code>, Robert Huff <code class="email">&lt;<a xmlns="" class="email" href="mailto:rhuff@cybercom.net">rhuff@cybercom.net</a>&gt;</code>.</em></span></p><p><span class="emphasis"><em>訳: 石墨 紀孝 <code class="email">&lt;<a xmlns="" class="email" href="mailto:graphite@jp.FreeBSD.org">graphite@jp.FreeBSD.org</a>&gt;</code>.
	1996 年 9 月 6 日.</em></span></p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94411216"></a>20.3.1. カーネル PPP の設定</h3></div></div></div><p>PPP の設定を始める前に, <code class="command">pppd</code> が
        <code class="filename">/usr/sbin</code> にあり, また
        <code class="filename">/etc/ppp</code> という
        ディレクトリが存在することを確認してください.</p><p><code class="command">pppd</code> はふたつのモードで動作します.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="quote">「<span class="quote">クライアント</span>」</span> モード.
            シリアル接続やモデムを利用して, そのマシンを
            外部のネットワークに PPP 接続したい場合に用います.</p></li><li class="listitem"><p><span class="quote">「<span class="quote">サーバ</span>」</span> モード.
            そのマシンがネットワーク上にあるときに, PPP を使って
            ほかのコンピュータを接続する際に用います.</p></li></ol></div><p>どちらの場合でも, オプションファイルを設定する必要があります
        (<code class="filename">/etc/ppp/options</code> または, そのマシン上で
        PPP を使用する人が 複数いる場合には
        <code class="filename">~/.ppprc</code>).</p><p>また, ダイヤルとリモートホストへの接続をおこなうために,
        シリアル接続やモデムを 操作する,
        なんらかのソフトウェアが必要です (kermit
        が適しているでしょう).</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94422352"></a>20.3.2. PPP クライアントとしての動作</h3></div></div></div><p>わたしは, CISCO ターミナルサーバの PPP 回線に接続するために,
	下記のような <code class="filename">/etc/ppp/options</code>
	を使用しています.</p><pre class="programlisting">crtscts         # enable hardware flow control
modem           # modem control line
noipdefault     # remote PPP server must supply your IP address.
                # if the remote host doesn't send your IP during IPCP
                # negotiation , remove this option
passive         # wait for LCP packets
domain ppp.foo.com      # put your domain name here

:&lt;remote_ip&gt;    # put the IP of remote PPP host here
                # it will be used to route packets via PPP link
                # if you didn't specified the noipdefault option
                # change this line to &lt;local_ip&gt;:&lt;remote_ip&gt;

defaultroute    # put this if you want that PPP server will be your
                # default router</pre><p>接続方法:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>kermit (またはその他のモデム操作プログラム)
	    を使ってリモートホストに ダイヤルし, 接続してください.
	    そして, あなたのユーザ名とパスワード (必要 であれば,
	    その他にもリモートホストで PPP を有効にするための操作)
	    を入力 します.</p></li><li class="step"><p>kermit を抜けてください. (回線を切断せずに)</p></li><li class="step"><p>下記のように入力します: </p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/src/usr.sbin/pppd.new/pppd /dev/tty01 19200</code></strong></pre><p>(通信速度とデバイス名には,
	    あなたの環境に適したものを入れてください)</p></li></ol></div><p>これでこのコンピュータは PPP で接続されました. もし,
	なんらかの理由で 接続に失敗したならば,
	<code class="filename">/etc/ppp/options</code> ファイルに
	<code class="option">debug</code>  オプションを追加して,
	問題点を突き止めるために, コンソールに表示される
	メッセージを調べてください.</p><p>下記の <code class="filename">/etc/ppp/pppup</code> スクリプトは,
	上記の作業を すべて自動的におこないます:</p><pre class="programlisting">#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.dial
pppd /dev/tty01 19200</pre><p><code class="filename">/etc/ppp/kermit.dial</code> は kermit
	用のスクリプトで, ダイヤルして,
	リモートホストでの認証に必要なすべての処理をおこないます.
	(そのようなスクリプトの例は
	この文書の終わりに添付してあります)</p><p>PPP 接続を切断するには, 下記のような
	<code class="filename">/etc/ppp/pppdown</code> スクリプトを
	使用します:</p><pre class="programlisting">#!/bin/sh
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ X${pid} != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill -TERM ${pid}
fi

ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

/sbin/ifconfig ppp0 down
/sbin/ifconfig ppp0 delete
kermit -y /etc/ppp/kermit.hup
/etc/ppp/ppptest</pre><p>PPP が動作中かどうかを調べます
	(<code class="filename">/usr/etc/ppp/ppptest</code>):</p><pre class="programlisting">#!/bin/sh
pid=`ps ax| grep pppd |grep -v grep|awk '{print $1;}'`
if [ X${pid} != "X" ] ; then
        echo 'pppd running: PID=' ${pid-NONE}
else
        echo 'No pppd running.'
fi
set -x
netstat -n -I ppp0
ifconfig ppp0</pre><p>モデム回線を切断します
	(<code class="filename">/etc/ppp/kermit.hup</code>):</p><pre class="programlisting">set line /dev/tty01	; put your modem device here
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
echo \13
exit</pre><p>次は <code class="command">kermit</code> の代わりに
	<code class="command">chat</code> を使う方法です.</p><p><span class="emphasis"><em>原作: Robert Huff <code class="email">&lt;<a xmlns="" class="email" href="mailto:rhuff@cybercom.net">rhuff@cybercom.net</a>&gt;</code>.</em></span></p><p>pppd 接続を確立するためには,
	次の二つのファイルの設定だけで十分です.</p><p><code class="filename">/etc/ppp/options</code>:</p><pre class="programlisting">/dev/cuaa1 115200

crtscts		# enable hardware flow control
modem		# modem control line
connect "/usr/bin/chat -f /etc/ppp/login.chat.script"
noipdefault	# remote PPP serve must supply your IP address.
	        # if the remote host doesn't send your IP during
                # IPCP negotiation, remove this option
passive         # wait for LCP packets
domain &lt;your.domain&gt;	# put your domain name here

:		# put the IP of remote PPP host here
	        # it will be used to route packets via PPP link
                # if you didn't specified the noipdefault option
                # change this line to &lt;local_ip&gt;:&lt;remote_ip&gt;

defaultroute	# put this if you want that PPP server will be
	        # your default router</pre><p><code class="filename">/etc/ppp/login.chat.script</code>:</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">(実際には一行になります.)</p></div><pre class="programlisting">ABORT BUSY ABORT 'NO CARRIER' "" AT OK ATDT&lt;phone.number&gt;
 CONNECT "" TIMEOUT 10 ogin:-\\r-ogin: &lt;login-id&gt;
 TIMEOUT 5 sword: &lt;password&gt;</pre><p>正しくインストールし編集した後は,
	必要な事はこれだけです</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pppd</code></strong></pre><p>このサンプルは主に Trev Roydhouse
	&lt;Trev.Roydhouse@f401.n711.z3.fidonet.org&gt;
	から寄せられた情報に基づいており,
	承諾を得て使用しています.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94450512"></a>20.3.3. PPP サーバとしての動作</h3></div></div></div><p><code class="filename">/etc/ppp/options</code>:</p><pre class="programlisting">crtscts                         # Hardware flow control
netmask 255.255.255.0           # netmask ( not required )
192.114.208.20:192.114.208.165  # ip's of local and remote hosts
                                # local ip must be different from one
                                # you assigned to the ethernet ( or other )
                                # interface on your machine.
                                # remote IP is ip address that will be
                                # assigned to the remote machine
domain ppp.foo.com              # your domain
passive                         # wait for LCP
modem                           # modem line</pre><p>下記のような <code class="filename">/etc/ppp/pppserv</code>
	スクリプトで, そのマシンを PPP
	サーバにすることができます.</p><pre class="programlisting">#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

# reset ppp interface
ifconfig ppp0 down
ifconfig ppp0 delete

# enable autoanswer mode
kermit -y /etc/ppp/kermit.ans

# run ppp
pppd /dev/tty01 19200</pre><p>PPP サーバを終了するには, この
	<code class="filename">/etc/ppp/pppservdown</code> スクリプト
	を使用します:</p><pre class="programlisting">#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi
ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.noans</pre><p>下記の kermit スクリプトは, モデムの自動応答機能を有効,
	または無効にします
	(<code class="filename">/etc/ppp/kermit.ans</code>):</p><pre class="programlisting">set line /dev/tty01
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
inp 5 OK
echo \13
out ATS0=1\13   ; change this to out ATS0=0\13 if you want to disable
                ; autoanswer mod
inp 5 OK
echo \13
exit</pre><p>この <code class="filename">/etc/ppp/kermit.dial</code>
	スクリプトは, リモートホストに ダイヤルし,
	認証手続きをするのに使用します. あなたは必要に応じて, これを
	変更しないといけないでしょう.
	あなたのユーザ名とパスワードをこの
	スクリプトに書かなければいけませんし,
	モデムやリモートホストからの 応答によっては,
	入力待ちの文を変更する必要もあります.</p><pre class="programlisting">;
; put the com line attached to the modem here:
;
set line /dev/tty01
;
; put the modem speed here:
;
set speed 19200
set file type binary            ; full 8 bit file xfer
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none
set modem hayes
set dial hangup off
set carrier auto                ; Then SET CARRIER if necessary,
set dial display on             ; Then SET DIAL if necessary,
set input echo on
set input timeout proceed
set input case ignore
def \%x 0                       ; login prompt counter
goto slhup

:slcmd                          ; put the modem in command mode
echo Put the modem in command mode.
clear                           ; Clear unread characters from input buffer
pause 1
output +++                      ; hayes escape sequence
input 1 OK\13\10                ; wait for OK
if success goto slhup
output \13
pause 1
output at\13
input 1 OK\13\10
if fail goto slcmd              ; if modem doesn't answer OK, try again

:slhup                          ; hang up the phone
clear                           ; Clear unread characters from input buffer
pause 1
echo Hanging up the phone.
output ath0\13                  ; hayes command for on hook
input 2 OK\13\10
if fail goto slcmd              ; if no OK answer, put modem in command mode

:sldial                         ; dial the number
pause 1
echo Dialing.
output atdt9,550311\13\10               ; put phone number here
assign \%x 0                    ; zero the time counter

:look
clear                           ; Clear unread characters from input buffer
increment \%x                   ; Count the seconds
input 1 {CONNECT }
if success goto sllogin
reinput 1 {NO CARRIER\13\10}
if success goto sldial
reinput 1 {NO DIALTONE\13\10}
if success goto slnodial
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if &lt; \%x 60 goto look
else goto slhup

:sllogin                        ; login
assign \%x 0                    ; zero the time counter
pause 1
echo Looking for login prompt.

:slloop
increment \%x                   ; Count the seconds
clear                           ; Clear unread characters from input buffer
output \13
;
; put your expected login prompt here:
;
input 1 {Username: }
if success goto sluid
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if &lt; \%x 10 goto slloop         ; try 10 times to get a login prompt
else goto slhup                 ; hang up and start again if 10 failures

:sluid
;
; put your userid here:
;
output ppp-login\13
input 1 {Password: }
;
; put your password here:
;
output ppp-password\13
input 1 {Entering SLIP mode.}
echo
quit

:slnodial
echo \7No dialtone.  Check the telephone line!\7
exit 1

; local variables:
; mode: csh
; comment-start: "; "
; comment-start-skip: "; "
; end:</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="userppp.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="ppp-and-slip.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="pppoe.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">20.2. ユーザ ppp の利用〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓20.4.  PPP オーバイーサネット (PPPoE) の利用</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>