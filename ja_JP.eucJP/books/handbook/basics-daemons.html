<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>4.8. デーモン、シグナルとプロセス終了</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="basics.html" title="第4章 UNIX の基礎知識" /><link rel="prev" href="basics-processes.html" title="4.7. プロセス" /><link rel="next" href="shells.html" title="4.9. シェル" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.8. デーモン、シグナルとプロセス終了</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="basics-processes.html">戻る</a>〓</td><th width="60%" align="center">第4章 UNIX の基礎知識</th><td width="20%" align="right">〓<a accesskey="n" href="shells.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="basics-daemons"></a>4.8. デーモン、シグナルとプロセス終了</h2></div></div></div><p>エディタを使っている場合、エディタを操作するのは簡単です。
      ファイルを開く、などと動かせばよいのです。
      このように操作できるのは、エディタにそういった機能があり、
      かつエディタが<em class="firstterm">端末</em>に関連づけられているからです。
      一方、ユーザから始終入力があるように設計されていないプログラムもあり、
      そういったプログラムは最初から端末と切り離されます。
      例えば、ウェブサーバは一日中ウェブのリクエストばかり処理するので、
      通常全く入力を必要としません。
      サイトからサイトへとメールを転送するプログラムも、
      こういった種類のアプリケーションの一例です。</p><p>このようなプログラムは、<em class="firstterm">デーモン</em>と呼ばれます。
      デーモンはギリシャ神話の登場人物で、
      善でも悪でもなく、大雑把にいうと、
      人間のために役立つことをしてくれる小さな妖精さんです。
      今日の便利なウェブサーバやメールサーバととてもよく似ていますね。
      このため、長い間 BSD のマスコットはスニーカーをはいてフォークを携えた
      かわいらしい姿のデーモンなのです。</p><p>通常デーモンとして動作するプログラムには末尾に <span class="quote">「<span class="quote">d</span>」</span>
      を持った名前をつける慣習があります。
      <span class="application">BIND</span> は Berkeley Internet Name Domain
      ですが、
      実際実行されるプログラムは <code class="command">named</code> という名前です。
      <span class="application">Apache</span> ウェブサーバのプログラムは
      <code class="command">httpd</code> と呼ばれ、
      ラインプリンタスプーリングデーモンは <code class="command">lpd</code>、
      などなどです。
      これは単なる慣習で、しっかりがっちりとしたルールではありません。
      例えば、<span class="application">Sendmail</span>
      アプリケーションの主なメールデーモンは
      <code class="command">sendmail</code> という名前で、
      連想しそうな <code class="command">maild</code> ではありません。</p><p>時々、デーモンプロセスと通信したいときがあります。
      一つの方法として、それ (に限らずどんな動作中のプロセスでも) に
      <em class="firstterm">シグナル</em>と呼ばれるものを送信する方法です。
      送信可能なシグナルはたくさんあります―特別な意味があるものもあれば、
      アプリケーションによって解釈されるものもありますし、
      アプリケーションがシグナルをどう解釈するかは
      そのアプリケーションの文章を読めば分かるでしょう。
      自分が持っているプロセスにしかシグナルを送ることはできません。
      他人のプロセスに <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> や <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">kill</span>(2)</span></a>
      を使ってシグナルを送っても、許可されないでしょう。
      これの例外は <code class="systemitem">root</code> ユーザで、
      ルートユーザは誰のプロセスでもシグナルを送ることができます。</p><p>FreeBSD もアプリケーションにシグナルを送ることがあります。
      アプリケーションを下手に書くと、
      予想外のメモリにアクセスしようとするので、
      FreeBSD がプロセスに <em class="firstterm">セグメンテーション違反</em>
      シグナル (<code class="literal">SIGSEGV</code>) を送ります。
      ある程度の時間が経ったら <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=alarm&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">alarm</span>(3)</span></a>
      システムコールを使って警告してもらうようなアプリケーションには、
      警告シグナル (<code class="literal">SIGALRM</code>) が送信される、
      などです。</p><p>プロセスを止めるためには2つのシグナル、
      <code class="literal">SIGTERM</code> か <code class="literal">SIGKILL</code>
      を使います。
      <code class="literal">SIGTERM</code> は穏かにプロセスを終了させる方法です。
      プロセスはシグナルを<span class="emphasis"><em>受け取る</em></span>ことができ、
      終了させたいのだなということを理解し、
      開いているログファイルを全部を閉じ、
      一般的に終了前にしていたことを終えることができます。
      中断できない処理の途中だと、<code class="literal">SIGTERM</code>
      をプロセスが無視することもあるかもしれません。</p><p>プロセスは <code class="literal">SIGKILL</code> を無視することができません。
      これは、<span class="quote">「<span class="quote">なにをしていようが構わないから今すぐ止まれ</span>」</span>
      というシグナルです。 プロセスに <code class="literal">SIGKILL</code> を送ると、
      FreeBSD はそのプロセスをそこで止めます<a href="#ftn.idp83000784" class="footnote" id="idp83000784"><sup class="footnote">[4]</sup></a>。</p><p>使う可能性のあるシグナルは、他に
      <code class="literal">SIGHUP</code>、<code class="literal">SIGUSR1</code>、と
      <code class="literal">SIGUSR2</code> があります。
      これらは一般的な用途のシグナルで、
      このシグナルが送信されたときアプリケーションによって別のことをします。</p><p>ウェブサーバの設定ファイルを変更したとしましょう―ウェブサーバに新しい設定を再読み込みさせたいですね。
      <code class="command">httpd</code> を止めて再起動することもできますが、
      そうするとウェブサーバは一瞬ながら停止してしまいますし、
      ちょっとでも止まってほしくないこともあるでしょう。
      ほとんどのデーモンは <code class="literal">SIGHUP</code>
      シグナルに対して設定ファイルを再読み込みする反応を返すよう書かれています。
      従って、<code class="command">httpd</code> を止めて再起動する代わりに、
      <code class="literal">SIGHUP</code> シグナルを送りましょう。
      これらのシグナルへの標準的な反応というものがないために、
      デーモンごとに行動が違うので、
      疑問があれば必ずそのデーモンの文書を読んでください。</p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> コマンドを使って送るシグナルはこの例をご覧ください。</p><div class="procedure"><a id="idp83010768"></a><div class="procedure-title">手順4.1 プロセスにシグナルを送る</div><p>この例では、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> にシグナルを送る方法を示します。
	<code class="command">inetd</code> の設定ファイルは
	<code class="filename">/etc/inetd.conf</code> で、
	<code class="command">inetd</code> は <code class="literal">SIGHUP</code>
	が送信されるとこの設定ファイルを再読み込みします。</p><ol class="procedure" type="1"><li class="step"><p>シグナルを送りたいプロセスのプロセス ID を探します。
	  それには <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> と <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=grep&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">grep</span>(1)</span></a> を使います。
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=grep&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">grep</span>(1)</span></a> コマンドは出力を検索するために使い、
	  指定した文字列を探します。
	  このコマンドは一般ユーザで実行しますが、
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> は <code class="systemitem">root</code> で実行されているので、
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> には <code class="option">ax</code>
	  オプションを与える必要があります。</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ps -ax | grep inetd</code></strong>
  198  ??  IWs    0:00.00 inetd -wW</pre><p>ということで、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> の PID は 198 です。
	  <code class="literal">grep inetd</code> コマンドがこの出力に出てくる場合もあります。
	  それは、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> が動作中のプロセスのリストを見つける方法によります。</p></li><li class="step"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> を使ってシグナルを送ります。
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> は <code class="systemitem">root</code> で起動されているために、
	  まず <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> を使って <code class="systemitem">root</code>
	  にならなければなりません。</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>su</code></strong>
<code class="prompt">Password:</code>
<code class="prompt">#</code> <strong class="userinput"><code>/bin/kill -s HUP 198</code></strong></pre><p>大部分の <span class="trademark">UNIX</span>® コマンドと同じく、
	  成功したら <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> は何の出力も表示しません。
	  自分のものではないプロセスにシグナルを送ると、
	  <span class="errorname">kill:
	    <em class="replaceable"><code>PID</code></em>: Operation not
	    permitted</span> と表示されます。
	  PID を打ち間違えると、
	  悪いことに間違ったプロセスにシグナルを送ってしまうか、
	  もしくは運がよければその時点で使われていない PID
	  にシグナルを送ったことになり、<span class="errorname">kill:
	    <em class="replaceable"><code>PID</code></em>: No such process</span>
	  と表示されます。</p><div xmlns="" class="note"><h3 class="admontitle">なぜ <code xmlns="http://www.w3.org/1999/xhtml" class="command">/bin/kill</code> を使うんでしょう?: </h3><p xmlns="http://www.w3.org/1999/xhtml">多くのシェルは <code class="command">kill</code>
	    コマンドを組み込みコマンドとして備えています。
	    つまり、<code class="filename">/bin/kill</code> を実行するのではなく、
	    シェルが直接シグナルを送ります。
	    これはとても便利なのですが、
	    シェルが違うと送るシグナルの名前の指定の仕方が違います。
	    シェルによって異なるシグナルの指定の仕方を全部覚えようとはせずに、
	    <code class="command">/bin/kill ...</code>
	    コマンドを直接使うほうが簡単です。</p></div></li></ol></div><p>他のシグナルの送り方はほとんど同じで、
      コマンドラインの <code class="literal">TERM</code> や <code class="literal">KILL</code>
      を必要に応じて変えるだけです。</p><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">システム上のランダムプロセスを終了させるのはよくありません。
        特に、プロセス ID が 1 の <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a> は特別です。
	<code class="command">/bin/kill -s KILL 1</code>
	を使うといとも簡単にシステムをシャットダウンさせることができます。
	<span class="keycap"><strong>Return</strong></span> を押す<span class="emphasis"><em>前</em></span>に
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> を実行する引数を二重にチェックする<span class="emphasis"><em>癖</em></span>をつけてください。</p></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp83000784" class="footnote"><p><a href="#idp83000784" class="para"><sup class="para">[4] </sup></a>正確ではありません―中断できないものはわずかながら存在します。
	  例えば、プロセスがネットワーク上の別の計算機にあるファイルを読もうとして、
	  その計算機がなんらかの理由
	  (電源を落とされたとか、ネットワークに問題があるとか)
	  でいなくなった場合、そのプロセスは<span class="quote">「<span class="quote">中断不可能</span>」</span>と言われます。
	  最終的にはそのプロセスはタイムアウトします。普通は2分後です。
	  タイムアウトした直後、そのプロセスは終了します。</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="basics-processes.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="basics.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="shells.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">4.7. プロセス〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓4.9. シェル</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>