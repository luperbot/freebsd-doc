<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>16.13. ディスクパーティションの暗号化</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="disks.html" title="第16章 ストレージ" /><link rel="prev" href="quotas.html" title="16.12. ファイルシステムクォータ" /><link rel="next" href="l10n.html" title="第17章 地域化 (localization) - I18N/L10N の利用と設定" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">16.13. ディスクパーティションの暗号化</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="quotas.html">戻る</a>〓</td><th width="60%" align="center">第16章 ストレージ</th><td width="20%" align="right">〓<a accesskey="n" href="l10n.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-encrypting"></a>16.13. ディスクパーティションの暗号化</h2></div><div><span class="authorgroup">寄稿: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Green</span> <span class="firstname">Lucky</span> [FAMILY Given]</span>. </span></div></div></div><a id="idp91840208" class="indexterm"></a><p>FreeBSD
      は無許可のデータアクセスに対する優れたオンライン保護機能を提供します。
      ファイルのパーミッションおよび強制的アクセスコントロール
      (MAC: Mandatory Access Control)
      (Mandatory Access Control (MAC) を参照)
      
      は、コンピュータが動作中で、OS が実行中であるときに、
      無許可の第三者がデータにアクセスするのを防ぐことに役立ちます。
      しかしながら、攻撃者がコンピュータに物理的にアクセスし、
      機密データをコピーし分析するためにコンピュータのハードドライブを別のシステムに移動させることができれば、
      OS によって強化された許可属性は意味をなさなくなります。</p><p>攻撃者が電源の落ちたコンピュータや
      ハードドライブを手にいれる手段にかかわらず、
      <span class="application">GEOM ベースのディスク暗号化 (gbde: GEOM Based Disk Encryption)</span>
      は、著しい資源を持ち本気で攻撃を仕掛けるつもりでやってきた攻撃者からさえもコンピュータのファイルシステム上にあるデータを保護することができます。
      個々のファイルだけを暗号化する煩わしい方法と異なり、
      <span class="application">gbde</span>
      は全ファイルシステムを透過的に暗号化します。
      平文テキストは決してハードドライブのプラッタに関係しません。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91847248"></a>16.13.1. カーネルで gbde を有効にする</h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong><code class="systemitem">root</code> になる</strong></p><p><span class="application">gbde</span>
	    の設定をするにはスーパユーザの権限が必要になります。
	    以下のコマンドを実行して、
	    <code class="systemitem">root</code> になってください。</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>su -</code></strong>
Password:</pre></li><li class="step"><p class="title"><strong>オペレーティングシステムのバージョンを確かめる</strong></p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">gbde</span>(4)</span></a> が動作するには FreeBSD 5.0 以降が必要です。
	    以下のコマンドを実行して、
	    オペレーティングシステムのバージョンを確認してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>uname -r</code></strong>
5.0-RELEASE</pre></li><li class="step"><p class="title"><strong>カーネルコンフィギュレーションファイルに <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">gbde</span>(4)</span></a>
	    対応を追加する</strong></p><p>お好みのテキストエディタを使用して、
	    以下の行をカーネルコンフィギュレーションファイルに加えます。</p><p><code class="literal">options GEOM_BDE</code></p><p>FreeBSD カーネルを設定、再コンパイル、インストールします。
	    この手順は <a class="xref" href="kernelconfig.html" title="第9章 FreeBSD カーネルのコンフィグレーション">9章<em>FreeBSD カーネルのコンフィグレーション</em></a> で説明されています。</p><p>新しいカーネルで再起動します。</p></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91866448"></a>16.13.2. 暗号化されたハードドライブの準備</h3></div></div></div><p>以下の例では、システムに新しいハードディスクを追加しようとしています。このシステムは単一の暗号化されたパーティションを保持することになります。
	このパーティションは <code class="filename">/private</code>
	としてマウントされます。<span class="application">gbde</span> は
	<code class="filename">/home</code> および <code class="filename">/var/mail</code>
	を暗号化するのにも使用できますが、
	より複雑な指示を必要となるのでこの解説の範疇を越えています。</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>新しいハードドライブを追加する</strong></p><p><a class="xref" href="disks-adding.html" title="16.3. ディスクの追加">「ディスクの追加」</a> で説明されている通りに新しいドライブをシステムに設置します。
	    この例では、新しいハードドライブは
	    <code class="filename">/dev/ad4s1c</code> パーティションに
	    加えられたものとします。
	    <code class="filename">/dev/ad0s1*</code>
	    デバイスは、この例のシステム上に存在する標準的な
	    FreeBSD パーティションを表します。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls /dev/ad*</code></strong>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4</pre></li><li class="step"><p class="title"><strong>gbde ロックファイルを保持するディレクトリを作成する</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /etc/gbde</code></strong></pre><p><span class="application">gbde</span> ロックファイルには、
	    暗号化されたパーティションにアクセスするのに必要となる情報が格納されています。
	    ロックファイルにアクセスしない場合、
	    <span class="application">gbde</span> は
	    膨大な手動による介在なしには (ソフトウェアは対応していません)、暗号化されたパーティションに含まれるデータを解読することはできないでしょう。
	    それぞれの暗号化されたパーティションは別々のロックファイルを使用します。</p></li><li class="step"><p class="title"><strong>gbde パーティションを初期化する</strong></p><p><span class="application">gbde</span>
	    パーティションは使用する前に初期化されなければなりません。
	    この初期化は一度だけ実行される必要があります。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gbde init /dev/ad4s1c -i -L /etc/gbde/ad4s1c</code></strong></pre><p>エディタが開くので、
	    テンプレートをもとにさまざまなオプションを設定してください。
	    UFS1 または UFS2 で使用するには、sector_size を
	    2048 に設定してください。</p><pre class="programlisting">$FreeBSD: src/sbin/gbde/template.txt,v 1.1 2002/10/20 11:16:13 phk Exp $
#
# Sector size is the smallest unit of data which can be read or written.
# Making it too small decreases performance and decreases available space.
# Making it too large may prevent filesystems from working.  512 is the
# minimum and always safe.  For UFS, use the fragment size
#
sector_size     =       2048
[...]
</pre><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a>
	    はデータを保護するのに使用するパスフレーズを二度尋ます。
	    パスフレーズはそれぞれ同じでなければなりません。
	    データを保護する <span class="application">gbde</span> の能力は、
	    あなたが選択したパスフレーズの品質に完全に依存します。
	    <a href="#ftn.idp91879888" class="footnote" id="idp91879888"><sup class="footnote">[5]</sup></a></p><p><code class="command">gbde init</code> コマンドは
	    <span class="application">gbde</span>
	    パーティションに対するロックファイルを作成します。この例では
	    <code class="filename">/etc/gbde/ad4s1c</code> に格納されます。</p><div xmlns="" class="caution"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="application">gbde</span> ロックファイルは、
	      すべての暗号化されたパーティションの内容とともにバックアップされなければ <span class="emphasis"><em>なりません</em></span>。
	      ロックファイルだけを削除している間、
	      ロックファイルなしでは信念の固い攻撃者が
	      <span class="application">gbde</span>
	      パーティションを解読することを防ぐことができない一方で、
	      正当な所有者は、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> およびこの設計者にまったく支持されない膨大な量の作業なしには、
	      暗号化されたパーティション上のデータにアクセスすることができないでしょう。</p></div></li><li class="step"><p class="title"><strong>カーネルに暗号化されたパーティションを接続する</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c</code></strong></pre><p>暗号化されたパーティションを初期化する際に選択したパスフレーズを入力するように求められます。
	    新しい暗号化デバイスは <code class="filename">/dev</code> に
	    <code class="filename">/dev/device_name.bde</code>
	    として現れます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls /dev/ad*</code></strong>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4        /dev/ad4s1c.bde</pre></li><li class="step"><p class="title"><strong>暗号化デバイス上にファイルシステムを作成する</strong></p><p>カーネルに暗号化デバイスが接続されると、
	    デバイス上にファイルシステムを作成できます。
	    暗号化デバイス上にファイルシステムを作成するには <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a>
	    を使用します。従来の UFS1 ファイルシステムで初期化するより、
	    新しい UFS2 ファイルシステムで初期化した方が高速なので、
	    <code class="option">-O2</code> オプションとともに <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a>
	    を使用することが推奨されています。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD 5.1-RELEASE 以降では、<code class="option">-O2</code>
	      オプションはデフォルトです。</p></div><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>newfs -U -O2 /dev/ad4s1c.bde</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml"><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a> は、デバイス名に
	      <code class="filename">*.bde</code>
	      拡張子によって認識される、
	      接続された <span class="application">gbde</span>
	      パーティションに対して実行されなければなりません。</p></div></li><li class="step"><p class="title"><strong>暗号化パーティションをマウントする</strong></p><p>暗号化ファイルシステムに対するマウントポイントを作成します。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /private</code></strong></pre><p>暗号化ファイルシステムをマウントします。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/ad4s1c.bde /private</code></strong></pre></li><li class="step"><p class="title"><strong>暗号化ファイルシステムが利用可能か確かめる</strong></p><p>これで暗号化ファイルシステムは <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=df&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">df</span>(1)</span></a> で見ることができ、
	    利用する準備ができました。</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>df -H</code></strong>
Filesystem        Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a      1037M    72M   883M     8%    /
/devfs            1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f       8.1G    55K   7.5G     0%    /home
/dev/ad0s1e      1037M   1.1M   953M     0%    /tmp
/dev/ad0s1d       6.1G   1.9G   3.7G    35%    /usr
/dev/ad4s1c.bde   150G   4.1K   138G     0%    /private</pre></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91911248"></a>16.13.3. 存在する暗号化ファイルシステムをマウントする</h3></div></div></div><p>システムを起動する度に、すべての暗号化ファイルシステムは
	使用前にカーネルに接続し、
	エラーの有無をチェックし、マウントする必要があります。
	必要なコマンドは <code class="systemitem">root</code>
	ユーザとして実行されなければなりません。</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>カーネルに gbde パーティションを接続する</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c</code></strong></pre><p>パーティションの暗号化を初期化する際に選択したパスフレーズを入力するように求められるでしょう。</p></li><li class="step"><p class="title"><strong>ファイルシステムのエラーをチェックする</strong></p><p>暗号化ファイルシステムを自動的にマウントするために
	    <code class="filename">/etc/fstab</code> に設定を掲載することはまだできないため、
	    マウントする前に <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> を実行して、
	    ファイルシステムのエラーをチェックしなければなりません。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>fsck -p -t ffs /dev/ad4s1c.bde</code></strong></pre></li><li class="step"><p class="title"><strong>暗号化ファイルをマウントする</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/ad4s1c.bde /private</code></strong></pre><p>これで暗号化ファイルシステムが利用できるようになりました。</p></li></ol></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91924816"></a>16.13.3.1. 暗号化パーティションを自動的にマウントする</h4></div></div></div><p>スクリプトを作成して、暗号化パーティションを自動的に接続、
	  チェック、マウントすることは可能です。しかしながら、
	  安全上の理由によりスクリプトに <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a>
	  パスワードを含めるべきではありません。その代わりに、コンソールまたは
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> による接続からパスワードを入力するようなスクリプトが手動で実行されることが推奨されます。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91927632"></a>16.13.4. gbde が採用した暗号の保護</h3></div></div></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> は 128bit AES の
	CBC モードを使用してセクタペイロードを暗号化します。
	ディスク上のそれぞれのセクタは異なる AES 鍵で暗号化されます。
	セクタ鍵がユーザが入力したパスフレーズからどのように導き出されるかを含め、
	<span class="application">gbde</span> の暗号手法の設計についての詳細は、
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">gbde</span>(4)</span></a> を参照してください。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91930576"></a>16.13.5. 互換性に関する問題</h3></div></div></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a> は
	<span class="application">gbde</span> 暗号化デバイスと互換性がありません。
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a> を実行する前に
	<code class="filename">*.bde</code>
	デバイスはすべてカーネルから切断されなければなりません。
	そうしないと、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a> が初めにデバイスを走査する際にクラッシュしてしまうでしょう。
	暗号化デバイスを切断するには、以下のコマンドを使用します。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gbde detach /dev/ad4s1c</code></strong></pre></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp91879888" class="footnote"><p><a href="#idp91879888" class="para"><sup class="para">[5] </sup></a>記憶するのが簡単で、
		安全なパスフレーズを選択する方法については、
		<a class="link" href="http://world.std.com/~reinhold/diceware.html" target="_top">
		  Diceware Passphrase</a>
		ウェブサイトを参照してください。</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="quotas.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="disks.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="l10n.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">16.12. ファイルシステムクォータ〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓第17章 地域化 (localization) - I18N/L10N の利用と設定</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>