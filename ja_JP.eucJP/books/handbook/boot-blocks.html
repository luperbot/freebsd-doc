<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>13.3. ブートマネージャと起動ステージ</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="boot.html" title="第13章 FreeBSD の起動のプロセス" /><link rel="prev" href="boot-introduction.html" title="13.2. 起動時の問題" /><link rel="next" href="boot-kernel.html" title="13.4. カーネル起動時の応答" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">13.3. ブートマネージャと起動ステージ</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="boot-introduction.html">戻る</a>〓</td><th width="60%" align="center">第13章 FreeBSD の起動のプロセス</th><td width="20%" align="right">〓<a accesskey="n" href="boot-kernel.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="boot-blocks"></a>13.3. ブートマネージャと起動ステージ</h2></div></div></div><a id="idp88730448" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-boot0"></a>13.3.1. ブートマネージャ</h3></div></div></div><a id="idp88731728" class="indexterm"></a><p>MBR やブートマネージャのコードは起動プロセスの<span class="emphasis"><em>第
	0 ステージ</em></span>と呼ばれることがあります。
	この節では前述の 2 つのブートマネージャ、
	<span class="application">boot0</span> と <span class="application">LILO</span>
	について説明します。</p><p><span class="formalpara-title"><span class="application">boot0</span> ブートマネージャ.〓</span>FreeBSD のインストーラや <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=boot0cfg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">boot0cfg</span>(8)</span></a>
	  がデフォルトでインストールする
	  MBR は、<code class="filename">/boot/boot0</code> を基にしています
	  (<code class="filename">boot0</code> は非常に単純なプログラムです。
	  <abbr class="abbrev">MBR</abbr> にあるプログラムは、
	  スライステーブルと末尾の識別子 <code class="literal">0x55AA</code> があるため、
	  446 バイトの大きさでなければならないという制限があるためです)。
	  ハードディスクに <span class="application">boot0</span>
	  と複数のオペレーティングシステムをインストールした場合、
	  起動時に以下のような画面が出るでしょう。</p><div class="example"><a id="boot-boot0-example"></a><div class="example-title">例13.1 <code class="filename">boot0</code> のスクリーンショット</div><div class="example-contents"><pre class="screen">F1 DOS
F2 FreeBSD
F3 Linux
F4 ??
F5 Drive 1

Default: F2</pre></div></div><br class="example-break" /><p>他のオペレーティングシステム、特に <span class="trademark">Windows</span>® は、
	既存の MBR を自らの MBR で上書きしてしまうことで知られています。
	もしそうなってしまったら、
	もしくは既存の MBR を FreeBSD の MBR で置き換えたいのなら、
	次のコマンドを使ってください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>fdisk -B -b /boot/boot0 device</code></strong></pre><p><em class="replaceable"><code>device</code></em> は起動するデバイス名で、
	たとえば 1 番目の IDE ディスクは
	<code class="filename">ad0</code>、
	2 番目の IDE コントローラに接続されている 1 番目の IDE ディスクは
	<code class="filename">ad2</code>、
	1 番目の SCSI ディスクは
	<code class="filename">da0</code>
	などとなります。
	MBR の設定をカスタマイズしたい場合は <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=boot0cfg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">boot0cfg</span>(8)</span></a>
	を使ってください。</p><p><span class="formalpara-title">LILO ブートマネージャ.〓</span>このブートマネージャをインストールして FreeBSD
	  を起動するようにするには、まず Linux を起動して
	  <code class="filename">/etc/lilo.conf</code>
	  コンフィグレーションファイルに以下を追加してください。</p><pre class="programlisting">other=/dev/hdXY
table=/dev/hdX
loader=/boot/chain.b
label=FreeBSD</pre><p>上記において、FreeBSD のプライマリパーティションとドライブを
	Linux の識別子を使って指定してください。
	<em class="replaceable"><code>X</code></em> を Linux のドライブ文字に、また
	<em class="replaceable"><code>Y</code></em> を Linux
	のプライマリパーティション番号に置き換えてください。
	<acronym class="acronym">SCSI</acronym> ドライブを使っているのであれば、
	<em class="replaceable"><code>/dev/hd</code></em> を
	<em class="replaceable"><code>/dev/sd</code></em>
	のように読み替えてください。
	同じドライブ上に両方のオペレーティングシステムが置いてあるなら、
	<code class="option">loader=/boot/chain.b</code> 行は不要です。
	これで <code class="command">/sbin/lilo -v</code>
	を実行するとシステムに新しい変更が反映されます。
	画面のメッセージを見て確認しておきましょう。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-boot1"></a>13.3.2. 起動ステージ 1 <code class="filename">/boot/boot1</code> と起動ステージ 2
	<code class="filename">/boot/boot2</code></h3></div></div></div><p>概念上、第 1 ステージと第 2 ステージは
	ハードディスクの同じ領域上の同一のプログラムの部分部分です。
	スペースの制約のため 2 つに分割されていますが、
	いつも一緒にインストールされます。
	インストーラまたは <span class="application">bsdlabel</span>
	は、両者を 1 つにまとめたファイル
	<code class="filename">/boot/boot</code> をコピーします (下記参照)。</p><p>第 1 ステージと第 2 ステージは、ファイルシステムの外部、
	起動スライスの最初のトラックに置かれ、
	先頭が最初のセクタにきます。
	<a class="link" href="boot-blocks.html#boot-boot0" title="13.3.1. ブートマネージャ">boot0</a>
	またはその他のブートマネージャは、
	起動プロセスを続けるために必要なプログラムがそこにあると想定しています。
	使用されるセクタの数は、<code class="filename">/boot/boot</code>
	の大きさから簡単に分かります。</p><p><code class="filename">boot1</code> は
	512 バイトの大きさでなければならないという制限があるので、
	非常に単純なプログラムです。
	このプログラムは <code class="filename">boot2</code> を検索し、
	実行するため、そのスライスの情報を保持する FreeBSD
	の <em class="firstterm">BSD ラベル</em>
	に関する最低限の情報だけを持っています。</p><p><code class="filename">boot2</code> はもう少し高機能です。
	これは FreeBSD のファイルシステム上でファイルを見つける能力を持ち、
 	実行するカーネルやローダを指定するための簡単なインタフェースを提供します。</p><p><a class="link" href="boot-blocks.html#boot-loader" title="13.3.3. 起動ステージ 3 /boot/loader">ローダ (loader)</a>
	はさらに高機能なもので、
	使いやすく簡単な起動設定が行なえる手段を提供します。
	<code class="filename">boot2</code> は通常それを起動します。
	以前の <code class="filename">boot2</code> には、
	カーネルを直接起動する機能しかありませんでした。</p><div class="example"><a id="boot-boot2-example"></a><div class="example-title">例13.2 <code class="filename">boot2</code> のスクリーンショット</div><div class="example-contents"><pre class="screen">&gt;&gt; FreeBSD/i386 BOOT
Default: 0:ad(0,a)/boot/loader
boot:</pre></div></div><br class="example-break" /><p>もし仮にインストールされた <code class="filename">boot1</code> と
	<code class="filename">boot2</code> を変更したいのであれば、
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a> を使ってください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -B diskslice</code></strong></pre><p><em class="replaceable"><code>diskslice</code></em>
	は起動するディスクとスライスで、
	たとえば最初の IDE ディスクの 1 番目のスライスは
	<code class="filename">ad0s1</code> となります。</p><div xmlns="" class="warning"><h3 class="admontitle">Dangerously Dedicated Mode: </h3><p xmlns="http://www.w3.org/1999/xhtml"><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a> を使うとき、
	  <code class="filename">ad0</code> のようにディスク名だけを指定すると、
	  スライスを持たない危険な専用ディスクを作成してしまいます。
	  これはまず間違いなく、あなたがやりたいことではないでしょうから、
	  必ず <span class="keycap"><strong>Return</strong></span> キーを押す前に
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a> コマンドを二重にチェックしてください。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-loader"></a>13.3.3. 起動ステージ 3 <code class="filename">/boot/loader</code></h3></div></div></div><a id="idp88783056" class="indexterm"></a><p>ローダは三段階の起動プロセスの最終段階です。
      ローダは通常、ファイルシステム上の
      <code class="filename">/boot/loader</code>
      として存在しています。</p><p>ローダは、よりさまざまなコマンド群をサポートした
      強力なインタプリタによって提供される簡易組み込みコマンド群を利用することで、
      ユーザが利用しやすい設定手段となるように設計されています。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-loader-flow"></a>13.3.3.1. ローダプログラムの処理の流れ</h4></div></div></div><p>ローダは初期化の際にコンソールとディスクの検出を行ない、
	どのディスクから起動しているかを調べます。
	そして必要な変数を設定してからインタプリタを起動し、
	スクリプトからコマンドを送ったり手でコマンドを入力したりできます。</p><a id="idp88786000" class="indexterm"></a><a id="idp88786512" class="indexterm"></a><p>ローダは次に
	<code class="filename">/boot/loader.rc</code>
	を読み込み、通常、変数の標準値を定義した
	<code class="filename">/boot/defaults/loader.conf</code>
	と、そのマシンにローカルな変数を定義した
	<code class="filename">/boot/loader.conf</code>
	を読み込みます。
	<code class="filename">loader.rc</code>
	はそれらの変数にもとづき、
	選択されたモジュールとカーネルをロードします。</p><p>ローダは最後に、標準設定で 10 秒のキー入力待ち時間を用意し、
	入力がなければカーネルを起動します。
	入力があった場合、簡易コマンド群が使えるプロンプトが表示され、
	ユーザは変数を調整したり、
	すべてのモジュールをアンロードしたり、
	モジュールをロードしたりすることができます。
	その後、最終的な起動や再起動へ移行します。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-loader-commands"></a>13.3.3.2. ローダの組み込みコマンド</h4></div></div></div><p>もっともよく使われるローダのコマンドを以下に示します。
	利用可能なコマンドをすべて知りたい場合、
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> を参照してください。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">autoboot <em class="replaceable"><code>seconds</code></em></span></dt><dd><p><em class="replaceable"><code>seconds</code></em>
	      で与えられた時間内に入力がなければ、
	      カーネルの起動へと進みます。
	      カウントダウンを表示し、標準設定では 10 秒間です。</p></dd><dt><span class="term">boot
	    [<span class="optional">-options</span>]
	    [<span class="optional">kernelname</span>]</span></dt><dd><p>すぐにカーネルの起動へ進みます。
	      オプション、カーネル名が指定されている場合は、
	      それらが使われます。</p></dd><dt><span class="term">boot-conf</span></dt><dd><p>すべてのモジュールの設定を、
	      起動時と同じように変数にもとづいて自動的に行ないます。
	      このコマンドは、まず <code class="command">unload</code> を行なって、
	      変数―普通 <code class="envar">kernel</code>
	      など―を変更した場合にのみ有効に働きます。</p></dd><dt><span class="term">help
	    [<span class="optional">topic</span>]</span></dt><dd><p><code class="filename">/boot/loader.help</code>
	      を読み込み、ヘルプメッセージを表示します。
	      <em class="replaceable"><code>topic</code></em> に
	      <code class="literal">index</code> が指定された場合、利用可能な
	      <em class="replaceable"><code>topic</code></em> を表示します。</p></dd><dt><span class="term">include <em class="replaceable"><code>filename</code></em>
	    …</span></dt><dd><p>指定されたファイル名のファイルを処理します。
	      ローダはファイルを読み込み、行単位で解釈します。
	      エラーが発生した場合、
	      include コマンドの実行はその時点で停止します。</p></dd><dt><span class="term">load [<span class="optional">-t
	    type</span>]
	    <em class="replaceable"><code>filename</code></em></span></dt><dd><p>指定されたファイル名のカーネル、
	      カーネルモジュール、あるいは
	      type に指定された種類のファイルをロードします。
	      ファイル名以降に指定された引数はファイルへと渡されます。</p></dd><dt><span class="term">ls [<span class="optional">-l</span>]
	    [<span class="optional">path</span>]</span></dt><dd><p>指定された <em class="replaceable"><code>path</code></em>
	      にあるファイルを表示します。
	      <em class="replaceable"><code>path</code></em>
	      が指定されていなければ、ルートディレクトリを表示します。
	      <code class="option">-l</code>
	      が指定されていればファイルサイズも表示されます。</p></dd><dt><span class="term">lsdev [<span class="optional">-v</span>]</span></dt><dd><p>モジュールがロード可能なすべてのデバイスを表示します。
	      もし <code class="option">-v</code> が指定されていれば、
	      より詳細な出力がされます。</p></dd><dt><span class="term">lsmod [<span class="optional">-v</span>]</span></dt><dd><p>ロード済みのモジュールを表示します。
	      <code class="option">-v</code> が指定されていれば、
	      より詳細な内容が出力されます。</p></dd><dt><span class="term">more <em class="replaceable"><code>filename</code></em></span></dt><dd><p><code class="varname">LINES</code>
	      行を表示するごとに停止しながら指定されたファイルを表示します。</p></dd><dt><span class="term">reboot</span></dt><dd><p>すぐにシステムを再起動します。</p></dd><dt><span class="term">set <em class="replaceable"><code>variable</code></em>, </span><span class="term">set
	    <em class="replaceable"><code>variable</code></em>=<em class="replaceable"><code>value</code></em></span></dt><dd><p>ローダの環境変数を設定します。</p></dd><dt><span class="term">unload</span></dt><dd><p>すべてのロード済みモジュールを削除します。</p></dd></dl></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-loader-examples"></a>13.3.3.3. ローダの使用例</h4></div></div></div><p>次にあげるのは、ローダの実践的な使用例です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>普段使っているカーネルをシングルユーザモード<a id="idp88840272" class="indexterm"></a>で起動します。</p><pre class="screen"><strong class="userinput"><code>boot -s</code></strong></pre></li><li class="listitem"><p>普段使っているカーネルとモジュールをアンロードし、
	    古い (もしくは別の) カーネルをロードします。</p><pre class="screen"><strong class="userinput"><code>unload</code></strong>
<strong class="userinput"><code>load kernel.old</code></strong></pre><p><code class="filename">kernel.GENERIC</code> とすると、
	    インストールディスクに入っていた
	    generic カーネルを指定することができます。
	    また、直前にインストールされていたカーネル (たとえば、
	    カーネルを自分で設定したり、
	    アップグレードしたりした場合) を指定するには
	    <code class="filename">kernel.old</code><a id="idp88843984" class="indexterm"></a> とします。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">普段のカーネルで使っているモジュールを
	      指定したカーネルでロードする場合は、下のようにします。</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><strong class="userinput"><code>unload</code></strong>
<strong class="userinput"><code>set kernel="kernel.old"</code></strong>
<strong class="userinput"><code>boot-conf</code></strong></pre></div></li><li class="listitem"><p>カーネルの設定スクリプト (通常、
	    カーネル起動時に設定される内容を自動化するスクリプト)
	    をロードします。</p><pre class="screen"><strong class="userinput"><code>load -t userconfig_script /boot/kernel.conf</code></strong></pre></li></ul></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="boot-introduction.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="boot.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="boot-kernel.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">13.2. 起動時の問題〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓13.4. カーネル起動時の応答</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>