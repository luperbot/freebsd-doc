<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>18.7. 複数のマシンで追いかける</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="updating-upgrading.html" title="第18章 FreeBSD のアップデートとアップグレード" /><link rel="prev" href="makeworld.html" title="18.6. world の再構築" /><link rel="next" href="network-communication.html" title="パート〓IV.〓ネットワーク通信" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">18.7. 複数のマシンで追いかける</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="makeworld.html">戻る</a>〓</td><th width="60%" align="center">第18章 FreeBSD のアップデートとアップグレード</th><td width="20%" align="right">〓<a accesskey="n" href="network-communication.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="small-lan"></a>18.7. 複数のマシンで追いかける</h2></div><div><span class="authorgroup">寄稿: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Meyer</span> <span class="firstname">Mike</span> [FAMILY Given]</span>. </span></div></div></div><a id="idp93043536" class="indexterm"></a><p>複数のコンピュータで同じソースツリーを追いかけていて、
      全部のマシンにソースをダウンロードして全部を再構築するのは、
      ディスクスペース、ネットワーク帯域、
      そして <acronym class="acronym">CPU</acronym> サイクルの無駄使いです。
      解決策は 1 つのマシンに仕事のほとんどをさせ、
      残りのマシンは <acronym class="acronym">NFS</acronym>
      経由でそれをマウントする、というものです。
      このセクションではそのやり方を概観します。
      <acronym class="acronym">NFS</acronym> の使い方の詳細については、<a class="xref" href="network-nfs.html" title="22.6. NFS">「NFS」</a> をご覧下さい。</p><p>まず初めに、同じバイナリで動かそうとするマシンたちを決めます。
      このマシンたちのことを<em class="firstterm">ビルドセット</em>と呼びます。
      それぞれのマシンはカスタムカーネルを持っているかもしれませんが、
      同じユーザランドバイナリを動かそうというのです。
      このビルドセットから、
      <em class="firstterm">ビルドマシン</em>となるマシンを 1 台選びます。
      ベースシステムとカーネルを構築するのはこのマシンになります。
      理想的には、このマシンは <code class="command">make buildworld</code>
      と <code class="command">make buildkernel</code>
      を実行するのに十分な <acronym class="acronym">CPU</acronym>
      を持った速いマシンであるべきです。</p><p><em class="firstterm">テストマシン</em>
      となるべきマシンも選んでください。
      更新されたソフトウェアを使う前にそのマシンでテストするのです。
      テストマシンはかなり長い時間落ちていても
      だいじょうぶなマシン<span class="emphasis"><em>であったほうがいいでしょう</em></span>。
      ビルドマシンでもかまいませんが、
      ビルドマシンである必要はありません。</p><p>このビルドセットのマシンはすべて
      <code class="filename">/usr/obj</code> と
      <code class="filename">/usr/src</code>
      をビルドマシンから <acronym class="acronym">FTP</acronym>
      経由でマウントする必要があります。
      ビルドセット自体が複数ある場合は、
      <code class="filename">/usr/src</code>
      はひとつのビルドマシン上にあるべきです。
      他のマシンからはそれを <acronym class="acronym">NFS</acronym>
      マウントするようにしましょう。</p><p>ビルドセットのすべてのマシン上の
      <code class="filename">/etc/make.conf</code> と
      <code class="filename">/etc/src.conf</code>
      がビルドマシンと一致していることを確認してください。つまり、
      ビルドマシンはビルドセットのどのマシンもインストールしようとしている
      ベースシステムを全部ビルドしなければならないということです。
      また、各ビルドマシンは <code class="filename">/etc/make.conf</code>
      にそれぞれのビルドマシンのカーネル名を
      <code class="varname">KERNCONF</code> で指定し、
      ビルドマシンは自分自身のカーネルから順に全部のカーネル名を
      <code class="varname">KERNCONF</code> にリストアップしてください。
      ビルドマシンは各マシンのカーネル設定ファイルを <code class="filename">/usr/src/sys/<em class="replaceable"><code>arch</code></em>/conf</code>
      に持っていなければなりません。</p><p>ビルドマシンにて、
      <a class="xref" href="makeworld.html" title="18.6. world の再構築">「world の再構築」</a>
      に書いてあるようにカーネルとベースシステムを構築してください。
      でも、まだビルドマシンにはインストールしないでください。
      そのかわり、
      ビルドしたカーネルをテストマシンにインストールしてください。
      <acronym class="acronym">FTP</acronym> 経由で
      <code class="filename">/usr/src</code> および <code class="filename">/usr/obj</code>
      をテストマシンにマウントしてください。
      その後、<code class="command">shutdown now</code>
      を実行してシングルユーザモードに移行し、
      新しいカーネルとベースシステムをインストールし、
      いつもするように
      <code class="command">mergemaster</code> を実行してください。
      終わったら、再起動して通常のマルチユーザ動作に戻します。</p><p>テストマシンにあるものすべてがちゃんと動いている確信が得られたら、
      同じ手順でビルドセットの他のマシンにも新しいソフトウェアをインストールします。</p><p>ports ツリーにも同じ方法が使えます。
      最初のステップは、
      ビルドセットのすべてのマシンが <acronym class="acronym">NFS</acronym> 経由で
      <code class="filename">/usr/ports</code> をマウントすることです。
      そして、distfiles を共有するように
      <code class="filename">/etc/make.conf</code> を設定します。
      <acronym class="acronym">NFS</acronym> マウントによってマップされる
      <code class="systemitem">root</code>
      ユーザが何であれ、<code class="varname">DISTDIR</code>
      はそのユーザが書き込める共通の共有ディレクトリに設定する必要があります。
      ports をローカルでビルドする場合には、
      各マシンは <code class="varname">WRKDIRPREFIX</code>
      を自分のマシンのビルドディレクトリに設定しなければなりません。
      また、ビルドシステムが packages
      をビルドしてビルドセットのコンピュータに配布するのであれば、
      <code class="varname">DISTDIR</code> と同じようにビルドシステム上の
      <code class="varname">PACKAGES</code>
      ディレクトリも設定してください。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="makeworld.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="updating-upgrading.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="network-communication.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">18.6. world の再構築〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓パート〓IV.〓ネットワーク通信</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>