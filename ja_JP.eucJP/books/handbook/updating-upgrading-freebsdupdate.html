<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>18.2. FreeBSD Update</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="updating-upgrading.html" title="第18章 FreeBSD のアップデートとアップグレード" /><link rel="prev" href="updating-upgrading.html" title="第18章 FreeBSD のアップデートとアップグレード" /><link rel="next" href="updating-upgrading-documentation.html" title="18.3. ドキュメントのアップデート" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">18.2. FreeBSD Update</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="updating-upgrading.html">戻る</a>〓</td><th width="60%" align="center">第18章 FreeBSD のアップデートとアップグレード</th><td width="20%" align="right">〓<a accesskey="n" href="updating-upgrading-documentation.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="updating-upgrading-freebsdupdate"></a>18.2. FreeBSD Update</h2></div><div><span class="authorgroup">寄稿: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Rhodes</span> <span class="firstname">Tom</span> [FAMILY Given]</span>. </span></div><div><span class="authorgroup">ベースとなったノートの提供: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Percival</span> <span class="firstname">Colin</span> [FAMILY Given]</span>. </span></div></div></div><a id="idp92283600" class="indexterm"></a><a id="idp92284368" class="indexterm"></a><p>システム管理における重要な側面に、
      すみやかにセキュリティパッチを適用し、
      オペレーティングシステムを新しいリリースにアップグレードすることがあります。
      FreeBSD には、これらの処理を行うために <code class="command">freebsd-update</code>
      と呼ばれるユーティリティが用意されています。</p><p>このユーティリティを用いると、FreeBSD のセキュリティおよび
      eratta アップデートをバイナリによって行うことができます。
      手動でパッチもしくは新しいカーネルをコンパイルし、
      インストールする必要はありません。
      バイナリアップデートは、
      セキュリティチームがサポートしているすべてのアーキテクチャとリリースで利用できます。
      <code class="uri"><a class="uri" href="http://www.FreeBSD.org/ja/security/" target="_top">http://www.FreeBSD.org/ja/security/</a></code> には、
      サポートが行われているリリースや保守終了予定日の一覧があります。</p><p>このユーティリティは、マイナーリリースであったり、
      他のリリースブランチへのアップグレードにも対応しています。
      新しいリリースにアップデートする前に、
      アップデートしようとしているリリースのアナウンスに目を通し、
      重要な情報がないかどうかを確認してください。
      リリースのアナウンスは <code class="uri"><a class="uri" href="http://www.FreeBSD.org/ja/releases/" target="_top">http://www.FreeBSD.org/ja/releases/</a></code>
      で確認できます。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">もし <code class="command">crontab</code> の中に
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">freebsd-update</span>(8)</span></a> の機能が含まれていたら、
	オペレーティングシステムのアップグレード作業を終えるまでは無効にしてください。</p></div><p>この節では、<code class="command">freebsd-update</code>
      で使われる設定ファイルの説明、
      セキュリティパッチの適応方法のデモンストレーション、
      オペレーティングシステムをアップグレードする際に考慮すべきことについて説明します。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-config-file"></a>18.2.1. 設定ファイル</h3></div></div></div><p><code class="command">freebsd-update</code> のデフォルトの設定ファイルは、
	そのままでも用いることができます。      
	<code class="filename">/etc/freebsd-update.conf</code>
	の設定をデフォルトからきめ細かく調整して、
	アップデートプロセスを制御するユーザもいます。
	このファイルのコメントにおいて利用可能なオプションが説明されていますが、
	以下の項目については補足が必要でしょう。</p><pre class="programlisting"># Components of the base system which should be kept updated.
Components world kernel</pre><p>このパラメータは、FreeBSD のどの部分を最新に維持するかを設定します。
	デフォルトでは、ベースシステム全体、
	そしてカーネルをアップデートします。
	<code class="literal">src/base</code> や <code class="literal">src/sys</code>
	のように、個々の項目を指定することもできます。
	この部分についてはデフォルトのままにしておき、
	アップデートする項目をユーザがリストに加える形にするのがベストでしょう。
	ソースコードとバイナリが同期していないと、
	長い年月の間に悲惨な結果がもたらされる可能性があります。</p><pre class="programlisting"># Paths which start with anything matching an entry in an IgnorePaths
# statement will be ignored.
IgnorePaths /boot/kernel/linker.hints</pre><p><code class="filename">/bin</code> や <code class="filename">/sbin</code>
	等の特定のディレクトリをアップデートで変更しないように、
	これらのパスを追加してください。
	このオプションは、ローカルの変更点を <code class="command">freebsd-update</code>
	が上書きすることを防ぐ目的にも利用できます。</p><pre class="programlisting"># Paths which start with anything matching an entry in an UpdateIfUnmodified
# statement will only be updated if the contents of the file have not been
# modified by the user (unless changes are merged; see below).
UpdateIfUnmodified /etc/ /var/ /root/ /.cshrc /.profile</pre><p>このオプションは、指定したディレクトリにある設定ファイルを、
	ローカルで変更されていない場合のみアップデートします。
	ユーザがこれらのファイルを変更していると、
	これらのファイルの自動アップデートは妨げられます。
	他に、<code class="literal">KeepModifiedMetadata</code>
	という別のオプションが存在します。
	このオプションは、<code class="command">freebsd-update</code>
	がマージ中に変更点を保存するようにします。</p><pre class="programlisting"># When upgrading to a new FreeBSD release, files which match MergeChanges
# will have any local changes merged into the version from the new release.
MergeChanges /etc/ /var/named/etc/ /boot/device.hints</pre><p><code class="command">freebsd-update</code>
	がマージすべきファイルが存在するディレクトリの一覧です。
	ファイルのマージのプロセスは、
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> と同様 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> パッチの連続ですが、
	選択肢は少なく、マージを承認するか、エディタを起動するか、
	<code class="command">freebsd-update</code>
	を中断するかどうかを選んでください。
	もし、心配な点があれば、
	<code class="filename">/etc</code>
	をバックアップしてからマージを承認してください。
	<code class="command">mergemaster</code> の詳細な情報については、
	<a class="xref" href="makeworld.html#mergemaster" title="18.6.4. 設定ファイルの同期">「設定ファイルの同期」</a> で確認してください。</p><pre class="programlisting"># Directory in which to store downloaded updates and temporary
# files used by FreeBSD Update.
# WorkDir /var/db/freebsd-update</pre><p>ここではすべてのパッチや一次ファイルを置くディレクトリを指定しています。
	バージョンをアップグレードするのであれば、
	この場所には少なくともギガバイトの空き容量が必要です。</p><pre class="programlisting"># When upgrading between releases, should the list of Components be
# read strictly (StrictComponents yes) or merely as a list of components
# which *might* be installed of which FreeBSD Update should figure out
# which actually are installed and upgrade those (StrictComponents no)?
# StrictComponents no</pre><p>このオプションを <code class="literal">yes</code> に設定すると、
	<code class="command">freebsd-update</code> は
	<code class="literal">Components</code> のリストが完全に正しいと判断し、
	このリスト以外の変更点については取り扱いません。
	<code class="command">freebsd-update</code> は、効率的に
	<code class="literal">Components</code>
	リストに属するファイルをアップデートします。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-security-patches"></a>18.2.2. セキュリティパッチの適用</h3></div></div></div><p>FreeBSD のセキュリティパッチを適用する過程は簡単になり、
	管理者は <code class="command">freebsd-update</code> を使って、
	システムを完全にパッチがあたった状態に保つ事ができるようになりました。
	FreeBSD セキュリティ勧告の詳細については、
	<a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/security-advisories.html" target="_top">FreeBSD セキュリティ勧告</a>
	
	の節で説明されています。</p><p>以下のコマンドを実行すると、FreeBSD
	のセキュリティパッチがダウンロードされ、インストールされます。
	最初のコマンドは、未対応のパッチがあるかどうかを調べます。
	もし未対応のパッチがある場合には、
	パッチが当てられた際に変更されるファイルのリストが作成されます。
	2 番目のコマンドはパッチを適用します。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update fetch</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><p>アップデートによってカーネルにパッチが当たった場合には、
	パッチが当たったカーネルで起動するように、
	システムを再起動する必要があります。
	もし、実行中のバイナリにパッチが当てられた場合には、
	パッチの当てられたバージョンのバイナリが使われるように、
	影響のあるアプリケーションを再起動する必要があります。</p><p>毎日一度アップデートがないかどうかを自動的に確認するように設定するには、
	以下のエントリを <code class="filename">/etc/crobntab</code>
	に追加してください。</p><pre class="programlisting">@daily                                  root    freebsd-update cron</pre><p>パッチが存在すると、
	自動的にダウンロードされますが、適用はされません。
	<code class="systemitem">root</code>宛てにメールで、
	ダウンロードされたパッチを確認し、
	<code class="command">freebsd-update install</code>
	とともに手動でインストールする必要のあることが通知されます。</p><p>うまく行かなかった場合には、<code class="command">freebsd-update</code>
	を以下のように実行すると、最後の変更までロールバックできます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update rollback</code></strong>
Uninstalling updates... done.</pre><p>カーネルまたはカーネルモジュールがアップデートされた場合には、
	完了後にもう一度システムを再起動して、
	影響のあったバイナリを再起動してください。</p><p><code class="command">freebsd-update</code>
	ユーティリティが自動的にアップデートするカーネルは
	<code class="filename">GENERIC</code> のみです。
	カスタムカーネルがインストールされている場合には、
	<code class="command">freebsd-update</code> がインストールした後、
	カーネルを再構築し、もう一度インストールする必要があります。
	しかしながら、<code class="filename">GENERIC</code> カーネルが
	<code class="filename">/boot/GENERIC</code> に存在する場合には、
	現在のシステムで実行されているカーネルでなくとも、
	<code class="command">freebsd-update</code>
	によりアップデートされます。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="filename">GENERIC</code> カーネルを、
	  常に <code class="filename">/boot/GENERIC</code> に置いておいてください。
	  さまざまな問題を解決する際や、
	  バージョンをアップグレードする際に助けとなります。
	  <code class="filename">GENERIC</code> カーネルを用意する方法については、
	  <a class="xref" href="updating-upgrading-freebsdupdate.html#freebsd-update-custom-kernel-9x" title="18.2.3.1. FreeBSD 9.X 以降のシステムにおけるカスタムカーネル">「FreeBSD 9.X 以降のシステムにおけるカスタムカーネル」</a> または <a class="xref" href="updating-upgrading-freebsdupdate.html#freebsd-update-custom-kernel-8x" title="18.2.3.2. FreeBSD 8.X におけるカスタムカーネル">「FreeBSD 8.X におけるカスタムカーネル」</a>
	  を参照してください。</p></div><p><code class="filename">/etc/freebsd-update.conf</code>
	のデフォルトの設定を変更しない限り、
	<code class="command">freebsd-update</code> は、
	他の更新と共にカーネルソースをアップデートします。
	新しいカスタムカーネルの再構築と再インストールは、
	通常通り行うことができます。</p><p><code class="command">freebsd-update</code> は、
	常にカーネルをアップデートするとは限りません。
	<code class="command">freebsd-update install</code>
	によってカーネルソースが変更されなかった場合には、
	カスタムカーネルを再構築する必要はありません。
	しかしながら <code class="command">freebsd-update</code> は、
	<code class="filename">/usr/src/sys/conf/newvers.sh</code>
	を常にアップデートします。
	これは、現在のシステムのパッチレベルを
	<code class="command">uname -r</code> が <code class="literal">-p</code>
	で表示する時にこのファイルが参照されます。
	そのため、何も変更されていない場合でも、
	カスタムカーネルを再構築することにより、
	<code class="command">uname</code> がシステムの正確なパッチレベルを報告するようになります。
	各システムにインストールされているアップデートをすばやく把握できるようになるので、
	特に複数のシステムを管理するときに助けとなります。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-upgrade"></a>18.2.3. メジャーおよびマイナーバージョンのアップグレードを行う</h3></div></div></div><p>FreeBSD のマイナーバージョン間のアップグレード、
	たとえば、FreeBSD 9.0 から FreeBSD 9.1 へのアップグレードは、
	<span class="emphasis"><em>マイナーバージョン</em></span> アップグレードと呼ばれます。
	<span class="emphasis"><em>メジャーバージョン</em></span> アップグレードは、
	FreeBSD 9.X から FreeBSD 10.X へのアップグレードといった、
	FreeBSD のメジャーバージョンが変わるようなアップグレードのことです。
	どちらのアップグレードもリリース番号のターゲットを指定する事で、
	<code class="command">freebsd-update</code> によって行う事ができます。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">カスタムカーネルを使っているシステムでは、
	  アップグレードを行う前に
	  <code class="filename">GENERIC</code> カーネルが、
	  <code class="filename">/boot/GENERIC</code>
	  に置かれている事を確認してください。
	  <code class="filename">GENERIC</code> カーネルを用意する方法については、
	  <a class="xref" href="updating-upgrading-freebsdupdate.html#freebsd-update-custom-kernel-9x" title="18.2.3.1. FreeBSD 9.X 以降のシステムにおけるカスタムカーネル">「FreeBSD 9.X 以降のシステムにおけるカスタムカーネル」</a> または <a class="xref" href="updating-upgrading-freebsdupdate.html#freebsd-update-custom-kernel-8x" title="18.2.3.2. FreeBSD 8.X におけるカスタムカーネル">「FreeBSD 8.X におけるカスタムカーネル」</a>
	  を参照してください。</p></div><p>以下のコマンドを実行すると、FreeBSD 9.0
	のシステムを FreeBSD 9.1 にアップグレードします。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update -r 9.1-RELEASE upgrade</code></strong></pre><p>コマンドを実行すると、<code class="command">freebsd-update</code>
	は設定ファイルと現在のシステムを評価し、
	アップデートするために必要な情報を収集します。
	画面には、どのコンポーネントが認識され、
	どのコンポーネントが認識されていないといったリストが表示されます。
	たとえば以下のように表示されます。</p><pre class="screen">Looking up update.FreeBSD.org mirrors... 1 mirrors found.
Fetching metadata signature for 9.0-RELEASE from update1.FreeBSD.org... done.
Fetching metadata index... done.
Inspecting system... done.

The following components of FreeBSD seem to be installed:
kernel/smp src/base src/bin src/contrib src/crypto src/etc src/games
src/gnu src/include src/krb5 src/lib src/libexec src/release src/rescue
src/sbin src/secure src/share src/sys src/tools src/ubin src/usbin
world/base world/info world/lib32 world/manpages

The following components of FreeBSD do not seem to be installed:
kernel/generic world/catpages world/dict world/doc world/games
world/proflibs

Does this look reasonable (y/n)? <strong class="userinput"><code>y</code></strong></pre><p>ここで、<code class="command">freebsd-update</code>
	はアップグレードに必要なすべてのファイルをダウンロードします。
	何をインストールし、どのように進むかといった質問をされることもあります。</p><p>カスタムカーネルを使っていると、
	上記のステップで以下のような警告が表示されます。</p><pre class="screen">WARNING: This system is running a "<em class="replaceable"><code>MYKERNEL</code></em>" kernel, which is not a
kernel configuration distributed as part of FreeBSD 9.0-RELEASE.
This kernel will not be updated: you MUST update the kernel manually
before running "/usr/sbin/freebsd-update install"</pre><p>この時点ではこの警告を無視してもかまいません。
	アップデートされた <code class="filename">GENERIC</code> カーネルは、
	アップグレードプロセスの途中で利用されます。</p><p>すべてのパッチがローカルシステムへダウンロードされたら、
	次にパッチが適用されます。
	このプロセスには時間がかかります。
	この時間はコンピュータの性能とワークロードに依存します。
	その後、設定ファイルがマージされます。
	このプロセスでは、ユーザはファイルをマージするか、
	画面上にエディタを立ち上げて手動でマージするかを尋ねられます。
	プロセスが進むごとに、成功したマージのすべての結果の情報がユーザに示されます。
	マージに失敗したり、無視した場合には、プロセスが中断します。
	ユーザによっては <code class="filename">/etc</code>
	のバックアップを取り、
	<code class="filename">master.passwd</code> や <code class="filename">group</code>
	のような重要なファイルを後で手動でマージする方もいます。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">すべてのパッチは別のディレクトリでマージされており、
	  まだ、システムには反映されていません。
	  すべてのパッチが正しく適用され、
	  すべての設定ファイルがマージされてプロセスがスムーズに進んだら、
	  ユーザは以下のコマンドを用いて、
	  変更点をディスクに反映してください。</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre></div><p>パッチは最初にカーネルとカーネルモジュールに対して当てられます。
	システムがカスタムカーネルを実行している場合には、
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=nextboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">nextboot</span>(8)</span></a> を使って次回の再起動時のカーネルを、
	アップデートされた <code class="filename">/boot/GENERIC</code>
	に設定してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>nextboot -k GENERIC</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="filename">GENERIC</code> カーネルで再起動する前に、
	  カーネルにシステムが適切に起動するために必要なすべてのドライバが含まれていること、
	  もしアップデートしているコンピュータがリモートでアクセスしているのであれば、
	  ネットワーク接続に必要なすべてのドライバも含まれていることを確認してください。
	  特に、これまで実行しているカスタムカーネルが、
	  カーネルモジュールとして提供されているビルドインの機能を含んでいるのであれば、
	  これらのモジュールを一時的に <code class="filename">/boot/loader.conf</code>
	  の機能を用いて、
	  <code class="filename">GENERIC</code> に読み込んでください。
	  アップグレードプロセスが終わるまでは、
	  重要ではないサービスを無効にするとともに、
	  必要のないディスクやネットワークのマウントなども避けることが推奨されています。</p></div><p>アップデートされたカーネルでコンピュータを再起動してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre><p>システムがオンラインに戻ったら、以下のコマンドを使って
	<code class="command">freebsd-update</code> を再び実行してください。
	アップデートプロセスの状態は保存されているので、
	<code class="command">freebsd-update</code> を実行すると、
	最初からではなく、次のステップに進み、
	古い共有ライブラリとオブジェクトファイルを削除します。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">使用しているライブラリのバージョン番号の付けられ方によって、
	  3 つのインストールフェーズが 2 つになる場合もあります。</p></div><p>アップグレードはこれで終了です。
	もしメジャーアップグレードを行った場合には、
	<a class="xref" href="updating-upgrading-freebsdupdate.html#freebsdupdate-portsrebuild" title="18.2.3.3. メジャーバージョンアップグレード後の package のアップグレード">「メジャーバージョンアップグレード後の
	  package のアップグレード」</a>
	で説明されているようにすべての ports および package
	を再構築してください。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsd-update-custom-kernel-9x"></a>18.2.3.1. FreeBSD 9.X 以降のシステムにおけるカスタムカーネル</h4></div></div></div><p><code class="command">freebsd-update</code> を使う前に、
	  <code class="filename">GENERIC</code> カーネルが
	  <code class="filename">/boot/GENERIC</code>
	  に置かれていることを確認してください。
	  ただ一度だけカスタムカーネルを構築したのであれば、
	  <code class="filename">/boot/kernel.old</code>
	  は <code class="filename">GENERIC</code> カーネルそのものです。
	  このディレクトリの名前を
	  <code class="filename">/boot/kernel</code>
	  へと変更してください。</p><p>もし、2 回以上カスタムカーネルを構築した後であったり、
	  カスタムカーネルを構築した回数がわからなければ、
	  現在のオペレーティングシステムのバージョンの
	  <code class="filename">GENERIC</code> カーネルを入手してください。
	  コンピュータへの物理的なアクセスが可能であれば、
	  インストールメディアから <code class="filename">GENERIC</code>
	  カーネルをインストールできます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /cdrom</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /cdrom/usr/freebsd-dist</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tar -C/ -xvf kernel.txz boot/kernel/kernel</code></strong></pre><p>別な方法としては、
	  <code class="filename">GENERIC</code> カーネルをソースから再構築して、
	  インストールしてください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make kernel __MAKE_CONF=/dev/null SRCCONF=/dev/null</code></strong></pre><p><code class="command">freebsd-update</code> がこのカーネルを
	  <code class="filename">GENERIC</code> カーネルとして認識するために、
	  <code class="filename">GENERIC</code> コンフィグレーションファイルは、
	  とにかく変更してはいけません。
	  また、特別なオプションを指定しないで構築してください。</p><p><code class="command">freebsd-update</code> は、
	  <code class="filename">/boot/GENERIC</code>
	  が存在する事だけを必要とするので、
	  <code class="filename">GENERIC</code>
	  カーネルで再起動する必要はありません。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsd-update-custom-kernel-8x"></a>18.2.3.2. FreeBSD 8.X におけるカスタムカーネル</h4></div></div></div><p>FreeBSD 8.X システムでは、<code class="filename">GENERIC</code>
	  カーネルを入手する方法や構築の方法が少し異なります。</p><p>コンピュータへの物理的なアクセスが可能であれば、
	  以下のコマンドを実行することで、
	  インストールメディアから <code class="filename">GENERIC</code>
	  カーネルをインストールできます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /cdrom</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /cdrom/<em class="replaceable"><code>X.Y-RELEASE</code></em>/kernels</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>./install.sh GENERIC</code></strong></pre><p>ここで <code class="filename"><em class="replaceable"><code>X.Y-RELEASE</code></em></code>
	  をリリース番号に置き換えてください。
	  <code class="filename">GENERIC</code> カーネルは、
	  デフォルトで <code class="filename">/boot/GENERIC</code>
	  にインストールされます。</p><p>または、<code class="filename">GENERIC</code>
	  カーネルをソースから再構築してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>env DESTDIR=/boot/GENERIC make kernel __MAKE_CONF=/dev/null SRCCONF=/dev/null</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv /boot/GENERIC/boot/kernel/* /boot/GENERIC</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -rf /boot/GENERIC/boot</code></strong></pre><p><code class="command">freebsd-update</code> が、このカーネルを
	  <code class="filename">GENERIC</code> カーネルとして扱うように、
	  <code class="filename">GENERIC</code> コンフィグレーションファイルは、
	  とにかく変更してはいけません。
	  また、特別なオプションを指定しないで構築してください。</p><p><code class="filename">GENERIC</code>
	  カーネルで再起動する必要はありません。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-portsrebuild"></a>18.2.3.3. メジャーバージョンアップグレード後の
	  package のアップグレード</h4></div></div></div><p>一般的に、マイナーバージョンアップグレードの後では、
	  インストールされているアプリケーションは、問題なく動作するでしょう。
	  メジャーバージョンが異なるとアプリケーションバイナリーインタフェース
	  (<acronym class="acronym">ABI</acronym>) が異なるため、
	  サードパーティ製のアプリケーションの多くは動作しなくなるでしょう。
	  メジャーバージョンアップグレード後には、
	  インストールされているすべての packages, ports
	  をアップグレードする必要があります。
	  package は、<code class="command">pkg upgrade</code>
	  を使ってアップグレードできます。
	  インストールされている ports をアップグレードする場合には、
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmaster/pkg-descr">ports-mgmt/portmaster</a>
	  といったユーティリティを使ってください。</p><p>すべての package の強制的なアップグレードでは、
	  バージョン番号が上がらない package に対しても、
	  リポジトリから最新のバージョンで、インストールされている
	  package を置き換えます。
	  FreeBSD のメージャーバージョンが変わるようなアップグレードでは、
	  ABI のバージョンも変わるため、
	  このようなアップグレードが必要になります。
	  強制的なアップグレードを行うには、以下のように実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg-static upgrade -f</code></strong></pre><p>インストールされているすべてのアプリケーションを再構築するには、
	  以下のコマンドを実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmaster -af</code></strong></pre><p>このコマンドを実行すると、
	  設定を変更するオプションを持つアプリケーションは、
	  設定変更のスクリーンを表示し、
	  ユーザからの指示待ちの状態で停止します。
	  この振る舞いをやめ、デフォルトのオプションを使用するには、
	  上記のコマンドに <code class="option">-G</code> を含めてください。</p><p>ソフトウェアのアップグレードが終わったら、最後にもう一度
	  <code class="command">freebsd-update</code>
	  を実行して、
	  すべてのアップグレードプロセスのやり残し作業を行い、
	  アップグレードのプロセスを完了してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><p><code class="filename">GENERIC</code>
	  カーネルを一時的に読み込んでいたのであれば、<a class="xref" href="kernelconfig.html" title="第9章 FreeBSD カーネルのコンフィグレーション">9章<em>FreeBSD カーネルのコンフィグレーション</em></a> に書かれている手順に従って、
	  新しいカスタムを構築し、インストールしてください。</p><p>コンピュータを再起動し、新しい FreeBSD を立ち上げてください。
	  これでアップグレードのプロセスは完了です。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-system-comparison"></a>18.2.4. システムの状態の比較</h3></div></div></div><p><code class="command">freebsd-update</code> を用いて、
	インストールされている FreeBSD の状態と、
	正しく動作することが分かっている状態とを比較できます。
	このコマンドは、現在のシステムのユーティリティ、ライブラリ、
	設定ファイルを評価するので、
	組み込みの侵入検知システム (<acronym class="acronym">IDS</acronym>)
	として使うことができます。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">このコマンドは、<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/snort/pkg-descr">security/snort</a>
	  のような本当の <acronym class="acronym">IDS</acronym>
	  の置き換えになるものではありません。
	  <code class="command">freebsd-update</code> はデータをディスクに保存するので、
	  不正な変更が行われる可能性があります。
	  <code class="varname">kern.securelevel</code> と、
	  <code class="command">freebsd-update</code> のデータを使用しないときに、
	  読み取りのみの許可属性に設定されているファイルシステムに置くことで、
	  不正な変更の可能性を低くできますが、
	  よりよい解決方法は、
	  <acronym class="acronym">DVD</acronym>
	  または安全に保存されている外部 <acronym class="acronym">USB</acronym>
	  ディスクのような安全なディスクとシステムを比較することです。
	  組み込まれているユーティリティを用いた、別の方法による
	  <acronym class="acronym">IDS</acronym> 機能については、
	  <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/security-intro.html#security-ids" target="_top">FreeBSD バイナリによる検出</a>
	  
	  の節をご覧ください。</p></div><p>比較を行うには、
	結果の出力先のファイル名を指定してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update IDS &gt;&gt; outfile.ids</code></strong></pre><p>システムは検査され、リリースファイルの <acronym class="acronym">SHA256</acronym>
	ハッシュ値と現在インストールされているファイルのハッシュ値がファイルの一覧と共に、
	指定した出力先のファイルに送られます。</p><p>これらの行は極めて長いのですが、出力形式は簡単にすぐに解析できます。
	たとえば、これらのリリースで異なっているすべてのファイルを知りたいのであれば、
	以下のコマンドを実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat outfile.ids | awk '{ print $1 }' | more</code></strong>
/etc/master.passwd
/etc/motd
/etc/passwd
/etc/pf.conf</pre><p>上の表示例では出力は切り捨てられており、
	実際にはもっと多くのファイルが存在します。
	これらのファイルには、運用中に変更されるファイルがあります。
	たとえば、<code class="filename">/etc/passwd</code>
	はユーザがシステムに追加されると変更されます。
	また、カーネルモジュールは、
	<code class="command">freebsd-update</code>
	によりアップデートされるため、変更されます。
	このような特別なファイルやディレクトリを除外するには、
	それらを <code class="filename">/etc/freebsd-update.conf</code> の
	<code class="literal">IDSIgnorePaths</code> オプションに追加してください。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="updating-upgrading.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="updating-upgrading.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="updating-upgrading-documentation.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">第18章 FreeBSD のアップデートとアップグレード〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓18.3. ドキュメントのアップデート</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>