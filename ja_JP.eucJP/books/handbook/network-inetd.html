<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>22.14. inetd 「スーパサーバ」</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="advanced-networking.html" title="第22章 高度なネットワーク" /><link rel="prev" href="network-natd.html" title="22.13. ネットワークアドレス変換 (NAT)" /><link rel="next" href="network-plip.html" title="22.15. パラレルライン IP (PLIP)" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">22.14. <span class="application">inetd</span> <span class="quote">「<span class="quote">スーパサーバ</span>」</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-natd.html">戻る</a>〓</td><th width="60%" align="center">第22章 高度なネットワーク</th><td width="20%" align="right">〓<a accesskey="n" href="network-plip.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-inetd"></a>22.14. <span class="application">inetd</span> <span class="quote">「<span class="quote">スーパサーバ</span>」</span></h2></div><div><span class="authorgroup">寄稿: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Lee</span> <span class="firstname">Chern</span> [FAMILY Given]</span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-overview"></a>22.14.1. 概観</h3></div></div></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> は複数のデーモンに対する接続を制御するので、
	<span class="quote">「<span class="quote">インターネットスーパサーバ</span>」</span> と呼ばれます。
	ネットワークサービスを提供するプログラムは、
	一般的にデーモン呼ばれます。<span class="application">inetd</span>
	は他のデーモンを管理するサーバを努めます。
	接続が <span class="application">inetd</span> によって受け付けられると、
	<span class="application">inetd</span>
	は接続がどのデーモンに対するものか判断して、
	そのデーモンを起動し、ソケットを渡します。
	<span class="application">inetd</span> を 1 つ実行することにより、
	それぞれのデーモンをスタンドアロンモードで実行することに比べ、
	全体としてのシステム負荷を減らします。</p><p>基本的に、<span class="application">inetd</span>
	は他のデーモンを起動するために使用されます。しかし、
	<span class="application">chargen</span>, <span class="application">auth</span>
	および <span class="application">daytime</span>
	のようなささいなプロトコルは直接扱われます。</p><p>この節ではコマンドラインオプションおよび設定ファイル
	<code class="filename">/etc/inetd.conf</code> による
	<span class="application">inetd</span> の設定の基本を説明します。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-settings"></a>22.14.2. 設定</h3></div></div></div><p><span class="application">inetd</span> は
	<code class="filename">/etc/rc.conf</code> の仕組によって初期化されます。
	デフォルトでは <code class="literal">inetd_enable</code> オプションは
	<span class="quote">「<span class="quote">NO</span>」</span> に設定されています。
	しかし多くの場合、<span class="application">sysinstall</span>
	でセキュリティプロファイルを
	medium に設定することにより、有効化されます。
	</p><pre class="programlisting">inetd_enable="YES"</pre><p> または
	</p><pre class="programlisting">inetd_enable="NO"</pre><p> を
	<code class="filename">/etc/rc.conf</code> に置くことで、起動時に
	<span class="application">inetd</span> を有効または無効にできます。</p><p>さらに <code class="literal">inetd_flags</code> オプションによって、
	いろいろなコマンドラインオプションを
	<span class="application">inetd</span> に渡すことができます。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-cmdline"></a>22.14.3. コマンドラインオプション</h3></div></div></div><p><span class="application">inetd</span> 書式</p><p><code class="option">     inetd [-d] [-l] [-w] [-W] [-c maximum] [-C rate] [-a address | hostname]
           [-p filename] [-R rate] [configuration file]</code></p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-d</span></dt><dd><p>デバッグモードにします。</p></dd><dt><span class="term">-l</span></dt><dd><p>成功した接続のログをとります。</p></dd><dt><span class="term">-w</span></dt><dd><p>外部サービスに対して TCP Wrapper を有効にします
	      (デフォルト)。</p></dd><dt><span class="term">-W</span></dt><dd><p><span class="application">inetd</span>
	      組み込みの内部サービスに対して TCP Wrapper を有効にします
	      (デフォルト)。</p></dd><dt><span class="term">-c maximum</span></dt><dd><p>サービス毎に同時に起動可能な最大値のデフォルトを指定します。
	      デフォルトでは無制限です。サービスごとに指定する
	      <code class="option">max-child</code>
	      パラメータで上書きできます。</p></dd><dt><span class="term">-C rate</span></dt><dd><p>1 分間にひとつの IP アドレスから起動されるサービスの、
	      最大値のデフォルトを指定します。デフォルトは無制限です。
	      サービスごとに指定する
	      <code class="option">max-connections-per-ip-per-minute</code>
	      パラメータで上書きできます。</p></dd><dt><span class="term">-R rate</span></dt><dd><p>あるサービスを 1 分間に起動できる最大の数を指定します。
	      デフォルトは 256 です。rate に 0 を指定すると、
	      起動可能な数は無制限になります。</p></dd><dt><span class="term">-a</span></dt><dd><p>バインドする IP アドレスを一つ指定します。
	      代わりにホスト名も指定できます。この場合、ホスト名に対応する
	      IPv4 または IPv6 アドレスが使用されます。通常
	      <span class="application">inetd</span> が <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>
	      内で起動される時点で、ホスト名が指定されます。この場合、
	      ホスト名は <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> 環境に対応するものです。</p><p>ホスト名指定が使用され、
	      IPv4 および IPv6 両方にバインドしたい場合、
	      <code class="filename">/etc/inetd.conf</code> の各サービスに対して、
	      各バインドに対する適切なプロトコルのエントリが必要です。
	      たとえば TCP ベースのサービスは、
	      ひとつはプロトコルに <span class="quote">「<span class="quote">tcp4</span>」</span> を使用し、
	      もう一つは <span class="quote">「<span class="quote">tcp6</span>」</span> を使用する、
	      2 つのエントリが必要です。</p></dd><dt><span class="term">-p</span></dt><dd><p>デフォルトとは異なる
	       PID を保持するファイルを指定します。</p></dd></dl></div><p><code class="filename">/etc/rc.conf</code> 内の
	<code class="literal">inetd_flags</code> オプションを用いて、これらのオプションを
	<span class="application">inetd</span> に渡すことができます。デフォルトでは
	<code class="literal">inetd_flags</code> は <span class="quote">「<span class="quote">-wW</span>」</span> に設定されており、
	これは <span class="application">inetd</span>
	の内部および外部サービスに対して TCP wrapper を有効にします。
	初心者ユーザはこれらのパラメータを変更する必要は通常ありませんし、
	<code class="filename">/etc/rc.conf</code> に入力する必要もありません。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">外部サービスは、接続を受け取ったときに起動される
	  <span class="application">inetd</span> の外部にあるデーモンで、
	  それに対して、内部サービスは <span class="application">inetd</span>
	  自身が提供する内部のデーモンです。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-conf"></a>22.14.4. <code class="filename">inetd.conf</code></h3></div></div></div><p><span class="application">inetd</span> の設定は
	<code class="filename">/etc/inetd.conf</code>
	ファイルによって制御されます。</p><p><code class="filename">/etc/inetd.conf</code> が変更されたときは、
	以下のように <span class="application">inetd</span> プロセスに
	HangUP シグナルを送ることにより、<span class="application">inetd</span>
	に設定ファイルを再読み込みさせられます。</p><div class="example"><a id="network-inetd-hangup"></a><div class="example-title">例22.4 <span class="application">inetd</span> への HangUP シグナル送付</div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP `cat /var/run/inetd.pid`</code></strong></pre></div></div><br class="example-break" /><p>設定ファイルのそれぞれの行は、
	個々のデーモンについての指示になります。
	ファイル内のコメントは <span class="quote">「<span class="quote">#</span>」</span> が先頭につきます。
	<code class="filename">/etc/inetd.conf</code> の書式は以下のとおりです。</p><pre class="programlisting">service-name
socket-type
protocol
{wait|nowait}[/max-child[/max-connections-per-ip-per-minute]]
user[:group][/login-class]
server-program
server-program-arguments</pre><p>IPv4 を利用する <span class="application">ftpd</span>
	デーモンのエントリの例です。</p><pre class="programlisting">ftp     stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -l</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">service-name</span></dt><dd><p>これは特定のデーモンのサービス名です。
	      これは <code class="filename">/etc/services</code>
	      内のサービスリストに対応していなければなりません。
	      これは <span class="application">inetd</span>
	      がどのポートで受け付けなければならないかを決定します。
	      新しいサービスが作成された場合、まずはじめに
	      <code class="filename">/etc/services</code>
	      内に記載しなければなりません。</p></dd><dt><span class="term">socket-type</span></dt><dd><p><code class="literal">stream</code>,
	      <code class="literal">dgram</code>, <code class="literal">raw</code> または
	      <code class="literal">seqpacket</code> のどれかを指定します。
	      <code class="literal">stream</code>
	      はコネクションに基づいた TCP デーモンに使用しなければならず、
	      一方で <code class="literal">dgram</code> は
	      UDP 転送プロトコルを利用したデーモンに対して使用されます。</p></dd><dt><span class="term">protocol</span></dt><dd><p>次のうちのどれか 1 つを指定します。</p><div class="informaltable"><table border="1"><colgroup><col /><col /></colgroup><thead><tr><th>プロトコル</th><th>説明</th></tr></thead><tbody><tr><td>tcp, tcp4</td><td>TCP IPv4</td></tr><tr><td>udp, udp4</td><td>UDP IPv4</td></tr><tr><td>tcp6</td><td>TCP IPv6</td></tr><tr><td>udp6</td><td>UDP IPv6</td></tr><tr><td>tcp46</td><td>TCP IPv4 および v6 の両方</td></tr><tr><td>udp46</td><td>UDP IPv4 および v6 の両方</td></tr></tbody></table></div></dd><dt><span class="term">{wait|nowait}[/max-child[/max-connections-per-ip-per-minute]]</span></dt><dd><p><code class="option">wait|nowait</code> は
	      <span class="application">inetd</span> から起動したデーモンが、
	      自分のソケットを管理できるかどうかを示します。
	      通常マルチスレッド化されている stream ソケットデーモンは
	      <code class="option">nowait</code> を使用するべきである一方、
	      <code class="option">dgram</code> ソケットタイプは
	      wait オプションを使用しなければなりません。
	      <code class="option">nowait</code>
	      は新しいソケット毎に子のデーモンを起動する一方で、
	      <code class="option">wait</code>
	      は通常複数のソケットを 1 つのデーモンに渡します。</p><p><span class="application">inetd</span>
	      が起動できる子のデーモンの最大数は
	      <code class="option">max-child</code> オプションで設定できます。
	      特定のデーモンに対して、起動する数が
	      10 までという制限が必要な場合、
	      <code class="option">nowait</code> の後に <code class="literal">/10</code>
	      を置きます。</p><p><code class="option">max-child</code> に加えて、他にある
	      1 つの場所から特定のデーモンへの最大接続数を制限するオプションが利用できます。
	      <code class="option">max-connections-per-ip-per-minute</code>
	      がそれです。ここに 10 を指定すると、特定の
	      IP アドレスからの特定のサービスへの接続を
	      1 分間につき 10 回に制限します。
	      これは故意または故意でない資源の浪費および、
	      マシンへのサービス不能 (DoS) 攻撃を防ぐのに有用です。</p><p><code class="option">wait</code> または
	      <code class="option">nowait</code> はこの欄に必ず必要です。
	      <code class="option">max-child</code> および
	      <code class="option">max-connections-per-ip-per-minute</code>
	      は任意です。</p><p><code class="option">max-child</code> または
	      <code class="option">max-connections-per-ip-per-minute</code>
	      制限をかけない
	      stream タイプのマルチスレッドデーモンの設定は
	      <code class="literal">nowait</code> になります。</p><p>作成できる子プロセスの上限が 10 である同じデーモンの設定は
	      <code class="literal">nowait/10</code> になります。</p><p>さらに、
	      1 分間に IP アドレスあたりの接続制限が 20、
	      子プロセスの上限が 10 である同じデーモンの設定は
	      <code class="literal">nowait/10/20</code> になります。</p><p>以下のように、これらのオプションはすべて
	      <span class="application">fingerd</span>
	      デーモンのデフォルト設定に使われています。</p><pre class="programlisting">finger stream  tcp     nowait/3/10 nobody /usr/libexec/fingerd fingerd -s</pre></dd><dt><span class="term">user</span></dt><dd><p>user はあるデーモンが実行するときのユーザ名を指定します。
	      一般的にデーモンは <code class="systemitem">root</code>
	      ユーザとして実行します。セキュリティを考慮して、
	      いくつかのサーバは <code class="systemitem">daemon</code> ユーザ、
	      または最低の権限が与えられている <code class="systemitem">nobody</code>
	      ユーザとして実行することも多く見られます。</p></dd><dt><span class="term">server-program</span></dt><dd><p>接続を受け取ったときに実行するデーモンのフルパスです。
	      デーモンが <span class="application">inetd</span>
	      によって内部的に提供されるサービスの場合
	      <code class="option">internal</code> を使用します。</p></dd><dt><span class="term">server-program-arguments</span></dt><dd><p>ここには、起動するときにデーモンに渡される、
	      argv[0] から始まる引数を指定して、
	      <code class="option">server-program</code> と協調して動作します。
	      <span class="application">mydaemon -d</span> がコマンドラインの場合、
	      <code class="option">server program arguments</code> の値に
	      <code class="literal">mydaemon -d</code> を指定します。
	      また、デーモンが内部サービスの場合、ここに
	      <code class="option">internal</code> を指定します。</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-security"></a>22.14.5. セキュリティ</h3></div></div></div><p>インストールの時に選択したセキュリティプロファイルによっては、
	多くの <span class="application">inetd</span>
	のデーモンがデフォルトで有効になっているかもしれません。
	あるデーモンが特に必要でない場合には、それを無効にしてください!
	問題となっているデーモンが記述されている行の先頭に
	<span class="quote">「<span class="quote">#</span>」</span> をおいて <a class="link" href="network-inetd.html#network-inetd-hangup" title="例22.4 inetd への HangUP シグナル送付">inetd
	  にハングアップシグナル</a>を送ってください。
	<span class="application">fingerd</span> のようないくつかのデーモンは、
	動かそうとすべきではないかもしれません。なぜなら、
	それらは攻撃者に対してあまりにも多くの情報を与えるからです。</p><p>セキュリティをあまり考慮せず、
	接続試行に対してタイムアウトまでの時間が長いか、
	タイムアウトしないデーモンもあります。
	これは、特定のデーモンに攻撃者がゆっくり接続要求を送ることによって、
	利用可能なリソースを飽和させることを可能にします。ある種のデーモンに
	<code class="option">ip-per-minute</code> および <code class="option">max-child</code>
	制限を設けることはよい考えかもしれません。</p><p>TCP wrapper はデフォルトで有効です。
	<span class="application">inetd</span>
	から起動されるさまざまなデーモンに対して
	TCP 制限を設けることの詳細については
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a> マニュアルページを参照してください。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-misc"></a>22.14.6. その他</h3></div></div></div><p><span class="application">daytime</span>,
	<span class="application">time</span>,
	<span class="application">echo</span>,
	<span class="application">discard</span>,
	<span class="application">chargen</span> および
	<span class="application">auth</span> はすべて
	<span class="application">inetd</span>
	が内部的に提供するサービスです。</p><p><span class="application">auth</span> サービスは identity
	(ident, identd) ネットワークサービスを提供し、
	ある程度設定可能です。</p><p>詳細については <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> マニュアルを参照してください。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-natd.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="network-plip.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">22.13. ネットワークアドレス変換 (NAT)〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓22.15. パラレルライン IP (PLIP)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>