<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>22.12. NTP</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="advanced-networking.html" title="第22章 高度なネットワーク" /><link rel="prev" href="network-dns.html" title="22.11. DNS" /><link rel="next" href="network-natd.html" title="22.13. ネットワークアドレス変換 (NAT)" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">22.12. NTP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-dns.html">戻る</a>〓</td><th width="60%" align="center">第22章 高度なネットワーク</th><td width="20%" align="right">〓<a accesskey="n" href="network-natd.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ntp"></a>22.12. NTP</h2></div><div><span class="authorgroup">寄稿: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Hukins</span> <span class="firstname">Tom</span> [FAMILY Given]</span>. </span></div></div></div><a id="idp97232080" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97232592"></a>22.12.1. 概説</h3></div></div></div><p>時間の経過とともに、コンピュータの時計はずれてしまいがちです。
	時間が経つと、コンピュータの時計は正確でなくなってゆきます。
	NTP (Network Time Protocol)
	は時計が正確であることを保証する方法の一つです。</p><p>インターネットサービスの多くは、
	コンピュータの時計が正確であることに依存しているか、
	あるいは多くを負っています。
	たとえば web サーバ は、
	あるファイルがある時刻以降に修正されていたらそのファイルを送ってほしいという要求を受け取るかもしれません。
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> のようなサービスは所定の時間にコマンドを実行します。
	時計が正確でない場合、
	これらのコマンドは期待したとおりには実行されないかもしれません。</p><a id="idp97234768" class="indexterm"></a><p>FreeBSD は <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> NTP サーバを搭載しています。これは、
	マシンの時計を合わせるために他の NTP サーバに問い合わせをしたり、
	他のマシンに対して時刻を報じるために使用できます。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97237328"></a>22.12.2. 適切な NTP サーバの選択</h3></div></div></div><a id="idp97237968" class="indexterm"></a><p>時刻を同期するために利用する NTP サーバを、
	一つ以上見つける必要があります。
	ネットワーク管理者、または ISP はこの目的のために
	NTP サーバを設定しているかもしれません ―
	本当にそうなのか確かめるためにドキュメントを確認してください。
	あなたの近くの NTP サーバを探せる
	<a class="link" href="http://www.eecis.udel.edu/~mills/ntp/servers.html" target="_top">公にアクセス可能な
	NTP サーバのリスト</a> があります。
	どのサーバを選択するとしても、そのサーバの運営ポリシを理解し、
	要求されているなら利用許可を求めることを忘れないでください。</p><p>使用しているサーバのうちのどれかが到達不能になるか、
	その時計の信頼性が低い場合、無関係の
	NTP サーバをいくつか選択するとよいでしょう。
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> は他のサーバから受け取った応答を賢く利用します ―
	信頼できないサーバより信頼できるサーバを重視します。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97241296"></a>22.12.3. マシンの設定</h3></div></div></div><a id="idp97241936" class="indexterm"></a><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97243088"></a>22.12.3.1. 基本設定</h4></div></div></div><a id="idp97264336" class="indexterm"></a><p>マシンが起動するときだけ時計を同期させたい場合は
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> が使えます。頻繁に再起動され、
	  たまに同期すれば十分なデスクトップマシンには適切かもしれません。
	  しかしほとんどのマシンでは <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> を実行するべきです。</p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> を動かしているマシンでも、起動時に
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> を使用するのはよい考えです。
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> プログラムは時計を徐々に変更します。しかし
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a>
	  は正しい時刻と現在設定されているマシンの時刻がどんなに離れていようとも時計を設定します。</p><p>起動時に <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> を有効にするためには、
	  <code class="literal">ntpdate_enable="YES"</code> を
	  <code class="filename">/etc/rc.conf</code> に追加してください。
	  さらに、同期したいすべてのサーバおよび、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a>
	  に渡すあらゆるフラグを <code class="varname">ntpdate_flags</code>
	  に指定する必要があるでしょう。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97277648"></a>22.12.3.2. 一般設定</h4></div></div></div><a id="idp97278288" class="indexterm"></a><p>NTP は <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a> に記述された書式の
	  <code class="filename">/etc/ntp.conf</code> ファイルによって設定されます。
	  簡単な例を以下に示します。</p><pre class="programlisting">server ntplocal.example.com prefer
server timeserver.example.org
server ntp2a.example.net

driftfile /var/db/ntp.drift</pre><p><code class="literal">server</code> オプションは、
	  使用するサーバを一行に一つずつ指定します。サーバが上記の
	  <code class="systemitem">ntplocal.example.com</code> のように
	  <code class="literal">prefer</code> 引数とともに指定された場合、
	  このサーバは他のサーバより優先されます。
	  優先されたサーバからの応答は、
	  他のサーバの応答と著しく異なる場合は破棄されますが、
	  そうでなければ他の応答を考慮することなく使用されます。
	  <code class="literal">prefer</code> 引数は、通常、
	  特別な時間モニタハードウェアを備えているような非常に正確であるとされている
	  NTP サーバに対して使用されます。</p><p><code class="literal">driftfile</code>
	  オプションはシステム時計の周波数オフセットを格納するために使用するファイルを指定します。
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> プログラムは、
	  時計の自然変動を自動的に補正するためにこれを用います。
	  これにより、一定時間外部の時刻ソースから切り離されたとしても、
	  十分正確な時刻を維持することを可能にします。</p><p><code class="literal">driftfile</code> オプションは、使用している NTP
	  サーバから過去に受け取った応答に関する情報を格納するために、
	  どのファイルが使用されるか指定します。
	  このファイルは NTP に関する内部情報を含んでいます。
	  これは他のプロセスによって修正されてはいけません。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97285712"></a>22.12.3.3. サーバへのアクセス制御</h4></div></div></div><p>デフォルトでは NTP
	  サーバはインターネット上のすべてのホストからアクセスが可能です。
	  <code class="filename">/etc/ntp.conf</code> 内で <code class="literal">restrict</code>
	  オプションを指定することによって、
	  どのマシンがサーバにアクセスできるかを制御できるようにします。</p><p>NTP サーバにアクセスするマシンのすべてを拒否したいのなら、
	  以下の行を <code class="filename">/etc/ntp.conf</code>
	  に追加してください。</p><pre class="programlisting">restrict default ignore</pre><p>あなたのネットワーク内のマシンにだけサーバに接続して時計を同期することを認めたいが、
	  それらからサーバに対して設定を行うのを許さず、
	  同期する端末としても利用されないようにしたいのなら、
	  以下を加えてください。</p><pre class="programlisting">restrict 192.168.1.0 mask 255.255.255.0 notrust nomodify notrap</pre><p><code class="systemitem">192.168.1.0</code>
	  をあなたのネットワークの IP アドレスに
	  <code class="systemitem">255.255.255.0</code>
	  をあなたのネットワークのネットマスクに置き換えてください。</p><p><code class="filename">/etc/ntp.conf</code> には複数の
	  <code class="literal">restrict</code> オプションを置けます。
	  詳細に付いては <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a> の
	  <code class="literal">Access Control Support</code>
	  サブセクションを参照してください。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97301712"></a>22.12.4. NTP サーバの実行</h3></div></div></div><p>NTP サーバが起動時に実行されることを保証するために、
	<code class="literal">xntpd_enable="YES"</code> を
	<code class="filename">/etc/rc.conf</code> に加えてください。
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> にフラグを追加したい場合は
	<code class="filename">/etc/rc.conf</code> 内の
	<code class="varname">xntpd_flags</code> パラメータを編集してください。</p><p>マシンを再起動することなくサーバを実行したいときは、
	<code class="filename">/etc/rc.conf</code> 内の <code class="varname">xntpd_flags</code>
	で追加されたパラメータをすべて指定して
	<code class="command">ntpd</code> を実行してください。以下に例を示します。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ntpd -p /var/run/ntpd.pid</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD 5.X では <code class="filename">/etc/rc.conf</code>
	  内のさまざまなオプションの名前が変わりました。
	  したがって、上記の
	  <code class="literal">xntpd</code> に関するオプションは
	  <code class="literal">ntpd</code> に置き換えてください。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97317968"></a>22.12.5. 一時的なインターネット接続で ntpd を使用する</h3></div></div></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> プログラムは正しく機能するために、
	インターネットへの常時接続を必要としません。しかしながら、
	オンデマンドでダイアルアップされるように設定された一時的な接続の場合、
	NTP トラフィックがダイアルを引き起こしたり、
	接続を維持し続けるようなことを避けるようにした方がよいでしょう。
	ユーザ PPP を使用している場合、以下の例のように
	<code class="filename">/etc/ppp/ppp.conf</code> 内で
	<code class="literal">filter</code> ディレクティブが使用できます。</p><pre class="programlisting"> set filter dial 0 deny udp src eq 123
 # Prevent NTP traffic from initiating dial out
 set filter dial 1 permit 0 0
 set filter alive 0 deny udp src eq 123
 # Prevent incoming NTP traffic from keeping the connection open
 set filter alive 1 deny udp dst eq 123
 # Prevent outgoing NTP traffic from keeping the connection open
 set filter alive 2 permit 0/0 0/0</pre><p>詳細については <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> 内の <code class="literal">PACKET FILTERING</code>
	セクション、および <code class="filename">/usr/share/examples/ppp/</code>
	内の例を参照してください。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">小さい番号のポートをブロックするインターネットアクセスプロバイダでは、
	  応答があなたのマシンに到達しないので
	  NTP がきちんと動作しない場合もあります。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97323600"></a>22.12.6. さらなる情報源</h3></div></div></div><p>NTP サーバに関する文書は HTML 形式で
	<code class="filename">/usr/share/doc/ntp/</code> にあります。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-dns.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="network-natd.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">22.11. DNS〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓22.13. ネットワークアドレス変換 (NAT)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>