<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>19.6. シリアルコンソールの設定</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="serialcomms.html" title="第19章 シリアル通信" /><link rel="prev" href="dialout.html" title="19.5. ダイアルアウトサービス" /><link rel="next" href="ppp-and-slip.html" title="第20章 PPP と SLIP" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">19.6. シリアルコンソールの設定</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="dialout.html">戻る</a>〓</td><th width="60%" align="center">第19章 シリアル通信</th><td width="20%" align="right">〓<a accesskey="n" href="ppp-and-slip.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="serialconsole-setup"></a>19.6. シリアルコンソールの設定</h2></div><div><span class="authorgroup">寄稿: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">YOKOTA</span> <span class="firstname">Kazutaka</span> [FAMILY Given]</span>. </span></div><div><span class="authorgroup">原作: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Paul</span> <span class="firstname">Bill</span> [FAMILY Given]</span>. </span></div></div></div><a id="idp93823824" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-intro"></a>19.6.1. 導入</h3></div></div></div><p>FreeBSD は、
	コンソールとしてシリアルポート上のダム端末しか持たないシステムでも起動します。
	この様な構成はきっと次のような二種類の人達に便利でしょう。それは、
	キーボードやモニタのないマシンに
	FreeBSD をインストールしたいシステム管理者と、
	カーネルやデバイスドライバをデバッグしたい開発者です。</p><p><a class="xref" href="boot.html" title="第13章 FreeBSD の起動のプロセス">13章<em>FreeBSD の起動のプロセス</em></a> で説明されているように、
	FreeBSD は 3 ステージ構成のブートストラップを用いています。
	最初の 2 つのステージは、
	ブートディスクにある FreeBSD スライスの最初に格納されている、
	ブートブロックのコードが行います。
	それからブートブロックは、第 3 ステージのコードとしてブートローダ
	(<code class="filename">/boot/loader</code>) を読み込み、実行します。</p><p>シリアルコンソールを設定するためには、ブートブロックコード、
	ブートローダコード、カーネルを設定する必要があります。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-howto"></a>19.6.2. シリアルコンソールの設定</h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>シリアルケーブルを用意してください。</p><a id="idp93828816" class="indexterm"></a><p>ヌルモデムケーブル、
	    もしくは標準シリアルケーブルとヌルモデムアダプタが必要となります。
	    シリアルケーブルについては <a class="xref" href="serial.html#serial-cables-ports" title="19.2.2. ケーブルとポート">「ケーブルとポート」</a>
	    をご覧ください。</p></li><li class="step"><p>キーボードをはずして下さい。</p><p>たいていの PC システムは Power-On Self-Test (POST)
	    の間にキーボードを検出し、もし見つからなければエラーと
	    なります。また、キーボードがないことを大きな音で知らせ、
	    キーボードが接続されるまでは起動を中断するようなマシンもあります。</p><p>コンピュータがエラーを表示していても、
	    とにかく起動するなら特別な対応は必要ありません
	    (Phoenix BIOS を搭載しているマシンには、
	    <span class="errorname">Keyboard failed</span>
	    と表示されても、正常に起動するものがあります)。</p><p>あなたのコンピュータがキーボードを接続していない状態で
	    起動しないようなら、(もし可能ならば) エラーを無視するように
	    BIOS を設定する必要があります。設定方法の詳細については、
	    マザーボードのマニュアルを調べてください。</p><div xmlns="" class="tip"><h3 class="admontitle">ヒント: </h3><p xmlns="http://www.w3.org/1999/xhtml">BIOS の設定でキーボードを <span class="quote">「<span class="quote">Not installed</span>」</span>
	      にするということは、キーボードを使えないということを
	      意味しているわけでは<span class="emphasis"><em>ありません</em></span>。これは、BIOS
	      がキーボードがなくても文句を言わないように、電源投入時には
	      キーボードを探すな、と指示するだけです。このフラグを
	      <span class="quote">「<span class="quote">Not installed</span>」</span> にしていてもキーボードを
	      接続したままにできますし、ちゃんと動作します。</p></div><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">あなたのシステムが PS/2 マウスを使っているなら、
	      おそらくマウスもキーボード同様にはずす必要があるでしょう。
	      というのは、PS/2 マウスは部分的にキーボードとハードウェアを
	      共有しており、マウスを接続したままにしていると、
	      キーボードも存在する、と誤って検出してしまう可能性があるからです。
	      AMI BIOS を持つ Gateway 2000 Pentium 90MHz システム
	      はこれに該当すると言われています。
	      一般的にこれは問題ではありません。なぜなら、どっちにしても
	      マウスはキーボードなしではたいして役に立たないからです。</p></div></li><li class="step"><p><code class="filename">COM1</code> (<code class="filename">sio0</code>)
	    にダム端末を接続してください。</p><p>ダム端末がなければ、かわりに古い PC/XT でモデム
	    プログラムを走らせて使ったり、シリアルポートに他の Unix
	    マシンを繋いだりできます。もしも <code class="filename">COM1</code>
	    (<code class="filename">sio0</code>) がなければ、作成してください。
	    今のところ、<code class="filename">COM1</code> 以外のポートを
	    選択するためにはブートブロックの再コンパイルが必要です。
	    すでに <code class="filename">COM1</code> を他の装置に
	    使っていた場合は、一時的にその装置をはずして
	    いったん FreeBSD がうまく動作してから、
	    新しいブートブロックとカーネルをインストールしてください。
	    (上記はとにかくファイル/演算/端末サーバの
	    <code class="filename">COM1</code> が利用可能であると仮定して
	    います。あなたが本当に何かのために
	    <code class="filename">COM1</code> が必要 (で、なおかつその何かを
	    <code class="filename">COM2</code> (<code class="filename">sio1</code>)
	    に付け替えることができない) ならば、多分、そもそも
	    悩んでる場合ではありません。)</p></li><li class="step"><p>カーネルコンフィグファイルの <code class="filename">COM1</code>
	    (<code class="filename">sio0</code>) に適切なフラグを
	    設定していることを確認してください。</p><p>関連するフラグ:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">0x10</code></span></dt><dd><p>このポートのコンソールサポートを有効にします。
		  このフラグが設定されない場合、他のフラグは無視されます。
		  現在のところ、一つのポートしかコンソールサポートを有効に
		  できません。(config ファイルに書かれた順番で) 最初にこのフラグを
		  指定されたポートが選択されます。
		  なお、このオプションを指定するだけでシリアルポートが
		  コンソールとして使えるわけではありません。
		  このフラグと一緒に、以下のフラグも指定するかもしくは
		  <code class="option">-h</code> オプションも使ってください。</p></dd><dt><span class="term"><code class="literal">0x20</code></span></dt><dd><p>後述される <code class="option">-h</code> オプション
		  を無視して、(他に優先度の高いコンソールがない限り)
	          このポートをコンソールとして指定します。
		  このフラグは FreeBSD バージョン
		  2.<em class="replaceable"><code>X</code></em> の
		  <code class="literal">COMCONSOLE</code> オプションに対応するものです。
		  フラグ <code class="literal">0x20</code> は必ず
		  フラグ <code class="option">0x10</code> と一緒に指定されなければなりません。</p></dd><dt><span class="term"><code class="literal">0x40</code></span></dt><dd><p>(<code class="literal">0x10</code> と組み合わせることで)
		  このポートを予約し、通常のアクセスができない
		  ようにします。
		  このフラグは、シリアルコンソールとして使いたいポートに
		  指定すべきではありません。
		  唯一の使い道は、ユニットがカーネルのリモートデバッグ用
		  であることを指定することです。
		  リモートデバッグの詳細については
	          <a class="link" href="../developers-handbook/index.html" target="_top">The
		  Developer's Handbook</a> を参照してください。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD 4.0 以降では、
		    フラグ <code class="literal">0x40</code> の意味が若干異なり、
		    シリアルポートにリモートデバッグを指定するためには、
		    別のフラグを使います。</p></div></dd></dl></div><p>例:</p><pre class="programlisting">device sio0 at isa? port "IO_COM1" tty flags 0x10 irq 4</pre><p>詳細については <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sio&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">sio</span>(4)</span></a>
	    のマニュアルを参照してください。</p><p>もしこれらのフラグがセットされていなければ、(別のコンソールで)
	    UserConfig を実行するか、
	    カーネルを再コンパイルする必要があります。</p></li><li class="step"><p>ブートドライブの <code class="literal">a</code> パーティションの
	    ルートディレクトリに <code class="filename">boot.config</code>
	    を作成してください。</p><p>このファイルは、ブートブロックコードに対してどのように
	    システムを起動したいかを教えます。
	    シリアルコンソールを活かすためには、以下のオプションを幾つか
	    ― 複数の場合も一行で、設定する必要があります:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-h</code></span></dt><dd><p>内蔵コンソールとシリアルコンソールの切替えを行います。
		  これを使用してコンソールデバイスを変更できます。
		  例えば、内蔵 (ビデオ) コンソールからブートした場合、
		  カーネルとブートローダがコンソールデバイスとして
		  シリアルポートを使用するようにするため、
		  <code class="option">-h</code> を使って指示できます。
		  反対に、シリアルポートからブートした場合、
		  ブートローダとカーネルがコンソールとして代わりに
		  ビデオディスプレイを使用するようにするため、
		  <code class="option">-h</code> を使用できます。</p></dd><dt><span class="term"><code class="option">-D</code></span></dt><dd><p>シングルとデュアルのコンソール設定を切り替えます。
		  シングル設定では、上記の <code class="option">-h</code>
		  オプションの状態によって、コンソールは内蔵コンソール
		  (ビデオディスプレイ)かシリアルポートのいずれかになります。
		  デュアルコンソール設定では、ビデオディスプレイと
		  シリアルポートの両方が、<code class="option">-h</code>
		  オプションの状態によらず、同時にコンソールになります。
		  しかし、デュアルコンソール設定は、ブートブロックが
		  実行されている間でしか効果を持ちません。
		  一旦ブートローダに制御が移ると、<code class="option">-h</code>
		  オプションによって指定されたコンソールが
		  唯一のコンソールになります。</p></dd><dt><span class="term"><code class="option">-P</code></span></dt><dd><p>ブートブロックがキーボードを検出するようにします。
		  キーボードが発見できなかった場合には、
		  <code class="option">-D</code> と <code class="option">-h</code>
	          オプションが自動的にセットされます。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">現バージョンのブートブロックでは容量の制限により、
		    <code class="option">-P</code> オプションは拡張キーボードしか
		    検出できません。キーが 101 個より少ない (そして F11
		    と F12 がない) キーボードは検出されない可能性があります。
		    この制限から、いくつかのラップトップコンピュータの
		    キーボードは正しく検出されないでしょう。
		    もし、あなたのシステムがこのようなキーボードを使っているのであれば、
		    <code class="option">-P</code> オプションを外してください。
		    残念ながら、この問題の回避策はありません。</p></div></dd></dl></div><p><code class="option">-P</code> オプションを使ってコンソールを
	    自動的に選ぶか、<code class="option">-h</code> オプションを使って
	    シリアルコンソールを有効にしてください。</p><p>さらに <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=boot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">boot</span>(8)</span></a> で説明されている他のオプションも使う
	    ことができます。</p><p><code class="option">-P</code> 以外のオプションはブートローダ
	    (<code class="filename">/boot/loader</code>) に渡されます。
	    ブートローダは、<code class="option">-h</code> オプションだけの状態を
	    調べることで内蔵ビデオとシリアルポートのどちらがコンソールに
	    なるのか決めます。
	    つまり、<code class="filename">/boot.config</code> の中で
	    <code class="option">-D</code> オプションを指定して
	    <code class="option">-h</code> オプションを指定しなかった場合、
	    ブートブロック実行中でのみシリアルポートをコンソールとして
	    使うことができます。ブートローダは内蔵ビデオディスプレイを
	    コンソールとして使います。</p></li><li class="step"><p>マシンを起動する。</p><p>FreeBSD を起動したとき、ブートブロックは
	    <code class="filename">/boot.config</code> の内容をコンソールに表示
	    します。例えば、</p><pre class="screen">/boot.config: -P
Keyboard: no</pre><p>行の二番目は、
	    <code class="filename">/boot.config</code> にオプション
	    <code class="option">-P</code> が指定してあるときだけ表示され、
	    キーボードが存在するかどうかを表します。
	    これらのメッセージは、シリアルか内蔵のいずれか、
	    あるいはその両方のコンソールに表示されます。
	    どちらに表示されるかは、
	    <code class="filename">/boot.config</code> の設定によって変わります。</p><div class="informaltable"><table border="0"><colgroup><col /><col /></colgroup><thead><tr><th>オプション指定</th><th>メッセージの表示される場所</th></tr></thead><tbody><tr><td>なし</td><td>内蔵</td></tr><tr><td><code class="option">-h</code></td><td>シリアル</td></tr><tr><td><code class="option">-D</code></td><td>シリアルと内蔵の両方</td></tr><tr><td><code class="option">-Dh</code></td><td>シリアルと内蔵の両方</td></tr><tr><td><code class="option">-P</code>、キーボードが存在する場合</td><td>内蔵</td></tr><tr><td><code class="option">-P</code>、キーボードが存在しない場合</td><td>シリアル</td></tr></tbody></table></div><p>このメッセージが表示された後、
	    ブートブロックがブートローダのロードを再開し、
	    他の全てのメッセージがコンソールに表示されるまで、
	    若干時間がかかります。通常の環境では、ブートブロックに
	    割り込みをかける必要はありませんが、
	    ちゃんとセットアップされているかどうか確かめるために、
	    割り込みをかけることができるようになっています。</p><p>ブートプロセスに割り込みをかけるには、
	    コンソールの (<span class="keycode">Enter</span> 以外の)
	    キーをたたいて下さい。
	    ブートブロックはその時、操作を指定するためのプロンプトを表示します。
	    こんな風に表示されるでしょう。
	  </p><pre class="screen">&gt;&gt; FreeBSD/i386 BOOT
Default: 0:wd(0,a)/boot/loader
boot:</pre><p>上に示したメッセージが、シリアルか内蔵、
	    あるいはその両方といった、<code class="filename">/boot.config</code>
	    で指定したとおりのコンソールに表示されることを確認して下さい。
	    メッセージが正しいコンソールに表示されたら、
	    <span class="keycode">Enter</span>
	    キーを押してブートプロセスを継続してください。
	  </p><p>もし、シリアルコンソールを利用するように設定しているのに
	    シリアル端末にプロンプトが出てこない場合は、
	    設定のどこかに間違いがあります。
	    ブートブロック(とブートローダ、カーネル)に対して
	    シリアルポートをコンソールに使うことを伝えるため、
	    割り込みをかけた時に <code class="option">-h</code> を入力し、
	    (可能ならば) Enter/Return キーを押して下さい。そして、
	    一度システムを起動させてから、どこが悪いのかをチェックして下さい。</p></li></ol></div><p>ブートローダがロードされ、ブートプロセスの第三ステージに
      いる時には、まだ内蔵コンソールとシリアルコンソールを切り替えることができます。
      それにはブートローダの環境変数を適切に設定すれは良いのですが、
      詳細については <a class="xref" href="serialconsole-setup.html#serialconsole-loader" title="19.6.5. ブートローダからコンソールを変更するには">「ブートローダからコンソールを変更するには」</a> を参照してください。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-summary"></a>19.6.3. まとめ</h3></div></div></div><p>このセクションで扱ったさまざまな設定と、
	最終的に選択されるコンソールに関するまとめです。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93908048"></a>19.6.3.1. Case 1: <code class="filename">sio0</code> の
	  flags に 0x10 をセットした場合</h4></div></div></div><pre class="programlisting">device sio0 at isa? port "IO_COM1" tty flags 0x10 irq 4</pre><div class="informaltable"><table border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>/boot.config 内のオプション</th><th>ブートブロック実行中のコンソール</th><th>ブートローダ実行中のコンソール</th><th>カーネルのコンソール</th></tr></thead><tbody><tr><td>なし</td><td>内蔵</td><td>内蔵</td><td>内蔵</td></tr><tr><td><code class="option">-h</code></td><td>シリアル</td><td>シリアル</td><td>シリアル</td></tr><tr><td><code class="option">-D</code></td><td>内蔵、シリアルの両方</td><td>内蔵</td><td>内蔵</td></tr><tr><td><code class="option">-Dh</code></td><td>内蔵、シリアルの両方</td><td>シリアル</td><td>シリアル</td></tr><tr><td><code class="option">-P</code>、キーボードが存在する場合</td><td>内蔵</td><td>内蔵</td><td>内蔵</td></tr><tr><td><code class="option">-P</code>、キーボードが存在しない場合</td><td>内蔵、シリアルの両方</td><td>シリアル</td><td>シリアル</td></tr></tbody></table></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93934288"></a>19.6.3.2. Case 2:  sio0 の flags に 0x30 をセットした場合</h4></div></div></div><pre class="programlisting">device sio0 at isa? port "IO_COM1" tty flags 0x30 irq 4</pre><div class="informaltable"><table border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>/boot.config 内のオプション</th><th>ブートブロック実行中のコンソール</th><th>ブートローダ実行中のコンソール</th><th>カーネルのコンソール</th></tr></thead><tbody><tr><td>なし</td><td>内蔵</td><td>内蔵</td><td>シリアル</td></tr><tr><td><code class="option">-h</code></td><td>シリアル</td><td>シリアル</td><td>シリアル</td></tr><tr><td><code class="option">-D</code></td><td>内蔵、シリアルの両方</td><td>内蔵</td><td>シリアル</td></tr><tr><td><code class="option">-Dh</code></td><td>内蔵、シリアルの両方</td><td>シリアル</td><td>シリアル</td></tr><tr><td><code class="option">-P</code>、キーボードが存在する場合</td><td>内蔵</td><td>内蔵</td><td>シリアル</td></tr><tr><td><code class="option">-P</code>、キーボードが存在しない場合</td><td>内蔵、シリアルの両方</td><td>シリアル</td><td>シリアル</td></tr></tbody></table></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-tips"></a>19.6.4. シリアルコンソールを利用する上で役に立つ情報</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93956944"></a>19.6.4.1. シリアルポートの通信速度をもっと速いものに設定するには</h4></div></div></div><p>デフォルトのシリアルポート通信速度は、9600 ボー、
	  8 ビット、パリティなし、ストップビット 1 です。
	  通信速度を変更したい場合には、少なくとも
	  ブートブロックの再コンパイルが必要になります。
	  <code class="filename">/etc/make.conf</code> に次のような行を追加して、
	  新しくブートブロックをコンパイルして下さい。</p><pre class="programlisting">BOOT_COMCONSOLE_SPEED=19200</pre><p>もし、シリアルコンソールがブート時の <code class="option">-h</code>
	  オプション以外の方法で設定されていたり、
	  カーネルが利用するシリアルコンソールが
	  ブートブロック実行中のものと異なる場合には、
	  カーネルコンフィグレーションファイルに次のオプションを追加して、
	  新しくカーネルをコンパイルしなければなりません。</p><pre class="programlisting">options CONSPEED=19200</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-com2"></a>19.6.4.2. <code class="filename">sio0</code> 以外のシリアルポートを
	  コンソールとして使うには</h4></div></div></div><p><code class="filename">sio0</code>
	  以外のポートをコンソールとして使うには、再コンパイルが必要です。
	  それがどんな理由であれ、他のポートを使用する場合には
	  ブートブロック、ブートローダ、カーネルを
	  次のようにして再コンパイルして下さい。</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>カーネルソースを取得する (<a class="xref" href="updating-upgrading.html" title="第18章 FreeBSD のアップデートとアップグレード">18章<em>FreeBSD のアップデートとアップグレード</em></a>
	      をご覧ください)。</p></li><li class="step"><p><code class="filename">/etc/make.conf</code> を編集し、
	      <code class="literal">BOOT_COMCONSOLE_PORT</code> に
	      使用したいポートのアドレス(0x3F8、0x2F8、0x3E8 or 0x2E8)を
	      設定してください。使用可能なのは
	      <code class="filename">sio0</code> から
	      <code class="filename">sio3</code> (<code class="filename">COM1</code>
	      から <code class="filename">COM4</code>) までで、
	      マルチポートシリアルカードは使えません。
	      また、ここで割り込みの設定をする必要はありません。</p></li><li class="step"><p>設定を変更するために新たなカーネルコンフィグレーションファイルを作成し、
	      使いたいシリアルポートのフラグを適切に設定します。
	      例えば、<code class="filename">sio1</code>
	      (<code class="filename">COM2</code>) をコンソールにしたければ、</p><pre class="programlisting">device sio1 at isa? port "IO_COM2" tty flags 0x10 irq 3</pre><p>または、</p><pre class="programlisting">device sio1 at isa? port "IO_COM2" tty flags 0x30 irq 3</pre><p>とします。その際、
	    他のシリアルポートにコンソールフラグをつけてはいけません。</p></li><li class="step"><p>ブートブロックを再コンパイルし、インストールする。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /sys/boot/i386/boot2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong></pre></li><li class="step"><p>ブートローダを再コンパイルし、インストールする。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /sys/boot/i386/loader</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong></pre></li><li class="step"><p>カーネルを再構築し、インストールする。</p></li><li class="step"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=disklabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">disklabel</span>(8)</span></a>
	      を使ってブートブロックをブートディスクに書き込み、
	      新しいカーネルから起動する。</p></li></ol></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93986512"></a>19.6.4.3. シリアルポートから DDB デバッガを起動するには</h4></div></div></div><p>シリアルコンソールからカーネルデバッガを起動したい(これは
	  リモートで診断する際に便利ですが、もしおかしな BREAK
	  信号がシリアルポートに送られるような場合には危険です!)
	  場合には、次のオプションを使ってカーネルをコンパイルして下さい。
	</p><pre class="programlisting">options BREAK_TO_DEBUGGER
options DDB</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93988176"></a>19.6.4.4. シリアルコンソールにログインプロンプトを表示させるには</h4></div></div></div><p>シリアルコンソールからブートメッセージを確認したり、
	  シリアルコンソールを経由してカーネルデバッグセッションに入ることが
	  できるので、これは必要がないかもしれませんが、
	  <span class="emphasis"><em>login</em></span> プロンプトをシリアルポートに
	  出力するように設定することもできます。
	  これには、次のようにします。</p><p>エディタで <code class="filename">/etc/ttys</code> というファイルを開き、
	  次に示す行に移動して下さい。</p><pre class="programlisting">ttyd0 "/usr/libexec/getty std.9600" unknown off secure
ttyd1 "/usr/libexec/getty std.9600" unknown off secure
ttyd2 "/usr/libexec/getty std.9600" unknown off secure
ttyd3 "/usr/libexec/getty std.9600" unknown off secure</pre><p><code class="literal">ttyd0</code> から
	  <code class="literal">ttyd3</code> は、
	  <code class="filename">COM1</code> から
	  <code class="filename">COM4</code> に対応しています。
	  設定したいポートの <code class="literal">off</code> を
	  <code class="literal">on</code> に変更して下さい。
	  また、もしシリアルポートの通信速度を変更しているなら、
	  <code class="literal">std.9600</code> が実際の通信速度になるように、
	  例えば <code class="literal">std.19200</code> のように変更して下さい。</p><p>さらに、実際のシリアル端末に合わせて、
	  端末タイプを <code class="literal">unknown</code> から変更することも可能です。
	</p><p>ファイルの編集が終了したら、
	  変更を有効化するために <code class="command">kill -HUP 1</code>
	  を実行しなければなりません。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-loader"></a>19.6.5. ブートローダからコンソールを変更するには</h3></div></div></div><p>前セクションは、ブートブロックの設定を変更することでシリアルコンソールを
	セットアップする方法について解説していました。
	このセクションでは、ブートローダへのコマンド入力と環境変数設定で
	コンソールの指定を行なう方法を紹介します。
	ブートローダがブートブロックの後、
	ブートプロセスの第三ステージで呼び出されたとき、
	ブートローダの設定には、ブートブロックの設定がそのまま使われます。
	</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94021968"></a>19.6.5.1. シリアルコンソールをセットアップする</h4></div></div></div><p>ブートローダとカーネルに対して
	  シリアルコンソールを使用するように設定するには、
	  単に <code class="filename">/boot/loader.rc</code>
	  のファイルに、次のような一行を書くだけで実現できます。</p><pre class="programlisting">set console=comconsole</pre><p>これは、前セクションで扱ったブートブロックの設定に
	  全く関係なく機能します。</p><p>上に示した行は、
	  <code class="filename">/boot/loader.rc</code>
	  の最初の行に書き込まなくてはいけません。
	  これはできるだけ早く、ブートメッセージをシリアルコンソールに
	  出力させるために必要なことです。</p><p>同様にして、次のように内蔵コンソールを指定することもできます。</p><pre class="programlisting">set console=vidconsole</pre><p>もし、ブートローダの環境変数
	  <code class="envar">console</code> が設定されていない場合、
	  ブートローダ、そしてその次に起動するカーネルは
	  ブートブロックで指定された <code class="option">-h</code> オプションに
	  示されたコンソールを使用します。
	  </p><p>3.2 以降のバージョンにおいては
	  <code class="filename">/boot/loader.rc</code> ではなく、
	  <code class="filename">/boot/loader.conf.local</code> や
	  <code class="filename">/boot/loader.conf</code>
	  にコンソール指定を書き込みます。
	  その場合、
	  <code class="filename">/boot/loader.rc</code>
	  は次のようになっていなければなりません。
	  </p><pre class="programlisting">include /boot/loader.4th
start</pre><p>それから、<code class="filename">/boot/loader.conf.local</code>
	  を作成して、次の行をそこに追加して下さい。
	</p><pre class="programlisting">console=comconsole</pre><p>か、もしくは</p><pre class="programlisting">console=vidconsole</pre><p>です。詳細については、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a> を参照して下さい。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">その際、ブートローダはオプション指定なし
	  (ブートブロックに <code class="option">-P</code> オプションが指定されたのと等価)になり、
	  キーボードの存在を調べて
	  内蔵コンソールとシリアルコンソールを自動的に選択する機能は働きません。</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94037840"></a>19.6.5.2. <code class="filename">sio0</code> 以外のシリアルポートを
	  コンソールとして使うには</h4></div></div></div><p><code class="filename">sio0</code> 以外のシリアルポートを
	  コンソールとして使うには、ブートローダを再コンパイルする必要があります。
	  それには、
	  <a class="xref" href="serialconsole-setup.html#serialconsole-com2" title="19.6.4.2. sio0 以外のシリアルポートを コンソールとして使うには">「<code class="filename">sio0</code> 以外のシリアルポートを
	  コンソールとして使うには」</a> に書かれている説明にしたがって下さい。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-caveats"></a>19.6.6. 注意</h3></div></div></div><p>シリアルコンソールというアイデアは、
	グラフィック出力用のハードウェアやキーボードが接続されていない
	専用サーバのセットアップを可能にするためのものです。
	ほとんどのシステムはキーボードなしで起動できますが、
	不幸にも、グラフィックアダプタなしでは起動できないシステムはたくさんあります。
	AMI BIOS を採用しているマシンでは、CMOS 設定の
	`graphics adapter' を `Not Installed'
	にするだけで、
	グラフィックアダプタがなくとも起動できるように設定することができます。</p><p>しかしながら、多くのマシンはこのようなオプションを持っていませんし、
	ディスプレイハードウェアがシステムに存在しないと起動しないように
	なっています。そのようなマシンでは、
	モニタを接続する必要がなかったとしても、
	適当なグラフィックカード(モノクロのジャンク品でも構いません)を
	挿入したままにしておく必要があるでしょう。
	また、AMI BIOS をインストールする、という手もあります。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="dialout.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="serialcomms.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="ppp-and-slip.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">19.5. ダイアルアウトサービス〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓第20章 PPP と SLIP</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>