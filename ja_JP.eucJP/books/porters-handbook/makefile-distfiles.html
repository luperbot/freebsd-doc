<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>5.4. 配布ファイル</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD port 作成者のためのハンドブック" /><link rel="up" href="makefile.html" title="第5章 Makefile の作成" /><link rel="prev" href="makefile-categories.html" title="5.3. カテゴリ分類" /><link rel="next" href="makefile-maintainer.html" title="5.5. MAINTAINER" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.4. 配布ファイル</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="makefile-categories.html">戻る</a>〓</td><th width="60%" align="center">第5章 <code class="filename">Makefile</code> の作成</th><td width="20%" align="right">〓<a accesskey="n" href="makefile-maintainer.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="makefile-distfiles"></a>5.4. 配布ファイル</h2></div></div></div><p><code class="filename">Makefile</code> の第二の部分では、
	その port をビルドするためにダウンロードしなければならないファイルと、
	それをどこからダウンロードできるか説明しています。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80065104"></a>5.4.1. <code class="varname">DISTNAME</code></h3></div></div></div><p><code class="varname">DISTNAME</code>
	  は製作者が決めたソフトウェアの名前です。
	  デフォルトでは <code class="varname">DISTNAME</code> は
	  <code class="literal">${PORTNAME}-${PORTVERSION}</code> になりますので、
	  必要にな場合だけ書き換えるようにしてください。
	  <code class="varname">DISTNAME</code> は二つの場所でしか使われません。
	  一つ目は配布ファイルリスト (<code class="varname">DISTFILES</code>) のデフォルト
	  <code class="varname">${DISTNAME}</code><code class="varname">${EXTRACT_SUFX}</code>
	  で、二つ目は配布ファイルが展開されるサブディレクトリ
	  <code class="varname">WRKSRC</code> のデフォルト
	  <code class="filename">work/${DISTNAME}</code>
	  です。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="varname">PKGNAMEPREFIX</code> や
	    <code class="varname">PKGNAMESUFFIX</code> は
	    <code class="varname">DISTNAME</code> に影響を与えません。
	    また、元のソースアーカイブが
	    <code class="varname">${PORTNAME}-${PORTVERSION}${EXTRACT_SUFX}</code> という
	    名前ではないのに、<code class="varname">WRKSRC</code> を
	    <code class="filename">work/${PORTNAME}-${PORTVERSION}</code>
	    と設定しているなら、おそらく <code class="varname">DISTNAME</code>
	    はそのままにしておく必要があることに注意してください ―
	    <code class="varname">DISTNAME</code> と <code class="varname">WRKSRC</code>
	    の両方を (そして おそらく <code class="varname">EXTRACT_SUFX</code> も)
	    セットするよりは、<code class="varname">DISTFILES</code>
	    を定義する方が楽でしょう。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80086864"></a>5.4.2. <code class="varname">MASTER_SITES</code></h3></div></div></div><p>元になる配布ファイルを指し示す、FTP/HTTP の URL のファイル名を除いた部分を
	  <code class="varname">MASTER_SITES</code> に設定します。
	  最後にスラッシュ (<code class="filename">/</code>)
	  をつけることをお忘れなく!</p><p>このシステム上に配布ファイルが見つからなかった場合、
	  <code class="command">make</code> マクロは <code class="varname">FETCH</code>
	  を使ってこの変数に指定されたサイトから配布ファイルを取得しようとします。</p><p>このリストには、
	  できれば異なる大陸に存在する複数のサイトを入れておくことが推奨されています。
	  これにより、広域ネットワークのトラブルに対する耐性を高めることができます。
	  さらに私たちは、自動的に最も近いマスタサイトを判断して、
	  そこから取ってくるメカニズムの導入を計画しています。
	  複数のサイトがあれば、この取組を大きく助けることになります。</p><p>元になる tar ファイルが X-contrib や GNU, Perl CPAN
	  等の有名なアーカイブサイトに置かれている場合には、
	  <code class="varname">MASTER_SITE_<em class="replaceable"><code>*</code></em></code>
	  を使ってこれらのサイトを簡潔に
	  (例えば <code class="varname">MASTER_SITE_XCONTRIB</code> とか、
	  <code class="varname">MASTER_SITE_PERL_CPAN</code> のように) 指定することができます。
	  <code class="varname">MASTER_SITES</code> を これらの変数の一つにセットし、
	  サイト内でのパスを <code class="varname">MASTER_SITE_SUBDIR</code>
	  に指定するだけです。
	  以下に例を示します。</p><pre class="programlisting">MASTER_SITES=         ${MASTER_SITE_XCONTRIB}
MASTER_SITE_SUBDIR=   applications</pre><p>これらの変数は <code class="filename">/usr/ports/Mk/bsd.sites.mk</code>
	  で定義されています。
	  いつでも新しい項目が追加されて行きますので、
	  port を提出する前に このファイルの最新版を
	  チェックするように心掛けてください。</p><p>ユーザは <code class="filename">/etc/make.conf</code> 中で
	  <code class="varname">MASTER_SITE_*</code> 変数を上書きすることもできます。
	  そうすることで、これらの有名なアーカイブそのものではなく、
	  好みのミラーサイトを使用することができます。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80095440"></a>5.4.3. <code class="varname">EXTRACT_SUFX</code></h3></div></div></div><p>配布ファイルが 1 つで、
	  圧縮方式を示すのに普通と異なる接尾辞を使っていたら、
	  <code class="varname">EXTRACT_SUFX</code> を設定してください。</p><p>例えば、配布ファイルがより一般的な
	  <code class="filename">foo.tar.gz</code> ではなく、
	  <code class="filename">foo.tgz</code> となっていたら、
	  次のように書きます。</p><pre class="programlisting">DISTNAME=      foo
EXTRACT_SUFX=  .tgz</pre><p><code class="varname">USE_BZIP2</code> と <code class="varname">USE_ZIP</code>
	  変数を設定すると、<code class="varname">EXTRACT_SUFX</code>
	  は必要に応じて自動的に <code class="literal">.bz2</code>
	  または <code class="literal">.zip</code> に設定されます。
	  どちらも設定されていなければ、<code class="varname">EXTRACT_SUFX</code>
	  は <code class="literal">.tar.gz</code> に設定されます。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="varname">EXTRACT_SUFX</code> と
	    <code class="varname">DISTFILES</code>
	    を両方設定する必要はありません。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80103376"></a>5.4.4. <code class="varname">DISTFILES</code></h3></div></div></div><p>時々、ダウンロードするファイルの名称が port
	  の名称とまったく似ていないことがあります。たとえば、
	  <code class="filename">source.tar.gz</code>
	  などと名づけられていることもあるでしょう。
	  ほかに、ソースコードがいくつかのアーカイブに分かれていて、
	  そのすべてをダウンロードしなければならないならないこともあります。</p><p>この場合、<code class="varname">DISTFILES</code>
	  に、ダウンロードしなければならないファイルすべてのリストを、
	  スペースで区切って設定してください。</p><pre class="programlisting">DISTFILES=     source1.tar.gz source2.tar.gz</pre><p>明示的に設定されていない場合、
	  <code class="varname">DISTFILES</code> は
	  <code class="literal">${DISTNAME}${EXTRACT_SUFX}</code>
	  に設定されます。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80107344"></a>5.4.5. <code class="varname">EXTRACT_ONLY</code></h3></div></div></div><p><code class="varname">DISTFILES</code> の一部だけを展開すべき
	  (例えば、一方がソースコードで、もう一方は圧縮されていない文書という)
	  場合、展開しなければならないファイル名を
	  <code class="varname">EXTRACT_ONLY</code> に設定してください。</p><pre class="programlisting">DISTFILES=     source.tar.gz manual.html
EXTRACT_ONLY=  source.tar.gz</pre><p><span class="emphasis"><em>どの</em></span> <code class="varname">DISTFILES</code>
	  も展開すべきでは<span class="emphasis"><em>ない</em></span>なら、
	  <code class="varname">EXTRACT_ONLY</code>
	  に空文字列を設定してください。</p><pre class="programlisting">EXTRACT_ONLY=</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="porting-patchfiles"></a>5.4.6. <code class="varname">PATCHFILES</code></h3></div></div></div><p>その port が配布ファイルの他に FTP や HTTP
	  で手に入る追加パッチを必要とする場合には、
	  <code class="varname">PATCHFILES</code> にはそのパッチのファイル名を、
	  <code class="varname">PATCH_SITES</code>
	  にはそのファイルが置かれているディレクトリの URL
	  をセットしてください。(書き方は
	  <code class="varname">MASTER_SITES</code> と同じです。)</p><p>そのパッチに記録されているファイル名に余計なパス名がついていて、
	  ソースツリーのトップディレクトリ
	  (つまり <code class="varname">WKRSRC</code>)
	  からの相対パスになっていない場合には、
	  それに応じた <code class="varname">PATCH_DIST_STRIP</code> を指定してください。
	  たとえば、パッチ内のすべてのファイル名の先頭に、余計な
	  <code class="literal">foozolix-1.0/</code> がついている場合には、
	  <code class="literal">PATCH_DIST_STRIP=-p1</code>
	  としてください。</p><p>これらのパッチは圧縮されていても大丈夫です。
	  ファイル名が <code class="filename">.gz</code> や <code class="filename">.Z</code>
	  で終わる場合には、自動的に展開されるようになっています。</p><p>もしパッチが、ドキュメント等その他のファイルと一緒に
	  gzip された tar ファイルで配布されている場合には、単に
	  <code class="varname">PATCHFILES</code> を使うだけではうまくいきません。
	  このような場合には、このパッチの tar ファイルの名前と場所を
	  <code class="varname">DISTFILES</code> と
	  <code class="varname">MASTER_SITES</code> に追加しておきます。
	  それから、<code class="varname">EXTRA_PATCHES</code>
	  変数にそれらのパッチを指定すれば、
	  <code class="filename">bsd.port.mk</code> が
	  自動的にパッチを適用してくれます。
	  特に注意が必要なのは、パッチファイルを
	  <code class="varname">PATCHDIR</code>
	  ディレクトリにコピー<span class="emphasis"><em>してはならない</em></span>ことです
	  ― (訳注: port が CD-ROM 上に置かれている等の場合には、)
	  そのディレクトリには書き込みができないかもしれません。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">それが普通の gzip か compress された tar ファイルであれば、
	    通常のソースファイルと一緒にパッチ適用時までに展開されていますので、
	    明示的に展開する必要はありません。
	    もしパッチを <code class="varname">DISTFILES</code>
	    に追加した場合には、パッチを含むファイルが展開される際に、
	    そのディレクトリにある何かを上書きしないように注意してください。
	    さらに、コピーされたパッチファイルを削除するコマンドを
	    <code class="buildtarget">pre-clean</code>
	    ターゲットに追加することを忘れないでください。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="porting-master-sites-n"></a>5.4.7. 異なるサイトやサブディレクトリからの複数の配布ファイルまたはパッチ
	  (<code class="literal">MASTER_SITES:n</code>)</h3></div></div></div><p>(これはいささか<span class="quote">「<span class="quote">高度な話題</span>」</span>です。
	  この文書を初めて読む人は、
	  最初はこの節を飛ばしてもよいでしょう)。</p><p>この節は <code class="literal">MASTER_SITES:n</code> や
	  <code class="literal">MASTER_SITES_NN</code>
	  と呼ばれる取得方法について説明しています。
	  ここでは、この方式を <code class="literal">MASTER_SITES:n</code>
	  と呼びます。</p><p>まず、背景を少し説明しておきましょう。OpenBSD
	  には、<code class="varname">DISTFILES</code> と
	  <code class="varname">PATCHFILES</code>
	  変数の両方に素敵な機能があります。ファイル、パッチの両方とも、
	  後ろに <code class="literal">:n</code> (<code class="literal">n</code>
	  は <code class="literal">[0-9]</code> のどれかになります)
	  をつけてグループを指示できます。たとえば、</p><pre class="programlisting">DISTFILES=      alpha:0 beta:1</pre><p>OpenBSD では、配布ファイル <code class="filename">alpha</code>
	  は、通常の <code class="varname">MASTER_SITES</code> ではなく
	  <code class="varname">MASTER_SITES0</code> に、
	  <code class="filename">beta</code> は <code class="varname">MASTER_SITES1</code>
	  に結び付けられます。</p><p>これは、正しいダウンロードサイトを際限なく探す羽目になるのを減らせる、
	  興味深い機能です。</p><p><code class="varname">DISTFILES</code> にファイルが
	  2 つ指定され、<code class="varname">MASTER_SITES</code> が
	  20 サイトあって、サイトはものすごく遅く、
	  <code class="filename">beta</code> は <code class="varname">MASTER_SITES</code>
	  中のすべてのサイトに置かれていますが、
	  <code class="filename">alpha</code> は
	  20 番目のサイトにしかないという場合を考えてください。
	  メンテナがあらかじめそのことを知っていたら、
	  すべてのサイトを確認するのは無駄だと思いませんか?
	  楽しい週末のはじまりというわけにはゆきませんね。</p><p>イメージできたら、今度は <code class="varname">DISTFILES</code>
	  や <code class="varname">MASTER_SITES</code>
	  がもっと沢山あるのを想像してください。
	  <span class="quote">「<span class="quote">distfiles 調査マイスタ</span>」</span>は、
	  ネットワーク負荷が緩和されることを喜ぶに違いありません。</p><p>次節からは、FreeBSD におけるこのアイディアの実装について説明します。
	  OpenBSD の考え方を多少改良しています。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80152272"></a>5.4.7.1. 簡単な説明</h4></div></div></div><p>この節では、複数の配布ファイルやパッチを、
	    異なるサイトやサブディレクトリから細かく分けて取得する簡単な設定を示します。
	    ここでは、単純化した <code class="literal">MASTER_SITES:n</code>
	    の使い方を説明します。ほとんどの場面ではこれで十分です。
	    さらに詳しいことを知りたければ、次の節をお読みください。</p><p>アプリケーションによっては、
	    いくつもの異なるサイトからダウンロードする複数の配布ファイルからなっているものがあります。
	    たとえば、<span class="application">Ghostscript</span>
	    は、中核部のプログラムと、
	    ユーザのプリンタに応じて使い分けられる多数のドライバファイルからなっています。
	    このドライバファイルの一部は中核部と共に配布されますが、
	    多くはさまざまなサイトからダウンロードしなければなりません。</p><p>これに対応するため、<code class="varname">DISTFILES</code>
	    の各項目の後ろには、コロンと<span class="quote">「<span class="quote">タグ名</span>」</span>
	    をつけられるようになっています。<code class="varname">MASTER_SITES</code>
	    に設定されているそれぞれのサイトの末尾にも、コロンと、
	    そのサイトからダウンロードすべきファイルを示すためのタグを加えます。</p><p>たとえば、ソースコードが
	    <code class="filename">source1.tar.gz</code> と
	    <code class="filename">source2.tar.gz</code> の
	    2 つに分けられていて、
	    2 つの別のサイトからダウンロードしなければならないアプリケーションを考えてみましょう。
	    その port の <code class="filename">Makefile</code>
	    には、<a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-simple-use-one-file-per-site" title="例5.1 各サイトに 1 つファイルがある場合の、簡単な MASTER_SITES:n の使用法">例5.1「各サイトに 1 つファイルがある場合の、簡単な
	      <code class="literal">MASTER_SITES:n</code> の使用法」</a>
	    のような行があるとします。</p><div class="example"><a id="ports-master-sites-n-example-simple-use-one-file-per-site"></a><div class="example-title">例5.1 各サイトに 1 つファイルがある場合の、簡単な
	      <code class="literal">MASTER_SITES:n</code> の使用法</div><div class="example-contents"><pre class="programlisting">MASTER_SITES=   ftp://ftp.example1.com/:source1 \
                ftp://ftp.example2.com/:source2
DISTFILES=      source1.tar.gz:source1 \
                source2.tar.gz:source2</pre></div></div><br class="example-break" /><p>複数の配布ファイルに同じタグがついていてもかまいません。
	  先ほどの例に続いて、3 番目の配布ファイル
	  <code class="filename">source3.tar.gz</code> があって、
	  <code class="systemitem">ftp.example2.com</code> からダウンロードすべきだとしましょう。
	  <code class="filename">Makefile</code> は <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-simple-use-more-than-one-file-per-site" title="例5.2 各サイトに 1 つ以上ファイルがある場合の、簡単な MASTER_SITES:n の使用法">例5.2「各サイトに 1 つ以上ファイルがある場合の、簡単な
	      <code class="literal">MASTER_SITES:n</code> の使用法」</a>
	    のようになります。</p><div class="example"><a id="ports-master-sites-n-example-simple-use-more-than-one-file-per-site"></a><div class="example-title">例5.2 各サイトに 1 つ以上ファイルがある場合の、簡単な
	      <code class="literal">MASTER_SITES:n</code> の使用法</div><div class="example-contents"><pre class="programlisting">MASTER_SITES=   ftp://ftp.example1.com/:source1 \
                ftp://ftp.example2.com/:source2
DISTFILES=      source1.tar.gz:source1 \
                source2.tar.gz:source2 \
                source3.tar.gz:source2</pre></div></div><br class="example-break" /></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80163536"></a>5.4.7.2. 詳しい説明</h4></div></div></div><p>分かりました。
	    前節の例ではあなたの要求を満足できなかったわけですね。
	    この節では、ファイルの取得を細かく制御する仕組み
	    <code class="literal">MASTER_SITES:n</code>
	    がどう働くかと、これを利用するために
	    ports をどう変更すればよいかを詳しく説明します。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>要素の末尾に
		<code class="literal">:n</code>
		をつけることができます。
		ここで、<em class="replaceable"><code>n</code></em> は
		<code class="literal">[^:,]+</code>
		つまり、概念上はいかなる文字と数字からなる文字列でもよいのですが、
		われわれとしては、当面は
		<code class="literal">[a-zA-Z_][0-9a-zA-Z_]+</code>
		に制限します。</p><p>さらに、文字列のマッチは大文字と小文字を区別します。
		つまり、<code class="literal">n</code> と <code class="literal">N</code>
		は別の文字として扱われます。</p><p>しかし、
		<code class="literal">default</code>, <code class="literal">all</code>,
		<code class="literal">ALL</code>
		は特別な意味を与えられているので、
		末尾に付加するのには使えません
		(これは、<a class="xref" href="makefile-distfiles.html#porting-master-sites-n-what-changes-in-port-targets">ii</a>
		項で内部的に利用されています)。
		さらに、<code class="literal">DEFAULT</code>
		は特別な意味を持つ単語です
		(<a class="xref" href="makefile-distfiles.html#porting-master-sites-n-DEFAULT-group">3</a>
		の項を確認してください)。</p></li><li class="listitem"><p><code class="literal">:n</code> がついた要素は、グループ
		<code class="literal">n</code> に属し、
		<code class="literal">:m</code> がついた要素は、グループ
		<code class="literal">m</code>
		に属するということになります。</p></li><li class="listitem"><p><a id="porting-master-sites-n-DEFAULT-group"></a>接尾辞がついていない要素はグループに属しません。
		これは、特別なグループ <code class="literal">DEFAULT</code>
		に属しているとして扱われます。
		要素の後ろに <code class="literal">DEFAULT</code>
		をつけるのは、その要素を <code class="literal">DEFAULT</code>
		とそれ以外のグループに同時に割り当てたいのでなければ、
		冗長に過ぎません
		(<a class="xref" href="makefile-distfiles.html#porting-master-sites-n-comma-operator">5</a>
		の項を確認してください)。</p><p>次の例はどちらも同じ意味ですが、
		最初の方が好ましいです。</p><pre class="programlisting">MASTER_SITES=   alpha

MASTER_SITES=   alpha:DEFAULT</pre></li><li class="listitem"><p>グループは相互排他ではありません。
		ひとつの要素が同時に複数のグループに属することができ、
		ひとつのグループには複数の要素が属することも、
		何も割り当てないこともできます。
		同じグループで何回も指定された要素は、
		単に複数回指定された要素ということになります。</p></li><li class="listitem"><p><a id="porting-master-sites-n-comma-operator"></a>ある要素を同時にいくつものグループに所属させたい時は、
		カンマ演算子 (<code class="literal">,</code>) が使えます。</p><p>その都度別の接尾辞をつけて繰り返すかわりに、
		一度だけ接尾辞を指定して複数のグループを指定できます。
		たとえば、<code class="literal">:m,n,o</code>
		と書くと、その要素はグループ <code class="literal">m</code>,
		<code class="literal">n</code> および <code class="literal">o</code>
		に属することを示します。</p><p>以下の例はすべて同等ですが、
		最後の形式がもっともよいでしょう。</p><pre class="programlisting">MASTER_SITES=   alpha alpha:SOME_SITE

MASTER_SITES=   alpha:DEFAULT alpha:SOME_SITE

MASTER_SITES=   alpha:SOME_SITE,DEFAULT

MASTER_SITES=   alpha:DEFAULT,SOME_SITE</pre></li><li class="listitem"><p>任意のグループ内のサイトは、
		<code class="varname">MASTER_SORT_AWK</code>
		によって整列されます。
		<code class="varname">MASTER_SITES</code> と
		<code class="varname">PATCH_SITES</code>
		内のすべてのグループについても同様に整列されます。</p></li><li class="listitem"><p><a id="porting-master-sites-n-group-semantics"></a>グループの概念は、変数
		<code class="varname">MASTER_SITES</code>,
		<code class="varname">PATCH_SITES</code>,
		<code class="varname">MASTER_SITE_SUBDIR</code>,
		<code class="varname">PATCH_SITE_SUBDIR</code>,
		<code class="varname">DISTFILES</code> および
		<code class="varname">PATCHFILES</code>
		においても、下記の文法に従って使えます。</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p><code class="varname">MASTER_SITES</code>,
		    <code class="varname">PATCH_SITES</code>,
		    <code class="varname">MASTER_SITE_SUBDIR</code> および
		    <code class="varname">PATCH_SITE_SUBDIR</code>
		    のすべての要素はスラッシュ <code class="literal">/</code>
		    記号で終端されていなければなりません。
		    ある要素がどれかのグループに属しているなら、
		    グループの接尾辞
		    <code class="literal">:n</code>
		    は、終端記号 <code class="literal">/</code>
		    のすぐ後にこなければなりません。
		    <code class="literal">MASTER_SITES:n</code>
		    の仕組みでは、終端記号
		    <code class="literal">/</code> があることで、
		    <code class="literal">:n</code> が要素の有効な一部である場合と、
		    <code class="literal">:n</code> がグループ <code class="literal">n</code>
		    を示す場合の混同を避けることができます。
		    以前は、
		    <code class="varname">MASTER_SITE_SUBDIR</code> と
		    <code class="varname">PATCH_SITE_SUBDIR</code>
		    要素のいずれにおいても終端記号 <code class="literal">/</code>
		    は不要だったので、互換性を保つために、
		    接尾辞の直前の文字が <code class="literal">/</code>
		    でなければ、
		    要素の接尾辞が <code class="literal">:n</code> であっても、
		    グループの接尾語ではなく、
		    要素の有効な一部分として扱われます。
		    <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-master-site-subdir" title="例5.3 MASTER_SITE_SUBDIR における MASTER_SITES:n の詳細な使用法">例5.3「<code class="varname">MASTER_SITE_SUBDIR</code> における
		      <code class="literal">MASTER_SITES:n</code> の詳細な使用法」</a>
		    と <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-complete-example-master-sites" title="例5.4 カンマ演算子、複数のファイル、複数のサイト、 複数のサブディレクトリと合わせた MASTER_SITES:n の詳細な使用法">例5.4「カンマ演算子、複数のファイル、複数のサイト、
			複数のサブディレクトリと合わせた
			<code class="literal">MASTER_SITES:n</code>
			の詳細な使用法」</a>
		    の両方をご覧ください。</p><div class="example"><a id="ports-master-sites-n-example-detailed-use-master-site-subdir"></a><div class="example-title">例5.3 <code class="varname">MASTER_SITE_SUBDIR</code> における
		      <code class="literal">MASTER_SITES:n</code> の詳細な使用法</div><div class="example-contents"><pre class="programlisting">MASTER_SITE_SUBDIR=     old:n new/:NEW</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>グループ <code class="literal">DEFAULT</code>
			  に属するディレクトリ -&gt; old:n</p></li><li class="listitem"><p>グループ <code class="literal">NEW</code>
			  に属するディレクトリ -&gt; new</p></li></ul></div></div></div><br class="example-break" /><div class="example"><a id="ports-master-sites-n-example-detailed-use-complete-example-master-sites"></a><div class="example-title">例5.4 カンマ演算子、複数のファイル、複数のサイト、
			複数のサブディレクトリと合わせた
			<code class="literal">MASTER_SITES:n</code>
			の詳細な使用法</div><div class="example-contents"><pre class="programlisting">MASTER_SITES=   http://site1/%SUBDIR%/ http://site2/:DEFAULT \
                http://site3/:group3 http://site4/:group4 \
                http://site5/:group5 http://site6/:group6 \
                http://site7/:DEFAULT,group6 \
                http://site8/%SUBDIR%/:group6,group7 \
                http://site9/:group8
DISTFILES=      file1 file2:DEFAULT file3:group3 \
                file4:group4,group5,group6 file5:grouping \
                file6:group7
MASTER_SITE_SUBDIR=     directory-trial:1 directory-n/:groupn \
                        directory-one/:group6,DEFAULT \
                        directory</pre><p>上の例は、次のような細かく分けた取得を実現します。
		      サイトは、利用される順番で挙げられています。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">file1</code>
			  は次のサイトから取得されます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site1/directory/</p></li><li class="listitem"><p>http://site1/directory-one/</p></li><li class="listitem"><p>http://site1/directory-trial:1/</p></li><li class="listitem"><p>http://site2/</p></li><li class="listitem"><p>http://site7/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div></li><li class="listitem"><p><code class="filename">file2</code>
			  は、<code class="filename">file1</code>
			  と同じグループに属しているので、
			  まったく同じように取得されます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site1/directory/</p></li><li class="listitem"><p>http://site1/directory-one/</p></li><li class="listitem"><p>http://site1/directory-trial:1/</p></li><li class="listitem"><p>http://site2/</p></li><li class="listitem"><p>http://site7/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div></li><li class="listitem"><p><code class="filename">file3</code>
			  は次のサイトから取得されます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site3/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div></li><li class="listitem"><p><code class="filename">file4</code>
			  は次のサイトから取得されます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site4/</p></li><li class="listitem"><p>http://site5/</p></li><li class="listitem"><p>http://site6/</p></li><li class="listitem"><p>http://site7/</p></li><li class="listitem"><p>http://site8/directory-one/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div></li><li class="listitem"><p><code class="filename">file5</code>
			  は次のサイトから取得されます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div></li><li class="listitem"><p><code class="filename">file6</code>
			  は次のサイトから取得されます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site8/directory-one/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div></li></ul></div></div></div><br class="example-break" /></li></ol></div></li><li class="listitem"><p><code class="varname">MASTER_SITE_SOURCEFORGE</code>
		のように、<code class="filename">bsd.sites.mk</code>
		で定義される特別な変数をグループに割り当てるにはどうすればよいですか?</p><p><a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-master-site-sourceforge" title="例5.5 MASTER_SITE_SOURCEFORGE と合わせた MASTER_SITES:n の詳しい使用法">例5.5「<code class="varname">MASTER_SITE_SOURCEFORGE</code>
		  と合わせた <code class="literal">MASTER_SITES:n</code>
		  の詳しい使用法」</a>
		をご覧ください。</p><div class="example"><a id="ports-master-sites-n-example-detailed-use-master-site-sourceforge"></a><div class="example-title">例5.5 <code class="varname">MASTER_SITE_SOURCEFORGE</code>
		  と合わせた <code class="literal">MASTER_SITES:n</code>
		  の詳しい使用法</div><div class="example-contents"><pre class="programlisting">MASTER_SITES=   http://site1/ ${MASTER_SITE_SOURCEFORGE:S/$/:sourceforge,TEST/}
DISTFILES=      something.tar.gz:sourceforge</pre></div></div><br class="example-break" /><p><code class="filename">something.tar.gz</code>
		は、<code class="varname">MASTER_SITE_SOURCEFORGE</code>
		に含まれるあらゆるサイトから取得されます。</p></li><li class="listitem"><p>これを <code class="varname">PATCH*</code>
		変数と組み合わせて使うにはどうすればよいでしょうか?</p><p>すべての例で <code class="varname">MASTER*</code>
		変数を使っていますが、<a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-patch-sites" title="例5.6 PATCH_SITES と合わせた MASTER_SITES:n の簡単な使用法">例5.6「<code class="varname">PATCH_SITES</code> と合わせた
		  <code class="literal">MASTER_SITES:n</code> の簡単な使用法」</a>
		にあるように、<code class="varname">PATCH*</code>
		変数に対してもまったく同じように働きます。</p><div class="example"><a id="ports-master-sites-n-example-detailed-use-patch-sites"></a><div class="example-title">例5.6 <code class="varname">PATCH_SITES</code> と合わせた
		  <code class="literal">MASTER_SITES:n</code> の簡単な使用法</div><div class="example-contents"><pre class="programlisting">PATCH_SITES=    http://site1/ http://site2/:test
PATCHFILES=     patch1:test</pre></div></div><br class="example-break" /></li></ol></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80279120"></a>5.4.7.3. ports
	    について何が変更され、何が変わらないのでしょうか?</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>現在のすべての ports はそのまま変わりません。
		<code class="literal">MASTER_SITES:n</code>
		機能のコードは、<a class="xref" href="makefile-distfiles.html#porting-master-sites-n-group-semantics">7</a>
		で述べた文法に従う
		<code class="literal">:n</code>
		のような形式が後ろについた要素がある場合だけ動作します。</p></li><li class="listitem"><p><a id="porting-master-sites-n-what-changes-in-port-targets"></a>port を make する際のターゲットにも変更はありません。
		<code class="buildtarget">checksum</code>,
		<code class="buildtarget">makesum</code>,
		<code class="buildtarget">patch</code>,
		<code class="buildtarget">configure</code>,
		<code class="buildtarget">build</code> 等です。
		もちろん、<code class="buildtarget">do-fetch</code>,
		<code class="buildtarget">fetch-list</code>,
		<code class="buildtarget">master-sites</code> それから
		<code class="buildtarget">patch-sites</code>
		は例外です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="buildtarget">do-fetch</code>
		    は、新しくグループ分けの接尾辞のついた
		    <code class="varname">DISTFILES</code> と
		    <code class="varname">PATCHFILES</code>
		    を設定します。それぞれが、対応する
		    <code class="varname">MASTER_SITES</code> と
		    <code class="varname">PATCH_SITES</code>
		    を利用し、さらに対応する
		    <code class="varname">MASTER_SITE_SUBDIR</code> と
		    <code class="varname">PATCH_SITE_SUBDIR</code>
		    を利用します。<a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-complete-example-master-sites" title="例5.4 カンマ演算子、複数のファイル、複数のサイト、 複数のサブディレクトリと合わせた MASTER_SITES:n の詳細な使用法">例5.4「カンマ演算子、複数のファイル、複数のサイト、
			複数のサブディレクトリと合わせた
			<code class="literal">MASTER_SITES:n</code>
			の詳細な使用法」</a>
		    をご覧ください。</p></li><li class="listitem"><p><code class="buildtarget">fetch-list</code>
		    は、<code class="buildtarget">do-fetch</code>
		    と同じようにグループを利用するということを除いて、以前の
		    <code class="buildtarget">fetch-list</code>
		    のように動作します。</p></li><li class="listitem"><p><code class="buildtarget">master-sites</code> および
		    <code class="buildtarget">patch-sites</code> は、
		    (古いバージョンと互換性がなくなり)
		    <code class="literal">DEFAULT</code>
		    グループの要素を返すだけになっています。
		    実際は、それぞれ
		    <code class="buildtarget">master-sites-default</code> および
		    <code class="buildtarget">patch-sites-default</code>
		    というターゲットを実行します。</p><p>さらに、
		    <code class="buildtarget">MASTER_SITES</code> や
		    <code class="buildtarget">PATCH_SITES</code>
		    を直接確認するよりも、
		    <code class="buildtarget">master-sites-all</code> または
		    <code class="buildtarget">patch-sites-all</code>
		    のどちらかのターゲットを使う方がよいです。
		    また、将来のバージョンでも直接確認ができるかどうかは保証されていません。
		    これら新規 port ターゲットについては、<a class="xref" href="makefile-distfiles.html#porting-master-sites-n-new-port-targets-master-sites-all">B</a>
		    の項をご確認ください。</p></li></ul></div></li><li class="listitem"><p>新規の port ターゲット</p><div class="orderedlist"><ol class="orderedlist" type="A"><li class="listitem"><p><code class="varname">MASTER_SITES</code> および
		    <code class="varname">PATCH_SITES</code>
		    のそれぞれについて、
		    グループ <em class="replaceable"><code>n</code></em> の要素を表示する
		    <code class="buildtarget">master-sites-<em class="replaceable"><code>n</code></em></code>
		    および
		    <code class="buildtarget">patch-sites-<em class="replaceable"><code>n</code></em></code>
		    ターゲットがあります。たとえば、
		    <code class="buildtarget">master-sites-DEFAULT</code> および
		    <code class="buildtarget">patch-sites-DEFAULT</code>
		    のいずれも <code class="literal">DEFAULT</code>
		    グループの要素を返し、
		    <code class="buildtarget">master-sites-test</code> および
		    <code class="buildtarget">patch-sites-test</code>
		    は <code class="literal">test</code>
		    グループの要素を返します。</p></li><li class="listitem"><p><a id="porting-master-sites-n-new-port-targets-master-sites-all"></a>以前の
		    <code class="buildtarget">master-sites</code> および
		    <code class="buildtarget">patch-sites</code>
		    が行っていた作業を行う
		    <code class="buildtarget">master-sites-all</code> および
		    <code class="buildtarget">patch-sites-all</code>
		    という新たなターゲットがあります。
		    これらのターゲットは、
		    すべてのグループの要素をすべてが同じグループに属しているかのように返します。
		    ただし、
		    <code class="buildtarget">master-sites-all</code> および
		    <code class="buildtarget">patch-sites-all</code>
		    のそれぞれについて、
		    <code class="varname">DISTFILES</code> や
		    <code class="varname">PATCHFILES</code>
		    で定義されているグループと同じ数だけ
		    <code class="varname">MASTER_SITE_BACKUP</code> と
		    <code class="varname">MASTER_SITE_OVERRIDE</code>
		    を表示します。</p></li></ol></div></li></ol></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80317776"></a>5.4.8. <code class="varname">DIST_SUBDIR</code></h3></div></div></div><p><code class="filename">/usr/ports/distfiles</code>
	  ディレクトリ内をあまり散らかさないようにしてください。
	  たくさんのファイルを取ってくる port
	  や、他の port と名前の衝突が起きる恐れのあるファイル
	  (<code class="filename">Makefile</code> など)
	  がある場合には、
	  <code class="varname">DIST_SUBDIR</code> に port の名前
	  (<code class="literal">${PORTNAME}</code> か
	  <code class="literal">${PKGNAMEPREFIX}${PORTNAME}</code>
	  を使うといいでしょう)
	  を入れてください。すると <code class="varname">DISTDIR</code>
	  がデフォルトの
	  <code class="filename">/usr/ports/distfiles</code> から
	  <code class="filename">/usr/ports/distfiles/DIST_SUBDIR</code>
	  に変更され、
	  取ってきたファイルはすべてそのサブディレクトリの中に置かれるようになります。</p><p>また、
	  ファイルを取ってくるときにバックアップサイトとして使われる
	  <code class="filename">ftp.FreeBSD.org</code>
	  のディレクトリ名にもこの変数の値が使われます
	  (<code class="varname">Makefile</code> の中で
	  <code class="varname">DISTDIR</code> を明示的に指定した場合、
	  ローカルのファイルを置くところは変わりますが、
	  このサイトのディレクトリ名は変わりません。
	  必ず <code class="varname">DIST_SUBDIR</code>
	  を使うようにしてください)。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">この変数は <code class="filename">Makefile</code>
	    中で明示的に指定された
	    <code class="varname">MASTER_SITES</code>
	    には影響しません。</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="makefile-categories.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="makefile.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="makefile-maintainer.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">5.3. カテゴリ分類〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓5.5. <code class="varname">MAINTAINER</code></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>