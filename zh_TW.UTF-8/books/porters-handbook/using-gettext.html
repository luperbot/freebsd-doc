<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>6.5. Using GNU gettext</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="special.html" title="章 6. Special considerations" /><link rel="prev" href="using-autotools.html" title="6.4. Using GNU autotools" /><link rel="next" href="using-perl.html" title="6.6. Using perl" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.5. Using GNU <code class="literal">gettext</code></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="using-autotools.html">前一頁</a> </td><th width="60%" align="center">章 6. Special considerations</th><td width="20%" align="right"> <a accesskey="n" href="using-perl.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-gettext"></a>6.5. Using GNU <code class="literal">gettext</code></h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68214224"></a>6.5.1. Basic usage</h3></div></div></div><p>If your port requires <code class="literal">gettext</code>,
	    just set <code class="varname">USE_GETTEXT</code> to <code class="literal">yes</code>,
	    and your port will grow the dependency on <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/devel/gettext/pkg-descr">devel/gettext</a>.  The value of
	    <code class="varname">USE_GETTEXT</code> can also specify the required
	    version of the <code class="literal">libintl</code> library, the basic
	    part of <code class="literal">gettext</code>, but using this
	    feature is <span class="emphasis"><em>strongly discouraged</em></span>:
	    Your port should work with just the current version of
	    <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/devel/gettext/pkg-descr">devel/gettext</a>.</p><p>A rather common case is a port using
	    <code class="literal">gettext</code> and <code class="command">configure</code>.
	    Generally, GNU <code class="command">configure</code> should be
	    able to locate <code class="literal">gettext</code> automatically.
	    If it ever fails to, hints at the location of
	    <code class="literal">gettext</code> can be passed in
	    <code class="envar">CPPFLAGS</code> and <code class="envar">LDFLAGS</code> as
	    follows:</p><pre class="programlisting">USE_GETTEXT=    yes
CPPFLAGS+=      -I${LOCALBASE}/include
LDFLAGS+=       -L${LOCALBASE}/lib

GNU_CONFIGURE=  yes
CONFIGURE_ENV=  CPPFLAGS="${CPPFLAGS}" \
                LDFLAGS="${LDFLAGS}"</pre><p>Of course, the code can be more compact if there are no
	    more flags to pass to <code class="command">configure</code>:</p><pre class="programlisting">USE_GETTEXT=    yes
GNU_CONFIGURE=  yes
CONFIGURE_ENV=  CPPFLAGS="-I${LOCALBASE}/include" \
                LDFLAGS="-L${LOCALBASE}/lib"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68231760"></a>6.5.2. Optional usage</h3></div></div></div><p>Some software products allow for disabling NLS,
	    e.g., through passing <code class="option">--disable-nls</code> to
	    <code class="command">configure</code>.  In that case, your port
	    should use <code class="literal">gettext</code> conditionally,
	    depending on the status of <a class="link" href="makefile-options.html#knobs-without-nls"><code class="varname">WITHOUT_NLS</code></a>.
	    For ports of low to medium complexity, you can rely on the
	    following idiom:</p><pre class="programlisting">GNU_CONFIGURE=          yes

.if !defined(WITHOUT_NLS)
USE_GETTEXT=            yes
PLIST_SUB+=             NLS=""
.else
CONFIGURE_ARGS+=        --disable-nls
PLIST_SUB+=             NLS="@comment "
.endif</pre><p>The next item on your to-do list is to arrange so that
	    the message catalog files are included in the packing list
	    conditionally.  The <code class="filename">Makefile</code> part of
	    this task is already provided by the idiom.  It is explained
	    in the section on <a class="link" href="plist.html#plist-sub" title="7.1. Changing pkg-plist based on make variables">advanced
	    <code class="filename">pkg-plist</code> practices</a>.  In a
	    nutshell, each occurrence of <code class="literal">%%NLS%%</code> in
	    <code class="filename">pkg-plist</code> will be replaced by
	    <span class="quote">“<span class="quote"><code class="literal">@comment </code></span>”</span> if NLS is
	    disabled, or by a null string if NLS is enabled.  Consequently,
	    the lines prefixed by <code class="literal">%%NLS%%</code> will become
	    mere comments in the final packing list if NLS is off;
	    otherwise the prefix will be just left out.  All you need
	    to do now is insert <code class="literal">%%NLS%%</code> before each
	    path to a message catalog file in <code class="filename">pkg-plist</code>.
	    For example:</p><pre class="programlisting">%%NLS%%share/locale/fr/LC_MESSAGES/foobar.mo
%%NLS%%share/locale/no/LC_MESSAGES/foobar.mo</pre><p>In high complexity cases, you may need to use more advanced
	    techniques than the recipe given here, such as <a class="link" href="plist-dynamic.html" title="7.4. Dynamic vs. static package list">dynamic packing list generation</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68244816"></a>6.5.3. Handling message catalog directories</h3></div></div></div><p>There is a point to note about installing message catalog
	    files.  The target directories for them, which reside under
	    <code class="filename">LOCALBASE/share/locale</code>,
	    should rarely be created and removed by your port.  The
	    most popular languages have their respective directories
	    listed in <code class="filename">/etc/mtree/BSD.local.dist</code>;
	    that is, they are a part of the base system.  The directories
	    for many other languages are governed by the <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/devel/gettext/pkg-descr">devel/gettext</a> port.  You may want
	    to consult its <code class="filename">pkg-plist</code> and see whether
	    your port is going to install a message catalog file for a
	    unique language.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="using-autotools.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="special.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="using-perl.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">6.4. Using GNU autotools </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 6.6. Using <code class="literal">perl</code></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>