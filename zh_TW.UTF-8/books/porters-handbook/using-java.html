<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>6.10. Using Java</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="special.html" title="章 6. Special considerations" /><link rel="prev" href="using-kde.html" title="6.9. Using KDE" /><link rel="next" href="using-php.html" title="6.11. Web applications, Apache and PHP" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.10. Using Java</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="using-kde.html">前一頁</a> </td><th width="60%" align="center">章 6. Special considerations</th><td width="20%" align="right"> <a accesskey="n" href="using-php.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-java"></a>6.10. Using Java</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="java-variables"></a>6.10.1. Variable definitions</h3></div></div></div><p>If your port needs a Java™ Development Kit (JDK) to
	either build, run or even extract the distfile, then it should
	define <code class="varname">USE_JAVA</code>.</p><p>There are several JDKs in the ports collection, from various
	vendors, and in several versions.  If your port must use one of
	these versions, you can define which one.  The most current
	version is <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/java/jdk15/pkg-descr">java/jdk15</a>.</p><div class="table"><a id="idp68516432"></a><div class="table-title">表格 6.13. Variables that may be set by ports that use Java</div><div class="table-contents"><table summary="Variables that may be set by ports that use Java" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Variable</th><th>Means</th></tr></thead><tbody><tr><td><code class="varname">USE_JAVA</code></td><td>Should be defined for the remaining variables to have any
		effect.</td></tr><tr><td><code class="varname">JAVA_VERSION</code></td><td>List of space-separated suitable Java versions for
		the port.  An optional <code class="literal">"+"</code> allows you to
		specify a range of versions (allowed values:
		<code class="literal">1.1[+] 1.2[+] 1.3[+] 1.4[+]</code>).</td></tr><tr><td><code class="varname">JAVA_OS</code></td><td>List of space-separated suitable JDK port operating
		systems for the port (allowed values: <code class="literal">native
		linux</code>).</td></tr><tr><td><code class="varname">JAVA_VENDOR</code></td><td>List of space-separated suitable JDK port vendors for
		the port (allowed values: <code class="literal">freebsd bsdjava sun ibm
		blackdown</code>).</td></tr><tr><td><code class="varname">JAVA_BUILD</code></td><td>When set, it means that the selected JDK port should
		be added to the build dependencies of the port.</td></tr><tr><td><code class="varname">JAVA_RUN</code></td><td>When set, it means that the selected JDK port should
		be added to the run dependencies of the port.</td></tr><tr><td><code class="varname">JAVA_EXTRACT</code></td><td>When set, it means that the selected JDK port should
		be added to the extract dependencies of the port.</td></tr><tr><td><code class="varname">USE_JIKES</code></td><td>Whether the port should or should not use the
		<code class="command">jikes</code> bytecode compiler to build. When
		no value is set for this variable, the port will use
		<code class="command">jikes</code> to build if available. You may
		also explicitly forbid or enforce the use of
		<code class="command">jikes</code> (by setting <code class="literal">'no'</code>
		or <code class="literal">'yes'</code>). In the later case, <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/devel/jikes/pkg-descr">devel/jikes</a> will be added to build
		dependencies of the port. In any case that <code class="command">jikes</code>
		is actually used in place of <code class="command">javac</code>, then the
		<code class="varname">HAVE_JIKES</code> variable is defined by
		<code class="filename">bsd.java.mk</code>.</td></tr></tbody></table></div></div><br class="table-break" /><p>Below is the list of all settings a port will receive after
	setting <code class="varname">USE_JAVA</code>:</p><div class="table"><a id="idp68540624"></a><div class="table-title">表格 6.14. Variables provided to ports that use Java</div><div class="table-contents"><table summary="Variables provided to ports that use Java" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Variable</th><th>Value</th></tr></thead><tbody><tr><td><code class="varname">JAVA_PORT</code></td><td>The name of the JDK port (e.g.
		<code class="literal">'java/jdk14'</code>).</td></tr><tr><td><code class="varname">JAVA_PORT_VERSION</code></td><td>The full version of the JDK port (e.g.
		<code class="literal">'1.4.2'</code>). If you only need the first
		two digits of this version number, use
		<code class="varname">${JAVA_PORT_VERSION:C/^([0-9])\.([0-9])(.*)$/\1.\2/}</code>.</td></tr><tr><td><code class="varname">JAVA_PORT_OS</code></td><td>The operating system used by the JDK port (e.g.
		<code class="literal">'linux'</code>).</td></tr><tr><td><code class="varname">JAVA_PORT_VENDOR</code></td><td>The vendor of the JDK port (e.g.
		<code class="literal">'sun'</code>).</td></tr><tr><td><code class="varname">JAVA_PORT_OS_DESCRIPTION</code></td><td>Description of the operating system used by the JDK port
		(e.g. <code class="literal">'Linux'</code>).</td></tr><tr><td><code class="varname">JAVA_PORT_VENDOR_DESCRIPTION</code></td><td>Description of the vendor of the JDK port (e.g.
		<code class="literal">'FreeBSD Foundation'</code>).</td></tr><tr><td><code class="varname">JAVA_HOME</code></td><td>Path to the installation directory of the JDK (e.g.
		<code class="filename">'/usr/local/jdk1.3.1'</code>).</td></tr><tr><td><code class="varname">JAVAC</code></td><td>Path to the Java compiler to use (e.g.
		<code class="filename">'/usr/local/jdk1.1.8/bin/javac'</code> or
		<code class="filename">'/usr/local/bin/jikes'</code>).</td></tr><tr><td><code class="varname">JAR</code></td><td>Path to the <code class="command">jar</code> tool to use (e.g.
		<code class="filename">'/usr/local/jdk1.2.2/bin/jar'</code> or
		<code class="filename">'/usr/local/bin/fastjar'</code>).</td></tr><tr><td><code class="varname">APPLETVIEWER</code></td><td>Path to the <code class="command">appletviewer</code> utility (e.g.
		<code class="filename">'/usr/local/linux-jdk1.2.2/bin/appletviewer'</code>).</td></tr><tr><td><code class="varname">JAVA</code></td><td>Path to the <code class="command">java</code> executable. Use
		this for executing Java programs (e.g.
		<code class="filename">'/usr/local/jdk1.3.1/bin/java'</code>).</td></tr><tr><td><code class="varname">JAVADOC</code></td><td>Path to the <code class="command">javadoc</code> utility
		program.</td></tr><tr><td><code class="varname">JAVAH</code></td><td>Path to the <code class="command">javah</code> program.</td></tr><tr><td><code class="varname">JAVAP</code></td><td>Path to the <code class="command">javap</code> program.</td></tr><tr><td><code class="varname">JAVA_KEYTOOL</code></td><td>Path to the <code class="command">keytool</code> utility program.
		This variable is available only if the JDK is Java 1.2 or
		higher.</td></tr><tr><td><code class="varname">JAVA_N2A</code></td><td>Path to the <code class="command">native2ascii</code> tool.</td></tr><tr><td><code class="varname">JAVA_POLICYTOOL</code></td><td>Path to the <code class="command">policytool</code> program.
		This variable is available only if the JDK is Java 1.2 or
		higher.</td></tr><tr><td><code class="varname">JAVA_SERIALVER</code></td><td>Path to the <code class="command">serialver</code> utility
		program.</td></tr><tr><td><code class="varname">RMIC</code></td><td>Path to the RMI stub/skeleton generator,
		<code class="command">rmic</code>.</td></tr><tr><td><code class="varname">RMIREGISTRY</code></td><td>Path to the RMI registry program,
		<code class="command">rmiregistry</code>.</td></tr><tr><td><code class="varname">RMID</code></td><td>Path to the RMI daemon program <code class="command">rmid</code>.
		This variable is only available if the JDK is Java 1.2
		or higher.</td></tr><tr><td><code class="varname">JAVA_CLASSES</code></td><td>Path to the archive that contains the JDK class
		files. On JDK 1.2 or later, this is
		<code class="filename">${JAVA_HOME}/jre/lib/rt.jar</code>.  Earlier
		JDKs used
		<code class="filename">${JAVA_HOME}/lib/classes.zip</code>.</td></tr><tr><td><code class="varname">HAVE_JIKES</code></td><td>Defined whenever <code class="command">jikes</code> is used by
	        the port (see <code class="varname">USE_JIKES</code> above).</td></tr></tbody></table></div></div><br class="table-break" /><p>You may use the <code class="literal">java-debug</code> make target
	to get information for debugging your port. It will display the
	value of many of the forecited variables.</p><p>Additionally, the following constants are defined so all
	Java ports may be installed in a consistent way:</p><div class="table"><a id="idp68595408"></a><div class="table-title">表格 6.15. Constants defined for ports that use Java</div><div class="table-contents"><table summary="Constants defined for ports that use Java" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Constant</th><th>Value</th></tr></thead><tbody><tr><td><code class="varname">JAVASHAREDIR</code></td><td>The base directory for everything related to Java.
		Default: <code class="filename">${PREFIX}/share/java</code>.
	      </td></tr><tr><td><code class="varname">JAVAJARDIR</code></td><td>The directory where JAR files should be installed.
		Default:
		<code class="filename">${JAVASHAREDIR}/classes</code>.</td></tr><tr><td><code class="varname">JAVALIBDIR</code></td><td>The directory where JAR files installed by other
	        ports are located. Default:
		<code class="filename">${LOCALBASE}/share/java/classes</code>.</td></tr></tbody></table></div></div><br class="table-break" /><p>The related entries are defined in both
	<code class="varname">PLIST_SUB</code> (documented in
	<a class="xref" href="plist.html#plist-sub" title="7.1. Changing pkg-plist based on make variables">節 7.1, “Changing <code class="filename">pkg-plist</code> based on make
	  variables”</a>) and
	<code class="varname">SUB_LIST</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="java-building-with-ant"></a>6.10.2. Building with Ant</h3></div></div></div><p>When the port is to be built using Apache Ant, it has to
	  define <code class="varname">USE_ANT</code>. Ant is thus considered to be
	  the sub-make command. When no <code class="literal">do-build</code> target
	  is defined by the port, a default one will be set that simply
	  runs Ant according to <code class="varname">MAKE_ENV</code>,
	  <code class="varname">MAKE_ARGS</code> and <code class="varname">ALL_TARGETS</code>.
	  This is similar to the <code class="varname">USE_GMAKE</code> mechanism,
	  which is documented in <a class="xref" href="building.html" title="6.3. Building mechanisms">節 6.3, “Building mechanisms”</a>.</p><p>If <code class="command">jikes</code> is used in place of
	  <code class="command">javac</code> (see <code class="varname">USE_JIKES</code> in
	  <a class="xref" href="using-java.html#java-variables" title="6.10.1. Variable definitions">節 6.10.1, “Variable definitions”</a>), then Ant will automatically
	  use it to build the port.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="java-best-practices"></a>6.10.3. Best practices</h3></div></div></div><p>When porting a Java library, your port should install the
	  JAR file(s) in <code class="filename">${JAVAJARDIR}</code>, and everything
	  else under <code class="filename">${JAVASHAREDIR}/${PORTNAME}</code>
	  (except for the documentation, see below). In order to reduce
	  the packing file size, you may reference the JAR file(s) directly
	  in the <code class="filename">Makefile</code>. Just use the following
	  statement (where <code class="filename">myport.jar</code> is the name
	  of the JAR file installed as part of the port):</p><pre class="programlisting">PLIST_FILES+= %%JAVAJARDIR%%/myport.jar</pre><p>When porting a Java application, the port usually installs
	  everything under a single directory (including its JAR
	  dependencies).  The use of
	  <code class="filename">${JAVASHAREDIR}/${PORTNAME}</code> is strongly
	  encouraged in this regard.  It is up the porter to decide
	  whether the port should install the additional JAR dependencies
	  under this directory or directly use the already installed ones
	  (from <code class="filename">${JAVAJARDIR}</code>).</p><p>Regardless of the type of your port (library or application),
	  the additional documentation should be installed in the
	  <a class="link" href="install.html#install-documentation" title="5.14.4. Install additional documentation">same location</a> as for
	  any other port.  The JavaDoc tool is known to produce a
	  different set of files depending on the version of the JDK that
	  is used. For ports that do not enforce the use of a particular
	  JDK, it is therefore a complex task to specify the packing list
	  (<code class="filename">pkg-plist</code>).  This is one reason why
	  porters are strongly encouraged to use the
	  <code class="varname">PORTDOCS</code> macro.  Moreover, even if you can
	  predict the set of files that will be generated by
	  <code class="command">javadoc</code>, the size of the resulting
	  <code class="filename">pkg-plist</code> advocates for the use of
	  <code class="varname">PORTDOCS</code>.</p><p>The default value for <code class="varname">DATADIR</code> is
	  <code class="filename">${PREFIX}/share/${PORTNAME}</code>.  It is a good
	  idea to override <code class="varname">DATADIR</code> to
	  <code class="filename">${JAVASHAREDIR}/${PORTNAME}</code> for Java ports.
	  Indeed, <code class="varname">DATADIR</code> is automatically added to
	  <code class="varname">PLIST_SUB</code> (documented in <a class="xref" href="plist.html#plist-sub" title="7.1. Changing pkg-plist based on make variables">節 7.1, “Changing <code class="filename">pkg-plist</code> based on make
	  variables”</a>) so you may use
	  <code class="literal">%%DATADIR%%</code> directly in
	  <code class="filename">pkg-plist</code>.</p><p>As for the choice of building Java ports from source or
	  directly installing them from a binary distribution, there is
	  no defined policy at the time of writing.  However, people from
	  the <a class="link" href="http://www.freebsd.org/java/" target="_top">FreeBSD Java Project</a>
	  encourage porters to have their ports built from source whenever
	  it is a trivial task.</p><p>All the features that have been presented in this section
	  are implemented in <code class="filename">bsd.java.mk</code>. If you
	  ever think that your port needs more sophisticated Java support,
	  please first have a look at the <a class="link" href="http://www.freebsd.org/cgi/cvsweb.cgi/ports/Mk/bsd.java.mk" target="_top">
	  bsd.java.mk CVS log</a> as it usually takes some time to
	  document the latest features.  Then, if you think the support
	  you are lacking would be beneficial to many other Java ports,
	  feel free to discuss it on the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-java" target="_top">FreeBSD Java Language 郵遞論壇</a>.</p><p>Although there is a <code class="literal">java</code> category for
	  PRs, it refers to the JDK porting effort from the FreeBSD Java
	  project.  Therefore, you should submit your Java port in the
	  <code class="literal">ports</code> category as for any other port, unless
	  the issue you are trying to resolve is related to either a JDK
	  implementation or <code class="filename">bsd.java.mk</code>.</p><p>Similarly, there is a defined policy regarding the
	  <code class="varname">CATEGORIES</code> of a Java port, which is detailed
	  in <a class="xref" href="makefile-categories.html" title="5.3. Categorization">節 5.3, “Categorization”</a>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="using-kde.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="special.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="using-php.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">6.9. Using KDE </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 6.11. Web applications, Apache and PHP</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>