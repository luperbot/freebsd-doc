<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>5.4. The distribution files</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="makefile.html" title="章 5. 設定 Makefile" /><link rel="prev" href="makefile-categories.html" title="5.3. Categorization" /><link rel="next" href="makefile-maintainer.html" title="5.5. MAINTAINER" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.4. The distribution files</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="makefile-categories.html">前一頁</a> </td><th width="60%" align="center">章 5. 設定 Makefile</th><td width="20%" align="right"> <a accesskey="n" href="makefile-maintainer.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="makefile-distfiles"></a>5.4. The distribution files</h2></div></div></div><p>The second part of the <code class="filename">Makefile</code> describes the
	files that must be downloaded in order to build the port, and where
	they can be downloaded from.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67364816"></a>5.4.1. <code class="varname">DISTVERSION/DISTNAME</code></h3></div></div></div><p><code class="varname">DISTNAME</code> is the name of the port as
	  called by the authors of the software.
	  <code class="varname">DISTNAME</code> defaults to
	  <code class="literal">${PORTNAME}-${PORTVERSION}</code>, so override it only if necessary.
	  <code class="varname">DISTNAME</code> is only used in two places.
	  First, the distribution file list
	  (<code class="varname">DISTFILES</code>) defaults to
	  <code class="varname">${DISTNAME}</code><code class="varname">${EXTRACT_SUFX}</code>.
	  Second, the distribution file is expected to extract into a
	  subdirectory named <code class="varname">WRKSRC</code>, which defaults
	  to <code class="filename">work/${DISTNAME}</code>.</p><p>Some vendor's distribution names which do not fit into the
	  <code class="literal">${PORTNAME}-${PORTVERSION}</code>-scheme can be handled
	  automatically by setting <code class="varname">DISTVERSION</code>.
	  <code class="varname">PORTVERSION</code> and <code class="varname">DISTNAME</code> will be
	  derived automatically, but can of course be overridden.  The following
	  table lists some examples:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th><code class="varname">DISTVERSION</code></th><th><code class="varname">PORTVERSION</code></th></tr></thead><tbody><tr><td>0.7.1d</td><td>0.7.1.d</td></tr><tr><td>10Alpha3</td><td>10.a3</td></tr><tr><td>3Beta7-pre2</td><td>3.b7.p2</td></tr><tr><td>8:f_17</td><td>8f.17</td></tr></tbody></table></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="varname">PKGNAMEPREFIX</code> and
	    <code class="varname">PKGNAMESUFFIX</code> do not affect
	    <code class="varname">DISTNAME</code>.  Also note that if
	    <code class="varname">WRKSRC</code> is equal to
	    <code class="filename">work/${PORTNAME}-${PORTVERSION}</code>
	    while the original source archive is named something other than
	    <code class="varname">${PORTNAME}-${PORTVERSION}${EXTRACT_SUFX}</code>,
	    you should probably leave <code class="varname">DISTNAME</code>
	    alone—— you are better off defining
	    <code class="varname">DISTFILES</code> than having to set both
	    <code class="varname">DISTNAME</code> and <code class="varname">WRKSRC</code>
	    (and possibly <code class="varname">EXTRACT_SUFX</code>).</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67384400"></a>5.4.2. <code class="varname">MASTER_SITES</code></h3></div></div></div><p>Record the directory part of the FTP/HTTP-URL pointing at the
	  original tarball in <code class="varname">MASTER_SITES</code>.  Do not forget
	  the trailing slash (<code class="filename">/</code>)!</p><p>The <code class="command">make</code> macros will try to use this
	  specification for grabbing the distribution file with
	  <code class="varname">FETCH</code> if they cannot find it already on the
	  system.</p><p>It is recommended that you put multiple sites on this list,
	  preferably from different continents.  This will safeguard against
	  wide-area network problems.  We are even planning to add support
	  for automatically determining the closest master site and fetching
	  from there; having multiple sites will go a long way towards
	  helping this effort.</p><p>If the original tarball is part of one of the popular
	  archives such as X-contrib, GNU, or Perl CPAN, you may be able
	  refer to those sites in an easy compact form using
	  <code class="varname">MASTER_SITE_<em class="replaceable"><code>*</code></em></code>
	  (比如：<code class="varname">MASTER_SITE_XCONTRIB</code>、
	  <code class="varname">MASTER_SITE_GNU</code>、
	  <code class="varname">MASTER_SITE_PERL_CPAN</code>)。  Simply set
	  <code class="varname">MASTER_SITES</code> to one of these variables and
	  <code class="varname">MASTER_SITE_SUBDIR</code> to the path within the
	  archive.  Here is an example:</p><pre class="programlisting">MASTER_SITES=         ${MASTER_SITE_XCONTRIB}
MASTER_SITE_SUBDIR=   applications</pre><p>These variables are defined in
	  <code class="filename">/usr/ports/Mk/bsd.sites.mk</code>.  There are
	  new entries added all the time, so make sure to check the
	  latest version of this file before submitting a port.</p><p>The user can also set the <code class="varname">MASTER_SITE_*</code>
	  variables in <code class="filename">/etc/make.conf</code> to override our
	  choices, and use their favorite mirrors of these popular archives
	  instead.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67393360"></a>5.4.3. <code class="varname">EXTRACT_SUFX</code></h3></div></div></div><p>If you have one distribution file, and it uses an odd suffix to
	  indicate the compression mechanism, set
	  <code class="varname">EXTRACT_SUFX</code>.</p><p>For example, if the distribution file was named
	  <code class="filename">foo.tgz</code> instead of the more normal
	  <code class="filename">foo.tar.gz</code>, you would write:</p><pre class="programlisting">DISTNAME=      foo
EXTRACT_SUFX=  .tgz</pre><p>The <code class="varname">USE_BZIP2</code> and <code class="varname">USE_ZIP</code>
	  variables automatically set <code class="varname">EXTRACT_SUFX</code> to
	  <code class="literal">.tar.bz2</code> or <code class="literal">.zip</code> as necessary.  If
	  neither of these are set then <code class="varname">EXTRACT_SUFX</code>
	  defaults to <code class="literal">.tar.gz</code>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">You never need to set both <code class="varname">EXTRACT_SUFX</code> and
	    <code class="varname">DISTFILES</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67409488"></a>5.4.4. <code class="varname">DISTFILES</code></h3></div></div></div><p>Sometimes the names of the files to be downloaded have no
	  resemblance to the name of the port.  For example, it might be
	  called <code class="filename">source.tar.gz</code> or similar.  In other
	  cases the application's source code might be in several different
	  archives, all of which must be downloaded.</p><p>If this is the case, set <code class="varname">DISTFILES</code> to be a
	  space separated list of all the files that must be
	  downloaded.</p><pre class="programlisting">DISTFILES=     source1.tar.gz source2.tar.gz</pre><p>If not explicitly set, <code class="varname">DISTFILES</code> defaults to
	  <code class="literal">${DISTNAME}${EXTRACT_SUFX}</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67413584"></a>5.4.5. <code class="varname">EXTRACT_ONLY</code></h3></div></div></div><p>If only some of the <code class="varname">DISTFILES</code> must be
	  extracted——for example, one of them is the source code, while
	  another is an uncompressed document——list the filenames that
	  must be extracted in <code class="varname">EXTRACT_ONLY</code>.</p><pre class="programlisting">DISTFILES=     source.tar.gz manual.html
EXTRACT_ONLY=  source.tar.gz</pre><p>If <span class="emphasis"><em>none</em></span> of the <code class="varname">DISTFILES</code>
	  should be uncompressed then set <code class="varname">EXTRACT_ONLY</code> to
	  the empty string.</p><pre class="programlisting">EXTRACT_ONLY=</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="porting-patchfiles"></a>5.4.6. <code class="varname">PATCHFILES</code></h3></div></div></div><p>If your port requires some additional patches that are available
	  by FTP or HTTP, set <code class="varname">PATCHFILES</code> to the names of
	  the files and <code class="varname">PATCH_SITES</code> to the URL of the
	  directory that contains them (the format is the same as
	  <code class="varname">MASTER_SITES</code>).</p><p>If the patch is not relative to the top of the source tree
	  (i.e., <code class="varname">WRKSRC</code>) because it contains some extra
	  pathnames, set <code class="varname">PATCH_DIST_STRIP</code> accordingly. For
	  instance, if all the pathnames in the patch have an extra
	  <code class="literal">foozolix-1.0/</code> in front of the filenames, then set
	  <code class="literal">PATCH_DIST_STRIP=-p1</code>.</p><p>Do not worry if the patches are compressed; they will be
	  decompressed automatically if the filenames end with
	  <code class="filename">.gz</code> or <code class="filename">.Z</code>.</p><p>If the patch is distributed with some other files, such as
	  documentation, in a gzip'd tarball, you cannot just use
	  <code class="varname">PATCHFILES</code>.  If that is the case, add the name
	  and the location of the patch tarball to
	  <code class="varname">DISTFILES</code> and <code class="varname">MASTER_SITES</code>.
	  Then, use the <code class="varname">EXTRA_PATCHES</code> variable to
	  point to those files and <code class="filename">bsd.port.mk</code>
	  will automatically apply them for you.  In particular, do
	  <span class="emphasis"><em>not</em></span> copy patch files into the
	  <code class="varname">PATCHDIR</code> directory——that directory may
	  not be writable.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">The tarball will have been extracted alongside the
	    regular source by then, so there is no need to explicitly extract
	    it if it is a regular gzip'd or compress'd tarball. If you do the
	    latter, take extra care not to overwrite something that already
	    exists in that directory.  Also, do not forget to add a command to
	    remove the copied patch in the <code class="buildtarget">pre-clean</code>
	    target.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="porting-master-sites-n"></a>5.4.7. Multiple distribution files or patches from different
	  sites and subdirectories
	  (<code class="literal">MASTER_SITES:n</code>)</h3></div></div></div><p>(Consider this to be a somewhat <span class="quote">“<span class="quote">advanced topic</span>”</span>;
	  those new to this document may wish to skip this section at first).
	  </p><p>This section has information on the fetching mechanism
	  known as both <code class="literal">MASTER_SITES:n</code> and
	  <code class="literal">MASTER_SITES_NN</code>.  We will refer to this
	  mechanism as <code class="literal">MASTER_SITES:n</code>
	  hereon.</p><p>A little background first.  OpenBSD has a neat feature
	  inside both <code class="varname">DISTFILES</code> and
	  <code class="varname">PATCHFILES</code> variables, both files and
	  patches can be postfixed with <code class="literal">:n</code>
	  identifiers where <code class="literal">n</code> both can be
	  <code class="literal">[0-9]</code> and denote a group designation.
	  For example:</p><pre class="programlisting">DISTFILES=      alpha:0 beta:1</pre><p>In OpenBSD, distribution file <code class="filename">alpha</code>
	  will be associated with variable
	  <code class="varname">MASTER_SITES0</code> instead of our common
	  <code class="varname">MASTER_SITES</code> and
	  <code class="filename">beta</code> with
	  <code class="varname">MASTER_SITES1</code>.</p><p>This is a very interesting feature which can decrease
	  that endless search for the correct download site.</p><p>Just picture 2 files in <code class="varname">DISTFILES</code> and
	  20 sites in <code class="varname">MASTER_SITES</code>, the sites slow
	  as hell where <code class="filename">beta</code> is carried by all
	  sites in <code class="varname">MASTER_SITES</code>, and
	  <code class="filename">alpha</code> can only be found in the 20th
	  site.  It would be such a waste to check all of them if
	  maintainer knew this beforehand, would it not?  Not a good
	  start for that lovely weekend!</p><p>Now that you have the idea, just imagine more
	  <code class="varname">DISTFILES</code> and more
	  <code class="varname">MASTER_SITES</code>.  Surely our
	  <span class="quote">“<span class="quote">distfiles survey meister</span>”</span> would appreciate the
	  relief to network strain that this would bring.</p><p>In the next sections, information will follow on the
	  FreeBSD implementation of this idea.	We improved a bit on
	  OpenBSD's concept.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67449680"></a>5.4.7.1. Simplified information</h4></div></div></div><p>This section tells you how to quickly prepare fine
	    grained fetching of multiple distribution files and
	    patches from different sites and subdirectories.  We
	    describe here a case of simplified
	    <code class="literal">MASTER_SITES:n</code> usage.  This will be
	    sufficient for most scenarios.  However, if you need
	    further information, you will have to refer to the next
	    section.</p><p>Some applications consist of multiple distribution
	    files that must be downloaded from a number of different
	    sites.  For example,
	    <span class="application">Ghostscript</span> consists of the
	    core of the program, and then a large number of driver
	    files that are used depending on the user's printer.  Some
	    of these driver files are supplied with the core, but many
	    others must be downloaded from a variety of different
	    sites.</p><p>To support this, each entry in
	    <code class="varname">DISTFILES</code> may be followed by a colon
	    and a <span class="quote">“<span class="quote">tag name</span>”</span>.  Each site listed in
	    <code class="varname">MASTER_SITES</code> is then followed by a
	    colon, and the tag that indicates which distribution files
	    should be downloaded from this site.</p><p>For example, consider an application with the source
	    split in two parts, <code class="filename">source1.tar.gz</code>
	    and <code class="filename">source2.tar.gz</code>, which must be
	    downloaded from two different sites.  The port's
	    <code class="filename">Makefile</code> would include lines like
	    <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-simple-use-one-file-per-site" title="範例 5.1. Simplified use of MASTER_SITES:n with 1 file per site">範例 5.1, “Simplified use of <code class="literal">MASTER_SITES:n</code>
	      with 1 file per site”</a>.</p><div class="example"><a id="ports-master-sites-n-example-simple-use-one-file-per-site"></a><div class="example-title">範例 5.1. Simplified use of <code class="literal">MASTER_SITES:n</code>
	      with 1 file per site</div><div class="example-contents"><pre class="programlisting">MASTER_SITES=   ftp://ftp.example1.com/:source1 \
		ftp://ftp.example2.com/:source2
DISTFILES=      source1.tar.gz:source1 \
		source2.tar.gz:source2</pre></div></div><br class="example-break" /><p>Multiple distribution files can have the same tag.
	    Continuing the previous example, suppose that there was a
	    third distfile, <code class="filename">source3.tar.gz</code>, that
	    should be downloaded from
	    <code class="systemitem">ftp.example2.com</code>.	The
	    <code class="filename">Makefile</code> would then be written like
	    <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-simple-use-more-than-one-file-per-site" title="範例 5.2. Simplified use of MASTER_SITES:n with more than 1 file per site">範例 5.2, “Simplified use of <code class="literal">MASTER_SITES:n</code>
	      with more than 1 file per site”</a>.</p><div class="example"><a id="ports-master-sites-n-example-simple-use-more-than-one-file-per-site"></a><div class="example-title">範例 5.2. Simplified use of <code class="literal">MASTER_SITES:n</code>
	      with more than 1 file per site</div><div class="example-contents"><pre class="programlisting">MASTER_SITES=   ftp://ftp.example1.com/:source1 \
		ftp://ftp.example2.com/:source2
DISTFILES=      source1.tar.gz:source1 \
		source2.tar.gz:source2 \
		source3.tar.gz:source2</pre></div></div><br class="example-break" /></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67464912"></a>5.4.7.2. Detailed information</h4></div></div></div><p>Okay, so the previous section example did not reflect
	    your needs?	 In this section we will explain in detail how
	    the fine grained fetching mechanism
	    <code class="literal">MASTER_SITES:n</code> works and how you can
	    modify your ports to use it.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Elements can be postfixed with
		<code class="literal">:n</code> where
		<em class="replaceable"><code>n</code></em> is
		<code class="literal">[^:,]+</code>, i.e.,
		<em class="replaceable"><code>n</code></em> could conceptually be any
		alphanumeric string but we will limit it to
		<code class="literal">[a-zA-Z_][0-9a-zA-Z_]+</code> for
		now.</p><p>Moreover, string matching is case sensitive;
		i.e., <code class="literal">n</code> is different from
		<code class="literal">N</code>.</p><p>However, the following words cannot be used for
		postfixing purposes since they yield special meaning:
		<code class="literal">default</code>, <code class="literal">all</code> and
		<code class="literal">ALL</code> (they are used internally in
		item <a class="xref" href="makefile-distfiles.html#porting-master-sites-n-what-changes-in-port-targets">ii</a>).
		Furthermore, <code class="literal">DEFAULT</code> is a special
		purpose word (check item <a class="xref" href="makefile-distfiles.html#porting-master-sites-n-DEFAULT-group">3</a>).</p></li><li class="listitem"><p>Elements postfixed with <code class="literal">:n</code>
		belong to the group <code class="literal">n</code>,
		<code class="literal">:m</code> belong to group
		<code class="literal">m</code> and so forth.</p></li><li class="listitem"><p><a id="porting-master-sites-n-DEFAULT-group"></a>Elements without a postfix are groupless, i.e.,
		they all belong to the special group
		<code class="literal">DEFAULT</code>.  If you postfix any
		elements with <code class="literal">DEFAULT</code>, you are just
		being redundant unless you want to have an element
		belonging to both <code class="literal">DEFAULT</code> and other
		groups at the same time (check item <a class="xref" href="makefile-distfiles.html#porting-master-sites-n-comma-operator">5</a>).</p><p>The following examples are equivalent but the
		first one is preferred:</p><pre class="programlisting">MASTER_SITES=   alpha

MASTER_SITES=   alpha:DEFAULT</pre></li><li class="listitem"><p>Groups are not exclusive, an element may belong to
		several different groups at the same time and a group
		can either have either several different elements or
		none at all.  Repeated elements within the same group
		will be simply that, repeated elements.</p></li><li class="listitem"><p><a id="porting-master-sites-n-comma-operator"></a>When you want an element to belong to several
		groups at the same time, you can use the comma
		operator (<code class="literal">,</code>).</p><p>Instead of repeating it several times, each time
		with a different postfix, we can list several groups
		at once in a single postfix.  For instance,
		<code class="literal">:m,n,o</code> marks an element that
		belongs to group <code class="literal">m</code>,
		<code class="literal">n</code> and <code class="literal">o</code>.</p><p>All the following examples are equivalent but the
		last one is preferred:</p><pre class="programlisting">MASTER_SITES=   alpha alpha:SOME_SITE

MASTER_SITES=   alpha:DEFAULT alpha:SOME_SITE

MASTER_SITES=   alpha:SOME_SITE,DEFAULT

MASTER_SITES=   alpha:DEFAULT,SOME_SITE</pre></li><li class="listitem"><p>All sites within a given group are sorted
		according to <code class="varname">MASTER_SORT_AWK</code>.  All
		groups within <code class="varname">MASTER_SITES</code> and
		<code class="varname">PATCH_SITES</code> are sorted as
		well.</p></li><li class="listitem"><p><a id="porting-master-sites-n-group-semantics"></a>Group semantics can be used in any of the
		following variables <code class="varname">MASTER_SITES</code>,
		<code class="varname">PATCH_SITES</code>,
		<code class="varname">MASTER_SITE_SUBDIR</code>,
		<code class="varname">PATCH_SITE_SUBDIR</code>,
		<code class="varname">DISTFILES</code>, and
		<code class="varname">PATCHFILES</code> according to the
		following syntax:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>All <code class="varname">MASTER_SITES</code>,
		    <code class="varname">PATCH_SITES</code>,
		    <code class="varname">MASTER_SITE_SUBDIR</code> and
		    <code class="varname">PATCH_SITE_SUBDIR</code> elements must
		    be terminated with the forward slash
		    <code class="literal">/</code> character.  If any elements
		    belong to any groups, the group postfix
		    <code class="literal">:n</code>
		    must come right after the terminator
		    <code class="literal">/</code>.  The
		    <code class="literal">MASTER_SITES:n</code> mechanism relies
		    on the existence of the terminator
		    <code class="literal">/</code> to avoid confusing elements
		    where a <code class="literal">:n</code> is a valid part of
		    the element with occurrences where
		    <code class="literal">:n</code> denotes group
		    <code class="literal">n</code>.  For compatibility purposes,
		    since the <code class="literal">/</code> terminator was not
		    required before in both
		    <code class="varname">MASTER_SITE_SUBDIR</code> and
		    <code class="varname">PATCH_SITE_SUBDIR</code> elements, if
		    the postfix immediate preceding character is not
		    a <code class="literal">/</code> then <code class="literal">:n</code>
		    will be considered a valid part of the element
		    instead of a group postfix even if an element is
		    postfixed with <code class="literal">:n</code>.  See both
		    <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-master-site-subdir" title="範例 5.3. Detailed use of MASTER_SITES:n in MASTER_SITE_SUBDIR">範例 5.3, “Detailed use of
		      <code class="literal">MASTER_SITES:n</code> in
		      <code class="varname">MASTER_SITE_SUBDIR</code>”</a>
		    and <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-complete-example-master-sites" title="範例 5.4. Detailed use of MASTER_SITES:n with comma operator, multiple files, multiple sites and multiple subdirectories">範例 5.4, “Detailed use of
			<code class="literal">MASTER_SITES:n</code> with comma
			operator, multiple files, multiple sites and
			multiple subdirectories”</a>.</p><div class="example"><a id="ports-master-sites-n-example-detailed-use-master-site-subdir"></a><div class="example-title">範例 5.3. Detailed use of
		      <code class="literal">MASTER_SITES:n</code> in
		      <code class="varname">MASTER_SITE_SUBDIR</code></div><div class="example-contents"><pre class="programlisting">MASTER_SITE_SUBDIR=     old:n new/:NEW</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Directories within group
			  <code class="literal">DEFAULT</code> -&gt; old:n</p></li><li class="listitem"><p>Directories within group
			  <code class="literal">NEW</code> -&gt; new</p></li></ul></div></div></div><br class="example-break" /><div class="example"><a id="ports-master-sites-n-example-detailed-use-complete-example-master-sites"></a><div class="example-title">範例 5.4. Detailed use of
			<code class="literal">MASTER_SITES:n</code> with comma
			operator, multiple files, multiple sites and
			multiple subdirectories</div><div class="example-contents"><pre class="programlisting">MASTER_SITES=   http://site1/%SUBDIR%/ http://site2/:DEFAULT \
		http://site3/:group3 http://site4/:group4 \
		http://site5/:group5 http://site6/:group6 \
		http://site7/:DEFAULT,group6 \
		http://site8/%SUBDIR%/:group6,group7 \
		http://site9/:group8
DISTFILES=      file1 file2:DEFAULT file3:group3 \
		file4:group4,group5,group6 file5:grouping \
		file6:group7
MASTER_SITE_SUBDIR=     directory-trial:1 directory-n/:groupn \
			directory-one/:group6,DEFAULT \
			directory</pre><p>The previous example results in the
		      following fine grained fetching.	Sites are
		      listed in the exact order they will be
		      used.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">file1</code> will be
			  fetched from</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site1/directory-trial:1/</p></li><li class="listitem"><p>http://site1/directory-one/</p></li><li class="listitem"><p>http://site1/directory/</p></li><li class="listitem"><p>http://site2/</p></li><li class="listitem"><p>http://site7/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div></li><li class="listitem"><p><code class="filename">file2</code> will be
			  fetched exactly as
			  <code class="filename">file1</code> since they
			  both belong to the same group</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site1/directory-trial:1/</p></li><li class="listitem"><p>http://site1/directory-one/</p></li><li class="listitem"><p>http://site1/directory/</p></li><li class="listitem"><p>http://site2/</p></li><li class="listitem"><p>http://site7/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div></li><li class="listitem"><p><code class="filename">file3</code> will be
			  fetched from</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site3/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div></li><li class="listitem"><p><code class="filename">file4</code> will be
			  fetched from</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site4/</p></li><li class="listitem"><p>http://site5/</p></li><li class="listitem"><p>http://site6/</p></li><li class="listitem"><p>http://site7/</p></li><li class="listitem"><p>http://site8/directory-one/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div></li><li class="listitem"><p><code class="filename">file5</code> will be
			  fetched from</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div></li><li class="listitem"><p><code class="filename">file6</code> will be
			  fetched from</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site8/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div></li></ul></div></div></div><br class="example-break" /></li></ol></div></li><li class="listitem"><p>How do I group one of the special variables from
		<code class="filename">bsd.sites.mk</code>, e.g.,
		<code class="varname">MASTER_SITE_SOURCEFORGE</code>?</p><p>See <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-master-site-sourceforge" title="範例 5.5. Detailed use of MASTER_SITES:n with MASTER_SITE_SOURCEFORGE">範例 5.5, “Detailed use of
		  <code class="literal">MASTER_SITES:n</code> with
		  <code class="varname">MASTER_SITE_SOURCEFORGE</code>”</a>.</p><div class="example"><a id="ports-master-sites-n-example-detailed-use-master-site-sourceforge"></a><div class="example-title">範例 5.5. Detailed use of
		  <code class="literal">MASTER_SITES:n</code> with
		  <code class="varname">MASTER_SITE_SOURCEFORGE</code></div><div class="example-contents"><pre class="programlisting">MASTER_SITES=   http://site1/ ${MASTER_SITE_SOURCEFORGE:S/$/:sourceforge,TEST/}
DISTFILES=      something.tar.gz:sourceforge</pre></div></div><br class="example-break" /><p><code class="filename">something.tar.gz</code> will be
		fetched from all sites within
		<code class="varname">MASTER_SITE_SOURCEFORGE</code>.</p></li><li class="listitem"><p>How do I use this with <code class="varname">PATCH*</code>
		variables?</p><p>All examples were done with
		<code class="varname">MASTER*</code> variables but they work
		exactly the same for <code class="varname">PATCH*</code> ones as
		can be seen in <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-patch-sites" title="範例 5.6. Simplified use of MASTER_SITES:n with PATCH_SITES.">範例 5.6, “Simplified use of
		  <code class="literal">MASTER_SITES:n</code> with
		  <code class="varname">PATCH_SITES</code>.”</a>.</p><div class="example"><a id="ports-master-sites-n-example-detailed-use-patch-sites"></a><div class="example-title">範例 5.6. Simplified use of
		  <code class="literal">MASTER_SITES:n</code> with
		  <code class="varname">PATCH_SITES</code>.</div><div class="example-contents"><pre class="programlisting">PATCH_SITES=    http://site1/ http://site2/:test
PATCHFILES=     patch1:test</pre></div></div><br class="example-break" /></li></ol></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67581520"></a>5.4.7.3. What does change for ports?  What does not?</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>All current ports remain the same.  The
		<code class="literal">MASTER_SITES:n</code> feature code is only
		activated if there are elements postfixed with
		<code class="literal">:n</code> like
		elements according to the aforementioned syntax rules,
		especially as shown in item <a class="xref" href="makefile-distfiles.html#porting-master-sites-n-group-semantics">7</a>.</p></li><li class="listitem"><p><a id="porting-master-sites-n-what-changes-in-port-targets"></a>The port targets remain the same:
		<code class="buildtarget">checksum</code>,
		<code class="buildtarget">makesum</code>,
		<code class="buildtarget">patch</code>,
		<code class="buildtarget">configure</code>,
		<code class="buildtarget">build</code>, etc.  With the obvious
		exceptions of <code class="buildtarget">do-fetch</code>,
		<code class="buildtarget">fetch-list</code>,
		<code class="buildtarget">master-sites</code> and
		<code class="buildtarget">patch-sites</code>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="buildtarget">do-fetch</code>: deploys the
		    new grouping postfixed
		    <code class="varname">DISTFILES</code> and
		    <code class="varname">PATCHFILES</code> with their matching
		    group elements within both
		    <code class="varname">MASTER_SITES</code> and
		    <code class="varname">PATCH_SITES</code> which use matching
		    group elements within both
		    <code class="varname">MASTER_SITE_SUBDIR</code> and
		    <code class="varname">PATCH_SITE_SUBDIR</code>.  Check <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-complete-example-master-sites" title="範例 5.4. Detailed use of MASTER_SITES:n with comma operator, multiple files, multiple sites and multiple subdirectories">範例 5.4, “Detailed use of
			<code class="literal">MASTER_SITES:n</code> with comma
			operator, multiple files, multiple sites and
			multiple subdirectories”</a>.</p></li><li class="listitem"><p><code class="buildtarget">fetch-list</code>: works
		    like old <code class="buildtarget">fetch-list</code> with
		    the exception that it groups just like
		    <code class="buildtarget">do-fetch</code>.</p></li><li class="listitem"><p><code class="buildtarget">master-sites</code> and
		    <code class="buildtarget">patch-sites</code>:
		    (incompatible with older versions) only return the
		    elements of group <code class="literal">DEFAULT</code>;  in
		    fact, they execute targets
		    <code class="buildtarget">master-sites-default</code> and
		    <code class="buildtarget">patch-sites-default</code>
		    respectively.</p><p>Furthermore, using target either
		    <code class="buildtarget">master-sites-all</code> or
		    <code class="buildtarget">patch-sites-all</code> is
		    preferred to directly checking either
		    <code class="buildtarget">MASTER_SITES</code> or
		    <code class="buildtarget">PATCH_SITES</code>.  Also,
		    directly checking is not guaranteed to work in any
		    future versions.  Check item <a class="xref" href="makefile-distfiles.html#porting-master-sites-n-new-port-targets-master-sites-all">B</a>
		    for more information on these new port
		    targets.</p></li></ul></div></li><li class="listitem"><p>New port targets</p><div class="orderedlist"><ol class="orderedlist" type="A"><li class="listitem"><p>There are
		    <code class="buildtarget">master-sites-<em class="replaceable"><code>n</code></em></code>
		    and
		    <code class="buildtarget">patch-sites-<em class="replaceable"><code>n</code></em></code>
		    targets which will list the elements of the
		    respective group <em class="replaceable"><code>n</code></em>
		    within <code class="varname">MASTER_SITES</code> and
		    <code class="varname">PATCH_SITES</code> respectively.  For
		    instance, both
		    <code class="buildtarget">master-sites-DEFAULT</code> and
		    <code class="buildtarget">patch-sites-DEFAULT</code> will
		    return the elements of group
		    <code class="literal">DEFAULT</code>,
		    <code class="buildtarget">master-sites-test</code> and
		    <code class="buildtarget">patch-sites-test</code> of group
		    <code class="literal">test</code>, and thereon.</p></li><li class="listitem"><p><a id="porting-master-sites-n-new-port-targets-master-sites-all"></a>There are new targets
		    <code class="buildtarget">master-sites-all</code> and
		    <code class="buildtarget">patch-sites-all</code> which do
		    the work of the old
		    <code class="buildtarget">master-sites</code> and
		    <code class="buildtarget">patch-sites</code> ones.  They
		    return the elements of all groups as if they all
		    belonged to the same group with the caveat that it
		    lists as many
		    <code class="varname">MASTER_SITE_BACKUP</code> and
		    <code class="varname">MASTER_SITE_OVERRIDE</code> as there
		    are groups defined within either
		    <code class="varname">DISTFILES</code> or
		    <code class="varname">PATCHFILES</code>;  respectively for
		    <code class="buildtarget">master-sites-all</code> and
		    <code class="buildtarget">patch-sites-all</code>.</p></li></ol></div></li></ol></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67619920"></a>5.4.8. <code class="varname">DIST_SUBDIR</code></h3></div></div></div><p>Do not let your port clutter
	  <code class="filename">/usr/ports/distfiles</code>.  If your port requires a
	  lot of files to be fetched, or contains a file that has a name that
	  might conflict with other ports (e.g.,
	  <code class="filename">Makefile</code>), set <code class="varname">DIST_SUBDIR</code>
	  to the name of the port (<code class="literal">${PORTNAME}</code> or
	  <code class="literal">${PKGNAMEPREFIX}${PORTNAME}</code>
	  should work fine).  This will change
	  <code class="varname">DISTDIR</code> from the default
	  <code class="filename">/usr/ports/distfiles</code> to
	  <code class="filename">/usr/ports/distfiles/DIST_SUBDIR</code>,
	  and in effect puts everything that is required for your port into
	  that subdirectory.</p><p>It will also look at the subdirectory with the same name on the
	  backup master site at <code class="filename">ftp.FreeBSD.org</code>.
	  (Setting <code class="varname">DISTDIR</code> explicitly in your
	  <code class="varname">Makefile</code> will not accomplish this, so please use
	  <code class="varname">DIST_SUBDIR</code>.)</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">This does not affect the <code class="varname">MASTER_SITES</code> you
	    define in your <code class="filename">Makefile</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67627856"></a>5.4.9. <code class="varname">ALWAYS_KEEP_DISTFILES</code></h3></div></div></div><p>If your port uses binary distfiles and has a license that
	  requires that the source code is provided with packages distributed
	  in binary form, e.g. GPL, <code class="varname">ALWAYS_KEEP_DISTFILES</code>
	  will instruct the FreeBSD build cluster to keep a copy of the files
	  specified in <code class="varname">DISTFILES</code>.  Users of these ports
	  will generally not need these files, so it is a good idea to only
	  add the source distfiles to <code class="varname">DISTFILES</code> when
	  <code class="varname">PACKAGE_BUILDING</code> is defined.
	</p><div class="example"><a id="ports-master-sites-n-example-always-keep-distfiles"></a><div class="example-title">範例 5.7. Use of <code class="varname">ALWAYS_KEEP_DISTFILES</code>.</div><div class="example-contents"><pre class="programlisting">.if defined(PACKAGE_BUILDING)
DISTFILES+=             <em class="replaceable"><code>foo.tar.gz</code></em>
ALWAYS_KEEP_DISTFILES=  yes
.endif</pre></div></div><br class="example-break" /><p>When adding extra files to <code class="varname">DISTFILES</code>,
	  make sure you also add them to <code class="filename">distinfo</code>.
	  Also, the additional files will normally be extracted into
	  <code class="varname">WRKDIR</code> as well, which for some ports may
	  lead to undesirable sideeffects and require special handling.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="makefile-categories.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="makefile.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="makefile-maintainer.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">5.3. Categorization </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 5.5. <code class="varname">MAINTAINER</code></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>