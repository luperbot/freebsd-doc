<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>18.3. 新增磁碟</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="disks.html" title="章 18. 儲存設備篇" /><link rel="prev" href="disks-naming.html" title="18.2. 裝置名稱" /><link rel="next" href="disks-growing.html" title="18.4. Resizing and Growing Disks" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">18.3. 新增磁碟</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="disks-naming.html">前一頁</a> </td><th width="60%" align="center">章 18. 儲存設備篇</th><td width="20%" align="right"> <a accesskey="n" href="disks-growing.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-adding"></a>18.3. 新增磁碟</h2></div><div><span class="authorgroup">Originally contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">David</span> <span class="surname">O'Brien</span></span>. </span></div></div></div><a id="idp80278992" class="indexterm"></a><p>假設我們想新增 SCSI 磁碟到一臺原先只有一顆磁碟的機器上，
      首先將電腦關機，依製造商的指示將磁碟裝上去，
      詳細的操作方式請參考製造商的說明文件。</p><p>安裝好磁碟後，用 <code class="systemitem">root</code> 登入系統，
      看一下 <code class="filename">/var/run/dmesg.boot</code> 以確認系統是否抓到新磁碟。
      繼續剛才的範例，新增的磁碟會是 <code class="filename">da1</code>，
      假設我們想將它掛載到 <code class="filename">/1</code> 這個位置
      (如果您新增的是 IDE 磁碟的話，請用 <code class="filename">ad1</code>)。</p><a id="idp80283088" class="indexterm"></a><a id="idp80283600" class="indexterm"></a><a id="idp80284112" class="indexterm"></a><p>FreeBSD 為了在 IBM-PC 相容電腦上執行，
      必須配合 PC BIOS partition，因此和傳統的 BSD partition 有很大的不同。
      在 PC 裡磁碟最多可以有四筆 BIOS partition 資訊(亦即最多可分割成四個
      partition)。如果這個磁碟打算全部讓 FreeBSD 使用，可選擇
      <span class="emphasis"><em>dedicated</em></span> 模式，
      不然的話 FreeBSD 必須置身於其中一個 PC BIOS partition 中。
      在 FreeBSD 裡，PC BIOS partition 稱為 <span class="emphasis"><em>slice</em></span>，
      這是為了不要和傳統的 BSD partition 搞混了。
      <a href="#ftn.idp80286032" class="footnote" id="idp80286032"><sup class="footnote">[13]</sup></a>
      不論是完全由 FreeBSD 使用的磁碟，還是安裝了其它作業系統的磁碟，
      您都可以使用 slice。這樣的好處是，其它非 FreeBSD 作業系統的
      <code class="command">fdisk</code> 工具可以順利操作。</p><p>如果使用 slice，這個新增的磁碟會是
      <code class="filename">/dev/da1s1e</code>。可以這樣來解讀它：SCSI 磁碟、
      unit number 1(第二個 SCSI 磁碟)、slice 1(第一個 PC BIOS partition)、
      及 <code class="filename">e</code> BSD partition。在 dedicated 模式的話，
      新磁碟則是 <code class="filename">/dev/da1e</code>。</p><p>因為 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a> 是用 32-bit 整數來儲存 sector(磁區) 數，
      因此限制一個磁碟最大只能有 2^32-1 個 sector，亦即 2TB 的空間。
      而 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fdisk&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">fdisk</span>(8)</span></a> 的格式容許起始 sector 編號不超過 2^32-1，
      長度也不超過 2^32-1，因此 partition 最大空間是 2TB，而磁碟最大是 4TB。
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sunlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sunlabel</span>(8)</span></a> 則限制 partition 最大是 2TB，磁碟最多可有 8 個
      partition，因此最大是 16TB。  如果要使用更大的磁碟，請使用
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gpt&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gpt</span>(8)</span></a>。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80296272"></a>18.3.1. 使用 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a></h3></div></div></div><a id="idp80297552" class="indexterm"></a><a id="idp80298832" class="indexterm"></a><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>操作 <span class="application">Sysinstall</span></strong></p><p>透過 <code class="command">sysinstall</code> 的選單介面，
	    可以輕易為磁碟分割 BIOS partition(slice) 和 BSD patition。
	    必須以 root 身份使用 <code class="command">sysinstall</code>，
	    要嘛用 root 登入，要嘛用 <code class="command">su</code> 切換到 root。
	    執行 <code class="command">sysinstall</code> 後，選
	    <code class="literal">Configure</code>，在
	    <code class="literal">FreeBSD Configuration Menu</code> 裡移到
	    <code class="literal">Fdisk</code> 選項。</p></li><li class="step"><p class="title"><strong><span class="application">fdisk</span> Partition 編輯器</strong></p><p>在 <span class="application">fdisk</span> 裡，按下
	    <strong class="userinput"><code>A</code></strong> 表示整個磁碟都給 FreeBSD 使用。
	    接著會提示您『是否要相容其它的作業系統』，回答
	    <code class="literal">YES</code>。  按 <strong class="userinput"><code>W</code></strong>
	    會將這些改變立即寫入磁碟，再按 <strong class="userinput"><code>q</code></strong> 可以離開
	    FDISK 編輯器。  接下來會問您要將 <span class="quote">“<span class="quote">Master Boot Record</span>”</span>
	    安裝於何處，由於現在是新增磁碟，表示作業系統已經裝在別的磁碟上了，
	    所以可以選 <code class="literal">None</code> 就行了。</p></li><li class="step"><p class="title"><strong>Disk Label Editor(磁碟 Label 編輯器)</strong></p><a id="idp80312912" class="indexterm"></a><p>接著請關閉 <span class="application">sysinstall</span>，再重開一次。
	    照著上一節的指示，不過這次改選 <code class="literal">Label</code>
	    進入 <code class="literal">Disk Label Editor</code>，在此您可以編輯傳統的
	    BSD partition。  一個磁碟(或著一個 slice) 最多可切分成 8 個
	    BSD partition，依序用 <code class="literal">a-h</code> 來表示。
	    有些字母有特別的意義，<code class="literal">a</code> partition 表示這是
	    root partition(根分割區，<code class="filename">/</code>)，
	    因此只有安裝系統的磁碟(例如用來開機的磁碟) 有
	    <code class="literal">a</code> partition。  <code class="literal">b</code> partition
	    表示這是 swap partitions(交換分割區)，每個磁碟上都可以有 swap。
	    <code class="literal">c</code> partition 用來表示整個磁碟(如果使用 dedicated
	    mode 的話)或整個 slice。  其它的字母則用來表示普通的 BSD partition
	    。</p><p><span class="application">sysinstall</span> 的
	    Label editor(磁碟 Label 編輯器) 偏好用 <code class="literal">e</code>
	    來表示非 root、也非 swap 的分割區
	    <a href="#ftn.idp80318672" class="footnote" id="idp80318672"><sup class="footnote">[14]</sup></a> 在 Label editor 裡，按 <strong class="userinput"><code>C</code></strong>
	    可以新增一個檔案系統(BSD label)，它會問您這是一個 FS(file system
	    ，檔案系統) 或是 swap(交換分割區)，選擇 <code class="literal">FS</code>
	    接著輸入要掛載的位置(例如 <code class="filename">/mnt</code>)。
	    如果系統安裝完後才新增磁碟，<span class="application">sysinstall</span>
	    不會幫您把這筆掛載資料加入 <code class="filename">/etc/fstab</code>，
	    所以掛載的位置不太重要。</p><p>當您準備好將新的 label 寫入磁碟、建立檔案系統，按
	    <strong class="userinput"><code>W</code></strong> 即可。如果出現在什麼錯誤，
	    <span class="application">sysinstall</span> 可能無法幫您掛載這個新分割區。
	    結束 Label Editor、結束 <span class="application">sysinstall</span>
	    就行了。</p></li><li class="step"><p class="title"><strong>完成</strong></p><p>最後要做的是編輯 <code class="filename">/etc/fstab</code>，
	    加入您新增的分割區資訊。</p></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80325840"></a>18.3.2. 使用命令列工具</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80326480"></a>18.3.2.1. 使用 Slices(BIOS partitions)</h4></div></div></div><p>這種模式能讓您的磁碟分割區與其它作業系統的
	  <code class="command">fdisk</code> 工具和平共處，因此我們建議您使用 slice 模式。
	  如果您一定要使用 <code class="literal">dedicated</code> 模式，
	  您得有個好理由！
	  <a href="#ftn.idp80328144" class="footnote" id="idp80328144"><sup class="footnote">[15]</sup></a></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/dev/da1 bs=1k count=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>fdisk -BI da1</code></strong> # 初始您的磁碟。
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -B -w -r da1s1 auto</code></strong> # 建立 bsdlabel。
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -e da1s1</code></strong> # 編輯 bsdlabel 以新增 label。
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/da1s1e</code></strong> # 如果您新增了多個 label，對每個 label 重覆這個步驟。
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/da1s1e /1</code></strong> # 掛載這些新 label。
<code class="prompt">#</code> <strong class="userinput"><code>vi /etc/fstab</code></strong> # 在 <code class="filename">/etc/fstab</code> 加入適當的資訊。</pre><p>如果您新增的是 IDE 磁碟，將 <code class="filename">da</code>
	  改成 <code class="filename">ad</code> 即可
	  <a href="#ftn.idp80340816" class="footnote" id="idp80340816"><sup class="footnote">[16]</sup></a>。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80341712"></a>18.3.2.2. Dedicated</h4></div></div></div><a id="idp80342352" class="indexterm"></a><p>如果您不打算將新磁碟用於其它的作業系統，
	  您可以使用 <code class="literal">dedicated</code> 模式。注意：
	  Microsoft 的作業系統認不得這個模式，不過也不會去破壞它；
	  然而 IBM 的 <span class="trademark">OS/2</span>® 就沒那麼好心了，它會去調整所有它不認得的分割區
	  <a href="#ftn.idp80352336" class="footnote" id="idp80352336"><sup class="footnote">[17]</sup></a>。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/dev/da1 bs=1k count=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -Brw da1 auto</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -e da1</code></strong>				# 建立 `e' partition。
<code class="prompt">#</code> <strong class="userinput"><code>newfs -d0 /dev/da1e</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>vi /etc/fstab</code></strong>				# 新增一筆 /dev/da1e 的資訊。
<code class="prompt">#</code> <strong class="userinput"><code>mount /1</code></strong></pre><p>另一種方法：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/dev/da1 count=2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel /dev/da1 | bsdlabel -BrR da1 /dev/stdin</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/da1e</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>vi /etc/fstab</code></strong>					# 新增一筆 /dev/da1e 的資訊。
<code class="prompt">#</code> <strong class="userinput"><code>mount /1</code></strong></pre></div></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp80286032" class="footnote"><p><a href="#idp80286032" class="para"><sup class="para">[13] </sup></a>譯註：基於相同的理由，
      現在 BSD partition 常稱為 BSD label，或簡稱 label。</p></div><div id="ftn.idp80318672" class="footnote"><p><a href="#idp80318672" class="para"><sup class="para">[14] </sup></a>譯註：老實說我看不懂這句指的是什麼？原文是
		<span class="application">sysinstall</span> Label editor
		favors the <code class="literal">e</code> partition for non-root,
		non-swap partitions. </p></div><div id="ftn.idp80328144" class="footnote"><p><a href="#idp80328144" class="para"><sup class="para">[15] </sup></a>譯註：如果您自始至終都不打算將這個磁碟用於 FreeBSD
	      之外的作業系統，那可以算是個好理由。不過就算如此，
	      用 slice 模式也沒什麼壞處就是了:-)。</p></div><div id="ftn.idp80340816" class="footnote"><p><a href="#idp80340816" class="para"><sup class="para">[16] </sup></a>譯註：da 是 direct access (disk) 的縮寫；
	      ad 是 ata disk 的縮寫。</p></div><div id="ftn.idp80352336" class="footnote"><p><a href="#idp80352336" class="para"><sup class="para">[17] </sup></a>譯註：我對這句的意思沒什麼信心，原文是 IBM's <span class="trademark">OS/2</span>® however,
	      will <span class="quote">“<span class="quote">appropriate</span>”</span> any partition it finds which it
	      does not understand.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="disks-naming.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="disks-growing.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">18.2. 裝置名稱 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 18.4. Resizing and Growing Disks</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>