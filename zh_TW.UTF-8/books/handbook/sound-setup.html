<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>8.2. 設定音效卡</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="multimedia.html" title="章 8. 多媒體影音娛樂(Multimedia)" /><link rel="prev" href="multimedia.html" title="章 8. 多媒體影音娛樂(Multimedia)" /><link rel="next" href="sound-mp3.html" title="8.3. MP3 音樂" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">8.2. 設定音效卡</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="multimedia.html">前一頁</a> </td><th width="60%" align="center">章 8. 多媒體影音娛樂(Multimedia)</th><td width="20%" align="right"> <a accesskey="n" href="sound-mp3.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="sound-setup"></a>8.2. 設定音效卡</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Moses</span> <span class="surname">Moore</span></span>. </span></div><div><span class="authorgroup">加強 FreeBSD 5.X 的內容：<span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-device"></a>8.2.1. 設定系統</h3></div></div></div><a id="idp72331600" class="indexterm"></a><a id="idp72340432" class="indexterm"></a><a id="idp72340944" class="indexterm"></a><p>開始設定之前，必須先知道你的音效卡型號、晶片為何，以及是 PCI 或 ISA 規格。
      FreeBSD 有支援許多種的 PCI、ISA 音效卡，請檢查支援的音效硬體表 <a class="link" href="http://www.FreeBSD.org/releases/10.1R/hardware.html" target="_top">Hardware Notes</a>，以確認你的音效卡是否支援。
      本文也會提到相對應該卡的驅動程式。</p><a id="idp72342352" class="indexterm"></a><p>要使用音效卡，必須要載入正確的驅動程式才行。有兩種方式都可以完成這動作，
      最簡單方式就是以 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a> 來輕鬆載入 kernel 動態模組(module)，
      像是下列指令：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_emu10k1</code></strong></pre><p>或者把相關驅動程式加到
      <code class="filename">/boot/loader.conf</code> 檔，像是：</p><pre class="programlisting">snd_emu10k1_load="YES"</pre><p>上面例子是給 Creative <span class="trademark">SoundBlaster</span>® Live! 音效卡使用的。
      其他可用的音效卡驅動程式模組，可參考
      <code class="filename">/boot/defaults/loader.conf</code> 範例。
      若不確定到底該用哪一種驅動程式，那麼可以試試載入 <code class="filename">snd_driver</code>
      模組看看：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_driver</code></strong></pre><p>This is a metadriver loading the most common device drivers
      at once.  This speeds up the search for the correct driver.  It
      is also possible to load all sound drivers via the
      <code class="filename">/boot/loader.conf</code> facility.</p><p>If you wish to find out the driver selected for your
      soundcard after loading the <code class="filename">snd_driver</code>
      metadriver, you may check the <code class="filename">/dev/sndstat</code>
      file with the <code class="command">cat /dev/sndstat</code>
      command.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">Under FreeBSD 4.X, to load all sound drivers, you have
	to load the <code class="filename">snd</code> module instead of
	<code class="filename">snd_driver</code>.</p></div><p>A second method is to statically
      compile in support for your sound card in your kernel.  The
      section below provides the information you need to add support
      for your hardware in this manner.  For more information about
      recompiling your kernel, please see <a class="xref" href="kernelconfig.html" title="章 9. 設定 FreeBSD Kernel">章 9, <em>設定 FreeBSD Kernel</em></a>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72354000"></a>8.2.1.1. Configuring a Custom Kernel with Sound Support</h4></div></div></div><p>The first thing to do is adding the generic audio driver
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sound&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">sound</span>(4)</span></a> to the kernel, for that you will need to
	add the following line to the kernel configuration file:</p><pre class="programlisting">device sound</pre><p>Under FreeBSD 4.X, you would use the following
	line:</p><pre class="programlisting">device pcm</pre><p>Then we have to add the support for our sound card.
	Therefore, we need to know which driver supports the card.
	Check the supported audio devices list of the <a class="link" href="http://www.FreeBSD.org/releases/10.1R/hardware.html" target="_top">Hardware Notes</a>, to
	determine the correct driver for your sound card.  For
	example, a Creative <span class="trademark">SoundBlaster</span>® Live! sound card is
	supported by the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_emu10k1&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_emu10k1</span>(4)</span></a> driver.  To add the support
	for this card, use the following:</p><pre class="programlisting">device snd_emu10k1</pre><p>Be sure to read the manual page of the driver for the
	syntax to use.  Information regarding the syntax of sound
	drivers in the kernel configuration can also be found in the
	<code class="filename">/usr/src/sys/conf/NOTES</code> file
	(<code class="filename">/usr/src/sys/i386/conf/LINT</code> for
	FreeBSD 4.X).</p><p>Non-PnP ISA cards may require you to provide the kernel
	with information on the sound card settings (IRQ, I/O port,
	etc).  This is done via the
	<code class="filename">/boot/device.hints</code> file.  At system boot,
	the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> will read this file and pass the settings
	to the kernel.  For example, an old
	Creative <span class="trademark">SoundBlaster</span>® 16 ISA non-PnP card will use the
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a> driver in conjunction with snd_sb16(4).  For this card the following lines have to be added to
	the kernel configuration file:</p><pre class="programlisting">device snd_sbc
device snd_sb16</pre><p>as well as the following in
	<code class="filename">/boot/device.hints</code>:</p><pre class="programlisting">hint.sbc.0.at="isa"
hint.sbc.0.port="0x220"
hint.sbc.0.irq="5"
hint.sbc.0.drq="1"
hint.sbc.0.flags="0x15"</pre><p>In this case, the card uses the <code class="literal">0x220</code>
	I/O port and the IRQ <code class="literal">5</code>.</p><p>The syntax used in the
	<code class="filename">/boot/device.hints</code> file is covered in the
	sound driver manual page.  On FreeBSD 4.X, these settings
	are directly written in the kernel configuration file.  In the
	case of our ISA card, we would only use this line:</p><pre class="programlisting">device sbc0 at isa? port 0x220 irq 5 drq 1 flags 0x15</pre><p>The settings shown above are the defaults.  In some
	cases, you may need to change the IRQ or the other settings to
	match your card.  See the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a> manual page for more
	information.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">Under FreeBSD 4.X, some systems with built-in
	  motherboard sound devices may require the following option in
	  the kernel configuration:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">options PNPBIOS</pre></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-testing"></a>8.2.2. Testing the Sound Card</h3></div></div></div><p>After rebooting with the modified kernel, or after loading
      the required module, the sound card should appear in your system
      message buffer (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a>) as something like:</p><pre class="screen">pcm0: &lt;Intel ICH3 (82801CA)&gt; port 0xdc80-0xdcbf,0xd800-0xd8ff irq 5 at device 31.5 on pci0
pcm0: [GIANT-LOCKED]
pcm0: &lt;Cirrus Logic CS4205 AC97 Codec&gt;</pre><p>The status of the sound card may be checked via the
      <code class="filename">/dev/sndstat</code> file:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat /dev/sndstat</code></strong>
FreeBSD Audio Driver (newpcm)
Installed devices:
pcm0: &lt;Intel ICH3 (82801CA)&gt; at io 0xd800, 0xdc80 irq 5 bufsz 16384
kld snd_ich (1p/2r/0v channels duplex default)</pre><p>The output from your system may vary.  If no
      <code class="filename">pcm</code> devices show up, go back and review
      what was done earlier.  Go through your kernel
      configuration file again and make sure the correct
      device is chosen.  Common problems are listed in <a class="xref" href="sound-setup.html#troubleshooting" title="8.2.2.1. Common Problems">節 8.2.2.1, “Common Problems”</a>.</p><p>If all goes well, you should now have a functioning sound
      card.  If your CD-ROM or DVD-ROM drive is properly coupled to
      your sound card, you can put a CD in the drive and play it
      with <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cdcontrol&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cdcontrol</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cdcontrol -f /dev/acd0 play 1</code></strong></pre><p>Various applications, such as <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/audio/workman/pkg-descr">audio/workman</a> can provide a friendlier
      interface.  You may want to install an application such as
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/audio/mpg123/pkg-descr">audio/mpg123</a> to listen to
      MP3 audio files.  A quick way to test the card is sending data
      to the <code class="filename">/dev/dsp</code>, like this:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cat filename &gt; /dev/dsp</code></strong></pre><p>where <em class="replaceable"><code>filename</code></em> can be any file.
      This command line should produce some noise, confirming the
      sound card is actually working.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD 4.X users need to create the sound card device
	nodes before being able to use it.  If the card showed up in
	message buffer as <code class="filename">pcm0</code>, you will have
	to run the following as <code class="systemitem">root</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /dev</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sh MAKEDEV snd0</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">If the card detection returned <code class="filename">pcm1</code>,
	follow the same steps as shown above, replacing
	<code class="filename">snd0</code> with
	<code class="filename">snd1</code>.</p><p xmlns="http://www.w3.org/1999/xhtml"><code class="command">MAKEDEV</code> will create a group of device
	nodes that will be used by the different sound related
	applications.</p></div><p>Sound card mixer levels can be changed via the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mixer&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mixer</span>(8)</span></a>
      command.  More details can be found in the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mixer&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mixer</span>(8)</span></a> manual
      page.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="troubleshooting"></a>8.2.2.1. Common Problems</h4></div></div></div><a id="idp72401744" class="indexterm"></a><a id="idp72402256" class="indexterm"></a><a id="idp72402768" class="indexterm"></a><a id="idp72403280" class="indexterm"></a><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Error</th><th>Solution</th></tr></thead><tbody><tr><td><span class="errorname">unsupported subdevice XX</span></td><td><p>One or more of the device nodes was not created
	        correctly.  Repeat the steps above.</p></td></tr><tr><td><span class="errorname">sb_dspwr(XX) timed out</span></td><td><p>The I/O port is not set correctly.</p></td></tr><tr><td><span class="errorname">bad irq XX</span></td><td><p>The IRQ is set incorrectly.  Make sure that
  	        the set IRQ and the sound IRQ are the same.</p></td></tr><tr><td><span class="errorname">xxx: gus pcm not attached, out of memory</span></td><td><p>There is not enough available memory to use
                the device.</p></td></tr><tr><td><span class="errorname">xxx: can't open /dev/dsp!</span></td><td><p>Check with <code class="command">fstat | grep dsp</code>
                if another application is holding the device open.
                Noteworthy troublemakers are <span class="application">esound</span> and <span class="application">KDE</span>'s sound
                support.</p></td></tr></tbody></table></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-multiple-sources"></a>8.2.3. Utilizing Multiple Sound Sources</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Munish</span> <span class="surname">Chopra</span></span>. </span></div></div></div><p>It is often desirable to have multiple sources of sound that
      are able to play simultaneously, such as when
      <span class="application">esound</span> or
      <span class="application">artsd</span> do not support sharing of the
      sound device with a certain application.</p><p>FreeBSD lets you do this through <span class="emphasis"><em>Virtual Sound
      Channels</em></span>, which can be set with the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
      facility.  Virtual channels allow you to multiplex your sound
      card's playback channels by mixing sound in the kernel.</p><p>To set the number of virtual channels, there are two sysctl
      knobs which, if you are the <code class="systemitem">root</code> user, can
      be set like this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.pcm0.vchans=4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.maxautovchans=4</code></strong></pre><p>The above example allocates four virtual channels, which is a
      practical number for everyday use.  <code class="varname">hw.snd.pcm0.vchans</code>
      is the number of virtual channels <code class="filename">pcm0</code> has, and is configurable
      once a device has been attached.
      <code class="literal">hw.snd.maxautovchans</code> is the number of virtual channels
      a new audio device is given when it is attached using
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>.  Since the <code class="filename">pcm</code> module
      can be loaded independently of the hardware drivers,
      <code class="varname">hw.snd.maxautovchans</code> can store how many
      virtual channels any devices which are attached later will be
      given.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">You cannot change the number of virtual channels for a
	device while it is in use.  First close any programs using the
	device, such as music players or sound daemons.</p></div><p>If you are not using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a>, you will have to point
      your applications at
      <code class="filename">/dev/dsp0</code>.<em class="replaceable"><code>x</code></em>,
      where <em class="replaceable"><code>x</code></em> is 0 to 3 if
      <code class="varname">hw.snd.pcm.0.vchans</code> is set to 4 as in the
      above example.  On a system using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a>, the above will
      automatically be allocated transparently to the user.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72443728"></a>8.2.4. 設定預設(Mixer Channel)的音量大小</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Josef</span> <span class="surname">El-Rayes</span></span>. </span></div></div></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">本功能只有在 FreeBSD 5.3-RELEASE 及之後版本才有支援。</p></div><p>The default values for the different mixer channels are
      hardcoded in the sourcecode of the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> driver.  There are
      a lot of different applications and daemons that allow
      you to set values for the mixer they remember and set
      each time they are started, but this is not a clean
      solution, we want to have default values at the driver
      level.  This is accomplished by defining the appropriate
      values in <code class="filename">/boot/device.hints</code>. E.g.:</p><pre class="programlisting">hint.pcm.0.vol="100"</pre><p>This will set the volume channel to a default value of
      100, when the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> module is loaded.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="multimedia.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="multimedia.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="sound-mp3.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">章 8. 多媒體影音娛樂(Multimedia) </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 8.3. MP3 音樂</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>