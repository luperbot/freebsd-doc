<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>12.15. Using and Debugging FreeBSD ACPI</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="config-tuning.html" title="章 12. 設定與效能調校(Tuning)" /><link rel="prev" href="acpi-overview.html" title="12.14. Power and Resource Management" /><link rel="next" href="boot.html" title="章 13. FreeBSD 開機流程篇" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">12.15. Using and Debugging FreeBSD <acronym class="acronym">ACPI</acronym></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="acpi-overview.html">前一頁</a> </td><th width="60%" align="center">章 12. 設定與效能調校(Tuning)</th><td width="20%" align="right"> <a accesskey="n" href="boot.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ACPI-debug"></a>12.15. Using and Debugging FreeBSD <acronym class="acronym">ACPI</acronym></h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Nate</span> <span class="surname">Lawson</span></span>. </span></div><div><span class="authorgroup">With contributions from <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Peter</span> <span class="surname">Schultz</span></span> 且 <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp77133264" class="indexterm"></a><p><acronym class="acronym">ACPI</acronym> is a fundamentally new way of
      discovering devices, managing power usage, and providing
      standardized access to various hardware previously managed
      by the <acronym class="acronym">BIOS</acronym>.  Progress is being made toward
      <acronym class="acronym">ACPI</acronym> working on all systems, but bugs in some
      motherboards' <em class="firstterm"><acronym class="acronym">ACPI</acronym> Machine
      Language</em> (<acronym class="acronym">AML</acronym>) bytecode,
      incompleteness in FreeBSD's kernel subsystems, and bugs in the <span class="trademark">Intel</span>®
      <acronym class="acronym">ACPI-CA</acronym> interpreter continue to appear.</p><p>This document is intended to help you assist the FreeBSD
      <acronym class="acronym">ACPI</acronym> maintainers in identifying the root cause
      of problems you observe and debugging and developing a solution.
      Thanks for reading this and we hope we can solve your system's
      problems.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-submitdebug"></a>12.15.1. Submitting Debugging Information</h3></div></div></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">Before submitting a problem, be sure you are running the latest
	  <acronym class="acronym">BIOS</acronym> version and, if available, embedded
	  controller firmware version.</p></div><p>For those of you that want to submit a problem right away,
	please send the following information to
	<a class="link" href="mailto:freebsd-acpi@FreeBSD.org" target="_top">
	freebsd-acpi@FreeBSD.org</a>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Description of the buggy behavior, including system type
	    and model and anything that causes the bug to appear.  Also,
	    please note as accurately as possible when the bug began
	    occurring if it is new for you.</p></li><li class="listitem"><p>The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> output after <code class="command">boot
	    -v</code>, including any error messages
	    generated by you exercising the bug.</p></li><li class="listitem"><p>The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> output from <code class="command">boot
	    -v</code> with <acronym class="acronym">ACPI</acronym>
	    disabled, if disabling it helps fix the problem.</p></li><li class="listitem"><p>Output from <code class="command">sysctl hw.acpi</code>.  This is also
	    a good way of figuring out what features your system
	    offers.</p></li><li class="listitem"><p><acronym class="acronym">URL</acronym> where your
	    <em class="firstterm"><acronym class="acronym">ACPI</acronym> Source Language</em>
	    (<acronym class="acronym">ASL</acronym>)
	    can be found.  Do <span class="emphasis"><em>not</em></span> send the
	    <acronym class="acronym">ASL</acronym> directly to the list as it can be
	    very large.  Generate a copy of your <acronym class="acronym">ASL</acronym>
	    by running this command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>acpidump -t -d &gt; name-system.asl</code></strong></pre><p>(Substitute your login name for
	    <em class="replaceable"><code>name</code></em> and manufacturer/model for
	    <em class="replaceable"><code>system</code></em>.  Example:
	    <code class="filename">njl-FooCo6000.asl</code>)</p></li></ul></div><p>Most of the developers watch the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">FreeBSD-CURRENT 郵遞論壇</a>
        but please submit problems to <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a> to be sure it is
	seen.  Please be patient, all of us have full-time jobs
	elsewhere.  If your bug is not immediately apparent, we will
	probably ask you to submit a <acronym class="acronym">PR</acronym> via
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=send-pr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">send-pr</span>(1)</span></a>.  When entering a <acronym class="acronym">PR</acronym>, please
	include the same information as requested above.  This will help
	us track the problem and resolve it.  Do not send a
	<acronym class="acronym">PR</acronym> without emailing <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a> first as we use
	<acronym class="acronym">PR</acronym>s as reminders of existing problems, not a
	reporting mechanism.  It is likely that your problem has been
	reported by someone before.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-background"></a>12.15.2. Background</h3></div></div></div><a id="idp77167184" class="indexterm"></a><p><acronym class="acronym">ACPI</acronym> is present in all modern computers
	that conform to the ia32 (x86), ia64 (Itanium), and amd64 (AMD)
	architectures.  The full standard has many features including
	<acronym class="acronym">CPU</acronym> performance management, power planes
	control, thermal zones, various battery systems, embedded
	controllers, and bus enumeration.  Most systems implement less
	than the full standard.  For instance, a desktop system usually
	only implements the bus enumeration parts while a laptop might
	have cooling and battery management support as well.  Laptops
	also have suspend and resume, with their own associated
	complexity.</p><p>An <acronym class="acronym">ACPI</acronym>-compliant system has various
	components.  The <acronym class="acronym">BIOS</acronym> and chipset vendors
	provide various fixed tables (e.g., <acronym class="acronym">FADT</acronym>)
	in memory that specify things like the <acronym class="acronym">APIC</acronym>
	map (used for <acronym class="acronym">SMP</acronym>), config registers, and
	simple configuration values.  Additionally, a table of bytecode
	(the <em class="firstterm">Differentiated System Description Table</em>
	<acronym class="acronym">DSDT</acronym>) is provided that specifies a
	tree-like name space of devices and methods.</p><p>The <acronym class="acronym">ACPI</acronym> driver must parse the fixed
	tables, implement an interpreter for the bytecode, and modify
	device drivers and the kernel to accept information from the
	<acronym class="acronym">ACPI</acronym> subsystem.  For FreeBSD, <span class="trademark">Intel</span>® has
	provided an interpreter (<acronym class="acronym">ACPI-CA</acronym>) that is
	shared with Linux and NetBSD.  The path to the
	<acronym class="acronym">ACPI-CA</acronym> source code is
	<code class="filename">src/sys/contrib/dev/acpica</code>.
	The glue code that allows <acronym class="acronym">ACPI-CA</acronym> to work on
	FreeBSD is in
	<code class="filename">src/sys/dev/acpica/Osd</code>.  Finally, drivers
	that implement various <acronym class="acronym">ACPI</acronym> devices are found
	in
	<code class="filename">src/sys/dev/acpica</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-comprob"></a>12.15.3. Common Problems</h3></div></div></div><a id="idp77177552" class="indexterm"></a><p>For <acronym class="acronym">ACPI</acronym> to work correctly, all the parts
	have to work correctly.  Here are some common problems, in order
	of frequency of appearance, and some possible workarounds or
	fixes.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77179472"></a>12.15.3.1. Mouse Issues</h4></div></div></div><p>In some cases, resuming from a suspend operation will
	  cause the mouse to fail.  A known work around is to add
	  <code class="literal">hint.psm.0.flags="0x3000"</code> to the
	  <code class="filename">/boot/loader.conf</code> file.  If this
	  does not work then please consider sending a bug report
	  as described above.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77181520"></a>12.15.3.2. Suspend/Resume</h4></div></div></div><p><acronym class="acronym">ACPI</acronym> has three suspend to
	  <acronym class="acronym">RAM</acronym> (<acronym class="acronym">STR</acronym>) states,
	  <code class="literal">S1</code>-<code class="literal">S3</code>, and one suspend
	  to disk state (<code class="literal">STD</code>), called
	  <code class="literal">S4</code>.  <code class="literal">S5</code> is
	  <span class="quote">“<span class="quote">soft off</span>”</span> and is the normal state your system
	  is in when plugged in but not powered up.
	  <code class="literal">S4</code> can actually be implemented two separate
	  ways.  <code class="literal">S4</code><acronym class="acronym">BIOS</acronym> is a
	  <acronym class="acronym">BIOS</acronym>-assisted suspend to disk.
	  <code class="literal">S4</code><acronym class="acronym">OS</acronym> is implemented
	  entirely by the operating system.</p><p>Start by checking <code class="command">sysctl hw.acpi</code>
	  for the suspend-related items.  Here
	  are the results for a Thinkpad:</p><pre class="screen">hw.acpi.supported_sleep_state: S3 S4 S5
hw.acpi.s4bios: 0</pre><p>This means that we can use <code class="command">acpiconf -s</code>
	  to test <code class="literal">S3</code>,
	  <code class="literal">S4</code><acronym class="acronym">OS</acronym>, and
	  <code class="literal">S5</code>.  If <code class="option">s4bios</code> was one
	  (<code class="literal">1</code>), we would have
	  <code class="literal">S4</code><acronym class="acronym">BIOS</acronym>
	  support instead of <code class="literal">S4</code>
	  <acronym class="acronym">OS</acronym>.</p><p>When testing suspend/resume, start with
	  <code class="literal">S1</code>, if supported.  This state is most
	  likely to work since it does not require much driver support.
	  No one has implemented <code class="literal">S2</code> but if you have
	  it, it is similar to <code class="literal">S1</code>.  The next thing
	  to try is <code class="literal">S3</code>.  This is the deepest
	  <acronym class="acronym">STR</acronym> state and requires a lot of driver
	  support to properly reinitialize your hardware.  If you have
	  problems resuming, feel free to email the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a> list but
	  do not expect the problem to be resolved since there are a lot
	  of drivers/hardware that need more testing and work.</p><p>To help isolate the problem, remove as many drivers from
	  your kernel as possible.  If it works, you can narrow down
	  which driver is the problem by loading drivers until it fails
	  again.  Typically binary drivers like
	  <code class="filename">nvidia.ko</code>, X11
	  display drivers, and <acronym class="acronym">USB</acronym> will have the most
	  problems while Ethernet interfaces usually work fine.  If you
	  can properly load/unload the drivers, you can automate this by
	  putting the appropriate commands in
	  <code class="filename">/etc/rc.suspend</code> and
	  <code class="filename">/etc/rc.resume</code>.  There is a
	  commented-out example for unloading and loading a driver.  Try
	  setting <code class="option">hw.acpi.reset_video</code> to zero (<code class="literal">0</code>) if
	  your display is messed up after resume.  Try setting longer or
	  shorter values for <code class="option">hw.acpi.sleep_delay</code> to see
	  if that helps.</p><p>Another thing to try is load a recent Linux distribution
	  with <acronym class="acronym">ACPI</acronym> support and test their
	  suspend/resume support on the same hardware.  If it works
	  on Linux, it is likely a FreeBSD driver problem and narrowing down
	  which driver causes the problems will help us fix the problem.
	  Note that the <acronym class="acronym">ACPI</acronym> maintainers do not
	  usually maintain other drivers (e.g sound,
	  <acronym class="acronym">ATA</acronym>, etc.) so any work done on tracking
	  down a driver problem should probably eventually be posted
	  to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">freebsd-current</a> list and mailed to the driver
	  maintainer.  If you are feeling adventurous, go ahead and
	  start putting some debugging <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=printf&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">printf</span>(3)</span></a>s in a problematic
	  driver to track down where in its resume function it
	  hangs.</p><p>Finally, try disabling <acronym class="acronym">ACPI</acronym> and
	  enabling <acronym class="acronym">APM</acronym> instead.  If suspend/resume
	  works with <acronym class="acronym">APM</acronym>, you may be better off
	  sticking with <acronym class="acronym">APM</acronym>, especially on older
	  hardware (pre-2000).  It took vendors a while to get
	  <acronym class="acronym">ACPI</acronym> support correct and older hardware is
	  more likely to have <acronym class="acronym">BIOS</acronym> problems with
	  <acronym class="acronym">ACPI</acronym>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77214160"></a>12.15.3.3. System Hangs (temporary or permanent)</h4></div></div></div><p>Most system hangs are a result of lost interrupts or an
	  interrupt storm.  Chipsets have a lot of problems based on how
	  the <acronym class="acronym">BIOS</acronym> configures interrupts before boot,
	  correctness of the <acronym class="acronym">APIC</acronym>
	  (<acronym class="acronym">MADT</acronym>) table, and routing of the
	  <em class="firstterm">System Control Interrupt</em>
	  (<acronym class="acronym">SCI</acronym>).</p><a id="idp77217104" class="indexterm"></a><p>Interrupt storms can be distinguished from lost interrupts
	  by checking the output of <code class="command">vmstat -i</code>
	  and looking at the line that has
	  <code class="literal">acpi0</code>.  If the counter is increasing at more
	  than a couple per second, you have an interrupt storm.  If the
	  system appears hung, try breaking to <acronym class="acronym">DDB</acronym>
	  (<span class="keycap"><strong>CTRL</strong></span>+<span class="keycap"><strong>ALT</strong></span>+<span class="keycap"><strong>ESC</strong></span> on
	  console) and type <code class="literal">show interrupts</code>.</p><a id="idp77245776" class="indexterm"></a><p>Your best hope when dealing with interrupt problems is to
	  try disabling <acronym class="acronym">APIC</acronym> support with
	  <code class="literal">hint.apic.0.disabled="1"</code> in
	  <code class="filename">loader.conf</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77248592"></a>12.15.3.4. Panics</h4></div></div></div><p>Panics are relatively rare for <acronym class="acronym">ACPI</acronym> and
	  are the top priority to be fixed.  The first step is to
	  isolate the steps to reproduce the panic (if possible)
	  and get a backtrace.  Follow the advice for enabling
	  <code class="literal">options DDB</code> and setting up a serial console
	  (see <a class="xref" href="serialconsole-setup.html#serialconsole-ddb" title="26.6.5.3. Entering the DDB Debugger from the Serial Line">節 26.6.5.3, “Entering the DDB Debugger from the Serial Line”</a>)
	  or setting up a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> partition.  You can get a
	  backtrace in <acronym class="acronym">DDB</acronym> with
	  <code class="literal">tr</code>.  If you have to handwrite the
	  backtrace, be sure to at least get the lowest five (5) and top
	  five (5) lines in the trace.</p><p>Then, try to isolate the problem by booting with
	  <acronym class="acronym">ACPI</acronym> disabled.  If that works, you can
	  isolate the <acronym class="acronym">ACPI</acronym> subsystem by using various
	  values of <code class="option">debug.acpi.disable</code>.  See the
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a> manual page for some examples.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77258960"></a>12.15.3.5. System Powers Up After Suspend or Shutdown</h4></div></div></div><p>First, try setting
	  <code class="literal">hw.acpi.disable_on_poweroff="0"</code>
	  in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a>.  This keeps <acronym class="acronym">ACPI</acronym>
	  from disabling various events during the shutdown process.
	  Some systems need this value set to <code class="literal">1</code> (the
	  default) for the same reason.  This usually fixes
	  the problem of a system powering up spontaneously after a
	  suspend or poweroff.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77262032"></a>12.15.3.6. Other Problems</h4></div></div></div><p>If you have other problems with <acronym class="acronym">ACPI</acronym>
	  (working with a docking station, devices not detected, etc.),
	  please email a description to the mailing list as well;
	  however, some of these issues may be related to unfinished
	  parts of the <acronym class="acronym">ACPI</acronym> subsystem so they might
	  take a while to be implemented.  Please be patient and
	  prepared to test patches we may send you.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-aslanddump"></a>12.15.4. <acronym class="acronym">ASL</acronym>, <code class="command">acpidump</code>, and
        <acronym class="acronym">IASL</acronym></h3></div></div></div><a id="idp77270096" class="indexterm"></a><p>The most common problem is the <acronym class="acronym">BIOS</acronym>
	vendors providing incorrect (or outright buggy!) bytecode.  This
	is usually manifested by kernel console messages like
	this:</p><pre class="screen">ACPI-1287: *** Error: Method execution failed [\\_SB_.PCI0.LPC0.FIGD._STA] \\
(Node 0xc3f6d160), AE_NOT_FOUND</pre><p>Often, you can resolve these problems by updating your
	<acronym class="acronym">BIOS</acronym> to the latest revision.  Most console
	messages are harmless but if you have other problems like
	battery status not working, they are a good place to start
	looking for problems in the <acronym class="acronym">AML</acronym>.  The
	bytecode, known as <acronym class="acronym">AML</acronym>, is compiled from a
	source language called <acronym class="acronym">ASL</acronym>.  The
	<acronym class="acronym">AML</acronym> is found in the table known as the
	<acronym class="acronym">DSDT</acronym>.  To get a copy of your
	<acronym class="acronym">ASL</acronym>, use <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpidump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">acpidump</span>(8)</span></a>.  You should use
	both the <code class="option">-t</code> (show contents of the fixed tables)
	and <code class="option">-d</code> (disassemble <acronym class="acronym">AML</acronym> to
	<acronym class="acronym">ASL</acronym>) options.  See the
	<a class="link" href="ACPI-debug.html#ACPI-submitdebug" title="12.15.1. Submitting Debugging Information">Submitting Debugging
	Information</a> section for an example syntax.</p><p>The simplest first check you can do is to recompile your
	<acronym class="acronym">ASL</acronym> to check for errors.  Warnings can
	usually be ignored but errors are bugs that will usually prevent
	<acronym class="acronym">ACPI</acronym> from working correctly.  To recompile
	your <acronym class="acronym">ASL</acronym>, issue the following command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>iasl your.asl</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-fixasl"></a>12.15.5. Fixing Your <acronym class="acronym">ASL</acronym></h3></div></div></div><a id="idp77286096" class="indexterm"></a><p>In the long run, our goal is for almost everyone to have
	<acronym class="acronym">ACPI</acronym> work without any user intervention.  At
	this point, however, we are still developing workarounds for
	common mistakes made by the <acronym class="acronym">BIOS</acronym> vendors.
	The <span class="trademark">Microsoft</span>® interpreter (<code class="filename">acpi.sys</code> and
	<code class="filename">acpiec.sys</code>) does not strictly check for
	adherence to the standard, and thus many <acronym class="acronym">BIOS</acronym>
	vendors who only test <acronym class="acronym">ACPI</acronym> under <span class="trademark">Windows</span>®
	never fix their <acronym class="acronym">ASL</acronym>.  We hope to continue to
	identify and document exactly what non-standard behavior is
	allowed by <span class="trademark">Microsoft</span>®'s interpreter and replicate it so FreeBSD can
	work without forcing users to fix the <acronym class="acronym">ASL</acronym>.
	As a workaround and to help us identify behavior, you can fix
	the <acronym class="acronym">ASL</acronym> manually.  If this works for you,
	please send a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> of the old and new
	<acronym class="acronym">ASL</acronym> so we can possibly work around the buggy
	behavior in <acronym class="acronym">ACPI-CA</acronym> and thus make your fix
	unnecessary.</p><a id="idp77298384" class="indexterm"></a><p>Here is a list of common error messages, their cause, and
	how to fix them:</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77299920"></a>12.15.5.1. _OS dependencies</h4></div></div></div><p>Some <acronym class="acronym">AML</acronym> assumes the world consists of
	  various <span class="trademark">Windows</span>® versions.  You can tell FreeBSD to claim it is
	  any <acronym class="acronym">OS</acronym> to see if this fixes problems you
	  may have.  An easy way to override this is to set
	  <code class="literal">hw.acpi.osname="Windows 2001"</code>
	  in <code class="filename">/boot/loader.conf</code> or other similar
	  strings you find in the <acronym class="acronym">ASL</acronym>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77307728"></a>12.15.5.2. Missing Return statements</h4></div></div></div><p>Some methods do not explicitly return a value as the
	  standard requires.  While <acronym class="acronym">ACPI-CA</acronym>
	  does not handle this, FreeBSD has a workaround that allows it to
	  return the value implicitly.  You can also add explicit
	  Return statements where required if you know what value should
	  be returned.  To force <code class="command">iasl</code> to compile the
	  <acronym class="acronym">ASL</acronym>, use the <code class="option">-f</code>
	  flag.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77310416"></a>12.15.5.3. Overriding the Default <acronym class="acronym">AML</acronym></h4></div></div></div><p>After you customize <code class="filename">your.asl</code>, you
	  will want to compile it, run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>iasl your.asl</code></strong></pre><p>You can add the <code class="option">-f</code> flag to force creation
	  of the <acronym class="acronym">AML</acronym>, even if there are errors during
	  compilation.  Remember that some errors (e.g., missing Return
	  statements) are automatically worked around by the
	  interpreter.</p><p><code class="filename">DSDT.aml</code> is the default output
	  filename for <code class="command">iasl</code>.  You can load this
	  instead of your <acronym class="acronym">BIOS</acronym>'s buggy copy (which
	  is still present in flash memory) by editing
	  <code class="filename">/boot/loader.conf</code> as
	  follows:</p><pre class="programlisting">acpi_dsdt_load="YES"
acpi_dsdt_name="/boot/DSDT.aml"</pre><p>Be sure to copy your <code class="filename">DSDT.aml</code> to the
	  <code class="filename">/boot</code> directory.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-debugoutput"></a>12.15.6. Getting Debugging Output From
	<acronym class="acronym">ACPI</acronym></h3></div></div></div><a id="idp77318864" class="indexterm"></a><a id="idp77320016" class="indexterm"></a><p>The <acronym class="acronym">ACPI</acronym> driver has a very flexible
	debugging facility.  It allows you to specify a set of subsystems
	as well as the level of verbosity.  The subsystems you wish to
	debug are specified as <span class="quote">“<span class="quote">layers</span>”</span> and are broken down
	into <acronym class="acronym">ACPI-CA</acronym> components (ACPI_ALL_COMPONENTS)
	and <acronym class="acronym">ACPI</acronym> hardware support (ACPI_ALL_DRIVERS).
	The verbosity of debugging output is specified as the
	<span class="quote">“<span class="quote">level</span>”</span> and ranges from ACPI_LV_ERROR (just report
	errors) to ACPI_LV_VERBOSE (everything).  The
	<span class="quote">“<span class="quote">level</span>”</span> is a bitmask so multiple options can be set
	at once, separated by spaces.  In practice, you will want to use
	a serial console to log the output if it is so long
	it flushes the console message buffer.  A full list of the
	individual layers and levels is found in the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a> manual
	page.</p><p>Debugging output is not enabled by default.  To enable it,
	add <code class="literal">options ACPI_DEBUG</code> to your kernel configuration file
	if <acronym class="acronym">ACPI</acronym> is compiled into the kernel.  You can
	add <code class="literal">ACPI_DEBUG=1</code> to your
	<code class="filename">/etc/make.conf</code> to enable it globally.  If
	it is a module, you can recompile just your
	<code class="filename">acpi.ko</code> module as follows:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /sys/modules/acpi/acpi
&amp;&amp; make clean &amp;&amp;
make ACPI_DEBUG=1</code></strong></pre><p>Install <code class="filename">acpi.ko</code> in
	<code class="filename">/boot/kernel</code> and add your
	desired level and layer to <code class="filename">loader.conf</code>.
	This example enables debug messages for all
	<acronym class="acronym">ACPI-CA</acronym> components and all
	<acronym class="acronym">ACPI</acronym> hardware drivers
	(<acronym class="acronym">CPU</acronym>, <acronym class="acronym">LID</acronym>, etc.)  It will
	only output error messages, the least verbose level.</p><pre class="programlisting">debug.acpi.layer="ACPI_ALL_COMPONENTS ACPI_ALL_DRIVERS"
debug.acpi.level="ACPI_LV_ERROR"</pre><p>If the information you want is triggered by a specific event
	(say, a suspend and then resume), you can leave out changes to
	<code class="filename">loader.conf</code> and instead use
	<code class="command">sysctl</code> to specify the layer and level after
	booting and preparing your system for the specific event.  The
	<code class="command">sysctl</code>s are named the same as the tunables
	in <code class="filename">loader.conf</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-References"></a>12.15.7. References</h3></div></div></div><p>More information about <acronym class="acronym">ACPI</acronym> may be found
	in the following locations:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">FreeBSD ACPI 郵遞論壇</a></p></li><li class="listitem"><p>The <acronym class="acronym">ACPI</acronym> Mailing List Archives
	    <code class="uri"><a class="uri" href="http://lists.freebsd.org/pipermail/freebsd-acpi/" target="_top">http://lists.freebsd.org/pipermail/freebsd-acpi/</a></code></p></li><li class="listitem"><p>The old <acronym class="acronym">ACPI</acronym> Mailing List Archives
            <code class="uri"><a class="uri" href="http://home.jp.FreeBSD.org/mail-list/acpi-jp/" target="_top">http://home.jp.FreeBSD.org/mail-list/acpi-jp/</a></code></p></li><li class="listitem"><p>The <acronym class="acronym">ACPI</acronym> 2.0 Specification
	    <code class="uri"><a class="uri" href="http://acpi.info/spec.htm" target="_top">http://acpi.info/spec.htm</a></code></p></li><li class="listitem"><p>FreeBSD Manual pages: <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a>,
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi_thermal&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi_thermal</span>(4)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpidump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">acpidump</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=iasl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">iasl</span>(8)</span></a>,
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpidb&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">acpidb</span>(8)</span></a></p></li><li class="listitem"><p><a class="link" href="http://www.cpqlinux.com/acpi-howto.html#fix_broken_dsdt" target="_top">
	    <acronym class="acronym">DSDT</acronym> debugging resource</a>.
	    (Uses Compaq as an example but generally useful.)</p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="acpi-overview.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="config-tuning.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="boot.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">12.14. Power and Resource Management </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 章 13. FreeBSD 開機流程篇</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>