<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>5.5. 使用 Ports 管理機制</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="ports.html" title="章 5. 軟體套件管理篇：Packages 及 Ports 機制" /><link rel="prev" href="pkgng-intro.html" title="5.4. Using pkg for Binary Package Management" /><link rel="next" href="ports-nextsteps.html" title="5.6. 安裝之後，有什麼後續注意事項嗎？" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.5. 使用 Ports 管理機制</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="pkgng-intro.html">前一頁</a> </td><th width="60%" align="center">章 5. 軟體套件管理篇：Packages 及 Ports 機制</th><td width="20%" align="right"> <a accesskey="n" href="ports-nextsteps.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports-using"></a>5.5. 使用 Ports 管理機制</h2></div></div></div><p>The Ports Collection is a set of
      <code class="filename">Makefiles</code>, patches, and description files
      stored in <code class="filename">/usr/ports</code>.  This set of files is
      used to compile and install applications on FreeBSD.  Before an
      application can be compiled using a port, the Ports Collection
      must first be installed.  If it was not installed during the
      installation of FreeBSD, use one of the following methods to
      install it:</p><div class="procedure"><a id="ports-using-portsnap-method"></a><div class="procedure-title">過程 5.1. Portsnap 方式</div><p>The base system of FreeBSD includes
	<span class="application">Portsnap</span>.  This is a fast and
	user-friendly tool for retrieving the Ports Collection and
	is the recommended choice for most users.  This utility
	connects to a FreeBSD site, verifies the secure key, and
	downloads a new copy of the Ports Collection.  The key is used
	to verify the integrity of all downloaded files.</p><ol class="procedure" type="1"><li class="step"><p>To download a compressed snapshot of the Ports
	  Collection into
	  <code class="filename">/var/db/portsnap</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch</code></strong></pre></li><li class="step"><p>若是第一次跑 <span class="application">Portsnap</span> 的話，
	  則需要先解壓到 <code class="filename">/usr/ports</code>：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap extract</code></strong></pre></li><li class="step"><p>After the first use of
	  <span class="application">Portsnap</span> has been completed as
	  shown above, <code class="filename">/usr/ports</code> can be updated
	  as needed by running:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>portsnap update</code></strong></pre><p>When using <code class="literal">fetch</code>, the
	  <code class="literal">extract</code> or the <code class="literal">update</code>
	  operation may be run consecutively, like so:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch update</code></strong></pre></li></ol></div><div class="procedure"><a id="ports-using-subversion-method"></a><div class="procedure-title">過程 5.2. Subversion Method</div><p>If more control over the ports tree is needed or if local
	changes need to be maintained,
	<span class="application">Subversion</span> can be used to obtain
	the Ports Collection.  Refer to <a class="link" href="../../../../doc/zh_TW.UTF-8/articles/committers-guide/subversion-primer.html" target="_top">the
	  Subversion Primer</a> for a detailed description of
	<span class="application">Subversion</span>.</p><ol class="procedure" type="1"><li class="step"><p><span class="application">Subversion</span> must be installed
	  before it can be used to check out the ports tree.  If a
	  copy of the ports tree is already present, install
	  <span class="application">Subversion</span> like this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/devel/subversion</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>If the ports tree is not available, or
	  <span class="application">pkg</span> is being used to manage
	  packages, <span class="application">Subversion</span> can be
	  installed as a package:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install subversion</code></strong></pre></li><li class="step"><p>Check out a copy of the ports tree.  For better
	  performance, replace
	  <em class="replaceable"><code>svn0.us-east.FreeBSD.org</code></em> with a
	  <a class="link" href="svn.html#svn-mirrors" title="A.4.4. Subversion Mirror Sites">Subversion
	    mirror</a> close to your geographic location:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>svn checkout https://<em class="replaceable"><code>svn0.us-east.FreeBSD.org</code></em>/ports/head /usr/ports</code></strong></pre></li><li class="step"><p>As needed, update <code class="filename">/usr/ports</code> after
	  the initial <span class="application">Subversion</span>
	  checkout:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>svn update /usr/ports</code></strong></pre></li></ol></div><p>The Ports Collection installs a series of directories
      representing software categories with each category having
      a subdirectory for each application.  Each subdirectory, also
      referred to as a ports skeleton, contains a set of files that
      tell FreeBSD how to compile and install that program.  Each port
      skeleton includes these files and directories:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">Makefile</code>: contains statements that
	  specify how the application should be compiled and where
	  its components should be installed.</p></li><li class="listitem"><p><code class="filename">distinfo</code>: contains the names and
	  checksums of the files that must be downloaded to build the
	  port.</p></li><li class="listitem"><p><code class="filename">files/</code>: this directory contains
	  any patches needed for the program to compile and install
	  on FreeBSD.  This directory may also contain other files used
	  to build the port.</p></li><li class="listitem"><p><code class="filename">pkg-descr</code>: provides a more detailed
	  description of the program.</p></li><li class="listitem"><p><code class="filename">pkg-plist</code>:  a list of all the
	  files that will be installed by the port.  It also tells
	  the ports system which files to remove upon
	  deinstallation.</p></li></ul></div><p>Some ports include <code class="filename">pkg-message</code> or
      other files to handle special situations.  For more details
      on these files, and on ports in general, refer to the <a class="link" href="../../../../doc/zh_TW.UTF-8/books/porters-handbook/index.html" target="_top">FreeBSD
	Porter's Handbook</a>.</p><p>The port does not include the actual source code, also
      known as a <code class="filename">distfile</code>.  The extract portion
      of building a port will automatically save the downloaded
      source to <code class="filename">/usr/ports/distfiles</code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-skeleton"></a>5.5.1. Ports 的安裝方式</h3></div></div></div><a id="idp70954192" class="indexterm"></a><p>下面我們會介紹如何使用 Ports Collection 來安裝、移除軟體的基本用法。
      至於其他可用的 <code class="command">make</code> 詳細用法與環境設定，可參閱
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ports&amp;sektion=7"><span class="citerefentry"><span class="refentrytitle">ports</span>(7)</span></a>。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">Before compiling any port, be sure to update the Ports
	  Collection as described in the previous section.  Since
	  the installation of any third-party software can introduce
	  security vulnerabilities, it is recommended to first check
	  <code class="uri"><a class="uri" href="http://vuxml.freebsd.org/" target="_top">http://vuxml.freebsd.org/</a></code>
	  for known security issues related to the port.  Alternately,
	  if <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portaudit/pkg-descr">ports-mgmt/portaudit</a> is installed, run
	  <code class="command">portaudit -F</code> before installing a new
	  port.  This command can be configured to automatically
	  perform a security audit and an update of the vulnerability
	  database during the daily security system check.  For more
	  information, refer to the manual page for
	  <span class="application">portaudit</span> and
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a>.</p></div><p>提到 Ports Collection，首先要先說明的是：何謂
	<span class="quote">“<span class="quote">skeleton</span>”</span>。
        簡單來講，port skeleton 就是讓軟體如何在 FreeBSD
	順利編譯、安裝的最基本檔案組合。
        每份 port skeleton 基本上會有：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">Makefile</code> 檔。
	    這個 <code class="filename">Makefile</code> 內容有分許多部分，
	    是用來指定要如何編譯，以及該裝在系統的何處。</p></li><li class="listitem"><p><code class="filename">distinfo</code> 檔。
	    編譯該軟體所需下載的檔案、checksum(使用 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md5&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">md5</span>(1)</span></a> 及
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sha256&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">sha256</span>(1)</span></a> 來檢驗檔案)都會記錄在這檔，
	    以確保所下載的檔案是正確無誤的。</p></li><li class="listitem"><p><code class="filename">files</code> 目錄。 這目錄放的是讓軟體正常編譯、
	    安裝的 patch 檔。
	    Patches 檔基本上是一些小檔案，並針對特定檔案來做修改，
	    而且是純文字檔格式，
	    基本上內容通常會像是 <span class="quote">“<span class="quote">Remove line 10(刪除第 10 行)</span>”</span>
	    或
	    <span class="quote">“<span class="quote">Change line 26 to this ...(把第 26 行改為...)</span>”</span>
	    之類的。
	    這些 Patches 通常也稱為 <span class="quote">“<span class="quote">diffs</span>”</span>
	    ，因為都是由 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> 程式所產生的。</p><p>此外，本目錄也可能會放一些協助編譯該 port 的檔案。</p></li><li class="listitem"><p><code class="filename">pkg-descr</code> 檔，內容是比較詳細的軟體介紹，
	    通常會寫得比較多行。</p></li><li class="listitem"><p><code class="filename">pkg-plist</code> 檔，該 port
	    會安裝的所有檔案清單。
	    也是告訴系統在移除該 port 時，需要刪除哪些檔案。</p></li></ul></div><p>有些 port 還會有其他檔案，像是 <code class="filename">pkg-message</code> 檔。
        port 系統在一些情況時，會用這些檔案。
        如果想知道這些檔案的更多細節用途，以及 port 一般用法，請參閱 <a class="link" href="../../../../doc/zh_TW.UTF-8/books/porters-handbook/index.html" target="_top">FreeBSD Porter's
        Handbook</a>。</p><p>port 內寫的是告訴系統如何編譯 source code 的相關指令，
	但並不是真正的 source code。
        而 source code 可以從光碟或網路(Internet)來取得，
        該軟體開發者可能會把 source code 以各種格式來發佈。
        通常是以 tar 以及 gzip 這兩者工具一起壓縮的檔案，
	也有可能是以其他工具壓縮，或根本沒壓縮。
	而軟體的 source code 無論是以哪一種壓縮檔型態，我們都稱之為
	<span class="quote">“<span class="quote">distfile</span>”</span>。
        下面將介紹兩種安裝 FreeBSD port 的方式。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">要安裝 port 的話，請務必切為 <code class="systemitem">root</code> 身份。
	  </p></div><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">在安裝任何 port 之前，請務必確認有更新 Ports Collection 到最新版，
	  此外請檢閱 <code class="uri"><a class="uri" href="http://vuxml.freebsd.org/" target="_top">http://vuxml.freebsd.org/</a></code> 來檢查所要裝的 port
	  是否有相關安全漏洞議題需要注意的。</p><p xmlns="http://www.w3.org/1999/xhtml"><span class="application">portaudit</span> 會在安裝任何 port 之前，
	  先自動檢查是否有相關已知的安全漏洞。這個工具在 Ports Collection 內有
	  (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portaudit/pkg-descr">ports-mgmt/portaudit</a>)。
	  在安裝 port 之前，可以先跑 <code class="command">portaudit -F</code> 指令，
	  如此一來就會抓最新的資安漏洞資料庫回來核對。
	  每天的系統定期安檢會自動更新資料庫，並作安全稽核。
	  詳情請參閱 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=portaudit&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">portaudit</span>(1)</span></a> 以及 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a> 的線上說明。</p></div><p>Ports Collection 會假設你的網路是可正常連線的。
        如果沒有的話，那麼需手動把所需的 distfile 檔複製到
	<code class="filename">/usr/ports/distfiles</code> 才行。</p><p>開始操作之前，要先進入打算安裝的 port 目錄內：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/sysutils/lsof</code></strong></pre><p>一旦進入 <code class="filename">lsof</code> 目錄後，就可以看到這個 port
	  的 skeleton 結構。
	  接下來，就是編譯，也就是 <span class="quote">“<span class="quote">build</span>”</span> 這個 port。
	  只需簡單輸入 <code class="command">make</code> 指令，就可輕鬆完成編譯。
	  完成後，應該可以看到類似下面訊息：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make</code></strong>
&gt;&gt; lsof_4.57D.freebsd.tar.gz doesn't seem to exist in /usr/ports/distfiles/.
&gt;&gt; Attempting to fetch from ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/.
===&gt;  Extracting for lsof-4.57
...
[extraction output snipped]
...
&gt;&gt; Checksum OK for lsof_4.57D.freebsd.tar.gz.
===&gt;  Patching for lsof-4.57
===&gt;  Applying FreeBSD patches for lsof-4.57
===&gt;  Configuring for lsof-4.57
...
[configure output snipped]
...
===&gt;  Building for lsof-4.57
...
[compilation output snipped]
...
<code class="prompt">#</code></pre><p>請注意：編譯完成後，就會回到提示列(prompt)。接下來就是安裝該
	  port 了，要裝的話，只需在原本的 <code class="command">make</code>
	  指令後面再加上一個字即可，
	  那個字就是 <code class="command">install</code>：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong>
===&gt;  Installing for lsof-4.57
...
[installation output snipped]
...
===&gt;   Generating temporary packing list
===&gt;   Compressing manual pages for lsof-4.57
===&gt;   Registering installation for lsof-4.57
===&gt;  SECURITY NOTE:
      This port has installed the following binaries which execute with
      increased privileges.
<code class="prompt">#</code></pre><p>一旦回到提示列(prompt)，就可以執行剛裝的程式了。
	  另外，因為 <code class="command">lsof</code> 這程式執行時會有額外權限，
	  所以會出現安全警告。在編譯、安裝 port 的時候，
	  請留意任何出現的警告。</p><p>此外，建議刪除編譯用的工作目錄(預設是 <code class="filename">work</code>)，
	  這目錄內為在編譯過程中所用到的一些臨時檔案，
	  這些檔案不只佔硬碟空間，而且也可能會在該 port 升級新版時，
	  造成不必要的困擾。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make clean</code></strong>
===&gt;  Cleaning for lsof-4.57
<code class="prompt">#</code></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">用 <code class="command">make install clean</code> 就可以一口氣完成剛所說
	    <code class="command">make</code>、<code class="command">make install</code>、
	    <code class="command">make clean</code> 這三個步驟了。</p></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">有些 shell 會依據 <code class="envar">PATH</code> 環境變數的路徑，
	    把那些路徑的執行檔 cache 起來，來加速搜尋執行檔。
	    如果你用的是這類的 shell，那麼在裝完 port 後需要打
	    <code class="command">rehash</code> 指令，才能執行新裝的執行檔，而
	    <code class="command">rehash</code> 指令可以在 <code class="command">tcsh</code>
	    之類的 shell 上使用，若是 <code class="command">sh</code> 的話，則是
	    <code class="command">hash -r</code>。
	    詳情請參閱你所使用的 shell 相關文件。</p></div><p>有些由所謂 third-party 所發行的 DVD-ROM 產品，像是
	  <a class="link" href="http://www.freebsdmall.com/" target="_top">FreeBSD
	  Mall</a> 所發行的 FreeBSD Toolkit 會包括 distfiles 檔案，
	  這些檔案可用來搭配 Ports Collection。
	  把 DVD-ROM 掛載在 <code class="filename">/cdrom</code>。
	  若使用其他掛載點的話，要記得設定 <code class="varname">CD_MOUNTPTS</code>
	  環境變數為相對應的掛載點。  如此一來，光碟上若有所需的 distfiles
	  就會自動使用光碟的檔案。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">請注意，有少數 port 並不允許透過光碟來發佈檔案。
	    可能的原因有：需先填註冊單才能下載或散佈檔案，或其他原因。
	    如果想安裝在光碟上沒附上的 port，就需連上網路才能繼續進行安裝。
	    </p></div><p>ports 系統採用 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fetch&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">fetch</span>(1)</span></a> 來下載檔案，
	  它有許多可調整的環境變數，包括：
	  <code class="envar">FTP_PASSIVE_MODE</code>、<code class="envar">FTP_PROXY</code>、
	  <code class="envar">FTP_PASSWORD</code>。  如果是處於有防火牆的環境，
	  或者需要使用 FTP/HTTP proxy，那麼就需要設定這些變數。
	  使用細節請參閱 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fetch&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">fetch</span>(3)</span></a> 說明。</p><p>若無法隨時一直上網的話，那麼可以利用
	  <code class="command">make fetch</code>。
	  只要在 port 的最上層路徑(<code class="filename">/usr/ports</code>)
	  打這指令，那麼所有需要用到的檔案都會下載。
	  這指令也可以在下層目錄使用，例如：
	  <code class="filename">/usr/ports/net</code>。
	  請注意，若該 port 有相依的 library 或者其他 port 的話，
	  那麼它<span class="emphasis"><em>並不會</em></span>跟著一起下載其他所相依的檔案。
	  若想一次下載所有相依的 port 所有檔案，那麼指令參數請改用
	  <code class="buildtarget">fetch-recursive</code> 而非
	  <code class="buildtarget">fetch</code>。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">可以在某類別或最上層路徑打 <code class="command">make</code>
	  指令來編譯所有的 port，或者以上述的 <code class="command">make
	  fetch</code> 指令來下載所有檔案。
	  然而，這樣是相當危險，因為有些 port 不能並存。
	  也有另一種情況，有些 port 可能會以相同檔名，
	  但是實際上卻是不同內容的檔案。</p></div><p>在某些罕見情況，可能需加上 <code class="varname">MASTER_SITES</code>
	  (檔案的原始下載處)之外的下載點，以下載所需的檔案。
	  可以用下列指令，來更改預設的 <code class="varname">MASTER_SITES</code>
	  下載點：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/directory</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make MASTER_SITE_OVERRIDE= \
ftp://ftp.FreeBSD.org/pub/FreeBSD/ports/distfiles/ fetch</code></strong></pre><p>上面這例子，是把 <code class="varname">MASTER_SITES</code> 改設
	  <code class="systemitem">ftp.FreeBSD.org/pub/FreeBSD/ports/distfiles/</code>
	  為下載點。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">有些 port 允許(或要求)您得指定編譯選項，
	  以啟用、停用該軟體中非必須的功能、安全選項以及其他可自訂的選項。
	  具有代表性的包括了
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/mozilla/pkg-descr">www/mozilla</a>、<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/gpgme/pkg-descr">security/gpgme</a>、<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/mail/sylpheed-claws/pkg-descr">mail/sylpheed-claws</a>。
	  若有這類選項時，通常在編譯時會出現相關提示訊息。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71059280"></a>5.5.1.1. 更改(Override)預設的 Ports 目錄</h4></div></div></div><p>有時候，會發現到使用其他目錄作為 port、distfiles
	  目錄可能相當有用(甚至是必須)，可以設定
	  <code class="varname">PORTSDIR</code> 及 <code class="varname">PREFIX</code>
	  環境變數以修改預設的 port 目錄。舉例：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make PORTSDIR=/usr/home/example/ports install</code></strong></pre><p>以上會在
	    <code class="filename">/usr/home/example/ports</code> 內進行編譯，
	    並把所有檔案安裝到 <code class="filename">/usr/local</code> 內。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make PREFIX=/usr/home/example/local install</code></strong></pre><p>則會在 <code class="filename">/usr/ports</code> 目錄內編譯，
	  並把所有檔案安裝到
	  <code class="filename">/usr/home/example/local</code> 內。</p><p>當然囉，</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make PORTSDIR=../ports PREFIX=../local install</code></strong></pre><p>則會同時包含兩種設定(還有很多變化以致無法在本頁全部都有寫到，
	  但您應該已經有抓到大概概念了吧)。</p><p>此外，這些變數也以作為環境變數來設定。
	  請依您所使用的 shell 去參閱相關說明，以瞭解如何設定。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71067600"></a>5.5.1.2. 處理 <code class="command">imake</code></h4></div></div></div><p>有些 port 會使用 <code class="command">imake</code>(X Window 系統的一部份)
	  無法正常運用 <code class="varname">PREFIX</code> 變數，
	  它們會堅持把檔案都安裝到 <code class="filename">/usr/X11R6</code> 目錄。
	  同樣地，也有一些 Perl port 會忽略 <code class="varname">PREFIX</code>
	  並把檔案安裝到 Perl 目錄架構內。  讓這些 ports respect
	  <code class="varname">PREFIX</code> 是相當困難，甚至是不可能的事。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp71087568"></a>5.5.1.3. 重新設定 Ports 選項</h4></div></div></div><p>在編譯某些 port 時會出現選單畫面(ncurses-based)，
	  可以用來選擇安裝選項。  通常裝好該 port 之後，便不太會需要重加、
	  移除、更改一些當初安裝的選項。  但日後若有需要的話，
	  也有許多方式可以調整這些選項。  其中一種方式便是切到該 port 目錄，
	  並打 <code class="command">make</code> <code class="buildtarget">config</code>
	  即可再次回到選項畫面去作調整。  另外還可用 <code class="command">make</code>
	  <code class="buildtarget">showconfig</code> 以顯示該 port 安裝時所用的選項。
	  也可以用 <code class="command">make</code> <code class="buildtarget">rmconfig</code>
	  來把所有選項回到初始設定。  這些選項跟其他動作都可參閱 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ports&amp;sektion=7"><span class="citerefentry"><span class="refentrytitle">ports</span>(7)</span></a>
	  內的詳細說明。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-removing"></a>5.5.2. 移除已安裝的 Ports</h3></div></div></div><a id="idp71092816" class="indexterm"></a><p>現在您已經知道如何安裝 port，而開始想瞭解如何移除。
        比如裝了一個 port 後才意識到裝錯 port 了。
        在此，我們將移除前面例子所裝的那個 port
	(沒仔細注意的話，我們再提醒一下就是 <code class="command">lsof</code>)。
	跟移除 package 時相當類似，都是使用
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pkg_delete&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">pkg_delete</span>(1)</span></a> 指令：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg_delete lsof-4.57</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-upgrading"></a>5.5.3. 升級已安裝的 Ports</h3></div></div></div><a id="idp71105744" class="indexterm"></a><p>首先，用 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pkg_version&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">pkg_version</span>(1)</span></a> 指令來列出目前 Ports Collection
	中提供了那些可升級的 port 版本：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg_version -v</code></strong></pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-file-updating"></a>5.5.3.1. <code class="filename">/usr/ports/UPDATING</code></h4></div></div></div><p>每次更新完 Ports Collection 之後，請務必記得在升級 port 前，
	  先看看 <code class="filename">/usr/ports/UPDATING</code>，
	  這裡會寫升級方面的各式問題，比如：檔案格式改變、變更設定檔位置、
	  與舊版不相容的問題等，以及怎麼解決的完整步驟。</p><p>若 <code class="filename">UPDATING</code> 內容與你看到的其他文件有些不同
	  、相衝的話，
	  那麼請以 <code class="filename">UPDATING</code> 為準。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="portupgrade"></a>5.5.3.2. 以 Portupgrade 來升級已安裝的 Ports</h4></div></div></div><a id="idp71112784" class="indexterm"></a><p><span class="application">portupgrade</span> 可以輕鬆升級已裝的軟體。
	該工具可從 <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portupgrade/pkg-descr">ports-mgmt/portupgrade</a>
	port 安裝，
	安裝方式就如同其他 port 一樣，用 <code class="command">make install	clean
	</code> 指令就可以了：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/ports-mgmt/portupgrade</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>首先最好先以 <code class="command">pkgdb -F</code> 來掃瞄已裝的 ports
	資料庫是否有誤，並修正有問題的地方。
	在每次做升級之前，最好定期做一下 <code class="command">pkgdb -F</code>
	動作會較為妥當。</p><p>跑 <code class="command">portupgrade -a</code> 的話，
	<span class="application">portupgrade</span> 會升級系統上所有已裝的過舊
	ports。  若用 <code class="option">-i</code> 則在升級每個 port 過程當中，
	會要求確認相關動作是否符合所需。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portupgrade -ai</code></strong></pre><p>若只想升級某特定程式而非全部，那麼可以用
	<code class="command">portupgrade pkgname</code>
	來做指定。  若想要 <span class="application">portupgrade</span>
	優先升級某 port 所相依的相關套件，則請用 <code class="option">-R</code>
	參數即可。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portupgrade -R firefox</code></strong></pre><p>若要用 package 而非 port 來安裝，則需指定
	<code class="option">-P</code> 才可以。  若有指定這選項，則
	<span class="application">portupgrade</span> 會搜尋
	<code class="envar">PKG_PATH</code> 變數所指定的本機目錄，
	若找不到則透過網路來下載安裝。
	若本機跟網路都沒有可用的 package 的話，則
	<span class="application">portupgrade</span> 會使用 port 方式安裝。
	若不想如此又變成使用 port 方式安裝，則用 <code class="option">-PP</code>
	即可強制避免使用 port 方式安裝。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portupgrade -PP gnome2</code></strong></pre><p>若只想下載 distfiles(或者若指定 <code class="option">-P</code> 的話，則是
	package)而不想編譯或安裝檔案，可以使用 <code class="option">-F</code>。
	詳情請參閱 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=portupgrade&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">portupgrade</span>(1)</span></a> 的說明。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="portmanager"></a>5.5.3.3. 以 Portmanager 來升級已安裝的 Ports</h4></div></div></div><a id="idp71133392" class="indexterm"></a><p><span class="application">Portmanager</span>
	  也可以用來輕鬆升級已裝的軟體。  該工具可從 <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmanager/pkg-descr">ports-mgmt/portmanager</a> port 安裝：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/ports-mgmt/portmanager</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>所有已裝的軟體，都可以輕鬆用類似下列指令來升級：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmanager -u</code></strong></pre><p>此外，使用參數可以改為 <code class="option">-ui</code>，如此一來
	  <span class="application">Portmanager</span> 在升級一些有特殊選項的軟體時
	  ，就會詢問該如何升級。  <span class="application">Portmanager</span>
	  也可以用來裝新 port。與以往常用的
	  <code class="command">make install clean</code> 指令不同之處在於：
	  它會先升級你要裝的 port 所相依的所有 ports，然後才開始編譯、
	  安裝要裝的 port。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmanager x11/gnome2</code></strong></pre><p>若要裝的 port 之軟體相依關係有問題時，也可以用
	  <span class="application">Portmanager</span> 使它們重歸正軌。  而
	  <span class="application">Portmanager</span> 解決相依問題完畢之後，該 port
	  也會重新編譯，以因應正確的相依關係。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmanager graphics/gimp -f</code></strong></pre><p>其餘運用法門，請參閱 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=portmanager&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">portmanager</span>(1)</span></a> 說明。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ports-disk-space"></a>5.5.4. Ports 與硬碟空間</h3></div></div></div><a id="idp71149520" class="indexterm"></a><p>因為使用 Ports Collection 遲早可能會用光硬碟空間，
	所以在裝完軟體後，記得要以 <code class="command">make clean
	</code> 指令來清除臨時的 <code class="filename">work
	</code> 目錄。
	此外，可以用下列指令來清除整個 Ports Collection 內的臨時目錄：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsclean -C</code></strong></pre><p>ports 用久了，您可能會在
	<code class="filename">distfiles</code>
	目錄內會累積著許多的原始碼檔案。  可以手動刪除這些檔案，
	或者用下列指令來清除所有 port 都不使用的舊檔：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsclean -D</code></strong></pre><p>或者要清除所有已裝的 port 都不再使用的舊檔：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsclean -DD</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="command">portsclean</code> 這工具乃是
	  <span class="application">portupgrade</span> 套件的一部分。</p></div><p>不要忘了移除那些已經安裝，但不再需要用到的 ports。
	有個 <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/pkg_cutleaves/pkg-descr">ports-mgmt/pkg_cutleaves</a>
	port，正是可自動完成這功能的好工具。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pkgng-intro.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ports.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="ports-nextsteps.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">5.4. Using <span class="application">pkg</span> for Binary Package
      Management </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 5.6. 安裝之後，有什麼後續注意事項嗎？</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>