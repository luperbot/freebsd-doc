<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>22.2. 安裝 FreeBSD 為 Guest OS</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="virtualization.html" title="章 22. Virtualization(虛擬機器)" /><link rel="prev" href="virtualization.html" title="章 22. Virtualization(虛擬機器)" /><link rel="next" href="virtualization-host.html" title="22.3. 以 FreeBSD 為 Host OS" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">22.2. 安裝 FreeBSD 為 Guest OS</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="virtualization.html">前一頁</a> </td><th width="60%" align="center">章 22. Virtualization(虛擬機器)</th><td width="20%" align="right"> <a accesskey="n" href="virtualization-host.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="virtualization-guest"></a>22.2. 安裝 FreeBSD 為 Guest OS</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-parallels"></a>22.2.1. MacOS 上的 Parallels</h3></div></div></div><p><span class="trademark">Mac</span>® 版的 <span class="application">Parallels Desktop</span>
	乃是可用於搭配 <span class="trademark">Intel</span>® CPU 以及 <span class="trademark">Mac OS</span>® 10.4.6 以上的 <span class="trademark">Apple</span>® <span class="trademark">Mac</span>®
	電腦的商業軟體。  FreeBSD 是其有完整支援的 guest OS 之一。  在
	<span class="trademark">Mac OS</span>® X 裝好 <span class="application">Parallels</span> 後，
	必須針對所欲安裝的 guest OS 來作相關的虛擬機器設定。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-parallels-install"></a>22.2.1.1. 在 Parallels/<span class="trademark">Mac OS</span>® X 上安裝 FreeBSD</h4></div></div></div><p>在 <span class="trademark">Mac OS</span>® X/<span class="application">Parallels</span> 上安裝 FreeBSD
	    的第一步是新增虛擬機器。  如下所示，在提示視窗內請將
	    <span class="guimenu">Guest OS Type</span> 勾選為
	    <span class="guimenuitem">FreeBSD</span>：</p><div class="mediaobject"><img src="virtualization/parallels-freebsd1.png" /></div><p>並依據自身需求來規劃硬碟容量跟記憶體的分配。  對大多數在
	    <span class="application">Parallels</span> 使用的情況而言，大約 4GB
	    硬碟以及 512MB RAM 就夠用了：</p><div class="mediaobject"><img src="virtualization/parallels-freebsd2.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd3.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd4.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd5.png" /></div><p>接下來，選擇網路種類以及網路卡：</p><div class="mediaobject"><img src="virtualization/parallels-freebsd6.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd7.png" /></div><p>最後，儲存設定檔就完成設定了：</p><div class="mediaobject"><img src="virtualization/parallels-freebsd8.png" /></div><div class="mediaobject"><img src="virtualization/parallels-freebsd9.png" /></div><p>在 FreeBSD 虛擬機器新增後，就可以繼續以其安裝 FreeBSD。
	    安裝方面，比較好的作法是使用官方的 FreeBSD 光碟或者從官方 FTP
	    站下載 ISO image 檔。  若您的 <span class="trademark">Mac</span>® 本機已經有該 ISO 檔，
	    或者 <span class="trademark">Mac</span>® 的光碟機內有放安裝片，那麼就可以在 FreeBSD 的
	    <span class="application">Parallels</span> 視窗右下角按下光碟片圖示。
	    接著會出現一個視窗，可以把虛擬機器內的光碟機設定到該 ISO 檔，
	    或者是實體光碟機。</p><div class="mediaobject"><img src="virtualization/parallels-freebsd11.png" /></div><p>設好光碟片來源之後，就可以按下重開機圖示以重開 FreeBSD
	    虛擬機器。  <span class="application">Parallels</span> 會以特殊 BIOS
	    開機，並與普通的 BIOS 一樣會先檢查是否有光碟機。</p><div class="mediaobject"><img src="virtualization/parallels-freebsd10.png" /></div><p>此時，它就會找到 FreeBSD 安裝片，並開始在 <a class="xref" href="install.html" title="章 3. 安裝 FreeBSD">章 3, <em>安裝 FreeBSD</em></a> 內所介紹到的
	    <span class="application">sysinstall</span> 安裝過程。  這時候也可順便裝
	    X11，但先不要進行相關設定。</p><div class="mediaobject"><img src="virtualization/parallels-freebsd12.png" /></div><p>完成安裝過程之後，就可以重開剛裝的 FreeBSD 虛擬機器。</p><div class="mediaobject"><img src="virtualization/parallels-freebsd13.png" /></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-parallels-configure"></a>22.2.1.2. 在 <span class="trademark">Mac OS</span>® X/Parallels 上設定 FreeBSD</h4></div></div></div><p>把 FreeBSD 成功裝到 <span class="trademark">Mac OS</span>® X 的
	    <span class="application">Parallels</span> 之後，還需要作一些設定步驟，
	    以便將虛擬機器內的 FreeBSD 最佳化。</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>設定 boot loader 參數</strong></p><p>最重要的步驟乃是藉由調降 <code class="option">kern.hz</code> 來降低
		<span class="application">Parallels</span> 環境內 FreeBSD 的 CPU
		佔用率。  可以在 <code class="filename">/boot/loader.conf</code>
		內加上下列設定即可：</p><pre class="programlisting">kern.hz=100</pre><p>若不作這設定，那麼光是 idle 狀態的 FreeBSD
		(<span class="application">Parallels</span> guest OS)
		就會在僅單一處理器的 <span class="trademark">iMac</span>® 上佔了大約 15% 的 CPU 佔用率。
		作上述修改之後，佔用率就會降至大約 5%。</p></li><li class="step"><p class="title"><strong>設定新的 kernel 設定檔</strong></p><p>可以放心把所有 SCSI、FireWire、USB
		相關設備都移除。  <span class="application">Parallels</span>
		有提供 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ed&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ed</span>(4)</span></a> 的虛擬網卡，因此，除了 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ed&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ed</span>(4)</span></a> 以及
		<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=miibus&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">miibus</span>(4)</span></a> 以外的其他網路卡也都可以從 kernel 中移除。</p></li><li class="step"><p class="title"><strong>設定網路</strong></p><p>可以替虛擬機器簡單用 DHCP 來設定與 <span class="trademark">Mac</span>® 相同的 LAN
		網路環境，只要在 <code class="filename">/etc/rc.conf</code>
		內加上 <code class="literal">ifconfig_ed0="DHCP"</code> 即可完成。
		其他進階的網路設定方式，請參考 <a class="xref" href="advanced-networking.html" title="章 31. 網路進階練功房">章 31, <em>網路進階練功房</em></a>。</p></li></ol></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-xen"></a>22.2.2. 在 Linux 透過 <span class="trademark">Xen</span>™ 跑 FreeBSD</h3></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Fukang</span> <span class="surname">Chen (Loader)</span></span>. </span></div></div></div><p><span class="application"><span class="trademark">Xen</span>™</span> hypervisor 乃是開放源碼的
	  paravirtualization 產品，並由商業公司(XenSource)提供支援。
	  Guest OS 通常被稱為 domU domains，而 host OS 則是被稱為 dom0。
	  在 Linux 上建立 FreeBSD 虛擬機器的第一步，則是安裝 Linux dom0 的
	  <span class="application"><span class="trademark">Xen</span>™</span>。  在本例中， host OS 乃是 Slackware
	  Linux。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="xen-slackware-dom0"></a>22.2.2.1. 在 Linux dom0 上設定 <span class="trademark">Xen</span>™ 3</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>從 XenSource 網站下載 <span class="trademark">Xen</span>™ 3.0</strong></p><p>從 <code class="uri"><a class="uri" href="http://www.xensource.com/" target="_top">http://www.xensource.com/</a></code> 下載
		<a class="link" href="http://bits.xensource.com/oss-xen/release/3.0.4-1/src.tgz/xen-3.0.4_1-src.tgz" target="_top">xen-3.0.4_1-src.tgz</a>。</p></li><li class="step"><p class="title"><strong>解壓縮</strong></p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd xen-3.0.4_1-src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>KERNELS="linux-2.6-xen0 linux-2.6-xenU" make world</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">為 dom0 重新編譯 kernel：</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd xen-3.0.4_1-src/linux-2.6.16.33-xen0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make menuconfig</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">舊版的 <span class="application"><span class="trademark">Xen</span>™</span> 可能需要用
	        <code class="command">make ARCH=xen menuconfig</code></p></div></li><li class="step"><p class="title"><strong>增加選項到 Grub 的 menu.lst 選單</strong></p><p>修改 <code class="filename">/boot/grub/menu.lst</code>
		加上下列設定：</p><pre class="programlisting">title Xen-3.0.4
root (hd0,0)
kernel /boot/xen-3.0.4-1.gz dom0_mem=262144
module /boot/vmlinuz-2.6.16.33-xen0 root=/dev/hda1 ro</pre></li><li class="step"><p class="title"><strong>重開機並進入 <span class="trademark">Xen</span>™</strong></p><p>首先，修改
		<code class="filename">/etc/xen/xend-config.sxp</code>
		加上下列設定：</p><pre class="programlisting">(network-script 'network-bridge netdev=eth0')</pre><p>接下來，就可以啟動 <span class="application"><span class="trademark">Xen</span>™</span>：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/init.d/xend start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>/etc/init.d/xendomains start</code></strong></pre><p>現在 dom0 已經開始運作：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>xm list</code></strong>
Name                                      ID   Mem VCPUs      State   Time(s)
Domain-0                                   0   256     1     r-----  54452.9</pre></li></ol></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83398480"></a>22.2.2.2. FreeBSD 7-CURRENT domU</h4></div></div></div><p>從 <a class="link" href="http://www.fsmware.com/" target="_top">http://www.fsmware.com/</a>
	    下載搭配 <span class="application"><span class="trademark">Xen</span>™ 3.0</span> 的 FreeBSD domU
	    kernel 相關檔案</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.fsmware.com/xenofreebsd/7.0/download/kernel-current" target="_top">kernel-current</a></p></li><li class="listitem"><p><a class="link" href="http://www.fsmware.com/xenofreebsd/7.0/download/mdroot-7.0.bz2" target="_top">mdroot-7.0.bz2</a></p></li><li class="listitem"><p><a class="link" href="http://www.fsmware.com/xenofreebsd/7.0/download/config/xmexample1.bsd" target="_top">xmexample1.bsd</a></p></li></ul></div><p>把 <code class="filename">xmexample1.bsd</code> 設定檔放到
	<code class="filename">/etc/xen/</code>，並修改 kernel 及 disk image 相關位置。
	以下是示範的例子：</p><pre class="programlisting">kernel = "/opt/kernel-current"
memory = 256
name = "freebsd"
vif = [ '' ]
disk = [ 'file:/opt/mdroot-7.0,hda1,w' ]
#on_crash    = 'preserve'
extra = "boot_verbose"
extra += ",boot_single"
extra += ",kern.hz=100"
extra += ",vfs.root.mountfrom=ufs:/dev/xbd769a"</pre><p>其中 <code class="filename">mdroot-7.0.bz2</code> 檔要記得解壓縮之。</p><p>接下來，要修改 <code class="filename">kernel-current</code> 設定檔的
	__xen_guest 小節，並加上 <span class="application"><span class="trademark">Xen</span>™ 3.0.3</span> 所需的
	VIRT_BASE：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>objcopy kernel-current -R __xen_guest</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>perl -e 'print "LOADER=generic,GUEST_OS=freebsd,GUEST_VER=7.0,XEN_VER=xen-3.0,BSD_SYMTAB,VIRT_BASE=0xC0000000\x00"' &gt; tmp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>objcopy kernel-current --add-section __xen_guest=tmp</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>objdump -j __xen_guest -s kernel-current</code></strong>

kernel-current:     file format elf32-i386

Contents of section __xen_guest:
 0000 4c4f4144 45523d67 656e6572 69632c47  LOADER=generic,G
 0010 55455354 5f4f533d 66726565 6273642c  UEST_OS=freebsd,
 0020 47554553 545f5645 523d372e 302c5845  GUEST_VER=7.0,XE
 0030 4e5f5645 523d7865 6e2d332e 302c4253  N_VER=xen-3.0,BS
 0040 445f5359 4d544142 2c564952 545f4241  D_SYMTAB,VIRT_BA
 0050 53453d30 78433030 30303030 3000      SE=0xC0000000. </pre><p>現在可以新增並啟動 domU 囉：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>xm create /etc/xen/xmexample1.bsd -c</code></strong>
Using config file "/etc/xen/xmexample1.bsd".
Started domain freebsd
WARNING: loader(8) metadata is missing!
Copyright (c) 1992-2006 The FreeBSD Project.
Copyright (c) 1979, 1980, 1983, 1986, 1988, 1989, 1991, 1992, 1993, 1994
The Regents of the University of California. All rights reserved.
FreeBSD 7.0-CURRENT #113: Wed Jan  4 06:25:43 UTC 2006
    kmacy@freebsd7.gateway.2wire.net:/usr/home/kmacy/p4/freebsd7_xen3/src/sys/i386-xen/compile/XENCONF
WARNING: DIAGNOSTIC option enabled, expect reduced performance.
Xen reported: 1796.927 MHz processor.
Timecounter "ixen" frequency 1796927000 Hz quality 0
CPU: Intel(R) Pentium(R) 4 CPU 1.80GHz (1796.93-MHz 686-class CPU)
  Origin = "GenuineIntel"  Id = 0xf29  Stepping = 9
  Features=0xbfebfbff&lt;FPU,VME,DE,PSE,TSC,MSR,PAE,MCE,CX8,APIC,SEP,MTRR,PGE,MCA,CMOV,PAT,PSE36,CLFLUSH,
  DTS,ACPI,MMX,FXSR,SSE,SSE2,SS,HTT,TM,PBE&gt;
  Features2=0x4400&lt;CNTX-ID,&lt;b14&gt;&gt;
real memory  = 265244672 (252 MB)
avail memory = 255963136 (244 MB)
xc0: &lt;Xen Console&gt; on motherboard
cpu0 on motherboard
Timecounters tick every 10.000 msec
[XEN] Initialising virtual ethernet driver.
xn0: Ethernet address: 00:16:3e:6b:de:3a
[XEN]
Trying to mount root from ufs:/dev/xbd769a
WARNING: / was not properly dismounted
Loading configuration files.
No suitable dump device was found.
Entropy harvesting: interrupts ethernet point_to_point kickstart.
Starting file system checks:
/dev/xbd769a: 18859 files, 140370 used, 113473 free (10769 frags, 12838 blocks, 4.2% fragmentation)
Setting hostname: demo.freebsd.org.
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384
	  inet6 ::1 prefixlen 128
	  inet6 fe80::1%lo0 prefixlen 64 scopeid 0x2
	  inet 127.0.0.1 netmask 0xff000000
Additional routing options:.
Mounting NFS file systems:.
Starting syslogd.
/etc/rc: WARNING: Dump device does not exist.  Savecore not run.
ELF ldconfig path: /lib /usr/lib /usr/lib/compat /usr/X11R6/lib /usr/local/lib
a.out ldconfig path: /usr/lib/aout /usr/lib/compat/aout /usr/X11R6/lib/aout
Starting usbd.
usb: Kernel module not available: No such file or directory
Starting local daemons:.
Updating motd.
Starting sshd.
Initial i386 initialization:.
Additional ABI support: linux.
Starting cron.
Local package initialization:.
Additional TCP options:.
Starting background file system checks in 60 seconds.

Sun Apr  1 02:11:43 UTC 2007

FreeBSD/i386 (demo.freebsd.org) (xc0)

login: </pre><p>現在 domU 應該可以跑 FreeBSD 7.0-CURRENT kernel：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>uname -a</code></strong>
FreeBSD demo.freebsd.org 7.0-CURRENT FreeBSD 7.0-CURRENT #113: Wed Jan  4 06:25:43 UTC 2006
kmacy@freebsd7.gateway.2wire.net:/usr/home/kmacy/p4/freebsd7_xen3/src/sys/i386-xen/compile/XENCONF  i386</pre><p>接下來是設定 domU 的網路，FreeBSD domU 會用代號為
	<code class="filename">xn0</code> 的特殊網路卡：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig xn0 10.10.10.200 netmask 255.0.0.0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig</code></strong>
xn0: flags=843&lt;UP,BROADCAST,RUNNING,SIMPLEX&gt; mtu 1500
    inet 10.10.10.200 netmask 0xff000000 broadcast 10.255.255.255
    ether 00:16:3e:6b:de:3a
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384
      inet6 ::1 prefixlen 128
      inet6 fe80::1%lo0 prefixlen 64 scopeid 0x2
      inet 127.0.0.1 netmask 0xff000000 </pre><p>在 dom0 Slackware 上應該會出現一些 <span class="application"><span class="trademark">Xen</span>™</span>
	專用的網路卡：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig</code></strong>
eth0      Link encap:Ethernet  HWaddr 00:07:E9:A0:02:C2
          inet addr:10.10.10.130  Bcast:0.0.0.0  Mask:255.0.0.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:815 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1400 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:204857 (200.0 KiB)  TX bytes:129915 (126.8 KiB)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:99 errors:0 dropped:0 overruns:0 frame:0
          TX packets:99 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:9744 (9.5 KiB)  TX bytes:9744 (9.5 KiB)

peth0     Link encap:Ethernet  HWaddr FE:FF:FF:FF:FF:FF
          UP BROADCAST RUNNING NOARP  MTU:1500  Metric:1
          RX packets:1853349 errors:0 dropped:0 overruns:0 frame:0
          TX packets:952923 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:2432115831 (2.2 GiB)  TX bytes:86528526 (82.5 MiB)
          Base address:0xc000 Memory:ef020000-ef040000

vif0.1    Link encap:Ethernet  HWaddr FE:FF:FF:FF:FF:FF
          UP BROADCAST RUNNING NOARP  MTU:1500  Metric:1
          RX packets:1400 errors:0 dropped:0 overruns:0 frame:0
          TX packets:815 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:129915 (126.8 KiB)  TX bytes:204857 (200.0 KiB)

vif1.0    Link encap:Ethernet  HWaddr FE:FF:FF:FF:FF:FF
          UP BROADCAST RUNNING NOARP  MTU:1500  Metric:1
          RX packets:3 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2 errors:0 dropped:157 overruns:0 carrier:0
          collisions:0 txqueuelen:1
          RX bytes:140 (140.0 b)  TX bytes:158 (158.0 b)

xenbr1    Link encap:Ethernet  HWaddr FE:FF:FF:FF:FF:FF
          UP BROADCAST RUNNING NOARP  MTU:1500  Metric:1
          RX packets:4 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:112 (112.0 b)  TX bytes:0 (0.0 b)</pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>brctl show</code></strong>
bridge name     bridge id           STP enabled         interfaces
xenbr1          8000.feffffffffff   no                  vif0.1
                                                        peth0
                                                        vif1.0</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-virtualpc"></a>22.2.3. <span class="trademark">Windows</span>® 上的 Virtual PC</h3></div></div></div><p><span class="application">Virtual PC</span> 是 <span class="trademark">Microsoft</span>® 的
	<span class="trademark">Windows</span>® 軟體產品，可以免費下載使用。  相關系統需求，請參閱 <a class="link" href="http://www.microsoft.com/windows/downloads/virtualpc/sysreq.mspx" target="_top">
	system requirements</a> 說明。  在 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 裝完
	<span class="application">Virtual PC</span> 之後，
	必須針對所欲安裝的虛擬機器來作相關設定。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-virtualpc-install"></a>22.2.3.1. 在 Virtual PC/<span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 上安裝 FreeBSD</h4></div></div></div><p>在 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>®/<span class="application">Virtual PC</span>
	    上安裝 FreeBSD 的第一步是新增虛擬機器。  如下所示，
	    在提示視窗內請選擇 <span class="guimenuitem">Create a virtual
	    machine</span>：</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd1.png" /></div><div class="mediaobject"><img src="virtualization/virtualpc-freebsd2.png" /></div><p>然後在 <span class="guimenuitem">Operating system</span> 處選
	    <span class="guimenuitem">Other</span>：</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd3.png" /></div><p>並依據自身需求來規劃硬碟容量跟記憶體的分配。
	    對大多數在 <span class="application">Virtual PC</span> 使用 FreeBSD
	    的情況而言，大約 4GB 硬碟空間以及 512MB RAM 就夠用了：</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd4.png" /></div><div class="mediaobject"><img src="virtualization/virtualpc-freebsd5.png" /></div><p>儲存設定檔：</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd6.png" /></div><p>接下來選剛剛所新增的 FreeBSD 虛擬機器，並按下
	    <span class="guimenu">Settings</span>，以設定網路種類以及網路卡：</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd7.png" /></div><div class="mediaobject"><img src="virtualization/virtualpc-freebsd8.png" /></div><p>在 FreeBSD 虛擬機器新增後，就可以繼續以其安裝 FreeBSD。
	    安裝方面，比較好的作法是使用官方的 FreeBSD 光碟或者從官方 FTP
	    站下載 ISO image 檔。  若您的 <span class="trademark">Windows</span>® 檔案系統內已經有該 ISO
	    檔， 或者光碟機內有放安裝片，那麼就可以在 FreeBSD
	    虛擬機器上連按兩下，以開始啟動。  接著在
	    <span class="application">Virtual PC</span> 視窗內按
	    <span class="guimenu">CD</span> 再按 <span class="guimenu">Capture ISO Image...</span>
	    。  接著會出現一個視窗，可以把虛擬機器內的光碟機設定到該 ISO 檔，
	    或者是實體光碟機。</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd9.png" /></div><div class="mediaobject"><img src="virtualization/virtualpc-freebsd10.png" /></div><p>設好光碟片來源之後，就可以重開機，也就是先按
	    <span class="guimenu">Action</span> 再按 <span class="guimenu">Reset</span> 即可。
	    <span class="application">Virtual PC</span> 會以特殊 BIOS 開機，並與普通
	    BIOS 一樣會先檢查是否有光碟機。</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd11.png" /></div><p>此時，它就會找到 FreeBSD 安裝片，並開始在 <a class="xref" href="install.html" title="章 3. 安裝 FreeBSD">章 3, <em>安裝 FreeBSD</em></a> 內所介紹到的 <span class="application">sysinstall</span>
	    安裝過程。  這時候也可順便裝 X11，但先不要進行相關設定。</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd12.png" /></div><p>完成安裝之後，記得把光碟片退出或者 ISO image 退片。  最後，
	    把裝好的 FreeBSD 虛擬機器重開機即可。</p><div class="mediaobject"><img src="virtualization/virtualpc-freebsd13.png" /></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-virtualpc-configure"></a>22.2.3.2. 調整 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>®/Virtual PC 上的 FreeBSD</h4></div></div></div><p>在 <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® 上以 <span class="application">Virtual
	    PC</span> 裝好 FreeBSD 後，還需要作一些設定步驟，
	    以便將虛擬機器內的 FreeBSD 最佳化。</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>設定 boot loader 參數</strong></p><p>最重要的步驟乃是藉由調降 <code class="option">kern.hz</code> 來降低
		<span class="application">Virtual PC</span> 環境內 FreeBSD 的 CPU
		佔用率。  可以在 <code class="filename">/boot/loader.conf</code>
		內加上下列設定即可：</p><pre class="programlisting">kern.hz=100</pre><p>若不作這設定，那麼光是 idle 狀態的 FreeBSD
	        <span class="application">Virtual PC</span> guest OS
		就會在僅單一處理器的電腦上佔了大約 40% 的 CPU 佔用率。
		作上述修改之後，佔用率就會降至大約 3%。</p></li><li class="step"><p class="title"><strong>設定新的 kernel 設定檔</strong></p><p>可以放心把所有 SCSI、FireWire、USB 相關設備都移除。
		<span class="application">Virtual PC</span> 有提供 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=de&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">de</span>(4)</span></a>
		的虛擬網卡，因此除了 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=de&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">de</span>(4)</span></a> 以及 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=miibus&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">miibus</span>(4)</span></a>
		以外的其他網路卡也都可以從 kernel 中移除。</p></li><li class="step"><p class="title"><strong>設定網路</strong></p><p>可以替虛擬機器簡單用 DHCP 來設定與 host(<span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>®)
		相同的 LAN 網路環境，只要在 <code class="filename">/etc/rc.conf</code>
		加上 <code class="literal">ifconfig_de0="DHCP"</code> 即可完成。
		其他進階的網路設定方式，請參閱 <a class="xref" href="advanced-networking.html" title="章 31. 網路進階練功房">章 31, <em>網路進階練功房</em></a>。</p></li></ol></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-vmware"></a>22.2.4. 在 MacOS 上的 VMware</h3></div></div></div><p><span class="trademark">Mac</span>® 上的 <span class="application">VMWare Fusion</span> 乃是可用於搭配
	<span class="trademark">Intel</span>® CPU 以及 <span class="trademark">Mac OS</span>® 10.4.9 之 <span class="trademark">Apple</span>® <span class="trademark">Mac</span>® 以上的 <span class="trademark">Apple</span>® <span class="trademark">Mac</span>®
	電腦之商業軟體。  FreeBSD 是其有完整支援的 guest OS 之一。  在 <span class="trademark">Mac OS</span>®
	X 上裝完 <span class="application">VMWare Fusion</span> 之後，
	必須針對所欲安裝的 guest OS 來作相關的虛擬機器設定。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-vmware-install"></a>22.2.4.1. 在 VMWare/<span class="trademark">Mac OS</span>® X 上安裝 FreeBSD</h4></div></div></div><p>首先執行 VMWare Fusion，而其 Virtual Machine Library
	  也會隨之一併載入，這時請按 "New" 來建立 VM(虛擬機器)：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd01.png" /></div><p>接著會有 New Virtual Machine Assistant 來協助您建立 VM，請按
	  Continue 繼續：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd02.png" /></div><p>在 <span class="guimenuitem">Operating System</span> 選
	  <span class="guimenuitem">Other</span>，以及 <span class="guimenu">Version</span>
	  處請選擇是否要
	  <span class="guimenuitem">FreeBSD</span> 或
	  <span class="guimenuitem">FreeBSD 64-bit</span>，這部份請依自身需求是否有要
	  64-bit 支援而定：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd03.png" /></div><p>接著設定 VM image 檔要存到何處，以及決定名稱：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd04.png" /></div><p>決定該 VM 的虛擬硬碟要用多大：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd05.png" /></div><p>選擇要裝 VM 的方式為何，要用 ISO image 檔或者光碟機：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd06.png" /></div><p>按 Finish 以完畢，接著就會啟動該 VM：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd07.png" /></div><p>接著就照以往安裝 FreeBSD 的方式來裝，若不熟的話請參閱
	  <a class="xref" href="install.html" title="章 3. 安裝 FreeBSD">章 3, <em>安裝 FreeBSD</em></a>：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd08.png" /></div><p>裝完之後，就可以修改一些 VM 設定，像是記憶體大小：</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">VM 在運作之時，不能修改 VM 的硬體設定。</p></div><div class="mediaobject"><img src="virtualization/vmware-freebsd09.png" /></div><p>調整 VM 的 CPU 數量：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd10.png" /></div><p>光碟機狀態，通常不再需要用的時候，就可以切斷其與 VM 的連接：</p><div class="mediaobject"><img src="virtualization/vmware-freebsd11.png" /></div><p>最後要改的則是 VM 的網路設定。  若除了 Host OS 之外的機器也能連到
	  VM，那麼請選 <span class="guimenuitem">Connect directly to the physical network
	  (Bridged)</span>，否則就選 <span class="guimenuitem">Share the host's
	  internet connection (NAT)</span> 即可讓 VM 連到 Internet，
	  但外面則無法連入該 VM。</p><div class="mediaobject"><img src="virtualization/vmware-freebsd12.png" /></div><p>改完上述設定之後，就可以啟動新裝妥的 FreeBSD 虛擬機器。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualization-guest-vmware-configure"></a>22.2.4.2. 調整 <span class="trademark">Mac OS</span>® X/VMWare 上的 FreeBSD</h4></div></div></div><p>把 FreeBSD 成功裝到 <span class="trademark">Mac OS</span>® X 的 <span class="application">VMWare</span>
	  之後，還需要作一些設定步驟， 以便將虛擬機器內的 FreeBSD 最佳化。</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>設定 boot loader 參數</strong></p><p>最重要的步驟乃是藉由調降 <code class="option">kern.hz</code> 來降低
	      <span class="application">VMWare</span> 環境內 FreeBSD 的 CPU 佔用率。
	      可以在 <code class="filename">/boot/loader.conf</code>
	      內加上下列設定即可：</p><pre class="programlisting">kern.hz=100</pre><p>若不作這設定，那麼光是 idle 狀態的 FreeBSD
	      (<span class="application">VMWare</span> guest OS) 就會在僅單一處理器的
	      <span class="trademark">iMac</span>® 上佔了大約 15% 的 CPU 佔用率。  作上述修改之後，
	      佔用率就會降至大約 5%。</p></li><li class="step"><p class="title"><strong>設定新的 kernel 設定檔</strong></p><p>可以放心把所有 FireWire、USB 相關設備都移除。
	      <span class="application">VMWare</span> 有提供 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=em&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">em</span>(4)</span></a> 的虛擬網卡，
	      因此，除了 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=em&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">em</span>(4)</span></a> 以及 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=miibus&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">miibus</span>(4)</span></a> 以外的其他網路卡，
	      也都可以從 kernel 中移除。</p></li><li class="step"><p class="title"><strong>設定網路</strong></p><p>可以替虛擬機器簡單用 DHCP 來設定與 host <span class="trademark">Mac</span>® 相同的 LAN
	      網路環境，只要在 <code class="filename">/etc/rc.conf</code> 加上
	      <code class="literal">ifconfig_em0="DHCP"</code> 即可。
	      其他進階的網路設定方式，請參考 <a class="xref" href="advanced-networking.html" title="章 31. 網路進階練功房">章 31, <em>網路進階練功房</em></a>。</p></li></ol></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="virtualization.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="virtualization.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="virtualization-host.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">章 22. Virtualization(虛擬機器) </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 22.3. 以 FreeBSD 為 Host OS</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>