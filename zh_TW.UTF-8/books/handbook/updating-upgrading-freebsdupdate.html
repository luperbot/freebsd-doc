<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>24.2. FreeBSD Update</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="updating-upgrading.html" title="章 24. 更新、升級 FreeBSD" /><link rel="prev" href="updating-upgrading.html" title="章 24. 更新、升級 FreeBSD" /><link rel="next" href="updating-upgrading-documentation.html" title="24.3. 更新文件組" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">24.2. FreeBSD Update</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="updating-upgrading.html">前一頁</a> </td><th width="60%" align="center">章 24. 更新、升級 FreeBSD</th><td width="20%" align="right"> <a accesskey="n" href="updating-upgrading-documentation.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="updating-upgrading-freebsdupdate"></a>24.2. FreeBSD Update</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Based on notes provided by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Colin</span> <span class="surname">Percival</span></span>. </span></div></div></div><a id="idp83909840" class="indexterm"></a><a id="idp83910608" class="indexterm"></a><p>即時應用安全性更新與升級作業系統到新的發行版本對一個持續運作的系統是重要的。FreeBSD 包括一個叫 <code class="command">freebsd-update</code> 的工具程式可以執行這兩項任務。</p><p>這個工具程式支援 FreeBSD 二進制安全性與和錯誤更新，
不需要手動編譯和安裝修復或新核心。
安全性團隊目前支援的所有架構和發行版都可以取得二進制更新。
目前支援的發行版列表和他們的支援期限都列於
      <code class="uri"><a class="uri" href="http://www.FreeBSD.org/security/" target="_top">http://www.FreeBSD.org/security/</a></code>。</p><p>這個工具程式也支援作業系統升級到次要的發行版本和升級到令一個發行版分支升級到新的發行版本前，要檢查他的發行宣告，因為他包含發行版本相關的重要資訊。發行公告可以由<code class="uri"><a class="uri" href="http://www.FreeBSD.org/releases/" target="_top">http://www.FreeBSD.org/releases/</a></code>取得。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">如果有使用<code class="command">crontab</code>來執行
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=freebsd-update&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">freebsd-update</span>(8)</span></a>，那必須在升級作業系統前先停用。</p></div><p>這節描述 <code class="command">freebsd-update</code> 使用的設定檔，
示範如何運用安全性修補和如何升級到主要或次要的作業系統發行版，
以及討論某些升級作業系統的考量。 </p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-config-file"></a>24.2.1. 設定檔</h3></div></div></div><p>
	<code class="command">freebsd-update</code>預設的設定檔不需變更即可運作。
有些使用者可能想要調校預設的設定檔 <code class="filename">/etc/freebsd-update.conf</code>
來對程序有更好的控制。這個設定檔的註解說明了可以使用的選項，
但以下可能需要更多一些的解釋：
	</p><pre class="programlisting"># Components of the base system which should be kept updated.
Components world kernel</pre><p>這個參數控制 FreeBSD 的哪個部份將保持最新。
	預設是將更新整個 base system 和核心。
個別元件可以被指定，
例如：<code class="literal">src/base</code> 或 <code class="literal">src/sys</code>。
然而最好的選項是維持預設設定，
因為改變設定去包括特定項目，則每個需要的項目都必須要列出。
時間一久可能會因為原始碼和二進制檔案沒有更新而造成慘重的後果。</p><pre class="programlisting"># Paths which start with anything matching an entry in an IgnorePaths
# statement will be ignored.
IgnorePaths /boot/kernel/linker.hints</pre><p>保持特定的目錄，例如
	<code class="filename">/bin</code> 或 <code class="filename">/sbin</code>,
	在更新過程不被更動，可以將他們的路徑加到此敘述中。
	這個選項可以防止 <code class="command">freebsd-update</code>覆蓋本機的修改。</p><pre class="programlisting"># Paths which start with anything matching an entry in an UpdateIfUnmodified
# statement will only be updated if the contents of the file have not been
# modified by the user (unless changes are merged; see below).
UpdateIfUnmodified /etc/ /var/ /root/ /.cshrc /.profile</pre><p>這個選項只會更新特定目錄中未修改的設定檔。
	任何使用者修改的檔案都不會自動更新。
	有另一個選項──
	<code class="literal">KeepModifiedMetadata</code>會指示
	<code class="command">freebsd-update</code> 在合併時將改變儲存下來</p><pre class="programlisting"># When upgrading to a new FreeBSD release, files which match MergeChanges
# will have any local changes merged into the version from the new release.
MergeChanges /etc/ /var/named/etc/ /boot/device.hints</pre><p>列出 <code class="command">freebsd-update</code>應嘗試合併的設定檔目錄。
	檔案合併過程是一系列類似<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a>的<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a>修補，
但是選項比較少。
	合併可以接受，開啟編輯器，或是令<code class="command">freebsd-update</code>中止。
如果有疑慮，備份 <code class="filename">/etc</code>，然後同意合併。
	更多關於<code class="command">mergemaster</code>的資訊，
參見 <a class="xref" href="makeworld.html#mergemaster" title="24.6.4. Merging Configuration Files">節 24.6.4, “Merging Configuration Files”</a>。
	</p><pre class="programlisting"># Directory in which to store downloaded updates and temporary
# files used by FreeBSD Update.
# WorkDir /var/db/freebsd-update</pre><p>這個目錄是所有修補檔和暫存檔放置處。
	當使用者進行版本升級時，這個位置應該要有至少1GB的可用磁碟空間。</p><pre class="programlisting"># When upgrading between releases, should the list of Components be
# read strictly (StrictComponents yes) or merely as a list of components
# which *might* be installed of which FreeBSD Update should figure out
# which actually are installed and upgrade those (StrictComponents no)?
# StrictComponents no</pre><p>當這個選項設定為<code class="literal">yes</code>，
	<code class="command">freebsd-update</code> 將會假設
	<code class="literal">Components</code> 列表已完成，將不會嘗試做列表外的改變。
	實際上 <code class="command">freebsd-update</code>將嘗試更新每一個屬於
	<code class="literal">Components</code> 列表的檔案。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-security-patches"></a>24.2.2. 運用安全性修補</h3></div></div></div><p>運用 FreeBSD 安全性修補的過程已經被簡化，
	允許系統管理員使用<code class="command">freebsd-update</code>保持系統更新。
	更多關於FreeBSD 安全性報告的資訊可以參考
	<a class="xref" href="security-advisories.html" title="14.11. FreeBSD Security Advisories">節 14.11, “FreeBSD Security Advisories”</a>。</p><p>FreeBSD 安全性修補可以使用以下指令下載與安裝。
	第一個指令將決定是否有尚未完成的修補，如果有，將列出執行修補將會變更的檔案清單。第二個指令將會執行修補。
	</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update fetch</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><p>如果更新執行任何核心修補，系統將會重新開機以使用修補過的核心。
如果在任何執行中的二進位檔進行修補，被影響的應用程式將會重新啟動來使用修補過的二進位檔。</p><p>將以下項目加入 <code class="filename">/etc/crontab</code> 系統可以每天自動檢查是否有更新:</p><pre class="programlisting">@daily                                  root    freebsd-update cron</pre><p>如果有新的修補，它們將會自動下載，但是還不會執行。
	管理者<code class="systemitem">root</code> 將會收到email來檢視修補然後手動執行
	<code class="command">freebsd-update install</code> 來安裝</p><p>如果有發生任何錯誤，<code class="command">freebsd-update</code>
	可以使用以下指令回溯最後的變更：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update rollback</code></strong>
Uninstalling updates... done.</pre><p>再次，如果核心或任何核心模組有變更，系統將重新開機，受影響的二進位檔會重新執行。
	</p><p>只有 <code class="filename">GENERIC</code> 核心可以自動被
	<code class="command">freebsd-update</code> 更新。
	如果有安裝自訂的核心，在<code class="command">freebsd-update</code>
	完成安裝更新後，將會被重新編譯和重新安裝。
	然而，如果 <code class="filename">/boot/GENERIC</code> 存在，
	<code class="command">freebsd-update</code>將會偵測和更新 <code class="filename">GENERIC</code> 核心，
	即使他並非目前系統正在執行的核心。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">永遠在 <code class="filename">/boot/GENERIC</code> 保留一份 <code class="filename">GENERIC</code>
	  核心的備份。這對於診斷不同的問題與版本的升級有幫助。
	  參考<a class="xref" href="updating-upgrading-freebsdupdate.html#freebsd-update-custom-kernel-9x" title="24.2.3.1. FreeBSD 9.X 以上自訂核心">節 24.2.3.1, “ FreeBSD 9.X 以上自訂核心”</a> 或 <a class="xref" href="updating-upgrading-freebsdupdate.html#freebsd-update-custom-kernel-8x" title="24.2.3.2. FreeBSD 8.X 自訂核心">節 24.2.3.2, “FreeBSD 8.X 自訂核心”</a> 關於如何備份
	  <code class="filename">GENERIC</code> 核心的說明</p></div><p>除非 <code class="filename">/etc/freebsd-update.conf</code> 的預設設定被改變，
	<code class="command">freebsd-update</code>將安裝更新過的核心原始碼和其餘的更新
	然後就可以照平常的方式重新編譯和重新安裝新的自訂核心。</p><p>以 <code class="command">freebsd-update</code> 發行的更新並非總是包含核心。
	如果核心的原始碼沒有被 <code class="command">freebsd-update install</code> 變更，並不需要重新編譯自訂核心。
	然而 <code class="command">freebsd-update</code> 總是會更新
	<code class="filename">/usr/src/sys/conf/newvers.sh</code>。目前修補的程度，
	如同執行 <code class="command">uname -r</code> 顯示的 <code class="literal">-p</code>
	數字是由這個檔案取得。
	即使沒有做任何改變，重新編譯核心會讓 <code class="command">uname</code> 正確地報告目前系統修補的程度。
	這對於維護多個系統特別有幫助，可以讓你快速評估每個系統安裝的更新。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-upgrade"></a>24.2.3. 執行主要和次要的版本升級</h3></div></div></div><p>從FreeBSD的次要版本升級到另一個版本，例如從
	FreeBSD 9.0 到 FreeBSD 9.1, 叫作
	<em class="firstterm">次要版本</em>更新。
	<em class="firstterm">主要版本</em>更新發生在當 FreeBSD
	從一個主要版本升級到主要版本升級到另一個主要版本時
，例如從 FreeBSD 9.X 到 FreeBSD 10.X。
兩種更新都可以透過提供 <code class="command">freebsd-update</code> 發行版本來執行。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">如果系統正在執行自訂的核心，開始升級前，
	確定 <code class="filename">GENERIC</code> 核心的副本在
	  <code class="filename">/boot/GENERIC</code>。
	   參考<a class="xref" href="updating-upgrading-freebsdupdate.html#freebsd-update-custom-kernel-9x" title="24.2.3.1. FreeBSD 9.X 以上自訂核心">節 24.2.3.1, “ FreeBSD 9.X 以上自訂核心”</a> 或 <a class="xref" href="updating-upgrading-freebsdupdate.html#freebsd-update-custom-kernel-8x" title="24.2.3.2. FreeBSD 8.X 自訂核心">節 24.2.3.2, “FreeBSD 8.X 自訂核心”</a> 關於如何製作
	  <code class="filename">GENERIC</code>核心副本的說明。</p></div><p>以下的指令執行在 FreeBSD 9.0 系統時，
	將會把系統升級至 FreeBSD 9.1：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update -r 9.1-RELEASE upgrade</code></strong></pre><p>當收到這個指令後，
	<code class="command">freebsd-update</code> 將會評估設定檔和目前的系統來收集升級需要的資訊。
	螢幕上的清單會顯示偵測到或沒偵測到哪些元件。例如： </p><pre class="screen">Looking up update.FreeBSD.org mirrors... 1 mirrors found.
Fetching metadata signature for 9.0-RELEASE from update1.FreeBSD.org... done.
Fetching metadata index... done.
Inspecting system... done.

The following components of FreeBSD seem to be installed:
kernel/smp src/base src/bin src/contrib src/crypto src/etc src/games
src/gnu src/include src/krb5 src/lib src/libexec src/release src/rescue
src/sbin src/secure src/share src/sys src/tools src/ubin src/usbin
world/base world/info world/lib32 world/manpages

The following components of FreeBSD do not seem to be installed:
kernel/generic world/catpages world/dict world/doc world/games
world/proflibs

Does this look reasonable (y/n)? <strong class="userinput"><code>y</code></strong></pre><p>此時，<code class="command">freebsd-update</code> 將嘗試下載所有升級需要的檔案。
在某些案例，使用者會被提示一些關於安裝什麼或是如何進行的問題。</p><p>當使用自訂核心，上述的步驟將會產生如下列的警告：</p><pre class="screen">WARNING: This system is running a "<em class="replaceable"><code>MYKERNEL</code></em>" kernel, which is not a
kernel configuration distributed as part of FreeBSD 9.0-RELEASE.
This kernel will not be updated: you MUST update the kernel manually
before running "/usr/sbin/freebsd-update install"</pre><p>這個警告可以安全地忽略，升級過程將會立即使用更新過的
	 <code class="filename">GENERIC</code> 核心</p><p>一旦所有的修補都被下載到本地的系統，
	它們將會被運用。這個過程可能會花點時間，取決於機器的速度和工作量
	設定檔將會被合併。
	合併的過程中當檔案被合併或是手動合併螢幕上出現編輯器時需要使用者介入。
	每一個成功合併的結果將會顯示給使用者。
	失敗或是被忽略的合併將會使程序中斷。使用者稍候可能想要備份
	<code class="filename">/etc</code> 和手動合併重要的檔案，例如：
	<code class="filename">master.passwd</code> 或
	<code class="filename">group</code> 。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">當所有修補和合併在另一個目錄進行時，系統還不會被警告。
	  一旦所有修補都成功運用，所有設定檔都被合併，而且過程順利，使用者可以以下指令來將這些改變付諸於磁碟上：</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre></div><p>核心和核心模組將會先被修補。如果系統正在執行自訂核心，使用
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=nextboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">nextboot</span>(8)</span></a> 指令設定下次開機的核心為更新過的
	<code class="filename">/boot/GENERIC</code>：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>nextboot -k GENERIC</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">如果機器以遠端遙控來更新，
	  使用<code class="filename">GENERIC</code>核心重新開機前，
	  確定他包含所有系統開機需要的驅動程式而且連接網路，
	  特別是當執行的自訂核心包含核心模組提供內建功能時，
	  確定暫時地使用 <code class="filename">/boot/loader.conf</code> 工具載入這些模組到 <code class="filename">GENERIC</code> 核心。
	  建議停用非必須的服務和磁碟與網路掛載直到升級程序完成。
	  </p></div><p>機器現在應該更新過的核心重新開機：
	</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre><p>一旦系統重新上線，使用以下指令重新開始
	<code class="command">freebsd-update</code>。
	因為程序的狀態已被儲存，
	<code class="command">freebsd-update</code> 將不會重頭開始，他會進行到下一個階段
	，移除所有舊的共用程式庫和目標檔。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">根據程式庫版本編號， 可能有兩個而不是三個安裝階段。</p></div><p>升級程序現在完成了。如果這是主要的版本升級，參考
	<a class="xref" href="updating-upgrading-freebsdupdate.html#freebsdupdate-portsrebuild" title="24.2.3.3. 主要版本更新後更新 Packages">節 24.2.3.3, “主要版本更新後更新 Packages”</a>
	的描述重新安裝所有的ports和套件。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsd-update-custom-kernel-9x"></a>24.2.3.1.  FreeBSD 9.X 以上自訂核心</h4></div></div></div><p>使用 <code class="command">freebsd-update</code> 前，確定有一份核心的副本, ensure
	  that a copy of the <code class="filename">GENERIC</code> kernel
	  exists in <code class="filename">/boot/GENERIC</code>.  If a custom
	  kernel has only been built once, the kernel in
	  <code class="filename">/boot/kernel.old</code> is the
	  <code class="literal">GENERIC</code> kernel.  Simply rename this
	  directory to <code class="filename">/boot/kernel</code>.</p><p>If a custom kernel has been built more than once or if
	  it is unknown how many times the custom kernel has been
	  built, obtain a copy of the <code class="literal">GENERIC</code>
	  kernel that matches the current version of the operating
	  system.  If physical access to the system is available, a
	  copy of the <code class="literal">GENERIC</code> kernel can be
	  installed from the installation media:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /cdrom</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /cdrom/usr/freebsd-dist</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tar -C/ -xvf kernel.txz boot/kernel/kernel</code></strong></pre><p>Alternately, the <code class="literal">GENERIC</code> kernel may
	  be rebuilt and installed from source:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make kernel __MAKE_CONF=/dev/null SRCCONF=/dev/null</code></strong></pre><p>For this kernel to be identified as the
	  <code class="literal">GENERIC</code> kernel by
	  <code class="command">freebsd-update</code>, the
	  <code class="filename">GENERIC</code> configuration file must not
	  have been modified in any way.  It is also suggested that
	  the kernel is built without any other special
	  options.</p><p>Rebooting into the <code class="filename">GENERIC</code> kernel
	  is not required as <code class="command">freebsd-update</code> only
	  needs <code class="filename">/boot/GENERIC</code> to exist.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsd-update-custom-kernel-8x"></a>24.2.3.2. FreeBSD 8.X 自訂核心</h4></div></div></div><p>On an FreeBSD 8.X system, the instructions for
	  obtaining or building a <code class="filename">GENERIC</code> kernel
	  differ slightly.</p><p>Assuming physical access to the machine is possible, a
	  copy of the <code class="filename">GENERIC</code> kernel can be
	  installed from the installation media using the following
	  commands:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /cdrom</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /cdrom/<em class="replaceable"><code>X.Y-RELEASE</code></em>/kernels</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>./install.sh GENERIC</code></strong></pre><p>Replace <code class="filename"><em class="replaceable"><code>X.Y-RELEASE</code></em></code>
	  with the version of the release being used.  The
	  <code class="filename">GENERIC</code> kernel will be installed in
	  <code class="filename">/boot/GENERIC</code> by default.</p><p>To instead build the <code class="filename">GENERIC</code> kernel
	  from source:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>env DESTDIR=/boot/GENERIC make kernel __MAKE_CONF=/dev/null SRCCONF=/dev/null</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv /boot/GENERIC/boot/kernel/* /boot/GENERIC</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -rf /boot/GENERIC/boot</code></strong></pre><p>For this kernel to be picked up as
	  <code class="filename">GENERIC</code> by
	  <code class="command">freebsd-update</code>, the
	  <code class="filename">GENERIC</code> configuration file must not
	  have been modified in any way.  It is also suggested that it
	  is built without any other special options.</p><p>Rebooting into the <code class="filename">GENERIC</code> kernel
	  is not required.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-portsrebuild"></a>24.2.3.3. 主要版本更新後更新 Packages</h4></div></div></div><p>一般來說，次要版本更新後安裝的應用程式可以沒有問題地繼續執行。
	  主要版本間使用不同的應用程式二進位介面 Application Binary Interfaces
	  (<acronym class="acronym">ABI</acronym>s)，會破壞大部份第三方應用程式。
	  主要版本更新後，所有安裝的套件和 ports 需要使用應用程式來升級，例如
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmaster/pkg-descr">ports-mgmt/portmaster</a>
	  重新編譯所有應用程式，可以使用以下指令完成：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmaster -af</code></strong></pre><p>這個指令將會顯示每個程式的設定選項設定畫面，等待使用者的互動。
	  如果要使用預設的選項，可以在上述指令使用<code class="option">-G</code>選項。
	  </p><p>一旦軟體升級完成, 執行
	  <code class="command">freebsd-update</code> 來完成所有升級過程的零碎事情 ：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><p>如果是暫時使用 <code class="filename">GENERIC</code> 核心，
	  現在請使用
	<a class="xref" href="kernelconfig.html" title="章 9. 設定 FreeBSD Kernel">章 9, <em>設定 FreeBSD Kernel</em></a>的說明編譯和安裝新的自訂核心。</p><p>重新開機進入新版的 FreeBSD。現在已經完成升級過程了。
	  </p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-system-comparison"></a>24.2.4. 系統狀態比較</h3></div></div></div><p>已安裝的 FreeBSD 版本可以使用 <code class="command">freebsd-update IDS</code>
來跟另一個已知好的複製版本來做測試。
這個指令評估系統應用程式，程式庫和設定檔案目前的版本，
可以被當成內建的入侵偵測系統來使用 (<acronym class="acronym">IDS</acronym>)。</p><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">這個指令不是取代真正的
	  <acronym class="acronym">IDS</acronym> ，例如
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/snort/pkg-descr">security/snort</a>。當
	  <code class="command">freebsd-update</code> 儲存資料在磁碟裡，是有被竄改的可能性
	  可以使用 <code class="varname">kern.securelevel</code>
	  或是將沒有在使用的 <code class="command">freebsd-update</code>
	  的資料儲存在唯讀檔案系統來減少這樣的可能性，
	  比較好的解決方法是將系統和安全的磁碟，例如
	  <acronym class="acronym">DVD</acronym> 或是安全的外接
	  <acronym class="acronym">USB</acronym> 磁碟裝置做比較。
	  另類的方法是使用在 <a class="xref" href="security-intro.html#security-ids" title="14.2.6. Binary Verification">節 14.2.6, “Binary Verification”</a> 描述的內建應用程式提供的
	  <acronym class="acronym">IDS</acronym> 功能</p></div><p>為了開始比較，先指定特定的輸出檔案來儲存結果：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update IDS &gt;&gt; outfile.ids</code></strong></pre><p>現在系統將會被檢查，
	而包含已知發行版和現在安裝版的<acronym class="acronym">SHA256</acronym>雜湊值
	的冗長檔案清單將會被送至指定的輸出檔。</p><p>清單的項目相當長，但是輸出格式很容易被分析。
	例如，要獲得一個和發行版不同的檔案清單，可以下以下指令：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat outfile.ids | awk '{ print $1 }' | more</code></strong>
/etc/master.passwd
/etc/motd
/etc/passwd
/etc/pf.conf</pre><p>這個輸出範例已經被截短，原來有更多的檔案存在。
	有些檔案自然會有修改。例如，如果有使用者被加入系統，
	<code class="filename">/etc/passwd</code> 會被修改
	如果 <code class="command">freebsd-update</code> 有更新過，核心模組可能會不同
	 為了要排除特定的檔案或目錄，把它們加到<code class="filename">/etc/freebsd-update.conf</code> 裡的 <code class="literal">IDSIgnorePaths</code> 選項。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="updating-upgrading.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="updating-upgrading.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="updating-upgrading-documentation.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">章 24. 更新、升級 FreeBSD </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 24.3. 更新文件組</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>