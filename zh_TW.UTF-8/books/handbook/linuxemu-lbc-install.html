<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>11.2. 安裝</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="linuxemu.html" title="章 11. 與 Linux Binary 的相容方面" /><link rel="prev" href="linuxemu.html" title="章 11. 與 Linux Binary 的相容方面" /><link rel="next" href="linuxemu-mathematica.html" title="11.3. Installing Mathematica®" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">11.2. 安裝</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="linuxemu.html">前一頁</a> </td><th width="60%" align="center">章 11. 與 Linux Binary 的相容方面</th><td width="20%" align="right"> <a accesskey="n" href="linuxemu-mathematica.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-lbc-install"></a>11.2. 安裝</h2></div></div></div><a id="idp74914000" class="indexterm"></a><p>預設並不會打開 Linux 相容模式，最簡單的啟用方式，就是載入
      <code class="literal">linux</code> KLD object (<span class="quote">“<span class="quote">Kernel LoaDable
      object</span>”</span>)。  載入方式，請切為 <code class="systemitem">root</code>
      權限，然後打下列指令：</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload linux</code></strong></pre><p>若要每次開機都啟用的話，請把下列內容加到
      <code class="filename">/etc/rc.conf</code> 檔：</p><pre class="programlisting">linux_enable="YES"</pre><p>另外可以用 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldstat</span>(8)</span></a> 指令，來確認有哪些 KLD 有載入：</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>kldstat</code></strong>
Id Refs Address    Size     Name
 1    2 0xc0100000 16bdb8   kernel
 7    1 0xc24db000 d000     linux.ko</pre><a id="idp74928720" class="indexterm"></a><p>If for some reason you do not want to or cannot load the KLD,
      then you may statically link Linux binary compatibility into the kernel
      by adding <code class="literal">options COMPAT_LINUX</code> to your kernel
      configuration file.  Then install your new kernel as described in
      <a class="xref" href="kernelconfig.html" title="章 9. 設定 FreeBSD Kernel">章 9, <em>設定 FreeBSD Kernel</em></a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74931024"></a>11.2.1. Installing Linux Runtime Libraries</h3></div></div></div><a id="idp74931664" class="indexterm"></a><p>This can be done one of two ways, either by using the
	<a class="link" href="linuxemu-lbc-install.html#linuxemu-libs-port" title="11.2.1.1. Installing Using the linux_base Port">linux_base</a> port, or
	by installing them <a class="link" href="linuxemu-lbc-install.html#linuxemu-libs-manually" title="11.2.1.2. Installing Libraries Manually">manually</a>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="linuxemu-libs-port"></a>11.2.1.1. Installing Using the linux_base Port</h4></div></div></div><a id="idp74934992" class="indexterm"></a><p>This is by far the easiest method to use when installing the
	  runtime libraries.  It is just like installing any other port
	  from the <a class="link" href="file://localhost/usr/ports/" target="_top">Ports Collection</a>.
	  Simply do the following:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/emulators/linux_base-fc4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install distclean</code></strong></pre><p>You should now have working Linux binary compatibility.
	  Some programs may complain about incorrect minor versions of the
	  system libraries.  In general, however, this does not seem to be
	  a problem.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">There may be multiple versions of the <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/emulators/linux_base/pkg-descr">emulators/linux_base</a> port available,
	  corresponding to different versions of various Linux distributions.
	  You should install the port most closely resembling the
	  requirements of the Linux applications you would like to
	  install.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="linuxemu-libs-manually"></a>11.2.1.2. Installing Libraries Manually</h4></div></div></div><p>If you do not have the <span class="quote">“<span class="quote">ports</span>”</span> collection
	  installed, you can install the libraries by hand instead.  You
	  will need the Linux shared libraries that the program depends on
	  and the runtime linker.  Also, you will need to create a
	  <span class="quote">“<span class="quote">shadow root</span>”</span> directory,
	  <code class="filename">/compat/linux</code>, for Linux libraries on your
	  FreeBSD system.  Any shared libraries opened by Linux programs
	  run under FreeBSD will look in this tree first.  So, if a Linux
	  program loads, for example, <code class="filename">/lib/libc.so</code>,
	  FreeBSD will first try to open
	  <code class="filename">/compat/linux/lib/libc.so</code>, and if that does
	  not exist, it will then try <code class="filename">/lib/libc.so</code>.
	  Shared libraries should be installed in the shadow tree
	  <code class="filename">/compat/linux/lib</code> rather than the paths
	  that the Linux <code class="command">ld.so</code> reports.</p><p>Generally, you will need to look for the shared libraries
	  that Linux binaries depend on only the first few times that you
	  install a Linux program on your FreeBSD system.  After a while,
	  you will have a sufficient set of Linux shared libraries on your
	  system to be able to run newly imported Linux binaries without
	  any extra work.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74964816"></a>11.2.1.3. How to Install Additional Shared Libraries</h4></div></div></div><a id="idp74965584" class="indexterm"></a><p>What if you install the <code class="filename">linux_base</code> port
	  and your application still complains about missing shared
	  libraries?  How do you know which shared libraries Linux
	  binaries need, and where to get them?  Basically, there are 2
	  possibilities (when following these instructions you will need
	  to be <code class="systemitem">root</code> on your FreeBSD system).</p><p>If you have access to a Linux system, see what shared
	  libraries the application needs, and copy them to your FreeBSD
	  system.  Look at the following example:</p><div class="informalexample"><p>Let us assume you used FTP to get the Linux binary of
	    <span class="application">Doom</span>, and put it on a Linux system you have access to.  You
	    then can check which shared libraries it needs by running
	    <code class="command">ldd linuxdoom</code>, like so:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ldd linuxdoom</code></strong>
libXt.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libXt.so.3.1.0
libX11.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libX11.so.3.1.0
libc.so.4 (DLL Jump 4.5pl26) =&gt; /lib/libc.so.4.6.29</pre><a id="idp74970320" class="indexterm"></a><p>You would need to get all the files from the last column,
	    and put them under <code class="filename">/compat/linux</code>, with
	    the names in the first column as symbolic links pointing to
	    them.  This means you eventually have these files on your
	    FreeBSD system:</p><pre class="screen">/compat/linux/usr/X11/lib/libXt.so.3.1.0
/compat/linux/usr/X11/lib/libXt.so.3 -&gt; libXt.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3 -&gt; libX11.so.3.1.0
/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</pre><div class="blockquote"><blockquote class="blockquote"><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">Note that if you already have a Linux shared library
		with a matching major revision number to the first column
		of the <code class="command">ldd</code> output, you will not need to
		copy the file named in the last column to your system, the
		one you already have should work.  It is advisable to copy
		the shared library anyway if it is a newer version,
		though.  You can remove the old one, as long as you make
		the symbolic link point to the new one.  So, if you have
		these libraries on your system:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">/compat/linux/lib/libc.so.4.6.27
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.27</pre><p xmlns="http://www.w3.org/1999/xhtml">and you find a new binary that claims to require a
		later version according to the output of
		<code class="command">ldd</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">libc.so.4 (DLL Jump 4.5pl26) -&gt; libc.so.4.6.29</pre><p xmlns="http://www.w3.org/1999/xhtml">If it is only one or two versions out of date in the
		in the trailing digit then do not worry about copying
		<code class="filename">/lib/libc.so.4.6.29</code> too, because the
		program should work fine with the slightly older version.
		However, if you like, you can decide to replace the
		<code class="filename">libc.so</code> anyway, and that should leave
		you with:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</pre></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">The symbolic link mechanism is
		<span class="emphasis"><em>only</em></span> needed for Linux binaries.  The
		FreeBSD runtime linker takes care of looking for matching
		major revision numbers itself and you do not need to worry
		about it.</p></div></blockquote></div></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74979024"></a>11.2.2. Installing Linux ELF Binaries</h3></div></div></div><a id="idp74979664" class="indexterm"></a><p>ELF binaries sometimes require an extra step of
	<span class="quote">“<span class="quote">branding</span>”</span>.  If you attempt to run an unbranded ELF
	binary, you will get an error message like the following:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>./my-linux-elf-binary</code></strong>
ELF binary type not known
Abort</pre><p>To help the FreeBSD kernel distinguish between a FreeBSD ELF
	binary from a Linux binary, use the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>
	utility.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>brandelf -t Linux my-linux-elf-binary</code></strong></pre><a id="idp74992976" class="indexterm"></a><p>The GNU toolchain now places the appropriate branding
	information into ELF binaries automatically, so this step
	should become increasingly unnecessary in the future.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74994000"></a>11.2.3. Configuring the Hostname Resolver</h3></div></div></div><p>If DNS does not work or you get this message:</p><pre class="screen">resolv+: "bind" is an invalid keyword resolv+:
"hosts" is an invalid keyword</pre><p>You will need to configure a
	<code class="filename">/compat/linux/etc/host.conf</code> file
	containing:</p><pre class="programlisting">order hosts, bind
multi on</pre><p>The order here specifies that <code class="filename">/etc/hosts</code>
	is searched first and DNS is searched second.  When
	<code class="filename">/compat/linux/etc/host.conf</code> is not
	installed, Linux applications find FreeBSD's
	<code class="filename">/etc/host.conf</code> and complain about the
	incompatible FreeBSD syntax.  You should remove
	<code class="literal">bind</code> if you have not configured a name server
	using the <code class="filename">/etc/resolv.conf</code> file.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="linuxemu.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="linuxemu.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="linuxemu-mathematica.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">章 11. 與 Linux Binary 的相容方面 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 11.3. Installing <span class="trademark">Mathematica</span>®</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>