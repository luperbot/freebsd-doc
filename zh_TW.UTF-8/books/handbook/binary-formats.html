<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>4.13. Binary 的格式</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="basics.html" title="章 4. UNIX 基礎概念" /><link rel="prev" href="basics-devices.html" title="4.12. 設備及設備節點" /><link rel="next" href="basics-more-information.html" title="4.14. 更多資訊" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.13. Binary 的格式</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="basics-devices.html">前一頁</a> </td><th width="60%" align="center">章 4. UNIX 基礎概念</th><td width="20%" align="right"> <a accesskey="n" href="basics-more-information.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="binary-formats"></a>4.13. Binary 的格式</h2></div></div></div><p>若要知道為何 FreeBSD 是採用 <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=elf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">elf</span>(5)</span></a> 格式，必先瞭解當前 <span class="trademark">UNIX</span>®
      系統中三種<span class="quote">“<span class="quote">影響最為重大</span>”</span>的可執行檔相關背景：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=a.out&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">a.out</span>(5)</span></a></p><p>最古老、<span class="quote">“<span class="quote">經典</span>”</span> 的 <span class="trademark">UNIX</span>® object 檔格式。
          It uses a short and compact header with a magic
          number at the beginning that is often used to characterize
          the format (see <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=a.out&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">a.out</span>(5)</span></a> for more details).  It
          contains three loaded segments: .text, .data, and .bss plus
          a symbol table and a string table.</p></li><li class="listitem"><p><acronym class="acronym">COFF</acronym></p><p>The SVR3 object format.  The header now comprises a
          section table, so you can have more than just .text, .data,
          and .bss sections.</p></li><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=elf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">elf</span>(5)</span></a></p><p>The successor to <acronym class="acronym">COFF</acronym>, featuring
          multiple sections and 32-bit or 64-bit possible values.  One
          major drawback: <acronym class="acronym">ELF</acronym> was also designed
          with the assumption that there would be only one ABI per
          system architecture.  That assumption is actually quite
          incorrect, and not even in the commercial SYSV world (which
          has at least three ABIs: SVR4, Solaris, SCO) does it hold
          true.</p><p>FreeBSD tries to work around this problem somewhat by
          providing a utility for <span class="emphasis"><em>branding</em></span> a
          known <acronym class="acronym">ELF</acronym> executable with information
          about the ABI it is compliant with.  See the manual page for
          <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a> for more information.</p></li></ul></div><p>FreeBSD comes from the <span class="quote">“<span class="quote">classic</span>”</span> camp and used
      the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=a.out&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">a.out</span>(5)</span></a> format, a technology tried and proven through
      many generations of BSD releases, until the beginning of the 3.X
      branch. Though it was possible to build and run native
      <acronym class="acronym">ELF</acronym> binaries (and kernels) on a FreeBSD
      system for some time before that, FreeBSD initially resisted the
      <span class="quote">“<span class="quote">push</span>”</span> to switch to <acronym class="acronym">ELF</acronym> as the
      default format. Why?  Well, when the Linux camp made their
      painful transition to <acronym class="acronym">ELF</acronym>, it was not so much
      to flee the <code class="filename">a.out</code> executable format as it
      was their inflexible jump-table based shared library mechanism,
      which made the construction of shared libraries very difficult
      for vendors and developers alike. Since the
      <acronym class="acronym">ELF</acronym> tools available offered a solution to the
      shared library problem and were generally seen as <span class="quote">“<span class="quote">the way
      forward</span>”</span> anyway, the migration cost was accepted as
      necessary and the transition made.  FreeBSD's shared library
      mechanism is based more closely on Sun's
      <span class="trademark">SunOS</span>™ style shared library mechanism
      and, as such, is very easy to use.</p><p>So, why are there so many different formats?</p><p>Back in the dim, dark past, there was simple hardware.  This
      simple hardware supported a simple, small system. <code class="filename">a.out</code> was
      completely adequate for the job of representing binaries on this
      simple system (a PDP-11). As people ported <span class="trademark">UNIX</span>® from this simple
      system, they retained the <code class="filename">a.out</code> format because it was sufficient
      for the early ports of <span class="trademark">UNIX</span>® to architectures like the Motorola
      68k, VAXen, etc.</p><p>Then some bright hardware engineer decided that if he could
      force software to do some sleazy tricks, then he would be able
      to shave a few gates off the design and allow his CPU core to
      run faster. While it was made to work with this new kind of
      hardware (known these days as <acronym class="acronym">RISC</acronym>), <code class="filename">a.out</code>
      was ill-suited for this hardware, so many formats were developed
      to get to a better performance from this hardware than the
      limited, simple <code class="filename">a.out</code> format could
      offer. Things like <acronym class="acronym">COFF</acronym>,
      <acronym class="acronym">ECOFF</acronym>, and a few obscure others were invented
      and their limitations explored before things seemed to settle on
      <acronym class="acronym">ELF</acronym>.</p><p>In addition, program sizes were getting huge and disks (and
      physical memory) were still relatively small so the concept of a
      shared library was born. The VM system also became more
      sophisticated. While each one of these advancements was done
      using the <code class="filename">a.out</code> format, its usefulness was
      stretched more and more with each new feature.  In addition,
      people wanted to dynamically load things at run time, or to junk
      parts of their program after the init code had run to save in
      core memory and swap space. Languages became more sophisticated
      and people wanted code called before main automatically. Lots of
      hacks were done to the <code class="filename">a.out</code> format to
      allow all of these things to happen, and they basically worked
      for a time. In time, <code class="filename">a.out</code> was not up to
      handling all these problems without an ever increasing overhead
      in code and complexity. While <acronym class="acronym">ELF</acronym> solved many
      of these problems, it would be painful to switch from the system
      that basically worked. So <acronym class="acronym">ELF</acronym> had to wait
      until it was more painful to remain with
      <code class="filename">a.out</code> than it was to migrate to
      <acronym class="acronym">ELF</acronym>.</p><p>However, as time passed, the build tools that FreeBSD
      derived their build tools from (the assembler and loader
      especially) evolved in two parallel trees. The FreeBSD tree
      added shared libraries and fixed some bugs. The GNU folks that
      originally wrote these programs rewrote them and added simpler
      support for building cross compilers, plugging in different
      formats at will, and so on. Since many people wanted to build cross
      compilers targeting FreeBSD, they were out of luck since the
      older sources that FreeBSD had for <span class="application">as</span> and <span class="application">ld</span> were not up to the
      task. The new GNU tools chain (<span class="application">binutils</span>) does support cross
      compiling, <acronym class="acronym">ELF</acronym>, shared libraries, C++
      extensions, etc. In addition, many vendors are releasing
      <acronym class="acronym">ELF</acronym> binaries, and it is a good thing for
      FreeBSD to run them.</p><p><acronym class="acronym">ELF</acronym> is more expressive than <code class="filename">a.out</code> and
      allows more extensibility in the base system. The
      <acronym class="acronym">ELF</acronym> tools are better maintained, and offer
      cross compilation support, which is important to many people.
      <acronym class="acronym">ELF</acronym> may be a little slower than <code class="filename">a.out</code>, but
      trying to measure it can be difficult. There are also numerous
      details that are different between the two in how they map
      pages, handle init code, etc. None of these are very important,
      but they are differences. In time support for
      <code class="filename">a.out</code> will be moved out of the <code class="filename">GENERIC</code>
      kernel, and eventually removed from the kernel once the need to
      run legacy <code class="filename">a.out</code> programs is past.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="basics-devices.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="basics.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="basics-more-information.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">4.12. 設備及設備節點 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 4.14. 更多資訊</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>