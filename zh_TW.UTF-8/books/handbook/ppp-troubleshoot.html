<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>27.4. Troubleshooting PPP Connections</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="ppp-and-slip.html" title="章 27. PPP and SLIP" /><link rel="prev" href="ppp.html" title="27.3. Using Kernel PPP" /><link rel="next" href="pppoe.html" title="27.5. Using PPP over Ethernet (PPPoE)" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">27.4. Troubleshooting <acronym class="acronym">PPP</acronym> Connections</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ppp.html">前一頁</a> </td><th width="60%" align="center">章 27. PPP and SLIP</th><td width="20%" align="right"> <a accesskey="n" href="pppoe.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ppp-troubleshoot"></a>27.4. Troubleshooting <acronym class="acronym">PPP</acronym> Connections</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp86155984" class="indexterm"></a><p>This section covers a few issues which may arise when
	using PPP over a modem connection.  For instance, perhaps you
	need to know exactly what prompts the system you are dialing
	into will present.  Some <acronym class="acronym">ISP</acronym>s present the
	<code class="literal">ssword</code> prompt, and others will present
	<code class="literal">password</code>; if the <code class="command">ppp</code>
	script is not written accordingly, the login attempt will
	fail.  The most common way to debug <code class="command">ppp</code>
	connections is by connecting manually.  The following
	information will walk you through a manual connection step by
	step.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86159184"></a>27.4.1. Check the Device Nodes</h3></div></div></div><p>If you reconfigured your kernel then you recall the
	  <code class="filename">sio</code> device.  If you did not
	  configure your kernel, there is no reason to worry.  Just
	  check the <code class="command">dmesg</code> output for the modem
	  device with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dmesg | grep sio</code></strong></pre><p>You should get some pertinent output about the
	  <code class="filename">sio</code> devices.  These are the COM
	  ports we need.  If your modem acts like a standard serial
	  port then you should see it listed on
	  <code class="filename">sio1</code>, or <code class="filename">COM2</code>.  If so, you are not
	  required to rebuild the kernel, you just need to make the
	  serial device.  You can do this by changing your directory
	  to <code class="filename">/dev</code> and running the
	  <code class="filename">MAKEDEV</code> script like above.  Now make
	  the serial devices with:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh MAKEDEV cuaa0 cuaa1 cuaa2 cuaa3</code></strong></pre><p>which will create the serial devices for your system.
	  When matching up sio modem is on <code class="filename">sio1</code> or
          <code class="filename">COM2</code> if you are in DOS, then your
	  modem device would be <code class="filename">/dev/cuaa1</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86166864"></a>27.4.2. Connecting Manually</h3></div></div></div><p>Connecting to the Internet by manually controlling
	<code class="command">ppp</code> is quick, easy, and a great way to
	debug a connection or just get information on how your
	<acronym class="acronym">ISP</acronym> treats <code class="command">ppp</code> client
	connections.  Lets start <span class="application">PPP</span> from
	the command line.  Note that in all of our examples we will
	use <span class="emphasis"><em>example</em></span> as the hostname of the
	machine running <span class="application">PPP</span>.  You start
	<code class="command">ppp</code> by just typing
	<code class="command">ppp</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ppp</code></strong></pre><p>We have now started <code class="command">ppp</code>.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>set device /dev/cuaa1</code></strong></pre><p>We set our modem device, in this case it is
	<code class="filename">cuaa1</code>.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>set speed 115200</code></strong></pre><p>Set the connection speed, in this case we
	are using 115,200 <acronym class="acronym">kbps</acronym>.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>enable dns</code></strong></pre><p>Tell <code class="command">ppp</code> to configure our
	resolver and add the nameserver lines to
	<code class="filename">/etc/resolv.conf</code>.  If <code class="command">ppp</code>
	cannot determine our hostname, we can set one manually later.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>term</code></strong></pre><p>Switch to <span class="quote">“<span class="quote">terminal</span>”</span> mode so that we can manually
	control the modem.</p><pre class="programlisting">deflink: Entering terminal mode on <code class="filename">/dev/cuaa1</code>
type '~h' for help</pre><pre class="screen"><strong class="userinput"><code>at</code></strong>
OK
<strong class="userinput"><code>atdt123456789</code></strong></pre><p>Use <code class="command">at</code> to initialize the modem,
	then use <code class="command">atdt</code> and the number for your
	<acronym class="acronym">ISP</acronym> to begin the dial in process.</p><pre class="screen">CONNECT</pre><p>Confirmation of the connection, if we are going to have
	any connection problems, unrelated to hardware, here is where
	we will attempt to resolve them.</p><pre class="screen">ISP Login:<strong class="userinput"><code>myusername</code></strong></pre><p>Here you are prompted for a username, return the
	prompt with the username that was provided by the
	<acronym class="acronym">ISP</acronym>.</p><pre class="screen">ISP Pass:<strong class="userinput"><code>mypassword</code></strong></pre><p>This time we are prompted for a password, just
	reply with the password that was provided by the
	<acronym class="acronym">ISP</acronym>.  Just like logging into
	FreeBSD, the password will not echo.</p><pre class="screen">Shell or PPP:<strong class="userinput"><code>ppp</code></strong></pre><p>Depending on your <acronym class="acronym">ISP</acronym> this prompt
	may never appear.  Here we are being asked if we wish to
	use a shell on the provider, or to start
	<code class="command">ppp</code>.  In this example, we have chosen
	to use <code class="command">ppp</code> as we want an Internet
	connection.</p><pre class="screen">Ppp ON example&gt;</pre><p>Notice that in this example the first <code class="option">p</code>
	has been capitalized.  This shows that we have successfully
	connected to the <acronym class="acronym">ISP</acronym>.</p><pre class="screen">PPp ON example&gt;</pre><p>We have successfully authenticated with our
	<acronym class="acronym">ISP</acronym> and are waiting for the
	assigned <acronym class="acronym">IP</acronym> address.</p><pre class="screen">PPP ON example&gt;</pre><p>We have made an agreement on an <acronym class="acronym">IP</acronym>
	address and successfully completed our connection.</p><pre class="screen">PPP ON example&gt;<strong class="userinput"><code>add default HISADDR</code></strong></pre><p>Here we add our default route, we need to do this before
	we can talk to the outside world as currently the only
	established connection is with the peer.  If this fails due to
	existing routes you can put a bang character
	<code class="literal">!</code> in front of the <code class="option">add</code>.
	Alternatively, you can set this before making the actual
	connection and it will negotiate a new route
	accordingly.</p><p>If everything went good we should now have an active
	connection to the Internet, which could be thrown into the
	background using <span class="keycap"><strong>CTRL</strong></span>+<span class="keycap"><strong>z</strong></span> If you notice the
	<code class="command">PPP</code> return to <code class="command">ppp</code> then
	we have lost our connection.  This is good to know because it
	shows our connection status.  Capital P's show that we have a
	connection to the <acronym class="acronym">ISP</acronym> and lowercase p's
	show that the connection has been lost for whatever reason.
	<code class="command">ppp</code> only has these 2 states.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86205904"></a>27.4.2.1. Debugging</h4></div></div></div><p>If you have a direct line and cannot seem to make a
	  connection, then turn hardware flow
	  <acronym class="acronym">CTS/RTS</acronym> to off with the <code class="option">set
	  ctsrts off</code>.  This is mainly the case if you are
	  connected to some <span class="application">PPP</span> capable
	  terminal servers, where <span class="application">PPP</span> hangs
	  when it tries to write data to your communication link, so
	  it would be waiting for a <acronym class="acronym">CTS</acronym>, or Clear
	  To Send signal which may never come.  If you use this option
	  however, you should also use the <code class="option">set accmap</code>
	  option, which may be required to defeat hardware dependent
	  on passing certain characters from end to end, most of the
	  time XON/XOFF.  See the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> manual page for more
	  information on this option, and how it is used.</p><p>If you have an older modem, you may need to use the
	  <code class="option">set parity even</code>.  Parity is set at none
	  be default, but is used for error checking (with a large
	  increase in traffic) on older modems and some
	  <acronym class="acronym">ISP</acronym>s.  You may need this option for
	  the Compuserve <acronym class="acronym">ISP</acronym>.</p><p><span class="application">PPP</span> may not return to the
	  command mode, which is usually a negotiation error where
	  the <acronym class="acronym">ISP</acronym> is waiting for your side to start
	  negotiating.  At this point, using the <code class="command">~p</code>
	  command will force ppp to start sending the configuration
	  information.</p><p>If you never obtain a login prompt, then most likely you
	  need to use <acronym class="acronym">PAP</acronym> or
	  <acronym class="acronym">CHAP</acronym> authentication instead of the
	  <span class="trademark">UNIX</span>® style in the example above.  To use
	  <acronym class="acronym">PAP</acronym> or <acronym class="acronym">CHAP</acronym> just add
	  the following options to <span class="application">PPP</span>
	  before going into terminal mode:</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>set authname myusername</code></strong></pre><p>Where <em class="replaceable"><code>myusername</code></em> should be
	  replaced with the username that was assigned by the
	  <acronym class="acronym">ISP</acronym>.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>set authkey mypassword</code></strong></pre><p>Where <em class="replaceable"><code>mypassword</code></em> should be
	  replaced with the password that was assigned by the
	  <acronym class="acronym">ISP</acronym>.</p><p>If you connect fine, but cannot seem to find any domain
	  name, try to use <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> with an <acronym class="acronym">IP</acronym>
	  address and see if you can get any return information.  If
	  you experience 100 percent (100%) packet loss, then it is most
	  likely that you were not assigned a default route.  Double
	  check that the option <code class="option">add default HISADDR</code>
	  was set during the connection.  If you can connect to a
	  remote <acronym class="acronym">IP</acronym> address then it is possible
	  that a resolver address has not been added to the
	  <code class="filename">/etc/resolv.conf</code>.  This file should
	  look like:</p><pre class="programlisting">domain <em class="replaceable"><code>example.com</code></em>
nameserver <em class="replaceable"><code>x.x.x.x</code></em>
nameserver <em class="replaceable"><code>y.y.y.y</code></em></pre><p>Where <em class="replaceable"><code>x.x.x.x</code></em> and
	  <em class="replaceable"><code>y.y.y.y</code></em> should be replaced with
	  the <acronym class="acronym">IP</acronym> address of your
	  <acronym class="acronym">ISP</acronym>'s DNS servers.  This information may
	  or may not have been provided when you signed up, but a
	  quick call to your <acronym class="acronym">ISP</acronym> should remedy
	  that.</p><p>You could also have <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslog&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a> provide a logging
	  function for your <span class="application">PPP</span> connection.
	  Just add:</p><pre class="programlisting">!ppp
*.*     /var/log/ppp.log</pre><p>to <code class="filename">/etc/syslog.conf</code>.  In most cases, this
	  functionality already exists.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ppp.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ppp-and-slip.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="pppoe.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">27.3. Using Kernel PPP </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 27.5. Using PPP over Ethernet (PPPoE)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>