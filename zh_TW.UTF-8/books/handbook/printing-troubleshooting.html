<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>10.7. Troubleshooting</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="printing.html" title="章 10. 列印" /><link rel="prev" href="printing-lpd-alternatives.html" title="10.6. Alternatives to the Standard Spooler" /><link rel="next" href="linuxemu.html" title="章 11. 與 Linux Binary 的相容方面" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">10.7. Troubleshooting</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="printing-lpd-alternatives.html">前一頁</a> </td><th width="60%" align="center">章 10. 列印</th><td width="20%" align="right"> <a accesskey="n" href="linuxemu.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-troubleshooting"></a>10.7. Troubleshooting</h2></div></div></div><p>After performing the simple test with <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lptest&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lptest</span>(1)</span></a>, you might
      have gotten one of the following results instead of the correct
      printout:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">It worked, after awhile; or, it did not eject a full
	  sheet.</span></dt><dd><p>The printer printed the above, but it sat for awhile and
	    did nothing.  In fact, you might have needed to press a
	    PRINT REMAINING or FORM FEED button on the printer to get any
	    results to appear.</p><p>If this is the case, the printer was probably waiting to
	    see if there was any more data for your job before it printed
	    anything.  To fix this problem, you can have the text filter
	    send a FORM FEED character (or whatever is necessary) to the
	    printer.  This is usually sufficient to have the printer
	    immediately print any text remaining in its internal buffer.
	    It is also useful to make sure each print job ends on a full
	    sheet, so the next job does not start somewhere on the middle
	    of the last page of the previous job.</p><p>The following replacement for the shell script
	    <code class="filename">/usr/local/libexec/if-simple</code> prints a
	    form feed after it sends the job to the printer:</p><pre class="programlisting">#!/bin/sh
#
# if-simple - Simple text input filter for lpd
# Installed in /usr/local/libexec/if-simple
#
# Simply copies stdin to stdout.  Ignores all filter arguments.
# Writes a form feed character (\f) after printing job.

/bin/cat &amp;&amp; printf "\f" &amp;&amp; exit 0
exit 2</pre></dd><dt><span class="term">It produced the <span class="quote">“<span class="quote">staircase effect.</span>”</span></span></dt><dd><p>You got the following on paper:</p><pre class="programlisting">!"#$%&amp;'()*+,-./01234
                "#$%&amp;'()*+,-./012345
                                 #$%&amp;'()*+,-./0123456</pre><a id="idp74836560" class="indexterm"></a><a id="idp74837072" class="indexterm"></a><a id="idp74837584" class="indexterm"></a><p>You have become another victim of the <span class="emphasis"><em>staircase
	    effect</em></span>, caused by conflicting interpretations of
	    what characters should indicate a new line.  <span class="trademark">UNIX</span>® style
	    operating systems use a single character:  ASCII code 10, the
	    line feed (LF). <span class="trademark">MS-DOS</span>®, <span class="trademark">OS/2</span>®, and others uses a pair of
	    characters, ASCII code 10 <span class="emphasis"><em>and</em></span> ASCII code
	    13 (the carriage return or CR).  Many printers use the <span class="trademark">MS-DOS</span>®
	    convention for representing new-lines.</p><p>When you print with FreeBSD, your text used just the line
	    feed character.  The printer, upon seeing a line feed
	    character, advanced the paper one line, but maintained the
	    same horizontal position on the page for the next character
	    to print.  That is what the carriage return is for:  to move
	    the location of the next character to print to the left edge
	    of the paper.</p><p>Here is what FreeBSD wants your printer to do:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td>Printer received CR</td><td>Printer prints CR</td></tr><tr><td>Printer received LF</td><td>Printer prints CR + LF</td></tr></tbody></table></div><p>Here are some ways to achieve this:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Use the printer's configuration switches or control
		panel to alter its interpretation of these characters.
		Check your printer's manual to find out how to do
		this.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">If you boot your system into other operating systems
		  besides FreeBSD, you may have to
		  <span class="emphasis"><em>reconfigure</em></span> the printer to use a an
		  interpretation for CR and LF characters that those other
		  operating systems use.  You might prefer one of the other
		  solutions, below.</p></div></li><li class="listitem"><p>Have FreeBSD's serial line driver automatically
		convert LF to CR+LF.  Of course, this works with printers
		on serial ports <span class="emphasis"><em>only</em></span>.  To enable this
		feature, use the <code class="literal">ms#</code> capability and
		set the <code class="literal">onlcr</code> mode
		in the <code class="filename">/etc/printcap</code> file
		for the printer.</p></li><li class="listitem"><p>Send an <span class="emphasis"><em>escape code</em></span> to the
	        printer to have it temporarily treat LF characters
		differently.  Consult your printer's manual for escape
		codes that your printer might support.  When you find the
		proper escape code, modify the text filter to send the
		code first, then send the print job.</p><a id="idp74852176" class="indexterm"></a><p>Here is an example text filter for printers that
		understand the Hewlett-Packard PCL escape codes.  This
		filter makes the printer treat LF characters as a LF and
		CR; then it sends the job; then it sends a form feed to
		eject the last page of the job.  It should work with
		nearly all Hewlett Packard printers.</p><pre class="programlisting">#!/bin/sh
#
# hpif - Simple text input filter for lpd for HP-PCL based printers
# Installed in /usr/local/libexec/hpif
#
# Simply copies stdin to stdout.  Ignores all filter arguments.
# Tells printer to treat LF as CR+LF.  Ejects the page when done.

printf "\033&amp;k2G" &amp;&amp; cat &amp;&amp; printf "\033&amp;l0H" &amp;&amp; exit 0
exit 2</pre><p>Here is an example <code class="filename">/etc/printcap</code>
		from a host called <code class="systemitem">orchid</code>.  It has a single printer
		attached to its first parallel port, a Hewlett Packard
		LaserJet 3Si named <code class="literal">teak</code>.  It is using the
		above script as its text filter:</p><pre class="programlisting">#
#  /etc/printcap for host orchid
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=/dev/lpt0:sh:sd=/var/spool/lpd/teak:mx#0:\
        :if=/usr/local/libexec/hpif:</pre></li></ul></div></dd><dt><span class="term">It overprinted each line.</span></dt><dd><p>The printer never advanced a line.  All of the lines of
	    text were printed on top of each other on one line.</p><p>This problem is the <span class="quote">“<span class="quote">opposite</span>”</span> of the
	    staircase effect, described above, and is much rarer.
	    Somewhere, the LF characters that FreeBSD uses to end a line
	    are being treated as CR characters to return the print
	    location to the left edge of the paper, but not also down a
	    line.</p><p>Use the printer's configuration switches or control panel
	    to enforce the following interpretation of LF and CR
	    characters:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Printer receives</th><th>Printer prints</th></tr></thead><tbody><tr><td>CR</td><td>CR</td></tr><tr><td>LF</td><td>CR + LF</td></tr></tbody></table></div></dd><dt><span class="term">The printer lost characters.</span></dt><dd><p>While printing, the printer did not print a few characters
	    in each line.  The problem might have gotten worse as the
	    printer ran, losing more and more characters.</p><p>The problem is that the printer cannot keep up with the
	    speed at which the computer sends data over a serial line
	    (this problem should not occur with printers on parallel
	    ports).  There are two ways to overcome the problem:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If the printer supports XON/XOFF flow control, have
		FreeBSD use it by specifying the <code class="literal">ixon</code> mode
		in the <code class="literal">ms#</code> capability.</p></li><li class="listitem"><p>If the printer supports carrier flow control, specify
		the <code class="literal">crtscts</code> mode in the
		<code class="literal">ms#</code> capability.
		Make sure the cable connecting the printer to the computer
		is correctly wired for carrier flow control.</p></li></ul></div></dd><dt><span class="term">It printed garbage.</span></dt><dd><p>The printer printed what appeared to be random garbage,
	    but not the desired text.</p><p>This is usually another symptom of incorrect
	    communications parameters with a serial printer.  Double-check
	    the bps rate in the <code class="literal">br</code> capability, and the
	    parity setting in the
	    <code class="literal">ms#</code> capability; make sure the printer is
	    using the same settings as specified in the
	    <code class="filename">/etc/printcap</code> file.</p></dd><dt><span class="term">Nothing happened.</span></dt><dd><p>If nothing happened, the problem is probably within
	    FreeBSD and not the hardware.  Add the log file
	    (<code class="literal">lf</code>) capability to the entry for the
	    printer you are debugging in the
	    <code class="filename">/etc/printcap</code> file.  For example, here is
	    the entry for <code class="literal">rattan</code>, with the
	    <code class="literal">lf</code> capability:</p><pre class="programlisting">rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:\
        :lf=/var/log/rattan.log</pre><p>Then, try printing again.  Check the log file (in our
	    example, <code class="filename">/var/log/rattan.log</code>) to see any
	    error messages that might appear.  Based on the messages you
	    see, try to correct the problem.</p><p>If you do not specify a <code class="literal">lf</code> capability,
	    <span class="application">LPD</span> uses
	    <code class="filename">/dev/console</code> as a default.</p></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="printing-lpd-alternatives.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="printing.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="linuxemu.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">10.6. Alternatives to the Standard Spooler </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 章 11. 與 Linux Binary 的相容方面</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>