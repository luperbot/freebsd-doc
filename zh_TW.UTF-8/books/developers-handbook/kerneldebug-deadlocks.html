<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>9.9. Debugging the Deadlocks</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Developers' Handbook" /><link rel="up" href="kerneldebug.html" title="章 9. Kernel Debugging" /><link rel="prev" href="kerneldebug-console.html" title="9.8. Debugging a Console Driver" /><link rel="next" href="architectures.html" title="部 IV. Architectures(電腦架構)" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">9.9. Debugging the Deadlocks</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kerneldebug-console.html">前一頁</a> </td><th width="60%" align="center">章 9. Kernel Debugging</th><td width="20%" align="right"> <a accesskey="n" href="architectures.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kerneldebug-deadlocks"></a>9.9. Debugging the Deadlocks</h2></div></div></div><p>You may experience so called deadlocks, the situation where
      system stops doing useful work. To provide the helpful bug report
      in this situation, you shall use ddb as described above. Please,
      include the output of <code class="command">ps</code> and
      <code class="command">trace</code> for suspected processes in the
      report.</p><p>If possible, consider doing further investigation. Receipt
      below is especially useful if you suspect deadlock occurs in the
      VFS layer. Add the options
      </p><pre class="programlisting">makeoptions		DEBUG=-g
	options		INVARIANTS
	options		INVARIANT_SUPPORT
	options		WITNESS
	options		DEBUG_LOCKS
	options		DEBUG_VFS_LOCKS
	options		DIAGNOSTIC</pre><p>

      to the kernel config. When deadlock occurs, in addition to the
      output of the <code class="command">ps</code> command, provide information
      from the <code class="command">show allpcpu</code>, <code class="command">show
      alllocks</code>, <code class="command">show lockedvnods</code> and
      <code class="command">show alltrace</code>.</p><p>For threaded processes, to obtain meaningful backtraces, use
      <code class="command">thread thread-id</code> to switch to the thread
      stack, and do backtrace with <code class="command">where</code>.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kerneldebug-console.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="kerneldebug.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="architectures.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">9.8. Debugging a Console Driver </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 部 IV. Architectures(電腦架構)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>