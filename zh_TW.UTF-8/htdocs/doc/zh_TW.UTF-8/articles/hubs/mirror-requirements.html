<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>2. 成為 FreeBSD mirrors 的必備條件</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Mirroring FreeBSD" /><link rel="up" href="index.html" title="Mirroring FreeBSD" /><link rel="prev" href="index.html" title="Mirroring FreeBSD" /><link rel="next" href="mirror-howto.html" title="3. How to Mirror FreeBSD" /><link rel="copyright" href="trademarks.html" title="法律聲明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2. 成為 FreeBSD mirrors 的必備條件</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="index.html">前一頁</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="mirror-howto.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mirror-requirements"></a>2. 成為 FreeBSD mirrors 的必備條件</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-diskspace"></a>2.1. 硬碟空間</h3></div></div></div><p>
        硬碟空間是最重要的必備條件之一。
        Depending on the set of releases, architectures,
        and degree of completeness you want to mirror, a huge
        amount of disk space may be consumed. Also keep in mind
        that <span class="emphasis"><em>official</em></span> mirrors are probably required to be
        complete. The CVS repository and the web pages should
        always be mirrored completely. Also note that the
        numbers stated here are reflecting the current
        state (at 9.3-RELEASE/10.1-RELEASE). Further development and
        releases will only increase the required amount.
        Also make sure to keep some (ca. 10-20%) extra space
        around just to be sure.
        Here are some approximate figures:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>完整 FTP Distribution: 126 GB</p></li><li class="listitem"><p>CVS repository: 2.7 GB</p></li><li class="listitem"><p>CTM deltas: 1.8 GB</p></li><li class="listitem"><p>Web pages: 300 MB</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-bandwidth"></a>2.2. 網路頻寬</h3></div></div></div><p>
        當然，你一定要能連上 Internet。
        頻寬需求多少，這要看你所想要的 mirror 程度而定。
        若只想要 mirror 一部份的 FreeBSD 檔案以作為網站或 intranet 的局部用途，
        那麼頻寬需求會明顯比成為公共服務用途的小一些。
	若想成為 official mirror 之一的話，那麼頻寬就勢必得增加才夠用。以下，我們僅列出一些估計值以做為參考：
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Local site, no public access: basically no minimum,
           but &lt; 2 Mbps could make syncing too slow.</p></li><li class="listitem"><p>Unofficial public site: 34 Mbps is probably a good start.</p></li><li class="listitem"><p>Official site: &gt; 100 Mbps is recommended, and your host
           should be connected as close as possible to your border router.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-system"></a>2.3. 系統需求、CPU、RAM</h3></div></div></div><p>
        One thing this depends on the expected number of clients,
        which is determined by the server's policy. It is
        also affected by the types of services you want to offer.
        Plain FTP or HTTP services may not require a huge
        amount of resources. Watch out if you provide
        CVSup, rsync or even AnonCVS. This can have a huge
        impact on CPU and memory requirements. Especially
        rsync is considered a memory hog, and CVSup does
        indeed consume some CPU. For AnonCVS it might
        be a nice idea to set up a memory resident file system (MFS) of at least
        300 MB, so you need to take this into account
        for your memory requirements. The following
        are just examples to give you a very rough hint.
      </p><p>
        For a moderately visited site that offers
        <span class="application">Rsync</span>, you might
        consider a current CPU with around 800MHz - 1 GHz,
        and at least 512MB RAM. This is probably the
        minimum you want for an <span class="emphasis"><em>official</em></span>
        site.
      </p><p>
        For a frequently used site you definitely need
        more RAM (consider 2GB as a good start)
        and possibly more CPU, which could also mean
        that you need to go for a SMP system.
      </p><p>
        You also want to consider a fast disk subsystem.
        Operations on the CVS repository require a fast
        disk subsystem (RAID is highly advised). A SCSI
        controller that has a cache of its own can also
        speed up things since most of these services incur a
        large number of small modifications to the disk.
      </p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-services"></a>2.4. Services to offer</h3></div></div></div><p>
        Every mirror site is required to have a set of core services
        available. In addition to these required services, there are
        a number of optional services that
        server administrators may choose to offer.  This section explains
        which services you can provide and how to go about implementing them.
      </p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-serv-ftp"></a>2.4.1. FTP (required for FTP fileset)</h4></div></div></div><p>
          This is one of the most basic services, and
          it is required for each mirror offering public
          FTP distributions. FTP access must be
          anonymous, and no upload/download ratios
          are allowed (a ridiculous thing anyway).
          Upload capability is not required (and <span class="emphasis"><em>must</em></span>
          never be allowed for the FreeBSD file space).
          Also the FreeBSD archive should be available under
          the path <code class="filename">/pub/FreeBSD</code>.
        </p><p>
          There is a lot of software available which
          can be set up to allow anonymous FTP
          (in alphabetical order).
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="command">/usr/libexec/ftpd</code>: FreeBSD's own ftpd
              can be used. Be sure to read <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ftpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ftpd</span>(8)</span></a>.</p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/ncftpd/pkg-descr">ftp/ncftpd</a>: A commercial package,
              free for educational use.</p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/oftpd/pkg-descr">ftp/oftpd</a>: An ftpd designed with
              security as a main focus.</p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/proftpd/pkg-descr">ftp/proftpd</a>: A modular and very flexible ftpd.</p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/pure-ftpd/pkg-descr">ftp/pure-ftpd</a>: Another ftpd developed with
                security in mind.</p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/twoftpd/pkg-descr">ftp/twoftpd</a>: As above.</p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/vsftpd/pkg-descr">ftp/vsftpd</a>: The <span class="quote">“<span class="quote">very secure</span>”</span> ftpd.</p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/wu-ftpd/pkg-descr">ftp/wu-ftpd</a>: The ftpd from Washington
                University. It has become infamous, because of the huge
                amount of security issues that have been found in it.
                If you do choose to use this software be sure to
                keep it up to date.
              </p></li></ul></div><p>
          FreeBSD's <span class="application">ftpd</span>, <span class="application">proftpd</span>,
          <span class="application">wu-ftpd</span> and maybe <span class="application">ncftpd</span>
          are among the most commonly used FTPds.
          The others do not have a large userbase among mirror sites.  One
          thing to consider is that you may need flexibility in limiting
          how many simultaneous connections are allowed, thus limiting how
          much network bandwidth and system resources are consumed.
        </p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-serv-rsync"></a>2.4.2. Rsync (optional for FTP fileset)</h4></div></div></div><p>
          <span class="application">Rsync</span> is often offered for access to the
          contents of the FTP area of FreeBSD, so other mirror sites can use your system as their source.  The
          protocol is different from FTP in many ways.
          It is much more
          bandwidth friendly, as only differences between files
          are transferred instead of whole files when they change.
          <span class="application">Rsync</span> does require a significant amount of memory for
          each instance. The size depends on the size of
          the synced module in terms of the number of directories and
          files. <span class="application">Rsync</span> can use <code class="command">rsh</code> and
          <code class="command">ssh</code> (now default) as a transport,
          or use its own protocol for stand-alone access
          (this is the preferred method for public rsync servers).
          Authentication, connection limits, and other restrictions
          may be applied. There is just one software package
          available:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/rsync/pkg-descr">net/rsync</a></p></li></ul></div><p>
        </p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-serv-http"></a>2.4.3. HTTP (required for web pages, optional for FTP fileset)</h4></div></div></div><p>
          If you want to offer the FreeBSD web pages, you will need
          to install a web server.
          You may optionally offer the FTP fileset via HTTP.
          The choice of web server software is left up to the mirror administrator.
          Some of the most popular choices are:

          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/apache13/pkg-descr">www/apache13</a>:
                <span class="application">Apache</span> is the most widely
                deployed web server on the Internet. It is used
                extensively by the FreeBSD Project. You may also wish to
                use the next generation of the
                <span class="application">Apache</span> web server, available
                in the ports collection as <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/apache22/pkg-descr">www/apache22</a>.</p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/thttpd/pkg-descr">www/thttpd</a>:
                If you are going to be serving a large amount of static content
                you may find that using an application such as thttpd is more
                efficient than <span class="application">Apache</span>. It is
                optimized for excellent performance on FreeBSD.</p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/boa/pkg-descr">www/boa</a>:
                <span class="application">Boa</span> is another alternative to
                <span class="application">thttpd</span> and
                <span class="application">Apache</span>. It should provide
                considerably better performance than
                <span class="application">Apache</span> for purely static
                content. It does not, at the time of this writing,
                contain the same set of optimizations for FreeBSD that
                are found in <span class="application">thttpd</span>.</p></li></ul></div><p>
        </p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-serv-cvsup"></a>2.4.4. CVSup (desired for CVS repository)</h4></div></div></div><p>
          <span class="application">CVSup</span> is a very efficient way of distributing files.
          It works similar to <span class="application">rsync</span>, but was specially designed for
          use with CVS repositories. If you want to offer the
          FreeBSD CVS repository, you really want to consider
          offering it via <span class="application">CVSup</span>. It is possible to offer
          the CVS repository via <span class="application">AnonCVS</span>, FTP,
          <span class="application">rsync</span> or HTTP, but
          people would benefit much more from <span class="application">CVSup</span> access.
          <span class="application">CVSup</span> was developed by John Polstra.
          It is a bit tricky to install on non-FreeBSD platforms,
          since it is written in Modula-3 and therefore requires
          a Modula-3 environment. John Polstra has built a
          stripped down version of M3 that is sufficient to
          run <span class="application">CVSup</span>, and can be installed much easier.
          See <a class="link" href="http://www.polstra.com/projects/freeware/ezm3/" target="_top">Ezm3</a>
          for details. Related ports are:

          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/cvsup/pkg-descr">net/cvsup</a>: The native CVSup port (client and server)
                which requires <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/lang/ezm3/pkg-descr">lang/ezm3</a> now.</p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/cvsup-mirror/pkg-descr">net/cvsup-mirror</a>: The CVSup mirror kit, which requires
                 <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/cvsup-without-gui/pkg-descr">net/cvsup-without-gui</a>, and configures it mirror-ready. Some
                 site administrators may want a different setup though.
              </p></li></ul></div><p>

          There are a few more like
          <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/cvsup-without-gui/pkg-descr">net/cvsup-without-gui</a> you might want to have
          a look at. If you prefer a static binary package, take a look
          <a class="link" href="http://people.FreeBSD.org/~jdp/s1g/" target="_top">here</a>.
          This page still refers to the S1G bug that was present
          in <span class="application">CVSup</span>. Maybe
          John will set up a generic download-site to get
          static binaries for various platforms.
        </p><p>
          It is possible to use <span class="application">CVSup</span> to offer
          any kind of fileset, not just CVS repositories,
          but configuration can be complex.
          <span class="application">CVSup</span> is known to eat some CPU on both the server and the
          client, since it needs to compare lots of files.
        </p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-anoncvs"></a>2.4.5. AnonCVS (optional for CVS repository)</h4></div></div></div><p>
          If you have the CVS repository, you may want to offer
          anonymous CVS access. A short warning first:
          There is not much demand for it,
          it requires some experience, and you need to know
          what you are doing.
        </p><p>
          Generally there are two ways
          to access a CVS repository remotely: via
          <span class="emphasis"><em>pserver</em></span> or via <code class="command">ssh</code>
          (we do not consider <code class="command">rsh</code>).
          For anonymous access, <span class="emphasis"><em>pserver</em></span> is
          very well suited, but some still offer <code class="command">ssh</code>
          access as well. There is a custom crafted
          <a class="link" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/development/FreeBSD-CVS/anoncvs.shar" target="_top">wrapper</a>
          in the CVS repository, to be used as a login-shell for the
          anonymous ssh account. It does a chroot, and therefore
          requires the CVS repository to be available under the
          anonymous user's home-directory.   This may not be possible
          for all sites. If you just offer <span class="emphasis"><em>pserver</em></span>
          this restriction does not apply, but you may run with
          more security risks. You do not need to install any special
          software, since <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cvs&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cvs</span>(1)</span></a> comes with
          FreeBSD. You need to enable access via <code class="command">inetd</code>,
          so add an entry into your <code class="filename">/etc/inetd.conf</code>
          like this:
          </p><pre class="programlisting">
cvspserver stream tcp nowait root /usr/bin/cvs cvs -f -l -R -T /anoncvstmp --allow-root=/home/ncvs pserver
          </pre><p>
          See the manpage for details of the options. Also see the CVS <span class="emphasis"><em>info</em></span>
          page about additional ways to make sure access is read-only.
          It is advised that you create an unprivileged account,
          preferably called <code class="systemitem">anoncvs</code>.
          Also you need to create a file <code class="filename">passwd</code>
          in your <code class="filename">/home/ncvs/CVSROOT</code> and assign a
          CVS password (empty or <code class="literal">anoncvs</code>) to that user.
          The directory <code class="filename">/anoncvstmp</code> is a special
          purpose memory based file system. It is not required but
          advised since <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cvs&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cvs</span>(1)</span></a> creates a shadow directory
          structure in your <code class="filename">/tmp</code> which is
          not used after the operation but slows things
          dramatically if real disk operations are required.
          Here is an excerpt from <code class="filename">/etc/fstab</code>,
          how to set up such a MFS:
          </p><pre class="programlisting">
/dev/da0s1b /anoncvstmp mfs rw,-s=786432,-b=4096,-f=512,-i=560,-c=3,-m=0,nosuid,nodev 0 0
          </pre><p>
          This is (of course) tuned a lot, and was suggested by John Polstra.
        </p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="index.html">前一頁</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="mirror-howto.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">Mirroring FreeBSD </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 3. How to Mirror FreeBSD</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>