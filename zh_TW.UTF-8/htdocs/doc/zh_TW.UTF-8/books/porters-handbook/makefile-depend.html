<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>5.7. Dependencies</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="makefile.html" title="章 5. 設定 Makefile" /><link rel="prev" href="makefile-comment.html" title="5.6. COMMENT" /><link rel="next" href="makefile-masterdir.html" title="5.8. MASTERDIR" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.7. Dependencies</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="makefile-comment.html">前一頁</a> </td><th width="60%" align="center">章 5. 設定 Makefile</th><td width="20%" align="right"> <a accesskey="n" href="makefile-masterdir.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="makefile-depend"></a>5.7. Dependencies</h2></div></div></div><p>Many ports depend on other ports.  There are seven variables that
	  you can use to ensure that all the required bits will be on the
	  user's machine.  There are also some pre-supported dependency
	  variables for common cases, plus a few more to control the behavior
	  of dependencies.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67679184"></a>5.7.1. <code class="varname">LIB_DEPENDS</code></h3></div></div></div><p>This variable specifies the shared libraries this port depends
	    on.  It is a list of
	    <em class="replaceable"><code>lib</code></em>:<em class="replaceable"><code>dir</code></em>[<span class="optional">:target</span>]
	    tuples where <em class="replaceable"><code>lib</code></em> is the name of the
	    shared library, <em class="replaceable"><code>dir</code></em> is the
	    directory in which to find it in case it is not available, and
	    <em class="replaceable"><code>target</code></em> is the target to call in that
	    directory.  For example,
	    </p><pre class="programlisting">LIB_DEPENDS=   jpeg.9:${PORTSDIR}/graphics/jpeg</pre><p>
	    will check for a shared jpeg library with major version 9, and
	    descend into the <code class="filename">graphics/jpeg</code> subdirectory
	    of your ports tree to build and install it if it is not found.
	    The <em class="replaceable"><code>target</code></em> part can be omitted if it is
	    equal to <code class="varname">DEPENDS_TARGET</code> (which defaults to
	    <code class="literal">install</code>).</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <em class="replaceable"><code>lib</code></em> part is a regular
	      expression which is being looked up in the
	      <code class="command">ldconfig -r</code> output.  Values such as
	      <code class="literal">intl.[5-7]</code> and <code class="literal">intl</code> are
	      allowed.  The first pattern,
	      <code class="literal">intl.[5-7]</code>, will match any of:
	      <code class="literal">intl.5</code>, <code class="literal">intl.6</code> or
	      <code class="literal">intl.7</code>.  The second pattern,
	      <code class="literal">intl</code>, will match any version of the
	      <code class="literal">intl</code> library.</p></div><p>The dependency is checked twice, once from within the
	    <code class="buildtarget">extract</code> target and then from within the
	    <code class="buildtarget">install</code> target.  Also, the name of the
	    dependency is put into the package so that
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pkg_add&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a> will automatically install it if it is
	    not on the user's system.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67703504"></a>5.7.2. <code class="varname">RUN_DEPENDS</code></h3></div></div></div><p>This variable specifies executables or files this port depends
	    on during run-time.  It is a list of
	    <em class="replaceable"><code>path</code></em>:<em class="replaceable"><code>dir</code></em>[<span class="optional">:target</span>]
	    tuples where <em class="replaceable"><code>path</code></em> is the name of the
	    executable or file, <em class="replaceable"><code>dir</code></em> is the
	    directory in which to find it in case it is not available, and
	    <em class="replaceable"><code>target</code></em> is the target to call in that
	    directory.  If <em class="replaceable"><code>path</code></em> starts with a slash
	    (<code class="literal">/</code>), it is treated as a file and its existence
	    is  tested with <code class="command">test -e</code>; otherwise, it is
	    assumed to be an executable, and <code class="command">which -s</code> is
	    used to determine if the program exists in the search path.</p><p>For example,</p><pre class="programlisting">RUN_DEPENDS=   ${LOCALBASE}/etc/innd:${PORTSDIR}/news/inn \
	       xmlcatmgr:${PORTSDIR}/textproc/xmlcatmgr</pre><p>will check if the file or directory
	    <code class="filename">/usr/local/etc/innd</code> exists, and build and
	    install it from the <code class="filename">news/inn</code> subdirectory of
	    the ports tree if it is not found.  It will also see if an
	    executable called <code class="command">xmlcatmgr</code> is in the search
	    path, and descend into the <code class="filename">textproc/xmlcatmgr</code>
	    subdirectory of your ports tree to build and install it if it is
	    not found.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">In this case, <code class="command">innd</code> is actually an
	      executable; if an executable is in a place that is not expected
	      to be in the search path, you should use the full
	      pathname.</p></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">The official search <code class="envar">PATH</code> used on the ports
	      build cluster is</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:/usr/X11R6/bin</pre></div><p>The dependency is checked from within the
	    <code class="buildtarget">install</code> target.  Also, the name of the
	    dependency is put into the  package so that
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pkg_add&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a> will automatically install it if it is
	    not on the user's system.  The <em class="replaceable"><code>target</code></em>
	    part can be omitted if it is the same as
	    <code class="varname">DEPENDS_TARGET</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67724624"></a>5.7.3. <code class="varname">BUILD_DEPENDS</code></h3></div></div></div><p>This variable specifies executables or files this port
	    requires to build.  Like <code class="varname">RUN_DEPENDS</code>, it is a
	    list of
	    <em class="replaceable"><code>path</code></em>:<em class="replaceable"><code>dir</code></em>[<span class="optional">:target</span>]
	    tuples. For example, </p><pre class="programlisting"> BUILD_DEPENDS=
	      unzip:${PORTSDIR}/archivers/unzip</pre><p> will check
	    for an executable called <code class="command">unzip</code>, and descend
	    into the <code class="filename">archivers/unzip</code> subdirectory of your
	    ports tree to build and install it if it is not found.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="quote">“<span class="quote">build</span>”</span> here means everything from extraction to
	      compilation.  The dependency is checked from within the
	      <code class="buildtarget">extract</code> target.  The
	      <em class="replaceable"><code>target</code></em> part can be omitted if it is
	      the same as <code class="varname">DEPENDS_TARGET</code></p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67730640"></a>5.7.4. <code class="varname">FETCH_DEPENDS</code></h3></div></div></div><p>This variable specifies executables or files this port
	    requires to fetch.  Like the previous two, it is a list of
	    <em class="replaceable"><code>path</code></em>:<em class="replaceable"><code>dir</code></em>[<span class="optional">:target</span>]
	    tuples.  For example, </p><pre class="programlisting"> FETCH_DEPENDS=
	      ncftp2:${PORTSDIR}/net/ncftp2</pre><p> will check for an
	    executable called <code class="command">ncftp2</code>, and descend into the
	    <code class="filename">net/ncftp2</code> subdirectory of your ports tree to
	    build and install it if it is not found.</p><p>The dependency is checked from within the
	    <code class="buildtarget">fetch</code> target.  The
	    <em class="replaceable"><code>target</code></em> part can be omitted if it is the
	    same as <code class="varname">DEPENDS_TARGET</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67739984"></a>5.7.5. <code class="varname">EXTRACT_DEPENDS</code></h3></div></div></div><p>This variable specifies executables or files this port
	    requires for extraction.  Like the previous, it is a list of
	    <em class="replaceable"><code>path</code></em>:<em class="replaceable"><code>dir</code></em>[<span class="optional">:target</span>]
	    tuples.  For example, </p><pre class="programlisting">EXTRACT_DEPENDS=
	      unzip:${PORTSDIR}/archivers/unzip</pre><p> will check
	    for an executable called <code class="command">unzip</code>, and descend
	    into the <code class="filename">archivers/unzip</code> subdirectory of
	    your ports tree to build and install it if it is not found.</p><p>The dependency is checked from within the
	    <code class="buildtarget">extract</code> target.  The
	    <em class="replaceable"><code>target</code></em> part can be omitted if it is the
	    same as <code class="varname">DEPENDS_TARGET</code>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">Use this variable only if the extraction does not already
	      work (the default assumes <code class="command">gzip</code>) and cannot
	      be made to work using <code class="varname">USE_ZIP</code> or
	      <code class="varname">USE_BZIP2</code> described in <a class="xref" href="makefile-depend.html#use-vars" title="5.7.7. USE_*">節 5.7.7, “<code class="varname">USE_<em class="replaceable"><code>*</code></em></code>”</a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67747536"></a>5.7.6. <code class="varname">PATCH_DEPENDS</code></h3></div></div></div><p>This variable specifies executables or files this port
	    requires to patch.  Like the previous, it is a list of
	    <em class="replaceable"><code>path</code></em>:<em class="replaceable"><code>dir</code></em>[<span class="optional">:target</span>]
	    tuples.  For example, </p><pre class="programlisting"> PATCH_DEPENDS=
	      ${NONEXISTENT}:${PORTSDIR}/java/jfc:extract
		</pre><p>will descend into the
	    <code class="filename">java/jfc</code> subdirectory of your ports tree to
	    extract it.</p><p>The dependency is checked from within the
	    <code class="buildtarget">patch</code> target.  The
	    <em class="replaceable"><code>target</code></em> part can be omitted if it is the
	    same as <code class="varname">DEPENDS_TARGET</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="use-vars"></a>5.7.7. <code class="varname">USE_<em class="replaceable"><code>*</code></em></code></h3></div></div></div><p>A number of variables exist in order to encapsulate common
	  dependencies that many ports have.  Although their use is
	  optional, they can help to reduce the verbosity of the port
	  <code class="filename">Makefile</code>s.  Each of them is styled
	  as <code class="varname">USE_<em class="replaceable"><code>*</code></em></code>.  The
	  usage of these variables is restricted to the port
	  <code class="filename">Makefile</code>s and
	  <code class="filename">ports/Mk/bsd.*.mk</code> and is not designed
	  to encapsulate user-settable options —— use
	  <code class="varname">WITH_<em class="replaceable"><code>*</code></em></code> and
	  <code class="varname">WITHOUT_<em class="replaceable"><code>*</code></em></code>
	  for that purpose.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is <span class="emphasis"><em>always</em></span> incorrect to set
	    any <code class="varname">USE_<em class="replaceable"><code>*</code></em></code>
	    in <code class="filename">/etc/make.conf</code>.  For instance,
	    setting </p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">USE_GCC=3.2</pre><p xmlns="http://www.w3.org/1999/xhtml">
	    would adds a dependency on gcc32 for every port,
	    including gcc32 itself!</p></div><div class="table"><a id="idp67763664"></a><div class="table-title">表格 5.1. The <code class="varname">USE_<em class="replaceable"><code>*</code></em></code>
	    variables</div><div class="table-contents"><table summary="The USE_*&#10;&#9;    variables" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Variable</th><th>Means</th></tr></thead><tbody><tr><td><code class="varname">USE_BZIP2</code></td><td>The port's tarballs are compressed with
		  <code class="command">bzip2</code>.</td></tr><tr><td><code class="varname">USE_ZIP</code></td><td>The port's tarballs are compressed with
		  <code class="command">zip</code>.</td></tr><tr><td><code class="varname">USE_BISON</code></td><td>The port uses <code class="command">bison</code> for
		  building.</td></tr><tr><td><code class="varname">USE_CDRTOOLS</code></td><td>該 port 需要 <span class="application">cdrecord</span>，
		  無論是 <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools/pkg-descr">sysutils/cdrtools</a> 或 <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/sysutils/cdrtools-cjk/pkg-descr">sysutils/cdrtools-cjk</a> 哪一種的
		  <span class="application">cdrecord</span> 皆可，視使用者偏好而定
		  。</td></tr><tr><td><code class="varname">USE_GCC</code></td><td>The port requires a specific version of
		  <code class="command">gcc</code> to build.  The exact version can be
		  specified with value such as <code class="literal">3.2</code>.
		  The minimal required version can be specified as
		  <code class="literal">3.2+</code>.  The <code class="command">gcc</code> from
		  the base system is used when it satisfies the requested
		  version, otherwise an appropriate <code class="command">gcc</code> is
		  compiled from ports and the <code class="varname">CC</code> and
		  <code class="varname">CXX</code> variables are adjusted.</td></tr></tbody></table></div></div><br class="table-break" /><p>Variables related to <span class="application">gmake</span> and
	    the <code class="filename">configure</code> script are described in
	    <a class="xref" href="building.html" title="6.3. Building mechanisms">節 6.3, “Building mechanisms”</a>, while
	    <span class="application">autoconf</span>,
	    <span class="application">automake</span> and
	    <span class="application">libtool</span> are described in
	    <a class="xref" href="using-autotools.html" title="6.4. Using GNU autotools">節 6.4, “Using GNU autotools”</a>.  <span class="application">Perl</span>
	    related variables are described in <a class="xref" href="using-perl.html" title="6.6. Using perl">節 6.6, “Using <code class="literal">perl</code>”</a>.
	    X11 variables are listed in <a class="xref" href="using-x11.html" title="6.7. Using X11">節 6.7, “Using X11”</a>.  <a class="xref" href="using-gnome.html" title="6.8. Using GNOME">節 6.8, “Using GNOME”</a> deals with GNOME and <a class="xref" href="using-kde.html" title="6.9. Using KDE">節 6.9, “Using KDE”</a> with KDE related variables.  <a class="xref" href="using-java.html" title="6.10. Using Java">節 6.10, “Using Java”</a> documents Java variables, while <a class="xref" href="using-php.html" title="6.11. Web applications, Apache and PHP">節 6.11, “Web applications, Apache and PHP”</a> contains information on
	    <span class="application">Apache</span>, <span class="application">PHP</span>
	    and PEAR modules.  <span class="application">Python</span> is discussed
	    in <a class="xref" href="using-python.html" title="6.12. Using Python">節 6.12, “Using Python”</a>, while
	    <span class="application">Ruby</span> in <a class="xref" href="using-ruby.html" title="6.14. Using Ruby">節 6.14, “Using Ruby”</a>.
	    <a class="xref" href="using-sdl.html" title="6.15. Using SDL">節 6.15, “Using SDL”</a> provides variables used for
	    <span class="application">SDL</span> applications and finally,
	    <a class="xref" href="using-xfce.html" title="6.18. Using Xfce">節 6.18, “Using Xfce”</a> contains information on
	    <span class="application">Xfce</span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67801936"></a>5.7.8. Minimal version of a dependency</h3></div></div></div><p>A minimal version of a dependency can be specified in any
	    <code class="varname">*_DEPENDS</code> variable except
	    <code class="varname">LIB_DEPENDS</code> using the following
	    syntax:</p><pre class="programlisting">p5-Spiffy&gt;=0.26:${PORTSDIR}/devel/p5-Spiffy</pre><p>The first field contains a dependent package name,
	    which must match the entry in the package database,
	    a comparison sign, and a package version.  The dependency
	    is satisfied if p5-Spiffy-0.26 or newer is installed on
	    the machine.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67804624"></a>5.7.9. Notes on dependencies</h3></div></div></div><p>As mentioned above, the default target to call when a
	    dependency is required is <code class="buildtarget">DEPENDS_TARGET</code>.
	    It defaults to <code class="literal">install</code>.  This is a user
	    variable; it is never defined in a port's
	    <code class="filename">Makefile</code>.  If your port needs a special way
	    to handle a dependency, use the <code class="literal">:target</code> part of
	    the <code class="varname">*_DEPENDS</code> variables instead of redefining
	    <code class="varname">DEPENDS_TARGET</code>.</p><p>When you type <code class="command">make clean</code>, its dependencies
	    are automatically cleaned too.  If you do not wish this to happen,
	    define the variable <code class="varname">NOCLEANDEPENDS</code> in your
	    environment.  This may be particularly desirable if the port
	    has something that takes a long time to rebuild in its
	    dependency list, such as KDE, GNOME or Mozilla.</p><p>To depend on another port unconditionally, use the
	    variable <code class="varname">${NONEXISTENT}</code> as the first field
	    of <code class="varname">BUILD_DEPENDS</code> or
	    <code class="varname">RUN_DEPENDS</code>.  Use this only when you need to
	    get the source of the other port.  You can often save
	    compilation time by specifying the target too.  For
	    instance

	    </p><pre class="programlisting">BUILD_DEPENDS=   ${NONEXISTENT}:${PORTSDIR}/graphics/jpeg:extract</pre><p>

	    will always descend to the <code class="literal">jpeg</code> port and extract it.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67815888"></a>5.7.10. Circular dependencies are fatal</h3></div></div></div><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">Do not introduce any circular dependencies into the
	  ports tree!</p></div><p>The ports building technology does not tolerate
	  circular dependencies.  If you introduce one, you will have
	  someone, somewhere in the world, whose FreeBSD installation will
	  break almost immediately, with many others quickly to follow.
	  These can really be hard to detect; if in doubt, before
	  you make that change, make sure you have done the following:
	  <code class="command">cd /usr/ports; make index</code>.  That process
	  can be quite slow on older machines, but you may be able to
	  save a large number of people——including yourself——
	  a lot of grief in the process.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="makefile-comment.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="makefile.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="makefile-masterdir.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">5.6. <code class="varname">COMMENT</code> </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 5.8. <code class="varname">MASTERDIR</code></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>