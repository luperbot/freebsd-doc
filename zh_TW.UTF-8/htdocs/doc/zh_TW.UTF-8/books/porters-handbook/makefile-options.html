<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>5.11. Makefile Options</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="makefile.html" title="章 5. 設定 Makefile" /><link rel="prev" href="makefile-info.html" title="5.10. Info files" /><link rel="next" href="makefile-wrkdir.html" title="5.12. Specifying the working directory" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.11. Makefile Options</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="makefile-info.html">前一頁</a> </td><th width="60%" align="center">章 5. 設定 Makefile</th><td width="20%" align="right"> <a accesskey="n" href="makefile-wrkdir.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="makefile-options"></a>5.11. Makefile Options</h2></div></div></div><p>Some large applications can be built in a number of
	configurations, adding functionality if one of a number of
	libraries or applications is available.  Examples include
	choice of natural (human) language, GUI versus command-line,
	or type of database to support.  Since not all users
	want those libraries or applications, the ports system
	provides hooks that the port author can use to control which
	configuration should be built. Supporting these properly will
	make users happy, and effectively provide 2 or more ports for the
	price of one.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67865552"></a>5.11.1. Knobs</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67866192"></a>5.11.1.1. <code class="varname">WITH_<em class="replaceable"><code>*</code></em></code> and
	    <code class="varname">WITHOUT_<em class="replaceable"><code>*</code></em></code></h4></div></div></div><p>These variables are designed to be set by the system
	    administrator.  There are many that are standardized in
	    <a class="link" href="http://www.freebsd.org/cgi/cvsweb.cgi/ports/KNOBS?rev=HEAD&amp;content-type=text/x-cvsweb-markup" target="_top"><code class="filename">ports/KNOBS</code></a>
	    file.</p><p>When creating a port, do not make knob names specific to a
	    given application.  For example in Avahi port, use
	    <code class="varname">WITHOUT_MDNS</code> instead of
	    <code class="varname">WITHOUT_AVAHI_MDNS</code>.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">You should not assume that a
	      <code class="varname">WITH_<em class="replaceable"><code>*</code></em></code>
	      necessarily has a corresponding
	      <code class="varname">WITHOUT_<em class="replaceable"><code>*</code></em></code>
	      variable and vice versa.  In general, the default is
	      simply assumed.</p></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">Unless otherwise specified, these variables are only
	      tested for being set or not set, rather than being set to
	      some kind of variable such as <code class="literal">YES</code> or
	      <code class="literal">NO</code>.</p></div><div class="table"><a id="idp67874000"></a><div class="table-title">表格 5.2. Common <code class="varname">WITH_<em class="replaceable"><code>*</code></em></code>
	      and <code class="varname">WITHOUT_<em class="replaceable"><code>*</code></em></code>
	      variables</div><div class="table-contents"><table summary="Common WITH_*&#10;&#9;      and WITHOUT_*&#10;&#9;      variables" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Variable</th><th>Means</th></tr></thead><tbody><tr><td><a id="knobs-without-nls"></a><code class="varname">WITHOUT_NLS</code></td><td>If set, says that internationalization is not
		    needed, which can save compile time.  By default,
		    internationalization is used.</td></tr><tr><td><code class="varname">WITH_OPENSSL_BASE</code></td><td>Use the version of OpenSSL in the base system.</td></tr><tr><td><code class="varname">WITH_OPENSSL_PORT</code></td><td>Installs the version of OpenSSL from
		    <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/openssl/pkg-descr">security/openssl</a>,
		    even if the base is up to date.</td></tr><tr><td><code class="varname">WITHOUT_X11</code></td><td>If the port can be built both with and without
		    X support, then it should normally be built with
		    X support. If this variable is defined, then
		    the version that does not have X support should
		    be built instead.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67888592"></a>5.11.1.2. Knob naming</h4></div></div></div><p>It is recommended that porters use like-named knobs, for the
	      benefit of end-users and to help keep the number of knob names down.
	      A list of popular knob names can be found in the
	      <a class="link" href="http://www.freebsd.org/cgi/cvsweb.cgi/ports/KNOBS?rev=HEAD&amp;content-type=text/x-cvsweb-markup" target="_top">KNOBS</a>
	      file.</p><p>Knob names should reflect what the knob is and does.
	      When a port has a lib-prefix in the <code class="varname">PORTNAME</code>
	      the lib-prefix should be dropped in knob naming.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67891152"></a>5.11.2. <code class="varname">OPTIONS</code></h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67892048"></a>5.11.2.1. Background</h4></div></div></div><p>The <code class="varname">OPTIONS</code> variable gives the user who
	      installs the port a dialog with the available options and saves
	      them to <code class="filename">/var/db/ports/portname/options</code>.
	      Next time when the port has to be rebuild, the options are reused.
	      Never again you will have to remember all the twenty
	      <code class="varname">WITH_<em class="replaceable"><code>*</code></em></code> and
	      <code class="varname">WITHOUT_<em class="replaceable"><code>*</code></em></code> options you
	      used to build this port!</p><p>When the user runs <code class="command">make config</code> (or runs
	      <code class="command">make build</code> for the first time), the framework will
	      check for
	      <code class="filename">/var/db/ports/portname/options</code>.
	      If that file does not exist, it will use the values of
	      <code class="varname">OPTIONS</code> to create a dialogbox where the options
	      can be enabled or disabled.  Then the
	      <code class="filename">options</code> file is saved and the selected
	      variables will be used when building the port.</p><p>If a new version of the port adds new
	      <code class="varname">OPTIONS</code>, the dialog will be presented to the
	      user, with the saved values of old <code class="varname">OPTIONS</code>
	      prefilled.</p><p>Use <code class="command">make showconfig</code> to see the saved
	      configuration.  Use <code class="command">make rmconfig</code> to remove the
	      saved configuration.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67904208"></a>5.11.2.2. Syntax</h4></div></div></div><p>The syntax for the <code class="varname">OPTIONS</code> variable is:

</p><pre class="programlisting">OPTIONS=	OPTION	"descriptive text" default ...
</pre><p>

	      The value for default is either <code class="literal">ON</code> or
	      <code class="literal">OFF</code>.  Multiple repetitions of these three fields
	      are allowed.</p><p><code class="varname">OPTIONS</code> definition must appear before
	      the inclusion of <code class="filename">bsd.port.pre.mk</code>.
	      The <code class="varname">WITH_*</code> and <code class="varname">WITHOUT_*</code>
	      variables can only be tested after the inclusion of
	      <code class="filename">bsd.port.pre.mk</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67909072"></a>5.11.2.3. Example</h4></div></div></div><div class="example"><a id="ports-options-simple-use"></a><div class="example-title">範例 5.8. Simple use of <code class="varname">OPTIONS</code></div><div class="example-contents"><pre class="programlisting">OPTIONS=      FOO "Enable option foo" On \
              BAR "Support feature bar" Off

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITHOUT_FOO)
CONFIGURE_ARGS+=	--without-foo
.else
CONFIGURE_ARGS+=	--with-foo
.endif

.if defined(WITH_BAR)
RUN_DEPENDS+=	bar:${PORTSDIR}/bar/bar
.endif

.include &lt;bsd.port.post.mk&gt;</pre></div></div><br class="example-break" /></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67911632"></a>5.11.3. Feature auto-activation</h3></div></div></div><p>When using a GNU configure script, keep an eye on which optional
	  features are activated by auto-detection.  Explicitly disable
	  optional features you do not wish to be used by passing respective
	  <code class="literal">--without-xxx</code> or <code class="literal">--disable-xxx</code>
	  in <code class="varname">CONFIGURE_ARGS</code>.</p><div class="example"><a id="idp67918032"></a><div class="example-title">範例 5.9. Wrong handling of an option</div><div class="example-contents"><pre class="programlisting">.if defined(WITH_FOO)
LIB_DEPENDS+=          foo.0:${PORTSDIR}/devel/foo
CONFIGURE_ARGS+=       --enable-foo
.endif</pre></div></div><br class="example-break" /><p>In the example above, imagine a library libfoo is installed on
	  the system.  User does not want this application to use libfoo, so he
	  toggled the option off in the <code class="literal">make config</code> dialog.
	  But the application's configure script detects the library present in
	  the system and includes its support in the resulting executable.  Now
	  when user decides to remove libfoo from the system, the ports system
	  does not protest (no dependency on libfoo was recorded) but the
	  application breaks.</p><div class="example"><a id="idp67920080"></a><div class="example-title">範例 5.10. Correct handling of an option</div><div class="example-contents"><pre class="programlisting">.if defined(WITH_FOO)
LIB_DEPENDS+=          foo.0:${PORTSDIR}/devel/foo
CONFIGURE_ARGS+=       --enable-foo
.else
CONFIGURE_ARGS+=       --disable-foo
.endif</pre></div></div><br class="example-break" /><p>In the second example, the library libfoo is explicitly disabled.
	  The configure script does not enable related features in the
	  application, despite library's presence in the system.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="makefile-info.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="makefile.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="makefile-wrkdir.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">5.10. Info files </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 5.12. Specifying the working directory</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>