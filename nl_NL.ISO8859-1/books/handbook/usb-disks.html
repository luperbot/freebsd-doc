<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>19.5. USB-opslagapparaten</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD handboek" /><link rel="up" href="disks.html" title="Hoofdstuk 19. Opslag" /><link rel="prev" href="raid.html" title="19.4. RAID" /><link rel="next" href="creating-cds.html" title="19.6. Optische media (CD's) aanmaken en gebruiken" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">19.5. USB-opslagapparaten</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="raid.html">Terug</a> </td><th width="60%" align="center">Hoofdstuk 19. Opslag</th><td width="20%" align="right"> <a accesskey="n" href="creating-cds.html">Volgende</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-disks"></a>19.5. USB-opslagapparaten</h2></div><div><span class="authorgroup">Bijgedragen door <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp79568592" class="indexterm"></a><p>Veel externe opslagoplossingen gebruiken tegenwoordig de
      Universele Seriële Bus (USB): harde schijven,
      USB-duimdrives, CD-R-branders, etc.  FreeBSD biedt voor al dit soort
      apparaten ondersteuning.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79578448"></a>19.5.1. Instellen</h3></div></div></div><p>Het stuurprogramma <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=umass&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">umass</span>(4)</span></a> biedt de ondersteuning
	voor USB-opslagapparaten.  Indien de kernel
	<code class="filename">GENERIC</code> wordt gebruikt, hoeft er niets aan
	de instellingen gewijzigd te worden.  Als er een eigen kernel
	wordt gebruikt, dienen de volgende regels in het
	kernelinstellingenbestand aanwezig zijn:</p><pre class="programlisting">device scbus
device da
device pass
device uhci
device ohci
device ehci
device usb
device umass</pre><p>Het stuurprogramma <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=umass&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">umass</span>(4)</span></a> gebruikt het subsysteem
	SCSI om toegang te krijgen tot de USB-opslagapparaten.  Het
	USB-apparaat wordt door het systeem als een SCSI-apparaat
	gezien.  Afhankelijk van de chipset op het moederbord is
	slechts òf <code class="literal">device uhci</code> òf
	<code class="literal">device ohci</code> nodig voor ondersteuning van USB 1.X.
	Het kan echter geen kwaad om ze beiden in het kernelinstellingenbestand
	te hebben.  Ondersteuning voor USB 2.0 wordt geleverd door het
	stuurprogramma <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ehci&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ehci</span>(4)</span></a> (de regel met
	<code class="literal">device ehci</code>).  Indien er regels zijn toegevoegd dient
	de kernel opnieuw gecompileerd en geïnstalleerd te worden.</p><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Indien het USB-apparaat een CD-R- of DVD-brander is,
	  dient het SCSI CD-ROM-stuurprogramma <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">cd</span>(4)</span></a> met de
	  volgende regel aan de kernel toegevoegd te worden:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">device cd</pre><p xmlns="http://www.w3.org/1999/xhtml">Aangezien de brander als een SCSI-schijf gezien wordt,
	  dient het stuurprogramma <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=atapicam&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">atapicam</span>(4)</span></a> niet in de
	  kernelinstellingen gebruikt te worden.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79587408"></a>19.5.2. Instellingen testen</h3></div></div></div><p>De instellingen zijn klaar om getest te worden: het
	USB-apparaat dient aangesloten te worden en in de buffer voor
	systeemmeldingen (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a>) dient het stuurprogramma
	ongeveer als volgt te verschijnen:</p><pre class="screen">umass0: USB Solid state disk, rev 1.10/1.00, addr 2
GEOM: create disk da0 dp=0xc2d74850
da0 at umass-sim0 bus 0 target 0 lun 0
da0: &lt;Generic Traveling Disk 1.11&gt; Removable Direct Access SCSI-2 device
da0: 1.000MB/s transfers
da0: 126MB (258048 512 byte sectors: 64H 32S/T 126C)</pre><p>Uiteraard kunnen het merk, de apparaatnode
	(<code class="filename">da0</code>) en andere details verschillen
	naar gelang de instelling.</p><p>Aangezien het USB-apparaat als een SCSI-apparaat gezien
	wordt, kan het commando <code class="command">camcontrol</code> gebruikt
	worden om de USB-opslagapparaten weer te geven die aan het
	systeem gekoppeld zijn:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>camcontrol devlist</code></strong>
&lt;Generic Traveling Disk 1.11&gt;      at scbus0 target 0 lun 0 (da0,pass0)</pre><p>Indien er een bestandssysteem op de schijf aanwezig is, kan
	dat aangekoppeld worden.  <a class="xref" href="disks-adding.html" title="19.3. Schijven toevoegen">Paragraaf 19.3, &#8220;Schijven toevoegen&#8221;</a> biedt
	indien nodig hulp bij het formatteren en aanmaken van partities
	op de USB-drive.</p><div xmlns="" class="warning"><h3 class="admontitle">Waarschuwing: </h3><p xmlns="http://www.w3.org/1999/xhtml">Door het toestaan dat gewone gebruikers verschillende
	  media kunnen koppelen door bijvoorbeeld het aanzetten van
	  <code class="literal">vfs.usermount</code> zoals hieronder beschreven,
	  zou niet als veilig beschoud moeten worden uit een
	  beveiligings oogpunt.  Veel bestandssystemen in FreeBSD zijn
	  niet geschreven om beveiliging te bieden tegen kwaadaardige
	  apparaten.</p></div><p>Om het apparaat koppelbaar te maken voor de gewone gebruiker
	moeten er een aantal stappen ondernomen worden.  Als eerste
	moeten de apparaten die gecreeerd worden wanneer het USB opslag-
	medium wordt toegevoegd toegankelijk zijn voor de gebruiker.
	Een oplossing is om alle gebruikers die deze rechten nodig hebben
	toe te voegen aan de <code class="systemitem">operator</code> groep.  Dit
	kan gedaan worden met <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a>.  Daarna moet het voor de
	<code class="systemitem">operator</code> groep mogelijk zijn te lezen en
	te schrijven naar de gecreeerde apparaten.  Dit kan bewerkstelligd
	worden door de volgende regels toe te voegen aan
	<code class="filename">/etc/devfs.rules</code>:</p><pre class="programlisting">[localrules=5]
add path 'da*' mode 0660 group operator</pre><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Als er SCSI schijven in het systeem aanwezig zijn moet dit
	  anders aangepakt worden.  Stel dat het systeem reeds over de
	  volgende schijven beschikt <code class="filename">da0</code> tot
	  en met <code class="filename">da2</code>, verander de regel dan
	  in het volgende:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">add path 'da[3-9]*' mode 0660 group operator</pre><p xmlns="http://www.w3.org/1999/xhtml">Dit sluit de reeds bestaande schijven buiten van toegang
	  door de operator groep.</p></div><p>Erna moet ook de nieuwe ruleset voor <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs.rules</span>(5)</span></a>
	ingeschakeld worden door middel van
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">devfs_system_ruleset="localrules"</pre><p>Hierna moet de kernel worden geconfigureerd zodat gewone
	gebruikers rechten krijgen om bestandssystemen te koppelen.
	De makkelijkste manier is door de volgende regel toe te voegen
	aan <code class="filename">/etc/sysctl.conf</code>:</p><pre class="programlisting">vfs.usermount=1</pre><p>Let op, deze wijziging wordt pas actief na de volgende
	start van het systeem.  Als alternatief kan ook <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	gebruikt worden om deze variabele te zetten.</p><p>De laatste stap is het creëeren van de map waar het
	bestandssysteem gekoppeld wordt.  Deze map moet eigendom zijn
	van de gebruiker die het bestandssysteem gaat koppelen.  Een
	manier om dat te bewerkstelligen is door met de gebruiker
	<code class="systemitem">root</code> een submap aan te maken die eigendom
	is van de gebruiker als
	<code class="filename">/mntgebruikersnaam</code>
	(verander <em class="replaceable"><code>gebruikersnaam</code></em> door de
	loginnaam van de daadwerkelijke gebruiker en
	<em class="replaceable"><code>gebruikersgroep</code></em> door de primaire
	groep van de gebruiker):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /mnt/gebruikersnaam</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown gebruikersnaam:gebruikersgroep /mnt/gebruikersnaam</code></strong></pre><p>Stel dat er vervolgens een USB-stick ingeplugged wordt en er
	een <code class="filename">/dev/da0s1</code> aangemaakt wordt.  Omdat
	deze apparaten meestal voorgeformatteerd met een
	FAT-bestandssysteem komen, kan deze als volgende gekoppeld
	worden:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mount -t msdosfs -o -m=644,-M=755 /dev/da0s1 /mnt/gebruikersnaam</code></strong></pre><p>Indien het apparaat losgekoppeld wordt (nadat de schijf
	afgekoppeld is), dient in de buffer voor systeemmeldingen iets
	als het volgende te zien te zijn:</p><pre class="screen">umass0: at uhub0 port 1 (addr2) disconnected
(da0:umass-sim0:0:0:0): lost device
(da0:umass-sim0:0:0:0): removing device entry
GEOM: destroy disk da0 dp=0xc2d74850
umass0: detached</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79638864"></a>19.5.3. Referenties</h3></div></div></div><p>Naast de onderdelen <a class="link" href="disks-adding.html" title="19.3. Schijven toevoegen">Schijven
	  toevoegen</a> en <a class="link" href="mount-unmount.html" title="4.6. Het koppelen en ontkoppelen van bestandssystemen">Bestandssystemen aan- en
	  afkoppelen</a>, kunnen de volgende hulppagina's ook nuttig
	zijn: <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=umass&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">umass</span>(4)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=camcontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">camcontrol</span>(8)</span></a> en <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=usbconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">usbconfig</span>(8)</span></a> voor
	FreeBSD 8.X of <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=usbdevs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">usbdevs</span>(8)</span></a> voor eerdere versies van FreeBSD.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="raid.html">Terug</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Omhoog</a></td><td width="40%" align="right"> <a accesskey="n" href="creating-cds.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">19.4. RAID </td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top"> 19.6. Optische media (CD's) aanmaken en gebruiken</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>