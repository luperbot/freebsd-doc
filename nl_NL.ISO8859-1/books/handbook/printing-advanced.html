<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>10.4. Geavanceerde printerinstallatie</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD handboek" /><link rel="up" href="printing.html" title="Hoofdstuk 10. Afdrukken" /><link rel="prev" href="printing-intro-setup.html" title="10.3. Standaardinstallatie" /><link rel="next" href="printing-using.html" title="10.5. Printers gebruiken" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">10.4. Geavanceerde printerinstallatie</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="printing-intro-setup.html">Terug</a> </td><th width="60%" align="center">Hoofdstuk 10. Afdrukken</th><td width="20%" align="right"> <a accesskey="n" href="printing-using.html">Volgende</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-advanced"></a>10.4. Geavanceerde printerinstallatie</h2></div></div></div><p>Deze sectie behandelt het gebruik van filters om speciaal
      opgemaakte tekst en voorbladen af te drukken, via het netwerk af
      te drukken en printergebruik te beperken en statistieken bij te
      houden.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-filter-intro"></a>10.4.1. Filters</h3></div></div></div><a id="idp73225424" class="indexterm"></a><p>Hoewel <span class="application">LPD</span> veel van het
	afdrukwerk afhandelt (netwerkverkeer, wachtrijafhandeling,
	toegangscontrole, enzovoort), wordt het
	<span class="emphasis"><em>echte</em></span> werk door de filters gedaan.
	Filters zijn programma's die met een printer communiceren en
	inspelen op printerspecifieke eigenschappen.  In de eenvoudige
	printeropzet is een filter geïnstalleerd voor platte
	tekst, een zeer eenvoudig filter dat met de meeste printers zou
	moeten werken (<a class="link" href="printing-intro-setup.html#printing-textfilter" title="10.3.1.5.6. Tekstfilter installeren">Tekstfilter
	  installeren</a>).</p><p>Om echter gebruik te maken van formaatomzetting,
	printeradministratie, printerspecifieke aanpassingen,
	enzovoort, is het nodig te weten hoe filters werken.
	Uiteindelijk is het de verantwoordelijkheid van het filter om
	deze zaken af te handelen.  Het slechte nieuws is dat
	<span class="emphasis"><em>de beheerder</em></span> in het merendeel van de
	gevallen het filter moet aanleveren.  Het goede nieuws is dat
	veel filters algemeen beschikbaar zijn en als ze dat niet zijn,
	zijn ze vaak makkelijk te schrijven.</p><p>FreeBSD heeft een ingebouwd filter,
	<code class="filename">/usr/libexec/lpr/lpf</code>, die met veel
	printers werkt die platte tekst kunnen afdrukken.  Het filter
	regelt backspace en tabs in bestanden en administreert
	printergebruik, maar dat is zo'n  beetje alles wat dit filter
	doet.  Er zijn ook diverse filters en filtercomponenten in de
	FreeBSD Portscollectie.</p><p>Hieronder wordt het volgende beschreven:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>In <a class="link" href="printing-advanced.html#printing-advanced-filters" title="10.4.1.1. Hoe filters werken">Hoe
	      filters werken</a> staat een overzicht van de rol die
	    een filter speelt in het afdrukproces.  Lees dat onderdeel
	    om een indruk te krijgen wat er <span class="quote">&#8220;<span class="quote">onder de
	    motorkap</span>&#8221;</span> gebeurt als <span class="application">LPD</span>
	    filters gebruikt.  Deze kennis helpt mogelijke problemen te
	    voorkomen of op te lossen als meerdere filters worden
	    geïnstalleerd voor printers.</p></li><li class="listitem"><p><span class="application">LPD</span> gaat er van uit dat elke
	    printer standaard platte tekst af kan drukken.  Dit geeft
	    problemen voor <span class="trademark">PostScript</span>® (of andere op taal gebaseerde)
	    printers die niet in staat zijn direct platte tekst af te
	    drukken.  In <a class="link" href="printing-advanced.html#printing-advanced-if-conversion" title="10.4.1.2. Platte tekst op PostScript®-printers afdrukken">Platte tekst
	    op <span class="trademark">PostScript</span>®-printers afdrukken</a> staat wat er kan
	    worden gedaan om dit probleem te verhelpen.  Lees verder in
	    dit onderdeel als het om <span class="trademark">PostScript</span>®-printers gaat.</p></li><li class="listitem"><p>Voor veel programma's is <span class="trademark">PostScript</span>® een populair
	    uitvoerformaat.  Sommige mensen schrijven <span class="trademark">PostScript</span>® code
	    zelfs direct.  <span class="trademark">PostScript</span>®-printers zijn echter kostbaar.
	    In <a class="link" href="printing-advanced.html#printing-advanced-ps" title="10.4.1.3. PostScript® simuleren op niet-PostScript®-printers"><span class="trademark">PostScript</span>®
	    simuleren op niet-<span class="trademark">PostScript</span>®-printers</a> staat hoe
	    de tekstfilter van een printer aangepast moet worden zodat
	    die <span class="trademark">PostScript</span>® accepteert en afdrukt op een
	    <span class="emphasis"><em>niet-<span class="trademark">PostScript</span>®</em></span>-printer.  Dit
	    onderdeel is van toepassing voor
	    niet-<span class="trademark">PostScript</span>®-printers.</p></li><li class="listitem"><p>In <a class="link" href="printing-advanced.html#printing-advanced-convfilters" title="10.4.1.4. Conversiefilters">Conversiefilters</a>
	    wordt een methode beschreven om de conversie van bepaalde
	    bestandsformaten te automatiseren, zoals van grafische of
	    tekstopmaakprogramma's, naar formaten die een printer kan
	    begrijpen.  Na het lezen van dit onderdeel is een beheerder
	    in staat om een printer zodanig in te stellen dat
	    gebruikers <code class="command">lpr -t</code> kunnen
	    invoeren om troff-gegevens af te drukken, <code class="command">lpr
	    -d</code> om <span class="application">TeX</span> DVI-gegevens af te
	    drukken of <code class="command">lpr -v</code> om
	    rasterplaatjes af te drukken, enzovoorts.  Het wordt
	    aangeraden deze sectie te lezen.</p></li><li class="listitem"><p>In <a class="link" href="printing-advanced.html#printing-advanced-of" title="10.4.1.5. Uitvoerfilters">Uitvoerfilters</a>
	    wordt een niet vaak gebruikte functionaliteit van
	    <span class="application">LPD</span> behandeld: uitvoerfilters.
	    Tenzij voorbladen worden afgedrukt (<a class="link" href="printing-advanced.html#printing-advanced-header-pages" title="10.4.2. Voorbladen">Voorbladen</a>),
	    kan deze sectie waarschijnlijk overgeslagen worden.</p></li><li class="listitem"><p><a class="link" href="printing-advanced.html#printing-advanced-lpf" title="10.4.1.6. lpf: een tekstfilter">lpf: een
	      tekstfilter</a> beschrijft <code class="command">lpf</code>, een
	    redelijk complete, eenvoudige tekstfilter voor lijnprinters
	    (en laserprinters die zich als lijnprinters voordoen) dat
	    wordt geleverd bij FreeBSD.  Voor een snelle manier om
	    printeradministratie aan de praat te krijgen voor platte
	    tekst of voor printers waar rook uit komt bij het zien van
	    backspace karakters, is het serieus te overwegen gebruik te
	    maken van <code class="command">lpf</code>.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Een kopie van de scripts die hieronder worden beschreven,
	  staan in de map <code class="filename">/usr/share/examples/printing</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-filters"></a>10.4.1.1. Hoe filters werken</h4></div></div></div><p>Zoals eerder genoemd, is een filter een programma dat
	  wordt uitgevoerd door <span class="application">LPD</span> voor het
	  afhandelen van het apparaatafhankelijke deel van de
	  communicatie met een printer.</p><p>Als <span class="application">LPD</span> een bestand wil
	  afdrukken uit een afdrukopdracht, start het een
	  filterprogramma.  Het koppelt de standaard invoer van de
	  filter aan het af te drukken bestand, de standaard uitvoer
	  aan de printer en de standaard foutmelding aan het
	  logboekbestand voor foutmeldingen (zoals opgegeven via de
	  optie <code class="literal">lf</code> in
	  <code class="filename">/etc/printcap</code> of standaard
	  <code class="filename">/dev/console</code>).</p><a id="idp73269840" class="indexterm"></a><p>Welk filter <span class="application">LPD</span> start en de
	  argumenten van het filter hangen af van wat er in het bestand
	  <code class="filename">/etc/printcap</code> wordt opgegeven en de
	  argumenten die de gebruiker geeft op de commandoregel van
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a>.  Als een gebruiker bijvoorbeeld
	  <code class="command">lpr -t</code> ingeeft, start
	  <span class="application">LPD</span> het filter troff, zoals wordt
	  opgegeven via de optie <code class="literal">tf</code> voor de
	  betreffende printer.  Als een gebruiker platte tekst wilt
	  afdrukken, dan wordt het filter <code class="literal">if</code> gestart
	  (dit klopt bijna: zie <a class="link" href="printing-advanced.html#printing-advanced-of" title="10.4.1.5. Uitvoerfilters">Uitvoerfilters</a> voor
	  de details).</p><p>Er zijn drie soorten filters die in
	  <code class="filename">/etc/printcap</code> kunnen worden
	  opgegeven:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Het tekstfilter, dat in de
	      <span class="application">LPD</span> documentatie verwarrend
	      genoeg <span class="emphasis"><em>input filter</em></span> wordt genoemd,
	      verwerkt het afdrukken van gewone tekst.  Beschouw het
	      als het standaardfilter.  <span class="application">LPD</span>
	      verwacht dat elke printer standaard platte tekst kan
	      afdrukken en het is de taak van het tekstfilter om er voor
	      te zorgen dat backspaces, tabs en andere speciale
	      karakters de printer niet in de war sturen.  In een
	      omgeving waar moet worden bijgehouden hoeveel er wordt
	      afgedrukt, moet het tekstfilter ook administreren hoeveel
	      pagina's er zijn afgedrukt.  Dit gaat meestal door het
	      aantal afgedrukte regels te tellen en dit te vergelijken
	      met het aantal regels per pagina dat door de printer
	      wordt ondersteund.  Het tekstfilter wordt aangeroepen met
	      de volgende lijst argumenten:</p><div class="cmdsynopsis"><p><code class="command">filter-name</code> [-c]  -w <em class="replaceable"><code>width</code></em>   -l <em class="replaceable"><code>length</code></em>   -i <em class="replaceable"><code>indent</code></em>   -n <em class="replaceable"><code>login</code></em>   -h <em class="replaceable"><code>host</code></em>   <em class="replaceable"><code>acct-file</code></em> </p></div><p>met</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-c</code></span></dt><dd><p>wordt gebruikt als de afdrukopdracht is gegeven
		    met <code class="command">lpr -l</code></p></dd><dt><span class="term"><em class="replaceable"><code>width</code></em></span></dt><dd><p>is de waarde van de optie <code class="literal">pw</code>
		    (<span class="emphasis"><em>page width</em></span>: paginabreedte),
		    zoals opgegeven
		    in <code class="filename">/etc/printcap</code>, standaard
		    132</p></dd><dt><span class="term"><em class="replaceable"><code>length</code></em></span></dt><dd><p>is de waarde van de optie <code class="literal">pl</code>
		    (<span class="emphasis"><em>page length</em></span>: paginalengte),
		    standaard 66</p></dd><dt><span class="term"><em class="replaceable"><code>indent</code></em></span></dt><dd><p>geeft aan hoeveel wordt ingesprongen door
		    <code class="command">lpr -i</code>,
		    standaard 0</p></dd><dt><span class="term"><em class="replaceable"><code>login</code></em></span></dt><dd><p>de gebruikersnaam van de gebruiker die de
		    afdrukopdracht gaf</p></dd><dt><span class="term"><em class="replaceable"><code>host</code></em></span></dt><dd><p>de hostnaam waar de afdrukopdracht gegeven is</p></dd><dt><span class="term"><em class="replaceable"><code>acct-file</code></em></span></dt><dd><p>de naam van het administratiebestand zoals
		    opgegeven via de optie <code class="literal">af</code>.</p></dd></dl></div></li><li class="listitem"><p>Een <span class="emphasis"><em>conversiefilter</em></span><a id="idp73312208" class="indexterm"></a> converteert
	      een specifiek bestandsformaat naar een formaat dat een
	      printer begrijpt.  Bijvoorbeeld: ditroff
	      typesettinggegevens kunnen niet direct worden afgedrukt,
	      maar er bestaat wel een conversiefilter om
	      ditroff-gegevens te converteren naar een formaat dat een
	      printer kan verteren en afdrukken.  Dit wordt in <a class="link" href="printing-advanced.html#printing-advanced-convfilters" title="10.4.1.4. Conversiefilters">Conversiefilters</a>
	      beschreven.  Conversiefilters zijn ook nodig om
	      printergebruik te administreren, mocht dat nodig zijn.
	      Conversiefilters worden met de volgende argumenten
	      aangeroepen:</p><div class="cmdsynopsis"><p><code class="command">filter-name</code>  -x
		<em class="replaceable"><code>pixel-width</code></em>   -y
		<em class="replaceable"><code>pixel-height</code></em>   -n <em class="replaceable"><code>login</code></em>   -h <em class="replaceable"><code>host</code></em>   <em class="replaceable"><code>acct-file</code></em> </p></div><p>Hier is <em class="replaceable"><code>pixel-width</code></em> de
	      waarde van de optie <code class="literal">px</code> (standaard 0)
	      en <em class="replaceable"><code>pixel-height</code></em> is de waarde
	      van de optie <code class="literal">py</code> (standaard 0).</p></li><li class="listitem"><p>Het <span class="emphasis"><em>uitvoerfilter</em></span> wordt alleen
	      gebruikt als er geen tekstfilter is of als er voorbladen
	      worden afgedrukt.  De ervaring leert dat uitvoerfilters
	      zelden worden gebruikt.  In sectie <a class="link" href="printing-advanced.html#printing-advanced-of" title="10.4.1.5. Uitvoerfilters">Uitvoerfilters</a>
	      worden ze beschreven.  Er zijn slechts twee argumenten die
	      aan een uitvoerfilter worden meegegeven:</p><div class="cmdsynopsis"><p><code class="command">filter-name</code>  -w <em class="replaceable"><code>width</code></em>   -l <em class="replaceable"><code>length</code></em> </p></div><p>Deze zijn identiek aan de argumenten
	      <code class="option">-w</code> en <code class="option">-l</code> van het
	      tekstfilter.</p></li></ul></div><p>Filters moeten <span class="emphasis"><em>afsluiten</em></span> met de
	  volgende waarde:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">exit 0</span></dt><dd><p>Als het filter een bestand succesvol heeft
		afgedrukt.</p></dd><dt><span class="term">exit 1</span></dt><dd><p>Als het filter niet geslaagd is om een bestand af
		te drukken, maar wil dat <span class="application">LPD</span>
		het nogmaals probeert.  <span class="application">LPD</span>
		herstart het filter als die afsluit met deze
		status.</p></dd><dt><span class="term">exit 2</span></dt><dd><p>Als het filter niet geslaagd is om een bestand af
		te drukken, maar niet wil dat
		<span class="application">LPD</span> het nogmaals probeert.
		<span class="application">LPD</span> verwijdert het bestand
		uit de wachtrij.</p></dd></dl></div><p>Het tekstfilter dat bij FreeBSD wordt geleverd,
	  <code class="filename">/usr/libexec/lpr/lpf</code>, benut de
	  argumenten voor paginabreedte en -lengte om te bepalen
	  wanneer een nieuwe pagina moet worden begonnen en om het
	  printergebruik bij te houden.  Het gebruikt de argumenten
	  voor login, host en administratiebestand om accountingregels
	  aan te maken.</p><p>Controleer bij het zoeken naar filters of ze
	  LPD-compatibel zijn.  Zo ja, dan ondersteunen ze de
	  argumenten zoals hierboven beschreven.  Zorg bij het zelf
	  schrijven van filters voor algemeen gebruik dat ze dezelfde
	  argumenten en exitcodes ondersteunen.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-if-conversion"></a>10.4.1.2. Platte tekst op <span class="trademark">PostScript</span>®-printers afdrukken</h4></div></div></div><a id="idp73335760" class="indexterm"></a><p>Als een computer en <span class="trademark">PostScript</span>® (of andere op taal
	  gebaseerde) printer maar één gebruiker hebben
	  die belooft nooit platte tekst naar de printer te sturen of
	  programma's te gebruiken die dat doen, dan is dit onderdeel
	  overbodig.</p><p>Als gebruikers zowel <span class="trademark">PostScript</span>® als platte tekst
	  naar een printer willen sturen, dan is het aan te raden de
	  printerinstellingen hierop aan te passen.  Hiervoor moet het
	  tekstfilter bij elke nieuwe opdracht bepalen of het om platte
	  tekst of <span class="trademark">PostScript</span>® gaat.  Alle <span class="trademark">PostScript</span>®-opdrachten
	  beginnen met <code class="literal">%!</code> (raadpleeg de
	  printerhandleiding voor andere printertalen).  Als dit de
	  eerste twee karakters zijn van een opdracht is het
	  <span class="trademark">PostScript</span>® en kan de rest van een opdracht direct
	  doorgestuurd worden.  Is dit niet het geval, dan moet de
	  filter de tekst omzetten in <span class="trademark">PostScript</span>® en het resultaat
	  afdrukken.</p><p>Hoe gaat dat werken?</p><a id="idp73340880" class="indexterm"></a><p>Voor seriële printers kan het meest eenvoudig
	  <code class="command">lprps</code> geïnstalleerd worden.
	  <code class="command">lprps</code> is een <span class="trademark">PostScript</span>®-afdrukfilter
	  die tweewegcommunicatie met een printer heeft.  Het werkt
	  het statusbestand van een printer bij met uitgebreide
	  informatie afkomstig van een printer, zodat gebruikers en
	  beheerders precies kunnen zien wat de status van een printer
	  is (zoals: <span class="errorname">toner bijna op</span> of
	  <span class="errorname">papier vastgelopen</span>).  Maar
	  belangrijker, het omvat het programma <code class="command">psif</code>
	  dat bepaalt of een binnenkomende opdracht platte tekst is en
	  <code class="command">textps</code> (dat ook geleverd wordt met
	  <code class="command">lprps</code>) om opdrachten om te zetten naar
	  <span class="trademark">PostScript</span>®.  Vervolgens wordt een opdracht met
	  <code class="command">lprps</code> naar een printer gestuurd.</p><p><code class="command">lprps</code> is onderdeel van de FreeBSD
	  Portscollectie (zie <a class="link" href="ports.html" title="Hoofdstuk 5. Applicaties installeren: pakketten en ports">De
	  Portscollectie</a>).  U kunt één van de
	  ports <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print/lprps-a4/pkg-descr">print/lprps-a4</a> of
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print-lprps-letter/pkg-descr">print-lprps-letter</a>
	  installeren afhankelijk van de gebruikte papiermaat.  Nadat
	  <code class="command">lprps</code> is geïnstalleerd moet de
	  installatielocatie ervan aan <code class="command">psif</code> worden
	  doorgeven dat onderdeel is van <code class="command">lprps</code>.  Als
	  <code class="command">lprps</code> is geïnstalleerd via de
	  Portscollectie, gebruik dan het volgende voor de seriële
	  <span class="trademark">PostScript</span>®-printer in <code class="filename">/etc/printcap</code>:</p><pre class="programlisting">:if=<code class="filename">/usr/local/libexec/psif</code>:</pre><p>Ook moet de optie <code class="literal">rw</code> worden opgeven,
	  die <span class="application">LPD</span> vertelt om een printer in
	  lezen/schrijvenmodus te openen.</p><p>Als een parallelle <span class="trademark">PostScript</span>®-printer wordt ingesteld
	  (en dus geen tweewegcommunicatie toegepast kan worden met de
	  printer, zoals vereist door <code class="command">lprps</code>), dan
	  kan het volgende shellscript gebruikt worden als
	  tekstfilter:</p><pre class="programlisting">#!/bin/sh
#
#  psif - Druk <span class="trademark">PostScript</span>® of platte tekst af op een <span class="trademark">PostScript</span>®
#  printer. Script versie; NIET de versie die wordt geleverd bij lprps
#  Geïnstalleerd in /usr/local/libexec/psif
#

IFS="" read -r first_line
first_two_chars=`expr "$first_line" : '\(..\)'`

if [ "$first_two_chars" = "%!" ]; then
    #
    #  <span class="trademark">PostScript</span>® opdracht, afdrukken.
    #
    echo "$first_line" &amp;&amp; cat &amp;&amp; printf "\004" &amp;&amp; exit 0
    exit 2
else
    #
    #  Platte tekst, converteren en dan afdrukken.
    #
    ( echo "$first_line"; cat ) | /usr/local/bin/textps &amp;&amp; printf "\004" &amp;&amp; exit 0
    exit 2
fi</pre><p>In bovenstaand script is <code class="command">textps</code> een
	  programma dat geïnstalleerd is om platte tekst om te
	  zetten naar <span class="trademark">PostScript</span>®.  Elk tekst-naar-<span class="trademark">PostScript</span>®
	  programma volstaat.  De FreeBSD Portscollectie (zie <a class="link" href="ports.html" title="Hoofdstuk 5. Applicaties installeren: pakketten en ports">De Portscollectie</a>) bevat een
	  uitgebreid tekst-naar-<span class="trademark">PostScript</span>®-programma,
	  <code class="literal">a2ps</code>, dat wellicht handig is om te
	  gebruiken.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-ps"></a>10.4.1.3. <span class="trademark">PostScript</span>® simuleren op
	  niet-<span class="trademark">PostScript</span>®-printers</h4></div></div></div><a id="idp73369808" class="indexterm"></a><a id="idp73371216" class="indexterm"></a><p><span class="trademark">PostScript</span>® is <span class="emphasis"><em>de facto</em></span> de
	  standaard voor op hoge kwaliteit typesetten en afdrukken.
	  <span class="trademark">PostScript</span>® is echter een <span class="emphasis"><em>dure</em></span>
	  standaard.  Gelukkig heeft Aladdin Enterprises een gratis
	  <span class="trademark">PostScript</span>®-kloon, <span class="application">Ghostscript</span>,
	  die werkt onder FreeBSD.  <span class="application">Ghostscript</span>
	  kan de meeste <span class="trademark">PostScript</span>®-bestanden lezen en de pagina's op
	  verschillende soorten apparaten weergeven, waaronder veel
	  niet-<span class="trademark">PostScript</span>®-printers.  Door
	  <span class="application">Ghostscript</span> te installeren en een
	  printer gebruik te laten maken van een speciaal tekstfilter
	  voor uw printer, kan uw niet-<span class="trademark">PostScript</span>®-printer zich
	  gedragen als een echte <span class="trademark">PostScript</span>®-printer.</p><p>Ghostscript is beschikbaar via de FreeBSD Portscollectie,
	  vele versies zijn beschikbaar, de meest gebruikte versie is
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript-gpl/pkg-descr">print/ghostscript-gpl</a>.</p><p>Om <span class="trademark">PostScript</span>® te simuleren moet een tekstfilter
	  detecteren of het een <span class="trademark">PostScript</span>®-bestand aan het afdrukken
	  is.  Zo niet, dan stuurt het filter het bestand direct naar
	  een printer, anders gebruikt het filter
	  <span class="application">Ghostscript</span> om het bestand om te
	  zetten naar een formaat dat door een printer wordt begrepen.</p><p>Een voorbeeld: het volgende script is een tekstfilter
	  voor Hewlett Packard DeskJet 500 printers.  Voor andere
	  printers moet het argument <code class="option">-sDEVICE</code> voor het
	  commando <code class="command">gs</code>
	  (<span class="application">Ghostscript</span>) vervangen worden.
	  (Met <code class="command">gs -h</code> wordt een lijst met apparaten
	  getoond worden die de huidige installatie van
	  <span class="application">Ghostscript</span> ondersteunt.)</p><pre class="programlisting">#!/bin/sh
#
#  ifhp - Druk Ghostscript-gesimuleerd <span class="trademark">PostScript</span>® af op een DeskJet
#  500.  Geïnstalleerd in /usr/local/libexec/ifhp

#
#  Behandel LF als CR+LF (om een "trapeffect" op HP/PCL
#  printer te voorkomen):
#
printf "\033&amp;k2G" || exit 2

#
#  Lees de eerste twee karakters van het bestand
#
IFS="" read -r first_line
first_two_chars=`expr "$first_line" : '\(..\)'`

if [ "$first_two_chars" = "%!" ]; then
    #
    #  Het is <span class="trademark">PostScript</span>®. Gebruik Ghostscript om te converteren
    #  en druk het af.
    #
    /usr/local/bin/gs -dSAFER -dNOPAUSE -q -sDEVICE=djet500 \
        -sOutputFile=- - &amp;&amp; exit 0
else
    #
    #  Platte tekst of HP/PCL, dus direct afdrukken;  druk een
    #  pagina-einde af om de laatste pagina te ejecteren.
    #
    echo "$first_line" &amp;&amp; cat &amp;&amp; printf "\033&amp;l0H" &amp;&amp;
exit 0
fi

exit 2</pre><p>Tot slot moet <span class="application">LPD</span> op de hoogte
	  gebracht worden van het filter via de optie
	  <code class="literal">if</code>:</p><pre class="programlisting">:if=<code class="filename">/usr/local/libexec/ifhp</code>:</pre><p>Dat is alles.  Nu kan <code class="command">lpr
	    platte.tekst</code>
	  en <code class="command">lpr
	    watdanook.ps</code>
	  ingevoerd worden en beiden worden juist afgedrukt.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-convfilters"></a>10.4.1.4. Conversiefilters</h4></div></div></div><p>Na de eenvoudige installatie, zoals beschreven in <a class="link" href="printing-intro-setup.html#printing-simple" title="10.3.1. Eenvoudige printerinstallatie">Eenvoudige printerinstallatie</a>,
	  te hebben voltooid, is het
	  waarschijnlijk wenselijk om conversiefilters te installeren
	  voor favoriete bestandsformaten (naast platte
	  ASCII-tekst).</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73393488"></a>10.4.1.4.1. Waarom conversiefilters installeren?</h5></div></div></div><a id="idp73394128" class="indexterm"></a><p>Conversiefilters maken het afdrukken van verschillende
	    bestanden eenvoudig.  Stel dat veel gebruik gemaakt wordt
	    van het tekstverwerkingsprogramma <span class="application">TeX</span> en een <span class="trademark">PostScript</span>®
	    printer.  Elke keer als door <span class="application">TeX</span> een DVI-bestand wordt
	    gegenereerd, kan dat niet direct afgedrukt worden.  Het
	    DVI-bestand moet omgezet worden naar <span class="trademark">PostScript</span>®.  De te
	    geven opdrachten zijn de volgende:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>dvips zeewieranalyse.dvi</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>lpr zeewieranalyse.ps</code></strong></pre><p>Na installatie van een conversiefilter voor
	    DVI-bestanden kan deze handmatige conversie overgeslagen
	    worden door <span class="application">LPD</span> de conversie te
	    laten uitvoeren.  Elke keer als een DVI-bestand wordt
	    afgedrukt, hoeft alleen de volgende opdracht gegeven te
	    worden:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpr -d zeewieranalyse.dvi</code></strong></pre><p><span class="application">LPD</span> voert de
	    DVI-bestandsconversie uit door <code class="option">-d</code> te
	    geven.  In <a class="link" href="printing-using.html#printing-lpr-options-format" title="10.5.4.1. Opties voor opmaak en conversie">Opties voor opmaak
	    en conversie</a> staat een lijst van
	    conversie-opties.</p><p>Voor elke conversie-optie moet een
	    <span class="emphasis"><em>conversiefilter</em></span> geïnstalleerd
	    worden en moet in <code class="filename">/etc/printcap</code> de
	    locatie worden opgegeven.  Een conversiefilter is als het
	    tekstfilter voor de eenvoudige printerinstallatie (<a class="link" href="printing-intro-setup.html#printing-textfilter" title="10.3.1.5.6. Tekstfilter installeren">Tekstfilter
	      installeren</a>), behalve dat in plaats van platte
	    tekst af te drukken, het conversiefilter het bestand
	    converteert naar een formaat dat een printer
	    begrijpt.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73412944"></a>10.4.1.4.2. Welke conversiefilters installeren?</h5></div></div></div><p>Installeer de conversiefilters die nodig zijn.  Als
	    veel DVI-bestanden worden afgedrukt, dan is het handig een
	    DVI-filter te installeren.  Als veel troff wordt afgedrukt,
	    dan is het waarschijnlijk handig een troff-filter te
	    installeren.</p><p>De volgende tabel geeft een samenvatting van filters
	    waarmee <span class="application">LPD</span> kan werken, hoe ze
	    in <code class="filename">/etc/printcap</code> kunnen worden
	    aangeroepen en hoe ze met <code class="command">lpr</code> kunnen
	    worden aangeroepen:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Bestandsformaat</th><th><code class="filename">/etc/printcap</code>
		    optie</th><th><code class="command">lpr</code> optie</th></tr></thead><tbody><tr><td>cifplot</td><td><code class="literal">cf</code></td><td><code class="option">-c</code></td></tr><tr><td>DVI</td><td><code class="literal">df</code></td><td><code class="option">-d</code></td></tr><tr><td>plot</td><td><code class="literal">gf</code></td><td><code class="option">-g</code></td></tr><tr><td>ditroff</td><td><code class="literal">nf</code></td><td><code class="option">-n</code></td></tr><tr><td>FORTRAN-tekst</td><td><code class="literal">rf</code></td><td><code class="option">-f</code></td></tr><tr><td>troff</td><td><code class="literal">tf</code></td><td><code class="option">-f</code></td></tr><tr><td>raster</td><td><code class="literal">vf</code></td><td><code class="option">-v</code></td></tr><tr><td>platte tekst</td><td><code class="literal">if</code></td><td>geen, <code class="option">-p</code>, of
		    <code class="option">-l</code></td></tr></tbody></table></div><p>In het voorbeeld waarbij <code class="command">lpr
	      -d</code> wordt gebruikt, moet voor de
	    printer een optie <code class="literal">df</code> gedefinieerd staan
	    in <code class="filename">/etc/printcap</code>.</p><a id="idp73440336" class="indexterm"></a><p>Ondanks wat anderen mogelijk beweren, zijn formaten als
	    FORTRAN-tekst en plot waarschijnlijk verouderd.  Dit biedt
	    de mogelijkheid een nieuwe betekenis te geven aan deze
	    opties door zelf een filter te installeren.  Stel dat direct
	    Printerleaf-bestanden afgedrukt moeten worden (bestanden van
	    het bureaubladpublicatieprogramma Interleaf), maar nooit
	    plotbestanden worden afgedrukt.  Dan kan een
	    Printerleaf-conversiefilter geïnstalleerd worden onder
	    de optie <code class="literal">gf</code> en gebruikers kunnen
	    geïnstrueerd worden om <code class="command">lpr -g
	    </code> te gebruiken om Printerleaf-bestanden af te
	    drukken.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73450448"></a>10.4.1.4.3. Conversiefilters installeren</h5></div></div></div><p>Aangezien conversiefilters programma's zijn die niet
	    onder de FreeBSD-basisinstallatie vallen, kunnen ze het best
	    onder <code class="filename">/usr/local</code>
	    geplaatst worden.  De map <code class="filename">/usr/local/libexec</code> is een
	    veelgebruikte locatie, omdat hier programma's te vinden zijn
	    die alleen door <span class="application">LPD</span> gebruikt
	    worden.  Gewone gebruikers hoeven ze nooit te gebruiken.</p><p>Om een conversiefilter te activeren, moet de
	    bestandslocatie onder de juiste optie voor de betreffende
	    printer in <code class="filename">/etc/printcap</code> opgegeven
	    worden.</p><p>In het onderstaande voorbeeld wordt het
	    DVI-conversiefilter toegevoegd onder de sectie van de
	    printer <code class="literal">bamboo</code>.  Hieronder staat opnieuw
	    het voorbeeldbestand <code class="filename">/etc/printcap</code>, nu
	    met de nieuwe optie <code class="literal">df</code> voor de printer
	    <code class="literal">bamboo</code>:</p><pre class="programlisting">#
#  /etc/printcap voor host rose - df-filter voor bamboo toegevoegd
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=<code class="filename">/var/spool/lpd/rattan</code>:\
        :lp=<code class="filename">/dev/lpt0</code>:\
        :if=<code class="filename">/usr/local/libexec/if-simple</code>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:<code class="filename">sd=/var/spool/lpd/bamboo</code>:\
        :lp=<code class="filename">/dev/ttyu5</code>:ms#-parenb cs8 clocal crtscts:rw:\
        :if=<code class="filename">/usr/local/libexec/psif</code>:\
        :df=<code class="filename">/usr/local/libexec/psdf</code>:</pre><p>Het DVI-filter is een shellscript met de naam
	    <code class="filename">/usr/local/libexec/psdf</code>.  Het script
	    ziet er als volgt uit:</p><pre class="programlisting">#!/bin/sh
#
#  psdf - DVI naar PostScript afdrukfilter
#  Geïnstalleerd in /usr/local/libexec/psdf
#
# Aangeroepen door lpd wanneer een gebruiker lpr -d uitvoert
#
exec /usr/local/bin/dvips -f | /usr/local/libexec/lprps "$@"</pre><p>Dit script roept <code class="command">dvips</code> in
	    filtermodus aan (het <code class="option">-f</code> argument) op de
	    standaard uitvoer, de af te drukken opdracht.  Vervolgens
	    start het <span class="trademark">PostScript</span>® afdrukfilter
	    <code class="command">lprps</code> (zie <a class="link" href="printing-advanced.html#printing-advanced-if-conversion" title="10.4.1.2. Platte tekst op PostScript®-printers afdrukken">Platte tekst op
	    <span class="trademark">PostScript</span>®-printers afdrukken</a>) met de argumenten
	    die <span class="application">LPD</span> aan het script
	    doorgeeft.  <code class="command">lprps</code> gebruikt deze
	    argumenten om de afgedrukte pagina's te
	    administreren.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp73463888"></a>10.4.1.4.4. Meer voorbeelden van conversiefilters</h5></div></div></div><p>Er is geen vaste procedure om conversiefilters te
	    installeren, er worden in deze sectie wat werkende
	    voorbeelden gegeven.  Gebruik deze als hulp bij het zelf
	    maken van filters.  Gebruik ze zonder aanpassingen indien
	    mogelijk.</p><p>Dit voorbeeldscript is een raster (eigenlijk een
	    GIF-bestand) conversiefilter voor een HP LaserJet III-Si
	    printer:</p><pre class="programlisting">#!/bin/sh
#
#  hpvf - Converteer GIF-bestanden naar HP/PCL, druk vervolgens af
#  Geïnstalleerd in /usr/local/libexec/hpvf

PATH=/usr/X11R6/bin:$PATH; export PATH
giftopnm | ppmtopgm | pgmtopbm | pbmtolj -resolution 300 \
    &amp;&amp; exit 0 \
    || exit 2</pre><p>Het script converteert achtereenvolgens het GIF-bestand
	    naar een PNM-bestand (portable anymap), een PGM-bestand
	    (portable graymap), een PBM-bestand (portable bitmap) en
	    tenslotte naar LaserJet/PCL formaat.</p><p>Een <code class="filename">/etc/printcap</code> bestand dat
	    bovenstaand filter gebruikt ziet er als volgt uit:</p><pre class="programlisting">#
#  /etc/printcap voor host orchid
#
teak|hp|laserjet|HP LaserJet 3Si:\
        :lp=<code class="filename">/dev/lpt0</code>:sh:sd=<code class="filename">/var/spool/lpd/teak</code>:mx#0:\
        :if=<code class="filename">/usr/local/libexec/hpif</code>:\
        :vf=<code class="filename">/usr/local/libexec/hpvf</code>:</pre><p>Het volgende script is een conversiefilter voor
	    troff-gegevens afkomstig van het groff-typesettingsysteem
	    voor de <span class="trademark">PostScript</span>®-printer <code class="literal">bamboo</code>:</p><pre class="programlisting">#!/bin/sh
#
#  pstf - Converteert groff's troffgegevens naar PS, drukt vervolgens af.
#  Geïnstalleerd in /usr/local/libexec/pstf
#
exec grops | /usr/local/libexec/lprps "$@"</pre><p>Bovenstaande script maakt eveneens gebruik van
	    <code class="command">lprps</code> om de communicatie met een printer
	    af te handelen.  Als een printer op een parallelle poort
	    is aangesloten, ziet het er als volgt uit:</p><pre class="programlisting">#!/bin/sh
#
#  pstf - Converteert groff's troff naar PS, drukt vervolgens af.
#  Geïnstalleerd in /usr/local/libexec/pstf
#
exec grops</pre><p>Dat is alles.  In <code class="filename">/etc/printcap</code>
	    moet het volgende toegevoegd worden om het filter
	    beschikbaar te maken:</p><pre class="programlisting">:tf=<code class="filename">/usr/local/libexec/pstf</code>:</pre><p>Hieronder een voorbeeld waarvan FORTRAN-programmeurs
	    waarschijnlijk tranen in hun ogen krijgen: een
	    FORTRAN-tekstfilter voor een willekeurige printer die in
	    staat is platte tekst af te drukken.  Het filter wordt
	    actief gemaakt voor <code class="literal">teak</code>:</p><pre class="programlisting">#!/bin/sh
#
# hprf - FORTRAN tekstfilter voor LaserJet 3si:
# Geïnstalleerd in /usr/local/libexec/hprf
#

printf "\033&amp;k2G" &amp;&amp; fpr &amp;&amp; printf "\033&amp;l0H" &amp;&amp;
 exit 0
exit 2</pre><p>De onderstaande regel wordt toegevoegd aan
	    <code class="filename">/etc/printcap</code> voor de printer
	    <code class="literal">teak</code> om het filter beschikbaar te
	    maken:</p><pre class="programlisting">:rf=<code class="filename">/usr/local/libexec/hprf</code>:</pre><p>Het laatste voorbeeld is wellicht complexer.  Er
	    wordt een DVI-filter toegevoegd voor de eerder genoemde
	    LaserJet printer <code class="literal">teak</code>.  Eerst het
	    makkelijke gedeelte: in <code class="filename">/etc/printcap</code>
	    wordt de locatie van het DVI-filter opgegeven:</p><pre class="programlisting">:df=<code class="filename">/usr/local/libexec/hpdf</code>:</pre><p>Nu het moeilijke gedeelte: het schrijven van het filter.
	    Daarvoor is een DVI-naar-LaserJet/PCL conversieprogramma
	    nodig.  De FreeBSD Portscollectie (zie <a class="link" href="ports.html" title="Hoofdstuk 5. Applicaties installeren: pakketten en ports">Portscollectie</a>) heeft er een:
	    <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print/dvi2xx/pkg-descr">print/dvi2xx</a>.  Door deze
	    port te installeren komt het programma dat nodig is
	    beschikbaar, <code class="command">dvilj2p</code>, waarmee DVI
	    geconverteerd kan worden naar LaserJet IIp-, LaserJet III-
	    en LaserJet 2000-formaten.</p><p>Het hulpprogramma <code class="command">dvilj2p</code> maakt het
	    filter <code class="command">hpdf</code> redelijk complex, omdat
	    <code class="command">dvilj2p</code> niet van de standaard invoer kan
	    lezen.  Het wil werken met een bestandsnaam.  Nog lastiger
	    is dat de bestandsnaam moet eindigen op
	    <code class="filename">.dvi</code>, zodat moeilijk gebruik
	    gemaakt kan worden van <code class="filename">/dev/fd/0</code> als standaard.
	    Dit probleem kan omzeild worden door een (symbolische)
	    koppeling aan te maken van een tijdelijk bestand (eindigend
	    op <code class="filename">.dvi</code>) naar <code class="filename">/dev/fd/0</code>.  Hiermee wordt
	    <code class="command">dvilj2p</code> gedwongen van de standaard
	    invoer te lezen.</p><p>De enige andere hobbel die genomen moet worden, is dat
	    <code class="filename">/tmp</code> niet gebruikt
	    kan worden als tijdelijke koppeling.  Symbolische
	    koppelingen zijn eigendom van de gebruiker en groep
	    <code class="systemitem">bin</code>.  Het filter wordt uitgevoerd door
	    de gebruiker <code class="systemitem">daemon</code>.  De map
	    <code class="filename">/tmp</code> heeft het
	    sticky-bit aan staan.  Het filter kan de koppeling wel
	    aanmaken, maar het is niet mogelijk de koppeling te
	    verwijderen als de opdracht is uitgevoerd, omdat de
	    koppeling eigendom is van een andere gebruiker.</p><p>In plaats hiervan maakt het filter een symbolische
	    koppeling aan in de huidige werkmap, de wachtrijmap (zoals
	    opgegeven in de optie <code class="literal">sd</code> in
	    <code class="filename">/etc/printcap</code>).  Dit is een perfecte
	    plaats voor filters om hun werk te doen, zeker gezien er
	    (soms) meer vrije schijfruimte is in de wachtrijmap dan
	    onder <code class="filename">/tmp</code>.</p><p>Dit is het uiteindelijke filter:</p><pre class="programlisting">#!/bin/sh
#
#  hpdf - Druk DVI-gegevens af op een HP/PCL printer
#  Geïnstalleerd in /usr/local/libexec/hpdf

PATH=/usr/local/bin:$PATH; export PATH

#
#  Definieer een functie om tijdelijke bestanden op te ruimen. Deze
#  staan in de huidige map; de wachtrijmap voor de printer.
#
cleanup() {
   rm -f hpdf$$.dvi
}

#
#  Definieer een functie om fatale fouten te verwerken: geef de
#  opgegeven boodschap weer en sluit af met 2. Afsluiten met 2 vertelt
#  LPD niet nog eens te proberen de afdrukopdracht af te drukken.
#
fatal() {
    echo "$@" 1&gt;&amp;2
    cleanup
    exit 2
}

#
#  Als de gebruiker de opdracht annuleert, stuurt LPD een SIGINT, dus
#  ondervang SIGINT (en enkele andere signalen) om onze rommel op te
#  ruimen.
#
trap cleanup 1 2 15

#
#  Voor de zekerheid bestaande tijdelijke bestanden opruimen
#
cleanup

#
#  Koppel het DVI-invoerbestand aan de standaard invoer (het af te
#  drukken bestand).
#
ln -s /dev/fd/0 hpdf$$.dvi || fatal "Cannot symlink /dev/fd/0"

#
#  Maak LF = CR+LF
#
printf "\033&amp;k2G" || fatal "Cannot initialize printer"

#
#  Converteer en druk af.  De retourneerwaarde van dvilj2p lijkt niet
#  betrouwbaar, dus negeren we het.
#
dvilj2p -M1 -q -e- dfhp$$.dvi

#
#  Opruimen en afsluiten
#
cleanup
exit 0</pre></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-autoconv"></a>10.4.1.4.5. Automatische conversie: een alternatief voor
	    conversiefilters</h5></div></div></div><p>Al deze conversiefilters bieden vele mogelijkheden voor
	    afdrukomgevingen, maar dwingen de gebruiker aan te geven
	    (op de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a> commandoregel) welk filter gebruikt
	    moet worden.  Als gebruikers niet zo vaardig zijn in het
	    gebruik van computers, wordt het al snel vervelend steeds
	    aan te moeten geven welk filter gebruikt moet worden.
	    Vervelender is echter wanneer een gebruiker een verkeerd
	    filter gebruikt voor een bepaald bestandsformaat.  Het
	    resultaat kan zijn dat een printer honderden pagina's
	    papier uitspuugt.</p><p>In plaats van het installeren van conversiefilters, is
	    het te proberen om het (standaard) tekstfilter het
	    bestandstype van het af te drukken bestand te laten
	    detecteren en dan automatisch het juiste conversiefilter
	    aan te laten roepen.  Programma's als
	    <code class="command">file</code> kunnen hierbij handig zijn.  Voor
	    <span class="emphasis"><em>sommige</em></span> bestandsformaten kan het
	    moeilijk zijn de verschillen te ontdekken en voor deze
	    bestanden kan alsnog een conversiefilter beschikbaar worden
	    gesteld.</p><a id="idp73659600" class="indexterm"></a><a id="idp73660112" class="indexterm"></a><p>De FreeBSD Portscollectie heeft een tekstfilter dat
	    automatisch converteert genaamd <code class="command">apsfilter</code>
	    (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print/apsfilter/pkg-descr">print/apsfilter</a>).  Het
	    detecteert platte tekst, <span class="trademark">PostScript</span>® en DVI-bestanden,
	    voert de juiste conversie uit en druk de bestanden af.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-of"></a>10.4.1.5. Uitvoerfilters</h4></div></div></div><p>Het wachtrijsysteem <span class="application">LPD</span>
	  ondersteunt een ander type filter waar nog geen aandacht aan
	  is besteed: een uitvoerfilter.  Een uitvoerfilter is bedoeld
	  om alleen platte tekst af te drukken, net als een
	  tekstfilter, maar met veel vereenvoudigingen.  Wanneer een
	  uitvoerfilter wordt gebruikt, maar geen tekstfilter,
	  dan:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>start <span class="application">LPD</span> een
	      uitvoerfilter voor de gehele opdracht, in plaats van voor
	      elk bestand in de opdracht;</p></li><li class="listitem"><p>biedt <span class="application">LPD</span> het uitvoerfilter
	      niet de voorziening van het identificeren van het begin
	      of eind van de bestanden in de afdrukopdracht;</p></li><li class="listitem"><p>stuurt <span class="application">LPD</span> de
	      gebruikersnaam en de hostnaam niet door aan het filter.
	      Het is dus niet bedoeld om een afdrukadministratie bij
	      te houden.  In feite zijn er maar twee argumenten:</p><div class="cmdsynopsis"><p><code class="command">filter-name</code>  -w<em class="replaceable"><code>width</code></em>   -l<em class="replaceable"><code>length</code></em> </p></div><p>Hierbij is <em class="replaceable"><code>width</code></em> afkomstig
	      van de optie <code class="literal">pw</code> en
	      <em class="replaceable"><code>length</code></em> afkomstig van de optie
	      <code class="literal">pl</code> voor de betreffende printer.</p></li></ul></div><p>De eenvoud van een uitvoerfilter is verleidelijk.  Als
	  elk bestand in een afdrukopdracht op een nieuwe pagina moet
	  beginnen, is een uitvoerfilter <span class="emphasis"><em>niet
	  geschikt</em></span>.  In  dat geval dient een tekstfilter
	  (ook wel invoerfilter) gebruikt te worden (zie <a class="link" href="printing-intro-setup.html#printing-textfilter" title="10.3.1.5.6. Tekstfilter installeren">Tekstfilter
	  installeren</a>.  Verder is een uitvoerfilter eigenlijk
	  <span class="emphasis"><em>veel ingewikkelder</em></span>, omdat de te
	  verwerken bytestroom gecontroleerd moet worden op speciale
	  tekens en steeds signalen naar zichzelf moet sturen in
	  opdracht van <span class="application">LPD</span>.</p><p>Een uitvoerfilter is <span class="emphasis"><em>noodzakelijk</em></span> als
	  voorbladen gewenst zijn en het nodig is om escape-reeksen of
	  andere initialisatietekens te sturen voor het afdrukken van
	  het voorblad.  Maar het is tevens
	  <span class="emphasis"><em>nutteloos</em></span> als het voorblad voor rekening
	  van de afkomstige gebruiker moet komen, aangezien
	  <span class="application">LPD</span> geen gebruiker of
	  hostinformatie naar het uitvoerfilter stuurt.</p><p>Op een enkele printer staat
	  <span class="application">LPD</span> het gebruik van zowel een
	  uitvoerfilter als van een tekst of andere filter toe.  In
	  deze gevallen start <span class="application">LPD</span> het
	  uitvoerfilter alleen voor het afdrukken van het voorblad (zie
	  <a class="link" href="printing-advanced.html#printing-advanced-header-pages" title="10.4.2. Voorbladen">Voorbladen</a>).
	  <span class="application">LPD</span> verwacht vervolgens van het
	  uitvoerfilter dat deze <span class="emphasis"><em>zichzelf stopt</em></span>
	  door twee bytes naar het filter te sturen: ASCII 031 gevolgd
	  door ASCII 001.  Als een uitvoerfilter deze twee bytes ziet
	  (031, 001), moet die stoppen door een
	  <code class="literal">SIGSTOP</code> naar zichzelf te sturen.  Als
	  <span class="application">LPD</span> klaar is met het uitvoeren van
	  alle andere filters, dan herstart deze het uitvoerfilter door
	  er een <code class="literal">SIGCONT</code> naar toe te sturen.</p><p>Als er wel een uitvoerfilter, maar
	  <span class="emphasis"><em>geen</em></span> tekstfilter is en
	  <span class="application">LPD</span> is niet bezig met het
	  verwerken van een opdracht met platte tekst, dan gebruikt
	  <span class="application">LPD</span> het uitvoerfilter voor het
	  afdrukken van de opdracht.  Zoals eerder vermeld, drukt het
	  uitvoerfilter elk bestand van de opdracht achter elkaar
	  af zonder pagina-einden of andere signalen voor
	  paginavoortgang.  Dit is waarschijnlijk
	  <span class="emphasis"><em>niet</em></span> gewenst.  In bijna alle gevallen is
	  een tekstfilter nodig.</p><p>Het programma <code class="command">lpf</code>, dat eerder
	  geïntoduceerd is als tekstfilter, kan ook worden
	  uitgevoerd als uitvoerfilter.  Als een ad-hoc uitvoerfilter
	  nodig is, maar het schrijven van de bytedetectie en
	  signaalverzending code niet wenselijk is, dan is
	  <code class="command">lpf</code> het proberen waard.
	  <code class="command">lpf</code> kan ook opgenomen worden in een
	  shellscript om initialisatiecode af te handelen die eventueel
	  nodig is voor een printer.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-lpf"></a>10.4.1.6. <code class="command">lpf</code>: een tekstfilter</h4></div></div></div><p>Het programma <code class="filename">/usr/libexec/lpr/lpf</code>
	  uit de gecompileerde FreeBSD-distributie is een tekstfilter
	  (invoerfilter) die uitvoer kan inspringen (een opdracht
	  gegeven met <code class="command">lpr -i</code>),
	  karakters onveranderd kan doorlaten (een opdracht gegeven met
	  <code class="command">lpr -l</code>), de printpositie
	  voor backspaces en tabs in de opdracht kan aanpassen en
	  afgedrukte pagina's kan administreren.  Het kan ook
	  functioneren als uitvoerfilter.</p><p>Het filter <code class="command">lpf</code> is geschikt voor vele
	  afdrukomgevingen.  Hoewel het zelf niet in staat is
	  initialisatiesequenties naar een printer te sturen, is het
	  vrij eenvoudig om een shellscript te schrijven dat de
	  initialisatie doet en vervolgens <code class="command">lpf</code>
	  aanroept.</p><a id="idp73712720" class="indexterm"></a><a id="idp73713232" class="indexterm"></a><p>Als <code class="command">lpf</code> afgedrukte pagina's moet
	  administreren, is het nodig om de juiste waarden in te vullen
	  voor de opties <code class="literal">pw</code> en
	  <code class="literal">pl</code> in het bestand
	  <code class="filename">/etc/printcap</code>.  Deze waarden worden
	  gebruikt om te bepalen hoeveel tekst er op een pagina past en
	  hoeveel pagina's er in een afdrukopdracht zijn afgedrukt.
	  Zie <a class="link" href="printing-advanced.html#printing-advanced-acct" title="10.4.5. Printergebruik administreren">Printergebruik
	    administreren</a> voor meer informatie.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-header-pages"></a>10.4.2. Voorbladen</h3></div></div></div><p>Als er <span class="emphasis"><em>veel</em></span> gebruikers zijn die
	allemaal verschillende printers gebruiken, dan is het te
	overwegen gebruik te maken van <span class="emphasis"><em>voorbladen</em></span>
	als noodzakelijk kwaad.</p><a id="idp73719120" class="indexterm"></a><a id="idp73720272" class="indexterm"></a><p>Voorbladen, in het Engels ook wel bekend als
	<span class="emphasis"><em>banner</em></span> of <span class="emphasis"><em>burst</em></span>
	pagina's, identificeren wie een bepaalde opdracht heeft
	afgedrukt.  Ze worden meestal bedrukt met grote, dikgedrukte
	letters, eventueel met een decoratieve rand, zodat ze in een
	stapel afdrukken opvallen tussen de afgedrukte documenten.  Ze
	maken het gebruikers mogelijk hun afdrukopdracht snel te
	vinden.  Het nadeel van het gebruik van voorbladen is dat er
	een extra blad moet worden afgedrukt voor elke opdracht,
	waarmee hun nut niet langer duurt dan een paar minuten.
	Uiteindelijk belanden ze in een papierbak of afvalberg.
	Voorbladen gaan vooraf aan elke opdracht, niet aan elk bestand
	in een opdracht, waardoor de verspilling beperkt blijft.</p><p>Het <span class="application">LPD</span>-systeem kan automatisch
	voorbladen afdrukken <span class="emphasis"><em>als</em></span> een printer
	direct platte tekst kan afdrukken.  In geval van een
	<span class="trademark">PostScript</span>®-printer, is het nodig een extern programma aan te
	roepen om een voorblad te genereren (zie <a class="link" href="printing-advanced.html#printing-advanced-header-pages-ps" title="10.4.2.4. Voorbladen op PostScript®-printers">Voorbladen op
	  <span class="trademark">PostScript</span>®-printers</a>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-header-pages-enabling"></a>10.4.2.1. Voorbladen afdrukken</h4></div></div></div><p>In de sectie <a class="link" href="printing-intro-setup.html#printing-simple" title="10.3.1. Eenvoudige printerinstallatie">Eenvoudige
	    printerinstallatie</a> is het afdrukken van
	  voorbladen uitgeschakeld door de optie <code class="literal">sh</code>
	  (<span class="quote">&#8220;<span class="quote">suppress header</span>&#8221;</span>) in het bestand
	  <code class="filename">/etc/printcap</code> op te geven.  Om wel
	  voorbladen af te drukken, hoeft alleen de optie
	  <code class="literal">sh</code> verwijderd te worden.</p><p>Dit klinkt wat al te makkelijk, of niet?</p><p>Dat klopt.  Het <span class="emphasis"><em>kan</em></span> nodig zijn een
	  uitvoerfilter op te geven die initialisatiestrings naar een
	  printer stuurt.  Hier is een voorbeeld uitvoerfilter voor
	  HP PCL-compatible printers:</p><pre class="programlisting">#!/bin/sh
#
#  hpof - Uitvoerfilter voor HP PCL-compatible printers
#  Geïnstalleerd in /usr/local/libexec/hpof

printf "\033&amp;k2G" || exit 2
exec /usr/libexec/lpr/lpf</pre><p>Geef de locatie van het uitvoerfilter op met de optie
	  <code class="literal">of</code>.  Zie <a class="link" href="printing-advanced.html#printing-advanced-of" title="10.4.1.5. Uitvoerfilters">Uitvoerfilters</a> voor
	  meer informatie.</p><p>Hier is een voorbeeldbestand
	  <code class="filename">/etc/printcap</code> voor de printer
	  <code class="literal">teak</code> die eerder is geïntroduceerd;.
	  Het afdrukken van voorbladen is geactiveerd en bovenstaande
	  uitvoerfilter is toegevoegd:</p><pre class="programlisting">#
#  /etc/printcap voor host orchid
#
teak|hp|laserjet|HP LaserJet 3Si:\
        :lp=<code class="filename">/dev/lpt0</code>:sd=<code class="filename">/var/spool/lpd/teak</code>:mx#0:\
        :if=<code class="filename">/usr/local/libexec/hpif</code>:\
        :vf=<code class="filename">/usr/local/libexec/hpvf</code>:\
        :of=<code class="filename">/usr/local/libexec/hpof</code>:</pre><p>Als gebruikers nu een opdracht sturen naar
	  <code class="literal">teak</code>, wordt er bij elke opdracht een
	  voorblad afgedrukt.  Als gebruikers liever willen zoeken naar
	  hun afdrukken, dan kunnen ze de voorbladen onderdrukken door
	  de opdracht te geven met het commando
	  <code class="command">lpr -h</code>.  Zie <a class="link" href="printing-using.html#printing-lpr-options-misc" title="10.5.4.3. Voorbladopties">Voorbladopties</a>
	  voor meer opties voor <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="application">LPD</span> drukt een karakter voor
	    pagina-einde af na elk voorblad.  Als een printer een ander
	    teken of sequentie gebruikt voor het beëindigen van
	    een pagina, dan kan dit opgeven worden met de optie
	    <code class="literal">ff</code> in
	    <code class="filename">/etc/printcap</code>.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-header-pages-controlling"></a>10.4.2.2. Voorbladen beheren</h4></div></div></div><p>Door het afdrukken van voorbladen aan te zetten,
	  produceert <span class="application">LPD</span> een <span class="emphasis"><em>lang
	  voorblad</em></span> waarop in grote letters de gebruiker,
	  host en opdracht te lezen zijn.  Hier volgt een voorbeeld
	  (<code class="systemitem">kelly</code> heeft de opdracht
	  <span class="quote">&#8220;<span class="quote">outline</span>&#8221;</span> afgedrukt vanaf host
	  <code class="systemitem">rose</code>):</p><pre class="screen">      k                   ll       ll
      k                    l        l
      k                    l        l
      k   k     eeee       l        l     y    y
      k  k     e    e      l        l     y    y
      k k      eeeeee      l        l     y    y
      kk k     e           l        l     y    y
      k   k    e    e      l        l     y   yy
      k    k    eeee      lll      lll     yyy y
                                               y
                                          y    y
                                           yyyy


                                   ll
                          t         l        i
                          t         l
       oooo    u    u   ttttt       l       ii     n nnn     eeee
      o    o   u    u     t         l        i     nn   n   e    e
      o    o   u    u     t         l        i     n    n   eeeeee
      o    o   u    u     t         l        i     n    n   e
      o    o   u   uu     t  t      l        i     n    n   e    e
       oooo     uuu u      tt      lll      iii    n    n    eeee









      r rrr     oooo     ssss     eeee
      rr   r   o    o   s    s   e    e
      r        o    o    ss      eeeeee
      r        o    o      ss    e
      r        o    o   s    s   e    e
      r         oooo     ssss     eeee







                                              Job:  outline
                                              Date: Sun Sep 17 11:04:58 1995</pre><p><span class="application">LPD</span> geeft een paginabegin na
	  deze tekst, zodat de opdracht op een nieuwe pagina begint
	  (tenzij de optie <code class="literal">sf</code> (<span class="emphasis"><em>suppress
	  form feeds</em></span>, <span class="quote">&#8220;<span class="quote">onderdruk paginabegin</span>&#8221;</span>)
	  is toegevoegd bij de desbetreffende printer in
	  <code class="filename">/etc/printcap</code>).</p><p>Als dit wenselijk is, kan <span class="application">LPD</span>
	  ook een <span class="emphasis"><em>korte tekst</em></span> op het voorblad
	  afdrukken; geef hiervoor de optie <code class="literal">sb</code>
	  (<span class="emphasis"><em>short banner</em></span>, <span class="quote">&#8220;<span class="quote">kort
	  voorblad</span>&#8221;</span>) op in het bestand
	  <code class="filename">/etc/printcap</code>.  Het voorblad
	  ziet er dan als volgt uit:</p><pre class="screen">rose:kelly  Job: outline  Date: Sun Sep 17 11:07:51 1995</pre><p>Standaard drukt <span class="application">LPD</span> het
	  voorblad als eerste af en vervolgens de opdracht.  Om dat om
	  te keren, moet de optie <code class="literal">hl</code>
	  (<span class="emphasis"><em>header last</em></span>, <span class="quote">&#8220;<span class="quote">voorblad
	  laatst</span>&#8221;</span>) in <code class="filename">/etc/printcap</code> worden
	  opgeven.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-header-pages-accounting"></a>10.4.2.3. Voorbladen administreren</h4></div></div></div><p>Het gebruik van <span class="application">LPD</span>'s
	  ingebouwde voorbladen dwingt een bepaald paradigma af wat
	  betreft het administreren van printergebruik: voorbladen
	  moeten <span class="emphasis"><em>gratis</em></span> zijn.</p><p>Waarom?</p><p>Omdat het uitvoerfilter het enige externe programma is
	  dat controle heeft als het voorblad afgedrukt wordt dat het
	  gebruik zou kunnen administreren.  Het heeft echter geen
	  beschikking over informatie over <span class="emphasis"><em>gebruiker of
	  host</em></span> of een administratiebestand.  Het heeft dus
	  geen idee wie voor het gebruik moet worden belast.  Het
	  volstaat ook niet om gewoon <span class="quote">&#8220;<span class="quote">het aantal pagina's met
	  één op te hogen</span>&#8221;</span> door het tekstfilter of
	  een van de conversiefilters (dat wel beschikt over
	  gebruiker- en hostinformatie) te veranderen, omdat gebruikers
	  het afdrukken van een voorblad kunnen onderdrukken met
	  <code class="command">lpr -h</code>.  Ze worden dan
	  aangeslagen voor voorbladen die niet zijn afgedrukt.
	  Milieubewuste gebruikers gebruiken vast
	  <code class="command">lpr -h</code>, maar dit kan niet
	  worden afgedwongen.</p><p>Het is <span class="emphasis"><em>ook niet voldoende</em></span> om elk
	  filter zijn eigen voorblad te laten genereren (om zo het
	  gebruik te kunnen administreren).  Als gebruikers het
	  afdrukken van voorbladen willen onderdrukken met
	  <code class="command">lpr -h</code>, krijgen ze toch
	  een voorblad en worden er ook voor belast, aangezien
	  <span class="application">LPD</span> geen kennis over de optie
	  <code class="option">-h</code> doorgeeft aan de filters.</p><p>Wat zijn dan de mogelijkheden?</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Accepteer het paradigma van
	      <span class="application">LPD</span> en maak voorbladen
	      gratis;</p></li><li class="listitem"><p>Installeer een alternatief voor
	      <span class="application">LPD</span>, zoals
	      <span class="application">LPRng</span>.  In <a class="link" href="printing-lpd-alternatives.html" title="10.6. Alternatieven voor het standaard wachtrijsysteem">Alternatieven voor
	      het standaard wachtrijsysteem</a> staat meer over
	      andere afdruksoftware die in plaats van
	      <span class="application">LPD</span> geïnstalleerd kan
	      worden;</p></li><li class="listitem"><p>Schrijf een <span class="emphasis"><em>slim</em></span>
	      uitvoerfilter.  Gewoonlijk is een uitvoerfilter bedoeld
	      om niet meer te doen dan het initialiseren van een
	      printer of wat eenvoudige karakterconversie.  Het is
	      geschikt voor voorbladen en opdrachten met platte tekst
	      (als er een tekstfilter is).  Maar als er een tekstfilter
	      is voor opdrachten met platte tekst, dan start
	      <span class="application">LPD</span> het uitvoerfilter alleen
	      voor voorbladen.  Het uitvoerfilter kan dan het
	      voorblad dat <span class="application">LPD</span> genereert
	      analyseren om te bepalen welke gebruiker en host belast
	      moeten worden voor het afdrukken van het voorblad.  Het
	      enige probleem is dat het uitvoerfilter nog steeds niet
	      weet in welk bestand het gebruik moet worden bijgehouden
	      (de naam van het bestand opgegeven in de
	      <code class="literal">af</code> wordt niet meegegeven), maar als
	      een bekend bestand gebruikt wordt, kan dit in het
	      uitvoerfilter worden opgeven.  Om het parsen af te
	      handelen kan gebruik gemaakt worden van de optie
	      <code class="literal">sh</code> (<span class="emphasis"><em>short header</em></span>,
	      <span class="quote">&#8220;<span class="quote">kort voorblad</span>&#8221;</span>) in
	      <code class="filename">/etc/printcap</code>.  Dit kan echter wat
	      omslachtig zijn en gebruikers waarderen zeker de meer
	      gulle systeembeheerder die voorbladen gratis
	      maakt.</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-header-pages-ps"></a>10.4.2.4. Voorbladen op <span class="trademark">PostScript</span>®-printers</h4></div></div></div><p>Zoals hierboven beschreven, kan
	  <span class="application">LPD</span> een voorblad in platte tekst
	  genereren, dat geschikt is voor de meeste printers.
	  Natuurlijk kan <span class="trademark">PostScript</span>® platte tekst niet direct
	  afdrukken, zodat de voorbladfunctie van
	  <span class="application">LPD</span> nutteloos is.</p><p>Een voor de hand liggende manier om voorbladen te
	  krijgen, is elk conversiefilter en tekstfilter zijn eigen
	  voorblad te laten genereren.  De filters moeten gebruik maken
	  van de argumenten gebruiker en host om een geschikt voorblad
	  te genereren.  Het nadeel van deze methode is dat gebruikers
	  altijd een voorblad krijgen, ook wanneer zij een opdracht
	  geven met <code class="command">lpr -h</code>.</p><p>Deze methode wordt nader beschreven.  Het volgende script
	  heeft drie argumenten (gebruikersnaam, hostnaam en de naam van
	  de opdracht) en maakt een eenvoudig <span class="trademark">PostScript</span>®-voorblad:</p><pre class="programlisting">#!/bin/sh
#
#  make-ps-header - genereer een PostScript-voorblad op stdout
#  Geïnstalleerd in /usr/local/libexec/make-ps-header
#

#
#  Dit zijn PostScript-eenheden (72 in een inch). Pas dit aan voor A4
#  of het gebruikte formaat:
#
page_width=612
page_height=792
border=72

#
#  Controleer argumenten
#
if [ $# -ne 3 ]; then
    echo "Usage: `basename $0` &lt;user&gt; &lt;host&gt; &lt;job&gt;" 1&gt;&amp;2
    exit 1
fi

#
#  Bewaar deze, voornamelijk voor de leesbaarheid in de <span class="trademark">PostScript</span>®-code.
#
user=$1
host=$2
job=$3
date=`date`

#
#  Stuur de <span class="trademark">PostScript</span>®-code naar stdout.
#
exec cat &lt;&lt;EOF
%!PS

%
%  Vermijd conflicten met de opdracht van de gebruiker die volgt.
%
save

%
%  Maak een dikke, onaangename border in de marge van het papier.
%
$border $border moveto
$page_width $border 2 mul sub 0 rlineto
0 $page_height $border 2 mul sub rlineto
currentscreen 3 -1 roll pop 100 3 1 roll setscreen
$border 2 mul $page_width sub 0 rlineto closepath
0.8 setgray 10 setlinewidth stroke 0 setgray

%
%  Toon de gebruikersnaam duidelijk, groot en prominent
%
/Helvetica-Bold findfont 64 scalefont setfont
$page_width ($user) stringwidth pop sub 2 div $page_height 200 sub moveto
($user) show

%
%  Nu volgen de saaie bijzonderheden
%
/Helvetica findfont 14 scalefont setfont
/y 200 def
[ (Job:) (Host:) (Date:) ] {
200 y moveto show /y y 18 sub def }
forall

/Helvetica-Bold findfont 14 scalefont setfont
/y 200 def
[ ($job) ($host) ($date) ] {
        270 y moveto show /y y 18 sub def
} forall

%
% Dat is alles
%
restore
showpage
EOF</pre><p>Nu kan zowel het conversiefilter als het tekstfilter dit
	  script aanroepen om eerst een voorblad te genereren en
	  vervolgens de opdracht van de gebruiker af te drukken.  Hier
	  volgt het eerder gebruikte DVI-conversieprogramma, aangepast
	  om een voorblad te maken:</p><pre class="programlisting">#!/bin/sh
#
#  psdf - DVI naar PostScript printfilter
#  Geïnstalleerd in /usr/local/libexec/psdf
#
#  Aangeroepen door lpd, wanneer de gebruiker lpr -d uitvoert
#

orig_args="$@"

fail() {
    echo "$@" 1&gt;&amp;2
    exit 2
}

while getopts "x:y:n:h:" option; do
    case $option in
        x|y)  ;; # Ignore
        n)    login=$OPTARG ;;
        h)    host=$OPTARG ;;
        *)    echo "LPD started `basename $0` wrong." 1&gt;&amp;2
              exit 2
              ;;
    esac
done

[ "$login" ] || fail "No login name"
[ "$host" ] || fail "No host name"

( /usr/local/libexec/make-ps-header $login $host "DVI File"
  /usr/local/bin/dvips -f ) | eval /usr/local/libexec/lprps $orig_args</pre><p>Merk op hoe het filter eerst de argumentenlijst moet
	  nagaan om te bepalen wat de gebruikers- en hostnaam zijn.
	  Dit is gelijk voor de andere conversiefilters.  Het
	  tekstfilter heeft echter een andere verzameling argumenten
	  (zie <a class="link" href="printing-advanced.html#printing-advanced-filters" title="10.4.1.1. Hoe filters werken">Hoe filters
	    werken</a>).</p><p>Zoals eerder is beschreven, is het in bovenstaande opzet,
	  hoewel deze simpel is, niet mogelijk <span class="quote">&#8220;<span class="quote">voorbladen
	  te onderdrukken</span>&#8221;</span> (de optie <code class="option">-h</code> in
	  <code class="command">lpr</code>).  Als gebruikers een boom willen
	  sparen (of een paar centen bij betaalde voorbladen) dan is
	  dit dus niet mogelijk, aangezien elk filter een voorblad
	  afdrukt voor iedere opdracht.</p><p>Om gebruikers in staat te stellen per opdracht voorbladen
	  te onderdrukken, moet gebruik gemaakt worden van de truc
	  uit <a class="link" href="printing-advanced.html#printing-advanced-header-pages-accounting" title="10.4.2.3. Voorbladen administreren">Voorbladen
	  administreren</a>: schrijf een uitvoerfilter dat het door
	  LPD gegenereerde voorblad inleest en een <span class="trademark">PostScript</span>®-versie
	  genereert.  Als de gebruiker de opdracht geeft met
	  <code class="command">lpr -h</code>, dan genereert
	  <span class="application">LPD</span> geen voorblad en het
	  uitvoerfilter ook niet.  Anders leest het uitvoerfilter de
	  tekst van <span class="application">LPD</span> in en stuurt een
	  geschikt voorblad in <span class="trademark">PostScript</span>® naar de printer.</p><p>Voor een <span class="trademark">PostScript</span>®-printer op een seriële lijn
	  kan gebruik gemaakt worden van <code class="command">lprps</code>,
	  dat met een uitvoerfilter wordt geleverd en het bovenstaande
	  kan doen.  Voorbladen worden door <code class="command">psof</code>
	  niet geteld.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-network-printers"></a>10.4.3. Afdrukken via het netwerk</h3></div></div></div><a id="idp73813072" class="indexterm"></a><a id="idp73814224" class="indexterm"></a><p>FreeBSD ondersteunt afdrukken via het netwerk: het sturen van
	opdrachten naar printers op afstand.  Afdrukken via een netwerk
	betekent over het algemeen twee verschillende dingen:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Het benaderen van een printer aangesloten op een andere
	    computer.  Een printer met een conventionele
	    seriële of parallelle verbinding wordt op een bepaalde
	    computer geïnstalleerd.  Vervolgens wordt
	    <span class="application">LPD</span> zodanig ingesteld dat
	    afdrukken vanaf andere computers in het netwerk mogelijk
	    is.  In <a class="link" href="printing-advanced.html#printing-advanced-network-rm" title="10.4.3.1. Printers geïnstalleerd op andere hosts">Printers
	    geïnstalleerd op andere hosts</a> staat hoe dit
	    te doen.</p></li><li class="listitem"><p>Het benaderen van een printer die direct is aangesloten
	    op een netwerk.  Een printer heeft een netwerkinterface
	    naast (of in plaats van) een gewone seriële of
	    parallelle poort.  Zo een printer kan als volgt
	    werken:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Het begrijpt het <span class="application">LPD</span>
		protocol en kan zelfs opdrachten van andere hosts in
		de wachtrij plaatsen.  In dit geval werkt een printer
		als een gewone host die <span class="application">LPD</span>
		heeft draaien.  Volg de procedure in <a class="link" href="printing-advanced.html#printing-advanced-network-rm" title="10.4.3.1. Printers geïnstalleerd op andere hosts">Printers
		geïnstalleerd op andere hosts</a> om een
		dergelijke printer te installeren</p></li><li class="listitem"><p>Het kan zijn dat een printer een netwerkverbinding
		ondersteunt.  In dit geval kan een printer worden
		<span class="quote">&#8220;<span class="quote">aangesloten</span>&#8221;</span> op een bepaalde host op het
		netwerk door deze host verantwoordelijk te maken voor
		het plaatsen van opdrachten in een wachtrij en het
		versturen van opdrachten naar de printer.  In <a class="link" href="printing-advanced.html#printing-advanced-network-net-if" title="10.4.3.2. Printers met netwerkinterfaces">Printers
		met netwerkinterfaces</a> staan enkele suggesties
		om zulke printers te installeren.</p></li></ul></div></li></ul></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-network-rm"></a>10.4.3.1. Printers geïnstalleerd op andere hosts</h4></div></div></div><p>Het wachtrijsysteem <span class="application">LPD</span> heeft
	  een ingebouwde mogelijkheid om opdrachten naar andere hosts
	  te sturen die ook <span class="application">LPD</span> draaien (of
	  een systeem dat compatibel is met
	  <span class="application">LPD</span>).  Deze eigenschap maakt het
	  mogelijk om een printer op een host te installeren en deze
	  toegankelijk te maken voor andere hosts.  Het werkt ook met
	  printers die over een netwerkinterface beschikken en het
	  <span class="application">LPD</span>-protocol begrijpen.</p><p>Om dit soort afdrukken op afstand mogelijk te maken, moet
	  een printer eerst op een host geïnstalleerd worden, de
	  <span class="emphasis"><em>printerhost</em></span>, door de printerinstallatie
	  te volgen als beschreven in <a class="link" href="printing-intro-setup.html#printing-simple" title="10.3.1. Eenvoudige printerinstallatie">Eenvoudige
	  printerinstallatie</a>.  Stel desgewenst de printer in
	  voor geavanceerde taken volgens <a class="link" href="printing-advanced.html" title="10.4. Geavanceerde printerinstallatie">Geavanceerde
	    printerinstallatie</a>.  Test de printer en controleer
	  of deze werkt met eventueel speciaal ingestelde opties voor
	  <span class="application">LPD</span>.  De <span class="emphasis"><em>lokale
	  host</em></span> moet geautoriseerd zijn om de
	  <span class="application">LPD</span>-dienst op de
	  <span class="emphasis"><em>verre host</em></span> te gebruiken (zie <a class="link" href="printing-advanced.html#printing-advanced-restricting-remote" title="10.4.4.4. Opdrachten van hosts op afstand beperken">Opdrachten
	    van hosts op afstand beperken</a>).</p><a id="idp73833168" class="indexterm"></a><a id="idp73834320" class="indexterm"></a><p>Als een printer een netwerkinterface heeft die compatibel
	  is met <span class="application">LPD</span>, dan is de
	  <span class="emphasis"><em>printerhost</em></span> in onderstaande beschrijving
	  de printer zelf en de <span class="emphasis"><em>printernaam</em></span> is de
	  naam die voor de printer is ingesteld.  Meer informatie staat
	  in de documentatie bij de printer en/of de
	  printernetwerkinterface.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Bij een HP LaserJet voert de printernaam
	    <code class="literal">text</code> automatisch de CRLF-conversie uit.
	    Het is dan niet nodig het script <code class="filename">hpif</code>
	    te gebruiken.</p></div><p>Op hosts die toegang moeten krijgen tot de printer, moet
	  in <code class="filename">/etc/printcap</code> een regel worden
	  toegevoegd met het volgende:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Geef de regel een willekeurige naam.  Om het
	      eenvoudig te houden kunnen wellicht het beste dezelfde
	      namen en aliassen worden gebruikt als op de
	      printerhost;</p></li><li class="listitem"><p>Laat de optie <code class="literal">lp</code> expliciet leeg
	      (<code class="literal">:lp=:</code>);</p></li><li class="listitem"><p>Maak een wachtrijmap aan en geef de locatie op met de
	      optie <code class="literal">sd</code>.
	      <span class="application">LPD</span> slaat hier
	      afdrukopdrachten op alvorens ze naar de printerhost
	      te sturen;</p></li><li class="listitem"><p>Geef de naam van de printerhost op met de optie
	      <code class="literal">rm</code>;</p></li><li class="listitem"><p>Geef de naam van de printer op de
	      <span class="emphasis"><em>printerhost</em></span> op met de optie
	      <code class="literal">rp</code>.</p></li></ol></div><p>Dit is het.  Conversiefilters, paginadimensies,
	  enzovoort, hoeven niet in <code class="filename">/etc/printcap</code>
	  opgegeven te worden.</p><p>Hier volgt een voorbeeld.  De host <code class="systemitem">rose</code>
	  heeft twee printers: <code class="literal">bamboo</code> en
	  <code class="literal">rattan</code>.  Gebruikers op de host
	  <code class="systemitem">orchid</code> krijgen toegang tot deze printers.
	  Hier volgt <code class="filename">/etc/printcap</code> voor
	  <code class="systemitem">orchid</code> (uit <a class="link" href="printing-advanced.html#printing-advanced-header-pages-enabling" title="10.4.2.1. Voorbladen afdrukken">Voorbladen
	  afdrukken</a>).  Er stond in het bestand al een regel voor
	  de printer <code class="literal">teak</code>.  Voor de twee printers op
	  de host <code class="systemitem">rose</code> zijn twee regels
	  toegevoegd:</p><pre class="programlisting">#
#  /etc/printcap voor host orchid - printers (op afstand) op rose toegevoegd
#

#
#  teak is lokaal; het is direct aangesloten op orchid:
#
teak|hp|laserjet|HP LaserJet 3Si:\
        :lp=<code class="filename">/dev/lpt0</code>:sd=<code class="filename">/var/spool/lpd/teak</code>:mx#0:\
        :if=<code class="filename">/usr/local/libexec/ifhp</code>:\
        :vf=<code class="filename">/usr/local/libexec/vfhp</code>:\
        :of=<code class="filename">/usr/local/libexec/ofhp</code>:

#
#  rattan is aangesloten op rose; stuur opdrachten voor rattan naar rose:
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :lp=:rm=rose:rp=rattan:sd=<code class="filename">/var/spool/lpd/rattan</code>:

#
#  bamboo is ook aangesloten op rose:
#
bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :lp=:rm=rose:rp=bamboo:sd=<code class="filename">/var/spool/lpd/bamboo</code>:</pre><p>Op <code class="systemitem">orchid</code> moeten wachtrijmappen worden
	  aangemaakt:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /var/spool/lpd/rattan /var/spool/lpd/bamboo</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 770 /var/spool/lpd/rattan /var/spool/lpd/bamboo</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown daemon:daemon /var/spool/lpd/rattan /var/spool/lpd/bamboo</code></strong></pre><p>Nu kunnen gebruikers op <code class="systemitem">orchid</code> afdrukken
	  op <code class="literal">rattan</code> en <code class="literal">bamboo</code>.
	  Een gebruiker op <code class="systemitem">orchid</code> geeft bijvoorbeeld
	  de volgende invoer:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpr -P bamboo -d sushi-review.dvi</code></strong></pre><p>Dan kopieert <span class="application">LPD</span> op
	  <code class="systemitem">orchid</code> de opdracht naar de wachtrijmap
	  <code class="filename">/var/spool/lpd/bamboo</code>
	  en ziet dat het een DVI-opdracht is.  Zodra de host
	  <code class="systemitem">rose</code> ruimte heeft in zijn wachtrijmap
	  <code class="literal">bamboo</code>, sturen de twee
	  <span class="application">LPD</span>'s het bestand naar
	  <code class="systemitem">rose</code>.  Het bestand wacht in de wachtrij van
	  <code class="systemitem">rose</code> totdat het succesvol is afgedrukt.  Het
	  wordt geconverteerd naar <span class="trademark">PostScript</span>® (aangezien
	  <code class="literal">bamboo</code> een <span class="trademark">PostScript</span>®-printer is) op
	  <code class="systemitem">rose</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-network-net-if"></a>10.4.3.2. Printers met netwerkinterfaces</h4></div></div></div><p>Netwerkkaarten voor printers zijn er in twee versies:
	  een versie die een wachtrij nabootst (de duurdere versies),
	  of versies die alleen de mogelijkheid geven om er informatie
	  naar te sturen alsof het een seriële of parallelle poort
	  is (de goedkopere versies).  In <a class="link" href="printing-advanced.html#printing-advanced-network-rm" title="10.4.3.1. Printers geïnstalleerd op andere hosts">Printers
	    geïnstalleerd op andere hosts</a> wordt het voor
	  de duurdere beschreven.</p><p>Het formaat van <code class="filename">/etc/printcap</code> maakt
	  het mogelijk om op te geven welke seriële, of parallelle
	  poort gebruikt moet worden en (in geval van een seriële
	  poort) de baud-snelheid, of er communicatie moet worden
	  toegepast, vertragingen voor tabs, conversies voor nieuwe
	  regelkarakters en meer.  Er is geen mogelijkheid om een
	  verbinding met een printer op te geven die op een TCP/IP of
	  andere netwerkpoort luistert.</p><p>Om informatie naar een netwerkprinter te sturen, is het
	  nodig een programma te ontwikkelen dat door tekst- en
	  conversiefilters kan worden aangeroepen.  Hier volgt een
	  voorbeeld: het script <code class="command">netprint</code> stuurt alle
	  informatie van de standaard invoer naar een netwerkprinter.
	  Als eerste argument wordt de hostnaam van de printer
	  opgegeven en als tweede argument het poortnummer waarmee de
	  verbinding moet worden opgezet.  Er wordt alleen
	  eenrichtingcommunicatie ondersteund (FreeBSD naar printer).
	  Veel netwerkprinters ondersteunen tweewegcommunicatie.  Het
	  kan wenselijk zijn hiervan gebruik te maken (om printerstatus
	  op te vragen, statistieken bij te houden, enzovoort).</p><pre class="programlisting">#!/usr/bin/perl
#
#  netprint - Tekstfilter voor printer aangesloten op het netwerk
#  Geïnstalleerd in /usr/local/libexec/netprint
#
$#ARGV eq 1 || die "Usage: $0 &lt;printer-hostname&gt; &lt;port-number&gt;";

$printer_host = $ARGV[0];
$printer_port = $ARGV[1];

require 'sys/socket.ph';

($ignore, $ignore, $protocol) = getprotobyname('tcp');
($ignore, $ignore, $ignore, $ignore, $address)
    = gethostbyname($printer_host);

$sockaddr = pack('S n a4 x8', &amp;AF_INET, $printer_port, $address);

socket(PRINTER, &amp;PF_INET, &amp;SOCK_STREAM, $protocol)
    || die "Can't create TCP/IP stream socket: $!";
connect(PRINTER, $sockaddr) || die "Can't contact $printer_host: $!";
while (&lt;STDIN&gt;) { print PRINTER; }
exit 0;</pre><p>Dit script kan vervolgens in verschillende filters
	  gebruikt worden.  Stel dat een Diablo 750-N matrixprinter op
	  het netwerk is aangesloten.  Op poort 5100 accepteert de
	  printer informatie om af te drukken.  De hostnaam van de
	  printer is <code class="systemitem">scrivener</code>.  Hier volgt het
	  tekstfilter voor de printer:</p><pre class="programlisting">#!/bin/sh
#
#  diablo-if-net - Tekstfilter voor Diablo printer 'scrivener' luistert
#  op poort 5100. Geïnstalleerd in /usr/local/libexec/diablo-if-net
#
exec /usr/libexec/lpr/lpf "$@" | /usr/local/libexec/netprint scrivener 5100</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-restricting"></a>10.4.4. Printergebruik beperken</h3></div></div></div><a id="idp73883472" class="indexterm"></a><p>Nu volgt informatie over het beperken van printergebruik.
	Het <span class="application">LPD</span>-systeem maakt het mogelijk
	te bepalen wie er toegang heeft tot een printer, zowel lokaal
	als op afstand, of meerdere kopieën afgedrukt mogen
	worden, hoe lang opdrachten mogen zijn en hoe lang wachtrijen
	mogen worden.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-restricting-copies"></a>10.4.4.1. Meerdere kopieën beperken</h4></div></div></div><p>Het <span class="application">LPD</span> systeem maakt het heel
	  makkelijk voor gebruikers om meerdere afdrukken van een
	  bestand te maken.  Gebruikers kunnen opdrachten afdrukken met
	  bijvoorbeeld <code class="command">lpr -#5</code> en
	  krijgen dan vijf kopieën van elk bestand in de opdracht.
	  De systeembeheerder kan beslissen of dit wenselijk is.</p><p>Wanneer meerdere kopieën onwenselijk zijn, kan de
	  optie <code class="option">-#</code> van <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a> worden
	  uitgeschakeld door de optie <code class="literal">sc</code> in
	  <code class="filename">/etc/printcap</code> op te nemen.  Als
	  gebruikers opdrachten versturen met de optie
	  <code class="option">-#</code>, zien ze het volgende:</p><pre class="screen">lpr: multiple copies are not allowed</pre><p>Als het mogelijk is van andere hosts af te drukken (zie
	  <a class="link" href="printing-advanced.html#printing-advanced-network-rm" title="10.4.3.1. Printers geïnstalleerd op andere hosts">Printers
	  geïnstalleerd op andere hosts</a>), moet de optie
	  <code class="literal">sc</code> ook in
	  <code class="filename">/etc/printcap</code> van de andere hosts
	  aanwezig zijn.  Anders kunnen gebruikers nog steeds
	  multi-kopie opdrachten van andere hosts sturen.</p><p>Hier volgt een voorbeeld.  Hieronder staat
	  <code class="filename">/etc/printcap</code> voor de host
	  <code class="systemitem">rose</code>.  De printer <code class="literal">rattan</code>
	  is redelijk krachtig, dus meerdere kopieën zijn
	  toegestaan.  De laserprinter <code class="literal">bamboo</code> is wat
	  gevoeliger, dus meerdere kopieë zijn uitgeschakeld door
	  de optie <code class="literal">sc</code> toe te voegen:</p><pre class="programlisting">#
#  /etc/printcap voor host rose - beperk meerdere kopieën op bamboo
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=<code class="filename">/var/spool/lpd/rattan</code>:\
        :lp=<code class="filename">/dev/lpt0</code>:\
        :if=<code class="filename">/usr/local/libexec/if-simple</code>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<code class="filename">/var/spool/lpd/bamboo</code>:sc:\
        :lp=<code class="filename">/dev/ttyu5</code>:ms#-parenb cs8 clocal crtscts:rw:\
        :if=<code class="filename">/usr/local/libexec/psif</code>:\
        :df=<code class="filename">/usr/local/libexec/psdf</code>:</pre><p>Nu moet ook de optie <code class="literal">sc</code> worden
	  toegevoegd in <code class="filename">/etc/printcap</code> van host
	  <code class="systemitem">orchid</code> (tegelijk worden meerdere
	  kopieën voor de printer <code class="literal">teak</code>
	  uitgeschakeld):</p><pre class="programlisting">#
#  /etc/printcap voor host orchid - geen meerdere kopieën voor lokale
#  printer teak of printer op afstand bamboo
teak|hp|laserjet|HP LaserJet 3Si:\
        :lp=<code class="filename">/dev/lpt0</code>:sd=<code class="filename">/var/spool/lpd/teak</code>:mx#0:sc:\
        :if=<code class="filename">/usr/local/libexec/ifhp</code>:\
        :vf=<code class="filename">/usr/local/libexec/vfhp</code>:\
        :of=<code class="filename">/usr/local/libexec/ofhp</code>:

rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :lp=:rm=rose:rp=rattan:sd=<code class="filename">/var/spool/lpd/rattan</code>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :lp=:rm=rose:rp=bamboo:sd=<code class="filename">/var/spool/lpd/bamboo</code>:sc:</pre><p>Door de optie <code class="literal">sc</code> te gebruiken, wordt
	  het gebruik van <code class="command">lpr -#i</code>
	  voorkomen, maar dat weerhoudt gebruikers er nog steeds niet
	  van om <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a> meerdere keren te aanroepen of meerdere
	  keren hetzelfde bestand te versturen in een opdracht:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpr voorverkoop.teken voorverkoop.teken voorverkoop.teken voorverkoop.teken voorverkoop.teken</code></strong></pre><p>Er zijn vele manieren om dit misbruik te voorkomen (onder
	  andere door het te negeren), welke vrij zijn om te
	  verkennen.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-restricting-access"></a>10.4.4.2. Printertoegang beperken</h4></div></div></div><p>Door gebruik te maken van het <span class="trademark">UNIX</span>® groepmechanisme en
	  de optie <code class="literal">rg</code> in
	  <code class="filename">/etc/printcap</code> kan geregeld worden wie er
	  op welke printer kan afdrukken.  De gebruikers die toegang
	  hebben tot een printer moeten in een groep worden geplaatst
	  en deze groep moet in de optie <code class="literal">rg</code> worden
	  genoemd.</p><p>Als gebruikers buiten de groep (inclusief
	  <code class="systemitem">root</code>) naar de beheerde printer proberen
	  te printen, worden ze begroet met het volgende bericht:</p><pre class="screen">lpr: Not a member of the restricted group</pre><p>Net als met de optie <code class="literal">sc</code>
	  (<span class="emphasis"><em>suppress multiple copies</em></span>: onderdruk
	  meerdere kopieën) moet <code class="literal">rg</code>, indien
	  wenselijk, ook op andere hosts worden opgegeven die ook
	  toegang hebben tot printers (zie <a class="link" href="printing-advanced.html#printing-advanced-network-rm" title="10.4.3.1. Printers geïnstalleerd op andere hosts">Printers
	    geïnstalleerd op andere hosts</a>).</p><p>In het volgende voorbeeld heeft iedereen toegang tot de
	  printer <code class="literal">rattan</code>, maar alleen gebruikers in
	  de groep <code class="systemitem">artists</code> kunnen gebruik maken
	  van <code class="literal">bamboo</code>.  Hier volgt het bekende
	  <code class="filename">/etc/printcap</code> voor de host
	  <code class="systemitem">rose</code>:</p><pre class="programlisting">#
#  /etc/printcap voor host rose - beperkte toegang voor groep bamboo
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=<code class="filename">/var/spool/lpd/rattan</code>:\
        :lp=<code class="filename">/dev/lpt0</code>:\
        :if=<code class="filename">/usr/local/libexec/if-simple</code>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<code class="filename">/var/spool/lpd/bamboo</code>:sc:rg=artists:\
        :lp=<code class="filename">/dev/ttyu5</code>:ms#-parenb cs8 clocal crtscts:rw:\
        :if=<code class="filename">/usr/local/libexec/psif</code>:\
        :df=<code class="filename">/usr/local/libexec/psdf</code>:</pre><p>De andere voorbeeldbestanden
	  <code class="filename">/etc/printcap</code> (voor de host
	  <code class="systemitem">orchid</code>) worden niet aangepast.  Natuurlijk
	  kan iedereen op <code class="systemitem">orchid</code> afdrukken op
	  <code class="systemitem">bamboo</code>.  Het kan zijn dat er sowieso alleen
	  bepaalde gebruikers op <code class="systemitem">orchid</code> zijn
	  toegestaan en dat deze gebruikers toegang mogen hebben tot de
	  printer.  Of wellicht niet.</p><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Er kan per printer slechts één groep
	    worden opgegeven.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-restricting-sizes"></a>10.4.4.3. Grootte van afdrukopdrachten bepalen</h4></div></div></div><a id="idp73934800" class="indexterm"></a><p>Als veel gebruikers toegang hebben tot printers kan het
	  nodig zijn een limiet op te geven voor de grootte van de
	  bestanden die gebruikers naar een printer kunnen sturen.  Er
	  is immers slechts beperkte ruimte op het bestandssysteem en
	  er moet ook voldoende ruimte zijn voor opdrachten van andere
	  gebruikers.</p><a id="idp73935696" class="indexterm"></a><p><span class="application">LPD</span> heeft de mogelijkheid om
	  met de optie <code class="literal">mx</code> een limiet op te geven
	  voor het maximum aantal bytes van een bestand in een
	  afdrukopdracht.  De eenheden worden opgegeven in
	  <code class="literal">BUFSIZ</code> blokken, die 1024 bytes groot zijn.
	  Een nul voor deze optie betekent geen limiet aan de
	  bestandsgrootte.  Als de optie wordt weggelaten, wordt een
	  standaardlimiet van 1000 blokken gebruikt.</p><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">De limiet heeft betrekking op de
	    <span class="emphasis"><em>bestanden</em></span> in een opdracht,
	    <span class="emphasis"><em>niet</em></span> op de totale grootte van een
	    opdracht.</p></div><p><span class="application">LPD</span> weigert een bestand dat
	  groter is dan de opgegeven limiet niet.  In plaats daarvan
	  plaatst het zo veel mogelijk van het bestand op de wachtrij,
	  om dit vervolgens af te drukken.  De rest wordt genegeerd.
	  Of dit gedrag wenselijk is, is onderwerp van debat.</p><p>Nu worden limieten voor de voorbeeldprinters
	  <code class="literal">rattan</code> en <code class="literal">bamboo</code>
	  opgegeven.  Aangezien de <span class="trademark">PostScript</span>®-bestanden van die
	  <code class="systemitem">artists</code> nogal groot kunnen worden,
	  krijgen ze een limiet van vijf megabyte opgelegd.  Er wordt
	  geen limiet opgelegd voor de platte tekst printer:</p><pre class="programlisting">#
#  /etc/printcap voor host rose
#

#
#  Geen limiet op opdrachtgrootte:
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:mx#0:sd=<code class="filename">/var/spool/lpd/rattan</code>:\
        :lp=<code class="filename">/dev/lpt0</code>:\
        :if=<code class="filename">/usr/local/libexec/if-simple</code>:

#
#  Limiet van vijf megabyte:
#
bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<code class="filename">/var/spool/lpd/bamboo</code>:sc:rg=artists:mx#5000:\
        :lp=<code class="filename">/dev/ttyu5</code>:ms#-parenb cs8 clocal crtscts:rw:\
        :if=<code class="filename">/usr/local/libexec/psif</code>:\
        :df=<code class="filename">/usr/local/libexec/psdf</code>:</pre><p>Ook hier zijn de limieten alleen van toepassing op lokale
	  gebruikers.  Als toegang tot deze printers van andere hosts
	  mogelijk is, worden deze gebruikers niet beperkt.  Het is
	  daarom nodig de optie <code class="literal">mx</code> ook in de
	  <code class="filename">/etc/printcap</code> van de betreffende hosts
	  op te geven.  In <a class="link" href="printing-advanced.html#printing-advanced-network-rm" title="10.4.3.1. Printers geïnstalleerd op andere hosts">Printers
	  geïnstalleerd op andere hosts</a> staat meer
	  informatie over afdrukken op andere hosts.</p><p>Er is een andere gespecialiseerde manier om
	  opdrachtgrootte voor printers op afstand te beperken  (zie
	  <a class="link" href="printing-advanced.html#printing-advanced-restricting-remote" title="10.4.4.4. Opdrachten van hosts op afstand beperken">Opdrachten
	    van hosts op afstand beperken</a>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-restricting-remote"></a>10.4.4.4. Opdrachten van hosts op afstand beperken</h4></div></div></div><p>Het wachtrijsysteem <span class="application">LPD</span>
	  beschikt over verschillende methoden om afdrukopdrachten van
	  hosts op afstand te beperken:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Hostbeperkingen</span></dt><dd><p>Met de bestanden
		<code class="filename">/etc/hosts.equiv</code> en
		<code class="filename">/etc/hosts.lpd</code> kan worden
		ingesteld van welke hosts op afstand een lokale
		<span class="application">LPD</span>-opdracht wordt
		geaccepteerd.  <span class="application">LPD</span>
		controleert of een inkomend verzoek afkomstig is van
		een host die wordt genoemd in een van deze bestanden.
		Zo niet, dan weigert <span class="application">LPD</span> het
		verzoek.</p><p>Het formaat van deze bestanden is eenvoudig:
		één host per regel.
		<code class="filename">/etc/hosts.equiv</code> wordt ook
		gebruikt door het protocol <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ruserok&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">ruserok</span>(3)</span></a> en heeft
		invloed op programma's als <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rsh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rsh</span>(1)</span></a> en <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rcp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rcp</span>(1)</span></a>.
		Voorzichtigheid is dus geboden.</p><p>Als voorbeeld volgt hier
		<code class="filename">/etc/hosts.lpd</code> voor de host
		<code class="systemitem">rose</code>:</p><pre class="programlisting">orchid
violet
madrigal.fishbaum.de</pre><p>Dit betekent dat <code class="systemitem">rose</code> verzoeken
		accepteert van de hosts <code class="systemitem">orchid</code>,
		<code class="systemitem">violet</code> en
		<code class="systemitem">madrigal.fishbaum.de</code>.
		Voor iedere andere host die verbinding probeert te
		maken met <span class="application">LPD</span> op
		<code class="systemitem">rose</code>, wordt de opdracht
		geweigerd.</p></dd><dt><span class="term">Omvangbeperkingen</span></dt><dd><p>De hoeveelheid vrije ruimte die over moet blijven
		op een bestandssysteem waar een wachtrij zich bevindt
		kan ook worden ingesteld.  Hiervoor moet een bestand
		met de naam <code class="filename">minfree</code> in de
		wachtrijmap worden aangemaakt.  In dit bestand kan
		een getal worden gezet dat het aantal schijfblokken
		(512 bytes) aan vrije ruimte aangeeft dat beschikbaar
		moet blijven wil een opdracht worden
		geaccepteerd.</p><p>Hiermee kan worden gegarandeerd dat gebruikers op
		afstand een bestandssysteem niet vol kunnen schrijven.
		Ook kan hierdoor een soort voorrang worden gegeven aan
		lokale gebruikers: zij kunnen nog opdrachten plaatsen
		als de vrije schijfruimte al lang beneden de opgegeven
		limiet uit <code class="filename">minfree</code> is
		gekomen.</p><p>Als voorbeeld wordt een bestand
		<code class="filename">minfree</code> voor de printer
		<code class="literal">bamboo</code> toegevoegd.  In
		<code class="filename">/etc/printcap</code> staat de juiste
		wachtrijmap:</p><pre class="programlisting">bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<code class="filename">/var/spool/lpd/bamboo</code>:sc:rg=artists:mx#5000:\
        :lp=<code class="filename">/dev/ttyu5</code>:ms#-parenb cs8 clocal crtscts:rw:mx#5000:\
        :if=<code class="filename">/usr/local/libexec/psif</code>:\
        :df=<code class="filename">/usr/local/libexec/psdf</code>:</pre><p>De wachtrijmap wordt opgegeven met de optie
		<code class="literal">sd</code>.  Er wordt een limiet van drie
		megabyte ingesteld (wat gelijk staat aan 6144
		schijfblokken) voor de hoeveelheid vrije schijfruimte
		die op het bestandssysteem beschikbaar moet zijn
		voordat <span class="application">LPD</span> een opdracht op
		afstand accepteert:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 6144 &gt; /var/spool/lpd/bamboo/minfree</code></strong></pre></dd><dt><span class="term">Gebruikersbeperkingen</span></dt><dd><p>Met de optie <code class="literal">rs</code> in
		<code class="filename">/etc/printcap</code> kan worden geregeld
		welke gebruikers op afstand kunnen afdrukken op lokale
		printers.  Als <code class="literal">rs</code> voorkomt voor
		een lokale printer accepteert
		<span class="application">LPD</span> opdrachten van hosts op
		afstand <span class="emphasis"><em>als</em></span> de gebruiker die de
		opdracht wil plaatsen ook een account heeft met
		dezelfde gebruikersnaam op de lokale host.  Anders
		weigert <span class="application">LPD</span> de
		opdracht.</p><p>Deze optie is met name nuttig in een omgeving waar
		(bijvoorbeeld) verschillende afdelingen een netwerk
		delen en gebruikers de grenzen van de afdeling
		overschrijden.  Door ze een account te geven op een
		systeem kunnen ze de aangesloten printers gebruiken
		vanaf het systeem van hun eigen afdeling.  Wanneer ze
		<span class="emphasis"><em>alleen</em></span> gebruik mogen maken van de
		printers en niet van overige diensten op de computer,
		kunnen <span class="quote">&#8220;<span class="quote">tokenaccounts</span>&#8221;</span> worden aangemaakt,
		zonder thuismap en met een nutteloze shell als
		<code class="filename">/usr/bin/false</code>.</p></dd></dl></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-acct"></a>10.4.5. Printergebruik administreren</h3></div></div></div><a id="idp73997008" class="indexterm"></a><p>Het kan nodig zijn om afdrukken te doorbelasten.  Inkt en
	papier kosten geld en er zijn onderhoudskosten.  Printers
	zitten vol met bewegende delen en hebben de neiging kapot te
	gaan.  Nu is er gekeken naar de printers, het gebruikerspatroon
	en de onderhoudskosten en op basis hiervan is een prijs
	vastgesteld per pagina (of per centimeter, per meter, of per
	wat dan ook).  Hoe wordt nu een administratie bijgehouden van
	gemaakte afdrukken?</p><p>Het slechte nieuws is dat het wachtrijsysteem
	<span class="application">LPD</span> hierbij niet echt helpt.  Het
	administreren van afdrukken is erg afhankelijk van het type
	printer, het afdrukformaat en de wensen die een
	systeembeheerder heeft ten aanzien van het doorbelasten van
	printergebruik.</p><p>Om het administreren te implementeren, is het nodig om
	aanpassingen te maken in de tekstfilter (om platte tekst
	opdrachten te belasten) en de conversiefilters (om opdrachten
	in andere bestandsformaten te belasten), om pagina's te tellen,
	of de printer te vragen hoeveel pagina's er zijn afgedrukt.
	Het volstaat niet om het eenvoudige uitvoerfilter te gebruiken,
	aangezien dit niet in staat is het gebruik te administreren.
	Zie  <a class="link" href="printing-advanced.html#printing-advanced-filter-intro" title="10.4.1. Filters">Filters</a>.</p><p>In het algemeen zijn er twee manieren om gebruik te
	administreren:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>Periodiek administreren</em></span> is de meer
	    gebruikelijke manier, omdat het waarschijnlijk makkelijker
	    is.  Als iemand een opdracht afdrukt, schrijft het filter
	    de gebruiker, host en het aantal pagina's in een
	    administratiebestand.  Elke maand, semester, jaar, of
	    een andere gewenste periode kunnen de
	    administratiebestanden verzameld worden om het aantal
	    afgedrukte pagina's op te tellen en het gebruik in rekening
	    te brengen.  De logboekbestanden kunnen vervolgens
	    geschoond worden, zodat met een schone lei de volgende
	    periode begonnen kan worden.</p></li><li class="listitem"><p><span class="emphasis"><em>Directe administratie</em></span> is minder
	    gebruikelijk, waarschijnlijk omdat het moeilijker is.  Met
	    deze methode zorgen de filters ervoor dat gebruikers voor
	    hun printergebruik worden afgerekend op het moment dat ze er
	    gebruik van maken.  Net als schijfquota is de administratie
	    onmiddellijk.  Hiermee wordt voorkomen dat gebruikers kunnen
	    afdrukken wanneer ze over hun limiet zijn gegaan.  Ook
	    biedt dit de mogelijkheid voor gebruikers om hun
	    afdrukquotum te controleren, of aan te passen.  Deze
	    methode vereist databasecode om gebruikers en hun quota bij
	    te houden.</p></li></ul></div><p>Het wachtrijsysteem <span class="application">LPD</span>
	ondersteunt beide methoden op eenvoudige wijze.  Aangezien de
	filters (meestal) moeten worden aangeleverd, moet ook de code
	voor de administratie worden geleverd.  Er is echter een
	voordeel: er is grote flexibiliteit in de administratiemethode.
	Zo kan bijvoorbeeld gekozen worden tussen periodieke of directe
	administratie.  Er kan gekozen worden welke informatie
	opgeslagen wordt: gebruikersnamen, hostnamen, type opdracht,
	aantal afgedrukte pagina's, hoe lang het afdrukken duurde,
	enzovoort.  Dit alles kan worden gedaan door de filters aan te
	passen.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74036688"></a>10.4.5.1. Kort door de bocht printeradministratie</h4></div></div></div><p>FreeBSD wordt met twee programma's geleverd waarmee
	  periodieke administratie direct kan worden opgezet.  Het zijn
	  het tekstfilter <code class="command">lpf</code>, beschreven in <a class="link" href="printing-advanced.html#printing-advanced-lpf" title="10.4.1.6. lpf: een tekstfilter">lpf: een
	  tekstfilter</a> en <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a>, een programma dat posten
	  uit administratiebestanden verzamelt en optelt.</p><p>Zoals beschreven in de sectie over filters (<a class="link" href="printing-advanced.html#printing-advanced-filters" title="10.4.1.1. Hoe filters werken">Filters</a>), roept
	  <span class="application">LPD</span> de tekst- en conversiefilters
	  aan met de naam van het administratiebestand als argument.
	  De filters kunnen dit argument gebruiken om te bepalen in
	  welk bestand de gegevens voor de administratie moeten worden
	  weggeschreven.  De naam van dit bestand is afkomstig van de
	  optie <code class="literal">af</code> uit
	  <code class="filename">/etc/printcap</code>.  Als er geen absoluut pad
	  wordt opgegeven, dan is de locatie relatief aan de
	  wachtrijmap.</p><p><span class="application">LPD</span> start
	  <code class="command">lpf</code> met paginabreedte en -lengte
	  argumenten (afkomstig uit de opties <code class="literal">pw</code> en
	  <code class="literal">pl</code>).  Het filter <code class="command">lpf</code>
	  gebruikt deze argumenten om te bepalen hoeveel papier er
	  gebruikt zal worden.  Nadat het bestand naar de printer is
	  gestuurd, schrijft het een post in het administratiebestand.
	  De posten zien er als volgt uit:</p><pre class="programlisting">2.00 rose:andy
3.00 rose:kelly
3.00 orchid:mary
5.00 orchid:mary
2.00 orchid:zhang</pre><p>Aangezien <code class="command">lpf</code> geen ingebouwde logica
	  voor bestandslocking kent, moet voor elke printer een apart
	  administratiebestand gebruikt worden.  Twee
	  <code class="command">lpf</code>s kunnen elkaars posten corrumperen als
	  ze tegelijk in hetzelfde bestand schrijven.  De optie
	  <code class="literal">af=acct</code> in
	  <code class="filename">/etc/printcap</code> biedt een makkelijke
	  manier om er zeker van te zijn dat aparte bestanden worden
	  gebruikt.  Dan bevindt elk administratiebestand zich in de
	  wachtrijmap van de betreffende printer en krijgt de naam
	  <code class="filename">acct</code> krijgen</p><p>Wanneer het tijd is om met gebruikers af te rekenen voor
	  hun afdrukken, kan het programma <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a> gedraaid worden.
	  Ga naar de wachtrijmap van de printer waarvoor betaald moet
	  worden en typ <code class="command">pac</code>.  Er verschijnt een
	  dollar-centrische samenvatting zoals het volgende:</p><pre class="screen">  Login               pages/feet   runs    price
orchid:kelly                5.00    1   $  0.10
orchid:mary                31.00    3   $  0.62
orchid:zhang                9.00    1   $  0.18
rose:andy                   2.00    1   $  0.04
rose:kelly                177.00  104   $  3.54
rose:mary                  87.00   32   $  1.74
rose:root                  26.00   12   $  0.52

total                     337.00  154   $  6.74</pre><p>Dit zijn de argumenten die <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a> verwacht:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-P<em class="replaceable"><code>printer</code></em></code></span></dt><dd><p>De <em class="replaceable"><code>printer</code></em> waarvoor een
		samenvatting moet worden gegenereerd.  Deze optie werkt
		alleen als er een absoluut pad is gegeven in de optie
		<code class="literal">af</code> in
		<code class="filename">/etc/printcap</code>.</p></dd><dt><span class="term"><code class="option">-c</code></span></dt><dd><p>Sorteer de uitvoer op kosten, in plaats van
		alfabetisch op gebruikersnaam.</p></dd><dt><span class="term"><code class="option">-m</code></span></dt><dd><p>Negeer de hostnamen in het administratiebestand.
		Met deze optie is de gebruiker
		<code class="systemitem">smith</code> op host
		<code class="systemitem">alpha</code> dezelfde gebruiker als
		<code class="systemitem">smith</code> op host
		<code class="systemitem">gamma</code>.  Zonder deze optie zijn het
		verschillende gebruikers.</p></dd><dt><span class="term"><code class="option">-p<em class="replaceable"><code>prijs</code></em></code></span></dt><dd><p>Bereken de prijs met
		<em class="replaceable"><code>prijs</code></em> dollar per pagina of
		per voet, in plaats van de prijs uit de optie
		<code class="literal">pc</code> in
		<code class="filename">/etc/printcap</code> of twee cent (de
		standaard).  De <em class="replaceable"><code>prijs</code></em> kan
		worden opgegeven als een decimaal getal.</p></dd><dt><span class="term"><code class="option">-r</code></span></dt><dd><p>Keer de sorteervolgorde om.</p></dd><dt><span class="term"><code class="option">-s</code></span></dt><dd><p>Maak een bestand met een samenvatting van de
		administratie en leeg het administratiebestand.</p></dd><dt><span class="term"><em class="replaceable"><code>namen</code></em>
	      <em class="replaceable"><code>&#8230;</code></em></span></dt><dd><p>Druk de administratiegegevens alleen af voor
		gebruikersnamen <em class="replaceable"><code>namen</code></em>.</p></dd></dl></div><p>In de standaard samenvatting die <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a> genereert,
	  is het aantal pagina's te zien dat iedere gebruiker vanaf een
	  bepaalde host heeft afgedrukt.  Wanneer de hostnaam niet
	  van belang is (bijvoorbeeld omdat gebruikers iedere host
	  kunnen gebruiken), gebruik dan <code class="command">pac
	  -m</code> om de volgende samenvatting te
	  genereren:</p><pre class="screen">  Login               pages/feet   runs    price
andy                        2.00    1   $  0.04
kelly                     182.00  105   $  3.64
mary                      118.00   35   $  2.36
root                       26.00   12   $  0.52
zhang                       9.00    1   $  0.18

total                     337.00  154   $  6.74</pre><p>Om het verschuldigde bedrag te berekenen gebruikt
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a> de optie <code class="literal">pc</code> uit
	  <code class="filename">/etc/printcap</code> (standaard aantal van 200
	  of 2 cent per pagina).  Specificeer, in honderden
	  centen, de prijs per pagina of per voet die berekent moet
	  worden.  Deze waarde kan worden aangepast door <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a>
	  aan te roepen met de optie <code class="option">-p</code>.  De eenheden
	  van de optie <code class="option">-p</code> zijn echter in dollars, niet
	  in honderden centen.  Bijvoorbeeld,</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pac -p1.50</code></strong></pre><p>zorgt ervoor dat elke pagina 1,50 dollar kost.  U kunt
	  echt grote winsten maken met deze optie.</p><p>Tenslotte kan met <code class="command">pac
	    -s</code> de samenvatting worden
	  opgeslagen in een bestand dat dezelfde naam krijgt als het
	  administratiebestand van de printer, maar dan met
	  <code class="literal">_sum</code> toegevoegd aan de naam.  Vervolgens
	  wordt het administratiebestand geleegd.  Als <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a>
	  opnieuw wordt aangeroepen, herleest <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a> het
	  samenvattingsbestand om de startwaarden te bepalen en telt
	  daar de informatie bij op van het standaard
	  administratiebestand.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74101840"></a>10.4.5.2. Hoe kan het aantal afgedrukte pagina's worden
	  geteld?</h4></div></div></div><p>Om ook maar de minste nauwkeurigheid bij het
	  administreren te verkrijgen, is het nodig te weten hoeveel
	  papier een afdrukopdracht gebruikt.  Dit is het centrale
	  probleem van het bijhouden van printerstatistieken.</p><p>Voor opdrachten met platte tekst is het probleem niet zo
	  moeilijk op te lossen: het aantal regels in een opdracht
	  wordt geteld en vergeleken met het aantal regels per pagina
	  dat door een printer wordt ondersteund.  Hierbij moet niet
	  worden vergeten dat backspaces in het bestand regels
	  overschrijven en dat lange logische regels worden afgedrukt
	  als meerdere fysieke regels.</p><p>Het tekstfilter <code class="command">lpf</code>
	  (geïntroduceerd in <a class="link" href="printing-advanced.html#printing-advanced-lpf" title="10.4.1.6. lpf: een tekstfilter">lpf: een
	  tekstfilter</a>) houdt met deze zaken rekening bij het
	  administreren.  Als het nodig is een tekstfilter te schrijven
	  dat ook het printergebruik moet bijhouden, dan is het nuttig
	  de broncode van <code class="command">lpf</code> te bestuderen.</p><p>Hoe worden andere bestandsformaten dan verwerkt?</p><p>Voor een DVI-naar-LaserJet, of DVI-naar-<span class="trademark">PostScript</span>®
	  conversie kan het filter de diagnostische uitvoer van
	  <code class="command">dvilj</code> of <code class="command">dvips</code> bekijken
	  om te bepalen hoeveel pagina's er zijn geconverteerd.  Voor
	  andere formaten kan hetzelfde worden gedaan met behulp van de
	  betreffende conversieprogramma's.</p><p>Deze methoden hebben echter als nadeel dat een printer
	  eventueel niet alle pagina's ook daadwerkelijk afdrukt.  Zo
	  kan het papier vast komen te zitten, de toner opraken of de
	  printer ontploffen, terwijl de gebruiker toch moet
	  betalen.</p><p>Dus, wat kan hieraan worden gedaan?</p><p>Er is slechts één
	  <span class="emphasis"><em>betrouwbare</em></span> manier om
	  <span class="emphasis"><em>nauwkeurig</em></span> te administreren.  Dat is
	  met behulp van een printer die kan vertellen hoeveel papier
	  er is gebruikt.  Deze moet vervolgens worden aangesloten
	  met een seriële lijn, of een netwerkverbinding.  Bijna
	  alle <span class="trademark">PostScript</span>®-printers hebben deze mogelijkheid, andere
	  modellen en merken mogelijk ook (bijvoorbeeld Imagen
	  netwerklaserprinters).  De filters dienen voor deze printers
	  aangepast te worden om het papierverbruik na elke opdracht te
	  achterhalen en de administratieve informatie
	  <span class="emphasis"><em>alleen</em></span> op deze waarde te baseren.  Er is
	  geen noodzaak om foutgevoelig regels te tellen of bestanden
	  te analyseren.</p><p>Natuurlijk kan een beheerder ook vrijgevig zijn en alle
	  afdrukken gratis maken.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="printing-intro-setup.html">Terug</a> </td><td width="20%" align="center"><a accesskey="u" href="printing.html">Omhoog</a></td><td width="40%" align="right"> <a accesskey="n" href="printing-using.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">10.3. Standaardinstallatie </td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top"> 10.5. Printers gebruiken</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>