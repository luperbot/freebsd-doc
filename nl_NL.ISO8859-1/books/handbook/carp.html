<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>31.13. Common Address Redundancy Protocol (CARP)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD handboek" /><link rel="up" href="advanced-networking.html" title="Hoofdstuk 31. Geavanceerde netwerken" /><link rel="prev" href="network-atm.html" title="31.12. Asynchronous Transfer Mode (ATM)" /><link rel="next" href="appendices.html" title="Deel V. Appendix" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.13. Common Address Redundancy Protocol (CARP)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-atm.html">Terug</a> </td><th width="60%" align="center">Hoofdstuk 31. Geavanceerde netwerken</th><td width="20%" align="right"> <a accesskey="n" href="appendices.html">Volgende</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="carp"></a>31.13. Common Address Redundancy Protocol (CARP)</h2></div><div><span class="authorgroup">Bijgedragen door <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp90818896" class="indexterm"></a><a id="idp90819408" class="indexterm"></a><p>Het Common Address Redundancy Protocol, of
      <acronym class="acronym">CARP</acronym>, staat toe dat meerdere hosts hetzelfde
      <acronym class="acronym">IP</acronym>-adres gebruiken.  In sommige opstellingen
      wordt dit gebruikt voor beschikbaarheid of loadbalancing.  Hosts
      kunnen ook gescheiden <acronym class="acronym">IP</acronym>-adressen gebruiken,
      zoals in het voorbeeld dat hier is gegeven.</p><p>Om ondersteuning voor <acronym class="acronym">CARP</acronym> aan te zetten,
      dient de FreeBSD-kernel herbouwd zoals beschreven in
      <a class="xref" href="kernelconfig.html" title="Hoofdstuk 9. De FreeBSD-kernel instellen">Hoofdstuk 9, <em>De FreeBSD-kernel instellen</em></a> met de volgende
      optie:</p><pre class="programlisting">device	carp</pre><p>Als alternatief kan de <code class="filename">if_carp.ko</code>
      module geladen worden tijdens het opstarten.  Voeg de volgende
      regel toe aan <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">if_carp_load="YES"</pre><p>De functionaliteit van <acronym class="acronym">CARP</acronym> zou nu
      beschikbaar moeten zijn en kan met verschillende
      <code class="command">sysctl</code>-<acronym class="acronym">OID</acronym>s worden
      bijgesteld:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>OID</th><th>Beschrijving</th></tr></thead><tbody><tr><td><code class="varname">net.inet.carp.allow</code></td><td>Accepteer inkomende <acronym class="acronym">CARP</acronym> pakketten.
	      Staat standaard aan.</td></tr><tr><td><code class="varname">net.inet.carp.preempt</code></td><td>Deze optie zet alle <acronym class="acronym">CARP</acronym>
	      interfaces down op de host wanneer er een down gaat.
	      Staat standaard uit.</td></tr><tr><td><code class="varname">net.inet.carp.log</code></td><td>De waarde <code class="literal">0</code> zet alle logging uit.
	      De waarde <code class="literal">1</code> zet het loggen van slechte
	      <acronym class="acronym">CARP</acronym>-pakketten aan.  Waardes hoger dan
	      <code class="literal">1</code> zet het loggen van
	      toestandsveranderingen van de <acronym class="acronym">CARP</acronym>
	      interfaces aan.  De standaardwaarde is
	      <code class="literal">1</code>.</td></tr><tr><td><code class="varname">net.inet.carp.arpbalance</code></td><td>Balanceer lokaal netwerkverkeer met
	      <acronym class="acronym">ARP</acronym>.  Staat standaard uit.</td></tr><tr><td><code class="varname">net.inet.carp.suppress_preempt</code></td><td>Een alleen-lezen <acronym class="acronym">OID</acronym> die de
	      toestand van preëmptie-onderdrukking weergeeft.
	      Preëmptie kan worden onderdrukt wanneer de verbinding
	      op een interface afwezig is.  De waarde
	      <code class="literal">0</code> betekent dat preëmptie niet
	      onderdrukt is.  Elk probleem verhoogt deze
	      <acronym class="acronym">OID</acronym>.</td></tr></tbody></table></div><p>De <acronym class="acronym">CARP</acronym>-apparaten zelf kunnen met het
      commando <code class="command">ifconfig</code> worden aangemaakt:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig carp0 create</code></strong></pre><p>In een echte omgeving hebben deze interfaces unieke
      identificatienummers, bekend als een <acronym class="acronym">VHID</acronym>,
      nodig.  Dit <acronym class="acronym">VHID</acronym> of Virtual Host Identification
      zal worden gebruikt om de hosts op het netwerk te
      onderscheiden.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90843728"></a>31.13.1. CARP gebruiken voor serverbeschikbaarheid</h3></div></div></div><p>Eén gebruik van <acronym class="acronym">CARP</acronym>, zoals boven
	aangegeven, is serverbeschikbaarheid.  Dit voorbeeld geeft
	failover-ondersteuning voor drie hosts, met allemaal een uniek
	<acronym class="acronym">IP</acronym>-adres en dezelfde webinhoud.  Deze
	machines zullen samen met een Round Robin <acronym class="acronym">DNS</acronym>
	configuratie dienst doen.  De failover-machine zal twee
	aanvullende <acronym class="acronym">CARP</acronym>-interfaces hebben,
	één voor elk van de <acronym class="acronym">IP</acronym>'s van de
	contentservers.  Wanneer er een storing optreedt, zou de
	failover-server het <acronym class="acronym">IP</acronym>-adres van de falende
	machine moeten oppikken.  Dit betekent dat de storing geheel
	onmerkbaar zou moeten zijn voor de gebruiker.  De
	failover-server heeft dezelfde inhoud en diensten nodig als de
	andere contentservers waarvoor het moet invallen.</p><p>De twee machines dienen identiek geconfigureerd te worden
	op de gegeven hostnamen en <acronym class="acronym">VHID</acronym>s na.  Dit
	voorbeeld noemt deze machines respectievelijk
	<code class="systemitem">hosta.example.org</code> en
	<code class="systemitem">hostb.example.org</code>.  Ten eerste dienen de
	benodigde regels voor een <acronym class="acronym">CARP</acronym>-configuratie
	aan <code class="filename">rc.conf</code> te worden toegevoegd.  Voor
	<code class="systemitem">hosta.example.org</code> dient het bestand
	<code class="filename">rc.conf</code> de volgende regels te bevatten:</p><pre class="programlisting">hostname="hosta.example.org"
ifconfig_fxp0="inet 192.168.1.3 netmask 255.255.255.0"
cloned_interfaces="carp0"
ifconfig_carp0="vhid 1 pass testpass 192.168.1.50/24"</pre><p>Op <code class="systemitem">hostb.example.org</code> dienen de volgende
	regels in <code class="filename">rc.conf</code> te staan:</p><pre class="programlisting">hostname="hostb.example.org"
ifconfig_fxp0="inet 192.168.1.4 netmask 255.255.255.0"
cloned_interfaces="carp0"
ifconfig_carp0="vhid 2 pass testpass 192.168.1.51/24"</pre><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Het is erg belangrijk dat de wachtwoorden die met de optie
	  <code class="option">pass</code> aan <code class="command">ifconfig</code> gegeven
	  zijn, identiek zijn.  De <code class="filename">carp</code>
	  apparaten zullen alleen luisteren naar en advertenties
	  accepteren van machines met het juiste wachtwoord.  Het
	  <acronym class="acronym">VHID</acronym> dient ook verschillend te zijn voor
	  elke machine.</p></div><p>De derde machine,
	<code class="systemitem">provider.example.org</code>, dient voorbereidt te
	worden op het afhandelen van failover van beide hosts.  Deze
	machine heeft twee <code class="filename">carp</code> apparaten nodig,
	één om elke host af te handelen.  De juiste
	instelregels voor <code class="filename">rc.conf</code> zullen ongeveer
	gelijk zijn aan de volgende:</p><pre class="programlisting">hostname="provider.example.org"
ifconfig_fxp0="inet 192.168.1.5 netmask 255.255.255.0"
cloned_interfaces="carp0 carp1"
ifconfig_carp0="vhid 1 advskew 100 pass testpass 192.168.1.50/24"
ifconfig_carp1="vhid 2 advskew 100 pass testpass 192.168.1.51/24"</pre><p>Met twee <code class="filename">carp</code> apparaten is
	<code class="systemitem">provider.example.org</code> in staat om het
	<acronym class="acronym">IP</acronym>-adres van de andere machine op te pikken
	wanneer de ene niet meer antwoordt.</p><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">De standaard FreeBSD-kernel <span class="emphasis"><em>kan</em></span>
	  preëmptie geactiveerd hebben.  In dat geval hoeft
	  <code class="systemitem">provider.example.org</code> het
	  <acronym class="acronym">IP</acronym>-adres niet terug te geven aan de
	  originele contentserver.  In dit geval kan het nodig zijn dat
	  een beheerder handmatig het IP terug aan de meester moet geven.
	  Het volgende commando dient op
	  <code class="systemitem">provider.example.org</code> gegeven te worden:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig carp0 down &amp;&amp; ifconfig carp0 up</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">Dit dient gedaan te worden op de
	  <code class="filename">carp</code> interface die met de juiste
	  host overeenkomt.</p></div><p>Op dit moment dient <acronym class="acronym">CARP</acronym> volledig actief
	en beschikbaar voor testen te zijn.  Voor het testen dienen
	òfwel het netwerken herstart te worden, òf de
	machines dienen opnieuw opgestart te worden.</p><p>Meer informatie is altijd beschikbaar in de hulppagina
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=carp&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">carp</span>(4)</span></a></p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-atm.html">Terug</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Omhoog</a></td><td width="40%" align="right"> <a accesskey="n" href="appendices.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">31.12. Asynchronous Transfer Mode (ATM) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top"> Deel V. Appendix</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>