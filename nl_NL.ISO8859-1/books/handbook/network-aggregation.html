<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>31.6. Verbindingsaggregatie en failover</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD handboek" /><link rel="up" href="advanced-networking.html" title="Hoofdstuk 31. Geavanceerde netwerken" /><link rel="prev" href="network-bridging.html" title="31.5. Bridging" /><link rel="next" href="network-diskless.html" title="31.7. Schijfloos werken" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.6. Verbindingsaggregatie en failover</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-bridging.html">Terug</a> </td><th width="60%" align="center">Hoofdstuk 31. Geavanceerde netwerken</th><td width="20%" align="right"> <a accesskey="n" href="network-diskless.html">Volgende</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-aggregation"></a>31.6. Verbindingsaggregatie en failover</h2></div><div><span class="authorgroup">Geschreven door <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Andrew</span> <span class="surname">Thompson</span></span>. </span></div></div></div><a id="idp89907536" class="indexterm"></a><a id="idp89908176" class="indexterm"></a><a id="idp89908688" class="indexterm"></a><a id="idp89909200" class="indexterm"></a><a id="idp89909712" class="indexterm"></a><a id="idp89910224" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89910736"></a>31.6.1. Introductie</h3></div></div></div><p>De interface <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> maakt het mogelijk om meerdere
	netwerkinterfaces te aggregeren in één virtueel
	interface voor het bieden van fout-tolerante en zeer snelle
	verbindingen.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89912656"></a>31.6.2. Werkmodi</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Failover</span></dt><dd><p>Zendt en ontvangt verkeer alleen door de meesterpoort.
	      Wanneer de meesterpoort niet beschikbaar is, wordt de
	      volgende actieve poort gebruikt.  De eerste toegevoegde
	      interface is de meesterpoort; alle interfaces die hierna
	      zijn toegevoegd worden gebruikt als failover-apparaten.  Als
	      failover naar een niet-meesterpoort plaatsvindt, dan wordt de
	      originele poort de meester wanneer deze weer beschikbaar
	      wordt.</p></dd><dt><span class="term"><span class="trademark">Cisco</span>® Fast <span class="trademark">EtherChannel</span>®</span></dt><dd><p><span class="trademark">Cisco</span>® Fast <span class="trademark">EtherChannel</span>® (FEC), is een statische
	      installatie en onderhandelt niet over aggregatie met de
	      peer noch wisselt het frames uit om de verbinding te
	      monitoren.  Indien de switch LACP ondersteunt dient dat
	      gebruikt te worden.</p><p><acronym class="acronym">FEC</acronym> balanceert uitgaand verkeer
	      over de actieve poorten gebaseerd op gehashde informatie
	      over protocolheaders en accepteert inkomend verkeer van
	      elke actieve poort.  De hash bevat het Ethernet bron- en
	      doeladres, en indien beschikbaar, de VLAN-tag, en de
	      IPv4/IPv6 bron- en doeladressen.</p></dd><dt><span class="term">LACP</span></dt><dd><p>Het <span class="trademark">IEEE</span>® 802.3ad Link Aggregation Control Protocol
	      (LACP) en het Marker Protocol.  LACP onderhandelt met de
	      peer over een verzameling aggregeerbare verbindingen in
	      één of meerdere Link Aggregated Groups
	      (LAG).  Elke LAG is opgebouwd uit poorten die dezelfde
	      snelheid hebben, ingesteld op full-duplex werking.  Het
	      verkeer zal over de poorten in de LAG gebalanceerd worden
	      met de hoogste totaalsnelheid, in de meeste gevallen zal
	      er slechts één LAG zijn die alle poorten
	      bevat.  Wanneer er fysieke verbindingen veranderen, zal
	      Link Aggregation snel naar een nieuwe opstelling
	      convergeren.</p><p><acronym class="acronym">LACP</acronym> balanceert uitgaand verkeer
	      over de actieve poorten gebaseerd op gehashde informatie
	      over protocolheaders en accepteert inkomend verkeer van
	      elke actieve poort.  De hash bevat het Ethernet bron- en
	      doeladres, en indien beschikbaar, de VLAN-tag, en de
	      IPv4/IPv6 bron- en doeladressen.</p></dd><dt><span class="term">Loadbalance</span></dt><dd><p>Dit is een alias van de <span class="emphasis"><em>FEC</em></span>
	      modus.</p></dd><dt><span class="term">Round-Robin</span></dt><dd><p>Distribueert uitgaand verkeer door middel van een
	      round-robin scheduler over alle actieve poorten en
	      accepteert inkomend verkeer van elke actieve poort.  Deze
	      modus schendt Ethernet frame-ordering en dient met zorg
	      gebruikt te worden.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89946064"></a>31.6.3. Voorbeelden</h3></div></div></div><div class="example"><a id="networking-lacp-aggregation-cisco"></a><div class="example-title">Voorbeeld 31.1. LACP-aggregatie met een <span class="trademark">Cisco</span>® switch</div><div class="example-contents"><p>Dit voorbeeld verbindt twee interfaces op een FreeBSD-machine
	  met de switch als een enkele loadgebalanceerde en
	  fout-tolerante verbinding.  Er kunnen meer interfaces worden
	  toegevoegd om de doorvoer en fouttolerantie te verhogen.
	  Aangezien frame-ordering verplicht is op Ethernetverbindingen
	  stroomt al het verkeer tussen twee stations altijd over
	  dezelfde fysieke verbinding zodat de maximum snelheid beperkt
	  wordt tot die van één interface.  Het
	  verzendalgoritme probeert zoveel mogelijk informatie te
	  gebruiken voor het onderscheiden van verschillende
	  verkeersstromen en deze over de beschikbare interfaces te
	  balanceren.</p><p>Voeg op de <span class="trademark">Cisco</span>® switch de interfaces
	  <em class="replaceable"><code>FastEthernet0/1</code></em> en
	  <em class="replaceable"><code>FastEthernet0/2</code></em> aan de kanaalgroep
	  <em class="replaceable"><code>1</code></em> toe:</p><pre class="screen"><strong class="userinput"><code>interface FastEthernet0/1
 channel-group 1 mode active
 channel-protocol lacp</code></strong>
!
<strong class="userinput"><code>interface FastEthernet0/2
 channel-group 1 mode active
 channel-protocol lacp</code></strong></pre><p>Maak de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a>-interface aan met
	  <em class="replaceable"><code>fxp0</code></em> en <em class="replaceable"><code>fxp1</code></em> en
	  activeer de interface met IP-adres
	  <em class="replaceable"><code>10.0.0.3/24</code></em>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp0 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp1 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 up laggproto lacp laggport fxp0 laggport fxp1 10.0.0.3/24</code></strong></pre><p>Bekijk de interfacestatus van ifconfig:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0</code></strong></pre><p>Poorten die als <span class="emphasis"><em>ACTIVE</em></span> zijn
	  gemarkeerd zijn lid van de actieve aggregatiegroep waarover
	  onderhandeld is met de verre switch en waarover verkeer zal
	  worden verzonden en ontvangen.  Gebruik de uitgebreide uitvoer
	  van <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> om de LAG-identifiers te bekijken.</p><pre class="screen">lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
        media: Ethernet autoselect
        status: active
        laggproto lacp
        laggport: fxp1 flags=1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;
        laggport: fxp0 flags=1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;</pre><p>Gebruik, om de toestand van de poorten op de switch te
	  bekijken, <strong class="userinput"><code>show lacp neighbor</code></strong>.</p><pre class="screen">switch# show lacp neighbor
Flags:  S - Device is requesting Slow LACPDUs
        F - Device is requesting Fast LACPDUs
        A - Device is in Active mode       P - Device is in Passive mode

Channel group 1 neighbors

Partner's information:

                  LACP port                        Oper    Port     Port
Port      Flags   Priority  Dev ID         Age     Key     Number   State
Fa0/1     SA      32768     0005.5d71.8db8  29s    0x146   0x3      0x3D
Fa0/2     SA      32768     0005.5d71.8db8  29s    0x146   0x4      0x3D</pre><p>Gebruik voor meer detail het commando <strong class="userinput"><code>show lacp
	    neighbor detail</code></strong>.</p><p>Voeg de volgende regels aan <code class="filename">/etc/rc.conf</code> toe
	  om deze informatie na het opnieuw starten te behouden:</p><pre class="programlisting">ifconfig_<em class="replaceable"><code>fxp0</code></em>="up"
ifconfig_<em class="replaceable"><code>fxp1</code></em>="up"
cloned_interfaces="<code class="literal">lagg0</code>"
ifconfig_<code class="literal">lagg0</code>="laggproto lacp laggport <em class="replaceable"><code>fxp0</code></em> laggport <em class="replaceable"><code>fxp1</code></em> <em class="replaceable"><code>10.0.0.3/24</code></em>"</pre></div></div><br class="example-break" /><div class="example"><a id="networking-lagg-failover"></a><div class="example-title">Voorbeeld 31.2. Failover-modus</div><div class="example-contents"><p>Failover-modus kan worden gebruikt om op een secondaire
	  interface over te schakelen wanneer de verbinding op de
	  meesterinterface verloren is.  Activeer de onderliggende fysieke
	  interface.  Creëer de
	  interface <code class="literal">lagg0</code>, met
	  <em class="replaceable"><code>fxp0</code></em> als de meesterinterface en
	  <em class="replaceable"><code>fxp1</code></em> als de secondaire
	  interface en ken er IP-adres <em class="replaceable"><code>10.0.0.15/24</code></em>
	  aan toe:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp0 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp1 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 up laggproto failover laggport fxp0 laggport fxp1 10.0.0.15/24</code></strong></pre><p>De interface zal er ongeveer als volgt uitzien, de grote
	  verschillen zullen het <acronym class="acronym">MAC</acronym>-adres en de
	  apparaatnamen zijn:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0</code></strong>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
        inet 10.0.0.15 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet autoselect
        status: active
        laggproto failover
        laggport: fxp1 flags=0&lt;&gt;
        laggport: fxp0 flags=5&lt;MASTER,ACTIVE&gt;</pre><p>Het verkeer zal worden verzonden en ontvangen op
	  <em class="replaceable"><code>fxp0</code></em>.  Indien de verbinding op
	  <em class="replaceable"><code>fxp0</code></em> verloren is, zal
	  <em class="replaceable"><code>fxp1</code></em> de actieve verbinding worden.
	  Indien de verbinding op de meesterinterface hersteld is, zal
	  het weer de actieve verbinding worden.</p><p>Voeg de volgende regels aan <code class="filename">/etc/rc.conf</code> toe
	  om deze informatie na het opnieuw starten te behouden:</p><pre class="programlisting">ifconfig_<em class="replaceable"><code>fxp0</code></em>="up"
ifconfig_<em class="replaceable"><code>fxp1</code></em>="up"
cloned_interfaces="<code class="literal">lagg0</code>"
ifconfig_<code class="literal">lagg0</code>="laggproto lacp laggport <em class="replaceable"><code>fxp0</code></em> laggport <em class="replaceable"><code>fxp1</code></em> <em class="replaceable"><code>10.0.0.15/24</code></em>"</pre></div></div><br class="example-break" /><div class="example"><a id="networking-lagg-wired-and-wireless"></a><div class="example-title">Voorbeeld 31.3. Failover-modus tussen bekabelde en draadloze interfaces</div><div class="example-contents"><p>Voor laptop-gebruikers is het normaliter wenselijk om het
	  draadloze interface als secundair interface te gebruiken indien het
	  bekabelde interface niet beschikbaar is.  Met <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> is het
	  mogelijk om één IP-adres te gebruiken en het bekabelde
	  interface voor zowel prestatie als veiligheid te prefereren terwijl de
	  mogelijkheid behouden blijft om de draadloze verbinding te
	  gebruiken.</p><p>In deze opstelling dient het MAC-adres van het onderliggende
	  draadloze interface overschreven te worden om met dat van <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a>
	  overeen te komen, welke afkomstig is van het primaire interface dat
	  wordt gebruikt, het bekabelde interface.</p><p>In deze opstelling wordt het bekabelde interface,
	  <em class="replaceable"><code>bge0</code></em> als meester gebruikt, en het draadloze
	  interface, <em class="replaceable"><code>wlan0</code></em>, als het
	  failover-interface.  <em class="replaceable"><code>wlan0</code></em> was aangemaakt
	  vanuit <em class="replaceable"><code>iwn0</code></em> voor welke het
	  <acronym class="acronym">MAC</acronym>-adres van de bekabelde verbinding zal worden
	  gebruikt.  De eerste stap is om het <acronym class="acronym">MAC</acronym>-adres van
	  het bekabelde interface te verkrijgen:</p><pre class="screen"><code class="prompt">#</code>  <strong class="userinput"><code>ifconfig bge0</code></strong>
bge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
      options=19b&lt;RXCSUM,TXCSUM,VLAN_MTU,VLAN_HWTAGGING,VLAN_HWCSUM,TSO4&gt;
      ether 00:21:70:da:ae:37
      inet6 fe80::221:70ff:feda:ae37%bge0 prefixlen 64 scopeid 0x2
      nd6 options=29&lt;PERFORMNUD,IFDISABLED,AUTO_LINKLOCAL&gt;
      media: Ethernet autoselect (1000baseT &lt;full-duplex&gt;)
      status: active</pre><p><em class="replaceable"><code>bge0</code></em> kan vervangen worden door het
	  eigenlijke interface, er zal een andere regel met
	  <code class="literal">ether</code> verschijnen, dit is het
	  <acronym class="acronym">MAC</acronym>-adres van het bekabelde interface.  Om het
	  onderliggende draadloze interface, <em class="replaceable"><code>iwn0</code></em> te
	  wijzigen:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig iwn0 ether 00:21:70:da:ae:37</code></strong></pre><p>Activeer het draadloze interface maar geef er nog geen IP-adres
	  aan:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig wlan0 create wlandev iwn0 ssid mijn_router up</code></strong></pre><p>Activeer de interface <em class="replaceable"><code>bge0</code></em>.  Maak het
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a>-interface aan met <em class="replaceable"><code>bge0</code></em> als
	  meester, en met failover naar <em class="replaceable"><code>wlan0</code></em> indien
	  nodig:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bge0 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 up laggproto failover laggport bge0 laggport wlan0</code></strong></pre><p>Het interface zal er ongeveer als volgt uitzien, de grootste
	  verschillen zullen het <acronym class="acronym">MAC</acronym>-adres en de
	  apparaatnamen zijn:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0</code></strong>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
      options=8&lt;VLAN_MTU&gt;
      ether 00:21:70:da:ae:37
      media: Ethernet autoselect
      status: active
      laggproto failover
      laggport: wlan0 flags=0&lt;&gt;
      laggport: bge0 flags=5&lt;MASTER,ACTIVE&gt;</pre><p>Start vervolgens de DHCP-cliënt om een IP-adres te
	  verkrijgen:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dhclient lagg0</code></strong></pre><p>Om deze configuratie bij het opstarten te behouden, kan het
	  volgende aan <code class="filename">/etc/rc.conf</code> worden
	  toegevoegd:</p><pre class="programlisting">ifconfig_bge0="up"
ifconfig_iwn0="ether 00:21:70:da:ae:37"
wlans_iwn0="wlan0"
ifconfig_wlan0="WPA"
cloned_interfaces="<code class="literal">lagg0</code>"
ifconfig_<code class="literal">lagg0</code>="laggproto failover laggport bge0 laggport wlan0 DHCP"</pre></div></div><br class="example-break" /></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-bridging.html">Terug</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Omhoog</a></td><td width="40%" align="right"> <a accesskey="n" href="network-diskless.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">31.5. Bridging </td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top"> 31.7. Schijfloos werken</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>