<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>29.11. Hosts op afstand loggen met syslogd</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD handboek" /><link rel="up" href="network-servers.html" title="Hoofdstuk 29. Netwerkdiensten" /><link rel="prev" href="network-ntp.html" title="29.10. Tijd synchroniseren met NTP" /><link rel="next" href="firewalls.html" title="Hoofdstuk 30. Firewalls" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.11. Hosts op afstand loggen met
      <code class="command">syslogd</code></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-ntp.html">Terug</a> </td><th width="60%" align="center">Hoofdstuk 29. Netwerkdiensten</th><td width="20%" align="right"> <a accesskey="n" href="firewalls.html">Volgende</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-syslogd"></a>29.11. Hosts op afstand loggen met
      <code class="command">syslogd</code></h2></div><div><span class="authorgroup">Bijgedragen door <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>Het omgaan met systeemlogs is een cruciaal aspect van zowel
      beveiligings- als systeembeheer.  Het in de gaten houden van
      logbestanden van meerdere hosts kan nogal onhandelbaar worden als
      deze hosts over (middel)grote netwerken zijn verspreid, of wanneer
      ze deel zijn van verschillende soorten netwerken.  In deze
      gevallen kan het op afstand loggen het gehele proces een stuk
      aangenamer maken.</p><p>Het centraal loggen naar een specifieke loghost kan wat van de
      administratieve last van het beheren van logbestanden wegnemen.
      Het aggregeren, samenvoegen, en roteren van logbestanden kan op
      één enkele plaats worden ingesteld, door gebruik te
      maken van de eigen gereedschappen van FreeBSD, zoals <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a>
      en <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newsyslog&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newsyslog</span>(8)</span></a>.  In de volgende voorbeeldconfiguratie zal
      host <code class="systemitem">A</code>, genaamd <code class="systemitem">logserv.example.com</code>, loginformatie voor het
      plaatselijke netwerk verzamelen.  Host <code class="systemitem">B</code>, genaamd
      <code class="systemitem">logclient.example.com</code>, zal
      loginformatie aan het serversysteem doorgeven.  In echte
      configuraties hebben beide hosts degelijke voor- en terugwaartse
      <acronym class="acronym">DNS</acronym> of regels in
      <code class="filename">/etc/hosts</code> nodig.  Anders worden de gegevens
      geweigerd door de server.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87855184"></a>29.11.1. Configuratie van de logserver</h3></div></div></div><p>Logservers zijn machines die zijn geconfigureerd om
	loginformatie van hosts op afstand te accepteren.  In de meeste
	gevallen is dit om de configuratie te vergemakkelijken, in
	andere gevallen kan het gewoon een beheersbeslissing zijn.
	Ongeacht de reden zijn er enkele eisen voordat er verder wordt
	gegaan.</p><p>Een juist geconfigureerde logserver voldoet aan de volgende
	minimale eisen:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>De regels van de firewall staan toe dat
	    <acronym class="acronym">UDP</acronym> wordt doorgegeven op poort 514 van
	    zowel de cliënt als de server;</p></li><li class="listitem"><p>syslogd is ingesteld om berichten op afstand van
	    cliëntmachines te accepteren;</p></li><li class="listitem"><p>De syslogd-server en alle cliëntmachines moeten
	    geldige regels hebben voor zowel voorwaartse als
	    terugwaartse <acronym class="acronym">DNS</acronym>, of correct zijn
	    geconfigureerd in <code class="filename">/etc/hosts</code>.</p></li></ul></div><p>Om de logserver te configureren, moet de cliënt vermeld
	zijn in <code class="filename">/etc/syslog.conf</code>, en moet de
	logfaciliteit zijn gespecificeerd:</p><pre class="programlisting">+logclient.example.com
*.*	/var/log/logclient.log</pre><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Meer informatie over de verschillende ondersteunde en
	  beschikbare <span class="emphasis"><em>faciliteiten</em></span> kan gevonden
	  worden in de handleidingpagina <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslog.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">syslog.conf</span>(5)</span></a>.</p></div><p>Eenmaal toegevoegd worden alle
	<code class="literal">faciliteits</code>-berichten gelogd naar het eerder
	gespecificeerde bestand,
	<code class="filename">/var/log/logclient.log</code>.</p><p>De servermachine moet ook het volgende in
	<code class="filename">/etc/rc.conf</code> hebben staan:</p><pre class="programlisting">syslogd_enable="YES"
syslogd_flags="-a logclient.example.com -v -v"</pre><p>De eerste optie zet de daemon <code class="command">syslogd</code> aan
	tijdens het opstarten, en de tweede regel staat toe dat gegevens
	van de cliënt op deze server worden geaccepteerd.  Het
	laatste gedeelte, dat <code class="option">-v -v</code> gebruikt, verhoogt de
	verbositeit van gelogde berichten.  Dit is extreem handig voor
	het optimaal instellen van faciliteiten aangezien beheerders
	kunnen zien welk soort berichten onder welke faciliteit worden
	gelogd.</p><p>Er kunnen meerdere opties <code class="option">-a</code> worden
	gespecificeerd om logging vanuit meerdere cliënten toe te
	staan.  <acronym class="acronym">IP</acronym>-adressen en hele netblokken mogen
	ook worden gespecificeerd, bekijk de hulppagina <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslog&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a>
	voor een volledige lijst van mogelijke opties.</p><p>Als laatste dient het logbestand gecreëerd te worden.
	De gebruikte manier maakt niet uit, maar <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=touch&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">touch</span>(1)</span></a> werkt
	prima in dit soort situaties:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>touch /var/log/logclient.log</code></strong></pre><p>Nu dient het <code class="command">syslogd</code>-daemon herstart en
	geverifieerd worden:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pgrep syslog</code></strong></pre><p>Als er een <acronym class="acronym">PID</acronym> wordt teruggegeven, dan is
	de server succesvol herstart, en kan er begonnen worden met de
	configuratie van de cliënt.  Raadpleeg de log
	<code class="filename">/var/log/messages</code> voor uitvoer als de
	server niet is herstart.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87883216"></a>29.11.2. Configuratie van de logcliënt</h3></div></div></div><p>Een logcliënt is een machine die loginformatie naar een
	logserver verstuurt en daarnaast lokale kopieën
	bewaart.</p><p>Net als logservers moeten logcliënten ook aan enkele
	minimumeisen voldoen:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> moet zijn ingesteld om berichten van
	    bepaalde soorten naar een logserver te sturen, die ze moet
	    accepteren;</p></li><li class="listitem"><p>De firewall moet <acronym class="acronym">UDP</acronym>-pakketten
	    doorlaten op poort 514;</p></li><li class="listitem"><p>Zowel voorwaartse als terugwaartse
	    <acronym class="acronym">DNS</acronym> moeten geconfigureerd zijn of juiste
	    regels in <code class="filename">/etc/hosts</code> hebben.</p></li></ul></div><p>De configuratie van cliënten is wat soepeler dan die
	van servers.  De cliëntmachine moet de volgende regels in
	<code class="filename">/etc/rc.conf</code> hebben:</p><pre class="programlisting">syslogd_enable="YES"
syslogd_flags="-s -v -v"</pre><p>Net als eerder zullen deze regels de daemon
	<code class="command">syslogd</code> tijdens het opstarten aanzetten, en
	de verbositeit van gelogde berichten verhogen.  De optie
	<code class="option">-s</code> voorkomt dat logs van deze cliënt
	vanuit andere hosts worden geaccepteerd.</p><p>Faciliteiten beschrijven het systeemgedeelte waarvoor een
	bericht is gegenereerd.  <acronym class="acronym">ftp</acronym> en
	<acronym class="acronym">ipfw</acronym> bijvoorbeeld zijn beide faciliteiten.
	Wanneer er logberichten worden gegenereerd voor deze twee
	diensten, zullen ze normaalgesproken deze twee gereedschappen in
	elk logbericht opnemen.  Faciliteiten worden vergezeld van een
	prioriteit of niveau, welke wordt gebruikt om aan te geven hoe
	belangrijk een logbericht is.  De meest voorkomende zullen
	<code class="literal">warning</code> en <code class="literal">info</code> zijn.
	Bekijk de handleidingpagina <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslog&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a> voor een volledige
	lijst van beschikbare faciliteiten en prioriteiten.</p><p>De logserver moet in <code class="filename">/etc/syslog.conf</code>
	van de cliënt zijn gedefinieerd.  In dit geval wordt het
	symbool <code class="literal">@</code> gebruikt om loggegevens naar een
	server op afstand te sturen en zou er ongeveer als de volgende
	regel uit moeten zien:</p><pre class="programlisting">*.*	@logserv.example.com</pre><p>Eenmaal toegevoegd moet <code class="command">syslogd</code> worden
	herstart zodat de veranderingen effect hebben:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong></pre><p>Om te testen of logberichten over het netwerk worden
	verzonden, wordt <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=logger&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">logger</span>(1)</span></a> op de cliënt gebruikt om
	een bericht naar <code class="command">syslogd</code> te sturen:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>logger "Testbericht van logclient"</code></strong></pre><p>Dit bericht dient nu zowel in
	<code class="filename">/var/log/messages</code> op de cliënt als
	<code class="filename">/var/log/logclient.log</code> op de logserver te
	staan.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87905616"></a>29.11.3. Logservers debuggen</h3></div></div></div><p>In bepaalde gevallen kan het nodig zijn om te debuggen als
	berichten niet door de logserver worden ontvangen.  Er zijn
	verschillende redenen waarom dit kan gebeuren; de twee meest
	voorkomende zijn echter voorvallen met de netwerkverbinding en
	<acronym class="acronym">DNS</acronym>.  Om deze gevallen te testen, dient te
	worden nagegaan dat beide hosts elkaar kunnen bereiken door
	de hostnaam in <code class="filename">/etc/rc.conf</code> te gebruiken.
	Als dit juist lijkt te werken, dient de optie
	<code class="literal">syslogd_flags</code> in
	<code class="filename">/etc/rc.conf</code> te worden veranderd.</p><p>In het volgende voorbeeld is
	<code class="filename">/var/log/logclient.log</code> leeg, en noemt
	<code class="filename">/var/log/messages</code> geen reden waarom het
	mislukt.  Verander de optie <code class="literal">syslogd_flags</code>
	zoals in het volgende voorbeeld en herstart om de debuguitvoer
	te verhogen:</p><pre class="programlisting">syslogd_flags="-d -a logclien.example.com -v -v"</pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong></pre><p>Debuggegevens zoals de volgende zullen meteen na de herstart
	over het scherm vliegen:</p><pre class="screen">logmsg: pri 56, flags 4, from logserv.example.com, msg syslogd: restart
syslogd: restarted
logmsg: pri 6, flags 4, from logserv.example.com, msg syslogd: kernel boot file is /boot/kernel/kernel
Logging to FILE /var/log/messages
syslogd: kernel boot file is /boot/kernel/kernel
cvthname(192.168.1.10)
validate: dgram from IP 192.168.1.10, port 514, name logclient.example.com;
rejected in rule 0 due to name mismatch.</pre><p>Het is duidelijk dat de berichten worden geweigerd wegens
	een niet-overeenkomende naam.  Na de configuratie grondig te
	hebben herzien, lijkt het of een typefout in de volgende regel
	in <code class="filename">/etc/rc.conf</code> een probleem heeft:</p><pre class="programlisting">syslogd_flags="-d -a logclien.example.com -v -v"</pre><p>De regel dient <code class="literal">logclient</code>, niet
	<code class="literal">logclien</code> te bevatten.  Nadat de juiste
	wijzigingen zijn gemaakt, wordt er herstart met de verwachte
	resultaten:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong>
logmsg: pri 56, flags 4, from logserv.example.com, msg syslogd: restart
syslogd: restarted
logmsg: pri 6, flags 4, from logserv.example.com, msg syslogd: kernel boot file is /boot/kernel/kernel
syslogd: kernel boot file is /boot/kernel/kernel
logmsg: pri 166, flags 17, from logserv.example.com,
msg Dec 10 20:55:02 &lt;syslog.err&gt; logserv.example.com syslogd: exiting on signal 2
cvthname(192.168.1.10)
validate: dgram from IP 192.168.1.10, port 514, name logclient.example.com;
accepted in rule 0.
logmsg: pri 15, flags 0, from logclient.example.com, msg Dec 11 02:01:28 trhodes: Test message 2
Logging to FILE /var/log/logclient.log
Logging to FILE /var/log/messages</pre><p>Nu worden de berichten juist ontvangen en in het correcte
	bestand geplaatst.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87919952"></a>29.11.4. Beveiligingsoverwegingen</h3></div></div></div><p>Zoals bij alle netwerkdiensten, dienen beveiligingseisen in
	acht te worden genomen voordat deze configuratie wordt
	geïmplementeerd.  Soms kunnen logbestanden gevoelige
	gegevens bevatten over diensten die aanstaan op de lokale host,
	gebruikersaccounts, en configuratiegegevens.  Netwerkgegevens
	die van de cliënt naar de server worden verzonden worden
	niet versleuteld noch met een wachtwoord beveiligd.  Als
	versleuteling nodig is, kan <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/stunnel/pkg-descr">security/stunnel</a> worden gebruikt,
	wat gegevens over een versleutelde tunnel verstuurt.</p><p>Aan lokale beveiliging moet ook gedacht worden.
	Logbestanden worden niet versleuteld tijdens gebruik of na
	logrotatie.  Lokale gebruikers kunnen deze bestanden benaderen
	om aanvullende inzichten over de systeemconfiguratie op te doen.
	In deze gevallen is het van kritiek belang om de juiste rechten
	op deze bestanden in te stellen.  Het gereedschap
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> ondersteunt het instellen van rechten op nieuw
	aangemaakte en geroteerde logbestanden.  Het instellen van
	logbestanden op modus <code class="literal">600</code> dient al het
	ongewenste spieken door lokale gebruikers te verhinderen.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-ntp.html">Terug</a> </td><td width="20%" align="center"><a accesskey="u" href="network-servers.html">Omhoog</a></td><td width="40%" align="right"> <a accesskey="n" href="firewalls.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">29.10. Tijd synchroniseren met NTP </td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top"> Hoofdstuk 30. Firewalls</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>