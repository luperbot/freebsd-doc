<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>29.10. Tijd synchroniseren met NTP</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD handboek" /><link rel="up" href="network-servers.html" title="Hoofdstuk 29. Netwerkdiensten" /><link rel="prev" href="network-samba.html" title="29.9. Bestands- en printdiensten voor Microsoft® Windows® cliënten (Samba)" /><link rel="next" href="network-syslogd.html" title="29.11. Hosts op afstand loggen met syslogd" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.10. Tijd synchroniseren met NTP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-samba.html">Terug</a> </td><th width="60%" align="center">Hoofdstuk 29. Netwerkdiensten</th><td width="20%" align="right"> <a accesskey="n" href="network-syslogd.html">Volgende</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ntp"></a>29.10. Tijd synchroniseren met NTP</h2></div><div><span class="authorgroup">Geschreven door <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Hukins</span></span>. </span></div></div></div><a id="idp87776848" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87777360"></a>29.10.1. Overzicht</h3></div></div></div><p>Na verloop van tijd gaat de tijd van een computer meestal
	uit de pas lopen.  Het Netwerk Tijd Protocol (NTP) kan ervoor
	zorgen dat de tijd accuraat blijft.</p><p>Veel diensten op Internet zijn afhankelijk, of hebben veel
	voordeel, van het betrouwbaar zijn van de tijd.  Zo ontvangt een
	webserver bijvoorbeeld veel verzoeken om een bestand te sturen
	als dat gewijzigd is sinds een bepaald moment.  In een
	LAN-omgeving is het van groot belang dat computers die bestanden
	delen van eenzelfde server gesynchroniseerde tijd hebben zodat
	de tijdstempels consistent blijven.  Diensten zoals <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>
	zijn ook afhankelijk van een betrouwbare systeemtijd om
	commando's op het ingestelde moment uit te voeren.</p><a id="idp87779536" class="indexterm"></a><p>Bij FreeBSD zit de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> <acronym class="acronym">NTP</acronym> server die gebruikt kan worden om bij
	andere <acronym class="acronym">NTP</acronym> servers de tijd op
	te vragen om de eigen klok gelijk te zetten of om de juiste tijd
	te verstrekken aan andere apparaten.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87787344"></a>29.10.2. Passende NTP-servers kiezen</h3></div></div></div><a id="idp87787984" class="indexterm"></a><p>Om de tijd te synchroniseren moeten er één of
	meer <acronym class="acronym">NTP</acronym>-servers
	beschikbaar zijn.  Een lokale systeembeheerder of een ISP heeft
	wellicht een NTP-server voor dit doel opgezet.  Het is
	verstandig om documentatie te raadplegen en te bekijken of dat
	het geval is.  Er is een <a class="link" href="http://support.ntp.org/bin/view/Servers/WebHome" target="_top">online lijst
	van publiek toegankelijke NTP-servers</a> waarop een
	NTP-server gezocht kan worden die in geografische zin dichtbij
	een te synchroniseren computer ligt.  Het is belangrijk te
	voldoen aan het beleid voor de betreffende server en toestemming
	te vragen als dat in de voorwaarden staat.</p><p>Het is verstandig meerdere, niet van elkaar afhankelijke,
	NTP-servers te kiezen voor het geval een van de servers niet
	langer betrouwbaar is of niet bereikbaar is.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a>
	gebruikt de antwoorden die van andere servers ontvangen worden
	op intelligente wijze: betrouwbare servers krijgen voorrang
	boven onbetrouwbare servers.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87791824"></a>29.10.3. Machine instellen</h3></div></div></div><a id="idp87792464" class="indexterm"></a><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87793616"></a>29.10.3.1. Basisinstellingen</h4></div></div></div><a id="idp87798480" class="indexterm"></a><p>Als het alleen de bedoeling is de tijd te synchroniseren
	  bij het opstarten van een machine, dan kan <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a>
	  gebruikt worden.  Dit kan van toepassing zijn op desktops die
	  regelmatig herstart worden en niet echt regelmatig
	  gesynchroniseerd hoeven te worden.  Op sommige machines hoort
	  echter <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> te draaien.</p><p>Het gebruik van <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> bij het opstarten is ook
	  een goed idee voor machines waarop <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> draait.  De
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> wijzigt de tijd geleidelijk, terwijl
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> gewoon de tijd instelt, hoe groot het verschil
	  tussen de bestaande tijd van een machine en de correcte tijd
	  ook is.</p><p>Om <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> tijdens het opstarten in te schakelen
	  kan <code class="literal">ntpdate_enable="YES"</code> aan
	  <code class="filename">/etc/rc.conf</code> worden toegevoegd.  Alle
	  voor de synchronisatie te gebruiken servers moeten dan, samen
	  met eventuele opties voor <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a>, in
	  <code class="varname">ntpdate_flags</code> aangegeven worden.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87807952"></a>29.10.3.2. Algemene instellingen</h4></div></div></div><a id="idp87808592" class="indexterm"></a><p>NTP wordt ingesteld met het bestand
	  <code class="filename">/etc/ntp.conf</code> in het formaat dat
	  beschreven staat in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a>.  Hieronder volgt een
	  eenvoudig voorbeeld:</p><pre class="programlisting">server ntplocal.example.com prefer
server timeserver.example.org
server ntp2a.example.net

driftfile /var/db/ntp.drift</pre><p>De optie <code class="literal">server</code> geeft aan welke servers
	  er gebruikt moeten worden, met op elke regel een server.  Als
	  de server wordt ingesteld met het argument
	  <code class="literal">prefer</code>, zoals bij <code class="systemitem">ntplocal.example.com</code>, dan krijgt die
	  server de voorkeur boven de andere.  Een antwoord van een
	  voorkeursserver wordt genegeerd als dat significant afwijkt
	  van de antwoorden van de andere servers.  In andere gevallen
	  wordt het gebruikt zonder rekening te houden met de andere
	  antwoorden.  Het argument <code class="literal">prefer</code> wordt
	  meestal gebruikt voor NTP-servers waarvan bekend is dat ze erg
	  betrouwbaar zijn, zoals die met speciale
	  tijdbewakingshardware.</p><p>De optie <code class="literal">driftfile</code> geeft aan welk
	  bestand gebruikt wordt om de offset van de klokfrequentie van
	  het systeem op te slaan.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> gebruikt die om
	  automatisch te compenseren voor het natuurlijke afwijken van
	  de tijd, zodat er zelfs bij gebrek aan externe bronnen een
	  redelijke accurate tijdsinstelling mogelijk is.</p><p>De optie <code class="literal">driftfile</code> geeft aan welk
	  bestand gebruikt wordt om informatie over eerdere antwoorden
	  van NTP-servers die gebruikt worden op te slaan.  Dit bestand
	  bevat interne informatie voor NTP.  Het hoort niet door andere
	  processen gewijzigd te worden.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87816400"></a>29.10.3.3. Toegang tot een server instellen</h4></div></div></div><p>Een NTP-server is standaard toegankelijk voor alle hosts
	  op een netwerk.  De optie <code class="literal">restrict</code> in
	  <code class="filename">/etc/ntp.conf</code> maakt het mogelijk om aan
	  te geven welke machines de dienst mogen benaderen.</p><p>Voor het blokkeren van toegang voor alle andere machines
	  kan de volgende regel aan <code class="filename">/etc/ntp.conf</code>
	  toegevoegd worden:</p><pre class="programlisting">restrict default ignore</pre><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Dit zal ook toegang van uw server naar alle servers die
	    vermeld staan in uw lokale configuratie verhinderen.  Als u
	    uw NTP-server moet synchroniseren met een externe
	    NTP-server, dient u deze specifieke server toe te staan.
	    Lees de handleiding voor <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a> voor meer
	    informatie.</p></div><p>Om alleen machines op bijvoorbeeld het lokale netwerk toe
	  te staan hun tijd te synchroniseren met een server, maar ze
	  tegelijkertijd niet toe te staan om de server te draaien of de
	  server als referentie voor synchronisatie te gebruiken, kan de
	  volgende regel toegevoegd worden:</p><pre class="programlisting">restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</pre><p>Hierboven is <code class="systemitem">192.168.1.0</code>
	  een IP-adres op een LAN en <code class="systemitem">255.255.255.0</code> is het bijbehorende
	  netwerkmasker.</p><p><code class="filename">/etc/ntp.conf</code> mag meerdere regels met
	  <code class="literal">restrict</code> bevatten.  Meer details staan in
	  het onderdeel <code class="literal">Access Control Support</code> van
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87833808"></a>29.10.4. De NTP-server draaien</h3></div></div></div><p>De NTP-server kan bij het opstarten gestart worden door de
	regel <code class="literal">ntpd_enable="YES"</code> aan
	<code class="filename">/etc/rc.conf</code> toe te voegen.  Om extra
	opties aan <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> mee te geven kan de parameter
	<code class="varname">ntpd_flags</code> in
	<code class="filename">/etc/rc.conf</code> gebruikt worden.</p><p>Om de server zonder een herstart van de machine te starten
	kan <code class="command">ntpd</code> uitgevoerd worden, met toevoeging
	van de parameters uit <code class="varname">ntpd_flags</code> in
	<code class="filename">/etc/rc.conf</code>.  Bijvoorbeeld:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ntpd -p /var/run/ntpd.pid</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87839824"></a>29.10.5. <span class="application">ntpd</span> gebruiken met een tijdelijke
	Internetverbinding</h3></div></div></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> heeft geen permanente verbinding met een
	netwerk nodig om goed te werken.  Maar als er gebruik gemaakt
	wordt van een inbelverbinding, is het wellicht verstandig om
	ervoor te zorgen dat uitgaande NTP-verzoeken geen uitgaande
	verbinding kunnen starten.  Als er gebruik gemaakt wordt van
	gebruikers-PPP, kunnen er <code class="literal">filter</code> commando's
	ingesteld worden in <code class="filename">/etc/ppp/ppp.conf</code>.
	Bijvoorbeeld:</p><pre class="programlisting">set filter dial 0 deny udp src eq 123
# NTP-verkeer zorgt niet voor uitbellen
set filter dial 1 permit 0 0
set filter alive 0 deny udp src eq 123
# Inkomend NTP-verkeer houdt de verbinding niet open
set filter alive 1 deny udp dst eq 123
# Uitgaand NTP-verkeer houdt de verbinding niet open
set filter alive 2 permit 0/0 0/0</pre><p>Meer details staan in de sectie <code class="literal">PACKET
	  FILTERING</code> in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> en in de voorbeelden in
	<code class="filename">/usr/share/examples/ppp/</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Sommige Internetproviders blokkeren lage poorten, waardoor
	  NTP niet kan werken omdat er nooit een antwoord ontvangen kan
	  worden door een machine.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87845712"></a>29.10.6. Meer informatie</h3></div></div></div><p>HTML-documentatie voor de NTP-server staat in
	<code class="filename">/usr/share/doc/ntp/</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-samba.html">Terug</a> </td><td width="20%" align="center"><a accesskey="u" href="network-servers.html">Omhoog</a></td><td width="40%" align="right"> <a accesskey="n" href="network-syslogd.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">29.9. Bestands- en printdiensten voor <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>®
      cliënten (Samba) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top"> 29.11. Hosts op afstand loggen met
      <code class="command">syslogd</code></td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>