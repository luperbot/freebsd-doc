<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>15.7. Kerberos5</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD handboek" /><link rel="up" href="security.html" title="Hoofdstuk 15. Beveiliging" /><link rel="prev" href="tcpwrappers.html" title="15.6. TCP Wrappers" /><link rel="next" href="openssl.html" title="15.8. OpenSSL" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">15.7. <span class="application">Kerberos5</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="tcpwrappers.html">Terug</a> </td><th width="60%" align="center">Hoofdstuk 15. Beveiliging</th><td width="20%" align="right"> <a accesskey="n" href="openssl.html">Volgende</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kerberos5"></a>15.7. <span class="application">Kerberos5</span></h2></div><div><span class="authorgroup">Bijgedragen door <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tillman</span> <span class="surname">Hodgson</span></span>. </span></div><div><span class="authorgroup">Gebaseerd op een bijdrage van <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Mark</span> <span class="surname">Murray</span></span>. </span></div></div></div><p><span class="application">Kerberos</span> is een netwerkdienst,
      protocol en systeem waarmee gebruikers zich kunnen aanmelden
      met behulp van een dienst op een veilige server.  Diensten als
      op een andere server aanmelden, op afstand kopiëren, veilig
      tussen systemen kopiëren en andere taken met een hoog risico
      worden aanmerkelijk veiliger en beter controleerbaar.</p><p><span class="application">Kerberos</span> kan omschrijven worden
      als identiteitbevestigend proxy systeem.  Het kan ook
      omschreven worden als een vertrouwd autenticatiesysteem van een
      derde partij.  <span class="application">Kerberos</span> vervult maar
      één taak: het veilig autenticeren van gebruikers
      op het netwerk.  Het vervult geen autorisatietaken (wat
      gebruikers mogen) en controleert ook niets (wat gebruikers hebben
      gedaan).  Nadat een cliënt en server
      <span class="application">Kerberos</span> hebben gebruikt om hun
      identiteit vast te stellen kunnen ze ook al hun communicatie
      coderen om hun privacy en gegevensintegriteit te garanderen.</p><p>Daarom wordt het sterk aangeraden om
      <span class="application">Kerberos</span> samen met andere
      beveiligingsmechanismen te gebruiken die autorisatie en
      controlemogelijkheden bieden.</p><p>De aanwijzingen die nu volgen kunnen gebruikt worden als
      werkinstructie om <span class="application">Kerberos</span> in te
      stellen zoals dat wordt meegeleverd met FreeBSD.  Een complete
      beschrijving staat in de handleiding.</p><p>Voor demonstratie van de installatie van
      <span class="application">Kerberos</span> wordt gebruik gemaakt van de
      volgende naamgeving:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Het <acronym class="acronym">DNS</acronym> domein (<span class="quote">&#8220;<span class="quote">zone</span>&#8221;</span>)
	  is example.org.</p></li><li class="listitem"><p>De <span class="application">Kerberos</span> wereld is
	  EXAMPLE.ORG.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Het advies is voor installaties van
	<span class="application">Kerberos</span> echte domeinnamen te
	gebruiken, zelfs als het alleen intern wordt gebruikt.  Hiermee
	worden <acronym class="acronym">DNS</acronym> problemen voorkomen is een
	goede samenwerking met andere
	<span class="application">Kerberos</span> werelden verzekerd.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77338320"></a>15.7.1. Geschiedenis</h3></div></div></div><a id="idp77338960" class="indexterm"></a><p><span class="application">Kerberos</span> is ontworpen door
	<acronym class="acronym">MIT</acronym> als oplossing voor
	netwerkbeveiligingsproblemen.  Het
	<span class="application">Kerberos</span> protocol gebruikt sterke
	codering zodat een cliënt zijn identiteit kan bewijzen aan
	een server (en andersom) over een onveilige
	netwerkverbinding.</p><p><span class="application">Kerberos</span> is zowel de naam van
	een netwerkautorisatieprotocol als een bijvoeglijk naamwoord om
	de programma's te beschrijven die gebruik maken van het
	programma (zoals <span class="application">Kerberos</span> telnet).
	De huidige versie van het protocol is versie 5 en is beschreven
	in <acronym class="acronym">RFC</acronym> 1510.</p><p>Er zijn een aantal vrij beschikbare implementaties van dit
	protocol beschikbaar voor veel systemen.  Het Massachusetts
	Institute of Technology (<acronym class="acronym">MIT</acronym>), waar
	<span class="application">Kerberos</span> ooit is ontwikkeld,
	ontwikkelt nog steeds door aan hun
	<span class="application">Kerberos</span> pakket.  Het wordt in de
	<acronym class="acronym">VS</acronym> veel gebruikt als coderingspakket en
	daarom wordt het ook geraakt door de exportwetgeving van de
	<acronym class="acronym">VS</acronym>.  <span class="application">Kerberos</span>
	van <acronym class="acronym">MIT</acronym> is beschikbaar als port
	(<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/krb5/pkg-descr">security/krb5</a>).  Heimdal
	<span class="application">Kerberos</span> is een andere implementatie
	van versie 5 die expliciet buiten de <acronym class="acronym">VS</acronym> is
	ontwikkeld om de exportwetgeving de omzeilen (en wordt daarom
	vaak gebruikt in niet-commerciële <span class="trademark">UNIX</span>® varianten).  De
	Heimdal <span class="application">Kerberos</span> distributie is
	beschikbaar als port (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/heimdal/pkg-descr">security/heimdal</a>) en er zit een
	minimale installatie in de basisinstallatie van FreeBSD.</p><p>Om het grootst mogelijke publiek te bereiken gaan deze
	instructies ervan uit dat de Heimdal distributie die bij FreeBSD
	zit wordt gebruikt.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77353168"></a>15.7.2. Opzetten van een Heimdal <acronym class="acronym">KDC</acronym></h3></div></div></div><a id="idp77354192" class="indexterm"></a><p>Het Sleutel Distributie Centrum (<acronym class="acronym">KDC</acronym>,
	voluit <span class="quote">&#8220;<span class="quote">Key Distribution Center</span>&#8221;</span>) is de
	gecentraliseerde autenticatiedienst die
	<span class="application">Kerberos</span> levert.  Het is de computer
	die <span class="application">Kerberos</span> tickets uitgeeft.  Het
	<acronym class="acronym">KDC</acronym> wordt <span class="quote">&#8220;<span class="quote">vertrouwd</span>&#8221;</span> door
	alle andere computer in de <span class="application">Kerberos</span>
	wereld en daarom dient er een strenger beveiligingsregime op
	van kracht te zijn.</p><p>Hoewel het draaien van de
	<span class="application">Kerberos</span> dienst erg weinig van een
	systeem vraagt, wordt het wel aangeraden om een machine in te
	richten exclusief voor het <acronym class="acronym">KDC</acronym> om
	beveiligingsredenen.</p><p>Het opzetten van een <acronym class="acronym">KDC</acronym> begint met de
	controle of de instellingen in
	<code class="filename">/etc/rc.conf</code> juist zijn om te functioneren
	als <acronym class="acronym">KDC</acronym> (misschien moeten paden veranderd
	worden voor een eigen systeem):</p><pre class="programlisting">kerberos5_server_enable="YES"
kadmind5_server_enable="YES"</pre><p>Daarna wordt het
	<span class="application">Kerberos</span>-instellingenbestand
	<code class="filename">/etc/krb5.conf</code> aangemaakt:</p><pre class="programlisting">[libdefaults]
    default_realm = EXAMPLE.ORG
[realms]
    EXAMPLE.ORG = {
        kdc = kerberos.example.org
        admin_server = kerberos.example.org
    }
[domain_realm]
    .example.org = EXAMPLE.ORG</pre><p><code class="filename">/etc/krb5.conf</code> gaat ervan uit dat de
	<acronym class="acronym">KDC</acronym> de volledig gekwalificeerde hostnaam <code class="systemitem">kerberos.example.org</code> heeft.  Als de
	<acronym class="acronym">KDC</acronym> een andere hostnaam heeft, moet er nog
	een CNAME (alias) toegevoegd aan de zonefile.</p><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Voor grotere netwerken met een juist ingestelde
	  <acronym class="acronym">BIND</acronym> <acronym class="acronym">DNS</acronym> server kan
	  het bovenstaande voorbeeld ingekort worden tot:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">[libdefaults]
      default_realm = EXAMPLE.ORG</pre><p xmlns="http://www.w3.org/1999/xhtml">Door de volgende regels toe te voegen aan het
	    zonebestand voor <code class="systemitem">example.org</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">_kerberos._udp      IN  SRV     01 00 88 kerberos.example.org.
_kerberos._tcp      IN  SRV     01 00 88 kerberos.example.org.
_kpasswd._udp       IN  SRV     01 00 464 kerberos.example.org.
_kerberos-adm._tcp  IN  SRV     01 00 749 kerberos.example.org.
_kerberos           IN  TXT     EXAMPLE.ORG</pre></div><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Om cliënten de
	  <span class="application">Kerberos</span>-diensten te kunnen laten
	  vinden, <span class="emphasis"><em>moet</em></span> er een volledig ingestelde
	  <code class="filename">/etc/krb5.conf</code> zijn of een minimaal
	  ingestelde <code class="filename">/etc/krb5.conf</code>
	  <span class="emphasis"><em>en</em></span> een correct ingestelde DNS-server.</p></div><p>Nu wordt de <span class="application">Kerberos</span>
	database aangemaakt.  Deze database bevat de sleutels voor
	alle principals en zijn versleuteld met een hoofdwachtwoord.
	Dit wachtwoord hoeft niet onthouden te worden omdat het wordt
	opgeslagen in (<code class="filename">/var/heimdal/m-key</code>).  De
	hoofdsleutel wordt aangemaakt door <code class="command">kstash</code>
	te starten en een wachtwoord in te voeren.</p><p>Als de hoofdsleutel is gemaakt, kan de database
	ingeschakeld worden met <code class="command">kadmin</code>
	met de optie <code class="literal">-l</code> (die staat voor
	<span class="quote">&#8220;<span class="quote">local</span>&#8221;</span>).  Deze optie geeft
	<code class="command">kadmin</code> de opdracht om de databasebestanden
	direct te wijzigingen in plaats van via de
	<code class="command">kadmind</code> netwerkdienst.  Hiermee wordt het
	kip-ei-probleem opgelost waarbij een verbinding wordt gemaakt
	met de database voordat hij bestaat.  Op het prompt van
	<code class="command">kadmin</code> kan met <code class="command">init</code>
	de database met de werelden aangemaakt worden.</p><p>Tenslotte, nog steeds in <code class="command">kadmin</code>, kan
	de eerste principal gemaakt worden met
	<code class="command">add</code>.  De standaardopties voor de principal
	worden nu aangehouden.  Deze kunnen later altijd
	nog gewijzigd worden met <code class="command">modify</code>.  Met
	het commando <code class="literal">?</code> kunnen alle beschikbare
	mogelijkheden getoond worden.</p><p>Hieronder een sessie waarin een voorbeelddatabase wordt
	aangemaakt:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kstash</code></strong>
Master key: <strong class="userinput"><code>xxxxxxxx</code></strong>
Verifying password - Master key: <strong class="userinput"><code>xxxxxxxx</code></strong>

<code class="prompt">#</code> <strong class="userinput"><code>kadmin -l</code></strong>
kadmin&gt; <strong class="userinput"><code>init EXAMPLE.ORG</code></strong>
Realm max ticket life [unlimited]:
kadmin&gt; <strong class="userinput"><code>add tillman</code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Attributes []:
Password: <strong class="userinput"><code>xxxxxxxx</code></strong>
Verifying password - Password: <strong class="userinput"><code>xxxxxxxx</code></strong></pre><p>Nu kan de <acronym class="acronym">KDC</acronym> dienst gestart worden
	met <code class="command">service kerberos start</code> en
	<code class="command">service kadmind start</code>.  Op dit moment
	draait er nog geen enkele daemon die gebruik maakt van
	<span class="application">Kerberos</span>.  Bevestiging dat
	<acronym class="acronym">KDC</acronym> draait is te krijgen door een ticket te
	vragen en dat uit te lezen voor de principal (gebruiker)
	die zojuist is aangemaakt vanaf de commandoregel van het
	<acronym class="acronym">KDC</acronym> zelf:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>kinit tillman</code></strong>
tillman@EXAMPLE.ORG's Password:

<code class="prompt">%</code> <strong class="userinput"><code>klist</code></strong>
Credentials cache: FILE:<code class="filename">/tmp/krb5cc_500</code>
	Principal: tillman@EXAMPLE.ORG

  Issued           Expires          Principal
Aug 27 15:37:58  Aug 28 01:37:58  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG</pre><p>Het ticket kan worden ingenomen wanneer u klaar bent:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>kdestroy</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77396944"></a>15.7.3. <span class="application">Kerberos</span> inschakelen op een
	server met Heimdal diensten</h3></div></div></div><a id="idp77397840" class="indexterm"></a><p>Als eerste is een kopie van het instellingenbestand van
	<span class="application">Kerberos</span> nodig,
	<code class="filename">/etc/krb5.conf</code>.  Dit bestand kan
	eenvoudigweg op een veilige manier (met netwerkprogramma's
	als <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a>, of fysiek via een floppy) naar de
	cliëntcomputer gekopieerd worden vanaf de
	<acronym class="acronym">KDC</acronym>.</p><p>Hierna is het <code class="filename">/etc/krb5.keytab</code>
	nodig.  Dit is het belangrijkste verschil tussen een server
	die een daemons met <span class="application">Kerberos</span>
	aanbiedt en een werkstation: de server heeft het bestand
	<code class="filename">keytab</code> nodig.  Dit bestand bevat de
	hostsleutel van de server waardoor het werkstation en de
	<acronym class="acronym">KDC</acronym> elkaars identiteit kunnen bevestigen.
	Dit bestand dient veilig overgebracht te worden omdat de
	beveiliging van de server doorbroken kan worden als de
	sleutel openbaar wordt gemaakt.  Dit betekent expliciet dat
	overdracht via een protocol dat platte tekst gebruikt,
	bijvoorbeeld <acronym class="acronym">FTP</acronym>, een slecht idee is.</p><p>Meestal wordt <code class="filename">keytab</code> naar de
	server gebracht met <code class="command">kadmin</code>.  Dat
	werkt handig omdat ook de host principal (het
	<acronym class="acronym">KDC</acronym> onderdeel van
	<code class="filename">krb5.keytab</code>) aangemaakt moet
	worden met <code class="command">kadmin</code>.</p><p>Let wel op dat er al een ticket moet zijn en dat dit
	ticket de <code class="command">kadmin</code> interface moet mogen
	gebruiken in <code class="filename">kadmind.acl</code>.  Zie
	<span class="quote">&#8220;<span class="quote">Beheer op Afstand</span>&#8221;</span> in de Heimdal
	informatiepagina's (<code class="command">info heimdal</code>) voor
	details over het ontwerpen van toegangscontrole.  Als
	<code class="command">kadmin</code> via het netwerk geen toegang mag
	hebben, dan kan ook op een veilige verbinding gemaakt worden
	met de <acronym class="acronym">KDC</acronym> (via het lokale console,
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> of <span class="application">Kerberos</span>
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnet&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">telnet</span>(1)</span></a>) zodat alles lokaal uitgevoerd kan worden met
	<code class="command">kadmin -l</code>.</p><p>Na het installeren van
	<code class="filename">/etc/krb5.conf</code> kan
	<code class="command">kadmin</code> van de
	<span class="application">Kerberos</span> server gebruikt worden.
	Met <code class="command">add --random-key</code> kan de host
	principal toegevoegd worden en met <code class="command">ext</code> kan
	de host principal van de server naar zijn eigen keytab
	getrokken worden.  Bijvoorbeeld:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt;<strong class="userinput"><code> add --random-key host/myserver.example.org</code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Attributes []:
kadmin&gt;<strong class="userinput"><code> ext host/myserver.example.org</code></strong>
kadmin&gt;<strong class="userinput"><code> exit</code></strong></pre><p>Let op: <code class="command">ext</code> slaat de sleutel standaard
	op in <code class="filename">/etc/krb5.keytab</code>.</p><p>Als <code class="command">kadmind</code> niet beschikbaar is op de
	<acronym class="acronym">KDC</acronym> (wellicht om beveiligingsredenen) en
	er via het netwerk dus geen toegang is tot
	<code class="command">kadmin</code>, dan kan de host principal
	(<code class="systemitem">host/myserver.EXAMPLE.ORG</code>) ook direct
	aan de <acronym class="acronym">KDC</acronym> toegevoegd worden en daarna in
	een tijdelijk bestand gezet worden.  Het volgende kan
	gebruikt worden om te voorkomen dat
	<code class="filename">/etc/krb5.keytab</code> op de
	<acronym class="acronym">KDC</acronym>) wordt overschreven:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt;<strong class="userinput"><code> ext --keytab=/tmp/example.keytab host/myserver.example.org</code></strong>
kadmin&gt;<strong class="userinput"><code> exit</code></strong></pre><p>Hierna kan de keytab veilig gekopieerd worden naar de
	server (met <code class="command">scp</code> of een floppy).  Geef
	een niet-standaard naam op voor de keytab om te voorkomen
	dat de keytab op de <acronym class="acronym">KDC</acronym> wordt
	overschreven.</p><p>Nu kan de server communiceren met de
	<acronym class="acronym">KDC</acronym> (vanweg
	<code class="filename">krb5.conf</code>) en zijn identiteit bewijzen
	(vanwege <code class="filename">krb5.keytab</code>).  Nu is de server
	klaar om er een aantal <span class="application">Kerberos</span>
	diensten op te activeren.  In dit voorbeeld wordt de dienst
	<code class="command">telnet</code> geactiveerd door de volgende regel
	in <code class="filename">/etc/inetd.conf</code> te zetten en dan
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> te herstarten met
	<code class="command">service inetd restart</code>:</p><pre class="programlisting">telnet    stream  tcp     nowait  root    /usr/libexec/telnetd  telnetd -a user</pre><p>Het belangrijkste is dat de typering
	<code class="command">-a</code> (van autenticatie) op user staat.  Meer
	details zijn in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">telnetd</span>(8)</span></a> te vinden.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77441232"></a>15.7.4. <span class="application">Kerberos</span> activeren op een
	cliënt met Heimdal</h3></div></div></div><a id="idp77442128" class="indexterm"></a><p>Het opzetten van een cliëntcomputer is eigenlijk
	kinderlijk eenvoudig.  Wat betreft de
	<span class="application">Kerberos</span> instelling is alleen het
	<span class="application">Kerberos</span> instellingenbestand
	(<code class="filename">/etc/krb5.conf</code>) nodig.  Dat kan
	eenvoudigweg naar de cliëntcomputer gekopieerd worden
	vanaf de <acronym class="acronym">KDC</acronym>.</p><p>Test de cliënt met <code class="command">kinit</code>,
	<code class="command">klist</code> en <code class="command">kdestroy</code>
	vanaf de cliënt om een ticket te krijgen, te bekijken en
	daarna te verwijderen voor de principal die hierboven is
	aangemaakt.  Nu moeten ook
	<span class="application">Kerberos</span> applicaties gebruikt
	kunnen worden om verbindingen te maken met servers waarop
	<span class="application">Kerberos</span> is geactiveerd.  Als dat
	niet lukt en het verkrijgen van een ticket is wel mogelijk,
	dan ligt dat hoogstwaarschijnlijk aan de server en niet aan
	de cliënt of de <acronym class="acronym">KDC</acronym>.</p><p>Bij het testen van een applicatie als
	<code class="command">telnet</code> kan het beste een pakketsnuffelaar
	(bijvoorbeeld <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a>) gebruikt worden om te bevestigen dat
	een wachtwoord niet als tekst wordt verzonden.  Gebruik
	<code class="command">telnet</code> met de optie <code class="literal">-x</code>.
	Dan wordt de complete gegevensstroom versleuteld (vergelijkbaar
	met <code class="command">ssh</code>).</p><p>Er worden standaard ook andere
	<span class="application">Kerberos</span> applicaties op de
	cliënt geïnstalleerd.  Hier komt de
	<span class="quote">&#8220;<span class="quote">minimalistische</span>&#8221;</span> natuur van de basisinstallatie
	van Heimdal boven drijven: <code class="command">telnet</code> is
	de enige dienst waarvoor <span class="application">Kerberos</span>
	geactiveerd is.</p><p>De port Heimdal voegt een aantal ontbrekende
	cliëntapplicaties toe: versies met ondersteuning voor
	<span class="application">Kerberos</span> van
	<code class="command">ftp</code>, <code class="command">rsh</code>,
	<code class="command">rcp</code>, <code class="command">rlogin</code> en een paar
	minder gebruikelijke programma's.  De <acronym class="acronym">MIT</acronym>
	port bevat ook een volledig gamma aan
	<span class="application">Kerberos</span> cliëntapplicaties.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77464272"></a>15.7.5. Instellingenbestanden voor gebruikers:
	<code class="filename">.k5login</code> en
	<code class="filename">.k5users</code></h3></div></div></div><a id="idp77465552" class="indexterm"></a><a id="idp77466192" class="indexterm"></a><p>Voor gebruikers binnen een wereld wijst hun
	<span class="application">Kerberos</span> principal (bv.
	<code class="systemitem">tillman@EXAMPLE.ORG</code>) gewoonlijk naar
	een lokale gebruikersaccount (bijvoorbeeld een lokale account
	met de naam <code class="systemitem">tillman</code>).  Voor
	cliëntapplicaties als <code class="command">telnet</code> is
	gewoonlijk geen gebruikersnaam of principal nodig.</p><p>Soms moet iemand zonder bijpassende
	<span class="application">Kerberos</span> principal toch toegang
	hebben tot een lokale gebruikersaccount.
	<code class="systemitem">tillman@EXAMPLE.ORG</code> zou bijvoorbeeld
	toegang nodig kunnen hebben tot de lokale gebruikersaccount
	<code class="systemitem">webdevelopers</code>.  Andere principals zouden
	die toegang wellicht ook nodig kunnen hebben.</p><p>De bestanden <code class="filename">.k5login</code> en
	<code class="filename">.k5users</code> uit de gebruikersmap kunnen op
	eenzelfde manier gebruikt worden als
	<code class="filename">.hosts</code> en <code class="filename">.rhosts</code>.
	Zo wordt het voorgaande probleem opgelost.  Als bijvoorbeeld
	een <code class="filename">.k5login</code> met de volgende
	inhoud:</p><pre class="screen">tillman@example.org
jdoe@example.org</pre><p>in de thuismap van de lokale gebruiker
	<code class="systemitem">webdevelopers</code> gezet wordt dan zouden
	beide principals toegang hebben tot die account zonder dat
	ze een wachtwoord hoeven te delen.</p><p>We raden aan de handleidingen voor deze commando's
	te lezen.  Let op dat de <code class="command">ksu</code> handleiding
	<code class="filename">.k5users</code> behandelt.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77475920"></a>15.7.6. <span class="application">Kerberos</span> tips, trucs en
	problemen oplossen</h3></div></div></div><a id="idp77476816" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Als de Heimdal of <acronym class="acronym">MIT</acronym>
	    <span class="application">Kerberos</span> port wordt gebruikt
	    dan dient de <code class="envar">PATH</code> omgevingsvariabele
	    de <span class="application">Kerberos</span> versies van de
	    cliëntapplicaties te tonen voor de systeemversies.</p></li><li class="listitem"><p>Hebben alle computers in de wereld hun tijd
	    gesynchroniseerd?  Als dat niet zo is, dan slaagt de
	    autenticatie wellicht niet.
	    <a class="xref" href="network-ntp.html" title="29.10. Tijd synchroniseren met NTP">Paragraaf 29.10, &#8220;Tijd synchroniseren met NTP&#8221;</a> beschrijft hoe klokken
	    met <acronym class="acronym">NTP</acronym> gesynchroniseerd kunnen
	    worden.</p></li><li class="listitem"><p><acronym class="acronym">MIT</acronym> en Heimdal werken prima samen.
	    Dit geldt niet voor <code class="command">kadmin</code> omdat
	    daarvoor geen protocolstandaard is.</p></li><li class="listitem"><p>Als een hostnaam wordt gewijzigd, dan moet ook de
	    <code class="systemitem">host/</code> principal aangepast en de
	    keytab.  Dit geldt ook voor bijzondere instellingen
	    in de keytab zoals de <code class="systemitem">www/</code> principal
	    voor <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/mod_auth_kerb/pkg-descr">www/mod_auth_kerb</a> van
	    Apache.</p></li><li class="listitem"><p>Alle hosts in een wereld moeten oplosbaar
	    (resolvable) zijn (zowel vooruit als achteruit) in de
	    <acronym class="acronym">DNS</acronym> (of tenminste in
	    <code class="filename">/etc/hosts</code>).  CNAMEs werken wel,
	    maar de A en PTR records moeten juist en actief zijn.  De
	    foutmelding is niet erg duidelijk: <span class="errorname">Kerberos5
	      refuses authentication because Read req failed: Key table
	      entry not found</span>.</p></li><li class="listitem"><p>Sommige besturingssystemen van cliënten voor een
	    <acronym class="acronym">KDC</acronym> zetten wellicht geen setuid
	    <code class="systemitem">root</code> voor <code class="command">ksu</code>.
	    Dit betekent dat <code class="command">ksu</code> niet werkt.  Dat
	    is vanuit beveiligingsoogpunt een prima idee, maar wel
	    lastig.  Dit is dus geen <acronym class="acronym">KDC</acronym>-fout.</p></li><li class="listitem"><p>Als met <acronym class="acronym">MIT</acronym>
	    <span class="application">Kerberos</span> een principal een
	    ticket moet krijgen dat langer geldig is dan de standaard
	    van tien uur, dan moet
	    <code class="command">modify_principal</code> in
	    <code class="command">kadmin</code> gebruikt worden om de maximale
	    geldigheidsduur (maxlife) van zowel de principal waar het
	    om gaat als de <code class="systemitem">krbtgt</code> principal aan
	    te passen.  Dan kan de principal <code class="command">kinit</code>
	    <code class="literal">-l</code> gebruiken om een ticket met een
	    langere levensduur aan te vragen.</p></li><li class="listitem"><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Als een pakketsnuffelaar op de
	      <acronym class="acronym">KDC</acronym> draait bij om te helpen bij het
	      oplossen van problemen en dan <code class="command">kinit</code>
	      vanaf een werkstation wordt gestart, dan wordt zichtbaar
	      dat de <acronym class="acronym">TGT</acronym> meteen wordt verstuurd als
	      <code class="command">kinit</code> start, zelfs nog voor het
	      wachtwoord!  De reden hiervoor is dat de
	      <span class="application">Kerberos</span> server vrijelijk een
	      <acronym class="acronym">TGT</acronym> (Ticket Granting
	      Ticket) verstuurt op iedere niet geautoriseerd verzoek.
	      Maar iedere <acronym class="acronym">TGT</acronym> is versleuteld met een
	      sleutel die is afgeleid van het wachtwoord van de
	      gebruiker.  Als een gebruiker zijn wachtwoord ingeeft,
	      wordt dat dus niet naar de <acronym class="acronym">KDC</acronym>
	      gezonden, maar ontcijfert het de <acronym class="acronym">TGT</acronym>
	      die <code class="command">kinit</code> al heeft ontvangen.  Als de
	      ontcijfering resulteert in een geldige ticket met een
	      geldige tijdstempel, dan heeft de gebruiker geldige
	      <span class="application">Kerberos</span> rechten.  Deze
	      rechten bevatten ook een sessiesleutel voor het opzetten
	      van beveiligde communicatie met de
	      <span class="application">Kerberos</span> server in de toekomst
	      en de eigenlijke ticket-granting ticket, die is
	      versleuteld met de sleutel van de
	      <span class="application">Kerberos</span> server zelf.  Deze
	      tweede laag van versleuteling is niet bekend voor de
	      gebruiker, maar het stelt de
	      <span class="application">Kerberos</span> server in staat om de
	      juistheid van iedere <acronym class="acronym">TGT</acronym> te
	      bevestigen.</p></div></li><li class="listitem"><p>Als tickets worden gebruik die lang geldig zijn (bv.
	    een week) en <span class="application">OpenSSH</span> wordt
	    gebruikt om een verbinding te maken met de machine waarop
	    het ticket staat, zorg er dan voor dat de
	    <span class="application">Kerberos</span> optie
	    <code class="option">TicketCleanup</code> op <code class="literal">no</code>
	    staat in <code class="filename">sshd_config</code> want anders
	    worden tickets verwijderd bij afmelden.</p></li><li class="listitem"><p>Hostprincipals kunnen ook een langere levensduur
	    hebben.  Als een gebruikers principal een levensduur van
	    een week heeft, maar de host waar de verbinding mee
	    gemaakt wordt heeft een levensduur van negen uur,
	    dan heb staat er een verlopen host principal in de cache
	    en dan werkt een en ander niet zoals verwacht.</p></li><li class="listitem"><p>Een <code class="filename">krb5.dict</code> bestand om het
	    gebruik van bepaalde slechte wachtwoorden te voorkomen
	    (dit wordt kort behandeld in de handleiding voor
	    <code class="command">kadmind</code>) heeft alleen betrekking op
	    principals waar een wachtwoordbeleid voor geldt.  De
	    opmaak van <code class="filename">krb5.dict</code> is eenvoudig:
	    een rij tekens per regel.  Een symbolische link maken naar
	    <code class="filename">/usr/share/dict/words</code> is misschien
	    handig.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77524560"></a>15.7.7. Verschillen met de <acronym class="acronym">MIT</acronym> port</h3></div></div></div><p>Het belangrijkste verschil tussen de
	<acronym class="acronym">MIT</acronym> en Heimdal installatie heeft
	betrekking op <code class="command">kadmin</code>, dat een andere (maar
	gelijkwaardige) set commando's kent en een andere protocol
	gebruikt.  Dit betekent nogal wat als een
	<acronym class="acronym">KDC</acronym> <acronym class="acronym">MIT</acronym> is, omdat
	dan de <code class="command">kadmin</code> van Heimdal niet gebruikt
	kan worden om de <acronym class="acronym">KDC</acronym> vanaf afstand te
	beheren (dat geldt trouwens ook vice versa).</p><p>De cliëntapplicaties kunnen ook commandoregelopties
	gebruiken die een beetje verschillen, maar waarmee wel
	hetzelfde wordt bereikt.  We raden aan de instructies op de
	<acronym class="acronym">MIT</acronym> <span class="application">Kerberos</span>
	website (<code class="uri"><a class="uri" href="http://web.mit.edu/Kerberos/www/" target="_top">http://web.mit.edu/Kerberos/www/</a></code>) te volgen.
	Wees voorzichtig met paden: de <acronym class="acronym">MIT</acronym>-port
	installeert standaard in
	<code class="filename">/usr/local/</code> en dus kunnen de
	<span class="quote">&#8220;<span class="quote">normale</span>&#8221;</span> systeemapplicaties gestart worden in
	plaats van die van <acronym class="acronym">MIT</acronym> als de
	<code class="envar">PATH</code> omgevingsvariabele de systeemmappen als
	eerste weergeeft.</p><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Als de <acronym class="acronym">MIT</acronym>
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/krb5/pkg-descr">security/krb5</a> port die
	  bij FreeBSD zit wordt gebruikt, dan zorgt het lezen van
	  <code class="filename">/usr/local/share/doc/krb5/README.FreeBSD</code>
	  dat bij de port wordt geïnstalleerd voor een beter
	  begrip over waarom het aanmelden via
	  <code class="command">telnetd</code> en <code class="command">klogind</code>
	  soms wat vreemd verloopt.  Als belangrijkste wijzen we erop
	  dat het bij het corrigeren van
	  <span class="quote">&#8220;<span class="quote">onjuiste rechten op het cachebestand</span>&#8221;</span>
	  noodzakelijk is dat het binaire bestand
	  <code class="command">login.krb5</code> wordt gebruikt voor
	  autenticatie zodat het op de juiste wijze eigenaarschap kan
	  wijzigen voor de doorgegeven rechten.</p></div><p>Het bestand <code class="filename">rc.conf</code> moet ook gewijzigd
	worden zodat het de volgende configuratie bevat:</p><pre class="programlisting">kerberos5_server="/usr/local/sbin/krb5kdc"
kadmind5_server="/usr/local/sbin/kadmind"
kerberos5_server_enable="YES"
kadmind5_server_enable="YES"</pre><p>Dit is gedaan omdat de applicaties voor
	<acronym class="acronym">MIT</acronym>-Kerberos binairen in de hiërarchie
	<code class="filename">/usr/local</code> installeren.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77554640"></a>15.7.8. Beperkingen in
	<span class="application">Kerberos</span></h3></div></div></div><a id="idp77555536" class="indexterm"></a><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77556688"></a>15.7.8.1. <span class="application">Kerberos</span> is een alles of
	  niets aanpak</h4></div></div></div><p>Iedere ingeschakelde dienst op het netwerk moet
	  aangepast worden om met <span class="application">Kerberos</span>
	  te werken (of op een andere manier beschermd zijn tegen
	  netwerkaanvallen), want anders kunnen gebruikersrechten
	  worden gestolen en herbruikt.  Een voorbeeld hier van is
	  het inschakelen van <span class="application">Kerberos</span>
	  voor alle shells op afstand (via <code class="command">rsh</code> en
	  <code class="command">telnet</code> bijvoorbeeld), maar de
	  <acronym class="acronym">POP3</acronym> mailserver die wachtwoorden als
	  platte tekst verzend ongemoeid laten.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77560016"></a>15.7.8.2. <span class="application">Kerberos</span> is bedoeld voor
	  werkstations met een gebruiker</h4></div></div></div><p>In een meergebruikersomgeving is
	  <span class="application">Kerberos</span> minder veilig.  Dit
	  komt doordat de tickets worden opgeslagen in de map
	  <code class="filename">/tmp</code>, waar gelezen kan worden
	  door alle gebruikers.  Als een gebruiker een computer deelt met
	  andere gebruikers op hetzelfde moment (dus multi-user), dan
	  is het mogelijk dat een ticket van een gebruiker wordt
	  gestolen (gekopieerd) door een andere gebruiker.</p><p>Dit kan voorkomen worden met de commandoregeloptie
	  <span class="quote">&#8220;<span class="quote"><code class="literal">-c</code> bestandsnaam</span>&#8221;</span> of (bij
	  voorkeur) de omgevingsvariabele <code class="envar">KRB5CCNAME</code>,
	  maar dat wordt zelden gedaan.  In principe kan het opslaan
	  van een ticket in de thuismap van een gebruiker in
	  combinatie met eenvoudige bestandsrechten dit probleem
	  verhelpen.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77563728"></a>15.7.8.3. De KDC is een single point of failure</h4></div></div></div><p>Zoals het is ontworpen, moet de <acronym class="acronym">KDC</acronym>
	  zo goed mogelijk beveiligd zijn, omdat de
	  hoofdwachtwoorddatabase erop staat.  De <acronym class="acronym">KDC</acronym>
	  hoort geen enkele andere dienst aan te bieden en moet ook
	  fysiek afgeschermd worden.  Het gevaar is groot, omdat
	  <span class="application">Kerberos</span> alle wachtwoorden
	  versleutelt met dezelfde sleutel (de <span class="quote">&#8220;<span class="quote">master</span>&#8221;</span>
	  sleutel) die als een bestand op de <acronym class="acronym">KDC</acronym>
	  staat.</p><p>Toch is een gecompromitteerde mastersleutel niet zo'n
	  groot probleem als wellicht wordt verondersteld.  De
	  mastersleutel wordt alleen gebruikt om de
	  <span class="application">Kerberos</span> database te
	  versleutelen en als zaad voor de generator van willekeurige
	  nummers.  Zo lang als de toegang tot de
	  <acronym class="acronym">KDC</acronym> is beveiligd, kan een aanvaller niet
	  echt iets doen met de mastersleutel.</p><p>Als de <acronym class="acronym">KDC</acronym> niet beschikbaar is
	  (misschien door een ontzeggen van dienst aanval of
	  netwerkproblemen) kunnen de netwerkdiensten niet gebruikt
	  worden omdat er geen autenticatie uitgevoerd kan worden;
	  een recept voor een ontzeggen van dienst aanval.  Dit
	  risico kan omzeild worden door meerdere
	  <acronym class="acronym">KDC</acronym>'s (één master en
	  één of meer slaven) en een zorgvuldige
	  implementatie van secundaire of fall-back autenticatie.
	  <acronym class="acronym">PAM</acronym> is hier uitermate geschikt
	  voor.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77569744"></a>15.7.8.4. Tekortkomingen van
	  <span class="application">Kerberos</span></h4></div></div></div><p><span class="application">Kerberos</span> stelt gebruikers,
	  hosts en diensten in staat om elkaar te autenticeren.
	  Maar het heeft geen mechanisme om de <acronym class="acronym">KDC</acronym>
	  te autenticeren aan de gebruikers, hosts of diensten.  Dit
	  betekent dat bijvoorbeeld een vervalste
	  <code class="command">kinit</code> alle gebruikersnamen en
	  wachtwoorden zou kunnen afluisteren.  Iets als
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/tripwire/pkg-descr">security/tripwire</a> of
	  andere controle-instrumenten voor de integriteit van
	  bestandssystemen kunnen hier verlichting brengen.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77577168"></a>15.7.9. Bronnen en verdere informatie</h3></div></div></div><a id="idp77577808" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.faqs.org/faqs/Kerberos-faq/general/preamble.html" target="_top">
	      De <span class="application">Kerberos</span> FAQ</a> (Engels)</p></li><li class="listitem"><p><a class="link" href="http://web.mit.edu/Kerberos/www/dialogue.html" target="_top">Een
	      Autenticatiesysteem Ontwerpen: een Dialoog in Vier Scenes</a>
	    (Engels)</p></li><li class="listitem"><p><a class="link" href="http://www.ietf.org/rfc/rfc1510.txt?number=1510" target="_top">
	      RFC 1510, De <span class="application">Kerberos</span> Netwerk
	      Authenticatie Dienst (V5)</a> (Engels)</p></li><li class="listitem"><p><a class="link" href="http://web.mit.edu/Kerberos/www/" target="_top"><acronym class="acronym">MIT</acronym>
	      <span class="application">Kerberos</span> homepage</a></p></li><li class="listitem"><p><a class="link" href="http://www.pdc.kth.se/heimdal/" target="_top">Heimdal
	      <span class="application">Kerberos</span> homepage</a></p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="tcpwrappers.html">Terug</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Omhoog</a></td><td width="40%" align="right"> <a accesskey="n" href="openssl.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">15.6. TCP Wrappers </td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top"> 15.8. OpenSSL</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>