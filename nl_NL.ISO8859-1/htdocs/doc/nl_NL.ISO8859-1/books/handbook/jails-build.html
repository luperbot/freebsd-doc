<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>16.4. Creeëren en controleren van jails</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD handboek" /><link rel="up" href="jails.html" title="Hoofdstuk 16. Jails" /><link rel="prev" href="jails-intro.html" title="16.3. Introductie" /><link rel="next" href="jails-tuning.html" title="16.5. Optimaliseren en administratie" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">16.4. Creeëren en controleren van jails</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="jails-intro.html">Terug</a> </td><th width="60%" align="center">Hoofdstuk 16. Jails</th><td width="20%" align="right"> <a accesskey="n" href="jails-tuning.html">Volgende</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-build"></a>16.4. Creeëren en controleren van jails</h2></div></div></div><p>Sommige beheerders kiezen ervoor om jails op te delen in
      de volgende twee types: <span class="quote">&#8220;<span class="quote">complete</span>&#8221;</span> jails, welke
      een volledig FreeBSD systeem emuleert en <span class="quote">&#8220;<span class="quote">service</span>&#8221;</span>
      jails, gericht op één applicatie of dienst,
      mogelijkerwijs draaiende met privileges.  Dit is alleen een
      conceptuele splitsing, de manier van het opbouwen van een jail
      wordt hierdoor niet veranderd.  De <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> handleiding
      is heel duidelijk over de procedure voor het maken van een
      jail:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setenv D /here/is/the/jail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p $D</code></strong> <a id="jailpath"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildworld</code></strong> <a id="jailbuildworld"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld DESTDIR=$D</code></strong> <a id="jailinstallworld"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>make distribution DESTDIR=$D</code></strong> <a id="jaildistrib"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>mount -t devfs devfs $D/dev</code></strong> <a id="jaildevfs"></a><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#jailpath"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Het selecteren van een locatie voor een jail is het beste
	  beginpunt.  Hier zal de jail fysiek te vinden zijn binnen
	  het bestandssysteem van het host systeem.  Een goede keuze
	  kan <code class="filename">/usr/jailjailnaam</code>
	  zijn, waar <em class="replaceable"><code>jailnaam</code></em> de naam is van de
	  jail.  Het <code class="filename">/usr</code>
	  bestandssysteem heeft meestal genoeg ruimte voor het jail
	  bestandssysteem, wat voor een <span class="quote">&#8220;<span class="quote">complete</span>&#8221;</span> jail
	  betekend dat het eigenlijk een replica is van elk bestand
	  dat standaard aanwezig is binnen het FreeBSD basissysteem.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jailbuildworld"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Als u uw userland al heeft herbouwd met
	  <code class="command">make world</code> of <code class="command">make buildworld</code>,
	  dan kunt u deze stap overslaan en uw bestaande userland in de nieuwe
	  jail installeren.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jailinstallworld"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Dit commando zal de gekozen fysieke directory vullen
	  met de benodigde binaire bestanden, bibliotheken,
	  handleidingen, etc.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildistrib"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Het <code class="buildtarget">distribution</code> doel voor
	  <span class="application">make</span> installeert elk benodigd
	  configuratie bestand.  In simpelere termen, het installeert
	  alle installeerbare bestanden in
	  <code class="filename">/usr/src/etc</code> naar de
	  <code class="filename">/etc</code> directory van
	  de jail omgeving:
	  <code class="filename">$D/etc</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildevfs"><span><img src="./imagelib/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Het koppelen van het <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> bestandssysteem
	  is niet vereist in een jail.  Aan de andere kant, vrijwel
	  elke applicatie heeft toegang nodig tot minstens
	  één apparaat, afhankelijk van het doel van
	  het programma.  Het is erg belangrijk om toegang tot
	  apparaten te controleren binnenin een jail, omdat incorrecte
	  instellingen een aanvaller de mogelijkheid kunnen geven om
	  vervelende dingen in de jail te doen.  De controle over
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> wordt gedaan door middel van rulesets, welke
	  beschreven worden in de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> en <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs.conf</span>(5)</span></a>
	  handleidingen.</p></td></tr></table></div><p>Zodra een jail is geïnstalleerd, kan het opgestart worden
      door de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> applicatie.  De <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> applicatie
      heeft vier benodigde argumenten welke beschreven worden in
      <a class="xref" href="jails-intro.html#jails-what" title="16.3.1. Wat is een jail">Paragraaf 16.3.1, &#8220;Wat is een jail&#8221;</a>.  Er kunnen ook andere argumenten
      gebruikt worden, om bijvoorbeeld de jail te starten met de
      instellingen van een specifieke gebruiker.  Het
      <code class="option"><em class="replaceable"><code>commando</code></em></code> argument
      hangt af van het type jail, voor een
      <span class="emphasis"><em>virtueel systeem</em></span> is
      <code class="filename">/etc/rc</code> een goede keuze, omdat het de
      reguliere opstart procedure nabootst van een FreeBSD systeem.
      Voor een <span class="emphasis"><em>dienst</em></span> jail is het geheel afhankelijk
      van de dienst of applicatie die in de jail gaat draaien.</p><p>Jails worden over het algemeen gestart tegelijkertijd met
      de rest van het systeem.  Het FreeBSD <code class="filename">rc</code>
      mechanisme levert een makkelijke manier om dat te doen:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Een lijst van jails die opgestart moeten worden tijdens
	  het opstarten van het systeem, moeten worden toegevoegd aan
	  het <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> bestand:</p><pre class="programlisting">jail_enable="YES"   # Stel dit in op NO om te voorkomen dat er jails gestart worden
jail_list="<em class="replaceable"><code>www</code></em>"     # Door spaties gescheiden lijst van jails</pre><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">De jail namen in <code class="varname">jail_list</code> mogen alleen
	    alfanumerieke karakters bevatten.</p></div></li><li class="step"><p>Voor elke jail die gespecificeerd is in
	  <code class="varname">jail_list</code> moet een groep van <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>
	  instellingen worden toegevoegd:</p><pre class="programlisting">jail_<em class="replaceable"><code>www</code></em>_rootdir="/usr/jail/www"     # de hoofd directory van de jail
jail_<em class="replaceable"><code>www</code></em>_hostname="<em class="replaceable"><code>www</code></em>.example.org"  # de hostnaam van de jail
jail_<em class="replaceable"><code>www</code></em>_ip="192.168.0.10"           # het IP adres van de jail
jail_<em class="replaceable"><code>www</code></em>_devfs_enable="YES"          # moet devfs wel of niet gekoppeld worden in de jail
jail_<em class="replaceable"><code>www</code></em>_devfs_ruleset="<em class="replaceable"><code>www_ruleset</code></em>" # welke devfs ruleset gebruikt moet worden voor de jail</pre><p>De standaard opstart variabelen in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>
	  gebruiken het <code class="filename">/etc/rc</code> bestand om de jail
	  op te starten, wat er vanuit gaat dat de jail een compleet
	  virtueel systeem is.  Voor service jails moet het standaard
	  opstart commando worden gewijzigd door het aanpassen van de
	  <code class="varname">jail_<em class="replaceable"><code>jailname</code></em>_exec_start</code>
	  optie.</p><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Voor een complete lijst van beschikbare opties, zie de
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> handleiding.</p></div></li></ol></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=service&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">service</span>(8)</span></a> kan worden gebruikt om jails handmatig te starten en
      te stoppen, mits er een overeenkomstige verzameling regels bestaat in
      <code class="filename">/etc/rc.conf</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service jail start www</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>service jail stop www</code></strong></pre><p>Er is op dit moment geen nette methode om een jail te
      stoppen.  Dit komt omdat de benodigde applicaties die een
      nette afsluiting verzorgen, niet beschikbaar zijn in een
      jail.  De beste manier om een jail af te sluiten is door
      het volgende commando van binnenin de jail uit te voeren
      of door middel van het <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a> commando:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh /etc/rc.shutdown</code></strong></pre><p>Meer informatie hierover kan gevonden worden in de
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> handleiding.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jails-intro.html">Terug</a> </td><td width="20%" align="center"><a accesskey="u" href="jails.html">Omhoog</a></td><td width="40%" align="right"> <a accesskey="n" href="jails-tuning.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">16.3. Introductie </td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top"> 16.5. Optimaliseren en administratie</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>