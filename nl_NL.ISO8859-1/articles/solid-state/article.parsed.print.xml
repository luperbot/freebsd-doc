<?xml version="1.0" encoding="iso-8859-1"?>
<!-- Copyright (c) 2001 The FreeBSD Documentation Project

     Redistribution and use in source (SGML DocBook) and 'compiled' forms
     (SGML, HTML, PDF, PostScript, RTF and so forth) with or without
     modification, are permitted provided that the following conditions
     are met:

      1. Redistributions of source code (SGML DocBook) must retain the above
         copyright notice, this list of conditions and the following
         disclaimer as the first lines of this file unmodified.

      2. Redistributions in compiled form (transformed to other DTDs,
         converted to PDF, PostScript, RTF and other formats) must reproduce
         the above copyright notice, this list of conditions and the
         following disclaimer in the documentation and/or other materials
         provided with the distribution.

     THIS DOCUMENTATION IS PROVIDED BY THE FREEBSD DOCUMENTATION PROJECT "AS
     IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
     THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
     PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL NIK CLAYTON BE LIABLE FOR ANY
     DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
     DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
     OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
     HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
     STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
     ANY WAY OUT OF THE USE OF THIS DOCUMENTATION, EVEN IF ADVISED OF THE
     POSSIBILITY OF SUCH DAMAGE.

     $FreeBSD$

     %SOURCE%	en_US.ISO8859-1/articles/solid-state/article.xml
     %SRCID%	41645
-->
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:lang="nl">
  <info><title xmlns:xlink="http://www.w3.org/1999/xlink">FreeBSD en Solid State Apparaten</title>
    

    <authorgroup xmlns:xlink="http://www.w3.org/1999/xlink">
      <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><firstname xmlns:xlink="http://www.w3.org/1999/xlink">John</firstname><surname xmlns:xlink="http://www.w3.org/1999/xlink">Kozubik</surname></personname><affiliation xmlns:xlink="http://www.w3.org/1999/xlink">
	  <address xmlns:xlink="http://www.w3.org/1999/xlink"><email xmlns:xlink="http://www.w3.org/1999/xlink">john@kozubik.com</email></address>
	</affiliation></author>
    </authorgroup>

    <copyright xmlns:xlink="http://www.w3.org/1999/xlink">
      <year xmlns:xlink="http://www.w3.org/1999/xlink">2001</year>
      <year xmlns:xlink="http://www.w3.org/1999/xlink">2009</year>
      <holder xmlns:xlink="http://www.w3.org/1999/xlink">The FreeBSD Documentation Project</holder>
    </copyright>

    <pubdate xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</pubdate>

    <releaseinfo xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</releaseinfo>

    <legalnotice xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="trademarks" role="trademarks">
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">FreeBSD is een geregistreerd
  handelsmerk van de FreeBSD Foundation.</para>
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Veel van de termen die door
  fabrikanten en verkopers worden gebruikt om hun producten te
  onderscheiden worden geclaimd als handelsmerk.  Op de plaatsen waar
  deze handelsmerken in dit document voorkomen, en het FreeBSD Project op
  de hoogte was van de claim op het handelsmerk, worden de termen
  gevolgd door het symbool <quote xmlns:xlink="http://www.w3.org/1999/xlink">&#8482;</quote> of het symbool
  <quote xmlns:xlink="http://www.w3.org/1999/xlink">®</quote>.</para>
    </legalnotice>

    
<legalnotice xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="legalnotice">
  <title xmlns:xlink="http://www.w3.org/1999/xlink">Copyright</title>

  <para xmlns:xlink="http://www.w3.org/1999/xlink">Redistribution and use in source (XML DocBook) and 'compiled'
    forms (XML, HTML, PDF, PostScript, RTF and so forth) with or without
    modification, are permitted provided that the following conditions are
    met:</para>

  <orderedlist xmlns:xlink="http://www.w3.org/1999/xlink">
    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Redistributions of source code (XML DocBook) must retain the
        above copyright notice, this list of conditions and the following
        disclaimer as the first lines of this file unmodified.</para>
    </listitem>

    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Redistributions in compiled form (transformed to other DTDs,
        converted to PDF, PostScript, RTF and other formats) must
        reproduce the above copyright notice, this list of conditions and
        the following disclaimer in the documentation and/or other
        materials provided with the distribution.</para>
    </listitem>
  </orderedlist>

  <important xmlns:xlink="http://www.w3.org/1999/xlink">
    <para xmlns:xlink="http://www.w3.org/1999/xlink">THIS DOCUMENTATION IS PROVIDED BY THE FREEBSD DOCUMENTATION
      PROJECT "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
      BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
      FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL
      THE FREEBSD DOCUMENTATION PROJECT BE LIABLE FOR ANY DIRECT, INDIRECT,
      INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
      BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS
      OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
      ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
      TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
      USE OF THIS DOCUMENTATION, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
      DAMAGE.</para>
  </important>
</legalnotice>


    <abstract xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Dit artikel behandelt het gebruik van solid state
	disk-apparaten in FreeBSD voor het maken van embedded
	systemen.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Embedded systemen hebben het voordeel van verhoogde
	stabiliteit wegens het ontbreken van bewegende delen (harde
	schijven).  Er moet echter rekening worden gehouden met de over
	het algemeen weinig beschikbare schijfruimte in het systeem en
	de duurzaamheid van het opslagmedium.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Specifieke onderwerpen die aan bod komen omvatten de typen
	en attributen van solid state-media die geschikt zijn om in FreeBSD
	als schijf te gebruiken, kernelopties die interessant zijn in
	zo'n omgeving, de mechanismen van
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">rc.initdiskless</filename> die de initialisatie van zulke
	systemen automatiseren en de noodzaak voor alleen-lezen
	bestandssystemen, en het van voor af aan bouwen van
	bestandssystemen.  Het artikel zal afsluiten met wat algemene
	strategiën voor kleine en alleen-lezen
	FreeBSD-omgevingen.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink"><emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Vertaald door René Ladan</emphasis>.</para>
    </abstract>
  </info>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="intro">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Solid State Disk-apparaten</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Het bereik van dit artikel zal beperkt zijn tot solid state
      disk-apparaten die gemaakt zijn met flash-geheugen.
      Flash-geheugen is een solid state-geheugen (geen bewegende
      onderdelen) dat niet-vluchtig is (het geheugen blijft gegevens
      behouden zelf nadat alle stroombronnen zijn ontkoppeld).
      Flash-geheugen kan enorme fysieke schokken weerstaan en is
      redelijk snel (de oplossingen met flash-geheugens die in dit
      artikel worden behandeld zijn iets langzamer dan een EIDE-harde
      schijf voor schrijfbewerkingen, en veel sneller voor
      leesbewerkingen).  Een heel belangrijk aspect van flash-geheugen,
      waarvan de ramnificaties later in dit artikel besproken zullen
      worden, is dat elke sector een beperkte herschrijfcapaciteit heeft.
      Een sector flash-geheugen kan maar een bepaald aantal keren
      beschreven, gewist, en herschreven worden voordat de sector
      permanent onbruikbaar wordt.  Hoewel veel flash-geheugenproducten
      automatisch slechte blokken in kaart brengen, en hoewel sommigen
      zelfs schrijfoperaties gelijkmatig over de eenheid distribueren,
      blijft het een feit dat er een limiet bestaat aan de hoeveelheid
      waarmee het apparaat kan worden beschreven.  Concurrerende
      apparaten hebben tussen de 1.000.000 en 10.000.000
      schrijfbewerkingen per sector in hun specificaties staan.  Dit
      getal varieert vanwege de omgevingstemperatuur.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">In het bijzonder worden ATA-compatibele compact-flash-eenheden
      besproken, welke vrij populair zijn als opslagmedium voor digitale
      camera's.  Bijzonder interessant is het feit dat de pinnen ervan
      precies met die van de IDE-bus overeenkomen en dat ze compatibel
      zijn met de ATA-commandoverzameling.  Daarom kunnen deze apparaten
      direct aan een IDE-bus in een computer gekoppeld worden met een
      zeer eenvoudige en goedkope adapter.  Eenmaal op deze wijze
      geïmplementeerd zien besturingssystemen zoals FreeBSD het
      apparaat als een normale harde schijf (doch klein).</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Er bestaan nog andere solid state disk-oplossingen, maar hun
      kosten, zeldzaamheid, en relatieve gebruiksongemak plaatst ze
      buiten het bereik van dit artikel.</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="kernel">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Kernelopties</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Enkele kernelopties zijn specifiek interessant voor degenen
      die een embedded FreeBSD-systeem creëren.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Alle embedded FreeBSD-systemen die flash-geheugen als
      systeemschijf gebruiken zullen geïntereseerd zijn
      in geheugenschijven en geheugenbestandssystemen.  Vanwege het
      beperkt aantal keren dat het flash-geheugen kan worden beschreven,
      is het het waarschijnlijkst dat de schijf en de bestandssystemen
      op de schijf als alleen-lezen worden aangekoppeld.  In deze
      omgeving zullen bestandssystemen zoals <filename xmlns:xlink="http://www.w3.org/1999/xlink">/tmp</filename>
      en <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> als geheugenbestandssystemen worden
      aangekoppeld zodat het systeem logs kan creëren en tellers en
      tijdelijke bestanden kan bijwerken.  Geheugenbestandssystemen zijn
      een kritiek station naar een succesvolle implementatie van solid
      state FreeBSD.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">De volgende regels dienen in uw kernelinstellingenbestand te
      staan:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">options         MFS             # Geheugenbestandssysteem
options         MD_ROOT         # md-apparaat bruikbaar als een potentieel root-apparaat
pseudo-device   md              # geheugenschijf</programlisting>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="ro-fs">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Het <literal xmlns:xlink="http://www.w3.org/1999/xlink">rc</literal>-deelsysteem en alleen-lezen
      bestandssystemen</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">De post-boot-initialisatie van een embedded FreeBSD-systeem wordt
      beheerd door <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.initdiskless</filename>.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> koppelt
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> als een geheugenbestandssysteem aan,
      maakt een instelbare lijst van mappen in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename>
      aan met het commando <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">mkdir</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>, en verandert de modus van sommige
      van deze mappen.  Tijdens het uitvoeren van
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> is er nog een
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">rc.conf</filename>-variabele in het spel &#8211;
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">varsize</literal>.  Het bestand
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> maakt een partitie
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> aan gebaseerd op de waarde van deze
      variabele in <filename xmlns:xlink="http://www.w3.org/1999/xlink">rc.conf</filename>:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">varsize=8192</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Onthoud dat deze waarde standaard in sectoren is.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Het feit dat <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> een bestandssysteem is
      dat zowel gelezen als geschreven wordt is
      een belangrijk verschil, aangezien de partitie
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/</filename> (en alle andere partities die op uw
      flash-medium kunnen staan) als alleen-lezen aangekoppeld dienen te
      worden.  In <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="intro"/> hebben we de beperkingen van
      flash-geheugen uiteen gelegd - in bijzonder de beperkte
      herschrijfcapaciteit.  Het belang van het niet als lezen-schrijven
      aankoppelen van flash-media en het belang van het niet gebruiken
      van een wisselbestand kunnen niet genoeg benadrukt worden.  Een
      wisselbestand op een druk systeem kan binnen een jaar een
      flash-medium opmaken.  Het uitgebreid loggen of aanmaken en
      vernietigen van tijdelijke bestanden kan hetzelfde doen.  Daarom
      dient u, naast het verwijderen van de regel <literal xmlns:xlink="http://www.w3.org/1999/xlink">swap</literal>
      uit het bestand <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/fstab</filename>, ook de Options
      van elk bestandssysteem als volgt op <literal xmlns:xlink="http://www.w3.org/1999/xlink">ro</literal> te
      zetten:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink"># Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/ad0s1a             /               ufs     ro              1       1</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Op een gemiddeld systeem zullen enkele applicaties het
      onmiddellijk niet meer doen als gevolg van deze verandering.
      cron zal niet correct draaien vanwege ontbrekende cron-tabellen in
      het <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> dat door
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> is aangemaakt, en syslog en
      DHCP zullen problemen ondervinden als gevolg van het alleen-lezen
      bestandssysteem en ontbrekende items in het
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> dat
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> heeft aangemaakt.  Dit zijn
      slechts tijdelijke problemen, en worden tezamen met oplossingen
      voor het uitvoeren van andere veelgebruikte softwarepakketten
      behandeld in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="strategies"/>.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Een belangrijk ding om te onthouden is dat een bestandssysteem
      dat met <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/fstab</filename> als alleen-lezen was
      aangekoppeld ten alle tijden lezen-schrijven kan worden gemaakt
      door dit commando te geven:</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">/sbin/mount -uw partitie</userinput></screen>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">en kan op alleen-lezen worden teruggezet met het
      commando:</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">/sbin/mount -ur partitie</userinput></screen>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Een bestandssysteem uit het niets opbouwen</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Omdat ATA-compatibele compact-flash-kaarten door FreeBSD als
      normale IDE harde schijven worden gezien, kunt u theoretisch FreeBSD
      vanaf het netwerk installeren door de floppies kern en mfsroot of
      een CD te gebruiken.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Zelfs een kleine installatie van FreeBSD die normale
      installatieprocedures gebruikt kan echter een systeem produceren
      met een omvang van meer dan 200 MB.  Omdat de meeste mensen
      kleinere flash-geheugenapparaten zullen gebruiken (128 MB wordt als
      redelijk groot gezien - 32 of zelfs 16 MB is gebruikelijk) is een
      installatie dat de normale mechanismen gebruikt niet
      mogelijk er is simpelweg niet genoeg schijfruimte voor zelfs
      de kleinste van de conventionele installaties.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">De gemakkelijkste manier om over deze beperking heen te komen
      is om FreeBSD met conventionele middelen naar een normale harde
      schijf te installeren.  Kleedt, nadat de installatie voltooid is,
      het besturingssysteem uit tot een grootte die op uw flash-medium
      past, en pak vervolgens het gehele bestandssysteem in.  De volgende
      stappen leiden u door het proces heen van een normaal flash-geheugen
      voorbereiden op uw ingepakte bestandssysteem.  Omdat er geen normale
      installatie wordt uitgevoerd, moeten bewerkingen zoals partitioneren,
      labelen, het aanmaken van bestandssystemen, etcetera met de hand
      uitgevoerd worden.  Naast de floppies kern en mfsroot heeft u ook
      de floppy fixit nodig.</para>

    <procedure xmlns:xlink="http://www.w3.org/1999/xlink">
      <step xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Het flash-media-apparaat partitioneren</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Kies nadat er met de floppies kern en mfsroot is opgestart
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">custom</literal> uit het installatiemenu.  Kies
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">partition</literal> in het aangepaste
	  installatiemenu.  In het partitiemenu dient u alle bestaande
	  partities te wissen met de toets <keycap xmlns:xlink="http://www.w3.org/1999/xlink">d</keycap>.  Maak
	  nadat alle bestaande partities gewist zijn een partitie aan
	  met de toets <keycap xmlns:xlink="http://www.w3.org/1999/xlink">c</keycap> en accepteer de
	  standaardwaarde voor de grootte van de partitie.  Zorg ervoor
	  dat het type van de partitie op <literal xmlns:xlink="http://www.w3.org/1999/xlink">165</literal> is
	  ingesteld wanneer daar naar wordt gevraagd.  Schrijf nu deze
	  partitietabel naar schijf door op de toets <keycap xmlns:xlink="http://www.w3.org/1999/xlink">w</keycap>
	  te drukken (dit is een verborgen optie op dit scherm).  Wanneer
	  u een ATA-compatibele flash-kaart gebruikt, dient u de
	  opstartbeheerder van FreeBSD te gebruiken.  Druk nu op de toets
	  <keycap xmlns:xlink="http://www.w3.org/1999/xlink">q</keycap> om het partitiemenu te verlaten.  Het menu
	  van de opstartbeheerder wordt nog een keer aan u getoond -
	  herhaal de keuze die u eerder heeft gemaakt.</para>
      </step>

      <step xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">De bestandssystemen op uw flash-geheugenapparaat
	  aanmaken</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Verlaat het aangepaste installatiemenu, en kies van het
	  hoofdinstallatiemenu de optie <literal xmlns:xlink="http://www.w3.org/1999/xlink">fixit</literal>.  Geef
	  na het binnengaan van de fixit-omgeving het volgende
	  commando:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">disklabel -e /dev/ad0c</userinput></screen>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Op dit punt bent u de tekstverwerker vi binnengegaan onder
	  toezien van het commando disklabel.  Vervolgens dient u een
	  regel met <literal xmlns:xlink="http://www.w3.org/1999/xlink">a:</literal> aan het einde van het
	  bestand toe te voegen.  Deze regel dient er als volgt uit te
	  zien:</para>

	<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">a:      <replaceable xmlns:xlink="http://www.w3.org/1999/xlink">123456</replaceable>  0       4.2BSD  0       0</programlisting>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Hierbij is <replaceable xmlns:xlink="http://www.w3.org/1999/xlink">123456</replaceable> een getal dat
	  exact gelijk is aan het getal in de bestaande regel met
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">c:</literal> voor de grootte.  In feite dupliceert u
	  de bestaande regel met <literal xmlns:xlink="http://www.w3.org/1999/xlink">c:</literal> als een regel met
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">a:</literal>, met daarbij <literal xmlns:xlink="http://www.w3.org/1999/xlink">4.2BSD</literal>
	  als type van het bestandssysteem.  Sla het bestand op en
	  verlaat de tekstverwerker.</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">disklabel -B -r /dev/ad0c</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">newfs /dev/ad0a</userinput></screen>
      </step>

      <step xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Uw bestandssysteem op het flash-medium plaatsen</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Koppel het nieuw voorbereide flash-medium aan:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">mount /dev/ad0a /flash</userinput></screen>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Activeer deze machine in het netwerk zodat we ons
	  tar-bestand kunnen overzenden en het op het bestandssysteem
	  van het flash-medium kunnen uitpakken.  Een manier om dit te
	  doen is:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ifconfig xl0 192.168.0.10 netmask 255.255.255.0</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">route add default 192.168.0.1</userinput></screen>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Nu de machine op het netwerk is, kan het tar-bestand
	  worden overgezonden.  U kunt nu tegen een dilemma aanlopen -
	  als bijvoorbeeld uw flash-geheugen 128 MB groot is, en uw
	  tar-bestand groter is dan 64 MB, kan uw tar-bestand niet op
	  het zelfde moment op het flash-medium staan als dan wanneer u
	  het uitpakt - u zult schijfruimte tekort komen.  Een oplossing
	  voor dit probleem is, wanneer u FTP gebruikt, om het bestand
	  uitpakt terwijl u het over FTP verzendt.  Als u de overdracht
	  op deze manier aanpakt, zult u nooit het tar-bestand en de
	  inhoud ervan op hetzelfde moment op uw schijf hebben:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns:xlink="http://www.w3.org/1999/xlink">ftp&gt;</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">get tar-bestand.tar "| tar xvf -"</userinput></screen>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Als uw tar-bestand met gzip is ingepakt, kunt u dit ook
	  voor elkaar krijgen:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns:xlink="http://www.w3.org/1999/xlink">ftp&gt;</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">get tar-bestand.tar "| zcat | tar xvf -"</userinput></screen>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Nadat de inhoud van uw ge-tar-de bestandssysteem op het
	  bestandssysteem van uw flash-geheugen staan, kunt u het
	  flash-geheugen afkoppelen en opnieuw opstarten:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">cd /</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">umount /flash</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">exit</userinput></screen>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Aangenomen dat u uw bestandssysteem correct heeft
	  geconfigureerd toen het gebouwd werd op de normale harde
	  schijf (met uw bestandssystemen als alleen-lezen aangekoppeld
	  en met de nodige opties in de kernel gecompileerd) zou u nu
	  succesvol uw embedded FreeBSD-systeem moeten kunnen
	  opstarten.</para>
      </step>
    </procedure>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="strategies">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Systeemstragiën voor kleine en alleen-lezen
      omgevingen.</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">In <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="ro-fs"/> werd erop gewezen dat het
      bestandssysteem <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> zoals geconstrueerd
      door <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> en de aanwezigheid van
      een hoofdbestandssysteem dat alleen gelezen kan worden problemen
      veroorzaakt met veel alledaagse softwarepakketten die door FreeBSD
      gebruikt worden.  In dit artikel zullen suggesties voor het
      succesvol draaien van cron, syslog, ports-installaties en de
      webserver Apache worden gegeven.</para>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">cron</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Tijdens het opstarten wordt <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> bevolkt door
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> dat de lijst van
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/mtree/BSD.var.dist</filename> gebruikt, dus
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">cron</filename>, <filename xmlns:xlink="http://www.w3.org/1999/xlink">cron/tabs</filename>, <filename xmlns:xlink="http://www.w3.org/1999/xlink">at</filename>, en nog wat andere
	standaardmappen worden aangemaakt.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Dit lost echter nog niet het probleem van het
	behouden van cron-tabellen na het opnieuw opstarten op.  Wanneer
	het systeem opnieuw opstart, zal het bestandssysteem
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> dat in het geheugen staat verdwijnen
	en zullen alle cron-tabellen die er in stonden ook verdwijnen.
	Daarom is een oplossing hiervoor het aanmaken van cron-tabellen
	voor de gebruikers die ze nodig hebben, uw bestandssysteem
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/</filename> als lezen-schrijven aan te koppelen en
	die cron-tabellen naar een veilige plaats zoals
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/tabs</filename> te kopiëren en een regel aan
	het einde van <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.initdiskless</filename> toe te
	voegen die deze cron-tabellen naar
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/cron/tabs</filename> kopieert nadat die map is
	aangemaakt tijdens de syseeminitialisatie.  U moet misschien ook
	een regel toevoegen die de modi en toestemmingen van de mappen
	die u aanmaakt en de bestanden die u met
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">etc/rc.initdiskless</filename> kopieert verandert.</para>
    </sect2>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">syslog</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink"><filename xmlns:xlink="http://www.w3.org/1999/xlink">syslog.conf</filename> specificeert de plaats van
	bepaalde logbestanden die in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/log</filename>
	bestaan.  Deze bestanden worden niet door
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> tijdens de
	systeeminitialisatie aangemaakt.  Daarom dient u ergens na de
	sectie die de mappen in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> aanmaakt in
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> iets als het volgende
	toevoegen:</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">touch /var/log/security /var/log/maillog /var/log/cron /var/log/messages</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">chmod 0644 /var/log/*</userinput></screen>
    </sect2>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Ports installeren</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Voordat de veranderingen die nodig zijn om succesvol de
	portsboom te gebruiken besproken worden, is een herinnering ten
	aanzien van de alleen-lezen-natuur van uw bestandssystemen op
	het flash-medium op zijn plaats.  Aangezien ze alleen-lezen zijn,
	dient u ze tijdelijk als lezen-schrijven aan te koppelen waarbij
	de koppelsyntaxis zoals getoond in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="ro-fs"/> wordt
	gebruikt.  U dient deze bestandssystemen altijd als alleen-lezen
	te herkoppelen als u klaar bent met enig onderhoud - onnodige
	schrijfacties naar het flash-medium kunnen de levensduur ervan
	aanzienlijk verkorten.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Om het mogelijk te maken om een portsmap binnen te gaan en
	succesvol <command xmlns:xlink="http://www.w3.org/1999/xlink">make</command> <buildtarget>install</buildtarget>
	uit te voeren, moeten we een pakketmap op een bestandssysteem
	aanmaken dat niet geheugengebaseerd is en dat onze pakketten
	tussen herstarts bijhoudt.  Omdat het toch nodig is om uw
	bestandssystemen als lezen-schrijven te koppelen voor het
	installeren van een pakket, is het zinnig om aan te nemen dat
	een gebied op het flash-medium ook gebruikt kan worden om
	pakketinformatie naar te schrijven.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Maak als eerste een map aan voor de pakketdatabase.  Dit is
	normaliter <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/db/pkg</filename>, maar we kunnen het
	daar niet plaatsen aangezien het telkens als het systeem wordt
	opgestart zal verdwijnen.</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">mkdir /etc/pkg</userinput></screen>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Voeg nu een regel aan <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename>
	toe die de map <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pkg</filename> aan
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/db/pkg</filename> koppelt.  Een voorbeeld:</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ln -s /etc/pkg /var/db/pkg</userinput></screen>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Nu zal telkens wanneer u uw bestandssystemen als
	lezen-schrijven aankoppelt en een pakket installeert,
	<command xmlns:xlink="http://www.w3.org/1999/xlink">make</command> <buildtarget>install</buildtarget> werken,
	en zal de pakketinformatie succesvol naar
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pkg</filename> worden geschreven (omdat het
	bestandssysteem op dat moment als lezen-schrijven is aangekoppeld)
	wat altijd als <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/db/pkg</filename> beschikbaar is
	voor het besturingssysteem.</para>
    </sect2>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Apache Web Server</title>

      <note xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">De stappen in deze sectie zijn alleen nodig indien Apache
	  is ingesteld om de pid- of loginformatie buiten <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> te schrijven.  Standaard
	  houdt Apache het pid-bestand in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/run/httpd.pid</filename> en de
	  logbestanden in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/log</filename>.</para>
      </note>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Er wordt nu aangenomen dat Apache de logbestanden in een map
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">apache_log_map</filename>
	buiten <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> bewaart.
	Wanneer deze map op een alleen-lezen bestandssysteem staat, zal
	Apache geen logbestanden kunnen opslaan, en kan het werkproblemen
	hebben.  Indien dit zo is, is het noodzakelijk om een nieuwe map
	aan de lijst met mappen in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> die
	in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> worden aangemaakt toe te voegen, en om
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">apache_log_map</filename>
	aan <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/log/apache</filename> te koppelen.  Het is
	ook nodig om de toestemmingen en eigenaarschappen van deze
	nieuwe map in te stellen.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Voeg eerst de map <literal xmlns:xlink="http://www.w3.org/1999/xlink">log/apache</literal> toe aan de
	lijst van mappen die in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename>
	aangemaakt moeten worden.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Voeg ten tweede deze commando's toe aan
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> na de sectie die mappen
	aanmaakt:</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">chmod 0774 /var/log/apache</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">chown nobody:nobody /var/log/apache</userinput></screen>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Verwijder als laatste de bestaande map
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">apache_log_map</filename>
	en vervang het door een koppeling:</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">rm -rf apache_log_map</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ln -s /var/log/apache apache_log_map</userinput></screen>
    </sect2>
  </sect1>
</article>
