<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>6.12. Использование Java</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD по созданию портов" /><link rel="up" href="special.html" title="Глава 6. Особые соглашения" /><link rel="prev" href="using-kde.html" title="6.11. Использование KDE" /><link rel="next" href="using-php.html" title="6.13. Веб-приложения, Apache и PHP" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.12. Использование Java</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="using-kde.html">Пред.</a> </td><th width="60%" align="center">Глава 6. Особые соглашения</th><td width="20%" align="right"> <a accesskey="n" href="using-php.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-java"></a>6.12. Использование Java</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="java-variables"></a>6.12.1. Задание переменных</h3></div></div></div><p>Если вашему порту необходимо наличие JavaTM
	Development Kit (JDKTM) для построения, работы или даже
	распаковки дистрибутивного файла, то в нём должна быть задана
	переменная <code class="varname">USE_JAVA</code>.</p><p>В Коллекции Портов присутствуют несколько JDK различных
	разработчиков и разных версий.  Если ваш порт должен
	использовать одну из этих версий, то вы должны указать, какую
	именно.  Самой последней версией и версией по умолчанию
	является <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/java/openjdk6/pkg-descr">java/openjdk6</a>.</p><div class="table"><a id="idp77690448"></a><div class="table-title">Таблица 6.15. Переменные, которые которые могут задаваться портами,
	  использующими Java</div><div class="table-contents"><table summary="Переменные, которые которые могут задаваться портами,&#10;&#9;  использующими Java" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Переменная</th><th>Значение</th></tr></thead><tbody><tr><td><code class="varname">USE_JAVA</code></td><td>Должна быть определена для того, что последующие
		переменные вступили в действие.</td></tr><tr><td><code class="varname">JAVA_VERSION</code></td><td>Список версий Java, перечисленных через пробел,
		подходящих для порта.  Опциональный знак
		<code class="literal">"+"</code> позволяет вам указать диапазон
		версий (возможные значения:
		<code class="literal">1.5[+] 1.6[+] 1.7[+]</code>).</td></tr><tr><td><code class="varname">JAVA_OS</code></td><td>Список операционных систем, перечисленных через
		пробел, порты JDK для которых подходят для порта
		(возможные значения:
		<code class="literal">native linux</code>).</td></tr><tr><td><code class="varname">JAVA_VENDOR</code></td><td>Список разработчиков портов JDK, перечисленных
		через пробел, которые подходят для порта (возможные
		значения: <code class="literal">freebsd bsdjava sun
		  openjdk</code>).</td></tr><tr><td><code class="varname">JAVA_BUILD</code></td><td>Если задана, то означает, что выбранный порт JDK
		должен быть добавлен к зависимостям порта для его
		построения.</td></tr><tr><td><code class="varname">JAVA_RUN</code></td><td>Если задана, то означает, что выбранный порт JDK
		должен быть добавлен в зависимостям порта для его
		работы.</td></tr><tr><td><code class="varname">JAVA_EXTRACT</code></td><td>Если задана, то означает, что выбранный порт JDK
		должен быть добавлен в зависимостям порта для
		распаковки его дистрибутивных файлов.</td></tr></tbody></table></div></div><br class="table-break" /><p>Ниже перечисляются все значения, которые принимают
	переменные после задания переменной
	<code class="varname">USE_JAVA</code>:</p><div class="table"><a id="idp77705168"></a><div class="table-title">Таблица 6.16. Переменные, доступные в портах, использующих
	  Java</div><div class="table-contents"><table summary="Переменные, доступные в портах, использующих&#10;&#9;  Java" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Переменная</th><th>Значение</th></tr></thead><tbody><tr><td><code class="varname">JAVA_PORT</code></td><td>Название порта JDK (к примеру,
		<code class="literal">'java/openjdk6'</code>).</td></tr><tr><td><code class="varname">JAVA_PORT_VERSION</code></td><td>Полное наименовании версии порта JDK (к примеру,
		<code class="literal">'1.6.0'</code>).  Если вам нужны только
		первые две цифры номера версии, используйте
		<code class="varname">${JAVA_PORT_VERSION:C/^([0-9])\.([0-9])(.*)$/\1.\2/}</code>.</td></tr><tr><td><code class="varname">JAVA_PORT_OS</code></td><td>Операционная система, используемая портом JDK
		(к примеру, <code class="literal">'native'</code>).</td></tr><tr><td><code class="varname">JAVA_PORT_VENDOR</code></td><td>Разработчик порта JDK (к примеру,
		<code class="literal">'openjdk'</code>).</td></tr><tr><td><code class="varname">JAVA_PORT_OS_DESCRIPTION</code></td><td>Описание операционной системы, используемой
		портом JDK (к примеру,
		<code class="literal">'Native'</code>).</td></tr><tr><td><code class="varname">JAVA_PORT_VENDOR_DESCRIPTION</code></td><td>Описание разработчика порта JDK (к примеру,
		<code class="literal">'OpenJDK BSD Porting
		  Team'</code>).</td></tr><tr><td><code class="varname">JAVA_HOME</code></td><td>Маршрут к установочному каталогу JDK (к примеру,
		<code class="filename">'/usr/local/openjdk6'</code>).</td></tr><tr><td><code class="varname">JAVAC</code></td><td>Маршрут к используемому компилятору Java
		(к примеру,
		<code class="filename">'/usr/local/openjdk6/bin/javac'</code>.</td></tr><tr><td><code class="varname">JAR</code></td><td>Маршрут к используемой утилите
		<code class="command">jar</code> (к примеру,
		<code class="filename">'/usr/local/openjdk6/bin/jar'</code>
		или
		<code class="filename">'/usr/local/bin/fastjar'</code>).</td></tr><tr><td><code class="varname">APPLETVIEWER</code></td><td>Маршрут к утилите
		<code class="command">appletviewer</code> (к примеру,
		<code class="filename">'/usr/local/openjdk6/bin/appletviewer'</code>).</td></tr><tr><td><code class="varname">JAVA</code></td><td>Маршрут к выполняемому файлу
		<code class="command">java</code>.  Используйте его для запуска
		Java-программ (к примеру,
		<code class="filename">'/usr/local/openjdk6/bin/java'</code>).</td></tr><tr><td><code class="varname">JAVADOC</code></td><td>Маршрут к вспомогательной программе
		<code class="command">javadoc</code>.</td></tr><tr><td><code class="varname">JAVAH</code></td><td>Маршрут к программе
		<code class="command">javah</code>.</td></tr><tr><td><code class="varname">JAVAP</code></td><td>Маршрут к программе
		<code class="command">javap</code>.</td></tr><tr><td><code class="varname">JAVA_KEYTOOL</code></td><td>Маршрут к вспомогательной программе
		<code class="command">keytool</code>.</td></tr><tr><td><code class="varname">JAVA_N2A</code></td><td>Маршрут к утилите
		<code class="command">native2ascii</code>.</td></tr><tr><td><code class="varname">JAVA_POLICYTOOL</code></td><td>Маршрут к программе
		<code class="command">policytool</code>.</td></tr><tr><td><code class="varname">JAVA_SERIALVER</code></td><td>Маршрут к вспомогательной программе
		<code class="command">serialver</code>.</td></tr><tr><td><code class="varname">RMIC</code></td><td>Маршрут к генератору каркаса программ RMI,
		утилите <code class="command">rmic</code>.</td></tr><tr><td><code class="varname">RMIREGISTRY</code></td><td>Маршрут к программе регистрации RMI,
		<code class="command">rmiregistry</code>.</td></tr><tr><td><code class="varname">RMID</code></td><td>Маршрут к программе-даемону RMI
		<code class="command">rmid</code>.</td></tr><tr><td><code class="varname">JAVA_CLASSES</code></td><td>Маршрут к архиву, который содержит файлы классов
		JDK,
		<code class="filename">${JAVA_HOME}/jre/lib/rt.jar</code>.</td></tr></tbody></table></div></div><br class="table-break" /><p>Вы можете воспользоваться make-целью
	<code class="literal">java-debug</code> для получения информации,
	необходимой для отладки вашего порта.  При её выполнении
	будут выданы значения многих упомянутых выше
	переменных.</p><p>Кроме того, для единообразия установки всех портов Java
	определены следующие константы:</p><div class="table"><a id="idp77769552"></a><div class="table-title">Таблица 6.17. Константы, определённые для портов, использующих
	  Java</div><div class="table-contents"><table summary="Константы, определённые для портов, использующих&#10;&#9;  Java" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Константа</th><th>Значение</th></tr></thead><tbody><tr><td><code class="varname">JAVASHAREDIR</code></td><td>Корневой каталог для всего, что связано с Java.
		По умолчанию:
		<code class="filename">${PREFIX}/share/java</code>.</td></tr><tr><td><code class="varname">JAVAJARDIR</code></td><td>Каталог, в который должны устанавливаться
		JAR-файлы.  По умолчанию:
		<code class="filename">${JAVASHAREDIR}/classes</code>.</td></tr><tr><td><code class="varname">JAVALIBDIR</code></td><td>Каталог, в который устанавливаются JAR-файлы из
		других портов.  По умолчанию:
		<code class="filename">${LOCALBASE}/share/java/classes</code>.</td></tr></tbody></table></div></div><br class="table-break" /><p>Соответствующие записи определяются в обоих переменных
	<code class="varname">PLIST_SUB</code> (описана в
	<a class="xref" href="plist.html#plist-sub" title="7.1. Изменение содержимого pkg-plist в зависимости от make-переменных">Раздел 7.1, <<Изменение содержимого <code class="filename">pkg-plist</code> в
      зависимости от make-переменных>></a>) и
	<code class="varname">SUB_LIST</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="java-building-with-ant"></a>6.12.2. Построение с Ant</h3></div></div></div><p>Если построение порта производится с использованием
	Apache Ant, то необходимо определить
	<code class="varname">USE_ANT</code>.  Таким образом Ant становится
	подкомандой make.  Если в порте не определена цель
	<code class="literal">do-build</code>, то будет установлена цель по
	умолчанию, которая просто запускает Ant в соответствии со
	значением <code class="varname">MAKE_ENV</code>,
	<code class="varname">MAKE_ARGS</code> и <code class="varname">ALL_TARGET</code>.
	Это похоже на механизм <code class="varname">USES= gmake</code>,
	который описан в <a class="xref" href="building.html" title="6.4. Механизмы построения">Раздел 6.4, <<Механизмы построения>></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="java-best-practices"></a>6.12.3. Практические рекомендации</h3></div></div></div><p>При портировании Java-библиотеки ваш порт должен
	устанавливать JAR-файл(ы) в каталог
	<code class="filename">${JAVAJARDIR}</code>, а все остальные данные в
	каталог <code class="filename">${JAVASHAREDIR}/${PORTNAME}</code> (за
	исключением документации, о которой пойдёт речь ниже).  Для
	уменьшения размера упакованного файла вы можете сослаться на
	JAR-файл(ы) непосредственно в файле
	<code class="filename">Makefile</code>.  Просто воспользуйтесь
	следующей директивой (в которой
	<code class="filename">myport.jar</code> является именем JAR-файла,
	устанавливаемого как часть порта):</p><pre class="programlisting">PLIST_FILES+=	%%JAVAJARDIR%%/myport.jar</pre><p>При портировании Java-приложения порт обычно
	устанавливает всё в один каталог (в том числе все свои
	JAR-зависимости).  В этом отношении настоятельно
	рекомендуется использование
	<code class="filename">${JAVASHAREDIR}/${PORTNAME}</code>.  На
	усмотрение создателя порта остаётся решение вопроса о том,
	устанавливать ли дополнительные JAR-зависимости в этот
	каталог или напрямую использовать уже установленные (из
	каталога <code class="filename">${JAVAJARDIR}</code>).</p><p>При портировании приложения <span class="trademark">Java</span>TM, для запуска сервиса
	которого требуется сервер приложений, такой как <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/tomcat7/pkg-descr">www/tomcat7</a>, для производителя в
	порядке вещей является распространение файла
	<code class="filename">.war</code>.  Файл <code class="filename">.war</code>
	- это Веб-приложение АРхивированное и оно
	распаковывается при вызове данным приложением.  Избегайте
	добавлять файлы <code class="filename">.war</code> в
	<code class="filename">pkg-plist</code>.  Это не является наилучшим
	решением.  Сервер приложений производит расширение архива
	<code class="filename">war</code> без должной его очистки при удалении
	порта.  Более подходящим способом работы с этим файлом будет
	распаковать архив, установить файлы и добавить их в
	<code class="filename">pkg-plist</code>.</p><pre class="programlisting">TOMCATDIR=	${LOCALBASE}/apache-tomcat-7.0
WEBAPPDIR=	myapplication

post-extract:
	@${MKDIR} ${WRKDIR}/${PORTDIRNAME}
	@${TAR} xf ${WRKDIR}/myapplication.war -C ${WRKDIR}/${PORTDIRNAME}

do-install:
	cd ${WRKDIR} &amp;&amp; \
	${INSTALL} -d -o ${WWWOWN} -g ${WWWGRP} ${TOMCATDIR}/webapps/${PORTDIRNAME}
	@cd ${WRKDIR}/${PORTDIRNAME} &amp;&amp; ${COPYTREE_SHARE} \* ${WEBAPPDIR}/${PORTDIRNAME}</pre><p>Вне зависимости от типа вашего порта (библиотека это или
	приложение), дополнительная документация должна
	устанавливаться <a class="link" href="install.html#install-documentation" title="5.15.4. Установка дополнительной документации">в тоже
	самое место</a>, что и для других портов.  Известно, что в
	зависимости от используемой версии JDK утилита JavaDoc
	генерирует различные наборы файлов.  Для портов, которые не
	привязаны к использованию определённой версии JDK, таким
	образом становится проблематичным определить список файлов
	для упаковки (<code class="filename">pkg-plist</code>).  Это одна из
	причин, по которой создателям портов настоятельно
	рекомендуется использовать макрос
	<code class="varname">PORTDOCS</code>.  Более того, даже если вы
	сможете угадать набор файлов, который будет сгенерирован
	утилитой <code class="command">javadoc</code>, размер получающегося
	файла <code class="filename">pkg-plist</code> голосует за
	использование <code class="varname">PORTDOCS</code>.</p><p>Значением по умолчанию для переменной
	<code class="varname">DATADIR</code> является
	<code class="filename">${PREFIX}/share/${PORTNAME}</code>.  Хорошей
	идеей является переопределение для Java-портов значения
	<code class="varname">DATADIR</code> как
	<code class="filename">${JAVASHAREDIR}/${PORTNAME}</code>.  На самом
	деле <code class="varname">DATADIR</code> автоматически добавляется к
	<code class="varname">PLIST_SUB</code> (это описано в <a class="xref" href="plist.html#plist-sub" title="7.1. Изменение содержимого pkg-plist в зависимости от make-переменных">Раздел 7.1, <<Изменение содержимого <code class="filename">pkg-plist</code> в
      зависимости от make-переменных>></a>), так что вы сможете использовать
	<code class="literal">%%DATADIR%%</code> непосредственно в
	<code class="filename">pkg-plist</code>.</p><p>Что касается выбора между построением портов Java из
	исходных текстов или их прямой установкой из бинарных
	дистрибутивов, то на момент создания этого текста
	определённой политики на этот счёт не существует.  Однако
	участники <a class="link" href="http://www.freebsd.org/java/" target="_top">Проекта FreeBSD
	  Java</a> рекомендуют создателям портов строить их из
	исходных текстов, если эта задача является несложной.</p><p>Все возможности, которые были описаны в этом разделе,
	реализованы в файле <code class="filename">bsd.java.mk</code>.  Если
	вы предположите, что вашему порту требуется менее тривиальная
	поддержка Java, пожалуйста, взгляните сначала на <a class="link" href="http://svnweb.FreeBSD.org/ports/head/Mk/bsd.java.mk?view=markup" target="_top">журнал
	  изменений bsd.java.mk в
	  <span class="application">Subversion</span></a>, так как для
	документирования последних изменений требуется какое-то
	время.  Затем, если вы думаете, что не хватающая вам
	поддержка окажется полезной для многих других портов Java,
	обсудите ваш вопрос в <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-java" target="_top">Список рассылки, посвящённый поддержке Java во FreeBSD</a>.</p><p>Хотя в базе сообщений об ошибках для соответствующих PR
	имеется категория <code class="literal">java</code>, она относится к
	работе над портированием JDK, которые проводит Проект FreeBSD
	Java.  Таким образом, вы должны относить свой Java-порт, как
	и любой другой, к категории <code class="literal">ports</code>, если
	решаемый вами вопрос не относится ни к реализации JDK, ни к
	<code class="filename">bsd.java.mk</code>.</p><p>Похожим образом определена политика по отношению к
	<code class="varname">CATEGORIES</code> порта Java, которая подробно
	описана в <a class="xref" href="makefile-categories.html" title="5.3. Разделение по категориям">Раздел 5.3, <<Разделение по категориям>></a>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="using-kde.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="special.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="using-php.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">6.11. Использование KDE </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 6.13. Веб-приложения, Apache и PHP</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>