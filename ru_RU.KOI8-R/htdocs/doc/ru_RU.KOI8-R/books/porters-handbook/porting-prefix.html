<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>9.4. PREFIX и DESTDIR</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD по созданию портов" /><link rel="up" href="testing.html" title="Глава 9. Тестирование вашего порта" /><link rel="prev" href="testing-porttools.html" title="9.3. Port Tools" /><link rel="next" href="testing-tinderbox.html" title="9.5. Tinderbox" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">9.4. <code class="varname">PREFIX</code> и
      <code class="varname">DESTDIR</code></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="testing-porttools.html">Пред.</a> </td><th width="60%" align="center">Глава 9. Тестирование вашего порта</th><td width="20%" align="right"> <a accesskey="n" href="testing-tinderbox.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="porting-prefix"></a>9.4. <code class="varname">PREFIX</code> и
      <code class="varname">DESTDIR</code></h2></div></div></div><p>Переменная <code class="varname">PREFIX</code> определяет, куда будет
      установлен порт.  По умолчанию это
      <code class="filename">/usr/local</code>, но может меняться
      пользователем на собственный путь, такой как
      <code class="filename">/opt</code>.  В вашем порту значение этой
      переменной должно учитываться.</p><p>Если пользователь установил переменную
      <code class="varname">DESTDIR</code>, то она определяет полное
      альтернативное окружение, обычно, это jail или установленная
      система, смонтированная в месте, отличном от
      <code class="filename">/</code>.  На самом деле порт устанавливается в
      <code class="filename">DESTDIR/PREFIX</code> и регистрируется в базе
      данных пакетов в <code class="filename">DESTDIR/var/db/pkg</code>.
      Поскольку управление <code class="varname">DESTDIR</code> производится
      автоматически инфраструктурой портов с помощью <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chroot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">chroot</span>(8)</span></a>,
      вам не нужны никакие изменения или проявление особой
      осторожности при написании портов, совместымых с
      <code class="varname">DESTDIR</code>.</p><p>Значение переменной <code class="varname">PREFIX</code> будет
      установлено в <code class="varname">LOCALBASE</code> (по умолчанию
      <code class="filename">/usr/local</code>).  Если задана переменная
      <code class="varname">USE_LINUX_PREFIX</code>, то
      <code class="varname">PREFIX</code> примет значение
      <code class="varname">LINUXBASE</code> (по умолчанию
      <code class="filename">/compat/linux</code>).</p><p>Избегание явно прописываемых путей
      <code class="filename">/usr/local</code> в исходном коде сделает порт
      гораздо более гибким и способным удовлетворить потребности
      других серверов.  Часто этого можно добиться простой заменой
      строк <code class="filename">/usr/local</code> в различных файлах
      <code class="filename">Makefile</code> внутри порта на
      <code class="literal">${PREFIX}</code>.  Эта переменная
      автоматически передаётся далее на каждом этапе построения и
      установки.</p><p>Проверьте, что ваше приложение не устанавливает чего-либо в
      каталог <code class="filename">/usr/local</code> вместо
      <code class="varname">PREFIX</code>.  Наличие явно указанных путей можно
      быстро проверить следующим образом:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make clean; make package PREFIX=/var/tmp/`make -V PORTNAME`</code></strong></pre><p>Если что-то было установлено за пределами
      <code class="varname">PREFIX</code>, то процесс создания пакета сообщит
      об отсутствии файлов.</p><p>Это также стоит проверить с использованием поддержки
      каталога сборки (смотрите <a class="xref" href="special.html#staging" title="6.1. Staging">Раздел 6.1, <<Staging>></a>):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make stage &amp;&amp; make check-orphans &amp;&amp; make package</code></strong></pre><p>Эти проверки не найдут явно указанных путей внутри файлов
      порта и не проверят корректность использования
      <code class="varname">LOCALBASE</code> в качестве ссылки на файлы из
      других портов.  Порт, временно установленный в
      <code class="filename">/var/tmp/`make -V PORTNAME`</code>, следует
      проверять на работоспособность, чтобы убедиться в отсутствии
      проблем с путями.</p><p>Переменная <code class="varname">PREFIX</code> не должна задаваться
      явно в файле <code class="filename">Makefile</code> порта.  Пользователи
      при установке порта могут задать в <code class="varname">PREFIX</code>
      свое собственное место, и порт должен учитывать это
      значение.</p><p>Обратитесь к программам/файлам из других портов с
      переменными, перечисленными выше, без указания явных маршрутов.
      Например, если ваш порт требует, чтобы макрос
      <code class="literal">PAGER</code> являлся полным путем утилиты
      <code class="command">less</code>, не используйте строковый путь
      <code class="filename">/usr/local/bin/less</code>.  Вместо этого
      используйте <code class="literal">${LOCALBASE}</code>:</p><pre class="programlisting">-DPAGER=\"${LOCALBASE}/bin/less\"</pre><p>Путь с использованием <code class="varname">LOCALBASE</code> имеет
      больше шансов оставаться работоспособным, если системный
      администратор переместил всё дерево
      <code class="filename">/usr/local</code> куда-то в другое место.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="testing-porttools.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="testing.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="testing-tinderbox.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">9.3. Port Tools </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 9.5. Tinderbox</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>