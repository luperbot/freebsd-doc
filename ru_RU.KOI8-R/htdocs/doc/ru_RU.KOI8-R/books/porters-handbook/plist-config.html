<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>7.3. Конфигурационные файлы</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD по созданию портов" /><link rel="up" href="plist.html" title="Глава 7. Продвинутые практики pkg-plist" /><link rel="prev" href="plist-cleaning.html" title="7.2. Пустые каталоги" /><link rel="next" href="plist-dynamic.html" title="7.4. Динамический или статический список упаковки" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">7.3. Конфигурационные файлы</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="plist-cleaning.html">Пред.</a> </td><th width="60%" align="center">Глава 7. Продвинутые практики <code class="filename">pkg-plist</code></th><td width="20%" align="right"> <a accesskey="n" href="plist-dynamic.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="plist-config"></a>7.3. Конфигурационные файлы</h2></div></div></div><p>Если ваш порт устанавливает конфигурационные файлы в
      каталог <code class="filename">PREFIX/etc</code> (или куда-то еще),
      <span class="emphasis"><em>не</em></span> делайте их простого перечисления в
      файле <code class="filename">pkg-plist</code>.  Это приведёт к тому, что
      по команде <code class="command">pkg delete</code> или при новой
      установке файлы, тщательно отредактированные и настроенные
      пользователем, будут уничтожены.</p><p>Вместо этого установите файл(ы) с примерами с расширением
      <code class="filename">filename.sample</code>.  Затем скопируйте файл с
      примером на место настоящего файла конфигурации, если таковой
      ещё не существует.  При деинсталляции удаляйте файл
      конфигурации только в том случае, если он идентичен файлу с
      расширением <code class="filename">.sample</code>.  Вам нужно управлять
      этим в <code class="filename">Makefile</code> и в
      <code class="filename">pkg-plist</code> (для установки из
      пакета).</p><p>Пример части <code class="filename">Makefile</code>:</p><pre class="programlisting">post-install:
	@if [ ! -f ${PREFIX}/etc/orbit.conf ]; then \
	${CP} -p ${PREFIX}/etc/orbit.conf.sample ${STAGEDIR}${PREFIX}/etc/orbit.conf ; \
	fi</pre><p>Добавьте по три строки в <code class="filename">pkg-plist</code> для
      каждого конфигурационного файла, как показано ниже:</p><pre class="programlisting">@unexec if cmp -s %D/etc/orbit.conf.sample %D/etc/orbit.conf; then rm -f %D/etc/orbit.conf; fi
etc/orbit.conf.sample
@exec if [ ! -f %D/etc/orbit.conf ] ; then cp -p %D/%F %B/orbit.conf; fi</pre><p>Данные строки являются упорядоченными.  На этапе удаления
      файл с примером сравнивается с рабочим конфигурационным файлом.
      Полное совпадение означает отсутствие каких-либо изменений в
      рабочем файле со стороны пользователя, и следовательно этот
      файл может быть безопасно удалён.  Так как файл с примером всё
      ещё должен существовать для сравнения, строка
      <code class="literal">@unexec</code> следует перед именем файла с
      примером конфигурации.  На этапе установки, если рабочий файл
      конфигурации отсутствует, он копируется из файла с примером.
      Файл с примером обязательно должен быть установлен до операции
      копирования, поэтому строка <code class="literal">@exec</code> следует
      после имени файла с примером конфигурации.</p><p>Для получения дополнительного отладочного вывода на экран
      можно временно удалить параметр <code class="literal">-s</code> из
      команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cmp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cmp</span>(1)</span></a>.</p><p>Для получения дополнительной инфорации по использованию
      <code class="literal">%D</code> и прочих маркеров подстановки обратитесь
      к странице Справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pkg-create&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pkg-create</span>(8)</span></a>.</p><p>Если существует действительно стоящая причина не
      устанавливать рабочий файл конфигурации по умолчанию, уберите
      строку <code class="literal">@exec</code> из
      <code class="filename">pkg-plist</code> и добавьте <a class="link" href="pkg-files.html#porting-message" title="8.1. pkg-message">сообщение</a>, указывающее на
      то, что пользователь обязан скопировать и отредактировать этот
      файл перед тем, как программное обеспечение начнёт
      работать.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="plist-cleaning.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="plist.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="plist-dynamic.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">7.2. Пустые каталоги </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 7.4. Динамический или статический список упаковки</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>