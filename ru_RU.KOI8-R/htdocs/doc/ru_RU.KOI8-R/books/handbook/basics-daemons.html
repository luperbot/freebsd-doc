<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>4.9. Даемоны, сигналы, уничтожение процессов</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="basics.html" title="Глава 4. Основы UNIX" /><link rel="prev" href="basics-processes.html" title="4.8. Процессы" /><link rel="next" href="shells.html" title="4.10. Интерпретатор команд" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.9. Даемоны, сигналы, уничтожение процессов</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="basics-processes.html">Пред.</a> </td><th width="60%" align="center">Глава 4. Основы UNIX</th><td width="20%" align="right"> <a accesskey="n" href="shells.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="basics-daemons"></a>4.9. Даемоны, сигналы, уничтожение процессов</h2></div></div></div><p>Если вы запускаете редактор, им можно легко управлять, открывать в
      нем файлы и т.д.  Вы можете делать это, поскольку редактор предоставляет
      такие возможности и потому, что редактор присоединен к
      <em class="firstterm">терминалу</em>.  Некоторые программы разработаны
      без поддержки интерфейса пользователя, поэтому они отсоединяются от
      терминала при первой возможности.  Например, веб-сервер целый день
      отвечает на запросы из сети, и ему как правило не требуется ваше вмешательство.
      Программы, передающие почту от сервера к серверу - другой пример
      приложений этого класса.</p><p>Мы называем эти программы <em class="firstterm">даемонами</em>.  Даемоны это
      персонажи греческой мифологии: хорошие или плохие, они были спутниками
      человека и, вообще говоря, выполняли полезную работу для людей, почти как
      веб- и почтовые серверы выполняют полезную работу сегодня.  Это причина,
      по которой талисманом BSD долгое время является веселый даемон в кедах и с
      вилами.</p><p>Есть соглашение, по которому имя программы, которая обычно запускается
      как даемон, заканчивается на <span class="quote"><<<span class="quote">d</span>>></span>.  <span class="application">BIND</span>
      это Berkeley Internet Name Domain, а выполняемая программа называется
      <code class="command">named</code>; программа веб сервера
      <span class="application">Apache</span> называется <code class="command">httpd</code>;
      даемон очереди печати это <code class="command">lpd</code> и так далее.  Это соглашение,
      а не жесткое правило; например, главный почтовый даемон для
      <span class="application">Sendmail</span> называется
      <code class="command">sendmail</code>, а не <code class="command">maild</code>, как вы могли бы
      предположить.</p><p>Иногда может потребоваться взаимодействие с процессом даемона.
      Один из способов взаимодействия с процессом даемона (или с любым другим
      запущенным процессом) - это посылка ему так называемого
      <em class="firstterm">сигнала</em>.
      Есть множество различных сигналов - некоторые
      из них имеют специальное значение, другие обрабатываются приложением,
      реакция которого на эти сигналы должна быть описана в документации.
      Вы можете посылать сигналы только тем процессам,
      владельцем которых являетесь.  Если вы отправите сигнал какому-то другому
      процессу с помощью <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> или <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">kill</span>(2)</span></a>, доступ будет запрещен.
      Исключением из правил является пользователь <code class="systemitem">root</code>,
      который может отправлять сигналы любому процессу.</p><p>В некоторых случаях FreeBSD тоже посылает сигналы приложениям.  Если
      приложение плохо написано и пробует обратиться к области памяти, к
      которой оно не должно обращаться, FreeBSD посылает процессу сигнал
      <em class="firstterm">нарушение сегментации</em> (<code class="literal">SIGSEGV</code>).
      Если приложение использует системный вызов <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=alarm&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">alarm</span>(3)</span></a>, чтобы получить
      уведомление по истечении определенного периода времени, будет отправлен
      сигнал Alarm (<code class="literal">SIGALRM</code>) и т.д.</p><p>Два сигнала могут быть использованы для завершения процесса,
      <code class="literal">SIGTERM</code> и <code class="literal">SIGKILL</code>.
      <code class="literal">SIGTERM</code> это корректный способ завершить процесс;
      процесс может <span class="emphasis"><em>поймать</em></span> сигнал, определить, что его
      хотят завершить, закрыть любые файлы, которые он мог открыть,
      и закончить то, что он делал в момент перед закрытием.  В некоторых
      случаях процесс может даже игнорировать <code class="literal">SIGTERM</code>,
      если выполняет задачу, которая не может быть прервана.</p><p><code class="literal">SIGKILL</code> не может быть проигнорирован процессом.
      Этот сигнал говорит <span class="quote"><<<span class="quote">Меня не волнует что ты делаешь -
      остановись немедленно</span>>></span>.  Если вы посылаете процессу
      <code class="literal">SIGKILL</code>, FreeBSD сразу же остановит этот
	процесс<a href="#ftn.idp79620304" class="footnote" id="idp79620304"><sup class="footnote">[4]</sup></a>.</p><p>Другие сигналы, которые возможно вам понадобятся,
      <code class="literal">SIGHUP</code>, <code class="literal">SIGUSR1</code>, и
      <code class="literal">SIGUSR2</code>.  Это сигналы общего назначения,
      различные приложения могут по-разному реагировать на них.</p><p>Предположим, что вы изменили файл конфигурации веб сервера -
      теперь нужно указать ему перечитать конфигурацию.  Можно остановить
      и запустить <code class="command">httpd</code>, но это приведет к кратковременной
      остановке сервера, которая может быть нежелательна.  Большинство даемонов
      написаны так, чтобы при получении сигнала <code class="literal">SIGHUP</code>
      перечитывать файлы конфигурации.  Поэтому вместо уничтожения и запуска
      <code class="command">httpd</code> можно послать сигнал <code class="literal">SIGHUP</code>.
      Поскольку нет стандартного способа реагирования на этот сигнал, различные
      даемоны будут вести себя по разному; прочитайте документацию на даемон
      по этому вопросу.</p><p>Сигналы посылаются с помощью команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a>, как показано в этом
      примере.</p><div class="procedure"><a id="idp79626448"></a><div class="procedure-title">Процедура 4.1. Отправка сигнала процессу</div><p>Этот пример показывает как послать сигнал <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>.  Файл
	конфигурации <code class="command">inetd</code>
	<code class="filename">/etc/inetd.conf</code>, <code class="command">inetd</code> перечитает
	этот файл, если ему отправить сигнал <code class="literal">SIGHUP</code>.</p><ol class="procedure" type="1"><li class="step"><p>Нужно определить PID процесса, которому вы хотите отправить сигнал.
	  Сделайте это с помощью <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=grep&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">grep</span>(1)</span></a>.  Команда <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=grep&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">grep</span>(1)</span></a>
	  используется для поиска по заданной строке в выходном потоке.  Эта
	  команда запускается под обычным пользователем, а <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> под
	  <code class="systemitem">root</code>, поэтому <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> должна быть запущена с
	  параметром <code class="option">ax</code>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ps -ax | grep inetd</code></strong>
  198  ??  IWs    0:00.00 inetd -wW</pre><p>Итак, PID <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> 198.  В некоторых случаях в выводе команды
	  может также появиться <code class="literal">grep inetd</code>.  Это из-за способа,
	  которым <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> получает список запущенных процессов.</p></li><li class="step"><p>Используйте <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> для отправки сигнала.  Поскольку
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> запускается из под <code class="systemitem">root</code>,
	  нужно сначала использовать <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> для получения прав
	  <code class="systemitem">root</code>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>su</code></strong>
<code class="prompt">Password:</code>
<code class="prompt">#</code> <strong class="userinput"><code>/bin/kill -s HUP 198</code></strong></pre><p>Как и большинство команд <span class="trademark">UNIX</span>(R), <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> ничего не выведет,
	  если отработает нормально.  Если вы посылаете сигнал процессу,
	  которым не владеете, на экране появится <span class="errorname">kill:
	  <em class="replaceable"><code>PID</code></em>: Operation not
	  permitted</span>.  При неправильно набранном PID вы или отправите
	  сигнал другому процессу, что может привести к неприятностям, или, если
	  повезет, сигнал будет отправлен на PID, который в данный момент не
	  используется - на экране появится <span class="errorname">kill:
	  <em class="replaceable"><code>PID</code></em>: No such process</span>.</p><div xmlns="" class="note"><h3 class="admontitle">Зачем использовать <code xmlns="http://www.w3.org/1999/xhtml" class="command">/bin/kill</code>?: </h3><p xmlns="http://www.w3.org/1999/xhtml">Во многих оболочках команда <code class="command">kill</code> встроена;
	    таким образом, оболочка вместо вызова <code class="filename">/bin/kill</code>
	    сама посылает сигнал.  Это может быть очень полезно, но в разных
	    оболочках имя сигнала указывается по-разному.  Чем
	    пытаться выучить их все, гораздо проще использовать
	    <code class="command">/bin/kill <em class="replaceable"><code>...</code></em></code>
	    непосредственно.</p></div></li></ol></div><p>Отправка других сигналов очень похожа, просто замените
      <code class="literal">TERM</code> или <code class="literal">KILL</code> в командной
      строке на имя другого сигнала.</p><div xmlns="" class="important"><h3 class="admontitle">Важно: </h3><p xmlns="http://www.w3.org/1999/xhtml">Уничтожение процессов наугад может быть плохой идеей.  В частности,
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a>, чей PID 1, имеет особое значение.  Выполнение
	<code class="command">/bin/kill -s KILL 1</code> - быстрый способ перегрузить
	систему.  <span class="emphasis"><em>Всегда</em></span> дважды проверяйте параметры
	запуска <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> <span class="emphasis"><em>перед</em></span> тем, как нажать
	<span class="keycap"><strong>Enter</strong></span>.</p></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp79620304" class="footnote"><p><a href="#idp79620304" class="para"><sup class="para">[4] </sup></a>Не совсем верно - есть несколько действий, которые не могут
	  быть прерваны.  Например, если процесс пытается прочитать файл на
	  другом компьютере в сети, и другой компьютер по какой-то причине не
	  отвечает (был выключен, или в сети произошла ошибка), процесс
	  находится в так называемом <span class="quote"><<<span class="quote">непрерываемом состоянии</span>>></span>.
	  В конце концов время ожидания закончится, обычно это происходит через
	  две минуты.  Как только время закончится, процесс будет
	  уничтожен.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="basics-processes.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="basics.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="shells.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">4.8. Процессы </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 4.10. Интерпретатор команд</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>