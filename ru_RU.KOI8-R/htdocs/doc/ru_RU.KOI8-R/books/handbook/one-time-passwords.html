<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>14.5. Одноразовые пароли</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="security.html" title="Глава 14. Безопасность" /><link rel="prev" href="crypt.html" title="14.4. DES, MD5, и шифрование" /><link rel="next" href="tcpwrappers.html" title="14.6. TCP Wrappers" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.5. Одноразовые пароли</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="crypt.html">Пред.</a> </td><th width="60%" align="center">Глава 14. Безопасность</th><td width="20%" align="right"> <a accesskey="n" href="tcpwrappers.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="one-time-passwords"></a>14.5. Одноразовые пароли</h2></div></div></div><a id="idp88316496" class="indexterm"></a><a id="idp88317008" class="indexterm"></a><p>FreeBSD использует для одноразовых паролей
      OPIE (One-time Passwords In Everything).
      OPIE по умолчанию использует MD5.</p><p>Есть три различных вида паролей, о которых мы поговорим ниже.
      Первый вид это ваш обычный пароль <span class="trademark">UNIX</span>(R) или пароль Kerberos; мы
      будем называть его <span class="quote"><<<span class="quote">пароль <span class="trademark">UNIX</span>(R)</span>>></span>.  Второй вид это
      одноразовый пароль, сгенерированный программой
      OPIE <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=opiekey&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">opiekey</span>(1)</span></a> и принимаемый
      командой <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">opiepasswd</span>(1)</span></a>
      и в приглашении login; мы будем называть их <span class="quote"><<<span class="quote">одноразовыми
      паролями</span>>></span>.  Последний вид паролей это защищенные пароли, которые
      вы передаете программам <code class="command">opiekey</code> (и иногда
      <code class="command">opiepasswd</code>),
      и которые эти программы используют для создания одноразовых паролей;
      мы будем называть его <span class="quote"><<<span class="quote">защищенными паролями</span>>></span> или просто
      <span class="quote"><<<span class="quote">паролями</span>>></span>.</p><p>Защищенный пароль не имеет никакого отношения к вашему паролю
      <span class="trademark">UNIX</span>(R); они могут быть одинаковыми, но это не рекомендуется.
      Защищенные пароли OPIE не ограничены 8-ю символами, как
      старые <span class="trademark">UNIX</span>(R) пароли<a href="#ftn.idp88325200" class="footnote" id="idp88325200"><sup class="footnote">[6]</sup></a>,
      они могут быть настолько длинными, насколько вы захотите.  Очень часто
      используются пароли длиной в шесть или семь символов.  По большей части
      система OPIE работает полностью независимо от системы
      паролей <span class="trademark">UNIX</span>(R).</p><p>Помимо паролей, есть два других вида данных, важных для
      OPIE.  Первый, известный как <span class="quote"><<<span class="quote">seed</span>>></span> или
      <span class="quote"><<<span class="quote">ключ</span>>></span>, состоит из двух букв и пяти цифр.  Другой,
      называемый <span class="quote"><<<span class="quote">счетчиком цикла</span>>></span>, это номер от 1 до 100.
      OPIE создает одноразовый пароль, соединяя ключ и защищенный пароль,
      а затем применяя MD4 столько раз, сколько указано счетчиком цикла и
      выдает результат в виде шести коротких слов на английском.  Эти шесть
      слов на английском и есть ваш одноразовый пароль.  Система
      аутентификации (как правило PAM) хранит последний использованный
      одноразовый пароль, и пользователь аутентифицируется если хэш вводимого
      пользователем пароля совпадает с предыдущим паролем.  Поскольку
      используется односторонний хэш, невозможно сгенерировать следующий
      одноразовый пароль если получен предыдущий; счетчик цикла уменьшается
      после каждого успешного входа для поддержки синхронизации пользователя
      с программой login.  Когда счетчик цикла уменьшается до 1, набор OPIE
      должен быть переинициализирован.</p><p>В каждой из обсуждаемых ниже систем задействованы три программы.
      Программа <code class="command">opiekey</code>
      получает счетчик цикла, ключ и защищенный пароль и создает одноразовый
      пароль или последовательный список одноразовых паролей.  Программа
      <code class="command">opiepasswd</code>
      используется для инициализации OPIE соответственно,
      и для смены паролей, счетчиков цикла, или ключей; она принимает
      защищенный пароль или счетчик цикла, ключ и одноразовый пароль.
      Программа <code class="command">opieinfo</code>
      проверяет соответствующий файл (<code class="filename">/etc/opiekeys</code>)
      и печатает текущий счетчик
      цикла и ключ вызывающего пользователя.</p><p>Мы рассмотрим четыре вида операций.  Первая это использование
      <code class="command">opiepasswd</code> через
      защищенное соединение для первоначальной настройки системы одноразовых
      паролей, или для изменения пароля или ключа.  Вторая операция это
      использование в тех же целях
      <code class="command">opiepasswd</code> через незащищенное соединение, в сочетании
      с <code class="command">opiekey</code> через защищенное
      соединение.  Третья это использование
      <code class="command">opiekey</code> для входа через
      незащищенное соединение.  Четвертая это использование
      <code class="command">opiekey</code> для генерации
      набора ключей, которые могут быть записаны или распечатаны для
      соединения из места, где защищенное соединение недоступно.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88336592"></a>14.5.1. Защищенная установка соединения</h3></div></div></div><p>Для первоначальной настройки OPIE используется команда
	<code class="command">opiepasswd</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiepasswd -c</code></strong>
[grimreaper] ~ $ opiepasswd -f -c
Adding unfurl:
Only use this method from the console; NEVER from remote. If you are using
telnet, xterm, or a dial-in, type ^C now or exit with no password.
Then run opiepasswd without the -c parameter.
Using MD5 to compute responses.
Enter new secret pass phrase:
Again new secret pass phrase:
ID unfurl OTP key is 499 to4268
MOS MALL GOAT ARM AVID COED
</pre><p>В приглашениях <code class="prompt">Enter new secret pass phrase:</code> или
	<code class="prompt">Enter secret password:</code>, введите пароль или фразу.
	Запомните, это не тот пароль, с которым вы будете входить, он
	используется для генерации одноразовых паролей.  Строка
	<span class="quote"><<<span class="quote">ID</span>>></span> содержит информацию для вашего конкретного случая:
	имя пользователя, счетчик цикла и ключ.  При входе система запомнит
	эти параметры и отправит их вам, поэтому их не надо запоминать.  В
	последней строке находится одноразовый пароль, соответствующий
	этим параметрам и секретному паролю; если вы войдете в систему сразу,
	используйте этот одноразовый пароль.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88340688"></a>14.5.2. Незащищенная установка соединения</h3></div></div></div><p>Для инициализации или изменения защищенного пароля через
	незащищенное соединение, вам потребуется существующее защищенное
	соединение куда-то, где вы сможете запустить
	<code class="command">opiekey</code>; это может быть
	shell на компьютере, которому вы доверяете.
	Вам потребуется также установить значение счетчика цикла (100
	возможно подойдет), и задать ключ или использовать сгенерированный.
	Через незащищенное соединение (к компьютеру, на котором производится
	настройка), используйте команду <code class="command">opiepasswd</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiepasswd</code></strong>

Updating unfurl:
You need the response from an OTP generator.
Old secret pass phrase:
        otp-md5 498 to4268 ext
        Response: GAME GAG WELT OUT DOWN CHAT
New secret pass phrase:
        otp-md5 499 to4269
        Response: LINE PAP MILK NELL BUOY TROY

ID mark OTP key is 499 gr4269
LINE PAP MILK NELL BUOY TROY
</pre><p>Чтобы принять ключ по умолчанию нажмите <span class="keycap"><strong>Enter</strong></span>.
	Затем, перед вводом пароля доступа введите те же параметры в
	вашем защищенном соединении или средстве доступа OPIE:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiekey 498 to4268</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Don't use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT
</pre><p>Теперь переключитесь на незащищенное соединение и скопируйте
	одноразовый пароль, сгенерированный соответствующей программой.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88350288"></a>14.5.3. Создание одного одноразового пароля</h3></div></div></div><p>Как только вы настроите OPIE, во время входа появится
	приглашение вроде этого:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>telnet example.com</code></strong>
Trying 10.0.0.1...
Connected to example.com
Escape character is '^]'.

FreeBSD/i386 (example.com) (ttypa)

login: <strong class="userinput"><code>&lt;username&gt;</code></strong>
otp-md5 498 gr4269 ext
Password: </pre><p>Кроме того, у OPIE есть полезная особенность (не
	показанная здесь): если вы нажмете <span class="keycap"><strong>Enter</strong></span>
	в приглашении на ввод пароля, включится эхо, и вы сможете увидеть
	то, что вводите.  Это может быть очень полезно, если вы пытаетесь
	ввести пароль вручную, например с распечатки.</p><a id="idp88353616" class="indexterm"></a><a id="idp88354128" class="indexterm"></a><a id="idp88354640" class="indexterm"></a><p>В этот момент вам потребуется сгенерировать одноразовый пароль,
	чтобы ввести его в приглашение.  Это должно быть выполнено на
	защищенной системе, в которой вы можете запустить
	<code class="command">opiekey</code> (есть версии
	для DOS, <span class="trademark">Windows</span>(R) и <span class="trademark">Mac OS</span>(R)).  Им требуются значения счетчика цикла
	и ключ в качестве параметров командной строки.  Вы можете скопировать
	и вставить их прямо из приглашения login компьютера, на который
	входите.</p><p>В защищенной системе:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiekey 498 to4268</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Don't use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</pre><p>Теперь, когда у вас есть одноразовый пароль, можете продолжить
	вход в систему.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88358992"></a>14.5.4. Создание нескольких одноразовых паролей</h3></div></div></div><p>Иногда вы отправляетесь туда, где нет доступа к защищенному
	компьютеру или защищенному соединению.  В этом случае, можно
	использовать команду
	<code class="command">opiekey</code> для создания нескольких одноразовых
	паролей, которые вы сможете распечатать и забрать с собой.
	Например:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiekey -n 5 30 zz99999</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Don't use opiekey from telnet or dial-in sessions.
Enter secret pass phrase: <strong class="userinput"><code>&lt;secret password&gt;</code></strong>
26: JOAN BORE FOSS DES NAY QUIT
27: LATE BIAS SLAY FOLK MUCH TRIG
28: SALT TIN ANTI LOON NEAL USE
29: RIO ODIN GO BYE FURY TIC
30: GREW JIVE SAN GIRD BOIL PHI</pre><p>Параметр <code class="option">-n 5</code> запрашивает пять паролей,
	<code class="option">30</code> указывает значение последнего счетчика цикла.
	Обратите внимание, что пароли печатаются в
	<span class="emphasis"><em>обратном</em></span> по сравнению с обычным использованием
	порядке.  Если вы действительно параноик, перепишите результат
	вручную; иначе скопируйте и передайте его <code class="command">lpr</code>.
	Обратите внимание, что каждая линия содержит как счетчик цикла, так
	и одноразовый пароль; вам может показаться удобным отрывать пароль
	после использования.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88372176"></a>14.5.5. Ограничение использования <span class="trademark">UNIX</span>(R) паролей</h3></div></div></div><p>OPIE может ограничивать использование паролей <span class="trademark">UNIX</span>(R) на основе IP
	адреса.  Соответствующий файл называется
	<code class="filename">/etc/opieaccess</code>, он существует по умолчанию.
	Обратитесь к
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=opieaccess&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">opieaccess</span>(5)</span></a> за более подробной информацией об этом файле и о
	предосторожностях, которые вы должны предпринять при использовании
	этого файла.</p><p>Вот пример файла <code class="filename">opieaccess</code>:</p><pre class="programlisting">permit 192.168.0.0 255.255.0.0</pre><p>Эта строка позволяет пользователям, чей IP адрес (который
	подвержен подделке) соответствует указанному значению и маске,
	входить с паролем <span class="trademark">UNIX</span>(R).</p><p>Если ни одно из правил в <code class="filename">opieaccess</code> не
	сработало, поведением по умолчанию является запрет всех не-OPIE
	входов.</p></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp88325200" class="footnote"><p><a href="#idp88325200" class="para"><sup class="para">[6] </sup></a>В FreeBSD стандартный пароль
      может быть до 128 символов длиной.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="crypt.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="tcpwrappers.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">14.4. DES, MD5, и шифрование </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 14.6. TCP Wrappers</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>