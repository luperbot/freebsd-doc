<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>23.3. PPP уровня ядра</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="ppp-and-slip.html" title="Глава 23. PPP и SLIP" /><link rel="prev" href="userppp.html" title="23.2. PPP уровня пользователя" /><link rel="next" href="ppp-troubleshoot.html" title="23.4. Решение проблем с соединениями PPP" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">23.3. PPP уровня ядра</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="userppp.html">Пред.</a> </td><th width="60%" align="center">Глава 23. PPP и SLIP</th><td width="20%" align="right"> <a accesskey="n" href="ppp-troubleshoot.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ppp"></a>23.3. PPP уровня ядра</h2></div><div><span class="authorgroup">Части документа первоначально предоставили <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Gennady B.</span> <span class="surname">Sorokopud</span></span>  <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Robert</span> <span class="surname">Huff</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95837392"></a>23.3.1. Настройка PPP уровня ядра</h3></div></div></div><a id="idp95838032" class="indexterm"></a><p>Перед началом настройки PPP на вашем компьютере, убедитесь, что
	<code class="command">pppd</code> находится в <code class="filename">/usr/sbin</code>
	и каталог <code class="filename">/etc/ppp</code> существует.</p><p><code class="command">pppd</code> может работать в двух режимах:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>В качестве <span class="quote"><<<span class="quote">клиента</span>>></span> - когда вы хотите
	    подключить компьютер к внешнему миру через последовательное
	    соединение PPP или модемную линию.</p></li><li class="listitem"><a id="idp95843024" class="indexterm"></a><p>В качестве <span class="quote"><<<span class="quote">сервера</span>>></span> - когда компьютер
	    подключен к сети и используется для подключения других
	    компьютеров через PPP.</p></li></ol></div><p>В обеих случаях вам потребуется настроить файл параметров
	(<code class="filename">/etc/ppp/options</code> или
	<code class="filename">~/.ppprc</code> если на вашем компьютере
	более одного пользователя работают с PPP).</p><p>Вам потребуется также программа для модемных/последовательных
	линий (предпочтительно <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/comms/kermit/pkg-descr">comms/kermit</a>) для дозвона и установки
	соединения с удаленным хостом.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95846864"></a>23.3.2. Использование <code class="command">pppd</code> в качестве клиента</h3></div><div><span class="authorgroup">Основано на информации, предоставленной <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Trev</span> <span class="surname">Roydhouse</span></span>. </span></div></div></div><a id="idp95849680" class="indexterm"></a><a id="idp95850448" class="indexterm"></a><p>Для подключения к линии PPP терминального сервера Cisco
	может использоваться следующий файл
	<code class="filename">/etc/ppp/options</code>.</p><pre class="programlisting">crtscts	 # enable hardware flow control
modem           # modem control line
noipdefault     # remote PPP server must supply your IP address
                # if the remote host does not send your IP during IPCP
                # negotiation, remove this option
passive         # wait for LCP packets
domain ppp.foo.com      # put your domain name here

:&lt;remote_ip&gt;    # put the IP of remote PPP host here
                # it will be used to route packets via PPP link
                # if you didn't specified the noipdefault option
                # change this line to &lt;local_ip&gt;:&lt;remote_ip&gt;

defaultroute    # put this if you want that PPP server will be your
                # default router</pre><p>Для подключения:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><a id="idp95857232" class="indexterm"></a><a id="idp95857744" class="indexterm"></a><p>Дозвонитесь на удаленный хост, используя
	    <span class="application">kermit</span> (или любую другую модемную
	    программу), и введите ваше имя пользователя и пароль (или
	    те данные, которые требуются для установления PPP соединения
	    с удаленным хостом).</p></li><li class="step"><p>Выйдите из <span class="application">kermit</span> (без
	    обрыва соединения).</p></li><li class="step"><p>Введите следующее:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/src/usr.sbin/pppd.new/pppd <em class="replaceable"><code>/dev/tty01</code></em> <em class="replaceable"><code>19200</code></em></code></strong></pre><p>Убедитесь, что выбраны подходящая скорость и правильное имя
	    устройства.</p></li></ol></div><p>Теперь ваш компьютер подключен по PPP.  Если соединение не
	состоялось, вы можете добавить параметр <code class="option">debug</code>
	к файлу <code class="filename">/etc/ppp/options</code>, и отследить
	проблему по сообщениям на консоли.</p><p>Следующий скрипт <code class="filename">/etc/ppp/pppup</code> проведет все
	3 стадии в автоматическом режиме:</p><pre class="programlisting">#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.dial
pppd /dev/tty01 19200</pre><a id="idp95865552" class="indexterm"></a><p><code class="filename">/etc/ppp/kermit.dial</code> это скрипт
	<span class="application">kermit</span>, который дозванивается до
	удаленного хоста и проходит необходимую авторизацию (пример
	такого скрипта находится в конце этого раздела).</p><p>Используйте следующий скрипт <code class="filename">/etc/ppp/pppdown</code>
	для отключения от PPP линии:</p><pre class="programlisting">#!/bin/sh
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ X${pid} != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill -TERM ${pid}
fi

ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

/sbin/ifconfig ppp0 down
/sbin/ifconfig ppp0 delete
kermit -y /etc/ppp/kermit.hup
/etc/ppp/ppptest</pre><p>Проверьте, запущен ли еще <code class="command">pppd</code>,
	выполнив <code class="filename">/usr/etc/ppp/ppptest</code>, который выглядит
	примерно так:</p><pre class="programlisting">#!/bin/sh
pid=`ps ax| grep pppd |grep -v grep|awk '{print $1;}'`
if [ X${pid} != "X" ] ; then
        echo 'pppd running: PID=' ${pid-NONE}
else
        echo 'No pppd running.'
fi
set -x
netstat -n -I ppp0
ifconfig ppp0</pre><p>Для обрыва соединения, выполните
	<code class="filename">/etc/ppp/kermit.hup</code>, который должен
	содержать:</p><pre class="programlisting">set line /dev/tty01	; put your modem device here
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
echo \13
exit</pre><p>Существует альтернативный метод, использующий
	<code class="command">chat</code> вместо <code class="command">kermit</code>:</p><p>Для установления соединения <code class="command">pppd</code>достаточно
	двух файлов.</p><p><code class="filename">/etc/ppp/options</code>:</p><pre class="programlisting">/dev/cuaa1 115200

crtscts		# enable hardware flow control
modem		# modem control line
connect "/usr/bin/chat -f /etc/ppp/login.chat.script"
noipdefault	# remote PPP serve must supply your IP address
	        # if the remote host doesn't send your IP during
                # IPCP negotiation, remove this option
passive         # wait for LCP packets
domain &lt;your.domain&gt;	# put your domain name here

:		# put the IP of remote PPP host here
	        # it will be used to route packets via PPP link
                # if you didn't specified the noipdefault option
                # change this line to &lt;local_ip&gt;:&lt;remote_ip&gt;

defaultroute	# put this if you want that PPP server will be
	        # your default router</pre><p><code class="filename">/etc/ppp/login.chat.script</code>:</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Все это может быть расположено на одной строке.</p></div><pre class="programlisting">ABORT BUSY ABORT 'NO CARRIER' "" AT OK ATDT&lt;phone.number&gt;
  CONNECT "" TIMEOUT 10 ogin:-\\r-ogin: &lt;login-id&gt;
  TIMEOUT 5 sword: &lt;password&gt;</pre><p>Как только эти файлы будут созданы и отредактированы, необходимо
	только запустить <code class="command">pppd</code>, вот так:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pppd</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95881808"></a>23.3.3. Использование <code class="command">pppd</code> в качестве сервера</h3></div></div></div><p><code class="filename">/etc/ppp/options</code> должен содержать примерно
	следующее:</p><pre class="programlisting">crtscts                         # Hardware flow control
netmask 255.255.255.0           # netmask (not required)
192.114.208.20:192.114.208.165  # IP's of local and remote hosts
                                # local ip must be different from one
                                # you assigned to the Ethernet (or other)
                                # interface on your machine.
                                # remote IP is IP address that will be
                                # assigned to the remote machine
domain ppp.foo.com              # your domain
passive                         # wait for LCP
modem                           # modem line</pre><p>Следующий скрипт <code class="filename">/etc/ppp/pppserv</code>
	укажет <span class="application">pppd</span> работать в качестве
	сервера:</p><pre class="programlisting">#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi

# reset ppp interface
ifconfig ppp0 down
ifconfig ppp0 delete

# enable autoanswer mode
kermit -y /etc/ppp/kermit.ans

# run ppp
pppd /dev/tty01 19200</pre><p>Используйте этот скрипт <code class="filename">/etc/ppp/pppservdown</code>
	для остановки сервера:</p><pre class="programlisting">#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing pppd, PID=' ${pid}
        kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'killing kermit, PID=' ${pid}
        kill -9 ${pid}
fi
ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.noans</pre><p>Следующий <span class="application">kermit</span> скрипт
	(<code class="filename">/etc/ppp/kermit.ans</code>) включит/отключит
	режим ответа модема на входящие звонки.  Он должен выглядеть
	примерно так:</p><pre class="programlisting">set line /dev/tty01
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
inp 5 OK
echo \13
out ATS0=1\13   ; change this to out ATS0=0\13 if you want to disable
                ; autoanswer mode
inp 5 OK
echo \13
exit</pre><p>Скрипт, называющийся <code class="filename">/etc/ppp/kermit.dial</code>,
	используется для дозвона и аутентификации на удаленном хосте.
	Вам потребуется приспособить его под собственные нужды.  Поместите
	ваш логин и пароль в этот скрипт; вам также потребуется изменить
	операторы input в зависимости от ответов от модема и удаленного
	хоста.</p><pre class="programlisting">;
; put the com line attached to the modem here:
;
set line /dev/tty01
;
; put the modem speed here:
;
set speed 19200
set file type binary            ; full 8 bit file xfer
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none
set modem hayes
set dial hangup off
set carrier auto                ; Then SET CARRIER if necessary,
set dial display on             ; Then SET DIAL if necessary,
set input echo on
set input timeout proceed
set input case ignore
def \%x 0                       ; login prompt counter
goto slhup

:slcmd                          ; put the modem in command mode
echo Put the modem in command mode.
clear                           ; Clear unread characters from input buffer
pause 1
output +++                      ; hayes escape sequence
input 1 OK\13\10                ; wait for OK
if success goto slhup
output \13
pause 1
output at\13
input 1 OK\13\10
if fail goto slcmd              ; if modem doesn't answer OK, try again

:slhup                          ; hang up the phone
clear                           ; Clear unread characters from input buffer
pause 1
echo Hanging up the phone.
output ath0\13                  ; hayes command for on hook
input 2 OK\13\10
if fail goto slcmd              ; if no OK answer, put modem in command mode

:sldial                         ; dial the number
pause 1
echo Dialing.
output atdt9,550311\13\10               ; put phone number here
assign \%x 0                    ; zero the time counter

:look
clear                           ; Clear unread characters from input buffer
increment \%x                   ; Count the seconds
input 1 {CONNECT }
if success goto sllogin
reinput 1 {NO CARRIER\13\10}
if success goto sldial
reinput 1 {NO DIALTONE\13\10}
if success goto slnodial
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if &lt; \%x 60 goto look
else goto slhup

:sllogin                        ; login
assign \%x 0                    ; zero the time counter
pause 1
echo Looking for login prompt.

:slloop
increment \%x                   ; Count the seconds
clear                           ; Clear unread characters from input buffer
output \13
;
; put your expected login prompt here:
;
input 1 {Username: }
if success goto sluid
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if &lt; \%x 10 goto slloop         ; try 10 times to get a login prompt
else goto slhup                 ; hang up and start again if 10 failures

:sluid
;
; put your userid here:
;
output ppp-login\13
input 1 {Password: }
;
; put your password here:
;
output ppp-password\13
input 1 {Entering SLIP mode.}
echo
quit

:slnodial
echo \7No dialtone.  Check the telephone line!\7
exit 1

; local variables:
; mode: csh
; comment-start: "; "
; comment-start-skip: "; "
; end:</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="userppp.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="ppp-and-slip.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="ppp-troubleshoot.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">23.2. PPP уровня пользователя </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 23.4. Решение проблем с соединениями <acronym class="acronym">PPP</acronym></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>