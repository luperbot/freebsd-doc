<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>8.6. Сканеры</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="multimedia.html" title="Глава 8. Мультимедиа" /><link rel="prev" href="tvcard.html" title="8.5. Настройка ТВ тюнеров" /><link rel="next" href="kernelconfig.html" title="Глава 9. Настройка ядра FreeBSD" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">8.6. Сканеры</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="tvcard.html">Пред.</a> </td><th width="60%" align="center">Глава 8. Мультимедиа</th><td width="20%" align="right"> <a accesskey="n" href="kernelconfig.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="scanners"></a>8.6. Сканеры</h2></div><div><span class="authorgroup">Написана <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div><div><span class="authorgroup">Перевод на русский язык: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Дмитрий</span> <span class="surname">Морозовский</span></span>. </span></div></div></div><a id="idp82262608" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82263376"></a>8.6.1. Введение</h3></div></div></div><p>В FreeBSD доступ к сканерам обеспечивается программой
	<span class="application">SANE</span> (Scanner Access Now
	Easy), обеспечивающей универсальный интерфейс
	(<acronym class="acronym">API</acronym>)
	и доступной в коллекции портов FreeBSD.  Для общения со сканерами
	<span class="application">SANE</span> использует некоторые драйвера
	устройств FreeBSD.</p><p>FreeBSD поддерживает сканеры с интерфейсом как SCSI, так и USB.
	Убедитесь, что ваш сканер поддерживается
	<span class="application">SANE</span> перед тем, как приступить к
	конфигурации.  Для
	<span class="application">SANE</span> существует <a class="link" href="http://www.sane-project.org/sane-supported-devices.html" target="_top">список
	поддерживаемых устройств</a> где находится информация
	о поддержке сканера и статусе этой поддержки.
	Кроме того, страница справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=uscanner&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">uscanner</span>(4)</span></a> также перечисляет
	поддерживаемые устройства.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82268240"></a>8.6.2. Конфигурация ядра</h3></div></div></div><p>Как уже отмечалось, поддерживаются как SCSI, так и USB сканеры.
	В зависимости от интерфейса вашего сканера требуется поддержка разных
	драйверов устройств.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="scanners-kernel-usb"></a>8.6.2.1. USB</h4></div></div></div><p>Стандартное ядро <code class="filename">GENERIC</code> включает в себя
	  драйвера, необходимые для поддержки USB сканеров.  Если вы
	  компилируете собственное ядро, убедитесь, что в его конфигурации
	  присутствуют строки</p><pre class="programlisting">device usb
device uhci
device ohci
device uscanner</pre><p>В зависимости от чипсета USB, встроенного в вашу материнскую
	  плату, потребуется лишь один из драйверов <code class="literal">device
	  uhci</code> или <code class="literal">device ohci</code>, однако, наличие
	  обеих строк в конфигурации ядра никому не повредит.</p><p>Если вы не хотите перестраивать ядро, и при этом ваше ядро не
	  является стандартным (<code class="filename">GENERIC</code>), вы можете
	  загрузить модуль драйвера поддержки сканеров <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=uscanner&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">uscanner</span>(4)</span></a>
	  при помощи команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload uscanner</code></strong></pre><p>Для автоматической загрузки модуля при старте системы добавьте
	  в файл <code class="filename">/boot/loader.conf</code> строку</p><pre class="programlisting">uscanner_load="YES"</pre><p>После перезагрузки с новым ядром или загрузки модуля подключите
	  ваш USB сканер.  В буфере системных сообщений (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a>) должна
	  появиться строка об обнаружении сканера:</p><pre class="screen">uscanner0: EPSON EPSON Scanner, rev 1.10/3.02, addr 2</pre><p>В данном случае сканер будет использовать устройство
	  <code class="filename">/dev/uscanner0</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82279376"></a>8.6.2.2. SCSI</h4></div></div></div><p>Если ваш сканер имеет интерфейс SCSI, важно знать, к какому
	  контроллеру он подключен.  В зависимости от контроллера потребуются
	  различные драйвера в файле конфигурации ядра.  Стандартное ядро
	  <code class="filename">GENERIC</code> поддерживает большинство
	  распространенных SCSI-контроллеров.  Внимательно прочитайте файл
	  <code class="filename">NOTES</code> и добавьте необходимые строки в файл
	  конфигурации вашего ядра.  Помимо строки для драйвера адаптера,
	  вам потребуются следующие строки:</p><pre class="programlisting">device scbus
device pass</pre><p>После установки и загрузки нового ядра, в буфере системных
	  сообщений должны появиться строки о вашем сканере, например:</p><pre class="screen">pass2 at aic0 bus 0 target 2 lun 0
pass2: &lt;AGFA SNAPSCAN 600 1.10&gt; Fixed Scanner SCSI-2 device
pass2: 3.300MB/s transfers</pre><p>Если сканер не был включен в момент загрузки, его можно
	  принудительно опознать, выполнив сканирование SCSI шины при
	  помощи команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=camcontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">camcontrol</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>camcontrol rescan all</code></strong>
Re-scan of bus 0 was successful
Re-scan of bus 1 was successful
Re-scan of bus 2 was successful
Re-scan of bus 3 was successful</pre><p>После этого сканер должен появиться в списке устройств:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>camcontrol devlist</code></strong>
&lt;IBM DDRS-34560 S97B&gt;              at scbus0 target 5 lun 0 (pass0,da0)
&lt;IBM DDRS-34560 S97B&gt;              at scbus0 target 6 lun 0 (pass1,da1)
&lt;AGFA SNAPSCAN 600 1.10&gt;           at scbus1 target 2 lun 0 (pass3)
&lt;PHILIPS CDD3610 CD-R/RW 1.00&gt;     at scbus2 target 0 lun 0 (pass2,cd0)</pre><p>Более подробная информация о устройствах SCSI доступна на
	  страницах справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scsi&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">scsi</span>(4)</span></a> и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=camcontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">camcontrol</span>(8)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82292304"></a>8.6.3. Конфигурация SANE</h3></div></div></div><p>Система <span class="application">SANE</span> состоит из двух частей:
	аппаратной поддержки (backend, <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/graphics/sane-backends/pkg-descr">graphics/sane-backends</a>) и программной
	поддержки (frontend, <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/graphics/sane-frontends/pkg-descr">graphics/sane-frontends</a>).  Первая часть
	обеспечивает собственно доступ к сканеру.  <a class="link" href="http://www.sane-project.org/sane-supported-devices.html" target="_top">Список
	поддерживаемых устройств</a> <span class="application">SANE</span>
	содержит информацию о необходимом вам аппаратном модуле.
	Вторая часть обеспечивает графический интерфейс для сканирования
	(<span class="application">xscanimage</span>).</p><p>В первую очередь следует установить порт или пакет <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/graphics/sane-backends/pkg-descr">graphics/sane-backends</a>, после чего при
	помощи команды <code class="command">sane-find-scanner</code> проверить
	поддержку сканера системой <span class="application">SANE</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sane-find-scanner -q</code></strong>
found SCSI scanner "AGFA SNAPSCAN 600 1.10" at /dev/pass3</pre><p>В выводе должны присутствовать интерфейс сканера и имя
	используемого устройства.  Производитель и модель сканера могут
	отсутствовать: это нормально.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Некоторым USB сканерам может потребоваться загрузка прошивки.
	  Подробности смотрите в страницах справочника драйвера сканера,
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sane-find-scanner&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">sane-find-scanner</span>(1)</span></a> и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sane&amp;sektion=7"><span class="citerefentry"><span class="refentrytitle">sane</span>(7)</span></a>.</p></div><p>Теперь необходимо убедиться, что сканер опознан программой
	графического интерфейса.  В состав системы
	<span class="application">SANE</span> входит утилита <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scanimage&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scanimage</span>(1)</span></a>,
	позволяющая работать со сканером из командной строки.  Опция
	<code class="option">-L</code> используется для показа информации
	о сканере:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>scanimage -L</code></strong>
device `snapscan:/dev/pass3' is a AGFA SNAPSCAN 600 flatbed scanner</pre><p>Отсутствие сообщений или сообщение об отсутствии устройств
	означает, что утилита <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scanimage&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scanimage</span>(1)</span></a> не смогла идентифицировать
	сканер.  В этом случае вам потребуется отредактировать файл
	конфигурации аппаратного модуля и указать устройство, используемое
	сканером.  Все файлы настройки находятся в каталоге
	<code class="filename">/usr/local/etc/sane.d/</code>.
	Такие проблемы присущи некоторым моделям USB сканеров.
      </p><p>Например, в случае USB сканера, описанного в <a class="xref" href="scanners.html#scanners-kernel-usb" title="8.6.2.1. USB">Раздел 8.6.2.1, <<USB>></a>, утилита
	<code class="command">sane-find-scanner</code> выдаст следующую информацию:
      </p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sane-find-scanner -q</code></strong>
found USB scanner (UNKNOWN vendor and product) at device /dev/uscanner0</pre><p>Сканер обнаружен корректно, он использует интерфейс USB
	и доступен через устройство <code class="filename">/dev/uscanner0</code>.
	Теперь попробуем идентифицировать его:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>scanimage -L</code></strong>

No scanners were identified. If you were expecting something different,
check that the scanner is plugged in, turned on and detected by the
sane-find-scanner tool (if appropriate). Please read the documentation
which came with this software (README, FAQ, manpages).</pre><p>Поскольку сканер не идентифицирован, нам потребуется изменить
	файл конфигурации
	<code class="filename">/usr/local/etc/sane.d/epson.conf</code>.
	В нашем примере использован сканер <span class="trademark">EPSON
  Perfection</span>(R) 1650, так что
	мы знаем, что будет использоваться драйвер <code class="literal">epson</code>.
	Не забудьте прочитать комментарии в файле конфигурации.  Требуемые
	изменения весьма просты: закомментируйте все строки, описывающие
	интерфейсы, не соответствующие интерфейсу вашего сканера (в нашем
	случае, все строки, начинающиеся со <code class="literal">scsi</code>: наш
	сканер использует интерфейс USB), и добавьте в конец файла строку,
	содержащую интерфейс и имя использованного устройства.
	Мы добавим строку</p><pre class="programlisting">usb /dev/uscanner0</pre><p>Пожалуйста, прочтите комментарии в файле конфигурации, а также
	страницы справочника для более полной информации.  Теперь мы можем
	проверить, что наш сканер опознан:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>scanimage -L</code></strong>
device `epson:/dev/uscanner0' is a Epson GT-8200 flatbed scanner</pre><p>Наш USB сканер опознан.  Не столь важно, что имя и номер модели
	не совпадают, главное, что используются правильные имя устройства
	и драйвер: <code class="literal">`epson:/dev/uscanner0'</code>.</p><p>После того как команда <code class="command">scanimage -L</code> опознала
	сканер, конфигурация завершена.  Все готово к сканированию.</p><p>Хотя утилита <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scanimage&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scanimage</span>(1)</span></a> позволяет производить сканирование
	из командной строки, как правило, для сканирования предпочтительнее
	использовать графический интерфейс.  Для этого в состав
	<span class="application">SANE</span> входит простая, но эффективная
	утилита <span class="application">xscanimage</span> (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/graphics/sane-frontends/pkg-descr">graphics/sane-frontends</a>).</p><p>Другой популярной программой графического интерфейса к сканеру
	является <span class="application">Xsane</span> (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/graphics/xsane/pkg-descr">graphics/xsane</a>).  Эта программа
	поддерживает такие расширенные возможности, как разные режимы
	сканирования (фотокопия, факс и т.п.), цветокоррекцию, потоковое
	сканирование и другие.  Оба приложения пригодны для использования
	в качестве плагинов сканирования для <span class="application">GIMP</span>.
      </p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82328400"></a>8.6.4. Доступ к сканеру для других пользователей</h3></div></div></div><p>Все описанные операции выполнялись нами с привилегиями
	суперпользователя (<code class="systemitem">root</code>).  Вам может
	потребоваться дать доступ к сканеру другим пользователям.
	Для этого необходимо разрешить доступ на чтение и запись
	к файлу устройства, обслуживающему сканер.  В нашем примере
	USB сканер использует устройство <code class="filename">/dev/uscanner0</code>,
	принадлежащее группе <code class="systemitem">operator</code>.
	Добавление пользователя <code class="systemitem">joe</code> в группу
	<code class="systemitem">operator</code> разрешит ему использовать сканер:
      </p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw groupmod operator -m <em class="replaceable"><code>joe</code></em></code></strong></pre><p>За подробностями обращайтесь к странице справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a>.
	Вам также потребуется установить нужные права доступа (0660 или 0664)
	к устройству <code class="filename">/dev/uscanner0</code>, поскольку по
	умолчанию группа <code class="systemitem">operator</code> может лишь
	читать из него.  Это достигается добавлением следующей строки
	в файл <code class="filename">/etc/devfs.rules</code>:</p><pre class="programlisting">[system=5]
add path uscanner0 mode 660</pre><p>Затем добавьте в файл конфигурации системы
	<code class="filename">/etc/rc.conf</code> такую строку (после чего
	перезагрузите систему):</p><pre class="programlisting">devfs_system_ruleset="system"</pre><p>Подробную информацию о правах на файлы устройств вы найдете
	на странице справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Разумеется, по соображениям безопасности, вы должны как следует
	  подумать, прежде чем добавлять пользователя в другие группы,
	  в особенности в группу <code class="systemitem">operator</code>.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="tvcard.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="multimedia.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="kernelconfig.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">8.5. Настройка ТВ тюнеров </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> Глава 9. Настройка ядра FreeBSD</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>