<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>5. Устранение неполадок с журналированием</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Настройка журналирования UFS для настольного компьютера." /><link rel="up" href="index.html" title="Настройка журналирования UFS для настольного компьютера." /><link rel="prev" href="configure-journal.html" title="4. Настройка журналирования" /><link rel="next" href="further-reading.html" title="6. Для дальнейшего ознакомления" /><link rel="copyright" href="trademarks.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. Устранение неполадок с журналированием</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="configure-journal.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="further-reading.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="troubleshooting-gjournal"></a>5. Устранение неполадок с журналированием</h2></div></div></div><p>Этот раздел содержит часто задаваемые вопросы касательно неполадок,
      связанных с журналированием.</p><div class="qandaset"><a id="idp72334288"></a><dl><dt>5.1. <a href="troubleshooting-gjournal.html#idp72334928">Я получаю паники ядра во время высокой дисковой активности.
	    Как это связано с журналированием?</a></dt><dt>5.2. <a href="troubleshooting-gjournal.html#idp72341072">Я допустил некоторые ошибки во время конфигурирования,
	    теперь система не загружается. Можно это как-нибудь
	    исправить?</a></dt><dt>5.3. <a href="troubleshooting-gjournal.html#idp72369872">Возможно ли отказаться от журналирования и вернуться
	    к моей привычной файловой системе с механизмом Soft Updates?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp72334928"></a><a id="kernel-panic"></a><p><strong>5.1.</strong></p></td><td align="left" valign="top"><p>Я получаю паники ядра во время высокой дисковой активности.
	    Как это связано с журналированием?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Вероятно, что журнал заполняется раньше, чем происходит
	    сброс его на диск. Помните, размер журнала зависит от
	    загруженности диска, а не от размера поставщика данных.
	    Если загрузка диска высокая, вам потребуется раздел большего
	    размера для журнала. См. замечания в разделе
	    <a class="link" href="understanding-journaling.html" title="2. Реализация журналирования в FreeBSD">Реализация
	    журналирования</a></p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp72341072"></a><a id="unable-boot"></a><p><strong>5.2.</strong></p></td><td align="left" valign="top"><p>Я допустил некоторые ошибки во время конфигурирования,
	    теперь система не загружается. Можно это как-нибудь
	    исправить?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Вы либо забыли внести запись (опечатались) в
	    <code class="filename">/boot/loader.conf</code>, либо есть ошибки в
	    файле <code class="filename">/etc/fstab</code>. Это легко исправить.
	    Нажмите <span class="keycap"><strong>Enter</strong></span>, чтобы получить приглашение
	    командного интерпретатора в однопользовательском режиме.
	    Потом, проверьте возможные варианты:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat /boot/loader.conf</code></strong></pre><p>Если отсутствует запись <code class="literal">geom_journal_load</code>,
	    или она содержит ошибки, журналируемые устройства не создадутся.
	    Загрузите модуль вручную, примонтируйте все разделы и
	    переходите в многопользовательский режим (продолжайте
	    загрузку).</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal load</code></strong>

GEOM_JOURNAL: Journal 2948326772: ad0s1g contains journal.
GEOM_JOURNAL: Journal 3193218002: ad0s1h contains journal.
GEOM_JOURNAL: Journal 3193218002: ad0s1d contains data.
GEOM_JOURNAL: Journal ad0s1d clean.
GEOM_JOURNAL: Journal 2948326772: ad0s1f contains data.
GEOM_JOURNAL: Journal ad0s1f clean.

<code class="prompt">#</code> <strong class="userinput"><code>mount -a</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong>
<span class="emphasis"><em>(boot continues)</em></span></pre><p>Если же запись о <code class="literal">geom_journal_load</code>
	    верна, то проверьте <code class="filename">/etc/fstab</code>.
	    Вероятней всего, что вы обнаружите опечатку или отсутствие
	    необходимой записи. В этом случае смонтируйте вручную
	    оставшиеся разделы и продолжите загрузку в многопользовательский
	    режим.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp72369872"></a><a id="remove-journaling"></a><p><strong>5.3.</strong></p></td><td align="left" valign="top"><p>Возможно ли отказаться от журналирования и вернуться
	    к моей привычной файловой системе с механизмом Soft Updates?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Несомненно. Используйте приведенную ниже последовательность
	    действий, которая обращает изменения. Разделы, созданные для
	    поставщиков журналов, могут позже быть использованы для других
	    целей.</p><p>Залогиньтесь <code class="systemitem">root</code> и переведите систему
	    в однопользовательский режим:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown now</code></strong></pre><p>Размонтируйте журналируемые разделы:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>umount /usr /var</code></strong></pre><p>Синхронизируйте журналы:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal sync</code></strong></pre><p>Остановите поставщиков журналов:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal stop ad0s1d.journal</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gjournal stop ad0s1f.journal</code></strong></pre><p>Удалите метаданные журналирования со всех задействованных
	    устройств:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal clear ad0s1d</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gjournal clear ad0s1f</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gjournal clear ad0s1g</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gjournal clear ad0s1h</code></strong></pre><p>Снимите флаг журналирования и установите флаг механизма Soft
	    Updates:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tunefs -J disable -n enable ad0s1d</code></strong>

tunefs: gjournal cleared
tunefs: soft updates set

<code class="prompt">#</code> <strong class="userinput"><code>tunefs -J disable -n enable ad0s1f</code></strong>

tunefs: gjournal cleared
tunefs: soft updates set</pre><p>Смонтируйте вручную старые (первоначальные) устройства:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -o rw /dev/ad0s1d /var</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -o rw /dev/ad0s1f /usr</code></strong></pre><p>Откройте файл <code class="filename">/etc/fstab</code> и приведите
	    его к изначальному виду:</p><pre class="programlisting">/dev/ad0s1f     /usr            ufs     rw      2       2
/dev/ad0s1d     /var            ufs     rw      2       2</pre><p>И напоследок, удалите строку, загружающую модуль
	    <code class="literal">geom_journal</code>, из файла
	    <code class="filename">/boot/loader.conf</code> и перезагрузите
	    операционную систему.</p></td></tr></tbody></table></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="configure-journal.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="further-reading.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">4. Настройка журналирования </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 6. Для дальнейшего ознакомления</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>