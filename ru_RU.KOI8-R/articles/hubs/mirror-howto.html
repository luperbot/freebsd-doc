<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>3. Как вести зеркало FreeBSD</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Поддержка зеркал FreeBSD" /><link rel="up" href="index.html" title="Поддержка зеркал FreeBSD" /><link rel="prev" href="mirror-requirements.html" title="2. Требования к зеркалам FreeBSD" /><link rel="next" href="mirror-where.html" title="4. С какого сервера синхронизироваться" /><link rel="copyright" href="trademarks.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. Как вести зеркало FreeBSD</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mirror-requirements.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="mirror-where.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mirror-howto"></a>3. Как вести зеркало FreeBSD</h2></div></div></div><p>Теперь вам известно, какая потребуется машина и как предоставлять
      сервисы, но не как получить их самому. :-)
      В этом разделе описывается процесс ведения зеркала и поддержания
      его в актуальном состоянии, в том числе какие инструменты
      использовать и какие сайты выбирать в качестве источников для
      синхронизации.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-ftp-rsync"></a>3.1. Зеркалирование FTP-области</h3></div></div></div><p>Файлы, доступные по FTP, составляют большую часть зеркала.
	Они включают <span class="emphasis"><em>дистрибутивные наборы</em></span>, необходимые
	для установки по сети, <span class="emphasis"><em>ветви (branches)</em></span>,
	в которых отражено текущее состояние исходных текстов,
	<span class="emphasis"><em>образы ISO</em></span> для записи компакт-дисков с
	дистрибутивами для установки, образами <span class="quote"><<<span class="quote">живых</span>>></span> файловых
	систем и пакетами, дерево портов, исходные дистрибутивы для сборки
	портов и кучу готовых пакетов.  И, разумеется, все
	вышеописанное - для разных версий FreeBSD и различных
	архитектур.</p><p>Наиболее эффективным будет синхронизация FTP-области при помощи
	  <span class="application">rsync</span>.  Для этого следует установить
	  пакет <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/rsync/pkg-descr">net/rsync</a>, который был
	  описан в разделе <a class="xref" href="mirror-requirements.html#mirror-serv-rsync" title="2.4.2. Rsync (необязательный сервис для FTP зеркала)">Раздел 2.4.2, <<Rsync (необязательный сервис для FTP зеркала)>></a>.
	  Поскольку доступ по протоколу <span class="application">rsync</span> не
	  является обязательным, выбранный вами сайт может его не
	  поддерживать.  Возможно, вам придется немного поискать в сетевой
	  окрестности зеркало, поддерживающее
	  <span class="application">rsync</span>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Поскольку от количества клиентов
	    <span class="application">rsync</span> ощутимо зависит загрузка сервера,
	    большинство администраторов вводят ограничения доступа.  Для
	    поддержания зеркала вам следует связаться с администратором сайта,
	    с которым вы будете синхронизироваться, для уточнения локальных
	    правил и, возможно, для внесения в них исключения для вас
	    (поскольку вы также поддерживаете зеркало).</p></div><p>Строка для синхронизации FreeBSD по rsync выглядит примерно
	  так:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>rsync -vaHz --delete rsync://ftp4.de.FreeBSD.org/FreeBSD/ /pub/FreeBSD/</code></strong></pre><p>Загляните в документацию по <span class="application">rsync</span>,
	  также доступную по адресу
	  <a class="link" href="http://rsync.samba.org/" target="_top">http://rsync.samba.org/</a>
	  за дополнительной информацией по различным опциям rsync.
	  Обратите внимание, что в случае синхронизации модуля целиком (а не
	  отдельного каталога) необходимо явно указать результирующий каталог,
	  потому что каталог с именем модуля (в данном случае "FreeBSD")
	  не создается.  Для поддержания актуальности вам потребуется
	  создать скрипт для запуска подобной команды из <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-www"></a>3.2. Зеркалирование страниц WWW</h3></div></div></div><p>Веб-сайт FreeBSD следует зеркалировать исключительно при
	помощи <span class="application">rsync</span>.</p><p>Командная строка для синхронизации веб-сайта FreeBSD
	выглядит примерно так:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>rsync -vaHz --delete rsync://bit0.us-west.freebsd.org/FreeBSD-www-data/ /usr/local/www/</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-how-often"></a>3.3. Как часто синхронизироваться?</h3></div></div></div><p>Каждое зеркало должно регулярно обновляться.  Вам потребуется
	какой-то набор скриптов, выполняемых посредством <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>.
	Поскольку каждый администратор, как правило, пишет такие скрипты сам
	и на свой лад, мы не можем выдать конкретных указаний.  Общие же советы
	выглядят так:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Создайте скрипт с командой, которая запустит нужное приложение
	    для обновления зеркала.  Рекомендуем использовать скрипт на языке
	    обычного <code class="command">/bin/sh</code>.</p></li><li class="step"><p>Добавьте команд перенаправления вывода, чтобы записать
	    диагностику работы в файл.</p></li><li class="step"><p>Попробуйте, как ваш скрипт работает.  По завершении проверьте
	    логи.</p></li><li class="step"><p>При помощи утилиты <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">crontab</span>(1)</span></a> добавьте ваш скрипт в таблицу
	    регулярных заданий <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">crontab</span>(5)</span></a> соответствующего пользователя.
	    Это должен быть пользователь, отличный от пользователя FTP-даемона,
	    чтобы файлы в FTP-области без атрибута "чтение для всех" не были
	    доступны анонимным FTP-пользователям.  Данное свойство используется
	    для тестирования перед выходом новых релизов, для того чтобы
	    удостовериться, что все официальные зеркала содержат все
	    необходимые файлы к моменту официального объявления релиза.</p></li></ol></div><p>Некоторые рекомендуемые установки частоты обновления:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FTP-набор: раз в сутки</p></li><li class="listitem"><p>WWW-страницы: раз в сутки</p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mirror-requirements.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="mirror-where.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">2. Требования к зеркалам FreeBSD </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 4. С какого сервера синхронизироваться</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>