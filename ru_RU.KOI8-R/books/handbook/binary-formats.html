<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>4.13. Бинарные форматы</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="basics.html" title="Глава 4. Основы UNIX" /><link rel="prev" href="basics-devices.html" title="4.12. Устройства и файлы устройств" /><link rel="next" href="basics-more-information.html" title="4.14. Дополнительная информация" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.13. Бинарные форматы</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="basics-devices.html">Пред.</a> </td><th width="60%" align="center">Глава 4. Основы UNIX</th><td width="20%" align="right"> <a accesskey="n" href="basics-more-information.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="binary-formats"></a>4.13. Бинарные форматы</h2></div></div></div><p>Для понимания того, почему FreeBSD использует формат
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=elf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">elf</span>(5)</span></a>, вам потребуется сначала немного узнать
      о трех <span class="quote"><<<span class="quote">доминирующих</span>>></span> исполняемых форматах для
      <span class="trademark">UNIX</span>(R):</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=a.out&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">a.out</span>(5)</span></a></p><p>Старейший и <span class="quote"><<<span class="quote">классический</span>>></span> объектный формат
	  <span class="trademark">UNIX</span>(R).  Он использует короткий и компактный заголовок с
	  магическим числом в начале, которое часто используется для
	  описания формата (смотрите <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=a.out&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">a.out</span>(5)</span></a> с более подробной
	  информацией).  Он содержит три загружаемых сегмента: .text,
	  .data и .bss плюс таблицу символов и таблицу строк.</p></li><li class="listitem"><p><acronym class="acronym">COFF</acronym></p><p>Объектный формат SVR3.  Заголовок включает таблицу разделов,
	  так что могут быть сегменты кроме .text, .data и .bss.</p></li><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=elf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">elf</span>(5)</span></a></p><p>Наследник формата <acronym class="acronym">COFF</acronym>, поддерживающий
	  множественные сегменты и 32-битные или 64-битные значения.  Одно
	  важное замечание: <acronym class="acronym">ELF</acronym> был разработан в
	  предположении что есть только по одному ABI на одну архитектуру.
	  Это предположение совершенно неверно, и не только в мире
	  коммерческих SYSV (в котором есть как минимум три ABI: SVR4,
	  Solaris, SCO).</p><p>FreeBSD пытается обойти эту проблему, в частности предоставляя
	  утилиту для <span class="emphasis"><em>оглавления</em></span> известного
	  исполняемого файла <acronym class="acronym">ELF</acronym> информацией
	  об ABI с которым он совместим.  Обратитесь к странице справочника
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a> за более подробной информацией.</p></li></ul></div><p>FreeBSD имеет произошла из <span class="quote"><<<span class="quote">классического</span>>></span> лагеря и
      использовала формат <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=a.out&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">a.out</span>(5)</span></a>, технологию опробованную и
      проверенную на многих поколениях релизов BSD, до начала ветки
      3.X.  Хотя собирать и запускать родные бинарные
      файлы <acronym class="acronym">ELF</acronym> (и ядро) в системе FreeBSD
      можно было несколько раньше, FreeBSD вначале сопротивлялась
      <span class="quote"><<<span class="quote">проталкиванию</span>>></span> <acronym class="acronym">ELF</acronym> как формата
      по умолчанию.  Почему?  Когда лагерь Linux производил болезненный
      переход к <acronym class="acronym">ELF</acronym>, у него не было большого
      преимущества перед исполняемым форматом <code class="filename">a.out</code>,
      из-за негибкого, основанного на таблице переходов механизма
      разделяемых библиотек, что делало создание разделяемых библиотек
      очень трудным для поставщиков и разработчиков.  Когда доступные
      инструменты <acronym class="acronym">ELF</acronym> предоставили решение проблемы
      разделяемых библиотек, и появилась некоторая перспектива,
      цена перехода была признана допустимой и он был сделан.
      Механизм разделяемых библиотек FreeBSD близок по стилю к механизму
      разделяемых библиотек <span class="trademark">SunOS</span>TM от Sun, и поэтому очень прост в
      использовании.</p><p>Итак, почему так много разных форматов?</p><p>Давно, в темном далеком прошлом, оборудование было простым.
      Это простое оборудование поддерживало простые, маленькие системы.
      <code class="filename">a.out</code> был совершенно адекватен задаче представления
      бинарных файлов на таких простых системах (PDP-11).  Люди, портировавшие
      <span class="trademark">UNIX</span>(R) с этих простых систем, оставили <code class="filename">a.out</code>
      формат потому, что он был достаточен для ранних портов <span class="trademark">UNIX</span>(R) на
      архитектуры, подобные Motorola 68k, VAXen, etc.</p><p>Затем какой-то смышленый инженер по оборудованию решил, что если
      он сможет заставить программы исполнять некоторые трюки, то сможет
      несколько упростить дизайн и заставить ядро CPU работать быстрее.
      Хотя это было сделано с новым типом оборудования (известного сейчас
      как <acronym class="acronym">RISC</acronym>), формат <code class="filename">a.out</code> не подходил для него,
      и было разработано множество форматов, чтобы получить
      лучшую производительность на таком оборудовании по сравнению с
      той, которую мог предоставить простой формат <code class="filename">a.out</code>.
      Были изобретены форматы <acronym class="acronym">COFF</acronym>, <acronym class="acronym">ECOFF</acronym>
      и некоторые другие малоизвестные форматы, и их ограничения были учтены,
      когда все похоже остановились на <acronym class="acronym">ELF</acronym>.</p><p>Кроме того, размеры программ стали огромны, а диски (и оперативная
      память) остались относительно малы, поэтому появилась концепция
      разделяемых библиотек.  Система VM также стала более сложной.
      Хотя все эти усовершенствования были выполнены с форматом
      <code class="filename">a.out</code>, его полезность все больше и больше
      уменьшалась с каждым нововведением.  К тому же потребовалась
      динамическая загрузка во время выполнения, или выгрузка частей
      программы после выполнения стартового кода для экономии
      памяти или места на диске.  Языки усложнялись, и потребовался
      автоматический вызов кода перед главной программой.  Множество
      изменений было внесено в формат <code class="filename">a.out</code>, чтобы
      все это появилось, и в основном работало некоторое время.  Настал
      момент, когда <code class="filename">a.out</code> не смог решить все эти
      проблемы без чрезмерного увеличения размера и сложности.
      В то время, как <acronym class="acronym">ELF</acronym> решил многие из этих проблем,
      перевод этого формата с системы на систему болезнен. Поэтому
      формату <acronym class="acronym">ELF</acronym> пришлось подождать, пока не стало
      более болезненным оставаться с <code class="filename">a.out</code>, чем
      перейти на <acronym class="acronym">ELF</acronym>.</p><p>Тем временем, инструменты разработки, от которых
      произошли  инструменты разработки FreeBSD (особенно ассемблер и
      загрузчик), развивались в двух параллельных направлениях.
      Направление FreeBSD добавило разделяемые библиотеки и устранило
      некоторые ошибки.  Люди из GNU, написавшие эти программы,
      переписали их и добавили простую поддержку сборки
      кросс-компиляторов, подключения различных форматов в будущем
      и так далее.  Многим требовалось собрать кросс-компиляторы
      для FreeBSD, и это не удалось, поскольку устаревшие исходные
      тексты FreeBSD для <span class="application">as</span> и
      <span class="application">ld</span> не подходили для этой задачи.
      Новый набор инструментов GNU (<span class="application">binutils</span>)
      поддерживает кросс-компилирование, <acronym class="acronym">ELF</acronym>,
      разделяемые библиотеки, C++, расширения и т.д.  В дополнение,
      многие поставщики выпустили программы в формате
      <acronym class="acronym">ELF</acronym> и они хорошо подходят для запуска в
      FreeBSD.</p><p><acronym class="acronym">ELF</acronym> более выразителен, чем
      <code class="filename">a.out</code>, позволяет базовой системе быть более
      гибкой.  <acronym class="acronym">ELF</acronym> лучше поддерживается, и
      предоставляет поддержку кросс-компиляторов, что важно для многих
      людей.  <acronym class="acronym">ELF</acronym> может быть немного медленнее,
      чем <code class="filename">a.out</code>, но замерить это сложно.
      Есть также множество деталей, отличающихся для этих двух
      форматов, в том как они отображают страницы, обрабатывают
      начальный код, и т.д.  В этом нет ничего очень важного,
      но они различаются.  В настоящее время поддержка
      <code class="filename">a.out</code> убрана из ядра <code class="filename">GENERIC</code>, и со
      временем будет убрана из ядра, как только потребность в запуске
      старых программ <code class="filename">a.out</code> останется в прошлом.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="basics-devices.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="basics.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="basics-more-information.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">4.12. Устройства и файлы устройств </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 4.14. Дополнительная информация</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>