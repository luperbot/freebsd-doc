<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>22.6. Настройка последовательной консоли</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="serialcomms.html" title="Глава 22. Последовательные соединения" /><link rel="prev" href="dialout.html" title="22.5. Исходящие соединения по модему" /><link rel="next" href="ppp-and-slip.html" title="Глава 23. PPP и SLIP" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">22.6. Настройка последовательной консоли</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="dialout.html">Пред.</a> </td><th width="60%" align="center">Глава 22. Последовательные соединения</th><td width="20%" align="right"> <a accesskey="n" href="ppp-and-slip.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="serialconsole-setup"></a>22.6. Настройка последовательной консоли</h2></div><div><span class="authorgroup">Предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Kazutaka</span> <span class="surname">YOKOTA</span></span>. </span></div><div><span class="authorgroup">Оригинальный документ написал <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Bill</span> <span class="surname">Paul</span></span>. </span></div></div></div><a id="idp95070416" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-intro"></a>22.6.1. Введение</h3></div></div></div><p>FreeBSD может загружаться при использовании в качестве консоли
	текстового терминала на последовательном порту.  Такая конфигурация
	может быть полезна в двух случаях: для системных администраторов,
	устанавливающих FreeBSD на компьютеры без подключенных клавиатуры
	или монитора, и для разработчиков, производящих отладку ядра или
	драйверов устройств.</p><p>Как описано в <a class="xref" href="boot.html" title="Глава 13. Процесс загрузки FreeBSD">Глава 13, <em>Процесс загрузки FreeBSD</em></a>, процесс загрузки FreeBSD
	состоит из трех стадий.  Первые две стадии реализованы в блоке
	загрузки, находящемся в начале слайса FreeBSD на загрузочном
	диске.  На третей стадии загрузочный блок запускает загрузчик
	(<code class="filename">/boot/loader</code>).</p><p>Для настройки последовательной консоли вам потребуется настроить
	блок загрузки, загрузчик и ядро.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-howto-fast"></a>22.6.2. Настройка последовательной консоли, краткая версия</h3></div></div></div><p>В этом разделе предполагается, что вы используете настройки
	по умолчанию
	и просто хотите увидеть краткий обзор настройки последовательной
	консоли.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Соедините кабелем последовательный порт COM1 и управляющий
	    терминал.</p></li><li class="step"><p>Для того, чтобы сообщения в процессе загрузки выводились
	    в последовательную консоль, выполните от имени суперпользователя
	    команду</p><pre class="screen"><code class="prompt">#</code> echo 'console="comconsole"' &gt;&gt; /boot/loader.conf</pre></li><li class="step"><p>Отредактируйте <code class="filename">/etc/ttys</code> и измените
	    <code class="literal">off</code> на <code class="literal">on</code> и
	    <code class="literal">dialup</code> на <code class="literal">vt100</code> для записи
	    <code class="literal">ttyd0</code>.  В противном случае для входа с
	    последовательной консоли не будет требоваться пароль, что
	    может являться проблемой с точки зрения безопасности.</p></li><li class="step"><p>Перезагрузите систему и убедитесь, что последовательная
	    консоль активировалась.</p></li></ol></div><p>Если вам требуется иная конфигурация, обратитесь к более
	подробному описанию в разделе
	<a class="xref" href="serialconsole-setup.html#serialconsole-howto" title="22.6.3. Настройка последовательной консоли">Раздел 22.6.3, <<Настройка последовательной консоли>></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-howto"></a>22.6.3. Настройка последовательной консоли</h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Подготовьте кабель.</p><a id="idp95096272" class="indexterm"></a><p>Вам потребуется нуль-модемный или стандартный
	    последовательный кабель и нуль-модемный адаптер.  Обратитесь к
	    <a class="xref" href="serial.html#serial-cables-ports" title="22.2.2. Кабели и порты">Раздел 22.2.2, <<Кабели и порты>></a>, где рассматриваются
	    последовательные кабели.</p></li><li class="step"><p>Отключите клавиатуру.</p><p>Большинство систем PC тестируют клавиатуру во время включения
	    (POST) и выдают ошибку если клавиатура не обнаружена.  Некоторые
	    системы при отсутствии клавиатуры выдают звуковой сигнал и не
	    загружаются пока клавиатура не будет подключена.</p><p>Если компьютер сообщает об ошибке, но все же загружается,
	    вам не потребуется делать что-то еще.  (Некоторые компьютеры
	    с Phoenix BIOS просто сообщают <span class="errorname">Keyboard
	    failed</span> и продолжают загрузку).</p><p>Если компьютер не загружается без клавиатуры, вам потребуется
	    настроить BIOS так, чтобы отсутствие клавиатуры игнорировалось
	    (если это возможно).  Обратитесь к руководству по материнской
	    плате за деталями о том, как это сделать.</p><div xmlns="" class="tip"><h3 class="admontitle">Подсказка: </h3><p xmlns="http://www.w3.org/1999/xhtml">Установите параметр клавиатуры в настройках BIOS в значение
	      <span class="quote"><<<span class="quote">Not installed</span>>></span>.  При этом вы сможете продолжать
	      использовать клавиатуру.  Все, что делает этот
	      параметр - указывает BIOS не тестировать клавиатуру во
	      время загрузки, поэтому ее отсутствие не вызывает ошибки.
	      Вы можете оставить клавиатуру подключенной, даже если с флагом
	      <span class="quote"><<<span class="quote">Not installed</span>>></span>, и она все еще будет
	      работать.</p></div><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Если в к системе подключена <span class="trademark">PS/2</span>(R) мышь, отключите ее, как
	      и клавиатуру.  Мышь <span class="trademark">PS/2</span>(R) использует часть оборудования
	      совместно с клавиатурой, поэтому если оставить ее подключенной,
	      тестирование клавиатуры может ошибочно выдать наличие
	      последней.  Например, система Gateway 2000 Pentium 90 MHz
	      ведет себя именно так.  К тому же, это не проблема, поскольку
	      мышь без клавиатуры как правило не нужна.</p></div></li><li class="step"><p>Подключите текстовый терминал к <code class="filename">COM1</code>
	    (<code class="filename">sio0</code>).</p><p>Если у вас нет текстового терминала, используйте старый PC/XT
	    с модемной программой, или последовательный порт на другом
	    компьютере <span class="trademark">UNIX</span>(R).  Если порта <code class="filename">COM1</code>
	    (<code class="filename">sio0</code>) нет, подключите его.  На данный
	    момент нет способа использовать другой порт вместо
	    <code class="filename">COM1</code> без перекомпиляции загрузочных
	    блоков.  Если вы уже используете <code class="filename">COM1</code>
	    для подключения другого устройства, временно удалите это
	    устройство установите новый загрузочный блок и ядро как только
	    FreeBSD заработает.  (Предполагается, что
	    <code class="filename">COM1</code> будет доступен на
	    файловом/вычислительном/терминальном сервере в любом случае;
	    если вам действительно требуется <code class="filename">COM1</code>
	    для чего-то другого (и вы не можете переключить это на
	    <code class="filename">COM2</code> (<code class="filename">sio1</code>)),
	    возможно не стоит беспокоиться об этом сейчас.)</p></li><li class="step"><p>Убедитесь, что в файле настройки ядра установлены
	    соответствующие флаги для <code class="filename">COM1</code>
	    (<code class="filename">sio0</code>).</p><p>Подходящие флаги такие:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">0x10</code></span></dt><dd><p>Включает поддержку консоли для этого устройства.  Если
		  установлен этот флаг, другие игнорируются.  На данный
		  момент поддержка консоли может быть включена не более
		  чем на одном устройстве; предпочтительно на первом (в
		  соответствии с порядком в конфигурационном файле) с
		  установкой этого флага.  Эта опция сама по себе не сделает
		  последовательный порт консолью.  Установите следующий
		  флаг или используйте опцию <code class="option">-h</code>,
		  описанную ниже, вместе с этим флагом.</p></dd><dt><span class="term"><code class="literal">0x20</code></span></dt><dd><p>Включает поддержку консоли на устройстве (если нет
		  другой консоли с более высоким приоритетом), независимо
		  от наличия описываемой ниже опции <code class="option">-h</code>.
		  Флаг <code class="literal">0x20</code> должен использоваться вместе
		  с флагом <code class="option">0x10</code>.</p></dd><dt><span class="term"><code class="literal">0x40</code></span></dt><dd><p>Резервирует это устройство (совместно с флагом
		  <code class="literal">0x10</code>) и делает устройство недоступным
		  для обычной работы.  Вы не должны использовать
		  этот флаг для устройства последовательного порта,
		  которое будет использоваться в качестве последовательной
		  консоли.  Используйте этот флаг только если устройство
		  предназначено для удаленной отладки ядра.  Обратитесь
		  к <a class="link" href="../../../../doc/en_US.ISO8859-1/books/developers-handbook/index.html" target="_top">Руководству
		  для разработчиков</a> за дополнительной информацией
		  по удаленной отладке.</p></dd></dl></div><p>Пример:</p><pre class="programlisting">device sio0 at isa? port IO_COM1 flags 0x10 irq 4</pre><p>Обратитесь к странице справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sio&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">sio</span>(4)</span></a> за подробностями.</p><p>Если флаги не были установлены, вам потребуется запустить
	    UserConfig (на другой консоли) или пересобрать ядро.</p></li><li class="step"><p>Создайте <code class="filename">boot.config</code> в корневом каталоге
	    раздела <code class="literal">a</code> на загрузочном диске.</p><p>Этот файл сообщит загрузочному блоку способ загрузки системы.
	    Для активации последовательной консоли вам потребуется одна или
	    несколько следующих опций - несколько опций могут быть
	    указаны на одной строке:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-h</code></span></dt><dd><p>Переключает внутреннюю и последовательную консоль.  Вы
		  можете использовать ее для переключения устройств консоли.
		  Например, при загрузке с внутренней (видео) консоли, вы
		  можете использовать <code class="option">-h</code> для запуска
		  загрузчика и ядра с использованием последовательного порта
		  в качестве устройства консоли.  При загрузке с
		  последовательной консоли, вы можете использовать опцию
		  <code class="option">-h</code> для указания загрузчику и ядру
		  использовать в качестве консоли видео дисплей.</p></dd><dt><span class="term"><code class="option">-D</code></span></dt><dd><p>Переключает одно- и двухконсольную конфигурации. В
		  одноконсольной конфигурации консоль может быть либо
		  внутренней (видео дисплей), либо последовательным портом,
		  в зависимости от состояния опции <code class="option">-h</code>.
		  В двухконсольной конфигурации и видео дисплей и
		  последовательный порт станут консолями одновременно,
		  независимо от состояния опции <code class="option">-h</code>.
		  Имейте ввиду, что конфигурация с двумя консолями работает
		  только во время работы загрузочного блока.  Как только
		  управление переходит к загрузчику, остается только одна
		  консоль, указанная опцией <code class="option">-h</code>.</p></dd><dt><span class="term"><code class="option">-P</code></span></dt><dd><p>Указывает загрузочному блоку протестировать клавиатуру.
		  Если клавиатура не найдена, автоматически устанавливаются
		  параметры <code class="option">-D</code> и
		  <code class="option">-h</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">По причине ограничений на размер в существующей
		    версии загрузочного блока, опция <code class="option">-P</code>
		    может протестировать только расширенные клавиатуры.
		    Клавиатуры с менее чем 101 клавишами (и без клавиш F11
		    и F12) могут быть не обнаружены.  Клавиатуры некоторых
		    лэптопов могут быть не найдены из-за этого ограничения.
		    Если это случилось, вы не сможете использовать опцию
		    <code class="option">-P</code>.  К сожалению, не существует
		    обходного пути решения этой проблемы.</p></div></dd></dl></div><p>Используйте или опцию <code class="option">-P</code> для автоматического
	    выбора консоли, или опцию <code class="option">-h</code> для активации
	    последовательной консоли.</p><p>Вы можете включить также другие опции, описанные в
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=boot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">boot</span>(8)</span></a>.</p><p>Опции, за исключением <code class="option">-P</code>, будут переданы
	    загрузчику (<code class="filename">/boot/loader</code>).  Загрузчик
	    определит будет ли консолью внутреннее видео устройство или
	    последовательный порт, проверив только состояние опции
	    <code class="option">-h</code>.  Это означает, что если вы включите в
	    <code class="filename">/boot.config</code> опцию <code class="option">-D</code>, но
	    не <code class="option">-h</code>, то сможете использовать консоль только
	    во время работы загрузочного блока; загрузчик будет использовать
	    внутреннее видео устройство в качестве консоли.</p></li><li class="step"><p>Загрузите компьютер.</p><p>Когда вы включите компьютер FreeBSD, загрузочный блок выведет
	    содержимое <code class="filename">/boot.config</code> на консоль.
	    Например:</p><pre class="screen">/boot.config: -P
Keyboard: no</pre><p>Вторая строка появится только если вы поместите
	    <code class="option">-P</code> в <code class="filename">/boot.config</code> и
	    отражает наличие/отсутствие клавиатуры.  Эти сообщения
	    выводятся либо на последовательную, либо на внутреннюю
	    консоль, или на обе, в зависимости от параметров в
	    <code class="filename">/boot.config</code>.</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Опции</th><th align="left">Сообщения выводятся на</th></tr></thead><tbody><tr><td>нет</td><td>внутренняя консоль</td></tr><tr><td><code class="option">-h</code></td><td>последовательная консоль</td></tr><tr><td><code class="option">-D</code></td><td>последовательная и внутренняя консоли</td></tr><tr><td><code class="option">-Dh</code></td><td>последовательная и внутренняя консоли</td></tr><tr><td><code class="option">-P</code>, клавиатура присутствует</td><td>внутренняя консоль</td></tr><tr><td><code class="option">-P</code>, клавиатура отсутствует</td><td>последовательная консоль</td></tr></tbody></table></div><p>После вывода вышеприведенных сообщений, происходит небольшая
	    пауза перед тем, как запускается загрузчик и на консоли
	    появляются следующие сообщения.  В нормальной ситуации вам не
	    потребуется прерывать загрузку в этот момент, но это можно
	    сделать, чтобы убедиться, что все настроено правильно.</p><p>Нажмите на консоли любую клавишу кроме
	    <span class="keycode">Enter</span> для прерывания процесса загрузки.
	    Загрузочный блок выдаст приглашение к дальнейшим действиям.
	    Оно выглядит примерно так:</p><pre class="screen">&gt;&gt; FreeBSD/i386 BOOT
Default: 0:ad(0,a)/boot/loader
boot:</pre><p>Убедитесь, что сообщение выше появилось на последовательной,
	    внутренней консоли или на обеих, в зависимости от опций в
	    <code class="filename">/boot.config</code>.  Если сообщение появилось там,
	    где должно было появиться, нажмите <span class="keycode">Enter</span> для
	    продолжения процесса загрузки.</p><p>Если вам нужна последовательная консоль, но на терминале не
	    видно приглашения, это означает проблемы с настройками.  Введите
	    <code class="option">-h</code> и нажмите Enter/Return (если это возможно) для
	    указания загрузочному блоку (а также загрузчику и ядру) выбрать
	    последовательный порт в качестве консоли.  Когда система
	    загрузится, проверьте настройки еще раз и определите, что было
	    сделано неправильно.</p></li></ol></div><p>После запуска загрузчика и перехода в третью стадию процесса
	загрузки вы все еще можете переключиться между внутренней консолью
	и последовательной консолью путем установки соответствующих
	переменных окружения в загрузчике.  Обращайтесь к разделу
	<a class="xref" href="serialconsole-setup.html#serialconsole-loader" title="22.6.6. Изменение консоли из загрузчика">Раздел 22.6.6, <<Изменение консоли из загрузчика>></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-summary"></a>22.6.4. Итоги</h3></div></div></div><p>Здесь приведены краткие итоги по различным настройкам,
	рассмотренным в этом разделе и выбираемым в соответствии с
	ними консолям.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95171536"></a>22.6.4.1. Вариант 1: вы устанавливаете для
	  <code class="filename">sio0</code> флаги 0x10</h4></div></div></div><pre class="programlisting">device sio0 at isa? port IO_COM1 flags 0x10 irq 4</pre><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th align="left">Параметры в /boot.config</th><th align="left">Консоль для загрузочного блока</th><th align="left">Консоль для загрузчика</th><th align="left">Консоль для ядра</th></tr></thead><tbody><tr><td>нет</td><td>внутренняя</td><td>внутренняя</td><td>внутренняя</td></tr><tr><td><code class="option">-h</code></td><td>последовательная</td><td>последовательная</td><td>последовательная</td></tr><tr><td><code class="option">-D</code></td><td>последовательная и внутренняя</td><td>внутренняя</td><td>внутренняя</td></tr><tr><td><code class="option">-Dh</code></td><td>последовательная и внутренняя</td><td>последовательная</td><td>последовательная</td></tr><tr><td><code class="option">-P</code>, клавиатура присутствует</td><td>внутренняя</td><td>внутренняя</td><td>внутренняя</td></tr><tr><td><code class="option">-P</code>, клавиатура отсутствует</td><td>последовательная и внутренняя</td><td>последовательная</td><td>последовательная</td></tr></tbody></table></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95198288"></a>22.6.4.2. Вариант 2: вы устанавливаете для
	  <code class="filename">sio0</code> флаги 0x30</h4></div></div></div><pre class="programlisting">device sio0 at isa? port IO_COM1 flags 0x30 irq 4</pre><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th align="left">Параметры в /boot.config</th><th align="left">Консоль для загрузочного блока</th><th align="left">Консоль для загрузчика</th><th align="left">Консоль для ядра</th></tr></thead><tbody><tr><td>нет</td><td>внутренняя</td><td>внутренняя</td><td>последовательная</td></tr><tr><td><code class="option">-h</code></td><td>последовательная</td><td>последовательная</td><td>последовательная</td></tr><tr><td><code class="option">-D</code></td><td>последовательная и внутренняя</td><td>внутренняя</td><td>последовательная</td></tr><tr><td><code class="option">-Dh</code></td><td>последовательная и внутренняя</td><td>последовательная</td><td>последовательная</td></tr><tr><td><code class="option">-P</code>, клавиатура присутствует</td><td>внутренняя</td><td>внутренняя</td><td>последовательная</td></tr><tr><td><code class="option">-P</code>, клавиатура отсутствует</td><td>последовательная и внутренняя</td><td>последовательная</td><td>последовательная</td></tr></tbody></table></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-tips"></a>22.6.5. Приемы работы с последовательной консолью</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95221968"></a>22.6.5.1. Установка более высокой скорости порта</h4></div></div></div><p>По умолчанию, последовательный порт настроен так: 9600 бит/с,
	  8 бит, без четности, 1 стоп бит.  Если вам необходимо изменить
	  скорость, потребуется перекомпиляция как минимум загрузочных
	  блоков.  Добавьте следующую строку к
	  <code class="filename">/etc/make.conf</code> и скомпилируйте новый
	  загрузочный блок:</p><pre class="programlisting">BOOT_COMCONSOLE_SPEED=19200</pre><p>Обратитесь к <a class="xref" href="serialconsole-setup.html#serialconsole-com2" title="22.6.5.2. Использование для консоли другого последовательного порта вместо sio0">Раздел 22.6.5.2, <<Использование для консоли другого последовательного порта
	  вместо <code class="filename">sio0</code>>></a> за
	  подробными инструкциями по сборке и установке новых загрузочных
	  блоков.</p><p>Если последовательная консоль настраивается не путем установки
	  параметра <code class="option">-h</code>, или последовательная консоль,
	  используемая ядром, отличается от той, что используется загрузочным
	  блоком, потребуется добавить следующие опции к файлу настройки ядра
	  и собрать новое ядро:</p><pre class="programlisting">options CONSPEED=19200</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-com2"></a>22.6.5.2. Использование для консоли другого последовательного порта
	  вместо <code class="filename">sio0</code></h4></div></div></div><p>Использование другого последовательного порта вместо
	  <code class="filename">sio0</code> для консоли потребует кое-какой
	  перекомпиляции.  Если вы по каким-либо причинам хотите использовать
	  другой последовательный порт, перекомпилируйте загрузочный блок,
	  загрузчик и ядро согласно приведенной ниже инструкции.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Получите исходные тексты ядра (глава
	      <a class="xref" href="updating-upgrading.html" title="Глава 21. Обновление системы и смена версии">Глава 21, <em>Обновление системы и смена версии</em></a>)</p></li><li class="step"><p>Отредактируйте <code class="filename">/etc/make.conf</code> и
	      установите <code class="literal">BOOT_COMCONSOLE_PORT</code> в
	      соответствии с адресом порта, который вы хотите использовать
	      (0x3F8, 0x2F8, 0x3E8 или 0x2E8).  Могут быть использованы
	      только устройства от <code class="filename">sio0</code> до
	      <code class="filename">sio3</code> (от <code class="filename">COM1</code>
	      до <code class="filename">COM4</code>); мультипортовые
	      последовательные карты не будут работать.  Установка
	      прерываний не требуется.</p></li><li class="step"><p>Создайте файл настройки ядра и добавьте соответствующие
	      флаги для порта, который планируется использовать.  Например,
	      если вы хотите использовать для консоли
	      <code class="filename">sio1</code>
	      (<code class="filename">COM2</code>):</p><pre class="programlisting">device sio1 at isa? port IO_COM2 flags 0x10 irq 3</pre><p>или</p><pre class="programlisting">device sio1 at isa? port IO_COM2 flags 0x30 irq 3</pre><p>Флаги для других последовательных устройств не
	      устанавливайте.</p></li><li class="step"><p>Соберите и установите загрузочный блок и
	      загрузчик:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /sys/boot</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make clean</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong></pre></li><li class="step"><p>Соберите и установите ядро.</p></li><li class="step"><p>Запишите загрузочный блок на загрузочный диск с помощью
	      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a> и загрузитесь с новым ядром.</p></li></ol></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-ddb"></a>22.6.5.3. Вход в отладчик DDB с последовательной линии</h4></div></div></div><p>Если вы хотите войти в отладчик ядра с последовательной консоли
	  (полезно для удаленной диагностики, но опасно если вы введете
	  неправильный BREAK на последовательном порту!), потребуется
	  собрать ядро со следующими параметрами:</p><pre class="programlisting">options BREAK_TO_DEBUGGER
options DDB</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95252048"></a>22.6.5.4. Получение приглашения на последовательной консоли</h4></div></div></div><p>Хотя это не обязательно, вам может потребоваться приглашение
	  <span class="emphasis"><em>login</em></span> по последовательной линии, в дополнение
	  к уже доступным загрузочным сообщениям и отладочной сессии ядра.
	  Здесь описано как сделать это.</p><p>Откройте файл <code class="filename">/etc/ttys</code> с помощью
	  редактора и найдите строки:</p><pre class="programlisting">ttyd0 "/usr/libexec/getty std.9600" unknown off secure
ttyd1 "/usr/libexec/getty std.9600" unknown off secure
ttyd2 "/usr/libexec/getty std.9600" unknown off secure
ttyd3 "/usr/libexec/getty std.9600" unknown off secure</pre><p>Строки от <code class="literal">ttyd0</code> до <code class="literal">ttyd3</code>
	  соответствуют портам от <code class="filename">COM1</code> до
	  <code class="filename">COM4</code>.  Измените <code class="literal">off</code> на
	  <code class="literal">on</code> для требуемого порта.  Если вы изменили
	  скорость последовательного порта, может потребоваться изменить
	  <code class="literal">std.9600</code> для соответствия текущим настройкам,
	  например <code class="literal">std.19200</code>.</p><p>Возможно, вы захотите заменить тип терминала
	  <code class="literal">unknown</code> на тип реально используемого
	  терминала.</p><p>После редактирования файла потребуется выполнить
	  <code class="command">kill -HUP 1</code> для включения новых настроек.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-loader"></a>22.6.6. Изменение консоли из загрузчика</h3></div></div></div><p>Предыдущий раздел описывает настройку последовательной консоли
	изменением параметров загрузочного блока.  Этот раздел показывает,
	как указать консоль, вводя команды и переменные окружения для
	загрузчика.  Поскольку загрузчик загружается после загрузочного
	блока, на третьей стадии загрузочного процесса, настройки
	загрузчика превалируют над настройками загрузочного блока.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95265488"></a>22.6.6.1. Настройка последовательной консоли</h4></div></div></div><p>Вы можете прямо указать загрузчику и ядру использовать
	  последовательную консоль, записав одну строку в
	  <code class="filename">/boot/loader.rc</code>:</p><pre class="programlisting">set console="comconsole"</pre><p>Это сработает независимо от настроек загрузочного блока,
	  рассмотренных в предыдущем разделе.</p><p>Поместите эту строку в самое начало
	  <code class="filename">/boot/loader.rc</code>, чтобы увидеть на
	  последовательной консоли все загрузочные сообщения.</p><p>Вы можете также указать внутреннюю консоль:</p><pre class="programlisting">set console="vidconsole"</pre><p>Если вы не установите переменную загрузчика
	  <code class="envar">console</code>, загрузчик, а затем и ядро будут
	  использовать ту консоль, которая установлена параметром
	  <code class="option">-h</code> для загрузочного блока.</p><p>В версиях 3.2 или выше, вы можете указать консоль в
	  <code class="filename">/boot/loader.conf.local</code> или
	  <code class="filename">/boot/loader.conf</code> вместо
	  <code class="filename">/boot/loader.rc</code>.  С этим методом
	  <code class="filename">/boot/loader.rc</code> должен выглядеть примерно
	  так:</p><pre class="programlisting">include /boot/loader.4th
start</pre><p>Затем, создайте <code class="filename">/boot/loader.conf.local</code> и
	  поместите туда следующую строку.</p><pre class="programlisting">console=comconsole</pre><p>или</p><pre class="programlisting">console=vidconsole</pre><p>Обращайтесь к <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a> за дополнительной
	  информацией.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">На данный момент у загрузчика нет параметра, эквивалентного
	    параметру <code class="option">-P</code> загрузочного блока и нет способа
	    автоматического выбора внутренней и последовательной консоли
	    в зависимости от наличия клавиатуры.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95277392"></a>22.6.6.2. Использование для консоли отличного от
	  <code class="filename">sio0</code> последовательного порта</h4></div></div></div><p>Вам потребуется перекомпилировать загрузчик для использования
	  отличного от <code class="filename">sio0</code> последовательного порта
	  в качестве консоли.  Следуйте процедуре, описанной в разделе
	  <a class="xref" href="serialconsole-setup.html#serialconsole-com2" title="22.6.5.2. Использование для консоли другого последовательного порта вместо sio0">Раздел 22.6.5.2, <<Использование для консоли другого последовательного порта
	  вместо <code class="filename">sio0</code>>></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="serialconsole-caveats"></a>22.6.7. Предостережения</h3></div></div></div><p>Идея в том, чтобы настроить выделенный сервер, который не требует
	графического оборудования или подсоединенной клавиатуры. К сожалению,
	хотя многие системы способны загрузиться без клавиатуры, есть совсем
	немного систем, способных загрузиться без графического адаптера.
	Компьютеры с AMI BIOS могут быть настроены для загрузки без
	графического адаптера простой установкой параметра настройки CMOS
	<span class="quote"><<<span class="quote">graphics adapter</span>>></span> в значение <span class="quote"><<<span class="quote">Not
	installed</span>>></span>.</p><p>Однако, многие компьютеры не поддерживают этот параметр и не
	смогут загрузиться без графического оборудования.  Для этих
	компьютеров вам потребуется оставить подключенной любую
	графическую карту (даже если это просто старая моно карта),
	хотя монитор и не подключен.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="dialout.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="serialcomms.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="ppp-and-slip.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">22.5. Исходящие соединения по модему </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> Глава 23. PPP и SLIP</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>