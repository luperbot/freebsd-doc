<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>23.4. Решение проблем с соединениями PPP</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="ppp-and-slip.html" title="Глава 23. PPP и SLIP" /><link rel="prev" href="ppp.html" title="23.3. PPP уровня ядра" /><link rel="next" href="pppoe.html" title="23.5. Использование PPP через Ethernet (PPPoE)" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">23.4. Решение проблем с соединениями <acronym class="acronym">PPP</acronym></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ppp.html">Пред.</a> </td><th width="60%" align="center">Глава 23. PPP и SLIP</th><td width="20%" align="right"> <a accesskey="n" href="pppoe.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ppp-troubleshoot"></a>23.4. Решение проблем с соединениями <acronym class="acronym">PPP</acronym></h2></div><div><span class="authorgroup">Предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp95900752" class="indexterm"></a><p>Этот раздел охватывает несколько вопросов, которые могут
	возникнуть при использовании PPP через модемные соединения.
	Например, предположим, что вам потребовалось узнать, какое
	именно приглашение отображает система, до которой вы дозваниваетесь.
	Некоторые провайдеры выдают приглашение <code class="literal">ssword</code>,
	другие <code class="literal">password</code>; если <code class="command">ppp</code>
	скрипт не обрабатывает такие приглашения, попытка входа
	завершится неудачно.  Наиболее общий способ отладки
	соединений <code class="command">ppp</code> это подключение вручную.
	Ниже дана пошаговая информация по подключению вручную.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95903440"></a>23.4.1. Проверьте файлы устройств</h3></div></div></div><p>Если вы пересобирали ядро, проверьте устройство
	  <code class="filename">sio</code>.  Если вы не перенастраивали ядро,
	  нет причин для беспокойства.  Просто проверьте вывод
	  <code class="command">dmesg</code> для модемного устройства следующей
	  командой:</p><pre class="screen"><code class="prompt">#</code><strong class="userinput"><code>dmesg | grep sio</code></strong></pre><p>Вы должны получить информацию о устройствах
	  <code class="filename">sio</code>.  Это COM порты, которые нам
	  необходимы.  Если ваш модем работает как стандартный
	  последовательный порт, вы увидите его на
	  <code class="filename">sio1</code>, или <code class="filename">COM2</code>.
	  Если это так,
	  вам не требуется пересобирать ядро, необходимо лишь создать
	  последовательное устройство.  Вы можете сделать это, зайдя в
	  <code class="filename">/dev</code> и запустив скрипт
	  <code class="filename">MAKEDEV</code>.  Создайте последовательные
	  устройства:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh MAKEDEV cuaa0 cuaa1 cuaa2 cuaa3</code></strong></pre><p>Если модем находится на <code class="filename">sio1</code>,
	  или <code class="filename">COM2</code> в DOS, модемным устройством
	  будет <code class="filename">/dev/cuaa1</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95911120"></a>23.4.2. Подключение вручную</h3></div></div></div><p>Подключение к интернет с контролированием <code class="command">ppp</code>
	вручную это быстрый, легкий и действенный способ отладки
	соединения или получения информации о обслуживании
	провайдером клиентского соединения <code class="command">ppp</code>.
	Запустите <span class="application">PPP</span> из командной строки.
	В примерах в качестве имени хоста мы будем использовать
	<span class="emphasis"><em>example</em></span>.  Запустите <code class="command">ppp</code>,
	введя команду <code class="command">ppp</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ppp</code></strong></pre><p>Теперь программа <code class="command">ppp</code> запущена.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>set device /dev/cuaa1</code></strong></pre><p>Мы указали модемное устройство, в данном случае
	<code class="filename">cuaa1</code>.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>set speed 115200</code></strong></pre><p>Мы установили скорость подключения к модему, в данном случае
	115,200 <acronym class="acronym">кбит/с</acronym>.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>enable dns</code></strong></pre><p>Сообщает <code class="command">ppp</code> настроить разрешение имен,
	добавив строки в <code class="filename">/etc/resolv.conf</code>.
	Если <code class="command">ppp</code> не может определить имя хоста,
	его можно настроить позже вручную.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>term</code></strong></pre><p>Переключение в <span class="quote"><<<span class="quote">терминальный</span>>></span> режим для контроля
	модема вручную.</p><pre class="programlisting">deflink: Entering terminal mode on <code class="filename">/dev/cuaa1</code>
type '~h' for help</pre><pre class="screen"><strong class="userinput"><code>at</code></strong>
OK
<strong class="userinput"><code>atdt<em class="replaceable"><code>123456789</code></em></code></strong></pre><p>Использование команды <code class="command">at</code> для инициализации
	модема, а затем <code class="command">atdt</code> и номера провайдера
	для начала дозвона.</p><pre class="screen">CONNECT</pre><p>Подтверждение соединения, если есть проблемы с соединением,
	не вызванные проблемами в оборудовании, здесь мы попытаемся решить
	их.</p><pre class="screen">ISP Login:<strong class="userinput"><code>myusername</code></strong></pre><p>Здесь вам предлагается ввести имя пользователя в приглашение,
	выводимое сервером провайдера.</p><pre class="screen">ISP Pass:<strong class="userinput"><code>mypassword</code></strong></pre><p>Здесь предлагается ввести пароль, предоставленный провайдером.
	Как и при входе в FreeBSD, пароль не отображается.</p><pre class="screen">Shell or PPP:<strong class="userinput"><code>ppp</code></strong></pre><p>В зависимости от вашего провайдера, это приглашение может не
	появиться.  Здесь задается вопрос, хотите ли вы использовать
	оболочку на компьютере провайдера или запустить
	<code class="command">ppp</code>.  В этом примере мы выбрали
	<code class="command">ppp</code>, поскольку хотим соединиться с
	интернет.</p><pre class="screen">Ppp ON example&gt;</pre><p>Обратите внимание, что в этом примере первая буква
	<code class="option">p</code> появилась в верхнем регистре.  Это означает, что
	мы успешно подключились к провайдеру.</p><pre class="screen">PPp ON example&gt;</pre><p>Мы успешно аутентифицировались у провайдера и ожидаем
	присвоения <acronym class="acronym">IP</acronym> адреса.</p><pre class="screen">PPP ON example&gt;</pre><p>Мы завершили согласование <acronym class="acronym">IP</acronym> адресов,
	соединение успешно установлено.</p><pre class="screen">PPP ON example&gt;<strong class="userinput"><code>add default HISADDR</code></strong></pre><p>Это маршрут по умолчанию, его необходимо настроить, чтобы
	сделать возможной связь с внешним миром, поскольку на этот
	момент установлена связь только с удаленной стороной.
	Если маршрут не устанавливается из-за уже существующего маршрута,
	добавьте символ <code class="literal">!</code> перед <code class="option">add</code>.
	Альтернативно вы можете сделать настройку перед установкой
	соединения.</p><p>Если все прошло удачно, на данный момент должно работать
	соединение с интернет, которое можно поместить в фоновый режим
	клавишами <span class="keycap"><strong>CTRL</strong></span>+<span class="keycap"><strong>z</strong></span>.  Переход строки
	<code class="command">PPP</code> в приглашении в нижний регистр
	(<code class="command">ppp</code>) означает, что соединение было разорвано.
	Таким образом, символы P в верхнем регистре означают наличие
	соединения, а в нижнем - потерю соединения.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95946576"></a>23.4.2.1. Отладка</h4></div></div></div><p>Если у вас выделенная линия и нет необходимости устанавливать
	  соединение, выключите контроль передачи данных
	  <acronym class="acronym">CTS/RTS</acronym> командой <code class="option">set
	  ctsrts off</code>.  Это обычно необходимо при подключении к
	  поддерживающим <span class="application">PPP</span> терминальным
	  серверам, когда <span class="application">PPP</span> прерывается
	  при попытке записать данные в ваше соединение, и ожидает сигнала
	  <acronym class="acronym">CTS</acronym>, или Clear To Send, который не появляется.
	  Если вы используете этот параметр, используйте также параметр
	  <code class="option">set accmap</code>, который может быть необходим для
	  устранения зависимости от оборудования путем пропускания
	  определенных символов через соединение, обычно XON/XOFF.
	  Обратитесь к странице справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> за более подробной
	  информацией по этому параметру и его использованию.</p><p>Если у вас старый модем, может потребоваться использование
	  <code class="option">set parity even</code>.  Проверка четности по умолчанию
	  отключена, но она используется для для устранения ошибок
	  (с серьезным увеличением объема трафика) на старых модемах
	  и у некоторых провайдеров.</p><p><span class="application">PPP</span> может не вернуться в командный
	  режим, что обычно вызвано ошибкой согласования, когда провайдер
	  ждет от вас начала процесса согласования.  В этот момент
	  использование команды <code class="command">~p</code> заставит ppp
	  начать отправку настроечной информации.</p><p>Если вы не получаете приглашения на вход, скорее всего
	  вам требуется использование аутентификации
	  <acronym class="acronym">PAP</acronym> или <acronym class="acronym">CHAP</acronym> вместо
	  <span class="trademark">UNIX</span>(R) стиля как в примерах выше.  Для использования
	  <acronym class="acronym">PAP</acronym> или <acronym class="acronym">CHAP</acronym> просто добавьте
	  следующие параметры <span class="application">PPP</span> перед
	  переходом в терминальный режим:</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>set authname <em class="replaceable"><code>myusername</code></em></code></strong></pre><p>Необходимо заменить <em class="replaceable"><code>myusername</code></em>
	  на имя пользователя, выданное провайдером.</p><pre class="screen">ppp ON example&gt; <strong class="userinput"><code>set authkey <em class="replaceable"><code>mypassword</code></em></code></strong></pre><p>Где <em class="replaceable"><code>mypassword</code></em> должен быть
	  заменен на пароль, выданный провайдером.</p><p>Если вы подключаетесь, не можете определить ни одно доменное
	  имя, попробуйте использовать <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> с каким-либо
	  <acronym class="acronym">IP</acronym> адресом и просмотрите выводимую информацию.
	  Если 100 процентов (100%) пакетов теряются, скорее всего не
	  назначен маршрут по умолчанию.  Дважды проверьте, что параметр
	  <code class="option">add default HISADDR</code> установлен во время
	  соединения.  Если вы можете подключиться к удаленному
	  <acronym class="acronym">IP</acronym> адресу, возможно, что адрес сервера имен не
	  был добавлен в <code class="filename">/etc/resolv.conf</code>.
	  Этот файл должен выглядеть примерно так:</p><pre class="programlisting">domain <em class="replaceable"><code>example.com</code></em>
nameserver <em class="replaceable"><code>x.x.x.x</code></em>
nameserver <em class="replaceable"><code>y.y.y.y</code></em></pre><p>Где <em class="replaceable"><code>x.x.x.x</code></em> и
	  <em class="replaceable"><code>y.y.y.y</code></em> должны быть заменены на
	  <acronym class="acronym">IP</acronym> адреса DNS серверов провайдера.
	  Эта информация может предоставляться провайдером,
	  вы можете выяснить это в службе поддержки.</p><p>Вы можете также настроить <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslog&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a> для протоколирования
	  <span class="application">PPP</span> соединения.  Просто добавьте:</p><pre class="programlisting">!ppp
*.*     /var/log/ppp.log</pre><p>в файл <code class="filename">/etc/syslog.conf</code>.  В большинстве
	  случаев эти строки уже присутствуют.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ppp.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="ppp-and-slip.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="pppoe.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">23.3. PPP уровня ядра </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 23.5. Использование PPP через Ethernet (PPPoE)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>