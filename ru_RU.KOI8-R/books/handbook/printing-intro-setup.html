<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>10.3. Основная настройка</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="printing.html" title="Глава 10. Печать" /><link rel="prev" href="printing-intro-spooler.html" title="10.2. Введение" /><link rel="next" href="printing-advanced.html" title="10.4. Расширенная настройка принтера" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">10.3. Основная настройка</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="printing-intro-spooler.html">Пред.</a> </td><th width="60%" align="center">Глава 10. Печать</th><td width="20%" align="right"> <a accesskey="n" href="printing-advanced.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-intro-setup"></a>10.3. Основная настройка</h2></div></div></div><p>Для использования принтеров с системой спулинга
      <span class="application">LPD</span>, необходимо настроить как сам
      принтер, так и программное обеспечение
      <span class="application">LPD</span>. Этот документ описывает два уровня
      настройки:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>См. раздел <a class="link" href="printing-intro-setup.html#printing-simple" title="10.3.1. Простая настройка принтера">Простая настройка
	  принтера</a>, чтобы узнать, как подключить принтер,
	  объяснить <span class="application">LPD</span>, как с ним
	  взаимодействовать, и отправлять на принтер простые текстовые
	  файлы.</p></li><li class="listitem"><p>См. раздел <a class="link" href="printing-advanced.html" title="10.4. Расширенная настройка принтера">Расширенная
	  настройка принтера</a>, чтобы узнать, как печатать файлы
	  множества специальных форматов, как печатать страницы заголовка,
	  печатать по сети, управлять доступом к принтерам и учитывать
	  использование принтера.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-simple"></a>10.3.1. Простая настройка принтера</h3></div></div></div><p>В этом разделе описано, как сконфигурировать принтер
	и программное обеспечение <span class="application">LPD</span> для
	использования принтера. Здесь рассматриваются следующие вопросы:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>В разделе <a class="link" href="printing-intro-setup.html#printing-hardware" title="10.3.1.1. Настройка оборудования">Настройка
	    оборудования</a> представлены советы по подключению
	    принтера к порту компьютера.</p></li><li class="listitem"><p>В разделе <a class="link" href="printing-intro-setup.html#printing-software" title="10.3.1.2. Настройка программного обеспечения">Настройка
	    программного обеспечения</a> показано, как настроить
	    файл конфигурации спулера <span class="application">LPD</span>
	    (<code class="filename">/etc/printcap</code>).</p></li></ul></div><p>Если вы настраиваете принтер, использующий для принятия
	заданий печати сетевой протокол, вместо локальных интерфейсов
	компьютера, см. раздел
	<a class="link" href="printing-advanced.html#printing-advanced-network-net-if" title="10.4.3.2. Принтеры с сетевыми интерфейсами">Принтеры с
	сетевыми интерфейсами</a>.</p><p>Хотя этот раздел и назван <span class="quote"><<<span class="quote">Простая настройка
	принтера</span>>></span>, это, на самом деле, достаточно сложно.
	Заставить принтер работать с компьютером и спулером
	<span class="application">LPD</span> - самая сложная часть.
	Расширенные опции, вроде выдачи страниц заголовков и учета
	использования, установить несложно, как только принтер
	заработает.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-hardware"></a>10.3.1.1. Настройка оборудования</h4></div></div></div><p>В этом разделе описаны различные способы подключения
	  принтера к ПК. Рассматриваются различные порты и кабели, а
	  также параметры конфигурации ядра, которые может потребоваться
	  установить, чтобы ОС FreeBSD могла взаимодействовать с
	  принтером.</p><p>Если вы уже подключили ваш принтер и успешно печатали на
	  него в другой операционной системе, можете перейти к разделу
	  <a class="link" href="printing-intro-setup.html#printing-software" title="10.3.1.2. Настройка программного обеспечения">Настройка программного
	  обеспечения</a>.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-ports"></a>10.3.1.1.1. Порты и кабели</h5></div></div></div><p>Принтеры, которые продаются сегодня для использования на ПК,
	    обычно поддерживают один или несколько из следующих
	    интерфейсов:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a id="idp83168336" class="indexterm"></a><p><span class="emphasis"><em>Последовательные</em></span> интерфейсы, также
	        известные как RS-232, или COM-порты, используют
		для посылки данных на принтер последовательный порт
		компьютера.  Последовательные интерфейсы широко
		распространены в компьютерной индустрии, кабели для них легко
		найти и просто сделать. Для последовательных интерфейсов
		иногда нужны специальные кабели, и для их использования может
		потребоваться настраивать достаточно сложные опции
		взаимодействия. Большинство последовательных портов ПК имеют
		максимальную скорость передачи 115200 бит/сек, поэтому
		печатать через них большие графические задания
		неудобно.</p></li><li class="listitem"><a id="idp83170512" class="indexterm"></a><p><span class="emphasis"><em>Параллельные</em></span> интерфейсы используют
		параллельный порт компьютера для посылки данных на принтер.
		Параллельные интерфейсы широко распространены на рынке ПК
		и работают быстрее, чем последовательные RS-232.
		Кабели легко найти, но сделать самостоятельно сложнее. При
		использовании параллельных интерфейсов опции взаимодействия
		обычно задавать не надо, что делает их конфигурирование
		существенно проще.</p><a id="idp83172304" class="indexterm"></a><p>Параллельные интерфейсы иногда называют
		интерфейсами <span class="quote"><<<span class="quote">Centronics</span>>></span>, по названию типа
		разъема на принтере.</p></li><li class="listitem"><a id="idp83187024" class="indexterm"></a><p>Интерфейсы USB (сокращение от Universal Serial
		Bus - универсальная последовательная шина), могут работать
		на еще больших скоростях, чем параллельные или
		последовательные интерфейсы RS-232. Кабели для них -
		простые и дешевые. USB превосходит последовательный RS-232
		и параллельный интерфейсы для печати, но не слишком
		хорошо поддерживается в <span class="trademark">UNIX</span>(R)-системах. Обойти эту проблему
		можно, купив принтер с двумя интерфейсами, USB и
		параллельным, как у многих принтеров.</p></li></ul></div><p>В общем случае, параллельные интерфейсы обычно
	    обеспечивают только одностороннюю передачу (с компьютера
	    на принтер), тогда как последовательные и USB поддерживают
	    двустороннюю. Более новые параллельные порты (EPP и ECP) и принтеры
	    могут взаимодействовать в обоих направлениях под FreeBSD, если
	    используется кабель, соответствующий стандарту IEEE-1284.</p><a id="idp83189712" class="indexterm"></a><p>Двустороннее взаимодействие с принтером через параллельный
	    порт обычно выполняется одним из двух способов. Первый метод
	    опирается на использование специально созданного драйвера
	    принтера для FreeBSD, который поддерживает специфический язык
	    данного принтера. Этот метод типичен для струйных принтеров и
	    может использоваться для получения информации об уровне чернил и
	    другой информации о состоянии. Второй метод используется, когда
	    принтер поддерживает <span class="trademark">PostScript</span>(R).</p><p>Фактически, задания <span class="trademark">PostScript</span>(R)
	    являются программами, посылаемыми для выполнения принтеру;
	    они вообще могут не выдавать результат на бумагу и возвращать
	    его непосредственно компьютеру. <span class="trademark">PostScript</span>(R) также использует
	    двустороннее взаимодействие для сообщения компьютеру о проблемах,
	    таких как ошибки в <span class="trademark">PostScript</span>(R)-программе или замятие бумаги.
	    Такая информация может пригодиться пользователям. Более того,
	    лучший способ эффективного учета использования
	    <span class="trademark">PostScript</span>(R)-принтера требует двустороннего взаимодействия:
	    вы запрашиваете у принтера значение счетчика страниц (сколько
	    страниц напечатал принтер за все время существования), затем
	    посылаете задание пользователя, затем снова запрашиваете значение
	    его счетчика страниц. Вычитаем одно значение из другого, и узнаем,
	    сколько бумаги потратил пользователь.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-parallel"></a>10.3.1.1.2. Параллельные порты</h5></div></div></div><p>Для подключения принтера через параллельный интерфейс,
	    соедините принтер и компьютер кабелем Centronics.
	    Инструкции для принтера, для компьютера или обе должны полностью
	    описывать эту процедуру.</p><p>Помните, какой параллельный порт компьютера вы использовали.
	    Первый параллельный порт в ОС FreeBSD -
	    <code class="filename">ppc0</code>; второй -
	    <code class="filename">ppc1</code>, и так далее. Имена устройств для
	    принтеров используют ту же схему: <code class="filename">/dev/lpt0</code>
	    для принтера на первом параллельном порту и т.д.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-serial"></a>10.3.1.1.3. Последовательные порты</h5></div></div></div><p>Для подключения принтера через последовательный интерфейс,
	    соедините принтер с компьютером подходящим последовательным кабелем.
	    Инструкции для принтера, для компьютера или обе должны полностью
	    описывать эту процедуру.</p><p>Если вы не знаете, что такое <span class="quote"><<<span class="quote">подходящий последовательный
	    кабель</span>>></span>, можете попробовать использовать один из следующих:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>Модемный</em></span> кабель соединяет каждый штырёк
		на одном конце кабеля напрямую с соответствующим штырьком
		на другом конце. Кабель такого типа также называют
		кабелем <span class="quote"><<<span class="quote">DTE-to-DCE</span>>></span>.</p></li><li class="listitem"><a id="idp83200464" class="indexterm"></a><p><span class="emphasis"><em>Нуль-модемный</em></span> кабель соединяет часть
		штырьков напрямую, другие - меняет (пересылку данных на приём
		данных, например), а некоторые - закорачивает на каждом разъеме.
		Кабель такого типа также называют кабелем
		<span class="quote"><<<span class="quote">DTE-to-DTE</span>>></span> cable.</p></li><li class="listitem"><p>Кабель <span class="emphasis"><em>последовательного принтера</em></span>,
		необходимый для некоторых редко используемых принтеров, похож
		на нуль-модемный кабель, но посылает часть сигналов на
		соответствующие штырьки, а не закорачивает их.</p></li></ul></div><a id="idp83207632" class="indexterm"></a><a id="idp83208144" class="indexterm"></a><a id="idp83208656" class="indexterm"></a><p>Вам надо также настроить эти параметры взаимодействия с принтером,
	    обычно - через элементы управления на лицевой панели или переключатели
	    (DIP switches) на принтере. Выберите максимальную скорость передачи
	    <code class="literal">bps</code> (бит в секунду, иногда -
	    <span class="emphasis"><em>baud rate</em></span>), которую могут поддерживать как
	    компьютер, так и принтер. Выберите 7 или 8 битов данных; четность none,
	    even или odd; и 1 или 2 стоп-бита. Также надо выбрать протокол управления
	    передачей: none или XON/XOFF (также известный как
	    <span class="quote"><<<span class="quote">внутриполосный</span>>></span> или <span class="quote"><<<span class="quote">программный</span>>></span>).
	    Запомните выбранные установки для последующего конфигурирования
	    программного обеспечения.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-software"></a>10.3.1.2. Настройка программного обеспечения</h4></div></div></div><p>В этом разделе описана настройка программного обеспечения,
	  необходимая для печати с помощью системы спулинга
	  <span class="application">LPD</span> в ОС FreeBSD.
	</p><p>Вот план действий, которые необходимо выполнить:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>При необходимости, сконфигурировать в ядре поддержку порта,
	      к которому подключен принтер; в разделе <a class="link" href="printing-intro-setup.html#printing-kernel" title="10.3.1.2.1. Конфигурирование ядра">Конфигурирование ядра</a> описано,
	      что надо сделать.</p></li><li class="step"><p>Установить режим взаимодействия для параллельного порта,
	      если используется параллельный порт; детали представлены
	      в разделе <a class="link" href="printing-intro-setup.html#printing-parallel-port-mode" title="10.3.1.3. Настройка режима взаимодействия для параллельного порта">Настройка
	      режима взаимодействия для параллельного порта</a>.</p></li><li class="step"><p>Проверить, может ли операционная система посылать данные
	      на принтер. В разделе <a class="link" href="printing-intro-setup.html#printing-testing" title="10.3.1.4. Проверка взаимодействия с принтером">Проверка
	      взаимодействия с принтером</a> даны советы, как это сделать.</p></li><li class="step"><p>Настроить <span class="application">LPD</span> для принтера,
	      изменяя файл <code class="filename">/etc/printcap</code>. Как это
	      сделать описано далее в этой главе.</p></li></ol></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-kernel"></a>10.3.1.2.1. Конфигурирование ядра</h5></div></div></div><p>Ядро операционной системы компилируется для работы с
	    конкретным набором устройств. Последовательный или параллельный
	    интерфейс для принтера входит в этот набор. Поэтому может
	    понадобиться добавить поддержку для дополнительного
	    последовательного или параллельного порта, если он еще
	    не сконфигурирован в ядре.</p><p>Чтобы узнать, поддерживает ли используемое в настоящий
	    момент ядро последовательный интерфейс, наберите:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>grep sio<em class="replaceable"><code>N</code></em> /var/run/dmesg.boot</code></strong></pre><p>Где <em class="replaceable"><code>N</code></em> - номер последовательного
	    порта, начиная с нуля. Если вы получаете результат, подобный
	    следующему:</p><pre class="screen">sio2 at port 0x3e8-0x3ef irq 5 on isa
sio2: type 16550A</pre><p>значит, ядро поддерживает порт.</p><p>Чтобы узнать, поддерживает ли ядро параллельный интерфейс,
	    наберите:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>grep ppc<em class="replaceable"><code>N</code></em> /var/run/dmesg.boot</code></strong></pre><p>Где <em class="replaceable"><code>N</code></em>  номер параллельного порта,
	    начиная с нуля. Если вы получаете результат, подобный
	    следующему:</p><pre class="screen">ppc0: &lt;Parallel port&gt; at port 0x378-0x37f irq 7 on isa0
ppc0: SMC-like chipset (ECP/EPP/PS2/NIBBLE) in COMPATIBLE mode
ppc0: FIFO with 16/16/8 bytes threshold</pre><p>значит, ядро поддерживает порт.</p><p>Может потребоваться переконфигурировать ядро, чтобы
	    операционная система распознала и использовала параллельный
	    или последовательный порт, используемый для подключения
	    принтера.</p><p>Чтобы добавить поддержку последовательного порта,
	    обратитесь к разделу, посвященному конфигурированию ядра.
	    Чтобы добавить поддержку параллельного порта, почитайте
	    этот же раздел <span class="emphasis"><em>и</em></span> следующий раздел.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-parallel-port-mode"></a>10.3.1.3. Настройка режима взаимодействия для параллельного порта</h4></div></div></div><p>При использовании параллельного интерфейса можно выбрать,
	    должна ли ОС FreeBSD взаимодействовать с принтером на основе
	    прерываний или путем опроса. Универсальный драйвер принтера
	    (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpt&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lpt</span>(4)</span></a>) во FreeBSD использует
	    систему <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppbus&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ppbus</span>(4)</span></a>, которая управляет чипсетом порта
	    с помощью драйвера <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppc&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ppc</span>(4)</span></a>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Метод взаимодействия <span class="emphasis"><em>на основе прерываний</em></span>
		является стандартным для ядра GENERIC. По этому методу,
		операционная система использует линию запроса прерывания (IRQ line)
		для определения готовности принтера к приему данных.</p></li><li class="listitem"><p>Метод взаимодействия <span class="emphasis"><em>путем опроса</em></span>
		требует от операционной системы постоянно запрашивать
		принтер, готов ли он к приему данных. Когда он отвечает,
		что готов, ядро посылает дополнительные данные.</p></li></ul></div><p>Метод взаимодействия на основе прерываний обычно работает
	    несколько быстрее, но использует ценную линию запроса прерывания.
	    Про некоторые новые принтеры HP утверждают, что они работают
	    некорректно в режиме взаимодействия на основе прерываний,
	    вероятно, из-за некоторой (еще не вполне понятной) проблемы
	    синхронизации. Для этих принтеров необходимо устанавливать
	    режим опроса. Используйте тот режим, который работает. Некоторые
	    принтеры будут работать в обоих режимах, но оказываются
	    крайне медленными в режиме на основе прерываний.</p><p>Режим взаимодействия можно установить двумя способами:
	    конфигурируя ядро или с помощью программы <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lptcontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">lptcontrol</span>(8)</span></a>.</p><p><span class="emphasis"><em>Для установки режима взаимодействия путем
	    конфигурирования ядра:</em></span></p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Отредактируйте файл конфигурации ядра. Найдите запись
		<code class="literal">ppc0</code>. Если вы настраиваете второй
		параллельный порт, ищите запись <code class="literal">ppc1</code>.
		Используйте запись <code class="literal">ppc2</code> для третьего порта,
		и так далее.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Если необходимо установить режим на основе прерываний,
		    отредактируйте следующую строку:</p><pre class="programlisting">hint.ppc.0.irq="<em class="replaceable"><code>N</code></em>"</pre><p>в файле <code class="filename">/boot/device.hints</code>, заменив
		    <em class="replaceable"><code>N</code></em> соответствующим номером IRQ.
		    Файл конфигурации ядра также должен содержать драйвер
		    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppc&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ppc</span>(4)</span></a>:</p><pre class="screen">device ppc</pre></li><li class="listitem"><p>Если необходимо установить режим опроса,
		    удалите из файла
		    <code class="filename">/boot/device.hints</code> следующую
		    строку:</p><pre class="programlisting">hint.ppc.0.irq="<em class="replaceable"><code>N</code></em>"</pre><p>В некоторых случаях, этого недостаточно для перевода
		    порта в режим опроса под FreeBSD.  Чаще всего,
		    проблема связана с драйвером <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a>, который может
		    опрашивать и подключать устройства и, тем самым,
		    управлять режимом доступа к порту принтера. Чтобы решить
		    эту проблему, проверьте конфигурацию <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a>.</p></li></ul></div></li><li class="step"><p>Сохраните файл. Затем сконфигурируйте, соберите и установите
		ядро и перезагрузите систему. Подробнее см. в разделе <a class="link" href="kernelconfig.html" title="Глава 9. Настройка ядра FreeBSD">конфигурирование ядра</a>.</p></li></ol></div><p><span class="emphasis"><em>Для настройки режима взаимодействия с помощью
	    утилиты </em></span> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lptcontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">lptcontrol</span>(8)</span></a>:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Введите команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>lptcontrol -i -d /dev/lpt<em class="replaceable"><code>N</code></em></code></strong></pre><p>для установки режима взаимодействия на основе прерываний
		для <code class="literal">lpt<em class="replaceable"><code>N</code></em></code>.</p></li><li class="step"><p>Введите команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>lptcontrol -p -d /dev/lpt<em class="replaceable"><code>N</code></em></code></strong></pre><p>для установки режима взаимодействия по опросу для
	    <code class="literal">lpt<em class="replaceable"><code>N</code></em></code>.</p></li></ol></div><p>Вы можете поместить эти команды в файл
	    <code class="filename">/etc/rc.local</code> для установки требуемого режима
	    при каждой загрузке системы. Дополнительную информацию об этом
	    ищите на странице справочного руководства <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lptcontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">lptcontrol</span>(8)</span></a>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-testing"></a>10.3.1.4. Проверка взаимодействия с принтером</h4></div></div></div><p>Прежде чем переходить к конфигурированию системы спулинга,
	    надо убедиться, что операционная система может успешно посылать данные
	    на принтер. Намного проще отлаживать взаимодействие с принтером и
	    систему спулинга отдельно.</p><p>Для тестирования принтера мы пошлем на него текст. Для принтеров,
	    которые могут непосредственно печатать посланные на них символы,
	    идеально подходит программа <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lptest&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lptest</span>(1)</span></a>: она генерирует все 96
	    печатных символов ASCII в 96 строках.</p><a id="idp83269328" class="indexterm"></a><p>Для <span class="trademark">PostScript</span>(R)- (или основанного на другом языке) принтера,
	    необходим более сложный тест. Подойдет небольшая
	    <span class="trademark">PostScript</span>(R)-программа, вроде следующей:</p><pre class="programlisting">%!PS
100 100 moveto 300 300 lineto stroke
310 310 moveto /Helvetica findfont 12 scalefont setfont
(Is this thing working?) show
showpage</pre><p>Представленный выше <span class="trademark">PostScript</span>(R)-код можно поместить в
	    в файл и использовать, как показано в примерах в следующих
	    разделах.</p><a id="idp83284944" class="indexterm"></a><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Когда в этом документе речь идет о языке принтера,
	      подразумевается язык типа <span class="trademark">PostScript</span>(R), а не PCL компании Hewlett
	      Packard. Хотя PCL имеет прекрасные функциональные возможности, в нем
	      можно смешивать обычный текст с его управляющими
	      последовательностями. <span class="trademark">PostScript</span>(R) не позволяет непосредственно
	      печатать обычный текст, и это язык принтера именно того рода,
	      для которого надо выполнять специальные настройки.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-checking-parallel"></a>10.3.1.4.1. Проверка параллельного принтера</h5></div></div></div><a id="idp83288016" class="indexterm"></a><p>В этом разделе описано, как проверить, может ли ОС FreeBSD
	      взаимодействовать с принтером, подключенным к параллельному порту.</p><p><span class="emphasis"><em>Для тестирования принтера на параллельном порту:</em></span></p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Станьте пользователем <code class="systemitem">root</code> с помощью
		команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a>.</p></li><li class="step"><p>Пошлите данные на принтер.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Если принтер может печатать обычный текст, используйте
		      утилиту <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lptest&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lptest</span>(1)</span></a>. Введите команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>lptest &gt; /dev/lpt<em class="replaceable"><code>N</code></em></code></strong></pre><p>Где <em class="replaceable"><code>N</code></em> - номер параллельного порта,
		      начиная с нуля.</p></li><li class="listitem"><p>Если принтер понимает <span class="trademark">PostScript</span>(R) или другой язык принтера,
		      пошлите на принтер небольшую программу. Введите команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat &gt; /dev/lpt<em class="replaceable"><code>N</code></em></code></strong></pre><p>Затем, построчно, <span class="emphasis"><em>внимательно</em></span> введите
		      программу, поскольку вы не сможете отредактировать строку
		      после нажатия клавиши <code class="literal">RETURN</code>
		      или <code class="literal">ENTER</code>. По окончании ввода программы,
		      нажмите <code class="literal">CONTROL+D</code> или другую комбинацию клавиш,
		      используемую для ввода символа конца файла.</p><p>Можно также поместить программу в файл и выполнить команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat <em class="replaceable"><code>file</code></em> &gt; /dev/lpt<em class="replaceable"><code>N</code></em></code></strong></pre><p>Где <em class="replaceable"><code>file</code></em> - имя файла, содержащего
		      программу, которую вы хотите послать принтеру.</p></li></ul></div></li></ol></div><p>Вы должны увидеть распечатку. Не переживайте, если текст выглядит
	      не так, как предполагалось; этими проблемами мы займемся позже.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-checking-serial"></a>10.3.1.4.2. Проверка последовательного принтера</h5></div></div></div><a id="idp83309904" class="indexterm"></a><p>В этом разделе описано, как проверить, может ли ОС FreeBSD
	      взаимодействовать с принтером, подключенным к последовательному
	      порту.</p><p><span class="emphasis"><em>Для тестирования принтера на последовательном
	      порту:</em></span></p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Станьте пользователем <code class="systemitem">root</code> с помощью
		  команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a>.</p></li><li class="step"><p>Отредактируйте файл <code class="filename">/etc/remote</code>.
		  Добавьте следующую запись:</p><pre class="programlisting">printer:dv=/dev/<em class="replaceable"><code>port</code></em>:br#<em class="replaceable"><code>bps-rate</code></em>:pa=<em class="replaceable"><code>parity</code></em></pre><a id="idp83316816" class="indexterm"></a><a id="idp83317328" class="indexterm"></a><a id="idp83317840" class="indexterm"></a><p>Где <em class="replaceable"><code>port</code></em> - специальный файл
		  устройства для последовательного порта (<code class="literal">ttyd0</code>,
		  <code class="literal">ttyd1</code> и т.д.), <em class="replaceable"><code>bps-rate</code></em> -
		  скорость обработки данных принтером, в битах в секунду,
		  а <em class="replaceable"><code>parity</code></em> - требуемая принтером четность
		  (значение <code class="literal">even</code>, <code class="literal">odd</code>,
		  <code class="literal">none</code> или <code class="literal">zero</code>).</p><p>Вот пример записи для принтера, подключенного
		  к третьему последовательному порту на скорости 19200 bps
		  без четности:</p><pre class="programlisting">printer:dv=/dev/ttyd2:br#19200:pa=none</pre></li><li class="step"><p>Подключитесь к принтеру с помощью <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tip&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tip</span>(1)</span></a>.
		  Введите команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tip printer</code></strong></pre><p>Если этот шаг не срабатывает, снова отредактируйте
		  файл <code class="filename">/etc/remote</code> и попробуйте использовать
		  устройство <code class="filename">/dev/cuaa<em class="replaceable"><code>N</code></em></code>
		  вместо <code class="filename">/dev/ttyd<em class="replaceable"><code>N</code></em></code>.</p></li><li class="step"><p>Пошлите данные на принтер.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Если принтер может печатать обычный текст, используйте
		      утилиту <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lptest&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lptest</span>(1)</span></a>. Введите команду:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>$lptest</code></strong></pre></li><li class="listitem"><p>Если принтер понимает <span class="trademark">PostScript</span>(R) или другой язык
		      принтера, пошлите на принтер небольшую программу.
		      Вводите программу, построчно, <span class="emphasis"><em>очень
		      внимательно</em></span>, поскольку нажатие клавиши Backspacе
		      или других клавиш редактирования может иметь значение
		      для принтера. Может также понадобиться нажать специальную
		      комбинацию клавиш, обозначающую конец файла, чтобы принтер
		      понял, что получена вся программа.  Для
		      <span class="trademark">PostScript</span>(R)-принтеров нажмите <code class="literal">CONTROL+D</code>.</p><p>Можно также поместить программу в файл и ввести команду:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>&gt;<em class="replaceable"><code>file</code></em></code></strong></pre><p>Где <em class="replaceable"><code>file</code></em> - имя файла,
		      содержащего программу. После того, как утилита
		      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tip&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tip</span>(1)</span></a> пошлет файл, нажмите требуемую для
		      ввода признака конца файла комбинацию клавиш.</p></li></ul></div></li></ol></div><p>Вы должны увидеть распечатку. Не переживайте, если текст выглядит
	      не так, как предполагалось; этими проблемами мы займемся позже.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-printcap"></a>10.3.1.5. Включение спулера: файл <code class="filename">/etc/printcap</code></h4></div></div></div><p>Сейчас ваш принтер уже должен быть подключен, ядро
	  (при необходимости) - сконфигурировано для взаимодействия с ним,
	  и вы смогли послать на принтер простые данные. Теперь мы готовы
	  к конфигурированию системы <span class="application">LPD</span> для управления
	  доступом к принтеру.</p><p>Система <span class="application">LPD</span> конфигурируется путем
	  редактирования файла <code class="filename">/etc/printcap</code>. Система
	  спулинга <span class="application">LPD</span> читает этот файл при
	  каждом использовании спулера, так что, изменения в файле
	  сразу же учитываются.</p><a id="idp83349584" class="indexterm"></a><p>Формат файла <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=printcap&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">printcap</span>(5)</span></a> прост. Используйте
	  свой любимый текстовый редактор для изменения файла
	  <code class="filename">/etc/printcap</code>. Формат файла идентичен
	  формату других файлов, описывающих характеристики, например,
	  <code class="filename">/usr/share/misc/termcap</code> и
	  <code class="filename">/etc/remote</code>. Полная информация о формате
	  представлена на странице справочного руководства <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cgetent&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">cgetent</span>(3)</span></a>.</p><p>Простое конфигурирование спулера включает следующие шаги:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Выберите имя (и несколько удобных псевдонимов) для принтера
	      и поместите их в файл <code class="filename">/etc/printcap</code>; подробнее
	      об именовании см. в разделе
	      <a class="link" href="printing-intro-setup.html#printing-naming" title="10.3.1.5.1. Именование принтера">Именование принтера</a>.</p></li><li class="step"><a id="idp83356496" class="indexterm"></a><p>Отключите выдачу начальных страниц (которые по умолчанию выдаются),
	      вставив характеристику <code class="literal">sh</code>; подробнее об
	      этом см. в разделе
	      <a class="link" href="printing-intro-setup.html#printing-no-header-pages" title="10.3.1.5.2. Подавление выдачи начальных страниц">Подавление выдачи
	      начальных страниц</a>.</p></li><li class="step"><p>Создайте каталог для спулинга и укажите его местонахождение
	      с помощью характеристики <code class="literal">sd</code>; подробнее об этом
	      см. в разделе <a class="link" href="printing-intro-setup.html#printing-spooldir" title="10.3.1.5.3. Создание каталога для спулинга">Создание
	      каталога спулинга</a>.</p></li><li class="step"><p>Выберите специальный файл устройства <code class="filename">/dev</code> для
	      использования с принтером и укажите его в файле
	      <code class="filename">/etc/printcap</code> с помощью характеристики
	      <code class="literal">lp</code>; подробнее об этом см. в разделе
	      <a class="link" href="printing-intro-setup.html#printing-device" title="10.3.1.5.4. Выбор устройства для принтера">Выбор устройства для принтера</a>.
	      Кроме того, если принтер подключен к последовательному порту,
	      настройте параметры взаимодействия с помощью характеристики
	      <code class="literal">ms#</code>, которая обсуждается в разделе
	      <a class="link" href="printing-intro-setup.html#printing-commparam" title="10.3.1.5.5. Конфигурирование параметров взаимодействия спулера">Конфигурирование параметров
	      взаимодействия для спулера</a>.</p></li><li class="step"><p>Установите фильтр для обычного текста; подробнее об этом
	      см. в разделе <a class="link" href="printing-intro-setup.html#printing-textfilter" title="10.3.1.5.6. Установка текстового фильтра">Установка
	      текстового фильтра</a>.</p></li><li class="step"><p>Проверьте настройку, напечатав что-нибудь с помощью команды
	      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a>. Подробнее об этом см. в разделах
	      <a class="link" href="printing-intro-setup.html#printing-trying" title="10.3.1.5.8. Проверка">Проверка</a> и
	      <a class="link" href="printing-troubleshooting.html" title="10.7. Выявление проблем">Выявление
	      проблем</a>.</p></li></ol></div><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Принтеры, использующие специальные языки, например, <span class="trademark">PostScript</span>(R)-принтеры,
	    не могут непосредственно печатать обычный текст. Простая настройка,
	    представленная выше и описанная в следующих разделах, предполагает, что,
	    если вы устанавливаете такой принтер, то будете печатать только файлы,
	    которые он может обработать.</p></div><p>Пользователи часто предполагают, что они могут печатать обычный
	  текст на любом из установленных в системе принтеров. Программы,
	  взаимодействующие для обеспечения печати с системой
	  <span class="application">LPD</span>, обычно исходят из этого же предположения.
	  Если вы устанавливаете такой принтер и хотите иметь возможность посылать
	  на печать задания на языке принтера <span class="emphasis"><em>и</em></span> в виде обычного
	  текста, настоятельно рекомендуется добавить дополнительный шаг к представленной
	  выше простой последовательности настройки: установите программу
	  автоматического преобразования обычного текста в <span class="trademark">PostScript</span>(R) (или
	  другой язык принтера). В разделе
	  <a class="link" href="printing-advanced.html#printing-advanced-if-conversion" title="10.4.1.2. Прием заданий с обычным текстом на PostScript(R)-принтеры">Прием заданий с обычным текстом
	  на <span class="trademark">PostScript</span>(R)-принтеры</a> рассказано, как это сделать.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-naming"></a>10.3.1.5.1. Именование принтера</h5></div></div></div><p>Первый (простой) шаг - выбрать имя для принтера.
	    На самом деле, не важно, выберете ли вы функциональное имя или
	    причудливое, поскольку для принтера можно также задать несколько
	    псевдонимов.</p><p>По крайней мере, один из принтеров, указанных в файле
	    <code class="filename">/etc/printcap</code>, должен иметь псевдоним
	    <code class="literal">lp</code>. Это - стандартное имя принтера.
	    Если пользователи не установят переменную среды <code class="envar">PRINTER</code>
	    и не укажут имя принтера в командной сроке при вводе любой
	    команды системы <span class="application">LPD</span>, по умолчанию для
	    ее выполнения будет использован принтер <code class="literal">lp</code>.</p><p>Также широко распространена практика в качестве последнего
	    псевдонима для принтера задавать полное его описание, включая
	    производителя и модель.</p><p>После выбора имени и нескольких популярных псевдонимов поместите
	    их в файл <code class="filename">/etc/printcap</code>. Имя принтера должно начинаться
	    с крайнего левого столбца. Каждый псевдоним отделяйте вертикальной
	    чертой, а после последнего псевдонима поместите двоеточие.</p><p>В следующем примере мы начнем со скелетного файла
	    <code class="filename">/etc/printcap</code>, определяющего два принтера
	    (построчный принтер Diablo 630 и лазерный <span class="trademark">PostScript</span>(R)-принтер
	     Panasonic KX-P4455):</p><pre class="programlisting">#
#  /etc/printcap для хоста rose
#
rattan|line|diablo|lp|Diablo 630 Line Printer:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:</pre><p>В этом примере первый принтер назван
	    <code class="literal">rattan</code> и ему заданы псевдонимы
	    <code class="literal">line</code>, <code class="literal">diablo</code>,
	    <code class="literal">lp</code> и <code class="literal">Diablo 630 Line
	    Printer</code>. Поскольку у него есть псевдоним
	    <code class="literal">lp</code>, он является стандартным принтером. Второму
	    принтеру дано имя <code class="literal">bamboo</code> и ему заданы псевдонимы
	    <code class="literal">ps</code>, <code class="literal">PS</code>,
	    <code class="literal">S</code>, <code class="literal">panasonic</code> и
	    <code class="literal">Panasonic KX-P4455 PostScript v51.4</code>.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-no-header-pages"></a>10.3.1.5.2. Подавление выдачи начальных страниц</h5></div></div></div><a id="idp83404496" class="indexterm"></a><p>Система спулинга <span class="application">LPD</span> будет по умолчанию
	    печатать <span class="emphasis"><em>заголовочную страницу</em></span> для каждого задания.
	    Заголовочная страница содержит имя пользователя, отправившего задание,
	    хост, с которого поступило задание, и имя задания, красивыми большими
	    буквами. К сожалению, все эти дополнительные тексты мешают
	    отладке простой настройки принтера, поэтому мы будет отключать
	    выдачу начальных страниц.</p><p>Для подавления выдачи начальных страниц добавьте характеристику
	    <code class="literal">sh</code> к записи принтера в файле
	    <code class="filename">/etc/printcap</code>. Вот пример файла
	    <code class="filename">/etc/printcap</code> с добавлением <code class="literal">sh</code>:</p><pre class="programlisting">#
#  /etc/printcap для хоста rose - никаких начальных страниц
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:</pre><p>Обратите внимание, как мы использовали правильный формат: первая
	    строка начинается с самого левого столбца, а последующие строки
	    смещены. Каждая строка в записи,
	    кроме последней, завершается символом обратной косой черты.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-spooldir"></a>10.3.1.5.3. Создание каталога для спулинга</h5></div></div></div><a id="idp83410768" class="indexterm"></a><a id="idp83411280" class="indexterm"></a><p>Следующий шаг в простой настройке спулера - создать
	    <span class="emphasis"><em>каталог для спулинга</em></span>, каталог, в котором
	    находятся задания печати, пока не будут напечатаны, и где находятся
	    еще несколько других файлов для поддержки спулера.</p><p>Из-за присущих каталогам спулинга постоянных изменений, принято
	    помещать эти каталоги в каталог <code class="filename">/var/spool</code>.
	    Кроме того, не нужно создавать резервные копии содержимого каталогов
	    спулинга. Пересоздать их можно с помощью простой команды
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mkdir&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">mkdir</span>(1)</span></a>.</p><p>Принято также задавать для каталога имя, совпадающее с именем
	    принтера, как показано ниже:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /var/spool/<em class="replaceable"><code>имя-принтера</code></em></code></strong></pre><p>Однако при наличии большого количества принтеров в сети
	    может иметь смысл поместить все каталоги спулинга в один каталог,
	    который просто резервируется для печати с помощью
	    <span class="application">LPD</span>. Мы сделаем это для наших двух принтеров,
	    <code class="literal">rattan</code> и <code class="literal">bamboo</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /var/spool/lpd</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /var/spool/lpd/rattan</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /var/spool/lpd/bamboo</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Если вас интересует конфиденциальность заданий, отправляемых
	      пользователями на печать, можно защитить каталог спулинга, чтобы
	      он не был общедоступным. Каталоги спулинга должны принадлежать и
	      быть доступны на чтение, запись и просмотр содержимого пользователю
	      daemon и группе daemon, и никому больше. Мы установим это для
	      каталогов спулинга принтеров из нашего примера:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chown daemon:daemon /var/spool/lpd/rattan</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown daemon:daemon /var/spool/lpd/bamboo</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 770 /var/spool/lpd/rattan</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 770 /var/spool/lpd/bamboo</code></strong></pre></div><p>Наконец, надо сообщить системе <span class="application">LPD</span>
	    об этих каталогах с помощью файла <code class="filename">/etc/printcap</code>.
	    Полное имя каталога спулинга задается с помощью характеристики
	    <code class="literal">sd</code>:</p><pre class="programlisting">#
#  /etc/printcap для хоста rose - добавлены каталоги спулинга
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:</pre><p>Обратите внимание, что имя принтера начинается с самого
	    первого столбца, а все последующие строки смещены, и каждая строка в записи,
	    кроме последней, завершается символом обратной косой черты.</p><p>Если вы не зададите каталог спулинга с помощью характеристики
	    <code class="literal">sd</code>, система спулинга будет использовать по умолчанию
	    каталог <code class="filename">/var/spool/lpd</code>.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-device"></a>10.3.1.5.4. Выбор устройства для принтера</h5></div></div></div><p>Мы выяснили, какой специальный
	    файл устройства в каталоге <code class="filename">/dev</code> FreeBSD будет
	    использовать для взаимодействия с принтером. Теперь мы сообщаем эту
	    информацию системе <span class="application">LPD</span>. Когда у системы
	    спулинга есть задание для печати, она будет открывать указанное устройство
	    от имени программы-фильтра (которая отвечает за передачу данных
	    на принтер).</p><p>Задайте полное имя устройства <code class="filename">/dev</code> в файле
	    <code class="filename">/etc/printcap</code> с помощью характеристики
	    <code class="literal">lp</code>.</p><p>В нашем текущем примере давайте предположим, что принтер
	    <code class="literal">rattan</code> подключен к первому параллельному порту,
	    а принтер <code class="literal">bamboo</code> - к шестому последовательному
	    порту; вот что нужно добавить в файл <code class="filename">/etc/printcap</code>:</p><pre class="programlisting">#
#  /etc/printcap для хоста rose - указано, какие устройства использовать
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\
        :lp=/dev/lpt0:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:\
        :lp=/dev/ttyd5:</pre><p>Если вы не укажете характеристику <code class="literal">lp</code> для
	    принтера в файле <code class="filename">/etc/printcap</code>, система
	    <span class="application">LPD</span> использует по умолчанию
	    устройство <code class="filename">/dev/lp</code>. Устройство
	    <code class="filename">/dev/lp</code> сейчас в ОС FreeBSD не существует.</p><p>Если устанавливаемый принтер подключен к параллельному порту,
	    перейдите к разделу <a class="link" href="printing-intro-setup.html#printing-textfilter" title="10.3.1.5.6. Установка текстового фильтра">Установка
	    текстового фильтра</a>. Иначе выполните сначала инструкции,
	    представленные в следующем разделе.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-commparam"></a>10.3.1.5.5. Конфигурирование параметров взаимодействия спулера</h5></div></div></div><a id="idp83449936" class="indexterm"></a><p>Для принтеров на последовательных портах система
	    <span class="application">LPD</span> может устанавливать скорость передачи,
	    четность и другие параметры взаимодействия через последовательных порт
	    от имени программы-фильтра, которая посылает данные на принтер.
	    Это полезно потому, что:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Позволяет опробовать различные параметры взаимодействия, просто
	      редактируя файл <code class="filename">/etc/printcap</code>; программу-фильтр
	      перекомпилировать не нужно.</p></li><li class="listitem"><p>Позволяет системе спулинга использовать одну и ту же
	      программу-фильтр для нескольких принтеров, которые могут иметь
	      различные установки для взаимодействия через последовательный
	      порт.</p></li></ul></div><p>Следующие характеристики в файле <code class="filename">/etc/printcap</code>
	    задают параметры взаимодействия через последовательный порт
	    для устройства, указанного в качестве значения характеристики
	    <code class="literal">lp</code>:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">br#<em class="replaceable"><code>bps-rate</code></em></code></span></dt><dd><p>Устанавливает скорость взаимодействия для устройства в
	      <em class="replaceable"><code>bps-rate</code></em>, где
	      <em class="replaceable"><code>bps-rate</code></em> может иметь значение 50, 75, 110,
	      134, 150, 200, 300, 600, 1200, 1800, 2400, 4800, 9600,
	      19200, 38400, 57600 или 115200 бит в секунду.</p></dd><dt><span class="term"><code class="literal">ms#<em class="replaceable"><code>stty-mode</code></em></code></span></dt><dd><p>Устанавливает опции для терминального устройства после открытия устройства.
	      Поддерживаемые опции описаны на странице справочного руководства <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=stty&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">stty</span>(1)</span></a>.</p></dd></dl></div><p>Когда система <span class="application">LPD</span> открывает устройство,
	    заданное характеристикой <code class="literal">lp</code>, она устанавливает
	    опции устройства в соответствии со значением характеристики
	    <code class="literal">ms#</code>. Наибольший интерес представляют
	    режимы <code class="literal">parenb</code>, <code class="literal">parodd</code>,
	    <code class="literal">cs5</code>, <code class="literal">cs6</code>, <code class="literal">cs7</code>,
	    <code class="literal">cs8</code>, <code class="literal">cstopb</code>,
	    <code class="literal">crtscts</code> и <code class="literal">ixon</code>, которые
	    описаны на странице справочного руководства <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=stty&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">stty</span>(1)</span></a>.</p><p>Давайте зададим опции для нашего принтера на шестом последовательном
	    порту. Мы установим скорость передачи 38400. В качестве режима
	    установим режим без четности с помощью <code class="literal">-parenb</code>,
	    8-битовые символы с помощью <code class="literal">cs8</code>,
	    отсутствие модемного управления с помощью <code class="literal">clocal</code> и
	    аппаратное управление потоком с помощью опции <code class="literal">crtscts</code>:</p><pre class="programlisting">bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:\
        :lp=/dev/ttyd5:ms#-parenb cs8 clocal crtscts:</pre></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-textfilter"></a>10.3.1.5.6. Установка текстового фильтра</h5></div></div></div><a id="idp83474640" class="indexterm"></a><p>Теперь мы готовы задать системе <span class="application">LPD</span>,
	    какой текстовый фильтр использовать для посылки заданий на принтер.
	    <span class="emphasis"><em>Текстовый фильтр</em></span>, известный также как
	    <span class="emphasis"><em>входной фильтр</em></span>, - это программа,
	    которую система <span class="application">LPD</span> запускает при
	    получении задания на
	    печать. Когда система <span class="application">LPD</span> запускает
	    текстовый фильтр для принтера, она направляет на стандартный
	    входной поток фильтра задание печати, а его стандартный выходной
	    поток - на устройство принтера, заданное характеристикой <code class="literal">lp</code>.
	    Предполагается, что фильтр прочитает задание из стандартного входного
	    потока, выполнит все необходимые для принтера преобразования и
	    выдаст результат в стандартный выходной поток, который и будет
	    напечатан. Подробнее о текстовом фильтре см. в разделе
	    <a class="link" href="printing-advanced.html#printing-advanced-filters" title="10.4.1.1. Как работают фильтры">Фильтры</a>.</p><p>Для простой настройки принтера в качестве текстового фильтра можно
	    задать небольшой скрипт командного интерпретатора, который просто
	    выполняет <code class="command">/bin/cat</code> для посылки задания на принтер.
	    В составе FreeBSD поставляется другой фильтр, <code class="filename">lpf</code>,
	    обрабатывающий забой и подчеркивание для принтеров, которые не слишком
	    хорошо справляются с потоком данных, содержащих такие символы. И,
	    конечно же, вы можете использовать любую другую необходимую
	    программу-фильтр. Фильтр <code class="command">lpf</code> детально описан в разделе
	    <a class="link" href="printing-advanced.html#printing-advanced-lpf" title="10.4.1.6. lpf: текстовый фильтр">lpf: текстовый фильтр</a>.</p><p>Сначала давайте создадим скрипт командного интерпретатора
	    <code class="filename">/usr/local/libexec/if-simple</code> для простого
	    тестового фильтра. Поместите в этот файл следующий текст с помощью
	    любимого текстового редактора:</p><pre class="programlisting">#!/bin/sh
#
# if-simple - Простой фильтр входного текста для lpd
# Установлен в /usr/local/libexec/if-simple
#
# Просто копирует stdin в stdout. Игнорирует все аргументы фильтра.

/bin/cat &amp;&amp; exit 0
exit 2</pre><p>Сделайте этот файл выполняемым:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 555 /usr/local/libexec/if-simple</code></strong></pre><p>А теперь потребуйте от системы LPD его использовать, указав его в
	    качестве значения характеристики <code class="literal">if</code> в файле
	    <code class="filename">/etc/printcap</code>. Мы добавим его для двух принтеров,
	    имеющихся пока в примере файла <code class="filename">/etc/printcap</code>:</p><pre class="programlisting">#
#  /etc/printcap для хоста rose - добавлен текстовый фильтр
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=/var/spool/lpd/rattan:\ :lp=/dev/lpt0:\
        :if=/usr/local/libexec/if-simple:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=/var/spool/lpd/bamboo:\
        :lp=/dev/ttyd5:ms#-parenb cs8 clocal crtscts:\
        :if=/usr/local/libexec/if-simple:</pre><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Копию скрипта <code class="filename">if-simple</code> можно
	      найти в каталоге <code class="filename">/usr/share/examples/printing</code>.</p></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83491408"></a>10.3.1.5.7. Запуск системы <span class="application">LPD</span></h5></div></div></div><p>Даемон <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">lpd</span>(8)</span></a> запускается из <code class="filename">/etc/rc</code>,
	    а необходимость запуска задается переменной <code class="literal">lpd_enable</code>.
	    Эта переменная по умолчанию имеет значение <code class="literal">NO</code>. Если
	    вы еще этого не сделали, добавьте строку:</p><pre class="programlisting">lpd_enable="YES"</pre><p>в файл <code class="filename">/etc/rc.conf</code>, а затем либо перезапустите
	    машину, либо просто выполните команду <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">lpd</span>(8)</span></a>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>lpd</code></strong></pre></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-trying"></a>10.3.1.5.8. Проверка</h5></div></div></div><p>Вы добрались до конца простой настройки системы
	    <span class="application">LPD</span>. К сожалению,
	    поздравлять вас еще рано, поскольку надо еще проверить
	    настройку и устранить все выявленные проблемы. Для проверки
	    настройки, попытайтесь что-то распечатать. Для печати с помощью
	    системы <span class="application">LPD</span> используется
	    команда <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a>, которая посылает задание на печать.</p><p>Можно скомбинировать <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a> с программой <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lptest&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lptest</span>(1)</span></a>,
	    представленной в разделе <a class="link" href="printing-intro-setup.html#printing-testing" title="10.3.1.4. Проверка взаимодействия с принтером">Проверка
	    взаимодействия с принтером</a>, генерирующей тестовый текст.</p><p><span class="emphasis"><em>Для тестирования простой настройки
	  <span class="application">LPD</span>:</em></span></p><p>Введите команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>lptest 20 5 | lpr -P<em class="replaceable"><code>printer-name</code></em></code></strong></pre><p>Где <em class="replaceable"><code>printer-name</code></em> - имя
	    (или псевдоним) принтера, заданное в файле
	    <code class="filename">/etc/printcap</code>. Для проверки стандартного
	    принтера, введите команду <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a> без аргумента <code class="option">-P</code>.
	    Как уже отмечалось, если тестируется принтер, предполагающий использование
	    <span class="trademark">PostScript</span>(R), пошлите ему <span class="trademark">PostScript</span>(R)-программу вместо использования
	    утилиты <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lptest&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lptest</span>(1)</span></a>. Это можно сделать, поместив программу в файл
	    и выполнив команду <code class="command">lpr <em class="replaceable"><code>file</code></em></code>.</p><p>Для <span class="trademark">PostScript</span>(R)-принтера вы должны получить результаты выполнения
	    программы. Если вы используете <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lptest&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lptest</span>(1)</span></a>, ваши результаты должны
	    иметь такой вид:</p><pre class="programlisting">!"#$%&amp;'()*+,-./01234
"#$%&amp;'()*+,-./012345
#$%&amp;'()*+,-./0123456
$%&amp;'()*+,-./01234567
%&amp;'()*+,-./012345678</pre><p>Для дальнейшего тестирования принтера, попытайтесь загрузить
	    программы побольше (для принтеров, поддерживающих определенный язык)
	    или выполните команду <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lptest&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lptest</span>(1)</span></a> с другими аргументами. Например,
	    команда <code class="command">lptest 80 60</code> выдаст 60 строк по 80
	    символов в каждой.</p><p>Если принтер не работает, см. раздел <a class="link" href="printing-troubleshooting.html" title="10.7. Выявление проблем">Выявление проблем</a>.</p></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="printing-intro-spooler.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="printing.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="printing-advanced.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">10.2. Введение </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 10.4. Расширенная настройка принтера</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>