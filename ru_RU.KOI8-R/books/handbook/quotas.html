<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>17.15. Квотирование файловых систем</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="disks.html" title="Глава 17. Устройства хранения" /><link rel="prev" href="snapshots.html" title="17.14. Мгновенные копии файловых систем" /><link rel="next" href="disks-encrypting.html" title="17.16. Шифрование дисковых разделов" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">17.15. Квотирование файловых систем</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="snapshots.html">Пред.</a> </td><th width="60%" align="center">Глава 17. Устройства хранения</th><td width="20%" align="right"> <a accesskey="n" href="disks-encrypting.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="quotas"></a>17.15. Квотирование файловых систем</h2></div></div></div><a id="idp92224336" class="indexterm"></a><a id="idp92225488" class="indexterm"></a><p>Квоты - это опциональная возможность операционной системы, которая
      позволяет ограничивать объем дискового пространства и/или количество
      файлов для конкретного пользователя или членов определенной группы
      в рамках одной файловой системы.	Чаще всего эта возможность
      используется в системах разделения времени, когда желательно ограничить
      количество ресурсов, которые может использовать один пользователь или
      группа пользователей.  Это позволит не допустить ситуации, когда
      один пользователь или группа пользователей заполняют всё доступное
      дисковое пространство.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92226512"></a>17.15.1. Настройка вашей системы на использование дисковых квот</h3></div></div></div><p>Перед тем, как попытаться использовать дисковые квоты, необходимо
	убедиться, что квоты включены в вашем ядре.  Это делается добавлением
	следующей строки в конфигурационный файл вашего ядра:</p><pre class="programlisting">options QUOTA</pre><p>В стандартном ядре <code class="filename">GENERIC</code> это по умолчанию
	не включено, так что для использования дисковых квот вам нужно будет
	настроить, откомпилировать и установить собственное ядро.
	Пожалуйста, обратитесь к <a class="xref" href="kernelconfig.html" title="Глава 9. Настройка ядра FreeBSD">Глава 9, <em>Настройка ядра FreeBSD</em></a> за
	дополнительной информацией о настройке ядра.</p><p>Затем вам потребуется включить квотирование дисков в файле
	<code class="filename">/etc/rc.conf</code>.  Это делается добавление такой
	строчки:</p><pre class="programlisting">enable_quotas="YES"</pre><a id="idp92230224" class="indexterm"></a><p>Для более полного контроля над запуском квотирования имеется
	дополнительная переменная для настройки.  Как правило, при загрузке
	целостность квот каждой файловой системы проверяется программой
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a>.  При работе программы <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a>
	проверяется точное соответствие данных
	в базе данных квот данным в файловой системе.  Это весьма долгий
	процесс, что отражается на времени загрузки системы.  Если вам
	захочется пропустить этот шаг, то для этого предназначена специальная
	переменная в файле <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">check_quotas="NO"</pre><p>Наконец, вам потребуется отредактировать файл
	<code class="filename">/etc/fstab</code> для включения дисковых квот на
	уровне файловых систем.  Это то место, где вы можете включить квоты
	для пользователей, для групп или для обеих этих категорий для всех
	ваших файловых систем.</p><p>Для включения пользовательских квот для файловой системы,
	добавьте параметр <code class="option">userquota</code> в поле параметров
	файловой системы, на которой вы хотите включить квотирование, в файле
	<code class="filename">/etc/fstab</code>.  Например:</p><pre class="programlisting">/dev/da1s2g   /home    ufs rw,userquota 1 2</pre><p>Подобным же образом для включения квотирования на уровне групп,
	воспользуйтесь параметром <code class="option">groupquota</code> вместо
	<code class="option">userquota</code>.  Чтобы включить
	квотирование как для пользователей, так и для групп, измените
	строчку следующим образом:</p><pre class="programlisting">/dev/da1s2g   /home    ufs rw,userquota,groupquota 2 2</pre><p>По умолчанию файлы квот хранятся в корневом каталоге файловой
	системы в файлах с именами <code class="filename">quota.user</code> и
	<code class="filename">quota.group</code> соответственно для пользовательских
	и групповых квот.  Для получения подробной информации обратитесь к
	команде <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a>.  Хотя справочная страница по <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a>
	утверждает, что вы можете указать другое местоположение файлов с
	квотами, этого делать не рекомендуется, потому что различные утилиты
	для работы с квотами не могут нормально работать в такой
	ситуации.</p><p>На этом этапе вы должны перезагрузить вашу систему с новым ядром.
	Скрипт <code class="filename">/etc/rc</code> автоматически запустит
	соответствующие команды для создания начальных файлов для всех квот,
	которые вы создали в файле <code class="filename">/etc/fstab</code>, так что
	нет нужды вручную создавать никаких файлов квот нулевой длины.</p><p>При нормальной работе вам не потребуется вручную запускать
	программы <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotaon&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotaon</span>(8)</span></a> или <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotaoff&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotaoff</span>(8)</span></a>.
	Однако вам нужно хотя бы прочесть
	страницы справочника по этим командам, просто чтобы ознакомиться
	с их функциями.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92285776"></a>17.15.2. Установка квот</h3></div></div></div><a id="idp92286416" class="indexterm"></a><p>Как только вы настроили вашу систему на использование квот,
	проверьте, что они действительно были задействованы.  Простым
	способом сделать это является запуск такой команды:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>quota -v</code></strong></pre><p>Вы должны увидеть однострочную информацию, отражающую
	использование диска и текущие ограничения для каждой файловой
	системы, на которой включено квотирование.</p><p>Теперь вы действительно готовы задавать ограничения при помощи
	команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>.</p><p>У вас есть несколько вариантов того, как приводить в действие
	ограничения по объему дискового пространства, который могут занимать
	пользователь или группа, а также по количеству файлов, которые они
	могут создать.	Вы можете ограничивать размещение ресурсов на основе
	объема дискового пространства (квотирование блоков), количества
	файлов (квотирование inode) или их комбинации.	Каждое из этих
	ограничений, в свою очередь, делится на две категории: мягкие и
	жёсткие ограничения.</p><a id="idp92290768" class="indexterm"></a><p>Жёсткое ограничение не может быть превышено.  Как только
	пользователь достиг своих ограничений, ресурсы соответствующей
	файловой системы ему больше выделяться не будут.  Например, если
	пользователь имеет жесткое ограничение в 500 Кбайт на файловой
	системе и в текущий момент использует 490 Кбайт, то
	пользователь может получить дополнительно ещё 10 Кбайт.  Попытка
	занять ещё 11 Кбайт окончится неудачно.</p><a id="idp92295888" class="indexterm"></a><p>С другой стороны, мягкие ограничения могут быть превышены в
	течении некоторого периода времени.  Этот период времени также
	называют периодом отсрочки, который по умолчанию равен одной неделе.
	Если пользователь превышает своё мягкое ограничение в течение периода
	времени, превышающего отсрочку, то это мягкое ограничение становится
	жестким и последующее выделение ресурсов будет запрещено.  Когда
	пользователь вернётся обратно к отметке, меньшей, чем мягкое
	ограничение, то период отсрочки будет сброшен.</p><p>Далее приводится пример того, что вы можете наблюдать при
	запуске команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>.  Когда вызывается команда
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>, вы оказываетесь в редакторе, заданном
	переменной переменной окружения <code class="envar">EDITOR</code>, или в
	редакторе <span class="application">vi</span>, если переменная
	<code class="envar">EDITOR</code> не задана, и можете редактировать квоты.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>edquota -u test</code></strong></pre><pre class="programlisting">Quotas for user test:
/usr: kbytes in use: 65, limits (soft = 50, hard = 75)
	inodes in use: 7, limits (soft = 50, hard = 60)
/usr/var: kbytes in use: 0, limits (soft = 50, hard = 75)
	inodes in use: 0, limits (soft = 50, hard = 60)</pre><p>Для каждой файловой системы, на которой включено квотирование,
	вы должны увидеть две строки.  В одной строке приведены ограничения
	на блоки, а в другой на количество inode.  Например, чтобы увеличить
	ограничения на количество блоков для пользователя с мягкого
	ограничения в 50 и жёсткого ограничения в 75, на мягкое ограничение
	в 500 и жёсткое ограничение в 600, измените:</p><pre class="programlisting">/usr: kbytes in use: 65, limits (soft = 50, hard = 75)</pre><p>на:</p><pre class="programlisting">/usr: kbytes in use: 65, limits (soft = 500, hard = 600)</pre><p>Новые ограничения вступят в силу после выхода из
	редактора.</p><p>Иногда желательно установить ограничения квот на некоторый
	диапазон UID (идентификаторов пользователей).  Это можно сделать при
	помощи параметра <code class="option">-p</code> в команде
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>.  Во-первых, установите желаемое
	ограничение для пользователя, а затем запустите команду
	<code class="command">edquota -p protouser startuid-enduid</code>.  Например,
	если пользователь <code class="systemitem">test</code> имеет желаемые
	ограничения, то для дублирования этих ограничений на пользователей с
	UID от 10000 до 19999 может быть использована такая
	команда:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>edquota -p test 10000-19999</code></strong></pre><p>Дополнительную информацию можно получить из справочной страницы по
	команде <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92307920"></a>17.15.3. Проверка ограничений и использования диска</h3></div></div></div><a id="idp92308560" class="indexterm"></a><p>Для проверки квот и использования дисков вы можете использовать
	команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a> или <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=repquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">repquota</span>(8)</span></a>.
	Команда <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a> может быть использована для проверки
	квот отдельных пользователей, групп, а также использования дисков.
	Пользователь может только проверить собственную квоту и квоту той
	группы, к которой он принадлежит.  Только администратор системы может
	проверить квоты всех пользователей и групп.  Команду
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=repquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">repquota</span>(8)</span></a> можно использовать для получения
	суммарной статистики всех квот и использования дисков для файловых
	систем с включенными квотами.</p><p>Далее приведен пример вывода команды <code class="command">quota -v</code>
	для пользователя, который имеет ограничения на двух файловых
	системах.</p><pre class="programlisting">Disk quotas for user test (uid 1002):
     Filesystem  usage    quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75 	      0      50      60</pre><a id="idp92318544" class="indexterm"></a><p>В этом примере для файловой системы <code class="filename">/usr</code>
	пользователь превысил свое мягкое ограничение в 50 Кбайт на 15
	Кбайт и имеет 5 дней до истечения отсрочки.  Отметьте знак
	звездочки <code class="literal">*</code>, который указывает на превышение
	пользователем своего ограничения.</p><p>Как правило, файловые системы, на которых пользователь не
	занимает дискового пространства, не показываются в выводе команды
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a>, даже если ему выделена квота на
	этой файловой системе.	При использовании параметра
	<code class="option">-v</code> эти файловые системы выводятся, как, например,
	файловая система <code class="filename">/usr/var</code> в примере выше.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92322256"></a>17.15.4. Квоты в NFS</h3></div></div></div><a id="idp92322896" class="indexterm"></a><p>Квоты определяются подсистемой квот на сервере NFS.  Даемон
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rpc.rquotad&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rpc.rquotad</span>(8)</span></a> предоставляет информацию о квотах для программы
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a> на клиентах NFS, позволяя пользователям на этих машинах
	смотреть свою статистику о квотах.</p><p>Включите <code class="command">rpc.rquotad</code> в файле
	<code class="filename">/etc/inetd.conf</code> следующим образом:</p><pre class="programlisting">rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</pre><p>Теперь перезапустите <code class="command">inetd</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/inetd restart</code></strong></pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="snapshots.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="disks-encrypting.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">17.14. Мгновенные копии файловых систем </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 17.16. Шифрование дисковых разделов</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>