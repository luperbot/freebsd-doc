<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>4.4. Права доступа</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="basics.html" title="Глава 4. Основы UNIX" /><link rel="prev" href="users-synopsis.html" title="4.3. Пользователи и основы управления учетными записями" /><link rel="next" href="dirstructure.html" title="4.5. Структура каталогов" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.4. Права доступа</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="users-synopsis.html">Пред.</a> </td><th width="60%" align="center">Глава 4. Основы UNIX</th><td width="20%" align="right"> <a accesskey="n" href="dirstructure.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="permissions"></a>4.4. Права доступа</h2></div></div></div><a id="idp78987600" class="indexterm"></a><p>FreeBSD является прямым потомком BSD <span class="trademark">UNIX</span>(R) и основывается на
      некоторых ключевых концепциях <span class="trademark">UNIX</span>(R).  В первую очередь это, конечно,
      тот факт, что FreeBSD - многопользовательская операционная система.
      Это означает, что несколько пользователей могут работать одновременно,
      решая различные задачи и совершенно не мешая друг другу.  На системе
      лежит ответственность за правильное разделение и управление такими
      ресурсами как память, процессорное время, периферийные устройства и
      прочее.</p><p>Многопользовательская среда предполагает наличие механизма
      регулирования прав доступа к любому ресурсу в системе.  Существует три
      типа прав доступа: на чтение, запись и исполнение.  Права
      сгруппированы три по три, соответственно чтение/запись/выполнение для
      владельца/группы/всех остальных.  Численное представление:</p><a id="idp78990160" class="indexterm"></a><a id="idp78990672" class="indexterm"></a><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Значение</th><th>Права доступа</th><th>Список файлов каталога</th></tr></thead><tbody><tr><td>0</td><td>Ничего не разрешено</td><td><code class="literal">---</code></td></tr><tr><td>1</td><td>Нельзя читать и писать, разрешено исполнять</td><td><code class="literal">--x</code></td></tr><tr><td>2</td><td>Нельзя читать и исполнять, разрешено писать</td><td><code class="literal">-w-</code></td></tr><tr><td>3</td><td>Нельзя читать, разрешено писать и исполнять</td><td><code class="literal">-wx</code></td></tr><tr><td>4</td><td>Разрешено читать, нельзя писать и исполнять</td><td><code class="literal">r--</code></td></tr><tr><td>5</td><td>Разрешено читать и исполнять, нельзя писать</td><td><code class="literal">r-x</code></td></tr><tr><td>6</td><td>Разрешено читать и писать, нельзя исполнять</td><td><code class="literal">rw-</code></td></tr><tr><td>7</td><td>Разрешено все</td><td><code class="literal">rwx</code></td></tr></tbody></table></div><a id="idp79012560" class="indexterm"></a><a id="idp79013456" class="indexterm"></a><p>Вы можете использовать опцию <code class="option">-l</code> команды
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> для получения подробного листинга каталога, включающего
      колонку с информацией о правах на файл для владельца, группы и
      всех остальных.  Например, команда <code class="command">ls -l</code>
      в произвольном каталоге может вывести следующее:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ls -l</code></strong>
total 530
-rw-r--r--  1 root  wheel     512 Sep  5 12:31 myfile
-rw-r--r--  1 root  wheel     512 Sep  5 12:31 otherfile
-rw-r--r--  1 root  wheel    7680 Sep  5 12:31 email.txt
...</pre><p>Вот как выглядит первая колонка вывода
      <code class="command">ls -l</code>:</p><pre class="screen">-rw-r--r--</pre><p>Первый (считая слева) символ говорит обычный ли это файл, каталог,
      символьное устройство, сокет или любое другое псевдо-файловое
      устройство.  В нашем случае <code class="literal">-</code> указывает на обычный
      файл.  Следующие три символа (в данном случае это <code class="literal">rw-</code>)
      задают права доступа владельца файла.  Затем идут права группы,
      которой принадлежит файл (<code class="literal">r--</code>).  Последняя тройка
      (<code class="literal">r--</code>) определяет права для всех остальных.  Минус
      означает отсутствие каких-либо прав (т.е. нельзя ни читать, ни писать, ни
      выполнять).  В данном случае права установлены таким образом, что
      владелец может читать и писать в файл, а группа и другие могут только
      читать.  Таким образом, численное представление прав
      <code class="literal">644</code>, где каждая цифра представляет три части
      прав на файл.</p><p>Права на устройства контролируются аналогичным образом.  В
      FreeBSD все устройства представлены в виде файлов, которые можно
      открывать, читать и писать в них.  Эти специальные файлы содержатся в
      каталоге <code class="filename">/dev</code>.</p><p>Каталоги также являются файлами.  К ним применимы
      те же права на чтение, запись и выполнение.  Правда, в данном случае
      <span class="quote"><<<span class="quote">выполнение</span>>></span> имеет несколько другой смысл.  Когда
      каталог помечен как <span class="quote"><<<span class="quote">исполнимый</span>>></span>, это означает, что
      можно <span class="quote"><<<span class="quote">зайти</span>>></span> в него (с помощью команды
      <code class="command">cd</code>, change directory).  Это также означает, что в данном каталоге
      можно получить доступ к файлам, имена которых известны (конечно,
      если собственные права на файл разрешают такой доступ).</p><p>Если же требуется получить список файлов в некотором
      каталоге, права доступа на него должные включать доступ на
      чтение.  Для того, чтобы удалить из каталога какой-либо файл,
      имя которого известно, на этот каталог должны быть даны права
      на запись <span class="emphasis"><em>и</em></span> на исполнение.</p><p>Существуют и другие права доступа, но они как правило используются
      в особых случаях, например, setuid-бит на выполняемые файлы и sticky-бит
      на каталоги.  За дополнительными сведениями по этому вопросу обращайтесь
      к <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79033424"></a>4.4.1. Символические обозначения прав</h3></div><div><span class="authorgroup">Предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp79035856" class="indexterm"></a><p>Символические обозначения, иногда называемые символическими
	выражениями, используют буквы вместо восьмеричных значений для
	назначения прав на файлы и каталоги.  Символические выражения
	используют синтаксис (кто) (действие) (права), где существуют
	следующие значения:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Опция</th><th>Буква</th><th>Значение</th></tr></thead><tbody><tr><td>(кто)</td><td>u</td><td>Пользователь (User)</td></tr><tr><td>(кто)</td><td>g</td><td>Группа (Group)</td></tr><tr><td>(кто)</td><td>o</td><td>Другие (Other)</td></tr><tr><td>(кто)</td><td>a</td><td>Все (All, <span class="quote"><<<span class="quote">world</span>>></span>)</td></tr><tr><td>(действие)</td><td>+</td><td>Добавление прав</td></tr><tr><td>(действие)</td><td>-</td><td>Удаление прав</td></tr><tr><td>(действие)</td><td>=</td><td>Явная установка прав</td></tr><tr><td>(права)</td><td>r</td><td>Чтение (Read)</td></tr><tr><td>(права)</td><td>w</td><td>Запись (Write)</td></tr><tr><td>(права)</td><td>x</td><td>Выполнение (Execute)</td></tr><tr><td>(права)</td><td>t</td><td>Sticky бит</td></tr><tr><td>(права)</td><td>s</td><td>SUID или SGID</td></tr></tbody></table></div><p>Эти значения используются командой <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a> так же
      как и раньше, но с буквами.  Например, вы можете использовать
      следующую команду для запрета доступа других пользователей к
      <em class="replaceable"><code>FILE</code></em>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>chmod go= FILE</code></strong></pre><p>Для изменения более чем одного набора прав можно применить список,
      разделенный запятыми.  Например, следующая команда удалит права группы
      и <span class="quote"><<<span class="quote">всех остальных</span>>></span> на запись в
      <em class="replaceable"><code>FILE</code></em>, а затем добавит права на выполнение для
      всех:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>chmod go-w,a+x <em class="replaceable"><code>FILE</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79073232"></a>4.4.2. Флаги файлов в FreeBSD</h3></div><div><span class="authorgroup">Текст предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>Кроме уже описанных прав доступа к файлам, FreeBSD поддерживает
	использование <span class="quote"><<<span class="quote">флагов файлов</span>>></span>.  Эти флаги обеспечивают
	дополнительный уровень защиты и контроля над файлами, но не могут
	применяться к каталогам.</p><p>Эти флаги добавляют дополнительные возможности контроля над
	файлами, обеспечивая (при определенных условиях) невозможность их
	удаления или изменения даже пользователю <code class="systemitem">root</code>.</p><p>Файловые флаги изменяются при помощи утилиты <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a>
	посредством простого интерфейса.  К примеру, чтобы установить
	системный признак неудаляемости на файл <code class="filename">file1</code>,
	выполните следующую команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chflags sunlink file1</code></strong></pre><p>Чтобы отключить флаг неудаляемости, просто выполните предыдущую
	команду с ключом <span class="quote"><<<span class="quote">no</span>>></span> перед параметром
	<code class="option">sunlink</code>.  Вот так:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chflags nosunlink file1</code></strong></pre><p>Чтобы просмотреть флаги этого файла, воспользуйтесь командой
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> с параметрами <code class="option">-lo</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls -lo file1</code></strong></pre><p>Результат выполнения команды должен выглядеть примерно так:</p><pre class="programlisting">-rw-r--r--  1 trhodes  trhodes  sunlnk 0 Mar  1 05:54 file1</pre><p>Некоторые флаги могут быть установлены или сняты с файлов только
	пользователем <code class="systemitem">root</code>.  В остальных случаях эти флаги
	может установить владелец файла.  Для получения дополнительной
	информации мы рекомендуем изучить содержимое справки по командам
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a> и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">chflags</span>(2)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79092176"></a>4.4.3. setuid, setgid и sticky-биты в правах доступа</h3></div><div><span class="authorgroup">Текст предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>В дополнение к рассмотренным выше правам доступа и флагам файлов
	необходимо также упомянуть еще три бита прав доступа, о которых должны
	знать все системные администраторы.  Это такие биты, как
	<code class="literal">setuid</code>, <code class="literal">setgid</code> и
	<code class="literal">sticky</code>.</p><p>Эти биты играют важную роль в определённых моментах работы
	<span class="trademark">UNIX</span>(R), так как они предоставляют функциональность, расширяющую
	права обычного пользователя.  Чтобы понять как они работают, необходимо
	определить различие между реальным идентификатором пользователя
	(<acronym class="acronym">UID</acronym>) и действующим идентификатором пользователя
	(effective UID, <acronym class="acronym">EUID</acronym>).</p><p>Реальный <acronym class="acronym">UID</acronym> - это идентификатор
	пользователя, запустившего процесс на выполнение.  Действующий
	UID (<acronym class="acronym">EUID</acronym>) - это идентификатор пользователя,
	с которым на самом деле выполняется процесс.  Например, утилита
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=passwd&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">passwd</span>(1)</span></a> во время смены пароля пользователем запускается
	с реальным ID пользователя; однако, чтобы внести изменения в базу
	данных пользователей, ей необходимо работать с действующим ID
	пользователя <code class="systemitem">root</code>.  Это тот механизм, который
	позволяет обычным пользователям изменять свои пароли и при этом
	не наблюдать ошибку <span class="errorname">Permission Denied</span>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Опция <code class="literal">nosuid</code>, указанная при монтировании
	  файловой системы, отменяет действие битов
	  <code class="literal">setuid</code> и <code class="literal">setgid</code>.
	  То есть, утилиты, использующие эти биты прав, откажутся выполняться,
	  даже не выдав пользователю никакого предостережения.  К тому же,
	  (с точки зрения обеспечения безопасности) эта опция монтирования
	  не является абсолютно надежной, так как, согласно странице
	  справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>, накладываемые ею ограничения могут быть
	  обойдены при помощи <span class="quote"><<<span class="quote">обертки</span>>></span> <code class="literal">nosuid</code>
	  (<code class="literal">nosuid</code> wrapper).</p></div><p>Бит setuid устанавливается добавлением цифры четыре (4) перед
	численным представлением прав доступа, например:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 4755 suidexample.sh</code></strong></pre><p>Теперь права доступа на файл
	<code class="filename"><em class="replaceable"><code>suidexample.sh</code></em></code>
	выглядят подобно следующему:</p><pre class="programlisting">-rwsr-xr-x   1 trhodes  trhodes    63 Aug 29 06:36 suidexample.sh</pre><p>В вышеприведенной строке приметно то, что в перечне прав доступа
	для владельца файла присутствует символ <code class="literal">s</code>,
	который заменил собой бит выполнения.
	</p><p>Чтобы посмотреть <code class="literal">setuid</code> в действии,
	откройте два терминала.  На одном из них запустите команду
	<code class="command">passwd</code> с правами обычного пользователя.  Пока
	утилита ждет ввода нового пароля, просмотрите таблицу процессов
	и найдите в ней запись о процессе <code class="command">passwd</code>.</p><p>В терминале А:</p><pre class="screen">Changing local password for trhodes
Old Password:</pre><p>В терминале Б:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ps aux | grep passwd</code></strong></pre><pre class="screen">trhodes  5232  0.0  0.2  3420  1608   0  R+    2:10AM   0:00.00 grep passwd
root     5211  0.0  0.2  3620  1724   2  I+    2:09AM   0:00.01 passwd</pre><p>Как уже было сказано, утилита <code class="command">passwd</code> запущена
	с правами обычного пользователя, но ее действующий
	<acronym class="acronym">UID</acronym> - <code class="systemitem">root</code>.</p><p>Действие бита <code class="literal">setgid</code> подобно действию
	<code class="literal">setuid</code>; отличие заключается в том, что изменяются
	настройки прав для группы.  Когда выполняется приложение (или утилита)
	с установленным битом <code class="literal">setgid</code>, то ему (ей)
	будут обеспечены права в соответствии с группой владельца файла,
	а не с группой пользователя, запустившего процесс.</p><p>Чтобы установить на файл бит <code class="literal">setgid</code>,
	выполните команду <code class="command">chmod</code>, добавив цифру два (2)
	перед численным представлением прав доступа, например:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 2755 sgidexample.sh</code></strong></pre><p>Новый бит отображается подобно предыдущему случаю: обратите
	внимание на наличие <code class="literal">s</code> в перечне прав доступа
	для группы:</p><pre class="screen">-rwxr-sr-x   1 trhodes  trhodes    44 Aug 31 01:49 sgidexample.sh</pre><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">В этих примерах, несмотря на то, что сценарий оболочки является
	  исполняемым файлом, он не будет выполняться с другим действующим
	  идентификатором пользователя (<acronym class="acronym">EUID</acronym>).  Так
	  происходит потому, что сценариям командного интерпретатора недоступен
	  системный вызов <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=setuid&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">setuid</span>(2)</span></a>.</p></div><p>Позволяя расширять права пользователя, оба бита прав доступа
	(<code class="literal">setuid</code> и <code class="literal">setgid</code>) могут привести
	к снижению безопасности системы.  Третий обсуждаемый здесь бит
	- <code class="literal">sticky</code> - способствует повышению
	безопасности системы.</p><p>Бит <code class="literal">sticky</code>, будучи установленным на каталог,
	позволяет производить удаление файла только владельцу файла.  Этот
	бит применяется для предотвращения удаления файлов в публичных
	каталогах, таких как <code class="filename">/tmp</code>,
	пользователями, не владеющими файлом.  Чтобы задействовать этот
	бит, добавьте единицу (1) перед численным представлением прав
	доступа.  Например:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 1777 /tmp</code></strong></pre><p>Проверить результат можно при помощи команды
	<code class="command">ls</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls -al / | grep tmp</code></strong></pre><pre class="screen">drwxrwxrwt  10 root  wheel         512 Aug 31 01:49 tmp</pre><p>Отличительной особенностью бита <code class="literal">sticky</code>
	является наличие символа <code class="literal">t</code> в самом конце перечня
	прав.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="users-synopsis.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="basics.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="dirstructure.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">4.3. Пользователи и основы управления учетными записями </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 4.5. Структура каталогов</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>