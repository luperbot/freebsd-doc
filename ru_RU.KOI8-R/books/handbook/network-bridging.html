<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>27.5. Мосты</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="advanced-networking.html" title="Глава 27. Сложные вопросы работы в сети" /><link rel="prev" href="network-bluetooth.html" title="27.4. Bluetooth" /><link rel="next" href="network-diskless.html" title="27.6. Работа с бездисковыми станциями" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">27.5. Мосты</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-bluetooth.html">Пред.</a> </td><th width="60%" align="center">Глава 27. Сложные вопросы работы в сети</th><td width="20%" align="right"> <a accesskey="n" href="network-diskless.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-bridging"></a>27.5. Мосты</h2></div><div><span class="authorgroup">Текст создал <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Steve</span> <span class="surname">Peterson</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100242000"></a>27.5.1. Введение</h3></div></div></div><a id="idp100242640" class="indexterm"></a><a id="idp100243152" class="indexterm"></a><p>Иногда полезно разделить одну физическую сеть (такую, как
	сегмент Ethernet) на два отдельных сегмента сети без необходимости
	создания подсетей IP и использования маршрутизатора для соединения
	сегментов.  Устройство, которое соединяет две сети на такой манер,
	называется <span class="quote"><<<span class="quote">сетевым мостом</span>>></span> (<span class="quote"><<<span class="quote">bridge</span>>></span>).
	Система FreeBSD с двумя сетевыми адаптерами может выступать в роли
	моста.</p><p>Мост работает на основе изучения адресов уровня MAC (адресов
	Ethernet) устройств на каждом из своих сетевых интерфейсах.
	Он перенаправляет трафик между двумя сетями, только когда адреса
	отправителя и получателя находятся в разных сетях.</p><p>По многим параметрам мост работает также, как коммутатор Ethernet
	с малым количеством портов.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100245712"></a>27.5.2. Ситуации, когда можно использовать мосты</h3></div></div></div><p>На сегодняшний день есть две ситуации, когда можно использовать
	мост.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100246736"></a>27.5.2.1. Большой трафик в сегменте</h4></div></div></div><p>Первая ситуация возникает, когда ваша физическая сеть перегружена
	  трафиком, но по каким-то соображениям вы не хотите разделять сеть
	  на подсети и соединять их с помощью маршрутизатора.</p><p>Давайте рассмотрим в качестве примера газету, в которой
	  редакторский и производственный отделы находятся в одной и той же
	  подсети.  Пользователи в редакторском отделе все используют сервер
	  <code class="systemitem">A</code> для служб доступа к файлам, а пользователи
	  производственного отдела используют сервер <code class="systemitem">B</code>.  Для
	  объединения всех пользователей используется сеть Ethernet, а высокая
	  нагрузка на сеть замедляет работу.</p><p>Если пользователи редакторского отдела могут быть собраны в
	  одном сегменте сети, а пользователи производственного отдела в
	  другом, то два сетевых сегмента можно объединить мостом.  Только
	  сетевой трафик, предназначенный для интерфейсов с
	  <span class="quote"><<<span class="quote">другой</span>>></span> стороны моста, будет посылаться в другую сеть,
	  тем самым снижая уровень нагрузки на каждый сегмент сети.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100249808"></a>27.5.2.2. Сетевой экран с возможностями фильтрации/ограничения
	  пропускной способности трафика</h4></div></div></div><a id="idp100316112" class="indexterm"></a><a id="idp100316624" class="indexterm"></a><p>Второй распространённой ситуацией является необходимость в
	  обеспечении функций сетевого экрана без трансляции
	  сетевых адресов (NAT).</p><p>Для примера можно взять маленькую компанию, которая подключена
	  к своему провайдеру по каналу DSL или ISDN.  Для неё провайдер
	  выделил 13 глобально доступных IP-адресов для имеющихся в сети 10
	  персональных компьютеров.  В такой ситуации использование сетевого
	  экрана на основе маршрутизатора затруднено из-за проблем с
	  разделением на подсети.</p><a id="idp100317904" class="indexterm"></a><a id="idp100318416" class="indexterm"></a><a id="idp100318928" class="indexterm"></a><p>Брандмауэр на основе моста может быть настроен и включен
	  между маршрутизаторами DSL/ISDN без каких-либо проблем с
	  IP-адресацией.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100320080"></a>27.5.3. Настройка моста</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100320720"></a>27.5.3.1. Выбор сетевого адаптера</h4></div></div></div><p>Для работы моста требуются по крайней мере два сетевых адаптера.
	  К сожалению, не все сетевые адаптеры поддерживают
	  функции моста.  Прочтите страницу Справочника по <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bridge&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bridge</span>(4)</span></a> для
	  выяснения подробностей о поддерживаемых адаптерах.</p><p>Перед тем, как продолжить, сначала установите и протестируйте
	  два сетевых адаптера.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100323024"></a>27.5.3.2. Изменения в конфигурации ядра</h4></div></div></div><a id="idp100323664" class="indexterm"></a><p>Для включения поддержки функций сетевого моста в ядре, добавьте
	  строчку</p><pre class="programlisting">options BRIDGE</pre><p>в файл конфигурации вашего ядра, и перестройте ядро.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100330320"></a>27.5.3.3. Поддержка функций брандмауэра</h4></div></div></div><a id="idp100330960" class="indexterm"></a><p>Если вы планируете использовать мост в качестве
	  брандмауэра, вам нужно также добавить опцию
	  <code class="literal">IPFIREWALL</code>.
	  Прочтите <a class="xref" href="firewalls.html" title="Глава 26. Межсетевые экраны">Глава 26, <em>Межсетевые экраны</em></a>, содержащую общую
	  информацию о настройке моста в качестве брандмауэра.</p><p>Если вам необходимо обеспечить прохождение не-IP пакетов (таких,
	  как ARP) через мост, то имеется опция брандмауэра,
	  которую можно задать.  Это опция
	  <code class="literal">IPFIREWALL_DEFAULT_TO_ACCEPT</code>.  Заметьте, что при
	  этом правило, используемое брандмауэром по умолчанию, меняется
	  на разрешительное для всех пакетов.  Перед тем, как задавать эту
	  опцию, убедитесь, что вы понимаете работу вашего набора
	  правил.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100333520"></a>27.5.3.4. Поддержка функций ограничения пропускной способности</h4></div></div></div><p>Если вы хотите использовать мост в качестве машины,
	  ограничивающей пропускную способность, то добавьте в файл
	  конфигурации ядра опцию <code class="literal">DUMMYNET</code>.  Дополнительную
	  информацию можно почерпнуть из страницы Справочника по
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dummynet&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">dummynet</span>(4)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100335952"></a>27.5.4. Включение функций моста</h3></div></div></div><p>Добавьте строку</p><pre class="programlisting">net.link.ether.bridge.enable=1</pre><p>в файл <code class="filename">/etc/sysctl.conf</code> для включения функций
	моста во время работы системы, и строку:</p><pre class="programlisting">net.link.ether.bridge.config=<em class="replaceable"><code>if1</code></em>,<em class="replaceable"><code>if2</code></em></pre><p>для включения функций моста для указанных интерфейсов (замените
	<em class="replaceable"><code>if1</code></em> и <em class="replaceable"><code>if2</code></em> на
	имена двух ваших сетевых интерфейсов).  Если вы хотите, чтобы
	проходящие через мост пакеты фильтровались посредством <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>,
	вы должны также добавить строчку:</p><pre class="programlisting">net.link.ether.bridge.ipfw=1</pre><p>Для версий FreeBSD, предшествующих FreeBSD 5.2-RELEASE, нужно
	использовать следующие строки:</p><pre class="programlisting">net.link.ether.bridge=1
net.link.ether.bridge_cfg=<em class="replaceable"><code>if1</code></em>,<em class="replaceable"><code>if2</code></em>
net.link.ether.bridge_ipfw=1</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100343376"></a>27.5.5. Дополнительные замечания</h3></div></div></div><p>Если вы хотите осуществлять удалённый доступ на мост через
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> из сети, то корректно назначить одному из сетевых
	адаптеров IP-адрес.  Общепринято, что назначение адреса обоим сетевым
	адаптерам является не самой хорошей идеей.</p><p>Если в вашей сети присутствует несколько мостов, не должно быть
	более одного маршрута между любыми двумя рабочими станциями.  С
	технической точки зрения это означает отсутствие поддержки протокола
	spanning tree.</p><p>Сетевой мост может увеличить задержки в замерах командой
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a>, особенно для трафика между двумя разными
	сегментами.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-bluetooth.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="network-diskless.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">27.4. Bluetooth </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 27.6. Работа с бездисковыми станциями</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>