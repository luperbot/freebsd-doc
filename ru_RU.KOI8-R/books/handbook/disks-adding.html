<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>17.3. Добавление дисков</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="disks.html" title="Глава 17. Устройства хранения" /><link rel="prev" href="disks-naming.html" title="17.2. Имена устройств" /><link rel="next" href="raid.html" title="17.4. RAID" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">17.3. Добавление дисков</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="disks-naming.html">Пред.</a> </td><th width="60%" align="center">Глава 17. Устройства хранения</th><td width="20%" align="right"> <a accesskey="n" href="raid.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-adding"></a>17.3. Добавление дисков</h2></div><div><span class="authorgroup">Изначальный текст предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">David</span> <span class="surname">O'Brien</span></span>. </span></div></div></div><a id="idp90996560" class="indexterm"></a><p>В этом разделе будет описан процесс добавления нового
      <acronym class="acronym">SCSI</acronym> диска на машину,
      имеющую в данный момент только один диск.  Сначала выключим компьютер и
      установим диск в компьютер согласно инструкциям к компьютеру,
      контроллеру и от производителя диска.  Из-за большого разнообразия
      этих процедур их рассмотрение выходит за рамки этого документа..</p><p>Войдите в систему как пользователь <code class="systemitem">root</code>.
      После того, как вы установили диск, просмотрите файл
      <code class="filename">/var/run/dmesg.boot</code>, чтобы убедиться, что новый
      диск был найден.	Продолжая наш пример, только что добавленный диск
      будет называться <code class="filename">da1</code> и мы хотим смонтировать его
      в каталог <code class="filename">/1</code> (если вы добавляете диск IDE, то
      устройство будет называться <code class="filename">ad1</code>).</p><a id="idp91000912" class="indexterm"></a><a id="idp91001808" class="indexterm"></a><a id="idp91002576" class="indexterm"></a><p>FreeBSD работает на IBM-PC совместимых компьютерах, поэтому она
      должна уметь работать с разделами PC BIOS.  Однако они отличаются от
      традиционных разделов BSD.  Диск ПК может иметь до четырёх
      записей разделов BIOS.  Если диск на самом деле будет использоваться
      исключительно под FreeBSD, вы можете использовать режим
      <span class="emphasis"><em>dedicated</em></span>.  В противном случае FreeBSD будет
      располагаться в одном из разделов PC BIOS.  Во FreeBSD разделы PC BIOS
      называются <span class="emphasis"><em>слайсами</em></span>, чтобы не путать их с
      традиционными разделами BSD.  Вы также можете использовать слайсы и с
      диском, предназначенным исключительно для FreeBSD, однако используемым
      в компьютере, на котором имеется дополнительная операционная система.
      Это является хорошим способом избежать путаницы в утилите
      <code class="command">fdisk</code> других операционных систем, не связанных с
      FreeBSD.</p><p>В случае слайсов диск будет добавлен как
      <code class="filename">/dev/da1s1e</code>.  Это интерпретируется следующим
      образом: диск SCSI, устройство номер 1 (второй диск SCSI), слайс 1
      (раздел PC BIOS 1), и раздел BSD <code class="filename">e</code>.	В случае
      использования в выделенном режиме диск будет добавлен просто как
      <code class="filename">/dev/da1e</code>.</p><p>Вследствие использования 32-разрядных целых чисел для адресации
      секторов, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a> ограничен 2^32-1 секторами на диск, или 2TB
      в большинстве случаев.  Формат <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fdisk&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">fdisk</span>(8)</span></a> позволяет наличие
      первого сектора со смещением не более 2^32-1 и длину не более
      2^32-1, что ограничивает размер раздела до 2TB, а размер диска
      до 4TB в большинстве случаев.  Формат <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sunlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sunlabel</span>(8)</span></a> ограничен
      2^32-1 секторами на раздел и 8 разделами, что составляет 16TB.
      Для дисков большего раздела могут быть использованы разделы
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gpt&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gpt</span>(8)</span></a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91018192"></a>17.3.1. Использование утилиты <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a></h3></div></div></div><a id="idp91019472" class="indexterm"></a><a id="idp91020752" class="indexterm"></a><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Использование <span class="application">Sysinstall</span></strong></p><p>Вы можете использовать простые меню утилиты
	    <code class="command">sysinstall</code> для разбиения на разделы и
	    разметки нового диска.  Войдите как пользователь
	    <code class="systemitem">root</code> или воспользуйтесь командой
	    <code class="command">su</code>.  Запустите команду
	    <code class="command">sysinstall</code> и войдите в меню
	    <code class="literal">Configure</code>.  Внутри <code class="literal">FreeBSD
	    Configuration Menu</code>, пролистайте и выберите пункт
	    <code class="literal">Fdisk</code>.</p></li><li class="step"><p class="title"><strong>Редактор разделов <span class="application">fdisk</span></strong></p><p>При работе с утилитой <span class="application">fdisk</span> нажатие
	    <span class="keycap"><strong>A</strong></span> используется для выделения под
	    FreeBSD полностью всего диска.  Когда будет задан вопрос о том,
	    хотите ли вы <span class="quote"><<<span class="quote">сохранить совместимость с другими возможными
	    операционными системами в будущем</span>>></span>, ответьте
	    <code class="literal">YES</code>.  Запишите изменения на диск при помощи
	    команды <span class="keycap"><strong>W</strong></span>.  А теперь выйдите из редактора
	    FDISK, нажав <span class="keycap"><strong>Q</strong></span>.  В этот момент вам будет
	    задан вопрос о <span class="quote"><<<span class="quote">Master Boot Record</span>>></span> (главной
	    загрузочной записи).  Так как вы добавляете диск к уже работающей
	    системе, выберите <code class="literal">None</code>.</p></li><li class="step"><p class="title"><strong>Редактор метки диска</strong></p><a id="idp91031504" class="indexterm"></a><p>Теперь вам нужно выйти из <span class="application">sysinstall</span>
	    и запустить эту утилиту снова.  Следуйте указаниям выше, но на этот
	    раз выберите пункт <code class="literal">Label</code>.  Вы перейдёте к
	    меню <code class="literal">Disk Label Editor</code>.
	    Здесь вы создадите традиционные разделы BSD.  На диске может быть
	    до восьми разделов, имеющих метки <code class="literal">a-h</code>.
	    Некоторые из меток разделов
	    имеют особый смысл.  Раздел <code class="literal">a</code> используется для
	    размещения корневого раздела (<code class="filename">/</code>).  По этой
	    причине только ваш системный диск (например, тот, с которого
	    происходит загрузка), должен иметь раздел <code class="literal">a</code>.
	    Раздел <code class="literal">b</code> используется под раздел подкачки, и вы
	    можете иметь много дисков с разделами подкачки.  Раздел
	    <code class="literal">c</code> используется для доступа ко всему диску в
	    режиме эксклюзивного использования или ко всему слайсу FreeBSD при
	    работе в режиме с использованием слайсов.  Остальные разделы имеют
	    обычное предназначение.</p><p>Редактор метки диска программы
	    <span class="application">sysinstall</span> использует раздел
	    <code class="literal">e</code> для некорневого раздела и не для раздела
	    подкачки.  Внутри редактора метки диска создайте отдельную файловую
	    систему, нажав <span class="keycap"><strong>C</strong></span>.  Когда будет задан
	    вопрос о том, будет ли это раздел с файловой системой (FS) или это
	    будет раздел подкачки, выберите <code class="literal">FS</code> и наберите
	    точку монтирования (например, <code class="filename">/mnt</code>).  При
	    добавлении диска после установки системы, программа
	    <span class="application">sysinstall</span> не
	    будет автоматически создавать записи в файле
	    <code class="filename">/etc/fstab</code>, поэтому точка монтирования не так
	    уж и важна.</p><p>Теперь вы готовы записать новую метку на диск и создать на нем
	    файловую систему.  Сделайте это, нажав <span class="keycap"><strong>W</strong></span>.
	    Проигнорируйте сообщения об ошибках от
	    <span class="application">sysinstall</span> о невозможности смонтировать
	    новый раздел.  Полностью выйдите из редактора метки диска и из
	    программы <span class="application">sysinstall</span>.</p></li><li class="step"><p class="title"><strong>Завершение</strong></p><p>Последний шаг заключается в редактировании файла
	    <code class="filename">/etc/fstab</code> и добавлении записи для вашего
	    нового диска.</p></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91054928"></a>17.3.2. Использовании утилит командной строки</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91055568"></a>17.3.2.1. Работа со слайсами</h4></div></div></div><p>Следующая настройка позволит вашему диску корректно работать с
	  другими операционными системами, которые могут быть установлены на
	  вашем компьютере, и не вызовет конфликта с утилитами
	  <code class="command">fdisk</code> других операционных систем.  Этот способ
	  рекомендуется использовать для установок новых дисков.  Используйте
	  <code class="literal">эксклюзивный</code> режим, только если у вас есть
	  реальные причины делать это!</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/dev/da1 bs=1k count=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>fdisk -BI da1</code></strong> # Инициализируем новый диск.
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -B -w da1s1 auto</code></strong> # Размечаем его.
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -e da1s1</code></strong> # Редактируем только что созданную метку диска и добавляем разделы.
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/da1s1e</code></strong> # Повторяем этот шаг для всех созданных разделов.
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/da1s1e /1</code></strong> # Монтируем раздел(ы)
<code class="prompt">#</code> <strong class="userinput"><code>vi /etc/fstab</code></strong> # Добавляем соответствующую запись/записи в файл <code class="filename">/etc/fstab</code>.</pre><p>Если у вас установлен диск IDE, подставьте
	  <code class="filename">ad</code> вместо <code class="filename">da</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91065552"></a>17.3.2.2. Эксклюзивный режим</h4></div></div></div><a id="idp91066192" class="indexterm"></a><p>Если вы не будете использовать новый диск совместно с другой
	  операционной системой, то вы можете использовать режим
	  <code class="literal">эксклюзивного</code> использования.  Отметьте, что этот
	  режим может ввести в заблуждение операционные системы от Microsoft;
	  однако информацию они не разрушат.  А вот <span class="trademark">OS/2</span>(R) компании IBM будет
	  <span class="quote"><<<span class="quote">забирать себе</span>>></span> любой раздел, который она найдет и не
	  сможет распознать.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/dev/da1 bs=1k count=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -Bw da1 auto</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -e da1</code></strong>                           # create the `e' partition
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/da1e</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>vi /etc/fstab</code></strong>                              # add an entry for /dev/da1e
<code class="prompt">#</code> <strong class="userinput"><code>mount /1</code></strong></pre><p>Альтернативный метод заключается в следующем:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/dev/da1 count=2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel /dev/da1 | bsdlabel -BR da1 /dev/stdin</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/da1e</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>vi /etc/fstab</code></strong>                              # add an entry for /dev/da1e
<code class="prompt">#</code> <strong class="userinput"><code>mount /1</code></strong></pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="disks-naming.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="raid.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">17.2. Имена устройств </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 17.4. RAID</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>