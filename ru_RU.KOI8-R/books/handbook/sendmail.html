<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>24.3. Настройка sendmail</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="mail.html" title="Глава 24. Электронная почта" /><link rel="prev" href="mail-using.html" title="24.2. Использование электронной почты" /><link rel="next" href="mail-changingmta.html" title="24.4. Установка другой почтовой программы" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">24.3. Настройка <span class="application">sendmail</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mail-using.html">Пред.</a> </td><th width="60%" align="center">Глава 24. Электронная почта</th><td width="20%" align="right"> <a accesskey="n" href="mail-changingmta.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="sendmail"></a>24.3. Настройка <span class="application">sendmail</span></h2></div><div><span class="authorgroup">Предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Christopher</span> <span class="surname">Shumway</span></span>. </span></div></div></div><a id="idp96435792" class="indexterm"></a><p>В FreeBSD по умолчанию программой передачи почты (Mail Transfer
      Agent, MTA) является <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sendmail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sendmail</span>(8)</span></a>.  Работа
      <span class="application">sendmail</span> заключается в приеме почты от
      почтовых программ пользователей (Mail User Agents,
      <acronym class="acronym">MUA</acronym>) и отправке ее на соответствующий адрес,
      в соответствии с имеющимися настройками.
      <span class="application">sendmail</span> может также принимать входящие
      соединения по сети и доставлять почту в локальные почтовые ящики
      или перенаправлять их другой программе.</p><p><span class="application">sendmail</span> использует следующие файлы
      настройки:</p><a id="idp96439632" class="indexterm"></a><a id="idp96440528" class="indexterm"></a><a id="idp96441552" class="indexterm"></a><a id="idp96442448" class="indexterm"></a><a id="idp96443344" class="indexterm"></a><a id="idp96444240" class="indexterm"></a><a id="idp96445136" class="indexterm"></a><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Имя файла</th><th>Назначение</th></tr></thead><tbody><tr><td><code class="filename">/etc/mail/access</code></td><td>Файл базы данных доступа
	      <span class="application">sendmail</span></td></tr><tr><td><code class="filename">/etc/mail/aliases</code></td><td>Синонимы почтовых ящиков</td></tr><tr><td><code class="filename">/etc/mail/local-host-names</code></td><td>Список хостов, для которых
	      <span class="application">sendmail</span> принимает почту</td></tr><tr><td><code class="filename">/etc/mail/mailer.conf</code></td><td>Настройки почтовой программы</td></tr><tr><td><code class="filename">/etc/mail/mailertable</code></td><td>Таблица доставки почтовой программы</td></tr><tr><td><code class="filename">/etc/mail/sendmail.cf</code></td><td>Основной файл настройки
	      <span class="application">sendmail</span></td></tr><tr><td><code class="filename">/etc/mail/virtusertable</code></td><td>Таблицы виртуальных пользователей и доменов</td></tr></tbody></table></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96463312"></a>24.3.1. <code class="filename">/etc/mail/access</code></h3></div></div></div><p>База данных доступа определяет список хостов или IP адресов,
	имеющих доступ к локальному почтовому серверу, а также тип
	предоставляемого доступа.  Хосты могут быть перечислены как
	<code class="option">OK</code>, <code class="option">REJECT</code>, <code class="option">RELAY</code>
	или просто переданы процедуре обработки ошибок
	<span class="application">sendmail</span> с заданным сообщением об ошибке.
	Хостам, перечисленным с параметром по умолчанию <code class="option">OK</code>,
	разрешено отправлять почты на этот хост, если адрес назначения почты
	принадлежит локальной машине.  Все почтовые соединения от хостов,
	перечисленных с параметром <code class="option">REJECT</code>, отбрасываются.
	Для хостов, перечисленных с параметром <code class="option">RELAY</code>,
	разрешена передача через этот сервер почты с любым адресом
	назначения.</p><div class="example"><a id="idp96467152"></a><div class="example-title">Пример 24.1. Настройка базы данных доступа
	  <span class="application">sendmail</span></div><div class="example-contents"><pre class="programlisting">cyberspammer.com		550 We do not accept mail from spammers
FREE.STEALTH.MAILER@		550 We do not accept mail from spammers
another.source.of.spam          REJECT
okay.cyberspammer.com           OK
128.32                          RELAY</pre></div></div><br class="example-break" /><p>В этом примере приведены пять записей.  К отправителям, чей адрес
	соответствует записи в левой части таблицы, применяется правило
	записанное в правой части таблицы.  В первых двух примерах
	код ошибки будет передан процедуре обработке ошибок
	<span class="application">sendmail</span>.  В этом случае на удаленном хосте
	будет получено соответствующее сообщение.  В следующем примере почта
	отбрасывается почта от определенного хоста,
	<code class="systemitem">another.source.of.spam</code>.  В четвертом примере
	разрешается прием почты от хоста <code class="systemitem">okay.cyberspammer.com</code>, имя которого более точно
	совпадает с этой записью, чем с <code class="systemitem">cyberspammer.com</code> в примере выше.  При более
	точном совпадении правила перезаписываются.  В последнем примере
	разрешается пересылка почты от хостов с IP адресами, начинающимися
	с <code class="systemitem">128.32</code>.  Эти хосты смогут отправлять почту через
	этот почтовый сервер для других почтовых серверов.</p><p>После изменения этого файла для обновления базы данных
	вам потребуется запустить <code class="command">make</code> в каталоге
	<code class="filename">/etc/mail/</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96517584"></a>24.3.2. <code class="filename">/etc/mail/aliases</code></h3></div></div></div><p>База данных синонимов содержит список виртуальных почтовых
	ящиков, принадлежащих другим пользователям, файлам, программам, или
	другим синонимам.  Вот несколько примеров, которые могут быть
	использованы для <code class="filename">/etc/mail/aliases</code>:</p><div class="example"><a id="idp96519120"></a><div class="example-title">Пример 24.2. Mail Aliases</div><div class="example-contents"><pre class="programlisting">root: localuser
ftp-bugs: joe,eric,paul
bit.bucket:  /dev/null
procmail: "|/usr/local/bin/procmail"</pre></div></div><br class="example-break" /><p>Формат файла прост; имя почтового ящика слева от двоеточия
	сопоставляется назначению(ям) справа.  В первом примере
	производится сопоставление почтового ящика
	<code class="systemitem">root</code> почтовому ящику
	<code class="systemitem">localuser</code>, для которого затем опять будет
	произведен поиск в базе данных синонимов.  Если совпадений не
	обнаружится, сообщение будет доставлено локальному пользователю
	<code class="systemitem">localuser</code>.  В следующем примере приведен
	список рассылки.  Почта на адрес <code class="systemitem">ftp-bugs</code>
	рассылается на три локальных почтовых ящика: <code class="systemitem">joe</code>,
	<code class="systemitem">eric</code> и <code class="systemitem">paul</code>.  Обратите
	внимание, что удалённый почтовый ящик может быть задан в виде
	<code class="email">&lt;<a xmlns="" class="email" href="mailto:user@example.com">user@example.com</a>&gt;</code>.  В следующем примере
	показана запись почты в файл, в данном случае
	<code class="filename">/dev/null</code>.  И в последнем примере показано
	отправление почты программе, в данном случае почтовое сообщение
	переправляется через канал <span class="trademark">UNIX</span>(R) на стандартный вход
	<code class="filename">/usr/local/bin/procmail</code>.</p><p>После обновления этого файла вам потребуется запустить
	<code class="command">make</code> в каталоге <code class="filename">/etc/mail/</code>
	для обновления базы данных.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96527312"></a>24.3.3. <code class="filename">/etc/mail/local-host-names</code></h3></div></div></div><p>В этом файле находится список имен хостов, принимаемых
	программой <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sendmail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sendmail</span>(8)</span></a> в качестве локальных.  Поместите в
	этот файл любые домены или хосты, для которых
	<span class="application">sendmail</span> должен принимать почту.
	Например, если этот почтовый сервер должен принимать почту для
	домена <code class="systemitem">example.com</code> и хоста
	<code class="systemitem">mail.example.com</code>, его файл
	<code class="filename">local-host-names</code> может выглядеть примерно
	так:</p><pre class="programlisting">example.com
mail.example.com</pre><p>После обновления этого файла необходимо перезапустить
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sendmail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sendmail</span>(8)</span></a>, чтобы он смог перечитать изменения.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96537168"></a>24.3.4. <code class="filename">/etc/mail/sendmail.cf</code></h3></div></div></div><p>Основной файл настройки <span class="application">sendmail</span>,
	<code class="filename">sendmail.cf</code> управляет общим поведением
	<span class="application">sendmail</span>, включая все, от перезаписи
	почтовых адресов до отправки удаленным серверам сообщений об
	отказе от пересылки почты.  Конечно, файл настройки с таким
	многообразием возможностей очень сложен и подробное его описание
	выходит за рамки данного раздела.  К счастью, для стандартных
	почтовых серверов изменять этот файл придется не часто.</p><p>Основной файл настройки <span class="application">sendmail</span>
	может быть собран из макроса <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=m4&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">m4</span>(1)</span></a>, определяющего возможности
	и поведение <span class="application">sendmail</span>.  Подробнее
	этот процесс описан в файле
	<code class="filename">/usr/src/contrib/sendmail/cf/README</code>.</p><p>Для применения изменений после правки файла необходимо
	перезапустить <span class="application">sendmail</span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96542672"></a>24.3.5. <code class="filename">/etc/mail/virtusertable</code></h3></div></div></div><p>Файл <code class="filename">virtusertable</code> сопоставляет виртуальные
	почтовые домены и почтовые ящики реальным почтовым ящикам.  Эти
	почтовые ящики могут быть локальными, удаленными, синонимами,
	определенными в <code class="filename">/etc/mail/aliases</code>, или
	файлами.</p><div class="example"><a id="idp96544720"></a><div class="example-title">Пример 24.3. Пример таблицы виртуального домена</div><div class="example-contents"><pre class="programlisting">root@example.com                root
postmaster@example.com          postmaster@noc.example.net
@example.com                    joe</pre></div></div><br class="example-break" /><p>В примере выше мы видим сопоставление адресов для домена
	<code class="systemitem">example.com</code>.  Почта
	обрабатывается по первому совпадению с записью в этом файле.
	Первая запись сопоставляет адрес <code class="email">&lt;<a xmlns="" class="email" href="mailto:root@example.com">root@example.com</a>&gt;</code>
	локальному почтовому ящику <code class="systemitem">root</code>.
	Вторая запись сопоставляет <code class="email">&lt;<a xmlns="" class="email" href="mailto:postmaster@example.com">postmaster@example.com</a>&gt;</code>
	локальному почтовому ящику <code class="systemitem">postmaster</code>
	на хосте <code class="systemitem">noc.example.net</code>.  Наконец,
	до этого момента адрес в домене <code class="systemitem">example.com</code> не совпал ни с одним из
	предыдущих, будет применено последнее сопоставление, в которому
	соответствует всякое другое почтовое сообщение, отправленное на любой
	адрес в <code class="systemitem">example.com</code>.  Это сообщение
	будет доставлено в локальный почтовый ящик
	<code class="systemitem">joe</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mail-using.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="mail.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="mail-changingmta.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">24.2. Использование электронной почты </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 24.4. Установка другой почтовой программы</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>