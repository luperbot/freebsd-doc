<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>8.2. Настройка звуковой карты</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="multimedia.html" title="Глава 8. Мультимедиа" /><link rel="prev" href="multimedia.html" title="Глава 8. Мультимедиа" /><link rel="next" href="sound-mp3.html" title="8.3. Звук MP3" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">8.2. Настройка звуковой карты</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="multimedia.html">Пред.</a> </td><th width="60%" align="center">Глава 8. Мультимедиа</th><td width="20%" align="right"> <a accesskey="n" href="sound-mp3.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="sound-setup"></a>8.2. Настройка звуковой карты</h2></div><div><span class="authorgroup">Предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Moses</span> <span class="surname">Moore</span></span>. </span></div><div><span class="authorgroup">Расширил для FreeBSD 5.X <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-device"></a>8.2.1. Настройка системы</h3></div></div></div><a id="idp81814224" class="indexterm"></a><a id="idp81814736" class="indexterm"></a><a id="idp81815248" class="indexterm"></a><p>Перед тем как начать, определите модель вашей карты,
      процессор, который она использует, и интерфейс карты: PCI или ISA.
      FreeBSD поддерживает множество разных PCI и ISA карт.
      Сверьтесь со списком поддерживаемых аудио устройств в <a class="link" href="http://www.FreeBSD.org/releases/10.1R/hardware.html" target="_top">Информации об оборудовании</a>,
      чтобы проверить, поддерживается ли ваша карта.  Этот документ также
      содержит информацию о том, какой драйвер поддерживает вашу
      карту.</p><a id="idp81816656" class="indexterm"></a><p>Для того, чтобы использовать звуковую карту, вы должный загрузить
     соответствующий драйвер устройства. Этого можно достигнуть двумя путями.
     Простейший способ - это просто загрузить соответствующий вашей карте
     модуль ядра используя <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>, что можно сделать или из командной
     строки:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_emu10k1</code></strong></pre><p>или добавлением соответствующей строки к файлу
      <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">snd_emu10k1_load="YES"</pre><p>Эти примеры приведены для звуковой карты Creative
      <span class="trademark">SoundBlaster</span>(R) Live!.  Другие имеющиеся модули драйверов
      звуковых карты приведены в
      <code class="filename">/boot/defaults/loader.conf</code>
      Если вы не уверены, какой драйвер использовать, попробуйте загрузить
      <code class="filename">snd_driver</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_driver</code></strong></pre><p>Это мета-драйвер, загружающий сразу все наиболее распространенные
      драйверы сразу.  Это повышает скорость поиска правильного драйвера.
      Возможна также загрузка всех звуковых драйверов через
      <code class="filename">/boot/loader.conf</code>.</p><p>Для того чтобы узнать, какой именно драйвер требуется для вашей
      звуковой карты, вы можете проверить содержимое файла
      <code class="filename">/dev/sndstat</code> при помощи команды
      <code class="command">cat /dev/sndstat</code>.</p><p>Другой способ заключается в
     добавлении статического драйвера в ядро.  В разделе ниже дана
     более подробная информация о том, что вам нужно сделать для добавления
     поддержки оборудования.  Более подробно о конфигурация ядра описана в
     <a class="xref" href="kernelconfig.html" title="Глава 9. Настройка ядра FreeBSD">Глава 9, <em>Настройка ядра FreeBSD</em></a>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81838800"></a>8.2.1.1. Настройка собственного ядра с поддержкой звука</h4></div></div></div><p>Первое, что необходимо сделать, это добавить в ядро
	общий звуковой драйвер <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sound&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">sound</span>(4)</span></a>.  Добавьте в
	файл конфигурации ядра следующую строку:</p><pre class="programlisting">device sound</pre><p>Затем необходимо добавить поддержку имеющейся звуковой
	карты.  Следовательно, нужно знать какой драйвер поддерживает
	карту.  Для этого сверьтесь со списком поддерживаемых
	устройств из <a class="link" href="http://www.FreeBSD.org/releases/10.1R/hardware.html" target="_top">Информации об оборудовании</a>.
	Например, звуковая карта Creative <span class="trademark">SoundBlaster</span>(R) Live!
	поддерживается драйвером <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_emu10k1&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_emu10k1</span>(4)</span></a>.
	Для добавления поддержки этой карты, используйте:</p><pre class="programlisting">device snd_emu10k1</pre><p>Прочтите страницу справочника драйвера, чтобы узнать,
	какой синтаксис использовать.  Информация, относящаяся
	к синтаксису включения звуковых драйверов в файл конфигурации
	ядра, может быть также найдена в файле
	<code class="filename">/usr/src/sys/conf/NOTES</code>.</p><p>Не-PnP ISA карты могут потребовать включения в ядро
	информации о настройках звуковой карты (IRQ, I/O port,
	и т.д.).  Эта информация добавляется редактированием
	файла <code class="filename">/boot/device.hints</code>.
	Во время загрузки системы <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> прочтет этот
	файл и передаст настройки ядру.  Например, старая ISA не-PnP карта
	Creative <span class="trademark">SoundBlaster</span>(R) 16 использует драйвер <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a>
	совместно с snd_sb16(4).  Для этой карты к файлу настройки ядра
	необходимо добавить следующие строки:</p><pre class="programlisting">device snd_sbc
device snd_sb16</pre><p>и со следующей информацией в
	<code class="filename">/boot/device.hints</code>:</p><pre class="programlisting">hint.sbc.0.at="isa"
hint.sbc.0.port="0x220"
hint.sbc.0.irq="5"
hint.sbc.0.drq="1"
hint.sbc.0.flags="0x15"</pre><p>В данном случае, карта использует порт ввода-вывода
	<code class="literal">0x220</code> и IRQ <code class="literal">5</code>.</p><p>Синтаксис, используемый в файле
	<code class="filename">/boot/device.hints</code>, описан в справочной
	странице драйвера.</p><p>Установки, приведенные выше, используются по умолчанию.
	В некоторых случаях вам может потребоваться изменить IRQ
	или другие настройки в соответствии с настройками карты.
	За более подробной информацией обратитесь к странице справочника
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-testing"></a>8.2.2. Тестирование звуковой карты</h3></div></div></div><p>После перезагрузки модифицированного ядра, или после загрузки
      необходимого модуля, звуковая карта должна появиться в буфере
      системных сообщений (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a>) примерно так:</p><pre class="screen">pcm0: &lt;Intel ICH3 (82801CA)&gt; port 0xdc80-0xdcbf,0xd800-0xd8ff irq 5 at device 31.5 on pci0
pcm0: [GIANT-LOCKED]
pcm0: &lt;Cirrus Logic CS4205 AC97 Codec&gt;</pre><p>Статус звуковой карты может быт проверен через файл
      <code class="filename">/dev/sndstat</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat /dev/sndstat</code></strong>
FreeBSD Audio Driver (newpcm)
Installed devices:
pcm0: &lt;Intel ICH3 (82801CA)&gt; at io 0xd800, 0xdc80 irq 5 bufsz 16384
kld snd_ich (1p/2r/0v channels duplex default)</pre><p>Вывод этой команды для вашей системы может отличаться.
      Если устройства <code class="filename">pcm</code> не появились, вернитесь
      назад и проверьте выполненные действия.  Проверьте файл настройки
      ядра еще раз и убедитесь, что выбрано подходящее устройство.
      Часто встречающиеся проблемы приведены в <a class="xref" href="sound-setup.html#troubleshooting" title="8.2.2.1. Часто встречающиеся проблемы">Раздел 8.2.2.1, <<Часто встречающиеся проблемы>></a>.</p><p>Если всё пройдет удачно, звуковая карта заработает. Если
      CD-ROM или DVD-ROM привод правильно подключён к звуковой карте, вы можете
      вставить CD в привод и воспроизвести его при помощи
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cdcontrol&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cdcontrol</span>(1)</span></a>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cdcontrol -f /dev/acd0 play 1</code></strong></pre><p>Различные приложения, например <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/audio/workman/pkg-descr">audio/workman</a> могут предоставить
      более дружественный
      пользователю интерфейс.  Вы можете также установить
      приложения для прослушивания звуковых файлов MP3, как например
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/audio/mpg123/pkg-descr">audio/mpg123</a>.  Быстрым способом
      тестирования звуковой карты является отправка данных в
      файл <code class="filename">/dev/dsp</code>, как показано здесь:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cat <em class="replaceable"><code>filename</code></em> &gt; /dev/dsp</code></strong></pre><p>где <em class="replaceable"><code>filename</code></em> может быть любым
      файлом.  Результатом выполнения этой команды станет шум,
      который означает, что звуковая карта на самом деле
      работает.</p><p>Уровни громкости звука могут быть изменены командой <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mixer&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mixer</span>(8)</span></a>.
      Более подробная информация находится на странице справочной системы
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mixer&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mixer</span>(8)</span></a>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="troubleshooting"></a>8.2.2.1. Часто встречающиеся проблемы</h4></div></div></div><a id="idp81878480" class="indexterm"></a><a id="idp81878992" class="indexterm"></a><a id="idp81879504" class="indexterm"></a><a id="idp81880016" class="indexterm"></a><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Ошибка</th><th>Решение</th></tr></thead><tbody><tr><td><span class="errorname">unsupported subdevice XX</span></td><td><p>Одно или более устройств не были правильно
		созданы.  Повторите приведенные выше шаги.</p></td></tr><tr><td><span class="errorname">sb_dspwr(XX) timed out</span></td><td><p>Порт ввода-вывода указан неправильно.</p></td></tr><tr><td><span class="errorname">bad irq XX</span></td><td><p>IRQ установлен неправильно.  Убедитесь, что
		настройки в системе и на карте одинаковы.</p></td></tr><tr><td><span class="errorname">xxx: gus pcm not attached, out of
		memory</span></td><td><p>Для использования устройства недостаточно
		памяти.</p></td></tr><tr><td><span class="errorname">xxx: can't open /dev/dsp!</span></td><td><p>Проверьте с помощью <code class="command">fstat | grep
		dsp</code>, не занято ли устройство другим приложением.
		Создать проблемы могут <span class="application">esound</span> и
		поддержка звука в <span class="application">KDE</span>.</p></td></tr></tbody></table></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-multiple-sources"></a>8.2.3. Использование нескольких источников звука</h3></div><div><span class="authorgroup">Предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Munish</span> <span class="surname">Chopra</span></span>. </span></div></div></div><p>Достаточно часто встречается необходимость иметь несколько источников
      звука, которые должны воспроизводить одновременно, например когда
      <span class="application">esound</span> или <span class="application">artsd</span> не
      поддерживают совместное использование звукового устройства с некоторым
      приложением.</p><p>FreeBSD позволяет делать это при помощи <span class="emphasis"><em>виртуальных
      звуковых каналов</em></span>, которые могут быть настроены с помощью
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>. Виртуальные каналы позволяют вам мультиплексировать
      каналы воспроизведения звуковой карты, смешивая звук в ядре.</p><p>Для установки количества виртуальных каналов вы можете использовать
      две переменные sysctl, которые, если вы пользователь <code class="systemitem">root</code>,
      могут быть установлены таким образом:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.pcm0.vchans=4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.maxautovchans=4</code></strong></pre><p>В этом примере выделяются четыре виртуальных канала, чего вполне
      достаточно для повседневного использования.
      <code class="literal">hw.snd.pcm0.vchans</code> это количество виртуальных каналов
      устройства <code class="filename">pcm0</code>, оно может быть установлено сразу
      же, как только устройство было подключено.
      <code class="varname">hw.snd.maxautovchans</code> это количество виртуальных
      каналов, которые выделяются новому аудио устройству, когда оно
      подключается при помощи <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>. Так как модуль
      <code class="filename">pcm</code> может быть загружен независимо от аппаратных
      драйверов, <code class="literal">hw.snd.maxautovchans</code> может указывать
      количество виртуальных каналов для любых устройств, которые будут подключены
      позже.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Количество виртуальных каналов не может быть изменено, если
	аудио устройство занято.  Вам потребуется предварительно закрыть
	все программы, работающие со звуком, такие как медиа-проигрыватели
	или звуковые даемоны.</p></div><p>Если вы не используете <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a>, необходимо будет указать
      приложениям
      <code class="filename">/dev/dsp0</code>.<em class="replaceable"><code>x</code></em>, где
      <em class="replaceable"><code>x</code></em> это число от 0 до 3, если
      <code class="varname">hw.snd.pcm0.vchans</code> установлено в значение 4. Для
      системы, использующей <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a>, вышеуказанные настройки будут
      сделаны автоматически прозрачно для пользователя.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81920208"></a>8.2.4. Установка значений по умолчанию для каналов mixer</h3></div><div><span class="authorgroup">Предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Josef</span> <span class="surname">El-Rayes</span></span>. </span></div></div></div><p>Значения по умолчанию для различных каналов mixer жестко
      прописаны в исходных текстах драйвера <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a>.  Существует
      множество различных приложений и даемонов, которые позволяют
      устанавливать значения для mixer, которые они запоминают
      и выставляют каждый раз при запуске, но это не совсем
      правильное решение, нам нужны значения по умолчанию на уровне
      драйвера.  Они могут быть установлены путем указания
      в  <code class="filename">/boot/device.hints</code>.   Например:</p><pre class="programlisting">hint.pcm.0.vol="100"</pre><p>Установит значение для канала volume в значение по умолчанию
      100, как только будет загружен модуль <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="multimedia.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="multimedia.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sound-mp3.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Глава 8. Мультимедиа </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 8.3. Звук MP3</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>