<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>18.6. Метки дисковых устройств</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="GEOM.html" title="Глава 18. GEOM: Модульная инфраструктура преобразования дисковых запросов" /><link rel="prev" href="geom-ggate.html" title="18.5. Сетевые устройства GEOM Gate" /><link rel="next" href="geom-gjournal.html" title="18.7. Журналирование UFS средствами GEOM" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">18.6. Метки дисковых устройств</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="geom-ggate.html">Пред.</a> </td><th width="60%" align="center">Глава 18. GEOM: Модульная инфраструктура преобразования дисковых запросов</th><td width="20%" align="right"> <a accesskey="n" href="geom-gjournal.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="geom-glabel"></a>18.6. Метки дисковых устройств</h2></div><div><span class="authorgroup">Перевод на русский язык <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Денис</span> <span class="surname">Пеплин</span></span>. </span></div></div></div><a id="idp92734288" class="indexterm"></a><a id="idp92735056" class="indexterm"></a><p>Во время загрузки системы, ядро FreeBSD создает файлы
      для обнаруженных устройств.  Этот метод обнаружения устройств
      создает некоторые проблемы, например если новое дисковое
      устройство подключается через <acronym class="acronym">USB</acronym>.  Может
      получиться так, что этому диску будет присвоено имя устройства
      <code class="filename">da0</code>, а устройство с прежним именем
      <code class="filename">da0</code> получит следующее имя,
      <code class="filename">da1</code>.  Это приведет к проблемам
      монтирования файловых систем, записанных в
      <code class="filename">/etc/fstab</code>.  На самом деле, это может даже
      помешать загрузке системы.</p><p>Одно из решений состоит в расположении <acronym class="acronym">SCSI</acronym>
      устройств в таком порядке, чтобы новые устройства, добавляемые к
      <acronym class="acronym">SCSI</acronym> контроллеру, занимали свободные номера
      устройств.  Но что делать с <acronym class="acronym">USB</acronym> устройствами,
      которые могут занять место основного <acronym class="acronym">SCSI</acronym> диска?
      Это случается потому, что <acronym class="acronym">USB</acronym> устройства обычно
      тестируются до <acronym class="acronym">SCSI</acronym> контроллера.  Решение может
      состоять в подключении этих устройств после загрузки системы.
      Другое решение - использование <acronym class="acronym">ATA</acronym> диска и
      исключение <acronym class="acronym">SCSI</acronym> устройств из
      <code class="filename">/etc/fstab</code>.</p><p>Есть и лучшее решение.  С помощью утилиты
      <code class="command">glabel</code>, администратор или пользователь могут
      пометить дисковые устройства и использовать эти метки в
      <code class="filename">/etc/fstab</code>.  Поскольку
      <code class="command">glabel</code> сохраняет метки в последнем секторе
      заданного устройства, они сохраняются и после перезагрузки.
      Используя эти метки вместо имени устройств, можно всегда смонтировать
      файловую систему независимо от назначенного имени устройства.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Очевидно, что метки должны быть постоянными.  Утилита
	<code class="command">glabel</code> может использоваться для создания как
	временных, так и постоянных меток.  Только постоянные метки
	сохраняются после перезагрузок.  Прочтите <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=glabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">glabel</span>(8)</span></a>
	для получения более подробной информации о различии между
	метками.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92749776"></a>18.6.1. Типы меток и примеры</h3></div></div></div><p>Существует два типа меток, основной (generic) тип и метки файловой
	системы.  Метки могут быть постоянными или временными.
	Постоянные метки создаются командой <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a> или <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a>.
	В дальнейшем они будут автоматически создаваться в подкаталоге
	каталога <code class="filename">/dev</code>,
	имя которого определяется
	в соответствии с типом файловой системы.  Например, метки
	файловых систем <acronym class="acronym">UFS</acronym>2 будут расположены в
	каталоге <code class="filename">/dev/ufs</code>.
	Постоянные метки также можно создать при помощи команды
	<code class="command">glabel label</code>.  Эти метки не зависят от типа
	файловой системы, поэтому они будут перечисляться в каталоге <code class="filename">/dev/label</code>.</p><p>Временные метки не сохраняются после перезагрузки.  Эти метки
	создаются в каталоге <code class="filename">/dev/label</code>,
	они хорошо подходят для экспериментов.  Временную метку можно создать
	командой <code class="command">glabel create</code>.  За более детальной
	информацией обратитесь к странице справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=glabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">glabel</span>(8)</span></a>.</p><p>Чтобы создать постоянную метку для файловой системы
	<acronym class="acronym">UFS</acronym>2 не нарушая самих данных, выполните следующую
	команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tunefs -L <em class="replaceable"><code>home</code></em> <em class="replaceable"><code>/dev/da3</code></em></code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Предупреждение: </h3><p xmlns="http://www.w3.org/1999/xhtml">Если файловая система заполнена, это может привести к
	  повреждению данных; в случае заполненной файловой системы
	  надо или удалить ненужные файлы, или не добавлять
	  метки.</p></div><p>Метка должна появиться в <code class="filename">/dev/ufs</code> и может быть добавлена в
	<code class="filename">/etc/fstab</code>:</p><pre class="programlisting">/dev/ufs/home		/home            ufs     rw              2      2</pre><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Во время запуска <code class="command">tunefs</code> файловая система
	не должна быть смонтирована.</p></div><p>Теперь файловую систему можно смонтировать как обычно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /home</code></strong></pre><p>Если модуль ядра <code class="filename">geom_label.ko</code> указан в
	<code class="filename">/boot/loader.conf</code> и загружается вместе с
	системой, или в ядре указана опция <code class="literal">GEOM_LABEL</code>,
	метку устройства можно изменять без какого-либо негативного
	для системы эффекта.</p><p>Файловая система может быть создана с меткой по умолчанию путем
	использования флага <code class="option">-L</code> команды
	<code class="command">newfs</code>.  Обратитесь к странице справочника
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a> за более подробной информацией.</p><p>Для удаления метки можно использовать следующую команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>glabel destroy home</code></strong></pre><p>В следующем примере показано, как устанавливаются метки
	на разделы загрузочного диска.</p><div class="example"><a id="idp92781648"></a><div class="example-title">Пример 18.1. Установка меток на разделы загрузочного диска</div><div class="example-contents"><p>Установка и задействование постоянных меток на разделах
	  загрузочного диска предоставит возможность операционной системе
	  загружаться нормально в том случае, если диск был переключен на
	  другой контроллер, или даже переставлен на другую машину.  В этом
	  примере был задействован один диск <acronym class="acronym">ATA</acronym>,
	  определяемый системой как <code class="filename">ad0</code>.  Также
	  в примере подразумевается, что система использует типичную для
	  FreeBSD схему разделения дискового пространства на слайсы и размещения
	  на них файловых систем <code class="filename">/</code>,
	  <code class="filename">/var</code>,
	  <code class="filename">/usr</code>,
	  <code class="filename">/tmp</code> и раздела
	  подкачки.</p><p>Перезагрузите систему, дождитесь меню загрузчика.  Нажатием
	  клавиши <span class="keycap"><strong>4</strong></span> выберите однопользовательский режим.
	  Далее, введите следующие команды:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>glabel label rootfs /dev/ad0s1a</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1a is label/rootfs
<code class="prompt">#</code> <strong class="userinput"><code>glabel label var /dev/ad0s1d</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1d is label/var
<code class="prompt">#</code> <strong class="userinput"><code>glabel label usr /dev/ad0s1f</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1f is label/usr
<code class="prompt">#</code> <strong class="userinput"><code>glabel label tmp /dev/ad0s1e</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1e is label/tmp
<code class="prompt">#</code> <strong class="userinput"><code>glabel label swap /dev/ad0s1b</code></strong>
GEOM_LABEL: Label for provider /dev/ad0s1b is label/swap
<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong></pre><p>Система продолжит загрузку в многопользовательский режим.
	  По завершении загрузки откройте файл <code class="filename">/etc/fstab</code>
	  и замените в нём традиционные имена файлов устройств
	  на соответствующие устройствам метки.  Результат будет выглядеть
	  подобно следующему:</p><pre class="programlisting"># Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/label/swap         none            swap    sw              0       0
/dev/label/rootfs       /               ufs     rw              1       1
/dev/label/tmp          /tmp            ufs     rw              2       2
/dev/label/usr          /usr            ufs     rw              2       2
/dev/label/var          /var            ufs     rw              2       2</pre><p>Перезагрузите еще раз систему.  Если всё прошло успешно,
	  система загрузится как обычно, а вывод команды
	  <code class="command">mount</code> отобразит следующее:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
/dev/label/rootfs on / (ufs, local)
devfs on /dev (devfs, local)
/dev/label/tmp on /tmp (ufs, local, soft-updates)
/dev/label/usr on /usr (ufs, local, soft-updates)
/dev/label/var on /var (ufs, local, soft-updates)</pre></div></div><br class="example-break" /><p>Начиная с FreeBSD 7.2, GEOM класс <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=glabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">glabel</span>(8)</span></a> поддерживает
	новый тип меток для файловых систем <acronym class="acronym">UFS</acronym>.  Новый
	тип меток базируется на уникальных идентификаторах файловых систем,
	называемых <code class="literal">ufsid</code>.  Во время загрузки системы
	они автоматически создаются и помещаются в каталог <code class="filename">/dev/ufsid</code>.  Перечисление меток должным
	образом в файле <code class="filename">/etc/fstab</code>
	делает возможным монтирование разделов по значениям
	<code class="literal">ufsid</code>.  Чтобы получить перечень файловых систем
	и соответствующих им меток <code class="literal">ufsid</code>, выполните команду
	<code class="command">glabel status</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>glabel status</code></strong>
                  Name  Status  Components
ufsid/486b6fc38d330916     N/A  ad4s1d
ufsid/486b6fc16926168e     N/A  ad4s1f</pre><p>В данном примере <code class="filename">ad4s1d</code> содержит
	файловую систему <code class="filename">/var</code>,
	а <code class="filename">ad4s1f</code> соответствует файловой системе
	<code class="filename">/usr</code>.  Эти файловые системы
	можно также монтировать, указав значения их <code class="literal">ufsid</code>
	в файле <code class="filename">/etc/fstab</code>:</p><pre class="programlisting">/dev/ufsid/486b6fc38d330916        /var        ufs        rw        2      2
/dev/ufsid/486b6fc16926168e        /usr        ufs        rw        2      2</pre><p>Таким способом могут быть смонтированы любые разделы с метками
	<code class="literal">ufsid</code>, что исключает необходимость создания
	постоянных меток вручную и в то же время позволяет воспользоваться
	преимуществами монтирования по меткам.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="geom-ggate.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="GEOM.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="geom-gjournal.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">18.5. Сетевые устройства GEOM Gate </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 18.7. Журналирование UFS средствами GEOM</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>