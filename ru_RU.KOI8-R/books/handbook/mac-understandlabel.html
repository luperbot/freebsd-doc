<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>15.4. Метки MAC</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="mac.html" title="Глава 15. Принудительный контроль доступа (MAC)" /><link rel="prev" href="mac-initial.html" title="15.3. Описание MAC" /><link rel="next" href="mac-modules.html" title="15.5. Настройка модулей" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">15.4. Метки MAC</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mac-initial.html">Пред.</a> </td><th width="60%" align="center">Глава 15. Принудительный контроль доступа (MAC)</th><td width="20%" align="right"> <a accesskey="n" href="mac-modules.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-understandlabel"></a>15.4. Метки MAC</h2></div></div></div><p>Метка <acronym class="acronym">MAC</acronym> это атрибут безопасности,
      который может быть применен к субъектам
      и объектам всей системы.</p><p>При установке метки пользователь должен в точности понимать,
      что именно она делает.  Атрибуты, доступные для объекта,
      зависят от загруженной политики, а политики интерпретируют
      свои атрибуты совершенно различным образом.  Результатом
      недостаточного понимания настроек может стать их неправильная
      реализация, что может привести к неожиданному, и возможно
      нежелательному поведению системы.</p><p>Метка безопасности на объекте используется политикой
      для определения правил доступа.  Для некоторых политик метка
      сама по себе содержит всю необходимую для этого информацию,
      в других моделях метки могут обрабатываться как часть
      большого набора правил, и т.д.</p><p>Например, установка метки в <code class="literal">biba/low</code>
      на файле присвоит этому файлу метку, обрабатываемую политикой
      Biba со значением <span class="quote"><<<span class="quote">low</span>>></span>.</p><p>Несколько политик, поддерживающих метки в FreeBSD,
      предоставляют три определенные предустановленные метки.
      Это низкая, высокая и равная метки.  Хотя они устанавливают контроль
      различными способами для каждой политики, вы можете быть уверены,
      что низкая метка задаст минимальные установки, равная метка
      означает отмену или недействительность, а высокая метка установит
      максимально возможные настройки в политиках Biba и
      <acronym class="acronym">MLS</acronym>.</p><p>При применении в файловой системе одиночной метки, только одна
      метка может быть использована для объектов.  Это вызовет установку
      одних и тех же прав доступа для всей системы, и во многих случаях
      это все, что необходимо.  Тем не менее, существует несколько ситуаций,
      в которых на объекты и субъекты файловой системы могут быть установлены
      множественные метки.  В этих ситуациях необходимо с помощью
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a> установить параметр <code class="option">multilabel</code>.</p><p>В случае Biba и <acronym class="acronym">MLS</acronym> может быть установлена
      числовая метка
      для указания точного уровня иерархического контроля.  Этот числовой
      уровень используется для разделения или сортировки информации
      по различным группам классификации, разрешающей доступ только к
      этой группе или группе с более высоким уровнем.</p><p>В большинстве случаев системный администратор использует только
      одну метку на всю файловую систему.</p><p><span class="emphasis"><em>Постойте, но это же похоже на <acronym class="acronym">DAC</acronym>!
      Я думал, что <acronym class="acronym">MAC</acronym> дает контроль только
      администратору.</em></span>  Это утверждение все еще верно,
      только <code class="systemitem">root</code> контролирует и настраивает
      политики, так что пользователи помещаются в соответствующие
      категории/уровни доступа.  Многие политики могут ограничить также
      и пользователя <code class="systemitem">root</code>.
      Базовый контроль над объектами затем
      передается группе, но пользователь <code class="systemitem">root</code>
      может отменить или изменить эти настройки в любое время.
      Данная иерархическая  модель соответствует
      таким политикам как Biba и <acronym class="acronym">MLS</acronym>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89871952"></a>15.4.1. Настройка меток</h3></div></div></div><p>Практически все действия по настройке политики с метками
	могут быть выполнены с использованием утилит базовой системы.
	Эти команды обеспечивают простой интерфейс для настройки
	объектов или субъектов, или для изменения и проверки
	настроек.</p><p>Все настройки могут быть выполнены с использованием утилит
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=setfmac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">setfmac</span>(8)</span></a> и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=setpmac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">setpmac</span>(8)</span></a>.  Команда
	<code class="command">setfmac</code> используется для установки меток
	<acronym class="acronym">MAC</acronym> на системные объекты, а команда
	<code class="command">setpmac</code> используется для установки меток на
	системные субъекты.  Выполните:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setfmac biba/high test</code></strong></pre><p>Если не произойдет ошибок, будет возвращено приглашение командной
	строки, как и после команд <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a> и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chown&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">chown</span>(8)</span></a>.
	В некоторых случаях может появиться ошибка
	<span class="errorname">Permission denied</span>, и она обычно появляется при
	установке или изменении метки на объект с ограничениями.
	<a href="#ftn.idp89883472" class="footnote" id="idp89883472"><sup class="footnote">[7]</sup></a>
	Системный администратор для обхода этой проблемы может использовать
	следующие команды:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setfmac biba/high test</code></strong>
<span class="errorname">Permission denied</span>
<code class="prompt">#</code> <strong class="userinput"><code>setpmac biba/low setfmac biba/high test</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>getfmac test</code></strong>
test: biba/high</pre><p>Как видно из примера выше, команда <code class="command">setpmac</code>
	может быть
	использована для изменения установок политики путем присвоения
	иной метки вызывающему процессу.  Утилита <code class="command">getpmac</code>
	обычно используется с существующим на данный момент процессом,
	таким как <span class="application">sendmail</span>, хотя она принимает
	PID вместо команды, ее действие аналогично.  Если пользователи
	попытаются манипулировать файлами, к которым у них нет доступа
	в соответствии с правилами загруженных политик,
	функцией <code class="function">mac_set_link</code> будет
	выдано сообщение об ошибке <span class="errorname">Operation not
	permitted</span>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89893712"></a>15.4.1.1. Пользователи и установки меток</h4></div></div></div><p>Пользователям необходимо иметь метки, чтобы их файлы и
	  процессы могли правильно взаимодействовать с определенной
	  в системе политикой безопасности.  Это настраивается
	  через файл <code class="filename">login.conf</code> путем использования
	  классов.  Каждая политика, использующая метки, реализует установку
	  класса пользователя.</p><p>Пример записи, содержащей все политики, приведенные
	  ниже:</p><pre class="programlisting">default:\
	:copyright=/etc/COPYRIGHT:\
	:welcome=/etc/motd:\
	:setenv=MAIL=/var/mail/$,BLOCKSIZE=K:\
	:path=~/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:\
	:manpath=/usr/share/man /usr/local/man:\
	:nologin=/usr/sbin/nologin:\
	:cputime=1h30m:\
	:datasize=8M:\
	:vmemoryuse=100M:\
	:stacksize=2M:\
	:memorylocked=4M:\
	:memoryuse=8M:\
	:filesize=8M:\
	:coredumpsize=8M:\
	:openfiles=24:\
	:maxproc=32:\
	:priority=0:\
	:requirehome:\
	:passwordtime=91d:\
	:umask=022:\
	:ignoretime@:\
	:label=partition/13,mls/5,biba/10(5-15),lomac10[2]:</pre><p>Параметр <code class="literal">label</code> используется для установки
	  метки <acronym class="acronym">MAC</acronym> по умолчанию для класса пользователя.
	  Пользователи не смогут изменять это значение, поэтому его
	  можно признать не опциональным.  В реальной ситуации администратору
	  никогда не потребуется включать каждую политику.
	  Рекомендуется прочесть главу полностью перед реализацией любой
	  из этих настроек.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Пользователи могут изменить свою метку после входа;
	    однако политика накладывает ограничение на это изменение.
	    В примере выше политике Biba указано, что минимальная
	    целостность процесса 5, максимальная 15, а эффективная
	    целостность по умолчанию 10.  Процесс будет работать на
	    уровне 10, пока метка не будет изменена, например если
	    пользователь использует команду setpmac, которую Biba
	    ограничит диапазоном, установленным при входе.</p></div><p>Во всех случаях после изменения
	  <code class="filename">login.conf</code>, база данных
	  <span class="quote"><<<span class="quote">login class capability</span>>></span> должна быть пересобрана
	  с использованием команды <code class="command">cap_mkdb</code>
	  и это будет отражено в каждом последующем примере главы.</p><p>Полезно отметить, что количество пользователей, которым
	  требуются различные классы, во многих сетях может быть велико.
	  Необходимо тщательное планирование, поскольку управление такой
	  сетью может серьезно усложниться.</p><p>В будущих версиях FreeBSD появится новый способ связывания
	  пользователей с метками; однако, он будет доступен только через
	  некоторое время после выхода FreeBSD 5.3.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89900368"></a>15.4.1.2. Сетевые интерфейсы и установка меток</h4></div></div></div><p>Метки также могут быть установлены на сетевые интерфейсы,
	  для контроля потока данных в сети. Во всех случаях они
	  функционируют аналогично тому, как политики по отношению к
	  объектам.  Пользователи с высокими установками, например,
	  <code class="literal">biba</code>, не смогут получить доступ к сетевым
	  интерфейсам с низкими установками.</p><p>Для установки <acronym class="acronym">MAC</acronym> меток на сетевых
	  интерфейсах параметр <code class="option">maclabel</code> может быть передан
	  <code class="command">ifconfig</code>.  Например:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bge0 maclabel biba/equal</code></strong></pre><p>установит <acronym class="acronym">MAC</acronym> метку
	  <code class="literal">biba/equal</code> на интерфейс <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bge&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bge</span>(4)</span></a>.
	  При использовании метки, подобной
	  <code class="literal">biba/high(low-high)</code> вся метка должна быть
	  взята в кавычки, иначе будет выдано сообщение об ошибке.</p><p>Каждая политика, использующая метки, снабжена переменной
	  <code class="command">sysctl</code>, которая может быть использована для
	  отключения <acronym class="acronym">MAC</acronym> меток на сетевых интерфейсах.
	  Установка метки в <code class="option">equal</code> будет иметь подобный
	  эффект.  Просмотрите вывод команды <code class="command">sysctl</code>,
	  страницы справочника для политик, или дальнейшую информацию из
	  этой главы по этим переменным.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89908816"></a>15.4.2. Одиночные или множественные метки?</h3></div></div></div><p>По умолчанию система будет использовать параметр
	<code class="option">singlelabel</code>.  Но что это означает для
	администратора?  Существуют несколько различий между политиками,
	каждая из которых правильна сама по себе, но имеет свои доводы
	за и против относительно гибкости модели безопасности
	системы.</p><p><code class="option">singlelabel</code> (одиночная метка) разрешает
	использование только одной метки, например
	<code class="literal">biba/high</code>, для каждого объекта или субъекта.
	Ее преимущество в меньшей нагрузке на системного администратора,
	а недостаток в малой гибкости политик, поддерживающих метки.
	Многие администраторы в своих политиках безопасности могут
	предпочесть использование параметра
	<code class="option">multilabel</code>.</p><p>С параметром <code class="option">multilabel</code> каждый субъект или
	объект может иметь собственную метку <acronym class="acronym">MAC</acronym>,
	в то время как со стандартным параметром <code class="option">singlelabel</code>
	возможна только одна метка на весь раздел.
	Параметры <code class="option">multilabel</code> и <code class="option">singlelabel</code>
	требуются только для политик, реализующих метки, включая
	Biba, Lomac, <acronym class="acronym">MLS</acronym> и
	<acronym class="acronym">SEBSD</acronym>.</p><p>Во многих случаях <code class="option">multilabel</code> может вообще не
	потребоваться.  Предположим следующую ситуацию и модель
	безопасности:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD веб-сервер, использующий инфраструктуру
	    <acronym class="acronym">MAC</acronym> и набор различных политик.</p></li><li class="listitem"><p>Этому компьютеру потребуется лишь одна метка,
	    <code class="literal">biba/high</code>, для всей системы.
	    Файловой системе не нужен параметр <code class="option">multilabel</code>,
	    поскольку по умолчанию работает одиночная метка.</p></li><li class="listitem"><p>Но поскольку этот компьютер будет веб сервером, процесс
	    веб сервера должен быть запущен с <code class="literal">biba/low</code>
	    для предотвращения записи.  Политика Biba и то, как она
	    работает, будет обсуждаться позже, поэтому предыдущий комментарий
	    сложно интерпретировать; просто продолжайте чтение.
	    Сервер может использовать дисковый раздел с установленной
	    меткой <code class="literal">biba/low</code> для большинства, если
	    не для всех своих операций.  В этом примере отсутствуют многие
	    детали, такие как ограничения на данные, конфигурация системы
	    и установки пользователей; однако, это лишь предварительный
	    пример.</p></li></ul></div><p>Если используется любая из политик, не поддерживающих метки,
	параметр <code class="option">multilabel</code> не требуется.  Сюда включаются
	политики <code class="literal">seeotheruids</code>, <code class="literal">portacl</code>
	и <code class="literal">partition</code>.</p><p>Необходимо также отметить, что использование параметра
	<code class="option">multilabel</code> на разделе и установление модели
	безопасности, основанной на функциональности
	<code class="option">multilabel</code>, может повлечь за собой
	множество дополнительной административной работы, поскольку всему в
	файловой системе должны быть присвоены метки.  Это включает каталоги,
	файлы, и даже файлы устройств.</p><p>Следующая команда установит параметр <code class="option">multilabel</code>
	на файловых системах.  Это может быть сделано только в
	однопользовательском режиме:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tunefs -l enable /</code></strong></pre><p>Это не требуется для файловой системы подкачки.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Некоторые пользователи сталкиваются с проблемами при
	  установке флага <code class="option">multilabel</code> на корневой раздел.
	  В данном случае обратитесь к
	  <a class="xref" href="mac-troubleshoot.html" title="15.16. Решение проблем с инфраструктурой MAC">Раздел 15.16, <<Решение проблем с инфраструктурой MAC>></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89951696"></a>15.4.3. Настройка MAC переменными sysctl</h3></div></div></div><p>Независимо от загрузки модулей, существует несколько частей
	<acronym class="acronym">MAC</acronym>, которые могут быть настроены с
	использованием интерфейса <code class="command">sysctl</code>.  Эти
	переменные описаны ниже и во всех случаях значение 1
	означает включение, а 0 - отключение:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">security.mac.enforce_fs</code> по умолчанию
	    установлена в 1 и включает политики
	    <acronym class="acronym">MAC</acronym> на файловых системах.</p></li><li class="listitem"><p><code class="literal">security.mac.enforce_kld</code> по умолчанию
	    1 и включает линкование политик <acronym class="acronym">MAC</acronym> в
	    ядре (см. <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kld&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">kld</span>(4)</span></a>).</p></li><li class="listitem"><p><code class="literal">security.mac.enforce_network</code> по умолчанию
	    1 и включает сетевые политики <acronym class="acronym">MAC</acronym>.</p></li><li class="listitem"><p><code class="literal">security.mac.enforce_pipe</code> по умолчанию
	    1 и включает политики <acronym class="acronym">MAC</acronym> для каналов
	    (pipe).</p></li><li class="listitem"><p><code class="literal">security.mac.enforce_process</code> по умолчанию
	    1 и включает политики <acronym class="acronym">MAC</acronym> для процессов,
	    использующих средства межпроцессного взаимодействия.</p></li><li class="listitem"><p><code class="literal">security.mac.enforce_socket</code> по умолчанию
	    1 и включает политики <acronym class="acronym">MAC</acronym> на сокетах
	    (см. страницу справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=socket&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">socket</span>(2)</span></a>).</p></li><li class="listitem"><p><code class="literal">security.mac.enforce_system</code> по умолчанию
            1 и включает политики <acronym class="acronym">MAC</acronym> для действий системы,
	    таких как учет (accounting) и перезагрузка.</p></li><li class="listitem"><p><code class="literal">security.mac.enforce_vm</code> по умолчанию
            1 и включает политики <acronym class="acronym">MAC</acronym> для системы
	    виртуальной памяти.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Каждая политика <acronym class="acronym">MAC</acronym> поддерживает
	  переменные <code class="command">sysctl</code>.  Они обычно попадают в дерево
	  <code class="literal">security.mac.&lt;policyname&gt;</code>.
	  Для просмотра всех переменных <acronym class="acronym">MAC</acronym>,
	  используйте следующую команду:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl -da | grep mac</code></strong></pre></div><p>Это должно быть интерпретировано так, что все основные
	политики <acronym class="acronym">MAC</acronym> включены по умолчанию.
	Если модули встроены в ядро, система будет заблокирована, и скорее
	всего не сможет связаться с локальной сетью или с интернет, и т.д.
	Поэтому встраивание модулей в ядро не рекомендуется.  Не потому,
	что это ограничит возможность отключения командой
	<code class="command">sysctl</code>, а потому, что включение политик в
	виде модулей позволит администратору переключать политики системы
	без необходимости пересборки и переустановки новой системы.</p></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp89883472" class="footnote"><p><a href="#idp89883472" class="para"><sup class="para">[7] </sup></a>Есть и другие ситуации, в которых могут возникать
	различные ошибки.  Например, файл может не находиться во владении
	пользователя, пытающегося изменить метку на объекте, объект может
	не существовать или существовать только для чтения.  Политика может
	не позволить процессу изменить метку на файл, возможно в связи со
	свойствами файла, процесса, или нового значения метки.  Например:
	пользователь с низким уровнем доверия пытается изменить метку на
	файле с высоким уровнем доверия.  Или пользователь с низким уровнем
	доверия пытается изменить метку файла с низким уровнем доверия на
	метку высокого уровня.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mac-initial.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="mac.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="mac-modules.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">15.3. Описание MAC </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 15.5. Настройка модулей</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>