<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>24.6. Расширенное руководство</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="mail.html" title="Глава 24. Электронная почта" /><link rel="prev" href="mail-trouble.html" title="24.5. Поиск и устранение неисправностей" /><link rel="next" href="outgoing-only.html" title="24.7. Настройка почты только для отправки" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">24.6. Расширенное руководство</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mail-trouble.html">Пред.</a> </td><th width="60%" align="center">Глава 24. Электронная почта</th><td width="20%" align="right"> <a accesskey="n" href="outgoing-only.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mail-advanced"></a>24.6. Расширенное руководство</h2></div></div></div><p>В следующем разделе рассматриваются более сложные темы, такие как
      настройка почты и включение почтовой системы для всего домена.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mail-config"></a>24.6.1. Базовая конфигурация</h3></div></div></div><a id="idp96655952" class="indexterm"></a><p>Изначально, вы можете отправлять почту <span class="quote"><<<span class="quote">во внешний
	мир</span>>></span> если правильно составлен файл
	<code class="filename">/etc/resolv.conf</code> или запущен свой сервер
	имен.  Если вы хотите, чтобы почта, предназначенная для хоста в
	вашем домене, доставлялась MTA (например,
	<span class="application">sendmail</span>) на вашем хосте FreeBSD, есть два
	пути:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Запустите свой собственный сервер DNS, тем самым организовав
	    собственный домен, например, <code class="systemitem">FreeBSD.org</code></p></li><li class="listitem"><p>Получайте почту для вашего хоста непосредственно.  Это
	    работает при доставке почты непосредственно на DNS имя вашей
	    машины.  Например, <code class="systemitem">example.FreeBSD.org</code>.</p></li></ul></div><a id="idp96661584" class="indexterm"></a><p>Независимо от выбранного из предложенных выше вариантов, для
	доставки почты непосредственно на ваш хост у него должен быть
	постоянный IP адрес (а не динамический,
	как у большинства PPP соединений).  Если вы находитесь за
	брандмауэром, то последний должен пропускать SMTP-пакеты.  Если
	вы хотите, чтобы почта приходила непосредственно на ваш
	хост, необходимо убедиться в одном из двух:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Убедитесь, что запись (с наименьшим номером) MX в<a id="idp96671824" class="indexterm"></a>
	    DNS соответствует IP адресу вашего хоста.</p></li><li class="listitem"><p>Убедитесь, что в DNS для вашего хоста вообще отсутствует
	    MX-запись.</p></li></ul></div><p>Выполнение любого из перечисленных условий обеспечит доставку
	почты для вашего хоста.</p><p>Попробуйте это:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>hostname</code></strong>
example.FreeBSD.org
<code class="prompt">#</code> <strong class="userinput"><code>host example.FreeBSD.org</code></strong>
example.FreeBSD.org has address 204.216.27.XX</pre><p>Если вы это видите, то можно без проблем посылать почту на
	<code class="email">&lt;yourlogin@example.FreeBSD.org&gt;</code>
	(предполагается, что <span class="application">sendmail</span> на <code class="systemitem">example.FreeBSD.org</code> работает правильно).</p><p>Однако, если вы видите это:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>host example.FreeBSD.org</code></strong>
example.FreeBSD.org has address 204.216.27.XX
example.FreeBSD.org mail is handled (pri=10) by hub.FreeBSD.org</pre><p>то вся почта, посланная на <code class="systemitem">example.FreeBSD.org</code> будет собираться на
	<code class="systemitem">hub</code> (для того же пользователя), вместо того, чтобы
	быть отосланной непосредственно на ваш хост.</p><p>Эта информация обрабатывается вашим DNS сервером.  Соответствующая
	запись DNS, указывающая, через какой хост будет проходить ваша
	почта, называется MX (<span class="emphasis"><em>M</em></span>ail
	e<span class="emphasis"><em>X</em></span>changer).  Если для хоста отсутствует такая
	запись, почта будет приходить прямо на этот хост.</p><p>Допустим, что запись MX для хоста <code class="systemitem">freefall.FreeBSD.org</code> в какой-то момент
	выглядела так:</p><pre class="programlisting">freefall		MX	30	mail.crl.net
freefall		MX	40	agora.rdrop.com
freefall		MX	10	freefall.FreeBSD.org
freefall		MX	20	who.cdrom.com</pre><p>Вы видите, что для хоста <code class="systemitem">freefall</code> существуют
	несколько MX-записей.  Запись с наименьшим номером соответствует
	хосту, получающему почту непосредственно, если он доступен; если
	он недоступен по каким-то причинам, другие сервера (иногда называемые
	(<span class="quote"><<<span class="quote">резервными MX</span>>></span>) временно получают почту, и хранят ее
	пока не станут доступны хосты с меньшими номерами, в конечном итоге
	отправляя почту на эти хосты.</p><p>Чтобы альтернативные MX-хосты использовались наиболее
	эффективно, они должны быть независимо подключены к Интернет.  Ваш
	провайдер (или дружественный сайт) скорее всего без проблем сможет
	оказать подобные услуги.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mail-domain"></a>24.6.2. Почта для вашего домена</h3></div></div></div><p>Для настройки <span class="quote"><<<span class="quote">почтового хоста</span>>></span> (почтовый
	сервер) вам потребуется, чтобы почта, направляемая различным рабочим
	станциям, пересылалась этому хосту.  Обычно вам необходима
	доставка всей почты для любого хоста вашего домена (в данном случае
	<code class="systemitem">*.FreeBSD.org</code>) на почтовый сервер, чтобы
	пользователи могли получать свою почту на с этого сервера.</p><a id="idp96691408" class="indexterm"></a><p>Чтобы облегчить себе (и другим) жизнь, создайте на обеих машинах
	учетные записи с одинаковыми именами пользователей, например, с помощью
	команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=adduser&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">adduser</span>(8)</span></a>.</p><p>Сервер, который вы будете использовать в качестве почтового,
	должен быть объявлен таковым для каждой машины в домене.  Вот
	фрагмент примерной конфигурации:</p><pre class="programlisting">example.FreeBSD.org	A	204.216.27.XX		; Рабочая станция
			MX	10 hub.FreeBSD.org	; Почтовый шлюз</pre><p>Таким образом, вся корреспонденция, адресованная рабочей
	станции, будет обрабатываться вашим почтовым сервером, независимо от
	того, что указано в A-записи.</p><p>Все это можно реализовать только в том случае, если вы
	используете сервер DNS.  Если вы по каким-либо причинам не имеете
	возможности установить свой собственный сервер имен, необходимо
	договориться с провайдером или теми, кто поддерживает ваш
	DNS.</p><p>Если вы хотите поддерживать несколько виртуальных почтовых
	серверов, может пригодиться следующая информация.  Допустим, что
	ваш клиент зарезервировал домен, например, <code class="systemitem">customer1.org</code>, и вам требуется, чтобы
	почта, предназначенная для <code class="systemitem">customer1.org</code> приходила на ваш хост,
	например, <code class="systemitem">mail.myhost.com</code>.  В таком
	случае, DNS должен выглядеть так:</p><pre class="programlisting">customer1.org		MX	10	mail.myhost.com</pre><p>Заметьте, что если вам требуется только получать почту для
	домена, соответствующая A-запись <span class="emphasis"><em>не</em></span>
	нужна.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Помните, что если вы попытаетесь каким-либо образом обратиться
	  к хосту <code class="systemitem">customer1.org</code>, у вас
	  вряд ли что-либо получится, если нет A-записи для этого
	  хоста.</p></div><p>Последнее, что вы должны сделать - это сказать программе
	<span class="application">sendmail</span>, для каких доменов и/или хостов
	она должна принимать почту.  Это можно сделать несколькими
	способами:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Добавьте названия этих хостов в файл
	    <code class="filename">/etc/mail/local-host-names</code>, если вы используете
	    <code class="literal">FEATURE(use_cw_file)</code>.  Если у вас
	    <span class="application">sendmail</span>
	    версии ниже 8.10, необходимо отредактировать файл
	    <code class="filename">/etc/sendmail.cw</code>.</p></li><li class="listitem"><p>Добавьте строку <code class="literal">Cwyour.host.com</code> в файл
	    <code class="filename">/etc/sendmail.cf</code> или
	    <code class="filename">/etc/mail/sendmail.cf</code> (если у вас
	    <span class="application">sendmail</span>
	    версии 8.10 или более поздней).</p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mail-trouble.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="mail.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="outgoing-only.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">24.5. Поиск и устранение неисправностей </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 24.7. Настройка почты только для отправки</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>