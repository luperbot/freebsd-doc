<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>25.2. <<Супер-сервер>> inetd</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="network-servers.html" title="Глава 25. Сетевые серверы" /><link rel="prev" href="network-servers.html" title="Глава 25. Сетевые серверы" /><link rel="next" href="network-nfs.html" title="25.3. Network File System (NFS)" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">25.2. <span class="quote"><<<span class="quote">Супер-сервер</span>>></span> <span class="application">inetd</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-servers.html">Пред.</a> </td><th width="60%" align="center">Глава 25. Сетевые серверы</th><td width="20%" align="right"> <a accesskey="n" href="network-nfs.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-inetd"></a>25.2. <span class="quote"><<<span class="quote">Супер-сервер</span>>></span> <span class="application">inetd</span></h2></div><div><span class="authorgroup">Текст предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div><div><span class="authorgroup">Обновлено: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="othername">Проект документации FreeBSD</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-overview"></a>25.2.1. Обзор</h3></div></div></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> иногда называют также <span class="quote"><<<span class="quote">супер-сервером
	Интернет</span>>></span>, потому что он управляет соединениями к многим
	сервисам.  Когда
	<span class="application">inetd</span> принимает соединение, он определяет,
	для какой программы предназначено соединение, запускает соответствующий
	процесс и предоставляет ему сокет, ссылка на который передается
	процессу в качестве стандартных устройств ввода, вывода и сообщения об
	ошибках.  Для не слишком нагруженных серверов запуск через
	<span class="application">inetd</span> может уменьшить общую нагрузку на систему по
	сравнению с запуском каждого даемона индивидуально в выделенном
	режиме.</p><p>В первую очередь <span class="application">inetd</span> используется для
	вызова других даемонов, но несколько простых протоколов, таких, как
	<span class="application">chargen</span>, <span class="application">auth</span> и
	<span class="application">daytime</span>, обслуживаются
	непосредственно.</p><p>Этот раздел посвящен основам настройки
	<span class="application">inetd</span> посредством его параметров командной
	строки и его конфигурационного файла,
	<code class="filename">/etc/inetd.conf</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-settings"></a>25.2.2. Настройки</h3></div></div></div><p><span class="application">inetd</span> инициализируется посредством
	системы <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a>.  Параметр
	<code class="literal">inetd_enable</code> по умолчанию установлен в
	<code class="literal">NO</code>, однако может быть включен утилитой
	<span class="application">sysinstall</span> в процессе установки.
	Указание</p><pre class="programlisting">inetd_enable="YES"</pre><p>или</p><pre class="programlisting">inetd_enable="NO"</pre><p>в файле
	<code class="filename">/etc/rc.conf</code> разрешит или запретит запуск
	<span class="application">inetd</span> во время загрузки.
	Команда</p><pre class="programlisting">/etc/rc.d/inetd rcvar</pre><p>покажет текущие установки переменных, относящихся к
	<span class="application">inetd</span>.</p><p>Кроме того, через <code class="literal">inetd_flags</code> даемону
	<span class="application">inetd</span> могут быть переданы различные
	параметры командной строки.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-cmdline"></a>25.2.3. Параметры командной строки</h3></div></div></div><p>Как и большинство даемонов, для <span class="application">inetd</span>
	существует большое количество разнообразных опций, изменяющих
	его поведение.  Полный из список таков:</p><p><code class="command">inetd</code> <code class="option">[-d] [-l] [-w] [-W] [-c maximum] [-C rate] [-a address | hostname]
	   [-p filename] [-R rate] [-s maximum] [configuration file]</code></p><p>Опции могут передаваться <span class="application">inetd</span>
	при помощи переменной <code class="literal">inetd_flags</code> файла
	<code class="filename">/etc/rc.conf</code>.  По умолчанию переменная
	<code class="literal">inetd_flags</code> установлена в <code class="literal">-wW -C
	60</code>, то есть включает обработку TCP wrapping и запрещает
	обращаться с одного IP-адреса к сервису более чем 60 раз в
	минуту.</p><p>Несмотря на то, что ниже по тексту мы упоминаем опции ограничения
	частоты обращения к службам (rate-limiting), в большинстве случаев
	начинающим пользователям нет необходимости менять эти параметры.  Эти
	опции могут стать полезными в том случае, если вы обнаружите, что ваша
	система принимает чрезмерное количество соединений.  Полный список
	опций можно найти на странице справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-c maximum</span></dt><dd><p>Определение максимального числа одновременных запусков каждой
	      службы; по умолчание не ограничено.  Может быть переопределено
	      индивидуально для каждой службы при помощи параметра
	      <code class="option">max-child</code>.</p></dd><dt><span class="term">-C rate</span></dt><dd><p>Определение по умолчанию максимального количества раз,
	      которое служба может быть вызвана с одного IP-адреса в минуту; по
	      умолчанию не ограничено.  Может быть переопределено для каждой
	      службы параметром
	      <code class="option">max-connections-per-ip-per-minute</code>.</p></dd><dt><span class="term">-R rate</span></dt><dd><p>Определяет максимальное количество раз, которое служба может
	      быть вызвана в минуту; по умолчанию 256.  Частота, равная 0,
	      не ограничивает число вызовов.</p></dd><dt><span class="term">-s maximum</span></dt><dd><p>Задает максимальное количество процессов, одновременно
	      обслуживающих один сервис для одного IP-адреса; по умолчанию
	      не ограничено.  Может переопределяться для каждой службы
	      параметром <code class="option">max-child-per-ip</code>.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-conf"></a>25.2.4. <code class="filename">inetd.conf</code></h3></div></div></div><p>Настройка <span class="application">inetd</span> производится через файл
	<code class="filename">/etc/inetd.conf</code>.</p><p>Если в файле <code class="filename">/etc/inetd.conf</code> делались
	изменения, то <span class="application">inetd</span> можно заставить считать
	его конфигурационный файл повторно посредством команды</p><div class="example"><a id="network-inetd-reread"></a><div class="example-title">Пример 25.1. Перезагрузка конфигурационного файла
	  <span class="application">inetd</span></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/inetd reload</code></strong></pre></div></div><br class="example-break" /><p>В каждой строке конфигурационного файла описывается отдельный
	даемон.  Комментариям в файле предшествует знак	<span class="quote"><<<span class="quote">#</span>>></span>.
	Строки в файле
	<code class="filename">/etc/inetd.conf</code> имеют такой формат:</p><pre class="programlisting">service-name
socket-type
protocol
{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]
user[:group][/login-class]
server-program
server-program-arguments</pre><p>Пример записи для даемона <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ftpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ftpd</span>(8)</span></a>,
	использующего IPv4:</p><pre class="programlisting">ftp     stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -l</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">service-name</span></dt><dd><p>Это имя сервиса, предоставляемого конкретным даемоном.  Оно
	      должно соответствовать сервису, указанному в файле
	      <code class="filename">/etc/services</code>.  Здесь определяется, какой
	      порт должен обслуживать <span class="application">inetd</span>.  При
	      создании нового сервиса он должен помещаться сначала в файл
	      <code class="filename">/etc/services</code>.</p></dd><dt><span class="term">socket-type</span></dt><dd><p><code class="literal">stream</code>, <code class="literal">dgram</code>,
	      <code class="literal">raw</code> либо <code class="literal">seqpacket</code>.
	      <code class="literal">stream</code> должен использоваться для
	      ориентированных на соединение даемонов TCP, когда как
	      <code class="literal">dgram</code> используется для даемонов, использующих
	      транспортный протокол <acronym class="acronym">UDP</acronym>.</p></dd><dt><span class="term">protocol</span></dt><dd><p>Одно из следующих:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Протокол</th><th>Описание</th></tr></thead><tbody><tr><td>tcp, tcp4</td><td>TCP IPv4</td></tr><tr><td>udp, udp4</td><td>UDP IPv4</td></tr><tr><td>tcp6</td><td>TCP IPv6</td></tr><tr><td>udp6</td><td>UDP IPv6</td></tr><tr><td>tcp46</td><td>TCP как для IPv4, так и для v6</td></tr><tr><td>udp46</td><td>UDP как для IPv4, так и для v6</td></tr></tbody></table></div></dd><dt><span class="term">{wait|nowait}[/max-child[/max-connections-per-ip-per-minute[/max-child-per-ip]]]</span></dt><dd><p><code class="option">wait|nowait</code> определяет, может ли даемон,
	      вызванный из <span class="application">inetd</span>, работать с
	      собственным сокетом, или нет.  Сокеты типа <code class="option">dgram</code>
	      должны использовать параметр <code class="option">wait</code>, когда как
	      даемоны с потоковыми
	      сокетами, которые обычно многопоточны, должны использовать
	      <code class="option">nowait</code>.  <code class="option">wait</code> обычно передает
	      много сокетов одному даемону, когда как <code class="option">nowait</code>
	      порождает даемон для каждого нового сокета.</p><p>Максимальное число порожденных даемонов, которых может
	      создать <span class="application">inetd</span>, может быть задано
	      параметром <code class="option">max-child</code>.  Если нужно ограничение в
	      десять экземпляров некоторого даемона, то после параметра
	      <code class="option">nowait</code> нужно задать
	      <code class="literal">/10</code>.  При задании <code class="literal">/0</code>
	      ограничения на количество экземпляров снимаются.</p><p>Кроме <code class="option">max-child</code>, могут быть задействованы
	      два других параметра, ограничивающих максимальное число соединений от
	      одного источника.
	      <code class="option">max-connections-per-ip-per-minute</code> ограничивает
	      количество соединений от одного IP-адреса в течение минуты, так что
	      значение, равное десяти, будет ограничивать
	      любой заданный IP-адрес на выполнение десяти попыток подключения
	      к некоторому сервису в минуту.  Параметр
	      <code class="option">max-child-per-ip</code> ограничивает количество
	      дочерних процессов, которые могут быть одновременно
	      задействованы на обслуживание одного IP-адреса.
	      Эти опции полезны для предотвращения
	      намеренного или ненамеренного расходования ресурсов и атак типа
	      Denial of Service (DoS) на машину.</p><p>В этом поле одно из значений <code class="option">wait</code>
	      или <code class="option">nowait</code>
	      обязательны.  <code class="option">max-child</code>,
	      <code class="option">max-connections-per-ip-per-minute</code> и
	      <code class="option">max-child-per-ip</code>
	      опциональны.</p><p>Многопоточный даемон типа stream без ограничений
	      <code class="option">max-child</code>,
	      <code class="option">max-connections-per-ip-per-minute</code> или
	      <code class="option">max-child-per-ip</code> будет
	      определен просто как <code class="literal">nowait</code>.</p><p>Тот же самый даемон с ограничением в максимум десять даемонов
	      будет определен так: <code class="literal">nowait/10</code>.</p><p>Та же конфигурация с ограничением в двадцать
	      соединений на IP-адрес в минуту и общим ограничением в максимум
	      десять порожденных даемонов выглядит так:
	      <code class="literal">nowait/10/20</code>.</p><p>Эти параметры, используемые все со значениями по умолчанию
	      даемоном <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fingerd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">fingerd</span>(8)</span></a>, имеют такой
	      вид:</p><pre class="programlisting">finger stream  tcp     nowait/3/10 nobody /usr/libexec/fingerd fingerd -s</pre><p>Наконец, пример, описывающий ограничение на 100 даемонов
	      в целом, при этом не более чем по 5 на один IP-адрес,
	      будет выглядеть так:
	      <code class="literal">nowait/100/0/5</code>.</p></dd><dt><span class="term">user</span></dt><dd><p>Это имя пользователя, под которым должен
	      работать соответствующий даемон.  Чаще всего даемоны работают
	      как пользователь <code class="systemitem">root</code>.  Для обеспечения
	      безопасности некоторые серверы запускаются как пользователь
	      <code class="systemitem">daemon</code> или как пользователь с минимальными
	      правами <code class="systemitem">nobody</code>.</p></dd><dt><span class="term">server-program</span></dt><dd><p>Полный маршрут к даемону, который будет выполняться при
	      установлении соединения.  Если даемон является сервисом,
	      предоставляемым самим <span class="application">inetd</span>, то нужно
	      задать ключевое слово <code class="option">internal</code>.</p></dd><dt><span class="term">server-program-arguments</span></dt><dd><p>Этот параметр работает вместе с параметром
	      <code class="option">server-program</code>, задавая параметры, начиная с
	      <code class="literal">argv[0]</code>, передаваемые даемону при запуске.
	      Если в командной
	      строке задано <code class="command">mydaemon -d</code>, то
	      <code class="literal">mydaemon -d</code> будет являться значением для
	      <code class="option">server-program-arguments</code>.  И снова, если даемон
	      является внутренней службой, то здесь нужно использовать
	      <code class="option">internal</code>.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-security"></a>25.2.5. Безопасность</h3></div></div></div><p>В зависимости от выбранных при установке параметров,
	многие из служб <span class="application">inetd</span> могут оказаться по
	умолчанию включенными.  Если нет особой нужды в некотором даемоне,
	подумайте, не стоит ли его выключить?
	Поместите знак <span class="quote"><<<span class="quote">#</span>>></span> перед ненужным даемоном
	в <code class="filename">/etc/inetd.conf</code>
	и <a class="link" href="network-inetd.html#network-inetd-reread" title="Пример 25.1. Перезагрузка конфигурационного файла inetd">пошлите сигнал для inetd</a>.
	Некоторые даемоны, такие, как <span class="application">fingerd</span>,
	вообще нежелательны, потому что они дают информацию, которая
	может оказаться полезной атакующему.</p><p>Некоторые даемоны не заботятся о безопасности и имеют большие
	тайм-ауты для соединений или вообще их не имеют.  Это позволяет
	атакующему неспешно устанавливать соединения к конкретному даемону,
	истощая имеющиеся ресурсы.  Может оказаться полезным задать для
	некоторых даемонов ограничения
	<code class="option">max-connections-per-ip-per-minute</code>,
	<code class="option">max-child</code> и <code class="option">max-child-per-ip</code>,
	особенно если вы обнаружите слишком большое число соединений.</p><p>По умолчанию механизм TCP wrapping включен.  Обратитесь к
	справочной странице по <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a> для получения более
	подробной информации о задании ограничений TCP для различных даемонов,
	запускаемых посредством <span class="application">inetd</span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-misc"></a>25.2.6. Разное</h3></div></div></div><p><span class="application">daytime</span>,
	<span class="application">time</span>,
	<span class="application">echo</span>,
	<span class="application">discard</span>,
	<span class="application">chargen</span> и
	<span class="application">auth</span> все являются услугами, предоставляемыми
	самим <span class="application">inetd</span>.</p><p>Сервис <span class="application">auth</span> предоставляет
	идентификационные сетевые услуги
	и поддается настройке; прочие сервисы ненастраиваемы.</p><p>Обратитесь к справочной странице по <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> для получения
	более подробной информации.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-servers.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="network-servers.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="network-nfs.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Глава 25. Сетевые серверы </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 25.3. Network File System (NFS)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>