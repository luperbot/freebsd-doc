<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>Глава 10. Обновление отдельного порта</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD по созданию портов" /><link rel="up" href="index.html" title="Руководство FreeBSD по созданию портов" /><link rel="prev" href="testing-poudriere.html" title="9.6. Poudriere" /><link rel="next" href="moved-and-updating-files.html" title="10.2. Файлы UPDATING и MOVED" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Глава 10. Обновление отдельного порта</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="testing-poudriere.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="moved-and-updating-files.html">След.</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="port-upgrading"></a>Глава 10. Обновление отдельного порта</h1></div></div></div><div class="toc"><div class="toc-title">Содержание</div><dl class="toc"><dt><span class="sect1"><a href="port-upgrading.html#svn-diff">10.1. Использование <span class="application">Subversion</span> для
      создания патчей</a></span></dt><dt><span class="sect1"><a href="moved-and-updating-files.html">10.2. Файлы <code class="filename">UPDATING</code> и
      <code class="filename">MOVED</code></a></span></dt></dl></div><p>Если вы заметите, что ваш порт устарел по сравнению с
    последней авторской версией, первым делом вы должны получить
    самую последнюю версия порта.  Вы можете найти их в каталоге
    <code class="filename">ports/ports-current</code> на зеркальных
    FTP-серверах FreeBSD.  Однако если вы работаете с достаточно большим
    количеством портов, наверное, будет проще использовать
    <span class="application">Subversion</span> или <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=portsnap&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">portsnap</span>(8)</span></a> для
    поддержания всей коллекции портов в актуальном состоянии, как это
    описано в <a class="link" href="../../../../doc/ru_RU.KOI8-R/books/handbook/ports-using.html" target="_top">Руководстве</a>.
    К тому же это даст возможность отслеживать все зависимости
    портов.</p><p>На следующем шаге необходимо выяснить, нет ожидает ли уже это
    обновление своей очереди.  Для этого у вас есть две возможности.
    Существует интерфейс к <a class="link" href="http://www.FreeBSD.org/cgi/query-pr-summary.cgi?query" target="_top">базе
      данных сообщений о проблемах FreeBSD (PR)</a> (известной
    также как <code class="literal">GNATS</code>) с поисковыми возможностями.
    Выберите из выпадающего списка <code class="literal">ports</code> и введите
    название порта.</p><p>Однако иногда люди забывают поместить название порта в поле
    Synopsis в точном виде.  В таком случае вы можете воспользоваться
    <a class="link" href="portsmon.html" title="14.6. Система мониторинга портов FreeBSD">Системой мониторинга портов FreeBSD</a>
    (которая известна также как <code class="literal">portsmon</code>).  В
    рамках этой системы делается попытка классифицировать PR,
    касающиеся портов, по имени порта.  Для поиска PR, относящихся к
    определённому порту, используйте механизм <a class="link" href="http://portsmon.FreeBSD.org/portoverview.py" target="_top">Просмотра
      по одному порту</a>.</p><p>Если таких отложенных PR не существует, то на следующем этапе
    следует послать сообщение электронной почты человеку,
    поддерживающему порт, который выдаётся по команде <code class="command">make
      maintainer</code>.  Этот человек может уже работать над
    обновлением, или иметь причину не обновлять порт прямо сейчас
    (например, из-за проблем со стабильностью функционирования новой
    версии); вам нет нужды дублировать их работу.  Заметьте, что
    неподдерживаемые порты перечисляются с адресом сопровождающего
    <code class="literal">ports@FreeBSD.org</code>, который является всего лишь
    адресом общего списка рассылки, так что отправка туда сообщений,
    скорее всего, в данном случае не поможет.</p><p>Если сопровождающий просит вас выполнить обновление, либо
    сопровождающий отсутствует, то у вас появляется шанс помочь FreeBSD,
    приготовив обновление самим!  Пожалуйста, делайте это с
    использованием команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> в основной системе.</p><p>Чтобы создать подходящий <code class="command">diff</code> для одного
    патча, скопируйте файл, который нужно пропатчить, в
    <em class="replaceable"><code>something.orig</code></em>, сохраните ваши
    изменения в <em class="replaceable"><code>something</code></em>, а затем
    создайте ваше патч:</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>diff -u something.orig something &gt; something.diff</code></strong></pre></div><p>В противном случае, вам следует воспользоваться методом
    <code class="command">svn diff</code> (<a class="xref" href="port-upgrading.html#svn-diff" title="10.1. Использование Subversion для создания патчей">Раздел 10.1, <<Использование <span class="application">Subversion</span> для
      создания патчей>></a>), либо
    скопировать содержимое порта в отдельный каталог и применить
    результат рекурсивной команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> между новым и старым
    каталогами порта (например, если каталог с модифицированным
    портом называется <code class="filename">superedit</code>, а оригинальный,
    совпадающий с находящимся в нашем дереве портов,
    <code class="filename">superedit.bak</code>, то сохраните результат
    выполнения команды <code class="command">diff -ruN superedit.bak
      superedit</code>).  Подойдёт как унифицированный, так и
    контекстный дифф, однако коммиттеры портов обычно предпочитают
    унифицированный формат.  Отметьте использование опции
    <code class="literal">-N</code>-это одобряемый способ заставить diff
    корректно работать в случае добавления новых файлов или удаления
    старых.  Перед тем, как посылать нам diff-файл, пожалуйста,
    проверьте его, чтобы убедиться в значимости всех внесённых
    изменений.  (В частности, убедитесь, что вы очистили рабочие
    каталоги командой <code class="command">make clean</code>).</p><p>Для упрощения повторяющихся операций с файлами заплаток вы
    можете воспользоваться скриптом
    <code class="filename">/usr/ports/Tools/scripts/patchtool.py</code>.
    Перед тем, как его запускать, пожалуйста, прочтите
    <code class="filename">/usr/ports/Tools/scripts/README.patchtool</code>.</p><p>Если порт никем не поддерживается, а вы активно его
    используете, пожалуйста, подумайте над тем, чтобы добровольно
    стать его сопровождающим.  Во FreeBSD имеется более 4000 портов без
    поддержки, и это как раз та область, где всегда нужны
    добровольцы.  (Детальное описание обязанностей сопровождающего
    можно найти в разделе <a class="link" href="../../../../doc/en_US.ISO8859-1/books/developers-handbook/policies.html#POLICIES-MAINTAINER" target="_top">Руководства
      Разработчика</a>.)</p><p>Лучше всего послать нам diff-файл, включив его в посылку по
    команде <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=send-pr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">send-pr</span>(1)</span></a> (категория <code class="literal">ports</code>).
    Если вы сопровождаете порт, обязательно поместите текст
    <code class="literal">[maintainer update]</code> в начале строки описания и
    задайте в поле <span class="quote"><<<span class="quote">Class</span>>></span> вашего PR строчку
    <code class="literal">maintainer-update</code>.  В противном случае в поле
    <span class="quote"><<<span class="quote">Class</span>>></span> вашего PR должно быть указано
    <code class="literal">change-request</code>.  Будьте добры, в сообщении
    отметьте все добавленные или удалённые файлы, так как они будут
    непосредственно указаны <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=svn&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">svn</span>(1)</span></a> при выполнении операции
    коммита.  Если diff-файл имеет размер, превышающий 20КБ, сожмите
    его и обработайте утилитой uuencode; в противном случае просто
    включите его как есть в PR.</p><p>Прежде чем пользоваться <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=send-pr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">send-pr</span>(1)</span></a> просмотрите раздел о
    <a class="link" href="../../../../doc/ru_RU.KOI8-R/articles/problem-reports/pr-writing.html" target="_top">Написании
      сообщений о проблемах</a> в статье о Сообщениях об ошибках.
    Он содержит гораздо больше информации о том, как писать полезные
    сообщения о проблемах.</p><div xmlns="" class="important"><h3 class="admontitle">Важно: </h3><p xmlns="http://www.w3.org/1999/xhtml">Если обновление вызвано соображениями информационной
      безопасности или наличием серьёзных ошибок в имеющемся порте,
      пожалуйста, оповестите Группа Менеджеров Дерева Портов FreeBSD <code class="email">&lt;<a xmlns="" class="email" href="mailto:portmgr@FreeBSD.org">portmgr@FreeBSD.org</a>&gt;</code> о необходимости немедленного
      перепостроения и повторного распространения пакета данного
      порта.  В противном случае ничего не подозревающие пользователи
      <code class="command">pkg</code> будут продолжать устанавливать старую
      версию по команде <code class="command">pkg install</code> в течение ещё
      нескольких недель.</p></div><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Повторяем еще раз - для посылки обновлений существующих
      портов используйте утилиту <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a>, а не <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=shar&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">shar</span>(1)</span></a>!
      Это поможет понять коммиттерам портов, что именно было
      изменено.</p></div><p>Теперь, когда вы проделали всё это, прочитайте о том, как
    поддерживать актуальное состояние, в <a class="xref" href="keeping-up.html" title="Глава 14. Актуализация">Глава 14, <em>Актуализация</em></a>.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="svn-diff"></a>10.1. Использование <span class="application">Subversion</span> для
      создания патчей</h2></div></div></div><p>По возможности присылайте исправления в формате <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=svn&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">svn</span>(1)</span></a>
      diff.  В таком виде их проще использовать по сравнению с
      разницей между <span class="quote"><<<span class="quote">старым и новым</span>>></span> каталогами.  Так
      проще увидеть изменения и обновить их в случае, если что-нибудь
      изменилось в Коллекции Портов с тех пор, как вы начали работу,
      либо если коммиттер просит что-то исправить.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd ~/my_wrkdir</code></strong> <a id="my-wrkdir"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">%</code> <strong class="userinput"><code>svn co https://svn0.us-west.FreeBSD.org/ports/head/dns/pdnsd</code></strong> <a id="svn-FreeBSD-org"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
<code class="prompt">%</code> <strong class="userinput"><code>cd ~/my_wrkdir/pdnsd</code></strong></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#my-wrkdir"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Это может быть где угодно; место, в котором
	  производится построение портов, не привязано к
	  <code class="filename">/usr/ports/</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#svn-FreeBSD-org"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p><a class="link" href="https://svn0.us-west.FreeBSD.org/" target="_top">svn0.us-west.FreeBSD.org</a>
	  - это общедоступный сервер
	  <span class="application">Subversion</span>.  Выберите ближайшее
	  зеркало и проверьте сертификат зеркалирующего сервера на
	  наличие в перечне <a class="link" href="../../../../doc/ru_RU.KOI8-R/books/handbook/svn-mirrors.html" target="_top">зеркалирующих
	    сайтов Subversion</a>.</p></td></tr></table></div><p>Находясь в рабочем каталоге, вносите любые изменения,
      которые обычно делают для порта.  При добавлении или удалении
      файла используйте <code class="command">svn</code> для отслеживания этих
      изменений:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn add new_file</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn remove deleted_file</code></strong></pre><p>Убедитесь, что вы проверяете порт в соответствии с
      рекомендуемым порядком проверки, описанным в
      <a class="xref" href="porting-testing.html" title="3.4. Тестирование порта">Раздел 3.4, <<Тестирование порта>></a> и
      <a class="xref" href="porting-portlint.html" title="3.5. Проверка вашего порта утилитой portlint">Раздел 3.5, <<Проверка вашего порта утилитой
      <code class="command">portlint</code>>></a>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn status</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn update</code></strong> <a id="svn-update"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#svn-update"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Эта команда попытается выполнить слияние различий между
	  вашим патчем и текущей версией репозитория; внимательно
	  проверьте полученный вывод.  Буква перед названием каждого
	  файла означает тип изменения, сделанного с этим файлом.
	  Для получения полного списка смотрите <a class="xref" href="port-upgrading.html#table-svn-up" title="Таблица 10.1. Префиксы файлов для Subversion Update">Таблица 10.1, <<Префиксы файлов для
	<span class="application">Subversion</span> Update>></a>.</p></td></tr></table></div><div class="table"><a id="table-svn-up"></a><div class="table-title">Таблица 10.1. Префиксы файлов для
	<span class="application">Subversion</span> Update</div><div class="table-contents"><table summary="Префиксы файлов для&#10;&#9;Subversion Update" width="100%" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td>U</td><td>Файл обновлен без проблем.</td></tr><tr><td>G</td><td>Файл обновлен без проблем (вы увидите это только
	      при работе с удаленным репозиторием).</td></tr><tr><td>M</td><td>Файл с локальными изменениями, слияние выполнено
	      без конфликтов.</td></tr><tr><td>C</td><td>Файл с локальными изменениями, слияние выполнено
	      с конфликтами.</td></tr></tbody></table></div></div><br class="table-break" /><p>Если в результате выполнения <code class="literal">svn update</code>
      отображается <code class="literal">C</code>, то это означает, что что-то
      изменилось в репозитории <span class="application">Subversion</span>
      и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=svn&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">svn</span>(1)</span></a> не смогла выполнить слияние локальных изменений с
      полученными из репозитория.  В любом случае никогда не помешает
      просмотреть изменения, поскольку <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=svn&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">svn</span>(1)</span></a> ничего не знает о
      том, каким должен быть порт, поэтому эта команда может (и,
      вероятно, будет) делать слияние тех изменений, которые не имеют
      смысла.</p><p>Последним шагом является создание унифицированного
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> для полученных изменений:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn diff &gt; ../`basename ${PWD}`.diff</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Информация о любых удаляемых файлов должна быть явным
	образом указана в PR, поскольку необходимость в удалении
	файла для коммиттера может быть неочевидна.</p></div><p>Присылайте свои патчи в соответствии с руководством,
      описанном в <a class="xref" href="port-upgrading.html" title="Глава 10. Обновление отдельного порта">Глава 10, <em>Обновление отдельного порта</em></a>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="testing-poudriere.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="moved-and-updating-files.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">9.6. Poudriere </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 10.2. Файлы <code class="filename">UPDATING</code> и
      <code class="filename">MOVED</code></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>