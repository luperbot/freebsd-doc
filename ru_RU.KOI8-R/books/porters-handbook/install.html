<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>5.15. Установка файлов</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD по созданию портов" /><link rel="up" href="makefiles.html" title="Глава 5. Настройка файла Makefile" /><link rel="prev" href="conflicts.html" title="5.14. Разрешение конфликтов" /><link rel="next" href="special.html" title="Глава 6. Особые соглашения" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.15. Установка файлов</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="conflicts.html">Пред.</a> </td><th width="60%" align="center">Глава 5. Настройка файла Makefile</th><td width="20%" align="right"> <a accesskey="n" href="special.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="install"></a>5.15. Установка файлов</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="install-macros"></a>5.15.1. Макросы <code class="varname">INSTALL_*</code></h3></div></div></div><p>Используйте макросы, которые есть в файле
	<code class="filename">bsd.port.mk</code> для обеспечения правильных
	прав доступа файлов в целях
	<code class="buildtarget">*-install</code> порта.  Устанавливайте
	права владения напрямую в <code class="filename">pkg-plist</code>
	через соответствующие записи <code class="literal">@owner owner</code>
	и <code class="literal">@group group</code>.  Эти операторы работают до
	момента их переопределения или до конца
	<code class="filename">pkg-plist</code>, поэтому не забывайте их
	сбрасывать, когда они больше не нужны.  По умолчанию владение
	устанавливается для <code class="literal">root:wheel</code>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">INSTALL_PROGRAM</code> - это команда для
	    установки бинарных выполнимых файлов.</p></li><li class="listitem"><p><code class="varname">INSTALL_SCRIPT</code> - это команда для
	    установки выполнимых скриптов.</p></li><li class="listitem"><p><code class="varname">INSTALL_LIB</code> - это команда для
	    установки динамических библиотек.</p></li><li class="listitem"><p><code class="varname">INSTALL_KLD</code> - это команда для
	    установки загружаемых модулей ядра.  Некоторые
	    архитектуры предпочитают, чтобы для модулей сохранялись
	    отладочные сведения, по этой причине используйте эту
	    команду вместо <code class="varname">INSTALL_PROGRAM</code>.</p></li><li class="listitem"><p><code class="varname">INSTALL_DATA</code> - это команда для
	    установки совместно используемых файлов данных.</p></li><li class="listitem"><p><code class="varname">INSTALL_MAN</code> - это команда для
	    установки страниц Справочника и другой документации
	    (никаких файлов она не сжимает).</p></li></ul></div><p>В основе работы этих макросов лежит команда
	<code class="command">install</code> со всеми соответствующими флагами.
	Смотрите пример их использования ниже.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="install-strip"></a>5.15.2. Удаление отладочной информации в бинарных файлах и
	динамических библиотеках</h3></div></div></div><p>Не удаляйте отладочную информацию из бинарных файлов
	вручную, если вы это делали.  Во всех двоичных файлах
	отладочная информация должна быть удалена, и макрос
	<code class="varname">INSTALL_PROGRAM</code> выполнит установку и
	удаление отладочной информации одновременно (обратитесь к
	следующему разделу).  Макрос <code class="varname">INSTALL_LIB</code>
	делает то же самое для динамических библиотек.</p><p>Если вам нужно удалить отладочную информацию из файла без
	использования макросов <code class="varname">INSTALL_PROGRAM</code> и
	<code class="varname">INSTALL_LIB</code>, то это можно сделать при
	помощи <code class="varname">${STRIP_CMD}</code>.  Обычно это делается
	внутри цели <code class="literal">post-install</code>.  К
	примеру:</p><pre class="programlisting">post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/xdl</pre><p>Удаление отладочной информации из нескольких
	файлов:</p><pre class="programlisting">post-install:
	.for l in geometry media body track world
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/lib${PORTNAME}-${l}.so.0
	.endfor</pre><p>Для проверки того, удалена ли отладочная информация из
	файла, используйте <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=file&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">file</span>(1)</span></a>.  Для двоичных файлов
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=file&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">file</span>(1)</span></a> печатает <code class="literal">stripped</code> или
	<code class="literal">not stripped</code>.  Кроме того, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=strip&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">strip</span>(1)</span></a>
	определяет, была ли уже удалена из программы отладочная
	информация, и в этом случае просто завершает свою
	работу.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="install-copytree"></a>5.15.3. Установка целого дерева файлов</h3></div></div></div><p>Иногда должно быть установлено большое количество файлов
	с сохранением их иерархической организации.  Например,
	копирование дерева каталогов целиком из
	<code class="varname">WRKSRC</code> в целевой каталог внутри
	<code class="varname">PREFIX</code>.  Обратите внимание, что
	<code class="varname">PREFIX</code>, <code class="varname">EXAMPLESDIR</code>,
	<code class="varname">DATADIR</code> и другие переменные пути всегда
	должны предваряться <code class="varname">STAGEDIR</code>, чтобы не
	ломать staging (смотрите <a class="xref" href="special.html#staging" title="6.1. Staging">Раздел 6.1, <<Staging>></a>).</p><p>Для этой ситуации существует два макроса.  Преимущество
	от использования этих макросов вместо команды
	<code class="command">cp</code> в том, что они гарантируют установку
	правильного владельца и прав на конечные файлы.  Первый
	макрос, <code class="varname">COPYTREE_BIN</code>, делает все
	устанавливаемые файлы исполняемыми, что подходит для
	установки в <code class="filename">PREFIX/bin</code>.  Второй макрос,
	<code class="varname">COPYTREE_SHARE</code>, не устанавливает на файлы
	права исполнения, и, таким образом, подходит для установки
	файлов внутри каталога
	<code class="filename">PREFIX/share</code>.</p><pre class="programlisting">post-install:
	${MKDIR} ${STAGEDIR}${EXAMPLESDIR}
	(cd ${WRKSRC}/examples &amp;&amp; ${COPYTREE_SHARE} . ${STAGEDIR}${EXAMPLESDIR})</pre><p>В этом примере устанавливается содержимое каталога
	<code class="filename">examples</code> из установочных файлов
	производителя в надлежащее место для примеров вашего
	порта.</p><pre class="programlisting">post-install:
	${MKDIR} ${STAGEDIR}${DATADIR}/summer
	(cd ${WRKSRC}/temperatures &amp;&amp; ${COPYTREE_SHARE} "June July August" ${STAGEDIR}${DATADIR}/summer)</pre><p>А в этом примере будут установлены данные летних месяцев
	в подкаталог <code class="filename">summer</code> каталога
	<code class="filename">DATADIR</code>.</p><p>В качестве третьего параметра в макросе
	<code class="varname">COPYTREE_*</code> можно передать дополнительные
	параметры <code class="command">find</code>.  Например, чтобы в первом
	примере установить все файлы кроме файлов Makefile, можно
	использовать следующую команду.</p><pre class="programlisting">post-install:
	${MKDIR} ${STAGEDIR}${EXAMPLESDIR}
	(cd ${WRKSRC}/examples &amp;&amp; \
	${COPYTREE_SHARE} . ${STAGEDIR}${EXAMPLESDIR} "! -name Makefile")</pre><p>Эти макросы не производят добавление устанавливаемых
	файлов в <code class="filename">pkg-plist</code>.  Они должны быть
	добавлены туда вручную.  Необязательные файлы документации
	(<code class="varname">PORTDOCS</code>, смотрите <a class="xref" href="install.html#install-documentation" title="5.15.4. Установка дополнительной документации">Раздел 5.15.4, <<Установка дополнительной документации>></a>) и примеров
	(<code class="varname">PORTEXAMPLES</code>) всегда должны предваряться
	в <code class="filename">pkg-plist</code> префиксами
	<code class="literal">%%PORTDOCS%%</code> или
	<code class="literal">%%PORTEXAMPLES%%</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="install-documentation"></a>5.15.4. Установка дополнительной документации</h3></div></div></div><p>Если с вашим программным обеспечением поставляется
	некоторая документация, отличающаяся от стандартных страниц
	Справочника и файлов info, которая, как вы думаете, будет
	полезна пользователям, установите ее в каталог
	<code class="filename">PREFIX/share/doc</code>.  Это может быть
	сделано, как и в предыдущем разделе, в цели
	<code class="buildtarget">post-install</code>.</p><p>Создайте для вашего порта новый каталог.  Имя каталога
	должно соответствовать тому, что представляет из себя порт.
	Обычно это означает <code class="varname">PORTNAME</code>.  Однако,
	если вы думаете, что пользователь захочет иметь разные версии
	порта, установленные одновременно, то вы можете использовать
	полное имя <code class="varname">PKGNAME</code>.</p><p>Поскольку устанавливаются только файлы, перечисленные в
	<code class="filename">pkg-plist</code>, безопасным способом будет
	устанавливать документацию в <code class="varname">STAGEDIR</code>
	всегда (смотрите <a class="xref" href="special.html#staging" title="6.1. Staging">Раздел 6.1, <<Staging>></a>).  Следовательно,
	блоки <code class="literal">.if</code> нужны только для файлов
	достаточно большого размера, установка которых влечёт
	значительные накладные расходы на операции
	ввода/вывода.</p><pre class="programlisting">post-install:
	${MKDIR} ${STAGEDIR}${DOCSDIR}
	${INSTALL_MAN} ${WRKSRC}/docs/xvdocs.ps ${STAGEDIR}${DOCSDIR}</pre><p>Вот несколько полезных переменных и то, как они
	преобразуются по умолчанию при использовании в
	<code class="filename">Makefile</code>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">DATADIR</code> преобразуется в
	    <code class="filename">PREFIX/share/PORTNAME</code>.</p></li><li class="listitem"><p><code class="varname">DATADIR_REL</code> преобразуется в
	    <code class="filename">share/PORTNAME</code>.</p></li><li class="listitem"><p><code class="varname">DOCSDIR</code> преобразуется в
	    <code class="filename">PREFIX/share/doc/PORTNAME</code>.</p></li><li class="listitem"><p><code class="varname">DOCSDIR_REL</code> преобразуется в
	    <code class="filename">share/doc/PORTNAME</code>.</p></li><li class="listitem"><p><code class="varname">EXAMPLESDIR</code> преобразуется в
	    <code class="filename">PREFIX/share/examples/PORTNAME</code>.</p></li><li class="listitem"><p><code class="varname">EXAMPLESDIR_REL</code> преобразуется в
	    <code class="filename">share/examples/PORTNAME</code>.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Параметр <code class="literal">DOCS</code> управляет установкой
	  дополнительной документации в <code class="varname">DOCSDIR</code>.
	  Это не относится к стандартным страницам справочника и
	  страницам info.  Все, что устанавливается в
	  <code class="varname">DATADIR</code> и
	  <code class="varname">EXAMPLESDIR</code>, соответственно управляется
	  через параметры <code class="literal">DATA</code> и
	  <code class="literal">EXAMPLES</code>.</p></div><p>Эти переменные экспортируются в
	<code class="varname">PLIST_SUB</code>.  Их значения появятся там в
	виде имён путей относительно <code class="filename">PREFIX</code>,
	если это возможно.  То есть
	<code class="filename">share/doc/PORTNAME</code> в списке сборки по
	умолчанию будет заменен на <code class="literal">%%DOCSDIR%%</code>, и
	так далее.  (Дополнительную информацию о подстановке в
	<code class="filename">pkg-plist</code> можно найти <a class="link" href="plist.html#plist-sub" title="7.1. Изменение содержимого pkg-plist в зависимости от make-переменных">здесь</a>.)</p><p>Все условно устанавливаемые файлы и каталоги с
	документацией должны быть перечислены в файле
	<code class="filename">pkg-plist</code> с префиксом
	<code class="literal">%%PORTDOCS%%</code>, например:</p><pre class="programlisting">%%PORTDOCS%%%%DOCSDIR%%/AUTHORS
%%PORTDOCS%%%%DOCSDIR%%/CONTACT
%%PORTDOCS%%@dirrm %%DOCSDIR%%</pre><p>В качестве альтернативы перечислению файлов документации
	в файле <code class="filename">pkg-plist</code>, порт может указать в
	переменной <code class="varname">PORTDOCS</code> список имён файлов и
	глобальных шаблонов командного процессора для добавления в
	окончательный список сборки.  Имена будут задаваться
	относительно <code class="varname">DOCSDIR</code>.  Таким образом,
	порт, использующий <code class="varname">PORTDOCS</code> и
	нестандартное местоположение документации, должен задавать
	соответствующим образом и <code class="varname">DOCSDIR</code>.  Если
	каталог указан в <code class="varname">PORTDOCS</code> или
	соответствует шаблону для этой переменной, то полное
	поддерево с входящими в него файлами и каталогами будет
	регистрироваться в окончательном списке сборки.  Если
	параметр <code class="literal">DOCS</code> не задан, то файлы и
	каталоги, перечисленные в <code class="varname">PORTDOCS</code>, не
	будут установлены и добавлены в список сборки порта.
	Установка документации в <code class="varname">PORTDOCS</code>, как это
	показано выше, остаётся за самим портом.  Типичный пример
	использования <code class="varname">PORTDOCS</code> выглядит следующим
	образом:</p><pre class="programlisting">PORTDOCS=	README.* ChangeLog docs/*</pre><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Эквивалентами <code class="varname">PORTDOCS</code> для файлов,
	  устанавливаемых в <code class="varname">DATADIR</code> и
	  <code class="varname">EXAMPLESDIR</code> являются
	  <code class="varname">PORTDATA</code> и
	  <code class="varname">PORTEXAMPLES</code> соответственно.</p><p xmlns="http://www.w3.org/1999/xhtml">Во время установки выводится содержимое
	  <code class="filename">pkg-message</code>.  За подробной информацией
	  обратитесь к <a class="link" href="pkg-files.html#porting-message" title="8.1. pkg-message">разделу об
	  использовании <code class="filename">pkg-message</code></a>.
	  Файл <code class="filename">pkg-message</code> не нужно добавлять в
	  <code class="filename">pkg-plist</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="install-subdirs"></a>5.15.5. Подкаталоги внутри PREFIX</h3></div></div></div><p>Попробуйте поместить все файлы порта в правильных
	подкаталогах каталога <code class="varname">PREFIX</code>.  Некоторые
	порты игнорируют все установки и помещают все в подкаталог с
	именем порта, что неправильно.  Также многие порты помещают
	все, кроме бинарных файлов, файлов заголовков и страниц
	Справочника, в подкаталог каталога <code class="filename">lib</code>,
	что не очень хорошо работает с подходом BSD.  Многие файлы
	должны быть перемещены в одно из следующих местоположений:
	<code class="filename">etc</code>
	(настроечные/конфигурационные файлы),
	<code class="filename">libexec</code> (выполнимые файлы, запускаемые
	из других программ), <code class="filename">sbin</code> (исполнимые
	файлы для администраторов/менеджеров системы),
	<code class="filename">info</code> (документация в формате info для
	просмотрщика info) или <code class="filename">share</code>
	(независимые от архитектуры файлы).  Обратитесь к
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hier&amp;sektion=7"><span class="citerefentry"><span class="refentrytitle">hier</span>(7)</span></a> для прояснения деталей; правила, покрывающие
	<code class="filename">/usr</code>, достаточно хорошо подходят также и
	к <code class="filename">/usr/local</code>.  Исключением являются
	порты, имеющие дело с <span class="quote"><<<span class="quote">новостями</span>>></span> USENET.  Они
	могут использовать каталог <code class="filename">PREFIX/news</code>
	для установки своих файлов.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="conflicts.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="makefiles.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="special.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">5.14. Разрешение конфликтов </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> Глава 6. Особые соглашения</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>