<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>6.20. Использование Lua</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD по созданию портов" /><link rel="up" href="special.html" title="Глава 6. Особые соглашения" /><link rel="prev" href="using-wx.html" title="6.19. Использование wxWidgets" /><link rel="next" href="using-iconv.html" title="6.21. Использование iconv" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.20. Использование <span class="application">Lua</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="using-wx.html">Пред.</a> </td><th width="60%" align="center">Глава 6. Особые соглашения</th><td width="20%" align="right"> <a accesskey="n" href="using-iconv.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-lua"></a>6.20. Использование <span class="application">Lua</span></h2></div></div></div><p>Эта глава описывает статус библиотек
      <span class="application">Lua</span> в дереве портов и их интеграцию
      в систему портов.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-introduction"></a>6.20.1. Введение</h3></div></div></div><p>Существует множество версий библиотек
	<span class="application">Lua</span> и соответствующих
	интерпретаторов, конфликтующих между собой (устанавливают
	файлы под тем же именем).  В дереве портов эта проблема
	решена путем установки каждой версии в собственное место с
	использованием номера версии в качестве суффикса.</p><p>Очевидным недостатком этого является необходимость
	изменения каждого приложения для нахождения искомой версии.
	Но это решается добавлением некоторых дополнительных флагов
	для компилятора и компоновщика.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-version"></a>6.20.2. Выбор версии</h3></div></div></div><p>Для того, чтобы заставить ваш порт использовать
	конкретную версию <span class="application">Lua</span>, существует
	две доступные для определения переменные (если определена
	только одна, то вторая примет значение по умолчанию):</p><div class="table"><a id="lua-ver-sel-table"></a><div class="table-title">Таблица 6.35. Переменные для выбора версии
	  <span class="application">Lua</span></div><div class="table-contents"><table summary="Переменные для выбора версии&#10;&#9;  Lua" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Переменная</th><th>Описание</th><th>Значение по умолчанию</th></tr></thead><tbody><tr><td><code class="varname">USE_LUA</code></td><td>Перечень версий, которые порт может
		использовать</td><td>Все доступные версии</td></tr><tr><td><code class="varname">USE_LUA_NOT</code></td><td>Перечень версий, которые порт не может
		использовать</td><td>Пусто</td></tr></tbody></table></div></div><br class="table-break" /><p>Перечень доступных версий <span class="application">Lua</span>
	и соответствующих портов в дереве:</p><div class="table"><a id="idp78394576"></a><div class="table-title">Таблица 6.36. Доступные версии
	  <span class="application">Lua</span></div><div class="table-contents"><table summary="Доступные версии&#10;&#9;  Lua" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Версия</th><th>Порт</th></tr></thead><tbody><tr><td><code class="literal">4.0</code></td><td><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/lang/lua4/pkg-descr">lang/lua4</a></td></tr><tr><td><code class="literal">5.0</code></td><td><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/lang/lua50/pkg-descr">lang/lua50</a></td></tr><tr><td><code class="literal">5.1</code></td><td><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/lang/lua/pkg-descr">lang/lua</a></td></tr></tbody></table></div></div><br class="table-break" /><p>Переменные из <a class="xref" href="using-lua.html#lua-ver-sel-table" title="Таблица 6.35. Переменные для выбора версии Lua">Таблица 6.35, <<Переменные для выбора версии
	  <span class="application">Lua</span>>></a> могут
	иметь комбинации из одного или нескольких значений,
	разделенных пробелом:</p><div class="table"><a id="idp78411856"></a><div class="table-title">Таблица 6.37. Определение версии
	  <span class="application">Lua</span></div><div class="table-contents"><table summary="Определение версии&#10;&#9;  Lua" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Описание</th><th>Пример</th></tr></thead><tbody><tr><td>Единичная версия</td><td><code class="literal">4.0</code></td></tr><tr><td>Восходящий диапазон</td><td><code class="literal">5.0+</code></td></tr><tr><td>Нисходящий диапазон</td><td><code class="literal">5.0-</code></td></tr><tr><td>Полный диапазон (обязан быть восходящим)</td><td><code class="literal">5.0-5.1</code></td></tr></tbody></table></div></div><br class="table-break" /><p>Кроме того, существует несколько переменных для выбора
	предпочитаемых версий из перечня доступных.  Они могут быть
	установлены в несколько версий, первая из которых будет иметь
	наибольший приоритет.</p><div class="table"><a id="idp78425168"></a><div class="table-title">Таблица 6.38. Переменные для выбора предпочитаемых версий
	  <span class="application">Lua</span></div><div class="table-contents"><table summary="Переменные для выбора предпочитаемых версий&#10;&#9;  Lua" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Название</th><th>Предназначение</th></tr></thead><tbody><tr><td><code class="varname">WANT_LUA_VER</code></td><td>порт</td></tr><tr><td><code class="varname">WITH_LUA_VER</code></td><td>пользователь</td></tr></tbody></table></div></div><br class="table-break" /><div class="example"><a id="lua-version-example"></a><div class="example-title">Пример 6.11. Выбор версии <span class="application">Lua</span></div><div class="example-contents"><p>Следующий фрагмент взят из порта, который использует
	  <span class="application">Lua</span> версий
	  <code class="literal">5.0</code> или <code class="literal">5.1</code>, по
	  умолчанию <code class="literal">5.0</code>.  Значение может быть
	  переопределено пользователем с использованием переменной
	  <code class="varname">WITH_LUA_VER</code>.</p><pre class="programlisting">USE_LUA=	5.0-5.1
WANT_LUA_VER=	5.0</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-components"></a>6.20.3. Выбор компонентов</h3></div></div></div><p>Существуют другие приложения, которые хотя и не являются
	библиотеками <span class="application">Lua</span>, но относятся к
	ним.  Эти приложения можно указать в переменной
	<code class="varname">LUA_COMPS</code>.  Доступны следующие
	компоненты:</p><div class="table"><a id="idp78437456"></a><div class="table-title">Таблица 6.39. Доступные компоненты
	  <span class="application">Lua</span></div><div class="table-contents"><table summary="Доступные компоненты&#10;&#9;  Lua" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Название</th><th>Описание</th><th>Ограничение версии</th></tr></thead><tbody><tr><td><code class="literal">lua</code></td><td>Основная библиотека</td><td>нет</td></tr><tr><td><code class="literal">tolua</code></td><td>Библиотека доступа к коду C/C++</td><td>4.0-5.0</td></tr><tr><td><code class="literal">ruby</code></td><td>Привязка к Ruby</td><td>4.0-5.0</td></tr></tbody></table></div></div><br class="table-break" /><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Есть и другие компоненты, но они относятся к модулям
	  для интерпретатора и не используются приложениями (только
	  другими модулями).</p></div><p>Тип зависимости можно выбрать для каждого компонента
	через добавление суффикса, отделенного точкой с запятой.  В
	случае отсутствия будет использован тип по умолчанию
	(смотрите <a class="xref" href="using-lua.html#lua-def-dep-types" title="Таблица 6.41. Типы зависимости Lua, используемые по умолчанию">Таблица 6.41, <<Типы зависимости <span class="application">Lua</span>,
	  используемые по умолчанию>></a>).  Доступные
	следующие типы:</p><div class="table"><a id="idp78456400"></a><div class="table-title">Таблица 6.40. Доступные типы зависимости
	  <span class="application">Lua</span></div><div class="table-contents"><table summary="Доступные типы зависимости&#10;&#9;  Lua" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Название</th><th>Описание</th></tr></thead><tbody><tr><td><code class="literal">build</code></td><td>Компонент требуется для построения, эквивалентен
		<code class="varname">BUILD_DEPENDS</code></td></tr><tr><td><code class="literal">run</code></td><td>Компонент требуется для запуска, эквивалентен
		<code class="varname">RUN_DEPENDS</code></td></tr><tr><td><code class="literal">lib</code></td><td>Компонент требуется для построения и запуска,
		эквивалентен <code class="varname">LIB_DEPENDS</code></td></tr></tbody></table></div></div><br class="table-break" /><p>Значения по умолчанию для компонентов подробно
	рассматриваются в следующей таблице:</p><div class="table"><a id="lua-def-dep-types"></a><div class="table-title">Таблица 6.41. Типы зависимости <span class="application">Lua</span>,
	  используемые по умолчанию</div><div class="table-contents"><table summary="Типы зависимости Lua,&#10;&#9;  используемые по умолчанию" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Компонент</th><th>Тип зависимости</th></tr></thead><tbody><tr><td><code class="literal">lua</code></td><td><code class="literal">lib</code> для
		<code class="literal">4.0-5.0</code> (динамическая) и
		<code class="literal">build</code> для <code class="literal">5.1</code>
		(статическая)</td></tr><tr><td><code class="literal">tolua</code></td><td><code class="literal">build</code> (статическая)</td></tr><tr><td><code class="literal">ruby</code></td><td><code class="literal">lib</code> (динамическая)</td></tr></tbody></table></div></div><br class="table-break" /><div class="example"><a id="lua-components-example"></a><div class="example-title">Пример 6.12. Выбор компонентов
	  <span class="application">Lua</span></div><div class="example-contents"><p>Следующий фрагмент соответствует порту, использующему
	  <span class="application">Lua</span> версии
	  <code class="literal">4.0</code> и привязку к
	  <span class="application">Ruby</span>.</p><pre class="programlisting">USE_LUA=	4.0
LUA_COMPS=	lua ruby</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-version-detection"></a>6.20.4. Обнаружение установленных версий</h3></div></div></div><p>Для обнаружения установленной версии вам необходимо
	задать переменную <code class="varname">WANT_LUA</code>.  Если вы не
	присвоите ей определенную версию, то компоненты получат
	суффикс версии.  Переменная <code class="varname">HAVE_LUA</code> будет
	заполнена после обнаружения.</p><div class="example"><a id="lua-ver-det-example"></a><div class="example-title">Пример 6.13. Обнаружение установленных версий и компонентов
	  <span class="application">Lua</span></div><div class="example-contents"><p>Следующий фрагмент можно использовать для порта,
	  использующего <span class="application">Lua</span>, если она
	  установлена, или был выбран соответствующий
	  параметр.</p><pre class="programlisting">WANT_LUA=	yes

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_LUA5) || !empty(PORT_OPTIONS:MLUA5) || !empty(HAVE_LUA:Mlua-5.[01])
USE_LUA=		5.0-5.1
CONFIGURE_ARGS+=	--enable-lua5
.endif</pre><p>Следующий фрагмент можно использовать для порта,
	  который включает поддержку
	  <span class="application">tolua</span>, если такой компонент
	  установлен, или был выбран соответствующий параметр в
	  дополнение к <span class="application">Lua</span>, оба имеют
	  версию <code class="literal">4.0</code>.</p><pre class="programlisting">USE_LUA=	4.0
LUA_COMPS=	lua
WANT_LUA=	4.0

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_TOLUA) || !empty(PORT_OPTIONS:MTOLUA) || !empty(HAVE_LUA:Mtolua)
LUA_COMPS+=		tolua
CONFIGURE_ARGS+=	--enable-tolua
.endif</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-defined-variables"></a>6.20.5. Переменные для определения</h3></div></div></div><p>Следующие переменные доступны в порту (после определения
	одной из переменных из
	<a class="xref" href="using-lua.html#lua-ver-sel-table" title="Таблица 6.35. Переменные для выбора версии Lua">Таблица 6.35, <<Переменные для выбора версии
	  <span class="application">Lua</span>>></a>).</p><div class="table"><a id="idp78494416"></a><div class="table-title">Таблица 6.42. Переменные, определенные для портов, использующих
	  <span class="application">Lua</span></div><div class="table-contents"><table summary="Переменные, определенные для портов, использующих&#10;&#9;  Lua" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Название</th><th>Описание</th></tr></thead><tbody><tr><td><code class="varname">LUA_VER</code></td><td>Версия <span class="application">Lua</span>, которая
		будет использоваться (например,
		<code class="literal">5.1</code>)</td></tr><tr><td><code class="varname">LUA_VER_SH</code></td><td>Старший номер версии динамической библиотеки
		<span class="application">Lua</span> (например,
		<code class="literal">1</code>)</td></tr><tr><td><code class="varname">LUA_VER_STR</code></td><td>Версия <span class="application">Lua</span> без точки
		(например, <code class="literal">51</code>)</td></tr><tr><td><code class="varname">LUA_PREFIX</code></td><td>Префикс, в который установлена
		<span class="application">Lua</span> (и компоненты)</td></tr><tr><td><code class="varname">LUA_SUBDIR</code></td><td>Каталог под <code class="filename">${PREFIX}/bin</code>,
		<code class="filename">${PREFIX}/share</code> и
		<code class="filename">${PREFIX}/lib</code>, в который
		установлена <span class="application">Lua</span></td></tr><tr><td><code class="varname">LUA_INCDIR</code></td><td>Каталог, в который установлены заголовочные
		файлы <span class="application">Lua</span> и
		<span class="application">tolua</span></td></tr><tr><td><code class="varname">LUA_LIBDIR</code></td><td>Каталог, в который установлены библиотеки
		<span class="application">Lua</span> и
		<span class="application">tolua</span></td></tr><tr><td><code class="varname">LUA_MODLIBDIR</code></td><td>Каталог, в который установлены модули библиотеки
		<span class="application">Lua</span>
		(<code class="filename">.so</code>)</td></tr><tr><td><code class="varname">LUA_MODSHAREDIR</code></td><td>Каталог, в который установлены модули
		<span class="application">Lua</span>
		(<code class="filename">.lua</code>)</td></tr><tr><td><code class="varname">LUA_PKGNAMEPREFIX</code></td><td>Префикс с именем пакета, используемый модулями
		<span class="application">Lua</span></td></tr><tr><td><code class="varname">LUA_CMD</code></td><td>Путь к интерпретатору
		<span class="application">Lua</span></td></tr><tr><td><code class="varname">LUAC_CMD</code></td><td>Путь к компилятору
		<span class="application">Lua</span></td></tr><tr><td><code class="varname">TOLUA_CMD</code></td><td>Путь к программе
		<span class="application">tolua</span></td></tr></tbody></table></div></div><br class="table-break" /><div class="example"><a id="lua-variables-example"></a><div class="example-title">Пример 6.14. Указание для порта, где искать
	  <span class="application">Lua</span></div><div class="example-contents"><p>Следующий фрагмент показывает, как сообщить порту,
	  который использует сценарий configure, где расположены
	  заголовочные файлы и библиотеки
	  <span class="application">Lua</span>.</p><pre class="programlisting">USE_LUA=	4.0
GNU_CONFIGURE=	yes
CONFIGURE_ENV=	CPPFLAGS="-I${LUA_INCDIR}" LDFLAGS="-L${LUA_LIBDIR}"</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-premk"></a>6.20.6. Обработка в <code class="filename">bsd.port.pre.mk</code></h3></div></div></div><p>Если вам нужно использовать переменные для запуска команд
	сразу после подключения <code class="filename">bsd.port.pre.mk</code>,
	для этого вам нужно определить переменную
	<code class="varname">LUA_PREMK</code>.</p><div xmlns="" class="important"><h3 class="admontitle">Важно: </h3><p xmlns="http://www.w3.org/1999/xhtml">Если вы задаете <code class="varname">LUA_PREMK</code>, то
	  версия, зависимости, компоненты и уже заданные переменные
	  не будут изменены, в случае если вы изменили переменные
	  порта <span class="application">Lua</span>
	  <span class="emphasis"><em>после</em></span> подключения
	  <code class="filename">bsd.port.pre.mk</code>.</p></div><div class="example"><a id="lua-premk-example"></a><div class="example-title">Пример 6.15. Использование переменных
	  <span class="application">Lua</span> в командах</div><div class="example-contents"><p>Следующий фрагмент иллюстрирует использование
	  <code class="varname">LUA_PREMK</code> посредством запуска
	  интерпретатора <span class="application">Lua</span> для того,
	  чтобы получить строку с полной версией, сохранить ее в
	  переменную и передать программе.</p><pre class="programlisting">USE_LUA=	5.0
LUA_PREMK=	yes

.include &lt;bsd.port.pre.mk&gt;

.if exists(${LUA_CMD})
VER_STR!=	${LUA_CMD} -v

CFLAGS+=	-DLUA_VERSION_STRING="${VER_STR}"
.endif</pre></div></div><br class="example-break" /><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Переменные <span class="application">Lua</span> можно
	  безопасно использовать в командах внутри целей без
	  необходимости в использовании
	  <code class="varname">LUA_PREMK</code>.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="using-wx.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="special.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="using-iconv.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">6.19. Использование <span class="application">wxWidgets</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 6.21. Использование <code class="command">iconv</code></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>