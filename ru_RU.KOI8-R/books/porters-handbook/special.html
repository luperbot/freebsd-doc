<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>Глава 6. Особые соглашения</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD по созданию портов" /><link rel="up" href="index.html" title="Руководство FreeBSD по созданию портов" /><link rel="prev" href="install.html" title="5.15. Установка файлов" /><link rel="next" href="porting-shlibs.html" title="6.2. Динамические библиотеки" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Глава 6. Особые соглашения</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="install.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="porting-shlibs.html">След.</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="special"></a>Глава 6. Особые соглашения</h1></div></div></div><div class="toc"><div class="toc-title">Содержание</div><dl class="toc"><dt><span class="sect1"><a href="special.html#staging">6.1. Staging</a></span></dt><dt><span class="sect1"><a href="porting-shlibs.html">6.2. Динамические библиотеки</a></span></dt><dt><span class="sect1"><a href="porting-restrictions.html">6.3. Порты с ограничениями на распространение или с правовым
      обременением</a></span></dt><dt><span class="sect1"><a href="building.html">6.4. Механизмы построения</a></span></dt><dt><span class="sect1"><a href="using-autotools.html">6.5. Использование GNU Autotools</a></span></dt><dt><span class="sect1"><a href="using-gettext.html">6.6. Использование GNU <code class="literal">gettext</code></a></span></dt><dt><span class="sect1"><a href="using-perl.html">6.7. Использование <span class="application">Perl</span></a></span></dt><dt><span class="sect1"><a href="using-x11.html">6.8. Использование X11</a></span></dt><dt><span class="sect1"><a href="using-gnome.html">6.9. Использование GNOME</a></span></dt><dt><span class="sect1"><a href="using-qt.html">6.10. Использование Qt</a></span></dt><dt><span class="sect1"><a href="using-kde.html">6.11. Использование KDE</a></span></dt><dt><span class="sect1"><a href="using-java.html">6.12. Использование Java</a></span></dt><dt><span class="sect1"><a href="using-php.html">6.13. Веб-приложения, Apache и PHP</a></span></dt><dt><span class="sect1"><a href="using-python.html">6.14. Использование Python</a></span></dt><dt><span class="sect1"><a href="using-tcl.html">6.15. Использование <span class="application">Tcl/Tk</span></a></span></dt><dt><span class="sect1"><a href="using-emacs.html">6.16. Использование Emacs</a></span></dt><dt><span class="sect1"><a href="using-ruby.html">6.17. Использование Ruby</a></span></dt><dt><span class="sect1"><a href="using-sdl.html">6.18. Использование SDL</a></span></dt><dt><span class="sect1"><a href="using-wx.html">6.19. Использование <span class="application">wxWidgets</span></a></span></dt><dt><span class="sect1"><a href="using-lua.html">6.20. Использование <span class="application">Lua</span></a></span></dt><dt><span class="sect1"><a href="using-iconv.html">6.21. Использование <code class="command">iconv</code></a></span></dt><dt><span class="sect1"><a href="using-xfce.html">6.22. Использование Xfce</a></span></dt><dt><span class="sect1"><a href="using-mozilla.html">6.23. Использование Mozilla</a></span></dt><dt><span class="sect1"><a href="using-databases.html">6.24. Использование баз данных</a></span></dt><dt><span class="sect1"><a href="rc-scripts.html">6.25. Запуск и остановка служб (сценарии
      <code class="literal">rc</code>)</a></span></dt><dt><span class="sect1"><a href="users-and-groups.html">6.26. Добавление пользователей и групп</a></span></dt><dt><span class="sect1"><a href="requiring-kernel-sources.html">6.27. Порты, требующие наличия исходных текстов ядра</a></span></dt></dl></div><p>Имеется ещё несколько вещей, которые вы должны иметь в виду
    при создании порта.  Этот раздел описывает наиболее часто
    встречающиеся из них.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="staging"></a>6.1. Staging</h2></div></div></div><p><code class="filename">bsd.port.mk</code> ожидает от портов работу с
      <span class="quote"><<<span class="quote">каталогом сборки</span>>></span>.  Это означает, что порт должен
      устанавливать файлы не напрямую в назначенные каталоги (то
      есть, например, под <code class="varname">PREFIX</code>), а в отдельный
      каталог, из которого затем собирается пакет.  Во многих случаях
      привилегии root для этого не требуются, что делает возможным
      сборку пакетов из-под непривилегированного пользователя.  В
      режиме staging порт собирается и устанавливается в каталог
      сборки <code class="varname">STAGEDIR</code>.  Пакет создается из
      каталога сборки и затем устанавливается в систему.  В
      инструментарии automake такая концепция именуется
      <code class="varname">DESTDIR</code>; в прочем, в FreeBSD
      <code class="varname">DESTDIR</code> имеет собственное значение (смотрите
      <a class="xref" href="porting-prefix.html" title="9.4. PREFIX и DESTDIR">Раздел 9.4, <<<code class="varname">PREFIX</code> и
      <code class="varname">DESTDIR</code>>></a>).</p><p>Если для порта всё ещё требуются системные привилегии при
      выполнении цели <code class="buildtarget">package</code>, то в
      <code class="filename">Makefile</code> должна быть добавлена следующая
      строка:</p><pre class="programlisting">NEED_ROOT=	yes</pre><p>Метапорты, то есть порты, которые не устанавливают файлы
      непосредственно, а только зависят от других портов, должны по
      возможности избегать распаковки <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mtree&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mtree</span>(8)</span></a> в каталог сборки.
      Это основная иерархия каталогов пакета, и эти пустые каталоги
      будут выглядеть лишними.  Для предотвращения распаковки
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mtree&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mtree</span>(8)</span></a> добавьте эту строку:</p><pre class="programlisting">NO_MTREE=	yes</pre><p>Staging задействуется посредством добавления переменной
      <code class="varname">STAGEDIR</code> слева от путей, которые
      используются в целях <code class="buildtarget">pre-install</code>,
      <code class="buildtarget">do-install</code> и
      <code class="buildtarget">post-install</code> (смотрите примеры в
      книге).  Обычно сюда относятся <code class="varname">PREFIX</code>,
      <code class="varname">ETCDIR</code>, <code class="varname">DATADIR</code>,
      <code class="varname">EXAMPLESDIR</code>, <code class="varname">MANPREFIX</code>,
      <code class="varname">DOCSDIR</code> и так далее.  Каталоги должны
      создаваться при выполнении цели
      <code class="buildtarget">post-install</code>.  Избегайте
      использования абсолютных путей, когда это возможно.</p><p>При создании символический ссылки
      <code class="varname">STAGEDIR</code> должен ставиться только для пути
      назначения.  Например:</p><pre class="programlisting">${LN} -sf libfoo.so.42 ${STAGEDIR}${PREFIX}/lib/libfoo.so</pre><p>Первоначальный путь
      <code class="filename">${PREFIX}/lib/libfoo.so.42</code> выглядит
      нормально, но по факту может быть неправильным.  Абсолютные
      пути могут указывать на неподходящее место, например, когда
      удалённая файловая система смонтирована по
      <acronym class="acronym">NFS</acronym> как непривилегированная точка
      монтирования.  Относительные пути реже подвержены проблемам и
      часто намного короче.</p><p>Порты, устанавливающие модули ядра, должны предварять путь
      установки (по умолчанию <code class="filename">/boot/modules</code>)
      переменной <code class="varname">STAGEDIR</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="install.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="porting-shlibs.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">5.15. Установка файлов </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 6.2. Динамические библиотеки</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>