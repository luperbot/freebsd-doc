<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>Глава 9. ZFS</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Часто задаваемые вопросы по FreeBSD 8.X, 9.X и 10.X" /><link rel="up" href="index.html" title="Часто задаваемые вопросы по FreeBSD 8.X, 9.X и 10.X" /><link rel="prev" href="disks.html" title="Глава 8. Диски, файловые системы и начальные загрузчики" /><link rel="next" href="admin.html" title="Глава 10. Системное администрирование" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Глава 9. ZFS</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="disks.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="admin.html">След.</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="all-about-zfs"></a>Глава 9. ZFS</h1></div></div></div><div class="qandaset"><a id="idp76507472"></a><dl><dt>9.1. <a href="all-about-zfs.html#idp76507728">Какой минимальный объём ОЗУ нужно иметь для ZFS?</a></dt><dt>9.2. <a href="all-about-zfs.html#idp76509776">Что такое ZIL и когда оно используется?</a></dt><dt>9.3. <a href="all-about-zfs.html#idp76522064">Нужен ли мне SSD для ZIL?</a></dt><dt>9.4. <a href="all-about-zfs.html#idp76524112">Что такое L2ARC?</a></dt><dt>9.5. <a href="all-about-zfs.html#idp76527184">Целесообразно ли включение дедупликации?</a></dt><dt>9.6. <a href="all-about-zfs.html#idp76530000">Я не могу создать или удалить файлы на пуле ZFS.
	    Как я могу это исправить?</a></dt><dt>9.7. <a href="all-about-zfs.html#idp76534480">Поддерживается ли TRIM в ZFS для твердотельных
	    накопителей?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp76507728"></a><a id="how-much-ram-for-zfs"></a><p><strong>9.1.</strong></p></td><td align="left" valign="top"><p>Какой минимальный объём ОЗУ нужно иметь для ZFS?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Для комфортного использования требуется 4 Гбайт
	    ОЗУ, но конкретная нагрузка может сильно различаться.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76509776"></a><a id="what-is-zil"></a><p><strong>9.2.</strong></p></td><td align="left" valign="top"><p>Что такое ZIL и когда оно используется?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><acronym class="acronym">ZIL</acronym> ((<acronym class="acronym">ZFS</acronym>
	    intent log) - это журнал записи, используемый для
	    фиксации операций записи.  Обычно операции собираются
	    в группу транзакций и при заполнении группы пишутся на
	    диск (<span class="quote"><<<span class="quote">Transaction Group Commit</span>>></span>).  Однако
	    системные вызовы типа <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fsync&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">fsync</span>(2)</span></a> требуют фиксацию
	    записи данных на устройстве перед возвратом управления.
	    ZIL нужен для подтверждения такой записи, но когда данные
	    ещё не находятся на диске.  Группа транзакций помечается
	    временной меткой.  В случае системного сбоя ищется
	    последняя неповреждённая метка и из ZIL извлекаются
	    недостающие данные.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76522064"></a><a id="need-ssd-for-zil"></a><p><strong>9.3.</strong></p></td><td align="left" valign="top"><p>Нужен ли мне SSD для ZIL?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>По умолчанию ZFS хранит ZIL в пуле со всеми данными.
	    Если приложение имеет большой процент записи, вынос ZIL
	    на отдельное устройство с очень быстрой синхронной
	    последовательной записью может улучшить общую
	    производительность.  В остальных случаях SSD вряд ли
	    сможет что-то сильно улучшить.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76524112"></a><a id="what-is-l2arc"></a><p><strong>9.4.</strong></p></td><td align="left" valign="top"><p>Что такое L2ARC?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><acronym class="acronym">L2ARC</acronym> - это кеш на чтение,
	    хранимый на быстром устройстве, таком как
	    <acronym class="acronym">SSD</acronym>.  Этот кеш не сохраняется между
	    перезагрузками.  Следует заметить, что ОЗУ выступает
	    как кеш первого уровня, а L2ARC задействуется только
	    при нехватке ОЗУ.</p><p>Для L2ARC нужно пространство в ARC для его индексации.
	    Таким образом, рабочий набор, который идеально помещается
	    в ARC, не будет помещаться при использовании L2ARC, потому
	    что часть ARC будет отведена под индекс L2ARC с
	    вытеснением части рабочего набора в L2ARC, более
	    медленный, чем ОЗУ.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76527184"></a><a id="should-enable-dedup"></a><p><strong>9.5.</strong></p></td><td align="left" valign="top"><p>Целесообразно ли включение дедупликации?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>В общем случае нет.</p><p>Дедупликация занимает значительный объём ОЗУ и может
	    увеличить задержки операций ввода/вывода.  Если данные
	    не являются сильно дублированными (образы виртуальных
	    машин или пользовательские бекапы), то, возможно,
	    дедупликация даст больше вреда.  Другое соображение
	    касается невозможности отменить статус дедупликации.
	    Если данные записаны при включённой дедупликации, её
	    выключение не приведёт к обратной репликации объединённых
	    блоков до момента следующей перезаписи.</p><p>Дедупликация также может приводить к некоторым
	    неожиданным ситуациям. В частности, удаление файлов
	    может сильно замедлиться.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76530000"></a><a id="zpool-fully-full"></a><p><strong>9.6.</strong></p></td><td align="left" valign="top"><p>Я не могу создать или удалить файлы на пуле ZFS.
	    Как я могу это исправить?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Такое может произойти при 100% заполненности пула.
	    ZFS требуется свободное место на диске для записи
	    метаданных транзакций.  Для восстановления
	    работоспособного состояния пула обрежьте файл перед его
	    удалением.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>truncate -s 0 <em class="replaceable"><code>unimportant-file</code></em></code></strong></pre><p>Обрезание файла работает по той причине, что новая
	   транзакция при этом не запускается; вместо этого создаются
	   новые свободные блоки.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">На системах с дополнительной настройкой ZFS dataset,
	      такой как дедупликация, свободное место может не быть
	      доступно сразу.</p></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76534480"></a><a id="zfs-ssd-trim"></a><p><strong>9.7.</strong></p></td><td align="left" valign="top"><p>Поддерживается ли TRIM в ZFS для твердотельных
	    накопителей?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Поддержка ZFS TRIM была добавлена во
	    FreeBSD 10-CURRENT в ревизии
	    r<a xmlns="" href="https://svnweb.freebsd.org/changeset/base/240868"><span class="svnref">240868</span></a> и стала доступна
	    в ветках -STABLE в r<a xmlns="" href="https://svnweb.freebsd.org/changeset/base/252162"><span class="svnref">252162</span></a> и
	    r<a xmlns="" href="https://svnweb.freebsd.org/changeset/base/251419"><span class="svnref">251419</span></a>.</p><p>ZFS TRIM включена по умолчанию и может быть отключена
	    посредством добавления такой строки в
	    <code class="filename">/etc/sysctl.conf</code>:</p><pre class="programlisting">vfs.zfs.trim_disable=1</pre><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">ZFS TRIM может не работать на всех конфигурациях,
	      в частности для файловой системы ZFS на устройствах с
	      использованием GELI.</p></div></td></tr></tbody></table></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="disks.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="admin.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Глава 8. Диски, файловые системы и начальные загрузчики </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> Глава 10. Системное администрирование</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>