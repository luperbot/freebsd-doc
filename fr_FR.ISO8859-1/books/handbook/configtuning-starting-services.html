<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>12.5. Démarrer des services</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="config-tuning.html" title="Chapitre 12. Configuration et optimisation" /><link rel="prev" href="configtuning-appconfig.html" title="12.4. Configuration des applications" /><link rel="next" href="configtuning-cron.html" title="12.6. Configuration de l'utilitaire cron" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">12.5. Démarrer des services</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="configtuning-appconfig.html">Précédent</a> </td><th width="60%" align="center">Chapitre 12. Configuration et optimisation</th><td width="20%" align="right"> <a accesskey="n" href="configtuning-cron.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-starting-services"></a>12.5. Démarrer des services</h2></div><div><span class="authorgroup">Contribution de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp76532688" class="indexterm"></a><p>Nombreux sont les utilisateurs qui choisissent d'installer
      des logiciels tierce partie sous FreeBSD à partir du
      catalogue des logiciels portés.  Dans de nombreuses
      situations, il peut être nécessaire de configurer
      le logiciel de manière à ce qu'il soit
      lancé au démarrage du système.  Des
      services comme <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/mail/postfix/pkg-descr">mail/postfix</a>
      ou <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/apache13/pkg-descr">www/apache13</a> sont deux
      exemples de logiciels parmi tant d'autres qui peuvent être
      lancés à l'initialisation du système.
      Cette section explique les procédures disponibles pour
      démarrer certains logiciels tierce partie.</p><p>Sous FreeBSD, la plupart des services offerts, comme
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>, sont lancés par l'intermédiaire des
      procédures de démarrage du système.  Ces
      procédures peuvent varier en fonction de la version de
      FreeBSD, ou du fournisseur; cependant, l'aspect le plus important
      à considérer est que leur configuration de
      démarrage peut être gérée à
      l'aide de procédures de démarrage simples.</p><p>Avant l'avènement du système <code class="filename">rc.d</code>, les
      applications plaçaient une procédure simple de
      lancement dans le répertoire <code class="filename">/usr/local/etc/rc.d</code> qui était
      lue par les scripts d'initialisation du système.  Ces
      procédures étant alors exécutées
      lors des dernières étapes du démarrage du
      système.</p><p>Bien que de nombreuses personnes aient passé des
      heures à tenter de fusionner l'ancien mode de
      configuration avec le nouveau, il reste que certains utilitaires
      tierce partie ont toujours besoin d'un script placé dans
      le répertoire précédemment
      évoqué.  Les différences subtiles dans les
      scripts dépend de si le système <code class="filename">rc.d</code> est
      utilisé ou non.  Avant FreeBSD 5.1 l'ancien style de
      configuration était utilisé et dans presque tous
      les cas la nouvelle procédure fonctionnera sans
      problème.</p><p>Bien que chaque procédure doit remplir certains
      pré-requis minimum, la plupart du temps ils seront
      indépendants de la version de FreeBSD.  Chaque
      procédure doit avoir une extension
      <code class="filename">.sh</code> et doit être exécutable
      par le système.  Ce dernier point peut être
      réalisé en utilisant la commande
      <code class="command">chmod</code> et en fixant les permissions à
      <code class="literal">755</code>.  Il doit y avoir, au minimum, une option
      pour démarrer (<code class="literal">start</code>) l'application et
      une autre pour l'arrêter (<code class="literal">stop</code>).</p><p>La procédure de démarrage la plus simple
      ressemblera à celle-ci:</p><pre class="programlisting">#!/bin/sh
echo -n ' utility'

case "$1" in
start)
        /usr/local/bin/utility
        ;;
stop)
        kill -9 `cat /var/run/utility.pid`
        ;;
*)
        echo "Usage: `basename $0` {start|stop}" &gt;&amp;2
        exit 64
        ;;
esac

exit 0</pre><p>Cette procédure offre des options
      <code class="literal">stop</code> et <code class="literal">start</code> pour une
      application appelée ici <code class="literal">utility</code>.</p><p>L'application pourra être lancée manuellement
      avec:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/local/etc/rc.d/utility.sh start</code></strong></pre><p>Bien que toutes les applications tierce partie ne
      nécessitent pas de ligne dans le fichier
      <code class="filename">rc.conf</code>, chaque jour un nouveau logiciel
      porté sera modifié pour accepter cette
      configuration.  Contrôlez l'affichage final lors de
      l'installation de l'application pour plus d'information à
      ce sujet.  Certains logiciels fourniront des procédures
      qui permettrons à l'application d'être
      utilisée avec le système <code class="filename">rc.d</code>, cela sera
      abordé dans la section suivante.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76544720"></a>12.5.1. Configuration étendue des applications</h3></div></div></div><p>Maintenant que FreeBSD dispose du système <code class="filename">rc.d</code>, la
	configuration du démarrage des applications est plus
	simple, et propose plus de possibilités.
	En utilisant les mots clés présentés dans
	la section sur le système <a class="link" href="configtuning-rcd.html" title="12.7. Utilisation du système rc sous FreeBSD">rc.d</a>, les applications
	peuvent désormais être paramétrées
	pour démarrer après certains services, par
	exemple le <acronym class="acronym">DNS</acronym>, des paramètres
	supplémentaires peuvent être passés par
	l'intermédiaire de <code class="filename">rc.conf</code> au lieu
	d'utiliser des paramètres fixes dans les
	procédures de démarrage, etc.  Une
	procédure de base pourra ressembler à ce qui
	suit:</p><pre class="programlisting">#!/bin/sh
#
# PROVIDE: utility
# REQUIRE: DAEMON
# KEYWORD: shutdown

. /etc/rc.subr

name=utility
rcvar=utility_enable

command="/usr/local/sbin/utility"

load_rc_config $name

#
# DO NOT CHANGE THESE DEFAULT VALUES HERE
# SET THEM IN THE /etc/rc.conf FILE
#
utility_enable=${utility_enable-"NO"}
pidfile=${utility_pidfile-"/var/run/utility.pid"}

run_rc_command "$1"</pre><p>Cette procédure s'assurera que l'application
	<span class="application">utility</span> sera lancée après le
	le service
	<code class="literal">daemon</code>.  Elle fournie également une
	méthode de suivi du <acronym class="acronym">PID</acronym>, ou encore
	<acronym class="acronym">ID</acronym> (identifiant) de processus.</p><p>Cette application pourra alors avoir la ligne suivante la
	concernant dans le fichier
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">utility_enable="YES"</pre><p>Cette nouvelle méthode permet également une
	manipulation plus aisée des arguments en ligne de
	commande, l'inclusion des fonctions offertes par défaut
	dans <code class="filename">/etc/rc.subr</code>, offre une
	compatibilité avec l'utilitaire <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rcorder&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rcorder</span>(8)</span></a> et
	fournie une configuration plus aisée par
	l'intermédiaire du fichier
	<code class="filename">rc.conf</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76553040"></a>12.5.2. Utiliser des services pour démarrer d'autres
	services</h3></div></div></div><p>Certains services, comme les serveurs
	<acronym class="acronym">POP</acronym>3, <acronym class="acronym">IMAP</acronym>, etc.,
	peuvent être démarrés en utilisant
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>.  Cela implique d'installer le service à
	partir du catalogue des logiciels portés et avec une
	ligne de configuration ajoutée au fichier
	<code class="filename">/etc/inetd.conf</code>, ou en
	décommentant une des lignes de configuration
	déjà présentes.  L'utilisation
	d'<span class="application">inetd</span> et sa configuration sont
	décrits en profondeur dans la section concernant <a class="link" href="network-inetd.html" title="29.2. Le &#8220;super-serveur&#8221; inetd">inetd</a>.</p><p>Dans certains cas, il peut être plus
	approprié d'utiliser le <span class="quote">« <span class="quote">daemon</span> »</span>
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> pour démarrer des services.  Cette
	approche présente un certain nombre d'avantages parce
	que <code class="command">cron</code> exécute ces processus sous
	les privilèges du propriétaire de la table
	<code class="filename">crontab</code>.  Cela permet aux utilisateurs
	normaux de lancer et maintenir certaines applications.</p><p>L'utilitaire <code class="command">cron</code> offre une fonction
	unique, <code class="literal">@reboot</code>, qui peut être
	utilisée en remplacement de la date d'exécution.
	Cela provoquera l'exécution de la tâche quand
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> est lancé, normalement lors de
	l'initialisation du système.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="configtuning-appconfig.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="config-tuning.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="configtuning-cron.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">12.4. Configuration des applications </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 12.6. Configuration de l'utilitaire
      <code class="command">cron</code></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>