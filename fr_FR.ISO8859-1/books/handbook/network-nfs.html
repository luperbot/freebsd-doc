<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>29.3. Système de fichiers réseau (NFS)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="network-servers.html" title="Chapitre 29. Serveurs réseau" /><link rel="prev" href="network-inetd.html" title="29.2. Le &#8220;super-serveur&#8221; inetd" /><link rel="next" href="network-nis.html" title="29.4. Services d'information réseau (NIS/YP)" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.3. Système de fichiers réseau (NFS)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-inetd.html">Précédent</a> </td><th width="60%" align="center">Chapitre 29. Serveurs réseau</th><td width="20%" align="right"> <a accesskey="n" href="network-nis.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-nfs"></a>29.3. Système de fichiers réseau (NFS)</h2></div><div><span class="authorgroup">Réorganisé et augmenté par <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Ecrit par <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Bill</span> <span class="surname">Swingle</span></span>. </span></div></div></div><a id="idp84850768" class="indexterm"></a><p>Parmi les différents systèmes de fichiers que
      FreeBSD supporte se trouve le système de fichiers
      réseau, connu sous le nom de <acronym class="acronym">NFS</acronym>.
      <acronym class="acronym">NFS</acronym> permet à un système de
      partager des répertoires et des fichiers avec d'autres
      systèmes par l'intermédiaire d'un réseau.  En
      utilisant <acronym class="acronym">NFS</acronym>, les utilisateurs et les
      programmes peuvent accéder aux fichiers sur des
      systèmes distants comme s'ils étaient des fichiers
      locaux.</p><p>Certains des avantages les plus remarquables offerts par
      <acronym class="acronym">NFS</acronym> sont:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Les stations de travail utilisent moins d'espace disque
	  en local parce que les données utilisées en
	  commun peuvent être stockées sur une seule
	  machine tout en restant accessibles aux autres machines sur le
	  réseau.</p></li><li class="listitem"><p>Les utilisateurs n'ont pas besoin d'avoir un
	  répertoire personnel sur chaque machine du
	  réseau.  Les répertoires personnels pourront se
	  trouver sur le serveur <acronym class="acronym">NFS</acronym> et seront
	  disponibles par l'intermédiaire du
	  réseau.</p></li><li class="listitem"><p>Les périphériques de stockage comme les
	  lecteurs de disquettes, de CDROM, de disquettes <span class="trademark">Zip</span>® peuvent
	  être utilisés par d'autres machines sur le
	  réseau.  Cela pourra réduire le nombre de
	  lecteurs de medias amovibles sur le réseau.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84865616"></a>29.3.1. Comment <acronym class="acronym">NFS</acronym> fonctionne</h3></div></div></div><p><acronym class="acronym">NFS</acronym> consiste en deux
	éléments principaux: un serveur et un ou
	plusieurs clients.  Le client accède à distance
	aux données stockées sur la machine serveur.
	Afin que tout cela fonctionne correctement quelques processus
	doivent être configurés et en
	fonctionnement.</p><p>Sur le serveur, les &#8220;daemons&#8221; suivants
	doivent tourner:</p><a id="idp84867664" class="indexterm"></a><a id="idp84868816" class="indexterm"></a><a id="idp84869968" class="indexterm"></a><a id="idp84870864" class="indexterm"></a><a id="idp84871760" class="indexterm"></a><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Daemon</th><th>Description</th></tr></thead><tbody><tr><td><span class="application">nfsd</span></td><td>Le &#8220;daemon&#8221; <acronym class="acronym">NFS</acronym>
		qui répond aux requêtes des clients
		<acronym class="acronym">NFS</acronym>.</td></tr><tr><td><span class="application">mountd</span></td><td>Le &#8220;daemon&#8221; de montage
		<acronym class="acronym">NFS</acronym> qui traite les requêtes que
		lui passe <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=nfsd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">nfsd</span>(8)</span></a>.</td></tr><tr><td><span class="application">rpcbind</span></td><td>Ce <span class="quote">« <span class="quote">daemon</span> »</span> permet aux
		clients <acronym class="acronym">NFS</acronym> de trouver le port que
		le serveur <acronym class="acronym">NFS</acronym> utilise.</td></tr></tbody></table></div><p>Le client peut également faire tourner un
	&#8220;daemon&#8221; connu sous le nom de
	<span class="application">nfsiod</span>.  Le &#8220;daemon&#8221;
	<span class="application">nfsiod</span> traite les requêtes en
	provenance du serveur <acronym class="acronym">NFS</acronym>.  Ceci est
	optionnel, et améliore les performances, mais n'est pas
	indispensable pour une utilisation normale et correcte.
	Consultez la page de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=nfsiod&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">nfsiod</span>(8)</span></a> pour plus
	d'informations.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-configuring-nfs"></a>29.3.2. Configurer <acronym class="acronym">NFS</acronym></h3></div></div></div><a id="idp84891216" class="indexterm"></a><p>La configuration de <acronym class="acronym">NFS</acronym> est une
	opération relativement directe.  Les processus qui
	doivent tourner peuvent tous être lancés au
	démarrage en modifiant légèrement votre
	fichier <code class="filename">/etc/rc.conf</code>.</p><p>Sur le serveur <acronym class="acronym">NFS</acronym>, assurez-vous que
	les options suivantes sont configurées dans le fichier
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">rpcbind_enable="YES"
nfs_server_enable="YES"
mountd_flags="-r"</pre><p><span class="application">mountd</span> est automatiquement
	exécuté dès que le serveur
	<acronym class="acronym">NFS</acronym> est activé.</p><p>Sur le client, assurez-vous que cette option est
	présente dans le fichier
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">nfs_client_enable="YES"</pre><p>Le fichier <code class="filename">/etc/exports</code> indique quels
	systèmes de fichiers <acronym class="acronym">NFS</acronym> devraient
	être exportés (parfois on utilise le terme de
	&#8220;partagés&#8221;).  Chaque ligne dans
	<code class="filename">/etc/exports</code> précise un
	système de fichiers à exporter et quelles
	machines auront accès à ce système de
	fichiers.  En plus des machines qui auront accès, des
	options d'accès peuvent également être
	présentes.  Ces options sont nombreuses mais seules
	quelques unes seront abordées ici.  Vous pouvez
	aisément découvrir d'autres options en lisant la
	page de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exports&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">exports</span>(5)</span></a>.</p><p>Voici quelques exemples d'entrées du fichier
	<code class="filename">/etc/exports</code>:</p><a id="idp84900560" class="indexterm"></a><p>Les exemples suivants donnent une idée de comment
	exporter des systèmes de fichiers bien que certains
	paramètres peuvent être différents en
	fonction de votre environnement et votre configuration
	réseau.  Par exemple, pour exporter le
	répertoire <code class="filename">/cdrom</code>
	pour les trois machines d'exemple qui appartiennent au
	même domaine que le serveur (d'où l'absence du
	nom de domaine pour chacune d'entre elles) ou qui ont une
	entrée dans votre fichier
	<code class="filename">/etc/hosts</code>.  Le paramètre
	<code class="option">-ro</code> limite l'accès en lecture seule au
	système de fichiers exporté.  Avec ce
	paramètre, le système distant ne pourra pas
	écrire sur le système de fichiers
	exporté.</p><pre class="programlisting">/cdrom -ro host1 host2 host3</pre><p>La ligne suivante exporte <code class="filename">/home</code> pour les trois machines en
	utilisant les adresses IP.  C'est une configuration utile si
	vous disposez d'un réseau privé sans serveur
	<acronym class="acronym">DNS</acronym> configuré.  Le fichier
	<code class="filename">/etc/hosts</code> pourrait éventuellement
	être configuré pour les noms de machines
	internes, consultez la page de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts</span>(5)</span></a> pour plus
	d'information.  Le paramètre <code class="option">-alldirs</code>
	autorise l'utilisation des sous-répertoires en tant que
	point de montage.  En d'autres termes, il ne montera pas les
	sous-répertoires mais autorisera le client à ne
	monter que les répertoires qui sont nécessaires
	ou désirés.</p><pre class="programlisting">/home  -alldirs  10.0.0.2 10.0.0.3 10.0.0.4</pre><p>La ligne suivante exporte <code class="filename">/a</code> pour que deux clients d'un
	domaine différent puissent y accéder.  Le
	paramètre <code class="option">-maproot=root</code> autorise
	l'utilisateur <code class="systemitem">root</code> du système
	distant à écrire des données sur le
	système de fichiers exporté en tant que
	<code class="systemitem">root</code>.  Si le paramètre
	<code class="literal">-maproot=root</code> n'est pas
	précisé, même si un utilisateur dispose
	d'un accès <code class="systemitem">root</code> sur le
	système distant, il ne pourra pas modifier de fichiers
	sur le système de fichiers exporté.</p><pre class="programlisting">/a  -maproot=root  host.example.com box.example.org</pre><p>Afin de pouvoir accéder à un système
	de fichiers exporté, le client doit avoir les
	permissions de le faire.  Assurez-vous que le client est
	mentionné dans votre fichier
	<code class="filename">/etc/exports</code>.</p><p>Dans <code class="filename">/etc/exports</code>, chaque ligne
	représente l'information d'exportation d'un
	système de fichiers vers une machine.  Une machine
	distante ne peut être spécifiée qu'une
	fois par système de fichiers, et ne devrait avoir
	qu'une seule entrée par défaut.  Par exemple,
	supposons que <code class="filename">/usr</code> soit
	un seul système de fichiers.  Le fichier
	<code class="filename">/etc/exports</code> suivant serait
	invalide:</p><pre class="programlisting"># Invalide quand /usr est un système de fichiers
/usr/src   client
/usr/ports client</pre><p>Un système de fichiers,
	<code class="filename">/usr</code>, a deux lignes
	précisant des exportations vers la même machine,
	<code class="systemitem">client</code>.  Le format correct pour une telle
	situation est:</p><pre class="programlisting">/usr/src /usr/ports  client</pre><p>Les propriétés d'un système de fichiers
	exporté vers une machine donnée devraient
	apparaître sur une ligne.  Les lignes sans client sont
	traitées comme destinée à une seule
	machine.  Cela limite la manière dont vous pouvez
	exporter les systèmes de fichiers, mais pour la plupart
	des gens cela n'est pas un problème.</p><p>Ce qui suit est un exemple de liste d'exportation valide,
	où les répertoires <code class="filename">/usr</code> et <code class="filename">/exports</code> sont des systèmes
	de fichiers locaux:</p><pre class="programlisting"># Exporte src et ports vers client01 et client02, mais seul
# client01 dispose des privilèges root dessus
/usr/src /usr/ports -maproot=root    client01
/usr/src /usr/ports               client02
# Les machines clientes ont les privilèges root et peuvent monter tout
# de /exports.  N'importe qui peut monter en lecture seule
# /exports/obj
/exports -alldirs -maproot=root      client01 client02
/exports/obj -ro</pre><p>Le <span class="quote">« <span class="quote">daemon</span> »</span> <span class="application">mountd</span>
	doit être forcé de relire le fichier
	<code class="filename">/etc/exports</code> à chacune de ses
	modifications, afin que les changements puissent prendre effet.
	Cela peut être effectué soit en envoyant un signal
	HUP au <span class="quote">« <span class="quote">daemon</span> »</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP `cat /var/run/mountd.pid`</code></strong></pre><p>soit en invoquant la procédure <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> de
	<code class="command">mountd</code> avec le paramètre
	approprié:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/mountd onereload</code></strong></pre><p>Veuillez consulter la <a class="xref" href="configtuning-rcd.html" title="12.7. Utilisation du système rc sous FreeBSD">Section 12.7, « Utilisation du système rc sous FreeBSD »</a>
	pour plus d'information sur l'utilisation des procédures
	rc.</p><p>De plus, un redémarrage permettra à FreeBSD de
	tout configurer proprement.  Un redémarrage n'est
	cependant pas nécessaire.  Exécuter les
	commandes suivantes en tant que <code class="systemitem">root</code>
	devrait mettre en place ce qui est nécessaire.</p><p>Sur le serveur <acronym class="acronym">NFS</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rpcbind</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>nfsd -u -t -n 4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mountd -r</code></strong></pre><p>Sur le client <acronym class="acronym">NFS</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>nfsiod -n 4</code></strong></pre><p>Maintenant il devrait être possible de monter un
	système de fichiers distant.  Dans nos exemples le nom
	du serveur sera <code class="systemitem">serveur</code> et le nom du client
	<code class="systemitem">client</code>.  Si vous voulez monter temporairement
	un système de fichiers distant ou vous voulez
	simplement tester la configuration, exécutez juste une
	commande comme celle-ci en tant que <code class="systemitem">root</code>
	sur le client:</p><a id="idp84942544" class="indexterm"></a><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount serveur:/home /mnt</code></strong></pre><p>Cela montera le répertoire <code class="filename">/home</code> situé sur le serveur
	au point <code class="filename">/mnt</code> sur le
	client.  Si tout est correctement configuré vous
	devriez être en mesure d'entrer dans le
	répertoire <code class="filename">/mnt</code>
	sur le client et de voir tous les fichiers qui sont sur le
	serveur.</p><p>Si vous désirez monter automatiquement un
	système de fichiers distant à chaque
	démarrage de l'ordinateur, ajoutez le système de
	fichiers au fichier <code class="filename">/etc/fstab</code>.  Voici un
	exemple:</p><pre class="programlisting">server:/home	/mnt	nfs	rw	0	0</pre><p>La page de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> liste toutes les options
	disponibles.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84952784"></a>29.3.3. Verrouillage</h3></div></div></div><p>Certaines applications (par exemple
	<span class="application">mutt</span>) ont besoin du verrouillage
	des fichiers pour fonctionner correctement.  Dans le cas du
	<acronym class="acronym">NFS</acronym>, <span class="application">rpc.lockd</span>
	peut être utilisé pour assurer le verrouillage
	des fichiers.  Pour l'activer, ajouter ce qui suit au fichier
	<code class="filename">/etc/rc.conf</code> sur les machines clientes et
	serveur (on suppose que les clients et le serveur
	<acronym class="acronym">NFS</acronym> sont déjà
	configurés):</p><pre class="programlisting">rpc_lockd_enable="YES"
rpc_statd_enable="YES"</pre><p>Lancez l'application en utilisant:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/nfslocking start</code></strong></pre><p>Si un verrouillage réel n'est pas nécessaire
	entre les clients et le serveur <acronym class="acronym">NFS</acronym>, il est
	possible de laisser le client <acronym class="acronym">NFS</acronym> effectuer
	le verrouillage localement en passant l'option
	<code class="option">-L</code> à <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount_nfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount_nfs</span>(8)</span></a>.  Veuillez vous
	référer à la page de manuel
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount_nfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount_nfs</span>(8)</span></a> pour de plus amples détails.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84973008"></a>29.3.4. Exemples pratiques d'utilisation</h3></div></div></div><p>Il existe de nombreuses applications pratiques de
	<acronym class="acronym">NFS</acronym>.  Les plus communes sont
	présentés ci-dessous:</p><a id="idp84974416" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Configurer plusieurs machines pour partager un CDROM
	    ou un autre médium.  C'est moins cher et souvent une
	    méthode plus pratique pour installer des logiciels
	    sur de multiples machines.</p></li><li class="listitem"><p>Sur les réseaux importants, il peut être
	    plus pratique de configurer un serveur
	    <acronym class="acronym">NFS</acronym> central sur lequel tous les
	    répertoires utilisateurs sont stockés.  Ces
	    répertoires utilisateurs peuvent alors être
	    exportés vers le réseau, les utilisateurs
	    devraient alors toujours avoir le même
	    répertoire utilisateur indépendamment de la
	    station de travail sur laquelle ils ouvrent une
	    session.</p></li><li class="listitem"><p>Plusieurs machines pourront avoir un répertoire
	    <code class="filename">/usr/ports/distfiles</code>
	    commun.  De cette manière, quand vous avez besoin
	    d'installer un logiciel porté sur plusieurs machines,
	    vous pouvez accéder rapidement aux sources sans les
	    télécharger sur chaque machine.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-amd"></a>29.3.5. Montages automatiques avec
	<span class="application">amd</span></h3></div><div><span class="authorgroup">Contribution de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Wylie</span> <span class="surname">Stilwell</span></span>. </span></div><div><span class="authorgroup">Réécrit par <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div></div></div><a id="idp84983632" class="indexterm"></a><a id="idp84984144" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> (&#8220;automatic mounter
	daemon&#8221;&#8212;&#8220;daemon&#8221; de montage
	automatique) monte automatiquement un système de
	fichiers distant dès que l'on accède à un
	fichier ou un répertoire contenu par ce système
	de fichiers.  Les systèmes de fichiers qui sont
	inactifs pendant une certaine période seront
	automatiquement démontés par
	<span class="application">amd</span>.  L'utilisation
	d'<span class="application">amd</span> offre une alternative simple
	aux montages permanents qui sont généralement
	listés dans <code class="filename">/etc/fstab</code>.</p><p><span class="application">amd</span> opère en s'attachant
	comme un serveur NFS aux répertoires <code class="filename">/host</code> et <code class="filename">/net</code>.  Quand on accède
	à un fichier à l'intérieur de ces
	répertoires, <span class="application">amd</span> recherche
	le montage distant correspondant et le monte automatiquement.
	<code class="filename">/net</code> est utilisé
	pour monter un système de fichiers exporté
	à partir d'une adresse IP, alors que <code class="filename">/host</code> est utilisé pour
	monter un système de fichiers exporté à
	partir d'un nom de machine distant.</p><p>Un accès à un fichier dans <code class="filename">/host/foobar/usr</code> demandera
	à <span class="application">amd</span> de tenter de monter
	l'export <code class="filename">/usr</code> sur la
	machine <code class="systemitem">foobar</code>.</p><div class="example"><a id="idp84995664"></a><div class="example-title">Exemple 29.2. Monter un systèmes de fichiers exporté
	  avec <span class="application">amd</span></div><div class="example-contents"><p>Vous pouvez voir les systèmes de fichiers
	  exportés par une machine distante avec la commande
	  <code class="command">showmount</code>.  Par exemple, pour voir les
	  répertoires exportés par une machine
	  appelée <code class="systemitem">foobar</code>, vous pouvez
	  utiliser:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>showmount -e foobar</code></strong>
Exports list on foobar:
/usr                               10.10.10.0
/a                                 10.10.10.0
<code class="prompt">%</code> <strong class="userinput"><code>cd /host/foobar/usr</code></strong></pre></div></div><br class="example-break" /><p>Comme on le voit dans l'exemple,
	<code class="command">showmount</code> liste <code class="filename">/usr</code> comme une exportation.  Quand
	on change de répertoire pour
	<code class="filename">/host/foobar/usr</code>,
	<span class="application">amd</span> tente de résoudre le nom
	de machine <code class="systemitem">foobar</code> et de monter
	automatiquement le système exporté
	désiré.</p><p><span class="application">amd</span> peut être
	lancé par les procédures de démarrage en
	ajoutant les lignes suivantes dans le fichier
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">amd_enable="YES"</pre><p>De plus, des paramètres peuvent être
	passés à <span class="application">amd</span> à
	l'aide de l'option <code class="literal">amd_flags</code>.  Par
	défaut, l'option <code class="varname">amd_flags</code> est
	possitionnée à:</p><pre class="programlisting">amd_flags="-a /.amd_mnt -l syslog /host /etc/amd.map /net /etc/amd.map"</pre><p>Le fichier <code class="filename">/etc/amd.map</code>
	définit les options par défaut avec lesquelles
	les systèmes exportés sont montés.  Le
	fichier <code class="filename">/etc/amd.conf</code> définit
	certaines des fonctionnalités les plus avancées
	de <span class="application">amd</span>.</p><p>Consultez les pages de manuel de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> et
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">amd.conf</span>(5)</span></a> pour plus d'informations.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-nfs-integration"></a>29.3.6. Problèmes d'intégration avec d'autres
	systèmes</h3></div><div><span class="authorgroup">Contribution de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">John</span> <span class="surname">Lind</span></span>. </span></div></div></div><p>Certaines cartes Ethernet ISA présentent des
	limitations qui peuvent poser de sérieux
	problèmes sur un réseau, en particulier avec
	NFS.  Ce n'est pas une particularité de FreeBSD, mais FreeBSD
	en est également affecté.</p><p>Ce problème se produit pratiquement à chaque
	fois que des systèmes (FreeBSD) PC sont sur le même
	réseau que des stations de travail très
	performantes, comme celles de Silicon Graphics, Inc. et Sun
	Microsystems, Inc.  Les montages NFS se feront sans
	difficulté, et certaines opérations pourront
	réussir, puis soudain le serveur semblera ne plus
	répondre au client, bien que les requêtes vers ou
	en provenance d'autres systèmes continueront à
	être traitées normalement.  Cela se manifeste
	sur la machine cliente, que ce soit le système FreeBSD ou
	la station de travail.  Sur de nombreux systèmes, il
	n'est pas possible d'arrêter le client proprement une
	fois que ce problème apparaît.  La seule solution
	est souvent de réinitialiser le client parce que le
	problème NFS ne peut être résolu.</p><p>Bien que la solution &#8220;correcte&#8221; est
	d'installer une carte Ethernet plus performante et de plus
	grande capacité sur le système FreeBSD, il existe
	une solution simple qui donnera satisfaction.  Si le
	système FreeBSD est le <span class="emphasis"><em>serveur</em></span>,
	ajoutez l'option <code class="option">-w=1024</code> lors du montage sur
	le client.  Si le système FreeBSD est le
	<span class="emphasis"><em>client</em></span>, alors montez le système de
	fichiers NFS avec l'option <code class="option">-r=1024</code>.  Ces
	options peuvent être spécifiées dans le
	quatrième champ de l'entrée
	<code class="filename">fstab</code> sur le client pour les montages
	automatiques, ou en utilisant le paramètre
	<code class="option">-o</code> de la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> pour les
	montages manuels.</p><p>Il faut noter qu'il existe un problème
	différent, que l'on confond parfois avec le
	précédent, qui peut se produire lorsque les
	serveurs et les clients NFS sont sur des réseaux
	différents.  Si c'est le cas,
	<span class="emphasis"><em>assurez-vous</em></span> que vos routeurs
	transmettent bien les informations UDP nécessaires, ou
	vous n'irez nulle part, quoi que vous fassiez par
	ailleurs.</p><p>Dans les exemples suivants, <code class="systemitem">fastws</code> est le
	nom de la station de travail (interface) performante, et
	<code class="systemitem">freebox</code> celui d'une machine (interface) FreeBSD
	avec une carte Ethernet moins performante.  <code class="filename">/sharedfs</code> est le système de
	fichiers NFS qui sera exporté (consulter la page de
	manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exports&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">exports</span>(5)</span></a>), et <code class="filename">/project</code> sera le point de montage
	sur le client pour le système de fichiers
	exporté.  Dans tous les cas, des options
	supplémentaires, telles que <code class="option">hard</code>
	<code class="option">soft</code> et <code class="option">bg</code> seront
	peut-être nécessaires pour vos
	applications.</p><p>Exemple d'extrait du fichier
	<code class="filename">/etc/fstab</code> sur <code class="systemitem">freebox</code>
	quand le système FreeBSD (<code class="systemitem">freebox</code>) est le
	client:</p><pre class="programlisting">fastws:/sharedfs /project nfs rw,-r=1024 0 0</pre><p>Commande de montage manuelle sur
	<code class="systemitem">freebox</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -t nfs -o -r=1024 fastws:/sharedfs /project</code></strong></pre><p>Exemple d'extrait du fichier
	<code class="filename">/etc/fstab</code> sur <code class="systemitem">fastws</code>
	quand le système FreeBSD est le serveur:</p><pre class="programlisting">freebox:/sharedfs /project nfs rw,-w=1024 0 0</pre><p>Commande de montage manuelle sur
	<code class="systemitem">fastws</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -t nfs -o -w=1024 freebox:/sharedfs /project</code></strong></pre><p>Presque n'importe quelle carte Ethernet 16 bits
	permettra d'opérer sans l'utilisation des
	paramètres restrictifs précédents sur les
	tailles des tampons de lecture et d'écriture.</p><p>Pour ceux que cela intéresse, voici ce qui se passe
	quand le problème survient, ce qui explique
	également pourquoi ce n'est pas
	récupérable.  NFS travaille
	généralement avec une taille de
	&#8220;bloc&#8221; de 8 k (bien qu'il arrive qu'il les
	fragmente en de plus petits morceaux).  Comme la taille
	maximale d'un paquet Ethernet est de 1500 octets, le
	&#8220;bloc&#8221; NFS est divisé en plusieurs paquets
	Ethernet, bien qu'il soit toujours vu comme quelque chose
	d'unitaire par les couches supérieures du code, et doit
	être réceptionné, assemblé, et
	<span class="emphasis"><em>acquitté</em></span> comme tel.  Les stations
	de travail performantes peuvent traiter les paquets qui
	composent le bloc NFS les uns après les autres,
	pratiquement aussi rapidement que le standard le permet.  Sur
	les cartes les plus petites, de moindre capacité, les
	derniers paquets d'un même bloc écrasent les
	paquets précédents avant qu'ils aient pu
	être transmis à la machine et le bloc ne peut
	être réassemblé ou acquitté.  Avec
	pour conséquence, le dépassement du délai
	d'attente sur la station de travail qui recommence alors la
	transmission, mais en renvoyant l'intégralité
	des 8 K, et ce processus se répète à
	l'infini.</p><p>En définissant la taille de bloc inférieure
	à la taille d'un paquet Ethernet, nous nous assurons
	que chaque paquet Ethernet complet sera acquitté
	individuellement, évitant ainsi la situation de
	blocage.</p><p>Des écrasements peuvent toujours survenir quand des
	stations de travail performantes surchargent un système
	PC de données, mais avec de meilleures cartes, de tels
	écrasements ne sont pas systématiques pour les
	&#8220;blocs&#8221; NFS.  Quand un écrasement
	apparaît, les blocs affectés sont retransmis, et
	ils y a de fortes chances pour qu'ils soient reçus,
	assemblés et acquittés.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-inetd.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="network-servers.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="network-nis.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">29.2. Le &#8220;super-serveur&#8221;
      <span class="application">inetd</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 29.4. Services d'information réseau (NIS/YP)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>