<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>A.6. Utiliser Portsnap</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="mirrors.html" title="Annexe A. Se procurer FreeBSD" /><link rel="prev" href="cvsup.html" title="A.5. Utiliser CVSup" /><link rel="next" href="cvs-tags.html" title="A.7. Etiquettes CVS" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">A.6. Utiliser Portsnap</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="cvsup.html">Précédent</a> </td><th width="60%" align="center">Annexe A. Se procurer FreeBSD</th><td width="20%" align="right"> <a accesskey="n" href="cvs-tags.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="portsnap"></a>A.6. Utiliser Portsnap</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="portsnap-intro"></a>A.6.1. Introduction</h3></div></div></div><p><span class="application">Portsnap</span> est un système
	de distribution sécurisée du catalogue des
	logiciels portés de FreeBSD.  Approximativement chaque
	heure, un <span class="quote">« <span class="quote">instantané</span> »</span> du catalogue des
	logiciels portés est généré,
	rassemblé et signé de manière
	chiffrée.  Les fichiers résultants sont alors
	distribués par l'intermédiaire du protocole
	HTTP.</p><p>Tout comme <span class="application">CVSup</span>,
	<span class="application">Portsnap</span> utilise un modèle
	de mise à jour de type <span class="emphasis"><em>pull</em></span>: le
	catalogue des logiciels portés packagé et
	signé est placé sur un serveur Web qui attend
	les requêtes des clients.  Les utilisateurs doivent soit
	exécuter manuellement <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=portsnap&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">portsnap</span>(8)</span></a> pour
	télécharger les mises à jour, soit
	configurer <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> pour un téléchargement
	régulier et automatique des mises à jour.</p><p>Pour des raisons techniques,
	<span class="application">Portsnap</span> ne met pas à jour
	le catalogue des logiciels portés directement dans le
	répertoire <code class="filename">/usr/ports</code>; le logiciel travaille
	plutôt par défaut sur une version
	compressée de l'arborescence des logiciels
	portés dans le répertoire <code class="filename">/var/db/portsnap</code>.  Cette copie
	compressée est ensuite utilisée pour mettre
	à jour le catalogue des logiciels portés.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si <span class="application">Portsnap</span> est
	  installé à partir du catalogue des logiciels
	  portés de FreeBSD, alors l'emplacement par défaut
	  pour son instantané compressé sera <code class="filename">/usr/local/portsnap</code> au lieu de
	  <code class="filename">/var/db/portsnap</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="portsnap-install"></a>A.6.2. Installation</h3></div></div></div><p>Sous FreeBSD 6.0 et les versions plus récentes,
	<span class="application">Portsnap</span> fait partie du
	système de base de FreeBSD.  Sous des versions plus
	anciennes de FreeBSD, il peut être installé à
	partir du logiciel porté <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portsnap/pkg-descr">ports-mgmt/portsnap</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="portsnap-config"></a>A.6.3. Configuration de Portsnap</h3></div></div></div><p>L'exécution de <span class="application">Portsnap</span>
	est contrôlée par le fichier de configuration
	<code class="filename">/etc/portsnap.conf</code>.  Pour la plupart des
	utilisateurs, le fichier de configuration par défaut
	sera suffisant; pour plus de détails, consultez la page
	de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=portsnap.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">portsnap.conf</span>(5)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si <span class="application">Portsnap</span> est
	  installé à partir du catalogue des logiciels
	  portés, il utilisera
	  <code class="filename">/usr/local/etc/portsnap.conf</code> comme
	  fichier de configuration au lieu de
	  <code class="filename">/etc/portsnap.conf</code>.  Ce fichier n'est pas
	  créé lors de l'installation du logiciel, mais un
	  fichier d'exemple est fourni; pour le copier à son
	  emplacement correct, utilisez la commande suivante:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/local/etc &amp;&amp; cp portsnap.conf.sample portsnap.conf</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88912720"></a>A.6.4. Exécuter <span class="application">Portsnap</span> pour la
	première fois</h3></div></div></div><p>Au premier lancement de la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=portsnap&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">portsnap</span>(8)</span></a>, il
	sera nécessaire de télécharger un
	instantané compressé de
	l'intégralité de l'arborescence des logiciels
	portés dans <code class="filename">/var/db/portsnap</code> (ou <code class="filename">/usr/local/portsnap</code> si
	<span class="application">Portsnap</span> a été
	installé à partir du catalogue des logiciels
	portés).  Au début de l'année 2006, cela
	représentait un téléchargement d'environ
	41 Mo.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch</code></strong></pre><p>Une fois que l'instantané compressé a
	été récupéré, une copie
	utilisable de l'arborescence des logiciels portés peut
	être extraite dans le répertoire <code class="filename">/usr/ports</code>.  Cela est
	nécessaire même si une arborescence a
	déjà été créée dans
	ce répertoire (par exemple en utilisant
	<span class="application">CVSup</span>), puisque cela met en place
	une version de référence à partir de
	laquelle <code class="command">portsnap</code> peut déterminer
	plus tard quelles parties du catalogue des logiciels
	portés a besoin d'une mise à jour.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap extract</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Dans l'installation par défaut de FreeBSD <code class="filename">/usr/ports</code> n'est pas
	  créé.  Si vous utilisez FreeBSD 6.0-RELEASE,
	  ce répertoire doit être créé avant
	  d'utiliser la commande <code class="command">portsnap</code>.  Sur les
	  versions de FreeBSD plus récentes ou de
	  <span class="application">Portsnap</span>, cette
	  création est effectuée automatiquement à
	  la premiere utilisation de la commande
	  <code class="command">portsnap</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88922064"></a>A.6.5. Mettre à jour l'arborescence des logiciels
	portés</h3></div></div></div><p>Après qu'un instantané initial du catalogue
	des logiciels portés ait été
	récupéré puis décompressé
	dans le répertoire <code class="filename">/usr/ports</code>, la mise à jour
	du catalogue se divise en deux étapes: la
	récupération (<span class="emphasis"><em>fetch</em></span>) des
	mises à jour de l'instantané, et leur
	utilisation pour mettre à jour
	(<span class="emphasis"><em>update</em></span>) le catalogue des logiciels
	portés en tant que tel.  Ces deux étapes peuvent
	être effectuées par l'intermédiaire d'une
	seule commande <code class="command">portsnap</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch update</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Des versions anciennes de <code class="command">portsnap</code> ne
	  supporte pas cette syntaxe; en cas d'échec, utilisez
	  à la place ceci:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>portsnap update</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88949072"></a>A.6.6. Exécuter Portsnap à partir de cron</h3></div></div></div><p>Afin d'éviter tout problème
	<span class="quote">« <span class="quote">d'embouteillage</span> »</span> lors de l'accès aux
	serveurs <span class="application">Portsnap</span>,
	<code class="command">portsnap fetch</code> ne fonctionnera pas à
	partir d'une tâche <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>.  Il existe, à la
	place, une commande <code class="command">portsnap cron</code>
	spécifique, qui patiente durant un délai
	aléatoire pouvant aller jusqu'à 3600 secondes
	avant de récupérer les mises à
	jour.</p><p>De plus, il est fortement recommandé de ne pas
	exécuter <code class="command">portsnap update</code> à
	partir d'une tâche <code class="command">cron</code>, puisque cela
	peut être à l'origine de graves problèmes
	si la commande a lieu au même moment qu'un logiciel
	porté est en train d'être compilé ou
	installé.  Cependant, les fichiers
	<code class="filename">INDEX</code> peuvent être mis à
	jour sans risque, et cela peut être fait en passant
	l'indicateur <code class="option">-I</code> à la commande
	<code class="command">portsnap</code> (bien entendu si <code class="command">portsnap
	-I update</code> est exécuté à par
	<code class="command">cron</code>, il sera alors nécessaire de
	lancer <code class="command">portsnap update</code> sans l'option
	<code class="option">-I</code> ultérieurement pour mettre à
	jour le reste de l'arborescence).</p><p>L'ajout de la ligne suivante dans le fichier
	<code class="filename">/etc/crontab</code> demandera à
	<code class="command">portsnap</code> de mettre à jour son
	instantané compressé et les fichiers
	<code class="filename">INDEX</code> du répertoire <code class="filename">/usr/ports</code>, et enverra un courrier
	électronique si un logiciel porté
	installé n'est pas à jour:</p><pre class="programlisting">0 3 * * * root portsnap -I cron update &amp;&amp; pkg_version -vIL=</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si l'horloge système n'est pas positionnée
	  sur le fuseau horaire local, remplacez <code class="literal">3</code>
	  par une valeur quelconque comprise entre 0 et 23, afin de
	  répartir de manière plus
	  équilibrée la charge sur les serveurs
	  <span class="application">Portsnap</span>.</p></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Des versions anciennes de <code class="command">portsnap</code> ne
	  supportent pas l'utilisation de commandes multiples (par
	  exemple <code class="literal">cron update</code>) lors de la même
	  invocation de <code class="command">portsnap</code>.  Si la ligne
	  précédente échoue, essayez de remplacer
	  <code class="command">portsnap -I cron update</code> par
	  <code class="command">portsnap cron &amp;&amp; portsnap -I
	  update</code>.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="cvsup.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="mirrors.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="cvs-tags.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">A.5. Utiliser CVSup </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> A.7. Etiquettes CVS</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>