<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>16.4. Création et contrôle de l'environnement jail</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="jails.html" title="Chapitre 16. Environnements jail" /><link rel="prev" href="jails-intro.html" title="16.3. Introduction" /><link rel="next" href="jails-tuning.html" title="16.5. Optimisation et administration" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">16.4. Création et contrôle de l'environnement
      jail</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="jails-intro.html">Précédent</a> </td><th width="60%" align="center">Chapitre 16. Environnements jail</th><td width="20%" align="right"> <a accesskey="n" href="jails-tuning.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-build"></a>16.4. Création et contrôle de l'environnement
      jail</h2></div></div></div><p>Certains administrateurs divisent les environnements jail en
      deux catégories: les environnements jails
      <span class="quote">« <span class="quote">complets</span> »</span>, qui ressemblent à un
      véritable système FreeBSD, et les environnements
      jails de <span class="quote">« <span class="quote">service</span> »</span>, qui sont dédiés
      à une application ou un seul service, et tournant
      éventuellement avec des privilèges.  Cette
      séparation est juste conceptuelle et n'affecte pas la
      création de l'environnement jail.  La page de manuel
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> est très claire quant à la
      procédure de création d'un environnement
      jail:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setenv D /here/is/the/jail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p $D</code></strong> <a id="jailpath"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make world DESTDIR=$D</code></strong> <a id="jailworld"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd etc/</code></strong> <a href="#ftn.idp79342160" class="footnote" id="idp79342160"><sup class="footnote">[9]</sup></a>
<code class="prompt">#</code> <strong class="userinput"><code>make distribution DESTDIR=$D</code></strong> <a id="jaildistrib"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>mount_devfs devfs $D/dev</code></strong> <a id="jaildevfs"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#jailpath"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Sélectionner un emplacement pour l'environnement
	  est le meilleur point de départ.  C'est l'endroit
	  où l'environnement jail se trouvera dans le
	  système de fichiers de la machine hôte.  Un bon
	  choix peut être <code class="filename">/usr/jail/jailname</code>,
	  où <em class="replaceable"><code>jailname</code></em> est le nom de
	  machine identifiant l'environnement jail.  Le système
	  de fichiers <code class="filename">/usr/</code>
	  dispose généralement de suffisamment d'espace
	  pour le système de fichiers de l'environnement jail,
	  qui est pour les environnements <span class="quote">« <span class="quote">complets</span> »</span>,
	  essentiellement, une copie de chaque fichier présent
	  dans une installation par défaut du système de
	  base de FreeBSD.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jailworld"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Cette commande peuplera l'arborescence du
	  répertoire choisi comme emplacement pour
	  l'environnement jail avec les binaires, les
	  bibliothèques, les pages de manuel, etc.
	  nécessaires.  Tout sera fait selon le style FreeBSD
	  habituel &#8212; en premier lieu tout est compilé, puis
	  ensuite installé à l'emplacement voulu.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildistrib"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>La cible <code class="buildtarget">distribution</code> pour
	  <span class="application">make</span> installe tous les fichiers de
	  configuration nécessaires.  Ou pour faire simple, cette
	  commande installe tous les fichiers installables du
	  répertoire <code class="filename">/usr/src/etc/</code> vers le
	  répertoire <code class="filename">/etc</code>
	  de l'environnement jail: <code class="filename">$D/etc/</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildevfs"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Le montage du système de fichiers <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a>
	  à l'intérieur d'un environnement jail n'est pas
	  requis.  Cependant, toutes, ou presque toutes les applications
	  nécessitent l'accès à au moins un
	  périphérique, en fonction du rôle de
	  l'application.  Il est vraiment important de contrôler
	  l'accès aux périphériques depuis
	  l'intérieur d'un environnement jail, comme un mauvais
	  paramétrage pourrait permettre à quelqu'un de
	  malintentionné de faire de <span class="quote">« <span class="quote">mauvaises</span> »</span>
	  choses dans l'environnement jail.  Le contrôle sur
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> est géré par
	  l'intermédiaire d'un ensemble de règles qui est
	  décrit dans les pages de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> et
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs.conf</span>(5)</span></a>.</p></td></tr></table></div><p>Une fois l'environnement jail installé, il peut
      être lancé en employant l'utilitaire <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>.
      Cet outil requiert obligatoirement quatre arguments qui sont
      décrits dans la <a class="xref" href="jails-intro.html#jails-what" title="16.3.1. Qu'est-ce qu'un environnement jail?">Section 16.3.1, « Qu'est-ce qu'un environnement jail? »</a>.  D'autres
      arguments peuvent également être utilisés,
      pour par exemple exécuter le processus avec les droits
      d'un utilisateur particulier.  L'argument
      <code class="option"><em class="replaceable"><code>command</code></em></code>
      dépend du type d'environnement; pour un
      <span class="emphasis"><em>système virtuel</em></span>,
      <code class="filename">/etc/rc</code> est un bon choix puisque la
      séquence de démarrage d'un véritable
      système FreeBSD sera dupliquée.  Pour un
      environnement jail de type <span class="emphasis"><em>service</em></span>, cela
      dépendra du service ou de l'application qui sera
      exécuté dans l'environnement jail.</p><p>Les environnements jails sont souvent lancés au
      démarrage de la machine et le système
      <code class="filename">rc</code> de FreeBSD propose une méthode
      simple pour cela.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Une liste des environnements jail autorisés
	  à être lancés au démarrage du
	  système devrait être ajoutée au fichier
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>:</p><pre class="programlisting">jail_enable="YES"   # Utiliser NO pour désactiver le lancement des environnements jail
jail_list="<em class="replaceable"><code>www</code></em>"     # Liste des noms des environnements jail séparés par une espace</pre></li><li class="step"><p>Pour chaque environnement listé dans
	  <code class="varname">jail_list</code>, un ensemble de
	  paramètres <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>, qui décrivent
	  l'environnement jail, devrait être
	  ajouté:</p><pre class="programlisting">jail_<em class="replaceable"><code>www</code></em>_rootdir="/usr/jail/www"     # le répertoire racine de l'environnement jail
jail_<em class="replaceable"><code>www</code></em>_hostname="<em class="replaceable"><code>www</code></em>.example.org"  # le nom de machine de l'environnement jail
jail_<em class="replaceable"><code>www</code></em>_ip="192.168.0.10"           # son adresse IP
jail_<em class="replaceable"><code>www</code></em>_devfs_enable="YES"          # monter devfs dans l'environnement jail
jail_<em class="replaceable"><code>www</code></em>_devfs_ruleset="<em class="replaceable"><code>www_ruleset</code></em>" # les règles devfs à appliquer à l'environnement jail</pre><p>Le démarrage par défaut des environnements
	  jails, configuré dans <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>,
	  exécutera la procédure
	  <code class="filename">/etc/rc</code> de l'environnement jail, ce qui
	  suppose que l'environnement est un système virtuel
	  complet.  Pour les environnements jail de service, la
	  commande de démarrage par défaut de
	  l'environnement devrait être modifiée en
	  configurant correctement l'option
	  <code class="varname">jail_<em class="replaceable"><code>jailname</code></em>_exec_start</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Pour une liste complète des options
	    disponibles, veuillez consulter la page de manuel
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>.</p></div></li></ol></div><p>La procedure <code class="filename">/etc/rc.d/jail</code> peut
      être utilisée pour démarrer ou arrêter
      un environnement jail à la main si une entrée pour
      l'environnement existe dans le fichier
      <code class="filename">rc.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/jail start www</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/jail stop www</code></strong></pre><p>Il n'existe pas pour le moment de méthode propre pour
      arrêter un environnement <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>.  C'est dû au
      fait que les commandes normalement employées pour
      arrêter proprement un système ne peuvent être
      utilisées à l'intérieur d'un environnement
      jail.  La meilleur façon d'arrêter un environnement
      jail est de lancer la commande suivante à
      l'intérieur de l'environnement ou en utilisant le
      programme <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a> depuis l'extérieur de
      l'environnement:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh /etc/rc.shutdown</code></strong></pre><p>Plus d'information à ce sujet peut être
      trouvé dans la page de manuel de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>.</p><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp79342160" class="footnote"><p><a href="#idp79342160" class="para"><sup class="para">[9] </sup></a>Cette
étape n'est pas requise sous FreeBSD 6.0 et versions ultérieures.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jails-intro.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="jails.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="jails-tuning.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">16.3. Introduction </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 16.5. Optimisation et administration</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>