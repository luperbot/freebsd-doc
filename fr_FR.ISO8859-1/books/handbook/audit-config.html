<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>18.3. Configuration de l'audit</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="audit.html" title="Chapitre 18. Audit des événements relatifs à la sécurité du système" /><link rel="prev" href="audit-inline-glossary.html" title="18.2. Mots-clés" /><link rel="next" href="audit-administration.html" title="18.4. Travailler avec les traces d'audit" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">18.3. Configuration de l'audit</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="audit-inline-glossary.html">Précédent</a> </td><th width="60%" align="center">Chapitre 18. Audit des événements relatifs à la
    sécurité du système</th><td width="20%" align="right"> <a accesskey="n" href="audit-administration.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="audit-config"></a>18.3. Configuration de l'audit</h2></div></div></div><p>Le support pour l'audit des événements est installé avec le
      système de base de FreeBSD. Le support présent dans le noyau
      <code class="filename">GENERIC</code> par défaut, et <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a> peut
      être activé en ajoutant la ligne suivante au fichier
      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">auditd_enable="YES"</pre><p>Puis, le daemon d'audit peut être lancé:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service auditd start</code></strong></pre><p>Les utilisateurs préférant compiler un noyau sur mesure
      doivent ajouter la ligne suivante dans le fichier de
      configuration du noyau:</p><pre class="programlisting">options     AUDIT</pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79511888"></a>18.3.1. Expressions de sélection des
	événements</h3></div></div></div><p>Les expressions de sélection sont utilisées
	à plusieurs endroits dans la configuration du
	système d'audit pour déterminer quels
	événements doivent être suivis.  Les
	expressions contiennent une liste de classes
	d'événements devant correspondre.
	Les expressions de sélection sont
	évaluées de gauche à droite, et deux
	expressions sont combinées en ajoutant l'une à
	la suite de l'autre.</p><p><a class="xref" href="audit-config.html#event-selection" title="Tableau 18.1. Classes d'événements par défaut">Tableau 18.1, « Classes d'événements par défaut »</a> résume les classes
	d'événements présentes par défaut</p><div class="table"><a id="event-selection"></a><div class="table-title">Tableau 18.1. Classes d'événements par défaut</div><div class="table-contents"><table summary="Classes d'événements par défaut" width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Classe</th><th>Description</th><th>Action</th></tr></thead><tbody><tr><td>all</td><td>tout</td><td>correspond à toutes les classes
		d'événements.</td></tr><tr><td>aa</td><td>authentification et autorisation</td><td> </td></tr><tr><td>ad</td><td>administration</td><td>Actions d'administration du système.</td></tr><tr><td>ap</td><td>application</td><td>Action définie par l'application.</td></tr><tr><td>cl</td><td>fermeture de fichiers</td><td>Enregistre les utilisations de l'appel système
		<code class="function">close</code>.</td></tr><tr><td>ex</td><td>exécution</td><td>Enregistre les exécutions de programmes.  L'audit
		des arguments en ligne de commande et des variables
		d'environnement est contrôlé par via
		<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=audit_control&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">audit_control</span>(5)</span></a> en utilisant les paramètres
		<code class="literal">argv</code> et <code class="literal">envv</code>
		pour l'entrée <code class="literal">policy</code>.</td></tr><tr><td>fa</td><td>accès à aux attributs des fichiers</td><td>enregistre l'accès aux attributs des objets comme
		<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=stat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">stat</span>(1)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pathconf&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">pathconf</span>(2)</span></a>.</td></tr><tr><td>fc</td><td>création de fichiers</td><td>Enregistre les événements ayant pour résultat la
		création d'un fichier.</td></tr><tr><td>fd</td><td>suppression de fichiers</td><td>Enregistre les événements pour lesquels une
		suppression de fichier a lieu.</td></tr><tr><td>fm</td><td>modification des attributs d'un fichier</td><td>Enregistre les événements lors desquels une
		modification des attributs d'un fichier intervient,
		comme l'utilisation de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chown&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">chown</span>(8)</span></a>,
		<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a>, et <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=flock&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">flock</span>(2)</span></a>.</td></tr><tr><td>fr</td><td>lecture de fichiers</td><td>Enregistre les événements qui donnent lieu
		à la lecture de données, l'ouverture de
		fichiers pour la lecture.</td></tr><tr><td>fw</td><td>écriture de fichiers</td><td>Enregistre les événements qui donnent lieu
		à l'écriture de données ou à l'écriture ou
		la modification de fichiers.</td></tr><tr><td>io</td><td>ioctl</td><td>Enregistre l'utilisation de l'appel système
		<code class="function">ioctl</code>.</td></tr><tr><td>ip</td><td>ipc</td><td>Enregistre les différentes utilisations de
		communication inter-processus, dont les utilisations
		des tubes POSIX et les opérations
		<acronym class="acronym">IPC</acronym> Système V.</td></tr><tr><td>lo</td><td>login_logout</td><td>Enregistre les ouvertures et fermeture de session
		(<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">login</span>(1)</span></a> et <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=logout&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">logout</span>(1)</span></a>).</td></tr><tr><td>na</td><td>non attributable</td><td>Enregistre les événements non-attribuables.</td></tr><tr><td>no</td><td>classe invalide</td><td>Ne correspond à aucun des événements
		surveillés.</td></tr><tr><td>nt</td><td>réseau</td><td>Enregistre les événements relatifs au réseau,
		comme l'utilisation des fonctions <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=connect&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">connect</span>(2)</span></a> et
		<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=accept&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">accept</span>(2)</span></a>.</td></tr><tr><td>ot</td><td>autre</td><td>Enregistre les événements divers.</td></tr><tr><td>pc</td><td>processus</td><td>Enregistre les opérations sur les processus,
		comme l'utilisation des fonctions <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exec&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">exec</span>(3)</span></a> et
		<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exit&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">exit</span>(3)</span></a>.</td></tr></tbody></table></div></div><br class="table-break" /><p>Ces classes d'événement peuvent être
	personnalisées en modifiant les fichiers de
	configuration <code class="filename">audit_class</code> et
	<code class="filename">audit_event</code>.</p><p>Chaque classe d'audit peut être combinée
	avec un préfixe indiquant si les opérations
	réussies/échouées sont
	sélectionnées, et si l'entrée ajoute ou
	supprime une sélection pour la classe ou le type
	concerné.  <a class="xref" href="audit-config.html#event-prefixes" title="Tableau 18.2. Prefixes pour les classes d'audit">Tableau 18.2, « Prefixes pour les classes d'audit »</a> résume les
	préfixes disponibles.</p><div class="table"><a id="event-prefixes"></a><div class="table-title">Tableau 18.2. Prefixes pour les classes d'audit</div><div class="table-contents"><table summary="Prefixes pour les classes d'audit" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Prefixe</th><th>Action</th></tr></thead><tbody><tr><td>+</td><td>Enregistre les événements réussis de cette
		classe.</td></tr><tr><td>-</td><td>Enregistre les événements de cette classe qui ont
		échoué.</td></tr><tr><td>^</td><td>N'enregistre ni les événements réussis ni les
		échecs de cette classe.</td></tr><tr><td>^+</td><td>Ne pas enregistrer les événements réussis de
		cette classe.</td></tr><tr><td>^-</td><td>Ne pas enregistrer les événements de cette classe
		qui ont échoué.</td></tr></tbody></table></div></div><br class="table-break" /><p>Si aucun préfixe n'est présent, les succès et le échecs de
	l'événement seront enregistrés.</p><p>L'exemple suivant d'expression de sélection permet
	la sélection des ouvertures et fermetures de session
	réussies ou échouées, et uniquement les
	exécutions ayant réussies:</p><pre class="programlisting">lo,+ex</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79606352"></a>18.3.2. Fichiers de configuration</h3></div></div></div><p>Les fichiers de configuration suivants pour l'audit
	d'événements en rapport avec la
	sécurité se trouvent dans le répertoire
	<code class="filename">/etc/security</code>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">audit_class</code>: contient les
	    définitions des classes d'audit.</p></li><li class="listitem"><p><code class="filename">audit_control</code>: contrôle les
	    caractéristiques du système d'audit comme les
	    classes d'audit par défaut, l'espace disque minimal
	    à conserver sur le volume réservé aux
	    journaux, la taille maximale des traces d'audit.</p></li><li class="listitem"><p><code class="filename">audit_event</code>: les noms et la
	    description des événements systèmes
	    audités ainsi qu'une liste de classes auxquelles
	    appartiennent chaque événement.</p></li><li class="listitem"><p><code class="filename">audit_user</code>: les classes
	    d'événement à auditer pour des
	    utilisateurs spécifiques, qui s'ajoutent aux
	    paramètres généraux fixés par
	    défaut à l'ouverture de session.</p></li><li class="listitem"><p><code class="filename">audit_warn</code>: une procédure
	    modifiable utilisée par
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a> pour générer
	    des messages d'alerte lors des situations exceptionnelles
	    comme un espace disque faible pour les fichiers journaux
	    d'audit ou quand il y a eu rotation de ces fichiers
	    journaux.</p></li></ul></div><div xmlns="" class="warning"><h3 class="admontitle">Avertissement: </h3><p xmlns="http://www.w3.org/1999/xhtml">Les fichiers de configuration de l'audit devraient
	  être modifiés et gérés avec prudence
	  étant donné que des erreurs dans la configuration
	  pourraient donner lieu à un enregistrement incorrect des
	  événements.</p></div><p>Dans la plupart des cas, les administrateurs ne devront
	modifier que <code class="filename">audit_control</code> et
	<code class="filename">audit_user</code>.  Le premier contrôle
	les propriétés et les stratégies au
	niveau du système et le second peut être
	utilisé pour affiner l'audit pour chaque
	utilisateur.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="audit-auditcontrol"></a>18.3.2.1. Le fichier <code class="filename">audit_control</code></h4></div></div></div><p>Un certain nombre de paramètres par défaut pour le
	  système d'audit sont spécifiés dans le fichier
	  <code class="filename">audit_control</code>:</p><pre class="programlisting">dir:/var/audit
dist:off
flags:lo,aa
minfree:5
naflags:lo,aa
policy:cnt,argv
filesz:2M
expire-after:10M</pre><p>L'option <code class="literal">dir</code> est utilisée pour
	  déclarer un ou plusieurs répertoires dans
	  lesquels seront stockés les fichiers journaux.  Si
	  l'on mentionne plus d'un répertoire, ces derniers
	  seront utilisés dans l'ordre à mesure qu'ils
	  se remplissent.  Il est classique de configurer le
	  système d'audit pour le stockage des fichiers
	  journaux sur un système de fichiers
	  dédié, afin d'éviter toute
	  interférence entre le système d'audit et
	  d'autres systèmes si le système de fichiers
	  est plein.</p><p>Si le champ <code class="option">dist</code> est fixé à
	  <code class="literal">on</code> ou <code class="literal">yes</code>, des liens
	  matériel seront créés pour tous les fichiers de trace
	  d'audit de <code class="filename">/var/audit/dist</code>.</p><p>Le champ <code class="literal">flags</code> fixe le masque
	  général de présélection
	  utilisé par défaut pour les
	  événements attribuables.  Dans l'exemple
	  ci-dessus, les ouvertures et fermetures de sessions
	  réussies ou échouées ainsi que les authentifications et
	  autorisations sont
	  enregistrées pour tous les utilisateurs.</p><p>L'option <code class="literal">minfree</code> définit le
	  pourcentage minimal d'espace libre du système de
	  fichiers sur lequel les traces d'audit sont stockées.</p><p>L'entrée <code class="literal">naflags</code> indique les
	  classes à surveiller pour les
	  événements non-attribués, comme les
	  processus d'ouverture et de fermeture de session et les
	  authentifications et autorisations.</p><p>L'entrée <code class="literal">policy</code> donne une
	  liste d'indicateurs de stratégie contrôlant
	  divers aspect du comportement de l'audit
	  séparés par une virgule.  L'indicateur
	  <code class="literal">cnt</code> indique que le système devrait
	  continuer à fonctionner en dépit d'un
	  échec dans l'audit (l'emploi de cet indicateur est
	  hautement recommandé).  L'autre indicateur
	  <code class="literal">argv</code>, provoque l'audit des arguments
	  passés à l'appel système <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a>
	  lors de l'audit de l'exécution des commandes.</p><p>L'entrée <code class="literal">filez</code> indique la
	  taille maximale en octets autorisée pour un fichier
	  de trace avant qu'il soit interrompu et que le
	  système provoque sa rotation.  La valeur par
	  défaut, <code class="literal">0</code>, désactive la rotation automatique
	  des journaux.  Si la taille de fichier est
	  inférieure à 512K, elle
	  sera ignorée et un message sera
	  généré.</p><p>Le champ <code class="option">expire-after</code> indique quand un
	  fichier de trace expirera et sera supprimé.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="audit-audituser"></a>18.3.2.2. Le fichier <code class="filename">audit_user</code></h4></div></div></div><p>L'administrateur peut spécifier des exigences
	  supplémentaires qu niveau de l'audit pour des utilisateurs
	  spécifiques dans le fichier <code class="filename">audit_user</code>.
	  Chaque ligne paramètre l'audit
	  pour un utilisateur par l'intermédiaire de deux
	  champs: le champ
	  <code class="literal">alwaysaudit</code>, qui indique l'ensemble des
	  événements qui devraient toujours être
	  surveillés pour l'utilisateur, le
	  champ, <code class="literal">neveraudit</code>, indique un ensemble
	  d'événements qui ne devrait jamais être
	  audité pour cet utilisateur.</p><p>L'exemple suivant d'entrées
	  permet le suivi des
	  ouvertures et fermetures de sessions et l'exécution
	  de commandes avec succès de l'utilisateur
	  <code class="systemitem">root</code>, et audite la création de
	  fichiers et l'exécution de commandes avec
	  succès pour l'utilisateur <code class="systemitem">www</code>.
	  Si utilisé avec le
	  fichier
	  <code class="filename">audit_control</code> par défaut, l'entrée
	  <code class="literal">lo</code> pour <code class="systemitem">root</code> est
	  redondante, et les événements relatifs aux
	  ouvertures et aux fermetures de sessions seront
	  également enregistrés pour l'utilisateur
	  <code class="systemitem">www</code>.</p><pre class="programlisting">root:lo,+ex:no
www:fc,+ex:no</pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="audit-inline-glossary.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="audit.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="audit-administration.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">18.2. Mots-clés </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 18.4. Travailler avec les traces d'audit</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>