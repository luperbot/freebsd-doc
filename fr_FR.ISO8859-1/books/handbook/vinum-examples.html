<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>21.6. Quelques exemples</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="vinum-vinum.html" title="Chapitre 21. Le gestionnaire de volume Vinum" /><link rel="prev" href="vinum-objects.html" title="21.5. Objets Vinum" /><link rel="next" href="ch21s07.html" title="21.7. Appellation des objets" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">21.6. Quelques exemples</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="vinum-objects.html">Précédent</a> </td><th width="60%" align="center">Chapitre 21. Le gestionnaire de volume Vinum</th><td width="20%" align="right"> <a accesskey="n" href="ch21s07.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="vinum-examples"></a>21.6. Quelques exemples</h2></div></div></div><p>Vinum maintient une <span class="emphasis"><em>base de données de
      configuration</em></span> qui décrit les objets connus pour un
      système individuel.  Initialement, l'utilisateur créé
      la base de données de configuration à partir d'un ou
      plusieurs fichiers de configuration avec l'aide de l'utilitaire
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vinum&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">vinum</span>(8)</span></a>.  Vinum conserve une copie de sa base de données
      de configuration sur chaque tranche (que Vinum nomme
      <span class="emphasis"><em>device</em></span>) sous son contrôle.  Cette
      base données est mise à jour à chaque changement
      d'état, aussi un redémarrage reconstitue exactement
      l'état de chaque objet Vinum.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81588560"></a>21.6.1. Le fichier de configuration</h3></div></div></div><p>Le fichier de configuration décrit les objets Vinum.
	La définition d'un simple volume pourrait être:</p><pre class="programlisting">
    drive a device /dev/da3h
    volume myvol
      plex org concat
        sd length 512m drive a</pre><p>Ce fichier décrit quatre objets Vinum:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>La ligne <span class="emphasis"><em>drive</em></span> une partition
	    disque (<span class="emphasis"><em>drive</em></span>) et son emplacement
	    relatif par rapport au matériel sous-jacent.  On lui donne
	    le nom symbolique <span class="emphasis"><em>a</em></span>.  Cette
	    séparation entre le nom symbolique et le nom du
	    périphérique permet aux disques d'être
	    déplacés d'un emplacement à un autre sans
	    confusion possible.</p></li><li class="listitem"><p>La ligne <span class="emphasis"><em>volume</em></span> décrit un volume.
	    Le seul attribut nécessaire est le nom, dans notre cas
	    <span class="emphasis"><em>myvol</em></span>.</p></li><li class="listitem"><p>La ligne <span class="emphasis"><em>plex</em></span> définit
	    une plex.  Le seul paramètre requit est l'organisation,
	    dans ce cas <span class="emphasis"><em>concat</em></span>.  Aucun nom n'est
	    nécessaire: le système génère
	    automatiquement un nom à partir du nom de volume en
	    ajoutant le suffixe
	    <span class="emphasis"><em>.p</em></span><span class="emphasis"><em>x</em></span>, où
	    <span class="emphasis"><em>x</em></span> est le nombre de plexes dans le volume.
	    Donc cette plex sera appelée
	    <span class="emphasis"><em>myvol.p0</em></span>.</p></li><li class="listitem"><p>La ligne <span class="emphasis"><em>sd</em></span> décrit un
	    sous-disque.  Les spécifications minimales sont le nom du
	    disque sur lequel le stocker et la taille du sous-disque.
	    Comme pour les plexes, aucun nom n'est nécessaire: le
	    système assignera automatiquement des noms
	    dérivés du nom de la plex en ajoutant le
	    suffixe <span class="emphasis"><em>.s</em></span><span class="emphasis"><em>x</em></span>,
	    où <span class="emphasis"><em>x</em></span> est le nombre de sous-disques
	    dans la plex.  Donc Vinum donnera le nom
	    <span class="emphasis"><em>myvol.p0.s0</em></span> à ce sous-disque.</p></li></ul></div><p>Après avoir traité ce fichier
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vinum&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">vinum</span>(8)</span></a> affiche ce qui suit:</p><pre class="programlisting">
      <code class="prompt">#</code> vinum -&gt; <code class="command">create config1</code>
      Configuration summary
      Drives:         1 (4 configured)
      Volumes:        1 (4 configured)
      Plexes:         1 (8 configured)
      Subdisks:       1 (16 configured)

	D a                     State: up       Device /dev/da3h        Avail: 2061/2573 MB (80%)

	V myvol                 State: up       Plexes:       1 Size:        512 MB

	P myvol.p0            C State: up       Subdisks:     1 Size:        512 MB

	S myvol.p0.s0           State: up       PO:        0  B Size:        512 MB</pre><p>Cette sortie affiche une brève liste du format
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vinum&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">vinum</span>(8)</span></a>.  Elle est représentée graphiquement
	dans <a class="xref" href="vinum-examples.html#vinum-simple-vol" title="Figure 21.4. Un simple volume Vinum">Figure 21.4, « Un simple volume Vinum »</a>.</p><p>
	</p><div class="figure"><a id="vinum-simple-vol"></a><div class="figure-title">Figure 21.4. Un simple volume Vinum</div><div class="figure-contents"><div class="mediaobject"><img src="vinum/vinum-simple-vol.png" alt="Un simple volume Vinum" /></div></div></div><p><br class="figure-break" />
      </p><p>Cette figure, et celles qui suivent, représentent un
	volume qui contient les plexes, qui à leur tour contiennent
	les sous-disques.  Dans cet exemple trivial, le volume
	contient une plex, et la plex contient un sous-disque.</p><p>Ce volume particulier ne présente aucun avantage
	spécifique par rapport à une partition de disque
	conventionnelle.  Il contient une seule plex, donc il n'est
	pas redondant.  La plex contient un seul sous-disque, il n'y a
	donc pas de différence dans l'organisation du stockage des
	données par rapport à une partition de disque
	conventionnelle.  Les sections suivantes présenteront
	diverses méthodes de configuration plus
	intéressantes.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81606736"></a>21.6.2. Robustesse accrue: le mode miroir</h3></div></div></div><p>La robustesse d'un volume peut être
	augmentée par le mode miroir.  Quand on implémente
	un volume en mode miroir, il est important de s'assurer que
	les sous-disques de chaque plex sont sur des disques
	différents, de sorte qu'une panne disque ne mette hors service
	les deux plexes.  La configuration suivante place en mode
	miroir un volume:</p><pre class="programlisting">
	drive b device /dev/da4h
	volume mirror
      plex org concat
        sd length 512m drive a
	  plex org concat
	    sd length 512m drive b</pre><p>Dans cet exemple, il n'était pas nécessaire de
	spécifier une définition de disque
	<span class="emphasis"><em>a</em></span> à nouveau,
	puisque Vinum garde trace de tous les objets dans sa base de
	données de configuration.  Après le traitement de cette
	définition, la configuration ressemble à:</p><pre class="programlisting">
	Drives:         2 (4 configured)
	Volumes:        2 (4 configured)
	Plexes:         3 (8 configured)
	Subdisks:       3 (16 configured)

	D a                     State: up       Device /dev/da3h        Avail: 1549/2573 MB (60%)
	D b                     State: up       Device /dev/da4h        Avail: 2061/2573 MB (80%)

    V myvol                 State: up       Plexes:       1 Size:        512 MB
    V mirror                State: up       Plexes:       2 Size:        512 MB

    P myvol.p0            C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p0           C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p1           C State: initializing     Subdisks:     1 Size:        512 MB

    S myvol.p0.s0           State: up       PO:        0  B Size:        512 MB
	S mirror.p0.s0          State: up       PO:        0  B Size:        512 MB
	S mirror.p1.s0          State: empty    PO:        0  B Size:        512 MB</pre><p><a class="xref" href="vinum-examples.html#vinum-mirrored-vol" title="Figure 21.5. Un volume Vinum en mode miroir">Figure 21.5, « Un volume Vinum en mode miroir »</a> présente la
	structure sous forme graphique.</p><p>
	</p><div class="figure"><a id="vinum-mirrored-vol"></a><div class="figure-title">Figure 21.5. Un volume Vinum en mode miroir</div><div class="figure-contents"><div class="mediaobject"><img src="vinum/vinum-mirrored-vol.png" alt="Un volume Vinum en mode miroir" /></div></div></div><p><br class="figure-break" />
      </p><p>Dans cet exemple, chaque plex contient un espace
	d'adressage de 512 MO.  Comme dans l'exemple
	précédent, chaque plex contient seulement un seul
	sous-disque.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81612368"></a>21.6.3. Optimiser les performances</h3></div></div></div><p>Le volume en mode miroir de l'exemple précédent
	est plus résistant aux pannes qu'un volume sans miroir,
	mais ses performances sont moindres: chaque écriture sur le
	volume demande d'écrire sur les deux disques, utilisant alors
	une plus grande proportion de la bande passante disque totale.
	Des considérations sur les performances demandent une
	approche différente: à la place d'un miroir, les
	données sont segmentées sur autant de disques que
	possible.  La configuration suivante montre un volume avec une plex
	segmentée sur quatre disques:</p><pre class="programlisting">
	drive c device /dev/da5h
	drive d device /dev/da6h
	volume stripe
	plex org striped 512k
	  sd length 128m drive a
	  sd length 128m drive b
	  sd length 128m drive c
	  sd length 128m drive d</pre><p>Comme précédemment, il n'est pas nécessaire de
	définir les disques qui sont déjà connus de Vinum.
	Après traitement de cette définition, la configuration
	ressemble à:</p><pre class="programlisting">
	Drives:         4 (4 configured)
	Volumes:        3 (4 configured)
	Plexes:         4 (8 configured)
	Subdisks:       7 (16 configured)

    D a                     State: up       Device /dev/da3h        Avail: 1421/2573 MB (55%)
    D b                     State: up       Device /dev/da4h        Avail: 1933/2573 MB (75%)
    D c                     State: up       Device /dev/da5h        Avail: 2445/2573 MB (95%)
    D d                     State: up       Device /dev/da6h        Avail: 2445/2573 MB (95%)

    V myvol                 State: up       Plexes:       1 Size:        512 MB
    V mirror                State: up       Plexes:       2 Size:        512 MB
    V striped               State: up       Plexes:       1 Size:        512 MB

    P myvol.p0            C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p0           C State: up       Subdisks:     1 Size:        512 MB
    P mirror.p1           C State: initializing     Subdisks:     1 Size:        512 MB
    P striped.p1            State: up       Subdisks:     1 Size:        512 MB

    S myvol.p0.s0           State: up       PO:        0  B Size:        512 MB
    S mirror.p0.s0          State: up       PO:        0  B Size:        512 MB
    S mirror.p1.s0          State: empty    PO:        0  B Size:        512 MB
    S striped.p0.s0         State: up       PO:        0  B Size:        128 MB
    S striped.p0.s1         State: up       PO:      512 kB Size:        128 MB
    S striped.p0.s2         State: up       PO:     1024 kB Size:        128 MB
    S striped.p0.s3         State: up       PO:     1536 kB Size:        128 MB</pre><p>
	</p><div class="figure"><a id="vinum-striped-vol"></a><div class="figure-title">Figure 21.6. Un volume Vinum segmenté</div><div class="figure-contents"><div class="mediaobject"><img src="vinum/vinum-striped-vol.png" alt="Un volume Vinum segmenté" /></div></div></div><p><br class="figure-break" />
      </p><p>Ce volume est représenté sur
	<a class="xref" href="vinum-examples.html#vinum-striped-vol" title="Figure 21.6. Un volume Vinum segmenté">Figure 21.6, « Un volume Vinum segmenté »</a>.  La couleur des segments
	indique leur position dans l'espace d'adresses de la plex: le
	segment le plus clair vient en premier, le plus sombre
	en dernier.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81625680"></a>21.6.4. Robustesse et performances</h3></div></div></div><p><a id="vinum-resilience"></a>Avec suffisamment de
	matériel, il est possible de créer des volumes qui
	présenteront une robustesse et des performances accrues
	comparés aux partitions UNIX&#8482; standards.  Un fichier
	de configuration pourrait être:</p><pre class="programlisting">
	volume raid10
      plex org striped 512k
        sd length 102480k drive a
        sd length 102480k drive b
        sd length 102480k drive c
        sd length 102480k drive d
        sd length 102480k drive e
      plex org striped 512k
        sd length 102480k drive c
        sd length 102480k drive d
        sd length 102480k drive e
        sd length 102480k drive a
        sd length 102480k drive b</pre><p>Les sous-disques de la seconde plex sont décalés
	de deux disques par rapport à ceux de la première plex:
	cela aide à s'assurer que les écritures ne vont pas sur
	les même sous-disques même si un transfert s'effectue sur
	les deux disques.</p><p><a class="xref" href="vinum-examples.html#vinum-raid10-vol" title="Figure 21.7. Un volume Vinum en mode miroir segmenté">Figure 21.7, « Un volume Vinum en mode miroir segmenté »</a> représente la structure
	de ce volume.</p><p>
	</p><div class="figure"><a id="vinum-raid10-vol"></a><div class="figure-title">Figure 21.7. Un volume Vinum en mode miroir segmenté</div><div class="figure-contents"><div class="mediaobject"><img src="vinum/vinum-raid10-vol.png" alt="Un volume Vinum en mode miroir segmenté" /></div></div></div><p><br class="figure-break" />
      </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="vinum-objects.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="vinum-vinum.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="ch21s07.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">21.5. Objets Vinum </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 21.7. Appellation des objets</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>