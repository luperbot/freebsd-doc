<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>8.2. Configurer une carte son</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="multimedia.html" title="Chapitre 8. Multimédia" /><link rel="prev" href="multimedia.html" title="Chapitre 8. Multimédia" /><link rel="next" href="sound-mp3.html" title="8.3. Fichiers MP3" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">8.2. Configurer une carte son</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="multimedia.html">Précédent</a> </td><th width="60%" align="center">Chapitre 8. Multimédia</th><td width="20%" align="right"> <a accesskey="n" href="sound-mp3.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="sound-setup"></a>8.2. Configurer une carte son</h2></div><div><span class="authorgroup">Contribution de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Moses</span> <span class="surname">Moore</span></span>. </span></div><div><span class="authorgroup">Augmentée pour FreeBSD 5.X par <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-device"></a>8.2.1. Configuration du système</h3></div></div></div><a id="idp72507344" class="indexterm"></a><a id="idp72507856" class="indexterm"></a><a id="idp72508368" class="indexterm"></a><p>Avant que vous commenciez, vous devriez connaître le
      modèle de carte son que vous avez, la puce qu'elle utilise, et si
      c'est une carte PCI ou ISA.  FreeBSD supporte une grande
      variété de cartes PCI et ISA.
      Consultez la liste des périphériques audio
      supportés des <a class="link" href="http://www.FreeBSD.org/releases/10.1R/hardware.html" target="_top">notes
      de compatibilité matériel</a> pour voir si
      votre carte est supportée.  Ces notes indiqueront
      également quel pilote supporte votre carte.</p><a id="idp72509776" class="indexterm"></a><p>Pour utiliser votre carte son, vous devrez charger le pilote
      de périphérique approprié.  Cela peut être
      fait de deux façons.  La plus simple est de charger le module pour
      votre carte son avec <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>, ce qui peut être
      soit fait à partir de la ligne de commande:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_emu10k1</code></strong></pre><p>soit en ajoutant la ligne appropriée dans le fichier
      <code class="filename">/boot/loader.conf</code> comme cela:</p><pre class="programlisting">snd_emu10k1_load="YES"</pre><p>Ces exemples concernent la carte Creative <span class="trademark">SoundBlaster</span>®
      Live!.  Les autres modules son chargeables sont listés dans
      <code class="filename">/boot/defaults/loader.conf</code>.  Si vous
      n'êtes pas sûr du pilote à utiliser, vous
      pouvez tenter de charger le pilote
      <code class="filename">snd_driver</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_driver</code></strong></pre><p>C'est un méta-pilote
      chargeant directement les pilotes les plus courants.  Cela
      accélère la recherche du pilote
      adapté.  Il est également possible de charger
      l'intégralité des pilotes de cartes son en
      utilisant le système
      <code class="filename">/boot/loader.conf</code>.</p><p>Si vous voulez connaître le pilote
      sélectionné lors du chargement du
      méta-pilote <code class="filename">snd_driver</code>, vous pouvez
      consulter le fichier <code class="filename">/dev/sndstat</code> à
      cet effet, et cela à l'aide de la commande <code class="command">cat
      /dev/sndstat</code>.</p><p>Une seconde méthode est de compiler le
      support pour votre carte son en statique dans votre noyau.  La
      section ci-dessous fournit les informations nécessaires pour
      ajouter le support de votre matériel de cette manière.
      Pour plus d'informations au sujet de la recompilation de votre noyau,
      veuillez consulter le <a class="xref" href="kernelconfig.html" title="Chapitre 9. Configurer le noyau de FreeBSD">Chapitre 9, <em>Configurer le noyau de FreeBSD</em></a>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72528208"></a>8.2.1.1. Configurer un noyau sur mesure avec support du
	son</h4></div></div></div><p>La première chose à effectuer est d'ajouter
	au noyau le pilote de périphérique audio
	générique <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sound&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">sound</span>(4)</span></a>; pour cela vous devrez
	ajouter la ligne suivante au fichier de configuration du
	noyau:</p><pre class="programlisting">device sound</pre><p>Ensuite, vous devez ajouter le support pour votre carte
	son.  Par conséquent, vous devez savoir quel pilote
	supporte la carte.  Consultez la liste des
	périphériques audio supportés des <a class="link" href="http://www.FreeBSD.org/releases/10.1R/hardware.html" target="_top">notes de compatibilité
	matériel</a> pour déterminer le pilote
	correct pour votre carte son.  Par exemple, une carte son
	Creative <span class="trademark">SoundBlaster</span>® Live! est supportée par le
	pilote <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_emu10k1&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_emu10k1</span>(4)</span></a>.  Pour ajouter le support pour
	cette carte, utilisez ce qui suit:</p><pre class="programlisting">device snd_emu10k1</pre><p>Assurez-vous de lire la page de manuel du pilote pour la
	syntaxe à utiliser.  La syntaxe de la configuration
	du noyau pour chaque pilote de carte son supportée
	peut être également trouvée dans
	le fichier <code class="filename">/usr/src/sys/conf/NOTES</code>.</p><p>Les cartes son ISA non-PnP pourront nécessiter de
	fournir au noyau des informations sur le paramétrage de
	la carte (IRQ, port d'E/S, etc.), comme c'est en général le
	cas pour toutes les cartes ISA non-PnP.  Cela s'effectue par
	l'intermédiaire du fichier
	<code class="filename">/boot/device.hints</code>.  Au démarrage
	du système, le chargeur (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>) lira ce
	fichier et passera les paramètres au noyau.  Par
	exemple, une vieille carte ISA non-PnP Creative <span class="trademark">SoundBlaster</span>®
	16 utilisera le pilote <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a> de paire avec <code class="literal">snd_sb16</code>, on ajoutera alors la ligne suivante
	au fichier de configuration du noyau:</p><pre class="programlisting">device snd_sbc
device snd_sb16</pre><p>avec également ceci dans le fichier
	<code class="filename">/boot/device.hints</code>:</p><pre class="programlisting">hint.sbc.0.at="isa"
hint.sbc.0.port="0x220"
hint.sbc.0.irq="5"
hint.sbc.0.drq="1"
hint.sbc.0.flags="0x15"</pre><p>Dans ce cas, la carte utilise le port d'E/S
	<code class="literal">0x220</code> et l'IRQ <code class="literal">5</code>.</p><p>La syntaxe utilisée dans le fichier
	<code class="filename">/boot/device.hints</code> est abordée
	dans la page de manuel du pilote <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sound&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">sound</span>(4)</span></a> ainsi que celle
	du pilote spécifique à la carte son.</p><p>Les paramètres donnés ci-dessus sont ceux
	par défaut.  Dans certains cas, vous pouvez avoir
	besoin de modifier l'IRQ ou tout autre paramètre en
	fonction de votre carte son.  Consultez la page de manuel
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a> pour plus d'informations au sujet de cette
	carte.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-testing"></a>8.2.2. Tester la carte son</h3></div></div></div><p>Après avoir redémarré avec le noyau
      modifié, ou après avoir chargé le module
      nécessaire, la carte son devrait apparaître dans le
      tampon des messages du système (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a>) d'un
      manière proche de la suivante:</p><pre class="screen">pcm0: &lt;Intel ICH3 (82801CA)&gt; port 0xdc80-0xdcbf,0xd800-0xd8ff irq 5 at device 31.5 on pci0
pcm0: [GIANT-LOCKED]
pcm0: &lt;Cirrus Logic CS4205 AC97 Codec&gt;</pre><p>L'état de la carte son peut être
      contrôlée par l'intermédiaire du fichier
      <code class="filename">/dev/sndstat</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat /dev/sndstat</code></strong>
FreeBSD Audio Driver (newpcm)
Installed devices:
pcm0: &lt;Intel ICH3 (82801CA)&gt; at io 0xd800, 0xdc80 irq 5 bufsz 16384
kld snd_ich (1p/2r/0v channels duplex default)</pre><p>Le résultat pourra être différent sur
      votre système.  Si aucun périphérique
      <code class="filename">pcm</code> n'apparaît, retournez en
      arrière et revoyez ce qui a été fait
      précédemment.  Contrôlez à nouveau votre
      fichier de configuration du noyau et vérifiez que vous
      avez choisi le périphérique correct.  Les
      problèmes courants sont listés dans la
      <a class="xref" href="sound-setup.html#troubleshooting" title="8.2.2.1. Problèmes courants">Section 8.2.2.1, « Problèmes courants »</a>.</p><p>Si tout va bien, vous devriez avoir maintenant une carte son
      qui fonctionne.  Si la sortie audio de votre lecteur de CD-ROM ou de DVD-ROM est
      correctement reliée à votre carte son, vous pouvez
      introduire un CD dans le lecteur et le jouer avec
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cdcontrol&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cdcontrol</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cdcontrol -f /dev/acd0 play 1</code></strong></pre><p>Diverses applications, comme <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/audio/workman/pkg-descr">audio/workman</a> offrent une meilleure
      interface.  Vous pouvez vouloir installer une application
      comme <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/audio/mpg123/pkg-descr">audio/mpg123</a> pour
      écouter des fichiers audio MP3.</p><p>Une autre méthode
      rapide pour tester la carte est d'envoyer des données au
      <code class="filename">/dev/dsp</code>, de la manière
      suivante:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cat filename &gt; /dev/dsp</code></strong></pre><p>où <em class="replaceable"><code>filename</code></em> peut
      être n'importe quel fichier.  Cette ligne de commande
      devrait produire des sons, confirmant le bon fonctionnement de
      la carte son.</p><p>Les niveaux du mixer de la carte son peuvent être
      modifiés par la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mixer&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mixer</span>(8)</span></a>.  Plus de
      détails peuvent être trouvés dans la page de
      manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mixer&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mixer</span>(8)</span></a>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="troubleshooting"></a>8.2.2.1. Problèmes courants</h4></div></div></div><a id="idp72564944" class="indexterm"></a><a id="idp72565456" class="indexterm"></a><a id="idp72565968" class="indexterm"></a><a id="idp72566480" class="indexterm"></a><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Erreur</th><th>Solution</th></tr></thead><tbody><tr><td><span class="errorname">sb_dspwr(XX) timed out</span></td><td><p>Le port d'E/S n'est pas configuré
	        correctement.</p></td></tr><tr><td><span class="errorname">bad irq XX</span></td><td><p>L'IRQ sélectionnée est incorrecte.
		Vérifiez que l'IRQ choisie et l'IRQ de la carte son sont
		les mêmes.</p></td></tr><tr><td><span class="errorname">xxx: gus pcm not attached, out of
    	        memory</span></td><td><p>Il n'y a pas suffisamment de mémoire
	        disponible pour utiliser ce périphérique.</p></td></tr><tr><td><span class="errorname">xxx: can't open /dev/dsp!</span></td><td><p>Vérifiez avec la commande
		<code class="command">fstat | grep dsp</code> si une autre
		application maintient le périphérique ouvert.
		Souvent à l'origine de ce type de problème on
		trouve <span class="application">esound</span> et le support son de <span class="application">KDE</span>.</p></td></tr></tbody></table></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-multiple-sources"></a>8.2.3. Utiliser des sources sonores multiples</h3></div><div><span class="authorgroup">Contribution de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Munish</span> <span class="surname">Chopra</span></span>. </span></div></div></div><p>Il est souvent intéressant de pouvoir jouer
      simultanément du son à partir de multiples
      sources, comme lorsque <span class="application">esound</span> ou
      <span class="application">artsd</span> ne supportent pas le partage du
      périphérique son avec certaines applications.</p><p>FreeBSD vous permet de le faire par l'intermédiaire
      de <span class="emphasis"><em>Canaux Sonores Virtuels</em></span>, qui peuvent
      être activés avec la fonction <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>.  Les canaux
      virtuels vous permettent de multiplexer la sortie de
      votre carte son en mixant le son au niveau du noyau.</p><p>Pour configurer le nombre de canaux virtuels, il existe deux
      paramètres de sysctl qui, si vous avez les privilèges
      de l'utilisateur <code class="systemitem">root</code>, peuvent
      être configurés comme ceci:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.pcm0.vchans=4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.maxautovchans=4</code></strong></pre><p>L'exemple ci-dessus alloue quatre canaux virtuels, ce qui est
      un nombre suffisant pour une utilisation classique.
    <code class="varname">hw.snd.pcm0.vchans</code> est le nombre de canaux
      virtuels que possède <code class="filename">pcm0</code>,
      et est configurable une fois que le périphérique
      a été attaché au système.
      <code class="literal">hw.snd.maxautovchans</code> est le nombre de canaux
      virtuels alloués à un nouveau
      périphérique audio quand il est attaché
      à l'aide de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>.  Comme le module
      <code class="filename">pcm</code> peut être chargé
      indépendamment des pilotes de périphériques,
      <code class="literal">hw.snd.maxautovchans</code> peut stocker combien de
      canaux virtuels seront alloués à chaque
      périphérique attaché par la suite.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Vous ne pouvez pas modifier le nombre de canaux virtuels
	pour un périphérique en cours d'utilisation.
	Quittez avant tout autre chose les programmes utilisant le
	périphérique en question, comme les lecteurs de
	fichiers sonores ou les <span class="quote">« <span class="quote">daemons</span> »</span> audios.</p></div><p>Si vous n'utilisez pas <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a>, vous devrez faire
      pointer vos applications sur
      <code class="filename">/dev/dsp0</code>.<em class="replaceable"><code>x</code></em>,
      où <em class="replaceable"><code>x</code></em> est 0 à 3 si
      <code class="varname">hw.snd.pcm.0.vchans</code> est fixé à 4.
      Sur un système utilisant <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a>, ce qui
      précède sera automatiquement effectué
      de façon transparente pour le programme qui
      réclame le périphérique
      <code class="filename">/dev/dsp0</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72614736"></a>8.2.4. Définir les valeurs par défaut du mixeur
	des différents canaux</h3></div><div><span class="authorgroup">Contribution de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Josef</span> <span class="surname">El-Rayes</span></span>. </span></div></div></div><p>Les valeurs par défaut du mixeur des
	différents canaux sont fixées en dur dans le
	code source du pilote <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a>.  Il existe plusieurs
	applications et &#8220;daemons&#8221; qui vous permettent de
	fixer les valeurs du mixeur qui seront mémorisées entre
	chaque invocation, mais
	ce n'est pas une solution idéale.  Il est possible
	régler les valeurs par défaut au niveau du
	pilote &#8212; ceci se fait en définissant les valeurs
	adéquates dans le fichier
	<code class="filename">/boot/device.hints</code>.  Par exemple:</p><pre class="programlisting">hint.pcm.0.vol="50"</pre><p>Cela fixera le volume du canal à une valeur par
	défaut de 50; dès que le module <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> est
	chargé.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="multimedia.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="multimedia.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="sound-mp3.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">Chapitre 8. Multimédia </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 8.3. Fichiers MP3</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>