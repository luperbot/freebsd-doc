<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>9.3. Compiler et installer un noyau sur mesure</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="kernelconfig.html" title="Chapitre 9. Configurer le noyau de FreeBSD" /><link rel="prev" href="kernelconfig-custom-kernel.html" title="9.2. Pourquoi compiler un noyau sur mesure?" /><link rel="next" href="kernelconfig-config.html" title="9.4. Le fichier de configuration" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">9.3. Compiler et installer un noyau sur mesure</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kernelconfig-custom-kernel.html">Précédent</a> </td><th width="60%" align="center">Chapitre 9. Configurer le noyau de FreeBSD</th><td width="20%" align="right"> <a accesskey="n" href="kernelconfig-config.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-building"></a>9.3. Compiler et installer un noyau sur mesure</h2></div></div></div><a id="idp73017808" class="indexterm"></a><p>Commençons par passer rapidement en revue le répertoire
      de configuration du noyau.  Tous les chemins d'accès
      mentionnés seront relatifs au répertoire principal
      <code class="filename">/usr/src/sys</code>, qui est également
      accessible via le lien symbolique <code class="filename">/sys</code>.
      Il comporte un certain nombre de sous-répertoires correspondants
      à différentes parties du noyau, mais les plus
      importantes, en ce qui nous concerne, sont
      <code class="filename">arch/conf</code>, où vous
      éditerez votre fichier configuration personnalisé, et
      <code class="filename">compile</code>, qui est l'espace de travail où
      votre noyau sera compilé.  <em class="replaceable"><code>arch</code></em>
      représente une des architectures suivante: <code class="filename">i386</code>, soit
      <code class="filename">alpha</code>, <code class="filename">amd64</code>,
      <code class="filename">ia64</code>, <code class="filename">powerpc</code>,
      <code class="filename">sparc64</code>, ou encore <code class="filename">pc98</code>
      (une branche alternative de développement de l'architecture PC,
      populaire au Japon).  Tout ce qui se trouve dans un répertoire
      particulier à une architecture est propre uniquement
      à cette architecture; le reste du code est un code indépendant du type de machine et commun à
      toutes les plates-formes sur lesquelles FreeBSD pourrait être
      potentiellement porté.  Remarquez l'organisation logique de
      l'arborescence des répertoires, où chaque
      périphérique, système de fichiers,
      et option supportés a son propre
      sous-répertoire.</p><p>Les exemples de ce chapitre supposent que vous utilisez
      l'architecture i386.  Si ce n'est pas votre cas, effectuez les
      ajustements appropriés au niveau des chemins
      d'accès pour votre architecture.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">S'il n'y a <span class="emphasis"><em>pas</em></span> de répertoire
	<code class="filename">/usr/src/sys</code> sur votre système,
	alors c'est que les sources du noyau n'ont pas été
	installées.  La manière la plus facile de les installer
	est d'exécuter <code class="command">sysinstall</code>
	en tant
	que <code class="systemitem">root</code>, et sélectionner
	<span class="guimenuitem">Configure</span>, puis
	<span class="guimenuitem">Distributions</span>,
	<span class="guimenuitem">src</span>, puis
	<span class="guimenuitem">base</span> et <span class="guimenuitem">sys</span>.
	Si vous avez une aversion envers <span class="application">sysinstall</span>
	et que vous disposez d'un CDROM &#8220;officiel&#8221; de
	FreeBSD, alors vous pouvez installer les sources depuis la
	ligne de commande:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /cdrom</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /usr/src/sys</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /usr/src/sys /sys</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cat /cdrom/src/ssys.[a-d]* | tar -xzvf -</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cat /cdrom/src/sbase.[a-d]* | tar -xzvf -</code></strong></pre></div><p>Ensuite allez dans le répertoire
      <code class="filename">arch/conf</code> et copiez
      le fichier de configuration <code class="filename">GENERIC</code> dans un
      fichier qui portera le nom que vous voulez donner à votre
      noyau.  Par exemple:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/i386/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC MONNOYAU</code></strong></pre><p>Par tradition, c'est un nom en majuscules, et si vous maintenez
      plusieurs machines FreeBSD avec des configurations matérielles
      différentes, c'est une bonne idée de lui donner le
      même nom que la machine.  Nous l'appellerons
      <code class="filename">MONNOYAU</code> pour les besoins de cet
      exemple.</p><div xmlns="" class="tip"><h3 class="admontitle">Astuce: </h3><p xmlns="http://www.w3.org/1999/xhtml">Conserver votre fichier de configuration du noyau
	directement sous <code class="filename">/usr/src</code> peut être une
	mauvaise idée.  Si vous avez des problèmes
	il peut être tentant de juste effacer
	<code class="filename">/usr/src</code> et recommencer à nouveau.
	Après avoir fait cela ne prends que quelques secondes
	pour vous rendre compte que vous venez
	d'effacer votre fichier de configuration du noyau
	personnalisé.  N'éditez pas, non plus, directement le fichier
	<code class="filename">GENERIC</code>, il peut être
	écrasé à la prochaine <a class="link" href="updating-upgrading.html" title="Chapitre 24. Mise à jour de FreeBSD">mise à jour de l'arborescence
	des sources</a>, et vos modifications seraient
	perdues.</p><p xmlns="http://www.w3.org/1999/xhtml">Vous voudrez peut être conserver votre fichier de
	configuration du noyau ailleurs et alors créer un lien
	symbolique vers le fichier dans le répertoire
	<code class="filename">i386</code>.</p><p xmlns="http://www.w3.org/1999/xhtml">Par exemple:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/i386/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /root/noyaux</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC /root/noyaux/MONNOYAU</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /root/noyaux/MONNOYAU</code></strong></pre></div><p>Editez maintenant <code class="filename">MONNOYAU</code> avec votre
      éditeur de texte préféré.
      Si vous venez tout juste de finir l'installation, le seul
      éditeur disponible sera probablement
      <span class="application">vi</span>, qui est trop complexe pour être
      décrit ici, mais est bien expliqué dans de nombreux
      ouvrages de la <a class="link" href="bibliography.html" title="Annexe B. Bibliographie">bibliographie</a>.
      Cependant, FreeBSD offre un éditeur plus simple appelé
      <span class="application">ee</span> qui, si vous êtes débutant,
      sera votre éditeur de choix.  N'hésitez pas à
      modifier les commentaires d'entête pour y décrire
      votre configuration ou les modifications que vous avez apportés
      par rapport au noyau <code class="filename">GENERIC</code>.</p><a id="idp73075024" class="indexterm"></a><p>Si vous avez déjà compilé un noyau sur <span class="trademark">SunOS</span>&#8482;
      ou tout autre système d'exploitation BSD, l'essentiel de fichier
      vous sera familier.  Si vous venez d'un système d'exploitation
      comme DOS, à l'inverse, le fichier de configuration
      <code class="filename">GENERIC</code> vous paraîtra inintelligible, lisez
      alors lentement et attentivement la section sur <a class="link" href="kernelconfig-config.html" title="9.4. Le fichier de configuration">le fichier de
      configuration</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si vous <a class="link" href="updating-upgrading.html" title="Chapitre 24. Mise à jour de FreeBSD">synchronisez
	votre arborescence des sources</a> avec les toutes
	dernières sources du projet FreeBSD, assurez-vous de
	toujours lire le fichier <code class="filename">/usr/src/UPDATING</code>
	avant d'effectuer une quelconque opération de mise
	à jour.  Ce fichier décrit les problèmes
	importants ou les domaines demandant une attention
	particulière dans le code mis à jour.
	<code class="filename">/usr/src/UPDATING</code> correspond toujours
	à votre version des sources de FreeBSD, et est donc plus
	à jour que ce Manuel.</p></div><p>Vous devez maintenant compiler le code source du
      noyau.</p><div class="procedure"><a id="idp73079760"></a><div class="procedure-title">Procédure 9.1. Compiler un noyau</div><ol class="procedure" type="1"><li class="step"><p>Passez dans le répertoire
	  <code class="filename">/usr/src</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong></pre></li><li class="step"><p>Compilez le noyau:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make buildkernel KERNCONF=MONNOYAU</code></strong></pre></li><li class="step"><p>Installez le nouveau noyau:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make installkernel KERNCONF=MONNOYAU</code></strong></pre></li></ol></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Il est indispensable d'avoir l'intégralité
	des sources du système FreeBSD pour compiler le
	noyau.</p></div><div xmlns="" class="tip"><h3 class="admontitle">Astuce: </h3><p xmlns="http://www.w3.org/1999/xhtml">Par défaut, quand vous compilez un noyau
	personnalisé, <span class="emphasis"><em>tous</em></span> les modules
	seront également recompilés.  Si vous
	désirez mettre à jour un noyau plus rapidement
	ou compiler que certains modules, vous devez éditer le
	fichier <code class="filename">/etc/make.conf</code> avant de compiler
	le noyau:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">MODULES_OVERRIDE = linux acpi sound/sound sound/driver/ds1 ntfs</pre><p xmlns="http://www.w3.org/1999/xhtml">Cette variable définit une liste de modules
	à compiler à la place de
	l'intégralité des modules.</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">WITHOUT_MODULES = linux acpi sound/sound sound/driver/ds1 ntfs</pre><p xmlns="http://www.w3.org/1999/xhtml">Cette variable définit une liste de modules
	à exclure du processus de compilation.  Pour d'autres
	variables qui peuvent être intéressantes pour le
	processus de compilation du noyau, consultez la page de manuel
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">make.conf</span>(5)</span></a>.</p></div><a id="idp73094864" class="indexterm"></a><p>Le nouveau noyau sera copié dans le répertoire
      <code class="filename">/boot/kernel</code> avec le nom
      <code class="filename">/boot/kernel/kernel</code> et l'ancien noyau sera renommé en
      <code class="filename">/boot/kernel.old/kernel</code>.  Maintenant, arrêtez
      le système et redémarrez pour utiliser votre
      nouveau noyau.
      Si quelque chose se passe mal, il y a quelques instructions
      de <a class="link" href="kernelconfig-trouble.html" title="9.5. Si quelque chose se passe mal">dépannage</a> à
      la fin de ce chapitre que vous pourrez trouver utiles.  Assurez-vous de lire la section qui
      explique comment revenir en arrière dans le cas où
      votre nouveau noyau <a class="link" href="kernelconfig-trouble.html#kernelconfig-noboot">ne
      démarre pas</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Les autres fichiers
	concernant le processus de démarrage, comme le chargeur
	(<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>) et la configuration du démarrage
	sont conservés dans le
	répertoire <code class="filename">/boot</code>.
	Les modules tiers et personnalisés peuvent être
	placés dans <code class="filename">/boot/kernel</code>,
	bien que les utilisateurs doivent être conscients
	que garder ses modules synchronisés avec le noyau
	compilé est très important.
	Les modules qui ne sont pas destinés à fonctionner
	avec le noyau compilé peuvent être instables et
	ne pas donner les résultats escomptés.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kernelconfig-custom-kernel.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="kernelconfig.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="kernelconfig-config.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">9.2. Pourquoi compiler un noyau sur mesure? </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 9.4. Le fichier de configuration</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>