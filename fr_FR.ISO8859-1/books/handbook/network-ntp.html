<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>29.10. Synchronisation de l'horloge avec NTP</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="network-servers.html" title="Chapitre 29. Serveurs réseau" /><link rel="prev" href="network-samba.html" title="29.9. Serveur de fichiers et d'impression pour clients Microsoft® Windows® (Samba)" /><link rel="next" href="firewalls.html" title="Chapitre 30. Firewalls ** Traduction en Cours **" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.10. Synchronisation de l'horloge avec NTP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-samba.html">Précédent</a> </td><th width="60%" align="center">Chapitre 29. Serveurs réseau</th><td width="20%" align="right"> <a accesskey="n" href="firewalls.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ntp"></a>29.10. Synchronisation de l'horloge avec NTP</h2></div><div><span class="authorgroup">Contribution de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Hukins</span></span>. </span></div></div></div><a id="idp86059088" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86059600"></a>29.10.1. Généralités</h3></div></div></div><p>Avec le temps, l'horloge d'un ordinateur tend à
	dériver.  Le protocole NTP (&#8220;Network Time
	Protocol&#8221;) est une des manières pour s'assurer
	que votre horloge reste précise.</p><p>De nombreux services Internet ont besoin, ou tirent
	partie, de la précision des horloges des ordinateurs.
	Par exemple, un serveur web, peut recevoir des requêtes
	pour n'envoyer un fichier que s'il a été
	modifié depuis un certain temps.  Sur un réseau
	local, il est essentiel que les ordinateurs partageant des
	fichiers à partir du même serveur de fichiers
	aient des horloges synchronisées de manière
	à ce que les dates de création ou de
	dernière modification d'un fichier
	(&#8220;timestamp&#8221;) soient cohérentes.  Des
	services comme <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> reposent sur une horloge
	système précise pour exécuter des
	commandes à des moments précis.</p><a id="idp86061776" class="indexterm"></a><p>FreeBSD est fourni avec le serveur NTP <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> qui peut
	être utilisé pour contacter d'autres serveurs NTP
	pour régler l'horloge de votre machine ou pour jouer le
	rôle de serveur de temps pour d'autres.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86064208"></a>29.10.2. Choisir les serveurs NTP appropriés</h3></div></div></div><a id="idp86064848" class="indexterm"></a><p>Afin de synchroniser votre horloge, vous devrez trouver un
	ou plusieurs serveurs NTP.  Votre administrateur réseau
	ou votre FAI peuvent avoir mis en place un serveur NTP dans
	cet objectif&#8212;consultez leur documentation pour voir si
	c'est le cas.  Il existe une <a class="link" href="http://ntp.isc.org/bin/view/Servers/WebHome" target="_top">liste
	en ligne de serveurs NTP accessibles par le public</a> que
	vous pouvez utiliser pour trouver un serveur NTP proche de
	vous.  Assurez-vous d'avoir pris connaissance de la politique
	d'utilisation des serveurs que vous choisissez, et demandez la
	permission si nécessaire.</p><p>Choisir plusieurs serveurs NTP non-connectés entre
	eux est une bonne idée au cas où un des serveurs
	que vous utilisez devient inaccessible ou que son horloge
	n'est plus fiable.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> utilise intelligemment les
	réponses qu'il reçoit d'autres serveurs&#8212;il
	favorisera les plus fiables par rapport aux moins
	fiables.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86072400"></a>29.10.3. Configuration de votre machine</h3></div></div></div><a id="idp86073040" class="indexterm"></a><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86074192"></a>29.10.3.1. Configuration de base</h4></div></div></div><a id="idp86074832" class="indexterm"></a><p>Si vous désirez synchroniser votre horloge
	  uniquement lors du démarrage de la machine, vous
	  pouvez alors employer <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a>.  Cela peut être
	  approprié pour certaines machines de bureau qui sont
	  fréquemment redémarrées et qui
	  ne nécessites qu'une synchronisation
	  épisodique, cependant la plupart des machines
	  devraient utiliser <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a>.</p><p>Utiliser <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> au moment du démarrage
	  est également une bonne idée pour les machines
	  qui exécutent <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a>.  Le programme
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> modifie l'horloge graduellement, alors que
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> change directement l'horloge, peu importe la
	  différence entre l'heure actuelle de la machine et
	  l'heure correcte.</p><p>Pour activer <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> au démarrage,
	  ajoutez la ligne <code class="literal">ntpdate_enable="YES"</code> au
	  fichier <code class="filename">/etc/rc.conf</code>.  Vous devrez
	  également préciser tous les serveurs avec
	  lesquels vous désirez vous synchroniser et tous les
	  indicateurs devant être passés à
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpdate&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpdate</span>(8)</span></a> avec
	  <code class="literal">ntpdate_flags</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86112720"></a>29.10.3.2. Configuration générale</h4></div></div></div><a id="idp86113360" class="indexterm"></a><p>NTP est configuré par l'intermédiaire du
	  fichier <code class="filename">/etc/ntp.conf</code> suivant le format
	  décrit dans la page de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a>.
	  Voici un exemple simple:</p><pre class="programlisting">server ntplocal.example.com prefer
server timeserver.example.org
server ntp2a.example.net

driftfile /var/db/ntp.drift</pre><p>L'option <code class="literal">server</code> précise quels
	  serveurs doivent être utilisés, avec un serveur
	  listé par ligne.  Si un serveur est
	  spécifié avec l'argument
	  <code class="literal">prefer</code>, comme c'est le cas pour <code class="systemitem">ntplocal.example.com</code>, ce serveur est
	  préféré par rapport aux autres
	  serveurs.  Une réponse en provenance d'un serveur
	  <span class="emphasis"><em>préféré</em></span> sera
	  ignorée si elle diffère de façon
	  significative des réponses des autres serveurs, sinon
	  elle sera utilisée sans considérer les autres
	  réponses.  L'argument <code class="literal">prefer</code> est
	  normalement employé pour les serveurs NTP qui sont
	  connus pour leur grande précision, comme ceux avec
	  des systèmes spéciaux de contrôle du
	  matériel.</p><p>L'option <code class="literal">driftfile</code> précise
	  quel fichier est utilisé pour stocker le
	  décalage de fréquence de l'horloge.  Le
	  programme <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> l'utilise pour compenser
	  automatiquement la dérive naturelle de l'horloge,
	  permettant de maintenir un réglage raisonnablement
	  correct même s'il est coupé d'autres sources
	  extérieures de temps pendant une certaine
	  période.</p><p>L'option <code class="literal">driftfile</code> précise
	  également quel fichier est utilisé pour
	  stocker l'information concernant les réponses
	  précédentes des serveurs NTP que vous
	  utilisez.  Il ne devrait pas être modifié par
	  un autre processus.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86125648"></a>29.10.3.3. Contrôler l'accès à votre
	  serveur</h4></div></div></div><p>Par défaut, votre serveur NTP sera accessible par
	  toutes les machines sur l'Internet.  L'option
	  <code class="literal">restrict</code> du fichier
	  <code class="filename">/etc/ntp.conf</code> vous permet de
	  contrôler quelles machines peuvent accéder
	  à votre serveur.</p><p>Si vous voulez refuser à tout le monde
	  l'accès à votre serveur NTP, ajoutez la ligne
	  suivante au fichier
	  <code class="filename">/etc/ntp.conf</code>:</p><pre class="programlisting">restrict default ignore</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Cela empêchera également à votre serveur d'accéder
	    à tout serveur listé dans votre configuration locale.
	    Si vous avez besoin de synchroniser votre serveur NTP avec
	    un serveur NTP externe, vous devez alors autoriser le
	    serveur en question.  Consultez la page de manuel de
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a> pour plus d'information.</p></div><p>Si vous désirez autoriser uniquement
	  l'accès aux machines de votre réseau pour
	  qu'elles puissent synchroniser leur horloge, tout en vous
	  assurant qu'elles ne peuvent configurer le serveur ou
	  être utilisées comme point de de
	  synchronisation, ajoutez:</p><pre class="programlisting">restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</pre><p>à la place, où <code class="systemitem">192.168.1.0</code> est une adresse IP de
	  votre réseau et <code class="systemitem">255.255.255.0</code> est votre masque de
	  sous-réseau.</p><p>Le fichier <code class="filename">/etc/ntp.conf</code> peut
	  contenir plusieurs options <code class="literal">restrict</code>.
	  Pour plus de détails, lisez la section
	  <code class="literal">Access Control Support</code> de la page de
	  manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntp.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ntp.conf</span>(5)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86139088"></a>29.10.4. Exécuter le serveur NTP</h3></div></div></div><p>Pour s'assurer que le serveur NTP est lancé au
	démarrage, ajoutez la ligne
	<code class="literal">ntpd_enable="YES"</code> dans le fichier
	<code class="filename">/etc/rc.conf</code>.  Si vous désirez
	passer des indicateurs supplémentaires à
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a>, éditez les paramètres de l'option
	<code class="varname">ntpd_flags</code> dans
	<code class="filename">/etc/rc.conf</code>.</p><p>Pour lancer le serveur sans redémarrer votre
	machine, exécutez <code class="command">ntpd</code> en
	étant sûr de préciser tout
	paramètre supplémentaire de
	<code class="varname">ntpd_flags</code> dans
	<code class="filename">/etc/rc.conf</code>.  Par exemple:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ntpd -p /var/run/ntpd.pid</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86149200"></a>29.10.5. Utiliser ntpd avec une connexion Internet
	temporaire</h3></div></div></div><p>Le programme <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a> n'a pas besoin d'une connexion
	permanente à l'Internet pour fonctionner correctement.
	Cependant, si vous disposez d'une connexion temporaire qui
	est configurée de telle sorte qu'il y ait
	établissement de la connexion à la demande,
	c'est une bonne idée d'empêcher le trafic NTP de
	déclencher la numérotation ou de maintenir
	constamment établie la connexion.  Si vous utilisez PPP
	en mode utilisateur, vous pouvez employer les directives
	<code class="literal">filter</code> dans le fichier
	<code class="filename">/etc/ppp/ppp.conf</code>.  Par exemple:</p><pre class="programlisting"> set filter dial 0 deny udp src eq 123
 # Empêche le trafic NTP de lancer une connexion
 set filter dial 1 permit 0 0
 set filter alive 0 deny udp src eq 123
 # Empêche le trafic NTP entrant de garder la connexion établie
 set filter alive 1 deny udp dst eq 123
 # Empêche le trafic NTP sortant de garder la connexion établie
 set filter alive 2 permit 0/0 0/0</pre><p>Pour plus de détails lisez la section
	<code class="literal">PACKET FILTERING</code> de la page de manuel
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> et les exemples du répertoire <code class="filename">/usr/share/examples/ppp/</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Certains fournisseurs d'accès Internet bloquent
	  les ports dont le numéro est faible, empêchant
	  NTP de fonctionner puisque les réponses n'atteignent
	  jamais votre machine.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86155088"></a>29.10.6. Information supplémentaire</h3></div></div></div><p>La documentation pour le serveur NTP peut être
	trouvée dans le répertoire <code class="filename">/usr/share/doc/ntp/</code> sous le format
	HTML.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-samba.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="network-servers.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="firewalls.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">29.9. Serveur de fichiers et d'impression pour clients
      <span class="trademark">Microsoft</span>® <span class="trademark">Windows</span>® (Samba) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> Chapitre 30. Firewalls ** Traduction en Cours **</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>