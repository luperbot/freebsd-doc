<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>27.3. Utiliser PPP intégré au noyau</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="ppp-and-slip.html" title="Chapitre 27. PPP et SLIP" /><link rel="prev" href="userppp.html" title="27.2. Using User PPP ** Traduction en Cours **" /><link rel="next" href="pppoe.html" title="27.4. Utiliser PPP sur Ethernet (PPPoE)" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">27.3. Utiliser PPP intégré au noyau</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="userppp.html">Précédent</a> </td><th width="60%" align="center">Chapitre 27. PPP et SLIP</th><td width="20%" align="right"> <a accesskey="n" href="pppoe.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ppp"></a>27.3. Utiliser PPP intégré au noyau</h2></div><div><span class="authorgroup">Contribution originale de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Gennady B.</span> <span class="surname">Sorokopud</span></span> et <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Robert</span> <span class="surname">Huff</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83451344"></a>27.3.1. Configurer PPP intégré au noyau</h3></div></div></div><a id="idp83451984" class="indexterm"></a><p>Avant de configurer PPP sur votre machine, vérifiez
	que <code class="command">pppd</code> est bien dans le répertoire
	<code class="filename">/usr/sbin</code> et que le
	répertoire <code class="filename">/etc/ppp</code> existe.</p><p>La commande <code class="command">pppd</code> peut fonctionner selon
	deux modes:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Comme &#8220;client&#8221; &#8212; si vous
	  désirez connecter votre machine au monde
	  extérieur via une liaison PPP série ou un
	  modem.</p></li><li class="listitem"><a id="idp83456592" class="indexterm"></a><p>Comme &#8220;serveur&#8221; &#8212; si votre machine
	  est sur le réseau, et sert à y connecter
	  d'autres ordinateurs avec PPP.</p></li></ol></div><p>Dans les deux cas, vous devrez renseigner un fichier
	d'options (<code class="filename">/etc/ppp/options</code> ou
	<code class="filename">~/.ppprc</code> si vous avez plus d'un
	utilisateur sur votre machine utilisant PPP).</p><p>Vous aurez également besoin d'un logiciel
	&#8220;modem/série&#8221; (de préférence
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/comms/kermit/pkg-descr">comms/kermit</a>), pour
	appeler et établir la connexion avec la machine
	distante.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83460048"></a>27.3.2. Utiliser <code class="command">pppd</code> comme client</h3></div><div><span class="authorgroup">Basé sur des informations fournies
	      par <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Trev</span> <span class="surname">Roydhouse</span></span>. </span></div></div></div><a id="idp83462864" class="indexterm"></a><a id="idp83463632" class="indexterm"></a><p>Le fichier <code class="filename">/etc/ppp/options</code> suivant
	pourrait être utilisé pour se connecter à la
	liaison PPP d'un concentrateur Cisco:</p><pre class="programlisting">crtscts         # contrôle de flux matériel
modem           # liaison par modem
noipdefault     # adresse IP affectée par le serveur PPP distant
                # si la machine distante ne vous donne pas d'adresse
                # IP lors de la négociation IPCP, retirez cette option
passive         # attendre les paquets LCP
domain ppp.foo.com      # mettre ici votre nom de domaine

:&lt;remote_ip&gt;    # mettre ici l'adresse IP de la machine PPP distante
                # elle servira à router des paquets via la liaison PPP
                # si vous n'avez pas précisé l'option noipdefault
                # changez cette ligne en &lt;ip_locale&gt;:&lt;ip_distante&gt;

defaultroute    # mettre cette ligne si vous voulez que le serveur PPP soit
                # votre routeur par défaut</pre><p>Pour se connecter:</p><a id="idp83474000" class="indexterm"></a><a id="idp83474512" class="indexterm"></a><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Appelez la machine distante en utilisant
	    <span class="application">kermit</span> (ou un autre programme
	    pour modem), puis entrez votre nom d'utilisateur et mot de
	    passe (ou ce qu'il faut pour activer PPP sur la machine
	    distante).</p></li><li class="step"><p>Quittez <span class="application">kermit</span> (sans
	    raccrocher la ligne).</p></li><li class="step"><p>Entrez la commande suivante:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/src/usr.sbin/pppd.new/pppd /dev/tty01 19200</code></strong></pre><p>Assurez-vous d'utiliser la vitesse et le nom de
	    périphérique adéquats.</p></li></ol></div><p>Votre ordinateur est maintenant connecté via PPP.
	Si la connexion échoue, vous pouvez ajouter l'option
	<code class="option">debug</code> au fichier
	<code class="filename">/etc/ppp/options</code>, et consulter les
	messages sur la console pour tracer le problème.</p><p>La procédure <code class="filename">/etc/ppp/pppup</code>
	ci-dessous effectuera automatiquement ces trois
	étapes:</p><pre class="programlisting">#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'arrêt de pppd, PID=' ${pid}
        kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'arrêt de kermit, PID=' ${pid}
        kill -9 ${pid}
fi

ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.dial
pppd /dev/tty01 19200</pre><a id="idp83482320" class="indexterm"></a><p><code class="filename">/etc/ppp/kermit.dial</code> est une
	procédure <span class="application">kermit</span> qui appelle
	et fournit toutes les informations d'authentification
	nécessaires à la machine distante (un exemple
	d'une telle procédure est donné à la fin de
	ce document).</p><p>Utilisez la procédure
	<code class="filename">/etc/ppp/pppdown</code> suivante pour terminer
	la session PPP et vous déconnecter:</p><pre class="programlisting">#!/bin/sh
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ X${pid} != "X" ] ; then
        echo 'arrêt de pppd, PID=' ${pid}
        kill -TERM ${pid}
fi

ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'arrêt de kermit, PID=' ${pid}
        kill -9 ${pid}
fi

/sbin/ifconfig ppp0 down
/sbin/ifconfig ppp0 delete
kermit -y /etc/ppp/kermit.hup
/etc/ppp/ppptest</pre><p>Vérifiez si <code class="command">pppd</code> tourne toujours
	en lançant la procédure
	<code class="filename">/usr/etc/ppp/ppptest</code>, qui devrait
	ressembler à ceci:</p><pre class="programlisting">#!/bin/sh
pid=`ps ax| grep pppd |grep -v grep|awk '{print $1;}'`
if [ X${pid} != "X" ] ; then
        echo 'pppd actif: PID=' ${pid-NONE}
else
        echo 'Pas de pppd en cours d'exécution.'
fi
set -x
netstat -n -I ppp0
ifconfig ppp0</pre><p>Pour raccrocher la ligne, exécutez
	<code class="filename">/etc/ppp/kermit.hup</code>, qui devrait
	contenir:</p><pre class="programlisting">set line /dev/tty01	; mettre ici le périphérique pour votre modem
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
echo \13
exit</pre><p>Voici une autre méthode qui utilise
	<code class="command">chat</code> au lieu de
	<code class="command">kermit</code>.</p><p>Les deux fichiers suivants suffisent à
	établir une connexion avec
	<code class="command">pppd</code>.</p><p><code class="filename">/etc/ppp/options</code>:</p><pre class="programlisting">/dev/cuaa1 115200

crtscts		# contrôle de flux matériel
modem		# liaison par modem
connect "/usr/bin/chat -f /etc/ppp/login.chat.script"
noipdefault	# adresse IP affectée par le serveur PPP distant
	        # si la machine distante ne vous donne pas d'adresse
	        # IP lors de la négociation IPCP, retirer cette option
passive	        # attendre les paquets LCP
domain &lt;your.domain&gt;	# mettre ici votre nom de domaine

:	        # mettre ici l'adresse IP de la machine PPP distante
	        # elle servira à router des paquets via la liaison PPP
	        # si vous n'avez pas précisé l'option noipdefault
	        # modifier cette ligne en &lt;ip_locale&gt;:&lt;ip_distante&gt;

defaultroute	# mettre cette ligne si vous voulez que le serveur PPP soit
	        # votre routeur par défaut</pre><p><code class="filename">/etc/ppp/login.chat.script</code>:</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ce qui suit doit être tapé sur une seule
	  ligne.</p></div><pre class="programlisting">ABORT BUSY ABORT 'NO CARRIER' "" AT OK ATDT&lt;numéro_de_téléphone&gt;
  CONNECT "" TIMEOUT 10 ogin:-\\r-ogin: &lt;nom_d_utilisateur&gt;
  TIMEOUT 5 sword: &lt;mot_de_passe&gt;</pre><p>Une fois que ces fichiers sont installés et
	correctement modifiés, tout ce dont vous avez besoin de
	faire est de lancer <code class="command">pppd</code>, comme
	suit:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pppd</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83494480"></a>27.3.3. Utiliser <code class="command">pppd</code> comme serveur</h3></div></div></div><p>Le contenu du fichier
	<code class="filename">/etc/ppp/options</code> devrait être
	semblable à ce qui suit:</p><pre class="programlisting">crtscts                         # contrôle de flux matériel
netmask 255.255.255.0           # masque de sous-réseau (facultatif)
192.114.208.20:192.114.208.165  # adresses IP des machines locales et distantes
                                # l'adresse locale ne doit pas être la même que
                                # celle que vous avez assignée à l'interface
                                # Ethernet (ou autre) de la machine.
                                # l'adresse IP de la machine distante est
                                # l'adresse IP qui lui sera affectée
domain ppp.foo.com              # votre nom de domaine
passive                         # attendre LCP
modem                           # liaison modem</pre><p>La procédure <code class="filename">/etc/ppp/pppserv</code>
	ci-dessous demandera à <span class="application">pppd</span>
	de se comporter comme un serveur:</p><pre class="programlisting">#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'arrêt de pppd, PID=' ${pid}
        kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'arrêt de kermit, PID=' ${pid}
        kill -9 ${pid}
fi

# réinitialiser l'interface ppp
ifconfig ppp0 down
ifconfig ppp0 delete

# activer le mode réponse automatique
kermit -y /etc/ppp/kermit.ans

# lancer ppp
pppd /dev/tty01 19200</pre><p>Utilisez cette procédure
	<code class="filename">/etc/ppp/pppservdown</code> pour arrêter
	le serveur:</p><pre class="programlisting">#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'arrêt de pppd, PID=' ${pid}
        kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
        echo 'arrêt de kermit, PID=' ${pid}
        kill -9 ${pid}
fi
ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.noans</pre><p>La procédure <span class="application">kermit</span>
	ci-dessous (<code class="filename">/etc/ppp/kermit.ans</code>) activera
	ou désactivera le mode réponse automatique de
	votre modem:</p><pre class="programlisting">set line /dev/tty01
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
inp 5 OK
echo \13
out ATS0=1\13   ; remplacer cela par ATS0=0\13 si vous voulez désactiver
                ; le mode réponse automatique
inp 5 OK
echo \13
exit</pre><p>Une procédure nommée
	<code class="filename">/etc/ppp/kermit.dial</code> est utilisée
	pour appeler et s'authentifier sur la machine distante.  Vous
	devrez l'adapter à vos besoins.  Mettez-y votre nom
	d'utilisateur et votre mot de passe; vous devrez
	également modifier les entrées en fonctions des
	réponses que vous envoient votre modem et la machine
	distante.</p><pre class="programlisting">;
; mettre ici la liaison série à laquelle est raccordé le modem:
;
set line /dev/tty01
;
; mettre ici la vitesse du modem:
;
set speed 19200
set file type binary            ; transfert 8 bits
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none
set modem hayes
set dial hangup off
set carrier auto                ; puis SET CARRIER si nécessaire,
set dial display on             ; puis SET DIAL si nécessaire,
set input echo on
set input timeout proceed
set input case ignore
def \%x 0                       ; compteur d'ouverture de session
goto slhup

:slcmd                          ; mettre le modem en mode commande
echo Put the modem in command mode.
clear                           ; vider le tampon d'entrée
pause 1
output +++                      ; séquence d'échappement Hayes
input 1 OK\13\10                ; attendre OK
if success goto slhup
output \13
pause 1
output at\13
input 1 OK\13\10
if fail goto slcmd              ; si le modem ne répond pas OK, réessayer

:slhup                          ; raccrocher la ligne
clear                           ; vider le tampon d'entrée
pause 1
echo Hanging up the phone.
output ath0\13                  ; commande Hayes pour raccrocher
input 2 OK\13\10
if fail goto slcmd              ; si pas de réponse OK, passer le modem en mode commande

:sldial                         ; composer le numéro
pause 1
echo Dialing.
output atdt9,550311\13\10       ; mettre ici le numéro de téléphone
assign \%x 0                    ; mettre le compteur à zéro

:look
clear                           ; vider le tampon d'entrée
increment \%x                   ; compter les secondes
input 1 {CONNECT }
if success goto sllogin
reinput 1 {NO CARRIER\13\10}
if success goto sldial
reinput 1 {NO DIALTONE\13\10}
if success goto slnodial
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if &lt; \%x 60 goto look
else goto slhup

:sllogin                        ; ouverture de session
assign \%x 0                    ; mettre le compteur à zéro
pause 1
echo Looking for login prompt.

:slloop
increment \%x                   ; compter les secondes
clear                           ; vider le tampon d'entrée
output \13
;
; put your expected login prompt here:
;
input 1 {Username: }
if success goto sluid
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if &lt; \%x 10 goto slloop         ; essayer 10 fois d'obtenir une invite de session
else goto slhup                 ; raccrocher et recommencer après 10 échecs

:sluid
;
; mettre ici votre nom d'utilisateur:
;
output nom-d-utilisateur-ppp\13
input 1 {Password: }
;
; mettre ici votre mot de passe:
;
output mot-de-passe-ppp\13
input 1 {Entering SLIP mode.}
echo
quit

:slnodial
echo \7Pas de tonalité.  Vérifiez votre ligne téléphonique!\7
exit 1

; local variables:
; mode: csh
; comment-start: "; "
; comment-start-skip: "; "
; end:</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="userppp.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="ppp-and-slip.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="pppoe.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">27.2. Using User PPP ** Traduction en Cours ** </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 27.4. Utiliser PPP sur Ethernet (PPPoE)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>