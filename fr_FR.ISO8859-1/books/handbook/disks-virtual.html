<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>19.13. Systèmes de fichiers réseaux, en mémoire et sauvegardés sur fichier</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="disks.html" title="Chapitre 19. Stockage des données" /><link rel="prev" href="backup-basics.html" title="19.12. Sauvegardes" /><link rel="next" href="snapshots.html" title="19.14. Instantané (&#8220;Snapshot&#8221;) d'un système de fichiers" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">19.13. Systèmes de fichiers réseaux, en mémoire
      et sauvegardés sur fichier</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="backup-basics.html">Précédent</a> </td><th width="60%" align="center">Chapitre 19. Stockage des données</th><td width="20%" align="right"> <a accesskey="n" href="snapshots.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-virtual"></a>19.13. Systèmes de fichiers réseaux, en mémoire
      et sauvegardés sur fichier</h2></div><div><span class="authorgroup">Réorganisée et augmentée par <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp80765520" class="indexterm"></a><a id="idp80766032" class="indexterm"></a><p>En plus des disques que vous introduisez physiquement
      dans votre ordinateur: disquettes, CD, disques durs, et ainsi
      de suite; d'autres formes de disques sont gérées
      par FreeBSD &#8212; les <em class="firstterm">disques
      virtuels</em>.</p><a id="idp80767952" class="indexterm"></a><a id="idp80768464" class="indexterm"></a><a id="idp80768976" class="indexterm"></a><p>Ceux-ci comprennent les systèmes de fichiers
      réseaux comme le <a class="link" href="network-nfs.html" title="29.3. Système de fichiers réseau (NFS)">NFS</a>
      et Coda, les systèmes de fichiers en mémoire et
      les systèmes de fichiers sauvegardé dans un
      fichier.</p><p>En fonction de la version de FreeBSD que vous utilisez,
      vous devrez utiliser des outils différents pour la
      création et l'utilisation de systèmes de fichiers
      en mémoire ou sauvegardé dans un
      fichier.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Utilisez <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a> pour
	allouer de façon transparente pour l'utilisateur
	les fichiers spéciaux de périphériques.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-mdconfig"></a>19.13.1. Système de fichiers sauvegardé dans un fichier</h3></div></div></div><a id="idp80773968" class="indexterm"></a><p>L'utilitaire <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a> est utilisé pour
	configurer et activer les disques mémoires,
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a>, sous FreeBSD.  Pour utiliser
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a>, vous devez charger le module <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a>
	ou en ajouter le support dans votre fichier de configuration
	du noyau:</p><pre class="programlisting">device md</pre><p>La commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a> supporte trois sortes
	de disques virtuels en mémoire: les disques mémoire
	alloués avec <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=malloc&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">malloc</span>(9)</span></a>, les disques mémoires
	utilisant un fichier ou l'espace de pagination comme
	espace disque.  Une des utilisations possibles est
	le montage d'images de disquettes ou de CDs conservées
	sous forme de fichier.</p><p>Pour monter l'image d'un système de fichiers:</p><div class="example"><a id="idp80781392"></a><div class="example-title">Exemple 19.4. Utilisation de <code class="command">mdconfig</code> pour monter
	  une image d'un système de fichiers</div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t vnode -f diskimage -u 0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/md0 /mnt</code></strong></pre></div></div><br class="example-break" /><p>Pour créer l'image d'un nouveau système de
	fichiers avec <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a>:</p><div class="example"><a id="idp80785488"></a><div class="example-title">Exemple 19.5. Création d'un nouveau disque sauvegardé sur
	  fichier avec <code class="command">mdconfig</code></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=newimage bs=1k count=5k</code></strong>
5120+0 records in
5120+0 records out
<code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t vnode -f newimage -u 0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -w md0 auto</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs md0a</code></strong>
/dev/md0a: 5.0MB (10224 sectors) block size 16384, fragment size 2048
        using 4 cylinder groups of 1.25MB, 80 blks, 192 inodes.
super-block backups (for fsck -b #) at:
 160, 2720, 5280, 7840
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/md0a /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df /mnt</code></strong>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0a       4710    4  4330     0%    /mnt</pre></div></div><br class="example-break" /><p>Si vous ne préciser pas de numéro d'unité
	avec l'option <code class="option">-u</code>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a>
	utilisera le mécanisme d'allocation automatique
	de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> pour sélectionner un
	périphérique libre.
	Le nom de l'unité allouée s'affichera sur
	la sortie standard comme par exemple
	<code class="filename">md4</code>.  Pour plus de détails concernant
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a>, référez-vous à la page de
	manuel.</p><p>L'outil <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a> est très utile, cependant
	son utilisation demande de nombreuses lignes de commandes
	pour créer un système de fichiers sauvegardé
	sur fichier.  FreeBSD vient avec un outil appelé
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdmfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdmfs</span>(8)</span></a>, ce programme configure un disque <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a>
	en utilisant <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a>, y ajoute dessus un
	système de fichiers UFS en utilisant <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a>, et le
	monte avec <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>.  Par exemple, si vous désirez
	créer et monter la même image de système de
	fichiers que précédemment, tapez simplement ce
	qui suit:</p><div class="example"><a id="idp80808656"></a><div class="example-title">Exemple 19.6. Création et montage d'un disque sauvegardé
	  sur fichier avec <code class="command">mdmfs</code></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=newimage bs=1k count=5k</code></strong>
5120+0 records in
5120+0 records out
<code class="prompt">#</code> <strong class="userinput"><code>mdmfs -F newimage -s 5m md0 /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df /mnt</code></strong>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0        4718    4  4338     0%    /mnt</pre></div></div><br class="example-break" /><p>Si vous utilisez l'option <code class="option">md</code> sans
	numéro d'unité, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdmfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdmfs</span>(8)</span></a> utilisera la fonction
	automatique de sélection d'unité de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> pour
	choisir un périphérique non utilisé.  Pour
	plus de détails au sujet de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdmfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdmfs</span>(8)</span></a>,
	référez-vous à la page de manuel.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disks-md-freebsd5"></a>19.13.2. Système de fichiers en mémoire</h3></div></div></div><a id="idp80820560" class="indexterm"></a><p>Pour un système de fichiers en mémoire la
	<span class="quote">« <span class="quote">sauvegarde sur l'espace de pagination</span> »</span> devrait
	être normalement utilisée.  Utiliser l'espace de
	pagination ne signifie pas que le disque en mémoire
	sera par défaut sur l'espace de pagination, mais
	plutôt que le disque mémoire sera alloué
	sur une zone de mémoire qui pourra être
	sauvegardée sur l'espace de pagination si
	nécessaire.  Il est également possible de
	créer un disque en mémoire dont la
	mémoire est allouée à l'aide de
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=malloc&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">malloc</span>(9)</span></a>, mais ce type de configuration, tout
	particulièrement dans le cas de disques de grande
	taille, peut donner lieu à une panique du
	système si le noyau se trouve à cours de
	mémoire.</p><div class="example"><a id="idp80831568"></a><div class="example-title">Exemple 19.7. Création d'un disque mémoire avec
	  <code class="command">mdconfig</code></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t swap -s 5m -u 1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs -U md1</code></strong>
/dev/md1: 5.0MB (10240 sectors) block size 16384, fragment size 2048
        using 4 cylinder groups of 1.27MB, 81 blks, 192 inodes.
        with soft updates
super-block backups (for fsck -b #) at:
 160, 2752, 5344, 7936
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/md1 /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df /mnt</code></strong>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md1        4718    4  4338     0%    /mnt</pre></div></div><br class="example-break" /><div class="example"><a id="idp80835920"></a><div class="example-title">Exemple 19.8. Création d'un disque mémoire avec
	  <code class="command">mdmfs</code></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdmfs -s 5m md2 /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df /mnt</code></strong>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md2        4846    2  4458     0%    /mnt</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80838864"></a>19.13.3. Détacher un disque mémoire du système</h3></div></div></div><a id="idp80847824" class="indexterm"></a><p>Quand un système de fichiers en mémoire ou
	sauvegardé dans un fichier n'est pas utilisé,
	vous devriez rendre au système toutes les ressources.
	La première chose à faire est de démonter le
	système de fichiers, ensuite utiliser <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a>
	pour détacher le disque du système et rendre les
	ressources.</p><p>Par exemple pour détacher et libérer
	toutes les ressources utilisées par
	<code class="filename">/dev/md4</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -d -u 4</code></strong></pre><p>Il est possible d'afficher des informations
	sur les périphériques <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> configurés
	en utilisant la commande <code class="command">mdconfig
	-l</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="backup-basics.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="snapshots.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">19.12. Sauvegardes </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 19.14. Instantané (&#8220;Snapshot&#8221;) d'un système de fichiers</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>