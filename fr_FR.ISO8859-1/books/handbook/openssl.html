<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>15.9. OpenSSL</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="security.html" title="Chapitre 15. Sécurité" /><link rel="prev" href="kerberos5.html" title="15.8. Kerberos5 ** Traduction en Cours **" /><link rel="next" href="ipsec.html" title="15.10. IPsec" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">15.9. OpenSSL</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kerberos5.html">Précédent</a> </td><th width="60%" align="center">Chapitre 15. Sécurité</th><td width="20%" align="right"> <a accesskey="n" href="ipsec.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="openssl"></a>15.9. OpenSSL</h2></div><div><span class="authorgroup">Ecrit par <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp78740688" class="indexterm"></a><p>Une des caractéristiques que de nombreux utilisateurs
      ignorent souvent est la présence des outils
      <span class="application">OpenSSL</span> dans le système FreeBSD.
      <span class="application">OpenSSL</span> fournit une couche de
      transport des données chiffrée par-dessus la
      couche de communication, lui permettant ainsi d'être
      liée à de nombreux services et applications
      réseau.</p><p>Les applications d'<span class="application">OpenSSL</span>
      pourront être l'authentification chiffrée de
      clients de messagerie, les transactions via le Web comme les
      paiements par carte bancaire et bien plus encore.  De nombreux
      logiciels portés tels que <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/apache13-ssl/pkg-descr">www/apache13-ssl</a>, et <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/mail/sylpheed-claws/pkg-descr">mail/sylpheed-claws</a> offriront un
      support pour <span class="application">OpenSSL</span> lors de leur
      compilation.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Dans la plupart des cas le catalogue des logiciels
	portés tentera de compiler le logiciel porté
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/openssl/pkg-descr">security/openssl</a> à
	moins que la variable <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>
	<code class="varname">WITH_OPENSSL_BASE</code> ne soit explicitement
	fixée à la valeur <span class="quote">« <span class="quote">yes</span> »</span>.</p></div><p>La version d'<span class="application">OpenSSL</span> fournie avec
      FreeBSD supporte les protocoles de sécurité
      réseau <span class="emphasis"><em>Secure Sockets Layer v2/v3</em></span>
      (SSLv2/SSLv3), et <span class="emphasis"><em>Transport Layer Security
      v1</em></span> (TLSv1) et peut être utilisée comme
      bibliothèque de chiffrement d'usage
      général.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Bien que <span class="application">OpenSSL</span> supporte
	l'algorithme <acronym class="acronym">IDEA</acronym>, il est
	désactivé par défaut en raison des
	problèmes de brevets aux USA.  Pour l'utiliser, le
	texte de la licence devrait être consulté et si
	les termes de cette licence sont acceptables, la variable
	<code class="varname">MAKE_IDEA</code> doit être activée
	dans le fichier <code class="filename">make.conf</code>.</p></div><p>Une des utilisations les plus courantes
      d'<span class="application">OpenSSL</span> est de fournir des
      certificats utilisables avec des applications logicielles.  Ces
      certificats assurent que les références de la
      société ou d'un individu sont valides et non
      frauduleuses.  Si le certificat en question n'a pas
      été vérifié par une des nombreuses
      <span class="quote">« <span class="quote">autorité de certification</span> »</span>
      (<span class="quote">« <span class="quote">Certificate Authorities</span> »</span>) ou
      <acronym class="acronym">CA</acronym>s, une alerte est
      généralement produite.  Une autorité de
      certification est une société, comme <a class="link" href="http://www.verisign.com" target="_top">VeriSign</a>, qui signera les
      certificats afin de valider les références
      d'individus ou de sociétés.  Ce processus a un
      coût et n'est pas obligatoire pour utiliser des
      certificats, cependant cela pourra mettre plus à l'aise
      les utilisateurs les plus paranoïaques.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78754000"></a>15.9.1. Générer des certificats</h3></div></div></div><a id="idp78754768" class="indexterm"></a><p>Pour générer un certificat, la commande
	suivante est disponible:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -new -nodes -out req.pem -keyout cert.pem</code></strong>
Generating a 1024 bit RSA private key
................++++++
.......................................++++++
writing new private key to 'cert.pem'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:<strong class="userinput"><code>US</code></strong>
State or Province Name (full name) [Some-State]:<strong class="userinput"><code>PA</code></strong>
Locality Name (eg, city) []:<strong class="userinput"><code>Pittsburgh</code></strong>
Organization Name (eg, company) [Internet Widgits Pty Ltd]:<strong class="userinput"><code>My Company</code></strong>
Organizational Unit Name (eg, section) []:<strong class="userinput"><code>Systems Administrator</code></strong>
Common Name (eg, YOUR name) []:<strong class="userinput"><code>localhost.example.org</code></strong>
Email Address []:<strong class="userinput"><code>trhodes@FreeBSD.org</code></strong>

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:<strong class="userinput"><code>SOME PASSWORD</code></strong>
An optional company name []:<strong class="userinput"><code>Another Name</code></strong></pre><p>Notez la réponse à la question <span class="quote">« <span class="quote">Common
	Name</span> »</span> qui est un nom de domaine.  Cette question
	demande l'entrée d'un serveur de noms à des fins
	de vérification; entrer autre chose qu'un nom de
	domaine produira un certificat inutilisable.  D'autres options
	sont disponibles comme par exemple: la date d'expiration, des
	algorithmes de chiffrement alternatifs, etc.  Une liste
	complète peut être obtenue en consultant la page
	de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=openssl&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">openssl</span>(1)</span></a>.</p><p>Deux fichiers doivent maintenant être
	présents dans le répertoire dans lequel la
	commande a été exécutée.  La
	demande de certificat, <code class="filename">req.pem</code>, peut
	être envoyée à une autorité de
	certification qui validera les références que
	vous avez saisies, signera la demande et vous retournera le
	certificat.  Le deuxième fichier s'appellera
	<code class="filename">cert.pem</code> et sera la clé
	privée du certificat et devra être à tout
	prix protégée; si ce fichier tombe dans d'autres
	mains, il pourra être utilisé pour imiter votre
	identité (ou votre serveur).</p><p>Pour les cas où une signature d'une
	<acronym class="acronym">CA</acronym> n'est pas indispensable, un certificat
	auto-signé peut être créé.
	Générez tout d'abord la clé
	<acronym class="acronym">RSA</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl dsaparam -rand -genkey -out myRSA.key 1024</code></strong></pre><p>Générez ensuite la clé de la
	<acronym class="acronym">CA</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl gendsa -des3 -out myca.key myRSA.key</code></strong></pre><p>Utilisez cette clé pour créer le
	certificat:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -new -x509 -days 365 -key myca.key -out new.crt</code></strong></pre><p>Deux fichiers devraient être présents
	maintenant dans le répertoire: un fichier de signature
	de l'autorité de certification,
	<code class="filename">myca.key</code>, et le certificat
	lui-même, <code class="filename">new.crt</code>.  Ces fichiers
	doivent être placés dans un répertoire, de
	préférence sous <code class="filename">/etc</code>, qui est uniquement lisible
	que par <code class="systemitem">root</code>.  Les permissions 0700
	devraient convenir et peuvent être fixées
	à l'aide de l'utilitaire
	<code class="command">chmod</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78787664"></a>15.9.2. Utilisation des certificats, un exemple</h3></div></div></div><p>A quoi peuvent servir ces fichiers?  Un bon exemple serait
	le chiffrage des connexions au <acronym class="acronym">MTA</acronym>
	<span class="application">sendmail</span>.  Cela permettra de faire
	disparaître l'utilisation d'une authentification en
	clair pour les utilisateurs qui envoient du courrier via le
	<acronym class="acronym">MTA</acronym> local.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ce n'est pas la meilleure utilisation au monde
	  étant donné que certains clients de messagerie
	  afficheront une erreur si le certificat n'a pas
	  été installé localement.  Reportez-vous
	  à la documentation du logiciel pour plus
	  d'information sur l'installation de certificats.</p></div><p>Les lignes suivantes doivent être ajoutées
	dans le fichier <code class="filename">.mc</code> local:</p><pre class="programlisting">dnl SSL Options
define(`confCACERT_PATH',`/etc/certs')dnl
define(`confCACERT',`/etc/certs/new.crt')dnl
define(`confSERVER_CERT',`/etc/certs/new.crt')dnl
define(`confSERVER_KEY',`/etc/certs/myca.key')dnl
define(`confTLS_SRV_OPTIONS', `V')dnl</pre><p>Où <code class="filename">/etc/certs/</code> est le
	répertoire à utiliser pour stocker localement
	les certificats et les clés.  La dernière
	condition nécessaire étant une reconstruction du
	fichier <code class="filename">.cf</code>.  Cela se fait facilement en
	tapant <code class="command">make</code> <em class="parameter"><code>install</code></em>
	à l'intérieur du répertoire <code class="filename">/etc/mail</code>.  Suivi d'un
	<code class="command">make</code> <em class="parameter"><code>restart</code></em> qui
	devrait relancer le <span class="quote">« <span class="quote">daemon</span> »</span>
	<span class="application">sendmail</span>.</p><p>Si tout s'est bien passé il n'y aura pas de message
	d'erreur dans le fichier <code class="filename">/var/log/maillog</code>
	et <span class="application">sendmail</span> apparaîtra dans
	la liste des processus.</p><p>Comme test simple, connectez vous au serveur de messagerie
	à l'aide de l'utilitaire <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnet&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">telnet</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>telnet example.com 25</code></strong>
Trying 192.0.34.166...
Connected to <code class="systemitem">example.com</code>.
Escape character is '^]'.
220 <code class="systemitem">example.com</code> ESMTP Sendmail 8.12.10/8.12.10; Tue, 31 Aug 2004 03:41:22 -0400 (EDT)
<strong class="userinput"><code>ehlo example.com</code></strong>
250-example.com Hello example.com [192.0.34.166], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH LOGIN PLAIN
250-STARTTLS
250-DELIVERBY
250 HELP
<strong class="userinput"><code>quit</code></strong>
221 2.0.0 <code class="systemitem">example.com</code> closing connection
Connection closed by foreign host.</pre><p>Si la ligne <span class="quote">« <span class="quote">STARTTLS</span> »</span> apparaît dans la
	sortie, cela signifie alors que tout fonctionne
	correctement.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kerberos5.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="ipsec.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">15.8. <span class="application">Kerberos5</span> ** Traduction en Cours ** </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 15.10. IPsec</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>