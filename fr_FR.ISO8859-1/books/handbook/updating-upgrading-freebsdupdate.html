<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>24.2. Mise à jour de FreeBSD</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="updating-upgrading.html" title="Chapitre 24. Mise à jour de FreeBSD" /><link rel="prev" href="updating-upgrading.html" title="Chapitre 24. Mise à jour de FreeBSD" /><link rel="next" href="updating-upgrading-portsnap.html" title="24.3. Portsnap: un outil de mise à jour du catalogue des logiciels portés" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">24.2. Mise à jour de FreeBSD</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="updating-upgrading.html">Précédent</a> </td><th width="60%" align="center">Chapitre 24. Mise à jour de FreeBSD</th><td width="20%" align="right"> <a accesskey="n" href="updating-upgrading-portsnap.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="updating-upgrading-freebsdupdate"></a>24.2. Mise à jour de FreeBSD</h2></div><div><span class="authorgroup">Ecrit par <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Basé sur des notes de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Colin</span> <span class="surname">Percival</span></span>. </span></div></div></div><a id="idp82318032" class="indexterm"></a><a id="idp82318544" class="indexterm"></a><p>Appliquer des correctifs de sécurité est une
      part importante de la maintenance de logiciels informatiques
      tout particulièrement dans le cas du système
      d'exploitation.  Pendant très longtemps sous FreeBSD, ce
      processus n'était pas aisé.  Les correctifs
      devaient être appliqués au code source, le code
      ensuite recompilé sous forme de binaires, et enfin les
      binaires devaient être ré-installés.</p><p>Ce processus n'est plus de mise comme FreeBSD dispose
      désormais d'un utilitaire appelé simplement
      <code class="command">freebsd-update</code>.  Cet utilitaire fournit deux
      fonctions distinctes.  Tout d'abord, il permet l'application de
      mises à jour de correction et de sécurité
      sur le système de base de FreeBSD sans nécessiter une
      compilation et une ré-installation.  En second lieu,
      l'utilitaire supporte les mises à jour mineures et
      majeures des versions publiées.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Les mise à jour binaires sont disponibles pour
	toutes les architectures actuellement supportées par
	l'équipe de sécurité.  Avant de mettre
	à jour vers une nouvelle version, les annonces
	concernant la version devront être passées en
	revue sachant qu'elles peuvent contenir des informations
	importantes au sujet de cette version.  Ces annonces peuvent
	être consultées à l'adresse suivante:
	<code class="uri"><a class="uri" href="http://www.FreeBSD.org/releases/" target="_top">http://www.FreeBSD.org/releases/</a></code>.</p></div><p>S'il existe une table <code class="command">crontab</code> utilisant
      <code class="command">freebsd-update</code>, elle doit être
      désactivée avant de démarrer les
      opérations qui vont suivre.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-config-file"></a>24.2.1. Le fichier de configuration</h3></div></div></div><p>Certains utilisateurs peuvent souhaiter adapter le fichier
	de configuration par défaut
	<code class="filename">/etc/freebsd-update.conf</code>, permettant un
	meilleur contrôle du processus.  Les options sont
	très bien documentées, mais les suivantes
	demandent un peu plus d'explication:</p><pre class="programlisting"># Composants du système de base qui doivent être maintenus à jour.
Components src world kernel</pre><p>Ce paramètre contrôle quelles sont les
	parties de FreeBSD qui seront mises à jour.  Par
	défaut on met à jour le code source,
	l'intégralité du système de base et le
	noyau.  Les composants sont les mêmes que ceux
	disponibles durant l'installation, par exemple, ajouter
	<code class="literal">world/games</code> ici permettrait d'appliquer les
	correctifs relatifs aux jeux.  Utiliser
	<code class="literal">src/bin</code> permettrait la mise à jour
	du code source du répertoire <code class="filename">src/bin</code>.</p><p>La meilleure option est de laisser telle quelle la
	configuration par défaut car la modifier pour ajouter
	des éléments particuliers demandera à
	l'utilisateur de lister chaque élément qu'il
	désire mettre à jour.  Cela pourrait avoir des
	conséquences désastreuses puisque le code source
	et les binaires peuvent à terme ne plus être en
	phase.</p><pre class="programlisting"># Les chemins d'accès commençant par quelque chose correspondant à une
# entrée de type IgnorePaths seront ignorés.
IgnorePaths</pre><p>Ajoute les chemins d'accès comme <code class="filename">/bin</code> ou <code class="filename">/sbin</code> pour préserver
	intacts ces répertoires durant le processus de mise
	à jour.  Cette option peut être utilisée
	pour empêcher <code class="command">freebsd-update</code>
	d'écraser des modifications locales.</p><pre class="programlisting"># Les chemins d'accès qui commencent par quelque chose correspondant à
# une entrée de type UpdateIfUnmodified seront mis à jour que si le
# contenu du fichier n'a pas été modifié par l'utilisateur (à moins
# que les modifications ne soient fusionnées; voir plus bas).
UpdateIfUnmodified /etc/ /var/ /root/ /.cshrc /.profile</pre><p>Met à jour les fichiers de configuration dans les
	répertoires désignés seulement s'ils
	n'ont pas été modifiés.  Tout changement
	effectué par l'utilisateur invalidera automatiquement
	la mise à jour de ces fichiers.  Il existe une autre
	option <code class="literal">KeepModifiedMetadata</code> qui indiquera
	à <code class="command">freebsd-update</code> de sauvegarder les
	changements durant la fusion.</p><pre class="programlisting"># Quand on met à jour vers une nouvelle version de FreeBSD, les fichiers
# correspondant à une entrée de type MergeChanges verront leurs
# différences locales fusionnées avec le fichier de la nouvelle
# version de FreeBSD.
MergeChanges /etc/ /var/named/etc/</pre><p>Liste des répertoires avec des fichiers de
	configuration que <code class="command">freebsd-update</code> devrait
	tenter de fusionner.  Le processus de fusion des fichiers est
	l'application d'une série de correctifs <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a>
	similaires à ceux de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> avec cependant
	moins d'options, les fusions sont soit acceptées,
	ouvrant un éditeur, soit abandonnées par
	<code class="command">freebsd-update</code>.  En cas de doute,
	sauvegardez <code class="filename">/etc</code> et
	acceptez les fusions.  Consultez la section sur <a class="xref" href="makeworld.html#mergemaster" title="24.6.11.1. mergemaster">Section 24.6.11.1, « <code class="command">mergemaster</code> »</a> pour plus d'information sur la commande
	<code class="command">mergemaster</code>.</p><pre class="programlisting"># Répertoire dans lequel stocker les mise à jour téléchargées et les
# fichiers temporaires utilisés par la mise à jour de FreeBSD.
# WorkDir /var/db/freebsd-update</pre><p>Ce répertoire est l'endroit où tous les
	correctifs et les fichiers temporaires seront placés.
	Dans les cas où l'utilisateur effectue une mise
	à jour de version, cet emplacement doit disposer d'au
	moins un gigaoctet d'espace disponible.</p><pre class="programlisting"># Lors de mises à jour entre versions de FreeBSD, doit-on lire la liste
# de composants de manière stricte (StrictComponents yes)
# ou tout simplement comme une liste de composants qui *pourraient*
# être installés et pour lesquels la mise à jour de FreeBSD devrait
# déterminer lesquels sont effectivement installés et les mettre à
# jour (StrictComponents no)?
# StrictComponents no</pre><p>Cette option fixée à <code class="literal">yes</code>,
	<code class="command">freebsd-update</code> supposera que la liste de
	composants est complète et n'essaiera pas d'effectuer
	des modifications en dehors de cette liste.
	Concrètement, <code class="command">freebsd-update</code> tentera
	de mettre à jour chaque fichier appartenant à la
	liste de composants.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-security-patches"></a>24.2.2. Correctifs de sécurité</h3></div></div></div><p>Les correctifs de sécurité sont
	stockés sur une machine distante et peuvent être
	téléchargés et installés en
	utilisant la commande suivante:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update fetch</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><p>Si des correctifs ont été appliqués
	au noyau le système devra être
	redémarré.  Si tout s'est bien passé le
	système est corrigé et
	<code class="command">freebsd-update</code> pourra être
	exécuté chaque nuit via un processus
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>.  Une entrée dans le fichier
	<code class="filename">/etc/crontab</code> devrait être
	suffisante pour accomplir cette tâche:</p><pre class="programlisting">@daily                                  root    freebsd-update cron</pre><p>Cette entrée indique qu'une fois par jour,
	l'utilitaire <code class="command">freebsd-update</code> sera
	exécuté.  De cette manière, en employant
	l'option <code class="option">cron</code>,
	<code class="command">freebsd-update</code> vérifiera seulement
	l'existence de mises à jour.  Si des correctifs
	existent, il seront automatiquement
	téléchargés sur le disque local mais
	non-appliqués.  L'utilisateur <code class="systemitem">root</code>
	sera contacté par courrier électronique, il
	pourra ainsi les installer manuellement.</p><p>Si quelque s'est mal passé,
	<code class="command">freebsd-update</code> a la capacité
	d'annuler le dernier ensemble de changements avec la commande
	suivante:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update rollback</code></strong></pre><p>Une fois la commande achevée, le système
	devra être redémarré si le noyau ou un de
	ses modules ont été modifiés.  Cela
	permettra à FreeBSD de charger en mémoire les
	nouveaux binaires.</p><p>L'utilitaire <code class="command">freebsd-update</code> peut mettre
	à jour uniquement et automatiquement le noyau
	<code class="literal">GENERIC</code>.  Si un noyau personnalisé
	est utilisé, il devra être recompilé et
	réinstallé après que la commande
	<code class="command">freebsd-update</code> ait achevé
	l'installation du reste des mises à jour.  Cependant
	<code class="command">freebsd-update</code> détectera et mettra
	à jour le noyau <code class="literal">GENERIC</code> dans
	<code class="filename">/boot/GENERIC</code> (s'il
	existe), et cela même si ce n'est pas le noyau actuel
	(qui tourne) du système.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">C'est toujours une bonne idée de conserver une
	  copie du noyau <code class="literal">GENERIC</code> dans <code class="filename">/boot/GENERIC</code>.  Cela sera utile
	  pour diagnostiquer une variété de
	  problèmes, et lors des mises à jour utilisant
	  <code class="command">freebsd-update</code> comme décrit dans
	  la <a class="xref" href="updating-upgrading-freebsdupdate.html#freebsdupdate-upgrade" title="24.2.3. Mises à jour mineures et majeures">Section 24.2.3, « Mises à jour mineures et majeures »</a>.</p></div><p>A moins que la configuration par défaut
	présente dans
	<code class="filename">/etc/freebsd-update.conf</code> n'ait
	été modifiée,
	<code class="command">freebsd-update</code> installera les sources du
	noyau mises à jour avec le reste des mises à
	jour.  La recompilation et la réinstallation d'un noyau
	personnalisé peuvent effectuées de la
	manière classique.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Les mises à jour distribuées via
	  <code class="command">freebsd-update</code>, n'impliquent pas toujours
	  le noyau.  Il ne sera pas nécessaire de recompiler
	  votre noyau personnalisé si les sources du noyau
	  n'ont pas été modifiées par
	  l'exécution de <code class="command">freebsd-update
	  install</code>.  Cependant
	  <code class="command">freebsd-update</code> met toujours à jour
	  le fichier
	  <code class="filename">/usr/src/sys/conf/newvers.sh</code>.  Le
	  niveau ou la version de correctifs (comme indiqué par
	  le nombre <code class="literal">-p</code> rapporté par
	  <code class="command">uname -r</code>) est obtenu à partir de
	  ce fichier.  Recompiler votre noyau personnalisé,
	  même si rien d'autre n'a changé, permettra
	  à la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=uname&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">uname</span>(1)</span></a> de rapporter
	  précisément le niveau de correctifs du
	  système.  C'est particulièrement utile quand
	  on gère de multiples systèmes, car cela permet
	  une évaluation rapide des mises à jour
	  présentes sur chacun d'eux.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-upgrade"></a>24.2.3. Mises à jour mineures et majeures</h3></div></div></div><p>Ce processus supprimera les anciens fichiers objets et
	bibliothèques qui rendent inutilisables la plupart des
	applications tierce-partie.  Il est recommandé que tous
	les logiciels portés soient supprimés et
	réinstallés ou mis à jour
	ultérieurement en utilisant l'outil <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portupgrade/pkg-descr">ports-mgmt/portupgrade</a>.  La plupart
	des utilisateurs voudront lancer une compilation test à
	l'aide de la commande suivante:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portupgrade -af</code></strong></pre><p>Cela garantira que tout sera réinstallé
	correctement.  Notez que fixer la variable d'environnement
	<code class="varname">BATCH</code> à <code class="literal">yes</code>
	répondra <code class="literal">yes</code> à toute question
	lors de ce processus, supprimant ainsi la
	nécessité d'une intervention humaine durant le
	processus de compilation.</p><p>Si un noyau personnalisé est utilisé, le
	processus de mise à jour est un peu plus complexe.  Une
	copie du noyau <code class="literal">GENERIC</code> est
	nécessaire et devrait être placée dans le
	répertoire <code class="filename">/boot/GENERIC</code>.  Si le noyau
	<code class="literal">GENERIC</code> n'est pas présent sur le
	système, il peut être obtenu en utilisant une des
	méthodes suivantes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Si un noyau personnalisé a déjà
	    été compilé, le noyau présent
	    dans <code class="filename">/boot/kernel.old</code> est en fait
	    le noyau <code class="literal">GENERIC</code>.  Renommer ce
	    répertoire en <code class="filename">/boot/GENERIC</code>.</p></li><li class="listitem"><p>En supposant qu'un accès physique à la
	    machine est possible, une copie du noyau
	    <code class="literal">GENERIC</code> peut être installé
	    à partir d'un CD-ROM.  Insérer votre disque
	    d'installation et utiliser les commandes suivantes:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /cdrom</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /cdrom/X.Y-RELEASE/kernels</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>./install.sh GENERIC</code></strong></pre><p>Remplacer <code class="filename">X.Y-RELEASE</code>
	    avec la version que vous utilisez.  Le noyau
	    <code class="literal">GENERIC</code> sera installé par
	    défaut dans <code class="filename">/boot/GENERIC</code>.</p></li><li class="listitem"><p>En dehors de ce qui précède le noyau
	    <code class="literal">GENERIC</code> peut être
	    recompilé et installé à partir des
	    sources:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>env DESTDIR=/boot/GENERIC make kernel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv /boot/GENERIC/boot/kernel/* /boot/GENERIC</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -rf /boot/GENERIC/boot</code></strong></pre><p>Pour que ce noyau soit pris en compte comme
	    <code class="literal">GENERIC</code> par
	    <code class="command">freebsd-update</code>, le fichier de
	    configuration <code class="literal">GENERIC</code> devra ne pas
	    avoir été modifié.  Il est
	    également suggéré qu'il soit
	    compilé sans aucune option particulière (de
	    préférence avec un fichier
	    <code class="filename">/etc/make.conf</code> vide).</p></li></ul></div><p>Redémarrer avec le noyau <code class="literal">GENERIC</code>
	n'est pas nécessaire à ce stade.</p><p>Les mises à jour de versions majeures et mineures
	peuvent être effectuées en passant à la
	commande <code class="command">freebsd-update</code> la version vers
	laquelle on désire mettre à jour, par exemple,
	la commande suivante effectuera la mise à jour vers
	FreeBSD 8.1:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update -r 8.1-RELEASE upgrade</code></strong></pre><p>La commande <code class="command">freebsd-update</code> analysera le
	fichier de configuration et le système afin de
	récupérer les informations nécessaires
	à la mise à jour du système.  A
	l'écran s'affichera quels sont les composants
	détectés et quels sont ceux qui n'ont pas
	été détectés.  Par exemple:</p><pre class="screen">Looking up update.FreeBSD.org mirrors... 1 mirrors found.
Fetching metadata signature for 8.0-RELEASE from update1.FreeBSD.org... done.
Fetching metadata index... done.
Inspecting system... done.

The following components of FreeBSD seem to be installed:
kernel/smp src/base src/bin src/contrib src/crypto src/etc src/games
src/gnu src/include src/krb5 src/lib src/libexec src/release src/rescue
src/sbin src/secure src/share src/sys src/tools src/ubin src/usbin
world/base world/info world/lib32 world/manpages

The following components of FreeBSD do not seem to be installed:
kernel/generic world/catpages world/dict world/doc world/games
world/proflibs

Does this look reasonable (y/n)? y</pre><p>A ce niveau <code class="command">freebsd-update</code> tentera de
	télécharger tous les fichiers nécessaires
	à la mise à jour.  Dans certains cas
	l'utilisateur sera interrogé sur ce qu'il faut
	installer ou sur comment procéder à certaines
	actions.</p><p>Si un noyau personnalisé est utilisé,
	l'étape précédente produira un
	avertissement semblable au suivant:</p><pre class="screen">WARNING: This system is running a "<em class="replaceable"><code>MYKERNEL</code></em>" kernel, which is not a
kernel configuration distributed as part of FreeBSD 8.0-RELEASE.
This kernel will not be updated: you MUST update the kernel manually
before running "/usr/sbin/freebsd-update install"</pre><p>Cet avertissement peut sans risque être
	ignoré à ce niveau.  Le noyau
	<code class="filename">GENERIC</code> mis à jour sera
	utilisé comme une étape intermédiaire
	dans le processus de mise à jour.</p><p>Une fois l'ensemble des correctifs
	téléchargé sur le système local,
	ils seront appliqués.  Ce processus peut prendre plus
	ou moins de temps en fonction de la vitesse et de la charge de
	la machine.  Les fichiers de configuration seront
	fusionnés &#8212; cette partie du processus
	demande l'intervention de l'utilisateur car un fichier peut
	être automatiquement fusionné ou en cas de besoin
	un éditeur peut apparaître sur l'écran
	pour une fusion manuelle.  Les résultats des fusions
	réussies seront affichés au fur et à
	mesure que se déroule l'opération.  Un
	échec ou une fusion ignorée provoqueront
	l'arrêt du processus.  Certains utilisateurs peuvent
	vouloir conserver une sauvegarde du répertoire
	<code class="filename">/etc</code> et fusionner plus
	tard à la main les fichiers importants comme
	<code class="filename">master.passwd</code> ou
	<code class="filename">group</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Le système n'a pas encore été
	  réellement modifié, les fusions et
	  l'application des correctifs ont lieu dans un autre
	  répertoire.  Quand tous les correctifs ont
	  été appliqués avec succès, que
	  tous les fichiers de configuration ont été
	  fusionnés et que le processus s'est
	  déroulé sans problème, les
	  modifications devront être appliquées
	  définitivement au système par
	  l'utilisateur.</p></div><p>Une fois les opérations précédentes
	achevées, la mise à jour peut être
	appliquée en utilisant la commande suivante:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><p>Le noyau et les modules seront corrigés les
	premiers.  A ce moment la machine doit être
	obligatoirement redémarrée.  Si le
	système utilisait un noyau personnalisé,
	utiliser la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=nextboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">nextboot</span>(8)</span></a> pour indiquer le noyau
	<code class="filename">/boot/GENERIC</code> (qui a
	été mis à jour) pour le prochain
	démarrage:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>nextboot -k GENERIC</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Avertissement: </h3><p xmlns="http://www.w3.org/1999/xhtml">Avant de redémarrer sur le noyau
	  <code class="literal">GENERIC</code>, assurez-vous qu'il contient tous
	  les pilotes nécessaires pour que votre système
	  démarre correctement (et se connecte au
	  réseau, si la mise à jour de la machine se
	  fait à distance).  En particulier, si le noyau
	  précédemment utilisé contient des
	  fonctions généralement fournies par des
	  modules, faites en sorte de charger temporairement ces
	  modules avec le noyau <code class="filename">GENERIC</code> à
	  l'aide de <code class="filename">/boot/loader.conf</code>.  Vous
	  pouvez également avoir intérêt à
	  désactiver les services non-indispensables, les
	  montages réseaux ou disques, etc.  avant que le
	  processus de mise à jour ne soit
	  achevé.</p></div><p>La machine doit maintenant être
	redémarrée avec le noyau mis à
	jour:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre><p>Une fois la machine de nouveau active,
	<code class="command">freebsd-update</code> devra être
	lancée à nouveau.  L'état du processus de
	mise à jour a été sauvegardé, et
	donc <code class="command">freebsd-update</code> ne recommencera pas au
	début, mais supprimera les anciens fichiers objet et
	bibliothèques partagées.  Afin de poursuivre les
	opérations, taper la commande suivante:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">En fonction d'un changement ou non de
	  numérotation d'une ou plusieurs bibliothèques,
	  il pourra y avoir deux phases d'installation au lieu de
	  trois.</p></div><p>Tous les logiciels tierce-partie doivent être
	maintenant recompilés et réinstallés.
	Cela est nécessaire comme certains logiciels peuvent
	dépendre de bibliothèques qui ont
	été supprimées lors du processus de mise
	à jour.  La commande <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portupgrade/pkg-descr">ports-mgmt/portupgrade</a> peut
	être employée pour automatiser la chose.  Les
	commandes suivantes peuvent être utilisées pour
	initier le processus:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portupgrade -f ruby</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm /var/db/pkg/pkgdb.db</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>portupgrade -f ruby18-bdb</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm /var/db/pkg/pkgdb.db /usr/ports/INDEX-*.db</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>portupgrade -af</code></strong></pre><p>Une fois cela effectué, terminer le processus de
	mise à jour avec un dernier appel à
	<code class="command">freebsd-update</code>.  Taper la commande suivante
	pour régler les derniers détails:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update install</code></strong></pre><p>Si le noyau <code class="literal">GENERIC</code> a été
	utilisé temporairement, il est temps de compiler et
	d'installer un nouveau noyau personnalisé suivant la
	méthode habituelle.</p><p>Redémarrer la machine avec la nouvelle version de
	FreeBSD.  Le processus de mise à jour est
	terminé.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="freebsdupdate-system-comparison"></a>24.2.4. Comparaison de l'état du système</h3></div></div></div><p>L'utilitaire <code class="command">freebsd-update</code> peut
	être utilisé pour comparer l'état du
	système FreeBSD installé avec une copie de
	confiance.  Cette fonctionnalité inspecte la version
	actuelle des utilitaires système, des
	bibliothèques et des fichiers de configuration.  Pour
	lancer la comparaison, utiliser la commande suivante:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>freebsd-update IDS &gt;&gt; outfile.ids</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Avertissement: </h3><p xmlns="http://www.w3.org/1999/xhtml">Bien que le nom de la commande soit
	  <acronym class="acronym">IDS</acronym>, elle ne devrait en aucun cas
	  être considérée comme un système
	  de détection d'intrusion du type de <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/snort/pkg-descr">security/snort</a>.  Etant
	  donné que <code class="command">freebsd-update</code> stocke
	  des données sur le disque, le risque de modification
	  des données est évident.  Alors que cette
	  possibilité peut être minimisée en
	  utilisant le paramétrage
	  <code class="varname">kern.securelevel</code> et en stockant les
	  données <code class="command">freebsd-update</code> sur un
	  système de fichiers en lecture seule quand elles ne
	  sont pas utilisées, une bien meilleure solution
	  serait de comparer le système avec un disque
	  sécurisé comme un <acronym class="acronym">DVD</acronym> ou un
	  disque <acronym class="acronym">USB</acronym> conservé à
	  l'extérieur.</p></div><p>Le système sera analysé, et une liste de
	fichiers ainsi que la valeur de leur empreinte
	numérique <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sha256&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">sha256</span>(1)</span></a>, celle de la version d'origine
	et celle de la version actuellement installée, seront
	affichés.  C'est pour cela que cet affichage est
	copié dans le fichier <code class="filename">outfile.ids</code>.
	L'affichage défile trop rapidement une comparaison
	visuelle et remplira rapidement le tampon de la
	console.</p><p>Ces lignes sont également très longues mais
	le format de sortie peut être facilement passé
	par une analyse syntaxique.  Par exemple, pour obtenir une
	liste des fichiers qui diffèrent avec ceux de la
	version d'origine, utiliser la commande suivante:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat outfile.ids | awk '{ print $1 }' | more</code></strong>
/etc/master.passwd
/etc/motd
/etc/passwd
/etc/pf.conf</pre><p>La sortie de cette commande a été
	tronquée, bien plus de fichiers sont concernés.
	Certains de ces fichiers sont naturellement modifiés,
	le fichier <code class="filename">/etc/passwd</code> a
	été modifié en raison de l'ajout
	d'utilisateurs au système.  Dans certains cas, d'autres
	fichiers apparaîtrons, comme les modules du noyau, qui
	diffèrent puisque <code class="command">freebsd-update</code>
	peut les avoir mis à jour.  Pour exclure des fichiers
	ou des répertoires spécifiques, ajoutez-les au
	paramètre <code class="literal">IDSIgnorePaths</code> dans le
	fichier <code class="filename">/etc/freebsd-update.conf</code>.</p><p>Ce système peut prendre part à une
	méthode de mise à jour élaboré, en
	dehors de ce qui a été présenté
	précédemment.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="updating-upgrading.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="updating-upgrading.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="updating-upgrading-portsnap.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">Chapitre 24. Mise à jour de FreeBSD </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 24.3. Portsnap: un outil de mise à jour du catalogue des
      logiciels portés</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>