<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>5.4. Compiler avec cc</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Livre de chevet du développeur FreeBSD" /><link rel="up" href="tools.html" title="Chapitre 5. Outils de programmation" /><link rel="prev" href="ch05s03.html" title="5.3. Introduction à la programmation" /><link rel="next" href="ch05s05.html" title="5.5. Make" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.4. Compiler avec <code class="command">cc</code></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch05s03.html">Précédent</a> </td><th width="60%" align="center">Chapitre 5. Outils de programmation</th><td width="20%" align="right"> <a accesskey="n" href="ch05s05.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp64020816"></a>5.4. Compiler avec <code class="command">cc</code></h2></div></div></div><p>Cette section traite uniquement du compilateur GNU pour C et C++,
      celui-ci faisant partie du système FreeBSD de base. Il peut être invoqué
      soit par <code class="command">cc</code> ou <code class="command">gcc</code>. Les
      détails de production d'un programme avec un interpréteur varient
      considérablement d'un interpréteur à l'autre, et sont habituellement
      bien couverts par la documentation et l'aide en ligne de l'interpréteur.</p><p>Une fois que vous avez écrit votre chef d'oeuvre, la prochaine étape est
      de le convertir en quelque chose qui s'exécutera (espérons !) sur FreeBSD.
      Cela implique normalement plusieurs étapes, réalisées chacune par un programme
      différent.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Pré-traiter votre code source pour retirer les commentaires et faire
	  d'autres trucs comme développer (expanser) les macros en C.</p></li><li class="step"><p>Vérifier la syntaxe de votre code source pour voir si vous avez
	obéi aux règles du langage. Si vous ne l'avez pas fait, il se plaindra !</p></li><li class="step"><p>Convertir le code source en langage assembleur&#8212;
	cela est vraiment proche du code machine, mais reste
	  compréhensible par des humains. Prétendument.

	  <a href="#ftn.idp64037328" class="footnote" id="idp64037328"><sup class="footnote">[2]</sup></a></p></li><li class="step"><p>Convertir le langage  assembleur en code machine
	  &#8212;ouais, on parle de bits et d'octets, de uns et
	  de zéros.</p></li><li class="step"><p>Vérifier que vous avez utilisé des choses comme des fonctions et
	des variables globales de façon consistente. Par exemple, si vous
	  avez appelé une fonction inexistente, le compilateur se plaindra.</p></li><li class="step"><p>Si vous essayez de produire un exécutable depuis plusieurs
	  fichiers de code source, résoudre comment les faire fonctionner
	  ensemble.</p></li><li class="step"><p>Résoudre comment produire quelque chose que le chargeur au vol
	du système sera capable de charger en mémoire et exécuter.</p></li><li class="step"><p>Finalement, écrire l'exécutable dans le système de fichiers.</p></li></ol></div><p>Le mot <em class="firstterm">compilation</em> est souvent utilisé pour
      les étapes 1 à 4 seules&#8212;les autres correspondent au terme
      <em class="firstterm">liaison</em>. Quelquefois, l'étape 1 est appelée
      <em class="firstterm">pre-traitement</em> et les étapes 3-4 <em class="firstterm">assemblage</em>.</p><p>Heureusement, la plupart de ces détails vous sont cachés, étant donné que
    <code class="command">cc</code> est un frontal qui s'occupe d'appeler tous les
      programmes avec les arguments corrects pour vous; tapez simplement</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc foobar.c</code></strong>
    </pre><p>compilera <code class="filename">foobar.c</code> avec toutes les étapes au-dessus.
    Si vous avez plus d'un fichier à compiler, faites simplement
      quelque chose comme</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc foo.c bar.c</code></strong>
    </pre><p>Notez que la vérification de syntaxe n'est que cela&#8212;vérifier
      la syntaxe. Cela ne vérifiera pas les erreurs de logique que vous pouvez
      avoir faites, comme mettre le programme en boucle infinie ou
      utiliser un tri à bulles quand vous devriez utiliser un tri binaire.

      <a href="#ftn.idp64074704" class="footnote" id="idp64074704"><sup class="footnote">[3]</sup></a></p><p>Il y a beaucoup d'options pour <code class="command">cc</code>, qui
      qui se trouvent toutes dans les pages de manuel en ligne.
      Voici quelques unes des plus importantes, avec des exemples illustrant leur
      utilisation.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-o <em class="replaceable"><code>nom_du_fichier</code></em></code></span></dt><dd><p>Le nom de sortie du fichier.  Si vous n'utilisez pas cette option,
	  <code class="command">cc</code> produira un exécutable appelé
	    <code class="filename">a.out</code>.

	    <a href="#ftn.idp64092752" class="footnote" id="idp64092752"><sup class="footnote">[4]</sup></a></p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc foobar.c</code></strong>               <em class="lineannotation"><span class="lineannotation">l'exécutable est a.out</span></em>
<code class="prompt">%</code> <strong class="userinput"><code>cc -o foobar foobar.c</code></strong>     <em class="lineannotation"><span class="lineannotation">l'exécutable est foobar</span></em>
	    </pre></div></dd><dt><span class="term"><code class="option">-c</code></span></dt><dd><p>Compile juste le fichier, ne le lie pas. Utile pour les
	    programmes jouets dont vous voulez juste vérifier la syntaxe,
	    ou si vous utilisez un <code class="filename">Makefile</code>.</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -c foobar.c</code></strong>
	    </pre></div><p>Cela va produire un <em class="firstterm">fichier objet</em> (pas un
	    exécutable) appelé <code class="filename">foobar.o</code>. Celui-ci
	    peut être lié ensuite avec d'autres fichiers objets pour produire un
	    exécutable.</p></dd><dt><span class="term"><code class="option">-g</code></span></dt><dd><p>Crée une version de déverminage de l'exécutable. Cela oblige
	    le compilateur à placer des informations dans l'exécutable comme
	    telle ligne du fichier source correspond à tel appel de fonction.
	    Un dévermineur peut utiliser cette information pour vous montrer
	    le code source au fur et à mesure que vous avancez pas à pas dans le programme,
	    ce qui est <span class="emphasis"><em>très</em></span> utile; le désavantage est que
	    toutes ces informations supplémentaires rendent le programme plus gros.
	    Normalement, vous compilez avec l'option <code class="option">-g</code> quand vous
	    êtes en train de développer un programme et compilez ensuite une
	    <span class="quote">« <span class="quote">version de production</span> »</span> sans <code class="option">-g</code> quand vous êtes
	    satisfait du fonctionnement.</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -g foobar.c</code></strong>
	    </pre></div><p>Cela va produire une version de déverminage du programme foobar.

	    <a href="#ftn.idp64131664" class="footnote" id="idp64131664"><sup class="footnote">[5]</sup></a></p></dd><dt><span class="term"><code class="option">-O</code></span></dt><dd><p>Crée une version optimisée de l'exécutable. Le compilateur
	    effectue différents trucs malins pour essayer de produire
	    un exécutable qui s'exécute plus rapidement que normal.
	    Vous pouvez ajouter un nombre après l'option <code class="option">-O</code>
	    pour spécifier un niveau d'optimisation plus important, mais cela vous expose
	    souvent aux bogues dans l'optimiseur du compilateur. Par exemple, la version de
	    <code class="command">cc</code> fournit avec la version 2.1.0 FreeBSD est connue
	    pour produire du mauvais code avec l'option <code class="option">-O2</code>
	    dans certaines circonstances.</p><p>L'optimisation est habituellement activée uniquement lors de
	  la compilation d'une version de production.</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -O -o foobar foobar.c</code></strong>
	    </pre></div><p>Cela va produire une version optimisée de
	    <code class="filename">foobar</code>.</p></dd></dl></div><p>Les trois prochaines options vont forcer <code class="command">cc</code>
      à vérifier que votre code est conforme au standard international en cours,
      se référant souvent à la norme <acronym class="acronym">ANSI</acronym>, qui pour dire précisement
      est un standard <acronym class="acronym">ISO</acronym>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-Wall</code></span></dt><dd><p>Active tous les avertissements que les auteurs de
	    <code class="command">cc</code> pensent valoir le coup. Malgré le nom, il
	    n'active pas tous les avertissements dont <code class="command">cc</code>
	    est capable.</p></dd><dt><span class="term"><code class="option">-ansi</code></span></dt><dd><p>Désactive la plupart, mais pas toutes, des caractéristiques
	    du C fournies par <code class="command">cc</code> qui sont non-<acronym class="acronym">ANSI</acronym> . Malgré
	    le nom, cela ne garantit pas strictement que votre code sera conforme au standard.</p></dd><dt><span class="term"><code class="option">-pedantic</code></span></dt><dd><p>Désactive <span class="emphasis"><em>toutes</em></span>
	    les caractéristiques de <code class="command">cc</code> qui ne sont pas <acronym class="acronym">ANSI</acronym> .</p></dd></dl></div><p>Sans ces options, <code class="command">cc</code> vous permettrait d'utiliser
      quelques extensions au standard non-standards. Quelques unes de celles-ci
      sont très utiles, mais ne fonctionneront pas avec d'autres compilateurs
      &#8212;en fait, un des principaux buts du standard est de permettre aux gens
      d'écrire du code qui fonctionnera avec n'importe quel compilateur sur
      n'importe quel système. Cela est connu sous le nom de <em class="firstterm">code portable</em>.</p><p>Generalement, vous devriez essayer de faire votre code aussi portable
    que possible, sinon vous pourriez avoir a ré-écrire totalement votre
    programme plus tard pour le faire fonctionner autre part&#8212;et qui
      sait ce que vous utiliserez dans quelques années?</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -Wall -ansi -pedantic -o foobar foobar.c</code></strong>
      </pre></div><p>Cela produira un exécutable <code class="filename">foobar</code>
      après avoir vérifié que <code class="filename">foobar.c</code> est conforme au standard.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-l<em class="replaceable"><code>librairie</code></em></code></span></dt><dd><p>Spécifie une librairie de fonctions à utiliser lors
	  de l'édition des liens.</p><p>L'exemple le plus commun de cela est lors de la compilation
	  d'un programme qui utilise quelques fonctions mathématiques en C.
	  A l'inverse de la plupart des plateformes, celles-ci se trouvent dans
	  une librairie standard du C et vous devez dire au compilateur de l'ajouter.
	  </p><p>La règle est que si une librairie est appelée
	    <code class="filename">libquelque_chose.a</code>,
	    vous donnez à  <code class="command">cc</code> l'argument
	    <code class="option">-l<em class="replaceable"><code>quelque_chose</code></em></code>.
	    Par exemple, la librairie des fonctions mathématiques est
	    <code class="filename">libm.a</code>, aussi vous donnez à
	    <code class="command">cc</code> le paramètre  <code class="option">-lm</code>.
	    Un <span class="quote">« <span class="quote">piège</span> »</span> habituel avec la librairie math est
	    qu'elle doit être la dernière sur la ligne de commande.</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -o foobar foobar.c -lm</code></strong>
	    </pre></div><p>Cela va lier les fonctions de la librairie math à l'interieur de
	    <code class="filename">foobar</code>.</p><p>Si vous compilez du C++; vous devrez ajouter
	    <code class="option">-lg++</code>, ou <code class="option">-lstdc++</code> si
	    vous utilisez FreeBSD 2.2 ou ultérieur, à la ligne de commande de
	    <code class="command">cc</code> pour lier avec les fonctions de la librairie C++.
	    Alternativement, vous pouvez utiliser <code class="command">c++</code> plutôt
	    que <code class="command">cc</code>, qui fait tout cela pour vous.
	    <code class="command">c++</code> peut aussi être invoqué par
	    <code class="command">g++</code> sur FreeBSD.</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -o foobar foobar.cc -lg++</code></strong>     <em class="lineannotation"><span class="lineannotation">Pour FreeBSD 2.1.6 et antérieur</span></em>
<code class="prompt">%</code> <strong class="userinput"><code>cc -o foobar foobar.cc -lstdc++</code></strong>  <em class="lineannotation"><span class="lineannotation">Pour FreeBSD 2.2 et ultérieur</span></em>
<code class="prompt">%</code> <strong class="userinput"><code>c++ -o foobar foobar.cc</code></strong>
	    </pre></div><p>Chacune de ces commandes va produire un exécutable
	    <code class="filename">foobar</code> à partir du fichier source C++
	    <code class="filename">foobar.cc</code>. Notez que, sur les systèmes Unix
	    , les fichiers source C++ se terminent traditionnellement en
	    <code class="filename">.C</code>, <code class="filename">.cxx</code> ou
	    <code class="filename">.cc</code>, plutôt que le style MS-DOS
	    <code class="filename">.cpp</code> (qui était déjà
	    utilisé pour autre chose).  <code class="command">gcc</code> a utilisé cela
	    pour trouver le type de compilateur à utiliser sur le fichier source;
	    toutefois, cette restriction ne s'applique plus,
	    aussi vous pouvez maintenant appeler vos fichiers C++
	    <code class="filename">.cpp</code> en toute impunité !</p></dd></dl></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64268112"></a>5.4.1. Questions et problèmes usuels sur <code class="command">cc</code></h3></div></div></div><div class="qandaset"><a id="idp64271440"></a><dl><dt>5.4.1.1. <a href="ch05s04.html#idp64272464">J'essaye d'écrire un programme qui utilise la fonction
	      sin() et je reçois l'erreur suivante.
	      Que cela signifie-t-il ?</a></dt><dt>5.4.1.2. <a href="ch05s04.html#idp64302672">J'ai écrit un programme simple pour m'exercer à
	    l'utilisation de l'option -lm. Tout ce qu'il fait
	    est d'élever 2,1 à la puissance 6.</a></dt><dt>5.4.1.3. <a href="ch05s04.html#idp64321616">Alors comment puis-je le réparer?</a></dt><dt>5.4.1.4. <a href="ch05s04.html#idp64349136">J'ai compilé un fichier appelé
	      foobar.c et je ne trouve pas d'exécutable
	      appelé foobar. Où est-il parti?</a></dt><dt>5.4.1.5. <a href="ch05s04.html#idp64365136">OK, j'ai un exécutable appelé
	      foobar, je peux le voir en exécutant
	      ls, mais quand je tape
	      foobar à l'invite de commandes, la réponse
	      est qu'il n'y a pas de tel fichier. Pourquoi le système ne le trouve pas?
	    </a></dt><dt>5.4.1.6. <a href="ch05s04.html#idp64396496">J'ai appelé mon exécutable test,
	    mais rien ne se passe quand je l'exécute. Que se passe-t-il?
	    </a></dt><dt>5.4.1.7. <a href="ch05s04.html#idp64412112">J'ai compilé mon programme et il semble fonctionner au premier abord,
	    puis il y a une erreur et le système a dit quelque chose comme
	    core dumped. Que cela signifie-t-il?</a></dt><dt>5.4.1.8. <a href="ch05s04.html#idp64429648">Fascinant, mais que suis-je supposé faire ?</a></dt><dt>5.4.1.9. <a href="ch05s04.html#idp64437200">Quand mon programme a généré un fichier core,
	    il a parlé d'une erreur segmentation fault.
	    Qu'est-ce que c'est ?</a></dt><dt>5.4.1.10. <a href="ch05s04.html#idp64485584">Des fois quand je reçoit une erreur core dump,
	    il est précisé bus error.
	    Il est dit dans mon livre Unix qu'il s'agit d'un problème matériel
	    mais l'ordinateur semble toujours fonctionner. Est-ce vrai ?
	    </a></dt><dt>5.4.1.11. <a href="ch05s04.html#idp64491600">Toute cette affaire de fichier core semble être
	    assez utile, si je peux le faire apparaître quand je le désire.
	    Puis-je faire cela, ou dois-je attendre la prochaine erreur ?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp64272464"></a><a id="idp64273488"></a><p><strong>5.4.1.1.</strong></p></td><td align="left" valign="top"><p>J'essaye d'écrire un programme qui utilise la fonction
	      <code class="function">sin()</code> et je reçois l'erreur suivante.
	      Que cela signifie-t-il ?</p><div class="informalexample"><pre class="screen">/var/tmp/cc0143941.o: Undefined symbol `_sin' referenced from text segment
	      </pre></div></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Lors de l'utilisation des fonctions mathématiques comme
	      <code class="function">sin()</code>, vous devez dire à
	      <code class="command">cc</code> de lier avec la librairie math, comme :</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -o foobar foobar.c -lm</code></strong>
	      </pre></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp64302672"></a><a id="idp64303696"></a><p><strong>5.4.1.2.</strong></p></td><td align="left" valign="top"><p>J'ai écrit un programme simple pour m'exercer à
	    l'utilisation de l'option <code class="option">-lm</code>. Tout ce qu'il fait
	    est d'élever 2,1 à la puissance 6.</p><div class="informalexample"><pre class="programlisting">#include &lt;stdio.h&gt;

int main() {
	float f;

	f = pow(2.1, 6);
	printf("2.1 ^ 6 = %f\n", f);
	return 0;
}
	      </pre></div><p>j'ai effectué la compilation comme suit :</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc temp.c -lm</code></strong>
	      </pre></div><p>et comme expliqué ici, mais j'obtiens ceci
	    quand je l'exécute :</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>./a.out</code></strong>
2.1 ^ 6 = 1023.000000
	      </pre></div><p>Ce <span class="emphasis"><em>n'est pas</em></span> la réponse correcte !
	      Que se passe-t-il ?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Quand le compilateur voit que vous appelez une fonction, il
	    vérifie s'il a déjà un prototype pour celle-ci.
	    S'il ne l'a pas vu, il suppose que la fonction retourne un <span class="type">int</span>,
	    ce qui n'est absolument  pas ce que vous voulez ici.
	    </p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp64321616"></a><a id="idp64321872"></a><p><strong>5.4.1.3.</strong></p></td><td align="left" valign="top"><p>Alors comment puis-je le réparer?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Les prototypes des fonctions mathématiques sont dans
	      <code class="filename">math.h</code>. Si vous incluez ce fichier,
	      le compilateur sera capable de trouver le prototype et il
	      arrêtera de faire des trucs étranges à vos calculs!
	      </p><div class="informalexample"><pre class="programlisting">#include &lt;math.h&gt;
#include &lt;stdio.h&gt;

int main() {
...
	      </pre></div><p>Après avoir recompilé comme précédemment,
	    exécutez :
	    </p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>./a.out</code></strong>
2.1 ^ 6 = 85.766121
	      </pre></div><p>Si vous utilisez quelques fonctions mathématiques que ce soit,
	    incluez <span class="emphasis"><em>toujours</em></span> <code class="filename">math.h</code> et n'oubliez pas
	    de lier avec la librairie math.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp64349136"></a><a id="idp64349392"></a><p><strong>5.4.1.4.</strong></p></td><td align="left" valign="top"><p>J'ai compilé un fichier appelé
	      <code class="filename">foobar.c</code> et je ne trouve pas d'exécutable
	      appelé <code class="filename">foobar</code>. Où est-il parti?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Souvenez-vous, <code class="command">cc</code> appellera
	    l'exécutable <code class="filename">a.out</code> sauf si vous lui dites
	    de faire autrement. Utilisez l'option
	      <code class="option">-o <em class="replaceable"><code>nomfichier</code></em></code>:</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -o foobar foobar.c</code></strong>
	      </pre></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp64365136"></a><a id="idp64366160"></a><p><strong>5.4.1.5.</strong></p></td><td align="left" valign="top"><p>OK, j'ai un exécutable appelé
	      <code class="filename">foobar</code>, je peux le voir en exécutant
	      <code class="command">ls</code>, mais quand je tape
	      <code class="command">foobar</code> à l'invite de commandes, la réponse
	      est qu'il n'y a pas de tel fichier. Pourquoi le système ne le trouve pas?
	    </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>A l'inverse de MS-DOS, Unix ne regarde pas dans le
	    répertoire courant lorsqu'il essaye de trouver un
	    exécutable que vous voulez exécuter, sauf si
	    vous lui avez dit de le faire.
	    Vous pouvez soit taper <code class="command">./foobar</code>, ce qui
	    signifie <span class="quote">« <span class="quote">exécute le fichier nommé
	    <code class="filename">foobar</code> dans le répertoire courant</span> »</span>,
	    soit changer votre variable d'environnement <code class="envar">PATH</code>
	    de façon à ce qu'elle ressemble à quelque chose comme
	    </p><div class="informalexample"><pre class="screen">bin:/usr/bin:/usr/local/bin:.
	      </pre></div><p>Le point à la fin signifie <span class="quote">« <span class="quote">regarde dans le repertoire
	    courant s'il n'est dans aucun autre</span> »</span>.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp64396496"></a><a id="idp64397264"></a><p><strong>5.4.1.6.</strong></p></td><td align="left" valign="top"><p>J'ai appelé mon exécutable <code class="filename">test</code>,
	    mais rien ne se passe quand je l'exécute. Que se passe-t-il?
	    </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>La plupart des systèmes Unix ont un programme appelé
	      <code class="command">test</code> dans <code class="filename">/usr/bin</code>
	      et l'interpréteur prend celui-ci avant de vérifier dans
	      le répertoire courant. Soit vous tapez
	      </p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>./test</code></strong>
	      </pre></div><p>soit vous choisissez un meilleur nom pour votre programme !!
	    </p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp64412112"></a><a id="idp64413008"></a><p><strong>5.4.1.7.</strong></p></td><td align="left" valign="top"><p>J'ai compilé mon programme et il semble fonctionner au premier abord,
	    puis il y a une erreur et le système a dit quelque chose comme
	    <span class="errorname">core dumped</span>. Que cela signifie-t-il?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Le nom <em class="firstterm">core dump</em> date
	    des tous premiers jours d'Unix, quand les machines utilisaient
	    la mémoire centrale<a href="#ftn.idp64418128" class="footnote" id="idp64418128"><sup class="footnote">[6]</sup></a>pour stocker
	    les données.
	    Simplement, si le programme a échoué sous certaines conditions,
	    le système va écrire le contenu de la mémoire centrale
	    sur le disque dans un fichier appelé
	    <code class="filename">core</code>, que le programmeur peut ensuite
	    examiner de près pour trouver ce qui s'est mal passé.
	    </p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp64429648"></a><a id="idp64429904"></a><p><strong>5.4.1.8.</strong></p></td><td align="left" valign="top"><p>Fascinant, mais que suis-je supposé faire ?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Utilisez <code class="command">gdb</code> pour analyser le fichier <code class="filename">core</code>
	    (voir <a class="xref" href="debugging.html" title="5.6. Déverminer">Section 5.6, « Déverminer »</a>).</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp64437200"></a><a id="idp64438096"></a><p><strong>5.4.1.9.</strong></p></td><td align="left" valign="top"><p>Quand mon programme a généré un fichier <code class="filename">core</code>,
	    il a parlé d'une erreur <span class="errorname">segmentation fault</span>.
	    Qu'est-ce que c'est ?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Cela signifie simplement que votre programme a essayé
	    d'effectuer une opération illégale sur la mémoire;
	    Unix est conçu pour protéger le système d'exploitation
	    et les autres programmes des programmes crapuleux.
	    </p><p>Les causes habituelles de cela sont :</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Essayer d'écrire dans un pointeur <span class="symbol">NULL</span>,
		par exemple
		</p><pre class="programlisting">char *foo = NULL;
strcpy(foo, "bang!");
		</pre></li><li class="listitem"><p>Utiliser un pointeur qui n'a pas été initialisé,
		par exemple</p><pre class="programlisting">char *foo;
strcpy(foo, "bang!");
		</pre><p>Le pointeur va avoir une valeur aléatoire qui
		avec de la chance, pointera dans une zone de la mémoire qui
		n'est pas disponible pour votre programme et le noyau va tuer
		votre programme avant qu'il ne fasse des dommages. Si
		vous êtes malchanceux, il pointera quelque part dans votre
		propre programme et altèrera une de vos structures de données,
		faisant planter votre programme mystérieusement.
		</p></li><li class="listitem"><p>Essayer d'accèder la mémoire au-delà de la fin
		d'un tableau,
		par exemple</p><pre class="programlisting">int bar[20];
bar[27] = 6;
		</pre></li><li class="listitem"><p>Essayer de stocker quelque chose dans la mémoire en lecture seule,
		par exemple</p><pre class="programlisting">char *foo = "Ma chaine";
strcpy(foo, "bang!");
		</pre><p>Les compilateurs Unix mettent souvent les chaînes comme
		<code class="literal">"Ma chaine"</code> dans des zones de mémoire
		en lecture seule.
		</p></li><li class="listitem"><p>Faire des trucs sales avec
		  <code class="function">malloc()</code> et
		  <code class="function">free()</code>, par exemple</p><pre class="programlisting">char bar[80];
free(bar);
		</pre><p>ou</p><pre class="programlisting">char *foo = malloc(27);
free(foo);
free(foo);
		</pre></li></ul></div><p>Faire une de ces fautes ne conduit pas toujours
	    à une erreur, mais elles sont toujours de mauvais entrainements.
	    Certains systèmes et compilateurs sont plus tolérants que d'autres,
	    ce qui explique pourquoi des programmes qui fonctionnent bien sur un système
	    peuvent planter si vous les essayer sur un autre.
	    </p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp64485584"></a><a id="idp64486224"></a><p><strong>5.4.1.10.</strong></p></td><td align="left" valign="top"><p>Des fois quand je reçoit une erreur <span class="errorname">core dump</span>,
	    il est précisé <span class="errorname">bus error</span>.
	    Il est dit dans mon livre Unix qu'il s'agit d'un problème matériel
	    mais l'ordinateur semble toujours fonctionner. Est-ce vrai ?
	    </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Non, heureusement non (sauf si bien sûr vous avez réellement
	    un problème matériel&#8230;). Cela est habituellement une
	    manière de dire que vous avez accédé à la mémoire
	    d'une façon que vous n'auriez pas dû.
	    </p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp64491600"></a><a id="idp64492240"></a><p><strong>5.4.1.11.</strong></p></td><td align="left" valign="top"><p>Toute cette affaire de fichier <code class="filename">core</code> semble être
	    assez utile, si je peux le faire apparaître quand je le désire.
	    Puis-je faire cela, ou dois-je attendre la prochaine erreur ?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Oui, ouvrez une autre console ou xterm, faites</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ps</code></strong>
	    </pre><p>pour trouver l'identifiant du processus de votre programme, et faites
	    </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>kill -ABRT identifiant</code></strong>
	    </pre><p>où
	      <em class="parameter"><code><em class="replaceable"><code>identifiant</code></em></code></em> est
	      l'identifiant du processus que vous avez trouvé.</p><p>Ceci est utile si votre programme est bloqué dans une boucle
	    infinie, par exemple. Si votre programme arrive à bloquer le signal
	    <span class="symbol">SIGABRT</span>, il y a d'autres signaux qui ont des effets
	    similaires.
	    </p><p>Alternativement, vous pouvez créer un fichier <code class="filename">core</code> depuis
	    votre programme, en appelant la fonction <code class="function">abort()</code>.
	    Voir la page de manuel en ligne de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=abort&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">abort</span>(3)</span></a> pour en savoir plus.
	    </p><p>Si vous voulez créer un fichier <code class="filename">core</code> depuis
	    l'extérieur de votre programme, mais ne voulez pas que le processus
	    s'arrêt,vous pouvez utiliser le programme <code class="command">gcore</code>.
	    Voir la page de manuel en ligne de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gcore&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">gcore</span>(1)</span></a> pour plus d'informations.
	    </p></td></tr></tbody></table></div></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp64037328" class="footnote"><p><a href="#idp64037328" class="para"><sup class="para">[2] </sup></a>Pour être vraiment précis, <code class="command">cc</code> convertit à ce niveau le
	      code source dans son propre <em class="firstterm">p-code</em> indépendant de la
	      machine plutôt qu'en langage assembleur.</p></div><div id="ftn.idp64074704" class="footnote"><p><a href="#idp64074704" class="para"><sup class="para">[3] </sup></a>Au cas où vous ne le sauriez pas, un tri binaire est un manière
	  efficace de trier les éléments et le tri à bulles n'en est pas une.</p></div><div id="ftn.idp64092752" class="footnote"><p><a href="#idp64092752" class="para"><sup class="para">[4] </sup></a>Les raisons de ceci sont enterrées dans les brumes de l'histoire.</p></div><div id="ftn.idp64131664" class="footnote"><p><a href="#idp64131664" class="para"><sup class="para">[5] </sup></a>Notez, nous n'avons pas utilisé l'option <code class="option">-o</code>
		pour spécifier le nom de l'exécutable, aussi nous obtiendrons un
		exécutable du nom de <code class="filename">a.out</code>.
		Produire une version de déverminage du nom de
		<code class="filename">foobar</code> est laissé en exercice pour le lecteur!</p></div><div id="ftn.idp64418128" class="footnote"><p><a href="#idp64418128" class="para"><sup class="para">[6] </sup></a>NDT: je n'ai pas trouvé
	    de meilleure traduction pour core memory</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch05s03.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="tools.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="ch05s05.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">5.3. Introduction à la programmation </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 5.5. Make</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>