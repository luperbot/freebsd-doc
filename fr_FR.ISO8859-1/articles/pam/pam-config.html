<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>4. Configuration de PAM</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Pluggable Authentication Modules" /><link rel="up" href="index.html" title="Pluggable Authentication Modules" /><link rel="prev" href="pam-essentials.html" title="3. Les bases de PAM" /><link rel="next" href="pam-freebsd-modules.html" title="5. Les modules PAM de FreeBSD" /><link rel="copyright" href="pam-legalnotice.html" title="Note légale" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. Configuration de PAM</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="pam-essentials.html">Précédent</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="pam-freebsd-modules.html">Suivant</a></td></tr></table><hr /></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="pam-config"></a>4. Configuration de PAM</h2></div></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-config-file-locations"></a>4.1. Emplacement des fichiers de configuration</h3></div></div></div><p>Le fichier de  configuration de PAM est traditionnellement
      <code class="filename">/etc/pam.conf</code>.  Ce fichier  contient toutes
      les  politiques  de PAM  pour  votre  système.  Chaque ligne  du
      fichier décrit une étape dans une chaîne, tel que nous allons le
      voir ci-dessous:</p><pre class="programlisting">login   auth    required        pam_nologin.so  no_warn</pre><p>Les champs  sont respectivement, le service, le nom  du mécanisme, le
      drapeau  de contrôle,  le nom  du  module et  les arguments  du
      module. Tout  champ additionnel est considéré  comme argument du
      module.</p><p>Une   chaîne  différente   est   construite  pour   chaque couple
      service/mécanisme;  ainsi,  alors  que  l'ordre  des  lignes  est
      important  lorsqu'il s'agit  des mêmes  services  ou mécanismes,
      l'ordre  dans  lequel  les  différents  services  et  mécanismes
      apparaissent  ne  l'est pas  &#8212;  excepté  l'entrée pour  le
      service  <code class="literal">other</code>, qui  sert de  référence par défaut  et doit
      être  placé à  la  fin.  L'exemple du  papier  original sur  PAM
      regroupait  les lignes  de configurations  par mécanisme  et le
      fichier   <code class="filename">pam.conf</code>  de   Solaris   le  fait
      toujours, mais  FreeBSD groupe  les lignes de  configuration par
      service. Toutefois il ne s'agit pas de la seule possibilité et les autres possèdent
      aussi un sens.</p><p>OpenPAM et Linux-PAM offrent un mécanisme de configuration
      alternatif  où les  politiques  sont placées  dans des  fichiers
      séparés portant  le nom du service auquel  ils s'appliquent. Ces
      fichiers  sont situés dans  <code class="filename">/etc/pam.d/</code> et
      ne contiennent que  quatre champs à la place  de cinq &#8212; le
      champ contenant  le nom du service  est omis. Il  s'agit du mode
      par  défaut   dans  FreeBSD  4.x.   Notez  que  si   le  fichier
      <code class="filename">/etc/pam.conf</code>   existe   et  contient   des
      informations de configuration pour des services qui n'ont pas de
      politique  spécifiée  dans <code class="filename">/etc/pam.d</code>,  ils
      seront utilisés pour ces services.</p><p>Le  gros avantage de  <code class="filename">/etc/pam.d/</code> sur
      <code class="filename">/etc/pam.conf</code>   est   qu'il  est   possible
      d'utiliser  la même  politique pour  plusieurs services  en liant
      chaque  nom  de service  à  un  fichier  de configuration.  Par
      exemple  pour  utiliser  la  même politique  pour  les  services
      <code class="literal">su</code>  et <code class="literal">sudo</code>,  nous pouvons
      faire comme ceci :</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /etc/pam.d</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s su sudo</code></strong></pre><p>Ceci  fonctionne car  le nom  de service  est  déterminé a
      partir  du nom  de fichier  plutôt qu'indiqué  à  l'intérieur du
      fichier de configuration, ainsi le même fichier peut être utilisé
      pour des services nommés différemment.</p><p>Un autre avantage est  qu'un logiciel tiers peu facilement
      installer  les politiques  pour ses  services sans  avoir besoin
      d'éditer  <code class="filename">/etc/pam.conf</code>. Pour  continuer la
      tradition     de     FreeBSD,     OpenPAM     regardera     dans
      <code class="filename">/usr/local/etc/pam.d</code>   pour   trouver   les
      fichiers  de  configurations; puis si  aucun n'est  trouvé  pour  le
      service   demandé,   il cherchera dans   <code class="filename">/etc/pam.d/</code>   ou
      <code class="filename">/etc/pam.conf</code>.</p><p>Finalement,   quelque   soit   le   mécanisme   que   vous
      choisissiez,       la      politique      <span class="quote">« <span class="quote">magique</span> »</span>
      <code class="literal">other</code> est  utilisée par défaut  pour tous les
      services qui n'ont pas leur propre politique.</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-config-breakdown"></a>4.2. Breakdown of a
	configuration line</h3></div></div></div><p>Comme      expliqué     dans     <a class="xref" href="pam-config.html#pam-config-file-locations" title="4.1. Emplacement des fichiers de configuration">Section 4.1, « Emplacement des fichiers de configuration »</a>, chaque ligne de
	<code class="filename">pam.conf</code> consiste en quatre champs ou plus: le
	nom de service, le nom du mécanisme, le drapeau de contrôle, le nom
	du module et la présence ou non d'arguments pour le module.</p><p>Le nom du service  est généralement, mais pas toujours, le
      nom  de  l'application auquelle  les  règles  s'appliquent. Si  vous
      n'êtes pas sûr, référez vous à la documentation de l'application
      pour déterminer quel nom de service elle utilise.</p><p>Notez         que         si         vous         utilisez
      <code class="filename">/etc/pam.d/</code>      à     la      place     de
      <code class="filename">/etc/pam.conf</code>,   le  nom  du   service  est
      spécifié par  le nom du  fichier de configuration et  n'est pas
      indiqué  dans   les  lignes  de  configuration   qui,  dès  lors,
      commencent par le nom du mécanisme.</p><p>Le mécanisme est  l'un des quatre mots clef  décrit dans
      <a class="xref" href="pam-essentials.html#pam-facilities-primitives" title="3.1. Mécanismes et primitives">Section 3.1, « Mécanismes et primitives »</a>.</p><p>De même, le  drapeau de contrôle est l'un  des quatre mots
      clef décrits dans <a class="xref" href="pam-essentials.html#pam-chains-policies" title="3.3. Chaînes et politiques">Section 3.3, « Chaînes et politiques »</a> et  décrit comment
      le   module   doit   interpréter    le   code   de   retour   du
      module.  Linux-PAM  supporte une  syntaxe  alternative qui  vous
      laisse  spécifier l'action à  associer à  chaque code  de retour
      possible;  mais ceci  devrait être  évité puisque  ce  n'est pas
      standard et étroitement lié à la façon dont Linux-PAM appelle les
      services  (qui diffère  grandement  de la  façon  de Solaris  et
      OpenPAM). C'est  sans étonnement que l'on  apprend qu'OpenPAM ne
      supporte pas cette syntaxe.</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-policies"></a>4.3. Politiques</h3></div></div></div><p>Pour  configurer  PAM correctement,  il  est essentiel  de
      comprendre comment les politiques sont interprétées.</p><p>Lorsqu'une   application   appelle  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_start&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_start</span>(3)</span></a>   la
      bibliothèque  PAM charge  la  politique du  service spécifié  et
      construit  les  quatre  chaînes   de  module  (une  pour  chaque
      mécanisme). Si  une ou plusieurs chaînes sont  vides, les chaînes
      de  la   politique  du  service   <code class="literal">other</code>  sont
      utilisées.</p><p>Plus  tard,  lorsque  l'application  appelle  l'une  des  six
      primitives  PAM,  la  bibliothèque  PAM récupère  la  chaîne  du
      mécanisme  correspondant et  appelle la  fonction  appropriée avec
      chaque  module listé dans  la chaîne.  Après chaque  appel d'une
      fonction  de service,  le type  du  module et  le code  d'erreur
      sont retournés par  celle-ci pour  déterminer quoi faire.  À quelques
      exceptions  près,  dont  nous  parlerons  plus  tard,  la  table
      suivante s'applique:</p><div class="table"><a id="idp64184528"></a><div class="table-title">Tableau 1. Résumé de la chaîne d'exécution PAM </div><div class="table-contents"><table summary="Résumé de la chaîne d'exécution PAM " border="1"><colgroup><col class="type" /><col class="success" /><col class="ignore" /><col class="other" /></colgroup><thead><tr><th> </th><th><code class="literal">PAM_SUCCESS</code></th><th><code class="literal">PAM_IGNORE</code></th><th><code class="literal">other</code></th></tr></thead><tbody><tr><td>binding</td><td>if (!fail) break;</td><td>-</td><td>fail = true;</td></tr><tr><td>required</td><td>-</td><td>-</td><td>fail = true;</td></tr><tr><td>requisite</td><td>-</td><td>-</td><td>fail = true; break;</td></tr><tr><td>sufficient</td><td>if (!fail) break;</td><td>-</td><td>-</td></tr><tr><td>optional</td><td>-</td><td>-</td><td>-</td></tr></tbody></table></div></div><br class="table-break" /><p>Si <code class="varname">fail</code> est vrai à la fin de la chaîne,
      ou  lorsqu'un <span class="quote">« <span class="quote">break</span> »</span>  est atteint,  le dispatcheur
      retourne le  code d'erreur renvoyé  par le premier module  qui a
      échoué.     Autrement     <code class="literal">PAM_SUCCESS</code>     est
      retourné.</p><p>La   première   exception  est   que   le  code   d'erreur
      <code class="literal">PAM_NEW_AUTHOK_REQD</code>  soit considéré  comme un
      succès, sauf si  aucun module n'échoue et qu'au  moins un module
      retourne  <code class="literal">PAM_NEW_AUTHOK_REQD</code>  le dispatcheur
      retournera <code class="literal">PAM_NEW_AUTHOK_REQD</code>.</p><p>La seconde exception  est que <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_setcred&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_setcred</span>(3)</span></a> considère
     les         modules         <code class="literal">binding</code>         et
     <code class="literal">sufficient</code>       comme      s'ils      étaient
     <code class="literal">required</code>.</p><p>La    troisième   et    dernière    exception   est    que
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_chauthtok&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_chauthtok</span>(3)</span></a> exécute la totalité de la chaîne deux fois
      (la première pour des vérifications préliminaires et la deuxième
      pour mettre le  mot de passe) et lors  de la première exécution
      il    considère   les   modules    <code class="literal">binding</code>   et
      <code class="literal">sufficient</code>      comme      s'ils      étaient
      <code class="literal">required</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pam-essentials.html">Précédent</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="pam-freebsd-modules.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">3. Les bases de PAM </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 5. Les modules PAM de FreeBSD</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>