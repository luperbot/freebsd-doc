<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>31.6. Système sans disque dur</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="advanced-networking.html" title="Chapitre 31. Administration réseau avancée" /><link rel="prev" href="network-bridging.html" title="31.5. Bridging" /><link rel="next" href="network-isdn.html" title="31.7. ISDN" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.6. Système sans disque dur</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-bridging.html">Précédent</a> </td><th width="60%" align="center">Chapitre 31. Administration réseau avancée</th><td width="20%" align="right"> <a accesskey="n" href="network-isdn.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-diskless"></a>31.6. Système sans disque dur</h2></div><div><span class="authorgroup">Mis à jour par <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Jean-François</span> <span class="surname">Dockès</span></span>. </span></div><div><span class="authorgroup">Réorganisé et augmenté
	    par <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Alex</span> <span class="surname">Dupre</span></span>. </span></div></div></div><a id="idp86931152" class="indexterm"></a><a id="idp86931664" class="indexterm"></a><p>Une machine FreeBSD peut démarrer via le réseau
      et fonctionner sans disque dur local, en utilisant des
      systèmes de fichiers montés à partir d'un
      serveur <acronym class="acronym">NFS</acronym>.  Aucune modification du
      système n'est nécessaire en dehors des fichiers de
      configuration standards.  Un tel système est facile
      à mettre en oeuvre comme tous les éléments
      sont directement disponibles:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Il y a au moins deux méthodes possibles pour
	  charger un noyau via le réseau:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><acronym class="acronym">PXE</acronym>: l'environnement
	      d'exécution préalable au démarrage
	      d'<span class="trademark">Intel</span>® (Preboot eXecution Environment) est une sorte de
	      ROM intelligente présente sur certaines cartes
	      réseau ou cartes mère.  Consultez la page de
	      manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a> pour plus de détails.</p></li><li class="listitem"><p>Le logiciel porté
	      <span class="application">Etherboot</span> (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/etherboot/pkg-descr">net/etherboot</a>) produit un code
	      stockable dans une ROM pour démarrer des noyaux via
	      le réseau.  Le code peut être soit
	      implanté dans une PROM de démarrage sur une
	      carte réseau, soit chargé à partir
	      d'une disquette (ou d'un disque dur local), ou à
	      partir d'un système <span class="trademark">MS-DOS</span>® en fonctionnement.  De
	      nombreuses cartes réseau sont
	      supportées.</p></li></ul></div></li><li class="listitem"><p>Une procédure d'exemple
	  (<code class="filename">/usr/share/examples/diskless/clone_root</code>)
	  facilite la création et la maintenance du
	  système de fichiers racine de la station de travail sur
	  le serveur.  La procédure demandera sûrement
	  quelques modifications mais vous permettra de démarrer
	  rapidement.</p></li><li class="listitem"><p>Des fichiers de démarrage du système
	  existent dans le répertoire <code class="filename">/etc</code> pour détecter et
	  supporter le démarrage d'un système sans disque
	  dur.</p></li><li class="listitem"><p>La pagination, si nécessaire, peut être
	  faite par l'intermédiaire d'un fichier
	  <acronym class="acronym">NFS</acronym> ou sur un disque local.</p></li></ul></div><p>Il existe plusieurs façons de configurer des stations
      de travail sans disque dur.  Plusieurs éléments
      entrent en oeuvre, et la plupart peuvent être
      ajustés en fonction des besoins locaux.  Ce qui suit
      décrit des variations sur la configuration d'un
      système complet, mettant en avant le simplicité et
      la compatibilité avec les procédures standards de
      démarrage de FreeBSD.  Le système décrit
      présente les caractéristiques suivantes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Les stations de travail sans disque dur utilisent des
	  systèmes de fichiers <code class="filename">/</code> et
	  <code class="filename">/usr</code> partagés et en lecture
	  seule.</p><p>Le système de fichiers racine est une copie d'une
	  racine FreeBSD standard (généralement celle du
	  serveur), avec certains fichiers de configuration
	  remplacés par des versions spécifiques
	  à un fonctionnement sans disque dur, et parfois
	  à la station de travail auxquels ils
	  appartiennent.</p><p>Les parties de la racine qui doivent être
	  inscriptibles sont remplacées par des systèmes
	  de fichiers <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mfs</span>(8)</span></a> (FreeBSD 4.X) ou <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a>
	  (FreeBSD 5.X).  Toute modification sera perdue au
	  redémarrage du système.</p></li><li class="listitem"><p>Le noyau est transféré et chargé
	  soit à l'aide d'<span class="application">Etherboot</span>
	  soit de <acronym class="acronym">PXE</acronym> comme certaines situations
	  peuvent exiger l'utilisation de l'une ou l'autre
	  méthode.</p></li></ul></div><div xmlns="" class="caution"><h3 class="admontitle">Attention: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ainsi décrit, le système n'est pas
	sécurisé.  Il devrait se trouver dans une partie
	protégée du réseau, et les autres machines
	ne devraient pas lui faire confiance aveuglément.</p></div><p>Toutes les instructions de cette section ont
      été testées sous FreeBSD 4.9-RELEASE et
      5.2.1-RELEASE.  Le texte est destiné à l'origine
      pour une utilisation sous 4.X.  Des notes on été
      insérées aux endroits nécessaires pour
      indiquer les modifications concernant la branche 5.X.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86958160"></a>31.6.1. Information de fond</h3></div></div></div><p>Mettre en place des stations de travail sans disque dur
	est à la fois relativement simple et enclin aux
	erreurs.  Ces dernières sont parfois difficiles
	à diagnostiquer pour de nombreuses raisons.  Par
	exemple:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Des options de compilation peuvent donner lieu
	    à des comportements différents à
	    l'exécution.</p></li><li class="listitem"><p>Les messages d'erreurs sont souvent cachés ou
	    totalement absents.</p></li></ul></div><p>Dans ce contexte, avoir quelques connaissances des
	mécanismes sous-jacents impliqués est très
	utile pour résoudre les problèmes qui peuvent
	surgir.</p><p>Plusieurs opérations doivent être
	effectuées pour un amorçage
	réussi:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>La machine doit obtenir des paramètres de base
	    comme son adresse IP, le nom du fichier exécutable,
	    le nom du serveur, l'emplacement de la racine.  Ceci est
	    fait en utilisant le protocole <acronym class="acronym">DHCP</acronym> ou le
	    protocole BOOTP.  <acronym class="acronym">DHCP</acronym> est une extension
	    compatible de BOOTP, et utilise les mêmes
	    numéros de ports et son format de paquets
	    basic.</p><p>Il est possible de configurer un système pour
	    n'utiliser que BOOTP.  Le programme serveur <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bootpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bootpd</span>(8)</span></a>
	    fait partie du système de base de FreeBSD.</p><p>Cependant, <acronym class="acronym">DHCP</acronym> présente
	    plusieurs avantage sur BOOTP (des fichiers de
	    configuration plus lisibles, la possibilité
	    d'utiliser <acronym class="acronym">PXE</acronym>, plus de nombreux autres
	    avantages n'ayant pas de relation directe avec les
	    systèmes sans disque dur), et nous décrirons
	    principalement une configuration <acronym class="acronym">DHCP</acronym>,
	    avec des exemples équivalent utilisant
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bootpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bootpd</span>(8)</span></a> quand cela est possible.  L'exemple de
	    configuration utilisera le logiciel <span class="application">ISC
	    DHCP</span> (la version 3.0.1.r12 était
	    installée sur le serveur de test).</p></li><li class="listitem"><p>La machine a besoin de transférer un ou
	    plusieurs programmes en mémoire locale.
	    <acronym class="acronym">TFTP</acronym> ou <acronym class="acronym">NFS</acronym> sont
	    utilisés.  Le choix entre <acronym class="acronym">TFTP</acronym> et
	    <acronym class="acronym">NFS</acronym> est à de nombreux endroits une
	    option sélectionnée lors de la compilation.
	    Une source d'erreur courante est d'indiquer des noms de
	    fichiers pour le mauvais protocole: <acronym class="acronym">TFTP</acronym>
	    transfère généralement tous les
	    fichiers à partir d'un seul répertoire sur le
	    serveur, et attendra des noms de fichiers relatifs à
	    ce répertoire.  <acronym class="acronym">NFS</acronym> a besoin de
	    chemins d'accès absolus.</p></li><li class="listitem"><p>Les éventuels programmes d'amorce
	    intermédiaires et le noyau doivent être
	    initialisés et exécutés.  Il existe
	    plusieurs variations à ce niveau:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><acronym class="acronym">PXE</acronym> chargera <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a>,
		qui est une version modifiée du chargeur.  Le
		chargeur (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>) récupérera la
		plupart des paramètres nécessaires au
		démarrage du système, et les transmettra
		au noyau avant de lui abandonner le contrôle du
		système.  Dans ce cas il est possible d'utiliser
		un noyau <code class="filename">GENERIC</code>.</p></li><li class="listitem"><p><span class="application">Etherboot</span>, chargera
		directement le noyau avec moins de préparation.
		Vous devrez compiler un noyau avec des options
		particulières.</p></li></ul></div><p><acronym class="acronym">PXE</acronym> et
	    <span class="application">Etherboot</span> fonctionnent aussi
	    bien l'un que l'autre avec des systèmes 4.X.  Comme
	    le noyau des systèmes 5.X laisse au chargeur
	    (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>) un peu plus de travail à
	    effectuer, <acronym class="acronym">PXE</acronym> est
	    préféré pour les systèmes
	    5.X.</p><p>Si votre <acronym class="acronym">BIOS</acronym> et vos cartes
	    réseau supportent <acronym class="acronym">PXE</acronym>, vous
	    devriez probablement l'utiliser.  Cependant, il est
	    toujours possible de démarrer un système 5.X
	    à l'aide
	    d'<span class="application">Etherboot</span>.</p></li><li class="listitem"><p>Et enfin, la machine a besoin d'accéder
	    à ses systèmes de fichiers.
	    <acronym class="acronym">NFS</acronym> est utilisé dans tous les
	    cas.</p></li></ul></div><p>Consultez également la page de manuel
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diskless&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">diskless</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86986576"></a>31.6.2. Configuration</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86987216"></a>31.6.2.1. Configuration utilisant <span class="application">ISC
	  DHCP</span></h4></div></div></div><a id="idp86988112" class="indexterm"></a><p>Le serveur <span class="application">ISC DHCP</span>
	  peut répondre aux requêtes BOOTP et
	  <acronym class="acronym">DHCP</acronym>.</p><p>Avec la version 4.9, <span class="application">ISC DHCP
	  3.0</span> ne fait pas partie du système de
	  base.  Vous devrez installer le logiciel porté
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/isc-dhcp3-server/pkg-descr">net/isc-dhcp3-server</a> ou
	  la version pré-compilée correspondante.</p><p>Une fois <span class="application">ISC DHCP</span>
	  installé, il nécessite un fichier de
	  configuration pour fonctionner (normalement appelé
	  <code class="filename">/usr/local/etc/dhcpd.conf</code>).  Voici un
	  exemple commenté, où la machine
	  <code class="systemitem">margaux</code> utilise
	  <span class="application">Etherboot</span> et où la machine
	  <code class="systemitem">corbieres</code> emploie
	  <acronym class="acronym">PXE</acronym>:</p><pre class="programlisting">
default-lease-time 600;
max-lease-time 7200;
authoritative;

option domain-name "example.com";
option domain-name-servers 192.168.4.1;
option routers 192.168.4.1;

subnet 192.168.4.0 netmask 255.255.255.0 {
  use-host-decl-names on; <a id="co-dhcp-host-name"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
  option subnet-mask 255.255.255.0;
  option broadcast-address 192.168.4.255;

  host margaux {
    hardware ethernet 01:23:45:67:89:ab;
    fixed-address margaux.example.com;
    next-server 192.168.4.4; <a id="co-dhcp-next-server"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
    filename "/data/misc/kernel.diskless"; <a id="co-dhcp-filename"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
    option root-path "192.168.4.4:/data/misc/diskless"; <a id="co-dhcp-root-path"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
  }
  host corbieres {
    hardware ethernet 00:02:b3:27:62:df;
    fixed-address corbieres.example.com;
    next-server 192.168.4.4;
    filename "pxeboot";
    option root-path "192.168.4.4:/data/misc/diskless";
  }
}
	</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-dhcp-host-name"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Cette option dit
	      à <span class="application">dhcpd</span> d'envoyer le
	      paramètre des déclarations
	      <code class="literal">host</code> comme nom de machine pour la
	      machine sans disque dur.  Une autre méthode
	      aurait été d'ajouter <code class="literal">option
	      host-name margaux</code>
	      à l'intérieur des déclarations
	      <code class="literal">host</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-dhcp-next-server"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>La directive
	      <code class="literal">next-server</code> désigne le serveur
	      <acronym class="acronym">TFTP</acronym> ou <acronym class="acronym">NFS</acronym>
	      à utiliser pour télécharger le
	      chargeur ou le noyau (le comportement par défaut
	      étant d'utiliser la même machine que le
	      serveur <acronym class="acronym">DHCP</acronym>).</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-dhcp-filename"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>La directive
	      <code class="literal">filename</code> précise le fichier
	      que chargera <span class="application">Etherboot</span> ou
	      <acronym class="acronym">PXE</acronym> à la prochaine
	      étape.  Il doit être défini en
	      fonction de la méthode de transfert
	      utilisée.  <span class="application">Etherboot</span>
	      peut être compilé pour utiliser
	      <acronym class="acronym">NFS</acronym> ou <acronym class="acronym">TFTP</acronym>.  Le
	      logiciel porté pour FreeBSD utilisera
	      <acronym class="acronym">NFS</acronym> par défaut.
	      <acronym class="acronym">PXE</acronym> emploie <acronym class="acronym">TFTP</acronym>,
	      c'est pourquoi un chemin d'accès relatif est
	      utilisé ici (cela peut dépendre de la
	      configuration du serveur <acronym class="acronym">TFTP</acronym>, mais
	      devrait être plutôt classique).  De plus,
	      <acronym class="acronym">PXE</acronym> charge
	      <code class="filename">pxeboot</code>, et non pas le noyau.  Il
	      existe d'autres possibilités
	      intéressantes, comme le chargement de
	      <code class="filename">pxeboot</code> à partir du
	      répertoire <code class="filename">/boot</code> d'un CD-ROM FreeBSD
	      (comme <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a> peut charger un noyau
	      <code class="filename">GENERIC</code> cela rend possible
	      l'utilisation de <acronym class="acronym">PXE</acronym> pour
	      démarrer à partir d'un lecteur de CD-ROM
	      distant).</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-dhcp-root-path"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>L'option
	      <code class="literal">root-path</code> définie le chemin
	      d'accès au système de fichiers racine,
	      suivant la notation classique de <acronym class="acronym">NFS</acronym>.
	      En utilisant <acronym class="acronym">PXE</acronym>, il est possible de
	      ne pas préciser l'adresse IP de la machine
	      dès lors que vous n'activez pas l'option BOOTP du
	      noyau.  Le serveur <acronym class="acronym">NFS</acronym> sera alors le
	      même que le serveur
	      <acronym class="acronym">TFTP</acronym>.</p></td></tr></table></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87020496"></a>31.6.2.2. Configuration utilisant BOOTP</h4></div></div></div><a id="idp87021136" class="indexterm"></a><p>Ce qui suit présente une configuration
	  <span class="application">bootpd</span> équivalente
	  (réduite à un seul client).  Elle se
	  trouverait sous <code class="filename">/etc/bootptab</code>.</p><p>Veuillez noter qu'<span class="application">Etherboot</span>
	  doit être compilé avec l'option
	  <code class="literal">NO_DHCP_SUPPORT</code> (qui n'est pas
	  activée par défaut) afin d'utiliser BOOTP et
	  que <acronym class="acronym">PXE</acronym>
	  <span class="emphasis"><em>nécessite</em></span>
	  <acronym class="acronym">DHCP</acronym>.  The seul avantage évident
	  de <span class="application">bootpd</span> est qu'il est
	  disponible dans le système de base.</p><pre class="programlisting">
.def100:\
  :hn:ht=1:sa=192.168.4.4:vm=rfc1048:\
  :sm=255.255.255.0:\
  :ds=192.168.4.1:\
  :gw=192.168.4.1:\
  :hd="/tftpboot":\
  :bf="/kernel.diskless":\
  :rp="192.168.4.4:/data/misc/diskless":

margaux:ha=0123456789ab:tc=.def100
	</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87030864"></a>31.6.2.3. Préparation d'un programme de démarrage
	  avec <span class="application">Etherboot</span></h4></div></div></div><a id="idp87031760" class="indexterm"></a><p>Le <a class="link" href="http://etherboot.sourceforge.net" target="_top">site
	  Web d'Etherboot</a> propose une <a class="link" href="http://etherboot.sourceforge.net/doc/html/userman/t1.html" target="_top">
	  documentation importante</a> principalement
	  destinée aux systèmes Linux, mais contenant
	  néamoins des informations utiles.  Ce qui suit
	  présente comment vous utiliseriez
	  <span class="application">Etherboot</span> sur un système
	  FreeBSD.</p><p>Vous devez tout d'abord installer le logiciel
	  porté <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/etherboot/pkg-descr">net/etherboot</a> ou sa version
	  pré-compilée.</p><p>Vous pouvez modifier la configuration
	  d'<span class="application">Etherboot</span> (i.e. pour utiliser
	  <acronym class="acronym">TFTP</acronym> au lieu de <acronym class="acronym">NFS</acronym>)
	  en éditant le fichier <code class="filename">Config</code>
	  dans le répertoire des sources
	  d'<span class="application">Etherboot</span>.</p><p>Pour notre configuration nous utiliserons une disquette
	  de démarrage.  Pour d'autres méthodes (PROM,
	  ou un programme <span class="trademark">MS-DOS</span>®), consultez la documentation
	  d'<span class="application">Etherboot</span>.</p><p>Pour créer une disquette de démarrage,
	  insérez une disquette dans le lecteur de la machine
	  où vous avez installé
	  <span class="application">Etherboot</span>, puis rendez-vous dans
	  le répertoire <code class="filename">src</code> de l'arborescence
	  <span class="application">Etherboot</span> et tapez:</p><pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>gmake bin32/devicetype.fd0</code></strong></pre><p><em class="replaceable"><code>devicetype</code></em> dépend du
	  type de carte Ethernet se trouvant dans la station de
	  travail sans disque dur.  Référez-vous au
	  fichier <code class="filename">NIC</code> dans le même
	  répertoire pour déterminer la valeur
	  <em class="replaceable"><code>devicetype</code></em> correcte.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87043152"></a>31.6.2.4. Démarrer avec <acronym class="acronym">PXE</acronym></h4></div></div></div><p>Par défaut le chargeur <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a> charge le
	  noyau via <acronym class="acronym">NFS</acronym>.  Il peut être
	  compilé pour utiliser <acronym class="acronym">TFTP</acronym>
	  à la place en spécifiant l'option
	  <code class="literal">LOADER_TFTP_SUPPORT</code> dans le fichier
	  <code class="filename">/etc/make.conf</code>.  Lisez les commentaires
	  dans le fichier <code class="filename">/etc/defaults/make.conf</code>
	  (ou <code class="filename">/usr/share/examples/etc/make.conf</code>
	  pour les systèmes 5.X) pour plus de
	  détails.</p><p>Il existe deux autres options de
	  <code class="filename">make.conf</code> non-documentées qui
	  peuvent être utiles pour la configuration d'une
	  machine faisant fonction de console série sans disque
	  dur: <code class="literal">BOOT_PXELDR_PROBE_KEYBOARD</code>, et
	  <code class="literal">BOOT_PXELDR_ALWAYS_SERIAL</code> (cette
	  dernière n'existe que sous FreeBSD 5.X).</p><p>Pour utiliser <acronym class="acronym">PXE</acronym> quand la machine
	  démarre, vous aurez normalement besoin de
	  sélectionner l'option <code class="literal">Boot from
	  network</code> dans votre <acronym class="acronym">BIOS</acronym>, ou
	  d'appuyer sur une touche de fonction lors de
	  l'initialisation du PC.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87050832"></a>31.6.2.5. Configuration des serveurs <acronym class="acronym">TFTP</acronym> et
	  <acronym class="acronym">NFS</acronym></h4></div></div></div><a id="idp87052112" class="indexterm"></a><a id="idp87061584" class="indexterm"></a><p>Si vous utilisez <acronym class="acronym">PXE</acronym> ou
	  <span class="application">Etherboot</span> configurés pour
	  employer <acronym class="acronym">TFTP</acronym>, vous devez activer
	  <span class="application">tftpd</span> sur le serveur de
	  fichier:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Créez un répertoire à partir
	      duquel <span class="application">tftpd</span> proposera les
	      fichiers, e.g. <code class="filename">/tftpboot</code>.</p></li><li class="step"><p>Ajoutez la ligne suivante à votre fichier
	      <code class="filename">/etc/inetd.conf</code>:</p><pre class="programlisting">tftp	dgram	udp	wait	root	/usr/libexec/tftpd	tftpd -l -s /tftpboot</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Il apparaît que certaines versions de
		<acronym class="acronym">PXE</acronym> veulent la version
		<acronym class="acronym">TCP</acronym> de <acronym class="acronym">TFTP</acronym>.
		Dans ce cas, ajoutez une seconde ligne, en
		remplaçant <code class="literal">dgram udp</code> par
		<code class="literal">stream tcp</code>.</p></div></li><li class="step"><p>Demandez à <span class="application">inetd</span>
	      de relire son fichier de configuration:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP `cat /var/run/inetd.pid`</code></strong></pre></li></ol></div><p>Le répertoire <code class="filename">tftpboot</code> peut être
	  placé n'importe où sur le serveur.
	  Assurez-vous que son emplacement est défini dans les
	  fichiers <code class="filename">inetd.conf</code> et
	  <code class="filename">dhcpd.conf</code>.</p><p>Dans tous les cas, vous devez également activer
	  <acronym class="acronym">NFS</acronym> et exporter le système de
	  fichiers approprié sur le serveur
	  <acronym class="acronym">NFS</acronym>.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Ajoutez ce qui suit au fichier
	      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">nfs_server_enable="YES"</pre></li><li class="step"><p>Exportez le système de fichiers contenant le
	      répertoire racine du système sans disque dur
	      en ajoutant ce qui suit au fichier
	      <code class="filename">/etc/exports</code> (ajustez le point de
	      montage et remplacez <em class="replaceable"><code>margaux
	      corbieres</code></em> avec les noms des stations de
	      travail sans disque dur):</p><pre class="programlisting"><em class="replaceable"><code>/data/misc</code></em> -alldirs -ro <em class="replaceable"><code>margaux corbieres</code></em></pre></li><li class="step"><p>Demandez à <span class="application">mountd</span>
	      de relire son fichier de configuration.  Si vous avez eu
	      besoin d'activer <acronym class="acronym">NFS</acronym> dans
	      <code class="filename">/etc/rc.conf</code> lors du premier point,
	      vous voudrez probablement plutot redémarrer la
	      machine.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP `cat /var/run/mountd.pid`</code></strong></pre></li></ol></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87083216"></a>31.6.2.6. Compilation d'un noyau pour système sans disque
	  dur</h4></div></div></div><a id="idp87083856" class="indexterm"></a><p>Si vous utilisez <span class="application">Etherboot</span>,
	  vous devez créer un fichier de configuration du noyau
	  pour le client sans disque dur avec les options suivantes
	  (en plus des options habituelles):</p><pre class="programlisting">
options     BOOTP          # Use BOOTP to obtain IP address/hostname
options     BOOTP_NFSROOT  # NFS mount root filesystem using BOOTP info
	</pre><p>Vous pouvez vouloir également employer les
	  options <code class="literal">BOOTP_NFSV3</code>,
	  <code class="literal">BOOT_COMPAT</code> et
	  <code class="literal">BOOTP_WIRED_TO</code> (référez-vous au
	  fichier <code class="filename">LINT</code> sous 4.X ou
	  <code class="filename">NOTES</code> sous 5.X).</p><p>Les noms de ces options sont historiques et
	  légèrement trompeur comme elles activent
	  indifférement l'utilisation de
	  <acronym class="acronym">DHCP</acronym> et BOOTP dans le noyau (il est
	  également possible de forcer une utilisation stricte
	  de BOOTP ou <acronym class="acronym">DHCP</acronym>).</p><p>Compilez le noyau (voir <a class="xref" href="kernelconfig.html" title="Chapitre 9. Configurer le noyau de FreeBSD">Chapitre 9, <em>Configurer le noyau de FreeBSD</em></a>),
	  et copiez-le à l'emplacement indiqué dans
	  <code class="filename">dhcpd.conf</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Quand on utilise <acronym class="acronym">PXE</acronym>, la
	    compilation d'un noyau avec les options
	    précédentes n'est pas strictement
	    nécessaire (bien que conseillé).  Les activer
	    causera un plus grand nombre de requêtes
	    <acronym class="acronym">DHCP</acronym> générées lors
	    du démarrage du noyau, avec un petit risque
	    d'inconsistance entre les nouvelles valeurs et celles
	    récupérées par <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a> dans
	    certains cas particuliers.  L'avantage de leur utilisation
	    est que le nom de la machine sera forcément
	    défini.  Sinon vous devrez définir le nom de
	    la machine par une autre méthode, par exemple dans un
	    fichier <code class="filename">rc.conf</code> particulier au
	    client.</p></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Afin d'être chargeable par
	    <span class="application">Etherboot</span>, un noyau 5.X doit
	    être compilé avec les &#8220;device
	    hints&#8221;.  Vous définirez normalement l'option
	    suivante dans le fichier de configuration (voir le fichier
	    de commentaires sur la configuration:
	    <code class="filename">NOTES</code>):</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">hints		"GENERIC.hints"</pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87108048"></a>31.6.2.7. Préparer le système de fichiers
	  racine</h4></div></div></div><a id="idp87108688" class="indexterm"></a><p>Vous devez créer un système de fichiers
	  racine pour les stations de travail sans disque dur,
	  à l'emplacement défini par
	  <code class="literal">root-path</code> dans le fichier
	  <code class="filename">dhcpd.conf</code>.  Les sections suivantes
	  décrivent deux manières de le faire.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87110992"></a>31.6.2.7.1. Utilisation de la procédure
	    <code class="filename">clone_root</code></h5></div></div></div><p>C'est la méthode la plus rapide pour
	    créer un système de fichiers racine, mais
	    elle est, pour le moment, uniquement supportée sous
	    FreeBSD 4.X..  Cette procédure est située
	    à l'emplacement
	    <code class="filename">/usr/share/examples/diskless/clone_root</code>
	    et demande quelques modifications, pour au moins ajuster
	    l'emplacement du système de fichiers à
	    créer (la variable <code class="literal">DEST</code>).</p><p>Référez-vous aux commentaires
	    situés en début de la procédure pour
	    information.  Ils expliquent comment le système de
	    fichiers de base est construit, et comment les fichiers
	    peuvent être remplacés de façon
	    sélective par des versions spécifiques
	    à un fonctionnement sans disque dur, ou à un
	    sous-réseau, ou encore à une station de
	    travail particulière.  Ils donnent également
	    des exemples de fichiers <code class="filename">/etc/fstab</code>
	    et <code class="filename">/etc/rc.conf</code> pour un
	    fonctionnement sans disque dur.</p><p>Les fichiers <code class="filename">README</code> dans le
	    répertoire <code class="filename">/usr/share/examples/diskless</code>
	    contiennent beaucoup d'information de fond, mais, avec les
	    autres exemples du répertoire <code class="filename">diskless</code>, ils documentent une
	    méthode de configuration qui est distincte de celle
	    utilisée par <code class="filename">clone_root</code> et les
	    procédures de démarrage du système de
	    <code class="filename">/etc</code>, ce qui est un
	    peu à l'origine de confusions.  Utilisez-les comme
	    référence uniquement, à moins que
	    vous préfériez la méthode qu'ils
	    décrivent, dans quel cas vous devrez modifier les
	    procédures <code class="filename">rc</code>.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87121360"></a>31.6.2.7.2. Utilisation de la procédure <code class="command">make
	    world</code> standard</h5></div></div></div><p>Cette méthode s'applique aussi bien à
	    FreeBSD 4.X qu'à FreeBSD 5.X et installera un
	    système complet (et non pas uniquement le
	    système de fichiers racine) dans le
	    répertoire défini par
	    <code class="envar">DESTDIR</code>.  Tout ce dont vous avez besoin de
	    faire est d'exécuter la procédure
	    suivante:</p><pre class="programlisting">#!/bin/sh
export DESTDIR=/data/misc/diskless
mkdir -p ${DESTDIR}
cd /usr/src; make world &amp;&amp; make kernel
cd /usr/src/etc; make distribution</pre><p>Une fois cela terminé, vous devrez personaliser
	    vos fichiers <code class="filename">/etc/rc.conf</code> et
	    <code class="filename">/etc/fstab</code> situés dans
	    <code class="envar">DESTDIR</code> en fonction de vos besoins.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87125328"></a>31.6.2.8. Configuration de l'espace de pagination</h4></div></div></div><p>Si nécessaire, un fichier de pagination
	  situé sur le serveur peut être utilisé
	  via <acronym class="acronym">NFS</acronym>.  Une des méthodes
	  couramment utilisées pour cela n'est plus
	  supportée sous 5.X.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87126864"></a>31.6.2.8.1. Pagination via <acronym class="acronym">NFS</acronym> sous
	    FreeBSD 4.X</h5></div></div></div><p>L'emplacement et la taille du fichier de pagination
	    peuvent être spécifiés avec les
	    options BOOTP/<acronym class="acronym">DHCP</acronym> 128 et 129
	    spécifiques à FreeBSD.  Des exemples de
	    fichiers de configuration pour <span class="application">ISC DHCP
	    3.0</span> ou <span class="application">bootpd</span>
	    suivent:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Ajoutez les lignes suivantes au fichier
		<code class="filename">dhcpd.conf</code>:</p><pre class="programlisting">
# Global section
option swap-path code 128 = string;
option swap-size code 129 = integer 32;

host margaux {
  ... # Standard lines, see above
  option swap-path <em class="replaceable"><code>"192.168.4.4:/netswapvolume/netswap"</code></em>;
  option swap-size <em class="replaceable"><code>64000</code></em>;
}
	      </pre><p><code class="literal">swap-path</code> est le chemin
		d'accès vers un répertoire où les
		fichiers de pagination sont situés.  Chaque
		fichier sera nommé
		<code class="filename">swap.ip-client</code>.</p><p>Les anciennes version de
		<span class="application">dhcpd</span> utilisaient une
		syntaxe du type <code class="literal">option option-128
		"...</code>, qui n'est plus
		supportée.</p><p><code class="filename">/etc/bootptab</code> utiliserait la
		syntaxe suivante à la place:</p><pre class="programlisting">T128="192.168.4.4:/netswapvolume/netswap":T129=0000fa00</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Dans le fichier
		  <code class="filename">/etc/bootptab</code>, la taille de
		  l'espace de pagination doit être exprimée
		  en hexadécimal.</p></div></li><li class="step"><p>Sur le serveur du fichier de pagination
		par <acronym class="acronym">NFS</acronym>, créez le(s)
		fichier(s) de pagination:</p><pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /netswapvolume/netswap</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /netswapvolume/netswap</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero bs=1024 count=64000 of=swap.192.168.4.6</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 0600 swap.192.168.4.6</code></strong></pre><p><em class="replaceable"><code>192.168.4.6</code></em> est
		l'adresse IP du client sans disque dur.</p></li><li class="step"><p>Sur le serveur du fichier de pagination par
		<acronym class="acronym">NFS</acronym>, ajoutez la ligne suivante au
		fichier <code class="filename">/etc/exports</code>:</p><pre class="programlisting">
<em class="replaceable"><code>/netswapvolume</code></em>  -maproot=0:10 -alldirs <em class="replaceable"><code>margaux corbieres</code></em>
	      </pre><p>Ensuite demandez à
		<span class="application">mountd</span> à relire le
		fichier <code class="filename">exports</code>, comme plus
		haut.</p></li></ol></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87149904"></a>31.6.2.8.2. Pagination via <acronym class="acronym">NFS</acronym> sous
	    FreeBSD 5.X</h5></div></div></div><p>Le noyau ne supporte pas l'activation de la pagination
	    par <acronym class="acronym">NFS</acronym> au démarrage.  L'espace
	    de pagination doit être activé par les
	    procédures de démarrage, en montant un
	    système de fichiers accessible en écriture
	    et en créant et en activant un fichier de
	    pagination.  Pour créer un fichier de pagination de
	    la taille appropriée, vous pouvez effectuer ce qui
	    suit:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/path/to/swapfile bs=1k count=1 oseek=100000</code></strong></pre><p>Pour ensuite l'activer, vous devez ajouter la ligne
	    suivante à votre fichier
	    <code class="filename">rc.conf</code>:</p><pre class="programlisting">swapfile=<em class="replaceable"><code>/path/to/swapfile</code></em></pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87154256"></a>31.6.2.9. Problèmes divers</h4></div></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87154896"></a>31.6.2.9.1. Utilisation d'un <code class="filename">/usr</code> en lecture
	    seule</h5></div></div></div><a id="idp87156048" class="indexterm"></a><p>Si la station de travail sans disque dur est
	    configurée pour exécuter X, you devrez
	    ajuster le fichier de configuration de
	    <span class="application">XDM</span>, qui envoie le journal
	    d'erreurs sur <code class="filename">/usr</code>
	    par défaut.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87158480"></a>31.6.2.9.2. Utilisation d'un serveur non-FreeBSD</h5></div></div></div><p>Quand le serveur pour le système de fichiers
	    racine ne fait pas tourner FreeBSD, vous devrez créer
	    le système de fichiers racine sur une machine FreeBSD,
	    puis le copier vers sa destination en utilisant
	    <code class="command">tar</code> ou <code class="command">cpio</code>.</p><p>Dans cette situation, il y a parfois des
	    problèmes avec les fichiers spéciaux de
	    périphériques dans <code class="filename">/dev</code>, en raison de
	    différences de taille sur les entiers.  Une
	    solution à ce problème est d'exporter un
	    répertoire à partir du serveur non-FreeBSD, de
	    monter ce répertoire sur une machine FreeBSD, et
	    exécuter <code class="command">MAKEDEV</code> sur la machine
	    FreeBSD pour créer les entrées de
	    périphériques correctes (FreeBSD 5.X et
	    les versions suivantes utilisent <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a> pour
	    l'allocation des fichiers spéciaux de
	    périphériques de manière transparente
	    pour l'utilisateur, exécuter
	    <code class="command">MAKEDEV</code> sur ces versions est
	    inutile).</p></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-bridging.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="network-isdn.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">31.5. Bridging </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 31.7. ISDN</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>