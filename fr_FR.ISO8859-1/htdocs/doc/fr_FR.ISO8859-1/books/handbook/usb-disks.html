<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>19.5. Périphériques de stockage USB</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="disks.html" title="Chapitre 19. Stockage des données" /><link rel="prev" href="raid.html" title="19.4. RAID" /><link rel="next" href="creating-cds.html" title="19.6. Création et utilisation de supports optiques (CDs)" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">19.5. Périphériques de stockage USB</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="raid.html">Précédent</a> </td><th width="60%" align="center">Chapitre 19. Stockage des données</th><td width="20%" align="right"> <a accesskey="n" href="creating-cds.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-disks"></a>19.5. Périphériques de stockage USB</h2></div><div><span class="authorgroup">Contribution de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp79963856" class="indexterm"></a><p>De nombreuses solutions de stockage externes utilisent, de
      nos jours, le bus série universel (&#8220;Universal
      Serial Bus&#8221;&#8212;USB): disques durs, clés USB,
      graveurs de CDs, etc.  FreeBSD fournit un support pour ces
      périphériques.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79965392"></a>19.5.1. Configuration</h3></div></div></div><p>Le pilote de périphériques USB de stockage
	de masse, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=umass&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">umass</span>(4)</span></a>, fournit le support pour les
	périphériques de stockage USB.  Si vous utilisez
	le noyau <code class="filename">GENERIC</code>, vous n'avez rien
	à modifier à votre configuration.  Si vous
	utilisez un noyau personnalisé, assurez-vous que les
	lignes suivantes sont présentent dans votre fichier de
	configuration du noyau:</p><pre class="programlisting">device scbus
device da
device pass
device uhci
device ohci
device usb
device umass</pre><p>Le pilote <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=umass&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">umass</span>(4)</span></a> utilise le sous-système
	SCSI pour accéder aux périphériques de
	stockage USB, votre périphérique USB sera vu par
	le système comme étant un
	périphérique SCSI.  En fonction du
	contrôleur USB présent sur votre carte
	mère, vous n'avez besoin qu'une des lignes
	<code class="literal">device uhci</code> et <code class="literal">device
	ohci</code>, cependant avoir les deux lignes dans votre
	configuration du noyau est sans danger.  N'oubliez pas de
	compiler et d'installer le nouveau noyau si vous y avez
	effectué des modifications.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si votre périphérique USB est un graveur
	  de CD ou de DVD, le pilote de périphérique SCSI
	  CD-ROM, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">cd</span>(4)</span></a>, doit être ajouté au noyau via
	  la ligne:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">device cd</pre><p xmlns="http://www.w3.org/1999/xhtml">Puisque le graveur est vu comme un disque SCSI, le
	  pilote <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=atapicam&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">atapicam</span>(4)</span></a> ne devrait pas être
	  employé dans la configuration du noyau.</p></div><p>Le support pour les contrôleurs USB 2.0 est fourni
	avec FreeBSD vous devez cependant ajouter:</p><pre class="programlisting">device ehci</pre><p>à votre fichier de configuration pour
	bénéficier du support USB 2.0.  Notez que les
	pilotes <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=uhci&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">uhci</span>(4)</span></a> et <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ohci&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ohci</span>(4)</span></a> sont toujours
	nécessaires si vous désirez le support de l'USB
	1.X.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79980112"></a>19.5.2. Test de la configuration</h3></div></div></div><p>La configuration est prête à être
	testée: branchez votre périphérique USB,
	et dans le tampon des messages du système
	(<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a>), le disque devrait apparaître de cette
	manière:</p><pre class="screen">umass0: USB Solid state disk, rev 1.10/1.00, addr 2
GEOM: create disk da0 dp=0xc2d74850
da0 at umass-sim0 bus 0 target 0 lun 0
da0: &lt;Generic Traveling Disk 1.11&gt; Removable Direct Access SCSI-2 device
da0: 1.000MB/s transfers
da0: 126MB (258048 512 byte sectors: 64H 32S/T 126C)</pre><p>Bien évidement, le modèle, le fichier
	spécial de périphérique
	(<code class="filename">da0</code>) et d'autres détails
	peuvent être différents en fonction de votre
	configuration.</p><p>Comme le périphérique USB est vu comme
	étant un périphérique SCSI, la commande
	<code class="command">camcontrol</code> peut être employée
	pour lister les périphériques de stockage USB
	attachés au système:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>camcontrol devlist</code></strong>
&lt;Generic Traveling Disk 1.11&gt;      at scbus0 target 0 lun 0 (da0,pass0)</pre><p>Si le disque dispose d'un système de fichiers, vous
	devriez pouvoir le monter.  La <a class="xref" href="disks-adding.html" title="19.3. Ajouter des disques">Section 19.3, « Ajouter des disques »</a>
	vous aidera à formater et créer des partitions
	sur le disque USB si nécessaire.</p><p>Pour rendre ce périphérique montable par un
	utilisateur normal, un certain nombre de paramétrages
	sont nécessaires.  Tout d'abord, les entrées de
	périphériques qui sont créées lors
	de la connexion d'un périphérique USB doivent
	être accessibles à l'utilisateur.  Une solution
	est de faire en sorte que tous les utilisateurs de ces
	périphériques soient membres du groupe
	<code class="systemitem">operator</code>.  Cela se fait à l'aide
	de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a>.  Ensuite, quand ces entrées de
	périphériques sont créées, le
	groupe <code class="systemitem">operator</code> doit pouvoir y
	accéder en lecture et en écriture.  Pour cela,
	les lignes suivantes sont ajoutées à
	<code class="filename">/etc/devfs.rules</code>:</p><pre class="programlisting">[localrules=1]
add path 'da*' mode 0660 group operator</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">S'il y a déjà des disques SCSI dans le
	  système, on doit procéder
	  légèrement différemment.  Par exemple,
	  si le système contient déjà des disques
	  <code class="filename">da0</code> à
	  <code class="filename">da2</code> attachés au
	  système, changez la seconde ligne pour:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">add path 'da[3-9]*' mode 0660 group operator</pre><p xmlns="http://www.w3.org/1999/xhtml">Les disques déjà présents
	  n'appartiendront pas au groupe
	  <code class="systemitem">operator</code>.</p></div><p>Vous devez également activer votre ensemble de
	règles <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs.rules</span>(5)</span></a> dans votre fichier
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">devfs_system_ruleset="localrules"</pre><p>Le noyau doit être ensuite configuré pour
	autoriser les utilisateurs habituels à monter des
	systèmes de fichiers.  La méthode la plus simple
	est d'ajouter la ligne suivante au fichier
	<code class="filename">/etc/sysctl.conf</code>:</p><pre class="programlisting">vfs.usermount=1</pre><p>Notez que ce paramétrage ne prendra effet qu'au
	prochain redémarrage.  Il est également possible
	d'utiliser <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> pour fixer cette variable.</p><p>La dernière étape est de créer un
	répertoire où le système de fichiers sera
	monté.  Ce répertoire doit appartenir à
	l'utilisateur qui montera le système de fichiers.  Une
	méthode adaptée et la création par
	<code class="systemitem">root</code> d'un sous-répertoire
	<code class="filename">/mnt/$USER</code>
	appartenant à l'utilisateur en question (remplacez
	<em class="replaceable"><code>$USER</code></em> par le nom d'utilisateur de
	cet utilisateur):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /mnt/$USER</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown $USER:$USER /mnt/$USER</code></strong></pre><p>Supposez qu'une clé USB soit branchée et
	qu'un périphérique
	<code class="filename">/dev/da0s1</code> apparaît.  Comme ce type
	de périphériques est en général
	livré préformaté avec un système
	de fichiers de type FAT, on pourra le monter de cette
	manière:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mount -t msdosfs -m 644 -M 755 /dev/da0s1 /mnt/$USER</code></strong></pre><p>Si vous débranchez le périphérique
	(le disque doit être démonté auparavant),
	vous devriez voir dans les messages du système quelque
	chose comme:</p><pre class="screen">umass0: at uhub0 port 1 (addr 2) disconnected
(da0:umass-sim0:0:0:0): lost device
(da0:umass-sim0:0:0:0): removing device entry
GEOM: destroy disk da0 dp=0xc2d74850
umass0: detached</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80010320"></a>19.5.3. Lectures supplémentaires</h3></div></div></div><p>En plus des sections <a class="link" href="disks-adding.html" title="19.3. Ajouter des disques">Ajouter
	des disques</a> et <a class="link" href="mount-unmount.html" title="4.6. Monter et démonter des systèmes de fichiers">Monter et
	démonter des systèmes de fichiers</a>, la
	lecture de différentes pages de manuel peut être
	également utile: <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=umass&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">umass</span>(4)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=camcontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">camcontrol</span>(8)</span></a>, et
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=usbdevs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">usbdevs</span>(8)</span></a>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="raid.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="creating-cds.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">19.4. RAID </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 19.6. Création et utilisation de supports optiques
      (CDs)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>