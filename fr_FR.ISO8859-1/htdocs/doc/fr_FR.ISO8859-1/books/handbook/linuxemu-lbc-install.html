<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>11.2. Installation</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="linuxemu.html" title="Chapitre 11. Compatibilité binaire avec Linux" /><link rel="prev" href="linuxemu.html" title="Chapitre 11. Compatibilité binaire avec Linux" /><link rel="next" href="linuxemu-mathematica.html" title="11.3. Installer Mathematica®" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">11.2. Installation</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="linuxemu.html">Précédent</a> </td><th width="60%" align="center">Chapitre 11. Compatibilité binaire avec Linux</th><td width="20%" align="right"> <a accesskey="n" href="linuxemu-mathematica.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-lbc-install"></a>11.2. Installation</h2></div></div></div><a id="idp74901072" class="indexterm"></a><p>La compatibilité binaire avec Linux n'est pas
      activée par défaut.  La manière la plus simple
      pour activer cette fonctionnalité est de charger le KLD
      <code class="literal">linux</code> (<span class="quote">« <span class="quote">Kernel LoaDable
      object</span> »</span>&#8212;objet chargeable par le noyau, ce que l'on
      nomme couramment un module).  Vous pouvez charger ce module
      en tapant ce qui suit sous l'utilisateur
      <code class="systemitem">root</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload linux</code></strong></pre><p>Si vous désirez que la compatibilité Linux soit
      toujours activée, alors vous devrez ajouter la ligne
      suivante au fichier <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">linux_enable="YES"</pre><p>La commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldstat</span>(8)</span></a> peut être utilisée
      pour vérifier que le KLD est chargé:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>kldstat</code></strong>
Id Refs Address    Size     Name
 1    2 0xc0100000 16bdb8   kernel
 7    1 0xc24db000 d000     linux.ko</pre><a id="idp74911696" class="indexterm"></a><p>Si pour quelques raisons vous ne voulez ou pouvez charger le
      KLD, alors vous pouvez lier statiquement la compatibilité
      binaire Linux dans votre noyau en ajoutant <code class="literal">options
      COMPAT_LINUX</code> à votre fichier de configuration du noyau.
      Puis installez votre noyau comme décrit dans la
      <a class="xref" href="kernelconfig.html" title="Chapitre 9. Configurer le noyau de FreeBSD">Chapitre 9, <em>Configurer le noyau de FreeBSD</em></a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74914000"></a>11.2.1. Installer les bibliothèques Linux</h3></div></div></div><a id="idp74914640" class="indexterm"></a><p>Cela peut être fait de deux manières, soit
	en utilisant le logiciel porté
	<a class="link" href="linuxemu-lbc-install.html#linuxemu-libs-port" title="11.2.1.1. Installation à l'aide du logiciel porté linux_base">linux_base</a>, soit
	en les installant <a class="link" href="linuxemu-lbc-install.html#linuxemu-libs-manually" title="11.2.1.2. Installer les bibliothèques à la main">à la main</a>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="linuxemu-libs-port"></a>11.2.1.1. Installation à l'aide du logiciel porté
	  linux_base</h4></div></div></div><a id="idp74918096" class="indexterm"></a><p>C'est de loin la méthode la plus simple pour
	  installer les bibliothèques.  La procédure est
	  juste identique à l'installation d'un autre logiciel
	  porté à partir du
	  <a class="link" href="file://localhost/usr/ports/" target="_top">catalogue
	  des logiciels portés</a>.
	  Faites ce qui suit:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/emulators/linux_base-fc4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install distclean</code></strong></pre><p>La compatibilité binaire Linux devrait maintenant
	  fonctionner.  Certains programmes pourront se plaindre de
	  versions mineures incorrectes de certaines bibliothèques
	  systèmes.  Cela semble, en général, ne pas
	  vraiment être un problème.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Il peut y avoir de multiples versions disponibles
	  du logiciel porté <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/emulators/linux_base/pkg-descr">emulators/linux_base</a>, correspondant
	  à différentes distributions et versions de Linux.
	  Vous devez installez la version la plus proche de ce que
	  nécessite les applications Linux que vous désirez
	  installer.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="linuxemu-libs-manually"></a>11.2.1.2. Installer les bibliothèques à la main</h4></div></div></div><p>Si vous n'avez pas le catalogue des logiciels
	  portés installé, vous pouvez à la
	  place installer les bibliothèques à la main.
	  Il vous faudra les bibliothèques partagées
	  Linux dont à besoin le programme et l'éditeur
	  de lien dynamiques.  Vous devrez également
	  créer un répertoire racine
	  &#8220;masquant&#8221; (&#8220;shadow root&#8221;),
	  <code class="filename">/compat/linux</code>, pour les
	  bibliothèques Linux sur votre système FreeBSD.
	  Toute bibliothèque partagée ouverte par les
	  programmes Linux exécutés sous FreeBSD iront d'abord voir
	  dans cette arborescence.  Ainsi, si un programme Linux
	  charge, par exemple, <code class="filename">/lib/libc.so</code>,
	  FreeBSD essayera d'abord d'ouvrir
	  <code class="filename">/compat/linux/lib/libc.so</code>, puis si
	  cette bibliothèque n'existe pas,
	  <code class="filename">/lib/libc.so</code>.  Les bibliothèques
	  partagées doivent donc être installées
	  sous l'arborescence <code class="filename">/compat/linux/lib</code>
	  plutôt que sous les chemins d'accès
	  mentionnés par la commande Linux
	  <code class="command">ld.so</code>.</p><p>Généralement, vous ne devrez cherchez à
	  savoir de quelles bibliothèques partagées
	  dépendent les binaires Linux que les premières
	  fois que vous installerez des programmes Linux sur votre
	  système FreeBSD.  Au bout d'un moment, vous disposerez
	  d'un jeu suffisant de bibliothèques partagées
	  Linux sur votre système pour être en mesure
	  d'exécuter les binaires Linux nouvellement
	  importés sans effort supplémentaire.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74926672"></a>11.2.1.3. Comment installer des bibliothèques
	  partagées supplémentaires</h4></div></div></div><a id="idp74927312" class="indexterm"></a><p>Que faire si vous avez installé le logiciel
	  porté <code class="filename">linux_base</code> et que votre
	  application se plaint toujours qu'il lui manque des
	  bibliothèques partagées?
	  Comment savoir quelles bibliothèques partagées
	  ont besoin les binaires Linux, et où se les
	  procurer?  Il a habituellement deux possibilités
	  (pour suivre les instructions ci-dessous, vous devrez
	  être en session sous le compte super-utilisateur
	  <code class="systemitem">root</code>).</p><p>Si vous avez accès à un système
	  Linux, déterminez de quelles bibliothèques
	  partagées l'application a besoin, et copiez-les sur
	  votre système FreeBSD.  Soit l'exemple suivant:</p><div class="informalexample"><p>Supposons que vous veniez de télécharger
	    le binaire Linux de <span class="application">Doom</span>,
	    et que vous l'avez installé sur un système
	    Linux.  Vous pouvez alors vérifier de quelles
	    bibliothèques partagées il a besoin pour
	    fonctionner avec la commande
	    <code class="command">ldd linuxdoom</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ldd linuxdoom</code></strong>
libXt.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libXt.so.3.1.0
libX11.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libX11.so.3.1.0
libc.so.4 (DLL Jump 4.5pl26) =&gt; /lib/libc.so.4.6.29</pre><a id="idp74931920" class="indexterm"></a><p>Vous devrez récupérer tous les
	    fichiers mentionnés dans la dernière colonne,
	    et les installer sous <code class="filename">/compat/linux</code>,
	    en utilisant les noms de la première colonne comme
	    liens symboliques qui pointent dessus.  Cela signifie
	    que vous aurez éventuellement les fichiers suivants
	    sur votre système FreeBSD:</p><pre class="screen">/compat/linux/usr/X11/lib/libXt.so.3.1.0
/compat/linux/usr/X11/lib/libXt.so.3 -&gt; libXt.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3 -&gt; libX11.so.3.1.0
/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</pre><div class="blockquote"><blockquote class="blockquote"><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Remarquez que si vous avez déjà
		une bibliothèque partagée de même
		numéro de version majeure que celle indiquée
		par la première colonne du résultat
		de la commande <code class="command">ldd</code>, il est inutile
		de copier le fichier donné par la dernière
		colonne sur votre système, celui que vous
		avez déjà devrait suffire.
		Il est cependant recommandé de recopier
		malgré tout la bibliothèque partagée
		si c'est une version récente.
		Vous pouvez supprimer l'ancienne version, du moment
		que le lien symbolique pointe sur la nouvelle.  Par
		exemple, si vous avez les bibliothèques suivantes
		sur votre système:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">/compat/linux/lib/libc.so.4.6.27
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.27</pre><p xmlns="http://www.w3.org/1999/xhtml">et que vous avez un nouveau binaire qui
		d'après le résultat de la commande
		<code class="command">ldd</code> semble avoir besoin d'une
		version plus récente:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">libc.so.4 (DLL Jump 4.5pl26) -&gt; libc.so.4.6.29</pre><p xmlns="http://www.w3.org/1999/xhtml">Si vous n'avez qu'une ou deux versions de retard
		sur le dernier indice, alors ne vous souciez pas
		d'installer la version
		<code class="filename">/lib/libc.so.4.6.29</code> plus
		récente, parce que le programme devrait fonctionner
		sans problème avec une version
		légèrement antérieure.
		Vous pouvez néanmoins décider de remplacer
		<code class="filename">libc.so</code>, ce qui devrait vous
		donner quelque chose comme:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</pre></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Le mécanisme de lien symbolique n'est
		nécessaire que pour les binaires Linux.
		L'éditeur de liens dynamiques de FreeBSD
		se charge lui-même de trouver les numéros
		de versions majeures adéquats et vous
		n'avez pas à vous en préoccuper.</p></div></blockquote></div></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74944336"></a>11.2.2. Installer des binaires Linux ELF</h3></div></div></div><a id="idp74949200" class="indexterm"></a><p>Une étape supplémentaire est parfois
	nécessaire pour les binaires ELF: le
	&#8220;marquage&#8221;.  Si vous tentez d'exécuter un
	binaire ELF non marqué, vous obtiendrez un message
	d'erreur ressemblant à ce qui suit:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>./mon-binaire-elf-linux</code></strong>
ELF binary type not known
Abort</pre><p>Pour que le noyau FreeBSD puisse distinguer un binaire ELF
	FreeBSD d'un binaire Linux, vous devez employer l'utilitaire
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>brandelf -t Linux mon-binaire-elf-linux</code></strong></pre><a id="idp74953936" class="indexterm"></a><p>Les outils GNU incorporent désormais automatiquement
	les marques nécessaires dans les binaires ELF, vous
	aurez donc de moins en moins besoin de passer par cette
	étape à l'avenir.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74954960"></a>11.2.3. Configurer le résolveur de noms de domaines</h3></div></div></div><p>Si le DNS ne fonctionne pas, ou si vous avez les
	messages:</p><pre class="screen">resolv+: "bind" is an invalid keyword resolv+:
"hosts" is an invalid keyword</pre><p>Vous devrez configurer un fichier
	<code class="filename">/compat/linux/etc/host.conf</code>
	contenant:</p><pre class="programlisting">order hosts, bind
multi on</pre><p>Où l'ordre ci-dessus spécifie qu'il faut tout
	d'abord regarder dans le fichier <code class="filename">/etc/hosts</code>
	puis interroger le DNS.  Quand le fichier
	<code class="filename">/compat/linux/etc/host.conf</code> n'existe pas,
	les applications Linux trouvent le fichier
	<code class="filename">/etc/host.conf</code> de FreeBSD et se plaignent de
	sa syntaxe FreeBSD incompatible.  Supprimez
	<code class="literal">bind</code> si vous n'avez pas configuré de
	serveur de noms avec le fichier
	<code class="filename">/etc/resolv.conf</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="linuxemu.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="linuxemu.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="linuxemu-mathematica.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">Chapitre 11. Compatibilité binaire avec Linux </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 11.3. Installer <span class="trademark">Mathematica</span>®</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>