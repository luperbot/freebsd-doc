<?xml version="1.0" encoding="iso-8859-7" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-7" /><title>25.4. Χρησιμοποιώντας το DTrace</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Εγχειρίδιο του FreeBSD" /><link rel="up" href="dtrace.html" title="Κεφάλαιο 25. DTrace" /><link rel="prev" href="dtrace-enable.html" title="25.3. Ενεργοποίηση της Υποστήριξης DTrace" /><link rel="next" href="dtrace-language.html" title="25.5. Η Γλώσσα D" /><link rel="copyright" href="legalnotice.html" title="Νομική Σημείωση" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">25.4. Χρησιμοποιώντας το DTrace</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="dtrace-enable.html">Προηγ</a> </td><th width="60%" align="center">Κεφάλαιο 25. DTrace</th><td width="20%" align="right"> <a accesskey="n" href="dtrace-language.html">Επόμενο</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dtrace-using"></a>25.4. Χρησιμοποιώντας το DTrace</h2></div></div></div><p>Πριν χρησιμοποιήσετε τις λειτουργίες του DTrace, θα πρέπει να
      υπάρχει η αντίστοιχη συσκευή.  Για να φορτώσετε τη συσκευή, θα πρέπει
      να δώσετε την παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload dtraceall</code></strong></pre><p>Θα πρέπει να έχετε πλέον υποστήριξη DTrace.  Για να δείτε όλα τα
      probes, θα πρέπει να εκτελέσετε ως διαχειριστής την παρακάτω
      εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dtrace -l | more</code></strong></pre><p>Όλη η έξοδος περνάει μέσω του βοηθητικού προγράμματος
      <code class="command">more</code>, διαφορετικά γρήγορα θα υπερχείλιζε την
      προσωρινή μνήμη της οθόνης.  Στο σημείο αυτό, θα πρέπει να θεωρηθεί ότι
      το DTrace λειτουργεί.  Είναι πλέον ώρα να εξετάσουμε αυτή τη σειρά
      εργαλείων.</p><p>Η σειρά των εργαλείων είναι μια συλλογή από έτοιμα scripts που
      εκτελούνται με το DTrace ώστε να συλλέξουν πληροφορίες σχετικά με το
      σύστημα.  Υπάρχουν scripts που ελέγχουν για ανοικτά αρχεία, τη μνήμη,
      τη χρήση της <acronym class="acronym">CPU</acronym> και πολλά ακόμα.  Κάντε εξαγωγή των
      scripts με την ακόλουθη εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gunzip -c DTraceToolkit* | tar xvf -</code></strong></pre><p>Μετακινηθείτε στον κατάλογο που τα αποσυμπιέσατε με την εντολή
      <code class="command">cd</code> και αλλάξτε τα δικαιώματα εκτέλεσης σε όλα τα
      αρχεία, όπως στα αρχεία με τα μικρά γράμματα, σε
      <code class="literal">755</code>.</p><p>Θα χρειαστεί να γίνουν αλλαγές στο περιεχόμενο σε όλα τα scripts.
      Όσα περιέχουν το
      <code class="filename">/usr/bin/ksh</code> θα πρέπει να αλλαχθούν σε
      <code class="filename">/usr/local/bin/ksh</code>, τα άλλα που περιέχουν το
      <code class="filename">/usr/bin/sh</code> θα πρέπει να αλλαχθούν σε
      <code class="filename">/bin/sh</code>, και τέλος αυτά που περιέχουν το
      <code class="filename">/usr/bin/perl</code> θα πρέπει να αλλαχθούν σε
      <code class="filename">/usr/local/bin/perl</code>.</p><div xmlns="" class="important"><h3 class="admontitle">Σημαντικό: </h3><p xmlns="http://www.w3.org/1999/xhtml">Στο σημείο αυτό είναι σημαντικό να υπενθυμίσουμε στον αναγνώστη
	ότι η υποστήριξη DTrace στο FreeBSD είναι <span class="emphasis"><em>ατελής</em></span>
	και πειραματική.  Πολλά από αυτά τα scripts δεν θα λειτουργήσουν,
	καθώς είναι είτε πολύ προσανατολισμένα στο <span class="trademark">Solaris</span>TM, ή χρησιμοποιούν
	probes τα οποία δεν υποστηρίζονται τη δεδομένη στιγμή.</p></div><p>Τη στιγμή που γράφονται αυτές οι γραμμές, μόνο δύο scripts από τη
      σειρά εργαλείων του DTrace υποστηρίζονται πλήρως στο FreeBSD: το
      <code class="filename">hotkernel</code> και το <code class="filename">procsystime</code>.
      Αυτά τα δύο θα εξερευνήσουμε στα επόμενα τμήματα αυτής της
      ενότητας.</p><p>Το <code class="filename">hotkernel</code> έχει σχεδιαστεί να αναγνωρίζει
      ποια συνάρτηση καταναλώνει το μεγαλύτερο χρόνο στον πυρήνα.  Εκτελώντας
      το υπό κανονικές συνθήκες, θα δείτε έξοδο παρόμοια με την
      παρακάτω:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>./hotkernel</code></strong>
Sampling... Hit Ctrl-C to end.</pre><p>Ο διαχειριστής του συστήματος θα πρέπει να χρησιμοποιήσει το
      συνδυασμό πλήκτρων <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span> για
      να σταματήσει τη διεργασία.  Με τον τερματισμό του, το script θα
      απεικονίσει μια σειρά από συναρτήσεις του πυρήνα και πληροφορίες σχετικά
      με το χρόνο τους, ταξινομώντας τις σε αύξουσα σειρά ανάλογα με το
      χρόνο:</p><pre class="screen">kernel`_thread_lock_flags                                   2   0.0%
0xc1097063                                                  2   0.0%
kernel`sched_userret                                        2   0.0%
kernel`kern_select                                          2   0.0%
kernel`generic_copyin                                       3   0.0%
kernel`_mtx_assert                                          3   0.0%
kernel`vm_fault                                             3   0.0%
kernel`sopoll_generic                                       3   0.0%
kernel`fixup_filename                                       4   0.0%
kernel`_isitmyx                                             4   0.0%
kernel`find_instance                                        4   0.0%
kernel`_mtx_unlock_flags                                    5   0.0%
kernel`syscall                                              5   0.0%
kernel`DELAY                                                5   0.0%
0xc108a253                                                  6   0.0%
kernel`witness_lock                                         7   0.0%
kernel`read_aux_data_no_wait                                7   0.0%
kernel`Xint0x80_syscall                                     7   0.0%
kernel`witness_checkorder                                   7   0.0%
kernel`sse2_pagezero                                        8   0.0%
kernel`strncmp                                              9   0.0%
kernel`spinlock_exit                                       10   0.0%
kernel`_mtx_lock_flags                                     11   0.0%
kernel`witness_unlock                                      15   0.0%
kernel`sched_idletd                                       137   0.3%
0xc10981a5                                              42139  99.3%</pre><p>Το script αυτό λειτουργεί επίσης με αρθρώματα του πυρήνα.  Για να
      χρησιμοποιήσετε αυτό το χαρακτηριστικό, εκτελέστε το με την επιλογή
      <code class="option">-m</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>./hotkernel -m</code></strong>
Sampling... Hit Ctrl-C to end.
^C
MODULE                                                  COUNT   PCNT
0xc107882e                                                  1   0.0%
0xc10e6aa4                                                  1   0.0%
0xc1076983                                                  1   0.0%
0xc109708a                                                  1   0.0%
0xc1075a5d                                                  1   0.0%
0xc1077325                                                  1   0.0%
0xc108a245                                                  1   0.0%
0xc107730d                                                  1   0.0%
0xc1097063                                                  2   0.0%
0xc108a253                                                 73   0.0%
kernel                                                    874   0.4%
0xc10981a5                                             213781  99.6%</pre><p>Το <code class="filename">procsystime</code> script συλλαμβάνει και τυπώνει
      τον χρόνο των κλήσεων συστήματος για μια συγκεκριμένη διεργασία μέσω
      του <acronym class="acronym">PID</acronym> ή του ονόματος της.  Στο παρακάτω παράδειγμα
      έχουμε ξεκινήσει μια νέα διεργασία του <code class="filename">/bin/csh</code>.
      Εκτελέσαμε το <code class="filename">procsystime</code> και το αφήσαμε στην
      αναμονή καθώς γράφαμε μερικές εντολές στο <code class="command">csh</code> που
      είχαμε ανοίξει.  Αυτά είναι τα αποτελέσματα της δοκιμής μας:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>./procsystime -n csh</code></strong>
Tracing... Hit Ctrl-C to end...
^C

Elapsed Times for processes csh,

         SYSCALL          TIME (ns)
          getpid               6131
       sigreturn               8121
           close              19127
           fcntl              19959
             dup              26955
         setpgid              28070
            stat              31899
       setitimer              40938
           wait4              62717
       sigaction              67372
     sigprocmask             119091
    gettimeofday             183710
           write             263242
          execve             492547
           ioctl             770073
           vfork            3258923
      sigsuspend            6985124
            read         3988049784</pre><p>Όπως φαίνεται, η κλήση του συστήματος για ανάγνωση
      (<code class="function">read()</code>) είναι αυτή που καταναλώνει τον
      περισσότερο χρόνο σε νανοδευτερόλεπτα, ενώ το λιγότερο τον καταναλώνει
      η κλήση συστήματος <code class="function">getpid()</code>.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="dtrace-enable.html">Προηγ</a> </td><td width="20%" align="center"><a accesskey="u" href="dtrace.html">Πάνω</a></td><td width="40%" align="right"> <a accesskey="n" href="dtrace-language.html">Επόμενο</a></td></tr><tr><td width="40%" align="left" valign="top">25.3. Ενεργοποίηση της Υποστήριξης DTrace </td><td width="20%" align="center"><a accesskey="h" href="index.html">Αρχή</a></td><td width="40%" align="right" valign="top"> 25.5. Η Γλώσσα D</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Αυτό το κείμενο, και άλλα κείμενα, μπορεί να βρεθεί στο
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Για ερωτήσεις σχετικά με το FreeBSD, διαβάστε την
    <a href="http://www.FreeBSD.org/docs.html">τεκμηρίωση</a> πριν να επικοινωνήσετε με την
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Για ερωτήσεις σχετικά με αυτή την τεκμηρίωση, στείλτε e-mail στην
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>