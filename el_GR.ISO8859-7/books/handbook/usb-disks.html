<?xml version="1.0" encoding="iso-8859-7" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-7" /><title>19.4. USB Storage Devices</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Εγχειρίδιο του FreeBSD" /><link rel="up" href="disks.html" title="Κεφάλαιο 19. Αποθηκευτικά Μέσα" /><link rel="prev" href="disks-adding.html" title="19.3. Adding Disks" /><link rel="next" href="creating-cds.html" title="19.5. Creating and Using CD Media" /><link rel="copyright" href="legalnotice.html" title="Νομική Σημείωση" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">19.4. USB Storage Devices</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="disks-adding.html">Προηγ</a> </td><th width="60%" align="center">Κεφάλαιο 19. Αποθηκευτικά Μέσα</th><td width="20%" align="right"> <a accesskey="n" href="creating-cds.html">Επόμενο</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="usb-disks"></a>19.4. USB Storage Devices</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Marc</span> <span class="surname">Fonvieille</span></span>. </span></div></div></div><a id="idp90107344" class="indexterm"></a><p>Many external storage solutions, such as hard drives, USB
      thumbdrives, and CD/DVD burners, use the Universal Serial Bus
      (USB).  FreeBSD provides support for these devices.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90113104"></a>19.4.1. Configuration</h3></div></div></div><p>The USB mass storage devices driver, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=umass&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">umass</span>(4)</span></a>, is
	built into the <code class="filename">GENERIC</code> kernel and
	provides support for USB storage devices.  For a custom
	kernel, be sure that the following lines are present in the
	kernel configuration file:</p><pre class="programlisting">device scbus
device da
device pass
device uhci
device ohci
device ehci
device usb
device umass</pre><p>Since the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=umass&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">umass</span>(4)</span></a> driver uses the SCSI subsystem to
	access the USB storage devices, any USB device will be seen as
	a SCSI device by the system.  Depending on the USB chipset on
	the motherboard, <code class="literal">device uhci</code> or
	<code class="literal">device ohci</code> is used to provide USB 1.X
	support.  Support for USB 2.0 controllers is provided by
	<code class="literal">device ehci</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Σημείωση: </h3><p xmlns="http://www.w3.org/1999/xhtml">If the USB device is a CD or DVD burner, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">cd</span>(4)</span></a>,
	  must be added to the kernel via the line:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">device cd</pre><p xmlns="http://www.w3.org/1999/xhtml">Since the burner is seen as a SCSI drive, the driver
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=atapicam&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">atapicam</span>(4)</span></a> should not be used in the kernel
	  configuration.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90121296"></a>19.4.2. Testing the Configuration</h3></div></div></div><p>To test the USB configuration, plug in the USB device.  In
	the system message buffer, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a>, the drive should
	appear as something like:</p><pre class="screen">umass0: USB Solid state disk, rev 1.10/1.00, addr 2
GEOM: create disk da0 dp=0xc2d74850
da0 at umass-sim0 bus 0 target 0 lun 0
da0: &lt;Generic Traveling Disk 1.11&gt; Removable Direct Access SCSI-2 device
da0: 1.000MB/s transfers
da0: 126MB (258048 512 byte sectors: 64H 32S/T 126C)</pre><p>The brand, device node (<code class="filename">da0</code>), and
	other details will differ according to the device.</p><p>Since the USB device is seen as a SCSI one,
	<code class="command">camcontrol</code> can be used to list the USB
	storage devices attached to the system:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>camcontrol devlist</code></strong>
&lt;Generic Traveling Disk 1.11&gt;      at scbus0 target 0 lun 0 (da0,pass0)</pre><p>If the drive comes with a file system, it can be mounted.
	Refer to <a class="xref" href="disks-adding.html" title="19.3. Adding Disks">Τμήμα 19.3, «Adding Disks»</a> for
	instructions on how to format and create partitions on the USB
	drive.</p><div xmlns="" class="warning"><h3 class="admontitle">Προειδοποίηση: </h3><p xmlns="http://www.w3.org/1999/xhtml">Allowing untrusted users to mount arbitrary media, by
	  enabling <code class="varname">vfs.usermount</code> as
	  described below, should not be considered safe from a
	  security point of view.  Most file systems in FreeBSD were not
	  built to safeguard against malicious devices.</p></div><p>To make the device mountable as a normal user, one
	solution is to make all users of the device a member of the
	<code class="systemitem">operator</code> group
	using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pw&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pw</span>(8)</span></a>.  Next, ensure that the
	<code class="systemitem">operator</code> group is
	able to read and write the device by adding these lines to
	<code class="filename">/etc/devfs.rules</code>:</p><pre class="programlisting">[localrules=5]
add path 'da*' mode 0660 group operator</pre><div xmlns="" class="note"><h3 class="admontitle">Σημείωση: </h3><p xmlns="http://www.w3.org/1999/xhtml">If SCSI disks are installed in the system, change
	  the second line as follows:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">add path 'da[3-9]*' mode 0660 group operator</pre><p xmlns="http://www.w3.org/1999/xhtml">This will exclude the first three SCSI disks
	  (<code class="filename">da0</code> to
	  <code class="filename">da2</code>)from belonging to the
	  <code class="systemitem">operator</code>
	  group.</p></div><p>Next, enable the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs.rules</span>(5)</span></a> ruleset in
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">devfs_system_ruleset="localrules"</pre><p>Next, instruct the running kernel to allow regular users
	to mount file systems.  The easiest way is to add the
	following line to
	<code class="filename">/etc/sysctl.conf</code>:</p><pre class="programlisting">vfs.usermount=1</pre><p>Since this only takes effect after the next reboot use
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> to set this variable now.</p><p>The final step is to create a directory where the file
	system is to be mounted.  This directory needs to be owned by
	the user that is to mount the file system.  One way to do that
	is for <code class="systemitem">root</code> to
	create a subdirectory owned by that user as
	<code class="filename">/mnt/username</code>.  In the following example,
	replace <em class="replaceable"><code>username</code></em> with the login
	name of the user and <em class="replaceable"><code>usergroup</code></em> with
	the user's primary group:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /mnt/username</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown username:usergroup /mnt/username</code></strong></pre><p>Suppose a USB thumbdrive is plugged in, and a device
	<code class="filename">/dev/da0s1</code> appears.  If the device is
	preformatted with a FAT file system, it can be mounted
	using:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mount -t msdosfs -o -m=644,-M=755 /dev/da0s1 /mnt/username</code></strong></pre><p>Before the device can be unplugged, it
	<span class="emphasis"><em>must</em></span> be unmounted first.  After device
	removal, the system message buffer will show messages similar
	to the following:</p><pre class="screen">umass0: at uhub0 port 1 (addr 2) disconnected
(da0:umass-sim0:0:0:0): lost device
(da0:umass-sim0:0:0:0): removing device entry
GEOM: destroy disk da0 dp=0xc2d74850
umass0: detached</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90165584"></a>19.4.3. Further Reading</h3></div></div></div><p>Beside the <a class="link" href="disks-adding.html" title="19.3. Adding Disks">Adding
	  Disks</a> and <a class="link" href="mount-unmount.html" title="4.6. Προσάρτηση και Αποπροσάρτηση Συστημάτων Αρχείων">Mounting and
	Unmounting File Systems</a> sections, reading various
	manual pages may also be useful: <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=umass&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">umass</span>(4)</span></a>,
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=camcontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">camcontrol</span>(8)</span></a>, and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=usbconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">usbconfig</span>(8)</span></a> under FreeBSD  8.X
	or <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=usbdevs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">usbdevs</span>(8)</span></a> under earlier versions of FreeBSD.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="disks-adding.html">Προηγ</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Πάνω</a></td><td width="40%" align="right"> <a accesskey="n" href="creating-cds.html">Επόμενο</a></td></tr><tr><td width="40%" align="left" valign="top">19.3. Adding Disks </td><td width="20%" align="center"><a accesskey="h" href="index.html">Αρχή</a></td><td width="40%" align="right" valign="top"> 19.5. Creating and Using CD Media</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Αυτό το κείμενο, και άλλα κείμενα, μπορεί να βρεθεί στο
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Για ερωτήσεις σχετικά με το FreeBSD, διαβάστε την
    <a href="http://www.FreeBSD.org/docs.html">τεκμηρίωση</a> πριν να επικοινωνήσετε με την
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Για ερωτήσεις σχετικά με αυτή την τεκμηρίωση, στείλτε e-mail στην
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>