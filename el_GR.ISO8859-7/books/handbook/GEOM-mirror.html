<?xml version="1.0" encoding="iso-8859-7" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-7" /><title>20.4. RAID1 - Mirroring</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Εγχειρίδιο του FreeBSD" /><link rel="up" href="GEOM.html" title="Κεφάλαιο 20. GEOM: Διαχείριση Συστοιχιών Δίσκων" /><link rel="prev" href="GEOM-striping.html" title="20.3. RAID0 - Striping" /><link rel="next" href="GEOM-raid3.html" title="20.5. RAID3 - Striping σε Επίπεδο Byte με Αφοσιωμένο Parity" /><link rel="copyright" href="legalnotice.html" title="Νομική Σημείωση" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">20.4. RAID1 - Mirroring</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="GEOM-striping.html">Προηγ</a> </td><th width="60%" align="center">Κεφάλαιο 20. GEOM: Διαχείριση Συστοιχιών Δίσκων</th><td width="20%" align="right"> <a accesskey="n" href="GEOM-raid3.html">Επόμενο</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="GEOM-mirror"></a>20.4. RAID1 - Mirroring</h2></div></div></div><a id="idp91367888" class="indexterm"></a><a id="idp91368656" class="indexterm"></a><p>Το mirroring (καθρεφτισμός) είναι μια τεχνολογία που
      χρησιμοποιείται από πολλές εταιρίες και οικιακούς χρήστες για να
      ασφαλίσουν τα δεδομένα τους χωρίς διακοπές.  Σε μια διάταξη mirror,
      ο δίσκος Β είναι απλώς ένα πλήρες αντίγραφο του δίσκου Α.  Ή μπορεί
      οι δίσκοι Γ+Δ να είναι αντίγραφα των δίσκων A+B.  Άσχετα με την
      ακριβή διάταξη των δίσκων, το σημαντικό είναι ότι οι πληροφορίες ενός
      δίσκου ή μιας κατάτμησης αντιγράφονται σε άλλους.  Οι πληροφορίες
      αυτές μπορεί αργότερα να αποκατασταθούν με εύκολο τρόπο, ή να
      αντιγραφούν χωρίς να προκληθεί διακοπή στις υπηρεσίες του μηχανήματος
      ή στην πρόσβαση των δεδομένων.  Μπορούν ακόμα και να μεταφερθούν και
      να φυλαχθούν σε άλλο, ασφαλές μέρος.</p><p>Για να ξεκινήσετε, βεβαιωθείτε ότι το σύστημα σας έχει δύο σκληρούς
      δίσκους ίδιου μεγέθους.  Στα παραδείγματα μας θεωρούμε ότι οι δίσκοι
      είναι τύπου <acronym class="acronym">SCSI</acronym> (απευθείας πρόσβασης,
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=da&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">da</span>(4)</span></a>).</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91375568"></a>20.4.1. Mirroring στους Βασικούς Δίσκους</h3></div></div></div><p>Υποθέτοντας ότι το FreeBSD έχει εγκατασταθεί στον πρώτο δίσκο
	<code class="filename">da0</code>, θα πρέπει να ρυθμίσετε το
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gmirror&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gmirror</span>(8)</span></a> να αποθηκεύσει εκεί τα βασικά δεδομένα του.</p><p>Πριν δημιουργήσετε το mirror, ενεργοποιήστε την δυνατότητα
	εμφάνισης περισσότερων λεπτομερειών (που μπορεί να σας βοηθήσουν σε
	περίπτωση προβλήματος) και επιτρέψτε την απευθείας πρόσβαση στη
	συσκευή δίσκου.  Για το σκοπό αυτό θέστε τη μεταβλητή
	<code class="varname">kern.geom.debugflags</code> του <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	στην παρακάτω τιμή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl kern.geom.debugflags=17</code></strong></pre><p>Μπορείτε τώρα να δημιουργήσετε το mirror.  Ξεκινήστε τη
	διαδικασία αποθηκεύοντας τα μετα-δεδομένα (meta-data) στον βασικό
	δίσκο, δημιουργώντας ουσιαστικά τη συσκευή
	<code class="filename">/dev/mirror/gm</code>.
	Χρησιμοποιήστε την παρακάτω εντολή:</p><div xmlns="" class="warning"><h3 class="admontitle">Προειδοποίηση: </h3><p xmlns="http://www.w3.org/1999/xhtml">Η δημιουργία mirror στο δίσκο εκκίνησης μπορεί να έχει ως
	  αποτέλεσμα την απώλεια δεδομένων, αν ο τελευταίος τομέας του δίσκου
	  έχει ήδη χρησιμοποιηθεί.  Η πιθανότητα αυτή είναι πολύ μικρότερη
	  αν το mirror δημιουργηθεί αμέσως μετά από μια νέα εγκατάσταση του
	  FreeBSD.  Η παρακάτω διαδικασία είναι επίσης ασύμβατη με τις
	  προεπιλεγμένες ρυθμίσεις εγκατάστασης του
	  FreeBSD 9.<em class="replaceable"><code>X</code></em> στις οποίες
	  χρησιμοποιείται το σύστημα κατατμήσεων <acronym class="acronym">GPT</acronym>.
	  To GEOM καταστρέφει τα μεταδεδομένα του <acronym class="acronym">GPT</acronym>,
	  και θα προκαλέσει απώλεια δεδομένων και πιθανή αδυναμία εκκίνησης
	  του συστήματος.</p></div><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror label -vb round-robin gm0 /dev/da0</code></strong></pre><p>Το σύστημα θα ανταποκριθεί με το παρακάτω μήνυμα:</p><pre class="screen">Metadata value stored on /dev/da0.
Done.</pre><p>Αρχικοποιήστε το GEOM.  Η παρακάτω εντολή θα φορτώσει το άρθρωμα
	<code class="filename">/boot/kernel/geom_mirror.ko</code> στον πυρήνα:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror load</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Σημείωση: </h3><p xmlns="http://www.w3.org/1999/xhtml">Με την επιτυχή εκτέλεση αυτής της εντολής, δημιουργείται η
	  συσκευή <code class="filename">gm0</code> μέσα στον κατάλογο
	  <code class="filename">/dev/mirror</code>.</p></div><p>Ενεργοποιήστε το φόρτωμα του αρθρώματος
	<code class="filename">geom_mirror.ko</code> κατά την εκκίνηση του
	συστήματος:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 'geom_mirror_load="YES"' &gt;&gt; /boot/loader.conf</code></strong></pre><p>Επεξεργαστείτε το αρχείο <code class="filename">/etc/fstab</code>,
	αντικαθιστώντας τις αναφορές στις παλιές συσκευές
	<code class="filename">da0</code> με τις αντίστοιχες καινούριες
	<code class="filename">gm0</code> που αντιπροσωπεύουν το mirror.</p><div xmlns="" class="note"><h3 class="admontitle">Σημείωση: </h3><p xmlns="http://www.w3.org/1999/xhtml">Αν χρησιμοποιείτε το <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a>, μπορείτε να ακολουθήσετε τα
	  παρακάτω βήματα για να ολοκληρώσετε εύκολα αυτή τη
	  διαδικασία:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>vi /etc/fstab</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">Στο <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a>, κρατήστε αντίγραφο ασφαλείας του τρέχοντος
	  αρχείου <code class="filename">fstab</code> πληκτρολογώντας
	  <strong class="userinput"><code>:w /etc/fstab.bak</code></strong>.  Έπειτα αντικαταστήστε
	  όλες τις αναφορές στις παλιές συσκευές <code class="filename">da0</code>
	  με τις νέες <code class="filename">gm0</code> γράφοντας
	  <strong class="userinput"><code>:%s/da/mirror\/gm/g</code></strong>.</p></div><p>Το <code class="filename">fstab</code> που θα προκύψει, θα μοιάζει με
	το παρακάτω.  Δεν έχει σημασία αν οι δίσκοι ήταν αρχικά
	<acronym class="acronym">SCSI</acronym> ή <acronym class="acronym">ATA</acronym>, η συσκευή
	<acronym class="acronym">RAID</acronym> θα έχει πάντα το όνομα
	<code class="filename">gm</code>.</p><pre class="programlisting"># Device                  Mountpoint  FStype      Options   Dump     Pass#
/dev/mirror/gm0s1b        none        swap        sw        0        0
/dev/mirror/gm0s1a        /           ufs         rw        1        1
/dev/mirror/gm0s1d        /usr        ufs         rw        0        0
/dev/mirror/gm0s1f        /home       ufs         rw        2        2
#/dev/mirror/gm0s2d       /store      ufs         rw        2        2
/dev/mirror/gm0s1e        /var        ufs         rw        2        2
/dev/acd0                 /cdrom      cd9660      ro,noauto 0        0</pre><p>Επανεκκινήστε το σύστημα:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre><p>Κατά την εκκίνηση του συστήματος, θα πρέπει πλέον να
	χρησιμοποιείται η συσκευή <code class="filename">gm0</code> αντί για την
	<code class="filename">da0</code>.  Μετά το τέλος της εκκίνησης, μπορείτε
	να ελέγξετε ότι όλα λειτουργούν σωστά, εξετάζοντας την έξοδο της
	εντολής <code class="command">mount</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/mirror/gm0s1a   1012974  224604   707334    24%    /
devfs                      1       1        0   100%    /dev
/dev/mirror/gm0s1f  45970182   28596 42263972     0%    /home
/dev/mirror/gm0s1d   6090094 1348356  4254532    24%    /usr
/dev/mirror/gm0s1e   3045006 2241420   559986    80%    /var
devfs                      1       1        0   100%    /var/named/dev</pre><p>Η έξοδος φαίνεται σωστή, όπως αναμενόταν.  Τελικά, για να
	ξεκινήσει ο συγχρονισμός, εισάγετε και την συσκευή
	<code class="filename">da1</code> στο mirror, χρησιμοποιώντας την
	ακόλουθη εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror insert gm0 /dev/da1</code></strong></pre><p>Κατά τη διάρκεια του συγχρονισμού του mirror, μπορείτε να δείτε
	την πρόοδο της διαδικασίας με την παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror status</code></strong></pre><p>Μετά το τέλος της δόμησης του mirror, και αφού έχουν συγχρονιστεί
	όλα τα δεδομένα, η έξοδος της παραπάνω εντολής θα μοιάζει με την
	ακόλουθη:</p><pre class="screen">      Name    Status  Components
mirror/gm0  COMPLETE  da0
                      da1</pre><p>Αν υπάρχουν προβλήματα, ή αν το mirror βρίσκεται ακόμα στη
	διαδικασία συγχρονισμού, το παράδειγμα θα δείχνει
	<code class="literal">DEGRADED</code> αντί για
	<code class="literal">COMPLETE</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91421264"></a>20.4.2. Αντιμετώπιση Προβλημάτων</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91421904"></a>20.4.2.1. Το σύστημα αρνείται να ξεκινήσει</h4></div></div></div><p>Αν το σύστημα σας σταματάει σε μια προτροπή που μοιάζει με την
	  παρακάτω:</p><pre class="programlisting">ffs_mountroot: can't find rootvp
Root mount failed: 6
mountroot&gt;</pre><p>Επανεκκινήστε το σύστημα σας μέσω του διακόπτη τροφοδοσίας ή
	  του πλήκτρου reset.  Στο μενού εκκίνησης, επιλέξτε το (6).  Με τον
	  τρόπο αυτό θα βρεθείτε στην προτροπή του <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>.  Φορτώστε
	  χειροκίνητα το άρθρωμα στον πυρήνα:</p><pre class="screen">OK? <strong class="userinput"><code>load geom_mirror</code></strong>
OK? <strong class="userinput"><code>boot</code></strong></pre><p>Αν το παραπάνω λειτουργήσει, τότε για κάποιο λόγο το άρθρωμα
	  δεν φορτώθηκε σωστά.  Ελέγξτε αν είναι σωστή η σχετική καταχώριση
	  στο αρχείο <code class="filename">/boot/loader.conf</code>.  Αν το πρόβλημα
	  παραμένει, προσθέστε τη γραμμή:</p><pre class="programlisting">options	GEOM_MIRROR</pre><p>στο αρχείο ρυθμίσεων του πυρήνα σας, αναδημιουργήστε και
	  επανεγκαταστήστε τον πυρήνα σας.  Το πρόβλημα σας θα πρέπει να
	  διορθωθεί.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91427408"></a>20.4.3. Επαναφορά Μετά από Αποτυχία Δίσκου</h3></div></div></div><p>Το εκπληκτικό με το mirroring είναι ότι όταν ένας σκληρός δίσκος
	χαλάσει, μπορείτε να τον αντικαταστήσετε χωρίς να χάσετε καθόλου
	δεδομένα.</p><p>Υποθέτοντας ότι χρησιμοποιούμε τις ρυθμίσεις
	<acronym class="acronym">RAID</acronym>1 που δείξαμε προηγουμένως, ας θεωρήσουμε ότι
	χάλασε ο δίσκος <code class="filename">da1</code> και πρέπει να
	αντικατασταθεί.  Για να τον αντικαταστήσετε, βρείτε ποιος δίσκος είναι
	και απενεργοποιήστε το σύστημα.  Στο σημείο αυτό, μπορείτε πλέον να
	ανταλλάξετε το δίσκο με ένα νέο και να ενεργοποιήσετε ξανά το
	σύστημα.  Μετά την επανενεργοποίηση του συστήματος, μπορείτε να
	χρησιμοποιήσετε τις παρακάτω εντολές για να θέσετε σε λειτουργία το
	νέο δίσκο:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror forget gm0</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmirror insert gm0 /dev/da1</code></strong></pre><p>Χρησιμοποιήστε την εντολή <code class="command">gmirror</code>
	<code class="option">status</code> για να παρακολουθείτε τη διαδικασία του
	συγχρονισμού.  Είναι στα αλήθεια τόσο απλό.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="GEOM-striping.html">Προηγ</a> </td><td width="20%" align="center"><a accesskey="u" href="GEOM.html">Πάνω</a></td><td width="40%" align="right"> <a accesskey="n" href="GEOM-raid3.html">Επόμενο</a></td></tr><tr><td width="40%" align="left" valign="top">20.3. RAID0 - Striping </td><td width="20%" align="center"><a accesskey="h" href="index.html">Αρχή</a></td><td width="40%" align="right" valign="top"> 20.5. <acronym class="acronym">RAID</acronym>3 - Striping σε Επίπεδο Byte με Αφοσιωμένο
      Parity</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Αυτό το κείμενο, και άλλα κείμενα, μπορεί να βρεθεί στο
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Για ερωτήσεις σχετικά με το FreeBSD, διαβάστε την
    <a href="http://www.FreeBSD.org/docs.html">τεκμηρίωση</a> πριν να επικοινωνήσετε με την
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Για ερωτήσεις σχετικά με αυτή την τεκμηρίωση, στείλτε e-mail στην
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>