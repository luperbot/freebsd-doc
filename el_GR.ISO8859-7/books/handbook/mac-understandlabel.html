<?xml version="1.0" encoding="iso-8859-7" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-7" /><title>17.4. Understanding MAC Labels</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Εγχειρίδιο του FreeBSD" /><link rel="up" href="mac.html" title="Κεφάλαιο 17. Υποχρεωτικός Έλεγχος Πρόσβασης" /><link rel="prev" href="mac-initial.html" title="17.3. Explanation of MAC" /><link rel="next" href="mac-planning.html" title="17.5. Planning the Security Configuration" /><link rel="copyright" href="legalnotice.html" title="Νομική Σημείωση" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">17.4. Understanding MAC Labels</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mac-initial.html">Προηγ</a> </td><th width="60%" align="center">Κεφάλαιο 17. Υποχρεωτικός Έλεγχος Πρόσβασης</th><td width="20%" align="right"> <a accesskey="n" href="mac-planning.html">Επόμενο</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-understandlabel"></a>17.4. Understanding MAC Labels</h2></div></div></div><p>A <acronym class="acronym">MAC</acronym> label is a security attribute
      which may be applied to subjects and objects throughout
      the system.</p><p>When setting a label, the user must be able to comprehend
      what it is, exactly, that is being done.  The attributes
      available on an object depend on the policy module loaded, and that
      policy modules interpret their attributes in different
      ways.  If improperly configured due to lack of comprehension, or
      the inability to understand the implications, the result will
      be the unexpected and perhaps, undesired, behavior of the
      system.</p><p>The security label on an object is used as a part of a
      security access control decision by a policy.  With some
      policies, the label by itself contains all information necessary
      to make a decision; in other models, the labels may be processed
      as part of a larger rule set, etc.</p><p>For instance, setting the label of <code class="literal">biba/low</code>
      on a file will represent a label maintained by the Biba security policy module,
      with a value of <span class="quote">«<span class="quote">low</span>»</span>.</p><p>A few policy modules which support the labeling feature in
      FreeBSD offer three specific predefined labels.  These
      are the low, high, and equal labels.  Although they enforce
      access control in a different manner with each policy module, you
      can be sure that the low label will be the lowest setting,
      the equal label will set the subject or object to be disabled
      or unaffected, and the high label will enforce the highest
      setting available in the Biba and <acronym class="acronym">MLS</acronym>
      policy modules.</p><p>Within single label file system environments, only one label may be
      used on objects.  This will enforce one set of
      access permissions across the entire system and in many
      environments may be all that is required.  There are a few
      cases where multiple labels may be set on objects
      or subjects in the file system.  For those cases, the
      <code class="option">multilabel</code> option may be passed to
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a>.</p><p>In the case of Biba and <acronym class="acronym">MLS</acronym>, a numeric
      label may be set to indicate the precise level of hierarchical
      control.  This numeric level is used to partition or sort
      information into different groups of say, classification only
      permitting access to that group or a higher group level.</p><p>In most cases the administrator will only be setting up a
      single label to use throughout the file system.</p><p><span class="emphasis"><em>Hey wait, this is similar to <acronym class="acronym">DAC</acronym>!
      I thought <acronym class="acronym">MAC</acronym> gave control strictly to the
      administrator.</em></span>  That statement still holds true, to some
      extent as <code class="systemitem">root</code> is the one in control and who
      configures the policies so that users are placed in the
      appropriate categories/access levels.  Alas, many policy modules can
      restrict the <code class="systemitem">root</code> user as well.  Basic
      control over objects will then be released to the group, but
      <code class="systemitem">root</code> may revoke or modify the settings
      at any time.  This is the hierarchal/clearance model covered
      by policies such as Biba and <acronym class="acronym">MLS</acronym>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89237328"></a>17.4.1. Label Configuration</h3></div></div></div><p>Virtually all aspects of label policy module configuration
	will be performed using the base system utilities.  These
	commands provide a simple interface for object or subject
	configuration or the manipulation and verification of
	the configuration.</p><p>All configuration may be done by use of the
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=setfmac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">setfmac</span>(8)</span></a> and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=setpmac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">setpmac</span>(8)</span></a> utilities.
	The <code class="command">setfmac</code> command is used to set
	<acronym class="acronym">MAC</acronym> labels on system objects while the
	<code class="command">setpmac</code> command is used to set the labels
	on system subjects.  Observe:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setfmac biba/high test</code></strong></pre><p>If no errors occurred with the command above, a prompt
	will be returned.  The only time these commands are not
	quiescent is when an error occurred; similarly to the
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a> and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chown&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">chown</span>(8)</span></a> commands.  In some cases this
	error may be a <span class="errorname">Permission denied</span> and
	is usually obtained when the label is being set or modified
	on an object which is restricted.<a href="#ftn.idp89252816" class="footnote" id="idp89252816"><sup class="footnote">[9]</sup></a>  The system administrator
	may use the following commands to overcome this:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setfmac biba/high test</code></strong>
<span class="errorname">Permission denied</span>
<code class="prompt">#</code> <strong class="userinput"><code>setpmac biba/low setfmac biba/high test</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>getfmac test</code></strong>
test: biba/high</pre><p>As we see above, <code class="command">setpmac</code>
	can be used to override the policy module's settings by assigning
	a different label to the invoked process.  The
	<code class="command">getpmac</code> utility is usually used with currently
	running processes, such as <span class="application">sendmail</span>:
	although it takes a process ID in place of
	a command the logic is extremely similar.  If users
	attempt to manipulate a file not in their access, subject to the
	rules of the loaded policy modules, the
	<span class="errorname">Operation not permitted</span> error
	will be displayed by the <code class="function">mac_set_link</code>
	function.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89258832"></a>17.4.1.1. Common Label Types</h4></div></div></div><p>For the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac_biba&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">mac_biba</span>(4)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac_mls&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">mac_mls</span>(4)</span></a> and
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac_lomac&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">mac_lomac</span>(4)</span></a> policy modules, the ability to assign
	  simple labels is provided.  These take the form of high,
	  equal and low, what follows is a brief description of
	  what these labels provide:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="literal">low</code> label is considered the
	      lowest label setting an object or subject may have.
	      Setting this on objects or subjects will block their
	      access to objects or subjects marked high.</p></li><li class="listitem"><p>The <code class="literal">equal</code> label should only be
	      placed on objects considered to be exempt from the
	      policy.</p></li><li class="listitem"><p>The <code class="literal">high</code> label grants an object or
	      subject the highest possible setting.</p></li></ul></div><p>With respect to each policy module, each of those settings
	  will instate a different information flow directive.  Reading
	  the proper manual pages will further explain the traits of
	  these generic label configurations.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89266512"></a>17.4.1.1.1. Advanced Label Configuration</h5></div></div></div><p>Numeric grade labels are used for
	    <code class="literal">comparison:compartment+compartment</code>; thus
	    the following:</p><pre class="programlisting">biba/10:2+3+6(5:2+3-20:2+3+4+5+6)</pre><p>May be interpreted as:</p><p><span class="quote">«<span class="quote">Biba Policy Label</span>»</span>/<span class="quote">«<span class="quote">Grade 10</span>»</span>
	    :<span class="quote">«<span class="quote">Compartments 2, 3 and 6</span>»</span>:
	    (<span class="quote">«<span class="quote">grade 5 ...</span>»</span>)</p><p>In this example, the first grade would be considered
	    the <span class="quote">«<span class="quote">effective grade</span>»</span> with
	    <span class="quote">«<span class="quote">effective compartments</span>»</span>, the second grade
	    is the low grade and the last one is the high grade.
	    In most configurations these settings will not be used;
	    indeed, they offered for more advanced
	    configurations.</p><p>When applied to system objects, they will only have a
	    current grade/compartments as opposed to system subjects
	    as they reflect the range of available rights in the system,
	    and network interfaces, where they are used for access
	    control.</p><p>The grade and compartments in a subject and object pair
	    are used to construct a relationship referred to as
	    <span class="quote">«<span class="quote">dominance</span>»</span>, in which a subject dominates an
	    object, the object dominates the subject, neither dominates
	    the other, or both dominate each other.  The
	    <span class="quote">«<span class="quote">both dominate</span>»</span> case occurs when the two labels
	    are equal.  Due to the information flow nature of Biba, you
	    have rights to a set of compartments,
	    <span class="quote">«<span class="quote">need to know</span>»</span>, that might correspond to
	    projects, but objects also have a set of compartments.
	    Users may have to subset their rights using
	    <code class="command">su</code> or <code class="command">setpmac</code> in order
	    to access objects in a compartment from which they are not
	    restricted.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89278928"></a>17.4.1.2. Users and Label Settings</h4></div></div></div><p>Users themselves are required to have labels so that
	  their files and processes may properly interact with the
	  security policy defined on the system.  This is
	  configured through the <code class="filename">login.conf</code> file
	  by use of login classes.  Every policy module that uses labels
	  will implement the user class setting.</p><p>An example entry containing every policy module setting is displayed
	  below:</p><pre class="programlisting">default:\
	:copyright=/etc/COPYRIGHT:\
	:welcome=/etc/motd:\
	:setenv=MAIL=/var/mail/$,BLOCKSIZE=K:\
	:path=~/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:\
	:manpath=/usr/share/man /usr/local/man:\
	:nologin=/usr/sbin/nologin:\
	:cputime=1h30m:\
	:datasize=8M:\
	:vmemoryuse=100M:\
	:stacksize=2M:\
	:memorylocked=4M:\
	:memoryuse=8M:\
	:filesize=8M:\
	:coredumpsize=8M:\
	:openfiles=24:\
	:maxproc=32:\
	:priority=0:\
	:requirehome:\
	:passwordtime=91d:\
	:umask=022:\
	:ignoretime@:\
	:label=partition/13,mls/5,biba/10(5-15),lomac/10[2]:</pre><p>The <code class="literal">label</code> option is used to set the
	  user class default label which will be enforced by
	  <acronym class="acronym">MAC</acronym>.  Users will never be permitted to
	  modify this value, thus it can be considered not optional
	  in the user case.  In a real configuration, however, the
	  administrator will never wish to enable every policy module.
	  It is recommended that the rest of this chapter be reviewed
	  before any of this configuration is implemented.</p><div xmlns="" class="note"><h3 class="admontitle">Σημείωση: </h3><p xmlns="http://www.w3.org/1999/xhtml">Users may change their label after the initial login;
	    however, this change is subject constraints of the policy.
	    The example above tells the Biba policy that a process's
	    minimum integrity is 5, its maximum is 15, but the default
	    effective label is 10.  The process will run at 10 until
	    it chooses to change label, perhaps due to the user using
	    the setpmac command, which will be constrained by Biba to
	    the range set at login.</p></div><p>In all cases, after a change to
	  <code class="filename">login.conf</code>, the login class capability
	  database must be rebuilt using <code class="command">cap_mkdb</code>
	  and this will be reflected throughout every forthcoming
	  example or discussion.</p><p>It is useful to note that many sites may have a
	  particularly large number of users requiring several
	  different user classes.  In depth planning is required
	  as this may get extremely difficult to manage.</p><p>Future versions of FreeBSD will include a new way to
	  deal with mapping users to labels; however, this will
	  not be available until some time after FreeBSD 5.3.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89289424"></a>17.4.1.3. Network Interfaces and Label Settings</h4></div></div></div><p>Labels may also be set on network interfaces to help
	  control the flow of data across the network.  In all cases
	  they function in the same way the policies function with
	  respect to objects.  Users at high settings in
	  <code class="literal">biba</code>, for example, will not be permitted
	  to access network interfaces with a label of low.</p><p>The <code class="option">maclabel</code> may be passed to
	  <code class="command">ifconfig</code> when setting the
	  <acronym class="acronym">MAC</acronym> label on network interfaces.  For
	  example:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bge0 maclabel biba/equal</code></strong></pre><p>will set the <acronym class="acronym">MAC</acronym> label of
	  <code class="literal">biba/equal</code> on the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bge&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bge</span>(4)</span></a> interface.
	  When using a setting similar to
	  <code class="literal">biba/high(low-high)</code> the entire label should
	  be quoted; otherwise an error will be returned.</p><p>Each policy module which supports labeling has a tunable
	  which may be used to disable the <acronym class="acronym">MAC</acronym>
	  label on network interfaces.  Setting the label to
	  <code class="option">equal</code> will have a similar effect.  Review
	  the output from <code class="command">sysctl</code>, the policy manual
	  pages, or even the information found later in this chapter
	  for those tunables.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89301584"></a>17.4.2. Singlelabel or Multilabel?</h3></div></div></div><p>By default the system will use the
	<code class="option">singlelabel</code> option.  But what does this
	mean to the administrator?  There are several differences
	which, in their own right, offer pros and cons to the
	flexibility in the systems security model.</p><p>The <code class="option">singlelabel</code> only permits for one
	label, for instance <code class="literal">biba/high</code> to be used
	for each subject or object.  It provides for lower
	administration overhead but decreases the flexibility of
	policies which support labeling.  Many administrators may
	want to use the <code class="option">multilabel</code> option in
	their security policy.</p><p>The <code class="option">multilabel</code> option will permit each
	subject or object to have its own independent
	<acronym class="acronym">MAC</acronym> label in
	place of the standard <code class="option">singlelabel</code> option
	which will allow only one label throughout the partition.
	The <code class="option">multilabel</code> and <code class="option">single</code>
	label options are only required for the policies which
	implement the labeling feature, including the Biba, Lomac,
	<acronym class="acronym">MLS</acronym> and <acronym class="acronym">SEBSD</acronym>
	policies.</p><p>In many cases, the <code class="option">multilabel</code> may not need
	to be set at all.  Consider the following situation and
	security model:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FreeBSD web-server using the <acronym class="acronym">MAC</acronym>
	    framework and a mix of the various policies.</p></li><li class="listitem"><p>This machine only requires one label,
	    <code class="literal">biba/high</code>, for everything in the system.
	    Here the file system would not require the
	    <code class="option">multilabel</code> option as a single label
	    will always be in effect.</p></li><li class="listitem"><p>But, this machine will be a web server and should have
	    the web server run at <code class="literal">biba/low</code> to prevent
	    write up capabilities.  The Biba policy and how it works
	    will be discussed later, so if the previous comment was
	    difficult to interpret just continue reading and return.
	    The server could use a separate partition set at
	    <code class="literal">biba/low</code> for most if not all of its
	    runtime state.  Much is lacking from this example, for
	    instance the restrictions on data, configuration and user
	    settings; however, this is just a quick example to prove the
	    aforementioned point.</p></li></ul></div><p>If any of the non-labeling policies are to be used,
	then the <code class="option">multilabel</code> option would never
	be required.  These include the <code class="literal">seeotheruids</code>,
	<code class="literal">portacl</code> and <code class="literal">partition</code>
	policies.</p><p>It should also be noted that using
	<code class="option">multilabel</code> with a partition and establishing
	a security model based on <code class="option">multilabel</code>
	functionality could open the doors for higher administrative
	overhead as everything in the file system would have a label.
	This includes directories, files, and even device
	nodes.</p><p>The following command will set <code class="option">multilabel</code>
	on the file systems to have multiple labels.  This may only be
	done in single user mode:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tunefs -l enable /</code></strong></pre><p>This is not a requirement for the swap file
	system.</p><div xmlns="" class="note"><h3 class="admontitle">Σημείωση: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some users have experienced problems with setting the
	  <code class="option">multilabel</code> flag on the root partition.
	  If this is the case, please review the
	  <a class="xref" href="mac-troubleshoot.html" title="17.16. Troubleshooting the MAC Framework">Τμήμα 17.16, «Troubleshooting the MAC Framework»</a> of this chapter.</p></div></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp89252816" class="footnote"><p><a href="#idp89252816" class="para"><sup class="para">[9] </sup></a>Other conditions
	may produce different failures.  For instance, the file may not
	be owned by the	user attempting to relabel the object, the
	object may not exist or	may be read only.  A mandatory policy
	will not allow the process to relabel the file, maybe because
	of a property of the file, a property of the process, or a
	property of the proposed new label value.  For example: a user
	running at low integrity tries to change the label of a high
	integrity file.  Or perhaps a user running at low integrity
	tries to change the label of a low integrity file to a high
	integrity label.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mac-initial.html">Προηγ</a> </td><td width="20%" align="center"><a accesskey="u" href="mac.html">Πάνω</a></td><td width="40%" align="right"> <a accesskey="n" href="mac-planning.html">Επόμενο</a></td></tr><tr><td width="40%" align="left" valign="top">17.3. Explanation of MAC </td><td width="20%" align="center"><a accesskey="h" href="index.html">Αρχή</a></td><td width="40%" align="right" valign="top"> 17.5. Planning the Security Configuration</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Αυτό το κείμενο, και άλλα κείμενα, μπορεί να βρεθεί στο
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Για ερωτήσεις σχετικά με το FreeBSD, διαβάστε την
    <a href="http://www.FreeBSD.org/docs.html">τεκμηρίωση</a> πριν να επικοινωνήσετε με την
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Για ερωτήσεις σχετικά με αυτή την τεκμηρίωση, στείλτε e-mail στην
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>