<?xml version="1.0" encoding="iso-8859-7" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-7" /><title>31.5. Bridging</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Εγχειρίδιο του FreeBSD" /><link rel="up" href="advanced-networking.html" title="Κεφάλαιο 31. Προχωρημένα Θέματα Δικτύωσης" /><link rel="prev" href="network-bluetooth.html" title="31.4. Bluetooth" /><link rel="next" href="network-diskless.html" title="31.6. Diskless Operation" /><link rel="copyright" href="legalnotice.html" title="Νομική Σημείωση" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.5. Bridging</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-bluetooth.html">Προηγ</a> </td><th width="60%" align="center">Κεφάλαιο 31. Προχωρημένα Θέματα Δικτύωσης</th><td width="20%" align="right"> <a accesskey="n" href="network-diskless.html">Επόμενο</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-bridging"></a>31.5. Bridging</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Steve</span> <span class="surname">Peterson</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100389712"></a>31.5.1. Introduction</h3></div></div></div><a id="idp100390352" class="indexterm"></a><a id="idp100390864" class="indexterm"></a><p>It is sometimes useful to divide one physical network
	(such as an Ethernet segment) into two separate network
	segments without having to create IP subnets and use a router
	to connect the segments together.  A device that connects two
	networks together in this fashion is called a
	<span class="quote">«<span class="quote">bridge</span>»</span>.  A FreeBSD system with two network
	interface cards can act as a bridge.</p><p>The bridge works by learning the MAC layer addresses
	(Ethernet addresses) of the devices on each of its network interfaces.
	It forwards traffic between two networks only when its source and
	destination are on different networks.</p><p>In many respects, a bridge is like an Ethernet switch with very
	few ports.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100393040"></a>31.5.2. Situations Where Bridging Is Appropriate</h3></div></div></div><p>There are two common situations in which a bridge is used
	today.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100406480"></a>31.5.2.1. High Traffic on a Segment</h4></div></div></div><p>Situation one is where your physical network segment is
	  overloaded with traffic, but you do not want for whatever reason to
	  subnet the network and interconnect the subnets with a
	  router.</p><p>Let us consider an example of a newspaper where the Editorial and
	  Production departments are on the same subnetwork.  The Editorial
	  users all use server <code class="systemitem">A</code> for file service, and the Production users
	  are on server <code class="systemitem">B</code>.  An Ethernet network is used to connect all users together,
	  and high loads on the network are slowing things down.</p><p>If the Editorial users could be segregated on one
	  network segment and the Production users on another, the two
	  network segments could be connected with a bridge.  Only the
	  network traffic destined for interfaces on the
	  <span class="quote">«<span class="quote">other</span>»</span> side of the bridge would be sent to the
	  other network, reducing congestion on each network
	  segment.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100409680"></a>31.5.2.2. Filtering/Traffic Shaping Firewall</h4></div></div></div><a id="idp100410320" class="indexterm"></a><a id="idp100410832" class="indexterm"></a><p>The second common situation is where firewall functionality is
	  needed without network address translation (NAT).</p><p>An example is a small company that is connected via DSL
	  or ISDN to their ISP.  They have a 13 globally-accessible IP
	  addresses from their ISP and have 10 PCs on their network.
	  In this situation, using a router-based firewall is
	  difficult because of subnetting issues.</p><a id="idp100412240" class="indexterm"></a><a id="idp100412752" class="indexterm"></a><a id="idp100413264" class="indexterm"></a><p>A bridge-based firewall can be configured and dropped into the
	  path just downstream of their DSL/ISDN router without any IP
	  numbering issues.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100414544"></a>31.5.3. Configuring a Bridge</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100415184"></a>31.5.3.1. Network Interface Card Selection</h4></div></div></div><p>A bridge requires at least two network cards to function.
	  Unfortunately, not all network interface cards
	  support bridging.  Read <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bridge&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bridge</span>(4)</span></a> for details on the cards that
	  are supported.</p><p>Install and test the two network cards before continuing.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100417488"></a>31.5.3.2. Kernel Configuration Changes</h4></div></div></div><a id="idp100418128" class="indexterm"></a><p>To enable kernel support for bridging, add the:</p><pre class="programlisting">options BRIDGE</pre><p>statement to your kernel configuration file, and rebuild your
	  kernel.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100420560"></a>31.5.3.3. Firewall Support</h4></div></div></div><a id="idp100421200" class="indexterm"></a><p>If you are planning to use the bridge as a firewall, you
	  will need to add the <code class="literal">IPFIREWALL</code> option as
	  well.  Read <a class="xref" href="firewalls.html" title="Κεφάλαιο 30. Firewalls">Κεφάλαιο 30, <em>Firewalls</em></a> for general
	  information on configuring the bridge as a firewall.</p><p>If you need to allow non-IP packets (such as ARP) to flow
	  through the bridge, there are three options available.
	  The first is to add the following option to the kernel and
	  rebuild:</p><pre class="programlisting">option	IPFIREWALL_DEFAULT_TO_ACCEPT</pre><p>The second is to set the firewall type to <span class="quote">«<span class="quote"><code class="literal">open</code></span>»</span> in the
	  <code class="filename">rc.conf</code> file:</p><pre class="programlisting">firewall_type="open"</pre><p>Note that these options will make the firewall seem completely
	  transparent; any packet or connection will be permitted by default.
	  This may require significant changes to the firewall ruleset.</p><p>The third option is to apply the following <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>
	  rule:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipfw add allow mac-type arp layer2</code></strong></pre><p>Or add it to the current firewall ruleset.  This rule effectively
	  allows <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=arp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">arp</span>(8)</span></a> packets through, so it must be be applied near the
	  beginning of the ruleset for early evaluation.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100433232"></a>31.5.3.4. Traffic Shaping Support</h4></div></div></div><p>If you want to use the bridge as a traffic shaper, you will need
	  to add the <code class="literal">DUMMYNET</code> option to your kernel
	  configuration.  Read <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dummynet&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">dummynet</span>(4)</span></a> for further
	  information.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100435792"></a>31.5.4. Enabling the Bridge</h3></div></div></div><p>Add the line:</p><pre class="programlisting">net.link.ether.bridge.enable=1</pre><p>to <code class="filename">/etc/sysctl.conf</code> to enable the bridge at
	runtime, and the line:</p><pre class="programlisting">net.link.ether.bridge.config=<em class="replaceable"><code>if1</code></em>,<em class="replaceable"><code>if2</code></em></pre><p>to enable bridging on the specified interfaces (replace
	<em class="replaceable"><code>if1</code></em> and
	<em class="replaceable"><code>if2</code></em> with the names of your two
	network interfaces).  If you want the bridged packets to be
	filtered by <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a>, you should add:</p><pre class="programlisting">net.link.ether.bridge.ipfw=1</pre><p>as well.</p><p>For versions prior to FreeBSD 5.2-RELEASE, use instead the following
	lines:</p><pre class="programlisting">net.link.ether.bridge=1
net.link.ether.bridge_cfg=<em class="replaceable"><code>if1</code></em>,<em class="replaceable"><code>if2</code></em>
net.link.ether.bridge_ipfw=1</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100443472"></a>31.5.5. Other Information</h3></div></div></div><p>If you want to be able to <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> into the bridge from the network,
	it is correct to assign one of the network cards an IP address.  The
	consensus is that assigning both cards an address is a bad
	idea.</p><p>If you have multiple bridges on your network, there cannot be more
	than one path between any two workstations.  Technically, this means
	that there is no support for spanning tree link management.</p><p>A bridge can add latency to your <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> times, especially for
        traffic from one segment to another.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-bluetooth.html">Προηγ</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Πάνω</a></td><td width="40%" align="right"> <a accesskey="n" href="network-diskless.html">Επόμενο</a></td></tr><tr><td width="40%" align="left" valign="top">31.4. Bluetooth </td><td width="20%" align="center"><a accesskey="h" href="index.html">Αρχή</a></td><td width="40%" align="right" valign="top"> 31.6. Diskless Operation</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Αυτό το κείμενο, και άλλα κείμενα, μπορεί να βρεθεί στο
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Για ερωτήσεις σχετικά με το FreeBSD, διαβάστε την
    <a href="http://www.FreeBSD.org/docs.html">τεκμηρίωση</a> πριν να επικοινωνήσετε με την
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Για ερωτήσεις σχετικά με αυτή την τεκμηρίωση, στείλτε e-mail στην
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>