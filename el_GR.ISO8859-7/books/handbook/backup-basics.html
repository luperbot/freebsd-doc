<?xml version="1.0" encoding="iso-8859-7" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-7" /><title>19.10. Backup Basics</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Εγχειρίδιο του FreeBSD" /><link rel="up" href="disks.html" title="Κεφάλαιο 19. Αποθηκευτικά Μέσα" /><link rel="prev" href="backup-strategies.html" title="19.9. Backup Strategies" /><link rel="next" href="disks-virtual.html" title="19.11. Network, Memory, and File-Backed File Systems" /><link rel="copyright" href="legalnotice.html" title="Νομική Σημείωση" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">19.10. Backup Basics</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="backup-strategies.html">Προηγ</a> </td><th width="60%" align="center">Κεφάλαιο 19. Αποθηκευτικά Μέσα</th><td width="20%" align="right"> <a accesskey="n" href="disks-virtual.html">Επόμενο</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="backup-basics"></a>19.10. Backup Basics</h2></div></div></div><p>The major backup programs built into FreeBSD are
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tar&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cpio&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cpio</span>(1)</span></a>, and
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pax&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">pax</span>(1)</span></a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90601168"></a>19.10.1. Dump and Restore</h3></div></div></div><a id="idp90601808" class="indexterm"></a><a id="idp90602960" class="indexterm"></a><a id="idp90603856" class="indexterm"></a><p>The traditional <span class="trademark">UNIX</span>(R) backup programs are
	<code class="command">dump</code> and <code class="command">restore</code>.  They
	operate on the drive as a collection of disk blocks, below the
	abstractions of files, links and directories that are created
	by the file systems.  Unlike other backup software,
	<code class="command">dump</code> backs up an entire file system on a
	device.  It is unable to backup only part of a file system or
	a directory tree that spans more than one file system.
	<code class="command">dump</code> does not write files and directories,
	but rather writes the raw data blocks that comprise files and
	directories.  When used to extract data,
	<code class="command">restore</code> stores temporary files in
	<code class="filename">/tmp/</code> by default.  When using a recovery
	disk with a small <code class="filename">/tmp</code>, set
	<code class="envar">TMPDIR</code> to a directory with more free space in
	order for the restore to succeed.</p><div xmlns="" class="note"><h3 class="admontitle">Σημείωση: </h3><p xmlns="http://www.w3.org/1999/xhtml">If <code class="command">dump</code> is used on the root
	  directory, it will not back up <code class="filename">/home</code>,
	  <code class="filename">/usr</code> or many other
	  directories since these are typically mount points for other
	  file systems or symbolic links into those file
	  systems.</p></div><p><code class="command">dump</code> has quirks that remain from its
	early days in Version 6 of AT&amp;T <span class="trademark">UNIX</span>(R),circa 1975.  The
	default parameters are suitable for 9-track tapes (6250 bpi),
	not the high-density media available today (up to 62,182
	ftpi).  These defaults must be overridden on the command line
	to utilize the capacity of current tape drives.</p><a id="idp90611920" class="indexterm"></a><p>It is also possible to backup data across the network to a
	tape drive attached to another computer with
	<code class="command">rdump</code> and <code class="command">rrestore</code>.
	Both programs rely upon <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rcmd&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">rcmd</span>(3)</span></a> and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ruserok&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">ruserok</span>(3)</span></a> to
	access the remote tape drive.  Therefore, the user performing
	the backup must be listed in <code class="filename">.rhosts</code> on
	the remote computer.  The arguments to
	<code class="command">rdump</code> and <code class="command">rrestore</code> must
	be suitable to use on the remote computer.  For example, to
	<code class="command">rdump</code> from a FreeBSD computer to an Exabyte
	tape drive connected to a host called
	<code class="systemitem">komodo</code>, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/sbin/rdump 0dsbfu 54000 13000 126 komodo:/dev/nsa8 /dev/da0a 2&gt;&amp;1</code></strong></pre><p>There are security implications to allowing
	<code class="filename">.rhosts</code> authentication, so use
	with caution.</p><p>It is also possible to use <code class="command">dump</code> and
	<code class="command">restore</code> in a more secure fashion over
	<code class="command">ssh</code>.</p><div class="example"><a id="idp90628944"></a><div class="example-title">Παράδειγμα 19.1. Using <code class="command">dump</code> over
	  <span class="application">ssh</span></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/sbin/dump -0uan -f - /usr | gzip -2 | ssh -c blowfish \
          targetuser@targetmachine.example.com dd of=/mybigfiles/dump-usr-l0.gz</code></strong></pre></div></div><br class="example-break" /><p>Or, use the built-in <code class="envar">RSH</code>:</p><div class="example"><a id="idp90632016"></a><div class="example-title">Παράδειγμα 19.2. Using <code class="command">dump</code> over
	  <span class="application">ssh</span> with <code class="envar">RSH</code>
	  Set</div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>env RSH=/usr/bin/ssh /sbin/dump -0uan -f targetuser@targetmachine.example.com:/dev/sa0 /usr</code></strong></pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90635088"></a>19.10.2. <code class="command">tar</code></h3></div></div></div><a id="idp90635856" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tar&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a> also dates back to Version 6 of AT&amp;T
	<span class="trademark">UNIX</span>(R), circa 1975.  <code class="command">tar</code> operates in
	cooperation with the file system and writes files and
	directories to tape.  <code class="command">tar</code> does not support
	the full range of options that are available from
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cpio&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cpio</span>(1)</span></a>, but it does not require the unusual command
	pipeline that <code class="command">cpio</code> uses.</p><a id="idp90640592" class="indexterm"></a><p>To <code class="command">tar</code> to an Exabyte tape drive
	connected to a host called
	<code class="systemitem">komodo</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tar cf - . | rsh komodo dd of=tape-device obs=20b</code></strong></pre><p>When backing up over an insecure network, instead use
	<code class="command">ssh</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90648400"></a>19.10.3. <code class="command">cpio</code></h3></div></div></div><a id="idp90649168" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cpio&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cpio</span>(1)</span></a> is the original <span class="trademark">UNIX</span>(R) file interchange tape
	program for magnetic media.  <code class="command">cpio</code> includes
	options to perform byte-swapping, write a number of different
	archive formats, and pipe the data to other programs.  This
	last feature makes <code class="command">cpio</code> an excellent choice
	for installation media.  <code class="command">cpio</code> does not know
	how to walk the directory tree and a list of files must be
	provided through <code class="filename">stdin</code>.</p><a id="idp90657744" class="indexterm"></a><p>Since <code class="command">cpio</code> does not support backups
	across the network, use a pipeline and <code class="command">ssh</code>
	to send the data to a remote tape drive.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>for f in directory_list; do</code></strong>
<strong class="userinput"><code>find $f &gt;&gt; backup.list</code></strong>
<strong class="userinput"><code>done</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cpio -v -o --format=newc &lt; backup.list | ssh user@host "cat &gt; backup_device"</code></strong></pre><p>Where <em class="replaceable"><code>directory_list</code></em> is the
	list of directories to back up,
	<em class="replaceable"><code>user</code></em>@<em class="replaceable"><code>host</code></em>
	is the user/hostname combination that will be performing the
	backups, and <em class="replaceable"><code>backup_device</code></em> is where
	the backups should be written to, such as
	<code class="filename">/dev/nsa0</code>).</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90664656"></a>19.10.4. <code class="command">pax</code></h3></div></div></div><a id="idp90665552" class="indexterm"></a><a id="idp90666832" class="indexterm"></a><a id="idp90667472" class="indexterm"></a><a id="idp90667984" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pax&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">pax</span>(1)</span></a> is the IEEE/<span class="trademark">POSIX</span>(R) answer to
	<code class="command">tar</code> and <code class="command">cpio</code>.  Over the
	years the various versions of <code class="command">tar</code> and
	<code class="command">cpio</code> have become slightly incompatible.  So
	rather than fight it out to fully standardize them, <span class="trademark">POSIX</span>(R)
	created a new archive utility.  <code class="command">pax</code>
	attempts to read and write many of the various
	<code class="command">cpio</code> and <code class="command">tar</code> formats,
	plus new formats of its own.  Its command set more resembles
	<code class="command">cpio</code> than <code class="command">tar</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="backups-programs-amanda"></a>19.10.5. <span class="application">Amanda</span></h3></div></div></div><a id="idp90675152" class="indexterm"></a><a id="idp90676432" class="indexterm"></a><p><span class="application">Amanda</span> (Advanced Maryland
	Network Disk Archiver) is a client/server backup system,
	rather than a single program.  An
	<span class="application">Amanda</span> server will backup to a
	single tape drive any number of computers that have
	<span class="application">Amanda</span> clients and a network
	connection to the <span class="application">Amanda</span> server.  A
	common problem at sites with a number of large disks is that
	the length of time required to backup to data directly to tape
	exceeds the amount of time available for the task.
	<span class="application">Amanda</span> solves this problem by using
	a <span class="quote">«<span class="quote">holding disk</span>»</span> to backup several file systems
	at the same time.  <span class="application">Amanda</span> creates
	<span class="quote">«<span class="quote">archive sets</span>»</span>: a group of tapes used over a
	period of time to create full backups of all the file systems
	listed in <span class="application">Amanda</span>'s configuration
	file.  The <span class="quote">«<span class="quote">archive set</span>»</span> also contains nightly
	incremental, or differential, backups of all the file systems.
	Restoring a damaged file system requires the most recent full
	backup and the incremental backups.</p><p>The configuration file provides fine grained control of
	backups and the network traffic that
	<span class="application">Amanda</span> generates.
	<span class="application">Amanda</span> will use any of the above
	backup programs to write the data to tape.
	<span class="application">Amanda</span> is not installed by
	but is available as either a port or package.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90691792"></a>19.10.6. Do Nothing</h3></div></div></div><p><span class="quote">«<span class="quote">Do nothing</span>»</span> is not a computer program, but
	it is the most widely used backup strategy.  There are no
	initial costs.  There is no backup schedule to follow.  Just
	say no.  If something happens to your data, grin and bear
	it!</p><p>If your time and data is worth little to nothing, then
	<span class="quote">«<span class="quote">Do nothing</span>»</span> is the most suitable backup program
	for the computer.  But beware, FreeBSD is a useful tool and
	over time it can be used to create a valuable collection of
	files.</p><p><span class="quote">«<span class="quote">Do nothing</span>»</span> is the correct backup method for
	<code class="filename">/usr/obj</code> and other
	directory trees that can be exactly recreated by the computer.
	An example is the files that comprise the HTML or <span class="trademark">PostScript</span>(R)
	version of this Handbook.  These document formats have been
	created from XML input files.  Creating backups of the HTML or
	<span class="trademark">PostScript</span>(R) files is not necessary if the XML files are
	backed up regularly.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90696272"></a>19.10.7. Which Backup Program Is Best?</h3></div></div></div><a id="idp90696912" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> <span class="emphasis"><em>Period.</em></span> Elizabeth D.
	Zwicky torture tested all the backup programs discussed here.
	The clear choice for preserving all your data and all the
	peculiarities of <span class="trademark">UNIX</span>(R) file systems is
	<code class="command">dump</code>.  Elizabeth created file systems
	containing a large variety of unusual conditions (and some not
	so unusual ones) and tested each program by doing a backup and
	restore of those file systems.  The peculiarities included:
	files with holes, files with holes and a block of nulls, files
	with funny characters in their names, unreadable and
	unwritable files, devices, files that change size during the
	backup, files that are created/deleted during the backup and
	more.   She presented the results at LISA V in Oct. 1991.  See
	<a class="link" href="http://www.coredumps.de/doc/dump/zwicky/testdump.doc.html" target="_top">torture-testing
	  Backup and Archive Programs</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90700752"></a>19.10.8. Emergency Restore Procedure</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90701392"></a>19.10.8.1. Before the Disaster</h4></div></div></div><p>There are four steps which should be performed in
	  preparation for any disaster that may occur.</p><a id="idp90702416" class="indexterm"></a><p>First, print the bsdlabel of each disk using a command
	  such as <code class="command">bsdlabel da0 | lpr</code>.  Also print a
	  copy of <code class="filename">/etc/fstab</code> and all boot
	  messages.</p><a id="idp90704464" class="indexterm"></a><p>Second, burn a <span class="quote">«<span class="quote">livefs</span>»</span> CD.  This CD
	  contains support for booting into a FreeBSD
	  <span class="quote">«<span class="quote">livefs</span>»</span> rescue mode, allowing the user to
	  perform many tasks like running <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a>,
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=restore&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">restore</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fdisk&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">fdisk</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a>,
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>, and more.  The livefs CD image
	  for FreeBSD/i386 9.3-RELEASE is
	  available from <code class="uri"><a class="uri" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/9.3/FreeBSD-9.3-RELEASE-i386-livefs.iso" target="_top">ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/9.3/FreeBSD-9.3-RELEASE-i386-livefs.iso</a></code>.</p><div xmlns="" class="note"><h3 class="admontitle">Σημείωση: </h3><p xmlns="http://www.w3.org/1999/xhtml">Livefs CD images are not available for
	    FreeBSD 10.1-RELEASE and later.  In addition to
	    the CD-ROM installation images, flash drive installation
	    images may be used to recover a system.  The
	    <span class="quote">«<span class="quote">memstick</span>»</span> image for
	    FreeBSD/i386 10.1-RELEASE is available
	    from <code class="uri"><a class="uri" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/i386/ISO-IMAGES/10.1/FreeBSD-10.1-RELEASE-i386-memstick.img" target="_top">ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/i386/ISO-IMAGES/10.1/FreeBSD-10.1-RELEASE-i386-memstick.img</a></code>.</p></div><p>Third, create backup tapes regularly.  Any changes that
	  made after the last backup may be irretrievably lost.
	  Write-protect the backup media.</p><p>Fourth, test the <span class="quote">«<span class="quote">livefs</span>»</span> CD and the
	  backups.  Make notes of the procedure.  Store these notes
	  with the CD, the printouts, and the backups.  These notes
	  may prevent the inadvertent destruction of the backups while
	  under the stress of performing an emergency
	  recovery.</p><p>For an added measure of security, store an extra
	  <span class="quote">«<span class="quote">livefs</span>»</span> CD and the latest backup at a
	  remote location, where a remote location is
	  <span class="emphasis"><em>not</em></span> the basement of the same building.
	  A remote location should be physically separated from the
	  computers and disk drives by a significant distance.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90719696"></a>19.10.8.2. After the Disaster</h4></div></div></div><p>First, determine if the hardware survived.  Thanks
	  to regular, off-site backups, there is no need to worry
	  about the software.</p><p>If the hardware has been damaged, the parts should be
	  replaced before attempting to use the computer.</p><p>If the hardware is okay, insert the
	  <span class="quote">«<span class="quote">livefs</span>»</span> CD and boot the computer.  The
	  original install menu will be displayed on the screen.
	  Select the correct country, then choose
	  <span class="guimenuitem">Fixit -- Repair mode with CD-ROM/DVD/floppy or
	  start a shell.</span> then select
	  <span class="guimenuitem">CD-ROM/DVD -- Use the live filesystem
	  CD-ROM/DVD</span>.
	  <code class="command">restore</code> and the other needed programs
	  are located in <code class="filename">/mnt2/rescue</code>.</p><p>Recover each file system separately.</p><a id="idp90723792" class="indexterm"></a><a id="idp90724688" class="indexterm"></a><a id="idp90725200" class="indexterm"></a><a id="idp90726096" class="indexterm"></a><p>Try to <code class="command">mount</code> the root partition
	  of the first disk using <code class="command">mount /dev/da0a
	    /mnt</code>.  If the bsdlabel was damaged, use
	  <code class="command">bsdlabel</code> to re-partition and label the
	  disk to match the label that was printed and saved.  Use
	  <code class="command">newfs</code> to re-create the file systems.
	  Re-mount the root partition of the disk read-write using
	  <code class="command">mount -u -o rw /mnt</code>.  Use the backups
	  to recover the data for this file system.  Unmount the file
	  system with <code class="command">umount /mnt</code>.  Repeat for each
	  file system that was damaged.</p><p>Once the system is running, backup the data onto new
	  media as whatever caused the crash or data loss may strike
	  again.  Another hour spent now may save further distress
	  later.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="backup-strategies.html">Προηγ</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Πάνω</a></td><td width="40%" align="right"> <a accesskey="n" href="disks-virtual.html">Επόμενο</a></td></tr><tr><td width="40%" align="left" valign="top">19.9. Backup Strategies </td><td width="20%" align="center"><a accesskey="h" href="index.html">Αρχή</a></td><td width="40%" align="right" valign="top"> 19.11. Network, Memory, and File-Backed File Systems</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Αυτό το κείμενο, και άλλα κείμενα, μπορεί να βρεθεί στο
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Για ερωτήσεις σχετικά με το FreeBSD, διαβάστε την
    <a href="http://www.FreeBSD.org/docs.html">τεκμηρίωση</a> πριν να επικοινωνήσετε με την
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Για ερωτήσεις σχετικά με αυτή την τεκμηρίωση, στείλτε e-mail στην
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>