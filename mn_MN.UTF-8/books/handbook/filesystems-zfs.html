<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>21.2. Z Файлын Систем (ZFS)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD гарын авлага" /><link rel="up" href="filesystems.html" title="Бүлэг 21. Файлын системийн дэмжлэг" /><link rel="prev" href="filesystems.html" title="Бүлэг 21. Файлын системийн дэмжлэг" /><link rel="next" href="filesystems-linux.html" title="21.3. Linux® файлын системүүд" /><link rel="copyright" href="legalnotice.html" title="Хуулийн заалт" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">21.2. Z Файлын Систем (ZFS)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="filesystems.html">Өмнөх</a> </td><th width="60%" align="center">Бүлэг 21. Файлын системийн дэмжлэг</th><td width="20%" align="right"> <a accesskey="n" href="filesystems-linux.html">Дараах</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filesystems-zfs"></a>21.2. Z Файлын Систем (ZFS)</h2></div></div></div><p><span class="trademark">Sun</span>™-ий хөгжүүлсэн Z  файлын систем нь цөөрөм хэлбэрийн
      хадгалалтын аргыг ашиглахаар хийгдсэн шинэ технолог юм. Энэ нь
      зай зөвхөн өгөгдөл хадгалалтад хэрэгтэй нөхцөлд ашиглагдана гэсэн
      үг юм. Энэ нь өгөгдлийн хормын хувилбарууд, олон хуулбарууд, болон
      өгөгдлийн хяналтын нийлбэрийг дэмжин өгөгдлийн максимум бүрэн бүтэн
      байдалд зориулагдан бас хийгдсэн юм. <acronym class="acronym">RAID</acronym>-Z
      гэгддэг өгөгдлийн шинэ хуулбарлах загвар нэмэгдсэн.
      <acronym class="acronym">RAID</acronym>-Z загвар нь <acronym class="acronym">RAID</acronym>5-тай
      төстэй боловч өгөгдлийн бичилтийн эвдрэлтээс хамгаалахаар
      хийгдсэн.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84060496"></a>21.2.1. ZFS тааруулалт</h3></div></div></div><p><acronym class="acronym">ZFS</acronym> дэд систем нь системийн эх үүсвэрүүдийн
	ихэнхийг хэрэглэгдэг учир өдөр тутмын хэрэглээнд максимум үр ашгийг
	хангахад шаардлагатай зарим нэг тааруулалт шаардлагатай байдаг. FreeBSD дээр
	туршилтын боломж гэгдэж байгаа боловч энэ нь ойрын ирээдүйд өөрчлөгдөж
	болох юм. Гэхдээ одоогоор дараах алхмуудыг зөвлөдөг.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84061776"></a>21.2.1.1. Санах ой</h4></div></div></div><p>Нийт системийн санах ой хамгийн багаа бодоход нэг гигабайт
	  байх ёстой бөгөөд хоёр болон түүнээс дээшхийг зөвлөдөг. Энд байгаа
	  бүх жишээнүүдэд систем нь нэг гигабайт санах ойтой, хэд хэдэн бусад
	  тааруулах аргын хамтаар байх болно.</p><p>Зарим хүмүүс нэг гигабайт санах ойгоос бага санах ойг амжилттай ашиглаж
	  чадсан боловч тийм хязгаарлагдмал физик санах ойтой систем ачаалал ихтэй
	  үед FreeBSD нь санах ойн шавхалтаас болж үймэх нь маш боломжийн байх
	  болно.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84063312"></a>21.2.1.2. Цөмийн тохиргоо</h4></div></div></div><p>Хэрэгцээгүй драйверууд болон тохиргоонуудыг цөмийн тохиргооны
	  файлаас устгахыг зөвлөдөг. Ихэнх төхөөрөмжүүд модуль хэлбэрээр
	  байдаг болохоор тэдгээрийг <code class="filename">/boot/loader.conf</code>
	  файлын тусламжтай дуудаж болно.</p><p><span class="trademark">i386</span>™ архитектурын хэрэглэгчид өөрсдийн цөмийн тохиргооны файлдаа
	  дараах тохиргоог нэмж цөмөө дахин бүтээж дахин ачаалах хэрэгтэй:</p><pre class="programlisting">options 	KVA_PAGES=512</pre><p>Энэ тохиргоо нь <code class="varname">vm.kvm_size</code> тохируулгыг
	  одоо байгаа 1 GB (<acronym class="acronym">PAE</acronym>-ийн хувьд 2 GB)
	  хязгаарыг давах боломжийг бүрдүүлж цөмийн хаягийн талбарыг
	  өргөтгөх болно. Энэ тохиргооны хувьд хамгийн тохиромжтой утгыг
	  олохын тулд мегабайтаар хүссэн хаягийн талбараа дөрөвт (4) хуваана.
	  Энэ тохиолдолд 2 GB-ийн хувьд <code class="literal">512</code>
	  байна.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84112848"></a>21.2.1.3. Дуудагчийн тохируулгууд</h4></div></div></div><p><code class="filename">kmem</code> хаягийн талбарыг FreeBSD-ийн бүх
	  архитектур дээр ихэсгэх ёстой. Нэг гигабайт физик санах ойтой тест
	  систем дээр <code class="filename">/boot/loader.conf</code> файлд хийсэн
	  дараах тохируулгууд болон системийг дахин ачаалсны дараа амжилттай
	  болсон:</p><pre class="programlisting">vm.kmem_size="330M"
vm.kmem_size_max="330M"
vfs.zfs.arc_max="40M"
vfs.zfs.vdev.cache.size="5M"</pre><p>ZFS-тэй холбоотой тохируулгуудын талаар илүү дэлгэрэнгүй
	  зөвлөмжүүдийн жагсаалтыг
	  <code class="uri"><a class="uri" href="http://wiki.freebsd.org/ZFSTuningGuide" target="_top">http://wiki.freebsd.org/ZFSTuningGuide</a></code> хаягаас үзнэ үү.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84116048"></a>21.2.2. <acronym class="acronym">ZFS</acronym>-г ашиглах нь</h3></div></div></div><p><acronym class="acronym">ZFS</acronym> цөөрмүүдийг систем эхлэх
	үед холбох боломжийг FreeBSD-д олгох эхлүүлэх арга зам
	байдаг. Үүнийг тохируулахын тулд дараах тушаалуудыг
	ажиллуулна:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 'zfs_enable="YES"' &gt;&gt; /etc/rc.conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/zfs start</code></strong></pre><p>Энэ баримтын үлдсэн хэсэг 3 <acronym class="acronym">SCSI</acronym> диск байна
	  гэж үзэх бөгөөд тэдгээр төхөөрөмжийн нэрс нь
	  <code class="filename">da0</code>,
	  <code class="filename">da1</code> болон
	  <code class="filename">da2</code>
	  юм.  <acronym class="acronym">IDE</acronym> тоног төхөөрөмжийн хэрэглэгчид
	  <acronym class="acronym">SCSI</acronym>-ийн оронд
	  <code class="filename">ad</code> төхөөрөмжүүдийг
	  ашигладаг.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84134864"></a>21.2.2.1. Ганц дискийн цөөрөм</h4></div></div></div><p>Ганц дискийн төхөөрөмж ашиглан энгийн, нөөцгүй <acronym class="acronym">ZFS</acronym> цөөрөм үүсгэхийн
	  тулд <code class="command">zpool</code> тушаалыг ашиглана:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool create example /dev/da0</code></strong></pre><p>Шинэ цөөрмийг харахын тулд <code class="command">df</code>
	  тушаалын гаралтыг үзнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235230  1628718    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032846 48737598     2%    /usr
example      17547136       0 17547136     0%    /example</pre><p>Энэ гаралт нь <code class="literal">example</code> цөөрөм
	  зөвхөн үүсгэгдээд зогсохгүй бас <span class="emphasis"><em>холбогдсон</em></span>
	  гэдгийг тодорхой харуулж байна. Энэ нь энгийн файлын систем
	  шиг хандах боломжтой, үүн дээр файлууд үүсгэж хэрэглэгчид
	  дараах жишээн дээрх шиг үзэх боломжтой байна:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /example</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>touch testfile</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls -al</code></strong>
total 4
drwxr-xr-x   2 root  wheel    3 Aug 29 23:15 .
drwxr-xr-x  21 root  wheel  512 Aug 29 23:12 ..
-rw-r--r--   1 root  wheel    0 Aug 29 23:15 testfile</pre><p>Харамсалтай нь энэ цөөрөм <acronym class="acronym">ZFS</acronym>-ийн
	  боломжуудын давуу талыг ашиглахгүй байна. Файлын системийг
	  энэ цөөрөм дээр үүсгэж түүн дээр шахалтыг идэвхжүүлнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=gzip example/compressed</code></strong></pre><p><code class="literal">example/compressed</code> нь одоо
	  <acronym class="acronym">ZFS</acronym> шахагдсан файлын систем боллоо. Зарим нэг том файлуудыг
	  <code class="filename">/example/compressed</code>
	  хуулан түүн рүү хуулж үз.</p><p>Шахалтыг дараах тушаалаар болиулж болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=off example/compressed</code></strong></pre><p>Файлын системийг салгахын тулд дараах тушаалыг ажиллуулж
	  <code class="command">df</code> хэрэгслээр шалгана:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs umount example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235232  1628716    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032864 48737580     2%    /usr
example      17547008       0 17547008     0%    /example</pre><p>Файлын системийг дахин холбож дахин хандах боломжтой
	  болгоод <code class="command">df</code> тушаалаар шалгана:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs mount example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
example             17547008       0 17547008     0%    /example
example/compressed  17547008       0 17547008     0%    /example/compressed</pre><p>Цөөрөм болон файлын системийг <code class="command">mount</code>
	  тушаалын гаралтыг шалган бас ажиглаж болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
/dev/ad0s1a on / (ufs, local)
devfs on /dev (devfs, local)
/dev/ad0s1d on /usr (ufs, local, soft-updates)
example on /example (zfs, local)
example/data on /example/data (zfs, local)
example/compressed on /example/compressed (zfs, local)</pre><p>Ажигласнаар <acronym class="acronym">ZFS</acronym> файлын системүүд нь
	  үүсгэгдсэнийхээ дараагаар жирийн файлын системүүд шигээр
	  ашиглагдаж болно, гэхдээ өөр бусад олон боломжууд бас
	  байдаг. Дараах жишээн дээр шинэ файлын систем <code class="literal">data</code>
	  үүсгэгдэж байна. Чухал файлууд энд хадгалагдах учир файлын
	  систем нь өгөгдлийн блок бүрийн хоёр хуулбарыг хадгалахаар
	  тохируулагдсан:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create example/data</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set copies=2 example/data</code></strong></pre><p>Одоо <code class="command">df</code>-г дахин ажиллуулж
	  өгөгдөл болон зайн хэрэглээг харах боломжтой:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
example             17547008       0 17547008     0%    /example
example/compressed  17547008       0 17547008     0%    /example/compressed
example/data        17547008       0 17547008     0%    /example/data</pre><p>Цөөрөм дээрх файлын систем бүр ижил хэмжээтэй зайтай байгааг
	  хараарай. Файлын системүүд нь зөвхөн хэрэгцээтэй зайгаа ашиглаж
	  ижил цөөрмөөс авч байгааг харуулахын тулд <code class="command">df</code> тушаалыг энэ
	  жишээнүүд дээр ашигласан шалтгаантай юм. <acronym class="acronym">ZFS</acronym>
	  файлын систем нь эзлэхүүн болон хуваалтууд гэх мэт ойлголтуудаас
	  ангид байж хэд хэдэн файлын систем нэг цөөрмийг эзлэхийг зөвшөөрдөг.
	  Файлын системүүдийг устгаад дараа нь цөөрмийг хэрэгцээгүй болсон
	  болохоор устгана:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs destroy example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs destroy example/data</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool destroy example</code></strong></pre><p>Дискүүд муудаж эвдрэх нь тойрох боломжгүй нөхцөл юм. Энэ диск
	  муудсан үед өгөгдөл алдагдах болно. Эвдэрсэн хатуу дискээс болоод
	  өгөгдлийн алдагдлаас хамгаалах нэг арга нь <acronym class="acronym">RAID</acronym>-г
	  ашиглах явдал юм. <acronym class="acronym">ZFS</acronym> нь энэ боломжийг
	  дараагийн хэсэгт тайлбарлах өөрийн цөөрмийн дизайндаа дэмжсэн
	  байдаг.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84174160"></a>21.2.2.2. <acronym class="acronym">ZFS</acronym> RAID-Z</h4></div></div></div><p>Өмнө хэлсэнчлэн энэ хэсэг нь гурван
	  <acronym class="acronym">SCSI</acronym> диск байгаа гэж үзэх бөгөөд
	  <code class="filename">da0</code>
	  <code class="filename">da1</code> болон
	  <code class="filename">da2</code> (буюу эсвэл IDE диск ашиглагдаж
	  байвал <code class="filename">ad0</code>
	  гэх мэтээр) байна.
	  <acronym class="acronym">RAID</acronym>-Z цөөрөм үүсгэхийн тулд
	  дараах тушаалыг өгнө:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool create storage raidz da0 da1 da2</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Тэмдэглэл: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="trademark">Sun</span>™-ий зөвлөснөөр <acronym class="acronym">RAID</acronym>-Z тохиргоонд ашиглагдах
	    төхөөрөмжүүдийн тоо гурваас есийн хооронд байна. Хэрэв та 10 буюу түүнээс
	    олон дискээс тогтсон ганц цөөрөм үүсгэхийг хүсэж байгаа бол түүнийг
	    арай жижиг хэмжээтэй <acronym class="acronym">RAID</acronym>-Z бүлгүүдэд хуваахыг бодох
	    хэрэгтэй. Хэрэв танд зөвхөн хоёр диск байгаа бөгөөд нөөцтэй байхыг хүсэж
	    байгаа бол <acronym class="acronym">ZFS</acronym> толийг ашиглах хэрэгтэй. Дэлгэрэнгүйг
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a> гарын авлагын хуудаснаас үзнэ үү.</p></div><p><code class="literal">storage</code> zpool үүсгэгдсэн байх ёстой.
	  Өмнөх шиг <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> болон <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=df&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">df</span>(1)</span></a> тушаалуудыг ашиглан
	  үүнийг шалгаж болно. Дээрх жагсаалтын төгсгөлд өөр илүү дискийн
	  төхөөрөмжүүдийг нэмэн хуваарилж болно. Хэрэглэгчийн файлууд удахгүй
	  байрлах <code class="literal">home</code> гэгдсэн шинэ файлын системийг
	  цөөрөмд хийнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create storage/home</code></strong></pre><p>Одоо шахалтыг идэвхжүүлж хэрэглэгчийн гэрийн сангууд болон файлуудын
	  илүү хуулбаруудыг хадгалах боломжтой. Үүнийг өмнөх шиг дараах тушаалуудыг
	  ашиглан хийж болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set copies=2 storage/home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=gzip storage/home</code></strong></pre><p>Үүнийг хэрэглэгчдийн шинэ гэрийн сан болгохын тулд
	  хэрэглэгчийн өгөгдлийг энэ сан руу хуулж тохирох тэмдэгт
	  холбоосуудыг үүсгэнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp -rp /home/* /storage/home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -rf /home /usr/home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /storage/home /home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /storage/home /usr/home</code></strong></pre><p>Одоо хэрэглэгчдийн хувьд шинээр үүсгэгдсэн
	  <code class="filename">/storage/home</code> файлын
	  систем дээр тэдний өгөгдөл хадгалагдсан байх болно. Шинэ хэрэглэгч
	  нэмж тэр хэрэглэгчээр нэвтэрч үзээрэй.</p><p>Дараа нь буцааж болох хормын хувилбар үүсгэж үзээрэй:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot storage/home@08-30-08</code></strong></pre><p>Хормын хувилбар тохиргоо нь гэрийн сан ч биш эсвэл файл ч
	  биш зөвхөн жинхэнэ файлын системийг авахыг анхаараарай.
	  <code class="literal">@</code> тэмдэгт нь файлын системийн нэр эсвэл
	  эзлэхүүний нэрийн хооронд ашиглагдсан зааглагч юм. Хэрэглэгчийн
	  гэрийн сан устгагдах үед түүнийг доорх тушаалаар сэргээнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs rollback storage/home@08-30-08</code></strong></pre><p>Байгаа хормын хувилбаруудын жагсаалтыг авахын тулд
	  <code class="command">ls</code>-г файлын системийн
	  <code class="filename">.zfs/snapshot</code>
	  сан дотор ажиллуулна. Жишээ нь өмнө нь авсан хормын хувилбарыг
	  харахын тулд дараах тушаалыг гүйцэтгэнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls /storage/home/.zfs/snapshot</code></strong></pre><p>Хэрэглэгчийн өгөгдөл дээр сар бүрийн хормын хувилбар үүсгэх
	  скрипт бичих боломжтой боловч хожим хормын хувилбарууд нь
	  ихээхэн хэмжээний дискийн хэмжээ эзлэх болно. Түрүүчийн
	  хормын хувилбарыг дараах тушаал ашиглан устгаж болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs destroy storage/home@08-30-08</code></strong></pre><p>Энэ бүх тестийн дараагаар
	  <code class="filename">/storage/home</code>
	  санг бид одоо байгаа төлөвт нь байлгаад байх шалтгаан байх
	  ёсгүй юм. Үүнийг жинхэнэ
	  <code class="filename">/home</code> файлын систем
	  болгох хэрэгтэй:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set mountpoint=/home storage/home</code></strong></pre><p><code class="command">df</code> болон
	  <code class="command">mount</code> тушаалуудыг ажиллуулснаар систем бидний
	  файлын системийг жинхэнэ <code class="filename">/home</code>
	  сан гэж үзэж байгааг харуулна:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
/dev/ad0s1a on / (ufs, local)
devfs on /dev (devfs, local)
/dev/ad0s1d on /usr (ufs, local, soft-updates)
storage on /storage (zfs, local)
storage/home on /home (zfs, local)
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem   1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a    2026030  235240  1628708    13%    /
devfs                1       1        0   100%    /dev
/dev/ad0s1d   54098308 1032826 48737618     2%    /usr
storage       26320512       0 26320512     0%    /storage
storage/home  26320512       0 26320512     0%    /home</pre><p>Ингэснээр <acronym class="acronym">RAID</acronym>-Z тохиргоо дуусаж
	  байна. Шөнө бүрийн <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a> ажиллах үед үүссэн
	  файлын системүүдийн талаар төлвийн шинэчлэлтүүдийг авахын тулд
	  дараах тушаалыг ажиллуулна:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 'daily_status_zfs_enable="YES"' &gt;&gt; /etc/periodic.conf</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84251216"></a>21.2.2.3. <acronym class="acronym">RAID</acronym>-Z-г сэргээх нь</h4></div></div></div><p>Програм хангамжийн <acronym class="acronym">RAID</acronym> бүр
	  өөрсдийн <code class="literal">төлвийг</code> хянах аргатай байдаг.
	  <acronym class="acronym">ZFS</acronym> нь ч мөн адил.
	  <acronym class="acronym">RAID</acronym>-Z төхөөрөмжүүдийн төлвийг дараах
	  тушаалаар харж болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status -x</code></strong></pre><p>Хэрэв бүх цөөрмүүд эрүүл ба бүгд хэвийн бол дараах
	  мэдэгдэл гарна:</p><pre class="screen">all pools are healthy</pre><p>Хэрэв асуудал байвал магадгүй диск холболтгүй болчихвол
	  цөөрмийн төлөв иймэрхүү харагдах болно:</p><pre class="screen">  pool: storage
 state: DEGRADED
status: One or more devices has been taken offline by the administrator.
	Sufficient replicas exist for the pool to continue functioning in a
	degraded state.
action: Online the device using 'zpool online' or replace the device with
	'zpool replace'.
 scrub: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	storage     DEGRADED     0     0     0
	  raidz1    DEGRADED     0     0     0
	    da0     ONLINE       0     0     0
	    da1     OFFLINE      0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>Энэ нь төхөөрөмжийг администратор салгасан гэдгийг
	  харуулж байна. Ялангуяа энэ жишээний хувьд энэ нь үнэн юм.
	  Дискийг салгахын тулд дараах тушаалыг ашиглажээ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool offline storage da1</code></strong></pre><p>Одоо системийг унтраасны дараа <code class="filename">da1</code>-г
	  солих боломжтой. Систем буцаж ассаны дараа дараах тушаалыг ажиллуулж
	  дискийг солино:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool replace storage da1</code></strong></pre><p>Эндээс төлвийг дахин шалгаж болох бөгөөд энэ удаад
	  төлвийн мэдээллийг авахын тулд <code class="option">-x</code> өгөгдөлгүйгээр
	  үзнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status storage</code></strong>
 pool: storage
 state: ONLINE
 scrub: resilver completed with 0 errors on Sat Aug 30 19:44:11 2008
config:

	NAME        STATE     READ WRITE CKSUM
	storage     ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>Энэ жишээнээс харахад бүгд хэвийн харагдаж байна.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84261968"></a>21.2.2.4. Өгөгдлийн шалгалт</h4></div></div></div><p>Өмнө дурдсанчлан <acronym class="acronym">ZFS</acronym> нь
	  хадгалагдсан өгөгдлийн бүрэн бүтэн байдлыг шалгахдаа
	  <code class="literal">хяналтын нийлбэрийг</code> ашигладаг.
	  Тэдгээр нь файлын системүүдийг үүсгэхэд автоматаар
	  идэвхждэг бөгөөд дараах тушаалыг ашиглан болиулж болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set checksum=off storage/home</code></strong></pre><p>Энэ нь ухаалаг санаа биш боловч хяналтын нийлбэрүүд нь
	  маш бага хадгалалтын зай эзэлдэг бөгөөд идэвжсэн байхдаа илүү
	  ашигтай байдаг. Бас тэдгээрийг идэвхжүүлснээр мэдэгдэхээр зардал
	  бас ажиглагддаггүй. Идэвхжсэн байх үед өгөгдлийн бүрэн бүтэн байдлыг
	  хяналтын нийлбэрийн шалгалт ашиглан <acronym class="acronym">ZFS</acronym>
	  шалгах боломжтой байдаг. Энэ процессийг <span class="quote">«<span class="quote">цэвэрлэх</span>»</span>
	  гэж хэлдэг. <code class="literal">storage</code> цөөрмийн өгөгдлийн
	  бүрэн бүтэн байдлыг шалгахын тулд дараах тушаалыг ажиллуулна:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool scrub storage</code></strong></pre><p>Энэ процесс хадгалагдсан өгөгдлийн хэмжээнээс хамаарч
	  ихээхэн хэмжээний хугацаа шаардаж болох юм. Энэ нь бас
	  эдгээр үйлдлүүдийн зөвхөн нэг нь тухайн үед ажиллаж болохоор тийм
	  ихээр <acronym class="acronym">I/O</acronym>-г ашигладаг байна. Цэвэрлэлт
	  дууссаны дараа төлөв шинэчлэгдэж төлвийн хүсэлтийг илгээн
	  харж болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status storage</code></strong>
 pool: storage
 state: ONLINE
 scrub: scrub completed with 0 errors on Sat Aug 30 19:57:37 2008
config:

	NAME        STATE     READ WRITE CKSUM
	storage     ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>Дууссан хугацаа энэ жишээн дээр цэврээр харуулагдаж байна.
	  Энэ боломж нь өгөгдлийн бүрэн бүтэн байдлыг урт хугацааны
	  турш хадгалахад баталгаа болж тусалдаг.</p><p>Z  файлын системд зориулсан өөр олон тохиргоонууд
	  байдаг бөгөөд <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=zfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">zfs</span>(8)</span></a> болон <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a> гарын авлагын
	  хуудсуудыг үзнэ үү.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84275536"></a>21.2.2.5. ZFS квот</h4></div></div></div><p>ZFS нь өөр төрлийн квотуудыг дэмждэг. Эдгээр нь
		  ref квот, ердийн квот ба бүлгийн квот юм. Энэ хэсэг нь
		  тус бүрийн талаар танилцуулах бөгөөд зарим нэг хэрэглээний
		  заавруудыг оруулах болно.</p><p>Квот нь өгөгдөл болон түүнээс үүссэн бусад удмын
		  хэрэглэх зайг хязгаарладаг бөгөөд эдгээр удмуудад зориулсан
		  хормын хувилбарууд болон файлын системүүдийн хэрэглэдэг
		  зайнд хязгаарлалт тавьж өгдөг. Хэрэглэгчийн хувьд квот нь
		  тухайн хэрэглэгч ашиглаж болох зайг хязгаарлахад ашигтай
		  байдаг.</p><div xmlns="" class="note"><h3 class="admontitle">Тэмдэглэл: </h3><p xmlns="http://www.w3.org/1999/xhtml">Квотыг эзлэхүүн дээр тавьж болдоггүй бөгөөд учир нь
	  	    <code class="literal">volsize</code> шинж чанар нь далд
		    квотыг илэрхийлдэг.</p></div><p>ref квот
		  <code class="literal">refquota=size</code> нь
		  ашиглах зайнд хатуу хязгаар тавин зайнд хязгаарладаг. Гэхдээ
		  энэ хатуу хязгаар нь файлын системүүд эсвэл хормын хувилбарууд
		  зэрэг өгөгдлийн удмуудын хэрэглэдэг зайнд хамааралгүй юм.</p><p><code class="filename">storage/home/bob</code>-д зориулж
		  10 GB ердийн квот тавихын тулд дараахийг
		  ашиглана:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set quota=10G storage/home/bob</code></strong></pre><p>Тухайн заагдсан хэрэглэгч ашиглаж болох зайг
		  хэрэглэгчийн квот хязгаарлаж өгдөг. Ерөнхий бичих
		  хэлбэр нь
		  <code class="literal">userquota@user=size</code>
		  байх бөгөөд хэрэглэгчийн нэр дараах хэлбэрийн аль нэг
		  байх ёстой:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><acronym class="acronym">POSIX</acronym>
	    	  нийцтэй нэр (жишээ нь <em class="replaceable"><code>joe</code></em>).</p></li><li class="listitem"><p><acronym class="acronym">POSIX</acronym>
	    	  тоон ID (жишээ нь <em class="replaceable"><code>789</code></em>).</p></li><li class="listitem"><p><acronym class="acronym">SID</acronym>
	    	  нэр (жишээ нь
	    	  <em class="replaceable"><code>joe.bloggs@example.com</code></em>).</p></li><li class="listitem"><p><acronym class="acronym">SID</acronym>
	    	  тоон ID (жишээ нь
	    	  <em class="replaceable"><code>S-1-123-456-789</code></em>).</p></li></ul></div><p>Жишээ нь <em class="replaceable"><code>joe</code></em> хэрэглэгчийн
		  хувьд 50 GB квот тавихын тулд дараахийг
		  ашиглана:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set userquota@joe=50G</code></strong></pre><p>Квотыг устгах эсвэл тавигдаагүй эсэхийг
		  шалгахын тулд дараахийг хэрэглэнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set userquota@joe=none</code></strong></pre><p>Хэрэглэгчийн квотын шинж чанаруудыг
		  <code class="command">zfs get all</code> тушаал харуулдаггүй.
		  <code class="systemitem">root</code> биш хэрэглэгчид <code class="literal">userquota</code>
		  зөвшөөрөл өгөгдөөгүй л бол зөвхөн өөрийн квотуудыг харж болно.
		  Энэ зөвшөөрөлтэй хэрэглэгчид бүгдийн квотыг харж тогтоох
		  боломжтой байна.</p><p>Бүлгийн квот нь заагдсан хэрэглэгчийн бүлэг
		  ашиглаж болох зайг хязгаарладаг. Ерөнхий бичиглэл нь
		  <code class="literal">groupquota@group=size</code>
		  байна.</p><p><em class="replaceable"><code>firstgroup</code></em> бүлэгт 50 GB
		  квот зааж өгөхийн тулд дараахийг
		  ашиглана:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set groupquota@firstgroup=50G</code></strong></pre><p><em class="replaceable"><code>firstgroup</code></em> бүлгийн хувьд
		  квотыг устгах эсвэл тавигдаагүй байгаа эсэхийг шалгахын
		  тулд дараахийг хэрэглэнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set groupquota@firstgroup=none</code></strong></pre><p>Хэрэглэгчийн квот шинж чанарын хувьд
		  <code class="systemitem">root</code> биш хэрэглэгчид зөвхөн өөрсдийн
		  харьяалагддаг хэрэглэгчийн бүлэгтэй холбоотой квотуудыг
		  харж чадна, гэхдээ <code class="systemitem">root</code> хэрэглэгч
		  эсвэл <code class="literal">groupquota</code> зөвшөөрөл бүхий
		  хэрэглэгч бүх бүлгийн хувьд квотыг харах болон тавих
		  боломжтой байна.</p><p><code class="command">zfs userspace</code> дэд тушаал
		  заагдсан файлын систем эсвэл хормын хувилбар дээр хэрэглэгч
		  бүрийн ашиглаж байгаа зай болон квотын хамтаар харуулдаг.
		  <code class="command">zfs groupspace</code> дэд тушаал
		  бүлгийн хувьд адилыг харуулна. Дэмжигдсэн боломжуудын
		  талаар эсвэл тухайн нэг боломжийг зөвхөн харуулъя гэвэл
		  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=zfs&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">zfs</span>(1)</span></a> гарын авлагын хуудсыг үзнэ үү.</p><p>Хэрэв танд хэрэгтэй зөвшөөрлүүд байгаа, аль эсвэл
		  <code class="systemitem">root</code> хэрэглэгч бол
		  <code class="filename">storage/home/bob</code>-н хувьд квотыг
		  харуулахын тулд дараахийг ашиглана:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs get quota storage/home/bob</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84310736"></a>21.2.2.6. ZFS захиалгууд</h4></div></div></div><p>ZFS нь хоёр төрлийн зайн захиалгыг дэмждэг.
		  Энэ хэсэг нь тус бүрийн талаар зарим нэг жишээ оролцуулан
		  тайлбарлах болно.</p><p><code class="literal">reservation</code> шинж чанар нь
		  өгөгдөл болон түүний удамд хэрэгтэй хамгийн бага зайг
		  захиалж нөөцлөх боломжийг бүрдүүлдэг. Энэ нь хэрэв
		  10 GB зай
		  <code class="filename">storage/home/bob</code> дээр тавигдсан бол
		  дискийн зай бага болсон тохиолдолд уг өгөгдөлд хамгийн
		  багадаа 10 GB зай нөөцлөгдсөн байна гэсэн үг юм.
		  <code class="literal">refreservation</code> шинж чанар нь
		  хормын хувилбарууд зэрэг удмуудыг хасаад зөвхөн уг өгөгдөлд
		  хэрэгтэй хамгийн бага зайг зааж өгөх юм уу тохируулж өгдөг.
		  Жишээ нь <code class="filename">storage/home/bob</code>-н хормын
		  хувилбарыг авсан бол үйлдэл амжилттай болохын тулд
		  <code class="literal">refreservation</code> хэмжээнээс гадна хангалттай
		  дискний зай байх ёстой, яагаад гэвэл гол өгөгдлийн удмууд
		  нь <code class="literal">refreservation</code> хэмжээнд хамааралгүй
		  бөгөөд өгөгдсөн зайнд баригдахгүй байна.</p><p>Аль ч төрлийн захиалгууд ихэнх тохиолдолд ашигтай
		  байдаг бөгөөд жишээлбэл шинэ систем дээр дискний зайг
		  хуваарилах тохиромжийг турших болон төлөвлөх, эсвэл
		  системийг сэргээх үйл ажиллагаа болон файлуудад зориулсан
		  хангалттай зай файлын системүүд дээр байгаа эсэхэд
		  баттай байхын тулд ашиглаж болно.</p><p><code class="literal">reservation</code> шинж чанарын
		  ерөнхий бичиглэл нь
		  <code class="literal">reservation=size</code>
		  байх бөгөөд <code class="filename">storage/home/bob</code>-д
		  10 GB зайг захиалахын тулд дараах тушаалыг
		  ашиглана:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set reservation=10G storage/home/bob</code></strong></pre><p>Захиалга хийгдээгүй аль эсвэл захиалгыг
		  устгахын тулд дараахийг ашиглана:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set reservation=none storage/home/bob</code></strong></pre><p>refreservation-г тохируулахад
		  <code class="literal">refreservation=size</code> гэсэн
		  ерөнхий бичиглэл ижил зарчмаар
		  <code class="literal">refreservation</code> шинж чанарт
		  үйлчилж болно.</p><p>Ямар нэг захиалга эсвэл <code class="filename">storage/home/bob</code>-н
		  хувьд захиалга байгаа эсэхийг шалгахдаа дараах тушаалуудын
		  аль нэгийг ажиллуулаарай:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs get reservation storage/home/bob</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs get refreservation storage/home/bob</code></strong></pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="filesystems.html">Өмнөх</a> </td><td width="20%" align="center"><a accesskey="u" href="filesystems.html">Дээш</a></td><td width="40%" align="right"> <a accesskey="n" href="filesystems-linux.html">Дараах</a></td></tr><tr><td width="40%" align="left" valign="top">Бүлэг 21. Файлын системийн дэмжлэг </td><td width="20%" align="center"><a accesskey="h" href="index.html">Эхлэл</a></td><td width="40%" align="right" valign="top"> 21.3. <span class="trademark">Linux</span>® файлын системүүд</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Энэ болон бусад баримтуудыг
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    хаягаас татаж авч болно.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD-ийн талаар
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;
    хаягтай холбоо барихаасаа өмнө
    <a href="http://www.FreeBSD.org/docs.html">баримтыг</a> уншина уу.<br></br>
    Энэ бичиг баримттай холбоотой асуулт байвал
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;
    хаягаар цахим захидал явуулна уу.<br></br>
    Энэ бичиг баримтын орчуулгатай холбоотой асуулт байвал
    &lt;<a href="mailto:admin@mnbsd.org">admin@mnbsd.org</a>&gt;
    хаягаар цахим захидал явуулна уу.</small></p></body></html>