<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>15.9. IPsec дээгүүр VPN хийх</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD гарын авлага" /><link rel="up" href="security.html" title="Бүлэг 15. Аюулгүй байдал" /><link rel="prev" href="openssl.html" title="15.8. OpenSSL" /><link rel="next" href="openssh.html" title="15.10. OpenSSH" /><link rel="copyright" href="legalnotice.html" title="Хуулийн заалт" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">15.9. IPsec дээгүүр VPN хийх</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="openssl.html">Өмнөх</a> </td><th width="60%" align="center">Бүлэг 15. Аюулгүй байдал</th><td width="20%" align="right"> <a accesskey="n" href="openssh.html">Дараах</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ipsec"></a>15.9. IPsec дээгүүр VPN хийх</h2></div><div><span class="authorgroup">Бичсэн <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Ник</span> <span class="surname">Клэйтон</span></span>. </span></div></div></div><a id="idp79854288" class="indexterm"></a><p>FreeBSD гарц машинуудыг ашиглан Интернэтээр тусгаарлагдсан хоёр сүлжээний
	хооронд VPN үүсгэх.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79855440"></a>15.9.1. IPsec-ийг ойлгох нь</h3></div><div><span class="authorgroup">Бичсэн <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Хитэн М.</span> <span class="surname">Пандиа</span></span>. </span></div></div></div><p>Энэ хэсэг нь IPsec-ийг тохируулах процессийг тайлбарлах
	болно. IPsec-ийг тохируулахын тулд та өөрчлөн тохируулсан
	цөм бүтээх ухагдахууныг мэдсэн байх шаардлагатай
	(<a class="xref" href="kernelconfig.html" title="Бүлэг 9. FreeBSD цөмийг тохируулах нь">Бүлэг 9, <em>FreeBSD цөмийг тохируулах нь</em></a>-г үзнэ үү).</p><p><span class="emphasis"><em>IPsec</em></span> нь Интернэт Протокол (IP) давхаргын
	дээр суудаг протокол юм. Энэ нь хоёр буюу хэд хэдэн хостуудыг аюулгүй байдлаар
	(нэрээс нь харах юм бол) холбох боломжийг олгодог. FreeBSD IPsec
	<span class="quote">«<span class="quote">сүлжээний стек</span>»</span> нь IPv4 болон IPv6 протоколуудыг хоёуланг
	дэмждэг <a class="link" href="http://www.kame.net/" target="_top">KAME</a> шийдэл дээр
	үндэслэсэн.</p><a id="idp79865168" class="indexterm"></a><a id="idp79866320" class="indexterm"></a><p>IPsec нь хоёр дэд протоколоос тогтоно:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>Encapsulated Security Payload
	      (ESP) буюу Хайрцаглагдсан Аюулгүй байдлын ачаа</em></span> нь
		гуравдагчийн нөлөөллөөс тэгш хэмт криптограф алгоритмийг
		(Blowfish, 3DES-тэй адил) ашиглан агуулгыг нь шифрлэж
		IP пакетийн өгөгдлийг хамгаалдаг.</p></li><li class="listitem"><p><span class="emphasis"><em>Authentication Header (AH) буюу Нэвтрэлт Танилтын
		Толгой</em></span> нь аюулгүй хэш хийх функцаар IP пакетийн толгойн
		талбаруудыг хэш хийн криптограф хянах нийлбэрийг тооцоолон гуравдагч
		этгээдийн нөлөөлөл болон хууран мэхлэлтээс IP пакетийн толгойг
		хамгаалдаг. Үүний дараа пакет дахь мэдээллийг таниулахыг зөвшөөрөх
		хэшийг агуулсан нэмэлт толгой байдаг.</p></li></ul></div><p><acronym class="acronym">ESP</acronym> болон <acronym class="acronym">AH</acronym> нь
	орчноосоо хамаараад хоёулаа цуг эсвэл тусдаа ашиглагдаж болно.</p><a id="idp79871312" class="indexterm"></a><a id="idp79872080" class="indexterm"></a><p>IPsec нь хоёр хостын хоорондох урсгалыг шууд шифрлэх (<span class="emphasis"><em>Transport
	  Mode буюу Тээвэрлэх Горим</em></span> гэгддэг) буюу эсвэл
	хоёр корпорацийн сүлжээний хооронд аюулгүй холбоонд ашиглагдаж болох
	<span class="quote">«<span class="quote">виртуал туннелиуд</span>»</span> (<span class="emphasis"><em>Tunnel Mode буюу Туннелийн
	Горим</em></span> гэгддэг) бүтээхэд хэрэглэгдэж болох юм. Сүүлийнх нь ерөнхийдөө
	<span class="emphasis"><em>Виртуал Хувийн Сүлжээ (VPN)</em></span> гэгддэг.
	FreeBSD-ийн IPsec дэд системийн талаар дэлгэрэнгүй мэдээллийг
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipsec&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ipsec</span>(4)</span></a> гарын авлагын хуудаснаас лавлах хэрэгтэй.</p><p>Өөрийн цөмдөө IPsec дэмжлэгийг нэмэхийн тулд та дараах тохируулгуудыг
	цөмийн тохиргоондоо нэмээрэй:</p><a id="idp79897040" class="indexterm"></a><pre class="screen">
options   IPSEC        #IP security
device    crypto</pre><a id="idp79898576" class="indexterm"></a><p>Хэрэв IPsec дибаг хийх дэмжлэг заавал хэрэгтэй бол дараах цөмийн тохируулга
	бас нэмэгдсэн байх шаардлагатай:</p><pre class="screen">
options   IPSEC_DEBUG  #debug for IP security
      </pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79900624"></a>15.9.2. Асуудал</h3></div></div></div><p>VPN-ийг байгуулахад ямар нэг стандарт байхгүй. VPN-үүд нь өөр өөрийн давуу болон сул
	талуудтай төрөл бүрийн технологиудыг ашиглан хийгдэж болно. Энэ хэсэг нь
	нэг тохиолдлын загвар үзүүлэх бөгөөд энэ тохиолдол дахь VPN-ийг хийхэд
	хэрэглэгдэх стратегиудыг харуулах болно.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79901904"></a>15.9.3. Тохиолдол: Хоёр сүлжээ, нэг нь гэрийн нэг нь ажлын. Хоёулаа
	Интернэтэд холбогдсон бөгөөд энэ <acronym class="acronym">VPN</acronym>-ээр нэг юм шиг
	ажиллах сүлжээ.</h3></div></div></div><a id="idp79903056" class="indexterm"></a><p>Угтвар нөхцөл дараах маягийн байна:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Та хамгийн багадаа хоёр сайттай байна</p></li><li class="listitem"><p>Хоёр сайт хоёулаа IP-г дотооддоо ашигладаг</p></li><li class="listitem"><p>FreeBSD дээр нь ажилладаг гарц компьютераар хоёр сайт хоёулаа
		Интернэтэд холбогдсон.</p></li><li class="listitem"><p>Хоёр сүлжээний гарц компьютер бүр хамгийн багаар бодоход нэг нийтийн IP
		хаягтай.</p></li><li class="listitem"><p>Хоёр сүлжээний дотоод хаягууд нь нийтийн эсвэл хувийн IP хаягууд байж
	    болох юм, энэ нь хамаагүй. Тэдгээр нь давхцахгүй байх ёстой, өөрөөр
	    хэлбэл хоёулаа <code class="systemitem">192.168.1.x</code>-г ашиглаж
	    болохгүй юм.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79909584"></a>15.9.4. IPsec-ийг FreeBSD дээр тохируулах нь</h3></div><div><span class="authorgroup">Бичсэн <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Том</span> <span class="surname">Рөүдс</span></span>. </span></div></div></div><p>Эхлээд <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/ipsec-tools/pkg-descr">security/ipsec-tools</a>
	портын цуглуулгаас суусан байх шаардлагатай. Энэ гуравдагч талын програм
	хангамжийн багц нь тохиргоог дэмжихэд туслах хэд хэдэн програмуудыг
	агуулдаг.</p><p>Дараагийн шаардлага нь пакетуудыг тунель хийх болон хоёр
	сүлжээг зөв холбогдоход ашиглагдах хоёр <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gif&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">gif</span>(4)</span></a> псевдо
	төхөөрөмжийг үүсгэх явдал юм. <code class="systemitem">root</code> хэрэглэгчээр
	<em class="replaceable"><code>internal</code></em> болон
	<em class="replaceable"><code>external</code></em> гэсэн утгуудыг жинхэнэ
	дотоод болон гадаад гарцуудаар өөрчлөн дараах тушаалыг
	ажиллуулна:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig gif0 create</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig gif0 internal1 internal2</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig gif0 tunnel external1 external2</code></strong></pre><p>Жишээ нь ажлын <acronym class="acronym">LAN</acronym>-ий нийтийн
	<acronym class="acronym">IP</acronym> нь
	<code class="systemitem">172.16.5.4</code> бөгөөд
	хувийн <acronym class="acronym">IP</acronym> нь
	<code class="systemitem">10.246.38.1</code> байна.
	Гэрийн <acronym class="acronym">LAN</acronym>-ий нийтийн <acronym class="acronym">IP</acronym> нь
	<code class="systemitem">192.168.1.12</code> бөгөөд
	дотоод хувийн <acronym class="acronym">IP</acronym> нь
	<code class="systemitem">10.0.0.5</code> байна.</p><p>Энэ нь толгой эргэмээр санагдаж болох бөгөөд
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> тушаалын дараах жишээ үр дүнгээс харна уу:</p><pre class="programlisting">Gateway 1:

gif0: flags=8051 mtu 1280
tunnel inet 172.16.5.4 --&gt; 192.168.1.12
inet6 fe80::2e0:81ff:fe02:5881%gif0 prefixlen 64 scopeid 0x6
inet 10.246.38.1 --&gt; 10.0.0.5 netmask 0xffffff00

Gateway 2:

gif0: flags=8051 mtu 1280
tunnel inet 192.168.1.12 --&gt; 172.16.5.4
inet 10.0.0.5 --&gt; 10.246.38.1 netmask 0xffffff00
inet6 fe80::250:bfff:fe3a:c1f%gif0 prefixlen 64 scopeid 0x4</pre><p>Хийгдэж дууссаны дараа хоёр хувийн <acronym class="acronym">IP</acronym>-д
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> тушаал ашиглан дараах үр дүнд харуулсан шиг
	хүрэх боломжтой байх ёстой:</p><pre class="programlisting">priv-net# ping 10.0.0.5
PING 10.0.0.5 (10.0.0.5): 56 data bytes
64 bytes from 10.0.0.5: icmp_seq=0 ttl=64 time=42.786 ms
64 bytes from 10.0.0.5: icmp_seq=1 ttl=64 time=19.255 ms
64 bytes from 10.0.0.5: icmp_seq=2 ttl=64 time=20.440 ms
64 bytes from 10.0.0.5: icmp_seq=3 ttl=64 time=21.036 ms
--- 10.0.0.5 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max/stddev = 19.255/25.879/42.786/9.782 ms

corp-net# ping 10.246.38.1
PING 10.246.38.1 (10.246.38.1): 56 data bytes
64 bytes from 10.246.38.1: icmp_seq=0 ttl=64 time=28.106 ms
64 bytes from 10.246.38.1: icmp_seq=1 ttl=64 time=42.917 ms
64 bytes from 10.246.38.1: icmp_seq=2 ttl=64 time=127.525 ms
64 bytes from 10.246.38.1: icmp_seq=3 ttl=64 time=119.896 ms
64 bytes from 10.246.38.1: icmp_seq=4 ttl=64 time=154.524 ms
--- 10.246.38.1 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 28.106/94.594/154.524/49.814 ms</pre><p>Хүсэн хүлээж байсны дагуу хоёр тал хоёулаа
	хувийн тохируулсан хаягаасаа <acronym class="acronym">ICMP</acronym>
	пакетуудыг илгээх болон хүлээн авах боломжтой байна. Дараа нь
	аль аль сүлжээнээс урсгалыг зөв илгээдэг байхын тулд хоёр гарцад
	хоёуланд нь пакетуудыг хэрхэн яаж чиглүүлэхийг зааж өгөх ёстой.
	Энэ зорилгод дараах тушаал хүрнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>corp-net# route add 10.0.0.0 10.0.0.5 255.255.255.0</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>corp-net# route add net 10.0.0.0: gateway 10.0.0.5</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>priv-net# route add 10.246.38.0 10.246.38.1 255.255.255.0</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>priv-net# route add host 10.246.38.0: gateway 10.246.38.1</code></strong></pre><p>Энэ үе хүрэхэд дотоод машинууд нь аль аль гарц болон гарцын цаана
	байгаа машинуудаас хүрэх боломжтой байх ёстой. Үүнийг хялбараар
	дараах жишээнээс тодорхойлж болно:</p><pre class="programlisting">corp-net# ping 10.0.0.8
PING 10.0.0.8 (10.0.0.8): 56 data bytes
64 bytes from 10.0.0.8: icmp_seq=0 ttl=63 time=92.391 ms
64 bytes from 10.0.0.8: icmp_seq=1 ttl=63 time=21.870 ms
64 bytes from 10.0.0.8: icmp_seq=2 ttl=63 time=198.022 ms
64 bytes from 10.0.0.8: icmp_seq=3 ttl=63 time=22.241 ms
64 bytes from 10.0.0.8: icmp_seq=4 ttl=63 time=174.705 ms
--- 10.0.0.8 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.870/101.846/198.022/74.001 ms

priv-net# ping 10.246.38.107
PING 10.246.38.1 (10.246.38.107): 56 data bytes
64 bytes from 10.246.38.107: icmp_seq=0 ttl=64 time=53.491 ms
64 bytes from 10.246.38.107: icmp_seq=1 ttl=64 time=23.395 ms
64 bytes from 10.246.38.107: icmp_seq=2 ttl=64 time=23.865 ms
64 bytes from 10.246.38.107: icmp_seq=3 ttl=64 time=21.145 ms
64 bytes from 10.246.38.107: icmp_seq=4 ttl=64 time=36.708 ms
--- 10.246.38.107 ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev = 21.145/31.721/53.491/12.179 ms</pre><p>Тунелиуд үүсгэж тохируулах нь хялбар хэсэг юм. Аюулгүй
	холбоосыг тохируулах нь илүү гүнзгий процесс юм. Дараах
	тохиргоо нь урьдчилан хуваалцсан (<acronym class="acronym">PSK</acronym>)
	<acronym class="acronym">RSA</acronym> түлхүүрүүдийг ашиглаж байна.
	<acronym class="acronym">IP</acronym> хаягаас гадна хоёр
	<code class="filename">/usr/local/etc/racoon/racoon.conf</code> файл
	хоёулаа адил бөгөөд доорхтой төстэй байна.</p><pre class="programlisting">path    pre_shared_key  "/usr/local/etc/racoon/psk.txt"; #location of pre-shared key file
log     debug;	#log verbosity setting: set to 'notify' when testing and debugging is complete

padding	# options are not to be changed
{
        maximum_length  20;
        randomize       off;
        strict_check    off;
        exclusive_tail  off;
}

timer	# timing options. change as needed
{
        counter         5;
        interval        20 sec;
        persend         1;
#       natt_keepalive  15 sec;
        phase1          30 sec;
        phase2          15 sec;
}

listen	# address [port] that racoon will listening on
{
        isakmp          172.16.5.4 [500];
        isakmp_natt     172.16.5.4 [4500];
}

remote  192.168.1.12 [500]
{
        exchange_mode   main,aggressive;
        doi             ipsec_doi;
        situation       identity_only;
        my_identifier   address 172.16.5.4;
        peers_identifier        address 192.168.1.12;
        lifetime        time 8 hour;
        passive         off;
        proposal_check  obey;
#       nat_traversal   off;
        generate_policy off;

                        proposal {
                                encryption_algorithm    blowfish;
                                hash_algorithm          md5;
                                authentication_method   pre_shared_key;
                                lifetime time           30 sec;
                                dh_group                1;
                        }
}

sainfo  (address 10.246.38.0/24 any address 10.0.0.0/24 any)	# address $network/$netmask $type address $network/$netmask $type ( $type being any or esp)
{								# $network must be the two internal networks you are joining.
        pfs_group       1;
        lifetime        time    36000 sec;
        encryption_algorithm    blowfish,3des,des;
        authentication_algorithm        hmac_md5,hmac_sha1;
        compression_algorithm   deflate;
}</pre><p>Тохируулга бүрийг энэ жишээн дээр жагсаагдсантай нь
	тайлбарлах нь энэ баримтын хүрээнээс гадуур юм.
	<span class="application">racoon</span>-ий тохиргооны гарын
	авлагын хуудсанд холбогдох мэдээлэл олон бий.</p><p>FreeBSD болон <span class="application">racoon</span> нь
	хостуудын хооронд сүлжээний урсгалыг нууцлах болон буцааж
	задалж чаддаг байхын тулд <acronym class="acronym">SPD</acronym>
	бодлогуудыг тохируулсан байх ёстой.</p><p>Энэ үйлдлийг дараах ажлын гарц дээрх шиг энгийн бүрхүүлийн
	скриптээр шийдэж болно. Энэ файлыг системийг эхлүүлэх үед
	ашиглах бөгөөд
	<code class="filename">/usr/local/etc/racoon/setkey.conf</code> гэж
	хадгалах ёстой.</p><pre class="programlisting">flush;
spdflush;
# To the home network
spdadd 10.246.38.0/24 10.0.0.0/24 any -P out ipsec esp/tunnel/172.16.5.4-192.168.1.12/use;
spdadd 10.0.0.0/24 10.246.38.0/24 any -P in ipsec esp/tunnel/192.168.1.12-172.16.5.4/use;</pre><p>Ингэсний дараа <span class="application">racoon</span>-г
	хоёр гарц дээр дараах тушаал ашиглан эхлүүлнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf -l /var/log/racoon.log</code></strong></pre><p>Гарах үр дүнд нь доорхтой төстэй байна:</p><pre class="programlisting">corp-net# /usr/local/sbin/racoon -F -f /usr/local/etc/racoon/racoon.conf
Foreground mode.
2006-01-30 01:35:47: INFO: begin Identity Protection mode.
2006-01-30 01:35:48: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:35:55: INFO: received Vendor ID: KAME/racoon
2006-01-30 01:36:04: INFO: ISAKMP-SA established 172.16.5.4[500]-192.168.1.12[500] spi:623b9b3bd2492452:7deab82d54ff704a
2006-01-30 01:36:05: INFO: initiate new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=28496098(0x1b2d0e2)
2006-01-30 01:36:09: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=47784998(0x2d92426)
2006-01-30 01:36:13: INFO: respond new phase 2 negotiation: 172.16.5.4[0]192.168.1.12[0]
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 192.168.1.12[0]-&gt;172.16.5.4[0] spi=124397467(0x76a279b)
2006-01-30 01:36:18: INFO: IPsec-SA established: ESP/Tunnel 172.16.5.4[0]-&gt;192.168.1.12[0] spi=175852902(0xa7b4d66)</pre><p>Тунель зөв ажиллаж байгааг шалгахын тулд нөгөө
	консол руу шилжиж сүлжээний урсгалыг харахын тулд
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a> ашиглан дараах тушаалыг хэрэглэнэ.
	<code class="literal">em0</code>-ийг сүлжээний интерфэйс картаараа
	шаардлагатай бол солиорой.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tcpdump -i em0 host 172.16.5.4 and dst 192.168.1.12</code></strong></pre><p>Доорхтой төстэй өгөгдөл консол дээр гарах ёстой.
	Хэрэв үгүй бол асуудалтай гэсэн үг бөгөөд буцаасан
	өгөгдлийг дибаг хийх шаардлагатай.</p><pre class="programlisting">01:47:32.021683 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xa)
01:47:33.022442 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xb)
01:47:34.024218 IP corporatenetwork.com &gt; 192.168.1.12.privatenetwork.com: ESP(spi=0x02acbf9f,seq=0xc)</pre><p>Энд хүрэхэд хоёр сүлжээ хүрэх боломжтой байх бөгөөд
	нэг сүлжээний хэсэг юм шиг харагдах болно. Хоёр сүлжээ нь
	аль аль нь галт ханаар хамгаалагдсан байж болох бөгөөд
	ингэх ч ёстой юм. Тэдгээрийн хооронд урсгалыг зөвшөөрөхийн
	тулд пакетуудыг нааш цааш дамжуулах дүрмүүдийг нэмэх
	шаардлагатай. <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfw&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfw</span>(8)</span></a> галт ханын хувьд галт ханын
	тохиргооны файлдаа дараах дүрмүүдийг нэмээрэй:</p><pre class="programlisting">ipfw add 00201 allow log esp from any to any
ipfw add 00202 allow log ah from any to any
ipfw add 00203 allow log ipencap from any to any
ipfw add 00204 allow log udp from any 500 to any</pre><div xmlns="" class="note"><h3 class="admontitle">Тэмдэглэл: </h3><p xmlns="http://www.w3.org/1999/xhtml">Дүрмийн дугааруудыг тухайн хостын тохиргооноос
	  хамаарч өөрчлөх шаардлагатай байж болох юм.</p></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pf</span>(4)</span></a> эсвэл <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a>,-ийн хэрэглэгчдийн хувьд
	дараах дүрмүүд үүнийг хийх болно:</p><pre class="programlisting">pass in quick proto esp from any to any
pass in quick proto ah from any to any
pass in quick proto ipencap from any to any
pass in quick proto udp from any port = 500 to any port = 500
pass in quick on gif0 from any to any
pass out quick proto esp from any to any
pass out quick proto ah from any to any
pass out quick proto ipencap from any to any
pass out quick proto udp from any port = 500 to any port = 500
pass out quick on gif0 from any to any</pre><p>Төгсгөлд нь системийг эхлүүлэх явцад
	<acronym class="acronym">VPN</acronym>-ийг
	машин дэмжин ажиллаж эхэлдэг байлгахын тулд дараах мөрүүдийг
	<code class="filename">/etc/rc.conf</code> файлд нэмэх хэрэгтэй:</p><pre class="programlisting">ipsec_enable="YES"
ipsec_program="/usr/local/sbin/setkey"
ipsec_file="/usr/local/etc/racoon/setkey.conf" # allows setting up spd policies on boot
racoon_enable="yes"</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="openssl.html">Өмнөх</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Дээш</a></td><td width="40%" align="right"> <a accesskey="n" href="openssh.html">Дараах</a></td></tr><tr><td width="40%" align="left" valign="top">15.8. OpenSSL </td><td width="20%" align="center"><a accesskey="h" href="index.html">Эхлэл</a></td><td width="40%" align="right" valign="top"> 15.10. OpenSSH</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Энэ болон бусад баримтуудыг
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    хаягаас татаж авч болно.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD-ийн талаар
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;
    хаягтай холбоо барихаасаа өмнө
    <a href="http://www.FreeBSD.org/docs.html">баримтыг</a> уншина уу.<br></br>
    Энэ бичиг баримттай холбоотой асуулт байвал
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;
    хаягаар цахим захидал явуулна уу.<br></br>
    Энэ бичиг баримтын орчуулгатай холбоотой асуулт байвал
    &lt;<a href="mailto:admin@mnbsd.org">admin@mnbsd.org</a>&gt;
    хаягаар цахим захидал явуулна уу.</small></p></body></html>