<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>31.5. IPFILTER (IPF) Галт хана</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD гарын авлага" /><link rel="up" href="firewalls.html" title="Бүлэг 31. Галт хана" /><link rel="prev" href="firewalls-pf.html" title="31.4. OpenBSD Пакет шүүгч (PF) ба ALTQ" /><link rel="next" href="firewalls-ipfw.html" title="31.6. IPFW" /><link rel="copyright" href="legalnotice.html" title="Хуулийн заалт" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.5. IPFILTER (IPF) Галт хана</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="firewalls-pf.html">Өмнөх</a> </td><th width="60%" align="center">Бүлэг 31. Галт хана</th><td width="20%" align="right"> <a accesskey="n" href="firewalls-ipfw.html">Дараах</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-ipf"></a>31.5. IPFILTER (IPF) Галт хана</h2></div></div></div><a id="idp91942352" class="indexterm"></a><p>IPFILTER-г зохиосон хүн бол Даррин Рид билээ. IPFILTER нь
үйлдлийн системээс хамааралгүй: нээлттэй эхийн програм бөгөөд
FreeBSD, NetBSD, OpenBSD, <span class="trademark">SunOS</span>™, HP/UX, ба <span class="trademark">Solaris</span>™ зэрэг олон үйлдлийн систем уруу
шилжүүлэгдсэн юм. IPFILTER эрчимтэй дэмжигдэж,
сайжруулсан хувилбарууд нь тогтмол гарсаар байгаа.</p><p>IPFILTER нь цөмийн талд ажиллах галт хана болон
<acronym class="acronym">NAT</acronym> механизм дээр суурилсан бөгөөд түүнийг удирдах, хянахын тулд
хэрэглэгчийн интерфэйс програмыг ашиглана. Галт ханын дүрмүүдийг нэмэх болон хасахдаа
<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a> хэрэгслийг хэрэглэнэ. <acronym class="acronym">NAT</acronym> дүрмүүдийг
нэмэх болон хасахдаа <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipnat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipnat</span>(8)</span></a> хэрэгслийг хэрэглэнэ. <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a> хэрэгсэл
нь IPFILTER-н цөмийн талд ажиллаж байгаа хэсгийн статистикийг хэвлэхэд зориулагдсан.
<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipmon&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipmon</span>(8)</span></a> програм харин IPFILTER-н үйлдлүүдийг системийн бүртгэлийн файлд
бүртгэнэ.</p><p>IPF-г анх зохиохдоо <span class="quote">«<span class="quote">сүүлд тохирсон дүрэм дийлнэ</span>»</span> гэсэн
логикийн дагуу бүтээсэн ба зөвхөн төлөвт-бус дүрмүүдийг ашигладаг байлаа.
Цаг хугацаа өнгөрөхөд IPF илүү хөгжиж, <span class="quote">«<span class="quote">quick</span>»</span> тохируулга
болон төлөвт <span class="quote">«<span class="quote">keep state</span>»</span> тохируулгуудыг агуулах болсон нь орчин үеийн
хэрэгцээ шаардлагад илүү нийцэх болжээ. IPF-н албан ёсны баримтжуулалтанд
хуучин уламжлалт дүрмүүдийг бичих параметрүүд болон файлтай ажиллах логикууд багтсан байдаг.
Харин шинэ функцуудыг нь зөвхөн нэмэлт боломж байдлаар оруулсан нь аюулгүй байдлыг хавьгүй
илүү хангасан аюулгүй галт хана бий болгож байгаа тэднийг хэт доогуур тавьсан санагддаг.</p><p>Энэ бүлэгт байгаа зааврууд нь <span class="quote">«<span class="quote">quick</span>»</span> болон төлөвт <span class="quote">«<span class="quote">keep state</span>»</span>
тохируулгуудыг агуулсан дүрмүүдээс үндсэндээ бүрдсэн байгаа. Энэ бол хамааруулсан галт ханын дүрмүүдийг
бичих үндсэн арга барил юм.</p><p>Хуучин уламжлалт дүрмүүдтэй ажиллах аргуудын талаар дэлгэрэнгүй тайлбарыг:
<code class="uri"><a class="uri" href="http://www.munk.me.uk/ipf/ipf-howto.html" target="_top">http://www.munk.me.uk/ipf/ipf-howto.html</a></code>
      ба <code class="uri"><a class="uri" href="http://coombs.anu.edu.au/~avalon/ip-filter.html" target="_top">http://coombs.anu.edu.au/~avalon/ip-filter.html</a></code> хаягаар орж үзнэ үү.</p><p>IPF FAQ-г <code class="uri"><a class="uri" href="http://www.phildev.net/ipf/index.html" target="_top">http://www.phildev.net/ipf/index.html</a></code> хаягаар орж үзнэ үү.</p><p>Нээлттэй эхийн IPFilter програмын захидлын жагсаалтын архивыг <code class="uri"><a class="uri" href="http://marc.theaimsgroup.com/?l=ipfilter" target="_top">http://marc.theaimsgroup.com/?l=ipfilter</a></code> хаягаар орж үзнэ үү.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91963344"></a>31.5.1. IPF-г идэвхжүүлэх</h3></div></div></div><a id="idp91963984" class="indexterm"></a><p>IPF нь FreeBSD үндсэн суулгацтай хамт, ажиллах үеийн ачаалах боломжтой модуль байдлаар ирдэг.
<code class="filename">rc.conf</code> тохиргооны файл дотор ipfilter_enable="YES" илэрхийлэл байгаа үед систем IPF цөмийн
модулийг динамикаар ачаална. Энэ ачаалах боломжтой модуль нь бүртгэх боломжтойгоор,
анхдагч <code class="literal">default pass all</code> тохируулгын хамт бүтээгдсэн байдаг. Анхдагч дүрмийг
<code class="literal">block all</code> болгохын тулд IPF-г цөмд эмхэтгэх шаардлага байхгүй. Зөвхөн
дүрмүүдийнхээ төгсгөлд бүгдийг хаах дүрмийг бичиж өгөхөд хангалттай.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91966800"></a>31.5.2. Цөмийн тохируулгууд</h3></div></div></div><a id="idp91967440" class="indexterm"></a><a id="idp91968720" class="indexterm"></a><a id="idp91969872" class="indexterm"></a><a id="idp91971024" class="indexterm"></a><p>FreeBSD цөм уруу дараах боломжуудыг эмхэтгэн IPF-г идэвхжүүлэх
албагүй боловч, суурь мэдлэг болгон энд үзүүллээ. IPF-г цөм уруу хөрвүүлэн
эмхэтгэснээр ачаалах боломжтой модулийг хэрэглэх боломжгүй болдог.</p><p>Цөмийн тохиргоон дахь жишээ IPF илэрхийллүүд
	<code class="filename">/usr/src/sys/conf/NOTES</code> гэсэн цөмийн эх файлд
байх ба доор сийрүүлбэл:</p><pre class="programlisting">options IPFILTER
options IPFILTER_LOG
options IPFILTER_DEFAULT_BLOCK</pre><p><code class="literal">options IPFILTER</code> мөр нь <span class="quote">«<span class="quote">IPFILTER</span>»</span>
галт ханыг идэвхжүүлнэ.</p><p><code class="literal">options IPFILTER_LOG</code> мөр нь <code class="literal">log</code>
гэсэн түлхүүр үг орсон дүрмүүдийн хувьд урсгалыг <code class="filename">ipl</code>
пакет бүртгэх хуурамч—төхөөрөмж уруу бүртгэх боломжтой болгоно.</p><p><code class="literal">options IPFILTER_DEFAULT_BLOCK</code> мөр нь
галт ханын <code class="literal">pass</code> дүрмэнд тохироогүй пакетийг
хаах анхдагч чанарыг зааж өгнө.</p><p>Эдгээр тохируулгууд нь зөвхөн тэдгээрийг тохируулан,
тусгайлан цөм бүтээж суулгасны дараа идэвхждэг.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91977808"></a>31.5.3. rc.conf тохируулгууд</h3></div></div></div><p>IPF-г систем ачаалах үед идэвхтэй болгохын тулд /etc/rc.conf дотор
дараах илэрхийллүүд байх ёстой:</p><pre class="programlisting">ipfilter_enable="YES"             # Start ipf firewall
ipfilter_rules="/etc/ipf.rules"   # loads rules definition text file
ipmon_enable="YES"                # Start IP monitor log
ipmon_flags="-Ds"                 # D = start as daemon
                                  # s = log to syslog
                                  # v = log tcp window, ack, seq
                                  # n = map IP &amp; port to names</pre><p>Хэрэв энэ галт ханын цаана хувийн IP хаяг хэрэглэдэг LAN байгаа бол
<acronym class="acronym">NAT</acronym> функцыг идэвхжүүлэхийн тулд дараах мөрүүдийг нэмэх хэрэгтэй:</p><pre class="programlisting">gateway_enable="YES"              # Enable as LAN gateway
ipnat_enable="YES"                # Start ipnat function
ipnat_rules="/etc/ipnat.rules"    # rules definition file for ipnat</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91980624"></a>31.5.4. IPF</h3></div></div></div><a id="idp91981264" class="indexterm"></a><p>Таны бичсэн дүрмүүдийг ачаалахад <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a> тушаалыг хэрэглэнэ.
Та өөрийн дүрмүүдээс бүтсэн файлыг үүсгээд, түүнийгээ дээрх тушаалын ашиглан
галт ханын одоо ажиллаж байгаа дотоод дүрмүүдтэй сольж тавьна гэсэн үг юм:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipf -Fa -f /etc/ipf.rules</code></strong></pre><p><code class="option">-Fa</code> нь бүх дотоод дүрмүүдийн хүснэгтийг цэвэрлэ гэсэн үг.</p><p><code class="option">-f</code> нь ачаалах дүрмүүдээ энэ файлаас унш гэсэн үг.</p><p>Ийм байдлаар та өөрийн хүссэн дүрмүүдийн файлыг үүсгээд,
дээрх IPF тушаалыг ажиллуулан системийг шинээр ачаалахгүйгээр
ажиллаж байгаа галт ханын дүрмүүдийг шинээр өөрчлөх боломжтой болж байна.
Дээрх аргаар галт ханын дүрмүүдийг хэдэн ч удаа сольж болох тул энэ арга нь
шинэ дүрмүүдийг туршихад тохиромжтой арга юм.</p><p>Энэ тушаалтай ажиллах боломжтой бусад тугуудын талаар
дэлгэрэнгүйг <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a> заавар хуудаснаас үзнэ үү.</p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a> тушаал дүрмүүдийн файлыг стандарт текст файл гэж
тооцдог. Симбол орлуулалттай скрипт байдлаар бичигдсэн файлыг ойлгохгүй.</p><p>Гэвч скрипт симбол орлуулалтын хүчийг ашиглан IPF дүрмүүдийг бүтээх
арга зам байгаа. Илүү дэлгэрэнгүй мэдээллийг
<a class="xref" href="firewalls-ipf.html#firewalls-ipf-rules-script" title="31.5.9. Симбол орлуулалттай скриптийг үүсгэх нь">Хэсэг 31.5.9, «Симбол орлуулалттай скриптийг үүсгэх нь»</a> хэсгээс үзнэ үү.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91993040"></a>31.5.5. IPFSTAT</h3></div></div></div><a id="idp91993680" class="indexterm"></a><a id="idp91994320" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a>-н анхдагч чанар бол галт ханыг хамгийн сүүлд асааснаас хойших,
эсвэл <code class="command">ipf -Z</code> тушаалыг өгөн хуримтлуулагчийг хамгийн сүүлд тэглэснээс хойших
галт ханаар орж байгаа болон гарч байгаа пакетуудыг хэрэглэгчийн тодорхойлж өгсөн дүрмүүдээр
шүүсэн үр дүнд бий болсон статистик тоог гаргаж ирэн, дэлгэцэнд харуулах юм.</p><p>Дэлгэрэнгүйг <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a> заавар хуудаснаас үзнэ үү.</p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a> тушаалын анхдагч үр дүн дараах байдалтай байна:</p><pre class="screen">input packets: blocked 99286 passed 1255609 nomatch 14686 counted 0
 output packets: blocked 4200 passed 1284345 nomatch 14687 counted 0
 input packets logged: blocked 99286 passed 0
 output packets logged: blocked 0 passed 0
 packets logged: input 0 output 0
 log failures: input 3898 output 0
 fragment state(in): kept 0 lost 0
 fragment state(out): kept 0 lost 0
 packet state(in): kept 169364 lost 0
 packet state(out): kept 431395 lost 0
 ICMP replies: 0 <acronym class="acronym">TCP</acronym> RSTs sent: 0
 Result cache hits(in): 1215208 (out): 1098963
 IN Pullups succeeded: 2 failed: 0
 OUT Pullups succeeded: 0 failed: 0
 Fastroute successes: 0 failures: 0
 <acronym class="acronym">TCP</acronym> cksum fails(in): 0 (out): 0
 Packet log flags set: (0)</pre><p>Дотогшоо урсгалын хувьд <code class="option">-i</code>,
гадагшаа урсгалын хувьд <code class="option">-o</code> тохируулгыг өгөхөд
кернелийн ашиглаж буй дүрмүүдийн жагсаалтыг гаргаж харуулна.</p><p><code class="command">ipfstat -in</code> нь дотогшоо урсгалын
дотоод дүрмүүдийн хүснэгтийг дүрмүүдийн дугаарын хамт харуулна.</p><p><code class="command">ipfstat -on</code> нь гадагшаа урсгалын
дотоод дүрмүүдийн хүснэгтийг дүрмүүдийн дугаарын хамт харуулна.</p><p>Үр дүн нь дараах байдалтай байна:</p><pre class="screen">@1 pass out on xl0 from any to any
@2 block out on dc0 from any to any
@3 pass out quick on dc0 proto tcp/udp from any to any keep state</pre><p><code class="command">ipfstat -ih</code> нь дотогшоо урсгалын
дотоод дүрмүүдийн хүснэгтийг дүрмүүдийн хэдэн удаа тохирсон тооны хамт харуулна.</p><p><code class="command">ipfstat -oh</code> нь гадагшаа урсгалын
дотоод дүрмүүдийн хүснэгтийг дүрмүүдийн хэдэн удаа тохирсон тооны хамт харуулна.</p><p>Үр дүн нь дараах байдалтай байна:</p><pre class="screen">2451423 pass out on xl0 from any to any
354727 block out on dc0 from any to any
430918 pass out quick on dc0 proto tcp/udp from any to any keep state</pre><p><code class="command">ipfstat</code> тушаалын хамгийн чухал функцуудын
нэг бол, FreeBSD-н ажиллаж байгаа процессийн хүснэгтийг <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a>
харуулдаг шиг төлвийн хүснэгтийг <code class="option">-t</code> туг харуулдаг явдал юм.
Таны галт хана гадны халдлагад өртөх үед энэ функц түүнийг илрүүлэх, шинжлэх, халдлагад
оролцож буй пакетуудыг харах боломжийг олгоно. Нэмэлт дэд тугууд нь хяналт хийх
эхлэл болон очих IP хаяг, порт, эсвэл протоколыг сонгох боломжийг олгодог.
Дэлгэрэнгүйг <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a> заавар хуудаснаас үзнэ үү.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92020816"></a>31.5.6. IPMON</h3></div></div></div><a id="idp92021456" class="indexterm"></a><a id="idp92022096" class="indexterm"></a><p><code class="command">ipmon</code> тушаал зохистой ажиллахын тулд цөмийн
<code class="literal">IPFILTER_LOG</code> тохируулга идэвхжсэн байх ёстой. Энэ тушаал хоёр өөр горимд
ажиллах чадвартай. Төрөлх горим нь энэ тушаалыг тушаал мөрөн дээр
<code class="option">-D</code> туггүйгээр оруулахад ажиллах анхдагч горим юм.</p><p>Демон горим нь болж өнгөрсөн үйл явцын бүртгэлийг эргэж харахын тулд
системийн бүртгэлийг тасралтгүй хөтлөн явуулахад тохиромжтой горим юм.
FreeBSD болон IPFILTER энэ горимд ажиллахаар тохируулагдсан байдаг. FreeBSD
нь системийн бүртгэлийг автоматаар тойруулах чадвартай. Тиймээс бүртгэлийн мэдээллийг <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a>
процесс уруу гаргах нь энгийн файл уруу гаргах анхдагч аргаас дээр байдаг.
Анхдагч <code class="filename">rc.conf</code> файл дотор <code class="literal">ipmon_flags</code> илэрхийлэл
<code class="option">-Ds</code> тугуудыг хэрэглэдэг:</p><pre class="programlisting">ipmon_flags="-Ds" # D = start as daemon
                  # s = log to syslog
                  # v = log tcp window, ack, seq
                  # n = map IP &amp; port to names</pre><p>Бүртгэл хөтлөн явуулахын давуу талыг дурдахад илүүц биз.
Бүртгэлийн тусламжтай ямар пакетууд орхигдсон, тэдгээр пакетууд хаанаас ирсэн,
хаашаа явж байсан зэрэг мэдээллийг эргэн харах боломжтой болдог. Энэ бүх мэдээлэл
гадны халдлагыг мөрдөхөд чухал түлхэц болно.</p><p>Хэдийгээр бүртгэх боломжоор хангагдсан боловч, IPF дангаараа бүртгэлийг үүсгэж
чадахгүй. Галт ханын администратор аль дүрмийн бүртгэлийг бичихийг шийдэн, тэдгээр дүрмүүдэд
log түлхүүр үгийг нэмж өгнө. Ер нь, зөвхөн deny дүрмүүдийн бүртгэл бичигддэг.</p><p>Бүгдийг хориглосон анхдагч дүрмийг log түлхүүр үгийн хамт дүрмүүдийнхээ
хамгийн төгсгөлд бичиж өгөх нь нилээд өргөн хэрэглэгддэг арга юм. Ингэснээр
таны дүрмүүдийн алинтай ч тохироогүй пакетуудыг мэдэх боломжтой болно.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92028752"></a>31.5.7. IPMON бүртгэл хөтлөлт</h3></div></div></div><p><span class="application">Syslogd</span> нь бүртгэлийн мэдээллийг дотор нь ангилах
өөрийн тусгай аргатай. <span class="quote">«<span class="quote">facility</span>»</span> ба <span class="quote">«<span class="quote">түвшин</span>»</span> гэсэн тусгай ангилалаар ялгадаг.
<code class="option">-Ds</code> горимон дахь IPMON нь анхдагчаар <span class="quote">«<span class="quote">facility</span>»</span>-аар <code class="literal">local0</code>-г
хэрэглэдэг. Хэрэв хүсвэл
доорх түвшнүүдийг ашиглан бүртгэгдсэн мэдээллийг илүү ангилж болно:</p><pre class="screen">LOG_INFO - нэвтрүүлэх, хаахаас үл хамааран "log" түлхүүрийг үйлдэл ашиглан пакетуудыг бүртгэх.
LOG_NOTICE - нэвтэрсэн пакетуудыг бүртгэх.
LOG_WARNING - хаагдсан пакетуудыг бүртгэх.
LOG_ERR - бүртгэсэн пакетууд болон богино гэгдсэн пакетууд</pre><p>IPFILTER-н бүх бүртгэлийн мэдээллийг <code class="filename">/var/log/ipfilter.log</code>
файл дотор бичихийн тулд, файл эхлээд үүссэн байх хэрэгтэй. Үүний тулд дараах
тушаалыг өгөх хэрэгтэй:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>touch /var/log/ipfilter.log</code></strong></pre><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a>-н функцуудыг <code class="filename">/etc/syslog.conf</code> файл доторх
тодорхойлох илэрхийллүүдээр удирдаж болно. <code class="filename">syslog.conf</code> файл нь
IPF мэт програмуудын үүсгэсэн системийн мэдэгдлүүдтэй <span class="application">syslog</span>-г
	ажиллахад уян хатан болгодог.</p><p>Дараах илэрхийллүүдийг <code class="filename">/etc/syslog.conf</code> файл дотор нэмж
бичнэ үү:</p><pre class="programlisting">local0.* /var/log/ipfilter.log</pre><p><code class="literal">local0.*</code> нь бүх бүртгэгдсэн мэдэгдлүүдийг
дурдсан файлд бичихийг хэлж өгч байна.</p><p><code class="filename">/etc/syslog.conf</code> файлд хийсэн өөрчлөлтүүдийг
идэвхжүүлэхийн тулд та системээ дахин ачаалах эсвэл <code class="command">/etc/rc.d/syslogd reload</code>
тушаалыг ашиглан <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> демонд <code class="filename">/etc/syslog.conf</code> файлыг дахин уншуулах
хэрэгтэй.</p><p>Дээр шинээр үүсгэсэн бүртгэлийг тойруулахын тулд
<code class="filename">/etc/newsyslog.conf</code> файл дотор өөрчлөлт оруулахаа мартуузай.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92115920"></a>31.5.8. Бүртгэгдсэн мэдэгдлийн формат</h3></div></div></div><p><code class="command">ipmon</code>-ы үүсгэсэн мэдэгдэл зайгаар тусгаарлагдсан
өгөгдлийн талбаруудаас бүрдэнэ. Бүх мэдэгдэлд байдаг гол талбарууд гэвэл:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Пакетийг хүлээж авсан огноо.</p></li><li class="listitem"><p>Пакетийг хүлээж авсан цаг. Цаг, минут, секунд, бутархай секундэд (олон орны нарийвчлалтай)
харгалзан HH:MM:SS.F форматтай байна.</p></li><li class="listitem"><p>Пакеттай ажилласан интерфэйсийн нэр, жишээлбэл <code class="filename">dc0</code>.</p></li><li class="listitem"><p>Дүрмийн бүлэг болон дүрмийн дугаар, жишээлбэл <code class="literal">@0:17</code>.</p></li></ol></div><p>Эдгээрийг <code class="command">ipfstat-in</code> тушаалын тусламжтай үзэж болно.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Үйлдэл: нэвтрүүлсэн бол р, хаасан бол b, богино пакет бол S,
аль ч дүрмэнд тохироогүй бол n, бүртгэх дүрэм бол L. Эдгээр тугуудыг дараах эрэмбээр харуулна:
S, p, b, n, L. Том P эсвэл B үсэг нь тухайн пакет ямар нэг дүрмээс биш, глобал тохиргооноос
хамааран бүртгэгдсэн болохыг заана.</p></li><li class="listitem"><p>Хаягууд. Үндсэндээ гурван талбар байна: эхлэл
хаяг болон порт (таслалаар тусгаарлагдсан), -&gt; тэмдэг, ба очих хаяг болон порт.
Жишээ нь <code class="literal">209.53.17.22,80 -&gt; 198.73.220.17,1722</code>.</p></li><li class="listitem"><p><code class="literal">PR</code>-н дараа протоколын нэр болон дугаар, жишээлбэл <code class="literal">PR tcp</code>.</p></li><li class="listitem"><p><code class="literal">len</code>-ы дараа толгойн урт болон
пакетийн нийт урт, жишээлбэл <code class="literal">len 20 40</code>.</p></li></ol></div><p>Хэрэв <acronym class="acronym">TCP</acronym> пакет бол зураасаар эхэлж тугуудаар удаалсан
нэмэлт талбар байна. Үсгүүд болон түүнд харгалзах тугуудын талаар <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a> заавар
хуудаснаас үзнэ үү.</p><p>Хэрэв ICMP пакет бол, төгсгөлд нь хоёр талбар байна.
Эхнийх нь үргэлж <span class="quote">«<span class="quote">ICMP</span>»</span> утгатай байна, дараагийнх нь налуу зураасаар тусгаарлагдсан
ICMP мэдэгдэл болон дэд мэдэгдлийн төрөл, жишээлбэл портод хандаж чадсангүй гэсэн мэдэгдлийн хувьд ICMP 3/3 байна.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls-ipf-rules-script"></a>31.5.9. Симбол орлуулалттай скриптийг үүсгэх нь</h3></div></div></div><p>Зарим туршлагатай IPF хэрэглэгчид дүрмүүдийг агуулсан файл үүсгээд
түүнийгээ симбол орлуулалттай скрипт байдлаар ажиллуулах боломжтой болгон бичдэг.
Үүний гол давуу тал нь зөвхөн симбол нэрд харгалзах утгыг өөрчлөх хэрэгтэй бөгөөд, скриптийг ажиллуулахад
уг симбол орлуулалт орсон дүрэм бүр шинэ утгыг авах болно. Скриптийн хувьд,
олон дахин хэрэглэгддэг утгуудыг бичихэд симбол орлуулалтыг ашиглаж, тэдгээрийг
олон дүрмэнд орлуулж өгнө гэсэн үг юм. Дараах жишээн дээрээс харна уу.</p><p>Энд хэрэглэгдсэн скриптийн синтакс нь <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a>, ба <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcsh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcsh</span>(1)</span></a> бүрхүүл дээр ажиллах
боломжтой.</p><p>Симбол орлуулалтын талбарууд нь урдаа долларын тэмдэгтэй байна: <code class="literal">$</code>.</p><p>Симбол талбарууд нь $ тэмдэг урдаа байхгүй.</p><p>Симбол талбарыг орлох утга нь давхар хашилтан(<code class="literal">"</code>) дотор байрлана.</p><p>Дүрмийн файлаа дараах байдалтай үүсгэж эхлэх хэрэгтэй:</p><pre class="programlisting">############# Start of IPF rules script ########################

oif="dc0"            # name of the outbound interface
odns="192.0.2.11"    # ISP's DNS server IP address
myip="192.0.2.7"     # my static IP address from ISP
ks="keep state"
fks="flags S keep state"

# You can choose between building /etc/ipf.rules file
# from this script or running this script "as is".
#
# Uncomment only one line and comment out another.
#
# 1) This can be used for building /etc/ipf.rules:
#cat &gt; /etc/ipf.rules &lt;&lt; EOF
#
# 2) This can be used to run script "as is":
/sbin/ipf -Fa -f - &lt;&lt; EOF

# Allow out access to my ISP's Domain name server.
pass out quick on $oif proto tcp from any to $odns port = 53 $fks
pass out quick on $oif proto udp from any to $odns port = 53 $ks

# Allow out non-secure standard www function
pass out quick on $oif proto tcp from $myip to any port = 80 $fks

# Allow out secure www function https over TLS SSL
pass out quick on $oif proto tcp from $myip to any port = 443 $fks
EOF
################## End of IPF rules script ########################</pre><p>Байх ёстой бүх зүйлс бүгд байна. Энэ жишээн дээр дүрмүүд чухал биш,
харин симбол орлуулалт хэрхэн ажилладгыг харуулсан байна. Хэрэв дээрх жишээ
<code class="filename">/etc/ipf.rules.script</code> нэртэй файл дотор байсан бол, эдгээр
дүрмүүдийг дараах тушаалыг өгч дахин ачаалах боломжтой:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh /etc/ipf.rules.script</code></strong></pre><p>Суулгагдсан симболтой дүрмийн файлыг хэрэглэхэд нэг асуудал тулгардаг:
IPF симбол орлуулалтыг ойлгохгүй, ийм скриптийг шууд уншиж чаддаггүй.</p><p>Дараах скриптийг хоёр аргын нэгээр хэрэглэж болно:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">cat</code>-р эхэлсэн мөрийг ил гарга, харин
<code class="literal">/sbin/ipf</code>-р эхэлсэн мөрүүдийг далдал. <code class="literal">ipfilter_enable="YES"</code>-г
<code class="filename">/etc/rc.conf</code> файл дотор байрлуул, дараа нь өөрчлөлт бүрийн дараа скриптийг
ажиллуулан <code class="filename">/etc/ipf.rules</code> файлыг үүсгэ эсвэл өөрчлөлт оруул.</p></li><li class="listitem"><p><code class="filename">/etc/rc.conf</code> файл дотор <code class="literal">ipfilter_enable="NO"</code>
(энэ анхдагч утга) мөрийг нэмэн системийн эхлэл скриптэд IPFILTER-г идэвхгүй болго.</p><p>Дээрхтэй адил скриптийг өөрийн <code class="filename">/usr/local/etc/rc.d/</code> эхлэл хавтаст
байрлуул. Энэ скрипт <code class="filename">ipf.loadrules.sh</code> ч юм уу ойлгомжтой нэртэй байх ёстой.

	    <code class="filename">.sh</code> гэсэн өргөтгөлтэй байх ёстой.</p><pre class="programlisting">#!/bin/sh
sh /etc/ipf.rules.script</pre><p>Энэ скриптийн эрхүүд эзэмшигч <code class="systemitem">root</code>-н хувьд
унших, бичих, ажиллах эрхтэй байх ёстой.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 700 /usr/local/etc/rc.d/ipf.loadrules.sh</code></strong></pre></li></ul></div><p>Одоо систем ачаалсны дараа таны IPF дүрмүүд ачаалагдсан байх болно.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92205904"></a>31.5.10. IPF Дүрмүүдийн олонлог</h3></div></div></div><p>Пакет дотор агуулагдаж байгаа утгуудыг үндэслэн тухайн пакетийг
нэвтрүүлэх болон хаахыг хэлж байгаа IPF дүрмүүдийг дүрмийн олонлог гэнэ. Хостуудын
хоорондох хоёр чиглэлтэй пакет солилцоо нь сесс харилцааг бүрдүүлнэ. Галт ханын
дүрмийн олонлог нь Интернэтээс ирж байгаа пакетуудыг болон систем
буцааж тэдэнд хариу өгсөн пакетуудыг боловсруулдаг. Бүх <acronym class="acronym">TCP/IP</acronym> үйлчилгээнүүд
(жишээ нь: telnet, www,	mail, г.м.) өөрийн протокол болон зөвшөөрөгдсөн
(сонсож байгаа) портоороо тодорхойлогддог.
Тухайн нэг үйлчилгээ рүү зорисон пакетууд нь тусгай зориулалтаар ашиглагддаггүй
	порт ашиглан эх хаягаас гарч очих хаягийн тухайн үйлчилгээний порт руу
	чиглэдэг.
Дээрх бүх параметрууд (өөрөөр хэлбэл: портууд болон хаягууд) дээр үндэслэн
	нэвтрүүлэх болох хаах дүрмүүдийг зохиодог.</p><a id="idp92207312" class="indexterm"></a><p>IPF-г анх зохиохдоо <span class="quote">«<span class="quote">сүүлд тохирсон дүрэм дийлнэ</span>»</span>
логикийн дагуу бүтээсэн ба зөвхөн төлөвт-бус дүрмүүдийг ашигладаг байлаа.
Цаг хугацаа өнгөрөхөд IPF илүү хөгжиж, <span class="quote">«<span class="quote">quick</span>»</span> тохируулга
болон төлөвт <span class="quote">«<span class="quote">keep state</span>»</span> тохируулгуудыг агуулах болсон нь орчин үеийн
хэрэгцээ шаардлагад илүү нийцэх болжээ.</p><p>Энэ бүлэгт байгаа зааврууд нь <span class="quote">«<span class="quote">quick</span>»</span> болон төлөвт <span class="quote">«<span class="quote">keep state</span>»</span>
тохируулгуудыг агуулсан дүрмүүдээс үндсэндээ бүрдсэн байгаа. Энэ бол хамааруулсан галт ханын дүрмүүдийг
бичих үндсэн арга барил юм.</p><div xmlns="" class="warning"><h3 class="admontitle">Сануулга: </h3><p xmlns="http://www.w3.org/1999/xhtml">Галт ханын дүрмүүдтэй ажиллахдаа <span class="emphasis"><em>маш
анхааралтай</em></span> байх хэрэгтэй. Зарим тохиргоо серверээс
<span class="emphasis"><em>бүх холбоог тань тасалж</em></span> мэднэ. Ийм аюулаас хол
байхын тулд, галт ханын тохиргоог анхлан хийхдээ <span class="application">ssh</span>
зэрэг алсын хандалтаас илүүтэйгээр ойрын удирдлагыг сонгоорой.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92213200"></a>31.5.11. Дүрмийн синтакс</h3></div></div></div><a id="idp92218064" class="indexterm"></a><p>Энд дурдах дүрмийн синтакс нь орчин үеийн төлөвт
дүрмүүдийн хүрээнд, <span class="quote">«<span class="quote">сүүлд тохирсон дүрэм дийлнэ</span>»</span> логикоор
ажиллахаар хялбаршуулан бичигдсэн байгаа. Хуучин уламжлалт дүрмүүдийн
синтаксын бүрэн тайлбарыг <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a> заавар хуудаснаас үзнэ үү.</p><p><code class="literal">#</code> гэсэн тэмдэгт тайлбарын эхлэлийг заах ба
дүрэм бичсэн мөрийн төгсгөлд эсвэл өөрөө бүтэн мөр байдлаар байрлана.
Хоосон мөрийг тооцохгүй.</p><p>Дүрмүүд нь түлхүүр үгүүдийг агуулна. Эдгээр түлхүүр үгүүд нь
тухайн мөрөнд зүүнээс баруун тийш тодорхой дэс дараагаар бичигдэнэ.
Түлхүүр үгүүд тодоор бичигдэх тул түүгээр нь ялгаж танина. Зарим түлхүүр
үгүүд дэд-тохируулгатай байна. Тэр нь өөрөө түлхүүр үг байж болохоос гадна
цааш дэд-тохируулгуудыг агуулсан байж болно. Доорх синтаксын үг бүр нь
дор байрлах мөрүүдэд задаргааны хамт байгаа.</p><p><em class="replaceable"><code>ACTION IN-OUT OPTIONS SELECTION STATEFUL PROTO
	  SRC_ADDR,DST_ADDR OBJECT PORT_NUM TCP_FLAG
	  STATEFUL</code></em></p><p><em class="replaceable"><code>ACTION</code></em> = block | pass</p><p><em class="replaceable"><code>IN-OUT</code></em> = in | out</p><p><em class="replaceable"><code>OPTIONS</code></em> = log | quick | on
	  interface-name</p><p><em class="replaceable"><code>SELECTION</code></em> = proto value |
	  source/destination IP | port = number | flags
	  flag-value</p><p><em class="replaceable"><code>PROTO</code></em> = tcp/udp | udp | tcp |
	  icmp</p><p><em class="replaceable"><code>SRC_ADD,DST_ADDR</code></em> = all | from
	  object to object</p><p><em class="replaceable"><code>OBJECT</code></em> = IP address | any</p><p><em class="replaceable"><code>PORT_NUM</code></em> = port number</p><p><em class="replaceable"><code>TCP_FLAG</code></em> = S</p><p><em class="replaceable"><code>STATEFUL</code></em> = keep state</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92229456"></a>31.5.11.1. ACTION</h4></div></div></div><p>Тухайн дүрмэнд тохирч байгаа пакетийг хэрхэхийг action буюу
үйлдэл зааж өгнө. Бүх дүрэм үйлдэлтэй <span class="emphasis"><em>байх ёстой</em></span>. Дараах
үйлдлүүдийг хэрэглэж болно:</p><p><code class="literal">block</code> гэдэг нь пакеттай selection буюу сонголтын
параметрүүд тохирч байвал тухайн пакетийг орхигдуулахыг зааж өгнө.</p><p><code class="literal">pass</code> гэдэг нь пакеттай selection буюу сонголтын
параметрүүд тохирч байвал тухайн пакетийг нэвтрүүлэхийг зааж өгнө.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92232272"></a>31.5.11.2. IN-OUT</h4></div></div></div><p>Дүрэм нь орох болон гарах урсгалын алинд үйлчлэхийг
заавал зааж өгөх ёстой. Энэ нь <code class="literal">in</code> эсвэл <code class="literal">out</code> түлхүүр үгийн аль нэг нь заавал
бичигдсэн байх ёстой гэсэн үг юм. Үгүй бол синтаксын алдаа өгч, танигдахгүй.</p><p><code class="literal">in</code> гэдэг нь Интернэт уруу харж байгаа
интерфэйс дээр хүлээж авсан дотогшоо ирж байгаа пакетийн хувьд энэ дүрэм
үйлчлэхийг зааж өгнө.</p><p><code class="literal">out</code> гэдэг нь Интернэт уруу харж байгаа
интерфэйс уруу чиглэсэн гадагшаа явж байгаа пакетийн хувьд энэ дүрэм үйлчлэхийг
зааж өгнө.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92235600"></a>31.5.11.3. OPTIONS</h4></div></div></div><div xmlns="" class="note"><h3 class="admontitle">Тэмдэглэл: </h3><p xmlns="http://www.w3.org/1999/xhtml">Эдгээр options буюу тохируулгуудыг энд үзүүлсэн дэс
дарааллын дагуу хэрэглэх ёстой.</p></div><p><code class="literal">log</code> гэдэг нь пакеттай selection буюу сонголтын
параметрүүд тохирч байвал пакетийн толгой
	

	  <code class="filename">ipl</code> бүртгэл уруу (дор Бүртгэл Хөтлөх хэсэгт
заасны дагуу) бичигдэхийг зааж өгнө.</p><p><code class="literal">quick</code> гэдэг нь пакеттай selection буюу сонголтын
параметрүүд тохирч байвал энэ дүрэм нь хамгийн сүүлийн дүрэм болохыг зааж өгнө.
Ингэснээр <span class="quote">«<span class="quote">short-circuit</span>»</span> замыг тухайн пакетийн хувьд дараагийн
дүрмүүдийг шалгахыг болиулна. Орчин үеийн дүрэмтэй ажиллах логикийн хувьд энэ
тохируулгыг заавал хэрэглэнэ.</p><p><code class="literal">on</code> гэдэг нь selection буюу сонголтын
параметрүүдийн ажиллах интерфэйсийг зааж өгнө. Интерфэйсүүдийн нэрийг
<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>-н тусламжтай харж болно. Энэ тохируулгыг хэрэглэснээр,
тухайн дүрэм зөвхөн энэ интерфэйсээр зохих чиглэлд(in/out) явж байгаа
пакетийн хувьд үйлчилнэ. Орчин үеийн дүрэмтэй ажиллах логикийн хувьд энэ
тохируулгыг заавал хэрэглэнэ.</p><p>Пакетийг бүртгэхэд, түүний толгойг <acronym class="acronym">IPL</acronym> пакет бүртгэх
хуурамч-төхөөрөмж уруу бичнэ. <code class="literal">log</code> түлхүүр үгийн дараа шууд залгаад,
дараах тодотгогчдыг(дараах дэс дарааллаар) хэрэглэж болно:</p><p><code class="literal">body</code> гэдэг нь пакетийн толгойн дараа
пакетийн агуулгын эхний 128 байтыг бүртгэхийг зааж өгнө.</p><p><code class="literal">first</code> Хэрэв <code class="literal">log</code>
түлхүүр үг <code class="literal">keep state</code> тохируулгын хамт хэрэглэгдсэн бол,
түүний араас ирэх <span class="quote">«<span class="quote">keep state</span>»</span>-д тохирч байгаа бүх пакетийг
биш зөвхөн энэ тохируулгыг идэвхжүүлсэн эхний пакетийг бүртгэхийн тулд
энэ тохируулгыг хэрэглэнэ.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92244560"></a>31.5.11.4. SELECTION</h4></div></div></div><p>Энэ бүлэгт танилцуулж байгаа түлхүүр үгүүд тухайн пакетийг
дүрмэнд тохирсон эсэхийг тогтоохын тулд шалгадаг пакетийн онцлогийг
тодорхойлоход хэрэглэгддэг. Мөн subject түлхүүр үг байх ба дэд-тохируулга
түлхүүр үгийн аль нэгийг сонгон хэрэглэнэ. Дараах ерөнхий онцлогуудыг
хэрэглэх боломжтой, гэхдээ доорх дэс дарааллаар хэрэглэх хэрэгтэй:</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92245712"></a>31.5.11.5. PROTO</h4></div></div></div><p><code class="literal">proto</code> гэдэг нь subject түлхүүр үг бөгөөд
өөрийн харгалзах дэд-тохируулгын хамт хэрэглэгдэх ёстой. Утга нь
ямар протокол дээр ажиллахыг хэлж өгнө. Орчин үеийн дүрэмтэй
ажиллах логикийн хувьд энэ тохируулгыг заавал хэрэглэнэ.</p><p><code class="literal">tcp/udp | udp | tcp | icmp</code> эсвэл
<code class="filename">/etc/protocols</code> файл дотор байгаа протоколуудыг
хэрэглэж болно. Тусгай <code class="literal">tcp/udp</code> гэсэн түлхүүр үг
<acronym class="acronym">TCP</acronym> эсвэл <acronym class="acronym">UDP</acronym> пакетийг сонгоход хэрэглэгддэг ба,
давхар эсвэл төстэй дүрмүүдийг арилгах үүднээс нэмэгдсэн байгаа.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92249296"></a>31.5.11.6. SRC_ADDR/DST_ADDR</h4></div></div></div><p><code class="literal">all</code> гэсэн түлхүүр үг нь
өөр ямар ч параметргүй <span class="quote">«<span class="quote">from any to any</span>»</span> гэдэгтэй адил юм.</p><p><code class="literal">from src to dst</code>: <code class="literal">from</code> ба <code class="literal">to</code> гэсэн
түлхүүр үгүүд IP хаягийг шүүхэд хэрэглэгдэнэ. Дүрэмд хэрэглэхдээ эхлэл ба
очих параметрийг <span class="emphasis"><em>хоёуланг</em></span> зааж өгөх ёстой. <code class="literal">any</code>
гэсэн тусгай түлхүүр үгийн тусламжтай бүх IP хаягийг зөвшөөрч өгч болно.
Хэрэглэх жишээ: <code class="literal">from any to any</code>
	  эсвэл <code class="literal">from 0.0.0.0/0 to any</code> эсвэл <code class="literal">from any to
          0.0.0.0/0</code> эсвэл <code class="literal">from 0.0.0.0 to any</code> эсвэл
	  <code class="literal">from any to 0.0.0.0</code>.</p><p>Цэгээр тусгаарлагдсан тоо/баг хэлбэрээр хялбархан илэрхийлэх боломжгүй IP хаягуудыг
хэрэглэх боломжгүй. <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/ipcalc/pkg-descr">net-mgmt/ipcalc</a> порт ашиглан үүнийг
	  хялбарчилж болох юм. Нэмэлт мэдээллийг дараах вэб хуудсаар
орж үзнэ үү: <code class="uri"><a class="uri" href="http://jodies.de/ipcalc" target="_top">http://jodies.de/ipcalc</a></code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92264784"></a>31.5.11.7. PORT</h4></div></div></div><p>Хэрэв эхлэл эсвэл очих порт, эсвэл хоёулангаар нь тохируулах бол
энэ нь зөвхөн <acronym class="acronym">TCP</acronym> ба <acronym class="acronym">UDP</acronym> пакетуудад хамаарна. Порт жишсэн дүрэм
бичихдээ <code class="filename">/etc/services</code> файл доторх үйлчилгээний нэр эсвэл
бүхэл тоон портын дугаарыг хэрэглэнэ. Портыг <code class="literal">from</code> обьекттой хамт хэрэглэх үед
энэ нь эхлэл портын дугаарыг, <code class="literal">to</code> обьекттой хамт хэрэглэх үед
энэ нь очих портын дугаарыг заана. Орчин үеийн дүрэмтэй
ажиллах логикийн хувьд port тохиргоог <code class="literal">to</code> обьекттой
заавал хамт хэрэглэнэ. Хэрэглэх жишээ: <code class="literal">from any to any port = 80</code></p><p>Портын харьцуулалтыг төрөл бүрийн жиших операторуудыг
	  ашиглан хэд хэдэн аргаар хийж болно. Портын зурвасыг бас
	  зааж өгч болно.</p><p>port "=" | "!=" | "&lt;" | "&gt;" | "&lt;=" | "&gt;=" |
	  "eq" | "ne" | "lt" | "gt" | "le" | "ge".</p><p>Порт зурвасыг зааж өгөхдөө, port "&lt;&gt;" |
	  "&gt;&lt;" гэж хэрэглэнэ.</p><div xmlns="" class="warning"><h3 class="admontitle">Сануулга: </h3><p xmlns="http://www.w3.org/1999/xhtml">Орчин үеийн дүрэмтэй
ажиллах логикийн хувьд эхлэл болон очих порт тохируулах параметрүүдийн дараа,
дараах хоёр параметрийг заавал хэрэглэнэ.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92275024"></a>31.5.11.8. <acronym class="acronym">TCP</acronym>_FLAG</h4></div></div></div><p>Тугуудыг зөвхөн <acronym class="acronym">TCP</acronym> шүүлтийн үед хэрэглэнэ.
Үсгүүдээр нь <acronym class="acronym">TCP</acronym> пакетийн толгойтой таарч байгаа эсэхийг шалгах боломжит тугуудыг
үзүүлсэн байна.</p><p>Орчин үеийн дүрэмтэй ажиллах логик нь <code class="literal">flags S</code> параметрийг
tcp сесс эхлүүлэх хүсэлтийг тэмдэглэхдээ хэрэглэдэг.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92277968"></a>31.5.11.9. STATEFUL</h4></div></div></div><p><code class="literal">keep state</code> гэдэг нь нэвтрүүлэх төрлийн дүрмийн хувьд
сонгох параметрүүдтэй тохирсан ямар ч пакет төлөвт шүүх нэмэлт боломжийг идэвхжүүлэх ёстойг
зааж өгнө.</p><div xmlns="" class="note"><h3 class="admontitle">Тэмдэглэл: </h3><p xmlns="http://www.w3.org/1999/xhtml">Орчин үеийн дүрэмтэй ажиллах логикийн хувьд энэ тохируулгыг заавал
хэрэглэнэ.</p></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92280400"></a>31.5.12. Төлөвт шүүлт</h3></div></div></div><a id="idp92281040" class="indexterm"></a><p> Хостуудын хоорондох хоёр чиглэлтэй пакет солилцоо сесс харилцаанаас бүрддэг.
Төлөвт шүүлт нь урсгалыг сесс харилцаанаас бүрдэж буй хоёр чиглэлтэй пакет
солилцоо гэж үздэг. keep-state-г идэвхжүүлсэн үед, keep-state нь хоёр чиглэлтэй сесс харилцааны
үед солилцсон бүх пакетуудын хувьд дотоод дүрмүүдийг динамик байдлаар үүсгэдэг. Мөн
энэ нь сесс эхлүүлсэн болон хүлээн авсан хостуудын хоорондох сесс харилцаа
хоёр чиглэлтэй пакет солилцох процедуртай зохицож байгаа эсэхийг магадлах чадвартай байдаг.
Сесс харилцааны загварт зохицоогүй пакетийг хуурамч гэж үзэн хүлээж авахгүй.</p><p><acronym class="acronym">TCP</acronym> эсвэл <acronym class="acronym">UDP</acronym> сесстэй холбоотой
<acronym class="acronym">ICMP</acronym> пакетуудыг keep state нэвтрүүлнэ. Тэгэхээр, keep state дүрмээр
зөвшөөрөгдсөн вэбээр хийх аялалын хариуд <acronym class="acronym">ICMP</acronym> type 3 code 4 хариуг хүлээн авбал
галт хана үүнийг автоматаар нэвтрүүлнэ гэсэн үг юм. Хэрэв IPF хүлээн авсан пакетийг
идэвхтэй байгаа сессийн нэг хэсэг гэж баттай итгэж байвал, өөр протокол дээр байсан ч
пакетийг нэвтрүүлнэ.</p><p>Үүний цаана юу болох вэ гэвэл:</p><p>Интернэт уруу холбогдсон интерфэйсээр гарч байгаа пакетуудыг
хамгийн түрүүнд динамик төлвийн хүснэгтэнд шалгана. Хэрэв тухайн пакет ямар нэг
идэвхтэй байгаа сесс харилцаанд оролцож байгаа зөвшөөрөгдсөн дараагийн пакет
байх юм бол, галт ханаар нэвтрүүлэх ба динамик төлвийн хүснэгтэн дэх
сесс харилцааны төлөв шинэчлэгдэнэ. Идэвхтэй сесс харилцаанд хамааралгүй
пакетуудыг гадагшаа урсгалын дүрмээр шалгах болно.</p><p>Интернэт уруу холбогдсон интерфэйсээс ирж байгаа пакетуудыг
хамгийн түрүүнд динамик төлвийн хүснэгтэнд шалгана. Хэрэв тухайн пакет ямар нэг
идэвхтэй байгаа сесс харилцаанд оролцож байгаа зөвшөөрөгдсөн дараагийн пакет
байх юм бол, галт ханаар нэвтрүүлэх ба динамик төлвийн хүснэгтэн дэх
сесс харилцааны төлөв шинэчлэгдэнэ. Идэвхтэй сесс харилцаанд хамааралгүй
пакетуудыг дотогшоо урсгалын дүрмээр шалгах болно.</p><p>Харилцаа дуусахад динамик төлвийн хүснэгтээс зохих бичлэг
устгагдана.</p><p>Төлөвт шүүлтийн тусламжтайгаар та шинэ сесс зөвшөөрөх/хаах
үйл ажиллагаан дээр төвлөрч ажиллаж чадна. Хэрэв шинэ сесс зөвшөөрөгдсөн бол
түүний дараагийн бүх пакетуудыг автоматаар нэвтрүүлэх ба хуурамч пакетууд
автоматаар буцаагдана. Хэрэв шинэ сесс хаагдсан бол
түүний дараагийн ямар ч пакет нэвтэрч чадахгүй. Төлөвт шүүлт нь
сүүлийн үеийн халдлагуудад ашиглагдаж байгаа аргуудын эсрэг хамгаалах
чадвартай, техникийн хувьд өндөр түвшний шүүлт хийх чадвартай юм.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92286672"></a>31.5.13. Хамааруулсан дүрмийн олонлогийн жишээ</h3></div></div></div><p>Дараах дүрмийн олонлог нь аюулгүй байдлыг маш сайн хангасан, хамааруулсан
	галт ханын дүрмүүдийг хэрхэн бичих жишээ юм. Хамааруулсан галт хана нь зөвхөн <code class="literal">pass</code> дүрмүүдэд
	тохирсон үйлчилгээг зөвшөөрч, бусдыг бүгдийг хаана.
	Бусад машинуудыг хамгаалах ёстой галт хананууд буюу <span class="quote">«<span class="quote">сүлжээний галт хананууд</span>»</span>
	нь багаар бодоход хоёр интерфэйстэй байх ёстой бөгөөд ерөнхийдөө
	нэг талд (<acronym class="acronym">LAN</acronym>) итгэж нөгөөд (Интернэт) итгэхгүй байхаар
	тохируулагдсан байдаг. Мөн ажиллаж байгаа системээ зөвхөн хамгаалахаар
	галт хана тохируулагдсан байж болох бөгөөд ийм галт ханыг <span class="quote">«<span class="quote">хостын галт хана</span>»</span>
	гэх бөгөөд энэ нь итгэлгүй сүлжээн дэх серверүүдийн хувьд ялангуяа
	тохиромжтой байдаг.</p><p>FreeBSD-г оролцуулаад бүх <span class="trademark">UNIX</span>® төрлийн систем нь үйлдлийн систем дэх
дотоод харилцаандаа <code class="filename">lo0</code> интерфэйс болон <code class="systemitem">127.0.0.1</code>
гэсэн IP хаягийг хэрэглэхээр бүтээгдсэн байдаг. Галт ханын дүрмүүд нь дотооддоо хэрэглэж байгаа
эдгээр пакетуудыг чөлөөтэй нэвтрүүлэх дүрмүүдийг агуулсан байх ёстой.</p><p>Интернэттэй холбогдож байгаа интерфэйс дээр
Интернэт уруу гарч байгаа болон Интернэтээс ирж байгаа хандалтыг удирдах
болон хянах дүрмүүдийг байрлуулна. Энэ нь таны PPP <code class="filename">tun0</code>
интерфэйс эсвэл таны DSL эсвэл кабель модемд холбогдсон NIC байж болно.</p><p>Галт ханын цаана байгаа хувийн сүлжээнд нэг болон түүнээс дээш тооны NIC-ууд
холбогдсон тохиолдолд, тэдгээр интерфэйсүүдийн хувьд тэдгээр LAN интерфэйсүүдийн нэгээс
	нөгөө рүү ба/эсвэл гадагш гарсан пакетуудыг чөлөөтэй нэвтрүүлэх дүрмийг агуулсан байх ёстой.</p><p>Дүрмүүд гурван үндсэн хэсэгт хуваагдан зохион байгуулагдсан байх
ёстой: эхлээд итгэлтэй интерфэйсүүд, дараа нь нийтийн гадагшаа интерфэйс, төгсгөлд нь
нийтийн итгэлтэй дотогшоо интерфэйс.</p><p>Нийтийн интерфэйс хэсэгт байгаа дүрмүүд тухайн интерфэйс болон чиглэлийн
хувьд хамгийн олон тохиолддог дүрмүүд нь хамгийн түрүүнд, цөөн тохиолддог дүрмүүдээс өмнө байхаар,
хаах болох бүртгэх дүрмүүд нь хамгийн сүүлд байхаар бичигдсэн байна.</p><p>Дараах жишээн дээрх Гадагшаа хэсэг нь Интернэт хандалтыг зөвшөөрч өгөх
үйлчилгээг тодорхойлох сонголтын утгуудыг агуулсан зөвхөн <code class="literal">pass</code> дүрмүүдээс бүрдэж байна.
Бүх дүрмүүд <code class="literal">quick</code>, <code class="literal">on</code>,
<code class="literal">proto</code>, <code class="literal">port</code>, болон <code class="literal">keep state</code> тохируулгуудыг агуулсан байгаа.
<code class="literal">proto tcp</code> дүрмүүд нь төлөвт байдлыг идэвхжүүлж байгаа пакетийг тодорхойлох байдлаар,
сесс эхлүүлэх хүсэлтийг тодорхойлох зорилгоор <code class="literal">flag</code> тохируулгыг агуулсан байна.</p><p>Дотогшоо хэсэгт эхлээд хүсээгүй пакетуудыг хаах дүрмүүдийг бичсэн байна.
Энэ нь хоёр өөр шалтгаантай. Эхнийх нь хортой пакетуудын зарим нь зөвшөөрсөн
	урсгалын хэсэг байж болох юм. <code class="literal">allow</code> дүрэмд таарч байгаа
	тэр хэсэг дээр тулгуурлан эдгээр пакетуудыг зөвшөөрөлгүйгээр
	хаах ёстой. Хоёр дахь шалтгаан нь тухайн хэсэгт байгаа хамгийн сүүлийн
	дүрмээр хааж бүртгэхийн оронд тэдгээр мэдэгдэж байгаа сонирхолгүй
	татгалзалтуудыг чимээгүйгээр хааж болох юм.  Хэсэг бүр дэх
	сүүлийн дүрэм бүх пакетуудыг хааж бүртгэдэг бөгөөд таны систем рүү
	халдаж байгаа хүмүүсийг шүүхэд шаардагдах баримтыг бий болгоход
	ашиглагдаж болох юм.</p><p>Өөр нэг санаа тавин тэмдэглэн хэлэх зүйл бол хүсээгүй урсгалын хариуд ямар ч хариу явуулахгүй
	байх явдал юм. Буруу пакетуудыг зүгээр орхиж тэд алга болох ёстой юм.
	Ингэснээр халдлага явуулагч түүний явуулсан пакетууд
таны системд хүрсэн эсэх талаар юу ч мэдэхгүй үлдэх болно. Таны системийн талаар хэдий хэр бага мэднэ,
тэд ямар нэг муу зүйл хийж чадах хүртэл төдий чинээ урт хугацаа зарцуулна гэсэн үг юм.

	<code class="literal">log first</code> тохируулгыг агуулах дүрмүүд
	анхны удаа таарахад бүртгэж авдаг. Энэ тохируулга нь
	жишээ <code class="literal">nmap OS fingerprint</code> дүрэмд орсон
	байдаг. <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/nmap/pkg-descr">security/nmap</a> хэрэгслийг
	халдагчид таны серверийн үйлдлийн системийг танихын тулд ихэвчлэн
	ашигладаг.</p><p><code class="literal">log first</code> дүрмийн хувьд бүртгэлийн мэдээлэл
	бүртгэгдэх бүрт <code class="command">ipfstat -hio</code> тушаалаар энэ дүрэм хэдэн
	удаа тохирсон байгааг шалгаж болно. Ихээхэн хэмжээний бүртгэлийн
	мэдээлэл нь таныг халдлагад өртөж байгааг ихэвчлэн илэрхийлдэг.</p><p><code class="filename">/etc/services</code> файлыг ашиглан мэдэгдэхгүй
	портын дугаарыг хайж олж болох юм. Мөн
<code class="uri"><a class="uri" href="http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers" target="_top">http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers</a></code> хаягаар тухайн
порт ямар зориулалтаар ашиглагддагийг орж шалгаж болох юм.</p><p>Троянуудын хэрэглэдэг портын дугааруудыг
<code class="uri"><a class="uri" href="http://www.sans.org/security-resources/idfaq/oddports.php" target="_top">http://www.sans.org/security-resources/idfaq/oddports.php</a></code> хаягаар орж шалгаарай.</p><p>Дараах дүрмийн олонлог нь ажиллаж байгаа систем дээр шалгагдсан
аюулгүй байдлыг бүрэн хангасан хамааруулсан галт ханын дүрмийн олонлог юм.
	Үүнийг өөрийн системд хялбарханаар тааруулж болох юм.
Зөвшөөрөхийг хүсэхгүй байгаа үйлчилгээнүүдийн хувьд харгалзах
<code class="literal">pass</code> дүрмийг далдлаарай.</p><p>Хүсээгүй мэдээллийг бүртгэхгүйн тулд дотогшоо хэсэгт
	<code class="literal">block</code> дүрэм нэмж бичээрэй.</p><p>Дүрэм бүрт байгаа <code class="filename">dc0</code> гэсэн интерфэйсийн нэрийн оронд
таны системийг Интернэт уруу холбож байгаа NIC картны интерфэйсийн нэрээр сольж тавиарай.
Хэрэглэгчийн PPP-н хувьд, энэ нь <code class="filename">tun0</code> байна.</p><p>Дараах илэрхийллүүдийг <code class="filename">/etc/ipf.rules</code> дотор бичих хэрэгтэй:</p><pre class="programlisting">#################################################################
# No restrictions on Inside LAN Interface for private network
# Not needed unless you have LAN
#################################################################

#pass out quick on xl0 all
#pass in quick on xl0 all

#################################################################
# No restrictions on Loopback Interface
#################################################################
pass in quick on lo0 all
pass out quick on lo0 all

#################################################################
# Interface facing Public Internet (Outbound Section)
# Match session start requests originating from behind the
# firewall on the private network
# or from this gateway server destined for the public Internet.
#################################################################

# Allow out access to my ISP's Domain name server.
# xxx must be the IP address of your ISP's DNS.
# Dup these lines if your ISP has more than one DNS server
# Get the IP addresses from /etc/resolv.conf file
pass out quick on dc0 proto tcp from any to xxx port = 53 flags S keep state
pass out quick on dc0 proto udp from any to xxx port = 53 keep state

# Allow out access to my ISP's DHCP server for cable or DSL networks.
# This rule is not needed for 'user ppp' type connection to the
# public Internet, so you can delete this whole group.
# Use the following rule and check log for IP address.
# Then put IP address in commented out rule &amp; delete first rule
pass out log quick on dc0 proto udp from any to any port = 67 keep state
#pass out quick on dc0 proto udp from any to z.z.z.z port = 67 keep state


# Allow out non-secure standard www function
pass out quick on dc0 proto tcp from any to any port = 80 flags S keep state

# Allow out secure www function https over TLS SSL
pass out quick on dc0 proto tcp from any to any port = 443 flags S keep state

# Allow out send &amp; get email function
pass out quick on dc0 proto tcp from any to any port = 110 flags S keep state
pass out quick on dc0 proto tcp from any to any port = 25 flags S keep state

# Allow out Time
pass out quick on dc0 proto tcp from any to any port = 37 flags S keep state

# Allow out nntp news
pass out quick on dc0 proto tcp from any to any port = 119 flags S keep state

# Allow out gateway &amp; LAN users' non-secure FTP ( both passive &amp; active modes)
# This function uses the IP<acronym class="acronym">NAT</acronym> built in FTP proxy function coded in
# the nat rules file to make this single rule function correctly.
# If you want to use the pkg_add command to install application packages
# on your gateway system you need this rule.
pass out quick on dc0 proto tcp from any to any port = 21 flags S keep state

# Allow out ssh/sftp/scp (telnet/rlogin/FTP replacements)
# This function is using SSH (secure shell)
pass out quick on dc0 proto tcp from any to any port = 22 flags S keep state

# Allow out insecure Telnet
pass out quick on dc0 proto tcp from any to any port = 23 flags S keep state

# Allow out FreeBSD CVSup
pass out quick on dc0 proto tcp from any to any port = 5999 flags S keep state

# Allow out ping to public Internet
pass out quick on dc0 proto icmp from any to any icmp-type 8 keep state

# Allow out whois from LAN to public Internet
pass out quick on dc0 proto tcp from any to any port = 43 flags S keep state

# Block and log only the first occurrence of everything
# else that's trying to get out.
# This rule implements the default block
block out log first quick on dc0 all

#################################################################
# Interface facing Public Internet (Inbound Section)
# Match packets originating from the public Internet
# destined for this gateway server or the private network.
#################################################################

# Block all inbound traffic from non-routable or reserved address spaces
block in quick on dc0 from 192.168.0.0/16 to any    #RFC 1918 private IP
block in quick on dc0 from 172.16.0.0/12 to any     #RFC 1918 private IP
block in quick on dc0 from 10.0.0.0/8 to any        #RFC 1918 private IP
block in quick on dc0 from 127.0.0.0/8 to any       #loopback
block in quick on dc0 from 0.0.0.0/8 to any         #loopback
block in quick on dc0 from 169.254.0.0/16 to any    #DHCP auto-config
block in quick on dc0 from 192.0.2.0/24 to any      #reserved for docs
block in quick on dc0 from 204.152.64.0/23 to any   #Sun cluster interconnect
block in quick on dc0 from 224.0.0.0/3 to any       #Class D &amp; E multicast

##### Block a bunch of different nasty things. ############
# That I do not want to see in the log

# Block frags
block in quick on dc0 all with frags

# Block short tcp packets
block in quick on dc0 proto tcp all with short

# block source routed packets
block in quick on dc0 all with opt lsrr
block in quick on dc0 all with opt ssrr

# Block nmap OS fingerprint attempts
# Log first occurrence of these so I can get their IP address
block in log first quick on dc0 proto tcp from any to any flags FUP

# Block anything with special options
block in quick on dc0 all with ipopts

# Block public pings
block in quick on dc0 proto icmp all icmp-type 8

# Block ident
block in quick on dc0 proto tcp from any to any port = 113

# Block all Netbios service. 137=name, 138=datagram, 139=session
# Netbios is MS/Windows sharing services.
# Block MS/Windows hosts2 name server requests 81
block in log first quick on dc0 proto tcp/udp from any to any port = 137
block in log first quick on dc0 proto tcp/udp from any to any port = 138
block in log first quick on dc0 proto tcp/udp from any to any port = 139
block in log first quick on dc0 proto tcp/udp from any to any port = 81

# Allow traffic in from ISP's DHCP server. This rule must contain
# the IP address of your ISP's DHCP server as it's the only
# authorized source to send this packet type. Only necessary for
# cable or DSL configurations. This rule is not needed for
# 'user ppp' type connection to the public Internet.
# This is the same IP address you captured and
# used in the outbound section.
pass in quick on dc0 proto udp from z.z.z.z to any port = 68 keep state

# Allow in standard www function because I have apache server
pass in quick on dc0 proto tcp from any to any port = 80 flags S keep state

# Allow in non-secure Telnet session from public Internet
# labeled non-secure because ID/PW passed over public Internet as clear text.
# Delete this sample group if you do not have telnet server enabled.
#pass in quick on dc0 proto tcp from any to any port = 23 flags S keep state

# Allow in secure FTP, Telnet, and SCP from public Internet
# This function is using SSH (secure shell)
pass in quick on dc0 proto tcp from any to any port = 22 flags S keep state

# Block and log only first occurrence of all remaining traffic
# coming into the firewall. The logging of only the first
# occurrence avoids filling up disk with Denial of Service logs.
# This rule implements the default block.
block in log first quick on dc0 all
################### End of rules file #####################################</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92335568"></a>31.5.14. <acronym class="acronym">NAT</acronym></h3></div></div></div><a id="idp92336336" class="indexterm"></a><a id="idp92336848" class="indexterm"></a><a id="idp92338000" class="indexterm"></a><p><acronym class="acronym">NAT</acronym> нь <span class="emphasis"><em>Network Address Translation</em></span> буюу
Сүлжээний хаягийн Хөрвүүлэлтийн товчлол юм. <span class="trademark">Linux</span>®-н талаар ойлголттой хүмүүсийн хувьд,
энэ ойлголтыг IP маскарад гэж нэрлэдэг; <acronym class="acronym">NAT</acronym> ба IP маскарад
нь нэг зүйл юм. IPF <acronym class="acronym">NAT</acronym>-н бидэнд олгож байгаа олон зүйлүүдийн нэг бол
галт ханын цаана байгаа Local Area Network буюу Ойрын Зайн Сүлжээ(LAN)-н хувьд
ISP-с оноож өгсөн ганц IP хаягийг Интернэтэд хуваан хэрэглэх юм.</p><p>Ингэх ямар шаардлага байнаа гэж та гайхан асуух байх.
ISP-ууд өөрийн ашгийн-бус хэрэглэгчиддээ ихэвчлэн динамик IP хаяг оноодог.
Динамик гэдэг нь таныг ISP руу залган нэвтрэн орох болгонд, кабель эсвэл
DSL модемтой хэрэглэгчдийн хувьд модемоо асааж унтраах болгонд
өөр өөр IP хаяг онооно гэсэн үг юм. Таны системийг Интернэтэд танихад
	энэ динамик IP хаягийг ашигладаг.</p><p>Та гэртээ таван PC-тэй бөгөөд бүгд Интернэт уруу гардаг байх хэрэгтэй гэж бодъё.
 Тэгвэл та PC тус бүрт тусад нь эрх худалдан авч, таван утасны үзүүртэй байх хэрэгтэй болно.</p><p><acronym class="acronym">NAT</acronym>-н тусламжтай ISP-гаас зөвхөн ганцхан эрх
	шаардлагатай. Бусад дөрвөн PC-гээ switch буюу шилжүүлэгч уруу холбож, харин switch-ээ таны LAN-нд гарц байдлаар ажиллах
FreeBSD системийн NIC руу залгана. <acronym class="acronym">NAT</acronym> нь LAN-д байгаа бүх PC-ны хувьд хувийн IP
хаягийг ганцхан гадаад IP хаяг уруу автоматаар хөрвүүлэх болно. <acronym class="acronym">NAT</acronym> нь эргэж
ирж байгаа пакетуудын хувьд эсрэг хөрвүүлэлтийг мөн хийнэ.</p><p><acronym class="acronym">NAT</acronym> хийгдсэн хувийн LAN-уудад зориулж бүлэг IP хаягийг тусгайлан
гаргасан байдаг. RFC 1918 стандартад зааснаар бол, дараах бүлэг IP-г хувийн сүлжээндээ ашиглах
боломжтой, эдгээр IP хэзээ ч гадаад Интернэт уруу гарахгүй болно:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /></colgroup><tbody><tr><td>Эхлэх IP <code class="systemitem">10.0.0.0</code></td><td>-</td><td>Төгсөх IP <code class="systemitem">10.255.255.255</code></td></tr><tr><td>Эхлэх IP <code class="systemitem">172.16.0.0</code></td><td>-</td><td>Төгсөх IP <code class="systemitem">172.31.255.255</code></td></tr><tr><td>Эхлэх IP <code class="systemitem">192.168.0.0</code></td><td>-</td><td>Төгсөх IP <code class="systemitem">192.168.255.255</code></td></tr></tbody></table></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92374864"></a>31.5.15. IP<acronym class="acronym">NAT</acronym></h3></div></div></div><a id="idp92375760" class="indexterm"></a><a id="idp92376912" class="indexterm"></a><p><acronym class="acronym">NAT</acronym> дүрмүүдийг <code class="command">ipnat</code> тушаалын
тусламжтай ачаална. Ихэвчлэн <acronym class="acronym">NAT</acronym> дүрмүүд <code class="filename">/etc/ipnat.rules</code>
файл дотор байрлана. Дэлгэрэнгүйг <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipnat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipnat</span>(8)</span></a> хэсгээс үзнэ үү.</p><p><acronym class="acronym">NAT</acronym> ажиллаж эхэлсний дараа <acronym class="acronym">NAT</acronym> дүрмүүдэд
өөрчлөлт оруулах шаардлагатай бол NAT дүрмүүд байгаа файл дотор өөрчлөлтийг хийсний дараа,
одоо хэрэглэгдэж байгаа <acronym class="acronym">NAT</acronym> дүрмүүдийг устгаж, хөрвүүлэгч хүснэгтийг цэвэрлэхийн
тулд <code class="command">ipnat</code> тушаалыг <code class="option">-CF</code> тугийн хамт ажиллуулах хэрэгтэй.</p><p>Харин <acronym class="acronym">NAT</acronym> дүрмүүдийг дахин ачаалахдаа тушаалыг
дараах байдалтай өгөх хэрэгтэй:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -CF -f /etc/ipnat.rules</code></strong></pre><p><acronym class="acronym">NAT</acronym>-н талаар зарим статистикийг харъя гэвэл дараах
тушаалыг ашиглана:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -s</code></strong></pre><p><acronym class="acronym">NAT</acronym> хүснэгтийн одоо ашиглаж байгаа оноолтын жагсаалтыг
харахын тулд дараах тушаалыг ашиглана:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -l</code></strong></pre><p>Вербос буюу хэр зэрэг харуулах горимыг нээхийн тулд, дүрэмтэй ажиллах болон идэвхтэй
байгаа дүрмүүдийн хүснэгтийг харахын тулд:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -v</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92388816"></a>31.5.16. IP<acronym class="acronym">NAT</acronym> Дүрмүүд</h3></div></div></div><p><acronym class="acronym">NAT</acronym> дүрмүүд нь маш уян хатан бөгөөд хэрэглэгчдийн
хэрэгцээг хангах олон зүйлүүдийг хийж чадна.</p><p>Энд үзүүлсэн дүрмийн синтаксыг ашгийн-бус орчинд ихэвчлэн хэрэглэгддэг
дүрмүүдэд зориулан хялбаршуулсан байгаа. Дүрмийн синтаксын бүрэн тайлбарыг <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipnat&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ipnat</span>(5)</span></a>
заавар хуудаснаас үзнэ үү.</p><p><acronym class="acronym">NAT</acronym> дүрмийн синтакс дараах байдалтай байна:</p><pre class="programlisting">map <em class="replaceable"><code>IF</code></em> <em class="replaceable"><code>LAN_IP_RANGE</code></em> -&gt; <em class="replaceable"><code>PUBLIC_ADDRESS</code></em></pre><p>Дүрэм нь <code class="literal">map</code> гэсэн түлхүүр үгээр эхэлнэ.</p><p><em class="replaceable"><code>IF</code></em>-г гадаад интерфэйсээр сольж тавьна.</p><p><em class="replaceable"><code>LAN_IP_RANGE</code></em> нь танай дотоод хэрэглэгчийн
хэрэглэж буй IP хаяглалтыг заана, ихэвчлэн <code class="systemitem">192.168.1.0/24</code>
гэсэн маягтай байна.</p><p><em class="replaceable"><code>PUBLIC_ADDRESS</code></em> нь гадаад IP
байж болно эсвэл <em class="replaceable"><code>IF</code></em>-д оноосон IP хаягийг
хэрэглэхийг заасан <code class="literal">0/32</code> гэсэн тусгай түлхүүр үг байж болно.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92402000"></a>31.5.17. <acronym class="acronym">NAT</acronym> хэрхэн ажилладаг вэ</h3></div></div></div><p>Гадаад очих хаягтай пакет галт хана дээр LAN-с хүрэлцэн ирнэ.
Эхлээд гадагшаа шүүлтийн дүрмүүдээр гарна, дараа нь <acronym class="acronym">NAT</acronym>-н
ээлж ирэх ба өөрийн дүрмүүдийг дээрээс доош шалгаж эхэлнэ. Хамгийн эхэнд тохирсон нь
дийлнэ. <acronym class="acronym">NAT</acronym> өөрийн дүрэм бүрийг пакетийн интерфэйсийн нэр болон
эхлэл хаягаар тулгаж шалгана. Пакетийн интерфэйсийн нэр <acronym class="acronym">NAT</acronym>
дүрэмтэй тохирвол пакетийн эхлэл IP хаяг (өөрөөр хэлбэл хувийн LAN IP хаяг)
<acronym class="acronym">NAT</acronym> дүрмийн сумны зүүн талд зааж өгсөн
IP хаягийн зурвас дотор байгаа эсэхийг шалгана. Хэрэв энэ тохирвол
пакетийн эхлэл хаягийг <code class="literal">0/32</code> түлхүүр үгийн тусламжтай
олж авсан гадаад IP хаягаар сольж бичнэ. <acronym class="acronym">NAT</acronym>
өөрийн дотоод <acronym class="acronym">NAT</acronym> хүснэгтэнд бичлэг нэмэх ба энэ нь
пакет Интернэтээс буцаж ирэхэд түүнийг буцаан хувийн IP хаяг уруу нь хөрвүүлэн,
цааш шүүлтийн дүрмүүдээр оруулах боломжийг олгоно.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92406096"></a>31.5.18. IP<acronym class="acronym">NAT</acronym>-г идэвхжүүлэх</h3></div></div></div><p>IP<acronym class="acronym">NAT</acronym>-г идэвхжүүлэхийн тулд эдгээр илэрхийллүүдийг
<code class="filename">/etc/rc.conf</code> дотор нэмж бичнэ.</p><p>Өөрийн машиныг интерфэйсүүдийн хооронд пакетуудыг чиглүүлдэг
болгохын тулд:</p><pre class="programlisting">gateway_enable="YES"</pre><p>Систем ачаалахад IP<acronym class="acronym">NAT</acronym>-г автоматаар ачаалдаг
болгохын тулд:</p><pre class="programlisting">ipnat_enable="YES"</pre><p>IP<acronym class="acronym">NAT</acronym>-н дүрмүүдийг хаанаас ачаалахыг зааж өгөхдөө:</p><pre class="programlisting">ipnat_rules="/etc/ipnat.rules"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92415696"></a>31.5.19. Маш том LAN-д зориулсан <acronym class="acronym">NAT</acronym></h3></div></div></div><p>LAN-даа олон тооны PC-тэй сүлжээний хувьд эсвэл нэгээс олон
LAN-тай сүлжээний хувьд, энэ олон хувийн IP хаягуудыг нэг гадаад IP хаяг уруу
нийлүүлэх үйл явцад <acronym class="acronym">NAT</acronym> хийгдсэн олон LAN PC дээр ижил портын
дугаар олон дахин хэрэглэгдсэнээс мөргөлдөөн үүсэх гэх мэт нөөцтэй холбоотой асуудал гардаг.
Нөөцтэй холбоотой энэ асуудлаас гарахын тулд дараах хоёр арга зам байдаг.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92417360"></a>31.5.19.1. Хэрэглэх портуудыг оноох</h4></div></div></div><p>Энгийн NAT дүрэм дараах байдалтай байна:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 0/32</pre><p>Дээрх дүрмэнд пакет IP<acronym class="acronym">NAT</acronym>-р дайрч өнгөрөхөд
пакетийн эхлэл порт өөрчлөгдөхгүй. <code class="literal">portmap</code> гэсэн түлхүүр үгийг нэмсэнээр
	  IP<acronym class="acronym">NAT</acronym>-ийг заасан зурвас дахь зөвхөн эхлэл портуудыг ашиглахаар зааж өгнө.
Жишээ нь, дараах дүрэм IP<acronym class="acronym">NAT</acronym>-г эхлэл порт хаягийг
тухайн зурвас дотор байхаар өөрчлөхийг зааж өгч байна.</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp 20000:60000</pre><p>Дээр нь бид <code class="literal">auto</code> түлхүүр үгийн тусламжтай
аль портуудыг ашиглах боломжтой байгааг өөрөө тодорхойлохыг зааж өгч болно:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp auto</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92423120"></a>31.5.19.2. Гадаад хаягийн цөөрмийг хэрэглэх</h4></div></div></div><p>Маш том LAN-уудын хувьд дэндүү олон LAN хаягуудыг нэг гадаад
хаягт оноох нь боломжгүй болох үе ирдэг. Хэрэв бүлэг гадаад IP сул байгаа бол,
эдгээр IP хаягуудыг <span class="quote">«<span class="quote">цөөрөм</span>»</span> байдлаар ашиглаж болох ба,
IP<acronym class="acronym">NAT</acronym> эдгээрээс нэгийг сонгон авч гадагшаа явж байгаа
пакетийн хаягт оноох байдлаар хэрэглэх болно.</p><p>Жишээ нь, доор үзүүлсэн шиг бүх пакетуудыг ганц
гадаад IP-д оноохын оронд:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 204.134.75.1</pre><p>гадаад IP хаягийн зурвасыг сүлжээний хуваалтын хамт зааж өгч болно:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 204.134.75.0/255.255.255.0</pre><p>эсвэл CIDR тэмдэглэгээг хэрэглэж болно:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 204.134.75.0/24</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92452304"></a>31.5.20. Портын дахин чиглүүлэлт</h3></div></div></div><p>LAN дотор вэб сервер, цахим шуудангийн сервер, өгөгдлийн
сангийн сервер болон DNS серверийг өөр өөр PC дээр тараан ажиллуулах нь
түгээмэл байдаг. Энэ тохиолдолд эдгээр серверээс гарч байгаа урсгал
мөн <acronym class="acronym">NAT</acronym> хийгдсэн байх ёстой. Гэхдээ гаднаас ирж буй
урсгалыг зөв LAN PC уруу дахин чиглүүлэх арга зам байх хэрэгтэй болно.
Энэ асуудлыг шийдэхийн тулд IP<acronym class="acronym">NAT</acronym> нь дахин чиглүүлэлт хийх
<acronym class="acronym">NAT</acronym> нэмэлт боломжийг олгодог. Вэб сервер
<code class="systemitem">10.0.10.25</code> гэсэн LAN хаягтай бөгөөд
<code class="systemitem">20.20.20.5</code> гэсэн ганц гадаад IP-тай
байлаа гэж бодъё. Тэгвэл дүрмийг дараах байдалтай:</p><pre class="programlisting">rdr dc0 20.20.20.5/32 port 80 -&gt; 10.0.10.25 port 80</pre><p>эсвэл:</p><pre class="programlisting">rdr dc0 0.0.0.0/0 port 80 -&gt; 10.0.10.25 port 80</pre><p>эсвэл гаднаас DNS хүсэлтүүд хүлээн авдаг
<code class="systemitem">10.0.10.33</code> гэсэн хаягтай LAN DNS Серверийн хувьд:</p><pre class="programlisting">rdr dc0 20.20.20.5/32 port 53 -&gt; 10.0.10.33 port 53 udp</pre><p>гэж бичих байсан.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92458448"></a>31.5.21. FTP ба <acronym class="acronym">NAT</acronym></h3></div></div></div><p>FTP-г Интернэт одоогийнх шиг байхаас өмнөх үе, их сургуулиуд
түрээсийн шугамаар хоорондоо холбогдож, судлаач эрдэмтэд хоорондоо файл солилцохын тулд
FTP-г ашигладаг байх үес үлдсэн үлэг гүрвэл гэж хэлж болох юм. Тэр үед
өгөгдлийн аюулгүй байдлын талаар огт анхаардаггүй байлаа. Цаг хугацаа өнгөрөхөд
FTP протоколыг шинээр гарч ирж байгаа Интернэтийн гол нуруу сүлжээнд хэрэглэх болсон ба
түүний хэрэглэгчийн нэр, нууц үгийг цэвэр текст хэлбэрээр дамжуулдаг байдал нь
хэзээ ч өөрчлөгдөөгүй бөгөөд орчин үеийн аюулгүй байдлын шаардлагад
нийцэхгүй болсон билээ. FTP нь active буюу идэвхтэй, passive буюу идэвхгүй гэсэн хоёр
горимд ажилладаг. Өгөгдлийн сувгийг хэрхэн ашиглаж байгаа дээр гол ялгаа нь гардаг.
Өгөгдлийн сувгийг эхэлж ftp сесс хүсэгч нь авдаг тул идэвхгүй горимд ажиллах
нь аюулгүй байдлыг илүүтэйгээр хангана. FTP-н талаар илүү сайн тайлбарыг болон түүний
горимуудын талаар <code class="uri"><a class="uri" href="http://www.slacksite.com/other/ftp.html" target="_top">http://www.slacksite.com/other/ftp.html</a></code> хаягаар үзнэ үү.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92464464"></a>31.5.21.1. IP<acronym class="acronym">NAT</acronym> Дүрмүүд</h4></div></div></div><p>IP<acronym class="acronym">NAT</acronym> нь дотроо <acronym class="acronym">NAT</acronym>
оноолт дүрэмд тодорхойлж өгөх боломжтой тусгай FTP прокси тохируулгыг
агуулсан байдаг. Энэ нь идэвхтэй болон идэвхгүй FTP сесс эхлүүлэх хүсэлтэд
оролцож байгаа бүх гадагшаа чиглэлтэй FTP пакетийг хянаж чадна. Мөн
өгөгдлийн сувагт үнэхээр хэрэглэгдэж байгаа порт дугаарыг агуулсан түр зуурын
шүүлтийн дүрмүүдийг динамикаар үүсгэж чадна. Ийм байдлаар FTP-с болж үүсдэг
дээд хэсгийн портуудыг өргөн зурвасаар нээх эрсдэлээс галт ханыг хамгаалж байгаа юм.</p><p>Доорх дүрэм нь дотоод LAN-н бүх урсгалыг зохицуулна:</p><pre class="programlisting">map dc0 10.0.10.0/29 -&gt; 0/32 proxy port 21 ftp/tcp</pre><p>Доорх дүрэм гарцаас ирж буй FTP урсгалыг зохицуулна:</p><pre class="programlisting">map dc0 0.0.0.0/0 -&gt; 0/32 proxy port 21 ftp/tcp</pre><p>Доорх дүрэм дотоод LAN-с ирж буй бүх FTP-н биш урсгалыг зохицуулна:</p><pre class="programlisting">map dc0 10.0.10.0/29 -&gt; 0/32</pre><p>FTP оноолтын дүрэм нь бидний ердийн оноолтын дүрмүүдийн өмнө бичигдэнэ.
Бүх пакетийг хамгийн дээр бичигдсэн дүрмээс эхлэн шалгана.
Интерфэйсийн нэр тохирвол дотоод LAN эхлэл IP хаяг, дараа нь FTP пакет эсэхийг
шалгана. Хэрэв бүгд тохирвол, тусгай FTP прокси эдгээр FTP сесс пакетуудыг
<acronym class="acronym">NAT</acronym> хийхээс гадна гадагш нь болон дотогш нь нэвтрүүлэх
түр зуурын шүүлтийн дүрмийг үүсгэнэ. FTP-н биш бусад бүх LAN пакетууд эхний
дүрмэнд тохирохгүй тул гуравдугаар дүрэм уруу шилжин дахин шалгагдана. Интерфэйс болон
эхлэл IP тохирох тул <acronym class="acronym">NAT</acronym> хийгдэнэ.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92470352"></a>31.5.21.2. IP<acronym class="acronym">NAT</acronym> FTP Шүүлтийн Дүрмүүд</h4></div></div></div><p><acronym class="acronym">NAT</acronym> FTP прокси ашиглаж байгаа тохиолдолд
FTP-н хувьд ганцхан шүүлтийн дүрэм хэрэгтэй.</p><p>FTP Прокси байхгүй бол дараах гурван дүрмийг хэрэглэнэ:</p><pre class="programlisting"># Allow out LAN PC client FTP to public Internet
# Active and passive modes
pass out quick on rl0 proto tcp from any to any port = 21 flags S keep state

# Allow out passive mode data channel high order port numbers
pass out quick on rl0 proto tcp from any to any port &gt; 1024 flags S keep state

# Active mode let data channel in from FTP server
pass in quick on rl0 proto tcp from any to any port = 20 flags S keep state</pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="firewalls-pf.html">Өмнөх</a> </td><td width="20%" align="center"><a accesskey="u" href="firewalls.html">Дээш</a></td><td width="40%" align="right"> <a accesskey="n" href="firewalls-ipfw.html">Дараах</a></td></tr><tr><td width="40%" align="left" valign="top">31.4. OpenBSD Пакет шүүгч (PF) ба
      <acronym class="acronym">ALTQ</acronym> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Эхлэл</a></td><td width="40%" align="right" valign="top"> 31.6. IPFW</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Энэ болон бусад баримтуудыг
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    хаягаас татаж авч болно.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD-ийн талаар
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;
    хаягтай холбоо барихаасаа өмнө
    <a href="http://www.FreeBSD.org/docs.html">баримтыг</a> уншина уу.<br></br>
    Энэ бичиг баримттай холбоотой асуулт байвал
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;
    хаягаар цахим захидал явуулна уу.<br></br>
    Энэ бичиг баримтын орчуулгатай холбоотой асуулт байвал
    &lt;<a href="mailto:admin@mnbsd.org">admin@mnbsd.org</a>&gt;
    хаягаар цахим захидал явуулна уу.</small></p></body></html>