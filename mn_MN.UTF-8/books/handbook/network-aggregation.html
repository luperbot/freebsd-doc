<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>32.6. Холбоос нэгтгэлт ба ослыг тойрон гарах (Link Aggregation and Failover)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD гарын авлага" /><link rel="up" href="advanced-networking.html" title="Бүлэг 32. Сүлжээний нэмэлт ойлголтууд" /><link rel="prev" href="network-bridging.html" title="32.5. Гүүр" /><link rel="next" href="network-diskless.html" title="32.7. Дискгүй ажиллагаа" /><link rel="copyright" href="legalnotice.html" title="Хуулийн заалт" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">32.6. Холбоос нэгтгэлт ба ослыг тойрон гарах (Link Aggregation and Failover)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-bridging.html">Өмнөх</a> </td><th width="60%" align="center">Бүлэг 32. Сүлжээний нэмэлт ойлголтууд</th><td width="20%" align="right"> <a accesskey="n" href="network-diskless.html">Дараах</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-aggregation"></a>32.6. Холбоос нэгтгэлт ба ослыг тойрон гарах (Link Aggregation and Failover)</h2></div><div><span class="authorgroup">Бичсэн <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Эндрю</span> <span class="surname">Томпсон</span></span>. </span></div></div></div><a id="idp93923280" class="indexterm"></a><a id="idp93923792" class="indexterm"></a><a id="idp93924304" class="indexterm"></a><a id="idp93924816" class="indexterm"></a><a id="idp93925328" class="indexterm"></a><a id="idp93925968" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93926480"></a>32.6.1. Танилцуулга</h3></div></div></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> интерфэйс нь fault-tolerance буюу
	алдаанд тэсвэртэй байдал болон өндөр хурдны холбоосуудыг
	хангах зорилгоор сүлжээний олон интерфэйсүүдийг нэг виртуал интерфэйс
	болгон нэгтгэх боломжийг олгодог.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93928272"></a>32.6.2. Ажиллагааны горимууд</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Failover</span></dt><dd><p>Зөвхөн мастер портоор урсгалыг илгээж хүлээн авна. Хэрэв
	  мастер порт байхгүй болвол дараагийн идэвхтэй порт ашиглагдана.
	  Эхний нэмэгдсэн интерфэйс нь мастер порт болох бөгөөд үүний дараа
	  нэмэгдсэнүүд нь ослыг тойрон гарах төхөөрөмжүүд болон ашиглагдах
	  болно. Хэрэв мастер биш порт дээр тойрон гарах үйлдэл хийгдвэл
	  анхдагч порт дахин боломжтой болонгуутаа мастер порт болдог.</p></dd><dt><span class="term"><span class="trademark">Cisco</span>® Fast <span class="trademark">EtherChannel</span>®</span></dt><dd><p><span class="trademark">Cisco</span>® Fast <span class="trademark">EtherChannel</span>® (FEC) нь статик тохируулга
	  бөгөөд нөгөө талтайгаа нэгтгэлт хийхэд тохиролцдоггүй эсвэл
	  холбоосыг монитор хийхийн тулд хүрээнүүд солилцдоггүй. Хэрэв шилжүүлэгч
	  LACP-г дэмждэг бол түүнийг ашиглах ёстой.</p><p><acronym class="acronym">FEC</acronym> нь хэш хийгдсэн протоколын толгойн мэдээлэл дээр үндэслэн
	  идэвхтэй портуудаар гарч байгаа урсгалыг тэнцвэржүүлж дурын идэвхтэй
	  портоос ирж байгаа урсгалыг хүлээн авна. Хэш нь Ethernet эхлэл болон
	  очих хаяг ба хэрэв байгаа бол VLAN хаяг болон IPv4/IPv6 эхлэл болон
	  очих хаягийг багтаадаг.</p></dd><dt><span class="term">LACP</span></dt><dd><p><span class="trademark">IEEE</span>® 802.3ad Link Aggregation Control Protocol
	  (LACP) буюу Холбоос Нэгтгэлт Хянах Протокол болон Marker буюу
	  Тэмдэглэгээний Протокол. LACP нь нэгтгэж болох холбоосуудыг
	  нөгөө талтай нь нэг буюу хэд хэдэн Link Aggregated
	  Group буюу Холбоос Нэгтгэгдсэн бүлгүүд (LAG) болгон
	  тохиролцуулдаг. LAG бүр нь адил хурдтай, гүйцэд дуплекс
	  ажиллагаанд тохируулсан портуудаас тогтоно. Урсгал нь
	  LAG дахь портуудын дагуу хамгийн их нийт хурдаар тэнцвэржүүлэгдэх
	  бөгөөд ихэнх тохиолдолд бүх портуудыг агуулсан зөвхөн нэг LAG байх
	  болно. Физик холболт өөрчлөгдөхөд Холбоос Нэгтгэлт шинэ тохиргоо
	  уруу хурдан шилжих болно.</p><p><acronym class="acronym">LACP</acronym> нь хэш хийгдсэн протоколын толгойн мэдээлэл дээр үндэслэн
	  идэвхтэй портуудаар гарч байгаа урсгалыг тэнцвэржүүлж дурын идэвхтэй
	  портоос ирж байгаа урсгалыг хүлээн авна. Хэш нь Ethernet эхлэл болон
	  очих хаяг ба хэрэв байгаа бол VLAN хаяг болон IPv4/IPv6 эхлэл болон
	  очих хаягийг багтаадаг.</p></dd><dt><span class="term">Loadbalance</span></dt><dd><p>Энэ нь <span class="emphasis"><em>FEC</em></span> горимын хуулбар юм.</p></dd><dt><span class="term">Round-robin</span></dt><dd><p>Тойрон эргэх хуваарилалтыг ашиглан гарч байгаа урсгалыг
	  бүх идэвхтэй портуудаар тарааж дурын идэвхтэй портоос ирж
	  байгаа урсгалыг хүлээн авна. Энэ горим нь Ethernet хүрээний
	  дарааллыг зөрчих бөгөөд болгоомжтой ашиглах шаардлагатай байдаг.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93948496"></a>32.6.3. Жишээнүүд</h3></div></div></div><div class="example"><a id="networking-lacp-aggregation-cisco"></a><div class="example-title">Жишээ 32.1. <span class="trademark">Cisco</span>® шилжүүлэгчтэй LACP нэгтгэлт</div><div class="example-contents"><p>Энэ жишээ нь FreeBSD машины хоёр интерфэйсийг шилжүүлэгч рүү
	  ачаалал тэнцвэржүүлсэн, алдаанд тэсвэртэй ганц холбоосоор холбож
	  байна. Дамжуулах чанар болон алдаанд тэсвэртэй байдлыг сайжруулах
	  зорилгоор илүү олон интерфэйсүүдийг нэмж болно. Ethernet холбоосууд
	  дээр хүрээний дараалал чухал байдаг учраас хоёр станцын хоорондох
	  ямар ч урсгал аль нэг интерфэйсийн хамгийн их хурдаар хязгаарлагдан
	  тэр физик холбоосоор үргэлж урсаж байдаг. Дамжуулах алгоритм нь
	  өөр өөр урсгалуудыг ялгаж, байгаа интерфэйсүүдээр тэдгээрийг
	  тэнцвэржүүлэхийн тулд аль болох их мэдээллийг ашиглахыг оролддог.</p><p><span class="trademark">Cisco</span>® шилжүүлэгч дээр <em class="replaceable"><code>FastEthernet0/1</code></em> болон
	  <em class="replaceable"><code>FastEthernet0/2</code></em> интерфэйсүүдийг
	  <em class="replaceable"><code>1</code></em> сувгийн бүлэгт нэмнэ.</p><pre class="screen"><strong class="userinput"><code>interface FastEthernet0/1
channel-group 1 mode active
channel-protocol lacp</code></strong>
!
<strong class="userinput"><code>interface FastEthernet0/2
 channel-group 1 mode active
 channel-protocol lacp</code></strong></pre><p><em class="replaceable"><code>fxp0</code></em> болон
          <em class="replaceable"><code>fxp1</code></em>-г ашиглан <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a>
	  интерфэйсийг үүсгээд <em class="replaceable"><code>10.0.0.3/24</code></em> гэсэн
	  IP хаяг тавьж интерфэйсийг босгоно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp0 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp1 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 create </code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 up laggproto lacp laggport fxp0 laggport fxp1 10.0.0.3/24</code></strong></pre><p>Доорх тушаалыг ажиллуулж интерфэйсийн төлвийг харна:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0</code></strong></pre><p><span class="emphasis"><em>ACTIVE</em></span> гэж тэмдэглэгдсэн портууд нь
	  алсын шилжүүлэгчтэй тохиролцсон, идэвхтэй нэгтгэлтийн бүлгийн хэсэг бөгөөд
	  урсгал нь дамжуулагдаж хүлээн авагдах болно. LAG таних тэмдгүүдийг
	  үзэхийн тулд <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>-ийн дэлгэрэнгүй гаралтыг ашиглаарай.</p><pre class="screen">lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
	inet 10.0.0.15 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet autoselect
        status: active
        laggproto lacp
        laggport: fxp1 flags=1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;
        laggport: fxp0 flags=1c&lt;ACTIVE,COLLECTING,DISTRIBUTING&gt;</pre><p>Шилжүүлэгч дээр портын төлвийг харахын тулд
	  <strong class="userinput"><code>show lacp neighbor</code></strong>
	  тушаалыг ашиглах хэрэгтэй.</p><pre class="screen">switch# show lacp neighbor
Flags:  S - Device is requesting Slow LACPDUs
        F - Device is requesting Fast LACPDUs
        A - Device is in Active mode       P - Device is in Passive mode

Channel group 1 neighbors

Partner's information:

                  LACP port                        Oper    Port     Port
Port      Flags   Priority  Dev ID         Age     Key     Number   State
Fa0/1     SA      32768     0005.5d71.8db8  29s    0x146   0x3      0x3D
Fa0/2     SA      32768     0005.5d71.8db8  29s    0x146   0x4      0x3D</pre><p>Дэлгэрэнгүйг харахыг хүсвэл <strong class="userinput"><code>show lacp neighbor
          detail</code></strong> тушаалыг ашиглана.</p></div></div><br class="example-break" /><div class="example"><a id="networking-lagg-failover"></a><div class="example-title">Жишээ 32.2. Failover горим</div><div class="example-contents"><p>Failover буюу ослыг тойрон гарах горимыг мастер интерфэйс дээр
	  холбоос тасарсан тохиолдолд хоёр дахь интерфэйс уруу шилжихэд
	  ашиглаж болно. <em class="replaceable"><code>fxp0</code></em> нь мастер интерфэйс,
	  <em class="replaceable"><code>fxp1</code></em> нь хоёр дахь интерфэйс байхаар
	  <em class="replaceable"><code>lagg0</code></em> интерфэйсийг үүсгэж тохируулна:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 up laggproto failover laggport fxp0 laggport fxp1</code></strong></pre><p>Интерфэйс нь үүнтэй төстэй байх бөгөөд гол ялгаа нь
	  <acronym class="acronym">MAC</acronym> хаяг болон төхөөрөмжийн нэрс байх
	  болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0</code></strong>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:05:5d:71:8d:b8
        media: Ethernet autoselect
        status: active
        laggproto failover
        laggport: fxp1 flags=0&lt;&gt;
        laggport: fxp0 flags=5&lt;MASTER,ACTIVE&gt;</pre><p>Урсгал <em class="replaceable"><code>fxp0</code></em> дээр хүлээн
	  авагдаж дамжих болно. Хэрэв холбоос <em class="replaceable"><code>fxp0</code></em> дээр
	  тасарсан бол <em class="replaceable"><code>fxp1</code></em> нь идэвхтэй холбоос
	  болно. Хэрэв холбоос нь мастер интерфэйс дээр сэргээгдсэн бол энэ нь
	  эргээд идэвхтэй холбоос болно.</p><p>Дахин ачаалахад энэ тохиргоог хэвээр байлгахын тулд
	  дараах мөрүүдийг <code class="filename">/etc/rc.conf</code> файлд
	  нэмж өгнө:</p><pre class="programlisting">ifconfig_<em class="replaceable"><code>fxp0</code></em>="up"
ifconfig_<em class="replaceable"><code>fxp1</code></em>="up"
cloned_interfaces="<code class="literal">lagg0</code>"
ifconfig_<code class="literal">lagg0</code>="laggproto failover laggport <em class="replaceable"><code>fxp0</code></em> laggport <em class="replaceable"><code>fxp1</code></em> <em class="replaceable"><code>10.0.0.15/24</code></em>"</pre></div></div><br class="example-break" /><div class="example"><a id="networking-lagg-wired-and-wireless"></a><div class="example-title">Жишээ 32.3. Утастай болон утасгүй сүлжээний интерфэйсүүдийн хоорондох Failover горим</div><div class="example-contents"><p>Зөөврийн компьютертай хэрэглэгчдийн хувьд утастай сүлжээний
	  холболт байхгүй болсон үед ашиглахаар утасгүй сүлжээний
	  интерфэйсийг хоёр дахь интерфэйс болгох нь зүйтэй байдаг.
	  Өгөгдлийг утасгүй холболтоор дамжуулах боломжийг хангахын хажуугаар
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a>-ийн тусламжтайгаар нэг IP хаяг ашиглах, ажиллагаа болон
	  аюулгүй байдлаас болоод утастай холболтыг илүүд үзэх боломжтой
	  юм.</p><p>Энэ тохиргоонд утасгүй сүлжээний <acronym class="acronym">MAC</acronym>
	  хаягийг ашиглагдаж байгаа мастер интерфэйс болох утастай сүлжээний
	  интерфэйсээс авсан  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a>-ийн хаягтай адилаар тавих
	  хэрэгтэй.</p><p>Энэ тохиргоонд утастай сүлжээний интерфэйс
	  <em class="replaceable"><code>bge0</code></em>-ийг мастер, утасгүй сүлжээний
	  интерфэйс <em class="replaceable"><code>wlan0</code></em>-ийг failover интерфэйс
	  гэж авч үзнэ. <em class="replaceable"><code>wlan0</code></em>-ийг
	  <em class="replaceable"><code>iwn0</code></em>-ээс үүсгэсэн бөгөөд бид үүнд
	  утастай сүлжээний холболтын <acronym class="acronym">MAC</acronym> хаяг зааж
	  өгөх болно. Эхний алхам бол <acronym class="acronym">MAC</acronym> хаягийг
	  утастай сүлжээний интерфэйсээс авах явдал юм:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bge0</code></strong>
bge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
	options=19b&lt;RXCSUM,TXCSUM,VLAN_MTU,VLAN_HWTAGGING,VLAN_HWCSUM,TSO4&gt;
	ether 00:21:70:da:ae:37
	inet6 fe80::221:70ff:feda:ae37%bge0 prefixlen 64 scopeid 0x2
	nd6 options=29&lt;PERFORMNUD,IFDISABLED,AUTO_LINKLOCAL&gt;
	media: Ethernet autoselect (1000baseT &lt;full-duplex&gt;)
	status: active</pre><p>Та <em class="replaceable"><code>bge0</code></em>-ийг өөрт байгаагаар
	  солих хэрэгтэй бөгөөд ингэхэд таны утастай сүлжээний интерфэйсийн
	  <acronym class="acronym">MAC</acronym> хаяг бүхий өөр <code class="literal">ether</code>
	  хаягийг авах болно. Одоо утасгүй сүлжээний интерфэйс
	  <em class="replaceable"><code>iwn0</code></em>-ийг солино:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig iwn0 ether 00:21:70:da:ae:37</code></strong></pre><p>Утасгүй сүлжээний интерфэйсийг босгоно, гэхдээ ямар ч IP хаяг
	  тавих хэрэггүй:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig wlan0 create wlandev iwn0 ssid my_router up</code></strong></pre><p><em class="replaceable"><code>bge0</code></em> интерфэйсийг босгоно.
	  <em class="replaceable"><code>bge0</code></em>-ийг мастер маягаар
	  ашиглан хэрэв шаардлагатай бол
	  <em class="replaceable"><code>wlan0</code></em> руу failover хийх боломжтойгоор
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lagg&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">lagg</span>(4)</span></a> интерфэйс үүсгэнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bge0 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0 up laggproto failover laggport bge0 laggport wlan0</code></strong></pre><p>Интерфэйс нь үүнтэй төстэй байх бөгөөд гол ялгаа нь
	  <acronym class="acronym">MAC</acronym> хаяг ба төхөөрөмжийн нэрс байх
	  болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig lagg0</code></strong>
lagg0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        options=8&lt;VLAN_MTU&gt;
        ether 00:21:70:da:ae:37
        media: Ethernet autoselect
        status: active
        laggproto failover
        laggport: wlan0 flags=0&lt;&gt;
        laggport: bge0 flags=5&lt;MASTER,ACTIVE&gt;</pre><p>Дараа нь IP хаяг авахын тулд DHCP клиентийг эхлүүлнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dhclient lagg0</code></strong></pre><p>Дахин ачаалахад энэ тохиргоог хэвээр байлгахын тулд
	  дараах мөрүүдийг <code class="filename">/etc/rc.conf</code> файлд
	  нэмж өгнө:</p><pre class="programlisting">ifconfig_bge0="up"
ifconfig_iwn0="ether 00:21:70:da:ae:37"
wlans_iwn0="wlan0"
ifconfig_wlan0="WPA"
cloned_interfaces="<code class="literal">lagg0</code>"
ifconfig_<code class="literal">lagg0</code>="laggproto failover laggport bge0 laggport wlan0 DHCP"</pre></div></div><br class="example-break" /></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-bridging.html">Өмнөх</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Дээш</a></td><td width="40%" align="right"> <a accesskey="n" href="network-diskless.html">Дараах</a></td></tr><tr><td width="40%" align="left" valign="top">32.5. Гүүр </td><td width="20%" align="center"><a accesskey="h" href="index.html">Эхлэл</a></td><td width="40%" align="right" valign="top"> 32.7. Дискгүй ажиллагаа</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Энэ болон бусад баримтуудыг
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    хаягаас татаж авч болно.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD-ийн талаар
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;
    хаягтай холбоо барихаасаа өмнө
    <a href="http://www.FreeBSD.org/docs.html">баримтыг</a> уншина уу.<br></br>
    Энэ бичиг баримттай холбоотой асуулт байвал
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;
    хаягаар цахим захидал явуулна уу.<br></br>
    Энэ бичиг баримтын орчуулгатай холбоотой асуулт байвал
    &lt;<a href="mailto:admin@mnbsd.org">admin@mnbsd.org</a>&gt;
    хаягаар цахим захидал явуулна уу.</small></p></body></html>