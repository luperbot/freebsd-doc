<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>32.5. Гүүр</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD гарын авлага" /><link rel="up" href="advanced-networking.html" title="Бүлэг 32. Сүлжээний нэмэлт ойлголтууд" /><link rel="prev" href="network-bluetooth.html" title="32.4. Bluetooth" /><link rel="next" href="network-aggregation.html" title="32.6. Холбоос нэгтгэлт ба ослыг тойрон гарах (Link Aggregation and Failover)" /><link rel="copyright" href="legalnotice.html" title="Хуулийн заалт" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">32.5. Гүүр</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-bluetooth.html">Өмнөх</a> </td><th width="60%" align="center">Бүлэг 32. Сүлжээний нэмэлт ойлголтууд</th><td width="20%" align="right"> <a accesskey="n" href="network-aggregation.html">Дараах</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-bridging"></a>32.5. Гүүр</h2></div><div><span class="authorgroup">Бичсэн <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Эндрю</span> <span class="surname">Томпсон</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93802448"></a>32.5.1. Танилцуулга</h3></div></div></div><a id="idp93803088" class="indexterm"></a><a id="idp93803600" class="indexterm"></a><p>Заримдаа нэг физик сүлжээг (Ethernet сегмент зэрэг)
	IP дэд сүлжээнүүд үүсгэж сегментүүдийг хооронд нь чиглүүлэгчээр
	цугт нь холбож ашиглалгүйгээр хоёр тусдаа сүлжээний сегмент болгох нь ашигтай
	байдаг. Ийм маягаар хоёр сүлжээг хооронд нь холбодог төхөөрөмжийг
	<span class="quote">«<span class="quote">bridge</span>»</span> буюу <span class="quote">«<span class="quote">гүүр</span>»</span> гэдэг.
	Хоёр сүлжээний интерфэйс карттай FreeBSD систем гүүр маягаар ажиллаж
	чаддаг.</p><p>Гүүр нь өөрийн сүлжээний интерфэйс бүрийн төхөөрөмжийн MAC давхаргын
	хаягуудыг (Ethernet хаягууд) сурч ажилладаг. Түүний эх болон төгсгөл нь
	зөвхөн өөр өөр сүлжээнд байгаа тохиолдолд хоёр сүлжээний хооронд
	урсгалыг дамжуулдаг.</p><p>Олон талаараа гүүр нь маш цөөн порттой Ethernet шилжүүлэгчтэй адил
	юм.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93806288"></a>32.5.2. Гүүр хийхэд тохирох тохиолдлууд</h3></div></div></div><p>Өнөөдөр гүүр ашиглагддаг олон нийтлэг тохиолдол байдаг.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93807440"></a>32.5.2.1. Сүлжээнүүдийг холбох нь</h4></div></div></div><p>Гүүрний үндсэн үйлдэл нь хоёр буюу түүнээс олон
	  сүлжээний сегментүүдийг хооронд нь холбох явдал юм.
	  Кабелийн хязгаарлалт, галт хана хийх эсвэл виртуал машины
	  интерфэйс зэрэг псевдо сүлжээнүүдийг холбох зэрэг сүлжээний
	  энгийн төхөөрөмжийн оронд хост дээр тулгуурласан гүүрийг ашиглах
	  шалтгаан олон байдаг. Гүүр нь бас hostap горимд ажиллаж байгаа
	  утасгүй сүлжээний интерфэйсийг утастай сүлжээ рүү холбож
	  хандалтын цэг маягаар ажиллах чадвартай.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93808592"></a>32.5.2.2. Шүүх/урсгал хэлбэржүүлэх галт хана</h4></div></div></div><a id="idp93809232" class="indexterm"></a><a id="idp93809744" class="indexterm"></a><p>Нийтлэг тохиолдол бол чиглүүлэлт юм уу эсвэл сүлжээний хаягийн хөрвүүлэлтгүй (NAT)
	галт ханын ажиллагаа шаардлагатай тохиолдол юм.</p><p>Үүний жишээ нь DSL юм уу эсвэл ISDN-ээр ISP уруугаа холбогдсон
	жижиг компани юм. Тэд 13 ширхэг гаднаас хандах боломжтой IP хаягийг
	өөрсдийн ISP-ээс авдаг бөгөөд сүлжээндээ 10 PC-тэй. Энэ тохиолдолд
	чиглүүлэгч дээр тулгуурласан галт хана нь дэд сүлжээний асуудлуудаас болоод
	төвөгтэй байна.</p><a id="idp93811024" class="indexterm"></a><a id="idp93811536" class="indexterm"></a><a id="idp93812048" class="indexterm"></a><p>Гүүр дээр тулгуурласан галт ханыг тохируулж тэдний DSL/ISDN чиглүүлэгчийн
	замд ямар нэгэн IP хаяглалтын асуудалгүйгээр тавьж болно.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93813072"></a>32.5.2.3. Сүлжээ сонсогч (Network tap)</h4></div></div></div><p>Гүүр нь сүлжээний хоёр сегментийг холбож тэдгээрийн
	  хооронд дамжиж байгаа бүх Ethernet урсгалыг шалгахад
	  хэрэглэгдэж болно. Энэ нь гүүр интерфэйс дээр
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a>/<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a> ашиглах юм уу эсвэл
	  бүх урсгалын хуулбарыг нэмэлт интерфэйс (span порт) уруу илгээх
	  замаар байж болно.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93815888"></a>32.5.2.4. Түвшин 2 VPN</h4></div></div></div><p>Хоёр Ethernet сүлжээ нь IP холбоосын дагуу
	  EtherIP туннель юм уу эсвэл OpenVPN зэрэг <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tap&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">tap</span>(4)</span></a>
	  дээр тулгуурласан шийдлүүдийн тусламжтайгаар холбогдож болно.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93817808"></a>32.5.2.5. Түвшин 2 Давхцал</h4></div></div></div><p>Сүлжээ нь хоорондоо олон холбоосоор холбогдож давхацсан замуудыг
	  хаахын тулд Spanning Tree протоколыг ашиглаж болно.
	  Ethernet сүлжээ нь зөв ажилладаг байхын тулд хоёр төхөөрөмжийн
	  хооронд зөвхөн нэг идэвхтэй зам байх ёстой байдаг бөгөөд
	  Spanning Tree нь давталтыг илрүүлж давхацсан холбоосуудыг
	  хаалттай төлөвт оруулдаг. Аль нэг идэвхтэй холбоос амжилтгүй
	  болсон тохиолдолд уг протокол өөр модыг тооцоолж сүлжээн дэх
	  бүх цэгүүдэд хүрэх холболтыг сэргээхийн тулд аль нэг
	  хаалттай замыг дахин идэвхжүүлдэг.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93819088"></a>32.5.3. Цөмийн тохиргоо</h3></div></div></div><p>Энэ хэсэг нь <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=if_bridge&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">if_bridge</span>(4)</span></a> гүүрний шийдлийн тухай өгүүлэх болно,
	netgraph гүүрний драйвер бас байдаг бөгөөд илүү дэлгэрэнгүй мэдээллийг
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_bridge&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_bridge</span>(4)</span></a> гарын авлагын хуудаснаас үзнэ үү.</p><p>Гүүрний драйвер нь цөмийн модуль бөгөөд <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>-оор
	гүүр интерфэйсийг үүсгэх үед автоматаар дуудагддаг.
	Өөрийн цөмийн тохиргооны файлд <code class="literal">device if_bridge</code>
	гэж нэмэн гүүрийг цөмд эмхэтгэж болно.</p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pfil&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">pfil</span>(9)</span></a> тогтолцоогоор холбогддог галт ханын дурын
	багцтай пакет шүүлтийг ашиглаж болдог. Галт хана нь модуль хэлбэрээр
	дуудагдах юм уу эсвэл цөмд эмхэтгэгдэж болно.</p><p>Гүүр нь <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=altq&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">altq</span>(4)</span></a> эсвэл <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dummynet&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">dummynet</span>(4)</span></a>-тэй цуг
	урсгал хэлбэржүүлэгч болон ашиглагдаж болно.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93830608"></a>32.5.4. Гүүрийг идэвхжүүлэх нь</h3></div></div></div><p>Интерфэйс хуулбарлалтыг ашиглан гүүрийг үүсгэдэг.
	Гүүрийг үүсгэхийн тулд <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>-ийг ашиглана.
	Хэрэв гүүрний драйвер цөмд байхгүй бол автоматаар
	дуудагддаг.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge create</code></strong>
bridge0
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0</code></strong>
bridge0: flags=8802&lt;BROADCAST,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        id 00:00:00:00:00:00 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:00:00:00:00:00 priority 0 ifcost 0 port 0</pre><p>Гүүр интерфэйс үүсч түүнд санамсаргүйгээр үүсгэгдсэн
	Ethernet хаяг автоматаар өгөгддөг. <code class="literal">maxaddr</code> болон
	<code class="literal">timeout</code> нэмэлт өгөгдлүүд нь өөрийн дамжуулах
	хүснэгтэд хичнээн MAC хаягийг хадгалах болон сүүлд харагдсанаасаа
	хойш оруулга бүр хичнээн секундын дараа устгагдах вэ гэдгийг
	хянадаг. Бусад нэмэлт өгөгдлүүд нь Spanning Tree хэрхэн
	ажиллахыг хянадаг.</p><p>Гишүүн сүлжээний интерфэйсийг гүүрэнд нэмэх хэрэгтэй.
	Гүүрний хувьд пакетуудыг дамжуулахын тулд бүх гишүүн интерфэйсүүд
	болон гүүр өөрөө идэвхжсэн байх шаардлагатай:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm fxp0 addm fxp1 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp0 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp1 up</code></strong></pre><p>Гүүр нь одоо Ethernet хүрээнүүдийг <code class="filename">fxp0</code>
	болон <code class="filename">fxp1</code>-ийн хооронд дамжуулж байна.
	Гүүр нь ачаалах үед үүсгэгдэх <code class="filename">/etc/rc.conf</code>-ийн
	тохиргоо ийм байна:</p><pre class="programlisting">cloned_interfaces="bridge0"
ifconfig_bridge0="addm fxp0 addm fxp1 up"
ifconfig_fxp0="up"
ifconfig_fxp1="up"</pre><p>Хэрэв гүүр хостод IP хаяг хэрэгтэй бол үүнийг тохируулах
	зөв газар бол гишүүн интерфэйсийн аль нэг биш харин
	гүүр интерфэйс өөрөө юм. Үүнийг статикаар эсвэл DHCP-ээр
	тохируулж болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 inet 192.168.0.1/24</code></strong></pre><p>Гүүр интерфэйсд IPv6 хаягийг өгч бас болно.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93846096"></a>32.5.5. Галт хана</h3></div></div></div><a id="idp93846736" class="indexterm"></a><p>Пакет шүүлт идэвхжсэн тохиолдолд гүүр хийгдсэн
	пакетууд нь гарч байгаа интерфэйс ба гүүр интерфэйс дээрээ
	гарах шүүлтээр, тохирох интерфэйс дээрээ орох
	шүүлтээр дамждаг.
	Аль ч шатыг хааж болдог. Пакетийн урсгалын
	чиглэл нь чухал бол гүүрэн дээр галт хана хийснээс
	гишүүн интерфэйсүүд дээр хийсэн нь дээр байдаг.</p><p>Гүүр нь IP бус ба ARP пакетуудыг дамжуулах болон IPFW-ийн тусламжтай
	хийгдэх хоёрдугаар түвшний галт хананд зориулсан хэд
	хэдэн тохируулж болох тохируулгуудтай байдаг. Дэлгэрэнгүй
	мэдээллийг <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=if_bridge&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">if_bridge</span>(4)</span></a>-ээс үзнэ үү.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93849040"></a>32.5.6. Spanning Tree</h3></div></div></div><p>Гүүрний драйвер нь хуучин Spanning Tree Протоколтой (STP)
	нийцтэй Rapid Spanning Tree Protocol (RSTP эсвэл 802.1w) буюу
	Түргэн Spanning Tree Протоколыг хийж гүйцэтгэсэн байдаг.
	Spanning Tree нь сүлжээн дэх давталтуудыг илрүүлж арилгахад
	хэрэглэгддэг. RSTP нь хуучин STP-г бодох юм бол илүү түргэн
	нийлэх боломжийг олгодог. Энэ протокол нь давхцал үүсгэлгүйгээр
	дамжуулалтад хурдан шилжихийн тулд хөрш шилжүүлэгчидтэйгээ
	мэдээлэл солилцдог.
	FreeBSD нь RSTP болон STP-г ажиллах горим хэлбэрээр дэмждэг бөгөөд
	RSTP нь анхдагч горим юм.</p><p>Spanning Tree-г <code class="literal">stp</code> тушаал ашиглан
	гишүүн интерфэйсүүд дээр идэвхжүүлж болно.
	Одоо <code class="filename">fxp0</code> болон
	<code class="filename">fxp1</code> интерфэйсүүдтэй гүүрний хувьд
	STP-г идэвхжүүлэхийн тулд доор дурдсаныг хийнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 stp fxp0 stp fxp1</code></strong>
bridge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether d6:cf:d5:a0:94:6d
        id 00:01:02:4b:d4:50 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:01:02:4b:d4:50 priority 32768 ifcost 0 port 0
        member: fxp0 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 3 priority 128 path cost 200000 proto rstp
                role designated state forwarding
        member: fxp1 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role designated state forwarding</pre><p>Энэ гүүр нь <code class="literal">00:01:02:4b:d4:50</code> гэсэн
	ID болон <code class="literal">32768</code> гэсэн ээлж бүхий spanning
	tree-тэй байна. <code class="literal">root id</code> адил байгаа нь
	модны хувьд root гүүр гэдгийг илтгэж байна.</p><p>Сүлжээн дэх өөр нэг гүүр бас идэвхжсэн spanning tree-тэй
	байна:</p><pre class="screen">bridge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        id 00:13:d4:9a:06:7a priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:01:02:4b:d4:50 priority 32768 ifcost 400000 port 4
        member: fxp0 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role root state forwarding
        member: fxp1 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 5 priority 128 path cost 200000 proto rstp
                role designated state forwarding</pre><p><code class="literal">root id 00:01:02:4b:d4:50 priority 32768
	ifcost 400000 port 4</code> мөр нь root гүүр нь
	дээр дурдсантай адил <code class="literal">00:01:02:4b:d4:50</code>
	бөгөөд энэ гүүрнээс <code class="literal">400000</code> гэсэн
	замын өртөгтэй, root гүүр рүү хүрэх зам нь
	<code class="filename">fxp0</code> болох <code class="literal">port 4</code>-өөр
	дамжина гэдгийг үзүүлж байна.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93865680"></a>32.5.7. Гүүрний нэмэлт тохиргоо</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93866320"></a>32.5.7.1. Урсгалыг бүтээх/шинэчлэх</h4></div></div></div><p>Гүүр нь монитор буюу хянах горимыг дэмждэг бөгөөд
	  энэ горимд пакетууд нь <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> процесс хийгдсэний дараа
	  хаягдаж цааш процесс хийгдэхгүй эсвэл дамжуулагдахгүй
	  болдог. Хоёр буюу түүнээс дээш тооны интерфэйсүүдийн оролтыг
	  нэгтгэж нэг <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> урсгал руу гаргахад үүнийг ашиглаж
	  болно. RX/TX дохионуудыг гадагш хоёр тусдаа интерфэйсээр дамжуулах
	  сүлжээний сонсогчид зориулсан урсгал бүтээхэд энэ нь ашигтай
	  байдаг.</p><p>Сүлжээний дөрвөн интерфэйсээс оролтыг нэг урсгал уруу уншихын
	  тулд:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm fxp0 addm fxp1 addm fxp2 addm fxp3 monitor up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tcpdump -i bridge0</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93871056"></a>32.5.7.2. Span портууд</h4></div></div></div><p>Гүүрний хүлээн авсан Ethernet хүрээ бүрийн хуулбар
	  томилогдсон span порт уруу дамждаг. Гүүрэн дээр тохируулагдсан
	  span портуудын тоо хязгааргүй байдаг, хэрэв интерфэйс нь
	  span порт гэж томилогдсон бол энэ нь ердийн гүүрний порт маягаар
	  ашиглагдах боломжгүй байж болох юм. Энэ нь гүүрний аль нэг span порт руу
	  холбогдсон өөр нэг хост дээрээс гүүр хийгдсэн сүлжээг идэвхгүйгээр
	  хулгайгаар үзэхэд их ашигтай байдаг.</p><p>Бүх хүрээнүүдийн хуулбарыг <code class="filename">fxp4</code> гэж
	  нэрлэгдсэн интерфэйс рүү илгээхийн тулд:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 span fxp4</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93878096"></a>32.5.7.3. Хувийн интерфэйсүүд</h4></div></div></div><p>Хувийн интерфэйс нь бусад хувийн интерфэйсүүд рүү ямар ч урсгалыг
	  дамжуулдаггүй. Урсгал нь ямар нэг нөхцөлгүйгээр хаагддаг
	  бөгөөд ARP зэрэг ямар ч Ethernet хүрээнүүд дамжуулагдахгүй.
	  Хэрэв урсгал нь сонголтын дагуу хаагдах хэрэгтэй бол үүний оронд
	  галт хана ашиглах ёстой байдаг.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93879248"></a>32.5.7.4. Наалттай интерфэйсүүд</h4></div></div></div><p>Хэрэв гүүрний гишүүн интерфэйс нь наалттай гэж тэмдэглэгдсэн
	  бол динамикаар тогтоосон хаягийн оруулгуудыг дамжуулалтын
	  кэшд ороход статик гэж үздэг. Хаяг өөр интерфэйс дээр үзэгдсэн байлаа ч
	  гэсэн наалттай оруулгууд нь хэзээ ч кэшээс гарч хуучирдаггүй эсвэл
	  солигддоггүй. Энэ нь дамжуулалтын хүснэгтийг урьдчилан нутагшуулах
	  шаардлагагүй болгож статик хаягийн оруулгуудын ашгийг өгдөг бөгөөд
	  гүүрний тодорхой нэг сегмент дээр тогтоогдсон хэрэглэгчид өөр сегмент
	  рүү тэнүүчилж чаддаггүй.</p><p>Наалттай хаягуудыг ашиглах өөр нэг жишээ нь IP хаягийн
	  талбарыг дэмий үрэлгүйгээр хэрэглэгчийн сүлжээнүүд нь тусгаарлагдсан
	  чиглүүлэгчийг үүсгэхийн тулд гүүрийг VLAN-уудтай нэгтгэх
	  явдал юм. <code class="systemitem">CustomerA</code> нь <code class="literal">vlan100</code>
	  дээр <code class="systemitem">CustomerB</code> нь <code class="literal">vlan101</code>
	  дээр гэж үзье. Гүүр нь <code class="systemitem">192.168.0.1</code>
	  гэсэн хаягтай бөгөөд бас интернэт чиглүүлэгч юм.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm vlan100 sticky vlan100 addm vlan101 sticky vlan101</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 inet 192.168.0.1/24</code></strong></pre><p>Хоёр клиент хоёулаа <code class="systemitem">192.168.0.1</code>-г өөрсдийн анхдагч
	  гарц гэж харах бөгөөд гүүрний кэш нь наалттай болохоор
	  тэд өөрсдийн урсгалыг дундаас нь оруулах гэж нөгөө
	  хэрэглэгчийнхээ MAC хаягийг ашиглан хуурч чадахгүй юм.</p><p>VLAN-уудын хоорондох ямар ч холбоог хувийн интерфэйсүүд
	  (эсвэл галт хана) ашиглан хааж болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 private vlan100 private vlan101</code></strong></pre><p>Хэрэглэгчид нь нэг нэгнээсээ бүр мөсөн тусгаарлагдсан бөгөөд
	  бүх <code class="systemitem">/24</code> хаягийн бүсийг дэд сүлжээ
	  болгон хуваалгүйгээр хуваарилж болно.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93904464"></a>32.5.7.5. Хаягийн хязгаарууд</h4></div></div></div><p>Интерфэйсийн цаана байгаа давтагдашгүй эх MAC хаягуудын
	  тоо хязгаартай байж болно. Тэр хязгаарт хүрэх үед мэдэгдэхгүй эх
	  хаягтай пакетууд нь тухайн үед байгаа хостын кэш оруулгын
	  хугацаа дуусах юм уу эсвэл устгагдах хүртэл хаягдсаар байх болно.</p><p>Доор дурдсан жишээ нь <code class="literal">vlan100</code> дээр
	  байгаа <code class="systemitem">CustomerA</code>-д зориулж
	  Ethernet төхөөрөмжүүдийн хамгийн их тоог 10 болгон тохируулж
	  байна.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 ifmaxaddr vlan100 10</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93907792"></a>32.5.7.6. SNMP монитор хийх</h4></div></div></div><p>Гүүр интерфэйс болон STP параметрүүдийг FreeBSD-ийн
	  үндсэн системд орсон байдаг SNMP демоны тусламжтайгаар
	  монитор хийж болно. Экспорт хийгдсэн гүүрний MIB-үүд нь
	  IETF-ийн стандартуудыг хангаж байдаг. Тийм болохоор дурын
	  SNMP клиент эсвэл монитор хийдэг багцыг өгөгдлийг хүлээн авахад
	  хэрэглэж болно.</p><p>Гүүр машин дээр <code class="filename">/etc/snmp.config</code>
	  файлд <code class="literal">begemotSnmpdModulePath."bridge" =
	  "/usr/lib/snmp_bridge.so"</code> мөрийг тайлбар болгосныг
	  болиулж <span class="application">bsnmpd</span> дэмоныг
	  эхлүүлэх хэрэгтэй. Community буюу нийгмийн нэрс болон
	  хандалтын жагсаалтууд зэрэг бусад тохиргоонуудыг өөрчлөх
	  шаардлагатай байж болно. Дэлгэрэнгүй мэдээллийг
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsnmpd&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">bsnmpd</span>(1)</span></a> болон <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snmp_bridge&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">snmp_bridge</span>(3)</span></a>-с үзнэ үү.</p><p>Доор дурдсан жишээнүүд нь гүүрэнд хүсэлт илгээхийн тулд
	  <span class="application">Net-SNMP</span> програм хангамжийг (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/net-snmp/pkg-descr">net-mgmt/net-snmp</a>) ашиглаж байгаа
	  бөгөөд <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/bsnmptools/pkg-descr">net-mgmt/bsnmptools</a> портыг бас
	  ашиглаж болно. Гүүрний MIB тодорхойлолтуудыг
	  <span class="application">Net-SNMP</span> руу оруулж ирэхийн тулд
	  SNMP клиент хост дээрээ <code class="filename">$HOME/.snmp/snmp.conf</code> файлд
	  доор дурдсан мөрүүдийг нэмэх хэрэгтэй:</p><pre class="programlisting">mibdirs +/usr/share/snmp/mibs
mibs +BRIDGE-MIB:RSTP-MIB:BEGEMOT-MIB:BEGEMOT-BRIDGE-MIB</pre><p>Ганц гүүрийг IETF BRIDGE-MIB
	  (RFC4188)-ээр монитор хийхийн тулд доор дурдсаныг хийнэ</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>snmpwalk -v 2c -c public bridge1.example.com mib-2.dot1dBridge</code></strong>
BRIDGE-MIB::dot1dBaseBridgeAddress.0 = STRING: 66:fb:9b:6e:5c:44
BRIDGE-MIB::dot1dBaseNumPorts.0 = INTEGER: 1 ports
BRIDGE-MIB::dot1dStpTimeSinceTopologyChange.0 = Timeticks: (189959) 0:31:39.59 centi-seconds
BRIDGE-MIB::dot1dStpTopChanges.0 = Counter32: 2
BRIDGE-MIB::dot1dStpDesignatedRoot.0 = Hex-STRING: 80 00 00 01 02 4B D4 50
...
BRIDGE-MIB::dot1dStpPortState.3 = INTEGER: forwarding(5)
BRIDGE-MIB::dot1dStpPortEnable.3 = INTEGER: enabled(1)
BRIDGE-MIB::dot1dStpPortPathCost.3 = INTEGER: 200000
BRIDGE-MIB::dot1dStpPortDesignatedRoot.3 = Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedCost.3 = INTEGER: 0
BRIDGE-MIB::dot1dStpPortDesignatedBridge.3 = Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedPort.3 = Hex-STRING: 03 80
BRIDGE-MIB::dot1dStpPortForwardTransitions.3 = Counter32: 1
RSTP-MIB::dot1dStpVersion.0 = INTEGER: rstp(2)</pre><p><code class="literal">dot1dStpTopChanges.0</code>-ийн утга хоёр бөгөөд
	  энэ нь STP гүүрний бүтэц хоёр удаа өөрчлөгдсөн гэдгийг харуулж
	  байна. Бүтцийн өөрчлөлт гэдэг нь сүлжээн дэх нэг буюу олон холбоосууд
	  өөрчлөгдсөн юм уу эсвэл амжилтгүй болсон бөгөөд шинэ мод тооцоологдсон
	  гэсэн үг юм. <code class="literal">dot1dStpTimeSinceTopologyChange.0</code>-ийн
	  утга ийм зүйл хэзээ болсныг харуулах болно.</p><p>Олон гүүрний интерфэйсийг монитор хийхийн тулд
	  хувийн BEGEMOT-BRIDGE-MIB-г ашиглаж болно:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>snmpwalk -v 2c -c public bridge1.example.com</code></strong>
enterprises.fokus.begemot.begemotBridge
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName."bridge0" = STRING: bridge0
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName."bridge2" = STRING: bridge2
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress."bridge0" = STRING: e:ce:3b:5a:9e:13
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress."bridge2" = STRING: 12:5e:4d:74:d:fc
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts."bridge0" = INTEGER: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts."bridge2" = INTEGER: 1
...
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange."bridge0" = Timeticks: (116927) 0:19:29.27 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange."bridge2" = Timeticks: (82773) 0:13:47.73 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges."bridge0" = Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges."bridge2" = Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot."bridge0" = Hex-STRING: 80 00 00 40 95 30 5E 31
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot."bridge2" = Hex-STRING: 80 00 00 50 8B B8 C6 A9</pre><p><code class="literal">mib-2.dot1dBridge</code> дэд модоор
	  монитор хийгдэж байгаа гүүрний интерфэйсийг солихын
	  тулд доор дурдсаныг хийнэ:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>snmpset -v 2c -c private bridge1.example.com</code></strong>
BEGEMOT-BRIDGE-MIB::begemotBridgeDefaultBridgeIf.0 s bridge2</pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-bluetooth.html">Өмнөх</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Дээш</a></td><td width="40%" align="right"> <a accesskey="n" href="network-aggregation.html">Дараах</a></td></tr><tr><td width="40%" align="left" valign="top">32.4. Bluetooth </td><td width="20%" align="center"><a accesskey="h" href="index.html">Эхлэл</a></td><td width="40%" align="right" valign="top"> 32.6. Холбоос нэгтгэлт ба ослыг тойрон гарах (Link Aggregation and Failover)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Энэ болон бусад баримтуудыг
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    хаягаас татаж авч болно.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD-ийн талаар
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;
    хаягтай холбоо барихаасаа өмнө
    <a href="http://www.FreeBSD.org/docs.html">баримтыг</a> уншина уу.<br></br>
    Энэ бичиг баримттай холбоотой асуулт байвал
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;
    хаягаар цахим захидал явуулна уу.<br></br>
    Энэ бичиг баримтын орчуулгатай холбоотой асуулт байвал
    &lt;<a href="mailto:admin@mnbsd.org">admin@mnbsd.org</a>&gt;
    хаягаар цахим захидал явуулна уу.</small></p></body></html>