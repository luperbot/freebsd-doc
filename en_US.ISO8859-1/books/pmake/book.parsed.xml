<?xml version="1.0" encoding="iso-8859-1"?>
<book xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:lang="en">
  <info><title xmlns:xlink="http://www.w3.org/1999/xlink">PMake &#8212; A Tutorial</title>
    

    <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Adam</firstname><surname xmlns:xlink="http://www.w3.org/1999/xlink">de Boor</surname></personname></author>

    <copyright xmlns:xlink="http://www.w3.org/1999/xlink">
      <year xmlns:xlink="http://www.w3.org/1999/xlink">1988</year>
      <year xmlns:xlink="http://www.w3.org/1999/xlink">1989</year>
      <holder xmlns:xlink="http://www.w3.org/1999/xlink">Adam de Boor</holder>
    </copyright>

    <copyright xmlns:xlink="http://www.w3.org/1999/xlink">
      <year xmlns:xlink="http://www.w3.org/1999/xlink">1989</year>
      <holder xmlns:xlink="http://www.w3.org/1999/xlink">Berkeley Softworks</holder>
    </copyright>

    <copyright xmlns:xlink="http://www.w3.org/1999/xlink">
      <year xmlns:xlink="http://www.w3.org/1999/xlink">1988</year>
      <year xmlns:xlink="http://www.w3.org/1999/xlink">1989</year>
      <year xmlns:xlink="http://www.w3.org/1999/xlink">1993</year>
      <holder xmlns:xlink="http://www.w3.org/1999/xlink">The Regents of the University of California.</holder>
    </copyright>

    
<!--
    $FreeBSD$
-->
<legalnotice xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="legalnotice">
  <para xmlns:xlink="http://www.w3.org/1999/xlink">All rights reserved.</para>

  <para xmlns:xlink="http://www.w3.org/1999/xlink">This code is derived from software contributed to Berkeley
    by Adam de Boor.</para>

  <para xmlns:xlink="http://www.w3.org/1999/xlink">Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:</para>

  <orderedlist xmlns:xlink="http://www.w3.org/1999/xlink">
    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Redistributions of source code must retain the above copyright
	notice, this list of conditions and the following disclaimer.</para>
    </listitem>

    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Redistributions in binary form must reproduce the above
	copyright notice, this list of conditions and the following
	disclaimer in the documentation and/or other materials provided
	with the distribution.</para>
    </listitem>

    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">All advertising materials mentioning features or use of this
	software must display the following acknowledgement: This product
	includes software developed by the University of California,
	Berkeley and its contributors.</para>
    </listitem>

    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Neither the name of the University nor the names of its
	contributors may be used to endorse or promote products derived
	from this software without specific prior written
	permission.</para>
    </listitem>
  </orderedlist>

  <important xmlns:xlink="http://www.w3.org/1999/xlink">
    <para xmlns:xlink="http://www.w3.org/1999/xlink">THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS "AS IS"
      AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
      THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
      PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS
      BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
      CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
      SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
      INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
      CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
      ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
      THE POSSIBILITY OF SUCH DAMAGE.</para>
  </important>
</legalnotice>


    <releaseinfo xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</releaseinfo>
  </info>

  
<!--
     PMake - A Tutorial

     $FreeBSD$
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="intro">
  <title xmlns:xlink="http://www.w3.org/1999/xlink">Introduction</title>

  <para xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is a program for creating other
    programs, or anything else you can think of for it to do.  The basic idea
    behind <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is that, for any given system, be
    it a program or a document or whatever, there will be some files that
    depend on the state of other files (on when they were last modified).
    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> takes these dependencies, which you must
    specify, and uses them to build whatever it is you want it to
    build.</para>

  <para xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is almost fully-compatible with
    <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application>, with which you may already be familiar.
    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>'s most important feature is its ability
    to run several different jobs at once, making the creation of systems
    considerably faster.  It also has a great deal more functionality than
    <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application>.</para>

  <para xmlns:xlink="http://www.w3.org/1999/xlink">This tutorial is divided into three main sections corresponding to
    basic, intermediate and advanced <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> usage.
    If you already know <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application> well, you will only
    need to skim <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="basics"/> (there are some aspects of
    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> that I consider basic to its use that did
    not exist in <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application>).
    Things in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="shortcuts"/> make life much easier, while those in
    <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="gods"/> are strictly for those who know what they are doing.
    <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="glossary"/> has definitions for the jargon I use and
    <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="answers"/> contains possible solutions to the problems
    presented throughout the tutorial.</para>
  </chapter>

  
<!--
     $FreeBSD$
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="basics">
  <title xmlns:xlink="http://www.w3.org/1999/xlink">The Basics of PMake</title>

  <para xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> takes as input a file that
    tells which files depend on which other files to be complete and
    what to do about files that are <quote xmlns:xlink="http://www.w3.org/1999/xlink">out-of-date</quote>.
    This file is known as a <quote xmlns:xlink="http://www.w3.org/1999/xlink">makefile</quote> and is usually
    kept in the top-most directory of the system to be built.
    While you can call the makefile anything you want,
    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will look for
    <filename xmlns:xlink="http://www.w3.org/1999/xlink">Makefile</filename> and <filename xmlns:xlink="http://www.w3.org/1999/xlink">makefile</filename>
    (in that order) in the current directory if you do not tell it
    otherwise.  To specify a different makefile, use the
    <option xmlns:xlink="http://www.w3.org/1999/xlink">-f</option> flag, e.g.</para>

  <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">pmake -f <replaceable xmlns:xlink="http://www.w3.org/1999/xlink">program.mk</replaceable></userinput></screen>

  <para xmlns:xlink="http://www.w3.org/1999/xlink">A makefile has four different types of lines in it:</para>

  <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">File dependency specifications</para>
    </listitem>

    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Creation commands</para>
    </listitem>

    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Variable assignments</para>
    </listitem>

    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Comments, include statements and conditional directives</para>
    </listitem>
  </itemizedlist>

  <para xmlns:xlink="http://www.w3.org/1999/xlink">Any line may be continued over multiple lines by ending it
    with a backslash.  The backslash, following newline and any
    initial whitespace on the following line are compressed into a
    single space before the input line is examined by
    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>.</para>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="deplines">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Dependency Lines</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">As mentioned in the introduction, in any system, there are
      dependencies between the files that make up the system.
      For instance, in a program made up of several C source files and
      one header file, the C files will need to be re-compiled should
      the header file be changed.  For a document of several chapters
      and one macro file, the chapters will need to be reprocessed if
      any of the macros changes.  These are dependencies and are
      specified by means of dependency lines in the makefile.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">On a dependency line, there are targets and sources,
      separated by a one- or two-character operator.  The targets
      <quote xmlns:xlink="http://www.w3.org/1999/xlink">depend</quote> on the sources and are usually created
      from them.  Any number of targets and sources may be specified
      on a dependency line.  All the targets in the line are made to
      depend on all the sources.  Targets and sources need not be
      actual files, but every source must be either an actual file or
      another target in the makefile.  If you run out of room, use a
      backslash at the end of the line to continue onto the next
      one.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Any file may be a target and any file may be a source, but
      the relationship between the two (or however many) is determined
      by the <quote xmlns:xlink="http://www.w3.org/1999/xlink">operator</quote> that separates them.  Three types
      of operators exist: one specifies that the datedness of a target
      is determined by the state of its sources, while another
      specifies other files (the sources) that need to be dealt with
      before the target can be re-created.  The third operator is very
      similar to the first, with the additional condition that the
      target is out-of-date if it has no sources.  These operations
      are represented by the colon, the exclamation point and the
      double-colon, respectively, and are mutually exclusive.
      Their exact semantics are as follows:</para>

    <informaltable xmlns:xlink="http://www.w3.org/1999/xlink" frame="none">
      <tgroup xmlns:xlink="http://www.w3.org/1999/xlink" cols="2">
	<tbody xmlns:xlink="http://www.w3.org/1999/xlink">
	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">:</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">If a colon is used, a target on the line is
	      considered to be <quote xmlns:xlink="http://www.w3.org/1999/xlink">out-of-date</quote> (and in need
	      of creation) if any of the sources has been modified
	      more recently than the target, or the target does not
	      exist.  Under this operation, steps will be taken to
	      re-create the target only if it is found to be
	      out-of-date by using these two rules.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">!</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">If an exclamation point is used, the target will
	      always be re-created, but this will not happen until all
	      of its sources have been examined and re-created, if
	      necessary.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">::</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">If a double-colon is used, a target is
	      <quote xmlns:xlink="http://www.w3.org/1999/xlink">out-of-date</quote> if any of the sources has
	      been modified more recently than the target, or the
	      target does not exist, or the target has no sources.
	      If the target is out-of-date according to these rules,
	      it will be re-created.  This operator also does
	      something else to the targets, but I will go into that
	      in the next section
	      (see <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="shellcmds"/>).</entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Enough words, now for an example.  Take that C program I
      mentioned earlier.  Say there are three C files
      (<filename xmlns:xlink="http://www.w3.org/1999/xlink">a.c</filename>, <filename xmlns:xlink="http://www.w3.org/1999/xlink">b.c</filename> and
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">c.c</filename>) each of which includes the file
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">defs.h</filename>.  The dependencies between the files
      could then be expressed as follows:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">program         : a.o b.o c.o

a.o b.o c.o     : defs.h

a.o             : a.c

b.o             : b.c

c.o             : c.c</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">You may be wondering at this point, where
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">a.o</filename>, <filename xmlns:xlink="http://www.w3.org/1999/xlink">b.o</filename> and
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">c.o</filename> came in and why they depend on
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">defs.h</filename> and the C files do not.
      The reason is quite simple: <buildtarget>program</buildtarget>
      cannot be made by linking together <filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename>
      files&#8212;it must be made from <filename xmlns:xlink="http://www.w3.org/1999/xlink">.o</filename> files.
      Likewise, if you change <filename xmlns:xlink="http://www.w3.org/1999/xlink">defs.h</filename>, it is not
      the <filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename> files that need to be re-created,
      it is the <filename xmlns:xlink="http://www.w3.org/1999/xlink">.o</filename> files.  If you think of
      dependencies in these terms&#8212;which files (targets) need to
      be created from which files (sources)&#8212;you should have no
      problems.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">An important thing to notice about the above example, is
      that all the <filename xmlns:xlink="http://www.w3.org/1999/xlink">.o</filename> files appear as targets on
      more than one line.  This is perfectly all right: the target is
      made to depend on all the sources mentioned on all the
      dependency lines.  For example, <filename xmlns:xlink="http://www.w3.org/1999/xlink">a.o</filename> depends
      on both <filename xmlns:xlink="http://www.w3.org/1999/xlink">defs.h</filename> and <filename xmlns:xlink="http://www.w3.org/1999/xlink">a.c</filename>.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The order of the dependency lines in the makefile is
      important: the first target on the first dependency line in the
      makefile will be the one that gets made if you do not say
      otherwise.  That is why program comes first in the example
      makefile, above.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Both targets and sources may contain the standard C-Shell wildcard
      characters (<literal xmlns:xlink="http://www.w3.org/1999/xlink">{</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">}</literal>,
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">*</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">?</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">[</literal>, and
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">]</literal>), but the non-curly-brace ones may only appear in
      the final component (the file portion) of the target or source.
      The characters mean the following things:</para>

    <informaltable xmlns:xlink="http://www.w3.org/1999/xlink" frame="none">
      <tgroup xmlns:xlink="http://www.w3.org/1999/xlink" cols="2">
	<tbody xmlns:xlink="http://www.w3.org/1999/xlink">
	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">{}</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">These enclose a comma-separated list of options and
	      cause the pattern to be expanded once for each element
	      of the list.  Each expansion contains a different
	      element.  For example,
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">src/{whiffle,beep,fish}.c</filename> expands
	      to the three words <filename xmlns:xlink="http://www.w3.org/1999/xlink">src/whiffle.c</filename>,
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">src/beep.c</filename>, and
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">src/fish.c</filename>.  These braces may be
	      nested and, unlike the other wildcard characters, the
	      resulting words need not be actual files.  All other
	      wildcard characters are expanded using the files that
	      exist when <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is
	      started.</entry> </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">*</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">This matches zero or more characters of any sort.
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">src/*.c</filename> will expand to the same
	      three words as above as long as src contains those three
	      files  (and  no other files that end in
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename>).&gt;</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">?</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">Matches any single character.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">[]</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">This is known as a character class and contains
	      either a list of single characters, or a series of
	      character ranges (<literal xmlns:xlink="http://www.w3.org/1999/xlink">a-z</literal>, for example
	      means all characters between <literal xmlns:xlink="http://www.w3.org/1999/xlink">a</literal> and
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">z</literal>), or both.  It matches any single
	      character contained in the list.  For example,
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">[A-Za-z]</literal> will match all letters,
	      while <literal xmlns:xlink="http://www.w3.org/1999/xlink">[0123456789]</literal> will match all
	      numbers.</entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="shellcmds" xreflabel="Shell Commands">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Shell Commands</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><quote xmlns:xlink="http://www.w3.org/1999/xlink">Is not that nice,</quote> you say to yourself,
      <quote xmlns:xlink="http://www.w3.org/1999/xlink">but how are files actually ``re-created'', as he likes to
	spell it?</quote>
      The re-creation is accomplished by commands you place in the
      makefile.  These commands are passed to the Bourne shell (better
      known as <filename xmlns:xlink="http://www.w3.org/1999/xlink">/bin/sh</filename>) to be executed and are
      expected to do what is necessary to update the target file
      (<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> does not actually check to see
      if the target was created.  It just assumes it is there).</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Shell commands in a makefile look a lot like shell commands
      you would type at a terminal, with one important exception: each
      command in a makefile must be preceded by at least one
      tab.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Each target has associated with it a shell script made up of
      one or more of these shell commands.  The creation script for a
      target should immediately follow the dependency line for that
      target.  While any given target may appear on more than one
      dependency line, only one of these dependency lines  may be
      followed  by a creation script, unless the <literal xmlns:xlink="http://www.w3.org/1999/xlink">::</literal>
      operator was used on the dependency line.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">If the double-colon was used, each dependency line for the
      target may be followed by a shell script.  That script will only
      be executed if the target on the associated dependency line is
      out-of-date with respect to the sources on that line, according
      to the rules I gave earlier.  I'll give you a good example of
      this later on.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">To expand on the earlier makefile, you might add commands
      as follows:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">program         : a.o b.o c.o
        cc a.o b.o c.o -o program

a.o b.o c.o     : defs.h
a.o             : a.c
       cc -c a.c

b.o             : b.c
       cc -c b.c

c.o             : c.c
       cc -c c.c</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Something you should remember when writing a makefile is,
      the commands will be executed if the target on the dependency
      line is out-of-date, not the sources.  In this example, the
      command <command xmlns:xlink="http://www.w3.org/1999/xlink">cc -c a.c</command> will be executed if
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">a.o</filename> is out-of-date.  Because of the
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">:</literal> operator, this means that should
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">a.c</filename> or <filename xmlns:xlink="http://www.w3.org/1999/xlink">defs.h</filename> have
      been modified more recently than <filename xmlns:xlink="http://www.w3.org/1999/xlink">a.o</filename>, the
      command will be executed (<filename xmlns:xlink="http://www.w3.org/1999/xlink">a.o</filename> will be
      considered out-of-date).</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Remember how I said the only difference between a makefile
      shell command and a regular shell command was the leading tab?
      I lied.  There is another way in which makefile commands differ
      from regular ones.  The first two characters after the initial
      whitespace are treated specially.  If they are any combination
      of <filename xmlns:xlink="http://www.w3.org/1999/xlink">@</filename> and <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal>, they cause
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to do different things.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">In most cases, shell commands are printed before they are
      actually executed.  This is to keep you informed of what is
      going on.  If an <literal xmlns:xlink="http://www.w3.org/1999/xlink">@</literal> appears, however, this
      echoing is suppressed.  In the case of an echo command,
      say</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">echo Linking index</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">it would be rather silly to see</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink">echo Linking index
Linking index</screen>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">so <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> allows you to place an
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">@</literal> before the command to prevent the command
      from being printed:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">@echo Linking index</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The other special character is the <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal>.
      In case you did not know, shell commands finish with a certain
      <quote xmlns:xlink="http://www.w3.org/1999/xlink">exit status</quote>.  This status is made available by
      the operating system to whatever program invoked the command.
      Normally this status will be <literal xmlns:xlink="http://www.w3.org/1999/xlink">0</literal> if everything
      went ok and non-zero if something went wrong.  For this reason,
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will consider an error to have
      occurred if one of the shells it invokes returns a non-zero
      status.  When it detects an error,
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>'s usual action is to abort
      whatever it is doing and exit with a non-zero status itself (any
      other targets that were being created will continue being made,
      but nothing new will be started.
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will exit after the last job
      finishes).  This behavior can be altered, however, by placing a
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal> at the front of a command
      (e.g. <command xmlns:xlink="http://www.w3.org/1999/xlink">-mv index index.old</command>), certain
      command-line arguments, or doing other things, to be detailed
      later.  In such a case, the non-zero status is simply ignored
      and <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> keeps chugging
      along.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Because all the commands are given to a single shell to
      execute, such things as setting shell variables, changing
      directories, etc., last beyond the command in which they are
      found.  This also allows shell compound commands (like for
      loops) to be entered in a natural manner.  Since this could
      cause problems for some makefiles that depend on each command
      being executed by a single shell,
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> has a <option xmlns:xlink="http://www.w3.org/1999/xlink">-B</option> flag
      (it stands for backwards-compatible) that forces each command to
      be given to a separate shell.  It also does several other
      things, all of which I discourage since they are now
      old-fashioned.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">A target's shell script is fed to the shell on its (the
      shell's) input stream. This means that any commands, such as
      <application xmlns:xlink="http://www.w3.org/1999/xlink">ci</application> that need to get input from the
      terminal will not work right &#8211; they will get the shell's
      input, something they probably will not find to their liking.
      A simple way around this is to give a command like this:</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink"><command xmlns:xlink="http://www.w3.org/1999/xlink">ci $(SRCS) &lt; /dev/tty</command></screen>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">This would force the program's input to come from the
      terminal.  If you cannot do this for some reason, your only
      other alternative is to use <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> in
      its fullest compatibility mode.
      See <quote xmlns:xlink="http://www.w3.org/1999/xlink">Compatibility</quote> in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="gods"/>.</para>
  </section>


  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="variables">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Variables</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>, like
      <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application> before it, has the ability to
      save text in variables to be recalled later at your convenience.
      Variables in <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> are used much like
      variables in the shell and, by tradition, consist of all
      upper-case letters (you do not have to use all upper-case
      letters.  In fact there is nothing to stop you from calling a
      variable <literal xmlns:xlink="http://www.w3.org/1999/xlink">@^&amp;$%$</literal>.  Just tradition).  Variables
      are assigned-to using lines of the form:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">VARIABLE = value</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">appended-to by:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">VARIABLE += value</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">conditionally assigned-to (if the variable is not already
      defined) by:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">VARIABLE ?= value</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">and assigned-to with expansion (i.e. the value is expanded
      (see below) before being assigned to the variable&#8212;useful
      for placing a value at the beginning of a variable, or other
      things) by:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">VARIABLE := value</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Any whitespace before value is stripped off.  When
      appending, a space is placed between the old value and the stuff
      being appended.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The final way a variable may be assigned to is using:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">VARIABLE != shell-command</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">In this case, shell-command has all its variables expanded
      (see below) and is passed off to a shell to execute.  The output
      of the shell is then placed in the variable.  Any newlines
      (other than the final one) are replaced by spaces before the
      assignment is made.  This is typically used to find the current
      directory via a line like:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">CWD             != pwd</programlisting>

    <note xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">This is intended to be used to execute commands that
	produce small amounts of output
	(e.g. <application xmlns:xlink="http://www.w3.org/1999/xlink">pwd</application>).
	The implementation is less than intelligent and will likely
	freeze if you execute something that produces thousands of
	bytes of output (8 Kb is the limit on many <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark> systems).
	The value of a variable may be retrieved by enclosing the
	variable name in parentheses or curly braces and preceding the
	whole thing with a dollar sign.</para>
    </note>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">For example, to set the variable <envar xmlns:xlink="http://www.w3.org/1999/xlink">CFLAGS</envar> to
      the string <literal xmlns:xlink="http://www.w3.org/1999/xlink">-I/sprite/src/lib/libc -O,</literal> you
      would place a line:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">CFLAGS = -I/sprite/src/lib/libc -O</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">in the makefile and use the word
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">$(CFLAGS)</literal> wherever you would like the string
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">-I/sprite/src/lib/libc -O</literal> to appear.  This is
      called variable expansion.</para>

    <note xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Unlike <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application>,
	<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will not expand a variable
	unless it knows the variable exists.  E.g. if you have a
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">${i}</literal> in a shell command and you have not
	assigned a value to the variable <varname xmlns:xlink="http://www.w3.org/1999/xlink">i</varname> (the
	empty string is considered a value, by the way), where
	<application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application> would have substituted the
	empty string, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will leave the
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">${i}</literal> alone.
	To keep <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> from substituting for
	a variable it knows, precede the dollar sign with another
	dollar sign (e.g. to pass <literal xmlns:xlink="http://www.w3.org/1999/xlink">${HOME}</literal> to
	the shell, use <literal xmlns:xlink="http://www.w3.org/1999/xlink">$${HOME}</literal>).  This causes
	<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>, in effect, to expand the
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">$</literal> macro, which expands to a single
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">$</literal>.</para>
    </note>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">For compatibility, <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application>'s style
      of variable expansion will be used if you invoke
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> with any of the compatibility
      flags (<option xmlns:xlink="http://www.w3.org/1999/xlink">-V</option>, <option xmlns:xlink="http://www.w3.org/1999/xlink">-B</option> or
      <option xmlns:xlink="http://www.w3.org/1999/xlink">-M</option>.  The <option xmlns:xlink="http://www.w3.org/1999/xlink">-V</option> flag alters just
      the variable expansion).  There are two different times at which
      variable expansion occurs: when parsing a dependency line, the
      expansion occurs immediately upon reading the line.  If any
      variable used on a dependency line is undefined,
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will print a message and exit.
      Variables in shell commands are expanded when the command is
      executed.  Variables used inside another variable are expanded
      whenever the outer variable is expanded (the expansion of an
      inner variable has no effect on the outer variable.  For
      example, if the outer variable is used on a dependency line and
      in a shell command, and the inner variable changes value between
      when the dependency line is read and the shell command is
      executed, two different values will be substituted for the outer
      variable).</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Variables come in four flavors, though they are all expanded
      the same and all look about the same.  They are (in order of
      expanding scope):</para>

    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Local variables.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Command-line variables.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Global variables.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Environment variables.</para>
      </listitem>
    </itemizedlist>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The classification of variables does not matter much, except
      that the classes are searched from the top (local) to the bottom
      (environment) when looking up a variable.  The first one found
      wins.</para>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="localvariables">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Local Variables</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Each target can have as many as seven local variables.
	These are variables that are only <quote xmlns:xlink="http://www.w3.org/1999/xlink">visible</quote>
	within that target's shell script and contain such things as
	the target's name, all of its sources (from all its dependency
	lines), those sources that were out-of-date, etc.  Four local
	variables are defined for all targets.  They are:</para>

      <variablelist xmlns:xlink="http://www.w3.org/1999/xlink">
	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><varname xmlns:xlink="http://www.w3.org/1999/xlink">.TARGET</varname></term>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The name of the target.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><varname xmlns:xlink="http://www.w3.org/1999/xlink">.OODATE</varname></term>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The list of the sources for the target that were
	      considered out-of-date.  The order in the list is not
	      guaranteed to be the same as the order in which the
	      dependencies were given.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><varname xmlns:xlink="http://www.w3.org/1999/xlink">.ALLSRC</varname></term>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The list of all sources for this target in the order
	      in which they were given.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><varname xmlns:xlink="http://www.w3.org/1999/xlink">.PREFIX</varname></term>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The target without its suffix and without any
	      leading path.  E.g. for the target
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">../../lib/compat/fsRead.c</filename>, this
	      variable would contain <literal xmlns:xlink="http://www.w3.org/1999/xlink">fsRead</literal>.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Three other local variables are set only for certain
	targets under special circumstances.  These are the
	<varname xmlns:xlink="http://www.w3.org/1999/xlink">.IMPSRC,</varname> <varname xmlns:xlink="http://www.w3.org/1999/xlink">.ARCHIVE,</varname> and
	<varname xmlns:xlink="http://www.w3.org/1999/xlink">.MEMBER</varname> variables.  When they are set and
	how they are used is described later.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Four of these variables may be used in sources as well as
	in shell scripts.  These are <varname xmlns:xlink="http://www.w3.org/1999/xlink">.TARGET</varname>,
	<varname xmlns:xlink="http://www.w3.org/1999/xlink">.PREFIX</varname>, <varname xmlns:xlink="http://www.w3.org/1999/xlink">.ARCHIVE</varname> and
	<varname xmlns:xlink="http://www.w3.org/1999/xlink">.MEMBER</varname>.  The variables in the sources are
	expanded once for each target on the dependency line,
	providing what is known as a <quote xmlns:xlink="http://www.w3.org/1999/xlink">dynamic source,</quote>
	allowing  you to specify several dependency lines at once.
	For example:</para>

      <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">$(OBJS)         : $(.PREFIX).c</programlisting>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">will create a dependency between each object file and its
	corresponding C source file.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="cmdvars">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Command-line Variables</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Command-line variables are set when
	<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is first invoked by giving a
	variable assignment as one of the arguments.
	For example:</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink">pmake "CFLAGS = -I/sprite/src/lib/libc -O"</screen>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">would make <envar xmlns:xlink="http://www.w3.org/1999/xlink">CFLAGS</envar> be a command-line
	variable with the given value.  Any assignments to
	<envar xmlns:xlink="http://www.w3.org/1999/xlink">CFLAGS</envar> in the makefile will have no effect,
	because once it is set, there is (almost) nothing you can do
	to change a command-line variable (the search order, you see).
	Command-line variables may be set using any of the four
	assignment operators, though only <literal xmlns:xlink="http://www.w3.org/1999/xlink">=</literal> and
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">?=</literal> behave as you would expect them to,
	mostly because assignments to command-line variables are
	performed before the makefile is read, thus the values set in
	the makefile are unavailable at the time.
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">+=</literal> is the same as <literal xmlns:xlink="http://www.w3.org/1999/xlink">=</literal>,
	because the old value of the variable is sought only in the
	scope in which the assignment is taking place (for reasons of
	efficiency that I will not get into here).  <literal xmlns:xlink="http://www.w3.org/1999/xlink">:=</literal>
	and <literal xmlns:xlink="http://www.w3.org/1999/xlink">?=</literal> will work if the  only variables
	used are in the environment.  <literal xmlns:xlink="http://www.w3.org/1999/xlink">!=</literal> is sort of
	pointless to use from the command line, since the same effect
	can no doubt be accomplished using the shell's own command
	substitution mechanisms (backquotes and all that).</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="globalvariables">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Global Variables</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Global variables are those set or appended-to in the
	makefile.  There are two classes of global variables: those
	you set and those <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> sets.
	As I said before, the ones you set can have any name you want
	them to have, except they may not contain a colon or an
	exclamation point.
	The variables <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> sets (almost)
	always begin with a period and always contain upper-case
	letters, only.  The variables are as follows:</para>

      <variablelist xmlns:xlink="http://www.w3.org/1999/xlink">
	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><varname xmlns:xlink="http://www.w3.org/1999/xlink">.PMAKE</varname></term>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The name by which <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	      was invoked is stored in this variable.  For
	      compatibility, the name is also stored in the
	      <varname xmlns:xlink="http://www.w3.org/1999/xlink">MAKE</varname> variable.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><varname xmlns:xlink="http://www.w3.org/1999/xlink">.MAKEFLAGS</varname></term>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">All the relevant flags with which
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> was invoked.
	      This does not include such things as <option xmlns:xlink="http://www.w3.org/1999/xlink">-f</option>
	      or variable assignments. Again for compatibility, this
	      value is stored in the <varname xmlns:xlink="http://www.w3.org/1999/xlink">MFLAGS</varname>
	      variable as well.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Two other variables, <varname xmlns:xlink="http://www.w3.org/1999/xlink">.INCLUDES</varname> and
	<varname xmlns:xlink="http://www.w3.org/1999/xlink">.LIBS,</varname> are covered in the section on
	special targets in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="shortcuts"/>.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Global variables may be deleted using lines of the
	form:</para>

      <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">#undef variable</programlisting>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <literal xmlns:xlink="http://www.w3.org/1999/xlink">#</literal> must be the first character on
	the line.  Note that this may only be done on global
	variables.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="envvars">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Environment Variables</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Environment variables are passed by the shell that invoked
	<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> and are given by
	<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to each shell it invokes.
	They are expanded like any other variable, but they cannot be
	altered in any way.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">One special environment variable, <envar xmlns:xlink="http://www.w3.org/1999/xlink">PMAKE</envar>, is
	examined by <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> for command-line
	flags, variable assignments, etc., it should always use.  This
	variable is examined before the actual arguments to
	<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> are.  In addition, all flags
	given to <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>, either through the
	<envar xmlns:xlink="http://www.w3.org/1999/xlink">PMAKE</envar> variable or on the command line, are
	placed in this environment variable and exported to each shell
	<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> executes.  Thus recursive
	invocations of <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> automatically
	receive the same flags as the top-most one.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Using all these variables, you can compress the sample
	makefile even more:</para>

      <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">OBJS            = a.o b.o c.o

program         : $(OBJS)
        cc $(.ALLSRC) -o $(.TARGET)

$(OBJS)         : defs.h

a.o             : a.c
        cc -c a.c

b.o             : b.c
        cc -c b.c

c.o             : c.c
        cc -c c.c</programlisting>
    </section>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="comments">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Comments</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Comments in a makefile start with a <literal xmlns:xlink="http://www.w3.org/1999/xlink">#</literal>
      character and extend to the end of the line.  They may appear
      anywhere you want them, except in a shell command (though the
      shell will treat it as a comment, too).  If, for some reason,
      you need to use the <literal xmlns:xlink="http://www.w3.org/1999/xlink">#</literal> in a variable or on a
      dependency line, put a backslash in front of it.
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will compress the two into a
      single <literal xmlns:xlink="http://www.w3.org/1999/xlink">#</literal>.</para>

    <note xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">This is not true if <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is
	operating in full-compatibility mode).</para>
    </note>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="parellelism">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Parallelism</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> was specifically designed
      to re-create several targets at once, when possible. You do not
      have to do anything special to cause this to happen (unless
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> was configured to not act in
      parallel, in which case you will have to make use of the
      <option xmlns:xlink="http://www.w3.org/1999/xlink">-L</option> and <option xmlns:xlink="http://www.w3.org/1999/xlink">-J</option> flags (see below)),
      but you do have to be careful at times.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">There are several problems you are likely to encounter.  One
      is that some makefiles (and programs) are written in such a way
      that it is impossible for two targets to be made at once.  The
      program <application xmlns:xlink="http://www.w3.org/1999/xlink">xstr</application>, for example, always
      modifies the files <filename xmlns:xlink="http://www.w3.org/1999/xlink">strings</filename> and
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">x.c</filename>.  There is no way to change it.  Thus
      you cannot run two of them at once without something being
      trashed.  Similarly, if you have commands in the makefile that
      always send output to the same file, you will not be able to
      make more than one target at once unless you change the file you
      use.  You can, for instance, add a <literal xmlns:xlink="http://www.w3.org/1999/xlink">$$$$</literal> to
      the end of the file name to tack on the process ID of the shell
      executing the command (each <literal xmlns:xlink="http://www.w3.org/1999/xlink">$$</literal> expands to a
      single <literal xmlns:xlink="http://www.w3.org/1999/xlink">$</literal>, thus giving you the shell variable
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">$$</literal>).  Since only one shell is used for all
      the commands, you will get the same file name for each command
      in the script.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The other problem comes from improperly-specified
      dependencies that worked in <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application>
      because of its sequential, depth-first way of examining them.
      While I do not want to go into depth on how
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> works (look in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="gods"/> if you are interested), I will warn you that
      files in two different levels of the dependency tree may be
      examined in a different order in
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> than they were in
      <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application>.
      For example, given the makefile:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">a               :

b c b           : d</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will examine the targets in
      the order <buildtarget>c</buildtarget>,
      <buildtarget>d</buildtarget>, <buildtarget>b</buildtarget>,
      <buildtarget>a</buildtarget>.  If the makefile's author expected
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to abort before making
      <buildtarget>c</buildtarget> if an error occurred while making
      <buildtarget>b</buildtarget>, or if <buildtarget>b</buildtarget>
      needed to exist before <buildtarget>c</buildtarget> was made,
      (s)he will be sorely disappointed.  The dependencies are
      incomplete, since in both these cases,
      <buildtarget>c</buildtarget> would depend on
      <buildtarget>b</buildtarget>.  So watch out.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Another problem you may face is that, while
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is set up to handle the output
      from multiple jobs in a graceful fashion, the same is not so for
      input.  It has no way to regulate input to different jobs, so if
      you use the redirection from <filename xmlns:xlink="http://www.w3.org/1999/xlink">/dev/tty</filename> I
      mentioned earlier, you must be careful not to run two of the
      jobs at once.</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="writeanddebug">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Writing and Debugging a Makefile</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Now you know most of what is in a
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">Makefile</filename>, what do you do next?  There are
      two choices: use one of the uncommonly-available makefile
      generators or write your own makefile (I leave out the third
      choice of ignoring <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> and doing
      everything by hand as being beyond the bounds of common
      sense).</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">When faced with the writing of a makefile, it is usually
      best to start from first principles: just what are you trying to
      do?  What do you want the makefile finally to produce?  To begin
      with a somewhat traditional example, let's say you need to write
      a makefile to create a program, <command xmlns:xlink="http://www.w3.org/1999/xlink">expr</command>, that
      takes standard infix expressions and converts them to prefix
      form (for no readily apparent reason).  You have got three
      source files, in C, that make up the program:
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">main.c</filename>, <filename xmlns:xlink="http://www.w3.org/1999/xlink">parse.c</filename>, and
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">output.c</filename>.  Harking back to my pithy advice
      about dependency lines, you write the first line of the
      file:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">expr            : main.o parse.o output.o</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">because you remember <filename xmlns:xlink="http://www.w3.org/1999/xlink">expr</filename> is made from
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">.o</filename> files, not <filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename>
      files.  Similarly for the <filename xmlns:xlink="http://www.w3.org/1999/xlink">.o</filename> files you
      produce the lines:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">main.o          : main.c

parse.o         : parse.c

output.o        : output.c

main.o parse.o output.o : defs.h</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Great.  You have now got the dependencies specified.  What
      you need now is commands.  These commands, remember, must
      produce the target on the dependency line, usually by using the
      sources you have listed.  You remember about local variables?
      Good, so it should come to you as no surprise when you
      write:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">expr            : main.o parse.o output.o
	cc -o $(.TARGET) $(.ALLSRC)</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Why use the variables?  If your program grows to produce
      postfix expressions too (which, of course, requires a name
      change or two), it is one fewer place you have to change the
      file. You cannot do this for the object files, however, because
      they depend on their corresponding source files and
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">defs.h</filename>, thus if you said:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">cc -c $(.ALLSRC)</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">you will get (for <filename xmlns:xlink="http://www.w3.org/1999/xlink">main.o</filename>):</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">cc -c main.c defs.h</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">which is wrong.  So you round out the makefile with these
      lines:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">main.o          : main.c
	cc -c main.c

parse.o         : parse.c
	cc -c parse.c

output.o        : output.c
	cc -c output.c</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The makefile is now complete and will, in fact, create the
      program you want it to without unnecessary compilations or
      excessive typing on your part.  There are two things wrong with
      it, however (aside from it being altogether too long, something
      I will address in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="shortcuts"/>):</para>

    <orderedlist xmlns:xlink="http://www.w3.org/1999/xlink">
      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The string <literal xmlns:xlink="http://www.w3.org/1999/xlink">main.o parse.o output.o</literal> is
	  repeated twice, necessitating two changes when you add
	  postfix (you were planning on that, were not you?).  This is
	  in direct violation of de Boor's First Rule of writing
	  makefiles:</para>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Anything that needs to be written more than once should
	  be placed in a variable.  I cannot emphasize this enough as
	  being very important to the maintenance of a makefile and
	  its program.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">There is no way to alter the way compilations are
	  performed short of editing the makefile and making the
	  change in all places.  This is evil and violates de Boor's
	  Second Rule, which follows directly from the first:</para>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Any flags or programs used inside a makefile should be
	  placed in a variable so they may be changed, temporarily or
	  permanently, with the greatest ease.</para>
      </listitem>
    </orderedlist>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The makefile should more properly read:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">OBJS            = main.o parse.o output.o

expr            : $(OBJS)
	$(CC) $(CFLAGS) -o $(.TARGET) $(.ALLSRC)

main.o          : main.c
	$(CC) $(CFLAGS) -c main.c

parse.o         : parse.c
	$(CC) $(CFLAGS) -c parse.c

output.o        : output.c
	$(CC) $(CFLAGS) -c output.c

$(OBJS)         : defs.h</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Alternatively, if you like the idea of dynamic sources
      mentioned in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="localvariables"/>, you could write it
      like this:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">OBJS            = main.o parse.o output.o

expr            : $(OBJS)
	$(CC) $(CFLAGS) -o $(.TARGET) $(.ALLSRC)

$(OBJS)         : $(.PREFIX).c defs.h
	$(CC) $(CFLAGS) -c $(.PREFIX).c</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">These two rules and examples lead to de Boor's First
      Corollary:
      <emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Variables are your friends</emphasis>.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Once you have written the makefile comes the
      sometimes-difficult task of making sure the darn thing works.
      Your most helpful tool to make sure the makefile is at least
      syntactically correct is the <option xmlns:xlink="http://www.w3.org/1999/xlink">-n</option> flag, which
      allows you to see if <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will choke
      on the makefile.  The second thing the <option xmlns:xlink="http://www.w3.org/1999/xlink">-n</option> flag
      lets you do is see what <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> would
      do without it actually doing it, thus you can make sure the
      right commands would be executed were you to give
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> its head.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">When you find your makefile is not behaving as you hoped,
      the first question that comes to mind (after <quote xmlns:xlink="http://www.w3.org/1999/xlink">What time is
      it, anyway?</quote>) is <quote xmlns:xlink="http://www.w3.org/1999/xlink">Why not?</quote> In answering
      this, two flags will serve you well: <literal xmlns:xlink="http://www.w3.org/1999/xlink">-d m</literal> and
      <quote xmlns:xlink="http://www.w3.org/1999/xlink">-p 2</quote>.
      The first causes <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to tell you as
      it examines each target in the makefile and indicate why it is
      deciding whatever it is deciding.  You can then use the
      information printed for other targets to see where you went
      wrong.  The <quote xmlns:xlink="http://www.w3.org/1999/xlink">-p 2</quote> flag makes
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> print out its internal state
      when it is done, allowing you to see that you forgot to make
      that one chapter depend on that file of macros you just got a
      new version of.  The output from <quote xmlns:xlink="http://www.w3.org/1999/xlink">-p 2</quote> is intended
      to resemble closely a real makefile, but with additional
      information provided and with variables expanded in those
      commands <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> actually printed or
      executed.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Something to be especially careful about is circular
      dependencies.  For example:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">a         : b

b         : c d

d         : a</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">In this case,
      because of how <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> works,
      <buildtarget>c</buildtarget> is the only thing
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will examine, because
      <buildtarget>d</buildtarget> and <buildtarget>a</buildtarget> will
      effectively fall off the edge of the universe, making it
      impossible to examine <buildtarget>b</buildtarget> (or them, for
      that matter).  <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will tell you
      (if run in its normal mode) all the targets involved in any
      cycle it looked at (i.e. if you have two cycles in the
      graph (naughty, naughty), but only try to make a target in one
      of them, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will only tell you
      about that one.  You will have to try to make the other to find
      the second cycle).  When run as <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application>,
      it will only print the first target in the cycle.</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="invoking">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Invoking PMake</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> comes with a wide variety
      of flags to choose from.  They may appear in any order,
      interspersed with command-line variable assignments and targets
      to create.  The flags are as follows:</para>

    <variablelist xmlns:xlink="http://www.w3.org/1999/xlink">
      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-d <replaceable xmlns:xlink="http://www.w3.org/1999/xlink">what</replaceable></option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This causes <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to spew
	    out debugging information that may prove useful to you.
	    If you cannot figure out why
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is doing what it is
	    doing, you might try using this flag.
	    The <replaceable xmlns:xlink="http://www.w3.org/1999/xlink">what</replaceable> parameter is a string
	    of single characters that tell
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> what aspects you are
	    interested in.  Most of what I describe will make little
	    sense to you, unless you have dealt with
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application> before.  Just remember
	    where this table is and come back to it as you read on.
	    The characters and the information they produce are as
	    follows:</para>

	  <informaltable xmlns:xlink="http://www.w3.org/1999/xlink" frame="none">
	    <tgroup xmlns:xlink="http://www.w3.org/1999/xlink" cols="2">
	      <tbody xmlns:xlink="http://www.w3.org/1999/xlink">
		<row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
		  <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">a</literal></entry>

		  <entry xmlns:xlink="http://www.w3.org/1999/xlink">Archive searching and caching.</entry>
		</row>

		<row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
		  <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">c</literal></entry>

		  <entry xmlns:xlink="http://www.w3.org/1999/xlink">Conditional evaluation.</entry>
		</row>

		<row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
		  <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">d</literal></entry>

		  <entry xmlns:xlink="http://www.w3.org/1999/xlink">The searching and caching of
		    directories.</entry>
		</row>

		<row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
		  <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">j</literal></entry>

		  <entry xmlns:xlink="http://www.w3.org/1999/xlink">Various snippets of information related to
		    the running of the multiple shells.  Not
		    particularly interesting.</entry>
		</row>

		<row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
		  <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">m</literal></entry>

		  <entry xmlns:xlink="http://www.w3.org/1999/xlink">The making of each target: what target is
		    being examined; when it was last modified; whether
		    it is out-of-date; etc.</entry>
		</row>

		<row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
		  <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">p</literal></entry>

		  <entry xmlns:xlink="http://www.w3.org/1999/xlink">Makefile parsing.</entry>
		</row>

		<row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
		  <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">r</literal></entry>

		  <entry xmlns:xlink="http://www.w3.org/1999/xlink">Remote execution.</entry>
		</row>

		<row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
		  <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">s</literal></entry>

		  <entry xmlns:xlink="http://www.w3.org/1999/xlink">The application of suffix-transformation
		    rules.  (See <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="shortcuts"/>.)</entry>
		</row>

		<row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
		  <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">t</literal></entry>

		  <entry xmlns:xlink="http://www.w3.org/1999/xlink">The maintenance of the list of targets.</entry>
		</row>

		<row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
		  <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">v</literal></entry>

		  <entry xmlns:xlink="http://www.w3.org/1999/xlink">Variable assignment.</entry>
		</row>
	      </tbody>
	    </tgroup>
	  </informaltable>

	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Of these all, the <literal xmlns:xlink="http://www.w3.org/1999/xlink">m</literal> and
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">s</literal> letters will be most useful to you.
	    If the <option xmlns:xlink="http://www.w3.org/1999/xlink">-d</option> is the final argument or the
	    argument from which it would get these key letters (see
	    below for a note about which argument would be used)
	    begins with a &#8211;, all of these debugging flags will
	    be set, resulting in massive amounts of output.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-f</option> makefile</term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Specify a makefile to read different from the standard
	  makefiles (<filename xmlns:xlink="http://www.w3.org/1999/xlink">Makefile</filename> or
	  <filename xmlns:xlink="http://www.w3.org/1999/xlink">makefile</filename>).
	  If makefile is <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal>,
	  <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> uses the standard input.
	  This is useful for making quick and dirty makefiles.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-h</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Prints out a summary of the various flags
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> accepts.
	    It can also be used to find out what level of concurrency was
	    compiled into the version of <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> you
	    are using (look at <literal xmlns:xlink="http://www.w3.org/1999/xlink">-J</literal> and
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">-L</literal>) and various other information on how
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> was configured.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-i</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">If you give this flag, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will
	    ignore non-zero status returned by any of its shells.  It is like
	    placing a <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal> before all the commands in the
	    makefile.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-k</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This is similar to <option xmlns:xlink="http://www.w3.org/1999/xlink">-i</option> in that it allows
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to continue when it sees an
	    error, but unlike <option xmlns:xlink="http://www.w3.org/1999/xlink">-i</option>, where
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> continues blithely as if nothing
	    went wrong, <option xmlns:xlink="http://www.w3.org/1999/xlink">-k</option> causes it to recognize the error
	    and only continue work on those things that do not depend on the
	    target, either directly or indirectly (through depending on
	    something that depends on it), whose creation returned the error.
	    The <option xmlns:xlink="http://www.w3.org/1999/xlink">k</option> is for <quote xmlns:xlink="http://www.w3.org/1999/xlink">keep going</quote>.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-l</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> has the ability to lock a
	    directory against other people executing it in the same directory
	    (by means of a file called <filename xmlns:xlink="http://www.w3.org/1999/xlink">LOCK.make</filename> that it
	    creates and checks for in the directory).  This is a Good Thing
	    because two people doing the same thing in the same place can be
	    disastrous for the final product (too many cooks and all that).
	    Whether this locking is the default is up to your system
	    administrator.  If locking is on, <option xmlns:xlink="http://www.w3.org/1999/xlink">-l</option> will turn it
	    off, and vice versa.
	    Note that this locking will not prevent you from invoking
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> twice in the same place&#8211;if
	    you own the lock file, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will warn
	    you about it but continue to execute.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-m <replaceable xmlns:xlink="http://www.w3.org/1999/xlink">directory</replaceable></option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Tells <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> another place to search
	    for included makefiles via the
	    &lt;<replaceable xmlns:xlink="http://www.w3.org/1999/xlink">filename</replaceable>&gt; style.
	    Several <filename xmlns:xlink="http://www.w3.org/1999/xlink">-m</filename> options can be given to form a
	    search path.  If this construct is used the default system
	    makefile search path is completely overridden.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-n</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This flag tells <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> not to
	    execute the commands needed to update the out-of-date targets in
	    the makefile.  Rather, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will
	    simply print the commands it would have executed and exit.
	    This is particularly useful for checking the correctness of a
	    makefile.  If <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> does not do what
	    you expect it to, it is a good chance the makefile is wrong.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-p number</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This causes <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to print its
	    input in a reasonable form, though not necessarily one that would
	    make immediate sense to anyone but me.  The number is a bitwise OR
	    of 1 and 2, where 1 means it should print the input before doing
	    any processing and 2 says it should print it after everything has
	    been re-created.
	    Thus <option xmlns:xlink="http://www.w3.org/1999/xlink">-p 3</option> would print it twice-a-once before
	    processing and once after (you might find the difference between
	    the two interesting).  This is mostly useful to me, but you may
	    find it informative in some bizarre circumstances.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-q</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">If you give <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> this flag, it
	    will not try to re-create anything.  It will just see if anything
	    is out-of-date and exit non-zero if so.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-r</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">When <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> starts up, it reads a
	    default makefile that tells it what sort of system it is on and
	    gives it some idea of what to do if you do not tell it anything.
	    I will tell you about it in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="shortcuts"/>.
	    If you give this flag, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will not
	    read the default makefile.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-s</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This causes <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to not print
	    commands before they are executed.  It is the equivalent of
	    putting an <quote xmlns:xlink="http://www.w3.org/1999/xlink">@</quote> before every command in the
	    makefile.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-t</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Rather than try to re-create a target,
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will simply <quote xmlns:xlink="http://www.w3.org/1999/xlink">touch</quote>
	    it so as to make it appear up-to-date.
	    If the target did not exist before, it will when
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> finishes, but if the target did
	    exist, it will appear to have been updated.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-v</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Targets can still be created in parallel, however.
	    This is the mode <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will enter
	    if it is invoked either as <command xmlns:xlink="http://www.w3.org/1999/xlink">smake</command> or
	    <command xmlns:xlink="http://www.w3.org/1999/xlink">vmake</command>.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-x</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This tells <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> it is OK to export
	    jobs to other machines, if they are available.  It is used when
	    running in Make mode, as exporting in this mode tends to make
	    things run slower than if the commands were just executed
	    locally.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-B</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Forces <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to be as
	    backwards-compatible with <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application> as
	    possible while still being itself.  This includes:</para>

	  <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	      <para xmlns:xlink="http://www.w3.org/1999/xlink">Executing one shell per shell command</para>
	    </listitem>

	    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	      <para xmlns:xlink="http://www.w3.org/1999/xlink">Expanding anything that looks even vaguely like a
		variable, with the empty string replacing any variable
		<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> does not know.</para>
	    </listitem>

	    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	      <para xmlns:xlink="http://www.w3.org/1999/xlink">Refusing to allow you to escape a <literal xmlns:xlink="http://www.w3.org/1999/xlink">#</literal>
		with a backslash.</para>
	    </listitem>

	    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	      <para xmlns:xlink="http://www.w3.org/1999/xlink">Permitting undefined variables on dependency lines and
		conditionals (see below).  Normally this causes
		<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to abort.</para>
	    </listitem>
	  </itemizedlist>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-C</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This nullifies any and all compatibility mode flags you may
	    have given or implied up to the time the <option xmlns:xlink="http://www.w3.org/1999/xlink">-C</option> is
	    encountered.  It is useful mostly in a makefile that you wrote for
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to avoid bad things happening
	    when someone runs <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> as
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">make</application> or has things set in the
	    environment that tell it to be compatible.
	    <option xmlns:xlink="http://www.w3.org/1999/xlink">-C</option> is not placed in the <envar xmlns:xlink="http://www.w3.org/1999/xlink">PMAKE</envar>
	    environment variable or the <varname xmlns:xlink="http://www.w3.org/1999/xlink">.MAKEFLAGS</varname> or
	    <envar xmlns:xlink="http://www.w3.org/1999/xlink">MFLAGS</envar> global variables.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-D <replaceable xmlns:xlink="http://www.w3.org/1999/xlink">variable</replaceable></option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Allows you to define a variable to have <quote xmlns:xlink="http://www.w3.org/1999/xlink">1</quote> as
	    its value.  The variable is a global variable, not a command-line
	    variable.  This is useful mostly for people who are used to the C
	    compiler arguments and those using conditionals, which I will get
	    into in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="condition"/>.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-I <replaceable xmlns:xlink="http://www.w3.org/1999/xlink">directory</replaceable></option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Tells <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> another place to search
	    for included makefiles.  Yet another thing to be explained in
	    <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="shortcuts"/> (<xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="including"/>, to be
	    precise).</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-J <replaceable xmlns:xlink="http://www.w3.org/1999/xlink">number</replaceable></option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Gives the absolute maximum number of targets to create at once
	    on both local and remote machines.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-L <replaceable xmlns:xlink="http://www.w3.org/1999/xlink">number</replaceable></option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This specifies the maximum number of targets to create on the
	    local machine at once.
	    This may be <literal xmlns:xlink="http://www.w3.org/1999/xlink">0</literal>, though you should be wary of
	    doing this, as <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> may hang until a
	    remote machine becomes available, if one is not available when it
	    is started.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-M</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This is the flag that provides absolute, complete, full
	    compatibility with <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application>.  It still
	    allows you to use all but a few of the features of
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>, but it is non-parallel.
	    This is the mode <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> enters if you
	    call it <command xmlns:xlink="http://www.w3.org/1999/xlink">make</command>.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-P</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">When creating targets in parallel, several shells are
	    executing at once, each wanting to write its own two cents'-worth
	    to the screen.
	    This output must be captured by <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	    in some way  in order to prevent the screen from being filled with
	    garbage even more indecipherable than you usually see.
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> has two ways of doing this, one
	    of which provides for much cleaner output and a clear separation
	    between the output of different jobs, the other of which provides
	    a more immediate response so one can tell what is really
	    happening.  The former is done by notifying you when the creation
	    of a target starts, capturing the output and transferring it to
	    the screen all at once when the job finishes.  The latter is done
	    by catching the output of the shell (and its children) and
	    buffering it until an entire line is received, then printing that
	    line preceded by an indication of which job produced the output.
	    Since I prefer this second method, it is the one used by default.
	    The first method will be used if you give the <option xmlns:xlink="http://www.w3.org/1999/xlink">-P</option>
	    flag to <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-V</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">As mentioned before, the <option xmlns:xlink="http://www.w3.org/1999/xlink">-V</option> flag tells
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to use
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application>'s style of expanding variables,
	    substituting the empty string for any variable it does not
	    know.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-W</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">There are several times when <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	    will print a message at you that is only a warning, i.e. it
	    can continue to work in spite of your having done something silly
	    (such as forgotten a leading tab for a shell command).  Sometimes
	    you are well aware of silly things you have done and would like
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to stop bothering you.  This flag
	    tells it to shut up about anything non-fatal.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><option xmlns:xlink="http://www.w3.org/1999/xlink">-X</option></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This flag causes <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to not
	    attempt to export any jobs to another machine.</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Several flags may follow a single <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal>.  Those flags
      that require arguments take them from successive parameters.
      For example:</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink">pmake -fDnI server.mk DEBUG /chip2/X/server/include</screen>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">will cause <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to read
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">server.mk</filename> as the input makefile,
      define the variable <varname xmlns:xlink="http://www.w3.org/1999/xlink">DEBUG</varname> as a global variable and
      look  for included makefiles in the directory
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/chip2/X/server/include</filename>.</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="summary">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Summary</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">A makefile is made of four types of lines:</para>

    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Dependency lines</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Creation commands</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Variable assignments</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Comments, include statements and conditional directives</para>
      </listitem>
    </itemizedlist>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">A dependency line is a list of one or more targets, an operator
      (<literal xmlns:xlink="http://www.w3.org/1999/xlink">:</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">::</literal>, or <literal xmlns:xlink="http://www.w3.org/1999/xlink">!</literal>),
      and a list of zero or more sources.  Sources may contain wildcards and
      certain local variables.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">A creation command is a regular shell command preceded by a tab.  In
      addition, if the first two characters after the tab
      (and other whitespace) are a combination of <literal xmlns:xlink="http://www.w3.org/1999/xlink">@</literal> or
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal>, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will cause the
      command to not be printed (if the character is <literal xmlns:xlink="http://www.w3.org/1999/xlink">@</literal>) or
      errors from it to be ignored (if <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal>).  A blank line,
      dependency line or variable assignment terminates a creation script.
      There may be only one creation script for each target with a
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">:</literal> or <literal xmlns:xlink="http://www.w3.org/1999/xlink">!</literal> operator.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Variables are places to store text.  They may be unconditionally
      assigned-to using the <literal xmlns:xlink="http://www.w3.org/1999/xlink">=</literal> operator, appended-to using
      the <literal xmlns:xlink="http://www.w3.org/1999/xlink">+=</literal> operator, conditionally (if the variable is
      undefined) assigned-to with the <literal xmlns:xlink="http://www.w3.org/1999/xlink">?=</literal> operator, and
      assigned-to with variable expansion with the <literal xmlns:xlink="http://www.w3.org/1999/xlink">:=</literal>
      operator.  The output of a shell command may be assigned to a variable
      using the <literal xmlns:xlink="http://www.w3.org/1999/xlink">!=</literal> operator.  Variables may be expanded
      (their value inserted) by enclosing their name in parentheses or curly
      braces, preceded by a dollar sign.  A dollar sign may be escaped with
      another dollar sign.  Variables are not expanded if
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> does not know about them.
      There are seven local variables: <varname xmlns:xlink="http://www.w3.org/1999/xlink">.TARGET</varname>,
      <varname xmlns:xlink="http://www.w3.org/1999/xlink">.ALLSRC</varname>, <varname xmlns:xlink="http://www.w3.org/1999/xlink">.OODATE</varname>,
      <varname xmlns:xlink="http://www.w3.org/1999/xlink">.PREFIX</varname>, <varname xmlns:xlink="http://www.w3.org/1999/xlink">.IMPSRC</varname>,
      <varname xmlns:xlink="http://www.w3.org/1999/xlink">.ARCHIVE</varname>, and <varname xmlns:xlink="http://www.w3.org/1999/xlink">.MEMBER</varname>.
      Four of them (<varname xmlns:xlink="http://www.w3.org/1999/xlink">.TARGET</varname>, <varname xmlns:xlink="http://www.w3.org/1999/xlink">.PREFIX</varname>,
      <varname xmlns:xlink="http://www.w3.org/1999/xlink">.ARCHIVE</varname>, and <varname xmlns:xlink="http://www.w3.org/1999/xlink">.MEMBER</varname>) may be used
      to specify <quote xmlns:xlink="http://www.w3.org/1999/xlink">dynamic sources</quote>.  Variables are good.  Know
      them.  Love them.  Live them.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Debugging of makefiles is best accomplished using the
      <option xmlns:xlink="http://www.w3.org/1999/xlink">-n</option>, <option xmlns:xlink="http://www.w3.org/1999/xlink">-d m</option>, and
      <option xmlns:xlink="http://www.w3.org/1999/xlink">-p 2</option> flags.</para>
  </section>
</chapter>

  
<!--
    $FreeBSD$
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="shortcuts">
  <title xmlns:xlink="http://www.w3.org/1999/xlink">Short-cuts and Other Nice Things</title>

  <para xmlns:xlink="http://www.w3.org/1999/xlink">Based on what I have told you so far, you may have gotten the
    impression that <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is just a way of
    storing away commands and making sure you do not forget to compile
    something.  Good.  That is just what it is.  However, the ways I
    have described have been inelegant, at best, and painful, at
    worst.  This chapter contains things that make the writing of
    makefiles easier and the makefiles themselves shorter and easier
    to modify (and, occasionally, simpler).  In this chapter, I assume
    you are somewhat more familiar with Sprite (or <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark>, if that is
    what you are using) than I did in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="basics"/>, just so
    you are on your toes.  So without further ado&#8230;</para>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="rules">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Transformation Rules</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">As you know, a file's name consists of two parts: a base
      name, which gives some hint as to the contents of the file, and
      a suffix, which usually indicates the format of the file.  Over
      the years, as <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark> has developed, naming conventions, with
      regard to suffixes, have also developed that have become almost
      as incontrovertible as Law.  E.g. a file ending in
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename> is assumed to contain C source code; one
      with a <filename xmlns:xlink="http://www.w3.org/1999/xlink">.o</filename> suffix is assumed to be a
      compiled, relocatable object file that may be linked into any
      program; a file with a <filename xmlns:xlink="http://www.w3.org/1999/xlink">.ms</filename> suffix is
      usually a text file to be processed by
      <application xmlns:xlink="http://www.w3.org/1999/xlink">Troff</application> with the <literal xmlns:xlink="http://www.w3.org/1999/xlink">-ms</literal>
      macro package, and so on.  One of the best aspects of both
      <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application> and
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> comes from their understanding
      of how the suffix of a file pertains to its contents and their
      ability to do things with a file based solely on its suffix.
      This ability comes from something known as a transformation
      rule.  A transformation rule specifies how to change a file with
      one suffix into a file with another suffix.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">A transformation rule looks much like a dependency line,
      except the target is made of two known suffixes stuck
      together.  Suffixes are made known to
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> by placing them
      as sources on a dependency line whose target is the special
      target <varname xmlns:xlink="http://www.w3.org/1999/xlink">.SUFFIXES</varname>.  E.g.:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">.SUFFIXES   : .o .c
.c.o        :
	$(CC) $(CFLAGS) -c $(.IMPSRC)</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The creation script attached to the target is used to
      trans form a file with the first suffix (in this case,
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename>) into a
      file with the second suffix (here, <filename xmlns:xlink="http://www.w3.org/1999/xlink">.o</filename>).
      In addition, the target inherits whatever attributes have
      been applied to the transformation rule.
      The simple rule given above says that to transform a C source
      file into an object file, you compile it using
      <application xmlns:xlink="http://www.w3.org/1999/xlink">cc</application> with the <option xmlns:xlink="http://www.w3.org/1999/xlink">-c</option>
      flag.  This rule is taken straight from the system makefile.
      Many transformation rules (and suffixes) are defined there,
      and I refer you to it for more examples
      (type <command xmlns:xlink="http://www.w3.org/1999/xlink">pmake -h</command> to find out where it
      is).</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">There are several things to note about the
      transformation rule given above:</para>

    <orderedlist xmlns:xlink="http://www.w3.org/1999/xlink">
      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The <varname xmlns:xlink="http://www.w3.org/1999/xlink">.IMPSRC</varname> variable.
	  This variable is set to the
	  <quote xmlns:xlink="http://www.w3.org/1999/xlink">implied source</quote> (the file from which
	  the target is  being created; the one with the first
	  suffix), which, in this case, is the
	  <filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename> file.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The <envar xmlns:xlink="http://www.w3.org/1999/xlink">CFLAGS</envar> variable.  Almost all of
	  the transformation rules in the system makefile are set
	  up using variables that you can alter in your makefile
	  to tailor the rule to your needs.  In this case, if you
	  want all your C files to be compiled with the
	  <option xmlns:xlink="http://www.w3.org/1999/xlink">-g</option> flag, to provide information for
	  dbx, you would set the <envar xmlns:xlink="http://www.w3.org/1999/xlink">CFLAGS</envar> variable to
	  contain <option xmlns:xlink="http://www.w3.org/1999/xlink">-g</option> (<literal xmlns:xlink="http://www.w3.org/1999/xlink">CFLAGS  =
	  -g</literal>) and <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	  would take care of the rest.</para>
      </listitem>
    </orderedlist>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">To give you a quick example, the makefile in
      <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="envvars"/> could be changed to this:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">OBJS            = a.o b.o c.o
program         : $(OBJS)
	 $(CC) -o $(.TARGET) $(.ALLSRC)
$(OBJS)         : defs.h</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The transformation rule I gave above takes the place of the
      6 lines
      <footnote xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">This is also somewhat cleaner, I think, than
	  the dynamic source solution presented in
	  <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="writeanddebug"/>.</para>
      </footnote>:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">a.o             : a.c
	cc -c a.c
b.o             : b.c
	cc -c b.c
c.o             : c.c
	cc -c c.c</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Now you may be wondering about the dependency between the
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">.o</filename>
      and <filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename> files &#8211; it is not mentioned
      anywhere in the new makefile.  This is because it is not needed:
      one of the effects of applying a transformation rule is the
      target comes to depend on the implied source.  That's why it is
      called the implied source.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">For a more detailed example.  Say you have a makefile like
      this:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">a.out           : a.o b.o
	$(CC) $(.ALLSRC)</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">and a directory set up like this:</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink">total 4
-rw-rw-r--  1 deboor        34 Sep  7 00:43 Makefile
-rw-rw-r--  1 deboor       119 Oct  3 19:39 a.c
-rw-rw-r--  1 deboor       201 Sep  7 00:43 a.o
-rw-rw-r--  1 deboor        69 Sep  7 00:43 b.c</screen>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">While just typing <command xmlns:xlink="http://www.w3.org/1999/xlink">pmake</command> will do
      the right thing, it is much more informative to type
      <command xmlns:xlink="http://www.w3.org/1999/xlink">pmake -d s</command>.  This will
      show you what <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is up
      to as it processes the files.  In this case,
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> prints the following:</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink">Suff_FindDeps (a.out)
     using existing source a.o
     applying .o -&gt; .out to "a.o"
Suff_FindDeps (a.o)
     trying a.c...got it
     applying .c -&gt; .o to "a.c"
Suff_FindDeps (b.o)
     trying b.c...got it
     applying .c -&gt; .o to "b.c"
Suff_FindDeps (a.c)
     trying a.y...not there
     trying a.l...not there
     trying a.c,v...not there
     trying a.y,v...not there
     trying a.l,v...not there
Suff_FindDeps (b.c)
     trying b.y...not there
     trying b.l...not there
     trying b.c,v...not there
     trying b.y,v...not there
     trying b.l,v...not there
--- a.o ---
cc  -c a.c
--- b.o ---
cc  -c b.c
--- a.out ---
cc a.o b.o</screen>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><computeroutput xmlns:xlink="http://www.w3.org/1999/xlink">Suff_FindDeps</computeroutput> is the
      name of a function in <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> that
      is called to check for implied sources for a target using
      transformation rules.  The transformations it tries are,
      naturally enough, limited to the ones that have been defined
      (a transformation may be defined multiple times, by the way,
      but only the most recent one will be used).  You will notice,
      however, that there is a definite order to the suffixes that
      are tried.  This order is set by the relative positions of
      the suffixes on the <varname xmlns:xlink="http://www.w3.org/1999/xlink">.SUFFIXES</varname> line
      &#8211; the earlier a suffix appears, the earlier it is
      checked as the source of a transformation.  Once a suffix
      has been defined, the only way to change its position in the
      pecking order is to remove all the suffixes (by having a
      <varname xmlns:xlink="http://www.w3.org/1999/xlink">.SUFFIXES</varname> dependency line with no sources)
      and redefine them in the order you want.
      (Previously-defined transformation rules will be
      automatically redefined as the suffixes they involve are
      re-entered.)  Another way to affect the search order is to make
      the dependency explicit.  In the above example,
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">a.out</filename> depends on <filename xmlns:xlink="http://www.w3.org/1999/xlink">a.o</filename>
      and <filename xmlns:xlink="http://www.w3.org/1999/xlink">b.o</filename>.  Since a transformation exists
      from <filename xmlns:xlink="http://www.w3.org/1999/xlink">.o</filename> to <filename xmlns:xlink="http://www.w3.org/1999/xlink">.out</filename>,
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> uses that, as indicated by
      the <computeroutput xmlns:xlink="http://www.w3.org/1999/xlink">using existing source a.o</computeroutput>
      message.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The search for a transformation starts from the suffix of
      the target and continues through all the defined
      transformations, in the order dictated by the suffix ranking,
      until an existing file with the same base (the target name
      minus the suffix and any leading directories) is found.  At that
      point, one or more transformation rules will have been found
      to change the one existing file into the target.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">For example, ignoring what's in the system makefile for
      now, say you have a makefile like this:</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink">.SUFFIXES       : .out .o .c .y .l
.l.c            :
	lex $(.IMPSRC)
	mv lex.yy.c $(.TARGET)
.y.c            :
	yacc $(.IMPSRC)
	mv y.tab.c $(.TARGET)
.c.o            :
	cc -c $(.IMPSRC)
.o.out          :
	cc -o $(.TARGET) $(.IMPSRC)</screen>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">and the single file <filename xmlns:xlink="http://www.w3.org/1999/xlink">jive.l</filename>.
      If you were to type <command xmlns:xlink="http://www.w3.org/1999/xlink">pmake -rd ms jive.out</command>,
      you would get the following output for
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">jive.out</filename>:</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink">Suff_FindDeps (jive.out)
     trying jive.o...not there
     trying jive.c...not there
     trying jive.y...not there
     trying jive.l...got it
     applying .l -&gt; .c to "jive.l"
     applying .c -&gt; .o to "jive.c"
     applying .o -&gt; .out to "jive.o"</screen>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">and this is why: <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> starts with the
      target <filename xmlns:xlink="http://www.w3.org/1999/xlink">jive.out</filename>, figures out its suffix
      (<filename xmlns:xlink="http://www.w3.org/1999/xlink">.out</filename>) and looks for things it  can
      transform to a <filename xmlns:xlink="http://www.w3.org/1999/xlink">.out</filename> file.  In this case, it
      only finds <filename xmlns:xlink="http://www.w3.org/1999/xlink">.o</filename>, so it looks for the file
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">jive.o</filename>.  It fails to find it, so it
      looks for transformations into a <filename xmlns:xlink="http://www.w3.org/1999/xlink">.o</filename>
      file.  Again it has only one choice: <filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename>.
      So it looks for <filename xmlns:xlink="http://www.w3.org/1999/xlink">jive.c</filename> and, as you
      know, fails to find it.  At this point it has two choices: it can
      create the <filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename> file from either a
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">.y</filename> file or a <filename xmlns:xlink="http://www.w3.org/1999/xlink">.l</filename> file.
      Since <filename xmlns:xlink="http://www.w3.org/1999/xlink">.y</filename> came first on the
      <varname xmlns:xlink="http://www.w3.org/1999/xlink">.SUFFIXES</varname> line, it checks for
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">jive.y</filename> first, but can not find it, so it looks
      for <filename xmlns:xlink="http://www.w3.org/1999/xlink">jive.l</filename> and, lo and behold, there it is.
      At this point, it has defined a transformation path as follows:</para>

    <literallayout xmlns:xlink="http://www.w3.org/1999/xlink"><filename xmlns:xlink="http://www.w3.org/1999/xlink">.l</filename>  -&gt;  <filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename>  -&gt;  <filename xmlns:xlink="http://www.w3.org/1999/xlink">.o</filename>  -&gt; <filename xmlns:xlink="http://www.w3.org/1999/xlink">.out</filename></literallayout>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">and applies the transformation rules accordingly.  For completeness,
      and to give you a better idea of what <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
      actually did with this three-step transformation, this is what
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> printed for the rest of the
      process:</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink">Suff_FindDeps (jive.o)
     using existing source jive.c
     applying .c -&gt; .o to "jive.c"
Suff_FindDeps (jive.c)
     using existing source jive.l
     applying .l -&gt; .c to "jive.l"
Suff_FindDeps (jive.l)
Examining jive.l...modified 17:16:01 Oct 4, 1987...up-to-date
Examining jive.c...non-existent...out-of-date
--- jive.c ---
lex jive.l
... meaningless lex output deleted ...
mv lex.yy.c jive.c
Examining jive.o...non-existent...out-of-date
--- jive.o ---
cc -c jive.c
Examining jive.out...non-existent...out-of-date
--- jive.out ---
cc -o jive.out jive.o</screen>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">One final question remains: what does
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> do with targets that have no
      known suffix?  <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> simply pretends
      it actually has a known suffix and searches for
      transformations accordingly.  The suffix it chooses is the
      source for the <buildtarget>.NULL</buildtarget> target mentioned
      later.  In the system makefile, <filename xmlns:xlink="http://www.w3.org/1999/xlink">.out</filename> is
      chosen as the <quote xmlns:xlink="http://www.w3.org/1999/xlink">null suffix</quote> because most people
      use <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to create programs.  You
      are, however, free and welcome to change it to a suffix
      of your own choosing.  The null suffix is ignored, however,
      when <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is in compatibility
      mode (see <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="gods"/>).</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="including">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Including Other Makefiles</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Just as for programs, it is often useful to extract certain
      parts of a makefile into another file and just include it in
      other makefiles somehow.  Many compilers allow you say something
      like:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">#include "defs.h"</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">to include the contents of <filename xmlns:xlink="http://www.w3.org/1999/xlink">defs.h</filename>
      in the source file.  <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
      allows you to do the same thing for makefiles, with the
      added ability to use variables in the filenames.  An include
      directive in a makefile looks either like this:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">#include &lt;file&gt;</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">or this:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">#include "file"</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The difference between the two is where
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> searches for the file: the first way,
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will look for the file only in the
      system makefile directory (or directories) (to find out what that
      directory is, give <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> the
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">-h</filename> flag).
      The system makefile directory search path can be overridden via the
      <option xmlns:xlink="http://www.w3.org/1999/xlink">-m</option> option.  For files in double-quotes, the search
      is more complex:</para>

    <orderedlist xmlns:xlink="http://www.w3.org/1999/xlink">
      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The directory of the makefile that's including the
	  file.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The current directory (the one in which you
	  invoked <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>).</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The directories given by you using
	  <option xmlns:xlink="http://www.w3.org/1999/xlink">-I</option> flags, in the order in which you
	  gave them.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Directories given by
	  <varname xmlns:xlink="http://www.w3.org/1999/xlink">.PATH</varname> dependency lines (see
	  <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="gods"/>).</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The system makefile directory.</para>
      </listitem>
    </orderedlist>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">in that order.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">You are free to use <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> variables
      in the filename &#8211; <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
      will expand them before searching for the file.  You  must
      specify the searching method with either angle brackets or
      double-quotes outside of a variable expansion.  I.e. the following:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">SYSTEM    = &lt;command.mk&gt;

#include $(SYSTEM)</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">will not work.</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="savingcmds">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Saving Commands</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">There may come a time when you will want to save certain
      commands to be executed when everything else is done.  For
      instance:  you are making several different libraries at one
      time and you want to create the members in parallel.  Problem is,
      <application xmlns:xlink="http://www.w3.org/1999/xlink">ranlib</application> is another one of those
      programs that can not be run more than once in the same directory
      at the same time (each one creates a file called
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">__.SYMDEF</filename> into which it stuffs information
      for the linker to use.  Two of them running at once will
      overwrite each other's file and the result will be garbage for
      both parties).  You might want a way to save the ranlib
      commands til the end so they can be run one after the other,
      thus keeping them from trashing each other's file.
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> allows you to do this by
      inserting an ellipsis (<quote xmlns:xlink="http://www.w3.org/1999/xlink">...</quote>) as a command between
      commands to be run at once and those to be run later.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">So for the <application xmlns:xlink="http://www.w3.org/1999/xlink">ranlib</application> case above,
      you might do this:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">lib1.a          : $(LIB1OBJS)
	rm -f $(.TARGET)
	ar cr $(.TARGET) $(.ALLSRC)
	...
	ranlib $(.TARGET)

lib2.a          : $(LIB2OBJS)
	rm -f $(.TARGET)
	ar cr $(.TARGET) $(.ALLSRC)
	...
	ranlib $(.TARGET)</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">This would save both</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">ranlib $(.TARGET)</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">commands until the end, when they would run one after the
      other (using the correct value for the
      <varname xmlns:xlink="http://www.w3.org/1999/xlink">.TARGET</varname> variable, of course).</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Commands saved in this manner are only executed if
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> manages to re-create
      everything without an error.</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="targetattr">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Target Attributes</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> allows you to give
      attributes to targets by means of special sources.  Like
      everything else <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> uses, these
      sources begin with a period and are made up of all upper-case
      letters.  There are various reasons for using them, and I will
      try to give examples for most of them.  Others you will have to
      find uses for yourself.  Think of it as <quote xmlns:xlink="http://www.w3.org/1999/xlink">an exercise for
      the reader</quote>.  By placing one (or more) of these as a
      source on a dependency line, you are <quote xmlns:xlink="http://www.w3.org/1999/xlink">marking the
      target(s) with that attribute</quote>.  That is just the way I
      phrase it, so you know.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Any attributes given as sources for a transformation
      rule are applied to the target of the transformation rule
      when the rule is applied.</para>

    <informaltable xmlns:xlink="http://www.w3.org/1999/xlink" frame="none">
      <tgroup xmlns:xlink="http://www.w3.org/1999/xlink" cols="2">
	<colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="1*"/>
	<colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="10*"/>

	<tbody xmlns:xlink="http://www.w3.org/1999/xlink">
	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">.DONTCARE</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">If a target is marked with this attribute and
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> can not figure out
	      how to create it, it will ignore this fact and assume
	      the file is not really needed or actually exists and
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> just can not find
	      it.  This may prove wrong, but the error will be
	      noted later on, not when  <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	      tries to create the target so marked.  This attribute also
	      prevents <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> from attempting
	      to touch the target if it is given the
	      <option xmlns:xlink="http://www.w3.org/1999/xlink">-t</option> flag.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">.EXEC</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><para xmlns:xlink="http://www.w3.org/1999/xlink">This attribute causes its shell script to be
		executed while having no effect on targets that depend
		on it.  This makes the target into a sort of subroutine.
		An example.  Say you have some LISP files that need to
		be compiled and loaded into a LISP process.  To do this,
		you echo LISP commands into a file and execute a LISP
		with this file as its input when  everything is
		done. Say also that you have to load
		other files from another system before you can compile
		your files and further, that you do not want to go
		through the loading and dumping unless one of your
		files has changed.  Your makefile might look a little
		bit like this (remember, this is an  educational example,
		and do not worry about the <buildtarget>COMPILE</buildtarget>
		rule, all will soon become clear, grasshopper):

		<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">system          : init a.fasl b.fasl c.fasl
	for i in $(.ALLSRC);
	do
		echo -n '(load "' &gt;&gt; input
		echo -n ${i} &gt;&gt; input
		echo '")' &gt;&gt; input
	done
	echo '(dump "$(.TARGET)")' &gt;&gt; input
	lisp &lt; input

a.fasl          : a.l init COMPILE
b.fasl          : b.l init COMPILE
c.fasl          : c.l init COMPILE
COMPILE         : .USE
	echo '(compile "$(.ALLSRC)")' &gt;&gt; input
init            : .EXEC
	echo '(load-system)' &gt; input</programlisting>

		<literal xmlns:xlink="http://www.w3.org/1999/xlink">.EXEC</literal> sources, do not appear in the
		local variables of targets that depend on them (nor are
		they touched if <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is
		given the <option xmlns:xlink="http://www.w3.org/1999/xlink">-t</option>
		flag).  Note that all the rules, not just that for
		system, include init as a source.  This is because
		none of the other targets can be made until init
		has been made, thus they depend on it.</para></entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">.EXPORT</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">This is used to mark those targets whose
	      creation should be sent to another machine if at
	      all possible.  This may be used by some exportation
	      schemes if the exportation is expensive.  You
	      should ask your system administrator if it is
	      necessary.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">.EXPORTSAME</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">Tells the export system that the job
	      should be exported to a machine of the same
	      architecture as the current  one.  Certain
	      operations (e.g. running text through nroff) can be
	      performed the same on any architecture (CPU and
	      operating system type), while others (e.g. compiling
	      a program with cc) must be performed on a
	      machine with the same architecture.  Not all export
	      systems will support this attribute.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">.IGNORE</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">Giving a target the
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">.IGNORE</literal> attribute causes
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to ignore errors
	      from any of the target's commands, as if they all
	      had <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal> before them.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">.INVISIBLE</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><para xmlns:xlink="http://www.w3.org/1999/xlink">This allows you to specify one target as a
		source for another without the one affecting the
		other's local variables.  Useful if, say, you
		have a makefile that creates two  programs, one
		of which is used to create the other, so it must
		exist before the other is created. You could say

		<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">prog1           : $(PROG1OBJS) prog2 MAKEINSTALL
prog2           : $(PROG2OBJS) .INVISIBLE MAKEINSTALL</programlisting>

		where <literal xmlns:xlink="http://www.w3.org/1999/xlink">MAKEINSTALL</literal>
		is some complex <literal xmlns:xlink="http://www.w3.org/1999/xlink">.USE</literal> rule (see
		below) that depends on the <varname xmlns:xlink="http://www.w3.org/1999/xlink">.ALLSRC</varname>
		variable containing the right things.  Without the
		<literal xmlns:xlink="http://www.w3.org/1999/xlink">.INVISIBLE</literal>
		attribute for <buildtarget>prog2</buildtarget>,
		the <literal xmlns:xlink="http://www.w3.org/1999/xlink">MAKEINSTALL</literal> rule
		could not be applied.  This is not as useful as it
		should be, and the semantics may change (or the
		whole thing go away) in the not-too-distant
		future.</para></entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">.JOIN</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><para xmlns:xlink="http://www.w3.org/1999/xlink">This is another way to avoid performing some
		operations in parallel while permitting
		everything else to be done so.  Specifically it forces
		the target's shell script to be executed only if
		one or more of the sources was out-of-date.  In
		addition, the target's name, in both its
		<varname xmlns:xlink="http://www.w3.org/1999/xlink">.TARGET</varname>
		variable and all the local variables of any
		target that depends on it, is replaced by the value
		of its <varname xmlns:xlink="http://www.w3.org/1999/xlink">.ALLSRC</varname> variable.  As an
		example, suppose you have a program that has
		four libraries that
		compile in the same directory along with, and at
		the same time as, the program.  You again have
		the problem with ranlib that I mentioned
		earlier, only this time it is more severe: you can not
		just put the ranlib off to the end since the
		program will need those libraries before it can
		be re-created.  You can do something like this:

		<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">program         : $(OBJS) libraries
	cc -o $(.TARGET) $(.ALLSRC)

libraries       : lib1.a lib2.a lib3.a lib4.a .JOIN
	ranlib $(.OODATE)</programlisting>

		In this case, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will re-create
		the <literal xmlns:xlink="http://www.w3.org/1999/xlink">$(OBJS)</literal>
		as necessary, along with <filename xmlns:xlink="http://www.w3.org/1999/xlink">lib1.a</filename>,
		<filename xmlns:xlink="http://www.w3.org/1999/xlink">lib2.a</filename>, <filename xmlns:xlink="http://www.w3.org/1999/xlink">lib3.a</filename>
		and <filename xmlns:xlink="http://www.w3.org/1999/xlink">lib4.a</filename>.  It will then
		execute ranlib on any library that was changed and set
		program's <varname xmlns:xlink="http://www.w3.org/1999/xlink">.ALLSRC</varname> variable to contain
		what's in <literal xmlns:xlink="http://www.w3.org/1999/xlink">$(OBJS)</literal>
		followed by <quote xmlns:xlink="http://www.w3.org/1999/xlink"><filename xmlns:xlink="http://www.w3.org/1999/xlink">lib1.a</filename>
		  <filename xmlns:xlink="http://www.w3.org/1999/xlink">lib2.a</filename>
		  <filename xmlns:xlink="http://www.w3.org/1999/xlink">lib3.a</filename>
		  <filename xmlns:xlink="http://www.w3.org/1999/xlink">lib4.a</filename>.</quote>  In
		case you are wondering, it is called
		<literal xmlns:xlink="http://www.w3.org/1999/xlink">.JOIN</literal> because
		it joins together different threads of the
		<quote xmlns:xlink="http://www.w3.org/1999/xlink">input graph</quote> at the target marked
		with the attribute.  Another aspect of the
		<literal xmlns:xlink="http://www.w3.org/1999/xlink">.JOIN</literal>
		attribute is it keeps the target from being
		created if the <option xmlns:xlink="http://www.w3.org/1999/xlink">-t</option> flag was
		given.</para></entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">.MAKE</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><para xmlns:xlink="http://www.w3.org/1999/xlink">The <literal xmlns:xlink="http://www.w3.org/1999/xlink">.MAKE</literal>
	      attribute marks its target as being a
	      recursive invocation of PMake.  This forces
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to execute the
	      script associated with the
	      target (if it is out-of-date) even if you gave
	      the <option xmlns:xlink="http://www.w3.org/1999/xlink">-n</option> or
	      <option xmlns:xlink="http://www.w3.org/1999/xlink">-t</option> flag.  By doing this, you can start
	      at the top of a system and type

	      <literallayout xmlns:xlink="http://www.w3.org/1999/xlink"><command xmlns:xlink="http://www.w3.org/1999/xlink">pmake -n</command></literallayout>

	      and have it descend the directory tree (if your
	      makefiles are set up correctly), printing what
	      it would have executed if you had not included
	      the <option xmlns:xlink="http://www.w3.org/1999/xlink">-n</option> flag.</para></entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">.NOEXPORT</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">If possible,
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will attempt to
	      export the creation of all targets to another machine
	      (this depends on how <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	      was configured).  Sometimes, the creation is so
	      simple, it is pointless to send it to another machine.
	      If you give the target the
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">.NOEXPORT</literal> attribute, it will be run
	      loally, even if you have given
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> the <option xmlns:xlink="http://www.w3.org/1999/xlink">-L
	      0</option> flag.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">.NOTMAIN</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">Normally, if you do not specify a target to
	      make in any other way,
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will take the first
	      target on the first dependency line of a makefile as
	      the target to create.  That target is known as the
	      <quote xmlns:xlink="http://www.w3.org/1999/xlink">Main Target</quote> and is labeled as such if
	      you print the dependencies out using the
	      <option xmlns:xlink="http://www.w3.org/1999/xlink">-p</option> flag.  Giving a target this
	      attribute tells <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> that
	      the target is definitely not the Main Target.  This
	      allows you to place targets in an included makefile
	      and have <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> create
	      something else by default.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">.PRECIOUS</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">When <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is
	      interrupted (you type control-C at the keyboard), it will
	      attempt to clean up after itself by removing any
	      half-made targets.  If a target has the
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">.PRECIOUS</literal> attribute, however,
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will leave it alone.
	      An additional side effect of the <literal xmlns:xlink="http://www.w3.org/1999/xlink">::</literal>
	      operator is to mark the targets as
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">.PRECIOUS</literal>.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">.SILENT</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">Marking a target with this attribute keeps its
	      commands from being printed when they are
	      executed, just as if they had an <literal xmlns:xlink="http://www.w3.org/1999/xlink">@</literal>
	      in front of them.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">.USE</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><para xmlns:xlink="http://www.w3.org/1999/xlink">By giving a target this attribute, you turn it
		into <application xmlns:xlink="http://www.w3.org/1999/xlink"/>PMake's equivalent of
		a macro.  When the target is
		used as a source for another target, the other target
		acquires the commands, sources and attributes (except
		<literal xmlns:xlink="http://www.w3.org/1999/xlink">.USE</literal>) of the source.  If the target
		already has commands, the <literal xmlns:xlink="http://www.w3.org/1999/xlink">.USE</literal> target's
		commands are added to the end.  If more than one
		<literal xmlns:xlink="http://www.w3.org/1999/xlink">.USE</literal>-marked source is given to a
		target, the rules are applied sequentially.  The typical
		<literal xmlns:xlink="http://www.w3.org/1999/xlink">.USE</literal> rule (as I call them) will use
		the sources of the target to which it is applied (as
		stored in the <varname xmlns:xlink="http://www.w3.org/1999/xlink">.ALLSRC</varname> variable for
		the target) as its <quote xmlns:xlink="http://www.w3.org/1999/xlink">arguments,</quote> if you
		will.  For example, you probably noticed that the
		commands for creating <filename xmlns:xlink="http://www.w3.org/1999/xlink">lib1.a</filename> and
		<filename xmlns:xlink="http://www.w3.org/1999/xlink">lib2.a</filename> in the example in section
		<xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="savingcmds"/> were exactly the same.
		You can use the <literal xmlns:xlink="http://www.w3.org/1999/xlink">.USE</literal> attribute to
		eliminate the repetition, like so:

		<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">lib1.a          : $(LIB1OBJS) MAKELIB
lib2.a          : $(LIB2OBJS) MAKELIB

MAKELIB         : .USE
	rm -f $(.TARGET)
	ar cr $(.TARGET) $(.ALLSRC)
	...
	ranlib $(.TARGET)</programlisting>

		Several system makefiles (not to be confused
		with The System Makefile) make use of these
		<literal xmlns:xlink="http://www.w3.org/1999/xlink">.USE</literal> rules to make your life
		easier (they are in the default, system makefile
		directory...take a look).  Note that the
		<literal xmlns:xlink="http://www.w3.org/1999/xlink">.USE</literal> rule source itself
		(<buildtarget>MAKELIB</buildtarget>) does not appear in
		any of the targets's local variables.  There is no limit
		to the number of times I could use the
		<buildtarget>MAKELIB</buildtarget> rule.  If there were
		more libraries, I could continue with
		<literal xmlns:xlink="http://www.w3.org/1999/xlink">lib3.a : $(LIB3OBJS) MAKELIB</literal>
		and so on and so forth.</para></entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="specialtargets">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Special Targets</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">As there were in <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application>, so there
      are certain targets that have special meaning to
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>.  When you use one on a
      dependency line,
      it is the only target that may appear on the left-hand-side of the
      operator.  As for the attributes  and variables, all the special
      targets begin with a period and consist of upper-case letters
      only.  I will not describe them all in detail because some of them
      are rather complex and I will describe them in more detail than you
      will want in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="gods"/>.  The targets are as follows:</para>

    <informaltable xmlns:xlink="http://www.w3.org/1999/xlink" frame="none">
      <tgroup xmlns:xlink="http://www.w3.org/1999/xlink" cols="2">
	<colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="1*"/>
	<colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="10*"/>

	<tbody xmlns:xlink="http://www.w3.org/1999/xlink">
	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.BEGIN</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">Any commands attached to this target are
	      executed before anything else is done.  You can use
	      it for any initialization that needs
	      doing.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.DEFAULT</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">This is sort of a <literal xmlns:xlink="http://www.w3.org/1999/xlink">.USE</literal>
	      rule for any target (that was used only as a source)
	      that <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> can not figure
	      out any other way to create.  It is only <quote xmlns:xlink="http://www.w3.org/1999/xlink">sort
	      of</quote> a <literal xmlns:xlink="http://www.w3.org/1999/xlink">.USE</literal> rule because
	      only the shell script attached to  the
	      <buildtarget>.DEFAULT</buildtarget> target is used.
	      The <varname xmlns:xlink="http://www.w3.org/1999/xlink">.IMPSRC</varname> variable of a target
	      that inherits <buildtarget>.DEFAULT</buildtarget>'s
	      commands is set to the target's own
	      name.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.END</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">This serves a function similar to
	      <buildtarget>.BEGIN</buildtarget>, in that commands
	      attached to it are executed once everything
	      has been re-created (so long as no errors
	      occurred).  It also serves the extra function of
	      being a place on which <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	      can hang commands you put off to the end.  Thus the script
	      for this target will be executed before any of the
	      commands you save with the
	      <quote xmlns:xlink="http://www.w3.org/1999/xlink">...</quote>.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.EXPORT</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">The sources for this target are passed
	      to the exportation system compiled into
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>.  Some systems will use
	      these sources to configure themselves.  You should ask
	      your system administrator about this.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.IGNORE</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">This target marks each of its sources
	      with the <literal xmlns:xlink="http://www.w3.org/1999/xlink">.IGNORE</literal> attribute.
	      If you do not give it any sources, then it is
	      like giving the <option xmlns:xlink="http://www.w3.org/1999/xlink">-i</option> flag when
	      you invoke <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> &#8211;
	      errors are ignored for all commands.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.INCLUDES</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><para xmlns:xlink="http://www.w3.org/1999/xlink">The sources for this target are taken to be
		suffixes that indicate a file that can be included in
		a program source file.  The suffix must  have
		already been declared with <literal xmlns:xlink="http://www.w3.org/1999/xlink">.SUFFIXES</literal>
		(see below).
		Any suffix so marked will have the directories on
		its search path (see <buildtarget>.PATH</buildtarget>,
		below) placed in the <varname xmlns:xlink="http://www.w3.org/1999/xlink">.INCLUDES</varname>
		variable, each preceded by a <option xmlns:xlink="http://www.w3.org/1999/xlink">-I</option> flag.
		This variable can then be used as an argument for
		the compiler in the normal fashion.  The
		<filename xmlns:xlink="http://www.w3.org/1999/xlink">.h</filename> suffix is already marked in
		this way in the system makefile.  E.g. if you have

		  <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">.SUFFIXES       : .bitmap
.PATH.bitmap    : /usr/local/X/lib/bitmaps
.INCLUDES       : .bitmap</programlisting>

		<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will place
		<literal xmlns:xlink="http://www.w3.org/1999/xlink">-I/usr/local/X/lib/bitmaps</literal>
		in the <varname xmlns:xlink="http://www.w3.org/1999/xlink">.INCLUDES</varname> variable and you can
		then say

		<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">cc $(.INCLUDES) -c xprogram.c</programlisting>

		(Note: the <varname xmlns:xlink="http://www.w3.org/1999/xlink">.INCLUDES</varname> variable is
		not actually filled in until the entire makefile has
		been read.)</para></entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.INTERRUPT</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">When <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is
	      interrupted, it will execute the commands in the
	      script for this target, if it exists.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.LIBS</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">This does for libraries what
	      <buildtarget>.INCLUDES</buildtarget> does for include
	      files, except the flag used is
	      <option xmlns:xlink="http://www.w3.org/1999/xlink">-L</option>, as required by those linkers
	      that allow you to tell them where to find libraries.
	      The variable used is <varname xmlns:xlink="http://www.w3.org/1999/xlink">.LIBS</varname>.
	      Be forewarned that <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	      may not have been compiled to do this if the linker
	      on your system does not accept the <option xmlns:xlink="http://www.w3.org/1999/xlink">-L</option>
	      flag, though the <varname xmlns:xlink="http://www.w3.org/1999/xlink">.LIBS</varname> variable
	      will always be defined once the makefile has been
	      read.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.MAIN</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">If you did not give a target (or targets) to
	      create when you invoked
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>, it will take the
	      sources of this target as the targets to
	      create.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.MAKEFLAGS</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">This target provides a way for you to
	      always specify flags for <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	      when the makefile is used.  The flags are just as they
	      would be typed to the shell (except you can not use shell
	      variables unless they are in the environment), though
	      the <option xmlns:xlink="http://www.w3.org/1999/xlink">-f</option> and <option xmlns:xlink="http://www.w3.org/1999/xlink">-r</option>
	      flags have no effect.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.NULL</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">This allows you to specify what
	      suffix <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> should pretend
	      a file has if, in fact, it has no known suffix.  Only
	      one suffix may be so designated.  The last source on the
	      dependency line is the suffix that is used (you
	      should, however, only give one suffix...).</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.PATH</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">If you give sources for this target,
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will take them as
	      directories in which to search for files it cannot
	      find in the current directory.  If you give no
	      sources, it will clear out any directories added to
	      the search path before.  Since the effects of this
	      all get very complex, we will leave it till <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="gods"/> to give you a complete
	      explanation.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.PATH<replaceable xmlns:xlink="http://www.w3.org/1999/xlink">suffix</replaceable></buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">This does a similar thing to
	      <buildtarget>.PATH</buildtarget>, but it does it only
	      for files with the given suffix.  The suffix must
	      have been defined already.  Look at Search Paths
	      (<xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="searchpaths"/>) for more
	      information.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.PRECIOUS</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">Similar to <buildtarget>.IGNORE</buildtarget>,
	      this gives the <literal xmlns:xlink="http://www.w3.org/1999/xlink">.PRECIOUS</literal> attribute to
	      each source on the dependency line, unless there are
	      no sources, in which case the <literal xmlns:xlink="http://www.w3.org/1999/xlink">.PRECIOUS</literal>
	      attribute is given to every target in the file.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.RECURSIVE</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">This target applies the <literal xmlns:xlink="http://www.w3.org/1999/xlink">.MAKE</literal>
	      attribute to all its sources.  It does nothing if you
	      do not give it any sources.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.SHELL</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is not
	      constrained to only using the Bourne shell to
	      execute the commands you put in the makefile.  You
	      can tell it some other shell to use with this
	      target.  Check out <quote xmlns:xlink="http://www.w3.org/1999/xlink"><xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="ashell" endterm="ashelltitle"/></quote> (<xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="ashell"/>) for more
	      information.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.SILENT</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">When you use
	      <buildtarget>.SILENT</buildtarget> as a target, it
	      applies the <literal xmlns:xlink="http://www.w3.org/1999/xlink">.SILENT</literal> attribute to
	      each of its sources.  If there are no sources on the
	      dependency line, then it is as if you gave
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> the
	      <option xmlns:xlink="http://www.w3.org/1999/xlink">-s</option> flag and no commands will be
	      echoed.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><buildtarget>.SUFFIXES</buildtarget></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">This is used to give new file suffixes
	      for <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to handle.
	      Each source is a suffix
	      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> should
	      recognize.  If you give a
	      <buildtarget>.SUFFIXES</buildtarget> dependency line
	      with no sources, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	      will forget about all the suffixes it knew
	      (this also nukes the null suffix).  For those
	      targets that need to have suffixes defined, this
	      is how you do it.</entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">In addition to these targets, a line of the form:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">attribute : sources</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">applies the attribute to all the targets listed as sources.</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="modyvarex">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Modifying Variable Expansion</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Variables need not always be expanded verbatim.
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> defines several modifiers
      that may be applied to a variable's value before it is expanded.
      You apply a modifier by placing it after the variable name with
      a colon between the two, like so:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">${VARIABLE:modifier}</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Each modifier is a single character followed by something
      specific to the modifier itself.  You may apply as many
      modifiers as you want &#8211; each one is applied to the
      result of the previous and is separated from the
      previous by another colon.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">There are seven ways to modify a variable's expansion,
      most of which come from the C shell variable modification
      characters:</para>

    <variablelist xmlns:xlink="http://www.w3.org/1999/xlink">
      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">Mpattern</literal></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This is used to select only those words (a word is a
	    series of characters that are neither spaces nor tabs)
	    that match the given pattern.  The pattern is a
	    wildcard pattern like that used by the shell, where
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">*</literal> means <literal xmlns:xlink="http://www.w3.org/1999/xlink">0</literal> or more
	    characters of any sort; <literal xmlns:xlink="http://www.w3.org/1999/xlink">?</literal> is any
	    single character; <literal xmlns:xlink="http://www.w3.org/1999/xlink">[abcd]</literal> matches any
	    single character that is either <literal xmlns:xlink="http://www.w3.org/1999/xlink">a</literal>,
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">b</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">c</literal> or
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">d</literal> (there may be any number of
	    characters between the brackets);
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">[0-9]</literal> matches any single character
	    that is between <literal xmlns:xlink="http://www.w3.org/1999/xlink">0</literal> and
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">9</literal> (i.e. any digit.  This form may be
	    freely mixed with the other bracket form), and
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">\</literal> is used to escape any of the
	    characters <literal xmlns:xlink="http://www.w3.org/1999/xlink">*</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">?</literal>,
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">[</literal> or <literal xmlns:xlink="http://www.w3.org/1999/xlink">:</literal>, leaving
	    them as regular characters to match themselves in a
	    word.  For example, the system makefile
	    <filename xmlns:xlink="http://www.w3.org/1999/xlink">&lt;makedepend.mk&gt;</filename> uses
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">$(CFLAGS:M-[ID]*)</literal> to extract all the
	    <option xmlns:xlink="http://www.w3.org/1999/xlink">-I</option> and <option xmlns:xlink="http://www.w3.org/1999/xlink">-D</option> flags that
	    would be passed to the C compiler.  This allows it to
	    properly locate include files and generate the correct
	    dependencies.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">Npattern</literal></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This is identical to <literal xmlns:xlink="http://www.w3.org/1999/xlink">:M</literal> except
	    it substitutes  all words that do not match the given
	    pattern.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">S/search-string/replacement-string/[g]</literal></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Causes the first occurrence of search-string in
	    the variable to be replaced by replacement-string,
	    unless the <option xmlns:xlink="http://www.w3.org/1999/xlink">g</option> flag is given at the end,
	    in which case all occurrences of the string are
	    replaced.  The substitution is performed on each word in
	    the variable in turn.  If search-string begins with a
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">^</literal>, the string must match starting at
	    the beginning of the word.  If search-string ends with a
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">$</literal>, the string must match to the end
	    of the word (these two may be combined to force an exact
	    match).  If a backslash precedes these two characters,
	    however, they lose their special meaning.  Variable
	    expansion also occurs in the normal fashion inside both
	    the search-string and the replacement-string, except
	    that a backslash is used to prevent the expansion of a
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">$</literal>, not another dollar sign, as is
	    usual.  Note that search-string is just a string, not a
	    pattern, so none of the usual regularexpression/wildcard
	    characters have any special meaning save
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">^</literal> and <literal xmlns:xlink="http://www.w3.org/1999/xlink">$</literal>.  In the
	    replacement string, the <literal xmlns:xlink="http://www.w3.org/1999/xlink">&amp;</literal> character
	    is replaced by the search-string unless it is preceded
	    by a backslash.  You are allowed to use any character
	    except colon or exclamation point to separate the two
	    strings.  This so-called delimiter character may be
	    placed in either string by preceding it with a
	    backslash.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">T</literal></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Replaces each word in the variable expansion by
	    its last component (its <quote xmlns:xlink="http://www.w3.org/1999/xlink">tail</quote>).
	    For example, given:</para>

	  <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">OBJS = ../lib/a.o b /usr/lib/libm.a
TAILS = $(OBJS:T)</programlisting>

	  <para xmlns:xlink="http://www.w3.org/1999/xlink">the variable <varname xmlns:xlink="http://www.w3.org/1999/xlink">TAILS</varname> would expand
	    to <literal xmlns:xlink="http://www.w3.org/1999/xlink">a.o b libm.a.</literal></para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">H</literal></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This is similar to <literal xmlns:xlink="http://www.w3.org/1999/xlink">:T</literal>, except
	    that every word is replaced by everything but the tail
	    (the <quote xmlns:xlink="http://www.w3.org/1999/xlink">head</quote>).  Using the same definition of
	    <varname xmlns:xlink="http://www.w3.org/1999/xlink">OBJS</varname>, the string
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">$(OBJS:H)</literal> would expand to
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">../lib /usr/lib.</literal>  Note that the final
	    slash on the heads is removed and anything without
	    a head is replaced by the empty string.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">E</literal></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">:E</literal> replaces each word by its
	    suffix (<quote xmlns:xlink="http://www.w3.org/1999/xlink">extension</quote>).  So
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">$(OBJS:E)</literal> would give you
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">.o .a.</literal></para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">R</literal></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This replaces each word by everything but the
	    suffix (the <quote xmlns:xlink="http://www.w3.org/1999/xlink">root</quote> of the word).
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">$(OBJS:R)</literal> expands to
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">../lib/a b /usr/lib/libm</literal>.</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">In addition, the System V style of substitution is also
      supported.  This looks like:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">$(VARIABLE:search-string=replacement)</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">It must be the last modifier in the chain.  The search is
      anchored at the end of each word, so only suffixes or whole
      words may be replaced.</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="moreexercises">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">More Exercises</title>

    <bridgehead xmlns:xlink="http://www.w3.org/1999/xlink">Exercise 3.1</bridgehead>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">You have got a set programs, each of which is created from
      its own assembly-language  source file (suffix
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">.asm</filename>).  Each program can be assembled into
      two versions, one with error-checking code assembled in and one
      without.  You could assemble them into files with different
      suffixes (<filename xmlns:xlink="http://www.w3.org/1999/xlink">.eobj</filename> and
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">.obj</filename>, for instance), but your linker only
      understands files that end in <filename xmlns:xlink="http://www.w3.org/1999/xlink">.obj</filename>. To top
      it all off, the final executables must have the suffix
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">.exe</filename>.  How can you still use
      transformation rules to make your life easier (Hint: assume the
      errorchecking versions have ec tacked onto their prefix)?</para>

    <bridgehead xmlns:xlink="http://www.w3.org/1999/xlink">Exercise 3.2</bridgehead>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Assume, for a moment or two, you want to perform
      a sort of <quote xmlns:xlink="http://www.w3.org/1999/xlink">indirection</quote> by placing the name of
      a variable into another one, then you want to get the value
      of the first by expanding the second somehow.  Unfortunately,
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> does not allow constructs like:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">$($(FOO))</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">What do you do?  Hint: no further variable expansion is
      performed after modifiers are applied, thus if you
      cause a <literal xmlns:xlink="http://www.w3.org/1999/xlink">$</literal> to occur in the expansion,
      that is what will be in the result.</para>
  </section>
</chapter>

  
<!--
    $FreeBSD$
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="gods">
  <title xmlns:xlink="http://www.w3.org/1999/xlink">PMake for Gods</title>

  <para xmlns:xlink="http://www.w3.org/1999/xlink">This chapter is devoted to those facilities in
    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> that allow you to do a great deal
    in a makefile with very little work, as well as do some things you
    could not do in <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application> without a great
    deal of work (and perhaps the use of other programs).  The problem
    with these features, is they must be handled with care, or you
    will end up with a mess.</para>

  <para xmlns:xlink="http://www.w3.org/1999/xlink">Once more, I assume a greater familiarity with <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark> or Sprite
    than I did in the previous two chapters.</para>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="searchpaths">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Search Paths</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> supports the dispersal of
      files into multiple directories by allowing you to specify
      places to look for sources with <buildtarget>.PATH</buildtarget>
      targets in the makefile.  The directories you give as sources
      for these targets make up a <quote xmlns:xlink="http://www.w3.org/1999/xlink">search path</quote>.  Only
      those files used exclusively as sources are actually sought on a
      search path, the assumption being that anything listed as a
      target in the makefile can be created by the makefile and thus
      should be in the current directory.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">There are two types of search paths in
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>: one is used for all types of
      files (including included makefiles) and is specified with a
      plain <buildtarget>.PATH</buildtarget> target (e.g. <literal xmlns:xlink="http://www.w3.org/1999/xlink">.PATH
      : RCS</literal>), while the other is specific to a certain
      type of file, as indicated by the file's suffix.  A specific
      search path is indicated by immediately following the
      <buildtarget>.PATH</buildtarget> with the suffix of the file.  For
      instance:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">.PATH.h         : /sprite/lib/include /sprite/att/lib/include</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">would tell <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to look in the
      directories <filename xmlns:xlink="http://www.w3.org/1999/xlink">/sprite/lib/include</filename> and
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/sprite/att/lib/include</filename> for any
      files whose suffix is <filename xmlns:xlink="http://www.w3.org/1999/xlink">.h</filename>.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The current directory is always consulted first to see if a
      file exists.  Only if it cannot be found there are the
      directories in the specific search path, followed by those in
      the general search path, consulted.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">A search path is also used when expanding wildcard
      characters.  If the pattern has a recognizable suffix on it,
      the path for that suffix will be used for the expansion.
      Otherwise the default search path is employed.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">When a file is found in some directory other than the
      current one, all local variables that would have contained the
      target's name (<varname xmlns:xlink="http://www.w3.org/1999/xlink">.ALLSRC</varname>, and
      <varname xmlns:xlink="http://www.w3.org/1999/xlink">.IMPSRC</varname>) will instead contain
      the path to the file, as found by
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>.
      Thus if you have a file <filename xmlns:xlink="http://www.w3.org/1999/xlink">../lib/mumble.c</filename>
      and a makefile like this:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">.PATH.c         : ../lib
mumble          : mumble.c
	$(CC) -o $(.TARGET) $(.ALLSRC)</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">the command executed to create mumble would be
      <command xmlns:xlink="http://www.w3.org/1999/xlink">cc -o mumble ../lib/mumble.c.</command>
      (as an aside, the command in this case is not strictly
      necessary, since it will be found using transformation rules
      if it is not given.  This is because <filename xmlns:xlink="http://www.w3.org/1999/xlink">.out</filename>
      is the null suffix by default and a transformation exists
      from <filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename> to
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">.out</filename>.  Just thought I would throw that in).
      If a file exists in two directories on the same search path,
      the file in the first directory on the path will be the one
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> uses.  So if you have
      a large system spread over many directories, it would
      behoove you to follow a naming convention that avoids such
      conflicts.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Something you should know about the way search paths are
      implemented is that each directory is read, and its contents
      cached, exactly once &#8211; when it is first encountered
      &#8211; so any changes to the directories while
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is running will not be noted
      when searching for implicit sources, nor will they be found when
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> attempts to discover when the
      file was last modified, unless the file was created in the
      current directory.  While people have suggested that
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> should read the directories
      each time, my experience suggests that the caching seldom causes
      problems.  In addition, not caching the directories slows things
      down enormously because of <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>'s attempts
      to apply transformation rules through non-existent files &#8211; the
      number of extra file-system searches is truly staggering,
      especially if many files without suffixes are used and the null
      suffix is not changed from <filename xmlns:xlink="http://www.w3.org/1999/xlink">.out</filename>.</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="archivesandlibraries">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Archives and Libraries</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark> and Sprite allow you to merge files into an archive
      using the <command xmlns:xlink="http://www.w3.org/1999/xlink">ar</command> command.  Further, if the files
      are relocatable object files, you can run
      <application xmlns:xlink="http://www.w3.org/1999/xlink">ranlib</application> on the archive and get
      yourself a library that you can link into any program you want.
      The main problem with archives is they double the space you need
      to store the archived files, since there is one copy in the
      archive and one copy out by itself.  The problem with libraries
      is you usually think of them as <option xmlns:xlink="http://www.w3.org/1999/xlink">-lm</option> rather
      than <filename xmlns:xlink="http://www.w3.org/1999/xlink">/usr/lib/libm.a</filename> and the linker thinks
      they are out-of-date if you so much as look at them.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> solves the problem with
      archives by allowing you to tell it to examine the files in the
      archives (so you can remove the individual files without having
      to regenerate them later).  To handle the problem with
      libraries, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> adds an additional
      way of deciding if a library is out-of-date: if the table of
      contents is older than the library, or is missing, the library
      is out-of-date.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">A library is any target that looks like <option xmlns:xlink="http://www.w3.org/1999/xlink">-lname</option>
      or that ends in a suffix that was marked as a library using the
      <buildtarget>.LIBS</buildtarget> target.  <filename xmlns:xlink="http://www.w3.org/1999/xlink">.a</filename>
      is so marked in the system makefile.  Members of an archive are
      specified as <literal xmlns:xlink="http://www.w3.org/1999/xlink">archive(member[member...])</literal>.
      Thus <literal xmlns:xlink="http://www.w3.org/1999/xlink">libdix.a(window.o)</literal> specifies the
      file <filename xmlns:xlink="http://www.w3.org/1999/xlink">window.o</filename> in the archive
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">libdix.a</filename>.  You may also use
      wildcards to specify the members of the archive.  Just
      remember that most the wildcard characters will only find
      existing files.  A file that is a member of an archive is
      treated specially.  If the file does not exist, but it is
      in the archive, the modification time recorded in the
      archive is used for the file when determining if the file
      is out-of-date.  When figuring out how to make an archived
      member target (not the file itself, but the file in the
      archive &#8211; the archive(member) target), special care
      is taken with the transformation rules, as follows:</para>

    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">archive(member) is made to depend on member.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The transformation from the member's suffix to the
	  archive's suffix is applied to the archive(member) target.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The archive(member)'s <varname xmlns:xlink="http://www.w3.org/1999/xlink">.TARGET</varname>
	  variable is set to the name of the member if member is
	  actually a target, or the path to the member file if
	  member is only a source.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The <varname xmlns:xlink="http://www.w3.org/1999/xlink">.ARCHIVE</varname> variable for the
	  archive(member) target is set to the name of the
	  archive.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The <varname xmlns:xlink="http://www.w3.org/1999/xlink">.MEMBER</varname> variable is set to the
	  actual string inside the parentheses.  In most cases,
	  this will be the same as the <varname xmlns:xlink="http://www.w3.org/1999/xlink">.TARGET</varname>
	  variable.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The archive(member)'s place in the local variables of
	  the targets that depend on it is taken by the value of its
	  <varname xmlns:xlink="http://www.w3.org/1999/xlink">.TARGET</varname> variable.</para>
      </listitem>
    </itemizedlist>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Thus, a program library could be created with the following
      makefile:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">.o.a            :
	...
	rm -f $(.TARGET:T)
OBJS            = obj1.o obj2.o obj3.o
libprog.a       : libprog.a($(OBJS))
	ar cru $(.TARGET) $(.OODATE)
	ranlib $(.TARGET)</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">This will cause the three object files to be compiled (if
      the corresponding source files were modified after the object
      file or, if that does not exist, the archived object file), the
      out-of-date ones archived in <filename xmlns:xlink="http://www.w3.org/1999/xlink">libprog.a</filename>, a
      table of contents placed in the archive and the newly-archived
      object files to be removed.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">All this is used in the <filename xmlns:xlink="http://www.w3.org/1999/xlink">makelib.mk</filename> system
      makefile to create a single library with ease.  This makefile looks
      like this:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">#
# Rules for making libraries. The object files that make up the library
# are removed once they are archived.
#
# To make several libraries in parallel, you should define the variable
# "many_libraries". This will serialize the invocations of ranlib.
#
# To use, do something like this:
#
# OBJECTS = &lt;files in the library&gt;
#
# fish.a: fish.a($(OBJECTS)) MAKELIB
#
#

#ifndef _MAKELIB_MK
_MAKELIB_MK    =

#include  &lt;po.mk&gt;

.po.a .o.a     :
	...
	rm -f $(.MEMBER)

ARFLAGS        ?= crl

#
# Re-archive the out-of-date members and recreate the library's table of
# contents using ranlib. If many_libraries is defined, put the ranlib
# off til the end so many libraries can be made at once.
#
MAKELIB        : .USE .PRECIOUS
	ar $(ARFLAGS) $(.TARGET) $(.OODATE)
#ifndef no_ranlib
# ifdef many_libraries
	...
# endif many_libraries
	ranlib $(.TARGET)
#endif no_ranlib

#endif _MAKELIB_MK</programlisting>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="condition">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">On the Condition...</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Like the C compiler before it, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
      allows you to configure the makefile, based on the current
      environment, using conditional statements.  A conditional looks like
      this:</para>

      <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">#if boolean expression
lines
#elif another boolean expression
more lines
#else
still more lines
#endif</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">They may be nested to a maximum depth of 30 and may occur
      anywhere (except in a comment, of course).  The
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">#</literal> must the very first character on the
      line.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Each boolean expression is made up of terms that look
      like function calls, the standard C boolean operators
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">&amp;&amp;</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">||</literal>, and
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">!</literal>, and the standard relational operators
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">==</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">!=</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">&gt;</literal>,
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">&gt;=</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">&lt;</literal>, and
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">&lt;=</literal>, with <literal xmlns:xlink="http://www.w3.org/1999/xlink">==</literal> and
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">!=</literal> being overloaded to allow string
      comparisons as well.  <literal xmlns:xlink="http://www.w3.org/1999/xlink">&amp;&amp;</literal> represents logical
      AND; <literal xmlns:xlink="http://www.w3.org/1999/xlink">||</literal> is logical OR and <literal xmlns:xlink="http://www.w3.org/1999/xlink">!</literal>
      is logical NOT.  The arithmetic and string operators take
      precedence over all three of these operators, while NOT
      takes precedence over AND, which takes  precedence over OR.
      This precedence may be overridden with parentheses, and an
      expression may be parenthesized to your heart's content.
      Each term looks like a call on one of four functions:</para>

    <informaltable xmlns:xlink="http://www.w3.org/1999/xlink" frame="none">
      <tgroup xmlns:xlink="http://www.w3.org/1999/xlink" cols="2">
	<colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="1*"/>
	<colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="10*"/>

	<tbody xmlns:xlink="http://www.w3.org/1999/xlink">
	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">make</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">The syntax is make(target) where target is
	      a target in the  makefile.  This is true if the
	      given target was specified on the command line, or
	      as the source for a <buildtarget>.MAIN</buildtarget>
	      target (note that the sources for
	      <buildtarget>.MAIN</buildtarget> are only used if no
	      targets were given on the command
	      line).</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">defined</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">The syntax is
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">defined(variable)</literal> and is true
	      if variable is defined.  Certain variables are
	      defined in the system makefile that identify the
	      system on which <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	      is being run.</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">exists</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">The syntax is
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">exists(file)</literal> and is true if the
	      file can be found on the global search path (i.e.
	      that defined by <varname xmlns:xlink="http://www.w3.org/1999/xlink">.PATH</varname> targets, not by
	      <buildtarget>.PATH<replaceable xmlns:xlink="http://www.w3.org/1999/xlink">suffix</replaceable></buildtarget>
	      targets).</entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink" valign="top">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">empty</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink">This syntax is much like the others, except
	      the string inside the parentheses is of the same
	      form as you would put between parentheses when
	      expanding a variable, complete with modifiers and
	      everything.  The function returns true if the
	      resulting string is empty.  An undefined
	      variable in this context will cause at the very
	      least a warning message about a malformed
	      conditional, and at the worst will cause the process
	      to stop once it has read the makefile.  If you want
	      to check for a variable being defined or empty,
	      use the expression:
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">!defined(var) || empty(var)</literal>
	      as the definition of <literal xmlns:xlink="http://www.w3.org/1999/xlink">||</literal> will
	      prevent the <literal xmlns:xlink="http://www.w3.org/1999/xlink">empty()</literal> from being
	      evaluated and causing an error, if the variable
	      is undefined.  This can be used to see if a
	      variable contains a given word, for example:
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">#if !empty(var:Mword)</literal></entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The arithmetic and string operators may only be used to test
      the value of a variable.  The lefthand side must contain the
      variable expansion, while the righthand side contains either
      a string, enclosed in double-quotes, or a number.  The
      standard C numeric conventions (except for specifying an octal
      number) apply to both sides.  E.g.:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">#if $(OS) == 4.3

#if $(MACHINE) == "sun3"

#if $(LOAD_ADDR) &gt; 0xc000</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">are all valid conditionals.  In addition, the numeric value
      of a variable can be tested as a boolean as follows:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">#if $(LOAD)</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">would see if <literal xmlns:xlink="http://www.w3.org/1999/xlink">LOAD</literal> contains a
      non-zero value and:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">#if !$(LOAD)</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">would test if <literal xmlns:xlink="http://www.w3.org/1999/xlink">LOAD</literal> contains a
      zero value.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">In addition to the bare <literal xmlns:xlink="http://www.w3.org/1999/xlink">#if</literal>, there are other
      forms that apply one of the first two functions to each term.
      They are as follows:</para>

    <informaltable xmlns:xlink="http://www.w3.org/1999/xlink" frame="none">
      <tgroup xmlns:xlink="http://www.w3.org/1999/xlink" cols="2">
	<tbody xmlns:xlink="http://www.w3.org/1999/xlink">
	  <row xmlns:xlink="http://www.w3.org/1999/xlink">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">ifdef</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">defined</literal></entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">ifndef</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">!defined</literal></entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">ifmake</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">make</literal></entry>
	  </row>

	  <row xmlns:xlink="http://www.w3.org/1999/xlink">
	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">ifnmake</literal></entry>

	    <entry xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">!make</literal></entry>
	  </row>
	</tbody>
      </tgroup>
    </informaltable>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">There are also the <quote xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">else
      if</literal></quote> forms: <literal xmlns:xlink="http://www.w3.org/1999/xlink">elif</literal>,
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">elifdef</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">elifndef</literal>,
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">elifmake</literal>, and <literal xmlns:xlink="http://www.w3.org/1999/xlink">elifnmake</literal>.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">For instance, if you wish to create two versions of a
      program, one of which is optimized (the production version) and
      the other of which is for debugging (has symbols for dbx),
      you have two choices: you can create two makefiles, one of
      which uses the <option xmlns:xlink="http://www.w3.org/1999/xlink">-g</option> flag for the compilation,
      while the other uses the <option xmlns:xlink="http://www.w3.org/1999/xlink">-O</option> flag, or you
      can use another target (call it debug) to create the debug
      version.  The construct below will take care of this for you.
      I have also made it  so  defining the variable
      <envar xmlns:xlink="http://www.w3.org/1999/xlink">DEBUG</envar> (say with <command xmlns:xlink="http://www.w3.org/1999/xlink">pmake -D DEBUG</command>)
      will also cause the debug version to be made.</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">#if defined(DEBUG) || make(debug)
CFLAGS         += -g
#else
CFLAGS         += -O
#endif</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">There are, of course, problems with this approach.  The most
      glaring annoyance is that if you want to go from making a
      debug version to making a production version, you have to
      remove all the object files, or you will get some optimized
      and some debug versions in the same program.  Another
      annoyance is you have to be careful not to make two targets that
      <quote xmlns:xlink="http://www.w3.org/1999/xlink">conflict</quote> because of some conditionals in the makefile.
      For instance:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">#if make(print)
FORMATTER = ditroff -Plaser_printer
#endif
#if make(draft)
FORMATTER = nroff -Pdot_matrix_printer
#endif</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">would wreak havoc if you tried <command xmlns:xlink="http://www.w3.org/1999/xlink">pmake draft print</command>
      since you would use the same formatter for each target.  As I said,
      this all gets somewhat complicated.</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="ashell">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="ashelltitle">A Shell is a Shell is a Shell</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">In normal operation, the Bourne Shell (better known
      as <application xmlns:xlink="http://www.w3.org/1999/xlink">sh</application>) is used to execute the
      commands to re-create  targets.  <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
      also allows you to specify a different shell for it to use when
      executing these commands.  There are several things
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> must know about
      the shell you wish to use.  These things are specified as the
      sources for the <buildtarget>.SHELL</buildtarget> target by
      keyword, as follows:</para>

    <variablelist xmlns:xlink="http://www.w3.org/1999/xlink">
      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">path=path</literal></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> needs to know where
	    the shell actually resides, so it can execute it.  If
	    you specify this and nothing else,
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will use the last
	    component of the path and look in its table of the
	    shells it knows and use the specification it finds, if
	    any.  Use this if you just want to use a different
	    version of the <application xmlns:xlink="http://www.w3.org/1999/xlink">Bourne</application> or
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">C Shell</application> (yes,
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> knows how to use the
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">C Shell</application> too).</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">name=name</literal></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This is the name by which the shell is to be
	    known.  It is a single word and, if no other keywords
	    are specified (other than path), it is the name by
	    which <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> attempts to find
	    a specification for it (as  mentioned above).  You
	    can use this if you would just rather use the C Shell
	    than the <application xmlns:xlink="http://www.w3.org/1999/xlink">Bourne Shell</application>
	    (<literal xmlns:xlink="http://www.w3.org/1999/xlink">.SHELL: name=csh</literal> will do it).</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">quiet=echo-off</literal> command</term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">As mentioned before, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	    actually controls whether commands are printed by
	    introducing commands into the shell's input stream.
	    This keyword, and the next two, control what those commands
	    are.  The <literal xmlns:xlink="http://www.w3.org/1999/xlink">quiet</literal> keyword is the command
	    used to turn echoing off.  Once it is turned off, echoing is
	    expected to remain off until the <literal xmlns:xlink="http://www.w3.org/1999/xlink">echo-on</literal>
	    command is given.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">echo=echo-on</literal> command</term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">The command <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	    should give to turn echoing back on again.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">filter=printed echo-off</literal> command</term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Many shells will echo the
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">echo-off</literal> command when it is given.
	    This keyword tells <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> in what
	    format the shell actually prints the <literal xmlns:xlink="http://www.w3.org/1999/xlink">echo-off</literal>
	    command.  Wherever <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	    sees this string in the shell's output, it will
	    delete it and  any  following whitespace, up to and
	    including the next newline.  See the example at the
	    end of this section for more details.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">echoFlag=flag</literal> to turn echoing on</term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Unless a target has been marked
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">.SILENT</literal>, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	    wants to start the shell running with echoing on.  To do
	    this, it passes this flag to the shell as one of its
	    arguments. If either this or the next flag begins with a
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal>, the flags will be passed to the
	    shell as separate arguments.  Otherwise, the two will
	    be concatenated (if they are used at the same time, of
	    course).</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">errFlag=flag</literal> to turn error checking on</term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Likewise, unless a  target  is  marked
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">.IGNORE</literal>,
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> wishes error-checking
	    to be on from the very start. To this end, it will pass
	    this flag to the shell as an argument.  The same
	    rules for an initial <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal> apply as for
	    the <literal xmlns:xlink="http://www.w3.org/1999/xlink">echoFlag</literal>.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">check=command</literal> to turn error checking on</term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Just as for echo-control, error-control is achieved
	    by inserting  commands into the shell's input stream.
	    This is the command to make the shell check for errors.
	    It also serves another purpose if the shell does not
	    have error-control as commands, but I will get into that
	    in a minute.  Again, once error checking has been turned
	    on, it is expected to remain on until it is turned off
	    again.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">ignore=command</literal>to turn error checking off</term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This is the command <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	    uses to turn error checking off.  It has another use if
	    the shell does not do errorcontrol, but I will tell you
	    about that...now.</para>
	</listitem>
      </varlistentry>

      <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">hasErrCtl=yes</literal> or <literal xmlns:xlink="http://www.w3.org/1999/xlink">no</literal></term>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">This takes a value that is either
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">yes</literal> or <literal xmlns:xlink="http://www.w3.org/1999/xlink">no</literal>.  Now
	    you might think that the existence of the check and
	    ignore keywords would be enough to tell
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> if the shell can do
	    error-control, but you would be wrong.  If
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">hasErrCtl</literal> is <literal xmlns:xlink="http://www.w3.org/1999/xlink">yes</literal>,
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> uses the check and
	    ignore commands in a straight-forward manner.  If this
	    is no, however, their use is rather different.  In this
	    case, the check command is used as a template, in which
	    the string <literal xmlns:xlink="http://www.w3.org/1999/xlink">%s</literal> is replaced by the
	    command that is about to be executed, to produce a
	    command for the shell that will echo the command to be
	    executed.  The ignore command is also used as a template,
	    again with <literal xmlns:xlink="http://www.w3.org/1999/xlink">%s</literal> replaced by the command
	    to be executed, to produce a command that will
	    execute the command to be executed and ignore any error
	    it returns.  When these strings are used as templates,
	    you must provide newline(s) (<literal xmlns:xlink="http://www.w3.org/1999/xlink">\n</literal>) in
	    the appropriate place(s).</para>
	</listitem>
      </varlistentry>
    </variablelist>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The strings that follow these keywords may be enclosed in
      single or double quotes (the quotes will be stripped off) and
      may contain the usual C backslash-characters
      (<literal xmlns:xlink="http://www.w3.org/1999/xlink">\n</literal> is newline, <literal xmlns:xlink="http://www.w3.org/1999/xlink">\r</literal> is
      return, <literal xmlns:xlink="http://www.w3.org/1999/xlink">\b</literal> is backspace,
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">\'</literal> escapes a single-quote inside
      single-quotes, <literal xmlns:xlink="http://www.w3.org/1999/xlink">\"</literal> escapes a double-quote
      inside double-quotes).  Now for an example.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">This is actually the contents of the &lt;shx.mk&gt; system
      makefile, and causes <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
      to use the <application xmlns:xlink="http://www.w3.org/1999/xlink">Bourne Shell</application> in such a way
      that  each command is printed as it is executed. That is, if
      more than one command is given on a line, each will be
      printed separately.  Similarly, each time the body of a loop
      is executed, the commands within that loop will be printed,
      etc.  The specification runs like this:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">#
# This is a shell specification to have the Bourne shell echo
# the commands just before executing them, rather than when it reads
# them. Useful if you want to see how variables are being expanded, etc.
#
.SHELL    : path=/bin/sh \
     quiet="set -" \
     echo="set -x" \
     filter="+ set - " \
     echoFlag=x \
     errFlag=e \
     hasErrCtl=yes \
     check="set -e" \
     ignore="set +e"</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">It tells <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> the following:</para>

    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The shell is located in the file
	  <filename xmlns:xlink="http://www.w3.org/1999/xlink">/bin/sh</filename>.  It need not tell
	  <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> that the name of the
	  shell is sh as <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> can
	  figure that out for itself (it is the last component of the
	  path).</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The command to stop echoing is set <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal>.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The command to start echoing is set <option xmlns:xlink="http://www.w3.org/1999/xlink">-x</option>.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">When the echo off command is executed, the shell
	  will print <literal xmlns:xlink="http://www.w3.org/1999/xlink">+</literal> set <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal>
	  (The <literal xmlns:xlink="http://www.w3.org/1999/xlink">+</literal> comes from using the
	  <option xmlns:xlink="http://www.w3.org/1999/xlink">-x</option> flag (rather than the
	  <option xmlns:xlink="http://www.w3.org/1999/xlink">-v</option> flag <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
	  usually uses)).  <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will
	  remove all occurrences of this string from the output, so
	  you do not notice extra commands you did not put
	  there.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The flag the <application xmlns:xlink="http://www.w3.org/1999/xlink">Bourne Shell</application>
	  will take to start echoing in this way is the
	  <option xmlns:xlink="http://www.w3.org/1999/xlink">-x</option> flag.  The <application xmlns:xlink="http://www.w3.org/1999/xlink">Bourne
	  Shell</application> will only take its flag arguments
	  concatenated as its first argument, so neither this nor
	  the errFlag specification begins with a
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">-</literal>.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The flag to use to turn error-checking on from the
	  start is <option xmlns:xlink="http://www.w3.org/1999/xlink">-e</option>.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The shell can turn error-checking on and off, and
	  the commands to do so are <literal xmlns:xlink="http://www.w3.org/1999/xlink">set +e</literal> and
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">set -e</literal>, respectively.</para>
      </listitem>
    </itemizedlist>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">I should note that this specification is for
      <application xmlns:xlink="http://www.w3.org/1999/xlink">Bourne  Shells</application>
      that are not part of Berkeley <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark>, as shells from Berkeley
      do not do error control.  You can get a similar effect,
      however, by changing the last three lines to be:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">hasErrCtl=no \
check="echo \"+ %s\"\n" \
ignore="sh -c '%s || exit 0\n"</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">This will cause <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to execute
      the two commands:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">echo "+ cmd"
sh -c 'cmd || true'</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">for each command for which errors are to be ignored.  (In
      case you are wondering, the thing for ignore tells the shell
      to execute another shell without error checking on and
      always exit 0, since the ||<literal xmlns:xlink="http://www.w3.org/1999/xlink"/> causes the
      exit 0 to be executed only  if the first command exited
      non-zero, and if the first command exited zero, the shell
      will also exit zero, since that is the last command it
      executed).</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="compatibility">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Compatibility</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">There are three (well, 3 1/2) levels of
      backwards-compatibility built into
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>.  Most makefiles will need none
      at all.  Some may need a little bit of work to operate correctly
      when run in parallel.  Each level encompasses the previous
      levels (e.g. <option xmlns:xlink="http://www.w3.org/1999/xlink">-B</option> (one shell per command) implies
      <option xmlns:xlink="http://www.w3.org/1999/xlink">-V</option>).  The three levels are described in the
      following three sections.</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="defcon3">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">DEFCON 3 &#8211; Variable Expansion</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">As noted before, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will not
      expand a variable unless it knows of a value for it.  This can
      cause problems for makefiles that expect to leave variables
      undefined except in special circumstances (e.g. if more flags
      need to be passed to the C compiler or the output from a text
      processor should be sent to a different printer).  If the
      variables are enclosed in curly braces
      (<literal xmlns:xlink="http://www.w3.org/1999/xlink">${PRINTER}</literal>), the shell will let them pass.
      If they are enclosed in parentheses, however, the shell will
      declare a syntax error and the make will come to a grinding
      halt.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">You have two choices: change the makefile to define the
      variables (their values can be overridden on the command line,
      since that is where they would have been set if you used
      <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application>, anyway) or always give the
      <option xmlns:xlink="http://www.w3.org/1999/xlink">-V</option> flag (this can be done with the
      <buildtarget>.MAKEFLAGS</buildtarget> target, if you want).</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="defcon2">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">DEFCON 2 &#8211; The Number of the Beast</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Then there are the makefiles that expect certain commands,
      such as changing to a different directory, to not affect
      other commands in a target's creation script.  You can solve
      this is either by going back to executing one shell per
      command (which is what the <option xmlns:xlink="http://www.w3.org/1999/xlink">-B</option> flag forces
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to do), which
      slows the process down a good bit and requires you to use
      semicolons and escaped newlines for shell constructs, or by
      changing the makefile to execute the offending command(s) in
      a subshell (by placing the line inside parentheses), like
      so:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">install :: .MAKE
      (cd src; $(.PMAKE) install)
      (cd lib; $(.PMAKE) install)
      (cd man; $(.PMAKE) install)</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">This will always execute the three makes (even if the
      <option xmlns:xlink="http://www.w3.org/1999/xlink">-n</option>
      flag was given) because of the combination of the
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">::</literal>
      operator and the <literal xmlns:xlink="http://www.w3.org/1999/xlink">.MAKE</literal> attribute.
      Each command will change to the proper directory to perform
      the install, leaving the main shell in the directory in
      which it started.</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="defcon1">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">DEFCON 1 &#8211; Imitation is the Not the Highest Form of
      Flattery</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The final category of makefile is the one where every command
      requires input, the dependencies are incompletely specified, or
      you simply cannot create more than one target at a time, as
      mentioned earlier.  In addition, you may not have the time or
      desire to upgrade the makefile to run smoothly with
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>.  If you are the conservative
      sort, this is the compatibility mode for you.  It is entered
      either by giving <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> the
      <option xmlns:xlink="http://www.w3.org/1999/xlink">-M</option> flag (for <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application>),
      or by executing <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> as
      <command xmlns:xlink="http://www.w3.org/1999/xlink">make.</command>  In either case,
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> performs things exactly like
      <application xmlns:xlink="http://www.w3.org/1999/xlink">Make</application> (while still supporting most
      of the nice new features <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
      provides).  This includes:</para>

    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">No parallel execution.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Targets are made in the exact order specified by the
	  makefile.  The sources for each target are made in strict
	  left-to-right order, etc.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">A single Bourne shell is used to execute each command,
	  thus the shell's <varname xmlns:xlink="http://www.w3.org/1999/xlink">$$</varname> variable is
	  useless, changing directories does not work across command
	  lines, etc.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">If no special characters exist in a command line,
	  <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> will break the command
	  into words itself and execute the command directly,
	  without executing a shell first.  The characters that
	  cause <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to execute a shell
	  are: <literal xmlns:xlink="http://www.w3.org/1999/xlink">#</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">=</literal>,
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">|</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">^</literal>,
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">(</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">)</literal>,
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">{</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">}</literal>,
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">;</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">&amp;</literal>,
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">&gt;</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">&lt;</literal>,
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">*</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">?</literal>,
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">[</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">]</literal>,
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">:</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">$</literal>,
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">`</literal>, and <literal xmlns:xlink="http://www.w3.org/1999/xlink">\</literal>.  You should
	  notice that these are all the characters that are given
	  special meaning by the shell (except <literal xmlns:xlink="http://www.w3.org/1999/xlink">'</literal>
	  and <literal xmlns:xlink="http://www.w3.org/1999/xlink">,</literal> which
	  <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> deals with all by its
	  lonesome).</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">The use of the null suffix is turned off.</para>
      </listitem>
    </itemizedlist>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="theway">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">The Way Things Work</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">When <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> reads the makefile, it
      parses sources and targets into nodes in a graph.  The graph is
      directed only in the sense that <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
      knows which way is up.  Each node contains not only links to all
      its parents and children (the nodes that depend on it and those
      on which it depends, respectively), but also a count of the
      number of its children that have already been processed.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The most important thing to know about how
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> uses this graph is that the
      traversal is breadth-first and occurs in two passes.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">After <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> has parsed the
      makefile, it begins with the nodes the user has told it to make
      (either on the command line, or via a
      <buildtarget>.MAIN</buildtarget> target, or by the target being
      the first in the file not labeled with the
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">.NOTMAIN</literal> attribute) placed in a queue.  It
      continues to take the node off the front of the queue, mark it
      as something that needs to be made, pass the node to
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">Suff_FindDeps</literal> (mentioned earlier) to find any
      implicit sources for the node, and place all the node's children
      that have yet to be marked at the end of the queue.  If any of
      the children is a <buildtarget>.USE</buildtarget> rule, its
      attributes are applied to the parent, then its commands are
      appended to the parent's list of commands and its children are
      linked to its parent.  The parent's unmade children counter is
      then decremented (since the <buildtarget>.USE</buildtarget> node
      has been processed).  You will note that this allows a
      <buildtarget>.USE</buildtarget> node to have children that are
      <buildtarget>.USE</buildtarget> nodes and the rules will be
      applied in sequence.  If the node has no children, it is placed
      at the end of another queue to be examined in the  second pass.
      This process continues until the first queue is empty.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">At this point, all the leaves of the graph are in the
      examination queue.  <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> removes the
      node at the head of the queue and sees if it is out-of-date.  If
      it is, it is passed to a function that will execute the commands
      for the node asynchronously.  When the commands have completed,
      all the node's parents have their unmade children counter
      decremented and, if the counter is then 0, they are placed on
      the examination queue.  Likewise, if the node is up-to-date.
      Only those parents that were marked on the downward pass are
      processed in this way.  Thus <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
      traverses the graph back up to the nodes the user instructed it
      to create.  When the examination queue is empty and no shells
      are running to create a target, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>
      is finished.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Once all targets have been processed,
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> executes the commands attached
      to the <buildtarget>.END</buildtarget> target, either explicitly
      or through the use of an ellipsis in a shell script.  If there
      were no errors during the entire process but there are still
      some targets unmade (<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> keeps a
      running count of how many targets are left to be made), there is
      a cycle in the graph.  <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> does a
      depth-first traversal of the graph to find all the targets that
      were not made and prints them out one by one.</para>
  </section>
</chapter>

  
<!--
    $FreeBSD$
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="answers">
  <title xmlns:xlink="http://www.w3.org/1999/xlink">Answers to Exercises</title>

  <bridgehead xmlns:xlink="http://www.w3.org/1999/xlink">Exercise 3.1</bridgehead>

  <para xmlns:xlink="http://www.w3.org/1999/xlink">This is something of a trick question, for which I apologize.
    The trick comes from the <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark> definition of a suffix, which
    <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> does not necessarily share.
    You will have noticed that all the suffixes used in this tutorial
    (and in <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark> in general) begin with a period
    (<filename xmlns:xlink="http://www.w3.org/1999/xlink">.ms</filename>, <filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename>, etc.).
    Now, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>'s idea of a suffix is more
    like English's: it is the characters at the end of a word.  With
    this in mind, one possible solution to this problem goes as
    follows:</para>

  <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">.SUFFIXES       : ec.exe .exe ec.obj .obj .asm
ec.objec.exe .obj.exe :
	link -o $(.TARGET) $(.IMPSRC)
.asmec.obj      :
	asm -o $(.TARGET) -DDO_ERROR_CHECKING $(.IMPSRC)
.asm.obj        :
	asm -o $(.TARGET) $(.IMPSRC)</programlisting>

  <bridgehead xmlns:xlink="http://www.w3.org/1999/xlink">Excercise 3.2</bridgehead>

  <para xmlns:xlink="http://www.w3.org/1999/xlink">The trick to this one lies in the <literal xmlns:xlink="http://www.w3.org/1999/xlink">:=</literal>
    variable-assignment operator and the <literal xmlns:xlink="http://www.w3.org/1999/xlink">:S</literal>
    variable-expansion modifier.  Basically what you want is to take
    the pointer variable, so to speak, and transform it into an
    invocation of the variable at which it points.  You might try
    something like:</para>

  <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">$(PTR:S/^/\$(/:S/$/))</programlisting>

  <para xmlns:xlink="http://www.w3.org/1999/xlink">which places <literal xmlns:xlink="http://www.w3.org/1999/xlink">$(</literal> at the front of the
    variable name and <literal xmlns:xlink="http://www.w3.org/1999/xlink">)</literal> at the end, thus
    transforming <literal xmlns:xlink="http://www.w3.org/1999/xlink">VAR,</literal> for example, into
    <literal xmlns:xlink="http://www.w3.org/1999/xlink">$(VAR)</literal>, which is just what we want.
    Unfortunately (as you know if you have tried it), since, as it
    says in the hint, <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> does no further
    substitution on the result of a modified expansion, that is all
    you get.  The solution is to make use of <literal xmlns:xlink="http://www.w3.org/1999/xlink">:=</literal> to
    place that string into yet another variable, then invoke the other
    variable directly:</para>

  <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">*PTR            := $(PTR:S/^/\$(/:S/$/)/)</programlisting>

  <para xmlns:xlink="http://www.w3.org/1999/xlink">You can then use <literal xmlns:xlink="http://www.w3.org/1999/xlink">$(*PTR)</literal> to your heart's
    content.</para>
</chapter>


  
<!--
     $FreeBSD$
-->
<glossary xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="glossary">
  <title xmlns:xlink="http://www.w3.org/1999/xlink">Glossary of Jargon</title>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">attribute</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">A property given to a target that causes
	<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to treat it differently.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="cmdscript">command script</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">The lines immediately following a dependency line that specify
	commands to execute to create each of the targets on the dependency
	line.  Each line in the command script must begin with a tab.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">command-line variable</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">A variable defined in an argument when
	<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is first executed.
	Overrides all assignments to the same variable name in the
	makefile.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">conditional</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">A construct much like that used in C that allows a makefile to be
	configured on the fly based on the local environment, or on what is
	being made by that invocation of <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">creation script</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Commands used to create a target.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">dependency</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">The relationship between a source and a target.  This comes in
	three flavors, as indicated by the operator between the target and the
	source.  <literal xmlns:xlink="http://www.w3.org/1999/xlink">:</literal> gives a straight time-wise dependency
	(if the target is older than the source, the target is out-of-date),
	while <literal xmlns:xlink="http://www.w3.org/1999/xlink">!</literal> provides simply an ordering and always
	considers the target out-of-date.  <literal xmlns:xlink="http://www.w3.org/1999/xlink">::</literal> is much like
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">:</literal>, save it creates multiple instances of a target
	each of which depends on its own list of sources.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">dynamic source</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">This refers to a source that has a local variable invocation in
	it.  It allows a single dependency line to specify a different source
	for each target on the line.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">global variable</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Any variable defined in a makefile.  Takes precedence over
	variables defined in the environment, but not over command-line or
	local variables.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">input graph</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">What <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> constructs from a makefile.
	Consists of nodes made of the targets in the makefile, and the links
	between them (the dependencies).  The links are directed (from source
	to target) and there may not be any cycles (loops) in the graph.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">local variable</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">A variable defined by <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> visible
	only in a target's shell script.
	There are seven local variables, not all of which are defined for
	every target: <varname xmlns:xlink="http://www.w3.org/1999/xlink">.TARGET</varname>, <varname xmlns:xlink="http://www.w3.org/1999/xlink">.ALLSRC</varname>,
	<varname xmlns:xlink="http://www.w3.org/1999/xlink">.OODATE</varname>, <varname xmlns:xlink="http://www.w3.org/1999/xlink">.PREFIX</varname>,
	<varname xmlns:xlink="http://www.w3.org/1999/xlink">.IMPSRC</varname>, <varname xmlns:xlink="http://www.w3.org/1999/xlink">.ARCHIVE</varname>, and
	<varname xmlns:xlink="http://www.w3.org/1999/xlink">.MEMBER</varname>.
	<varname xmlns:xlink="http://www.w3.org/1999/xlink">.TARGET</varname>, <varname xmlns:xlink="http://www.w3.org/1999/xlink">.PREFIX</varname>,
	<varname xmlns:xlink="http://www.w3.org/1999/xlink">.ARCHIVE</varname>, and <varname xmlns:xlink="http://www.w3.org/1999/xlink">.MEMBER</varname>
	may be used on dependency lines to create
	<quote xmlns:xlink="http://www.w3.org/1999/xlink">dynamic sources</quote>.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">makefile</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">A file that describes how a system is built.  If you do not know
	what it is after reading this tutorial&#8230;</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">modifier</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">A letter, following a colon, used to alter how a variable is
	expanded.  It has no effect on the variable itself.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">operator</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">What separates a source from a target (on a dependency line) and
	specifies the relationship between the two.  There are three:
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">:</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">::</literal>,
	and <literal xmlns:xlink="http://www.w3.org/1999/xlink">!</literal>.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">search path</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">A list of directories in which a file should be sought.
	<application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application>'s view of the contents of directories
	in a search path does not change once the makefile has been read.
	A file is sought on a search path only if it is exclusively a
	source.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">shell</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">A program to which commands are passed in order to create
	targets.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">source</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Anything to the right of an operator on a dependency line.
	Targets on the dependency line are usually created
	from the sources.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">special target</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">A target that causes <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> to do
      special things when it is encountered.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">suffix</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">The tail end of a file name.  Usually begins with a period, like
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">.c</filename> or <filename xmlns:xlink="http://www.w3.org/1999/xlink">.ms</filename>.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">target</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">A word to the left of the operator on a dependency line.
	More generally, any file that <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> might
	create.  A file may be (and often is) both a target and a source (what
	it is depends on how <application xmlns:xlink="http://www.w3.org/1999/xlink">PMake</application> is looking at it
	at the time &#8211; sort of like the wave/particle duality of light,
	you know).</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">transformation rule</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">A special construct in a makefile that specifies how to create a
	file of one type from a file of another, as indicated by their
	suffixes.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">variable expansion</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">The process of substituting the value of a variable for a
	reference to it.  Expansion may be altered by means of modifiers.</para>
    </glossdef>
  </glossentry>

  <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
    <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">variable</glossterm>

    <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">A place in which to store text that may be retrieved later.
	Also used to define the local environment.
	Conditionals exist that test whether a variable is defined or not.</para>
    </glossdef>
  </glossentry>
</glossary>

</book>
