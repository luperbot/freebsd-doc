<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>7.6. Expanding Package List with Keywords</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="plist.html" title="Chapter 7. Advanced pkg-plist Practices" /><link rel="prev" href="plist-autoplist.html" title="7.5. Automated Package List Creation" /><link rel="next" href="pkg-files.html" title="Chapter 8. pkg-*" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">7.6. Expanding Package List with Keywords</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="plist-autoplist.html">Prev</a> </td><th width="60%" align="center">Chapter 7. Advanced <code class="filename">pkg-plist</code> Practices</th><td width="20%" align="right"> <a accesskey="n" href="pkg-files.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="plist-keywords"></a>7.6. Expanding Package List with Keywords</h2></div></div></div><p>All keywords can also take optional arguments in
      parentheses.  The arguments are owner, group, and mode.  This
      argument is used on the file or directory referenced.
      To change the owner, group, and mode of a configuration file,
      use:</p><pre class="programlisting">@sample(games,games,640) etc/config.sample</pre><p>The arguments are optional.  If only the group and mode
      need to be changed, use:</p><pre class="programlisting">@sample(,games,660) etc/config.sample</pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-desktop-file-utils"></a>7.6.1. <code class="literal">@desktop-file-utils</code></h3></div></div></div><p>Will run <code class="command">update-desktop-database -q</code>
	after installation and deinstallation.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-fcfontsdir"></a>7.6.2. <code class="literal">@fcfontsdir</code>
	<em class="replaceable"><code>directory</code></em></h3></div></div></div><p>Add a <code class="literal">@dir</code> entry for the
	directory passed as an argument, and run <code class="command">fc-cache
	  -s</code>, <code class="command">mkfontscale</code> and
	<code class="command">mkfontdir</code> on that directory after
	installation and deinstallation.  Additionally, on
	deinstallation, it removes the
	<code class="filename">fonts.scale</code> and
	<code class="filename">fonts.dir</code> cache files if they are
	empty.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-glib-schemas"></a>7.6.3. <code class="literal">@glib-schemas</code></h3></div></div></div><p>Runs <code class="command">glib-compile-schemas</code> on
	installation and deinstallation.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-info"></a>7.6.4. <code class="literal">@info</code>
	<em class="replaceable"><code>file</code></em></h3></div></div></div><p>Add the file passed as argument to the plist, and updates
	the info document index on installation and deinstallation.
	Additionally, it removes the index if empty on
	deinstallation.  This should never be used manually, but
	always through <code class="varname">INFO</code>.  See <a class="xref" href="makefile-info.html" title="5.11. Info Files">Section 5.11, &#8220;Info Files&#8221;</a> for more information.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-kld"></a>7.6.5. <code class="literal">@kld</code>
	<em class="replaceable"><code>directory</code></em></h3></div></div></div><p>Runs <code class="command">kldxref</code> on the directory
	on installation and deinstallation.  Additionally, on
	deinstallation, it will remove the directory if empty.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-rmtry"></a>7.6.6. <code class="literal">@rmtry</code>
	<em class="replaceable"><code>file</code></em></h3></div></div></div><p>Will remove the file on deinstallation, and not give an
	error if the file is not there.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-sample"></a>7.6.7. <code class="literal">@sample</code>
	<em class="replaceable"><code>file</code></em></h3></div></div></div><p>Add the file passed as argument to the plist.</p><p>On installation, check for a <span class="quote">&#8220;<span class="quote">real</span>&#8221;</span> file with
	just the base name (the name without the
	<code class="filename">.sample</code> extension).  If the real file is
	not found, copy the sample file to the base file name.  On
	deinstallation, remove the configuration file if it has not
	been modified.  See <a class="xref" href="plist-config.html" title="7.3. Configuration Files">Section 7.3, &#8220;Configuration Files&#8221;</a> for more
	information.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-shared-mime-info"></a>7.6.8. <code class="literal">@shared-mime-info</code>
	<em class="replaceable"><code>directory</code></em></h3></div></div></div><p>Runs <code class="command">update-mime-database</code> on the
	directory on installation and deinstallation.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-shell"></a>7.6.9. <code class="literal">@shell</code>
	<em class="replaceable"><code>file</code></em></h3></div></div></div><p>Add the file passed as argument to the plist.</p><p>On installation, add the full path to
	<em class="replaceable"><code>file</code></em> to
	<code class="filename">/etc/shells</code>, while making sure it is not
	added twice.  On deinstallation, remove it from
	<code class="filename">/etc/shells</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-base"></a>7.6.10. Base Keywords</h3></div></div></div><p>There are a few keywords that are hardcoded, and
	documented in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pkg-create&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pkg-create</span>(8)</span></a>.  For the sake of
	completeness, they are also documented here.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-base-empty"></a>7.6.10.1. <code class="literal">@</code>
	  [<em class="replaceable"><code>file</code></em>]</h4></div></div></div><p>The empty keyword is a placeholder to use when the
	  file's owner, group, or mode need to be changed.  For
	  example, to set the group of the file to
	  <code class="literal">games</code> and add the setgid bit, add:</p><pre class="programlisting">@(,games,2755) sbin/daemon</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-base-cwd"></a>7.6.10.2. <code class="literal">@cwd</code>
	  [<em class="replaceable"><code>directory</code></em>] (Deprecated)</h4></div></div></div><p>Set the internal directory pointer to point to
	  directory.  All subsequent filenames are assumed relative to
	  this directory.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-base-exec"></a>7.6.10.3. <code class="literal">@exec</code>
	  <em class="replaceable"><code>command</code></em></h4></div></div></div><p>Execute <em class="replaceable"><code>command</code></em> as part of
	  the unpacking process.  If command contains any of these
	  sequences somewhere in it, they are expanded
	  inline.  For these examples, assume that
	  <code class="literal">@cwd</code> is set to
	  <code class="filename">/usr/local</code> and the last
	  extracted file was <code class="filename">bin/emacs</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">%F</code></span></dt><dd><p>Expand to the last filename extracted (as
		specified).  In the example case
		<code class="filename">bin/emacs</code>.</p></dd><dt><span class="term"><code class="literal">%D</code></span></dt><dd><p>Expand to the current directory prefix, as set
		with <code class="literal">@cwd</code>.  In the example case
		<code class="filename">/usr/local</code>.</p></dd><dt><span class="term"><code class="literal">%B</code></span></dt><dd><p>Expand to the basename of the fully qualified
		filename, that is, the current directory prefix plus
		the last filespec, minus the trailing filename.  In
		the example case, that would be
		<code class="filename">/usr/local/bin</code>.</p></dd><dt><span class="term"><code class="literal">%f</code></span></dt><dd><p>Expand to the filename part of the fully qualified
		name, or the converse of <code class="literal">%B</code>.  In
		the example case,
		<code class="filename">emacs</code>.</p></dd></dl></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-base-unexec"></a>7.6.10.4. <code class="literal">@unexec</code>
	  <em class="replaceable"><code>command</code></em></h4></div></div></div><p>Execute <em class="replaceable"><code>command</code></em> as part of
	  the deinstallation process.  Expansion of special
	  <code class="literal">%</code> sequences is the same as for
	  <code class="literal">@exec</code>.  This command is not executed
	  during the package add, as <code class="literal">@exec</code> is, but
	  rather when the package is deleted.  This is useful for
	  deleting links and other ancillary files that were created
	  as a result of adding the package, but not directly known to
	  the package's table of contents (and hence not automatically
	  removable).</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-base-mode"></a>7.6.10.5. <code class="literal">@mode</code>
	  <em class="replaceable"><code>mode</code></em></h4></div></div></div><p>Set default permission for all subsequently extracted
	  files to <em class="replaceable"><code>mode</code></em>.  Format is the
	  same as that used by <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chmod&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chmod</span>(1)</span></a>.  Use without an arg to
	  set back to default permissions (mode of the file while
	  being packed).</p><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">This must be a numeric mode, like
	    <code class="literal">644</code>, <code class="literal">4755</code>, or
	    <code class="literal">600</code>.  It cannnot be a relative mode
	    like <code class="literal">u+s</code>.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-base-owner"></a>7.6.10.6. <code class="literal">@owner</code>
	  <em class="replaceable"><code>user</code></em></h4></div></div></div><p>Set default ownership for all subsequent files to
	  <em class="replaceable"><code>user</code></em>.  Use without an argument to
	  set back to default ownership (<code class="systemitem">root</code>).</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-base-group"></a>7.6.10.7. <code class="literal">@group</code>
	  <em class="replaceable"><code>group</code></em></h4></div></div></div><p>Set default group ownership for all subsequent files to
	  <em class="replaceable"><code>group</code></em>.  Use without an arg to set
	  back to default group ownership (<code class="systemitem">wheel</code>).</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-base-comment"></a>7.6.10.8. <code class="literal">@comment</code>
	  <em class="replaceable"><code>string</code></em></h4></div></div></div><p>This line is ignored when packing.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-base-dir"></a>7.6.10.9. <code class="literal">@dir</code>
	  <em class="replaceable"><code>directory</code></em></h4></div></div></div><p>Declare directory name.  By default, directories created
	  under <code class="varname">PREFIX</code> by a package installation
	  are automatically removed.  Use this when an empty directory
	  under <code class="varname">PREFIX</code> needs to be created, or when
	  the directory needs to have non default owner, group, or
	  mode.  Directories outside of <code class="varname">PREFIX</code> need
	  to be registered.  For example,
	  <code class="filename">/var/db/${PORTNAME}</code> needs to have a
	  <code class="literal">@dir</code> entry whereas
	  <code class="filename">${PREFIX}/share/${PORTNAME}</code> does not if
	  it contains files or uses the default owner, group, and
	  mode.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-base-dirrm"></a>7.6.10.10. <code class="literal">@dirrm</code>
	  <em class="replaceable"><code>directory</code></em> (Deprecated)</h4></div></div></div><p>Declare directory name to be deleted at deinstall time.
	  By default, directories created under
	  <code class="varname">PREFIX</code> by a package installation are
	  deleted when the package is deinstalled.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-base-dirrmtry"></a>7.6.10.11. <code class="literal">@dirrmtry</code>
	  <em class="replaceable"><code>directory</code></em> (Deprecated)</h4></div></div></div><p>Declare directory name to be removed, as for
	  <code class="literal">@dirrm</code>, but does not issue a warning if
	  the directory cannot be removed.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist-keywords-creating-new"></a>7.6.11. Creating New Keywords</h3></div></div></div><p>Package list files can be extended by keywords that are
	defined in the <code class="filename">${PORTSDIR}/Keywords</code>
	directory.  The settings for each keyword are stored in a
	<acronym class="acronym">UCL</acronym> file named
	<code class="filename"><em class="replaceable"><code>keyword</code></em>.ucl</code>.
	The file must contain at least one of the next
	sections:</p><div class="variablelist"><dl class="variablelist"><dt><a id="plist-keywords-attributes"></a><span class="term"><code class="literal">attributes</code></span></dt><dd><p>Changes the owner, group, or mode used by the
	      keyword.  Contains an associative array where the
	      possible keys are <code class="literal">owner</code>,
	      <code class="literal">group</code>, and <code class="literal">mode</code>.
	      The values are, respectively, a user name, a group name,
	      and a file mode.  For example:</p><pre class="programlisting">attributes: { owner: "games", group: "games", mode: 0555 }</pre></dd><dt><a id="plist-keywords-action"></a><span class="term"><code class="literal">action</code></span></dt><dd><p>Defines what happens to the keyword's parameter.
	      Contains an array where the possible values are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">setprefix</code></span></dt><dd><p>Set the prefix for the next plist
		    entries.</p></dd><dt><span class="term"><code class="literal">dir</code></span></dt><dd><p>Register a directory to be created on
		    install and removed on deinstall.</p></dd><dt><span class="term"><code class="literal">dirrm</code></span></dt><dd><p>Register a directory to be deleted on
		    deinstall.  Deprecated.</p></dd><dt><span class="term"><code class="literal">dirrmtry</code></span></dt><dd><p>Register a directory to try and deleted on
		    deinstall.  Deprecated.</p></dd><dt><span class="term"><code class="literal">file</code></span></dt><dd><p>Register a file.</p></dd><dt><span class="term"><code class="literal">setmode</code></span></dt><dd><p>Set the mode for the next plist
		    entries.</p></dd><dt><span class="term"><code class="literal">setowner</code></span></dt><dd><p>Set the owner for the next plist
		    entries.</p></dd><dt><span class="term"><code class="literal">setgroup</code></span></dt><dd><p>Set the group for the next plist
		    entries.</p></dd><dt><span class="term"><code class="literal">comment</code></span></dt><dd><p>Does not do anything, equivalent to not
		    entering an <code class="literal">action</code>
		    section.</p></dd><dt><span class="term"><code class="literal">ignore_next</code></span></dt><dd><p>Ignore the next entry in the plist.</p></dd></dl></div></dd><dt><a id="plist-keywords-pre-post"></a><span class="term"><code class="literal">pre-install</code>, </span><span class="term"><code class="literal">post-install</code>, </span><span class="term"><code class="literal">pre-deinstall</code>, </span><span class="term"><code class="literal">post-deinstall</code>, </span><span class="term"><code class="literal">pre-upgrade</code>, </span><span class="term"><code class="literal">post-upgrade</code></span></dt><dd><p>These keywords contains a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> script to be
	      executed before or after installation, deinstallation,
	      or upgrade of the package.  In addition to the usual
	      <code class="literal">@exec</code>
	      <code class="literal">%<em class="replaceable"><code>foo</code></em></code>
	      placeholders described in <a class="xref" href="plist-keywords.html#plist-keywords-base-exec" title="7.6.10.3. @exec command">Section 7.6.10.3, &#8220;<code class="literal">@exec</code>
	  <em class="replaceable"><code>command</code></em>&#8221;</a>, there is a new
	      one, <code class="literal">%@</code>, which represents the
	      argument of the keyword.</p></dd></dl></div><div class="example"><a id="plist-keywords-fc-example"></a><div class="example-title">Example 7.1. Example of a <code class="literal">@dirrmtryecho</code>
	  Keyword</div><div class="example-contents"><p>This keyword does two things, it adds a
	  <code class="literal">@dirrmtry
	    <em class="replaceable"><code>directory</code></em></code> line to the
	  packing list, and echoes the fact that the directory is
	  removed when deinstalling the package.</p><pre class="programlisting">actions: [dirrmtry]
post-deinstall: &lt;&lt;EOD
  echo "Directory %D/%@ removed."
EOD</pre></div></div><br class="example-break" /><div class="example"><a id="plist-keywords-sample-example"></a><div class="example-title">Example 7.2. Real Life Example, How <code class="literal">@sample</code>
	  is Implemented</div><div class="example-contents"><p>This keyword does three things, it adds the
	  <em class="replaceable"><code>filename</code></em> passed as an argument to
	  <code class="literal">@sample</code> to the packing list, it adds to
	  the <code class="literal">post-install</code> script instructions to
	  copy the sample to the actual configuration file if it does
	  not already exist, and it adds to the
	  <code class="literal">post-deinstall</code> instructions to remove the
	  configuration file if it has not been modified.</p><pre class="programlisting">actions: [file]
post-install: &lt;&lt;EOD
  case "%@" in
  /*) sample_file="%@" ;;
  *) sample_file="%D/%@" ;;
  esac
  target_file="${sample_file%.sample}"
  if ! [ -f "${target_file}" ]; then
    /bin/cp -p "${sample_file}" "${target_file}"
  fi
EOD
pre-deinstall: &lt;&lt;EOD
  case "%@" in
  /*) sample_file="%@" ;;
  *) sample_file="%D/%@" ;;
  esac
  target_file="${sample_file%.sample}"
  if cmp -s "${target_file}" "${sample_file}"; then
    rm -f "${target_file}"
  else
    echo "You may need to manually remove ${target_file} if it's no longer needed."
  fi
EOD</pre></div></div><br class="example-break" /></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="plist-autoplist.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="plist.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="pkg-files.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">7.5. Automated Package List Creation </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 8. <code class="filename">pkg-*</code></td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>