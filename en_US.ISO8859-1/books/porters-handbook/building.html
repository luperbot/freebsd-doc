<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>6.5. Building Mechanisms</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="special.html" title="Chapter 6. Special Considerations" /><link rel="prev" href="porting-restrictions.html" title="6.4. Ports with Distribution Restrictions or Legal Concerns" /><link rel="next" href="using-autotools.html" title="6.6. Using GNU Autotools" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.5. Building Mechanisms</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="porting-restrictions.html">Prev</a> </td><th width="60%" align="center">Chapter 6. Special Considerations</th><td width="20%" align="right"> <a accesskey="n" href="using-autotools.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="building"></a>6.5. Building Mechanisms</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="parallel-builds"></a>6.5.1. Building Ports in Parallel</h3></div></div></div><p>The FreeBSD ports framework supports parallel building
	using multiple <code class="command">make</code> sub-processes, which
	allows <acronym class="acronym">SMP</acronym> systems to utilize all of
	their available <acronym class="acronym">CPU</acronym> power, allowing port
	builds to be faster and more effective.</p><p>This is achieved by passing <code class="varname">-jX</code> flag
	to <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> running on vendor code.  This is the default
	build behavior of ports.  Unfortunately, not all ports
	handle parallel building well and it may be required to
	explicitly disable this feature by adding the
	<code class="literal">MAKE_JOBS_UNSAFE=yes</code> variable.  It is
	used when a port is known to be broken with
	<code class="varname">-jX</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="using-make"></a>6.5.2. <code class="command">make</code>, <code class="command">gmake</code>,
	<code class="command">fmake</code>, and <code class="command">imake</code></h3></div></div></div><p>Several differing <code class="literal">make</code>
	implementations exist.  Ported software often requires a
	particular implementation, like <acronym class="acronym">GNU</acronym>
	<code class="command">make</code>, known in FreeBSD as
	<code class="command">gmake</code>, or <code class="command">fmake</code>, the
	legacy FreeBSD <code class="command">make</code>.</p><p>If the port uses <span class="application">GNU make</span>,
	add <code class="literal">gmake</code> to <code class="literal">USES</code>.  If
	the legacy FreeBSD <code class="command">make</code> is needed, add
	<code class="literal">fmake</code> there.</p><p><code class="varname">MAKE_CMD</code> can be used to reference the
	specific command configured by the <code class="literal">USES</code>
	setting in the port's <code class="filename">Makefile</code>.  In
	rare cases when more than one <code class="literal">make</code>
	implementation is listed in <code class="literal">USES</code>, the
	variables <code class="varname">GMAKE</code> (for the
	<acronym class="acronym">GNU</acronym> version) or <code class="varname">FMAKE</code>
	(for the legacy FreeBSD version) are available.
	Only use <code class="varname">MAKE_CMD</code> within the
	application <code class="filename">Makefile</code>s in
	<code class="varname">WRKSRC</code> to call the
	<code class="command">make</code> implementation expected by the
	ported software.</p><p>If the port is an X application that uses
	<span class="application">imake</span> to create
	<code class="filename">Makefile</code>s from
	<code class="filename">Imakefile</code>s, set <code class="literal">USES=
	  imake</code>..  See the <a class="link" href="uses.html#uses-imake"><code class="literal">USES=imake</code></a>
	section of <a class="xref" href="uses.html" title="Chapter 15. Values of USES">Chapter 15, <em>Values of
    <code class="varname">USES</code></em></a> for more details.</p><p>If the port's source <code class="filename">Makefile</code> has
	something other than <code class="buildtarget">all</code> as the
	main build target, set <code class="varname">ALL_TARGET</code>
	accordingly.  The same goes for
	<code class="buildtarget">install</code> and
	<code class="varname">INSTALL_TARGET</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="using-configure"></a>6.5.3. <code class="command">configure</code> Script</h3></div></div></div><p>If the port uses the <code class="command">configure</code>
	script to generate <code class="filename">Makefile</code> from
	<code class="filename">Makefile.in</code>, set
	<code class="literal">GNU_CONFIGURE=yes</code>.  To give
	extra arguments to the <code class="command">configure</code> script
	(the default argument is <code class="literal">--prefix=${PREFIX}
	  --infodir=${PREFIX}/${INFO_PATH}
	  --mandir=${MANPREFIX}/man
	  --build=${CONFIGURE_TARGET}</code>), set those
	extra arguments in <code class="varname">CONFIGURE_ARGS</code>.  Extra
	environment variables can be passed using
	<code class="varname">CONFIGURE_ENV</code>.</p><div class="table"><a id="using-configure-variables"></a><div class="table-title">Table 6.1. Variables for Ports That Use
	  <code class="command">configure</code></div><div class="table-contents"><table summary="Variables for Ports That Use&#10;&#9;  configure" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Variable</th><th>Means</th></tr></thead><tbody><tr><td><code class="varname">GNU_CONFIGURE</code></td><td>The port uses <code class="command">configure</code>
		script to prepare build.</td></tr><tr><td><code class="varname">HAS_CONFIGURE</code></td><td>Same as <code class="varname">GNU_CONFIGURE</code>,
		except default configure target is not added to
		<code class="varname">CONFIGURE_ARGS</code>.</td></tr><tr><td><code class="varname">CONFIGURE_ARGS</code></td><td>Additional arguments passed to
		<code class="command">configure</code> script.</td></tr><tr><td><code class="varname">CONFIGURE_ENV</code></td><td>Additional environment variables to be set
		for <code class="command">configure</code> script run.</td></tr><tr><td><code class="varname">CONFIGURE_TARGET</code></td><td>Override default configure target.  Default
		value is
		<code class="literal">${MACHINE_ARCH}-portbld-freebsd${OSREL}</code>.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="using-cmake"></a>6.5.4. Using <code class="command">cmake</code></h3></div></div></div><p>For ports that use <span class="application">CMake</span>,
	define <code class="literal">USES= cmake</code>, or
	<code class="literal">USES= cmake:outsource</code> to build in a
	separate directory (see below).</p><div class="table"><a id="using-cmake-variables"></a><div class="table-title">Table 6.2. Variables for Ports That Use
	  <code class="command">cmake</code></div><div class="table-contents"><table summary="Variables for Ports That Use&#10;&#9;  cmake" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Variable</th><th>Means</th></tr></thead><tbody><tr><td><code class="varname">CMAKE_ARGS</code></td><td>Port specific <span class="application">CMake</span>
		flags to be passed to the <code class="command">cmake</code>
		binary.</td></tr><tr><td><code class="varname">CMAKE_BUILD_TYPE</code></td><td>Type of build (<span class="application">CMake</span>
		predefined build profiles).  Default is
		<code class="literal">Release</code>, or
		<code class="literal">Debug</code> if
		<code class="varname">WITH_DEBUG</code> is set.</td></tr><tr><td><code class="varname">CMAKE_ENV</code></td><td>Environment variables to be set for the
		<code class="command">cmake</code> binary.  Default is
		<code class="literal">${CONFIGURE_ENV}</code>.</td></tr><tr><td><code class="varname">CMAKE_SOURCE_PATH</code></td><td>Path to the source directory.  Default is
		<code class="literal">${WRKSRC}</code>.</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="using-cmake-user-variables"></a><div class="table-title">Table 6.3. Variables the Users Can Define for
	  <code class="command">cmake</code> Builds</div><div class="table-contents"><table summary="Variables the Users Can Define for&#10;&#9;  cmake Builds" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Variable</th><th>Means</th></tr></thead><tbody><tr><td><code class="varname">CMAKE_VERBOSE</code></td><td>Enable verbose build output.  Default not set,
		unless <code class="varname">BATCH</code> or
		<code class="varname">PACKAGE_BUILDING</code> are set.</td></tr><tr><td><code class="varname">CMAKE_NOCOLOR</code></td><td>Disables colour build output.  Default not set,
		unless <code class="varname">BATCH</code> or
		<code class="varname">PACKAGE_BUILDING</code> are set.</td></tr></tbody></table></div></div><br class="table-break" /><p><span class="application">CMake</span> supports these
	build profiles: <code class="literal">Debug</code>,
	<code class="literal">Release</code>,
	<code class="literal">RelWithDebInfo</code> and
	<code class="literal">MinSizeRel</code>.  <code class="literal">Debug</code> and
	<code class="literal">Release</code> profiles respect system
	<code class="literal">*FLAGS</code>, <code class="literal">RelWithDebInfo</code>
	and <code class="literal">MinSizeRel</code> will set
	<code class="varname">CFLAGS</code> to <code class="literal">-O2 -g</code> and
	<code class="literal">-Os -DNDEBUG</code> correspondingly.  The
	lower-cased value of <code class="varname">CMAKE_BUILD_TYPE</code> is
	exported to <code class="varname">PLIST_SUB</code> and must be
	used if the port installs <code class="filename"><em class="replaceable"><code>*</code></em>.cmake</code>
	depending on the build type (see
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/deskutils/strigi/pkg-descr">deskutils/strigi</a> for an
	example).  Please note that some projects may define their
	own build profiles and/or force particular build type by
	setting <code class="literal">CMAKE_BUILD_TYPE</code> in
	<code class="filename">CMakeLists.txt</code>.  To
	make a port for such a project respect
	<code class="varname">CFLAGS</code> and <code class="varname">WITH_DEBUG</code>,
	the <code class="literal">CMAKE_BUILD_TYPE</code> definitions must be
	removed from those files.</p><p>Most <span class="application">CMake</span>-based projects
	support an out-of-source method of building.  The
	out-of-source build for a port can be requested by using the
	<code class="literal">:outsource</code> suffix.  When enabled,
	<code class="varname">CONFIGURE_WRKSRC</code>,
	<code class="varname">BUILD_WRKSRC</code> and
	<code class="varname">INSTALL_WRKSRC</code> will be set to
	<code class="literal">${WRKDIR}/.build</code> and this
	directory will be used to keep all files generated during
	configuration and build stages, leaving the source directory
	intact.</p><div class="example"><a id="using-cmake-example"></a><div class="example-title">Example 6.1. <code class="literal">USES= cmake</code> Example</div><div class="example-contents"><p>This snippet demonstrates the use of
	  <span class="application">CMake</span> for a port.
	  <code class="varname">CMAKE_SOURCE_PATH</code> is not usually
	  required, but can be set when the sources are not located
	  in the top directory, or if only a subset of the project
	  is intended to be built by the port.</p><pre class="programlisting">USES=			cmake:outsource
CMAKE_SOURCE_PATH=	${WRKSRC}/subproject</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="using-scons"></a>6.5.5. Using <code class="command">scons</code></h3></div></div></div><p>If the port uses <span class="application">SCons</span>,
	define <code class="literal">USE_SCONS=yes</code>.</p><div class="table"><a id="using-scons-variables"></a><div class="table-title">Table 6.4. Variables for Ports That Use
	  <code class="command">scons</code></div><div class="table-contents"><table summary="Variables for Ports That Use&#10;&#9;  scons" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Variable</th><th>Means</th></tr></thead><tbody><tr><td><code class="varname">SCONS_ARGS</code></td><td>Port specific SCons flags passed to the SCons
		environment.</td></tr><tr><td><code class="varname">SCONS_BUILDENV</code></td><td>Variables to be set in system
		environment.</td></tr><tr><td><code class="varname">SCONS_ENV</code></td><td>Variables to be set in SCons
		environment.</td></tr><tr><td><code class="varname">SCONS_TARGET</code></td><td>Last argument passed to SCons, similar to
		<code class="varname">MAKE_TARGET</code>.</td></tr></tbody></table></div></div><br class="table-break" /><p>To make third party <code class="filename">SConstruct</code>
	respect everything that is passed to SCons in
	<code class="varname">SCONS_ENV</code> (that is, most importantly,
	<code class="varname">CC/CXX/CFLAGS/CXXFLAGS</code>), patch
	<code class="filename">SConstruct</code> so build
	<code class="literal">Environment</code> is constructed like
	this:</p><pre class="programlisting">env = Environment(**ARGUMENTS)</pre><p>It may be then modified with
	<code class="literal">env.Append</code> and
	<code class="literal">env.Replace</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="porting-restrictions.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="special.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="using-autotools.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">6.4. Ports with Distribution Restrictions or Legal
      Concerns </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 6.6. Using GNU Autotools</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>