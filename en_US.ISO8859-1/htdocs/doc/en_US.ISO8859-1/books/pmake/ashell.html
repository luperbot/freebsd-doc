<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>4.4. A Shell is a Shell is a Shell</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="PMake &#8212; A Tutorial" /><link rel="up" href="gods.html" title="Chapter 4. PMake for Gods" /><link rel="prev" href="condition.html" title="4.3. On the Condition..." /><link rel="next" href="compatibility.html" title="4.5. Compatibility" /><link rel="copyright" href="legalnotice.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.4. A Shell is a Shell is a Shell</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="condition.html">Prev</a> </td><th width="60%" align="center">Chapter 4. PMake for Gods</th><td width="20%" align="right"> <a accesskey="n" href="compatibility.html">Next</a></td></tr></table><hr /></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ashell"></a>4.4. A Shell is a Shell is a Shell</h2></div></div></div><p>In normal operation, the Bourne Shell (better known
      as <span class="application">sh</span>) is used to execute the
      commands to re-create  targets.  <span class="application">PMake</span>
      also allows you to specify a different shell for it to use when
      executing these commands.  There are several things
      <span class="application">PMake</span> must know about
      the shell you wish to use.  These things are specified as the
      sources for the <code class="buildtarget">.SHELL</code> target by
      keyword, as follows:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">path=path</code></span></dt><dd><p><span class="application">PMake</span> needs to know where
	    the shell actually resides, so it can execute it.  If
	    you specify this and nothing else,
	    <span class="application">PMake</span> will use the last
	    component of the path and look in its table of the
	    shells it knows and use the specification it finds, if
	    any.  Use this if you just want to use a different
	    version of the <span class="application">Bourne</span> or
	    <span class="application">C Shell</span> (yes,
	    <span class="application">PMake</span> knows how to use the
	    <span class="application">C Shell</span> too).</p></dd><dt><span class="term"><code class="literal">name=name</code></span></dt><dd><p>This is the name by which the shell is to be
	    known.  It is a single word and, if no other keywords
	    are specified (other than path), it is the name by
	    which <span class="application">PMake</span> attempts to find
	    a specification for it (as  mentioned above).  You
	    can use this if you would just rather use the C Shell
	    than the <span class="application">Bourne Shell</span>
	    (<code class="literal">.SHELL: name=csh</code> will do it).</p></dd><dt><span class="term"><code class="literal">quiet=echo-off</code> command</span></dt><dd><p>As mentioned before, <span class="application">PMake</span>
	    actually controls whether commands are printed by
	    introducing commands into the shell's input stream.
	    This keyword, and the next two, control what those commands
	    are.  The <code class="literal">quiet</code> keyword is the command
	    used to turn echoing off.  Once it is turned off, echoing is
	    expected to remain off until the <code class="literal">echo-on</code>
	    command is given.</p></dd><dt><span class="term"><code class="literal">echo=echo-on</code> command</span></dt><dd><p>The command <span class="application">PMake</span>
	    should give to turn echoing back on again.</p></dd><dt><span class="term"><code class="literal">filter=printed echo-off</code> command</span></dt><dd><p>Many shells will echo the
	    <code class="literal">echo-off</code> command when it is given.
	    This keyword tells <span class="application">PMake</span> in what
	    format the shell actually prints the <code class="literal">echo-off</code>
	    command.  Wherever <span class="application">PMake</span>
	    sees this string in the shell's output, it will
	    delete it and  any  following whitespace, up to and
	    including the next newline.  See the example at the
	    end of this section for more details.</p></dd><dt><span class="term"><code class="literal">echoFlag=flag</code> to turn echoing on</span></dt><dd><p>Unless a target has been marked
	    <code class="literal">.SILENT</code>, <span class="application">PMake</span>
	    wants to start the shell running with echoing on.  To do
	    this, it passes this flag to the shell as one of its
	    arguments. If either this or the next flag begins with a
	    <code class="literal">-</code>, the flags will be passed to the
	    shell as separate arguments.  Otherwise, the two will
	    be concatenated (if they are used at the same time, of
	    course).</p></dd><dt><span class="term"><code class="literal">errFlag=flag</code> to turn error checking on</span></dt><dd><p>Likewise, unless a  target  is  marked
	    <code class="literal">.IGNORE</code>,
	    <span class="application">PMake</span> wishes error-checking
	    to be on from the very start. To this end, it will pass
	    this flag to the shell as an argument.  The same
	    rules for an initial <code class="literal">-</code> apply as for
	    the <code class="literal">echoFlag</code>.</p></dd><dt><span class="term"><code class="literal">check=command</code> to turn error checking on</span></dt><dd><p>Just as for echo-control, error-control is achieved
	    by inserting  commands into the shell's input stream.
	    This is the command to make the shell check for errors.
	    It also serves another purpose if the shell does not
	    have error-control as commands, but I will get into that
	    in a minute.  Again, once error checking has been turned
	    on, it is expected to remain on until it is turned off
	    again.</p></dd><dt><span class="term"><code class="literal">ignore=command</code>to turn error checking off</span></dt><dd><p>This is the command <span class="application">PMake</span>
	    uses to turn error checking off.  It has another use if
	    the shell does not do errorcontrol, but I will tell you
	    about that...now.</p></dd><dt><span class="term"><code class="literal">hasErrCtl=yes</code> or <code class="literal">no</code></span></dt><dd><p>This takes a value that is either
	    <code class="literal">yes</code> or <code class="literal">no</code>.  Now
	    you might think that the existence of the check and
	    ignore keywords would be enough to tell
	    <span class="application">PMake</span> if the shell can do
	    error-control, but you would be wrong.  If
	    <code class="literal">hasErrCtl</code> is <code class="literal">yes</code>,
	    <span class="application">PMake</span> uses the check and
	    ignore commands in a straight-forward manner.  If this
	    is no, however, their use is rather different.  In this
	    case, the check command is used as a template, in which
	    the string <code class="literal">%s</code> is replaced by the
	    command that is about to be executed, to produce a
	    command for the shell that will echo the command to be
	    executed.  The ignore command is also used as a template,
	    again with <code class="literal">%s</code> replaced by the command
	    to be executed, to produce a command that will
	    execute the command to be executed and ignore any error
	    it returns.  When these strings are used as templates,
	    you must provide newline(s) (<code class="literal">\n</code>) in
	    the appropriate place(s).</p></dd></dl></div><p>The strings that follow these keywords may be enclosed in
      single or double quotes (the quotes will be stripped off) and
      may contain the usual C backslash-characters
      (<code class="literal">\n</code> is newline, <code class="literal">\r</code> is
      return, <code class="literal">\b</code> is backspace,
      <code class="literal">\'</code> escapes a single-quote inside
      single-quotes, <code class="literal">\"</code> escapes a double-quote
      inside double-quotes).  Now for an example.</p><p>This is actually the contents of the &lt;shx.mk&gt; system
      makefile, and causes <span class="application">PMake</span>
      to use the <span class="application">Bourne Shell</span> in such a way
      that  each command is printed as it is executed. That is, if
      more than one command is given on a line, each will be
      printed separately.  Similarly, each time the body of a loop
      is executed, the commands within that loop will be printed,
      etc.  The specification runs like this:</p><pre class="programlisting">#
# This is a shell specification to have the Bourne shell echo
# the commands just before executing them, rather than when it reads
# them. Useful if you want to see how variables are being expanded, etc.
#
.SHELL    : path=/bin/sh \
     quiet="set -" \
     echo="set -x" \
     filter="+ set - " \
     echoFlag=x \
     errFlag=e \
     hasErrCtl=yes \
     check="set -e" \
     ignore="set +e"</pre><p>It tells <span class="application">PMake</span> the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The shell is located in the file
	  <code class="filename">/bin/sh</code>.  It need not tell
	  <span class="application">PMake</span> that the name of the
	  shell is sh as <span class="application">PMake</span> can
	  figure that out for itself (it is the last component of the
	  path).</p></li><li class="listitem"><p>The command to stop echoing is set <code class="literal">-</code>.</p></li><li class="listitem"><p>The command to start echoing is set <code class="option">-x</code>.</p></li><li class="listitem"><p>When the echo off command is executed, the shell
	  will print <code class="literal">+</code> set <code class="literal">-</code>
	  (The <code class="literal">+</code> comes from using the
	  <code class="option">-x</code> flag (rather than the
	  <code class="option">-v</code> flag <span class="application">PMake</span>
	  usually uses)).  <span class="application">PMake</span> will
	  remove all occurrences of this string from the output, so
	  you do not notice extra commands you did not put
	  there.</p></li><li class="listitem"><p>The flag the <span class="application">Bourne Shell</span>
	  will take to start echoing in this way is the
	  <code class="option">-x</code> flag.  The <span class="application">Bourne
	  Shell</span> will only take its flag arguments
	  concatenated as its first argument, so neither this nor
	  the errFlag specification begins with a
	  <code class="literal">-</code>.</p></li><li class="listitem"><p>The flag to use to turn error-checking on from the
	  start is <code class="option">-e</code>.</p></li><li class="listitem"><p>The shell can turn error-checking on and off, and
	  the commands to do so are <code class="literal">set +e</code> and
	  <code class="literal">set -e</code>, respectively.</p></li></ul></div><p>I should note that this specification is for
      <span class="application">Bourne  Shells</span>
      that are not part of Berkeley <span class="trademark">UNIX</span>®, as shells from Berkeley
      do not do error control.  You can get a similar effect,
      however, by changing the last three lines to be:</p><pre class="programlisting">hasErrCtl=no \
check="echo \"+ %s\"\n" \
ignore="sh -c '%s || exit 0\n"</pre><p>This will cause <span class="application">PMake</span> to execute
      the two commands:</p><pre class="programlisting">echo "+ cmd"
sh -c 'cmd || true'</pre><p>for each command for which errors are to be ignored.  (In
      case you are wondering, the thing for ignore tells the shell
      to execute another shell without error checking on and
      always exit 0, since the ||<code class="literal"></code> causes the
      exit 0 to be executed only  if the first command exited
      non-zero, and if the first command exited zero, the shell
      will also exit zero, since that is the last command it
      executed).</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="condition.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="gods.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="compatibility.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4.3. On the Condition... </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 4.5. Compatibility</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>