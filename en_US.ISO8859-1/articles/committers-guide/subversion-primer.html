<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>5. Subversion Primer</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Committer's Guide" /><link rel="up" href="index.html" title="Committer's Guide" /><link rel="prev" href="committer.types.html" title="4. Commit Bit Types" /><link rel="next" href="conventions.html" title="6. Setup, Conventions, and Traditions" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. Subversion Primer</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="committer.types.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="conventions.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="subversion-primer"></a>5. Subversion Primer</h2></div></div></div><p>It is assumed that you are already familiar with the basic
      operation of Subversion.  If not, start by reading the
      <a class="link" href="http://svnbook.red-bean.com/" target="_top">Subversion
	Book</a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-intro"></a>5.1. Introduction</h3></div></div></div><p>The FreeBSD source repository switched from
	<acronym class="acronym">CVS</acronym> to Subversion on May 31st, 2008.  The
	first real <acronym class="acronym">SVN</acronym> commit is
	<span class="emphasis"><em>r179447</em></span>.</p><p>The FreeBSD <code class="literal">doc/www</code> repository switched
	from <acronym class="acronym">CVS</acronym> to Subversion on May 19th, 2012.
	The first real <acronym class="acronym">SVN</acronym> commit is
	<span class="emphasis"><em>r38821</em></span>.</p><p>The FreeBSD <code class="literal">ports</code> repository switched
	from <acronym class="acronym">CVS</acronym> to Subversion on July 14th, 2012.
	The first real <acronym class="acronym">SVN</acronym> commit is
	<span class="emphasis"><em>r300894</em></span>.</p><p>Subversion can be installed from the FreeBSD Ports
	Collection by issuing these commands:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install subversion</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-getting-started"></a>5.2. Getting Started</h3></div></div></div><p>There are a few ways to obtain a working copy of the tree
	from Subversion.  This section will explain them.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-getting-started-direct-checkout"></a>5.2.1. Direct Checkout</h4></div></div></div><p>The first is to check out directly from the main
	  repository.  For the <code class="literal">src</code> tree,
	  use:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn checkout svn+ssh://svn.freebsd.org/base/head /usr/src</code></strong></pre><p>For the <code class="literal">doc</code> tree, use:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn checkout svn+ssh://svn.freebsd.org/doc/head /usr/doc</code></strong></pre><p>For the <code class="literal">ports</code> tree, use:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn checkout svn+ssh://svn.freebsd.org/ports/head /usr/ports</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Though the remaining examples in this document are
	    written with the workflow of working with the
	    <code class="literal">src</code> tree in mind, the underlying
	    concepts are the same for working with the
	    <code class="literal">doc</code> and the <code class="literal">ports</code>
	    tree.
	    Ports related Subversion operations are listed in
	    <a class="xref" href="ports.html" title="19. Ports Specific FAQ">Section 19, &#8220;Ports Specific FAQ&#8221;</a>.</p></div><p>The above command will check out a
	  <code class="literal">CURRENT</code> source tree as
	  <code class="filename"><em class="replaceable"><code>/usr/src/</code></em></code>,
	  which can be any target directory on the local filesystem.
	  Omitting the final argument of that command causes the
	  working copy, in this case, to be named <span class="quote">&#8220;<span class="quote">head</span>&#8221;</span>,
	  but that can be renamed safely.</p><p><code class="literal">svn+ssh</code> means the
	  <acronym class="acronym">SVN</acronym> protocol tunnelled over
	  <acronym class="acronym">SSH</acronym>.  The name of the server is
	  <code class="literal">svn.freebsd.org</code>, <code class="literal">base</code>
	  is the path to the repository, and <code class="literal">head</code>
	  is the subdirectory within the repository.</p><p>If your FreeBSD login name is different from your login
	  name on your local machine, you must either include it in
	  the <acronym class="acronym">URL</acronym> (for example
	  <code class="literal">svn+ssh://jarjar@svn.freebsd.org/base/head</code>),
	  or add an entry to your <code class="filename">~/.ssh/config</code>
	  in the form:</p><pre class="programlisting">Host svn.freebsd.org
	User jarjar</pre><p>This is the simplest method, but it is hard to tell just
	  yet how much load it will place on the repository.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <code class="command">svn diff</code> does not require
	    access to the server as <acronym class="acronym">SVN</acronym> stores a
	    reference copy of every file in the working copy.  This,
	    however, means that Subversion working copies are very
	    large in size.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-getting-started-checkout-from-a-mirror"></a>5.2.2. Checkout from a Mirror</h4></div></div></div><p>Check out a working copy from a mirror by
	  substituting the mirror's <acronym class="acronym">URL</acronym> for
	  <code class="literal">svn+ssh://svn.freebsd.org/base</code>.  This can
	  be an official mirror or a mirror maintained by
	  using <code class="command">svnsync</code>.</p><p>There is a serious disadvantage to this method: every
	  time something is to be committed, a
	  <code class="command">svn relocate</code> to the master repository has
	  to be done, remembering to <code class="command">svn relocate</code>
	  back to the mirror after the commit.  Also, since
	  <code class="command">svn relocate</code> only works between
	  repositories that have the same UUID, some hacking of the
	  local repository's UUID has to occur before it is possible
	  to start using it.</p><p>The hassle of a local
	  <code class="command">svnsync</code> mirror probably is not worth it
	  unless the network connectivity situation or other factors
	  demand it.  If it is needed, see the end of this chapter for
	  information on how to set one up.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-getting-started-base-layout"></a>5.2.3. <code class="literal">RELENG_*</code> Branches and General
	  Layout</h4></div></div></div><p>In <code class="literal">svn+ssh://svn.freebsd.org/base</code>,
	  <span class="emphasis"><em>base</em></span> refers to the source tree.
	  Similarly, <span class="emphasis"><em>ports</em></span> refers to the ports
	  tree, and so on.  These are separate repositories with their
	  own change number sequences, access controls and commit
	  mail.</p><p>For the base repository, HEAD refers to the -CURRENT
	  tree.  For example, <code class="filename">head/bin/ls</code> is what
	  would go into <code class="filename">/usr/src/bin/ls</code> in a
	  release.  Some key locations are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>/head/</em></span> which corresponds to
	      <code class="literal">HEAD</code>, also known as
	      <code class="literal">-CURRENT</code>.</p></li><li class="listitem"><p><span class="emphasis"><em>/stable/<em class="replaceable"><code>n</code></em></em></span>
	      which corresponds to
	      <code class="literal">RELENG_<em class="replaceable"><code>n</code></em></code>.</p></li><li class="listitem"><p><span class="emphasis"><em>/releng/<em class="replaceable"><code>n.n</code></em></em></span>
	      which corresponds to
	      <code class="literal">RELENG_<em class="replaceable"><code>n_n</code></em></code>.</p></li><li class="listitem"><p><span class="emphasis"><em>/release/<em class="replaceable"><code>n.n.n</code></em></em></span>
	      which corresponds to
	      <code class="literal">RELENG_<em class="replaceable"><code>n_n_n</code></em>_RELEASE</code>.</p></li><li class="listitem"><p><span class="emphasis"><em>/vendor*</em></span> is the vendor branch
	      import work area.  This directory itself does not
	      contain branches, however its subdirectories do.  This
	      contrasts with the <span class="emphasis"><em>stable</em></span>,
	      <span class="emphasis"><em>releng</em></span> and
	      <span class="emphasis"><em>release</em></span> directories.</p></li><li class="listitem"><p><span class="emphasis"><em>/projects</em></span> and
	      <span class="emphasis"><em>/user</em></span> feature a branch work area,
	      like in Perforce.  As above, the
	      <span class="emphasis"><em>/user</em></span> directory does not contain
	      branches itself.</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-getting-started-doc-layout"></a>5.2.4. FreeBSD Documentation Project Branches and
	  Layout</h4></div></div></div><p>In <code class="literal">svn+ssh://svn.freebsd.org/doc</code>,
	  <span class="emphasis"><em>doc</em></span> refers to the repository root of
	  the source tree.</p><p>In general, most FreeBSD Documentation Project work will be
	  done within the <code class="filename">head/</code> branch of the
	  documentation source tree.</p><p>FreeBSD documentation is written and/or translated to
	  various languages, each in a separate
	  directory in the <code class="filename">head/</code>
	  branch.</p><p>Each translation set contains several subdirectories for
	  the various parts of the FreeBSD Documentation Project.  A few
	  noteworthy directories are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>/articles/</em></span> contains the source
	      code for articles written by various FreeBSD
	      contributors.</p></li><li class="listitem"><p><span class="emphasis"><em>/books/</em></span> contains the source
	      code for the different books, such as the
	      FreeBSD Handbook.</p></li><li class="listitem"><p><span class="emphasis"><em>/htdocs/</em></span> contains the source
	      code for the FreeBSD website.</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-getting-started-ports-layout"></a>5.2.5. FreeBSD Ports Tree Branches and Layout</h4></div></div></div><p>In <code class="literal">svn+ssh://svn.freebsd.org/ports</code>,
	  <span class="emphasis"><em>ports</em></span> refers to the repository root of
	  the ports tree.</p><p>In general, most FreeBSD port work will be done within the
	  <code class="filename">head/</code> branch of the ports tree which is
	  the actual ports tree used to install software.  Some other
	  key locations are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>/branches/RELENG_<em class="replaceable"><code>n_n_n</code></em></em></span>
	      which corresponds to
	      <code class="literal">RELENG_<em class="replaceable"><code>n_n_n</code></em></code>
	      is used to merge back security updates in preparation
	      for a release.</p></li><li class="listitem"><p><span class="emphasis"><em>/tags/RELEASE_<em class="replaceable"><code>n_n_n</code></em></em></span>
	      which corresponds to
	      <code class="literal">RELEASE_<em class="replaceable"><code>n_n_n</code></em></code>
	      represents a release tag of the ports tree.</p></li><li class="listitem"><p><span class="emphasis"><em>/tags/RELEASE_<em class="replaceable"><code>n</code></em>_EOL</em></span>
	      represents the end of life tag of a specific FreeBSD
	      branch.</p></li></ul></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-daily-use"></a>5.3. Daily Use</h3></div></div></div><p>This section will explain how to perform common day-to-day
	operations with Subversion.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-daily-use-help"></a>5.3.1. Help</h4></div></div></div><p><acronym class="acronym">SVN</acronym> has built in help documentation.
	  It can be accessed by typing the following command:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn help</code></strong></pre><p>Additional information can be found in the
	  <a class="link" href="http://svnbook.red-bean.com/" target="_top">Subversion
	    Book</a>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-daily-use-checkout"></a>5.3.2. Checkout</h4></div></div></div><p>As seen earlier, to check out the FreeBSD head
	  branch:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn checkout svn+ssh://svn.freebsd.org/base/head /usr/src</code></strong></pre><p>At some point, more than just <code class="literal">HEAD</code>
	  will probably be useful, for instance when merging changes
	  to stable/7.  Therefore, it may be useful to have a partial
	  checkout of the complete tree (a full checkout would be very
	  painful).</p><p>To do this, first check out the root of the
	  repository:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn checkout --depth=immediates svn+ssh://svn.freebsd.org/base</code></strong></pre><p>This will give <code class="literal">base</code> with all the
	  files it contains (at the time of writing, just
	  <code class="filename">ROADMAP.txt</code>) and empty subdirectories
	  for <code class="literal">head</code>, <code class="literal">stable</code>,
	  <code class="literal">vendor</code> and so on.</p><p>Expanding the working copy is possible.  Just change the
	  depth of the various subdirectories:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn up --set-depth=infinity base/head</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn up --set-depth=immediates base/release base/releng base/stable</code></strong></pre><p>The above command will pull down a full copy of
	  <code class="literal">head</code>, plus empty copies of every
	  <code class="literal">release</code> tag, every
	  <code class="literal">releng</code> branch, and every
	  <code class="literal">stable</code> branch.</p><p>If at a later date merging to
	  <code class="literal">7-STABLE</code> is required, expand the working
	  copy:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn up --set-depth=infinity base/stable/7</code></strong></pre><p>Subtrees do not have to be expanded completely.  For
	  instance, expanding only <code class="literal">stable/7/sys</code> and
	  then later expand the rest of
	  <code class="literal">stable/7</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn up --set-depth=infinity base/stable/7/sys</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn up --set-depth=infinity base/stable/7</code></strong></pre><p>Updating the tree with <code class="command">svn update</code>
	  will only update what was previously asked for (in this
	  case, <code class="literal">head</code> and
	  <code class="literal">stable/7</code>; it will not pull down the whole
	  tree.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Decreasing the depth of a working copy is not
	    possible.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-daily-use-anonymous-checkout"></a>5.3.3. Anonymous Checkout</h4></div></div></div><p>It is possible to anonymously check out the FreeBSD
	  repository with Subversion.  This will give access to a
	  read-only tree that can be updated, but not committed back
	  to the main repository.  To do this, use the following
	  command:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn co <em class="replaceable"><code>https://svn0.us-west.FreeBSD.org</code></em>/base/head /usr/src</code></strong></pre><p>Select the closest mirror and verify the mirror server
	  certificate from the list of <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/svn.html#svn-mirrors" target="_top">Subversion
	    mirror sites</a>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-daily-use-updating-the-tree"></a>5.3.4. Updating the Tree</h4></div></div></div><p>To update a working copy to either the latest revision,
	  or a specific revision:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn update</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn update -<em class="replaceable"><code>r12345</code></em></code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-daily-use-status"></a>5.3.5. Status</h4></div></div></div><p>To view the local changes that have been made to the
	  working copy:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn status</code></strong></pre><p>To show local changes and files that are out-of-date
	  do:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn status --show-updates</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-daily-use-editing-and-committing"></a>5.3.6. Editing and Committing</h4></div></div></div><p>Unlike Perforce, <acronym class="acronym">SVN</acronym> does not need to
	  be told in advance about file editing.</p><p>To commit all changes in
	  the current directory and all subdirectories:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn commit</code></strong></pre><p>To commit all changes in, for example,
	  <code class="filename"><em class="replaceable"><code>lib/libfetch/</code></em></code>
	  and
	  <code class="filename"><em class="replaceable"><code>usr/bin/fetch/</code></em></code>
	  in a single operation:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn commit <em class="replaceable"><code>lib/libfetch</code></em> <em class="replaceable"><code>usr/bin/fetch</code></em></code></strong></pre><p>There is also a commit wrapper for the ports tree to
	  handle the properties and sanity checking your
	  changes:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>/usr/ports/Tools/scripts/psvn commit</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-daily-use-adding-and-removing"></a>5.3.7. Adding and Removing Files</h4></div></div></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Before adding files, get a copy of <a class="link" href="http://people.freebsd.org/~peter/auto-props.txt" target="_top">auto-props.txt</a>
	    (there is also a <a class="link" href="http://people.freebsd.org/~beat/cvs2svn/auto-props.txt" target="_top">
	      ports tree specific version</a>) and add it to
	    <code class="filename">~/.subversion/config</code> according to the
	    instructions in the file.  If you added something before
	    reading this, use <code class="command">svn rm --keep-local</code>
	    for just added files, fix your config file and re-add them
	    again.  The initial config file is created when you first
	    run a svn command, even something as simple as
	    <code class="command">svn help</code>.</p></div><p>Files are added to a
	  <acronym class="acronym">SVN</acronym> repository with <code class="command">svn
	    add</code>.  To add a file named
	  <span class="emphasis"><em>foo</em></span>, edit it, then:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn add <em class="replaceable"><code>foo</code></em></code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Most new source files should include a
	    <code class="literal">$FreeBSD$</code> string near the
	    start of the file.  On commit, <code class="command">svn</code> will
	    expand the <code class="literal">$FreeBSD$</code> string,
	    adding the file path, revision number, date and time of
	    commit, and the username of the committer.  Files which
	    cannot be modified may be committed without the
	    <code class="literal">$FreeBSD$</code> string.</p></div><p>Files can be removed with <code class="command">svn
	    remove</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn remove <em class="replaceable"><code>foo</code></em></code></strong></pre><p>Subversion does not require deleting the file before
	  using <code class="command">svn rm</code>, and indeed complains if
	  that happens.</p><p>It is possible to add directories with
	  <code class="command">svn add</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mkdir <em class="replaceable"><code>bar</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn add <em class="replaceable"><code>bar</code></em></code></strong></pre><p>Although <code class="command">svn mkdir</code> makes this easier
	  by combining the creation of the directory and the adding of
	  it:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn mkdir <em class="replaceable"><code>bar</code></em></code></strong></pre><p>Like files, directories are removed with
	  <code class="command">svn rm</code>.  There is no separate command
	  specifically for removing directories.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn rm <em class="replaceable"><code>bar</code></em></code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-daily-use-copying-and-moving"></a>5.3.8. Copying and Moving Files</h4></div></div></div><p>This command creates a copy of
	  <code class="filename">foo.c</code> named <code class="filename">bar.c</code>,
	  with the new file also under version control:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn copy <em class="replaceable"><code>foo.c</code></em> <em class="replaceable"><code>bar.c</code></em></code></strong></pre><p>The example above is equivalent to:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cp foo.c bar.c</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn add bar.c</code></strong></pre><p>To move and rename a file:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn move <em class="replaceable"><code>foo.c</code></em> <em class="replaceable"><code>bar.c</code></em></code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-daily-use-log-and-annotate"></a>5.3.9. Log and Annotate</h4></div></div></div><p><code class="command">svn log</code> shows revisions and commit
	  messages, most recent first, for files or directories.  When
	  used on a directory, all revisions that affected the
	  directory and files within that directory are shown.</p><p><code class="command">svn annotate</code>, or equally <code class="command">svn
	    praise</code> or <code class="command">svn blame</code>, shows
	  the most recent revision number and who committed that
	  revision for each line of a file.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-daily-use-diffs"></a>5.3.10. Diffs</h4></div></div></div><p><code class="command">svn diff</code> displays changes to the
	  working copy.  Diffs generated by <acronym class="acronym">SVN</acronym> are
	  unified and include new files by default in the diff
	  output.</p><p><code class="command">svn diff</code> can show the changes between
	  two revisions of the same file:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn diff -r179453:179454 ROADMAP.txt</code></strong></pre><p>It can also show all changes for a specific changeset.
	  The following will show what changes were made to the
	  current directory and all subdirectories in changeset
	  179454:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn diff -c179454 .</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-daily-use-reverting"></a>5.3.11. Reverting</h4></div></div></div><p>Local changes (including additions and deletions) can be
	  reverted using <code class="command">svn revert</code>.  It does not
	  update out-of-date files, but just replaces them with
	  pristine copies of the original version.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-daily-use-conflicts"></a>5.3.12. Conflicts</h4></div></div></div><p>If an <code class="command">svn update</code> resulted in a merge
	  conflict, Subversion will remember which files have
	  conflicts and refuse to commit any changes to those files
	  until explicitly told that the conflicts have been resolved.
	  The simple, not yet deprecated procedure is the
	  following:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn resolved <em class="replaceable"><code>foo</code></em></code></strong></pre><p>However, the preferred procedure is:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn resolve --accept=working <em class="replaceable"><code>foo</code></em></code></strong></pre><p>The two examples are equivalent.  Possible values for
	  <code class="literal">--accept</code> are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">working</code>: use the version in your
	      working directory (which one presumes has been edited to
	      resolve the conflicts).</p></li><li class="listitem"><p><code class="literal">base</code>: use a pristine copy of the
	      version you had before <code class="command">svn update</code>,
	      discarding your own changes, the conflicting changes,
	      and possibly other intervening changes as well.</p></li><li class="listitem"><p><code class="literal">mine-full</code>: use what you had
	      before <code class="command">svn update</code>, including your own
	      changes, but discarding the conflicting changes, and
	      possibly other intervening changes as well.</p></li><li class="listitem"><p><code class="literal">theirs-full</code>: use the version that
	      was retrieved when you did
	      <code class="command">svn update</code>, discarding your own
	      changes.</p></li></ul></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64548432"></a>5.4. Advanced Use</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-advanced-use-sparse-checkouts"></a>5.4.1. Sparse Checkouts</h4></div></div></div><p><acronym class="acronym">SVN</acronym> allows
	  <span class="emphasis"><em>sparse</em></span>, or partial checkouts of a
	  directory by adding <code class="option">--depth</code> to a
	  <code class="command">svn checkout</code>.</p><p>Valid arguments to <code class="option">--depth</code>
	  are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">empty</code>: the directory itself
	      without any of its contents.</p></li><li class="listitem"><p><code class="literal">files</code>: the directory and any
	      files it contains.</p></li><li class="listitem"><p><code class="literal">immediates</code>: the directory and any
	      files and directories it contains, but none of the
	      subdirectories' contents.</p></li><li class="listitem"><p><code class="literal">infinity</code>: anything.</p></li></ul></div><p>The <code class="literal">--depth</code> option applies to many
	  other commands, including <code class="command">svn commit</code>,
	  <code class="command">svn revert</code>, and <code class="command">svn
	    diff</code>.</p><p>Since <code class="literal">--depth</code> is sticky, there is a
	  <code class="literal">--set-depth</code> option for <code class="command">svn
	    update</code> that will change the selected depth.
	  Thus, given the working copy produced by the previous
	  example:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd <em class="replaceable"><code>~/freebsd</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn update --set-depth=immediates .</code></strong></pre><p>The above command will populate the working copy in
	  <em class="replaceable"><code>~/freebsd</code></em> with
	  <code class="filename">ROADMAP.txt</code> and empty subdirectories,
	  and nothing will happen when <code class="command">svn update</code>
	  is executed on the subdirectories.  However, the following
	  command will set the depth for
	  <em class="replaceable"><code>head</code></em> (in this case) to infinity,
	  and fully populate it:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn update --set-depth=infinity <em class="replaceable"><code>head</code></em></code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-advanced-use-direct-operation"></a>5.4.2. Direct Operation</h4></div></div></div><p>Certain operations can be performed directly on the
	  repository without touching the working copy.  Specifically,
	  this applies to any operation that does not require editing
	  a file, including:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">log</code>,
	      <code class="literal">diff</code></p></li><li class="listitem"><p><code class="literal">mkdir</code></p></li><li class="listitem"><p><code class="literal">remove</code>, <code class="literal">copy</code>,
	      <code class="literal">rename</code></p></li><li class="listitem"><p><code class="literal">propset</code>,
	      <code class="literal">propedit</code>,
	      <code class="literal">propdel</code></p></li><li class="listitem"><p><code class="literal">merge</code></p></li></ul></div><p>Branching is very fast.  The following command would be
	  used to branch <code class="literal">RELENG_8</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn copy svn+ssh://svn.freebsd.org/base/head svn+ssh://svn.freebsd.org/base/stable/8</code></strong></pre><p>This is equivalent to the following set of commands
	  which take minutes and hours as opposed to seconds,
	  depending on your network connection:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn checkout --depth=immediates svn+ssh://svn.freebsd.org/base</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cd base</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn update --set-depth=infinity head</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn copy head stable/8</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn commit stable/8</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-advanced-use-merging"></a>5.4.3. Merging with <acronym class="acronym">SVN</acronym></h4></div></div></div><p>This section deals with merging code from one branch to
	  another (typically, from head to a stable branch).</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">In all examples below, <code class="literal">$FSVN</code>
	    refers to the location of the FreeBSD Subversion repository,
	    <code class="literal">svn+ssh://svn.freebsd.org/base/</code>.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64692816"></a>5.4.3.1. About Merge Tracking</h5></div></div></div><p>From the user's perspective, merge tracking
	    information (or mergeinfo) is stored in a property called
	    <code class="literal">svn:mergeinfo</code>, which is a
	    comma-separated list of revisions and ranges of revisions
	    that have been merged.  When set on a file, it applies
	    only to that file.  When set on a directory, it applies to
	    that directory and its descendants (files and directories)
	    except for those that have their own
	    <code class="literal">svn:mergeinfo</code>.</p><p>It is <span class="emphasis"><em>not</em></span> inherited.  For
	    instance, <code class="filename">stable/6/contrib/openpam/</code>
	    does not implicitly inherit mergeinfo from
	    <code class="filename">stable/6/</code>, or
	    <code class="filename">stable/6/contrib/</code>.
	    Doing so would make partial checkouts very hard to manage.
	    Instead, mergeinfo is explicitly propagated down the tree.
	    For merging something into
	    <code class="filename">branch/foo/bar/</code>,
	    the following rules apply:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>If
		<code class="filename">branch/foo/bar/</code>
		does not already have a mergeinfo record, but a direct
		ancestor (for instance,
		<code class="filename">branch/foo/</code>)
		does, then that record will be propagated down to
		<code class="filename">branch/foo/bar/</code>
		before information about the current merge is
		recorded.</p></li><li class="listitem"><p>Information about the current merge will
		<span class="emphasis"><em>not</em></span> be propagated back up that
		ancestor.</p></li><li class="listitem"><p>If a direct descendant of
		<code class="filename">branch/foo/bar/</code> (for instance,
		<code class="filename">branch/foo/bar/baz/</code>) already has
		a mergeinfo record, information about the current
		merge will be propagated down to it.</p></li></ol></div><p>If you consider the case where a revision changes
	    several separate parts of the tree (for example,
	    <code class="filename">branch/foo/bar/</code> and
	    <code class="filename">branch/foo/quux/</code>), but you only want
	    to merge some of it (for example,
	    <code class="filename">branch/foo/bar/</code>), you will see that
	    these rules make sense.  If mergeinfo was propagated up,
	    it would seem like that revision had also been merged to
	    <code class="filename">branch/foo/quux/</code>, when in fact it had
	    not been.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="merge"></a>5.4.3.2. Selecting the Source and Target for
	    <code class="literal">stable/10</code> and Newer</h5></div></div></div><p>Starting with the <code class="literal">stable/10</code>
	    branch, all merges should be
	    merged to and committed from the root of the
	    branch.  All merges should look like:</p><pre class="screen"><code class="prompt">%</code> svn merge -c <em class="replaceable"><code>r123456</code></em> ^/head/ <em class="replaceable"><code>checkout</code></em>
<code class="prompt">%</code> svn commit <em class="replaceable"><code>checkout</code></em></pre><p>Note that <em class="replaceable"><code>checkout</code></em> should
	    be a complete checkout of the branch to which the merge
	    occurs.</p><p>Merges to <code class="literal">releng/</code> branches should
	    always originate from the corresponding
	    <code class="literal">stable/</code> branch.  For example:</p><pre class="screen"><code class="prompt">%</code> svn merge -c <em class="replaceable"><code>r123456</code></em> ^/stable/<em class="replaceable"><code>10</code></em> releng/<em class="replaceable"><code>10.0</code></em></pre></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="oldmerge"></a>5.4.3.3. Selecting the Source and Target for
	    <code class="literal">stable/9</code> and Older</h5></div></div></div><p>For <code class="literal">stable/9</code> and earlier,
	    a different strategy was used, distributing mergeinfo
	    around the tree so that merges could be performed without
	    a complete checkout.  This procedure proved extremely
	    error-prone, with the convenience of partial checkouts for
	    merges significantly outweighed by the complexity of
	    picking mergeinfo targets.  The below describes this
	    now-obsoleted procedure, which should be used
	    <span class="emphasis"><em>only for merges prior to
	      <code class="literal">stable/10</code></em></span>.</p><p>Because of mergeinfo propagation, it is important to
	    choose the source and target for the merge carefully to
	    minimise property changes on unrelated directories.</p><p>The rules for selecting the merge target (the
	    directory that you will merge the changes to) can be
	    summarized as follows:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Never merge directly to a file.</p></li><li class="listitem"><p>Never, ever merge directly to a file.</p></li><li class="listitem"><p><span class="emphasis"><em>Never, ever, ever</em></span> merge
		directly to a file.</p></li><li class="listitem"><p>Changes to kernel code should be merged to
		<code class="filename">sys/</code>.  For instance, a change to
		the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ichwd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ichwd</span>(4)</span></a> driver should be merged to
		<code class="filename">sys/</code>, not
		<code class="filename">sys/dev/ichwd/</code>.  Likewise, a
		change to the TCP/IP stack should be merged to
		<code class="filename">sys/</code>, not
		<code class="filename">sys/netinet/</code>.</p></li><li class="listitem"><p>Changes to code under <code class="filename">etc/</code>
		should be merged at <code class="filename">etc/</code>, not
		below it.</p></li><li class="listitem"><p>Changes to vendor code (code in
		<code class="filename">contrib/</code>,
		<code class="filename">crypto/</code> and so on) should be
		merged to the directory where vendor imports happen.
		For instance, a change to
		<code class="filename">crypto/openssl/util/</code> should be
		merged to <code class="filename">crypto/openssl/</code>.  This
		is rarely an issue, however, since changes to vendor
		code are usually merged wholesale.</p></li><li class="listitem"><p>Changes to userland programs should as a general
		rule be merged to the directory that contains the
		Makefile for that program.  For instance, a change to
		<code class="filename">usr.bin/xlint/arch/i386/</code> should
		be merged to
		<code class="filename">usr.bin/xlint/</code>.</p></li><li class="listitem"><p>Changes to userland libraries should as a general
		rule be merged to the directory that contains the
		Makefile for that library.  For instance, a change to
		<code class="filename">lib/libc/gen/</code> should be merged to
		<code class="filename">lib/libc/</code>.</p></li><li class="listitem"><p>There may be cases where it makes sense to deviate
		from the rules for userland programs and libraries.
		For instance, everything under
		<code class="filename">lib/libpam/</code> is merged to
		<code class="filename">lib/libpam/</code>, even though the
		library itself and all of the modules each have their
		own Makefile.</p></li><li class="listitem"><p>Changes to manual pages should be merged to
		<code class="filename">share/man/man<em class="replaceable"><code>N</code></em>/</code>,
		for the appropriate value of
		<code class="literal">N</code>.</p></li><li class="listitem"><p>Other changes to <code class="filename">share/</code>
		should be merged to the appropriate subdirectory and
		not to <code class="filename">share/</code> directly.</p></li><li class="listitem"><p>Changes to a top-level file in the source tree
		such as <code class="filename">UPDATING</code> or
		<code class="filename">Makefile.inc1</code> should be merged
		directly to that file rather than to the root of the
		whole tree.  Yes, this is an exception to the first
		three rules.</p></li><li class="listitem"><p>When in doubt, ask.</p></li></ol></div><p>If you need to merge changes to several places at once
	    (for instance, changing a kernel interface and every
	    userland program that uses it), merge each target
	    separately, then commit them together.  For instance, if
	    you merge a revision that changed a kernel
	    <acronym class="acronym">API</acronym> and updated all the userland bits
	    that used that <acronym class="acronym">API</acronym>, you would merge the
	    kernel change to sys, and the userland bits to the
	    appropriate userland directories, then commit all of these
	    in one go.</p><p>The source will almost invariably be the same as the
	    target.  For instance, you will always merge
	    <code class="filename">stable/7/lib/libc/</code> from
	    <code class="filename">head/lib/libc/</code>.  The only exception
	    would be when merging changes to code that has moved in
	    the source branch but not in the parent branch.  For
	    instance, a change to <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pkill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">pkill</span>(1)</span></a> would be merged from
	    <code class="filename">bin/pkill/</code> in head to
	    <code class="filename">usr.bin/pkill/</code> in stable/7.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64853456"></a>5.4.3.4. Preparing the Merge Target</h5></div></div></div><p>Because of the mergeinfo propagation issues described
	    earlier, it is very important that you never merge changes
	    into a sparse working copy.  You must always have a full
	    checkout of the branch you will merge into.  For instance,
	    when merging from HEAD to 7, you must have a full checkout
	    of stable/7:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd stable/7</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn up --set-depth=infinity</code></strong></pre><p>The target directory must also be up-to-date and must
	    not contain any uncommitted changes or stray files.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64869712"></a>5.4.3.5. Identifying Revisions</h5></div></div></div><p>Identifying revisions to be merged is a must.  If the
	    target already has complete mergeinfo, ask
	    <acronym class="acronym">SVN</acronym> for a list:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd stable/6/contrib/openpam</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn mergeinfo --show-revs=eligible $FSVN/head/contrib/openpam</code></strong></pre><p>If the target does not have complete mergeinfo, check
	    the log for the merge source.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64882512"></a>5.4.3.6. Merging</h5></div></div></div><p>Now, let us start merging!</p><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64884944"></a>5.4.3.6.1. The Principles</h6></div></div></div><p>Say you would like to merge:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>revision <code class="literal">$R</code></p></li><li class="listitem"><p>in directory $target in stable branch
		  $B</p></li><li class="listitem"><p>from directory $source in head</p></li><li class="listitem"><p>$FSVN is
		  <code class="literal">svn+ssh://svn.freebsd.org/base</code></p></li></ul></div><p>Assuming that revisions $P and $Q have
	      already been merged, and that the current directory is
	      an up-to-date working copy of stable/$B, the
	      existing mergeinfo looks like this:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn propget svn:mergeinfo -R $target</code></strong>
$target - /head/$source:$P,$Q</pre><p>Merging is done like so:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn merge -c$R $FSVN/head/$source $target</code></strong></pre><p>Checking the results of this is possible with
	      <code class="command">svn diff</code>.</p><p>The svn:mergeinfo now looks like:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn propget svn:mergeinfo -R $target</code></strong>
$target - head/$source:$P,$Q,$R</pre><p>If the results are not exactly as shown, assistance
	      may be required before committing as mistakes may have
	      been made, or there may be something wrong with the
	      existing mergeinfo, or there may be a bug in
	      Subversion.</p></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64918352"></a>5.4.3.6.2. Practical Example</h6></div></div></div><p>As a practical example, consider the following
	      scenario.  The changes to <code class="filename">netmap.4</code>
	      in r238987 are to be merged from CURRENT to 9-STABLE.
	      The file resides in
	      <code class="filename">head/share/man/man4</code>.  According
	      to <a class="xref" href="subversion-primer.html#svn-advanced-use-merging" title="5.4.3. Merging with SVN">Section 5.4.3, &#8220;Merging with <acronym class="acronym">SVN</acronym>&#8221;</a>, this is
	      also where to do the merge.  Note that in this example
	      all paths are relative to the top of the svn repository.
	      For more information on the directory layout, see <a class="xref" href="subversion-primer.html#svn-getting-started-base-layout" title="5.2.3. RELENG_* Branches and General Layout">Section 5.2.3, &#8220;<code class="literal">RELENG_*</code> Branches and General
	  Layout&#8221;</a>.</p><p>The first step is to inspect the existing
	      mergeinfo.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn propget svn:mergeinfo -R stable/9/share/man/man4</code></strong></pre><p>Take a quick note of how it looks before moving on
	      to the next step; doing the actual merge:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn merge -c r238987 svn+ssh://svn.freebsd.org/base/head/share/man/man4 stable/9/share/man/man4</code></strong>
--- Merging r238987 into 'stable/9/share/man/man4':
U    stable/9/share/man/man4/netmap.4
--- Recording mergeinfo for merge of r238987 into
'stable/9/share/man/man4':
 U   stable/9/share/man/man4</pre><p>Check that the revision number of the merged
	      revision has been added.  Once this is verified, the
	      only thing left is the actual commit.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn commit stable/9/share/man/man4</code></strong></pre></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64947408"></a>5.4.3.6.3. Merging into the Kernel
	      (<code class="filename">sys/</code>)</h6></div></div></div><p>As stated above, merging into the kernel is
	      different from merging in the rest of the tree.  In many
	      ways merging to the kernel is simpler because there is
	      always the same merge target
	      (<code class="filename">sys/</code>).</p><p>Once <code class="command">svn merge</code> has been executed,
	      <code class="command">svn diff</code> has to be run on the
	      directory to check the changes.  This may show some
	      unrelated property changes, but these can be ignored.
	      Next, build and test the kernel, and, once the tests are
	      complete, commit the code as normal, making sure that
	      the commit message starts with <span class="quote">&#8220;<span class="quote">Merge
		<em class="replaceable"><code>r226222</code></em> from head</span>&#8221;</span>,
	      or similar.</p></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64959952"></a>5.4.3.7. Precautions Before Committing</h5></div></div></div><p>As always, build world (or appropriate parts of
	    it).</p><p>Check the changes with <code class="command">svn diff</code> and
	    <code class="command">svn stat</code>.  Make sure all the files that
	    should have been added or deleted were in fact added or
	    deleted.</p><p>Take a closer look at any property change (marked by a
	    <code class="literal">M</code> in the second column of <code class="command">svn
	      stat</code>).  Normally, no svn:mergeinfo properties
	    should be anywhere except the target directory (or
	    directories).</p><p>If something looks fishy, ask for help.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp64985808"></a>5.4.3.8. Committing</h5></div></div></div><p>Make sure to commit a top level directory to have the
	    mergeinfo included as well.  Do not specify individual
	    files on the command line.  For more information about
	    committing files in general, see the relevant section of
	    this primer.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-advanced-use-vendor-imports"></a>5.4.4. Vendor Imports with <acronym class="acronym">SVN</acronym></h4></div></div></div><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">Please read this entire section before starting a
	    vendor import.</p></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Patches to vendor code fall into two
	    categories:</p><div xmlns="http://www.w3.org/1999/xhtml" class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Vendor patches: these are patches that have been
		issued by the vendor, or that have been extracted from
		the vendor's version control system, which address
		issues which in your opinion cannot wait until the
		next vendor release.</p></li><li class="listitem"><p>FreeBSD patches: these are patches that modify the
		vendor code to address FreeBSD-specific issues.</p></li></ul></div><p xmlns="http://www.w3.org/1999/xhtml">The nature of a patch dictates where it should be
	    committed:</p><div xmlns="http://www.w3.org/1999/xhtml" class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Vendor patches should be committed to the vendor
		branch, and merged from there to head.  If the patch
		addresses an issue in a new release that is currently
		being imported, it <span class="emphasis"><em>must not</em></span> be
		committed along with the new release: the release must
		be imported and tagged first, then the patch can be
		applied and committed.  There is no need to re-tag the
		vendor sources after committing the patch.</p></li><li class="listitem"><p>FreeBSD patches should be committed directly to
		head.</p></li></ul></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65005904"></a>5.4.4.1. Preparing the Tree</h5></div></div></div><p>If importing for the first time after the switch to
	    Subversion, flattening and cleaning up the vendor tree is
	    necessary, as well as bootstrapping the merge history in
	    the main tree.</p><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65007824"></a>5.4.4.1.1. Flattening</h6></div></div></div><p>During the conversion from <acronym class="acronym">CVS</acronym> to
	      Subversion, vendor branches were imported with the same
	      layout as the main tree.  This means that the
	      <code class="literal">pf</code> vendor sources ended up in
	      <code class="filename">vendor/pf/dist/contrib/pf</code>.  The
	      vendor source is best directly in
	      <code class="filename">vendor/pf/dist</code>.</p><p>To flatten the <code class="literal">pf</code> tree:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd <em class="replaceable"><code>vendor/pf/dist/contrib/pf</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn mv $(svn list) ../..</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cd ../..</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn rm contrib</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn propdel -R svn:mergeinfo .</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn commit</code></strong></pre><p>The <code class="literal">propdel</code> bit is necessary
	      because starting with 1.5, Subversion will automatically
	      add <code class="literal">svn:mergeinfo</code> to any directory
	      that is copied or moved.  In this case, as nothing is
	      being merged from the deleted tree, they just get in the
	      way.</p><p>Tags may be flattened as well (3, 4, 3.5 etc.); the
	      procedure is exactly the same, only changing
	      <code class="literal">dist</code> to <code class="literal">3.5</code> or
	      similar, and putting the <code class="command">svn commit</code>
	      off until the end of the process.</p></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65044176"></a>5.4.4.1.2. Cleaning Up</h6></div></div></div><p>The <code class="literal">dist</code> tree can be cleaned up
	      as necessary.  Disabling keyword expansion is
	      recommended, as it makes no sense on unmodified vendor
	      code and in some cases it can even be harmful.
	      <span class="application">OpenSSH</span>, for example,
	      includes two files that originated with FreeBSD and still
	      contain the original version tags.  To do this:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn propdel svn:keywords -R .</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn commit</code></strong></pre></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65052368"></a>5.4.4.1.3. Bootstrapping Merge History</h6></div></div></div><p>If importing for the first time after the switch to
	      Subversion, bootstrap <code class="literal">svn:mergeinfo</code>
	      on the target directory in the main tree to the revision
	      that corresponds to the last related change to the
	      vendor tree, prior to importing new sources:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd <em class="replaceable"><code>head/contrib/pf</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn merge --record-only svn+ssh://svn.freebsd.org/base/<em class="replaceable"><code>vendor/pf/dist@180876</code></em> .</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn commit</code></strong></pre></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65063504"></a>5.4.4.2. Importing New Sources</h5></div></div></div><p>With two commits&#8212;one for the import itself and
	    one for the tag&#8212;this step can optionally be repeated
	    for every upstream release between the last import and the
	    current import.</p><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65074384"></a>5.4.4.2.1. Preparing the Vendor Sources</h6></div></div></div><p>Unlike in <acronym class="acronym">CVS</acronym> where only the
	      needed parts were imported into the vendor tree to avoid
	      bloating the main tree, Subversion is able to store a
	      full distribution in the vendor tree.  So, import
	      everything, but merge only what is required.</p><p>A <code class="command">svn add</code> is required to add any
	      files that were added since the last vendor import, and
	      <code class="command">svn rm</code> is required to remove any that
	      were removed since.  Preparing sorted lists of the
	      contents of the vendor tree and of the sources that are
	      about to be imported is recommended, to facilitate the
	      process.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd <em class="replaceable"><code>vendor/pf/dist</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn list -R | grep -v '/$' | sort &gt;../old</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cd <em class="replaceable"><code>../pf-4.3</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>find . -type f | cut -c 3- | sort &gt;../new</code></strong></pre><p>With these two files,
	      <code class="command">comm -23 ../old ../new</code> will list
	      removed files (files only in <code class="filename">old</code>),
	      while <code class="command">comm -13 ../old ../new</code> will
	      list added files only in
	      <code class="filename">new</code>.</p></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65098448"></a>5.4.4.2.2. Importing into the Vendor Tree</h6></div></div></div><p>Now, the sources must be copied into
	      <code class="filename"><em class="replaceable"><code>dist</code></em></code> and
	      the <code class="command">svn add</code> and
	      <code class="command">svn rm</code> commands should be used as
	      needed:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd <em class="replaceable"><code>vendor/pf/pf-4.3</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>tar cf - . | tar xf - -C ../dist</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cd <em class="replaceable"><code>../dist</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>comm -23 ../old ../new | xargs svn rm</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>comm -13 ../old ../new | xargs svn --parents add</code></strong></pre><p>If any directories were removed, they will have to
	      be <code class="command">svn rm</code>ed manually.  Nothing will
	      break if they are not, but they will remain in the
	      tree.</p><p>Check properties on any new files.  All text files
	      should have <code class="literal">svn:eol-style</code> set to
	      <code class="literal">native</code>.  All binary files should have
	      <code class="literal">svn:mime-type</code> set to
	      <code class="literal">application/octet-stream</code> unless there
	      is a more appropriate media type.  Executable files
	      should have <code class="literal">svn:executable</code> set to
	      <code class="literal">*</code>.  No other properties should exist
	      on any file in the tree.</p><p>Committing is now possible, however it is good
	      practice to make sure that everything is OK by using the
	      <code class="command">svn stat</code> and
	      <code class="command">svn diff</code> commands.</p></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65138000"></a>5.4.4.2.3. Tagging</h6></div></div></div><p>Once committed, vendor releases should be tagged for
	      future reference.  The best and quickest way to do this
	      is directly in the repository:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn cp svn+ssh://svn.freebsd.org/base/<em class="replaceable"><code>vendor/pf/dist</code></em> svn+ssh://svn.freebsd.org/base/<em class="replaceable"><code>vendor/pf/4.3</code></em></code></strong></pre><p>Once that is complete, <code class="command">svn up</code> the
	      working copy of
	      <code class="filename"><em class="replaceable"><code>vendor/pf</code></em></code>
	      to get the new tag, although this is rarely
	      needed.</p><p>If creating the tag in the working copy of the tree,
	      <code class="command">svn:mergeinfo</code> results must be
	      removed:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd	<em class="replaceable"><code>vendor/pf</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn cp dist 4.3</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn propdel svn:mergeinfo -R 4.3</code></strong></pre></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65155920"></a>5.4.4.3. Merging to Head</h5></div></div></div><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd <em class="replaceable"><code>head/contrib/pf</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn up</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn merge --accept=postpone svn+ssh://svn.freebsd.org/base/<em class="replaceable"><code>vendor/pf/dist</code></em> .</code></strong></pre><p>The <code class="literal">--accept=postpone</code> tells
	    Subversion that it should not complain because merge
	    conflicts will be taken care of manually.</p><div xmlns="" class="tip"><h3 class="admontitle"><a xmlns="http://www.w3.org/1999/xhtml" id="svn-advanced-use-vendor-imports-pre-svn"></a>Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <code class="command">cvs2svn</code> changeover occurred
	      on June 3, 2008.  When performing vendor merges for
	      packages which were already present and converted by the
	      <code class="command">cvs2svn</code> process, the command used to
	      merge
	      <code class="filename">/vendor/<em class="replaceable"><code>package_name</code></em>/dist</code>
	      to
	      <code class="filename">/head/<em class="replaceable"><code>package_location</code></em></code>
	      (for example,
	      <code class="filename">head/contrib/sendmail</code>) must use
	      <code class="option">-c <em class="replaceable"><code>REV</code></em></code> to
	      indicate the revision to merge from the
	      <code class="filename">/vendor</code> tree.  For example:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn checkout svn+ssh://svn.freebsd.org/base/head/contrib/<em class="replaceable"><code>sendmail</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cd sendmail</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn merge -c r<em class="replaceable"><code>261190</code></em> ^/vendor/<em class="replaceable"><code>sendmail/dist</code></em> .</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml"><code class="literal">^</code> is an alias for the
	      repository path.</p></div><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">If using the <span class="application">Zsh</span> shell,
	      the <code class="literal">^</code> must be escaped with
	      <code class="literal">\</code>.  This means
	      <code class="literal">^/head</code> should be
	      <code class="literal">\^/head</code>.</p></div><p>It is necessary to resolve any merge conflicts.</p><p>Make sure that any files that were added or removed in
	    the vendor tree have been properly added or removed in the
	    main tree.  To check diffs against the vendor
	    branch:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn diff --no-diff-deleted --old=svn+ssh://svn.freebsd.org/base/<em class="replaceable"><code>vendor/pf/dist</code></em> --new=.</code></strong></pre><p>The <code class="literal">--no-diff-deleted</code> tells
	    Subversion not to complain about files that are in the
	    vendor tree but not in the main tree, i.e., things that
	    would have previously been removed before the vendor
	    import, like for example the vendor's makefiles
	    and configure scripts.</p><p>Using <acronym class="acronym">CVS</acronym>, once a file was off the
	    vendor branch, it was not able to be put back.  With
	    Subversion, there is no concept of on or off the vendor
	    branch.  If a file that previously had local
	    modifications, to make it not show up in diffs in the
	    vendor tree, all that has to be done is remove any
	    left-over cruft like FreeBSD version tags, which is much
	    easier.</p><p>If any changes are required for the world to build
	    with the new sources, make them now, and keep testing
	    until everything builds and runs perfectly.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67540688"></a>5.4.4.4. Committing the Vendor Import</h5></div></div></div><p>Committing is now possible!  Everything must be
	    committed in one go.  If done properly, the tree will move
	    from a consistent state with old code, to a consistent
	    state with new code.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67541840"></a>5.4.4.5. From Scratch</h5></div></div></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67542480"></a>5.4.4.5.1. Importing into the Vendor Tree</h6></div></div></div><p>This section is an example of importing and tagging
	      <span class="application">byacc</span> into
	      <code class="filename">head</code>.</p><p>First, prepare the directory in
	      <code class="filename">vendor</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn co --depth immediates <em class="replaceable"><code>$FSVN/vendor</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cd <em class="replaceable"><code>vendor</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn mkdir <em class="replaceable"><code>byacc</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn mkdir <em class="replaceable"><code>byacc/dist</code></em></code></strong></pre><p>Now, import the sources into the
	      <code class="filename">dist</code> directory.
	      Once the files are in place, <code class="command">svn add</code>
	      the new ones, then <code class="command">svn commit</code> and tag
	      the imported version.  To save time and bandwidth,
	      direct remote committing and tagging is possible:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn cp -m <em class="replaceable"><code>"Tag byacc 20120115"</code></em> <em class="replaceable"><code>$FSVN/vendor/byacc/dist</code></em> <em class="replaceable"><code>$FSVN/vendor/byacc/20120115</code></em></code></strong></pre></div><div class="sect5"><div xmlns="" class="titlepage"><div><div><h6 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67577808"></a>5.4.4.5.2. Merging to <code class="literal">head</code></h6></div></div></div><p>Due to this being a new file, copy it for the
	      merge:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn cp -m <em class="replaceable"><code>"Import byacc to contrib"</code></em> <em class="replaceable"><code>$FSVN/vendor/byacc/dist</code></em> <em class="replaceable"><code>$FSVN/head/contrib/byacc</code></em></code></strong></pre><p>Working normally on newly imported sources is still
	      possible.</p></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-advanced-use-reverting-a-commit"></a>5.4.5. Reverting a Commit</h4></div></div></div><p>Reverting a commit to a previous version is fairly
	  easy:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn merge -r179454:179453 ROADMAP.txt</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn commit</code></strong></pre><p>Change number syntax, with negative meaning a reverse
	  change, can also be used:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn merge -c -179454 ROADMAP.txt</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn commit</code></strong></pre><p>This can also be done directly in the repository:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn merge -r179454:179453 svn+ssh://svn.freebsd.org/base/ROADMAP.txt</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">It is important to ensure that the mergeinfo
	    is correct when reverting a file in order to permit
	    <code class="command">svn mergeinfo --eligible</code> to work as
	    expected.</p></div><p>Reverting the deletion of a file is slightly different.
	  Copying the version of the file that predates the deletion
	  is required.  For example, to restore a file that was
	  deleted in revision N, restore version N-1:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn copy svn+ssh://svn.freebsd.org/base/ROADMAP.txt@179454</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn commit</code></strong></pre><p>or, equally:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn copy svn+ssh://svn.freebsd.org/base/ROADMAP.txt@179454 svn+ssh://svn.freebsd.org/base</code></strong></pre><p>Do <span class="emphasis"><em>not</em></span> simply recreate the file
	  manually and <code class="command">svn add</code> it&#8212;this will
	  cause history to be lost.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-advanced-use-fixing-mistakes"></a>5.4.6. Fixing Mistakes</h4></div></div></div><p>While we can do surgery in an emergency, do not plan on
	  having mistakes fixed behind the scenes.  Plan on mistakes
	  remaining in the logs forever.  Be sure to check the output
	  of <code class="command">svn status</code> and <code class="command">svn
	    diff</code> before committing.</p><p>Mistakes will happen but,
	  they can generally be fixed without
	  disruption.</p><p>Take a case of adding a file in the wrong location.  The
	  right thing to do is to <code class="command">svn move</code> the file
	  to the correct location and commit.  This causes just a
	  couple of lines of metadata in the repository journal, and
	  the logs are all linked up correctly.</p><p>The wrong thing to do is to delete the file and then
	  <code class="command">svn add</code> an independent copy in the
	  correct location.  Instead of a couple of lines of text, the
	  repository journal grows an entire new copy of the file.
	  This is a waste.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-advanced-use-setting-up-svnsync"></a>5.4.7. Setting up a <span class="application">svnsync</span>
	  Mirror</h4></div></div></div><p>You probably do not want to do this unless there is a
	  good reason for it.  Such reasons might be to support many
	  multiple local read-only client machines, or if your network
	  bandwidth is limited.  Starting a fresh mirror from empty
	  would take a very long time.  Expect a minimum of 10 hours
	  for high speed connectivity.  If you have international
	  links, expect this to take 4 to 10 times longer.</p><p>A far better option is to grab a seed file.  It is large
	  (~1GB) but will consume less network traffic and take less
	  time to fetch than a svnsync will.  This is possible in one
	  of the following three ways:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>rsync -va --partial --progress freefall:/home/peter/svnmirror-base-r179637.tbz2 .</code></strong></pre><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>rsync -va --partial --progress rsync://repoman.freebsd.org:50873/svnseed/svnmirror-base-r215629.tar.xz .</code></strong></pre><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>fetch ftp://ftp.freebsd.org/pub/FreeBSD/development/subversion/svnmirror-base-r221445.tar.xz</code></strong></pre><p>Once you have the file, extract it to somewhere like
	  <code class="filename">home/svnmirror/base/</code>.
	  Then, update it, so that it fetches changes since the last
	  revision in the archive:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svnsync sync file:///home/svnmirror/base</code></strong></pre><p>You can then set that up to run from <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>, do
	  checkouts locally, set up a svnserve server for your local
	  machines to talk to, etc.</p><p>The seed mirror is set to fetch from
	  <code class="literal">svn://svn.freebsd.org/base</code>.  The
	  configuration for the mirror is stored in
	  <code class="literal">revprop 0</code> on the local mirror.  To see
	  the configuration, try:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn proplist -v --revprop -r 0 file:///home/svnmirror/base</code></strong></pre><p>Use <code class="literal">propset</code> to change things.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-advanced-use-committing-high-ascii-data"></a>5.4.8. Committing High-<acronym class="acronym">ASCII</acronym> Data</h4></div></div></div><p>Files that have high-<acronym class="acronym">ASCII</acronym> bits are
	  considered binary files in <acronym class="acronym">SVN</acronym>, so the
	  pre-commit checks fail and indicate that the
	  <code class="literal">mime-type</code> property should be set to
	  <code class="literal">application/octet-stream</code>.  However, the
	  use of this is discouraged, so please do not set it.  The
	  best way is always avoiding high-<acronym class="acronym">ASCII</acronym>
	  data, so that it can be read everywhere with any text editor
	  but if it is not avoidable, instead of changing the
	  mime-type, set the <code class="literal">fbsd:notbinary</code>
	  property with <code class="literal">propset</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn propset fbsd:notbinary yes foo.data</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="svn-advanced-use-maintaining-a-project-branch"></a>5.4.9. Maintaining a Project Branch</h4></div></div></div><p>A project branch is one that is synced to head (or
	  another branch) is used to develop a project then commit it
	  back to head.  In <acronym class="acronym">SVN</acronym>,
	  <span class="quote">&#8220;<span class="quote">dolphin</span>&#8221;</span> branching is used for this.  A
	  <span class="quote">&#8220;<span class="quote">dolphin</span>&#8221;</span> branch is one that diverges for a
	  while and is finally committed back to the original branch.
	  During development code migration in one direction (from
	  head to the branch only).  No code is committed back to head
	  until the end.  Once you commit back at the end, the branch
	  is dead (although you can have a new branch with the same
	  name after you delete the branch if you want).</p><p>As per <a class="link" href="http://people.freebsd.org/~peter/svn_notes.txt" target="_top">http://people.freebsd.org/~peter/svn_notes.txt</a>,
	  work that is intended to be merged back into HEAD should be
	  in <code class="filename">base/projects/</code>.  If you are doing
	  work that is beneficial to the FreeBSD community in some way
	  but not intended to be merged directly back into HEAD then
	  the proper location is
	  <code class="filename">base/user/<em class="replaceable"><code>your-name</code></em>/</code>.
	  <a class="link" href="http://svnweb.freebsd.org/base/projects/GUIDELINES.txt" target="_top">This
	    page</a> contains further details.</p><p>To create a project branch:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn copy svn+ssh://svn.freebsd.org/base/head svn+ssh://svn.freebsd.org/base/projects/spif</code></strong></pre><p>To merge changes from HEAD back into the project
	  branch:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd copy_of_spif</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn merge svn+ssh://svn.freebsd.org/base/head</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn commit</code></strong></pre><p>It is important to resolve any merge conflicts before
	  committing.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67640400"></a>5.5. Some Tips</h3></div></div></div><p>In commit logs etc., <span class="quote">&#8220;<span class="quote">rev 179872</span>&#8221;</span> should be
	spelled <span class="quote">&#8220;<span class="quote">r179872</span>&#8221;</span> as per convention.</p><p>Speeding up svn is possible by adding the following to
	<code class="filename">~/.ssh/config</code>:</p><pre class="screen">Host *
ControlPath ~/.ssh/sockets/master-%l-%r@%h:%p
ControlMaster auto
ControlPersist yes</pre><p>and then typing</p><pre class="screen"><strong class="userinput"><code>mkdir ~/.ssh/sockets</code></strong></pre><p>Checking out a working copy with a stock Subversion client
	without FreeBSD-specific patches
	(<code class="varname">OPTIONS_SET=FREEBSD_TEMPLATE</code>) will mean
	that <code class="literal">$FreeBSD$</code> tags will not
	be expanded.  Once the correct version has been installed,
	trick Subversion into expanding them like so:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>svn propdel -R svn:keywords .</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>svn revert -R .</code></strong></pre><p>This will wipe out uncommitted patches.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="committer.types.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="conventions.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4. Commit Bit Types </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 6. Setup, Conventions, and Traditions</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>