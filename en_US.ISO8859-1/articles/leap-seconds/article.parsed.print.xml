<?xml version="1.0" encoding="iso-8859-1"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="leapseconds">

  <info>
    <title xmlns:xlink="http://www.w3.org/1999/xlink">FreeBSD Support for Leap Seconds</title>

    <pubdate xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</pubdate>
  </info>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="leapseconds-definition">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Introduction</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">A <emphasis xmlns:xlink="http://www.w3.org/1999/xlink">leap second</emphasis> is an ad-hoc one-second
      correction to synchronize atomic timescales with Earth rotation.
      This article describes how FreeBSD interacts with leap
      seconds.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">As of this writing, the next leap second will occur at
      2015-Jun-30 23:59:60 UTC.  This leap second will occur during a
      business day for North and South America and the Asia/Pacific
      region.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Leap seconds are announced by <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://datacenter.iers.org/"><acronym xmlns:xlink="http://www.w3.org/1999/xlink">IERS</acronym></link>
      on <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://datacenter.iers.org/web/guest/bulletins/-/somos/5Rgv/product/16">Bulletin
	C</link>.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Standard leap second behavior is described in <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://tools.ietf.org/html/rfc7164#section-3">RFC
	7164</link>.  Also see <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">time2posix</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry>.</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="leapseconds-posix">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Default Leap Second Handling on FreeBSD</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The easiest way to handle leap seconds is with the
      <acronym xmlns:xlink="http://www.w3.org/1999/xlink">POSIX</acronym> time rules FreeBSD uses by default,
      combined with <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.FreeBSD.org/doc/en_US.ISO8859-1/books/handbook/network-ntp.html"><acronym xmlns:xlink="http://www.w3.org/1999/xlink">NTP</acronym></link>.
      When <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">ntpd</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> is running and the time is synchronized with
      upstream <acronym xmlns:xlink="http://www.w3.org/1999/xlink">NTP</acronym> servers that handle leap seconds
      correctly, the leap second will cause the system time to
      automatically repeat the last second of the day.  No other
      adjustments are necessary.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">If the upstream <acronym xmlns:xlink="http://www.w3.org/1999/xlink">NTP</acronym> servers do not handle
      leap seconds correctly, <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">ntpd</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> will step the time by one
      second after the errant upstream server has noticed and stepped
      itself.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">If <acronym xmlns:xlink="http://www.w3.org/1999/xlink">NTP</acronym> is not being used, manual
      adjustment of the system clock will be required after the leap
      second has passed.</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="leapseconds-cautions">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Cautions</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Leap seconds are inserted at the same instant all over the
      world: <acronym xmlns:xlink="http://www.w3.org/1999/xlink">UTC</acronym> midnight.  In Japan that is
      mid-morning, in the Pacific mid-day, in the Americas late
      afternoon, and in Europe at night.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">We believe and expect that FreeBSD, if provided correct and
      stable <acronym xmlns:xlink="http://www.w3.org/1999/xlink">NTP</acronym> service, will work as designed
      during this leap second, as it did during the previous
      ones.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">However, we caution that practically no applications have
      ever asked the kernel about leap seconds.  Our experience is
      that, as designed, leap seconds are essentially a replay of the
      second before the leap second, and this is a surprise to most
      application programmers.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Other operating systems and other computers may or may not
      handle the leap-second the same way as FreeBSD, and systems without
      correct and stable <acronym xmlns:xlink="http://www.w3.org/1999/xlink">NTP</acronym> service will not know
      anything about leap seconds at all.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">It is not unheard of for computers to crash because of
      leap seconds, and experience has shown that a large fraction
      of all public <acronym xmlns:xlink="http://www.w3.org/1999/xlink">NTP</acronym> servers might handle and
      announce the leap second incorrectly.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Please try to make sure nothing horrible happens because of
      the leap second.</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="leapseconds-testing">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Testing</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">It is possible to test whether a leap second will be used.
      Due to the nature of <acronym xmlns:xlink="http://www.w3.org/1999/xlink">NTP</acronym>, the test might work
      up to 24 hours before the leap second.  Some major reference
      clock sources only announce leap seconds one hour ahead of the
      event.  Query the <acronym xmlns:xlink="http://www.w3.org/1999/xlink">NTP</acronym> daemon:</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ntpq -c 'rv 0 leap'</userinput></screen>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Output that includes <literal xmlns:xlink="http://www.w3.org/1999/xlink">leap_add_sec</literal>
      indicates proper support of the leap second.  Before the 24
      hours leading up to the leap second, or after the leap second
      has passed, <literal xmlns:xlink="http://www.w3.org/1999/xlink">leap_none</literal> will be shown.</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="leapseconds-conclusion">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Conclusion</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">In practice, leap seconds are usually not a problem on FreeBSD.
      We hope that this overview helps clarify what to expect and how
      to make the leap second event proceed more smoothly.</para>
  </sect1>
</article>
