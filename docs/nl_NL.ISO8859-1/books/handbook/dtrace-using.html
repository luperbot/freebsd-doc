<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>25.4. DTrace gebruiken</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD handboek" /><link rel="up" href="dtrace.html" title="Hoofdstuk 25. DTrace" /><link rel="prev" href="dtrace-enable.html" title="25.3. Ondersteuning voor DTrace aanzetten" /><link rel="next" href="dtrace-language.html" title="25.5. De taal D" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">25.4. DTrace gebruiken</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="dtrace-enable.html">Terug</a> </td><th width="60%" align="center">Hoofdstuk 25. DTrace</th><td width="20%" align="right"> <a accesskey="n" href="dtrace-language.html">Volgende</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dtrace-using"></a>25.4. DTrace gebruiken</h2></div></div></div><p>Voordat er gebruik wordt gemaakt van de functionaliteit van
      DTrace, moet het DTrace-apparaat bestaan.  Geef het volgende
      commando om het apparaat te laten:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload dtraceall</code></strong></pre><p>Ondersteuning van DTrace zou nu beschikbaar moeten zijn.  De
      beheerder kan het volgende commando uitvoeren om alle sondes te
      bekijken:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dtrace -l | more</code></strong></pre><p>Alle uitvoer wordt aan het hulpmiddel <code class="command">more</code>
      doorgegeven omdat het snel de schermbuffer zal laten overstromen.
      DTrace kan nu als werkend worden beschouwd.  Het is nu tijd om
      de gereedschapskist te bekijken.</p><p>De gereedschapskist is een verzameling van kant-en-klare
      scripts die met DTrace gedraaid kunnen worden om informatie over
      het systeem te verzamelen.  Er zijn scripts om open bestanden,
      geheugen, <acronym class="acronym">CPU</acronym>-gebruik, en nog veel meer te
      controleren.  Pak de scripts uit met het volgende commando:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gunzip -c DTraceToolkit* | tar xvf -</code></strong></pre><p>Ga naar die map met <code class="command">cd</code> en zet de
      uitvoerpermissies voor alle bestanden waarvan de naam uit kleine
      letters bestaat, op <code class="literal">755</code>.</p><p>De inhoud van al deze scripts moet veranderd worden.  Degenen
      die naar <code class="filename">/usr/bin/ksh</code> verwijzen dienen naar
      <code class="filename">/usr/local/bin/ksh</code> te verwijzen, de anderen
      die <code class="filename">/usr/bin/sh</code> gebruiken dienen gewijzigd te
      worden om <code class="filename">/bin/sh</code> te gebruiken, en tenslotte
      dienen degenen die <code class="filename">/usr/bin/perl</code> gebruiken
      veranderd te worden om <code class="filename">/usr/local/bin/perl</code> te
      gebruiken.</p><div xmlns="" class="important"><h3 class="admontitle">Belangrijk: </h3><p xmlns="http://www.w3.org/1999/xhtml">Op dit moment is het voorzichtig om de lezer eraan te
	herinneren dat de ondersteuning voor DTrace in FreeBSD
	<span class="emphasis"><em>niet compleet</em></span> en
	<span class="emphasis"><em>experimenteel</em></span> is.  Veel van deze scripts
	zullen niet werken omdat ze of te <span class="trademark">Solaris</span>&#8482;-specifiek zijn of
	omdat ze sondes gebruiken die momenteel niet ondersteund
	worden.</p></div><p>Op het moment van schrijven worden slechts twee scripts van de
      DTrace Toolkit volledig ondersteund in FreeBSD: de scripts
      <code class="filename">hotkernel</code> en
      <code class="filename">procsystime</code>.  Dit zijn de twee die we in de
      volgende gedeelten van deze sectie zullen bekijken.</p><p>De <code class="filename">hotkernel</code> is ontworpen om te
      identificeren welke functie de meeste kerneltijd gebruikt.  Als
      het normaal gedraaid wordt, zal het uitvoer die op de volgende
      lijkt produceren:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/share/dtrace/toolkit</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>./hotkernel</code></strong>
Sampling... Hit Ctrl-C to end.</pre><p>De systeembeheerder moet de toetsencombinatie <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span>
      gebruiken om het proces te stoppen.  Nadat het gestopt is, zal het
      script een lijst van kernelfuncties en timinginformatie weergeven,
      waarbij de uitvoer in volgorde van toenemende tijd is
      gesorteerd:</p><pre class="screen">kernel`_thread_lock_flags                                   2   0.0%
0xc1097063                                                  2   0.0%
kernel`sched_userret                                        2   0.0%
kernel`kern_select                                          2   0.0%
kernel`generic_copyin                                       3   0.0%
kernel`_mtx_assert                                          3   0.0%
kernel`vm_fault                                             3   0.0%
kernel`sopoll_generic                                       3   0.0%
kernel`fixup_filename                                       4   0.0%
kernel`_isitmyx                                             4   0.0%
kernel`find_instance                                        4   0.0%
kernel`_mtx_unlock_flags                                    5   0.0%
kernel`syscall                                              5   0.0%
kernel`DELAY                                                5   0.0%
0xc108a253                                                  6   0.0%
kernel`witness_lock                                         7   0.0%
kernel`read_aux_data_no_wait                                7   0.0%
kernel`Xint0x80_syscall                                     7   0.0%
kernel`witness_checkorder                                   7   0.0%
kernel`sse2_pagezero                                        8   0.0%
kernel`strncmp                                              9   0.0%
kernel`spinlock_exit                                       10   0.0%
kernel`_mtx_lock_flags                                     11   0.0%
kernel`witness_unlock                                      15   0.0%
kernel`sched_idletd                                       137   0.3%
0xc10981a5                                              42139  99.3%</pre><p>Het script werkt ook met kernelmodules.  Draai het script met
      de vlag <code class="option">-m</code> om deze mogelijkheid te
      gebruiken:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>./hotkernel -m</code></strong>
Sampling... Hit Ctrl-C to end.
^C
MODULE                                                  COUNT   PCNT
0xc107882e                                                  1   0.0%
0xc10e6aa4                                                  1   0.0%
0xc1076983                                                  1   0.0%
0xc109708a                                                  1   0.0%
0xc1075a5d                                                  1   0.0%
0xc1077325                                                  1   0.0%
0xc108a245                                                  1   0.0%
0xc107730d                                                  1   0.0%
0xc1097063                                                  2   0.0%
0xc108a253                                                 73   0.0%
kernel                                                    874   0.4%
0xc10981a5                                             213781  99.6%</pre><p>Het script <code class="filename">procsystime</code> vangt en beeldt
      het tijdsgebruik van systeemaanroepen af voor een gegeven
      <acronym class="acronym">PID</acronym> of procesnaam.  In het volgende voorbeeld
      wordt er een nieuwe instantie van <code class="filename">/bin/csh</code>
      gedraaid.  Het <code class="filename">procsystime</code> werd uitgevoerd en
      bleef wachten terwijl er enkele commando's op de andere instantie
      van <code class="command">csh</code> werden getypt.  Dit zijn de resultaten
      van deze test:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>./procsystime -n csh</code></strong>
Tracing... Hit Ctrl-C to end...
^C

Elapsed Times for processes csh,

         SYSCALL          TIME (ns)
          getpid               6131
       sigreturn               8121
           close              19127
           fcntl              19959
             dup              26955
         setpgid              28070
            stat              31899
       setitimer              40938
           wait4              62717
       sigaction              67372
     sigprocmask             119091
    gettimeofday             183710
           write             263242
          execve             492547
           ioctl             770073
           vfork            3258923
      sigsuspend            6985124
            read         3988049784</pre><p>Zoals te zien is, lijkt de systeemaanroep
      <code class="function">read()</code> de meeste tijd in nanoseconden te
      gebruiken en gebruikte de systeemaanroep
      <code class="function">getpid()</code> de minste hoeveelheid tijd.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="dtrace-enable.html">Terug</a> </td><td width="20%" align="center"><a accesskey="u" href="dtrace.html">Omhoog</a></td><td width="40%" align="right"> <a accesskey="n" href="dtrace-language.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">25.3. Ondersteuning voor DTrace aanzetten </td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top"> 25.5. De taal D</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>