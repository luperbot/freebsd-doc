<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>31.4. Bluetooth</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD handboek" /><link rel="up" href="advanced-networking.html" title="Hoofdstuk 31. Geavanceerde netwerken" /><link rel="prev" href="network-wireless.html" title="31.3. Draadloze netwerken" /><link rel="next" href="network-bridging.html" title="31.5. Bridging" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.4. Bluetooth</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-wireless.html">Terug</a> </td><th width="60%" align="center">Hoofdstuk 31. Geavanceerde netwerken</th><td width="20%" align="right"> <a accesskey="n" href="network-bridging.html">Volgende</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-bluetooth"></a>31.4. Bluetooth</h2></div><div><span class="authorgroup">Geschreven door <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Pav</span> <span class="surname">Lucistnik</span></span>. </span></div></div></div><a id="idp89435472" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89435984"></a>31.4.1. Introductie</h3></div></div></div><p>Bluetooth is een draadloze technologie om persoonlijke
	netwerken aan te maken die in de vrije 2,4GHz-band werken binnen
	een straal van 10 meter.  Deze netwerken worden gewoonlijk
	ad-hoc gevormd en bestaan uit draagbare apparaten zoals mobiele
	telefoons, handhelds en laptops.  In tegenstelling tot die
	andere populaire draadloze techniek, Wi-Fi, biedt Bluetooth een
	hoger niveau van serviceprofielen, zoals FTP-achtige
	bestandsservers, pushing van bestanden, stemtransport, emulatie
	van seriële lijnen, en meer.</p><p>De Bluetooth stack is in FreeBSD geïmplementeerd door
	gebruik te maken van het Netgraph-raamwerk (zie
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=netgraph&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">netgraph</span>(4)</span></a>).  Veel van de Bluetooth USB-dongles worden
	ondersteund door het stuurprogramma <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_ubt</span>(4)</span></a>.  Apparaten
	gebaseerd op de Broadcom BCM2033 chip worden ondersteund door de
	stuurprogramma's <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ubtbcmfw&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ubtbcmfw</span>(4)</span></a> en <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_ubt&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_ubt</span>(4)</span></a>.  De 3Com
	Bluetooth PC Card 3CRWB60-A wordt ondersteund door het
	stuurprogramma <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_bt3c&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_bt3c</span>(4)</span></a>.  Seriële en op UART
	gebaseerde Bluetooth-apparaten worden ondersteund via
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sio&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">sio</span>(4)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_h4&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_h4</span>(4)</span></a>, en <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hcseriald&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">hcseriald</span>(8)</span></a>.  Deze sectie
	beschrijft het gebruik van de USB Bluetooth-dongle.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89492944"></a>31.4.2. Het apparaat inprikken</h3></div></div></div><p>Standaard zijn stuurprogramma's voor Bluetooth-apparaten
	beschikbaar als kernelmodules.  Voordat een apparaat wordt
	aangekoppeld, dient het stuurprogramma in de kernel geladen te
	worden:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload ng_ubt</code></strong></pre><p>Indien het Bluetooth-apparaat tijdens het opstarten van het
	systeem in het systeem aanwezig is, kan de module vanuit
	<code class="filename">/boot/loader.conf</code> geladen worden:</p><pre class="programlisting">ng_ubt_load="YES"</pre><p>Prik de USB-dongle in.  Uitvoer vergelijkbaar aan de
	onderstaande zal op de console (of in syslog) verschijnen:</p><pre class="screen">ubt0: vendor 0x0a12 product 0x0001, rev 1.10/5.25, addr 2
ubt0: Interface 0 endpoints: interrupt=0x81, bulk-in=0x82, bulk-out=0x2
ubt0: Interface 1 (alt.config 5) endpoints: isoc-in=0x83, isoc-out=0x3,
      wMaxPacketSize=49, nframes=6, buffer size=294</pre><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=service&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">service</span>(8)</span></a> wordt
	gebruikt om de Bluetooth-stack te starten en te stoppen.  Het is
	een goed idee om de stack te stoppen voordat het apparaat wordt
	losgekoppeld, maar het is (gewoonlijk) niet fataal.  Tijdens het
	starten van de stack verschijnt er uitvoer vergelijkbaar met de
	onderstaande:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service bluetooth start ubt0</code></strong>
BD_ADDR: 00:02:72:00:d4:1a
Features: 0xff 0xff 0xf 00 00 00 00 00
&lt;3-Slot&gt; &lt;5-Slot&gt; &lt;Encryption&gt; &lt;Slot offset&gt;
&lt;Timing accuracy&gt; &lt;Switch&gt; &lt;Hold mode&gt; &lt;Sniff mode&gt;
&lt;Park mode&gt; &lt;RSSI&gt; &lt;Channel quality&gt; &lt;SCO link&gt;
&lt;HV2 packets&gt; &lt;HV3 packets&gt; &lt;u-law log&gt; &lt;A-law log&gt; &lt;CVSD&gt;
&lt;Paging scheme&gt; &lt;Power control&gt; &lt;Transparent SCO data&gt;
Max. ACL packet size: 192 bytes
Number of ACL packets: 8
Max. SCO packet size: 64 bytes
Number of SCO packets: 8</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89507536"></a>31.4.3. Host Controller Interface (HCI)</h3></div></div></div><a id="idp89508176" class="indexterm"></a><p>Het Host Controller Interface (HCI) biedt een
	opdrachtinterface naar de controller van de basisband en de
	verbindingsbeheerder, en toegang tot hardwarestatus en
	controleregisters.  Deze interface biedt een uniforme manier
	om de mogelijkheden van de basisband van Bluetooth te benaderen.
	De HCI-laag op de gastheer wisselt gegevens en opdrachten uit
	met de HCI-firmware in de Bluetooth-hardware.  Het
	stuurprogramma voor de Host Controller Transport Layer (i.e., de
	fysieke bus) biedt aan beide HCI-lagen de mogelijkheid om
	informatie met elkaar uit te wisselen.</p><p>Voor een enkel Bluetooth-apparaat wordt een enkele Netgraph
	knoop van het type <span class="emphasis"><em>hci</em></span> aangemaakt.  De
	HCI-knoop is normaliter verbonden met de knoop van het
	Bluetooth-apparaatstuurprogramma (naar beneden toe) en de
	L2CAP-knoop (naar boven toe).  Alle HCI-bewerkingen dienen te
	worden uitgevoerd op de HCI-knoop en niet op de knoop van het
	apparaatstuurprogramma.  De standaardnaam voor de HCI-knoop is
	<span class="quote">&#8220;<span class="quote">devicehci</span>&#8221;</span>.  Kijk voor meer details in de
	hulppagina <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_hci&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_hci</span>(4)</span></a>.</p><p>Eén van de meest voorkomende taken is het ontdekken
	van Bluetooth-apparaten binnen radiobereik.  Deze bewerking
	wordt <span class="emphasis"><em>ondervragen</em></span> genoemd.  Ondervragen en
	andere HCI-gerelateerde bewerkingen worden uitgevoerd met het
	programma <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hccontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">hccontrol</span>(8)</span></a>.  Het onderstaande voorbeeld laat
	zien hoe kan worden uitgezocht welke Bluetooth-apparaten zich
	binnen het bereik bevinden.  De lijst met apparaten zou binnen
	enkele seconden moeten binnenkomen.  Bedenk dat een apparaat op
	afstand alleen antwoord op de ondervraging zal geven indien het
	in <span class="emphasis"><em>ontdekbare</em></span> modus staat.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci inquiry</code></strong>
Inquiry result, num_responses=1
Inquiry result #0
       BD_ADDR: 00:80:37:29:19:a4
       Page Scan Rep. Mode: 0x1
       Page Scan Period Mode: 00
       Page Scan Mode: 00
       Class: 52:02:04
       Clock offset: 0x78ef
Inquiry complete. Status: No error [00]</pre><p><code class="literal">BD_ADDR</code> is een uniek adres van een
	Bluetooth-apparaat, vergelijkbaar met een MAC-adres van een
	netwerkkaart.  Dit adres is nodig voor verdere communicatie met
	een apparaat.  Het is mogelijk om een menselijk leesbare naam
	aan een BD_ADDR toe te kennen.  Het bestand
	<code class="filename">/etc/bluetooth/hosts</code> bevat informatie over
	de bekende Bluetooth-gastheren.  Het volgende voorbeeld laat
	zien hoe de menselijk leesbare naam dat aan het apparaat op
	afstand was toegekend te verkrijgen is:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci remote_name_request 00:80:37:29:19:a4</code></strong>
BD_ADDR: 00:80:37:29:19:a4
Name: Pav's T39</pre><p>Tijdens het uitvoeren van een ondervraging op een
	Bluetooth-apparaat op afstand zal het de computer als
	<span class="quote">&#8220;<span class="quote">uw.gastheer.naam (ubt0)</span>&#8221;</span> vinden.  De naam die aan
	het lokale apparaat is toegekend, kan altijd gewijzigd
	worden.</p><p>Het Bluetooth-systeem biedt een punt-naar-punt-verbinding
	(slechts twee Bluetooth-eenheden betrokken), of een
	punt-naar-veelpunt-verbinding.  Bij een
	punt-naar-veelpunt-verbinding wordt de verbinding met meerdere
	Bluetooth-apparaten gedeeld.  Het volgende voorbeeld laat zien
	hoe de lijst met actieve basisbandverbindingen voor het lokale
	apparaat te verkrijgen is:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>hccontrol -n ubt0hci read_connection_list</code></strong>
Remote BD_ADDR    Handle Type Mode Role Encrypt Pending Queue State
00:80:37:29:19:a4     41  ACL    0 MAST    NONE       0     0 OPEN</pre><p>Een <span class="emphasis"><em>verbindingshandvat</em></span> is nuttig indien
	het beëindigen van de basisbandverbinding noodzakelijk is.
	Normaalgesproken is het niet nodig om dit handmatig te doen.  De
	stack zal automatisch niet-actieve basisbandverbindingen
	beëindigen.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>hccontrol -n ubt0hci disconnect 41</code></strong>
Connection handle: 41
Reason: Connection terminated by local host [0x16]</pre><p>Raadpleeg <code class="command">hccontrol help</code> voor een
	volledige lijst van beschikbare HCI-opdrachten.  Voor de meeste
	HCI-opdrachten zijn geen beheerdersrechten nodig.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89525328"></a>31.4.4. Logical Link Control and Adaptation
	Protocol (L2CAP)</h3></div></div></div><a id="idp89525968" class="indexterm"></a><p>Het Logical Link Control and Adaptation Protocol (L2CAP)
	biedt verbindingsgeoriënteerde en verbindingsloze
	gegevensdiensten met mogelijkheden om protocollen te multiplexen
	en mogelijkheden voor segmentatie/herassemblage voor protocollen
	in hogere lagen.  L2CAP staat toe dat protocollen en
	toepassingen in hogere lagen L2CAP-gegevenspakketten met een
	maximale lengte van 64 kB te verzenden en ontvangen.</p><p>L2CAP is op het concept van <span class="emphasis"><em>kanalen</em></span>
	gebaseerd.  Een kanaal is een logische verbinding bovenop een
	basisbandverbinding.  Elk kanaal is op een
	veel-op-één manier aan een enkel protocol
	gebonden.  Aan hetzelfde protocol kunnen meerdere kanalen worden
	gebonden, maar één kanaal kan niet aan meerdere
	protocollen worden gebonden.  Elk L2CAP-pakket dat op een kanaal
	wordt ontvangen, wordt naar het juiste hogere protocol
	doorgestuurd.  Meerdere kanalen kunnen dezelfde
	basisbandverbinding delen.</p><p>Voor elk Bluetooth-apparaat wordt een enkele Netgraph-knoop
	van het soort <span class="emphasis"><em>l2cap</em></span> aangemaakt.  De
	L2CAP-knoop is normaalgesproken verbonden met de Bluetooth
	HCI-knoop (naar beneden toe) en de knopen van de stopcontacten
	voor Bluetooth (naar boven toe).  De standaardnaam voor de
	L2CAP-knoop is <span class="quote">&#8220;<span class="quote">devicel2cap</span>&#8221;</span>.  Zie voor meer
	details de hulppagina <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_l2cap&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_l2cap</span>(4)</span></a>.</p><p>Een nuttig commando is <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=l2ping&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">l2ping</span>(8)</span></a>, dat gebruikt kan
	worden om andere apparaten te pingen.  Sommige
	Bluetooth-implementaties geven niet alle verzonden gegevens
	terug, dus is <code class="literal">0 bytes</code> normaal in het volgende
	voorbeeld.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>l2ping -a 00:80:37:29:19:a4</code></strong>
0 bytes from 0:80:37:29:19:a4 seq_no=0 time=48.633 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=1 time=37.551 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=2 time=28.324 ms result=0
0 bytes from 0:80:37:29:19:a4 seq_no=3 time=46.150 ms result=0</pre><p>Met het programma <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=l2control&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">l2control</span>(8)</span></a> kunnen verschillende
	bewerkingen op L2CAP-knopen worden uitgevoerd.  Dit voorbeeld
	laat zien hoe de lijst met logische verbindingen (kanalen)
	en de lijst met basisbandverbindingen voor het lokale apparaat
	verkregen kunnen worden:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>l2control -a 00:02:72:00:d4:1a read_channel_list</code></strong>
L2CAP channels:
Remote BD_ADDR     SCID/ DCID   PSM  IMTU/ OMTU State
00:07:e0:00:0b:ca    66/   64     3   132/  672 OPEN
<code class="prompt">%</code> <strong class="userinput"><code>l2control -a 00:02:72:00:d4:1a read_connection_list</code></strong>
L2CAP connections:
Remote BD_ADDR    Handle Flags Pending State
00:07:e0:00:0b:ca     41 O           0 OPEN</pre><p>Een ander diagnostisch programma is <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=btsockstat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">btsockstat</span>(1)</span></a>.  Het
	heeft ongeveer hetzelfde doel als <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=netstat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">netstat</span>(1)</span></a>, maar dan voor
	Bluetooth-netwerkgerelateerde gegevensstructuren.  Het
	onderstaande voorbeeld laat dezelfde logische verbinding zien
	als die van <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=l2control&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">l2control</span>(8)</span></a> hierboven.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>btsockstat</code></strong>
Active L2CAP sockets
PCB      Recv-Q Send-Q Local address/PSM       Foreign address   CID   State
c2afe900      0      0 00:02:72:00:d4:1a/3     00:07:e0:00:0b:ca 66    OPEN
Active RFCOMM sessions
L2PCB    PCB      Flag MTU   Out-Q DLCs State
c2afe900 c2b53380 1    127   0     Yes  OPEN
Active RFCOMM sockets
PCB      Recv-Q Send-Q Local address     Foreign address   Chan DLCI State
c2e8bc80      0    250 00:02:72:00:d4:1a 00:07:e0:00:0b:ca 3    6    OPEN</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89539280"></a>31.4.5. Het RFCOMM-protocol</h3></div></div></div><a id="idp89539920" class="indexterm"></a><p>Het RFCOMM-protocol biedt emulatie van seriële poorten
	over het L2CAP-protocol.  Het protocol is gebaseerd op de
	ETSI-standaard TS 07.10.  RFCOMM is een eenvoudig
	transportprotocol, met aanvullende voorzieningen om de 9
	circuits van RS-232- (EIATIA-232-E-) seriële poorten te
	emuleren.  Het RFCOMM-protocol ondersteunt tot 60 gelijktijdige
	verbindingen (RFCOMM-kanalen) tussen twee
	Bluetooth-apparaten.</p><p>Het is de bedoeling van RFCOMM dat in een volledig
	communicatiepad twee toepassingen op verschillende apparaten
	draaien (de eindpunten van de communicatie) met daartussen een
	communicatiesegment.  RFCOMM is bedoeld om de toepassingen te
	beheren die gebruik maken van de seriële poorten van de
	apparaten waarop ze zijn geïnstalleerd.  Het
	communicatiesegment is een directe Bluetooth-verbinding van het
	ene apparaat naar het andere.</p><p>RFCOMM houdt zich alleen bezig met de verbinding tussen twee
	apparaten bij directe verbindingen, of tussen het apparaat en
	een modem in het geval van een netwerk.  RFCOMM kan andere
	opstellingen ondersteunen, zoals modules die via draadloze
	Bluetooth-technologie communiceren aan de ene kant, en een
	draadinterface aanbieden aan de andere kant.</p><p>In FreeBSD is het RFCOMM-protocol in de laag van de
	Bluetooth-stopcontacten geïmplementeerd.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89542096"></a>31.4.6. Het paren van apparaten</h3></div></div></div><a id="idp89542736" class="indexterm"></a><p>Standaard is Bluetooth-communicatie niet geauthenticeerd en
	kan elk apparaat met elk ander apparaat praten.  Een
	Bluetooth-apparaat (bijvoorbeeld een mobiele telefoon) kan
	ervoor kiezen dat voor bepaalde diensten authenticatie nodig is
	(bijvoorbeeld voor de inbeldienst).  Bluetooth-authenticatie
	geschied normaalgesproken met <span class="emphasis"><em>PIN-codes</em></span>.
	Een PIN-code is een ACII-reeks van maximaal 16 tekens lang.  De
	gebruiker dient dezelfde PIN-code op beide apparaten in te
	voeren.  Nadat de gebruiker de PIN-code heeft ingevoerd, zullen
	beide apparaten een <span class="emphasis"><em>verbindingssleutel</em></span>
	aanmaken.  Hierna kan de verbindingssleutel òfwel in de
	apparaten zelf, òfwel in een permanente opslag  worden
	opgeslagen.  De volgende keer zullen beide apparaten de van
	tevoren aangemaakte verbindingssleutel gebruiken.  Bovenstaande
	procedure wordt <span class="emphasis"><em>paren</em></span> genoemd.  Merk op dat
	indien een apparaat de verbindingssleutel verliest, het paren
	moet worden herhaald.</p><p>De daemon <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a> is verantwoordelijk voor het
	behandelen van alle verzoeken voor Bluetooth-authenticatie.  Het
	standaard instellingenbestand is
	<code class="filename">/etc/bluetooth/hcsecd.conf</code>.  Een
	voorbeeldsectie voor een mobiele telefoon waarvan de PIN-code
	willekeurig op <span class="quote">&#8220;<span class="quote">1234</span>&#8221;</span> is hieronder
	beschreven:</p><pre class="programlisting">device {
	bgaddr	00:80:37:29:19:a4;
	name	"Pav's T39";
	key	nokey;
	pin	"1234";
      }</pre><p>Er is geen limiet voor PIN-codes (behalve de lengte).  Voor
	sommige apparaten (bijvoorbeeld Bluetooth-headsets) kan de
	PIN-code vast zijn ingebouwd.  De schakelaar <code class="option">-d</code>
	dwingt de daemon <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hcsecd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">hcsecd</span>(8)</span></a> om op de voorgrond te blijven,
	zodat het gemakkelijk is om te zien wat er gebeurt.  Stel het
	andere apparaat in om paarverzoeken te ontvangen en initialiseer
	de Bluetooth-verbinding naar het andere apparaat.  Het apparaat
	moet zeggen dat het paarverzoek geaccepteerd is en om de
	PIN-code vragen.  Geef dezelfde PIN-code op als in
	<code class="filename">hcsecd.conf</code>.  Nu zijn de PC en het andere
	apparaat gepaard.  Als alternatief kan paren op het andere
	apparaat worden geïnitialiseerd.</p><p>De volgende regel kan aan
	het bestand <code class="filename">/etc/rc.conf</code> worden toegevoegd
	om <span class="application">hcsecd</span> automatisch met het
	systeem op te starten:</p><pre class="programlisting">hcsecd_enable="YES"</pre><p>Het volgende is een voorbeeld van de uitvoer van de daemon
	<span class="application">hcsecd</span>:</p><pre class="programlisting">hcsecd[16484]: Got Link_Key_Request event from 'ubt0hci', remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name 'Pav's T39', link key doesn't exist
hcsecd[16484]: Sending Link_Key_Negative_Reply to 'ubt0hci' for remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Got PIN_Code_Request event from 'ubt0hci', remote bdaddr 0:80:37:29:19:a4
hcsecd[16484]: Found matching entry, remote bdaddr 0:80:37:29:19:a4, name 'Pav's T39', PIN code exists
hcsecd[16484]: Sending PIN_Code_Reply to 'ubt0hci' for remote bdaddr 0:80:37:29:19:a4</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89560144"></a>31.4.7. Service Discovery Protocol (SDP)</h3></div></div></div><a id="idp89560784" class="indexterm"></a><p>Het Service Discovery Protocol (SDP) biedt voor
	cliënttoepassingen de mogelijkheid om diensten te ontdekken
	die door servertoepassingen worden aangeboden alsook de
	kenmerken van deze diensten.  De kenmerken van een dienst
	omvatten de soort of klasse van de aangeboden dienst en de
	informatie over het mechanisme of protocol dat nodig is om de
	dienst te gebruiken.</p><p>SDP omvat communicatie tussen een SDP-server en een
	SDP-cliënt.  De server houdt een lijst van
	dienstenregistraties bij die de eigenschappen van de diensten
	beschrijven die met de server geassocieerd zijn.  Elke
	dienstregistratie bevat informatie over een enkele dienst.  Een
	cliënt kan informatie over een dienstregistratie opvragen
	die door de SDP-server wordt bijgehouden door een SDP-verzoek in
	te dienen.  Indien de cliënt, of een toepassing die met de
	cliënt geassocieerd is, besluit om de dienst te gebruiken,
	moet het een aparte verbinding naar de aanbieder van de dienst
	openen om de dienst te gebruiken.  SDP biedt een mechanisme om
	diensten en hun attributen te ontdekken, maar het biedt geen
	mechanisme om die diensten te gebruiken.</p><p>Normaalgesproken zoekt een SDP-cliënt naar diensten
	naar aanleiding van enkele gewenste eigenschappen van die
	diensten.  Soms is het echter wenselijk om te ontdekken welke
	soorten diensten door de dienstregistraties van een SDP-server
	worden beschreven zonder enige voorkennis van deze diensten.
	Dit kijken naar alle aangeboden diensten wordt
	<span class="emphasis"><em>browsen</em></span> genoemd.</p><p>De Bluetooth SDP-server <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> en de
	opdrachtregelcliënt <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sdpcontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sdpcontrol</span>(8)</span></a> zitten in de
	standaard FreeBSD-installatie.  Het volgende voorbeeld laat zien
	hoe een SDP-browse query uit te voeren.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sdpcontrol -a 00:01:03:fc:6e:ec browse</code></strong>
Record Handle: 00000000
Service Class ID List:
        Service Discovery Server (0x1000)
Protocol Descriptor List:
        L2CAP (0x0100)
                Protocol specific parameter #1: u/int/uuid16 1
                Protocol specific parameter #2: u/int/uuid16 1

Record Handle: 0x00000001
Service Class ID List:
        Browse Group Descriptor (0x1001)

Record Handle: 0x00000002
Service Class ID List:
        LAN Access Using PPP (0x1102)
Protocol Descriptor List:
        L2CAP (0x0100)
        RFCOMM (0x0003)
                Protocol specific parameter #1: u/int8/bool 1
Bluetooth Profile Descriptor List:
        LAN Access Using PPP (0x1102) ver. 1.0</pre><p>... enzovoorts.  Merk op dat elke dienst een lijst met
	attributen heeft (bijvoorbeeld een RFCOMM-kanaal).  Afhankelijk
	van de dienst kan het nodig zijn om een aantekening van sommige
	attributen te maken.  Sommige Bluetooth-implementaties
	ondersteunen dienst-browsen niet en zullen een lege lijst
	teruggeven.  In dit geval is het mogelijk om naar de specifieke
	dienst te zoeken.  Het onderstaande voorbeeld laat zien hoe naar
	de dienst OBEX Object Push (OPUSH) gezocht kan worden:</p><pre class="screen"><code class="prompt">%</code>  <strong class="userinput"><code>sdpcontrol -a 00:01:03:fc:6e:ec search OPUSH</code></strong></pre><p>Het aanbieden van diensten op FreeBSD aan
	Bluetooth-cliënten wordt gedaan met de server <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a>.
	De volgende regel kan aan het
	bestand <code class="filename">/etc/rc.conf</code> worden
	toegevoegd:</p><pre class="programlisting">sdpd_enable="YES"</pre><p>Het daemon <span class="application">sdpd</span> kan worden
	gestart met:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service sdpd start</code></strong></pre><p>De plaatselijke servertoepassing die Bluetooth-diensten wil
	aanbieden aan verre cliënten zal de dienst registreren bij
	de plaatselijke SDP-daemon.  Een voorbeeld van zo'n toepassing
	is <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a>.  Nadat het gestart is zal het de
	Bluetooth LAN-dienst bij de plaatselijke SDP-daemon
	registreren.</p><p>De lijst met diensten die bij de plaatselijke SDP-server
	zijn geregistreerd kan worden opgevraagd door te SDP-browsen
	via het plaatselijke controlekanaal:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sdpcontrol -l browse</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89577680"></a>31.4.8. Dial-Up Networking (DUN) en netwerktoegang met PPP (LAN)
	profielen</h3></div></div></div><p>Het inbelnetwerk (DUN) profiel wordt het meeste gebruikt met
	modems en mobiele telefoons.  De volgende scenario's worden in
	dit profiel behandeld:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>het gebruik van een mobiele telefoon of modem door een
	    computer als een draadloze modem voor het verbinden met een
	    inbelserver voor Internet-toegang, of voor andere
	    inbeldiensten;</p></li><li class="listitem"><p>het gebruik van een mobiele telefoon of modem door een
	    computer om gegevensoproepen te ontvangen.</p></li></ul></div><p>Het profiel voor netwerktoegang met PPP (LAN) kan in de
	volgende situaties gebruikt worden:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>LAN-toegang voor een enkel Bluetooth-apparaat;</p></li><li class="listitem"><p>LAN-toegang voor meerdere Bluetooth-apparaten;</p></li><li class="listitem"><p>PC naar PC (door PPP-netwerken over een seriële
	    kabel te emuleren).</p></li></ul></div><p>Op FreeBSD zijn beide profielen geïmplementeerd met
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> en <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> - een wrapper die een RFCOMM
	Bluetooth-verbinding omzet in iets waar PPP mee overweg kan.
	Voordat een profiel gebruikt kan worden, dient een nieuw
	PPP-label in het bestand <code class="filename">/etc/ppp/ppp.conf</code>
	te worden aangemaakt.  Raadpleeg de hulppagina
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> voor voorbeelden.</p><p>In het volgende voorbeeld zal <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> gebruikt
	worden om RFCOMM-verbinding met een ver apparaat met BD_ADDR
	00:80:37:29:19:a4 op een DUN RFCOMM-kanaal te maken.  Het
	eigenlijke RFCOMM-kanaalnummer wordt via SDP van het verre
	apparaat verkregen.  Het is mogelijk om het RFCOMM-kanaal
	handmatig op te geven, en in dat geval zal <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a>
	het SDP-verzoek niet uitvoeren.  Gebruik <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sdpcontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sdpcontrol</span>(8)</span></a> om
	het RFCOMM-kanaal op het verre apparaat te achterhalen.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rfcomm_pppd -a 00:80:37:29:19:a4 -c -C dun -l rfcomm-dialup</code></strong></pre><p>Om netwerktoegang met PPP (LAN) aan te bieden moet de server
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> draaien.  Er dient een nieuwe regel voor
	LAN-cliënten in het bestand
	<code class="filename">/etc/ppp/ppp.conf</code> aangemaakt te worden.
	Raadpleeg de hulppagina <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_pppd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rfcomm_pppd</span>(8)</span></a> voor voorbeelden.
	Tenslotte dient de RFCOMM PPP-server op een geldig RFCOMM-kanaal
	gestart te worden.  De RFCOMM PPP-server zal automatisch de
	Bluetooth LAN-dienst bij de plaatselijke SDP-daemon registreren.
	Het volgende voorbeeld laat zien hoe een RFCOMM PPP-server te
	starten:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rfcomm_pppd -s -C 7 -l rfcomm-server</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89598032"></a>31.4.9. Het OBEX Object Push (OPUSH) profiel</h3></div></div></div><a id="idp89598672" class="indexterm"></a><p>OBEX is een veelgebruikt protocol voor eenvoudige
	bestandsoverdrachten tussen mobiele apparaten.  Het primaire
	gebruik is infraroodcommunicatie, waar het wordt gebruikt voor
	generieke bestandsoverdrachten tussen notebooks of PDA's, en
	om visitekaarten en kalenderregels tussen mobiele telefoons en
	andere apparaten met PIM-toepassingen over te dragen.</p><p>De OBEX-server en clieënt zijn geïmplenteerd als
	een pakket van derde partij, <span class="application">obexapp</span>,
	dat beschikbaar is als de port
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/comms/obexapp/pkg-descr">comms/obexapp</a>.</p><p>De OBEX-cliënt wordt gebruikt om objecten naar en/of
	van de OBEX-server te duwen/trekken.  Een object kan
	bijvoorbeeld een visitekaart of een afspraak zijn.  De
	OBEX-cliënt kan het RFCOMM-kanaalnummer van het verre
	apparaat via SDP opvragen.  Dit kan gedaan worden door de
	dienstnaam in plaats van het RFCOMM-kanaalnummer op te geven.
	De ondersteunde dienstnamen zijn: IrMC, FTRN, en OPUSH.  Het is
	mogelijk om het RFCOMM-kanaal als een nummer op te geven.  Het
	onderstaande is een voorbeeld van een OBEX-sessie, waar een
	apparaatinformatie-object van de mobiele telefoon wordt
	getrokken, en een nieuw object (een visitekaart) in de gids van
	de telefoon wordt geduwd:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>obexapp -a 00:80:37:29:19:a4 -C IrMC</code></strong>
obex&gt; get telecom/devinfo.txt devinfo-t39.txt
Success, response: OK, Success (0x20)
obex&gt; put new.vcf
Success, response: OK, Success (0x20)
obex&gt; di
Success, response: OK, Success (0x20)</pre><p>Om de dienst OBEX Object Push aan te bieden, moet de server
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sdpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sdpd</span>(8)</span></a> draaien.  Er moet een hoofdmap worden aangemaakt
	waarin alle binnenkomende objecten worden opgeslagen.  Het
	standaardpad naar de hoofdmap is <code class="filename">/var/spool/obex</code>.  Tenslotte moet de
	OBEX-server op een geldig RFCOMM-kanaal worden gestart.  De
	OBEX-server zal automatisch de dienst OBEX Object Push bij de
	plaatselijke SDP-daemon registeren.  Het onderstaande voorbeeld
	laat zien hoe de OBEX-server gestart wordt:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>obexapp -s -C 10</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89674448"></a>31.4.10. Serial Port Profile (SPP)</h3></div></div></div><p>Het Seriële Poort Profiel (SPP) zorgt ervoor dat
	Bluetooth-apparaten RS232 (of gelijkwaardige) seriële
	kabels kunnen emuleren.  Het scenario dat dit profiel behandelt
	zorgt ervoor dat oude toepassingen Bluetooth kunnen gebruiken
	als vervanging van kabels, door gebruik te maken van een
	virtuele seriële poort.</p><p>Het programma <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_sppd&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rfcomm_sppd</span>(1)</span></a> implementeert het
	Seriële Poort profiel.  Een pseudo-tty wordt gebruikt als
	abstractie voor een virtuele seriële poort.  Onderstaand
	voorbeeld laat zien hoe met een Seriële Poortdienst voor
	verre apparaten te verbinden.  Merk op dat het niet nodig is om
	een RFCOMM-kanaal te kiezen - <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rfcomm_sppd&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rfcomm_sppd</span>(1)</span></a> kan het via
	SDP van het verre apparaat verkrijgen.  Dit kan worden overruled
	door een RFCOMM-kanaal op de opdrachtregel te specificeren.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rfcomm_sppd -a 00:07:E0:00:0B:CA -t /dev/ttyp6</code></strong>
rfcomm_sppd[94692]: Starting on /dev/ttyp6...</pre><p>Als er een verbinding is, kan de pseudo-tty als seriële
	poort worden gebruikt:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cu -l ttyp6</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89679824"></a>31.4.11. Problemen oplossen</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89680464"></a>31.4.11.1. Een apparaat op afstand kan geen verbinding maken</h4></div></div></div><p>Sommige oudere Bluetooth-apparaten ondersteunen het
	  wisselen van rol niet.  Standaard probeert FreeBSD, wanneer het
	  een nieuwe verbinding accepteert, een rolwisseling uit te
	  voeren en meester te worden.  Apparaten die dit niet
	  ondersteunen zullen niet kunnen verbinden.  Merk op dat van
	  rol wordt gewisseld wanneer een nieuwe verbinding wordt
	  gemaakt, dus het is niet mogelijk om het verre apparaat te
	  vragen of het rolwisseling ondersteunt.  Er is een HCI-optie
	  om rolwisselen aan de plaatselijke kant uit te zetten:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>hccontrol -n ubt0hci write_node_role_switch 0</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89682640"></a>31.4.11.2. Er gaat iets mis, kan ik precies zien wat er gebeurt?</h4></div></div></div><p>Ja, dit is mogelijk.  Gebruik het pakket
	  <span class="application">hcidump</span>, dat beschikbaar is als de
	  port <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/comms/hcidump/pkg-descr">comms/hcidump</a>.  Het
	  gereedschap <span class="application">hcidump</span> is
	  vergelijkbaar met <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a>.  Het kan gebruikt worden om
	  de inhoud van Bluetooth-pakketten op de terminal te laten zien
	  en om de Bluetooth-pakketten naar een bestand te schrijven.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-wireless.html">Terug</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Omhoog</a></td><td width="40%" align="right"> <a accesskey="n" href="network-bridging.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">31.3. Draadloze netwerken </td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top"> 31.5. Bridging</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>