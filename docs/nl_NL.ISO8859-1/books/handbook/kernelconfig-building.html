<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>9.5. Bouwen en installeren van een aangepaste kernel</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD handboek" /><link rel="up" href="kernelconfig.html" title="Hoofdstuk 9. De FreeBSD-kernel instellen" /><link rel="prev" href="kernelconfig-modules.html" title="9.4. Kernel stuurprogramma's, subsystemen, en modules" /><link rel="next" href="kernelconfig-config.html" title="9.6. Het instellingenbestand" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">9.5. Bouwen en installeren van een aangepaste kernel</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kernelconfig-modules.html">Terug</a> </td><th width="60%" align="center">Hoofdstuk 9. De FreeBSD-kernel instellen</th><td width="20%" align="right"> <a accesskey="n" href="kernelconfig-config.html">Volgende</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-building"></a>9.5. Bouwen en installeren van een aangepaste kernel</h2></div></div></div><a id="idp72046160" class="indexterm"></a><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Het is noodzakelijk om de volledige broncode van FreeBSD
	geïnstalleerd te hebben om de kernel te bouwen.</p></div><p>Eerst wordt er een overzicht gegeven van de mappen waarin de
      kernel gebouwd wordt.  Alle genoemde mappen staan onder de map
      <code class="filename">/usr/src/sys</code>, die ook toegankelijk is via
      de padnaam <code class="filename">/sys</code>.  Er zijn hier een aantal
      mappen aanwezig die de verschillende delen van de kernel
      representeren, maar de meest belangrijke hiervan zijn
      <code class="filename">arch/conf</code>, waarin
      de kernelinstellingen bewerkt worden en
      <code class="filename">compile</code>, waarin de aangepaste kernel gebouwd
      wordt.  <em class="replaceable"><code>arch</code></em> representeert hier
      één van <code class="filename">i386</code>,
      <code class="filename">amd64</code>,
      <code class="filename">ia64</code>, <code class="filename">powerpc</code>,
      <code class="filename">sparc64</code> of <code class="filename">pc98</code> (een
      alternatieve ontwikkelingstak van PC-hardware die populair is in
      Japan).  Alles binnen de map van een bepaalde architectuur is er
      alleen voor die architectuur.  De rest van de code is
      machine-onafhankelijk en hetzelfde op alle platformen waarnaar
      FreeBSD eventueel overgezet kan worden.  De indeling van de
      mapstructuur is logisch: alle ondersteunde apparaten,
      bestandssystemen en opties staan in een eigen submap.</p><p>Dit voorbeelden in dit hoofdstuk veronderstellen dat de
      i386-architectuur gebruikt wordt.  Als dit voor de lezer anders is,
      moeten de bijhorende aanpassingen aan de padnamen worden gemaakt.</p><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Als de map <code class="filename">/usr/src/</code>
	<span class="emphasis"><em>niet</em></span> aanwezig is op een systeem (of als het leeg
	is), dan is de broncode niet geïnstalleerd.  De eenvoudigste
	manier om de volledige broncode te installeren is <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=csup&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">csup</span>(1)</span></a> te
	gebruiken zoals beschreven in <a class="xref" href="synching.html" title="24.6. Broncode synchroniseren">Paragraaf 24.6, &#8220;Broncode synchroniseren&#8221;</a>.  U dient
	tevens een symbolische link naar <code class="filename">/usr/src/sys/</code>
	aan te maken:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ln -s /usr/src/sys /sys</code></strong></pre></div><p>Daarna kan vanuit de map
      <code class="filename">arch/conf</code> het
      instellingenbestand <code class="filename">GENERIC</code> naar de naam
      voor de aangepaste kernel gekopieerd worden.  Bijvoorbeeld:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/i386/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC MIJNKERNEL</code></strong></pre><p>Traditioneel bestaat deze naam geheel uit hoofdletters en als
      er meerdere FreeBSD-machines worden beheerd met verschillende
      hardware is het een goed idee om het te vernoemen naar de
      hostnaam van de machine.  Omwille van dit voorbeeld wordt het
      <code class="filename">MIJNKERNEL</code>
      genoemd.</p><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Het kernelinstellingenbestand direct onder
	<code class="filename">/usr/src</code> opslaan kan een slecht idee zijn.
	In geval van problemen kan het verleidelijk zijn om
	<code class="filename">/usr/src</code> te verwijderen en opnieuw te
	beginnen.  Nadat dit gedaan is kost het vaak maar enkele
	seconden om te realiseren dat het instellingenbestand voor de
	aangepaste kernel verwijderd is.  Ook moet
	<code class="filename">GENERIC</code> niet gewijzigd worden, omdat het
	tijdens de volgende keer dat de <a class="link" href="updating-upgrading.html" title="Hoofdstuk 24. FreeBSD updaten en upgraden"> broncodeboom bijgewerkt
	  wordt</a>, overschreven kan worden waarbij de wijzigingen
	in de kernelinstellingen verloren gaan.</p><p xmlns="http://www.w3.org/1999/xhtml">Het kan gewenst zijn om het kernelinstellingenbestand
	ergens anders op te slaan en een symbolische link naar het
	bestand in de map
	<code class="filename">i386</code> aan te
	maken:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/i386/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /root/kernels</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC /root/kernels/MIJNKERNEL</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /root/kernels/MIJNKERNEL</code></strong></pre></div><p>Nu moet
      <code class="filename">MIJNKERNEL</code> met de
      favoriete tekstverwerker bewerkt worden.  Voor beginners is
      waarschijnlijk alleen de tekstverwerker
      <span class="application">vi</span> beschikbaar, die te ingewikkeld is
      om hier te beschrijven, maar goed is beschreven in vele boeken in
      de <a class="link" href="bibliography.html" title="Bijlage B. Bibliografie">bibliografie</a>.  FreeBSD biedt
      ook de eenvoudigere tekstverwerker <span class="application">ee</span>,
      die voor een beginner de keuze bij uitstek is.  De
      commentaarregels in het begin kunnen gewijzigd worden om de
      persoonlijke instellingen of de veranderingen die gemaakt zijn ten
      opzichte van <code class="filename">GENERIC</code> weer te geven.</p><a id="idp72078288" class="indexterm"></a><p>Voor degenen die een kernel op <span class="trademark">SunOS</span>&#8482; of een andere BSD
      hebben gebouwd zal veel van dit bestand bekend voorkomen.
      Echter, voor degenen die van een ander besturingssysteem zoals
      DOS komen, kan het instellingenbestand
      <code class="filename">GENERIC</code> overdonderend overkomen, dus moeten
      de beschrijvingen in de sectie <a class="link" href="kernelconfig-config.html" title="9.6. Het instellingenbestand">Het Instellingenbestand</a>
      zorgvuldig opgevolgd worden.</p><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Als de <a class="link" href="updating-upgrading.html" title="Hoofdstuk 24. FreeBSD updaten en upgraden">broncodeboom
	  gesynchroniseerd</a> is met de nieuwste broncode van het
	FreeBSD-project, moet altijd
	<code class="filename">/usr/src/UPDATING</code> gelezen worden voordat
	enige bijwerkstappen worden genomen.  Dit bestand beschrijft
	alle belangrijke zaken en gebieden binnen de broncodestructuur
	die speciale aandacht nodig hebben.
	<code class="filename">/usr/src/UPDATING</code> komt altijd overeen met
	de lokale versie van de FreeBSD-broncode en is daarom meer
	bijgewerkt met nieuwe informatie dan dit handboek.</p></div><p>Nu moet de broncode voor de kernel gecompileerd worden.</p><div class="procedure"><a id="idp72083024"></a><div class="procedure-title">Procedure 9.1. Een kernel bouwen</div><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Het is noodzakelijk om de volledige broncode van FreeBSD
	  geïnstalleerd te hebben om te kernel te bouwen.</p></div><ol class="procedure" type="1"><li class="step"><p>Ga naar de map <code class="filename">/usr/src</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong></pre></li><li class="step"><p>Compileer de kernel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make buildkernel KERNCONF=MIJNKERNEL</code></strong></pre></li><li class="step"><p>Installeer de nieuwe kernel:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>make installkernel KERNCONF=MIJNKERNEL</code></strong></pre></li></ol></div><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Bij het bouwen van een aangepaste kernel worden standaard
	<span class="emphasis"><em>alle</em></span> kernelmodules ook herbouwd.  Om de
	kernel sneller bij te werken en alleen de aangepaste modules
	te bouwen kan <code class="filename">/etc/make.conf</code> aangepast
	worden voordat de kernel wordt gebouwd:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">MODULES_OVERRIDE = linux acpi sound/sound sound/driver/ds1 ntfs</pre><p xmlns="http://www.w3.org/1999/xhtml">Met deze variabele wordt een lijst van te bouwen modules
	ingesteld die gebouwd moeten worden in plaats van allen.</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">WITHOUT_MODULES = linux acpi sound ntfs</pre><p xmlns="http://www.w3.org/1999/xhtml">Deze variabele stelt een lijst in van modules op het topniveau
	die moeten worden uitgesloten van het bouwproces.  Andere variabelen
	die mogelijk ook nuttig zijn in het proces van het bouwen van een
	kernel staan beschreven in de handleiding voor
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">make.conf</span>(5)</span></a>.</p></div><a id="idp72114768" class="indexterm"></a><p>De nieuwe kernel wordt naar de map <code class="filename">/boot/kernel</code> gekopieerd als
      <code class="filename">/boot/kernel/kernel</code> en de oude kernel wordt
      verplaatst naar <code class="filename">/boot/kernel.old/kernel</code>.  Nu
      moet het systeem afgesloten worden en opnieuw worden opgestart om
      gebruik te maken van de nieuwe kernel.  Er zijn wat instructies
      voor <a class="link" href="kernelconfig-trouble.html" title="9.7. Problemen oplossen">problemen
	oplossen</a> aan het einde van dit hoofdstuk, die erg nuttig
      kunnen zijn als er iets misgaat.  Vergeet niet om het gedeelte te
      lezen waarin staat uitgelegd hoe te herstellen als de nieuwe
      kernel <a class="link" href="kernelconfig-trouble.html#kernelconfig-noboot">niet
	opstart</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Andere bestanden die te maken hebben met het opstartproces,
	zoals de boot <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> en instellingen worden opgeslagen
	in <code class="filename">/boot</code>.  Modules van derde partijen of
	eigen modules kunnen in <code class="filename">/boot/kernel</code> opgeslagen worden,
	alhoewel gebruikers erop bedacht moeten zijn dat het erg
	belangrijk is dat de modules synchroon worden gehouden met de
	gecompileerde kernel.  Modules die niet bedoeld zijn om met de
	gecompileerde kernel te draaien kunnen voor instabiliteit of
	onjuistheden zorgen.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kernelconfig-modules.html">Terug</a> </td><td width="20%" align="center"><a accesskey="u" href="kernelconfig.html">Omhoog</a></td><td width="40%" align="right"> <a accesskey="n" href="kernelconfig-config.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">9.4. Kernel stuurprogramma's, subsystemen, en modules </td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top"> 9.6. Het instellingenbestand</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>