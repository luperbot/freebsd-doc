<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>11.7. Gevorderde onderwerpen</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD handboek" /><link rel="up" href="linuxemu.html" title="Hoofdstuk 11. Linux® binaire compatibiliteit" /><link rel="prev" href="linuxemu-oracle.html" title="11.6. Oracle® installeren" /><link rel="next" href="system-administration.html" title="Deel III. Systeembeheer" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">11.7. Gevorderde onderwerpen</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="linuxemu-oracle.html">Terug</a> </td><th width="60%" align="center">Hoofdstuk 11. <span class="trademark">Linux</span>® binaire compatibiliteit</th><td width="20%" align="right"> <a accesskey="n" href="system-administration.html">Volgende</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-advanced"></a>11.7. Gevorderde onderwerpen</h2></div></div></div><p>Hier wordt beschreven hoe de <span class="trademark">Linux</span>® binaire compatibiliteit
      werkt.  Het meeste van wat nu volgt is sterk gebaseerd op een
      e-mailbericht van Terry Lambert
      <code class="email">&lt;<a xmlns="" class="email" href="mailto:tlambert@primenet.com">tlambert@primenet.com</a>&gt;</code> aan <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat" target="_top">FreeBSD babbel mailinglijst</a> (Message ID:
      <code class="literal">&lt;199906020108.SAA07001@usr09.primenet.com&gt;</code>).</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74596944"></a>11.7.1. Hoe werkt het?</h3></div></div></div><a id="idp74597584" class="indexterm"></a><p>FreeBSD heeft een abstractie met de naam <span class="quote">&#8220;<span class="quote">execution
	  class loader</span>&#8221;</span>.  Dit is een wig in de systeemaanroep
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a>.</p><p>Wat er gebeurt is dat FreeBSD een lijst van loaders heeft, in
	plaats van een enkele loader die terugvalt op de
	<code class="literal">#!</code> loader voor het draaien van elke
	shellinterpreter of shellscript.</p><p>Vroeger onderzocht de enige loader op het <span class="trademark">UNIX</span>® platform
	het magische getal (in het algemeen de eerste 4 of 8 bytes van
	het bestand) om te zien of het een binary was die het systeem
	kende en als dat het geval was laadde het de binaire
	loader.</p><p>Als het niet het binaire type voor het systeem was, faalde
	de aanroep naar <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> en probeerde de shell het als
	shellopdrachten uit te voeren.</p><p>Deze aanname was een standaard voor <span class="quote">&#8220;<span class="quote">wat de huidige
	  shell ook is.</span>&#8221;</span></p><p>Later werd er een hack gemaakt voor <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> om de eerste
	twee tekens te onderzoeken en als die bestonden uit
	<code class="literal">:\n</code> voerde het in plaats hiervan de
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a> shell uit (het idee is dat SCO de hack als eerste
	maakte).</p><p>Wat FreeBSD nu doet is door een lijst van loaders gaan
	met een generieke <code class="literal">#!</code> loader die kennis heeft
	van interpreters in de zin van de karakters die volgen op de
	volgende witruimte tot de laatste, met uiteindelijk een
	terugval op <code class="filename">/bin/sh</code>.</p><a id="idp74610896" class="indexterm"></a><p>Voor <span class="trademark">Linux</span>® ABI-ondersteuning ziet FreeBSD het magische getal
	als een ELF-binary (het maakt op dit punt geen onderscheid
	tussen FreeBSD, <span class="trademark">Solaris</span>&#8482;, <span class="trademark">Linux</span>® of elk ander besturingssysteem
	dat een ELF-beeldtype heeft).</p><a id="idp74613200" class="indexterm"></a><p>De ELF loader zoekt naar een gespecialiseerd
	<span class="emphasis"><em>merk</em></span>, dat een commentaargedeelte in het
	ELF-beeld is en dat niet aanwezig is in SVR4/<span class="trademark">Solaris</span>&#8482;
	ELF-binairen.</p><p>Om <span class="trademark">Linux</span>®-binairen werkend te krijgen, moeten ze
	<span class="emphasis"><em>gemerkt</em></span> worden als het type
	<code class="literal">Linux</code> met <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>brandelf -t Linux bestand</code></strong></pre><p>Als dit gedaan is, ziet de ELF loader het
	<code class="literal">Linux</code>-merk in het bestand.</p><a id="idp74623312" class="indexterm"></a><p>Als de ELF loader het <code class="literal">Linux</code>-merk
	tegenkomt, verplaatst de loader een pointer in de
	<code class="literal">proc</code>-structuur.  Alle systeemaanroepen
	worden met deze pointer geïndexeerd (in een traditioneel
	<span class="trademark">UNIX</span>® systeem is dit de
	<code class="literal">sysent[]</code>-structuurarray, die de
	systeemaanroepen bevat).  Ook wordt het proces gemerkt voor
	speciale behandeling door de valstrikvector van de
	signaal-trampolinecode samen met nog meer (kleine) aanpassingen
	die door de <span class="trademark">Linux</span>® kernelmodule worden afgehandeld.</p><p>De <span class="trademark">Linux</span>® kernelmodule bevat naast andere dingen een lijst
	van <code class="literal">sysent[]</code>-ingangen waarvan de adressen
	in de kernelmodule staan.</p><p>Als een systeemaanroep door de <span class="trademark">Linux</span>®-binary wordt
	aangeroepen, verwijdert de valstrikcode de referentie aan de
	functiepointer van de systeemaanroep en geeft die de
	ingangspunten van de systeemaanroep van <span class="trademark">Linux</span>® en niet van
	FreeBSD.</p><p>Verder <span class="emphasis"><em>reroot</em></span> de <span class="trademark">Linux</span>®-modus
	dynamisch lookups.  Dit is wat de optie <code class="option">union</code>
	(<span class="emphasis"><em>niet</em></span> het <code class="literal">unionfs</code>
	bestandssysteemtype!) voor het aankoppelen van bestandssystemen
	effectief doet.  Eerst wordt een poging gedaan om het bestand
	in de map
	<code class="filename">/compat/linux/origineel-pad</code>
	op te zoeken en <span class="emphasis"><em>vervolgens</em></span> alleen als dat
	mislukt, wordt het bestand in
	<code class="filename">/origineel-pad</code>
	opgezocht.  Dit zorgt ervoor dat binairen die andere binairen
	nodig hebben kunnen draaien (zo kan bijvoorbeeld de
	<span class="trademark">Linux</span>®-gereedschapskist geheel onder <span class="trademark">Linux</span>® ABI-ondersteuning
	draaien).  Dit betekent ook dat <span class="trademark">Linux</span>®-binairen FreeBSD-binairen
	kunnen laden en draaien als er geen overeenkomende
	<span class="trademark">Linux</span>®-binairen zijn en dat er een <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=uname&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">uname</span>(1)</span></a>-opdracht in
	de mappenstructuur <code class="filename">/compat/linux</code> gezet kan
	worden om er zeker van te zijn dat <span class="trademark">Linux</span>®-binairen niet kunnen
	weten dat ze niet op <span class="trademark">Linux</span>® draaien.</p><p>Effectief bevindt er zich een <span class="trademark">Linux</span>®-kernel in de
	FreeBSD-kernel.  De verschillende onderliggende functies die alle
	functies implementeren die de kernel aanbiedt, zijn dezelfde
	tabelingangen voor de systeemaanroepen van FreeBSD als van
	<span class="trademark">Linux</span>®: bestandssysteembewerkingen, bewerkingen op het
	virtuële geheugen, signaalaflevering, System V IPC,
	enzovoort.  Het enige verschil is dat FreeBSD-binairen de
	<span class="emphasis"><em>lijm</em></span> functies voor FreeBSD krijgen en dat de
	<span class="trademark">Linux</span>®-binairen de <span class="emphasis"><em>lijm</em></span>-functies voor
	<span class="trademark">Linux</span>® krijgen (de meeste oudere besturingssystemen hadden
	alleen hun eigen <span class="emphasis"><em>lijm</em></span>-functies: adressen
	van functies die in een statische globale
	<code class="literal">sysent[]</code> structuurarray werden opgeslagen,
	in plaats van adressen van functies waarvan dynamisch een
	geïnitialiseerde pointer wordt verwijderd in de
	<code class="literal">proc</code>-structuur van het proces dat de aanroep
	doet).</p><p>Welke is de eigenlijke FreeBSD ABI?  Dat maakt niet uit.
	Eigenlijk is het enige verschil dat (op dit moment; dit kan
	eenvoudig veranderen in een toekomstige uitgave, en dat gebeurt
	waarschijnlijk na deze uitgave) de
	<span class="emphasis"><em>lijm</em></span>-functies van FreeBSD statisch gelinkt
	zijn in de kernel en dat de <span class="emphasis"><em>lijm</em></span>-functies
	van <span class="trademark">Linux</span>® zowel statisch gelinkt kunnen worden als dat ze
	door een kernelmodule worden benaderd.</p><p>Maar is dit nu echt emulatie?  Nee.  Het is een
	ABI-implementatie, geen emulatie.  Er is geen emulator (of
	simulator, om de volgende vraag voor te zijn) bij
	betrokken.</p><p>Dus waarom wordt het dan soms
	<span class="quote">&#8220;<span class="quote"><span class="trademark">Linux</span>®-emulatie</span>&#8221;</span> genoemd?  Om het moeilijk te
	maken om FreeBSD te verkopen!  Serieus, het is zo omdat de
	historische implementatie in een tijd werd gedaan toen er echt
	geen ander woord was om te beschrijven wat er aan de hand was,
	om te zeggen dat FreeBSD <span class="trademark">Linux</span>®-binairen draaide was niet waar
	als de code niet in de kernel gecompileerd werd of als een
	module geladen werd en er moest een woord zijn voor hetgeen
	geladen werd.  Vandaar <span class="quote">&#8220;<span class="quote">de <span class="trademark">Linux</span>®-emulator</span>&#8221;</span>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="linuxemu-oracle.html">Terug</a> </td><td width="20%" align="center"><a accesskey="u" href="linuxemu.html">Omhoog</a></td><td width="40%" align="right"> <a accesskey="n" href="system-administration.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">11.6. <span class="trademark">Oracle</span>® installeren </td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top"> Deel III. Systeembeheer</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>