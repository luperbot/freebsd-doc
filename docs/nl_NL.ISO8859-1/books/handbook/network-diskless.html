<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>31.7. Schijfloos werken</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD handboek" /><link rel="up" href="advanced-networking.html" title="Hoofdstuk 31. Geavanceerde netwerken" /><link rel="prev" href="network-aggregation.html" title="31.6. Verbindingsaggregatie en failover" /><link rel="next" href="network-pxe-nfs.html" title="31.8. Met PXE en een NFS-root-bestandssysteem opstarten" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.7. Schijfloos werken</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-aggregation.html">Terug</a> </td><th width="60%" align="center">Hoofdstuk 31. Geavanceerde netwerken</th><td width="20%" align="right"> <a accesskey="n" href="network-pxe-nfs.html">Volgende</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-diskless"></a>31.7. Schijfloos werken</h2></div><div><span class="authorgroup">Bijgewerkt door <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Jean-François</span> <span class="surname">Dockès</span></span>. </span></div><div><span class="authorgroup">Gereorganiseerd en uitgebreid door <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Alex</span> <span class="surname">Dupre</span></span>. </span></div></div></div><a id="idp90000080" class="indexterm"></a><a id="idp90000592" class="indexterm"></a><p>Een FreeBSD-machine kan over het netwerk opstarten en zonder een
      plaatselijke schijf werken, door gebruik te maken van
      bestandssystemen die van een <acronym class="acronym">NFS</acronym>-server
      aangekoppeld worden.  Er zijn geen systeemwijzigingen nodig anders
      dan de standaard instellingenbestanden.  Dit soort systemen is
      relatief eenvoudig op te zetten omdat alle noodzakelijke elementen
      al aanwezig zijn:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Er zijn minstens twee manieren om de kernel over het
	  netwerk te laden:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><acronym class="acronym">PXE</acronym>: De <span class="trademark">Intel</span>® Preboot eXecution
	      Environment is een vorm een smart boot ROM dat in sommige
	      netwerkkaarten en moederborden is ingebouwd.  Bekijk de
	      hulppagina <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a> voor meer informatie.</p></li><li class="listitem"><p>De poort <span class="application">Etherboot</span>
	      (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/etherboot/pkg-descr">net/etherboot</a>) maakt
	      code aan dat naar een ROM geschreven kan worden en dat
	      kernels over het netwerk opstart.  De code kan
	      òfwel naar een opstart-PROM op een netwerkkaart
	      geflashed worden, òfwel van een floppy (of harde)
	      schijf geladen worden, òfwel van een draaiend
	      <span class="trademark">MS-DOS</span>® systeem geladen worden.  Vele netwerkkaarten
	      worden ondersteund.</p></li></ul></div></li><li class="listitem"><p>Een voorbeeldscript
	  (<code class="filename">/usr/share/examples/diskless/clone_root</code>)
	  vergemakkelijkt het aanmaken en beheren van het root
	  bestandssysteem van het werkstation op de server.  Het kan
	  nodig zijn dat het script wat aangepast moet worden, maar het
	  zorgt voor een snelle start.</p></li><li class="listitem"><p>Er bestaan standaardbestanden voor het opstarten van het systeem
	  in <code class="filename">/etc</code> om een systeemstart
	  zonder schijf te detecteren en te ondersteunen.</p></li><li class="listitem"><p>Het gebruik van een wisselbestand, indien nodig, kan
	  worden gedaan naar òfwel een <acronym class="acronym">NFS</acronym>
	  bestand òfwel naar een plaatselijke schijf.</p></li></ul></div><p>Er zijn vele manieren om een schijfloos werkstation op te
      zetten.  Hierbij zijn veel elementen betrokken, en vele kunnen aan
      de eigen smaak worden aangepast.  Het volgende beschrijft
      variaties met betrekking tot het installeren van een compleet
      systeem, waarbij de nadruk ligt op de eenvoud en de
      compatibiliteit met de standaard opstartscripts van FreeBSD.  Het
      beschreven systeem heeft de volgende eigenschappen:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>De schijfloze werkstations gebruiken een gedeeld bestandssysteem
	  voor <code class="filename">/</code>, dat alleen
	  gelezen kan worden, en een gedeeld bestandssysteem voor <code class="filename">/usr</code>, dat eveneens alleen gelezen kan
	  worden.</p><p>Het root-bestandssysteem is een kopie van een standaard
	  root-bestandssysteem voor FreeBSD (typisch van een server),
	  waarbij enkele instellingenbestanden zijn overschreven door
	  versies die specifiek zijn voor een schijfloos systeem of,
	  mogelijk, door het werkstation horen waar ze bij horen.</p><p>De delen van het root-bestandssysteem die beschrijfbaar
	  moeten zijn, zijn overdekt met <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a> bestandssystemen.
	  Alle veranderingen gaan verloren indien het systeem opnieuw
	  wordt opgestart.</p></li><li class="listitem"><p>De kernel is overgedragen en òfwel met
	  <span class="application">Etherboot</span> òfwel met
	  <acronym class="acronym">PXE</acronym> geladen, aangezien sommige situaties
	  het gebruik van één van de methodes kan eisen.</p></li></ul></div><div xmlns="" class="caution"><h3 class="admontitle">Let op: </h3><p xmlns="http://www.w3.org/1999/xhtml">Het systeem zoals hierboven beschreven is onveilig.  Het
	dient in een beschermd gebied van een netwerk te functioneren, en
	niet vertrouwd te worden door andere hosts.</p></div><p>Alle informatie in deze sectie is getest met
      FreeBSD 5.2.1-RELEASE.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90022096"></a>31.7.1. Achtergrondinformatie</h3></div></div></div><p>Het installeren van schijfloze werkstations is zowel vrij
	rechttoe-rechtaan als foutgevoelig.  Deze fouten zijn soms
	moeilijk vast te stellen wegens een aantal redenen.
	Bijvoorbeeld:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Opties die tijdens het compileren zijn opgegeven kunnen
	    verschillend gedrag tonen tijdens het draaien.</p></li><li class="listitem"><p>Foutmeldingen zijn vaak cryptisch of geheel afwezig.</p></li></ul></div><p>Op dit gebied is het bezit van wat achtergrondkennis over de
	gebruikte mechanismen zeer nuttig om mogelijke problemen op te
	lossen.</p><p>Voor een succesvol opstarten dienen verschillende
	handelingen uitgevoerd te worden:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>De machine moet een aantal initiële parameters
	    zoals het IP-adres, de bestandsnaam van de executable, de
	    naam van de server, en het root-pad verkrijgen.  Dit wordt
	    gedaan door gebruik te maken van de <acronym class="acronym">DHCP</acronym>
	    of BOOTP protocollen.  <acronym class="acronym">DHCP</acronym> is een
	    compatible uitbreiding van BOOTP, het gebruikt dezelfde
	    poorten en het pakketformaat heeft dezelfde basis.</p><p>Het is mogelijk om een systeem in te stellen zodat het
	    alleen BOOTP gebruikt.  Het serverprogramma <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bootpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bootpd</span>(8)</span></a>
	    wordt met het basissysteem van FreeBSD meegeleverd.</p><p><acronym class="acronym">DHCP</acronym> biedt echter een aantal
	    voordelen boven BOOTP (fijnere instellingenbestanden,
	    mogelijkheid om <acronym class="acronym">PXE</acronym> te gebruiken, en vele
	    anderen die niet direct verband houden met schijfloos
	    werken), er zal hoofdzakelijk een opstelling met
	    <acronym class="acronym">DHCP</acronym> worden beschreven, met analoge
	    voorbeelden voor <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bootpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bootpd</span>(8)</span></a> indien mogelijk.  De
	    voorbeeldopstelling zal het softwarepakket van
	    <span class="application">ISC DHCP</span> gebruiken (versie
	    3.0.1.r12 was geïnstalleerd op de testserver).</p></li><li class="listitem"><p>De machine moet één of meerdere
	    programma's naar het plaatselijke geheugen versturen.
	    Eén van <acronym class="acronym">TFTP</acronym> of
	    <acronym class="acronym">NFS</acronym> wordt gebruikt.  De keuze tussen
	    <acronym class="acronym">TFTP</acronym> en <acronym class="acronym">NFS</acronym> is op
	    verschillende plaatsen een optie tijdens het compileren.
	    Een veelgemaakte fout is het opgeven van bestandsnamen voor
	    het verkeerde protocol: <acronym class="acronym">TFTP</acronym> verstuurd
	    typisch alle bestanden vanuit één map op de
	    server, en verwacht dat alle bestandsnamen relatief aan
	    deze map zijn; <acronym class="acronym">NFS</acronym> verwacht absolute
	    bestandspaden.</p></li><li class="listitem"><p>De mogelijke tussentijdse opstartprogramma's en de
	    kernel dienen geïnitialiseerd en uitgevoerd te worden.
	    Er zijn enkele belangrijke variaties op dit gebied:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><acronym class="acronym">PXE</acronym> zal <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a> laden,
		wat een aangepaste versie is van de lader voor stage
		drie van FreeBSD.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> zal de meeste parameters
		verkrijgen die noodzakelijk zijn om het systeem op te
		starten, en zal ze in de kernelomgeving laten staan
		voordat het de controle overdraagt.  Het is in dit geval
		mogelijk om een <code class="filename">GENERIC</code> kernel te
		gebruiken.</p></li><li class="listitem"><p><span class="application">Etherboot</span> zal met minder
		voorbereiding direct de kernel laden.  Hiervoor is het
		noodzakelijk om een kernel met specifieke opties te
		bouwen.</p></li></ul></div><p><acronym class="acronym">PXE</acronym> en
	    <span class="application">Etherboot</span> werken beide even goed;
	    echter, omdat kernels normaalgesproken meer werk overlaten
	    aan <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>, is <acronym class="acronym">PXE</acronym> de te
	    verkiezen methode.</p><p>Indien het <acronym class="acronym">BIOS</acronym> en de netwerkkaarten
	    <acronym class="acronym">PXE</acronym> ondersteunen, dient dat
	    waarschijnlijk gebruikt te worden.</p></li><li class="listitem"><p>Tenslotte: de machine heeft toegang tot de
	    bestandssystemen nodig.  <acronym class="acronym">NFS</acronym> wordt in
	    alle gevallen gebruikt.</p></li></ul></div><p>Zie ook de hulppagina <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diskless&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">diskless</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90066384"></a>31.7.2. Installatie-instructies</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90067024"></a>31.7.2.1. Instellen met behulp van
	  <span class="application">ISC DHCP</span></h4></div></div></div><a id="idp90068048" class="indexterm"></a><p>De <span class="application">ISC DHCP</span> server kan zowel
	  verzoeken voor BOOTP als <acronym class="acronym">DHCP</acronym>
	  beantwoorden.</p><p><span class="application">ISC DHCP 4.2</span> maakt geen deel
	  uit van het basissysteem.  Eerst dient de poort <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/isc-dhcp42-server/pkg-descr">net/isc-dhcp42-server</a> of het
	  corresponderende pakket geïnstalleerd te worden.</p><p>Wanneer <span class="application">ISC DHCP</span> is
	  geïnstalleerd, heeft het een instellingenbestand nodig om
	  te draaien (normaliter
	  <code class="filename">/usr/local/etc/dhcpd.conf</code> genoemd).
	  Hieronder volgt een voorbeeld met commentaar, waarbij host
	  <code class="systemitem">margaux</code> gebruik maakt van
	  <span class="application">Etherboot</span> en
	  <code class="systemitem">corbieres</code> gebruik maakt van
	  <acronym class="acronym">PXE</acronym>:</p><pre class="programlisting">default-lease-time 600;
max-lease-time 7200;
authoritative;

option domain-name "example.com";
option domain-name-servers 192.168.4.1;
option routers 192.168.4.1;

subnet 192.168.4.0 netmask 255.255.255.0 {
  use-host-decl-names on; <a id="co-dhcp-host-name"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
  option subnet-mask 255.255.255.0;
  option broadcast-address 192.168.4.255;

  host margaux {
    hardware ethernet 01:23:45:67:89:ab;
    fixed-address margaux.example.com;
    next-server 192.168.4.4; <a id="co-dhcp-next-server"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
    filename "/data/misc/kernel.diskless"; <a id="co-dhcp-filename"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
    option root-path "192.168.4.4:/data/misc/diskless"; <a id="co-dhcp-root-path"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span>
  }
  host corbieres {
    hardware ethernet 00:02:b3:27:62:df;
    fixed-address corbieres.example.com;
    next-server 192.168.4.4;
    filename "pxeboot";
    option root-path "192.168.4.4:/data/misc/diskless";
  }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-dhcp-host-name"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Deze optie vertelt <span class="application">dhcpd</span>
	      om de waarde die in de verklaringen voor
	      <code class="literal">host</code> staan te versturen als de hostnaam
	      voor de schijfloze host.  Een andere mogelijkheid is om
	      <code class="literal">option
		host-name margaux</code>
	      binnen de verklaringen voor <code class="literal">host</code> op te
	      nemen.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-dhcp-next-server"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>De aanwijzing <code class="literal">next-server</code> bepaalt
	      de <acronym class="acronym">TFTP</acronym> of <acronym class="acronym">NFS</acronym>
	      server die gebruikt moet worden voor het laden van het
	      lader- of kernelbestand (standaard wordt dezelfde host als
	      voor de <acronym class="acronym">DHCP</acronym>-server gebruikt).</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-dhcp-filename"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>De aanwijzing <code class="literal">filename</code> bepaalt het
	      bestand dat <span class="application">Etherboot</span> of
	      <acronym class="acronym">PXE</acronym> gebruikt voor de volgende
	      uitvoerstap.  Het dient gespecificeerd te worden volgens
	      de gebruikte verzendmethode.  Voor
	      <span class="application">Etherboot</span> kan tijdens het
	      compileren worden opgegeven of het <acronym class="acronym">NFS</acronym>
	      of <acronym class="acronym">TFTP</acronym> moet gebruiken.  De FreeBSD-poort
	      stelt standaard <acronym class="acronym">NFS</acronym> in.
	      <acronym class="acronym">PXE</acronym> gebruikt <acronym class="acronym">TFTP</acronym>,
	      vandaar dat hier een relatieve bestandsnaam wordt gebruikt
	      (dit kan afhangen van de instellingen van de
	      <acronym class="acronym">TFTP</acronym>-server, maar het is de gewoonte).
	      Verder geldt dat <acronym class="acronym">PXE</acronym>
	      <code class="filename">pxeboot</code> en niet de kernel laadt.  Er
	      zijn andere interessante mogelijkheden, zoals het laden
	      van <code class="filename">pxeboot</code> vanuit de map <code class="filename">/boot</code> van een FreeBSD CD-ROM
	      (aangezien <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a> de <code class="filename">GENERIC</code>
	      kernel kan laden, bestaat de mogelijkheid om
	      <acronym class="acronym">PXE</acronym> te gebruiken om van een CDROM op
	      afstand op te starten.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-dhcp-root-path"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>De optie <code class="literal">root-path</code> definieert het
	      pad naar het root-bestandssysteem, in de gebruikelijke
	      notatie van <acronym class="acronym">NFS</acronym>.  Indien
	      <acronym class="acronym">PXE</acronym> gebruikt wordt, is het mogelijk om
	      het IP-adres van de host weg te laten zolang de
	      kerneloptie BOOTP niet geactiveerd is.  De
	      <acronym class="acronym">NFS</acronym>-server is dan dezelfde als die van
	      <acronym class="acronym">TFTP</acronym>.</p></td></tr></table></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90117200"></a>31.7.2.2. Configuratie door gebruik van BOOTP</h4></div></div></div><a id="idp90117840" class="indexterm"></a><p>Hieronder staan de equivalente instellingen voor
	  <span class="application">bootpd</span> (gereduceerd tot
	  één cliënt).  Dit staat in
	  <code class="filename">/etc/bootptab</code>.</p><p>Merk op dat <span class="application">Etherboot</span>
	  gecompileerd dient te worden met de afwijkende optie
	  <code class="literal">NO_DHCP_SUPPORT</code> om BOOTP te gebruiken, en
	  dat <acronym class="acronym">PXE</acronym> <acronym class="acronym">DHCP</acronym>
	  <span class="emphasis"><em>nodig heeft</em></span>.  Het enige duidelijke
	  voordeel van <span class="application">bootpd</span> is dat het in
	  het basissysteem zit.</p><pre class="programlisting">.def100:\
  :hn:ht=1:sa=192.168.4.4:vm=rfc1048:\
  :sm=255.255.255.0:\
  :ds=192.168.4.1:\
  :gw=192.168.4.1:\
  :hd="/tftpboot":\
  :bf="/kernel.diskless":\
  :rp="192.168.4.4:/data/misc/diskless":

margaux:ha=0123456789ab:tc=.def100</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90123344"></a>31.7.2.3. Een opstartprogramma voorbereiden met
	  <span class="application">Etherboot</span></h4></div></div></div><a id="idp90124240" class="indexterm"></a><p>De <a class="link" href="http://etherboot.sourceforge.net" target="_top">website
	    van Etherboot</a> bevat <a class="link" href="http://etherboot.sourceforge.net/doc/html/userman/t1.html" target="_top">
	    uitgebreide documentatie</a> die over het algemeen is
	  bedoeld voor Linux-systemen, maar die desalniettemin bruikbare
	  informatie bevat.  Het volgende geeft een samenvatting over
	  hoe <span class="application">Etherboot</span> op een FreeBSD-systeem
	  te gebruiken.</p><p>Ten eerste dient het pakket of de poort <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/etherboot/pkg-descr">net/etherboot</a> geïnstalleerd
	  te worden.</p><p>De instellingen van <span class="application">Etherboot</span>
	  (i.e., om <acronym class="acronym">TFTP</acronym> in plaats van
	  <acronym class="acronym">NFS</acronym> te gebruiken) kunnen gewijzigd worden
	  door het bestand <code class="filename">Config</code> in de bronmap van
	  <span class="application">Etherboot</span> te bewerken.</p><p>Hieronder zal een opstartdiskette gebruikt worden.
	  Raadpleeg voor andere methoden (PROM, of een
	  <span class="trademark">MS-DOS</span>®-programma) de documentatie van
	  <span class="application">Etherboot</span>.</p><p>Om een opstartdiskette te maken, dient er een diskette in
	  het diskettestation van de machine aanwezig te zijn waarop
	  <span class="application">Etherboot</span> is geïnstalleerd, daarna dient
	  er naar de map <code class="filename">src</code> in de
	  mapboom van <span class="application">Etherboot</span> gegaan te
	  worden, en het volgende ingetypt te worden:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gmake bin32/apparaatsoort.fd0</code></strong></pre><p><em class="replaceable"><code>apparaatsoort</code></em> hangt af van het
	  soort Ethernetkaart dat in het schijfloze werkstation
	  aanwezig is.  Raadpleeg het bestand <code class="filename">NIC</code>
	  in dezelfde map om het juiste
	  <em class="replaceable"><code>apparaatsoort</code></em> te bepalen.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90135376"></a>31.7.2.4. Opstarten met <acronym class="acronym">PXE</acronym></h4></div></div></div><p>Standaard laadt de lader <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a> de kernel via
	  <acronym class="acronym">NFS</acronym>.  Het kan zodanig gecompileerd worden
	  dat het <acronym class="acronym">TFTP</acronym> gebruikt door de optie
	  <code class="literal">LOADER_TFTP_SUPPORT</code> in
	  <code class="filename">/etc/make.conf</code> te specificeren.
	  Raadpleeg het commentaar in
	  <code class="filename">/usr/share/examples/etc/make.conf</code>
	  voor instructies.</p><p>Er zijn nog twee andere opties voor
	  <code class="filename">make.conf</code> die nuttig kunnen zijn bij het
	  opzetten van een schijfloze machine die als seriële
	  console gebruikt wordt:
	  <code class="literal">BOOT_PXELDR_PROBE_KEYBOARD</code>, en
	  <code class="literal">BOOT_PXELDR_ALWAYS_SERIAL</code>.</p><p>Om <acronym class="acronym">PXE</acronym> bij het opstarten van de machine
	  te gebruiken, is het gewoonlijk nodig om de optie
	  <code class="literal">Boot from network</code> in het
	  <acronym class="acronym">BIOS</acronym> te selecteren, of om een functietoets
	  tijdens de initialisatie van de PC in te typen.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90150864"></a>31.7.2.5. De <acronym class="acronym">TFTP</acronym> en <acronym class="acronym">NFS</acronym>
	  servers instellen</h4></div></div></div><a id="idp90152272" class="indexterm"></a><a id="idp90153424" class="indexterm"></a><p>Indien <acronym class="acronym">PXE</acronym> of
	  <acronym class="acronym">Etherboot</acronym> gebruikt wordt, welke is
	  ingesteld om <acronym class="acronym">TFTP</acronym> te gebruiken, is het
	  nodig om <span class="application">tftpd</span> op de
	  bestandsserver aan te zetten:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Maak een map aan van waaruit <span class="application">tftpd</span>
	      de bestanden serveert, bijvoorbeeld <code class="filename">/tftpboot</code>.</p></li><li class="step"><p>Voeg deze regel toe aan
	      <code class="filename">/etc/inetd.conf</code>:</p><pre class="programlisting">tftp	dgram	udp	wait	root	/usr/libexec/tftpd	tftpd -l -s /tftpboot</pre><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Het schijnt dat sommige versies van
		<acronym class="acronym">PXE</acronym> de <acronym class="acronym">TCP</acronym>-versie
		van <acronym class="acronym">TFTP</acronym> vereisen.  In dit geval
		dient een tweede regel toegevoegd te worden, waarbij
		<code class="literal">dgram udp</code> door
		<code class="literal">stream tcp</code> vervangen wordt.</p></div></li><li class="step"><p><span class="application">inetd</span> dient de
	      instellingenbestanden opnieuw te lezen.  De regel
	      <code class="option">inetd_enable="YES"</code> dient in het bestand
	      <code class="filename">/etc/rc.conf</code> aanwezig te zijn voor de
	      juiste werking van deze opdracht:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service inetd restart</code></strong></pre></li></ol></div><p>De map <code class="filename">tftpboot</code> kan overal
	  op de server geplaatst worden.  De plaats dient zowel in
	  <code class="filename">inetd.conf</code> als in
	  <code class="filename">dhcpd.conf</code> ingesteld te worden.</p><p>In alle gevallen dient er ook voor gezorgd te worden dat
	  <acronym class="acronym">NFS</acronym> aanstaat en dat het juiste
	  bestandssysteem op de <acronym class="acronym">NFS</acronym>-server
	  geëxporteerd wordt.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Voeg het volgende toe aan
	      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">nfs_server_enable="YES"</pre></li><li class="step"><p>Exporteer het bestandssysteem waar de schijfloze
	      root-map zich bevindt door het volgende aan
	      <code class="filename">/etc/exports</code> toe te voegen (pas het
	      aankoppelpunt van het volume aan en vervang
	      <em class="replaceable"><code>margaux corbieres</code></em> door de namen
	      van de schijfloze werkstations):</p><pre class="programlisting"><em class="replaceable"><code>/data/misc</code></em> -alldirs -ro <em class="replaceable"><code>margaux corbieres</code></em></pre></li><li class="step"><p><span class="application">mountd</span> dient het
	      instellingenbestand opnieuw te lezen.  Indien het nodig
	      was om <acronym class="acronym">NFS</acronym> in
	      <code class="filename">/etc/rc.conf</code>
	      tijdens de eerste stap aan te zetten, is het
	      waarschijnlijk gewenst om in plaats hiervan opnieuw op te
	      starten.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service mountd restart</code></strong></pre></li></ol></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90179664"></a>31.7.2.6. Een schijfloze kernel bouwen</h4></div></div></div><a id="idp90180304" class="indexterm"></a><p>Indien <span class="application">Etherboot</span> gebruikt wordt,
	  is het nodig om een kernelinstellingenbestand voor de
	  schijfloze cliënt met de volgende opties (naast de
	  gebruikelijke) aan te maken:</p><pre class="programlisting">options	BOOTP		# Gebruik BOOTP om het IP-adres en de hostnaam te verkrijgen
options	BOOTP_NFSROOT	# NFS-mount het root-bestandssysteem door gebruik te maken van de informatie van BOOTP</pre><p>Het kan ook gewenst zijn om <code class="literal">BOOTP_NFSV3</code>,
	  <code class="literal">BOOT_COMPAT</code>, en
	  <code class="literal">BOOTP_WIRED_TO</code> te gebruiken (raadpleeg
	  hiervoor <code class="filename">NOTES</code>).</p><p>De namen van deze opties zijn historisch en enigszins
	  misleidend aangezien ze eigenlijk onverschillig gebruik van
	  <acronym class="acronym">DHCP</acronym> en BOOTP in de kernel mogelijk maken
	  (het is ook mogelijk om strikt gebruik van BOOTP of
	  <acronym class="acronym">DHCP</acronym> te forceren).</p><p>De kernel dient gebouwd te worden (zie <a class="xref" href="kernelconfig.html" title="Hoofdstuk 9. De FreeBSD-kernel instellen">Hoofdstuk 9, <em>De FreeBSD-kernel instellen</em></a>) en gekopieerd te worden naar de
	  plaats die in <code class="filename">dhcpd.conf</code> is
	  aangegeven.</p><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Indien <acronym class="acronym">PXE</acronym> gebruikt wordt, is het
	    bouwen van een kernel met bovenstaande opties niet strikt
	    noodzakelijk (maar wel aangeraden).  Door deze opties aan te
	    zetten zullen er meer verzoeken voor <acronym class="acronym">DHCP</acronym>
	    tijdens het opstarten van de kernel verstuurd worden, met in
	    sommige speciale gevallen een klein risico op inconsistentie
	    tussen de nieuwe waarden en degenen die door <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pxeboot&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pxeboot</span>(8)</span></a>
	    zijn ontvangen.  Het voordeel van het gebruik van deze
	    opties is dat de hostnaam als een bijverschijnsel wordt
	    ingesteld.  In de andere gevallen dient de hostnaam op een
	    andere manier ingesteld te worden, bijvoorbeeld in een
	    cliënt-specifiek bestand
	    <code class="filename">rc.conf</code>.</p></div><div xmlns="" class="note"><h3 class="admontitle">Opmerking: </h3><p xmlns="http://www.w3.org/1999/xhtml">Om laadbaar te zijn met
	    <span class="application">Etherboot</span>, dienen de
	    apparaataanwijzingen in de kernel gecompileerd te worden.
	    Normaalgesproken wordt hiervoor de volgende optie in het
	    instellingenbestand gebruikt (zie het
	    instellingencommentaarbestand
	    <code class="filename">NOTES</code>):</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">hints		"GENERIC.hints"</pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90191824"></a>31.7.2.7. Het root-bestandssysteem voorbereiden</h4></div></div></div><a id="idp90192464" class="indexterm"></a><p>Er dient een root-bestandssysteem voor de schijfloze
	  werkstations op de plaats die als <code class="literal">root-path</code>
	  in <code class="filename">dhcpd.conf</code> staat aangegeven aangemaakt
	  te worden.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90207184"></a>31.7.2.7.1. <code class="command">make world</code> gebruiken om het
	    root-bestandssysteem te bevolken</h5></div></div></div><p>Deze methode is snel en installeert een compleet
	    maagdelijk systeem (niet alleen het root-bestandssysteem) in
	    <code class="envar">DESTDIR</code>.  Hiervoor dient slechts het volgende
	    script uitgevoerd te worden:</p><pre class="programlisting">#!/bin/sh
export DESTDIR=/data/misc/diskless
mkdir -p ${DESTDIR}
cd /usr/src; make buildworld &amp;&amp; make buildkernel
make installworld &amp;&amp; make installkernel
cd /usr/src/etc; make distribution</pre><p>Nadat dit gedaan is, kunnen
	    <code class="filename">/etc/rc.conf</code> en
	    <code class="filename">/etc/fstab</code> die in
	    <code class="envar">DESTDIR</code> geplaatst zijn naar behoefte worden
	    aangepast.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90211152"></a>31.7.2.8. Swapruimte instellen</h4></div></div></div><p>Indien nodig kan een wisselbestand dat zich op de server
	  bevindt via <acronym class="acronym">NFS</acronym> worden benaderd.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90212560"></a>31.7.2.8.1. Swapruimte via <acronym class="acronym">NFS</acronym></h5></div></div></div><p>De kernel biedt geen ondersteuning om swapruimte via
	    <acronym class="acronym">NFS</acronym> tijdens het opstarten aan te zetten.
	    De swapruimte moet door de opstartscripts worden aangezet,
	    door een beschrijfbaar bestandssysteem aan te koppelen en
	    een wisselbestand aan te maken en aan te zetten.  De
	    volgende opdracht maakt een wisselbestand van de juiste
	    grootte aan:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/pad/naar/wisselbestand bs=1k count=1 oseek=100000</code></strong></pre><p>Om het aan te zetten dient de volgende regel aan
	    <code class="filename">/etc/rc.conf</code> te worden
	    toegevoegd:</p><pre class="programlisting">swapfile=<em class="replaceable"><code>/pad/naar/wisselbestand</code></em></pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90216912"></a>31.7.2.9. Diverse problemen</h4></div></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90217552"></a>31.7.2.9.1. Draaien met een alleen-lezen
	    <code class="filename">/usr</code></h5></div></div></div><a id="idp90218448" class="indexterm"></a><p>Indien het schijfloze werkstation is ingesteld om X te
	    draaien, is het nodig om het instellingenbestand van
	    <span class="application">XDM</span> te wijzigen, dat standaard
	    het foutenlogboek in <code class="filename">/usr</code>
	    plaatst.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90221008"></a>31.7.2.9.2. Gebruik maken van een niet-FreeBSD-server</h5></div></div></div><p>Indien de server voor het root-bestandssysteem geen FreeBSD
	    draait, is het nodig om het root-bestandssysteem op een
	    FreeBSD-machine aan te maken, en het daarna naar de bestemming
	    te kopiëren, door gebruik te maken van
	    <code class="command">tar</code> of <code class="command">cpio</code>.</p><p>In deze situatie zijn er af en toe problemen met de
	    speciale bestanden in <code class="filename">/dev</code>,
	    vanwege verschillen in de groottes van grote/kleine integers.  Een
	    oplossing voor dit probleem is om een map van de
	    niet-FreeBSD-server te exporteren, deze map op een FreeBSD-machine
	    aan te koppelen, en <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a> te gebruiken om de
	    apparaatknooppunten transparant voor de gebruiker toe te
	    wijzen.</p></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-aggregation.html">Terug</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Omhoog</a></td><td width="40%" align="right"> <a accesskey="n" href="network-pxe-nfs.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">31.6. Verbindingsaggregatie en failover </td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top"> 31.8. Met PXE en een NFS-root-bestandssysteem opstarten</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>