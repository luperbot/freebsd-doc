<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>Chapter 14. PPP</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Frequently Asked Questions for FreeBSD 8.X, 9.X and 10.X" /><link rel="up" href="index.html" title="Frequently Asked Questions for FreeBSD 8.X, 9.X and 10.X" /><link rel="prev" href="security.html" title="Chapter 13. Security" /><link rel="next" href="serial.html" title="Chapter 15. Serial Communications" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 14. PPP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="security.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="serial.html">Next</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ppp"></a>Chapter 14. PPP</h1></div></div></div><div class="qandaset"><a id="idp68700496"></a><dl><dt>14.1. <a href="ppp.html#idp68700752">I cannot make ppp(8) work.  What am I doing
	    wrong?</a></dt><dt>14.2. <a href="ppp.html#idp68712912">Why does ppp(8) hang when I run it?</a></dt><dt>14.3. <a href="ppp.html#idp68719440">Why will ppp(8) not dial in
	    -auto mode?</a></dt><dt>14.4. <a href="ppp.html#idp68726736">What does No route to host
	    mean?</a></dt><dt>14.5. <a href="ppp.html#idp68740304">Why does my connection drop after about 3
	    minutes?</a></dt><dt>14.6. <a href="ppp.html#idp68747216">Why does my connection drop under heavy load?</a></dt><dt>14.7. <a href="ppp.html#idp68751696">Why does my connection drop after a random amount of
	    time?</a></dt><dt>14.8. <a href="ppp.html#idp68754128">Why does my connection hang after a random amount of
	    time?</a></dt><dt>14.9. <a href="ppp.html#idp68769744">The remote end is not responding.  What can I
	    do?</a></dt><dt>14.10. <a href="ppp.html#idp68781520">ppp(8) has hung.  What can I do?</a></dt><dt>14.11. <a href="ppp.html#idp68794192">I keep seeing errors about magic being the same.  What
	    does it mean?</a></dt><dt>14.12. <a href="ppp.html#idp68818896">LCP negotiations continue until the connection is
	    closed.  What is wrong?</a></dt><dt>14.13. <a href="ppp.html#idp68879056">Why does ppp(8) lock up when I shell out to test
	    it?</a></dt><dt>14.14. <a href="ppp.html#idp68886096">Why does ppp(8) over a null-modem cable never
	    exit?</a></dt><dt>14.15. <a href="ppp.html#idp68898768">Why does ppp(8) dial for no reason in
	    -auto mode?</a></dt><dt>14.16. <a href="ppp.html#idp68914512">What do these CCP errors mean?</a></dt><dt>14.17. <a href="ppp.html#idp68918608">Why does ppp(8) not log my connection
	    speed?</a></dt><dt>14.18. <a href="ppp.html#idp68934352">Why does ppp(8) ignore the \
	    character in my chat script?</a></dt><dt>14.19. <a href="ppp.html#idp68943824">What are FCS errors?</a></dt><dt>14.20. <a href="ppp.html#idp68956240">None of this helps &#8212; I am desperate!  What can I
	    do?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp68700752"></a><a id="userppp"></a><p><strong>14.1.</strong></p></td><td align="left" valign="top"><p>I cannot make <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> work.  What am I doing
	    wrong?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>First, read <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> and
	    the <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/ppp-and-slip.html#userppp" target="_top">PPP
	      section of the Handbook</a>.  To assist in
	    troubleshooting, enable logging with the
	    following command:</p><pre class="programlisting">set log Phase Chat Connect Carrier lcp ipcp ccp command</pre><p>This command may be typed at the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> command
	    prompt or it may be entered at the start of the
	    <code class="literal">default</code> section
	    in <code class="filename">/etc/ppp/ppp.conf</code>.  Make sure that
	    <code class="filename">/etc/syslog.conf</code> contains the lines below and the file
	    <code class="filename">/var/log/ppp.log</code> exists:</p><pre class="programlisting">!ppp
*.*        /var/log/ppp.log</pre><p>A lot about what is going can be learned from
	    the log file.  Do not worry if it does not all make sense as
	    it may make sense to someone else.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68712912"></a><a id="ppp-hangs"></a><p><strong>14.2.</strong></p></td><td align="left" valign="top"><p>Why does <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> hang when I run it?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>This is usually because the hostname will not
	    resolve.  The best way to fix this is to make sure that
	    <code class="filename">/etc/hosts</code> is read first by the
	    by ensuring that the <code class="literal">hosts</code> line is listed first in
	    <code class="filename">/etc/host.conf</code>.  Then, put an
	    entry in <code class="filename">/etc/hosts</code> for the local
	    machine.  If there is no local network, change the
	    <code class="systemitem">localhost</code> line:</p><pre class="programlisting">127.0.0.1        foo.example.com foo localhost</pre><p>Otherwise, add another entry for the host.
	    Consult the relevant manual pages for more details.</p><p>When finished, verify that this command is successful:
	    <code class="command">ping -c1 `hostname`</code>.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68719440"></a><a id="ppp-nodial-auto"></a><p><strong>14.3.</strong></p></td><td align="left" valign="top"><p>Why will <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> not dial in
	    <code class="literal">-auto</code> mode?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>First, check that a default route exists. This command
	    should display two entries:</p><pre class="programlisting">Destination        Gateway            Flags     Refs     Use     Netif Expire
default            10.0.0.2           UGSc        0        0      tun0
10.0.0.2           10.0.0.1           UH          0        0      tun0</pre><p>If
	    a default route is not listed, make sure that the
	    <code class="literal">HISADDR</code> line has been added to
	    <code class="filename">/etc/ppp/ppp.conf</code>.</p><p>Another reason for the default route line being
	    missing is that a default
	    route has been added to <code class="filename">/etc/rc.conf</code>
	    and this line is missing
	    from <code class="filename">/etc/ppp/ppp.conf</code>:</p><pre class="programlisting">delete ALL</pre><p>If this is the case, go back to the <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/userppp.html#userppp-final" target="_top">Final
	      System Configuration</a> section of the
	    Handbook.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68726736"></a><a id="no-route-to-host"></a><p><strong>14.4.</strong></p></td><td align="left" valign="top"><p>What does <span class="errorname">No route to host</span>
	    mean?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>This error is usually because the following section
	    is missing in
	    <code class="filename">/etc/ppp/ppp.linkup</code>:</p><pre class="programlisting">MYADDR:
  delete ALL
  add 0 0 HISADDR</pre><p>This is only necessary for a dynamic IP
	    address or when the address of the default gateway is unknown.  When
	    using interactive mode, the following can be typed in
	    after entering packet mode.  Packet mode
	    is indicated by the capitalized <acronym class="acronym">PPP</acronym> in
	    the prompt:</p><pre class="programlisting">delete ALL
add 0 0 HISADDR</pre><p>Refer to the <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/userppp.html#userppp-dynamicip" target="_top">PPP
	      and Dynamic IP addresses</a> section of the Handbook
	    for further details.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68740304"></a><a id="connection-threeminutedrop"></a><p><strong>14.5.</strong></p></td><td align="left" valign="top"><p>Why does my connection drop after about 3
	    minutes?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>The default PPP timeout is 3 minutes.  This can be
	    adjusted with the following line:</p><pre class="programlisting">set timeout <em class="replaceable"><code>NNN</code></em></pre><p>where <em class="replaceable"><code>NNN</code></em> is the number of
	    seconds of inactivity before the connection is closed.  If
	    <em class="replaceable"><code>NNN</code></em> is zero, the connection is
	    never closed due to a timeout.  It is possible to put this
	    command in <code class="filename">ppp.conf</code>, or to type it at
	    the prompt in interactive mode.  It is also possible to
	    adjust it on the fly while the line is active by
	    connecting to <span class="application">ppp</span>'s server
	    socket using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnet&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">telnet</span>(1)</span></a> or <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pppctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pppctl</span>(8)</span></a>.  Refer to
	    the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> man page for further details.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68747216"></a><a id="ppp-drop-heavy-load"></a><p><strong>14.6.</strong></p></td><td align="left" valign="top"><p>Why does my connection drop under heavy load?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If Link Quality Reporting (<acronym class="acronym">LQR</acronym>) is configured,
	    it is possible that too many <acronym class="acronym">LQR</acronym> packets are lost between
	    the FreeBSD system and the peer.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> deduces that the
	    line must therefore be bad, and disconnects.  <acronym class="acronym">LQR</acronym> is
	    disabled by default and can be enabled with the following
	    line:</p><pre class="programlisting">enable lqr</pre></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68751696"></a><a id="ppp-drop-random"></a><p><strong>14.7.</strong></p></td><td align="left" valign="top"><p>Why does my connection drop after a random amount of
	    time?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Sometimes, on a noisy phone line or even on a line
	    with call waiting enabled, the modem may hang up because
	    it incorrectly thinks that it lost carrier.</p><p>There is a setting on most modems for determining how
	    tolerant it should be to temporary losses of carrier.
	    Refer to the modem manual for details.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68754128"></a><a id="ppp-hangs-random"></a><p><strong>14.8.</strong></p></td><td align="left" valign="top"><p>Why does my connection hang after a random amount of
	    time?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Many people experience hung connections with no
	    apparent explanation.  The first thing to establish is
	    which side of the link is hung.</p><p>When using an external modem, try
	    using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> to see if the <acronym class="acronym">TD</acronym>
	    light is flashing when data is transmitted.  If it flashes
	    but the <acronym class="acronym">RD</acronym> light does not, the
	    problem is with the remote end.  If <acronym class="acronym">TD</acronym>
	    does not flash, the problem is local.  With an internal
	    modem, use the <code class="literal">set
	      server</code> command in
	    <code class="filename">ppp.conf</code>.  When the hang occurs,
	    connect to <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pppctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pppctl</span>(8)</span></a>.  If the
	    network connection suddenly revives due
	    to the activity on the diagnostic socket, or if it will not
	    connect but the <code class="literal">set socket</code>
	    command succeeded at startup time, the problem is local.
	    If it can connect but things are still hung, enable local
	    logging with <code class="literal">set log local async</code>
	    and use <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> from another window or terminal to
	    make use of the link.  The async logging will show the
	    data being transmitted and received on the link.  If data
	    is going out and not coming back, the problem is
	    remote.</p><p>Having established whether the problem is local or
	    remote, there are now two possibilities:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If the problem is remote, read on entry <a class="xref" href="ppp.html#ppp-remote-not-responding" title="14.9.">Q: 14.9</a>.</p></li><li class="listitem"><p>If the problem is local, read on entry <a class="xref" href="ppp.html#ppp-hung" title="14.10.">Q: 14.10</a>.</p></li></ul></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68769744"></a><a id="ppp-remote-not-responding"></a><p><strong>14.9.</strong></p></td><td align="left" valign="top"><p>The remote end is not responding.  What can I
	    do?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>There is very little that can be done about this.  Many ISPs
	    will refuse to help users not running a <span class="trademark">Microsoft</span>®
	    OS.  Add <code class="literal">enable lqr</code> to
	    <code class="filename">/etc/ppp/ppp.conf</code>, allowing <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to
	    detect the remote failure and hang up.  This detection
	    is relatively slow and therefore not that useful.</p><p>First, try disabling all local compression by adding
	    the following to the configuration:</p><pre class="programlisting">disable pred1 deflate deflate24 protocomp acfcomp shortseq vj
deny pred1 deflate deflate24 protocomp acfcomp shortseq vj</pre><p>Then reconnect to ensure that this makes no
	    difference.  If things improve or if the problem is solved
	    completely, determine which setting makes the difference
	    through trial and error.  This is good information for
	    the ISP, although it may make
	    it apparent that it is not a <span class="trademark">Microsoft</span>® system.</p><p>Before contacting the ISP, enable async logging
	    locally and wait until the connection hangs again.  This
	    may use up quite a bit of disk space.  The last data read
	    from the port may be of interest.  It is usually ASCII
	    data, and may even describe the problem (<span class="errorname">Memory
	      fault</span>, <span class="errorname">Core
	      dumped</span>).</p><p>If the ISP is helpful, they should be able to enable
	    logging on their end, then when the next link drop occurs,
	    they may be able to tell why their side is having a
	    problem.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68781520"></a><a id="ppp-hung"></a><p><strong>14.10.</strong></p></td><td align="left" valign="top"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> has hung.  What can I do?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>In this case, rebuild <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> with
	    debugging information, and then use <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gdb&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">gdb</span>(1)</span></a> to grab a
	    stack trace from the <span class="application">ppp</span>
	    process that is stuck.  To rebuild the
	    <span class="application">ppp</span> utility with debugging
	    information, type:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/usr.sbin/ppp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>env DEBUG_FLAGS='-g' make clean</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>env DEBUG_FLAGS='-g' make install</code></strong></pre><p>Then, restart <span class="application">ppp</span>
	    and wait until it hangs again.  When the debug build of
	    <span class="application">ppp</span> hangs, start
	    <span class="application">gdb</span> on the stuck process by
	    typing:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gdb ppp `pgrep ppp`</code></strong></pre><p>At the <span class="application">gdb</span> prompt,
	    use the <code class="command">bt</code> or <code class="command">where</code>
	    commands to get a stack trace.  Save the output of the
	    <span class="application">gdb</span> session, and
	    <span class="quote">&#8220;<span class="quote">detach</span>&#8221;</span> from the running process by typing
	    <code class="command">quit</code>.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68794192"></a><a id="ppp-same-magic"></a><p><strong>14.11.</strong></p></td><td align="left" valign="top"><p>I keep seeing errors about magic being the same.  What
	    does it mean?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Occasionally, just after connecting, there may be
	    messages in the log that say <span class="errorname">Magic is
	      same</span>.  Sometimes, these messages are
	    harmless, and sometimes one side or the other exits.  Most
	    PPP implementations cannot survive this problem, and even
	    if the link seems to come up, there will be repeated
	    configure requests and configure acknowledgments in the
	    log file until <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> eventually gives up and closes
	    the connection.</p><p>This normally happens on server machines with slow
	    disks that are spawning a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getty&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">getty</span>(8)</span></a> on the port, and
	    executing <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> from a login script or program after
	    login.  There were reports of it happening consistently
	    when using slirp.  The reason is that in the time taken
	    between <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getty&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">getty</span>(8)</span></a> exiting and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> starting,
	    the client-side <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> starts sending Line Control
	    Protocol (LCP) packets.  Because ECHO is still switched on
	    for the port on the server, the client <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> sees
	    these packets <span class="quote">&#8220;<span class="quote">reflect</span>&#8221;</span> back.</p><p>One part of the LCP negotiation is to establish a
	    magic number for each side of the link so that
	    <span class="quote">&#8220;<span class="quote">reflections</span>&#8221;</span> can be detected.  The protocol
	    says that when the peer tries to negotiate the same magic
	    number, a NAK should be sent and a new magic number should
	    be chosen.  During the period that the server port has
	    ECHO turned on, the client <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> sends LCP packets,
	    sees the same magic in the reflected packet and NAKs it.
	    It also sees the NAK reflect (which also means <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>
	    must change its magic).  This produces a potentially
	    enormous number of magic number changes, all of which are
	    happily piling into the server's tty buffer.  As soon as
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> starts on the server, it is flooded with magic
	    number changes and almost immediately decides it has tried
	    enough to negotiate LCP and gives up.  Meanwhile, the
	    client, who no longer sees the reflections, becomes happy
	    just in time to see a hangup from the server.</p><p>This can be avoided by allowing the peer to start
	    negotiating with the following line in
	    <code class="filename">ppp.conf</code>:</p><pre class="programlisting">set openmode passive</pre><p>This tells <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to wait for the server to
	    initiate LCP negotiations.  Some servers however may never
	    initiate negotiations.  In this case, try
	    something like:</p><pre class="programlisting">set openmode active 3</pre><p>This tells <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to be passive for 3 seconds,
	    and then to start sending LCP requests.  If the peer
	    starts sending requests during this period, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>
	    will immediately respond rather than waiting for the full
	    3 second period.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68818896"></a><a id="ppp-lcp-constant"></a><p><strong>14.12.</strong></p></td><td align="left" valign="top"><p>LCP negotiations continue until the connection is
	    closed.  What is wrong?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>There is currently an implementation mis-feature in
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> where it does not associate LCP, CCP &amp;
	    IPCP responses with their original requests.  As a result,
	    if one PPP implementation is more than 6 seconds slower
	    than the other side, the other side will send two
	    additional LCP configuration requests.  This is
	    fatal.</p><p>Consider two implementations,
	    <code class="systemitem">A</code> and <code class="systemitem">B</code>.
	    <code class="systemitem">A</code> starts sending LCP requests
	    immediately after connecting and
	    <code class="systemitem">B</code> takes 7 seconds to start.  When
	    <code class="systemitem">B</code> starts,
	    <code class="systemitem">A</code> has sent 3 LCP REQs.  We are
	    assuming the line has ECHO switched off, otherwise we
	    would see magic number problems as described in the
	    previous section.  <code class="systemitem">B</code> sends a REQ,
	    then an ACK to the first of <code class="systemitem">A</code>'s
	    REQs.  This results in <code class="systemitem">A</code> entering
	    the <acronym class="acronym">OPENED</acronym> state and sending and ACK
	    (the first) back to <code class="systemitem">B</code>.  In the
	    meantime, <code class="systemitem">B</code> sends back two more
	    ACKs in response to the two additional REQs sent by
	    <code class="systemitem">A</code> before
	    <code class="systemitem">B</code> started up.
	    <code class="systemitem">B</code> then receives the first ACK
	    from <code class="systemitem">A</code> and enters the
	    <acronym class="acronym">OPENED</acronym> state.
	    <code class="systemitem">A</code> receives the second ACK from
	    <code class="systemitem">B</code> and goes back to the
	    <acronym class="acronym">REQ-SENT</acronym> state, sending another (forth)
	    REQ as per the RFC.  It then receives the third ACK and
	    enters the <acronym class="acronym">OPENED</acronym> state.  In the
	    meantime, <code class="systemitem">B</code> receives the forth
	    REQ from <code class="systemitem">A</code>, resulting in it
	    reverting to the <acronym class="acronym">ACK-SENT</acronym> state and
	    sending another (second) REQ and (forth) ACK as per the
	    RFC.  <code class="systemitem">A</code> gets the REQ, goes into
	    <acronym class="acronym">REQ-SENT</acronym> and sends another REQ.  It
	    immediately receives the following ACK and enters
	    <acronym class="acronym">OPENED</acronym>.</p><p>This goes on until one side figures out that they are
	    getting nowhere and gives up.</p><p>The best way to avoid this is to configure one side to
	    be <code class="literal">passive</code> &#8212; that is, make one
	    side wait for the other to start negotiating.  This can be
	    done with the following command:</p><pre class="programlisting">set openmode passive</pre><p>Care should be taken with this option.
	    This command can also be used to limit the amount of time that
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> waits for the peer to begin
	    negotiations:</p><pre class="programlisting">set stopped <em class="replaceable"><code>N</code></em></pre><p>Alternatively, the following command (where
	    <em class="replaceable"><code>N</code></em> is the number of seconds to
	    wait before starting negotiations) can be used:</p><pre class="programlisting">set openmode active <em class="replaceable"><code>N</code></em></pre><p>Check the manual page for details.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68879056"></a><a id="ppp-shell-test-lockup"></a><p><strong>14.13.</strong></p></td><td align="left" valign="top"><p>Why does <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> lock up when I shell out to test
	    it?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>When using <code class="command">shell</code> or
	    <code class="command">!</code>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> executes a shell
	    or the passed arguments.  The
	    <span class="application">ppp</span> program will wait for the
	    command to complete before continuing.  Any attempt to
	    use the PPP link while running the command will appear as
	    a frozen link.  This is because <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> is
	    waiting for the command to complete.</p><p>To execute commands like this, use
	    <code class="command">!bg</code> instead.  This will execute the
	    given command in the background, and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> can
	    continue to service the link.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68886096"></a><a id="ppp-null-modem"></a><p><strong>14.14.</strong></p></td><td align="left" valign="top"><p>Why does <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> over a null-modem cable never
	    exit?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>There is no way for <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to automatically
	    determine that a direct connection has been dropped.  This
	    is due to the lines that are used in a null-modem serial
	    cable.  When using this sort of connection, LQR should
	    always be enabled with the following line:</p><pre class="programlisting">enable lqr</pre><p>LQR is accepted by default if negotiated by the
	    peer.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68898768"></a><a id="ppp-auto-noreasondial"></a><p><strong>14.15.</strong></p></td><td align="left" valign="top"><p>Why does <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> dial for no reason in
	    <code class="option">-auto</code> mode?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> is dialing unexpectedly,
	    determine the cause, and set up dial filters to
	    prevent such dialing.</p><p>To determine the cause, use the following line:</p><pre class="programlisting">set log +tcp/ip</pre><p>This will log all traffic through the connection.  The
	    next time the line comes up unexpectedly, the
	    reason will be logged with a convenient timestamp next to
	    it.</p><p>Next, disable dialing under these circumstances.
	    Usually, this sort of problem arises due to DNS lookups.
	    To prevent DNS lookups from establishing a connection
	    (this will <span class="emphasis"><em>not</em></span> prevent <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>
	    from passing the packets through an established
	    connection), use the following:</p><pre class="programlisting">set dfilter 1 deny udp src eq 53
set dfilter 2 deny udp dst eq 53
set dfilter 3 permit 0/0 0/0</pre><p>This is not always suitable, as it will effectively
	    break demand-dial capabilities.  Most programs
	    will need a DNS lookup before doing any other network
	    related things.</p><p>In the DNS case, try to determine what is
	    actually trying to resolve a host name.  A lot of the
	    time, <span class="application">Sendmail</span> is the culprit.  Make
	    sure to configure <span class="application">Sendmail</span> not
	    to do any DNS lookups in its configuration file.  See the
	    section on <a class="link" href="../../../../doc/en_US.ISO8859-1/books/handbook/smtp-dialup.html" target="_top">using
	      email with a dialup connection</a> in the FreeBSD
	    Handbook for details.  You may
	    also want to add the following line to
	    <code class="filename">.mc</code>:</p><pre class="programlisting">define(`confDELIVERY_MODE', `d')dnl</pre><p>This will make <span class="application">Sendmail</span>
	    queue everything until the queue is run, usually,
	    every 30 minutes, or until a <code class="command">sendmail
	      -q</code> is done, perhaps from
	    <code class="filename">/etc/ppp/ppp.linkup</code>.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68914512"></a><a id="ccp-errors"></a><p><strong>14.16.</strong></p></td><td align="left" valign="top"><p>What do these CCP errors mean?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>I keep seeing the following errors in my log
	    file:</p><pre class="programlisting">CCP: CcpSendConfigReq
CCP: Received Terminate Ack (1) state = Req-Sent (6)</pre><p>This is because <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> is trying to negotiate
	    Predictor1 compression, but the peer does not want to
	    negotiate any compression at all.  The messages are
	    harmless, but can be silenced by disabling the compression:</p><pre class="programlisting">disable pred1</pre></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68918608"></a><a id="ppp-connectionspeed"></a><p><strong>14.17.</strong></p></td><td align="left" valign="top"><p>Why does <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> not log my connection
	    speed?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>To log all lines of the modem
	    conversation, enable the
	    following:</p><pre class="programlisting">set log +connect</pre><p>This will make <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> log everything up until the
	    last requested <span class="quote">&#8220;<span class="quote">expect</span>&#8221;</span> string.</p><p>To see the connect speed when using
	    PAP or CHAP,
	    make sure to configure <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to
	    expect the whole CONNECT line, using something
	    like this:</p><pre class="programlisting">set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 4 \
  \"\" ATZ OK-ATZ-OK ATDT\\T TIMEOUT 60 CONNECT \\c \\n"</pre><p>This gets the CONNECT, sends nothing, then expects a
	    line-feed, forcing <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to read the whole CONNECT
	    response.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68934352"></a><a id="ppp-ignores-backslash"></a><p><strong>14.18.</strong></p></td><td align="left" valign="top"><p>Why does <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> ignore the <code class="literal">\</code>
	    character in my chat script?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>The <span class="application">ppp</span> utility parses each
	    line in its configuration files so that it can interpret strings
	    such as <code class="literal">set phone "123 456 789"</code>
	    correctly and realize that the number is actually only
	    one argument.  To specify a
	    <code class="literal">"</code> character, escape it
	    using a backslash (<code class="literal">\</code>).</p><p>When the chat interpreter parses each argument, it
	    re-interprets the argument to find any special escape
	    sequences such as <code class="literal">\P</code> or
	    <code class="literal">\T</code>.  As a result
	    of this double-parsing, remember to use the
	    correct number of escapes.</p><p>To actually send a <code class="literal">\</code>
	    character, do something
	    like:</p><pre class="programlisting">set dial "\"\" ATZ OK-ATZ-OK AT\\\\X OK"</pre><p>It will result in the following sequence:</p><pre class="programlisting">ATZ
OK
AT\X
OK</pre><p>Or:</p><pre class="programlisting">set phone 1234567
set dial "\"\" ATZ OK ATDT\\T"</pre><p>It will result in the following sequence:</p><pre class="programlisting">ATZ
OK
ATDT1234567</pre></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68943824"></a><a id="fcs-errors"></a><p><strong>14.19.</strong></p></td><td align="left" valign="top"><p>What are FCS errors?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>FCS stands for Frame Check Sequence.  Each PPP packet
	    has a checksum attached to ensure that the data being
	    received is the data being sent.  If the FCS of an
	    incoming packet is incorrect, the packet is dropped and
	    the HDLC FCS count is increased.  The HDLC error values
	    can be displayed using the <code class="literal">show hdlc</code>
	    command.</p><p>If the link is bad or if the serial driver is
	    dropping packets, it will produce the occasional FCS error.
	    This is not usually worth worrying about although it does
	    slow down the compression protocols substantially.</p><p>If the link freezes as soon as it connects and
	    produces a large number of FCS errors, make sure the modem is not
	    using software flow control (XON/XOFF).  If the link
	    must use software flow control, use
	    <code class="literal">set accmap 0x000a0000</code> to
	    tell <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to escape the <code class="literal">^Q</code> and
	    <code class="literal">^S</code> characters.</p><p>Another reason for too many FCS errors may be
	    that the remote end has stopped talking
	    <acronym class="acronym">PPP</acronym>.  In this case, enable
	    <code class="literal">async</code> logging to
	    determine if the incoming data is actually a login or
	    shell prompt.  If it is a shell prompt at the remote
	    end, it is possible to terminate <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> without
	    dropping the line by using <code class="command">close lcp</code> followed by
	    <code class="command">term</code>) to reconnect to
	    the shell on the remote machine.</p><p>If nothing in the log file indicates why the link
	    was terminated, ask the remote
	    administrator or ISP why the session was
	    terminated.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp68956240"></a><a id="desperation"></a><p><strong>14.20.</strong></p></td><td align="left" valign="top"><p>None of this helps &#8212; I am desperate!  What can I
	    do?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If all else fails, send the details of the error, the
	    configuration files, how
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> is being started, the relevant parts of the log file, and the
	    output of <code class="command">netstat -rn</code>, before and after
	    connecting, to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">FreeBSD general questions mailing list</a>.</p></td></tr></tbody></table></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="security.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="serial.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 13. Security </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 15. Serial Communications</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>