<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>2.3. Variables</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="PMake &#8212; A Tutorial" /><link rel="up" href="basics.html" title="Chapter 2. The Basics of PMake" /><link rel="prev" href="shellcmds.html" title="2.2. Shell Commands" /><link rel="next" href="comments.html" title="2.4. Comments" /><link rel="copyright" href="legalnotice.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2.3. Variables</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="shellcmds.html">Prev</a> </td><th width="60%" align="center">Chapter 2. The Basics of PMake</th><td width="20%" align="right"> <a accesskey="n" href="comments.html">Next</a></td></tr></table><hr /></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="variables"></a>2.3. Variables</h2></div></div></div><p><span class="application">PMake</span>, like
      <span class="application">Make</span> before it, has the ability to
      save text in variables to be recalled later at your convenience.
      Variables in <span class="application">PMake</span> are used much like
      variables in the shell and, by tradition, consist of all
      upper-case letters (you do not have to use all upper-case
      letters.  In fact there is nothing to stop you from calling a
      variable <code class="literal">@^&amp;$%$</code>.  Just tradition).  Variables
      are assigned-to using lines of the form:</p><pre class="programlisting">VARIABLE = value</pre><p>appended-to by:</p><pre class="programlisting">VARIABLE += value</pre><p>conditionally assigned-to (if the variable is not already
      defined) by:</p><pre class="programlisting">VARIABLE ?= value</pre><p>and assigned-to with expansion (i.e. the value is expanded
      (see below) before being assigned to the variable&#8212;useful
      for placing a value at the beginning of a variable, or other
      things) by:</p><pre class="programlisting">VARIABLE := value</pre><p>Any whitespace before value is stripped off.  When
      appending, a space is placed between the old value and the stuff
      being appended.</p><p>The final way a variable may be assigned to is using:</p><pre class="programlisting">VARIABLE != shell-command</pre><p>In this case, shell-command has all its variables expanded
      (see below) and is passed off to a shell to execute.  The output
      of the shell is then placed in the variable.  Any newlines
      (other than the final one) are replaced by spaces before the
      assignment is made.  This is typically used to find the current
      directory via a line like:</p><pre class="programlisting">CWD             != pwd</pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">This is intended to be used to execute commands that
	produce small amounts of output
	(e.g. <span class="application">pwd</span>).
	The implementation is less than intelligent and will likely
	freeze if you execute something that produces thousands of
	bytes of output (8 Kb is the limit on many <span class="trademark">UNIX</span>® systems).
	The value of a variable may be retrieved by enclosing the
	variable name in parentheses or curly braces and preceding the
	whole thing with a dollar sign.</p></div><p>For example, to set the variable <code class="envar">CFLAGS</code> to
      the string <code class="literal">-I/sprite/src/lib/libc -O,</code> you
      would place a line:</p><pre class="programlisting">CFLAGS = -I/sprite/src/lib/libc -O</pre><p>in the makefile and use the word
      <code class="literal">$(CFLAGS)</code> wherever you would like the string
      <code class="literal">-I/sprite/src/lib/libc -O</code> to appear.  This is
      called variable expansion.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Unlike <span class="application">Make</span>,
	<span class="application">PMake</span> will not expand a variable
	unless it knows the variable exists.  E.g. if you have a
	<code class="literal">${i}</code> in a shell command and you have not
	assigned a value to the variable <code class="varname">i</code> (the
	empty string is considered a value, by the way), where
	<span class="application">Make</span> would have substituted the
	empty string, <span class="application">PMake</span> will leave the
	<code class="literal">${i}</code> alone.
	To keep <span class="application">PMake</span> from substituting for
	a variable it knows, precede the dollar sign with another
	dollar sign (e.g. to pass <code class="literal">${HOME}</code> to
	the shell, use <code class="literal">$${HOME}</code>).  This causes
	<span class="application">PMake</span>, in effect, to expand the
	<code class="literal">$</code> macro, which expands to a single
	<code class="literal">$</code>.</p></div><p>For compatibility, <span class="application">Make</span>'s style
      of variable expansion will be used if you invoke
      <span class="application">PMake</span> with any of the compatibility
      flags (<code class="option">-V</code>, <code class="option">-B</code> or
      <code class="option">-M</code>.  The <code class="option">-V</code> flag alters just
      the variable expansion).  There are two different times at which
      variable expansion occurs: when parsing a dependency line, the
      expansion occurs immediately upon reading the line.  If any
      variable used on a dependency line is undefined,
      <span class="application">PMake</span> will print a message and exit.
      Variables in shell commands are expanded when the command is
      executed.  Variables used inside another variable are expanded
      whenever the outer variable is expanded (the expansion of an
      inner variable has no effect on the outer variable.  For
      example, if the outer variable is used on a dependency line and
      in a shell command, and the inner variable changes value between
      when the dependency line is read and the shell command is
      executed, two different values will be substituted for the outer
      variable).</p><p>Variables come in four flavors, though they are all expanded
      the same and all look about the same.  They are (in order of
      expanding scope):</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Local variables.</p></li><li class="listitem"><p>Command-line variables.</p></li><li class="listitem"><p>Global variables.</p></li><li class="listitem"><p>Environment variables.</p></li></ul></div><p>The classification of variables does not matter much, except
      that the classes are searched from the top (local) to the bottom
      (environment) when looking up a variable.  The first one found
      wins.</p><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="localvariables"></a>2.3.1. Local Variables</h3></div></div></div><p>Each target can have as many as seven local variables.
	These are variables that are only <span class="quote">&#8220;<span class="quote">visible</span>&#8221;</span>
	within that target's shell script and contain such things as
	the target's name, all of its sources (from all its dependency
	lines), those sources that were out-of-date, etc.  Four local
	variables are defined for all targets.  They are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="varname">.TARGET</code></span></dt><dd><p>The name of the target.</p></dd><dt><span class="term"><code class="varname">.OODATE</code></span></dt><dd><p>The list of the sources for the target that were
	      considered out-of-date.  The order in the list is not
	      guaranteed to be the same as the order in which the
	      dependencies were given.</p></dd><dt><span class="term"><code class="varname">.ALLSRC</code></span></dt><dd><p>The list of all sources for this target in the order
	      in which they were given.</p></dd><dt><span class="term"><code class="varname">.PREFIX</code></span></dt><dd><p>The target without its suffix and without any
	      leading path.  E.g. for the target
	      <code class="filename">../../lib/compat/fsRead.c</code>, this
	      variable would contain <code class="literal">fsRead</code>.</p></dd></dl></div><p>Three other local variables are set only for certain
	targets under special circumstances.  These are the
	<code class="varname">.IMPSRC,</code> <code class="varname">.ARCHIVE,</code> and
	<code class="varname">.MEMBER</code> variables.  When they are set and
	how they are used is described later.</p><p>Four of these variables may be used in sources as well as
	in shell scripts.  These are <code class="varname">.TARGET</code>,
	<code class="varname">.PREFIX</code>, <code class="varname">.ARCHIVE</code> and
	<code class="varname">.MEMBER</code>.  The variables in the sources are
	expanded once for each target on the dependency line,
	providing what is known as a <span class="quote">&#8220;<span class="quote">dynamic source,</span>&#8221;</span>
	allowing  you to specify several dependency lines at once.
	For example:</p><pre class="programlisting">$(OBJS)         : $(.PREFIX).c</pre><p>will create a dependency between each object file and its
	corresponding C source file.</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="cmdvars"></a>2.3.2. Command-line Variables</h3></div></div></div><p>Command-line variables are set when
	<span class="application">PMake</span> is first invoked by giving a
	variable assignment as one of the arguments.
	For example:</p><pre class="screen">pmake "CFLAGS = -I/sprite/src/lib/libc -O"</pre><p>would make <code class="envar">CFLAGS</code> be a command-line
	variable with the given value.  Any assignments to
	<code class="envar">CFLAGS</code> in the makefile will have no effect,
	because once it is set, there is (almost) nothing you can do
	to change a command-line variable (the search order, you see).
	Command-line variables may be set using any of the four
	assignment operators, though only <code class="literal">=</code> and
	<code class="literal">?=</code> behave as you would expect them to,
	mostly because assignments to command-line variables are
	performed before the makefile is read, thus the values set in
	the makefile are unavailable at the time.
	<code class="literal">+=</code> is the same as <code class="literal">=</code>,
	because the old value of the variable is sought only in the
	scope in which the assignment is taking place (for reasons of
	efficiency that I will not get into here).  <code class="literal">:=</code>
	and <code class="literal">?=</code> will work if the  only variables
	used are in the environment.  <code class="literal">!=</code> is sort of
	pointless to use from the command line, since the same effect
	can no doubt be accomplished using the shell's own command
	substitution mechanisms (backquotes and all that).</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="globalvariables"></a>2.3.3. Global Variables</h3></div></div></div><p>Global variables are those set or appended-to in the
	makefile.  There are two classes of global variables: those
	you set and those <span class="application">PMake</span> sets.
	As I said before, the ones you set can have any name you want
	them to have, except they may not contain a colon or an
	exclamation point.
	The variables <span class="application">PMake</span> sets (almost)
	always begin with a period and always contain upper-case
	letters, only.  The variables are as follows:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="varname">.PMAKE</code></span></dt><dd><p>The name by which <span class="application">PMake</span>
	      was invoked is stored in this variable.  For
	      compatibility, the name is also stored in the
	      <code class="varname">MAKE</code> variable.</p></dd><dt><span class="term"><code class="varname">.MAKEFLAGS</code></span></dt><dd><p>All the relevant flags with which
	      <span class="application">PMake</span> was invoked.
	      This does not include such things as <code class="option">-f</code>
	      or variable assignments. Again for compatibility, this
	      value is stored in the <code class="varname">MFLAGS</code>
	      variable as well.</p></dd></dl></div><p>Two other variables, <code class="varname">.INCLUDES</code> and
	<code class="varname">.LIBS,</code> are covered in the section on
	special targets in <a class="xref" href="shortcuts.html" title="Chapter 3. Short-cuts and Other Nice Things">Chapter 3, <em>Short-cuts and Other Nice Things</em></a>.</p><p>Global variables may be deleted using lines of the
	form:</p><pre class="programlisting">#undef variable</pre><p>The <code class="literal">#</code> must be the first character on
	the line.  Note that this may only be done on global
	variables.</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="envvars"></a>2.3.4. Environment Variables</h3></div></div></div><p>Environment variables are passed by the shell that invoked
	<span class="application">PMake</span> and are given by
	<span class="application">PMake</span> to each shell it invokes.
	They are expanded like any other variable, but they cannot be
	altered in any way.</p><p>One special environment variable, <code class="envar">PMAKE</code>, is
	examined by <span class="application">PMake</span> for command-line
	flags, variable assignments, etc., it should always use.  This
	variable is examined before the actual arguments to
	<span class="application">PMake</span> are.  In addition, all flags
	given to <span class="application">PMake</span>, either through the
	<code class="envar">PMAKE</code> variable or on the command line, are
	placed in this environment variable and exported to each shell
	<span class="application">PMake</span> executes.  Thus recursive
	invocations of <span class="application">PMake</span> automatically
	receive the same flags as the top-most one.</p><p>Using all these variables, you can compress the sample
	makefile even more:</p><pre class="programlisting">OBJS            = a.o b.o c.o

program         : $(OBJS)
        cc $(.ALLSRC) -o $(.TARGET)

$(OBJS)         : defs.h

a.o             : a.c
        cc -c a.c

b.o             : b.c
        cc -c b.c

c.o             : c.c
        cc -c c.c</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="shellcmds.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="basics.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="comments.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">2.2. Shell Commands </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 2.4. Comments</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>