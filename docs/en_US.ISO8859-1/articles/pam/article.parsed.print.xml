<?xml version="1.0" encoding="iso-8859-1"?>
<!--
  - Copyright (c) 2001-2003 Networks Associates Technology, Inc.
  - All rights reserved.
  -
  - This software was developed for the FreeBSD Project by ThinkSec AS and
  - Network Associates Laboratories, the Security Research Division of
  - Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
  - ("CBOSS"), as part of the DARPA CHATS research program.
  -
  - Redistribution and use in source and binary forms, with or without
  - modification, are permitted provided that the following conditions
  - are met:
  - 1. Redistributions of source code must retain the above copyright
  -    notice, this list of conditions and the following disclaimer.
  - 2. Redistributions in binary form must reproduce the above copyright
  -    notice, this list of conditions and the following disclaimer in the
  -    documentation and/or other materials provided with the distribution.
  - 3. The name of the author may not be used to endorse or promote
  -    products derived from this software without specific prior written
  -    permission.
  -
  - THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
  - ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  - IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  - ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
  - FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  - DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
  - OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
  - HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
  - LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
  - OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
  - SUCH DAMAGE.
  -->
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:lang="en">
  <info><title xmlns:xlink="http://www.w3.org/1999/xlink">Pluggable Authentication Modules</title>
    

    <abstract xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">This article describes the underlying principles and
	mechanisms of the Pluggable Authentication Modules (PAM)
	library, and explains how to configure PAM, how to integrate
	PAM into applications, and how to write PAM modules.</para>
    </abstract>

    <copyright xmlns:xlink="http://www.w3.org/1999/xlink">
      <year xmlns:xlink="http://www.w3.org/1999/xlink">2001</year>
      <year xmlns:xlink="http://www.w3.org/1999/xlink">2002</year>
      <year xmlns:xlink="http://www.w3.org/1999/xlink">2003</year>
      <holder xmlns:xlink="http://www.w3.org/1999/xlink">Networks Associates Technology, Inc.</holder>
    </copyright>

    <authorgroup xmlns:xlink="http://www.w3.org/1999/xlink">
      <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Dag-Erling</firstname><surname xmlns:xlink="http://www.w3.org/1999/xlink">Smørgrav</surname></personname><contrib xmlns:xlink="http://www.w3.org/1999/xlink">Contributed by </contrib></author>
    </authorgroup>

    <legalnotice xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-legalnotice">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">This article was written for the FreeBSD Project by
	ThinkSec AS and Network Associates Laboratories, the Security
	Research Division of Network Associates, Inc. under
	DARPA/SPAWAR contract N66001-01-C-8035 (<quote xmlns:xlink="http://www.w3.org/1999/xlink">CBOSS</quote>),
	as part of the DARPA CHATS research program.</para>
    </legalnotice>

    <legalnotice xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="trademarks" role="trademarks">
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">FreeBSD is a registered trademark of
  the FreeBSD Foundation.</para>
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Linux is a registered trademark of
  Linus Torvalds.</para>
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Motif, OSF/1, and UNIX are
  registered trademarks and IT DialTone and The Open Group are
  trademarks of The Open Group in the United States and other
  countries.</para>
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Sun, Sun Microsystems, Java, Java
  Virtual Machine, JDK, JRE, JSP, JVM, Netra, OpenJDK,
  Solaris, StarOffice, SunOS
  and VirtualBox are trademarks or registered trademarks of
  Sun Microsystems, Inc. in the United States and other countries.</para>
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Many of the designations used by
  manufacturers and sellers to distinguish their products are claimed
  as trademarks.  Where those designations appear in this document,
  and the FreeBSD Project was aware of the trademark claim, the
  designations have been followed by the <quote xmlns:xlink="http://www.w3.org/1999/xlink">&#8482;</quote> or the
  <quote xmlns:xlink="http://www.w3.org/1999/xlink">®</quote> symbol.</para>
    </legalnotice>

    <releaseinfo xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</releaseinfo>
  </info>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-intro">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-intro.title">Introduction</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The Pluggable Authentication Modules (PAM) library is a
      generalized API for authentication-related services which allows
      a system administrator to add new authentication methods simply
      by installing new PAM modules, and to modify authentication
      policies by editing configuration files.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">PAM was defined and developed in 1995 by Vipin Samar and
      Charlie Lai of Sun Microsystems, and has not changed much since.
      In 1997, the Open Group published the X/Open Single Sign-on
      (XSSO) preliminary specification, which standardized the PAM API
      and added extensions for single (or rather integrated) sign-on.
      At the time of this writing, this specification has not yet been
      adopted as a standard.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Although this article focuses primarily on FreeBSD 5.x,
      which uses OpenPAM, it should be equally applicable to FreeBSD
      4.x, which uses Linux-PAM, and other operating systems such as
      Linux and <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Solaris</trademark>.</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-terms">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-terms.title">Terms and conventions</title>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-definitions">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-definitions.title">Definitions</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The terminology surrounding PAM is rather confused.
	Neither Samar and Lai's original paper nor the XSSO
	specification made any attempt at formally defining terms for
	the various actors and entities involved in PAM, and the terms
	that they do use (but do not define) are sometimes misleading
	and ambiguous.  The first attempt at establishing a consistent
	and unambiguous terminology was a whitepaper written by Andrew
	G. Morgan (author of Linux-PAM) in 1999.  While Morgan's
	choice of terminology was a huge leap forward, it is in this
	author's opinion by no means perfect.  What follows is an
	attempt, heavily inspired by Morgan, to define precise and
	unambiguous terms for all actors and entities involved in
	PAM.</para>

      <glosslist xmlns:xlink="http://www.w3.org/1999/xlink">
	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">account</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The set of credentials the applicant is requesting
	      from the arbitrator.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">applicant</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The user or entity requesting authentication.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">arbitrator</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The user or entity who has the privileges necessary
	      to verify the applicant's credentials and the authority
	      to grant or deny the request.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">chain</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">A sequence of modules that will be invoked in
	      response to a PAM request.  The chain includes
	      information about the order in which to invoke the
	      modules, what arguments to pass to them, and how to
	      interpret the results.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">client</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The application responsible for initiating an
	      authentication request on behalf of the applicant and
	      for obtaining the necessary authentication information
	      from him.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">facility</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">One of the four basic groups of functionality
	      provided by PAM: authentication, account management,
	      session management and authentication token
	      update.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">module</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">A collection of one or more related functions
	      implementing a particular authentication facility,
	      gathered into a single (normally dynamically loadable)
	      binary file and identified by a single name.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">policy</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The complete set of configuration statements
	      describing how to handle PAM requests for a particular
	      service.  A policy normally consists of four chains, one
	      for each facility, though some services do not use all
	      four facilities.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">server</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The application acting on behalf of the arbitrator
	      to converse with the client, retrieve authentication
	      information, verify the applicant's credentials and
	      grant or deny requests.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">service</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">A class of servers providing similar or related
	      functionality and requiring similar authentication.  PAM
	      policies are defined on a per-service basis, so all
	      servers that claim the same service name will be subject
	      to the same policy.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">session</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The context within which service is rendered to the
	      applicant by the server.  One of PAM's four facilities,
	      session management, is concerned exclusively with
	      setting up and tearing down this context.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">token</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">A chunk of information associated with the account,
	      such as a password or passphrase, which the applicant
	      must provide to prove his identity.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">transaction</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">A sequence of requests from the same applicant to
	      the same instance of the same server, beginning with
	      authentication and session set-up and ending with
	      session tear-down.</para>
	  </glossdef>
	</glossentry>
      </glosslist>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-usage-examples">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-usage-examples.title">Usage examples</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">This section aims to illustrate the meanings of some of
	the terms defined above by way of a handful of simple
	examples.</para>

      <section xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Client and server are one</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">This simple example shows <literal xmlns:xlink="http://www.w3.org/1999/xlink">alice</literal>
	  <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>'ing to <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal>.</para>

<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">whoami</userinput>
alice
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ls -l `which su`</userinput>
-r-sr-xr-x  1 root  wheel  10744 Dec  6 19:06 /usr/bin/su
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">su -</userinput>
Password: <userinput xmlns:xlink="http://www.w3.org/1999/xlink">xi3kiune</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> whoami
root
</screen>

	<itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The applicant is <literal xmlns:xlink="http://www.w3.org/1999/xlink">alice</literal>.</para>
	  </listitem>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The account is <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal>.</para>
	  </listitem>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> process is both client and
	      server.</para>
	  </listitem>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The authentication token is
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">xi3kiune</literal>.</para>
	  </listitem>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The arbitrator is <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal>, which is
	      why <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> is setuid <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal>.</para>
	  </listitem>
	</itemizedlist>
      </section>

      <section xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Client and server are separate</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">The example below shows <literal xmlns:xlink="http://www.w3.org/1999/xlink">eve</literal> try to
	  initiate an <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">ssh</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> connection to
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">login.example.com</literal>, ask to log in as
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">bob</literal>, and succeed.  Bob should have chosen
	  a better password!</para>

<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">whoami</userinput>
eve
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ssh bob@login.example.com</userinput>
bob@login.example.com's password: <userinput xmlns:xlink="http://www.w3.org/1999/xlink">god</userinput>
Last login: Thu Oct 11 09:52:57 2001 from 192.168.0.1
Copyright (c) 1980, 1983, 1986, 1988, 1990, 1991, 1993, 1994
	The Regents of the University of California.  All rights reserved.
FreeBSD 4.4-STABLE (LOGIN) #4: Tue Nov 27 18:10:34 PST 2001

Welcome to FreeBSD!
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt></screen>

	<itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The applicant is <literal xmlns:xlink="http://www.w3.org/1999/xlink">eve</literal>.</para>
	  </listitem>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The client is Eve's <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">ssh</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> process.</para>
	  </listitem>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The server is the <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">sshd</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> process on
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">login.example.com</literal></para>
	  </listitem>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The account is <literal xmlns:xlink="http://www.w3.org/1999/xlink">bob</literal>.</para>
	  </listitem>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The authentication token is
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">god</literal>.</para>
	  </listitem>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Although this is not shown in this example, the
	      arbitrator is <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal>.</para>
	  </listitem>
	</itemizedlist>
      </section>

      <section xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Sample policy</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">The following is FreeBSD's default policy for
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">sshd</literal>:</para>

<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">sshd	auth		required	pam_nologin.so	no_warn
sshd	auth		required	pam_unix.so	no_warn try_first_pass
sshd	account		required	pam_login_access.so
sshd	account		required	pam_unix.so
sshd	session		required	pam_lastlog.so	no_fail
sshd	password	required	pam_permit.so</programlisting>

	<itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">This policy applies to the <literal xmlns:xlink="http://www.w3.org/1999/xlink">sshd</literal>
	      service (which is not necessarily restricted to the
	      <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">sshd</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> server.)</para>
	  </listitem>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">auth</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">account</literal>,
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">session</literal> and
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">password</literal> are facilities.</para>
	  </listitem>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><filename xmlns:xlink="http://www.w3.org/1999/xlink">pam_nologin.so</filename>,
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam_unix.so</filename>,
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam_login_access.so</filename>,
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam_lastlog.so</filename> and
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam_permit.so</filename> are modules.  It is
	      clear from this example that
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam_unix.so</filename> provides at least two
	      facilities (authentication and account
	      management.)</para>
	  </listitem>
	</itemizedlist>
      </section>
    </section>

<!--
    <section id="pam-conventions">
      <title id="pam-conventions.title">Conventions</title>

      <para>This section has not yet been written.</para>
    </section>
-->
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-essentials">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-essentials.title">PAM Essentials</title>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-facilities-primitives">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-facilities-primitives.title">Facilities and
	primitives</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The PAM API offers six different authentication primitives
	grouped in four facilities, which are described below.</para>

      <variablelist xmlns:xlink="http://www.w3.org/1999/xlink">
	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">auth</literal></term>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Authentication.</emphasis> This facility
	      concerns itself with authenticating the applicant and
	      establishing the account credentials.  It provides two
	      primitives:</para>

	    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
		<para xmlns:xlink="http://www.w3.org/1999/xlink"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_authenticate</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> authenticates the
		  applicant, usually by requesting an authentication
		  token and comparing it with a value stored in a
		  database or obtained from an authentication
		  server.</para>
	      </listitem>

	      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
		<para xmlns:xlink="http://www.w3.org/1999/xlink"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_setcred</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> establishes account
		  credentials such as user ID, group membership and
		  resource limits.</para>
	      </listitem>
	    </itemizedlist>
	  </listitem>
	</varlistentry>

	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">account</literal></term>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Account management.</emphasis> This
	      facility handles non-authentication-related issues of
	      account availability, such as access restrictions based
	      on the time of day or the server's work load.  It
	      provides a single primitive:</para>

	    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
		<para xmlns:xlink="http://www.w3.org/1999/xlink"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_acct_mgmt</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> verifies that the
		  requested account is available.</para>
	      </listitem>
	    </itemizedlist>
	  </listitem>
	</varlistentry>

	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">session</literal></term>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Session management.</emphasis> This
	      facility handles tasks associated with session set-up
	      and tear-down, such as login accounting.  It provides
	      two primitives:</para>

	    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
		<para xmlns:xlink="http://www.w3.org/1999/xlink"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_open_session</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> performs tasks
		  associated with session set-up: add an entry in the
		  <filename xmlns:xlink="http://www.w3.org/1999/xlink">utmp</filename> and
		  <filename xmlns:xlink="http://www.w3.org/1999/xlink">wtmp</filename> databases, start an SSH
		  agent, etc.</para>
	      </listitem>

	      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
		<para xmlns:xlink="http://www.w3.org/1999/xlink"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_close_session</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> performs tasks
		  associated with session tear-down: add an entry in
		  the <filename xmlns:xlink="http://www.w3.org/1999/xlink">utmp</filename> and
		  <filename xmlns:xlink="http://www.w3.org/1999/xlink">wtmp</filename> databases, stop the SSH
		  agent, etc.</para>
	      </listitem>
	    </itemizedlist>
	  </listitem>
	</varlistentry>

	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">password</literal></term>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Password management.</emphasis> This
	      facility is used to change the authentication token
	      associated with an account, either because it has
	      expired or because the user wishes to change it.  It
	      provides a single primitive:</para>

	    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
		<para xmlns:xlink="http://www.w3.org/1999/xlink"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_chauthtok</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> changes the authentication
		  token, optionally verifying that it is sufficiently
		  hard to guess, has not been used previously,
		  etc.</para>
	      </listitem>
	    </itemizedlist>
	  </listitem>
	</varlistentry>
      </variablelist>

    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules.title">Modules</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Modules are a very central concept in PAM; after all,
	they are the <quote xmlns:xlink="http://www.w3.org/1999/xlink">M</quote> in <quote xmlns:xlink="http://www.w3.org/1999/xlink">PAM</quote>.  A PAM
	module is a self-contained piece of program code that
	implements the primitives in one or more facilities for one
	particular mechanism; possible mechanisms for the
	authentication facility, for instance, include the <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark>
	password database, NIS, LDAP and Radius.</para>

      <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-module-naming">
	<title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-module-naming.title">Module Naming</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">FreeBSD implements each mechanism in a single module,
	  named
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">pam_<replaceable xmlns:xlink="http://www.w3.org/1999/xlink">mechanism</replaceable>.so</literal>
	  (for instance, <literal xmlns:xlink="http://www.w3.org/1999/xlink">pam_unix.so</literal> for the <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark>
	  mechanism.)  Other implementations sometimes have separate
	  modules for separate facilities, and include the facility
	  name as well as the mechanism name in the module name.  To
	  name one example, <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Solaris</trademark> has a
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">pam_dial_auth.so.1</literal> module which is
	  commonly used to authenticate dialup users.</para>
      </section>

      <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-module-versioning">
	<title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-module-versioning.title">Module Versioning</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">FreeBSD's original PAM implementation, based on
	  Linux-PAM, did not use version numbers for PAM modules.
	  This would commonly cause problems with legacy applications,
	  which might be linked against older versions of the system
	  libraries, as there was no way to load a matching version of
	  the required modules.</para>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">OpenPAM, on the other hand, looks for modules that have
	  the same version number as the PAM library (currently 2),
	  and only falls back to an unversioned module if no versioned
	  module could be loaded.  Thus legacy modules can be provided
	  for legacy applications, while allowing new (or newly built)
	  applications to take advantage of the most recent
	  modules.</para>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Although <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Solaris</trademark> PAM modules commonly have a version
	  number, they are not truly versioned, because the number is a
	  part of the module name and must be included in the
	  configuration.</para>
      </section>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-chains-policies">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-chains-policies.title">Chains and
	policies</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">When a server initiates a PAM transaction, the PAM library
	tries to load a policy for the service specified in the
	<citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_start</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> call.  The policy specifies how
	authentication requests should be processed, and is defined in
	a configuration file.  This is the other central concept in
	PAM: the possibility for the admin to tune the system security
	policy (in the wider sense of the word) simply by editing a
	text file.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">A policy consists of four chains, one for each of the four
	PAM facilities.  Each chain is a sequence of configuration
	statements, each specifying a module to invoke, some
	(optional) parameters to pass to the module, and a control
	flag that describes how to interpret the return code from the
	module.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Understanding the control flags is essential to
	understanding PAM configuration files.  There are four
	different control flags:</para>

      <variablelist xmlns:xlink="http://www.w3.org/1999/xlink">
	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">binding</literal></term>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">If the module succeeds and no earlier module in the
	      chain has failed, the chain is immediately terminated
	      and the request is granted.  If the module fails, the
	      rest of the chain is executed, but the request is
	      ultimately denied.</para>

	    <para xmlns:xlink="http://www.w3.org/1999/xlink">This control flag was introduced by Sun in <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Solaris</trademark> 9
	      (<trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">SunOS</trademark> 5.9), and is also supported by OpenPAM.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">required</literal></term>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">If the module succeeds, the rest of the chain is
	      executed, and the request is granted unless some other
	      module fails.  If the module fails, the rest of the
	      chain is also executed, but the request is ultimately
	      denied.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">requisite</literal></term>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">If the module succeeds, the rest of the chain is
	      executed, and the request is granted unless some other
	      module fails.  If the module fails, the chain is
	      immediately terminated and the request is denied.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">sufficient</literal></term>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">If the module succeeds and no earlier module in the
	      chain has failed, the chain is immediately terminated
	      and the request is granted.  If the module fails, the
	      module is ignored and the rest of the chain is
	      executed.</para>

	    <para xmlns:xlink="http://www.w3.org/1999/xlink">As the semantics of this flag may be somewhat
	      confusing, especially when it is used for the last
	      module in a chain, it is recommended that the
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">binding</literal> control flag be used instead
	      if the implementation supports it.</para>
	  </listitem>
	</varlistentry>

	<varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">optional</literal></term>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">The module is executed, but its result is ignored.
	      If all modules in a chain are marked
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">optional</literal>, all requests will always be
	      granted.</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">When a server invokes one of the six PAM primitives, PAM
	retrieves the chain for the facility the primitive belongs to,
	and invokes each of the modules listed in the chain, in the
	order they are listed, until it reaches the end, or determines
	that no further processing is necessary (either because a
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">binding</literal> or
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">sufficient</literal> module succeeded, or because a
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">requisite</literal> module failed.)  The request is
	granted if and only if at least one module was invoked, and
	all non-optional modules succeeded.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Note that it is possible, though not very common, to have
	the same module listed several times in the same chain.  For
	instance, a module that looks up user names and passwords in a
	directory server could be invoked multiple times with
	different parameters specifying different directory servers to
	contact.  PAM treat different occurrences of the same module
	in the same chain as different, unrelated modules.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-transactions">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-transactions.title">Transactions</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The lifecycle of a typical PAM transaction is described
	below.  Note that if any of these steps fails, the server
	should report a suitable error message to the client and abort
	the transaction.</para>

      <orderedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">If necessary, the server obtains arbitrator
	    credentials through a mechanism independent of
	    PAM&#8212;most commonly by virtue of having been started
	    by <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal>, or of being setuid
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal>.</para>
	</listitem>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">The server calls <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_start</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> to initialize the
	    PAM library and specify its service name and the target
	    account, and register a suitable conversation
	    function.</para>
	</listitem>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">The server obtains various information relating to the
	    transaction (such as the applicant's user name and the
	    name of the host the client runs on) and submits it to PAM
	    using <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_set_item</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry>.</para>
	</listitem>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">The server calls <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_authenticate</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> to
	    authenticate the applicant.</para>
	</listitem>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">The server calls <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_acct_mgmt</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> to verify that the
	    requested account is available and valid.  If the password
	    is correct but has expired, <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_acct_mgmt</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> will
	    return <literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_NEW_AUTHTOK_REQD</literal> instead of
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_SUCCESS</literal>.</para>
	</listitem>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">If the previous step returned
	    <literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_NEW_AUTHTOK_REQD</literal>, the server now
	    calls <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_chauthtok</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> to force the client to change
	    the authentication token for the requested account.</para>
	</listitem>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Now that the applicant has been properly
	    authenticated, the server calls <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_setcred</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> to
	    establish the credentials of the requested account.  It is
	    able to do this because it acts on behalf of the
	    arbitrator, and holds the arbitrator's credentials.</para>
	</listitem>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Once the correct credentials have been established,
	    the server calls <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_open_session</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> to set up the
	    session.</para>
	</listitem>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">The server now performs whatever service the client
	    requested&#8212;for instance, provide the applicant with a
	    shell.</para>
	</listitem>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Once the server is done serving the client, it calls
	    <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_close_session</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> to tear down the session.</para>
	</listitem>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Finally, the server calls <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_end</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> to notify
	    the PAM library that it is done and that it can release
	    whatever resources it has allocated in the course of the
	    transaction.</para>
	</listitem>
      </orderedlist>
    </section>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config.title">PAM Configuration</title>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-file">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-file.title">PAM policy files</title>

      <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-pam.conf">
	<title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-pam.conf.title">The
	  <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.conf</filename> file</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">The traditional PAM policy file is
	  <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.conf</filename>.  This file contains all
	  the PAM policies for your system.  Each line of the file
	  describes one step in a chain, as shown below:</para>

<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">login   auth    required        pam_nologin.so  no_warn</programlisting>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">The fields are, in order: service name, facility name,
	  control flag, module name, and module arguments.  Any
	  additional fields are interpreted as additional module
	  arguments.</para>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">A separate chain is constructed for each service /
	  facility pair, so while the order in which lines for the
	  same service and facility appear is significant, the order
	  in which the individual services and facilities are listed
	  is not.  The examples in the original PAM paper grouped
	  configuration lines by facility, and the <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Solaris</trademark> stock
	  <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam.conf</filename> still does that, but FreeBSD's
	  stock configuration groups configuration lines by service.
	  Either way is fine; either way makes equal sense.</para>
      </section>

      <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-pam.d">
	<title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-pam.d.title">The
	  <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.d</filename> directory</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">OpenPAM and Linux-PAM support an alternate configuration
	  mechanism, which is the preferred mechanism in FreeBSD.  In
	  this scheme, each policy is contained in a separate file
	  bearing the name of the service it applies to.  These files
	  are stored in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.d/</filename>.</para>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">These per-service policy files have only four fields
	  instead of <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam.conf</filename>'s five: the service
	  name field is omitted.  Thus, instead of the sample
	  <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam.conf</filename> line from the previous
	  section, one would have the following line in
	  <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.d/login</filename>:</para>

<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">auth    required        pam_nologin.so  no_warn</programlisting>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">As a consequence of this simplified syntax, it is
	  possible to use the same policy for multiple services by
	  linking each service name to a same policy file.  For
	  instance, to use the same policy for the
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">su</literal> and <literal xmlns:xlink="http://www.w3.org/1999/xlink">sudo</literal> services,
	  one could do as follows:</para>

<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">cd /etc/pam.d</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ln -s su sudo</userinput></screen>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">This works because the service name is determined from
	  the file name rather than specified in the policy file, so
	  the same file can be used for multiple differently-named
	  services.</para>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Since each service's policy is stored in a separate
	  file, the <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam.d</filename> mechanism also makes it
	  very easy to install additional policies for third-party
	  software packages.</para>
      </section>

      <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-file-order">
	<title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-file-order.title">The policy search
	  order</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">As we have seen above, PAM policies can be found in a
	  number of places.  What happens if policies for the same
	  service exist in multiple places?</para>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">It is essential to understand that PAM's configuration
	  system is centered on chains.<!-- XXX --></para>

      </section>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-breakdown">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-breakdown.title">Breakdown of a
	configuration line</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">As explained in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="pam-config-file"/>, each line in
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.conf</filename> consists of four or more
	fields: the service name, the facility name, the control flag,
	the module name, and zero or more module arguments.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The service name is generally (though not always) the name
	of the application the statement applies to.  If you are
	unsure, refer to the individual application's documentation to
	determine what service name it uses.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Note that if you use <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.d/</filename>
	instead of <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.conf</filename>, the service
	name is specified by the name of the policy file, and omitted
	from the actual configuration lines, which then start with the
	facility name.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The facility is one of the four facility keywords
	described in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="pam-facilities-primitives"/>.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Likewise, the control flag is one of the four keywords
	described in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="pam-chains-policies"/>,
	describing how to interpret the return code from the module.
	Linux-PAM supports an alternate syntax that lets you specify
	the action to associate with each possible return code, but
	this should be avoided as it is non-standard and closely tied
	in with the way Linux-PAM dispatches service calls (which
	differs greatly from the way <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Solaris</trademark> and OpenPAM do it.)
	Unsurprisingly, OpenPAM does not support this syntax.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-policies">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-policies.title">Policies</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">To configure PAM correctly, it is essential to understand
	how policies are interpreted.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">When an application calls <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_start</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry>, the PAM
	library loads the policy for the specified service and
	constructs four module chains (one for each facility.)  If one
	or more of these chains are empty, the corresponding chains
	from the policy for the <literal xmlns:xlink="http://www.w3.org/1999/xlink">other</literal> service are
	substituted.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">When the application later calls one of the six PAM
	primitives, the PAM library retrieves the chain for the
	corresponding facility and calls the appropriate service
	function in each module listed in the chain, in the order in
	which they were listed in the configuration.  After each call
	to a service function, the module type and the error code
	returned by the service function are used to determine what
	happens next.  With a few exceptions, which we discuss below,
	the following table applies:</para>

      <table xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">PAM chain execution summary</title>
	<tgroup xmlns:xlink="http://www.w3.org/1999/xlink" cols="4">
	  <colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="1*" colname="type"/>
	  <colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="1*" colname="success"/>
	  <colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="1*" colname="ignore"/>
	  <colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="1*" colname="other"/>
	  <thead xmlns:xlink="http://www.w3.org/1999/xlink">
	    <row xmlns:xlink="http://www.w3.org/1999/xlink">
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="type"/>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="success"><literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_SUCCESS</literal></entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="ignore"><literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_IGNORE</literal></entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="other"><literal xmlns:xlink="http://www.w3.org/1999/xlink">other</literal></entry>
	   </row>
	  </thead>
	  <tbody xmlns:xlink="http://www.w3.org/1999/xlink">
	    <row xmlns:xlink="http://www.w3.org/1999/xlink">
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="type">binding</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="success">if (!fail) break;</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="ignore">-</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="other">fail = true;</entry>
	    </row>
	    <row xmlns:xlink="http://www.w3.org/1999/xlink">
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="type">required</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="success">-</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="ignore">-</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="other">fail = true;</entry>
	    </row>
	    <row xmlns:xlink="http://www.w3.org/1999/xlink">
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="type">requisite</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="success">-</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="ignore">-</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="other">fail = true; break;</entry>
	    </row>
	    <row xmlns:xlink="http://www.w3.org/1999/xlink">
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="type">sufficient</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="success">if (!fail) break;</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="ignore">-</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="other">-</entry>
	    </row>
	    <row xmlns:xlink="http://www.w3.org/1999/xlink">
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="type">optional</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="success">-</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="ignore">-</entry>
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="other">-</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">If <varname xmlns:xlink="http://www.w3.org/1999/xlink">fail</varname> is true at the end of a chain,
	or when a <quote xmlns:xlink="http://www.w3.org/1999/xlink">break</quote> is reached, the dispatcher
	returns the error code returned by the first module that
	failed.  Otherwise, it returns
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_SUCCESS</literal>.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The first exception of note is that the error code
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_NEW_AUTHTOK_REQD</literal> is treated like a
	success, except that if no module failed, and at least one
	module returned <literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_NEW_AUTHTOK_REQD</literal>, the
	dispatcher will return
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_NEW_AUTHTOK_REQD</literal>.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The second exception is that <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_setcred</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> treats
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">binding</literal> and
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">sufficient</literal> modules as if they were
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">required</literal>.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The third and final exception is that
	<citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_chauthtok</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> runs the entire chain twice (once for
	preliminary checks and once to actually set the password), and
	in the preliminary phase it treats
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">binding</literal> and
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">sufficient</literal> modules as if they were
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">required</literal>.</para>
    </section>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-freebsd-modules">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-freebsd-modules.title">FreeBSD PAM Modules</title>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-deny">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-deny.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_deny</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_deny</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module is one of the simplest modules
	available; it responds to any request with
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_AUTH_ERR</literal>.  It is useful for quickly
	disabling a service (add it to the top of every chain), or for
	terminating chains of <literal xmlns:xlink="http://www.w3.org/1999/xlink">sufficient</literal>
	modules.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-echo">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-echo.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_echo</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_echo</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module simply passes its arguments to
	the conversation function as a
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_TEXT_INFO</literal> message.  It is mostly useful
	for debugging, but can also serve to display messages such as
	<quote xmlns:xlink="http://www.w3.org/1999/xlink">Unauthorized access will be prosecuted</quote> before
	starting the authentication procedure.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-exec">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-exec.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_exec</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_exec</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module takes its first argument to be
	the name of a program to execute, and the remaining arguments
	are passed to that program as command-line arguments.  One
	possible application is to use it to run a program at login
	time which mounts the user's home directory.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-ftpusers">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-ftpusers.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_ftpusers</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_ftpusers</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-group">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-group.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_group</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_group</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module accepts or rejects applicants
	on the basis of their membership in a particular file group
	(normally <literal xmlns:xlink="http://www.w3.org/1999/xlink">wheel</literal> for <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>).  It is
	primarily intended for maintaining the traditional behaviour
	of BSD <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>, but has many other uses, such as excluding
	certain groups of users from a particular service.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-guest">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-guest.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_guest</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_guest</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module allows guest logins using
	fixed login names.  Various requirements can be placed on the
	password, but the default behaviour is to allow any password
	as long as the login name is that of a guest account.  The
	<citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_guest</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module can easily be used to implement
	anonymous FTP logins.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-krb5">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-krb5.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_krb5</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_krb5</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-ksu">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-ksu.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_ksu</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_ksu</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-lastlog">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-lastlog.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_lastlog</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_lastlog</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-login-access">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-login-access.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_login_access</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_login_access</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module provides an
	implementation of the account management primitive which
	enforces the login restrictions specified in the
	<citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">login.access</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">5</manvolnum></citerefentry> table.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-nologin">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-nologin.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_nologin</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_nologin</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module refuses non-root logins
	when <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/run/nologin</filename> exists.  This file
	is normally created by <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">shutdown</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> when less than five
	minutes remain until the scheduled shutdown time.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-opie">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-opie.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module implements the <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">4</manvolnum></citerefentry>
	authentication method.  The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">4</manvolnum></citerefentry> system is a
	challenge-response mechanism where the response to each
	challenge is a direct function of the challenge and a
	passphrase, so the response can be easily computed <quote xmlns:xlink="http://www.w3.org/1999/xlink">just
	in time</quote> by anyone possessing the passphrase,
	eliminating the need for password lists.  Moreover, since
	<citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">4</manvolnum></citerefentry> never reuses a challenge that has been correctly
	answered, it is not vulnerable to replay attacks.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-opieaccess">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-opieaccess.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opieaccess</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opieaccess</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module is a companion module to
	<citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry>.  Its purpose is to enforce the restrictions
	codified in <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">opieaccess</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">5</manvolnum></citerefentry>, which regulate the conditions
	under which a user who would normally authenticate herself
	using <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">4</manvolnum></citerefentry> is allowed to use alternate methods.  This
	is most often used to prohibit the use of password
	authentication from untrusted hosts.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">In order to be effective, the <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opieaccess</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry>
	module must be listed as <literal xmlns:xlink="http://www.w3.org/1999/xlink">requisite</literal>
	immediately after a <literal xmlns:xlink="http://www.w3.org/1999/xlink">sufficient</literal> entry for
	<citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry>, and before any other modules, in the
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">auth</literal> chain.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-passwdqc">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-passwdqc.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_passwdqc</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_passwdqc</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-permit">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-permit.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_permit</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_permit</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module is one of the simplest
	modules available; it responds to any request with
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_SUCCESS</literal>.  It is useful as a placeholder
	for services where one or more chains would otherwise be
	empty.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-radius">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-radius.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_radius</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_radius</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-rhosts">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-rhosts.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_rhosts</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_rhosts</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-rootok">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-rootok.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_rootok</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_rootok</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module reports success if and only
	if the real user id of the process calling it (which is
	assumed to be run by the applicant) is 0.  This is useful for
	non-networked services such as <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> or <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">passwd</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>,
	to which the <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal> should have automatic
	access.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-securetty">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-securetty.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_securetty</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_securetty</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-self">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-self.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_self</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_self</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module reports success if and only if
	the names of the applicant matches that of the target account.
	It is most useful for non-networked services such as
	<citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>, where the identity of the applicant can be easily
	verified.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-ssh">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-ssh.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_ssh</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_ssh</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module provides both authentication
	and session services.  The authentication service allows users
	who have passphrase-protected SSH secret keys in their
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">~/.ssh</filename> directory to authenticate
	themselves by typing their passphrase.  The session service
	starts <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">ssh-agent</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> and preloads it with the keys that
	were decrypted in the authentication phase.  This feature is
	particularly useful for local logins, whether in X (using
	<citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" vendor="xfree86"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">xdm</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> or another PAM-aware X login manager) or at the
	console.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-tacplus">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-tacplus.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_tacplus</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_tacplus</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-unix">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-unix.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_unix</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">The <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_unix</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> module implements traditional <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark>
	password authentication, using <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">getpwnam</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> to obtain the
	target account's password and compare it with the one provided
	by the applicant.  It also provides account management
	services (enforcing account and password expiration times) and
	password-changing services.  This is probably the single most
	useful module, as the great majority of admins will want to
	maintain historical behaviour for at least some
	services.</para>
    </section>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-appl-prog">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-appl-prog.title">PAM Application Programming</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><!--XXX-->This section has not yet been written.</para>

    <!--

      Note that while the original PAM paper includes a sample PAM
      application that calls pam_open_session() before pam_setcred(),
      the Linux-PAM documentation states that pam_setcred() must be
      called first, which makes more sense.

      Also note that the example in the paper calls setgid(),
      initgroups() and setuid() itself rather than rely on
      pam_setcred() to do it.

      -->

  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-module-prog">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-module-prog.title">PAM Module Programming</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><!--XXX-->This section has not yet been written.</para>
  </section>

  <appendix xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-sample-appl">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-sample-appl.title">Sample PAM Application</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The following is a minimal implementation of <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>
      using PAM.  Note that it uses the OpenPAM-specific
      <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">openpam_ttyconv</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> conversation function, which is
      prototyped in <filename xmlns:xlink="http://www.w3.org/1999/xlink">security/openpam.h</filename>.  If you wish
      build this application on a system with a different PAM library,
      you will have to provide your own conversation function.  A
      robust conversation function is surprisingly difficult to
      implement; the one presented in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="pam-sample-conv"/> is a good
      starting point, but should not be used in real-world
      applications.</para>

<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">/*-
 * Copyright (c) 2002,2003 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * ("CBOSS"), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $P4: //depot/projects/openpam/bin/su/su.c#10 $
 * $FreeBSD$
 */

#include &lt;sys/param.h&gt;
#include &lt;sys/wait.h&gt;

#include &lt;err.h&gt;
#include &lt;pwd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;syslog.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_appl.h&gt;
#include &lt;security/openpam.h&gt;	/* for openpam_ttyconv() */

extern char **environ;

static pam_handle_t *pamh;
static struct pam_conv pamc;

static void
usage(void)
{

	fprintf(stderr, "Usage: su [login [args]]\n");
	exit(1);
}

int
main(int argc, char *argv[])
{
	char hostname[MAXHOSTNAMELEN];
	const char *user, *tty;
	char **args, **pam_envlist, **pam_env;
	struct passwd *pwd;
	int o, pam_err, status;
	pid_t pid;

	while ((o = getopt(argc, argv, "h")) != -1)
		switch (o) {
		case 'h':
		default:
			usage();
		}

	argc -= optind;
	argv += optind;

	if (argc &gt; 0) {
		user = *argv;
		--argc;
		++argv;
	} else {
		user = "root";
	}

	/* initialize PAM */
	pamc.conv = &amp;openpam_ttyconv;
	pam_start("su", user, &amp;pamc, &amp;pamh);

	/* set some items */
	gethostname(hostname, sizeof(hostname));
	if ((pam_err = pam_set_item(pamh, PAM_RHOST, hostname)) != PAM_SUCCESS)
		goto pamerr;
	user = getlogin();
	if ((pam_err = pam_set_item(pamh, PAM_RUSER, user)) != PAM_SUCCESS)
		goto pamerr;
	tty = ttyname(STDERR_FILENO);
	if ((pam_err = pam_set_item(pamh, PAM_TTY, tty)) != PAM_SUCCESS)
		goto pamerr;

	/* authenticate the applicant */
	if ((pam_err = pam_authenticate(pamh, 0)) != PAM_SUCCESS)
		goto pamerr;
	if ((pam_err = pam_acct_mgmt(pamh, 0)) == PAM_NEW_AUTHTOK_REQD)
		pam_err = pam_chauthtok(pamh, PAM_CHANGE_EXPIRED_AUTHTOK);
	if (pam_err != PAM_SUCCESS)
		goto pamerr;

	/* establish the requested credentials */
	if ((pam_err = pam_setcred(pamh, PAM_ESTABLISH_CRED)) != PAM_SUCCESS)
		goto pamerr;

	/* authentication succeeded; open a session */
	if ((pam_err = pam_open_session(pamh, 0)) != PAM_SUCCESS)
		goto pamerr;

	/* get mapped user name; PAM may have changed it */
	pam_err = pam_get_item(pamh, PAM_USER, (const void **)&amp;user);
	if (pam_err != PAM_SUCCESS || (pwd = getpwnam(user)) == NULL)
		goto pamerr;

	/* export PAM environment */
	if ((pam_envlist = pam_getenvlist(pamh)) != NULL) {
		for (pam_env = pam_envlist; *pam_env != NULL; ++pam_env) {
			putenv(*pam_env);
			free(*pam_env);
		}
		free(pam_envlist);
	}

	/* build argument list */
	if ((args = calloc(argc + 2, sizeof *args)) == NULL) {
		warn("calloc()");
		goto err;
	}
	*args = pwd-&gt;pw_shell;
	memcpy(args + 1, argv, argc * sizeof *args);

	/* fork and exec */
	switch ((pid = fork())) {
	case -1:
		warn("fork()");
		goto err;
	case 0:
		/* child: give up privs and start a shell */

		/* set uid and groups */
		if (initgroups(pwd-&gt;pw_name, pwd-&gt;pw_gid) == -1) {
			warn("initgroups()");
			_exit(1);
		}
		if (setgid(pwd-&gt;pw_gid) == -1) {
			warn("setgid()");
			_exit(1);
		}
		if (setuid(pwd-&gt;pw_uid) == -1) {
			warn("setuid()");
			_exit(1);
		}
		execve(*args, args, environ);
		warn("execve()");
		_exit(1);
	default:
		/* parent: wait for child to exit */
		waitpid(pid, &amp;status, 0);

		/* close the session and release PAM resources */
		pam_err = pam_close_session(pamh, 0);
		pam_end(pamh, pam_err);

		exit(WEXITSTATUS(status));
	}

pamerr:
	fprintf(stderr, "Sorry\n");
err:
	pam_end(pamh, pam_err);
	exit(1);
}
</programlisting>
  </appendix>

  <appendix xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-sample-module">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-sample-module.title">Sample PAM Module</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The following is a minimal implementation of
      <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_unix</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry>, offering only authentication services.  It
      should build and run with most PAM implementations, but takes
      advantage of OpenPAM extensions if available: note the use of
      <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_get_authtok</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry>, which enormously simplifies prompting
      the user for a password.</para>

<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">/*-
 * Copyright (c) 2002 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * ("CBOSS"), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $P4: //depot/projects/openpam/modules/pam_unix/pam_unix.c#3 $
 * $FreeBSD$
 */

#include &lt;sys/param.h&gt;

#include &lt;pwd.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_modules.h&gt;
#include &lt;security/pam_appl.h&gt;

#ifndef _OPENPAM
static char password_prompt[] = "Password:";
#endif

#ifndef PAM_EXTERN
#define PAM_EXTERN
#endif

PAM_EXTERN int
pam_sm_authenticate(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{
#ifndef _OPENPAM
	struct pam_conv *conv;
	struct pam_message msg;
	const struct pam_message *msgp;
	struct pam_response *resp;
#endif
	struct passwd *pwd;
	const char *user;
	char *crypt_password, *password;
	int pam_err, retry;

	/* identify user */
	if ((pam_err = pam_get_user(pamh, &amp;user, NULL)) != PAM_SUCCESS)
		return (pam_err);
	if ((pwd = getpwnam(user)) == NULL)
		return (PAM_USER_UNKNOWN);

	/* get password */
#ifndef _OPENPAM
	pam_err = pam_get_item(pamh, PAM_CONV, (const void **)&amp;conv);
	if (pam_err != PAM_SUCCESS)
		return (PAM_SYSTEM_ERR);
	msg.msg_style = PAM_PROMPT_ECHO_OFF;
	msg.msg = password_prompt;
	msgp = &amp;msg;
#endif
	for (retry = 0; retry &lt; 3; ++retry) {
#ifdef _OPENPAM
		pam_err = pam_get_authtok(pamh, PAM_AUTHTOK,
		    (const char **)&amp;password, NULL);
#else
		resp = NULL;
		pam_err = (*conv-&gt;conv)(1, &amp;msgp, &amp;resp, conv-&gt;appdata_ptr);
		if (resp != NULL) {
			if (pam_err == PAM_SUCCESS)
				password = resp-&gt;resp;
			else
				free(resp-&gt;resp);
			free(resp);
		}
#endif
		if (pam_err == PAM_SUCCESS)
			break;
	}
	if (pam_err == PAM_CONV_ERR)
		return (pam_err);
	if (pam_err != PAM_SUCCESS)
		return (PAM_AUTH_ERR);

	/* compare passwords */
	if ((!pwd-&gt;pw_passwd[0] &amp;&amp; (flags &amp; PAM_DISALLOW_NULL_AUTHTOK)) ||
	    (crypt_password = crypt(password, pwd-&gt;pw_passwd)) == NULL ||
	    strcmp(crypt_password, pwd-&gt;pw_passwd) != 0)
		pam_err = PAM_AUTH_ERR;
	else
		pam_err = PAM_SUCCESS;
#ifndef _OPENPAM
	free(password);
#endif
	return (pam_err);
}

PAM_EXTERN int
pam_sm_setcred(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_acct_mgmt(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_open_session(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_close_session(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_chauthtok(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SERVICE_ERR);
}

#ifdef PAM_MODULE_ENTRY
PAM_MODULE_ENTRY("pam_unix");
#endif
</programlisting>
  </appendix>

  <appendix xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-sample-conv">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-sample-conv.title">Sample PAM Conversation
      Function</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">The conversation function presented below is a greatly
      simplified version of OpenPAM's <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">openpam_ttyconv</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry>.  It is
      fully functional, and should give the reader a good idea of how
      a conversation function should behave, but it is far too simple
      for real-world use.  Even if you are not using OpenPAM, feel free
      to download the source code and adapt <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">openpam_ttyconv</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> to
      your uses; we believe it to be as robust as a tty-oriented
      conversation function can reasonably get.</para>

<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">/*-
 * Copyright (c) 2002 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * ("CBOSS"), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $FreeBSD$
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_appl.h&gt;

int
converse(int n, const struct pam_message **msg,
	struct pam_response **resp, void *data)
{
	struct pam_response *aresp;
	char buf[PAM_MAX_RESP_SIZE];
	int i;

	data = data;
	if (n &lt;= 0 || n &gt; PAM_MAX_NUM_MSG)
		return (PAM_CONV_ERR);
	if ((aresp = calloc(n, sizeof *aresp)) == NULL)
		return (PAM_BUF_ERR);
	for (i = 0; i &lt; n; ++i) {
		aresp[i].resp_retcode = 0;
		aresp[i].resp = NULL;
		switch (msg[i]-&gt;msg_style) {
		case PAM_PROMPT_ECHO_OFF:
			aresp[i].resp = strdup(getpass(msg[i]-&gt;msg));
			if (aresp[i].resp == NULL)
				goto fail;
			break;
		case PAM_PROMPT_ECHO_ON:
			fputs(msg[i]-&gt;msg, stderr);
			if (fgets(buf, sizeof buf, stdin) == NULL)
				goto fail;
			aresp[i].resp = strdup(buf);
			if (aresp[i].resp == NULL)
				goto fail;
			break;
		case PAM_ERROR_MSG:
			fputs(msg[i]-&gt;msg, stderr);
			if (strlen(msg[i]-&gt;msg) &gt; 0 &amp;&amp;
			    msg[i]-&gt;msg[strlen(msg[i]-&gt;msg) - 1] != '\n')
				fputc('\n', stderr);
			break;
		case PAM_TEXT_INFO:
			fputs(msg[i]-&gt;msg, stdout);
			if (strlen(msg[i]-&gt;msg) &gt; 0 &amp;&amp;
			    msg[i]-&gt;msg[strlen(msg[i]-&gt;msg) - 1] != '\n')
				fputc('\n', stdout);
			break;
		default:
			goto fail;
		}
	}
	*resp = aresp;
	return (PAM_SUCCESS);
 fail:
        for (i = 0; i &lt; n; ++i) {
                if (aresp[i].resp != NULL) {
                        memset(aresp[i].resp, 0, strlen(aresp[i].resp));
                        free(aresp[i].resp);
                }
        }
        memset(aresp, 0, n * sizeof *aresp);
	*resp = NULL;
	return (PAM_CONV_ERR);
}
</programlisting>
  </appendix>

  <bibliography xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-further">
    <info><title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-further.title">Further Reading</title>
    

    <abstract xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">This is a list of documents relevant to PAM and related
	issues.  It is by no means complete.</para>
    </abstract>
    </info>

    <bibliodiv xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Papers</title>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.sun.com/software/solaris/pam/pam.external.pdf">
	  Making Login Services Independent of Authentication
	  Technologies</link></citetitle>
	<authorgroup xmlns:xlink="http://www.w3.org/1999/xlink">
	  <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><surname xmlns:xlink="http://www.w3.org/1999/xlink">Samar</surname><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Vipin</firstname></personname></author>
	  <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><surname xmlns:xlink="http://www.w3.org/1999/xlink">Lai</surname><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Charlie</firstname></personname></author>
	</authorgroup>
	<orgname xmlns:xlink="http://www.w3.org/1999/xlink">Sun Microsystems</orgname>
      </biblioentry>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.opengroup.org/pubs/catalog/p702.htm">X/Open
	  Single Sign-on Preliminary Specification</link></citetitle>
	<orgname xmlns:xlink="http://www.w3.org/1999/xlink">The Open Group</orgname>
	<biblioid xmlns:xlink="http://www.w3.org/1999/xlink" class="isbn">1-85912-144-6</biblioid>
	<pubdate xmlns:xlink="http://www.w3.org/1999/xlink">June 1997</pubdate>
      </biblioentry>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.kernel.org/pub/linux/libs/pam/pre/doc/current-draft.txt">
	  Pluggable Authentication Modules</link></citetitle>
	<author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><surname xmlns:xlink="http://www.w3.org/1999/xlink">Morgan</surname><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Andrew</firstname><othername xmlns:xlink="http://www.w3.org/1999/xlink" role="mi">G.</othername></personname></author>
	<pubdate xmlns:xlink="http://www.w3.org/1999/xlink">1999-10-06</pubdate>
      </biblioentry>
    </bibliodiv>

    <bibliodiv xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">User Manuals</title>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.sun.com/software/solaris/pam/pam.admin.pdf">PAM
	  Administration</link></citetitle>
	<orgname xmlns:xlink="http://www.w3.org/1999/xlink">Sun Microsystems</orgname>
      </biblioentry>
    </bibliodiv>

    <bibliodiv xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Related Web pages</title>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://openpam.sourceforge.net/">OpenPAM homepage</link></citetitle>
	<author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><surname xmlns:xlink="http://www.w3.org/1999/xlink">Smørgrav</surname><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Dag-Erling</firstname></personname></author>
	<orgname xmlns:xlink="http://www.w3.org/1999/xlink">ThinkSec AS</orgname>
      </biblioentry>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.kernel.org/pub/linux/libs/pam/">Linux-PAM homepage</link></citetitle>
	<author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><surname xmlns:xlink="http://www.w3.org/1999/xlink">Morgan</surname><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Andrew</firstname><othername xmlns:xlink="http://www.w3.org/1999/xlink" role="mi">G.</othername></personname></author>
      </biblioentry>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
	<citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://wwws.sun.com/software/solaris/pam/">Solaris PAM homepage</link></citetitle>
	<orgname xmlns:xlink="http://www.w3.org/1999/xlink">Sun Microsystems</orgname>
      </biblioentry>
    </bibliodiv>
  </bibliography>
</article>
