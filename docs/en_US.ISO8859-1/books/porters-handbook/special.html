<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>Chapter 6. Special Considerations</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="prev" href="install.html" title="5.15. Installing Files" /><link rel="next" href="bundled-libs.html" title="6.2. Bundled Libraries" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 6. Special Considerations</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="install.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="bundled-libs.html">Next</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="special"></a>Chapter 6. Special Considerations</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="special.html#staging">6.1. Staging</a></span></dt><dt><span class="sect1"><a href="bundled-libs.html">6.2. Bundled Libraries</a></span></dt><dt><span class="sect1"><a href="porting-shlibs.html">6.3. Shared Libraries</a></span></dt><dt><span class="sect1"><a href="porting-restrictions.html">6.4. Ports with Distribution Restrictions or Legal
      Concerns</a></span></dt><dt><span class="sect1"><a href="building.html">6.5. Building Mechanisms</a></span></dt><dt><span class="sect1"><a href="using-autotools.html">6.6. Using GNU Autotools</a></span></dt><dt><span class="sect1"><a href="using-gettext.html">6.7. Using GNU <code class="literal">gettext</code></a></span></dt><dt><span class="sect1"><a href="using-perl.html">6.8. Using <span class="application">Perl</span></a></span></dt><dt><span class="sect1"><a href="using-x11.html">6.9. Using X11</a></span></dt><dt><span class="sect1"><a href="using-gnome.html">6.10. Using GNOME</a></span></dt><dt><span class="sect1"><a href="using-qt.html">6.11. Using Qt</a></span></dt><dt><span class="sect1"><a href="using-kde.html">6.12. Using KDE</a></span></dt><dt><span class="sect1"><a href="using-java.html">6.13. Using Java</a></span></dt><dt><span class="sect1"><a href="using-php.html">6.14. Web Applications, Apache and PHP</a></span></dt><dt><span class="sect1"><a href="using-python.html">6.15. Using Python</a></span></dt><dt><span class="sect1"><a href="using-tcl.html">6.16. Using <span class="application">Tcl/Tk</span></a></span></dt><dt><span class="sect1"><a href="using-emacs.html">6.17. Using Emacs</a></span></dt><dt><span class="sect1"><a href="using-ruby.html">6.18. Using Ruby</a></span></dt><dt><span class="sect1"><a href="using-sdl.html">6.19. Using SDL</a></span></dt><dt><span class="sect1"><a href="using-wx.html">6.20. Using <span class="application">wxWidgets</span></a></span></dt><dt><span class="sect1"><a href="using-lua.html">6.21. Using <span class="application">Lua</span></a></span></dt><dt><span class="sect1"><a href="using-iconv.html">6.22. Using <code class="command">iconv</code></a></span></dt><dt><span class="sect1"><a href="using-xfce.html">6.23. Using Xfce</a></span></dt><dt><span class="sect1"><a href="using-mozilla.html">6.24. Using Mozilla</a></span></dt><dt><span class="sect1"><a href="using-databases.html">6.25. Using Databases</a></span></dt><dt><span class="sect1"><a href="rc-scripts.html">6.26. Starting and Stopping Services (<code class="literal">rc</code>
      Scripts)</a></span></dt><dt><span class="sect1"><a href="users-and-groups.html">6.27. Adding Users and Groups</a></span></dt><dt><span class="sect1"><a href="requiring-kernel-sources.html">6.28. Ports That Rely on Kernel Sources</a></span></dt></dl></div><p>This section explains the most common things to consider when
    creating a port.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="staging"></a>6.1. Staging</h2></div></div></div><p><code class="filename">bsd.port.mk</code> expects ports to work
      with a <span class="quote">&#8220;<span class="quote">stage directory</span>&#8221;</span>.  This means that a port
      must not install files directly to the regular destination
      directories (that is, under <code class="varname">PREFIX</code>, for
      example) but instead into a separate directory from which the
      package is then built.  In many cases, this does not require
      root privileges, making it possible to build packages as an
      unprivileged user.  With staging, the port is built and
      installed into the stage directory,
      <code class="varname">STAGEDIR</code>.  A package is created from the
      stage directory and then installed on the system.  Automake
      tools refer to this concept as <code class="varname">DESTDIR</code>, but
      in FreeBSD, <code class="varname">DESTDIR</code> has a different meaning
      (see <a class="xref" href="porting-prefix.html" title="9.4. PREFIX and DESTDIR">Section 9.4, &#8220;<code class="varname">PREFIX</code> and
      <code class="varname">DESTDIR</code>&#8221;</a>).</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">No port <span class="emphasis"><em>really</em></span> needs to be root.  It
	can mostly be avoided by using <a class="link" href="uses.html#uses-uidfix"><code class="literal">USES=uidfix</code></a>.
	If the port still runs commands like <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chown&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">chown</span>(8)</span></a>,
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chgrp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chgrp</span>(1)</span></a>, or forces owner or group with <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=install&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">install</span>(1)</span></a>
	then use <a class="link" href="uses.html#uses-fakeroot"><code class="literal">USES=fakeroot</code></a>
	to fake those calls.  Sligh patching of the port's
	<code class="filename">Makefiles</code> will be needed.</p></div><p>Meta ports, or ports that do not install files themselves
      but only depend on other ports, must avoid needlessly
      extracting the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mtree&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mtree</span>(8)</span></a> to the stage directory.  This is
      the basic directory layout of the package, and these empty
      directories will be seen as orphans.  To prevent
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mtree&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mtree</span>(8)</span></a> extraction, add this line:</p><pre class="programlisting">NO_MTREE=	yes</pre><div xmlns="" class="tip"><h3 class="admontitle">Tip: </h3><p xmlns="http://www.w3.org/1999/xhtml">Metaports should use <a class="link" href="uses.html#uses-metaport"><code class="literal">USES=metaport</code></a>.
	It sets up defaults for ports that do not fetch, build, or
	install anything.</p></div><p>Staging is enabled by prepending
      <code class="varname">STAGEDIR</code> to paths used in the
      <code class="buildtarget">pre-install</code>,
      <code class="buildtarget">do-install</code>, and
      <code class="buildtarget">post-install</code> targets (see the
      examples through the book).  Typically, this includes
      <code class="varname">PREFIX</code>, <code class="varname">ETCDIR</code>,
      <code class="varname">DATADIR</code>, <code class="varname">EXAMPLESDIR</code>,
      <code class="varname">MANPREFIX</code>, <code class="varname">DOCSDIR</code>, and
      so on.  Directories should be created as part of the
      <code class="buildtarget">post-install</code> target.  Avoid using
      absolute paths whenever possible.</p><p>When creating a symlink, <code class="varname">STAGEDIR</code>
      is prepended to the target path only.  For
      example:</p><pre class="programlisting">${LN} -sf <em class="replaceable"><code>libfoo.so.42</code></em> ${STAGEDIR}${PREFIX}/lib/<em class="replaceable"><code>libfoo.so</code></em></pre><p>The source path
      <code class="filename">${PREFIX}/lib/<em class="replaceable"><code>libfoo.so.42</code></em></code> looks fine but
      could, in fact, be incorrect.  Absolute paths can point to a
      wrong location, like when a remote file system has been
      mounted with <acronym class="acronym">NFS</acronym> under a non-root mount
      point.  Relative paths are less fragile, and often much
      shorter.</p><p>Ports that install kernel modules must prepend
      <code class="varname">STAGEDIR</code> to
      their destination, by default
      <code class="filename">/boot/modules</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="install.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="bundled-libs.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">5.15. Installing Files </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 6.2. Bundled Libraries</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>