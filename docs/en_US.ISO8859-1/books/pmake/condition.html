<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>4.3. On the Condition...</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="PMake &#8212; A Tutorial" /><link rel="up" href="gods.html" title="Chapter 4. PMake for Gods" /><link rel="prev" href="archivesandlibraries.html" title="4.2. Archives and Libraries" /><link rel="next" href="ashell.html" title="4.4. A Shell is a Shell is a Shell" /><link rel="copyright" href="legalnotice.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.3. On the Condition...</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="archivesandlibraries.html">Prev</a> </td><th width="60%" align="center">Chapter 4. PMake for Gods</th><td width="20%" align="right"> <a accesskey="n" href="ashell.html">Next</a></td></tr></table><hr /></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="condition"></a>4.3. On the Condition...</h2></div></div></div><p>Like the C compiler before it, <span class="application">PMake</span>
      allows you to configure the makefile, based on the current
      environment, using conditional statements.  A conditional looks like
      this:</p><pre class="programlisting">#if boolean expression
lines
#elif another boolean expression
more lines
#else
still more lines
#endif</pre><p>They may be nested to a maximum depth of 30 and may occur
      anywhere (except in a comment, of course).  The
      <code class="literal">#</code> must the very first character on the
      line.</p><p>Each boolean expression is made up of terms that look
      like function calls, the standard C boolean operators
      <code class="literal">&amp;&amp;</code>, <code class="literal">||</code>, and
      <code class="literal">!</code>, and the standard relational operators
      <code class="literal">==</code>, <code class="literal">!=</code>, <code class="literal">&gt;</code>,
      <code class="literal">&gt;=</code>, <code class="literal">&lt;</code>, and
      <code class="literal">&lt;=</code>, with <code class="literal">==</code> and
      <code class="literal">!=</code> being overloaded to allow string
      comparisons as well.  <code class="literal">&amp;&amp;</code> represents logical
      AND; <code class="literal">||</code> is logical OR and <code class="literal">!</code>
      is logical NOT.  The arithmetic and string operators take
      precedence over all three of these operators, while NOT
      takes precedence over AND, which takes  precedence over OR.
      This precedence may be overridden with parentheses, and an
      expression may be parenthesized to your heart's content.
      Each term looks like a call on one of four functions:</p><div class="informaltable"><table border="0"><colgroup><col /><col /></colgroup><tbody><tr valign="top"><td valign="top"><code class="literal">make</code></td><td valign="top">The syntax is make(target) where target is
	      a target in the  makefile.  This is true if the
	      given target was specified on the command line, or
	      as the source for a <code class="buildtarget">.MAIN</code>
	      target (note that the sources for
	      <code class="buildtarget">.MAIN</code> are only used if no
	      targets were given on the command
	      line).</td></tr><tr valign="top"><td valign="top"><code class="literal">defined</code></td><td valign="top">The syntax is
	      <code class="literal">defined(variable)</code> and is true
	      if variable is defined.  Certain variables are
	      defined in the system makefile that identify the
	      system on which <span class="application">PMake</span>
	      is being run.</td></tr><tr valign="top"><td valign="top"><code class="literal">exists</code></td><td valign="top">The syntax is
	      <code class="literal">exists(file)</code> and is true if the
	      file can be found on the global search path (i.e.
	      that defined by <code class="varname">.PATH</code> targets, not by
	      <code class="buildtarget">.PATH<em class="replaceable"><code>suffix</code></em></code>
	      targets).</td></tr><tr valign="top"><td valign="top"><code class="literal">empty</code></td><td valign="top">This syntax is much like the others, except
	      the string inside the parentheses is of the same
	      form as you would put between parentheses when
	      expanding a variable, complete with modifiers and
	      everything.  The function returns true if the
	      resulting string is empty.  An undefined
	      variable in this context will cause at the very
	      least a warning message about a malformed
	      conditional, and at the worst will cause the process
	      to stop once it has read the makefile.  If you want
	      to check for a variable being defined or empty,
	      use the expression:
	      <code class="literal">!defined(var) || empty(var)</code>
	      as the definition of <code class="literal">||</code> will
	      prevent the <code class="literal">empty()</code> from being
	      evaluated and causing an error, if the variable
	      is undefined.  This can be used to see if a
	      variable contains a given word, for example:
	      <code class="literal">#if !empty(var:Mword)</code></td></tr></tbody></table></div><p>The arithmetic and string operators may only be used to test
      the value of a variable.  The lefthand side must contain the
      variable expansion, while the righthand side contains either
      a string, enclosed in double-quotes, or a number.  The
      standard C numeric conventions (except for specifying an octal
      number) apply to both sides.  E.g.:</p><pre class="programlisting">#if $(OS) == 4.3

#if $(MACHINE) == "sun3"

#if $(LOAD_ADDR) &gt; 0xc000</pre><p>are all valid conditionals.  In addition, the numeric value
      of a variable can be tested as a boolean as follows:</p><pre class="programlisting">#if $(LOAD)</pre><p>would see if <code class="literal">LOAD</code> contains a
      non-zero value and:</p><pre class="programlisting">#if !$(LOAD)</pre><p>would test if <code class="literal">LOAD</code> contains a
      zero value.</p><p>In addition to the bare <code class="literal">#if</code>, there are other
      forms that apply one of the first two functions to each term.
      They are as follows:</p><div class="informaltable"><table border="0"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="literal">ifdef</code></td><td><code class="literal">defined</code></td></tr><tr><td><code class="literal">ifndef</code></td><td><code class="literal">!defined</code></td></tr><tr><td><code class="literal">ifmake</code></td><td><code class="literal">make</code></td></tr><tr><td><code class="literal">ifnmake</code></td><td><code class="literal">!make</code></td></tr></tbody></table></div><p>There are also the <span class="quote">&#8220;<span class="quote"><code class="literal">else
      if</code></span>&#8221;</span> forms: <code class="literal">elif</code>,
      <code class="literal">elifdef</code>, <code class="literal">elifndef</code>,
      <code class="literal">elifmake</code>, and <code class="literal">elifnmake</code>.</p><p>For instance, if you wish to create two versions of a
      program, one of which is optimized (the production version) and
      the other of which is for debugging (has symbols for dbx),
      you have two choices: you can create two makefiles, one of
      which uses the <code class="option">-g</code> flag for the compilation,
      while the other uses the <code class="option">-O</code> flag, or you
      can use another target (call it debug) to create the debug
      version.  The construct below will take care of this for you.
      I have also made it  so  defining the variable
      <code class="envar">DEBUG</code> (say with <code class="command">pmake -D DEBUG</code>)
      will also cause the debug version to be made.</p><pre class="programlisting">#if defined(DEBUG) || make(debug)
CFLAGS         += -g
#else
CFLAGS         += -O
#endif</pre><p>There are, of course, problems with this approach.  The most
      glaring annoyance is that if you want to go from making a
      debug version to making a production version, you have to
      remove all the object files, or you will get some optimized
      and some debug versions in the same program.  Another
      annoyance is you have to be careful not to make two targets that
      <span class="quote">&#8220;<span class="quote">conflict</span>&#8221;</span> because of some conditionals in the makefile.
      For instance:</p><pre class="programlisting">#if make(print)
FORMATTER = ditroff -Plaser_printer
#endif
#if make(draft)
FORMATTER = nroff -Pdot_matrix_printer
#endif</pre><p>would wreak havoc if you tried <code class="command">pmake draft print</code>
      since you would use the same formatter for each target.  As I said,
      this all gets somewhat complicated.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="archivesandlibraries.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="gods.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ashell.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4.2. Archives and Libraries </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 4.4. A Shell is a Shell is a Shell</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>