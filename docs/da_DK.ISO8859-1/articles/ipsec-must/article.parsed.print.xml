<?xml version="1.0" encoding="iso-8859-1"?>
<!--
    The FreeBSD Documentation Project
    The FreeBSD Danish Documentation Project

    $FreeBSD$
    Original revision: 1.13
-->
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:lang="da">
  <info><title xmlns:xlink="http://www.w3.org/1999/xlink">Uafhængig Verifikation af IPsec Funktionalitet i
      FreeBSD</title>
    

    <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><firstname xmlns:xlink="http://www.w3.org/1999/xlink">David</firstname><surname xmlns:xlink="http://www.w3.org/1999/xlink">Honig</surname></personname><affiliation xmlns:xlink="http://www.w3.org/1999/xlink">
	<address xmlns:xlink="http://www.w3.org/1999/xlink"><email xmlns:xlink="http://www.w3.org/1999/xlink">honig@sprynet.com</email></address>
      </affiliation></author>

    <pubdate xmlns:xlink="http://www.w3.org/1999/xlink">3 Maj 1999</pubdate>

    <legalnotice xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="trademarks" role="trademarks">
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">FreeBSD is a registered trademark of
  the FreeBSD Foundation.</para>
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Motif, OSF/1, and UNIX are
  registered trademarks and IT DialTone and The Open Group are
  trademarks of The Open Group in the United States and other
  countries.</para>
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Many of the designations used by
  manufacturers and sellers to distinguish their products are claimed
  as trademarks.  Where those designations appear in this document,
  and the FreeBSD Project was aware of the trademark claim, the
  designations have been followed by the <quote xmlns:xlink="http://www.w3.org/1999/xlink">&#8482;</quote> or the
  <quote xmlns:xlink="http://www.w3.org/1999/xlink">®</quote> symbol.</para>
    </legalnotice>

    <releaseinfo xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</releaseinfo>

    <abstract xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Dansk version af Laust S. Jespersen
  <email xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Laust@doc.freebsd.dk</email>.</emphasis></para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Du installerede IPsec og det ser ud til at virke.  Men
	hvordan ved du det?  Jeg beskriver en metode til
	eksperimentalt at verificere at IPsec virker.</para>
    </abstract>
  </info>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="problem">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Problemet</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Lad os antage, at du har <link xmlns:xlink="http://www.w3.org/1999/xlink" linkend="ipsec-install">
      installeret <emphasis xmlns:xlink="http://www.w3.org/1999/xlink">IPsec</emphasis></link>.  Hvordan ved du
      at det <link xmlns:xlink="http://www.w3.org/1999/xlink" linkend="caveat">virker</link>?
      Selvfølgelig virker din forbindelse ikke hvis den er
      miskonfigureret, og den vil virke når du endelig laver det
      rigtigt.  <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">netstat</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> lister den.  Men kan du verificere det
      uafhængigt?</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="solution">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Løsningen</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Først, noget krypto-relevant teoretisk
      information:</para>

    <orderedlist xmlns:xlink="http://www.w3.org/1999/xlink">
      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">krypterede data er uniformt distribueret, som f.eks. har
	  maksimal entropi pr. symbol;</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">rå, ukomprimerede data er typisk redundant,
	  f.eks., har sub-maksimal entropi.</para>
      </listitem>
    </orderedlist>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Hvis du kunne måle entropien af dataene til og fra dit
      netværks interface.  Så kunne du se forskellen
      mellem ukrypterede og krypterede data.  Det ville være
      tilfældet selvom nogle af dataene i <quote xmlns:xlink="http://www.w3.org/1999/xlink">krypteret
      mode</quote> ikke var krypterede, som f.eks. den yderste IP
      header skal være, hvis pakken skal kunne routes.</para>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="MUST">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">MUST</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Ueli Maurers <quote xmlns:xlink="http://www.w3.org/1999/xlink">Universal Statistical Test for Random
	Bit Generators</quote> (<link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.geocities.com/SiliconValley/Code/4704/universal.pdf">
	<acronym xmlns:xlink="http://www.w3.org/1999/xlink">MUST</acronym></link>) måler hurtigt entropien
	af en stikprøve.  Den bruger en kompressionsagtig
	algoritme.  <link xmlns:xlink="http://www.w3.org/1999/xlink" linkend="code">Forneden angives
	kildekoden</link> til en variant der måler successive
	(~kvart megabyte) store bidder af en fil.</para>
    </sect2>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="tcpdump">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Tcpdump</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Vi har også brug for en måde at opsamle de
	rå netværksdata.  Et program kaldet
	<citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">tcpdump</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> lader dig gøre dette, hvis du har slået
	<emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Berkeley Packet Filter</emphasis> interfacet til i
	din <link xmlns:xlink="http://www.w3.org/1999/xlink" linkend="kernel">kerne konfig fil</link>.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Kommandoen</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink"><userinput xmlns:xlink="http://www.w3.org/1999/xlink">tcpdump -c 4000 -s 10000 -w dumpfile.bin</userinput></screen>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">vil opfange 4000 rå pakker til
	<replaceable xmlns:xlink="http://www.w3.org/1999/xlink">dumpfile.bin</replaceable>.  Op til 10.000 bytes
	per pakke bliver opfanget i dette eksempel.</para>
    </sect2>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="experiment">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Eksperimentet</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Her er eksperimentet:</para>

    <procedure xmlns:xlink="http://www.w3.org/1999/xlink">
      <step xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Åbn et vindue til en IPsec vært og et andet
	  vindue til en usikker vært.</para>
      </step>

      <step xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Start nu med at <link xmlns:xlink="http://www.w3.org/1999/xlink" linkend="tcpdump">opfange
	  pakker</link>.</para>
      </step>

      <step xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">I det <quote xmlns:xlink="http://www.w3.org/1999/xlink">sikre</quote> vindue, køres <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark>
	  kommandoen <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">yes</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>, hvilket vil streame
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">y</literal> karakteren.  Stop dette efter et stykke
	  tid.  Skift til det usikre vindue, og gentag.  Stop igen efter
	  et stykke tid.</para>
      </step>

      <step xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Kør nu <link xmlns:xlink="http://www.w3.org/1999/xlink" linkend="code">MUST</link> på de
	  opfangede pakker.  Du skulle se noget lignende det
	  følgende.  Det vigtige at notere sig er, at den sikre
	  forbindelse har 93% (6,7) af den ventede værdi (7.18),
	  og den <quote xmlns:xlink="http://www.w3.org/1999/xlink">normale</quote> forbindelse har 29% (2.1) af den
	  ventede værdi.</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">tcpdump -c 4000 -s 10000 -w ipsecdemo.bin</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">uliscan ipsecdemo.bin</userinput>

Uliscan 21 Dec 98
L=8 256 258560
Measuring file ipsecdemo.bin
Init done
Expected value for L=8 is 7.1836656
6.9396 --------------------------------------------------------
6.6177 -----------------------------------------------------
6.4100 ---------------------------------------------------
2.1101 -----------------
2.0838 -----------------
2.0983 -----------------</screen>
      </step>
    </procedure>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="caveat">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Undtagelse</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Dette eksperiment viser at, IPsec <emphasis xmlns:xlink="http://www.w3.org/1999/xlink">kan</emphasis>
      se ud til at distribuere payload data
      <emphasis xmlns:xlink="http://www.w3.org/1999/xlink">uniformt</emphasis>, som kryptering skal.  Men det
      eksperiment der er beskrevet her <emphasis xmlns:xlink="http://www.w3.org/1999/xlink">kan ikke</emphasis>
      detektere mange mulige fejl i et system (ingen af hvilke jeg har
      nogle beviser for).  Disse inkluderer dårlig nøgle
      generering eller udveksling, data eller nøgler der kan
      ses af andre, brug af svage algoritmer, kernel undergravning,
      osv.  Studér kildekoden; kend kildekoden.</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="IPsec">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">IPsec---Definition</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Internet Protokol sikkerheds udvidelser til IPv4;
      krævet for IPv6.  En protokol til at forhandle kryptering
      og autentifikation på IP (vært-til-vært)
      niveau.  SSL sikrer kun en applikationssocket;
      <application xmlns:xlink="http://www.w3.org/1999/xlink">SSH</application> sikrer kun et login;
      <application xmlns:xlink="http://www.w3.org/1999/xlink">PGP</application> sikrer kun en specifik fil eller
      besked.  IPsec krypterer alting mellem to værter.</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="ipsec-install">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Installering af IPsec</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">De fleste af de moderne versioner af FreeBSD har IPsec
      support i deres base kildekode.  Så du er sikkert
      nødt til at inkludere <option xmlns:xlink="http://www.w3.org/1999/xlink">IPSEC</option> optionen i
      din kernel konfig og, efter genbygning og reinstallation af
      kernel, konfigurere IPsec forbindelser ved hjælp af
      <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">setkey</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> kommandoen.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">En udførlig guide om at køre IPsec på
      FreeBSD er tilrådighed i <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="../../books/handbook/ipsec.html">FreeBSD
      Håndbogen</link>.</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="kernel">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">src/sys/i386/conf/KERNELNAME</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Dette skal være til stede i kernel konfig filen for at
      være i stand til at opfange netværksdata med
      <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">tcpdump</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>.  Vær sikker på at køre
      <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">config</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> efter at tilføje dette, og genbygge og
      reinstallere.</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">device	bpf</programlisting>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="code">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Maurers universelle statistiske test (for blok
      størrelse=8 bits)</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Du kan finde samme kode på <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.geocities.com/SiliconValley/Code/4704/uliscanc.txt">
      dette link</link>.</para>

<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">/*
  ULISCAN.c   ---blocksize of 8

  1 Oct 98
  1 Dec 98
  21 Dec 98       uliscan.c derived from ueli8.c

  This version has // comments removed for Sun cc

  This implements Ueli M Maurer's "Universal Statistical Test for Random
  Bit Generators" using L=8

  Accepts a filename on the command line; writes its results, with other
  info, to stdout.

  Handles input file exhaustion gracefully.

  Ref: J. Cryptology v 5 no 2, 1992 pp 89-105
  also on the web somewhere, which is where I found it.

  -David Honig
  honig@sprynet.com

  Usage:
  ULISCAN filename
  outputs to stdout
*/

#define L 8
#define V (1&lt;&lt;L)
#define Q (10*V)
#define K (100   *Q)
#define MAXSAMP (Q + K)

#include &lt;stdio.h&gt;
#include &lt;math.h&gt;

int main(argc, argv)
int argc;
char **argv;
{
  FILE *fptr;
  int i,j;
  int b, c;
  int table[V];
  double sum = 0.0;
  int iproduct = 1;
  int run;

  extern double   log(/* double x */);

  printf("Uliscan 21 Dec 98 \nL=%d %d %d \n", L, V, MAXSAMP);

  if (argc &lt; 2) {
    printf("Usage: Uliscan filename\n");
    exit(-1);
  } else {
    printf("Measuring file %s\n", argv[1]);
  }

  fptr = fopen(argv[1],"rb");

  if (fptr == NULL) {
    printf("Can't find %s\n", argv[1]);
    exit(-1);
  }

  for (i = 0; i &lt; V; i++) {
    table[i] = 0;
  }

  for (i = 0; i &lt; Q; i++) {
    b = fgetc(fptr);
    table[b] = i;
  }

  printf("Init done\n");

  printf("Expected value for L=8 is 7.1836656\n");

  run = 1;

  while (run) {
    sum = 0.0;
    iproduct = 1;

    if (run)
      for (i = Q; run &amp;&amp; i &lt; Q + K; i++) {
        j = i;
        b = fgetc(fptr);

        if (b &lt; 0)
          run = 0;

        if (run) {
          if (table[b] &gt; j)
            j += K;

          sum += log((double)(j-table[b]));

          table[b] = i;
        }
      }

    if (!run)
      printf("Premature end of file; read %d blocks.\n", i - Q);

    sum = (sum/((double)(i - Q))) /  log(2.0);
    printf("%4.4f ", sum);

    for (i = 0; i &lt; (int)(sum*8.0 + 0.50); i++)
      printf("-");

    printf("\n");

    /* refill initial table */
    if (0) {
      for (i = 0; i &lt; Q; i++) {
        b = fgetc(fptr);
        if (b &lt; 0) {
          run = 0;
        } else {
          table[b] = i;
        }
      }
    }
  }
}</programlisting>
  </sect1>
</article>
