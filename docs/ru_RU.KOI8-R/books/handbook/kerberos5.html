<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>14.8. Kerberos5</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="security.html" title="Глава 14. Безопасность" /><link rel="prev" href="kerberosIV.html" title="14.7. KerberosIV" /><link rel="next" href="openssl.html" title="14.9. OpenSSL" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.8. <span class="application">Kerberos5</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kerberosIV.html">Пред.</a> </td><th width="60%" align="center">Глава 14. Безопасность</th><td width="20%" align="right"> <a accesskey="n" href="openssl.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kerberos5"></a>14.8. <span class="application">Kerberos5</span></h2></div><div><span class="authorgroup">Предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tillman</span> <span class="surname">Hodgson</span></span>. </span></div><div><span class="authorgroup">Оригинальный материал предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Mark</span> <span class="surname">Murray</span></span>. </span></div></div></div><p>Все релизы FreeBSD после FreeBSD-5.1 включают поддержку только
      <span class="application">Kerberos5</span>.  Таким образом,
      <span class="application">Kerberos5</span> это единственная включаемая в
      поставку версия и его конфигурация похожа на
      <span class="application">KerberosIV</span> во многих аспектах.  Эта
      информация применима только к <span class="application">Kerberos5</span>
      из релизов после FreeBSD-5.0.  Пользователи, желающие использовать
      пакет <span class="application">KerberosIV</span>, могут установить его из
      порта <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/krb4/pkg-descr">security/krb4</a>.</p><p><span class="application">Kerberos</span> это дополнительная сетевая
      система/протокол, позволяющая пользователям авторизоваться через
      защищенные сервисы на защищенном сервере.  Такие сервисы как
      удаленный вход, удаленное копирование, защищенное копирование файлов
      между системами и другие задачи с высоким риском становятся
      допустимо безопасными и более контролируемыми.</p><p><span class="application">Kerberos</span> может быть описана как
      прокси система идентификации-проверки.  Она также может быть описана
      как защищенная внешняя система аутентификации.
      <span class="application">Kerberos</span> предоставляет только одну функцию
      - защищенную аутентификацию пользователей сети.
      Он не предоставляет функций авторизации (что разрешено делать
      пользователям) или функций аудита (какой пользователь что делает).
      После того, как клиент и сервер использовали
      <span class="application">Kerberos</span> для идентификации, они могут
      зашифровать все соединения для гарантирования собственной безопасности и
      целостности данных.</p><p>Следовательно крайне рекомендуется использовать
      <span class="application">Kerberos</span> с другими методами безопасности,
      предоставляющими сервисы авторизации и аудита.</p><p>Последующие инструкции могут использоваться в качестве руководства
      по настройке <span class="application">Kerberos</span>, поставляемого с FreeBSD.
      Тем не менее, вам потребуется обратиться к соответствующим страницам
      справочника за полным описанием.</p><p>В целях демонстрации установки <span class="application">Kerberos</span>,
      будут применены следующие обозначения:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><acronym class="acronym">DNS</acronym> домен (<span class="quote"><<<span class="quote">зона</span>>></span>)
	  example.org.</p></li><li class="listitem"><p>Уникальный идентификатор <span class="application">Kerberos</span>
	  EXAMPLE.ORG.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Используйте действующие имена доменов при настройке
	<span class="application">Kerberos</span> даже если вы будете использовать
	его во внутренней сети.  Это позволит избежать проблем с
	<acronym class="acronym">DNS</acronym> и гарантирует возможность связи с
	<span class="application">Kerberos</span> под другими
	идентификаторами.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88739920"></a>14.8.1. История</h3></div></div></div><a id="idp88740560" class="indexterm"></a><p><span class="application">Kerberos</span> был создан
	<acronym class="acronym">MIT</acronym> в качестве решения проблем с безопасностью
	сети.  Протокол <span class="application">Kerberos</span> использует
	стойкую криптографию, так что клиент может идентифицироваться на
	сервере (и обратно) через незащищенное сетевое соединение.</p><p><span class="application">Kerberos</span> это и имя сетевого протокола
	аутентификации и общий термин для описания программ, где он
	реализован (например, <span class="application">Kerberos</span> telnet).
	Текущая версия протокола 5 описана в
	<acronym class="acronym">RFC</acronym> 1510.</p><p>Доступно несколько свободных реализаций этого протокола,
	работающих на множестве операционных систем.  Massachusetts
	Institute of Technology (<acronym class="acronym">MIT</acronym>), где
	<span class="application">Kerberos</span> был первоначально разработан,
	продолжает разрабатывать собственный пакет
	<span class="application">Kerberos</span>.  Он обычно использовался
	в <acronym class="acronym">США</acronym> как криптографический продукт,
	и в этом качестве попадал под действие ограничений на экспорт.
	<acronym class="acronym">MIT</acronym> <span class="application">Kerberos</span>
	доступен в виде порта (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/krb5/pkg-descr">security/krb5</a>).  Heimdal
	<span class="application">Kerberos</span> это другая реализация версии
	5, которая разрабатывалась исключительно вне <acronym class="acronym">США</acronym>
	для обхода экспортных ограничений (и поэтому часто включалась в
	некоммерческие реализации <span class="trademark">UNIX</span>(R)).  Heimdal
	<span class="application">Kerberos</span> доступен в виде порта
	(<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/heimdal/pkg-descr">security/heimdal</a>),
	его минимальный комплект включен в базовую установку FreeBSD.</p><p>В целях получения наибольшей аудитории, в этих инструкциях
	предполагается использование Heimdal включаемого в FreeBSD.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88750288"></a>14.8.2. Настройка Heimdal <acronym class="acronym">KDC</acronym></h3></div></div></div><a id="idp88751184" class="indexterm"></a><p>Центр распространения ключей (Key Distribution Center,
	<acronym class="acronym">KDC</acronym>) это централизованный сервис аутентификации,
	предоставляемый <span class="application">Kerberos</span> -
	это компьютер, который предоставляет доступ через
	<span class="application">Kerberos</span>.  <acronym class="acronym">KDC</acronym>
	считается доверяемым всеми другими компьютерами с определенным
	идентификатором <span class="application">Kerberos</span> и поэтому
	к нему предъявляются высокие требования безопасности.</p><p>Имейте ввиду, что хотя работа сервера
	<span class="application">Kerberos</span> требует очень немного
	вычислительных ресурсов, из соображений безопасности для него
	рекомендуется отдельный компьютер, работающий только в качестве
	<acronym class="acronym">KDC</acronym>.</p><p>Перед началом настройки <acronym class="acronym">KDC</acronym>, убедитесь что в
	файле <code class="filename">/etc/rc.conf</code> содержатся правильные
	настройки для работы в качестве <acronym class="acronym">KDC</acronym> (вам может
	потребоваться изменить пути в соответствии с собственной
	системой):</p><pre class="programlisting">kerberos5_server_enable="YES"
kadmind5_server_enable="YES"</pre><p>Затем приступим к редактированию файла настройки
	<span class="application">Kerberos</span>,
	<code class="filename">/etc/krb5.conf</code>:</p><pre class="programlisting">[libdefaults]
    default_realm = EXAMPLE.ORG
[realms]
    EXAMPLE.ORG = {
        kdc = kerberos.example.org
        admin_server = kerberos.example.org
    }
[domain_realm]
    .example.org = EXAMPLE.ORG</pre><p>Обратите внимание что в файле <code class="filename">/etc/krb5.conf</code>
	подразумевается наличие у <acronym class="acronym">KDC</acronym> полного имени
	<code class="systemitem">kerberos.example.org</code>.  Вам потребуется
	добавить CNAME (синоним) к файлу зоны, если у
	<acronym class="acronym">KDC</acronym> другое имя.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Для больших сетей с правильно настроенным сервером
	  <acronym class="acronym">BIND</acronym> <acronym class="acronym">DNS</acronym> пример выше
	  может быть урезан до:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">[libdefaults]
      default_realm = EXAMPLE.ORG</pre><p xmlns="http://www.w3.org/1999/xhtml">Со следующими строками, добавленными в файл зоны
	  <code class="systemitem">example.org</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">_kerberos._udp      IN  SRV     01 00 88 kerberos.example.org.
_kerberos._tcp      IN  SRV     01 00 88 kerberos.example.org.
_kpasswd._udp       IN  SRV     01 00 464 kerberos.example.org.
_kerberos-adm._tcp  IN  SRV     01 00 749 kerberos.example.org.
_kerberos           IN  TXT     EXAMPLE.ORG</pre></div><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Чтобы клиенты могли найти сервисы
	  <span class="application">Kerberos</span>,
	  <span class="emphasis"><em>необходимо</em></span> наличие или полностью
	  настроенного <code class="filename">/etc/krb5.conf</code> или минимально
	  настроенного <code class="filename">/etc/krb5.conf</code>
	  <span class="emphasis"><em>и</em></span> правильно настроенного DNS
	сервера.</p></div><p>Создадим теперь базу данных <span class="application">Kerberos</span>.
	Эта база данных содержит ключи всех основных хостов, зашифрованных
	с помощью главного пароля.  Вам не требуется помнить этот пароль,
	он хранится в файле (<code class="filename">/var/heimdal/m-key</code>).
	Для создания главного ключа запустите <code class="command">kstash</code>
	и введите пароль.</p><p>Как только будет создан главный ключ, вы можете инициализировать
	базу данных с помощью программы <code class="command">kadmin</code> с ключом
	<code class="literal">-l</code> (означающим <span class="quote"><<<span class="quote">local</span>>></span>).  Этот
	ключ сообщает <code class="command">kadmin</code> обращаться к файлам базы
	данных непосредственно вместо использования сетевого сервиса
	<code class="command">kadmind</code>.  Это помогает решить <span class="quote"><<<span class="quote">проблему
	курицы и яйца</span>>></span>, когда обращение идет к еще не созданной базе
	данных.  Как только вы увидите приглашение <code class="command">kadmin</code>,
	используйте команду <code class="command">init</code> для создания базы
	данных идентификаторов.</p><p>Наконец, оставаясь в приглашении <code class="command">kadmin</code>,
	создайте первую запись с помощью команды <code class="command">add</code>.
	Оставьте неизменными параметры по умолчанию, вы всегда сможете
	изменить их позже с помощью команды <code class="command">modify</code>.
	Обратите внимание, что вы всегда можете использовать команду
	<code class="literal">?</code> для просмотра доступных параметров.</p><p>Пример создания базы данных показан ниже:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kstash</code></strong>
Master key: <strong class="userinput"><code>xxxxxxxx</code></strong>
Verifying password - Master key: <strong class="userinput"><code>xxxxxxxx</code></strong>

<code class="prompt">#</code> <strong class="userinput"><code>kadmin -l</code></strong>
kadmin&gt; <strong class="userinput"><code>init EXAMPLE.ORG</code></strong>
Realm max ticket life [unlimited]:
kadmin&gt; <strong class="userinput"><code>add tillman</code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Attributes []:
Password: <strong class="userinput"><code>xxxxxxxx</code></strong>
Verifying password - Password: <strong class="userinput"><code>xxxxxxxx</code></strong></pre><p>Теперь пришло время запустить сервисы <acronym class="acronym">KDC</acronym>.
	Выполните команды <code class="command">/etc/rc.d/kerberos start</code> и
	<code class="command">/etc/rc.d/kadmind start</code> для запуска сервисов.
	Заметьте, что ни один из поддерживающих
	<span class="application">Kerberos</span>
	даемонов на этот момент запущен не будет, но у вас должна быть
	возможность убедиться в том, что <acronym class="acronym">KDC</acronym> функционирует
	путем получения списка доступа для пользователя, которого вы только
	что самостоятельно создали из командной строки самого
	<acronym class="acronym">KDC</acronym>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>k5init <em class="replaceable"><code>tillman</code></em></code></strong>
tillman@EXAMPLE.ORG's Password:

<code class="prompt">%</code> <strong class="userinput"><code>k5list</code></strong>
Credentials cache: FILE:<code class="filename">/tmp/krb5cc_500</code>
        Principal: tillman@EXAMPLE.ORG

  Issued           Expires          Principal
Aug 27 15:37:58  Aug 28 01:37:58  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88792400"></a>14.8.3. Сервер <span class="application">Kerberos</span> с сервисами
	  Heimdal</h3></div></div></div><a id="idp88793424" class="indexterm"></a><p>Для начала нам потребуется копия файла настройки
	  <span class="application">Kerberos</span>,
	  <code class="filename">/etc/krb5.conf</code>.
	  Просто скопируйте его с <acronym class="acronym">KDC</acronym> на клиентский
	  компьютер безопасным способом (используя сетевые утилиты, такие
	  как <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a>, или физически, с помощью дискеты).</p><p>Затем вам понадобится файл <code class="filename">/etc/krb5.keytab</code>.
	  Это основное различие между сервером, поддерживающим
	  <span class="application">Kerberos</span> и рабочими станциями -
	  на сервере должен быть файл <code class="filename">keytab</code>.
	  В этом файле находится центральный ключ сервера, который позволяет
	  <acronym class="acronym">KDC</acronym> проверять все другие идентификаторы.  Он
	  должен быть помещен на сервер безопасным способом, поскольку
	  безопасность сервера может быть нарушена, если ключ станет
	  общедоступен.  Это означает, что его передача через прозрачный
	  канал, такой как <acronym class="acronym">FTP</acronym> - очень плохая
	  идея.</p><p>Обычно перенос файла <code class="filename">keytab</code> на сервер
	  производится с помощью программы <code class="command">kadmin</code>.
	  Это удобно, поскольку вам потребуется также создать запись хоста
	  (<acronym class="acronym">KDC</acronym> часть <code class="filename">krb5.keytab</code>)
	  с помощью <code class="command">kadmin</code>.</p><p>Обратите внимание, что должны быть уже зарегистрированы в
	  системе и необходимо наличие прав на использование интерфейса
	  <code class="command">kadmin</code> в файле <code class="filename">kadmind.acl</code>.
	  Обратитесь к разделу <span class="quote"><<<span class="quote">Remote administration</span>>></span> в info
	  страницах Heimdal (<code class="command">info heimdal</code>) за деталями по
	  составлению списка доступа.  Если вы не хотите включать удаленный
	  доступ <code class="command">kadmin</code>, можете просто подключиться к
	  <acronym class="acronym">KDC</acronym> через защищенное соединение (локальную
	  консоль, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> или <span class="application">Kerberos</span>
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnet&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">telnet</span>(1)</span></a>) и выполнять администрирование локально с помощью
	  <code class="command">kadmin -l</code>.</p><p>После добавления файла <code class="filename">/etc/krb5.conf</code>,
	  вы можете использовать <code class="command">kadmin</code> с сервера
	  <span class="application">Kerberos</span>.  Команда
	  <code class="command">add --random-key</code> позволит вам добавить запись
	  для сервера, а команда <code class="command">ext</code> позволит перенести
	  эту запись в собственный keytab файл сервера. Например:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt;<strong class="userinput"><code> add --random-key host/myserver.example.org</code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Attributes []:
kadmin&gt;<strong class="userinput"><code> ext host/myserver.example.org</code></strong>
kadmin&gt;<strong class="userinput"><code> exit</code></strong></pre><p>Обратите внимание, что команда <code class="command">ext</code>
	  (сокращение от <span class="quote"><<<span class="quote">extract</span>>></span>) сохраняет полученный ключ в
	  файле <code class="filename">/etc/krb5.keytab</code> по умолчанию.</p><p>Если на <acronym class="acronym">KDC</acronym> не запущен
	  <code class="command">kadmind</code> (возможно по соображениям безопасности)
	  и вы не можете получить доступ к <code class="command">kadmin</code>
	  удаленно, возможно добавление записи хоста
	  (<code class="systemitem">host/myserver.EXAMPLE.ORG</code>) непосредственно
	  на <acronym class="acronym">KDC</acronym> с последующим извлечением ее во временный
	  файл (и перезаписью <code class="filename">/etc/krb5.keytab</code> на
	  <acronym class="acronym">KDC</acronym>) примерно так:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt;<strong class="userinput"><code> ext --keytab=/tmp/example.keytab host/myserver.example.org</code></strong>
kadmin&gt;<strong class="userinput"><code> exit</code></strong></pre><p>Затем вы можете скопировать keytab на сервер защищенным способом
	  (например, используя <code class="command">scp</code> или дискету).
	  Убедитесь, что используемое имя keytab не совпадает с именем
	  по умолчанию во избежание перезаписывания  keytab на
	  <acronym class="acronym">KDC</acronym>.</p><p>Теперь ваш сервер может связываться с <acronym class="acronym">KDC</acronym>
	  (добавлен файл <code class="filename">krb5.conf</code>) и идентифицировать
	  себя (добавлен файл <code class="filename">krb5.keytab</code>).  Теперь вы
	  готовы к включению некоторых сервисов
	  <span class="application">Kerberos</span>.  В этом примере мы включим
	  сервис <code class="command">telnet</code>, поместив в
	  <code class="filename">/etc/inetd.conf</code> нижеприведенную строку и
	  перезапустив сервис <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> командой
	  <code class="command">/etc/rc.d/inetd restart</code>:</p><pre class="programlisting">telnet    stream  tcp     nowait  root    /usr/libexec/telnetd  telnetd -a user</pre><p>Очень важно установить ключ <code class="command">-a</code> (тип
	  аутентификации) в user.  Обратитесь к странице справочника
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">telnetd</span>(8)</span></a> за подробной информацией.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88837328"></a>14.8.4. Клиент <span class="application">Kerberos</span> с Heimdal</h3></div></div></div><a id="idp88838352" class="indexterm"></a><p>Настройка клиентского компьютера почти тривиально проста.
	  Как только настройка <span class="application">Kerberos</span> закончена,
	  вам потребуется только файл настройки
	  <span class="application">Kerberos</span>,
	  <code class="filename">/etc/krb5.conf</code>.  Просто скопируйте его
	  безопасным способом на клиентский компьютер с
	  <acronym class="acronym">KDC</acronym>.</p><p>Протестируйте клиентский компьютер, попытавшись использовать
	  <code class="command">kinit</code>, <code class="command">klist</code>, и
	  <code class="command">kdestroy</code> для получения, отображения и удаления
	  списка доступа.  Соединитесь с <span class="application">Kerberos</span>
	  севером используя клиент <span class="application">Kerberos</span>, если
	  соединение не работает и получение доступа является проблемой,
	  это скорее всего проблема сервера, а не клиента или
	  <acronym class="acronym">KDC</acronym>.</p><p>При тестировании приложения вроде <code class="command">telnet</code>,
	  попробуйте использовать программу перехвата пакетов (такую
	  как <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a>), чтобы убедиться, что ваш пароль не передается
	  незашифрованным.  Попробуйте использовать <code class="command">telnet</code>
	  с параметром <code class="literal">-x</code>, чтобы зашифровать весь поток
	  данных (подобно <code class="command">ssh</code>).</p><p>Основные клиентские приложения
	  <span class="application">Kerberos</span> (традиционно называющиеся
	  <code class="command">kinit</code>, <code class="command">klist</code>,
	  <code class="command">kdestroy</code>, и
	  <code class="command">kpasswd</code>) находятся в базовой установке FreeBSD.
	  Обратите внимание, что в FreeBSD версий до 5.0 они были переименованы
	  в <code class="command">k5init</code>, <code class="command">k5list</code>,
	  <code class="command">k5destroy</code>, <code class="command">k5passwd</code>, и
	  <code class="command">k5stash</code> (хотя их обычно использовали лишь
	  однократно).</p><p>Различные неосновные клиентские приложения
	  <span class="application">Kerberos</span> также устанавливаются по
	  умолчанию.  Здесь проявляется <span class="quote"><<<span class="quote">минимальность</span>>></span>
	  базовой установки Heimdal: <code class="command">telnet</code> это
	  единственное приложение, поддерживающее
	  <span class="application">Kerberos</span>.</p><p>Порт Heimdal добавляет некоторые отсутствующие клиентские
	  приложения: поддерживающие
	  <span class="application">Kerberos</span> версии
	  <code class="command">ftp</code>, <code class="command">rsh</code>,
	  <code class="command">rcp</code>, <code class="command">rlogin</code>, и некоторые
	  другие реже используемые программы.  Порт <acronym class="acronym">MIT</acronym>
	  также содержит полный пакет клиентских приложений
	  <span class="application">Kerberos</span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88864848"></a>14.8.5. Пользовательские файлы настройки: <code class="filename">.k5login</code>
	  и <code class="filename">.k5users</code></h3></div></div></div><a id="idp88866128" class="indexterm"></a><a id="idp88867024" class="indexterm"></a><p>Учётные записи пользователя в
	  <span class="application">Kerberos</span> (например
	  <code class="systemitem">tillman@EXAMPLE.ORG</code>) обычно связаны с
	  локальными учётными записями (например с локальной учётной записью6
	  <code class="systemitem">tillman</code>).  Клиентские приложения, такие как
	  <code class="command">telnet</code>, обычно не требуют указания имени
	  пользователя или учётной записи.</p><p>Тем не менее, время от времени вам может потребоваться дать
	  доступ к локальной учётной записи кому-то, у кого нет
	  соответствующей учётной записи <span class="application">Kerberos</span>.
	  Например, пользователю <code class="systemitem">tillman@EXAMPLE.ORG</code>
	  может потребоваться доступ к локальной учётной записи
	  <code class="systemitem">webdevelopers</code>.  Другим учётным записям
	  также может потребоваться доступ к этой локальной учётной
	  записи.</p><p>Файлы <code class="filename">.k5login</code> и
	  <code class="filename">.k5users</code>, помещенные в домашний каталог
	  пользователя, могут быть использованы подобно действенной
	  комбинации <code class="filename">.hosts</code> и
	  <code class="filename">.rhosts</code> для решения этой проблемы.
	  Например, файл <code class="filename">.k5login</code>
	  со следующим содержанием:</p><pre class="screen">tillman@example.org
jdoe@example.org</pre><p>помещен в домашний каталог локального пользователя
	  <code class="systemitem">webdevelopers</code>, то обе упомянутые учётные
	  записи получат доступ к этой учётной записи без необходимости
	  наличия общего пароля.</p><p>Рекомендуется прочитать страницу справочника по этим командам.
	  Обратите внимание, что страница справочника о
	  <code class="command">ksu</code> содержит информацию по
	  <code class="filename">.k5users</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88880976"></a>14.8.6. Подсказки, советы и решение проблем с
	  <span class="application">Kerberos</span></h3></div></div></div><a id="idp88881872" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>При использовании портов как Heimdal так и
	      <acronym class="acronym">MIT</acronym> <span class="application">Kerberos</span>
	      убедитесь, что в <code class="envar">PATH</code> версии
	      <span class="application">Kerberos</span> клиентов указаны перед
	      их версиями в базовой системе.</p></li><li class="listitem"><p>Все ли компьютеры в пределах данного realm
	      синхронизированы по времени?  Если нет, аутентификация может
	      завершиться неудачно.  <a class="xref" href="network-ntp.html" title="25.10. Синхронизация часов через NTP">Раздел 25.10, <<Синхронизация часов через NTP>></a> описывает
	      как синхронизировать часы с использованием
	      <acronym class="acronym">NTP</acronym>.</p></li><li class="listitem"><p><acronym class="acronym">MIT</acronym> и Heimdal успешно взаимодействуют.
	      За исключением <code class="command">kadmin</code>, протокол для которого
	      не стандартизован.</p></li><li class="listitem"><p>Если вы изменяете hostname, потребуется также изменить
	      учётную запись <code class="systemitem">host/</code> и обновить keytab.
	      Это также необходимо для специальных записей в keytab, таких
	      как <code class="systemitem">www/</code> запись модуля Apache
	      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/mod_auth_kerb/pkg-descr">www/mod_auth_kerb</a>.</p></li><li class="listitem"><p>Все хосты под общим идентификатором должны разрешаться
	      <acronym class="acronym">DNS</acronym> (прямое и обратное разрешение), или
	      как минимум через <code class="filename">/etc/hosts</code>. Записи
	      CNAME будут работать, но записи A и PTR должны быть корректны
	      и находиться на своем месте.  Сообщение об ошибке не всегда
	      интуитивно понятно:
	      <span class="errorname">Kerberos5 refuses authentication because Read req
	      failed: Key table entry not found</span>.</p></li><li class="listitem"><p>Некоторые операционные системы, способные работать в качестве
	      клиентов <acronym class="acronym">KDC</acronym> не устанавливают права
	      для <code class="command">ksu</code> в setuid <code class="systemitem">root</code>.
	      Это означает, что <code class="command">ksu</code> не работает, что хорошо
	      является хорошей идеей для безопасности, но неудобно.  Это не
	      ошибка <acronym class="acronym">KDC</acronym>.</p></li><li class="listitem"><p>С <acronym class="acronym">MIT</acronym>
	      <span class="application">Kerberos</span>, если вы хотите продлить
	      действие доступа до значения большего, чем десять часов по
	      умолчанию, используйте команду
	      <code class="command">modify_principal</code> в
	      <code class="command">kadmin</code> для изменения maxlife доступа к самой
	      учётной записи и к учётной записи <code class="systemitem">krbtgt</code>.
	      Затем возможно использование <code class="command">kinit</code>
	      с параметром <code class="literal">-l</code> для запроса доступа с большим
	      временем действия.</p></li><li class="listitem"><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Если вы запускаете перехватчик пакетов на
	      <acronym class="acronym">KDC</acronym> для разрешения проблем, а затем
	      запускаете <code class="command">kinit</code> с рабочей станции, то
	      увидите, что <acronym class="acronym">TGT</acronym> посылается непосредственно
	      при запуске <code class="command">kinit</code> - даже до того, как
	      вы введете пароль!  Объяснение в том, что сервер
	      <span class="application">Kerberos</span> свободно распространяет
	      <acronym class="acronym">TGT</acronym> (Ticket Granting Ticket) на каждый
	      неавторизованный запрос; однако, каждый <acronym class="acronym">TGT</acronym>
	      зашифрован ключом, полученным из пароля пользователя.
	      Следовательно, когда пользователь вводит свой пароль, он не
	      отправляется на <acronym class="acronym">KDC</acronym>, а используется для
	      расшифровка <acronym class="acronym">TGT</acronym>, который уже получен
	      <code class="command">kinit</code>.  Если в процессе расшифровки
	      получается правильный билет с правильным значением времени,
	      у пользователя есть действующее <span class="quote"><<<span class="quote">удостоверение</span>>></span>.
	      Это удостоверение содержит ключ сессии для установления
	      безопасного соединения с сервером
	      <span class="application">Kerberos</span>, как и действующий
	      <acronym class="acronym">TGT</acronym>, зашифрованный ключом сервера
	      <span class="application">Kerberos</span>.  Второй уровень шифрования
	      недоступен пользователю, но позволяет серверу
	      <span class="application">Kerberos</span> проверять правильность
	      каждого <acronym class="acronym">TGT</acronym>.</p></div></li><li class="listitem"><p>Если вы хотите установить большое время жизни доступа
	      (например, неделю), и используете
	      <span class="application">OpenSSH</span> для соединения с компьютером,
	      где хранится <span class="quote"><<<span class="quote">билет</span>>></span>, убедитесь, что параметр
	      <span class="application">Kerberos</span>
	      <code class="option">TicketCleanup</code> установлен в
	      <code class="literal">no</code> в файле <code class="filename">sshd_config</code>,
	      или билеты будут уничтожены при выходе из сеанса.</p></li><li class="listitem"><p>Запомните, что время жизни билетов хостов больше.
	      Если время жизни билета для учётной записи пользователя
	      составляет неделю, а время жизни учётной записи хоста, к
	      которому вы подсоединяетесь девять часов, учётная запись хоста
	      в кэше устареет и кэш билетов будет работать не так, как
	      ожидается.</p></li><li class="listitem"><p>При настройке файла <code class="filename">krb5.dict</code> на
	    предотвращение использования определенных плохих паролей
	    (страница справочника для <code class="command">kadmind</code> кратко
	    рассказывает об этом), запомните, что это применимо только
	    к учётным записям, для которых действует политика паролей.
	    Формат файла <code class="filename">krb5.dict</code> прост: одно слово
	    на строку.  Может помочь создание символической ссылки на
	    <code class="filename">/usr/share/dict/words</code>.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88921296"></a>14.8.7. Отличия от порта <acronym class="acronym">MIT</acronym></h3></div></div></div><p>Основное различие между установками <acronym class="acronym">MIT</acronym> и
	  Heimdal относится к программе <code class="command">kadmin</code>,
	  которая имеет другой (но эквивалентный) набор команд и
	  использует другой протокол.  Если ваш <acronym class="acronym">KDC</acronym>
	  работает на <acronym class="acronym">MIT</acronym>, вы не сможете использовать
	  <code class="command">kadmin</code> для удаленного администрирования
	  <acronym class="acronym">KDC</acronym> (и наоборот, по этой же причине).</p><p>Опции командной строки клиентов также могут немного отличаться
	  для одинаковых задач.  Рекомендуется следование инструкциям
	  на <acronym class="acronym">MIT</acronym> <span class="application">Kerberos</span>
	  Web-сайте (<code class="uri"><a class="uri" href="http://web.mit.edu/Kerberos/www/" target="_top">http://web.mit.edu/Kerberos/www/</a></code>).
	  Будьте внимательны при определении <code class="envar">PATH</code>:
	  порт <acronym class="acronym">MIT</acronym> устанавливается по умолчанию в
	  <code class="filename">/usr/local/</code>, и если в <code class="envar">PATH</code>
	  вначале указаны системные каталоги, вместо приложений
	  <acronym class="acronym">MIT</acronym> могут быть запущены системные
	  приложения.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">С портом <acronym class="acronym">MIT</acronym>
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/krb5/pkg-descr">security/krb5</a>, предоставляемым
	  FreeBSD, убедитесь что файл
	  <code class="filename">/usr/local/share/doc/krb5/README.FreeBSD</code>
	  установлен портом, если вы хотите понять почему вход через
	  <code class="command">telnetd</code> и <code class="command">klogind</code>
	  иногда происходит так странно.  Наиболее важно, исправление
	  <span class="quote"><<<span class="quote">incorrect permissions on cache file</span>>></span> требует
	  использования бинарного файла <code class="command">login.krb5</code>
	  для аутентификации, чтобы права на переданное удостоверение
	  передавались правильно.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88932304"></a>14.8.8. Преодоление ограничений, обнаруженных в
	  <span class="application">Kerberos</span></h3></div></div></div><a id="idp88933328" class="indexterm"></a><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88934480"></a>14.8.8.1. <span class="application">Kerberos</span> это все или ничего</h4></div></div></div><p>Каждый сервис, работающий в сети, должен быть модифицирован
	    для работы с <span class="application">Kerberos</span> (или другим
	    способом защищен от атак по сети) или удостоверения пользователей
	    могут быть украдены или использованы повторно.  В качестве примера
	    может быть приведено использование
	    <span class="application">Kerberos</span> версий
	    оболочек для удаленной работы (например через
	    <code class="command">rsh</code> и <code class="command">telnet</code>), при
	    наличии <acronym class="acronym">POP3</acronym> сервера, получающего пароли в
	    незашифрованном виде.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88937808"></a>14.8.8.2. <span class="application">Kerberos</span> предназначен для
	    однопользовательских рабочих станций</h4></div></div></div><p>В многопользовательской среде
	    <span class="application">Kerberos</span> менее безопасен.
	    Это потому, что он хранит билеты в каталоге
	    <code class="filename">/tmp</code>, которая доступна для чтения всем.
	    Если пользователь работает с несколькими другими пользователями
	    одновременно на одном компьютере (т.е. в многопользовательской
	    среде), возможна кража (копирование) билета другим
	    пользователем.</p><p>Решить проблему можно с помощью параметра командной
	    строки <code class="literal">-c</code> или (предпочтительно) с помощью
	    переменной окружения <code class="envar">KRB5CCNAME</code>, но это делается
	    редко.  Для преодоления ограничения достаточно сохранять билет
	    в домашнем каталоге пользователя и использовать простые
	    ограничения на доступ к файлам.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88945488"></a>14.8.8.3. От KDC зависит вся система</h4></div></div></div><p>Архитектура системы такова, что <acronym class="acronym">KDC</acronym> должен
	    быть максимально защищен, поскольку главный пароль базы данных
	    содержится в нем.  На <acronym class="acronym">KDC</acronym> не должно быть
	    запущено никаких других сервисов и он должен быть защищен
	    физически.  Опасность велика, поскольку
	    <span class="application">Kerberos</span> хранит все пароли
	    зашифрованными одним ключом (<span class="quote"><<<span class="quote">главным</span>>></span> ключом),
	    который хранится в файле на <acronym class="acronym">KDC</acronym>.</p><p>Хорошей новостью является то, что кража главного ключа
	    не станет такой проблемой, как может показаться.  Главный ключ
	    используется только для шифрования базы данных
	    <span class="application">Kerberos</span> и в качестве seed для
	    генератора случайных чисел.  Поскольку доступ к
	    <acronym class="acronym">KDC</acronym> защищен, атакующий мало что сможет сделать
	    с главным ключом.</p><p>Кроме того, если <acronym class="acronym">KDC</acronym> станет недоступен
	    (возможно по причине атак DoS или проблем в сети) сетевые сервисы
	    будет невозможно использовать, поскольку аутентификация не
	    может быть выполнена.
	    Уменьшить последствия можно при наличии нескольких
	    <acronym class="acronym">KDC</acronym> (один главный и один или несколько
	    резервных) и с аккуратно реализованной резервной аутентификацией
	    (отлично подойдет <acronym class="acronym">PAM</acronym>).</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88951504"></a>14.8.8.4. Недостатки <span class="application">Kerberos</span></h4></div></div></div><p><span class="application">Kerberos</span> позволяет пользователям,
	    хостам и сервисам производить аутентификацию друг друга.
	    В нем нет механизма аутентификации <acronym class="acronym">KDC</acronym>
	    для пользователей, хостов или сервисов.  Это означает, что
	    поддельный <code class="command">kinit</code> (например) может записывать
	    все имена пользователей и паролей.  Помочь решить проблему может
	    <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/tripwire/pkg-descr">security/tripwire</a> или
	    другой инструмент проверки целостности файловой системы.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88958672"></a>14.8.9. Ресурсы и информация для дальнейшего изучения</h3></div></div></div><a id="idp88959312" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.faqs.org/faqs/Kerberos-faq/general/preamble.html" target="_top">
	    <span class="application">Kerberos</span> FAQ</a></p></li><li class="listitem"><p><a class="link" href="http://web.mit.edu/Kerberos/www/dialogue.html" target="_top">Разработка
	    системы аутентификации: диалог в четырех сценах</a></p></li><li class="listitem"><p><a class="link" href="http://www.ietf.org/rfc/rfc1510.txt?number=1510" target="_top">RFC 1510,
	    <span class="application">Kerberos</span> Network Authentication Service
	    (V5)</a></p></li><li class="listitem"><p><a class="link" href="http://web.mit.edu/Kerberos/www/" target="_top">Домашняя страница
	    <acronym class="acronym">MIT</acronym>
	    <span class="application">Kerberos</span></a></p></li><li class="listitem"><p><a class="link" href="http://www.pdc.kth.se/heimdal/" target="_top">Домашняя страница
	  Heimdal <span class="application">Kerberos</span></a></p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kerberosIV.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="openssl.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">14.7. <span class="application">KerberosIV</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 14.9. OpenSSL</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>