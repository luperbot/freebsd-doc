<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>25.3. Network File System (NFS)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="network-servers.html" title="Глава 25. Сетевые серверы" /><link rel="prev" href="network-inetd.html" title="25.2. <<Супер-сервер>> inetd" /><link rel="next" href="network-nis.html" title="25.4. Network Information System (NIS/YP)" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">25.3. Network File System (NFS)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-inetd.html">Пред.</a> </td><th width="60%" align="center">Глава 25. Сетевые серверы</th><td width="20%" align="right"> <a accesskey="n" href="network-nis.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-nfs"></a>25.3. Network File System (NFS)</h2></div><div><span class="authorgroup">Реорганизация и улучшения <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Текст создал <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Bill</span> <span class="surname">Swingle</span></span>. </span></div></div></div><a id="idp97132496" class="indexterm"></a><p>Кроме поддержки многих прочих типов файловых систем, во FreeBSD
      встроена поддержка сетевой файловой системы (Network File System),
      известной как <acronym class="acronym">NFS</acronym>.  <acronym class="acronym">NFS</acronym> позволяет
      системе использовать каталоги и файлы совместно с другими машинами,
      посредством сети.  Посредством <acronym class="acronym">NFS</acronym> пользователи и
      программы могут получать доступ к файлам на удалённых системах точно так
      же, как если бы это были файлы на собственных дисках.</p><p>Вот некоторые из наиболее заметных преимуществ, которые даёт
      использование <acronym class="acronym">NFS</acronym>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Отдельно взятые рабочие станции используют меньше собственного
	  дискового пространства, так как совместно используемые данные могут
	  храниться на одной отдельной машине и быть доступными для других
	  машин в сети.</p></li><li class="listitem"><p>Пользователям не нужно иметь домашние каталоги, отдельные
	  для каждой машины в вашей сети.  Домашние каталоги могут
	  располагаться на сервере <acronym class="acronym">NFS</acronym> и их можно сделать
	  доступными отовсюду в сети.</p></li><li class="listitem"><p>Устройства хранения информации, такие, как дискеты, приводы
	  CD-ROM и устройства <span class="trademark">Zip</span>(R), могут использоваться другими машинами в
	  сети.  Это может привести к уменьшению переносимых устройств хранения
	  информации в сети.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97159888"></a>25.3.1. Как работает <acronym class="acronym">NFS</acronym></h3></div></div></div><p><acronym class="acronym">NFS</acronym> строится по крайней мере из двух основных
	частей: сервера и одного или большего количества клиентов.  Клиент
	обращается к данным, находящимся на сервере, в режиме удалённого
	доступа.  Для того, чтобы это нормально функционировало, нужно
	настроить и запустить несколько процессов.</p><p>На сервере работают следующие даемоны:</p><a id="idp97161808" class="indexterm"></a><a id="idp97162960" class="indexterm"></a><a id="idp97164112" class="indexterm"></a><a id="idp97165008" class="indexterm"></a><a id="idp97166032" class="indexterm"></a><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Даемон</th><th>Описание</th></tr></thead><tbody><tr><td><span class="application">nfsd</span></td><td>Даемон <acronym class="acronym">NFS</acronym>, обслуживающий запросы от
		клиентов <acronym class="acronym">NFS</acronym>.</td></tr><tr><td><span class="application">mountd</span></td><td>Даемон монтирования <acronym class="acronym">NFS</acronym>, который
		выполняет запросы, передаваемые ему от <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=nfsd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">nfsd</span>(8)</span></a>.</td></tr><tr><td><span class="application">rpcbind</span></td><td>Этот даемон позволяет клиентам
		<acronym class="acronym">NFS</acronym> определить порт, используемый сервером
		<acronym class="acronym">NFS</acronym>.</td></tr></tbody></table></div><p>Клиент может запустить также даемон, называемый
	<span class="application">nfsiod</span>.  <span class="application">nfsiod</span>
	обслуживает запросы, поступающие от сервера от сервера
	<acronym class="acronym">NFS</acronym>.  Он необязателен, увеличивает
	производительность, однако для нормальной и правильной работы не
	требуется.  Для получения дополнительной информации обратитесь к
	разделу справочной системы о <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=nfsiod&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">nfsiod</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-configuring-nfs"></a>25.3.2. Настройка <acronym class="acronym">NFS</acronym></h3></div></div></div><a id="idp97180880" class="indexterm"></a><p>Настройка <acronym class="acronym">NFS</acronym> является достаточно незамысловатым
	процессом.  Все процессы, которые должны быть запущены, могут быть
	запущены во время загрузки посредством нескольких модификаций в
	вашем файле <code class="filename">/etc/rc.conf</code>.</p><p>Проверьте, что на <acronym class="acronym">NFS</acronym>-сервере в файле
	<code class="filename">/etc/rc.conf</code> имеются такие строки:</p><pre class="programlisting">rpcbind_enable="YES"
nfs_server_enable="YES"
nfs_server_flags="-u -t -n 4"
mountd_flags="-r"</pre><p><span class="application">mountd</span> запускается автоматически, если включена
	функция сервера <acronym class="acronym">NFS</acronym>.</p><p>На клиенте убедитесь, что в файле <code class="filename">/etc/rc.conf</code>
	присутствует такой параметр:</p><pre class="programlisting">nfs_client_enable="YES"</pre><p>Файл <code class="filename">/etc/exports</code> определяет, какие
	файловые системы на вашем сервере <acronym class="acronym">NFS</acronym> будут
	экспортироваться (иногда их называют <span class="quote"><<<span class="quote">совместно
	используемыми</span>>></span>).  Каждая строка в
	<code class="filename">/etc/exports</code> задаёт файловую систему, которая
	будет экспортироваться и какие машины будут иметь к ней доступ.  Кроме
	машин, имеющих доступ, могут задаваться другие параметры, влияющие на
	характеристики доступа.  Имеется полный набор параметров,
	которые можно использовать, но здесь пойдёт речь лишь о некоторых из
	них.  Описания остальных параметров можно найти на страницах справочной
	системы по <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exports&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">exports</span>(5)</span></a>.</p><p>Вот несколько примерных строк из файла
	<code class="filename">/etc/exports</code>:</p><a id="idp97198800" class="indexterm"></a><p>В следующих примерах даётся общая идея того, как экспортировать
	файловые системы, хотя конкретные параметры могут отличаться в
	зависимости от ваших условий и конфигурации сети.  К примеру, чтобы
	экспортировать каталог <code class="filename">/cdrom</code> для трёх машин,
	находящихся в том же самом домене, что и сервер (поэтому отсутствует
	доменное имя для каждой машины) или для которых имеются записи в
	файле <code class="filename">/etc/hosts</code>.  Флаг <code class="option">-ro</code>
	указывает на использование экспортируемой файловой
	системы в режиме только чтения.  С этим флагом удалённая система не
	сможет никоим образом изменить экспортируемую файловую систему.</p><pre class="programlisting">/cdrom -ro host1 host2 host3</pre><p>В следующей строке экспортируется файловая система
	<code class="filename">/home</code>, которая становится доступной трем хостам,
	указанным по их IP-адресам.  Это полезно, если у вас есть собственная
	сеть без настроенного сервера <acronym class="acronym">DNS</acronym>.  Как вариант,
	файл <code class="filename">/etc/hosts</code> может содержать внутренние имена
	хостов; пожалуйста, обратитесь к справочную систему по <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts</span>(5)</span></a>
	для получения дополнительной информации.  Флаг
	<code class="option">-alldirs</code> позволяет рассматривать подкаталоги в
	качестве точек монтирования.  Другими словами, это не монтирование
	подкаталогов, но разрешение клиентам монтировать только каталоги,
	которые им требуются или нужны.</p><pre class="programlisting">/home  -alldirs  10.0.0.2 10.0.0.3 10.0.0.4</pre><p>В строке, приведённой ниже, файловая система
	<code class="filename">/a</code> экспортируется таким образом, что она доступна
	двум клиентам из других доменов.  Параметр
	<code class="option">-maproot=root</code> позволяет пользователю
	<code class="systemitem">root</code> удалённой системы осуществлять запись на
	экспортируемую файловую систему как пользователь
	<code class="systemitem">root</code>.  Если параметр
	<code class="literal">-maproot=root</code> не задан,
	то даже если пользователь имеет права доступа <code class="systemitem">root</code>
	на удалённой системе, он не сможет модифицировать
	файлы на экспортированной файловой системе.</p><pre class="programlisting">/a  -maproot=root  host.example.com box.example.org</pre><p>Для того, чтобы клиент смог обратиться к экспортированной файловой
	системе, он должен иметь права сделать это.  Проверьте, что клиент
	указан в вашем файле <code class="filename">/etc/exports</code>.</p><p>В файле <code class="filename">/etc/exports</code> каждая строка содержит
	информацию об экспортировании для отдельной файловой системы для
	отдельно взятого хоста.  Удалённый хост может быть задан только
	один раз для каждой файловой системы, и может иметь
	только одну запись, используемую по умолчанию, для каждой локальной
	файловой системы.  К примеру, предположим, что
	<code class="filename">/usr</code> является отдельной файловой системой.
	Следующий <code class="filename">/etc/exports</code> будет некорректен:</p><pre class="programlisting"># Invalid when /usr is one file system
/usr/src   client
/usr/ports client</pre><p>Одна файловая система, <code class="filename">/usr</code>, имеет две
	строки, задающие экспортирование для одного и того же хоста,
	<code class="systemitem">client</code>.  Правильный формат в этом случае таков:</p><pre class="programlisting">/usr/src /usr/ports  client</pre><p>Свойства отдельной файловой системы, экспортируемой некоторому
	хосту, должны задаваться в одной строке.  Строки без указания клиента
	воспринимаются как отдельный хост.  Это ограничивает то, как вы можете
	экспортировать файловые системы, но для большинства это не
	проблема.</p><p>Ниже приведён пример правильного списка экспортирования, где
	<code class="filename">/usr</code> и <code class="filename">/exports</code> являются
	локальными файловыми системами:</p><pre class="programlisting"># Экспортируем src и ports для client01 и client02, но
# только client01 имеет права пользователя root на них
/usr/src /usr/ports -maproot=root    client01
/usr/src /usr/ports	       client02
# Клиентские машины имеют пользователя root и могут монтировать всё в
# каталоге /exports.  Кто угодно может монтировать /exports/obj в режиме чтения
/exports -alldirs -maproot=root      client01 client02
/exports/obj -ro</pre><p>Даемон <span class="application">mountd</span> должен быть
	проинформирован об изменении файла <code class="filename">/etc/exports</code>,
	чтобы изменения вступили в силу.  Это может быть достигнуто посылкой
	сигнала HUP процессу <code class="command">mountd</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP `cat /var/run/mountd.pid`</code></strong></pre><p>или вызовом скрипта <code class="command">mountd</code> подсистемы <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a>
        с соответствующим параметром:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/mountd onereload</code></strong></pre><p>За подробной информацией о работе скриптов rc.d обращайтесь к
	<a class="xref" href="configtuning-rcd.html" title="12.7. Использование rc во FreeBSD 5.X и последующих версиях">Раздел 12.7, <<Использование rc во FreeBSD 5.X и последующих версиях>></a>.</p><p>Как вариант, при перезагрузке FreeBSD всё настроится правильно.
	Хотя выполнять перезагрузку вовсе не обязательно.  Выполнение следующих
	команд пользователем <code class="systemitem">root</code> запустит всё, что
	нужно.</p><p>На сервере <acronym class="acronym">NFS</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rpcbind</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>nfsd -u -t -n 4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mountd -r</code></strong></pre><p>На клиенте <acronym class="acronym">NFS</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>nfsiod -n 4</code></strong></pre><p>Теперь всё должно быть готово к реальному монтированию удалённой
	файловой системы.  В приводимых примерах сервер будет носить имя
	<code class="systemitem">server</code>, а клиент будет носить имя
	<code class="systemitem">client</code>.  Если вы только хотите
	временно смонтировать удалённую файловую систему, или всего лишь
	протестировать ваши настройки, то просто запустите команды, подобные
	приводимым здесь, работая как пользователь <code class="systemitem">root</code> на
	клиентской машине:</p><a id="idp97273296" class="indexterm"></a><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount server:/home /mnt</code></strong></pre><p>По этой команде файловая система <code class="filename">/home</code> на
	сервере будет смонтирована в каталог <code class="filename">/mnt</code> на
	клиенте.  Если всё настроено правильно, вы сможете войти в каталог
	<code class="filename">/mnt</code> на клиенте и увидеть файлы, находящиеся на
	сервере.</p><p>Если вы хотите автоматически монтировать удалённую файловую
	систему при каждой загрузке компьютера, добавьте файловую систему в
	<code class="filename">/etc/fstab</code>.  Вот пример:</p><pre class="programlisting">server:/home	  /mnt	  nfs	  rw	  0	  0</pre><p>На страницах справочной системы по <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> перечислены все
	доступные параметры.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97283536"></a>25.3.3. Блокировка файлов</h3></div></div></div><p>Некоторым приложениям (например, <span class="application">mutt</span>)
	для корректной работы необходима возможность блокировки файлов
	(file locking).  При работе по <acronym class="acronym">NFS</acronym> блокировка
	файлов может осуществляться при помощи демона
	<span class="application">rpc.lockd</span>.  Чтобы его активировать, добавьте
	следующие записи в файл <code class="filename">/etc/rc.conf</code> как
	на клиенте, так и на сервере <acronym class="acronym">NFS</acronym> (предполагается,
	что и клиент, и сервер уже сконфигурированы):</p><pre class="programlisting">rpc_lockd_enable="YES"
rpc_statd_enable="YES"</pre><p>Запустите демоны, выполнив следующие команды:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/lockd start</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/statd start</code></strong></pre><p>Если нет необходимости в настоящей блокировке файлов между
	сервером <acronym class="acronym">NFS</acronym> и клиентами, то клиент
	<acronym class="acronym">NFS</acronym> может быть настроен так, чтобы выполнять
	блокировки файлов локально, для чего необходимо передать опцию
	<code class="option">-L</code> команде <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount_nfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount_nfs</span>(8)</span></a>.  За подробностями
	обратитесь к странице справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount_nfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount_nfs</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97292368"></a>25.3.4. Практическое использование</h3></div></div></div><p>У <acronym class="acronym">NFS</acronym> есть много вариантов практического
	применения.  Ниже приводится несколько наиболее широко распространённых
	способов её использования:</p><a id="idp97293776" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Настройка несколько машин для совместного использования CDROM
	    или других носителей.  Это более дешёвый и зачастую более удобный
	    способ установки программного обеспечения на несколько машин.</p></li><li class="listitem"><p>В больших сетях может оказаться более удобным настроить
	    центральный сервер <acronym class="acronym">NFS</acronym>, на котором размещаются
	    все домашние каталоги пользователей.  Эти домашние каталоги могут
	    затем экспортироваться в сеть так, что пользователи всегда будут
	    иметь один и тот же домашний каталог вне зависимости от того, на
	    какой рабочей станции они работают.</p></li><li class="listitem"><p>Несколько машин могут иметь общий каталог
	    <code class="filename">/usr/ports/distfiles</code>.  Таким образом, когда
	    вам нужно будет установить порт на несколько машин, вы сможете быстро
	    получить доступ к исходным текстам без их загрузки на каждой
	    машине.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-amd"></a>25.3.5. Автоматическое монтирование с
	<span class="application">amd</span></h3></div><div><span class="authorgroup">Текст предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Wylie</span> <span class="surname">Stilwell</span></span>. </span></div><div><span class="authorgroup">Текст переписал <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div></div></div><a id="idp97307088" class="indexterm"></a><a id="idp97307856" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> (даемон автоматического монтирования) автоматически
	монтирует удалённую файловую систему,
	как только происходит обращение к файлу или каталогу в этой файловой
	системе.  Кроме того, файловые системы, которые были неактивны
	некоторое время, будут автоматически размонтированы даемоном
  	<span class="application">amd</span>.  Использование
	<span class="application">amd</span> является простой альтернативой
	статическому монтированию, так как в последнем случае обычно всё должно
	быть описано в файле <code class="filename">/etc/fstab</code>.</p><p><span class="application">amd</span> работает, сам выступая как сервер
	NFS для каталогов <code class="filename">/host</code> и
	<code class="filename">/net</code>.  Когда происходит обращение к файлу в одном
	из этих каталогов, <span class="application">amd</span> ищет соответствующий
	удаленный ресурс для монтирования и автоматически его монтирует.
	<code class="filename">/net</code> используется для монтирования экспортируемой
	файловой системы по адресу IP, когда как каталог
	<code class="filename">/host</code> используется для монтирования ресурса по
	удаленному имени хоста.</p><p>Обращение к файлу в каталоге
	<code class="filename">/host/foobar/usr</code> укажет
	<span class="application">amd</span> на выполнение попытки монтирования
	ресурса	<code class="filename">/usr</code>, который находится на хосте
	<code class="systemitem">foobar</code>.</p><div class="example"><a id="idp97315408"></a><div class="example-title">Пример 25.2. Монтирование ресурса при помощи
	  <span class="application">amd</span></div><div class="example-contents"><p>Вы можете посмотреть доступные для монтирования ресурсы
	  отдалённого хоста командой <code class="command">showmount</code>.  К примеру,
	  чтобы посмотреть ресурсы хоста с именем <code class="systemitem">foobar</code>, вы
	  можете использовать:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>showmount -e foobar</code></strong>
Exports list on foobar:
/usr			       10.10.10.0
/a				 10.10.10.0
<code class="prompt">%</code> <strong class="userinput"><code>cd /host/foobar/usr</code></strong></pre></div></div><br class="example-break" /><p>Как видно из примера, <code class="command">showmount</code> показывает
	<code class="filename">/usr</code> как экспортируемый ресурс.  При переходе в
	каталог	<code class="filename">/host/foobar/usr</code> даемон
	<span class="application">amd</span> пытается разрешить имя хоста
	<code class="systemitem">foobar</code> и автоматически смонтировать требуемый
	ресурс.</p><p><span class="application">amd</span> может быть запущен из скриптов
	начальной загрузки, если поместить такую строку в файл
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">amd_enable="YES"</pre><p>Кроме того, даемону <span class="application">amd</span> могут быть
	переданы настроечные флаги через параметр
	<code class="varname">amd_flags</code>.  По умолчанию
	<code class="varname">amd_flags</code> настроен следующим образом:</p><pre class="programlisting">amd_flags="-a /.amd_mnt -l syslog /host /etc/amd.map /net /etc/amd.map"</pre><p>Файл <code class="filename">/etc/amd.map</code> задает опции, используемые
	по умолчанию при монтировании экспортируемых ресурсов.  В файле
	<code class="filename">/etc/amd.conf</code> заданы настройки некоторых более
	сложных возможностей <span class="application">amd</span>.</p><p>Обратитесь к справочным страницам по <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">amd.conf</span>(5)</span></a>
	для получения более полной информации.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-nfs-integration"></a>25.3.6. Проблемы взаимодействия с другими системами</h3></div><div><span class="authorgroup">Текст предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">John</span> <span class="surname">Lind</span></span>. </span></div></div></div><p>Некоторые сетевые адаптеры для систем PC с шиной ISA имеют
	ограничения, которые могут привести к серьезным проблемам в сети, в
	частности, с NFS.  Эти проблемы не специфичны для FreeBSD, однако
	эту систему они затрагивают.</p><p>Проблема, которая возникает практически всегда при работе по сети
	систем PC (FreeBSD) с высокопроизводительными рабочими станциями,
	выпущенными такими производителями, как Silicon Graphics, Inc. и Sun
	Microsystems, Inc.  Монтирование по протоколу NFS будет работать
	нормально, и некоторые операции также будут выполняться успешно, но
	неожиданно сервер окажется недоступным для клиент, хотя запросы к и
	от других систем будут продолжаться обрабатываться.  Такое встречается
	с клиентскими системами, не зависимо от того, является ли клиент
	машиной с FreeBSD или рабочей станцией.  Во многих системах при
	возникновении этой проблемы нет способа корректно завершить работу
	клиента.  Единственным выходом зачастую является холодная перезагрузка
	клиента, потому что ситуация с NFS не может быть разрешена.</p><p>Хотя <span class="quote"><<<span class="quote">правильным</span>>></span> решением является установка более
	производительного и скоростного сетевого адаптера на систему FreeBSD,
	имеется простое решение, приводящее к удовлетворительным результатам.
	Если система FreeBSD является <span class="emphasis"><em>сервером</em></span>, укажите
	параметр <code class="option">-w=1024</code> на клиенте при монтировании.  Если
	система FreeBSD является <span class="emphasis"><em>клиентом</em></span>, то смонтируйте
	файловую систему NFS с параметром <code class="option">-r=1024</code>.  Эти
	параметры могут быть заданы в четвертом поле записи в файле
	<code class="filename">fstab</code> клиента при автоматическом монтировании,
	или при помощи параметра <code class="option">-o</code> в команде <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> при
	монтировании вручную.</p><p>Нужно отметить, что имеется также другая проблема, ошибочно
	принимаемая за приведенную выше, когда серверы и клиенты NFS находятся
	в разных сетях.  Если это тот самый случай,
	<span class="emphasis"><em>проверьте</em></span>, что ваши маршрутизаторы пропускают
	нужную информацию <acronym class="acronym">UDP</acronym>, в противном случае вы
	ничего не получите, что бы вы ни предпринимали.</p><p>В следующих примерах <code class="systemitem">fastws</code> является именем хоста
	(интерфейса) высокопроизводительной рабочей станции, а
	<code class="systemitem">freebox</code> является именем хоста (интерфейса) системы
	FreeBSD со слабым сетевым адаптером.  Кроме того,
	<code class="filename">/sharedfs</code> будет являться экспортируемой через NFS
	файловой системой (обратитесь к страницам справочной системы по команде
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exports&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">exports</span>(5)</span></a>), а <code class="filename">/project</code> будет точкой
	монтирования экспортируемой файловой системы на клиенте.  В любом
	случае, отметьте, что для вашего приложения могут понадобиться
	дополнительные параметры, такие, как <code class="option">hard</code>,
	<code class="option">soft</code> или <code class="option">bg</code>.</p><p>Пример системы FreeBSD (<code class="systemitem">freebox</code>) как клиента
	в файле <code class="filename">/etc/fstab</code> на машине
	<code class="systemitem">freebox</code>:</p><pre class="programlisting">fastws:/sharedfs /project nfs rw,-r=1024 0 0</pre><p>Команда, выдаваемая вручную на машине
	<code class="systemitem">freebox</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -t nfs -o -r=1024 fastws:/sharedfs /project</code></strong></pre><p>Пример системы FreeBSD в качестве сервера в файле
	<code class="filename">/etc/fstab</code> на машине
	<code class="systemitem">fastws</code>:</p><pre class="programlisting">freebox:/sharedfs /project nfs rw,-w=1024 0 0</pre><p>Команда, выдаваемая вручную на машине
	<code class="systemitem">fastws</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -t nfs -o -w=1024 freebox:/sharedfs /project</code></strong></pre><p>Практически все 16-разрядные сетевые адаптеры позволят работать
	без указанных выше ограничений на размер блоков при чтении и
	записи.</p><p>Для тех, кто интересуется, ниже описывается, что же происходит в
	при появлении этой ошибки, и объясняется, почему ее невозможно
	устранить.  Как правило, NFS работает с <span class="quote"><<<span class="quote">блоками</span>>></span> размером
	8 килобайт (хотя отдельные фрагменты могут иметь меньшие
	размеры).  Так, пакет Ethernet имеет максимальный размер около
	1500 байт, то
	<span class="quote"><<<span class="quote">блок</span>>></span> NFS разбивается на несколько пакетов Ethernet, хотя
	на более высоком уровне это все тот же единый блок, который должен быть
	принят, собран и <span class="emphasis"><em>подтвержден</em></span> как один блок.
	Высокопроизводительные рабочие станции могут посылать пакеты, которые
	соответствуют одному блоку NFS, сразу друг за другом, насколько это
	позволяет делать стандарт.  На слабых, низкопроизводительных адаптерах
	пакеты, пришедшие позже, накладываются поверх ранее пришедших пакетов
	того же самого блока до того, как они могут быть переданы хосту и
	блок как единое целое не может быть собран или подтвержден.  В
	результате рабочая станция входит в ситуацию тайм-аута и пытается
	повторить передачу, но уже с полным блоком в 8 КБ, и процесс будет
	повторяться снова, до бесконечности.</p><p>Задав размер блока меньше размера пакета Ethernet, мы достигаем
	того, что любой полностью полученный пакет Ethernet может быть
	подтвержден индивидуально, и избежим тупиковую ситуацию.</p><p>Наложение пакетов может все еще проявляться, когда
	высокопроизводительные рабочие станции сбрасывают данные на PC-систему,
	однако повторение этой ситуации не обязательно с более скоростными
	адаптерами с <span class="quote"><<<span class="quote">блоками</span>>></span> NFS.  Когда происходит наложение,
	затронутые блоки будут переданы снова, и скорее всего, они будут
	получены, собраны и подтверждены.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-inetd.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="network-servers.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="network-nis.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">25.2. <span class="quote"><<<span class="quote">Супер-сервер</span>>></span> <span class="application">inetd</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 25.4. Network Information System (NIS/YP)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>