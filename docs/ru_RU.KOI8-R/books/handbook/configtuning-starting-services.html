<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>12.5. Запуск сервисов</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="config-tuning.html" title="Глава 12. Настройка и оптимизация" /><link rel="prev" href="configtuning-appconfig.html" title="12.4. Настройка приложений" /><link rel="next" href="configtuning-cron.html" title="12.6. Настройка утилиты cron" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">12.5. Запуск сервисов</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="configtuning-appconfig.html">Пред.</a> </td><th width="60%" align="center">Глава 12. Настройка и оптимизация</th><td width="20%" align="right"> <a accesskey="n" href="configtuning-cron.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-starting-services"></a>12.5. Запуск сервисов</h2></div><div><span class="authorgroup">Предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp86488656" class="indexterm"></a><p>Многие пользователи предпочитают устанавливать программы сторонних
      производителей в FreeBSD из набора портов.  В подобных случаях
      может потребоваться сконфигурировать программы так, чтобы они
      запускались при инициализации системы.  Сервисы, такие как
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/mail/postfix/pkg-descr">mail/postfix</a> или
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/apache13/pkg-descr">www/apache13</a>, -
      это лишь два примера множества программных пакетов, которые
      можно запускать при инициализации системы.  В этом разделе
      описывается процедура, предназначенная для запуска программ
      сторонних разработчиков.</p><p>Большинство входящих в FreeBSD сервисов, таких как <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>,
      запускается с помощью стартовых скриптов системы.  Эти скрипты
      могут различаться в зависимости от версии FreeBSD или ее производителя;
      однако важнее всего учитывать, что их начальную конфигурацию
      можно задать с помощью простых стартовых скриптов.</p><p>До появления <code class="filename">rc.d</code> приложения должны были помещать
      простой стартовый скрипт в
      каталог <code class="filename">/usr/local/etc/rc.d</code>,
      который затем читался скриптами инициализации системы.  Эти скрипты
      затем выполнялись в ходе последующих стадий запуска системы.</p><p>Хотя много разработчиков потратили часы на попытки внедрить
      старый стиль конфигурирования в новую систему, остаётся фактом,
      что для некоторых утилит сторонних производителей по-прежнему
      необходим скрипт, помещённый в указанный выше каталог.  Незначительные
      различия в скриптах зависят от того, используется ли <code class="filename">rc.d</code>.  До
      версии FreeBSD 5.1 использовались скрипты в старом стиле,
      и почти во всех случаях скрипты в новом стиле должны подойти так же
      хорошо.</p><p>Хотя каждый скрипт должен соответствовать некоторым минимальным
      требованиям, в большинстве случаев эти требования не зависят от версии
      FreeBSD.  Каждый скрипт должен иметь в конце расширение
      <code class="filename">.sh</code> и каждый скрипт должен быть выполняемым.
      Последнее требование может быть выполнено путем установки командой
      <code class="command">chmod</code> уникальных прав доступа
      <code class="literal">755</code>.  Также, как минимум, должна быть опция
      <code class="literal">start</code> для запуска приложения и опция
      <code class="literal">stop</code> для его остановки.</p><p>Простейший стартовый скрипт, пожалуй, будет похож на
      следующий:</p><pre class="programlisting">#!/bin/sh
echo -n ' utility'

case "$1" in
start)
        /usr/local/bin/utility
        ;;
stop)
        kill -9 `cat /var/run/utility.pid`
        ;;
*)
        echo "Usage: `basename $0` {start|stop}" &gt;&amp;2
        exit 64
        ;;
esac

exit 0</pre><p>Этот скрипт поддерживает опции <code class="literal">stop</code> и
      <code class="literal">start</code> для приложения, которое мы здесь называем
      просто - <code class="literal">utility</code>.</p><p>А можно запускать его и вручную, с помощью команды:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/local/etc/rc.d/utility.sh start</code></strong></pre><p>Хотя и не все программы сторонних производителей требуют
      добавления строки в файл <code class="filename">rc.conf</code>, практически
      каждый день очередной новый порт меняется так, чтобы поддерживать
      подобную конфигурацию.  Поищите в результатах, выдаваемых после
      установки более детальную информацию по конкретному приложению.
      Некоторые программы сторонних производителей будут включать стартовые
      скрипты, позволяющие использовать приложение с <code class="filename">rc.d</code>; но это мы еще
      обсудим в следующем разделе.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86500816"></a>12.5.1. Расширенное конфигурирование приложения</h3></div></div></div><p>Теперь, когда FreeBSD включает <code class="filename">rc.d</code>, конфигурирование запуска
	приложений стало более оптимальным; фактически, оно стало более
	тщательным.  С помощью ключевых слов, рассмотренных в разделе
	<a class="link" href="configtuning-rcd.html" title="12.7. Использование rc во FreeBSD 5.X и последующих версиях">rc.d</a>, приложения теперь
	можно настроить для запуска после других заданных сервисов,
	например, <acronym class="acronym">DNS</acronym>; можно разрешить передачу
	дополнительных флагов через <code class="filename">rc.conf</code> вместо
	жесткого задания флагов в стартовых скриптах, и т.д.  Простой
	скрипт может иметь следующий вид:</p><pre class="programlisting">#!/bin/sh
#
# PROVIDE: utility
# REQUIRE: DAEMON
# KEYWORD: shutdown

. /etc/rc.subr

name=utility
rcvar=utility_pidfile

command="/usr/local/sbin/utility"

load_rc_config $name

#
# НЕ МЕНЯЙТЕ ЗДЕСЬ ЭТИ СТАНДАРТНЫЕ ЗНАЧЕНИЯ
# ЗАДАВАЙТЕ ИХ В ФАЙЛЕ /etc/rc.conf
#
utility_enable=${utility_enable-"NO"}
pidfile=${utility_pidfile-"/var/run/utility.pid"}

run_rc_command "$1"</pre><p>Этот скрипт будет гарантировать, что указанное приложение
	<span class="application">utility</span> будет запущено после сервиса
	<code class="literal">daemon</code>.  Он также предоставляет метод
	для создания и отслеживания файла идентификатора процесса,
	<acronym class="acronym">PID</acronym>.</p><p>Для этого приложения затем можно поместить следующую
	строку в файл <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">utility_enable="YES"</pre><p>Этот новый метод также позволяет легко работать с аргументами
	командной строки, включать стандартные функции из файла
	<code class="filename">/etc/rc.subr</code>, обеспечивает совместимость
	с утилитой <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rcorder&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rcorder</span>(8)</span></a> и упрощает конфигурирование с помощью
	файла <code class="filename">rc.conf</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86509008"></a>12.5.2. Использование сервисов для запуска сервисов</h3></div></div></div><p>Другие сервисы, такие как даемоны сервера
	  <acronym class="acronym">POP</acronym>3, <acronym class="acronym">IMAP</acronym>, и т.п. могут
	  быть запущены с помощью <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>.  Для этого необходимо
	  установить сервисную утилиту из набора портов и добавить
	  соответствующую строчку конфигурации в файл
	  <code class="filename">/etc/inetd.conf</code> или раскомментировать
	  подходящую строку конфигурации из уже имеющихся.  Работа с даемоном
	  <span class="application">inetd</span> и его конфигурирование подробно описаны
	  в разделе <a class="link" href="network-inetd.html" title="25.2. <<Супер-сервер>> inetd">inetd</a>.</p><p>В некоторых случаях использование для запуска системных
	  служб даемона <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> может оказаться более приемлемым.  Этот
	  подход имеет несколько преимуществ, поскольку даемон
	  <code class="command">cron</code> запускает эти процессы от имени
	  владельца файла <code class="filename">crontab</code>.  Это позволяет
	  обычным пользователям запускать и поддерживать некоторые
	  приложения.</p><p>Утилита <code class="command">cron</code> поддерживает уникальную
	  возможность, <code class="literal">@reboot</code>, - это значение
	  можно использовать вместо спецификации времени.  В результате,
	  задание будет выполнено при запуске <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>, обычно -
	  в ходе инициализации системы.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="configtuning-appconfig.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="config-tuning.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="configtuning-cron.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">12.4. Настройка приложений </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 12.6. Настройка утилиты <code class="command">cron</code></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>