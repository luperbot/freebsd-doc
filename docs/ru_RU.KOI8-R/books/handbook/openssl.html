<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>14.9. OpenSSL</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="security.html" title="Глава 14. Безопасность" /><link rel="prev" href="kerberos5.html" title="14.8. Kerberos5" /><link rel="next" href="ipsec.html" title="14.10. VPN через IPsec" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.9. OpenSSL</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kerberos5.html">Пред.</a> </td><th width="60%" align="center">Глава 14. Безопасность</th><td width="20%" align="right"> <a accesskey="n" href="ipsec.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="openssl"></a>14.9. OpenSSL</h2></div><div><span class="authorgroup">Написал: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp88908752" class="indexterm"></a><p>Одной из программ, требующих особого внимания пользователей,
      является набор программ <span class="application">OpenSSL</span>,
      включенный в FreeBSD.  <span class="application">OpenSSL</span> предоставляет
      уровень шифрования поверх обычных уровней соединения; следовательно,
      он может быть использован многими сетевыми приложениями и
      сервисами.</p><p><span class="application">OpenSSL</span> может использоваться для
      шифрования соединений почтовых клиентов, транзакций через интернет,
      например для кредитных карт, и многого другого.  Многие порты,
      такие как <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/apache13-ssl/pkg-descr">www/apache13-ssl</a> и
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/mail/sylpheed-claws/pkg-descr">mail/sylpheed-claws</a> собираются
      с <span class="application">OpenSSL</span>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">В большинстве случаев в Коллекции Портов будет сделана попытка
	построения порта <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/openssl/pkg-descr">security/openssl</a>,
	если только переменная <code class="varname">WITH_OPENSSL_BASE</code>
	не установлена явно в <span class="quote"><<<span class="quote">yes</span>>></span>.</p></div><p>Версия <span class="application">OpenSSL</span>, включаемая
      в FreeBSD, поддерживает сетевые протоколы безопасности
      Secure Sockets Layer v2/v3 (SSLv2/SSLv3),
      Transport Layer Security v1 (TLSv1) и может быть использована
      в качестве основной криптографической библиотеки.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Хотя <span class="application">OpenSSL</span> поддерживает алгоритм
	<acronym class="acronym">IDEA</acronym>, по умолчанию он отключен из-за патентных
	ограничений Соединенных Штатов.  Для его использования необходимо
	ознакомиться с лицензией, и, если ограничения приемлемы,
	установить в <code class="filename">make.conf</code> переменную
	<code class="varname">MAKE_IDEA</code>.</p></div><p>Наиболее часто <span class="application">OpenSSL</span>
      используется для создания сертификатов, используемых программными
      пакетами.  Эти сертификаты подтверждают, что данные компании
      или частного лица верны и не подделаны.  Если рассматриваемый
      сертификат не был проверен одним из нескольких сертификационных центров
      (<span class="quote"><<<span class="quote">Certificate Authorities</span>>></span> - <acronym class="acronym">CA</acronym>), обычно
      выводится предупреждение.  Центр сертификации представляет собой
      компанию, такую, как <a class="link" href="http://www.verisign.com" target="_top">
      VeriSign</a>, которая подписывает сертификаты для подтверждения
      данных частных лиц или компаний.  Эта процедура не бесплатна
      и не является абсолютно необходимой для использования сертификатов;
      однако может успокоить некоторых особо осторожных
      пользователей.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88924112"></a>14.9.1. Генерирование сертификатов</h3></div></div></div><a id="idp88924752" class="indexterm"></a><p>Для генерирования сертификатов доступна следующая
	команда:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -new -nodes -out req.pem -keyout cert.pem</code></strong>
Generating a 1024 bit RSA private key
................++++++
.......................................++++++
writing new private key to 'cert.pem'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:<strong class="userinput"><code><em class="replaceable"><code>US</code></em></code></strong>
State or Province Name (full name) [Some-State]:<strong class="userinput"><code><em class="replaceable"><code>PA</code></em></code></strong>
Locality Name (eg, city) []:<strong class="userinput"><code><em class="replaceable"><code>Pittsburgh</code></em></code></strong>
Organization Name (eg, company) [Internet Widgits Pty Ltd]:<strong class="userinput"><code><em class="replaceable"><code>My Company</code></em></code></strong>
Organizational Unit Name (eg, section) []:<strong class="userinput"><code><em class="replaceable"><code>Systems Administrator</code></em></code></strong>
Common Name (eg, YOUR name) []:<strong class="userinput"><code><em class="replaceable"><code>localhost.example.org</code></em></code></strong>
Email Address []:<strong class="userinput"><code><em class="replaceable"><code>trhodes@FreeBSD.org</code></em></code></strong>

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:<strong class="userinput"><code><em class="replaceable"><code>SOME PASSWORD</code></em></code></strong>
An optional company name []:<strong class="userinput"><code><em class="replaceable"><code>Another Name</code></em></code></strong></pre><p>Ввод после приглашения <span class="quote"><<<span class="quote">Common Name</span>>></span>
	содержит имя домена.  Здесь вводится имя сервера для
	верификации; помещение в это поле чего-либо кроме
	этого имени приведет к созданию бесполезного сертификата.
	Доступны и другие параметры, например срок действия,
	альтернативные алгоритмы шифрования и т.д.  Полный список
	находится на странице справочного руководства
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=openssl&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">openssl</span>(1)</span></a>.</p><p>В текущем каталоге, из которого была вызвана вышеуказанная
	команда, должны появиться два файла.  Файл
	<code class="filename">req.pem</code> с запросом на сертификацию может быть
	послан в центр выдачи сертификатов, который проверит введённые вами
	подтверждающие данные, подпишет запрос и возвратит сертификат вам.
	Второй созданный файл будет иметь название
	<code class="filename">cert.pem</code> и содержать приватный сертификационный
	ключ, который необходимо тщательно защищать; если он попадёт в руки
	посторонних лиц, то может быть использован для имитации лично вас (или
	вашего сервера).</p><p>Когда подпись <acronym class="acronym">CA</acronym> не требуется, может
	быть создан самоподписанный сертификат.  Сначала создайте ключ
	<acronym class="acronym">RSA</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl dsaparam -rand -genkey -out myRSA.key 1024</code></strong></pre><p>Теперь создайте ключ <acronym class="acronym">CA</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl gendsa -des3 -out myca.key myRSA.key</code></strong></pre><p>Используйте этот ключ при создании сертификата:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -new -x509 -days 365 -key myca.key -out new.crt</code></strong></pre><p>В каталоге должно появиться два новых файла: подпись сертификата,
	<code class="filename">myca.key</code> и сам сертификат,
	<code class="filename">new.crt</code>.  Они должны быть помещены в каталог,
	доступный для чтения только <code class="systemitem">root</code>,
	желательно внутри <code class="filename">/etc</code>.
	Права на каталог можно изменить <code class="command">chmod</code> с параметрами
	0700.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88946768"></a>14.9.2. Использование сертификатов, пример</h3></div></div></div><p>Итак, что могут сделать эти файлы?  Хорошим применением
	может стать шифрование соединений для
	<span class="application">Sendmail</span> <acronym class="acronym">MTA</acronym>.
	Это сделает ненужным использование простой текстовой
	аутентификации для тех, кто отправляет почту через
	локальный <acronym class="acronym">MTA</acronym>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Это не лучшее из возможных использований, поскольку
	  некоторые <acronym class="acronym">MUA</acronym> выдадут ошибку, если
	  сертификат не установлен локально.  Обратитесь к
	  поставляемой с программой документации за информацией по
	  установке сертификата.</p></div><p>Следующие строки должны быть помещены в локальный файл
	<code class="filename">.mc</code>:</p><pre class="programlisting">dnl SSL Options
define(`confCACERT_PATH',`/etc/certs')dnl
define(`confCACERT',`/etc/certs/new.crt')dnl
define(`confSERVER_CERT',`/etc/certs/new.crt')dnl
define(`confSERVER_KEY',`/etc/certs/myca.key')dnl
define(`confTLS_SRV_OPTIONS', `V')dnl</pre><p>Где <code class="filename">/etc/certs/</code>
	это каталог для локального хранения сертификата и
	ключей.  После настройки необходимо собрать локальный
	файл <code class="filename">.cf</code>.  Это легко сделать,
	набрав <code class="command">make</code> <em class="parameter"><code>install</code></em>
	в каталоге <code class="filename">/etc/mail</code>.
	Затем выполните команду <code class="command">make</code>
	<em class="parameter"><code>restart</code></em>, которая должна запустить
	даемон <span class="application">Sendmail</span>.</p><p>Если все пройдет нормально, в файле
	<code class="filename">/var/log/maillog</code> не появятся сообщения
	об ошибках и запустится процесс
	<span class="application">Sendmail</span>.</p><p>Для проведения простого теста подключитесь к почтовому серверу
	программой <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnet&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">telnet</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>telnet <em class="replaceable"><code>example.com</code></em> 25</code></strong>
Trying 192.0.34.166...
Connected to <code class="systemitem">example.com</code>.
Escape character is '^]'.
220 <code class="systemitem">example.com</code> ESMTP Sendmail 8.12.10/8.12.10; Tue, 31 Aug 2004 03:41:22 -0400 (EDT)
<strong class="userinput"><code>ehlo <em class="replaceable"><code>example.com</code></em></code></strong>
250-example.com Hello example.com [192.0.34.166], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH LOGIN PLAIN
250-STARTTLS
250-DELIVERBY
250 HELP
<strong class="userinput"><code>quit</code></strong>
221 2.0.0 <code class="systemitem">example.com</code> closing connection
Connection closed by foreign host.</pre><p>Если в выводе появилась строка <span class="quote"><<<span class="quote">STARTTLS</span>>></span>,
	все работает правильно.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kerberos5.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="ipsec.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">14.8. <span class="application">Kerberos5</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 14.10. VPN через IPsec</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>