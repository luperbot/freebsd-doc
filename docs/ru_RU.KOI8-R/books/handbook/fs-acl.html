<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>14.12. Списки контроля доступа файловой системы (ACL)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="security.html" title="Глава 14. Безопасность" /><link rel="prev" href="openssh.html" title="14.11. OpenSSH" /><link rel="next" href="security-portaudit.html" title="14.13. Мониторинг вопросов безопасности в ПО сторонних разработчиков" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.12. Списки контроля доступа файловой системы (ACL)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="openssh.html">Пред.</a> </td><th width="60%" align="center">Глава 14. Безопасность</th><td width="20%" align="right"> <a accesskey="n" href="security-portaudit.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="fs-acl"></a>14.12. Списки контроля доступа файловой системы (ACL)</h2></div><div><span class="authorgroup">Предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp89419728" class="indexterm"></a><p>В дополнение к другим расширениям файловой системы, таким как
      снимки (snapshots), FreeBSD 5.0 и более поздние версии системы
      предлагают защиту с помощью списков контроля доступа файловой системы
      (File System Access Control Lists, <acronym class="acronym">ACLs</acronym>).</p><p>Списки контроля доступа расширяют стандартную модель прав <span class="trademark">UNIX</span>(R)
      высоко совместимым (<span class="trademark">POSIX</span>(R).1e) способом.  Эта возможность позволяет
      администратору получить преимущество от использования более
      интеллектуальной модели безопасности.</p><p>Для включения поддержки <acronym class="acronym">ACL</acronym> в файловой
      системе <acronym class="acronym">UFS</acronym>, следующая строка:</p><pre class="programlisting">options UFS_ACL</pre><p>должна быть добавлена в файл настройки ядра.  Если параметр не
      добавлен, при попытке монтирования систем, поддерживающих
      <acronym class="acronym">ACL</acronym>, появится предупреждающее сообщение.
      Этот параметр включен в ядро <code class="filename">GENERIC</code>.
      <acronym class="acronym">ACL</acronym> основывается на дополнительных атрибутах,
      встроенных в файловую систему.  Дополнительные атрибуты
      поддерживаются по умолчанию следующим поколением файловых систем
      <span class="trademark">UNIX</span>(R), <acronym class="acronym">UFS2</acronym>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Для включения дополнительных атрибутов в
      <acronym class="acronym">UFS1</acronym> требуется больше усилий по сравнению с
      <acronym class="acronym">UFS2</acronym>.  Производительность дополнительных
      атрибутов в <acronym class="acronym">UFS2</acronym> также существенно выше.
      По этим причинам для работы с списками контроля доступа
      предпочтительно использование <acronym class="acronym">UFS2</acronym></p></div><p><acronym class="acronym">ACL</acronym> включаются во время монтирования флагом
      <code class="option">acls</code>, который добавляется к
      <code class="filename">/etc/fstab</code>.  Этот флаг также можно сделать
      постоянным с помощью <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tunefs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">tunefs</span>(8)</span></a>, изменив флаг
      <acronym class="acronym">ACL</acronym> в заголовке файловой системы.  Вообще говоря,
      использование флага в суперблоке предпочтительно по нескольким
      причинам:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Постоянный <acronym class="acronym">ACL</acronym> флаг не может быть изменен
	  путем перемонтирования системы (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> <code class="option">-u</code>),
	  а только через <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=umount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">umount</span>(8)</span></a> и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>.  Это означает,
	  что <acronym class="acronym">ACL</acronym> нельзя включить на корневой файловой
	  системе после загрузки.  Это также означает, что вы не можете
	  изменить флаг на используемой файловой системе.</p></li><li class="listitem"><p>Установка флага в суперблоке приводит к постоянному монтированию
	  файловой системы с включенным <acronym class="acronym">ACL</acronym>, даже если
	  нет записи в <code class="filename">fstab</code> или при смене порядка
	  устройств.  Это предотвращает случайное монтирование файловой
	  системы без <acronym class="acronym">ACL</acronym>, которое может повлечь за
	  собой проблемы с безопасностью.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Мы можем изменить поведение <acronym class="acronym">ACL</acronym> для
	включения флага без полного перемонтирования, но считаем, что
	желательно исключить случайное монтирование без
	<acronym class="acronym">ACL</acronym>, поскольку вы можете попасть в неприятную
	ситуацию, если включите <acronym class="acronym">ACL</acronym>, затем выключите
	их, затем опять включите без сброса расширенных атрибутов.
	Обычно, как только вы включили <acronym class="acronym">ACL</acronym> в файловой
	системе, они не должны быть выключены, поскольку получающаяся
	защита файлов может быть не совместима с той, что применяется
	пользователями системы, и повторное включение <acronym class="acronym">ACL</acronym>
	может подключить предыдущие списки контроля доступа к файлам,
	права на которые изменены, что приведет к непредсказуемому
	поведению.</p></div><p>Файловые системы с включенными <acronym class="acronym">ACLs</acronym> показывают
      знак <code class="literal">+</code> при просмотре прав на файлы.
      Например:</p><pre class="programlisting">drwx------  2 robert  robert  512 Dec 27 11:54 private
drwxrwx---+ 2 robert  robert  512 Dec 23 10:57 directory1
drwxrwx---+ 2 robert  robert  512 Dec 22 10:20 directory2
drwxrwx---+ 2 robert  robert  512 Dec 27 11:57 directory3
drwxr-xr-x  2 robert  robert  512 Nov 10 11:54 public_html</pre><p>Здесь мы видим, что каталоги <code class="filename">directory1</code>,
      <code class="filename">directory2</code>, и <code class="filename">directory3</code>
      используют преимущества <acronym class="acronym">ACL</acronym>.  Каталог
      <code class="filename">public_html</code> их не использует.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89485264"></a>14.12.1. Использование <acronym class="acronym">ACL</acronym></h3></div></div></div><p><acronym class="acronym">ACL</acronym> файловой системы можно просмотреть
	с помощью утилиты <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getfacl&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">getfacl</span>(1)</span></a>.  Например, для просмотра
	настроек <acronym class="acronym">ACL</acronym> файла
	<code class="filename">test</code>, может использоваться команда:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>getfacl test</code></strong>
        #file:test
        #owner:1001
        #group:1001
        user::rw-
        group::r--
        other::r--</pre><p>Для изменения <acronym class="acronym">ACL</acronym> этого файла,
	вызовите утилиту <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=setfacl&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">setfacl</span>(1)</span></a>.  Выполните:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>setfacl -k test</code></strong></pre><p>Параметр <code class="option">-k</code> удалит все установленные
	на данный момент <acronym class="acronym">ACL</acronym> из файла или файловой
	системы.  Более предпочтительный метод это использование
	параметра <code class="option">-b</code>, который оставит необходимые
	для работы <acronym class="acronym">ACL</acronym> поля.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>setfacl -m u:trhodes:rwx,group:web:r--,o::--- test</code></strong></pre><p>В вышеприведенной команде параметр <code class="option">-m</code>
	использован для изменения записей <acronym class="acronym">ACL</acronym>
	по умолчанию.  Поскольку предустановленных записей не было (они были
	удалены предыдущей командой), эта команда восстановит параметры
	по умолчанию и задаст приведенные параметры.  Имейте ввиду,
	при добавлении пользователя или группы, которых нет в системе,
	на <code class="filename">stdout</code> будет выведена ошибка
	<span class="errorname">Invalid argument</span>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="openssh.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="security-portaudit.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">14.11. OpenSSH </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 14.13. Мониторинг вопросов безопасности в ПО сторонних
      разработчиков</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>