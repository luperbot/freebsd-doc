<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>11.2. Установка</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="linuxemu.html" title="Глава 11. Двоичная совместимость с Linux" /><link rel="prev" href="linuxemu.html" title="Глава 11. Двоичная совместимость с Linux" /><link rel="next" href="linuxemu-mathematica.html" title="11.3. Установка Mathematica(R)" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">11.2. Установка</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="linuxemu.html">Пред.</a> </td><th width="60%" align="center">Глава 11. Двоичная совместимость с Linux</th><td width="20%" align="right"> <a accesskey="n" href="linuxemu-mathematica.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-lbc-install"></a>11.2. Установка</h2></div></div></div><a id="idp84860368" class="indexterm"></a><p>Двоичная совместимость с Linux не включена по умолчанию.
      Простейший способ включения этой функциональности заключается
      в загрузке KLD-объекта <code class="literal">linux</code> (<span class="quote"><<<span class="quote">Kernel
      LoaDable object</span>>></span>).  Вы можете загрузить этот модуль,
      набрав следующее, как пользователь <code class="systemitem">root</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload linux</code></strong></pre><p>Если вы хотите, чтобы совместимость с Linux была включена
      постоянно, необходимо добавить в <code class="filename">/etc/rc.conf</code>
      следующую строку:</p><pre class="programlisting">linux_enable="YES"</pre><p>Для проверки того, загружен ли модуль, может быть использована
      команда <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldstat</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>kldstat</code></strong>
Id Refs Address    Size     Name
 1    2 0xc0100000 16bdb8   kernel
 7    1 0xc24db000 d000     linux.ko</pre><a id="idp84870992" class="indexterm"></a><p>Если по какой-либо причине вы не хотите или не можете загрузить
      KLD, вы можете статически включить поддержку Linux в ядро,
      добавив опцию <code class="literal">options COMPAT_LINUX</code> в файл
      конфигурации ядра.  Затем соберите и установите новое ядро,
      следуя описанию в <a class="xref" href="kernelconfig.html" title="Глава 9. Настройка ядра FreeBSD">Глава 9, <em>Настройка ядра FreeBSD</em></a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84873296"></a>11.2.1. Установка необходимых библиотек Linux</h3></div></div></div><a id="idp84873936" class="indexterm"></a><p>Установить все требуемые библиотеки можно двумя путями: либо
	используя порт <a class="link" href="linuxemu-lbc-install.html#linuxemu-libs-port" title="11.2.1.1. Установка с помощью порта linux_base">linux_base</a>,
	либо установив их <a class="link" href="linuxemu-lbc-install.html#linuxemu-libs-manually" title="11.2.1.2. Установка библиотек вручную">вручную</a>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="linuxemu-libs-port"></a>11.2.1.1. Установка с помощью порта linux_base</h4></div></div></div><a id="idp84877264" class="indexterm"></a><p>Этот метод является самым простым, и мы рекомендуем
	  воспользоваться именно им.  Процесс аналогичен установке любого
	  другого порта из <a class="link" href="file://localhost/usr/ports/" target="_top">Коллекции Портов</a>.
	  Просто выполните следующие команды:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/emulators/linux_base-fc4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install distclean</code></strong></pre><p>Теперь вы можете работать с приложениями для Linux.  Некоторые
	  программы, возможно, будут сообщать о несоответствии подверсий
	  некоторых системных библиотек.  Однако обычно это не
	  вызывает каких-либо неудобств.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Возможно наличие нескольких версий порта <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/emulators/linux_base/pkg-descr">emulators/linux_base</a>, соответствующих
	  различным версиям разных дистрибутивов Linux.  Вы должны
	  установить порт, наиболее близко соответствующий требованиям
	  приложений Linux, которые будут установлены.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="linuxemu-libs-manually"></a>11.2.1.2. Установка библиотек вручную</h4></div></div></div><p>Если у вас не установлена коллекция портов, можно
	  установить требуемые библиотеки вручную. Вам понадобятся
	  совместно используемые библиотеки для Linux, которые нужны программам, и
	  runtime-компоновщик.  Вам также потребуется создать <span class="quote"><<<span class="quote">теневой
	  корневой каталог</span>>></span>, <code class="filename">/compat/linux</code>, где
	  будут расположены Linux-библиотеки.  Если Linux-программе нужно
	  загрузить какую-либо совместно используемую библиотеку, FreeBSD сперва будет
	  пытаться найти ее в этом дереве.  Так, если программа загружает,
	  например, <code class="filename">/lib/libc.so</code>, FreeBSD попытается
	  открыть <code class="filename">/compat/linux/lib/libc.so</code>, и если
	  такого файла не существует, будет пытаться открыть
	  <code class="filename">/lib/libc.so</code>.  Разделяемые библиотеки должны
	  находиться в теневом дереве, а не в каталогах, выдаваемых
	  загрузчиком Linux <code class="command">ld.so</code>.</p><p>Обычно вам придется добавлять совместно используемые библиотеки, от
	  которых зависят Linux-программы, только при нескольких первых
	  установках приложений Linux на вашу систему FreeBSD.  По мере
	  работы, у вас в системе накопится достаточный набор совместно используемых
	  библиотек Linux для запуска новых Linux-программ без
	  дополнительных действий.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84885840"></a>11.2.1.3. Как установить дополнительные совместно используемые библиотеки</h4></div></div></div><a id="idp84886736" class="indexterm"></a><p>Что, если при установленном <code class="filename">linux_base</code>
	  порте ваше приложение все равно сообщает об отсутствии необходимой
	  библиотеки?  Как узнать, какая именно нужна библиотека и где ее
	  взять?  В принципе, есть два способа.  Вам необходимо иметь
	  привилегии пользователя <code class="systemitem">root</code> для их
	  осуществления.</p><p>Если у вас есть доступ к машине, на которой установлен Linux,
	  узнайте, какие библиотеки использует Linux-приложение, и просто
	  скопируйте из на свою машину.  Рассмотрим следующий пример:</p><div class="informalexample"><p>Допустим, вы скачали по FTP Linux-версию
	    <span class="application">Doom</span> и установили ее на Linux-машине.
	    Вы можете узнать, какие совместно используемые библиотеки нужны
	    <span class="application">Doom</span>, с помощью команды
	    <code class="command">ldd linuxdoom</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ldd linuxdoom</code></strong>
libXt.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libXt.so.3.1.0
libX11.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libX11.so.3.1.0
libc.so.4 (DLL Jump 4.5pl26) =&gt; /lib/libc.so.4.6.29</pre><a id="idp84891728" class="indexterm"></a><p>Вам потребуются все файлы, перечисленные в последнем
	    столбце.  Скопируйте их в дерево <code class="filename">/compat/linux</code>
	    на вашей системе, а также создайте символические ссылки на эти
	    файлы с именами из первого столбца, соответственно.  В итоге,
	    у вас в системе FreeBSD должны быть следующие файлы:</p><pre class="screen">/compat/linux/usr/X11/lib/libXt.so.3.1.0
/compat/linux/usr/X11/lib/libXt.so.3 -&gt; libXt.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3 -&gt; libX11.so.3.1.0
/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</pre><div class="blockquote"><blockquote class="blockquote"><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Учтите, что если у вас уже есть совместно используемая библиотека
		Linux с соответствующим первому столбцу результатов
		<code class="command">ldd</code> основным номером версии, вам не
		обязательно копировать файл, указанный в последнем столбце,
		в вашу систему.  Уже существующий файл должен подойти.
		Рекомендуется, однако, все равно скопировать совместно используемую
		библиотеку, если ее версия новее.  Предыдущую версию
		библиотеки можно удалить, если вы создали символическую ссылку
		на новую.  Итак, если у вас в системе есть следующие
		библиотеки:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">/compat/linux/lib/libc.so.4.6.27
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.27</pre><p xmlns="http://www.w3.org/1999/xhtml">и какое-либо приложение требует библиотеку более поздней
		версии, судя по результатам команды
		<code class="command">ldd</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">libc.so.4 (DLL Jump 4.5pl26) -&gt; libc.so.4.6.29</pre><p xmlns="http://www.w3.org/1999/xhtml">Если версии немного отличаются в последней цифре,
		копировать <code class="filename">/lib/libc.so.4.6.29</code>
		необязательно, так как программа, скорее всего, будет
		нормально работать и с немного устаревшей версией.
		Тем не менее, вы можете заменить
		<code class="filename">libc.so</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</pre></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Символические ссылки важны <span class="emphasis"><em>только</em></span>
		для Linux-программ.  Runtime-компоновщик FreeBSD
		самостоятельно подберет правильные номера версий библиотек,
		и вам не нужно об этом беспокоиться.</p></div></blockquote></div></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84900432"></a>11.2.2. Установка двоичных файлов Linux ELF</h3></div></div></div><a id="idp84901072" class="indexterm"></a><p>Для ELF-файлов иногда требуется сделать так называемый
	<span class="quote"><<<span class="quote">branding</span>>></span> (маркировать его).  Если попытаться
	запустить не маркированный ELF-файл, вы получите следующее сообщение
	об ошибке:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>./моя-linux-elf-программа</code></strong>
ELF binary type not known
Abort</pre><p>Чтобы помочь ядру FreeBSD отличить ELF-файл FreeBSD от
	двоичного файла Linux, используется утилита <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>brandelf -t Linux моя-linux-elf-программа</code></strong></pre><a id="idp84914384" class="indexterm"></a><p>В настоящее время набор инструментальных средств GNU
	(GNU toolchain) помещает необходимую маркировочную информацию
	в двоичные ELF-файлы автоматически, поэтому необходимость
	в этом действии возникает всё реже.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84915408"></a>11.2.3. Конфигурирование распознавания имен хостов</h3></div></div></div><p>Если DNS не работает или вы получаете это сообщение:</p><pre class="screen">resolv+: "bind" is an invalid keyword resolv+:
"hosts" is an invalid keyword</pre><p>то вам нужно создать (изменить) файл
	<code class="filename">/compat/linux/etc/host.conf</code>, содержащий:</p><pre class="programlisting">order hosts, bind
multi on</pre><p>Таким образом, вы указываете, то сначала производится поиск в
	файле <code class="filename">/etc/hosts</code>, а только затем запрашивается
	DNS.  Когда файл <code class="filename">/compat/linux/etc/host.conf</code>
	отсутствует, Linux-приложения находят файл
	<code class="filename">/etc/host.conf</code> для FreeBSD и сообщают о
	несовместимом синтаксисе.  Если вы не настраивали сервер имен
	с помощью файла <code class="filename">/etc/resolv.conf</code>, уберите
	<code class="literal">bind</code> из файла
	<code class="filename">/compat/linux/etc/host.conf</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="linuxemu.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="linuxemu.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="linuxemu-mathematica.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Глава 11. Двоичная совместимость с Linux </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 11.3. Установка <span class="trademark">Mathematica</span>(R)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>