<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>17.12. Основы технологии резервного копирования</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="disks.html" title="Глава 17. Устройства хранения" /><link rel="prev" href="backup-strategies.html" title="17.11. Стратегии резервного копирования" /><link rel="next" href="disks-virtual.html" title="17.13. Сетевые файловые системы, файловые системы в памяти и с отображением в файл" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">17.12. Основы технологии резервного копирования</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="backup-strategies.html">Пред.</a> </td><th width="60%" align="center">Глава 17. Устройства хранения</th><td width="20%" align="right"> <a accesskey="n" href="disks-virtual.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="backup-basics"></a>17.12. Основы технологии резервного копирования</h2></div></div></div><p>Тремя основными программами резервного копирования являются
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tar&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a> и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cpio&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cpio</span>(1)</span></a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91721296"></a>17.12.1. Dump и Restore</h3></div></div></div><a id="idp91721936" class="indexterm"></a><a id="idp91723216" class="indexterm"></a><a id="idp91723856" class="indexterm"></a><p>Для <span class="trademark">UNIX</span>(R) традиционными программами резервного копирования
	являются <code class="command">dump</code> и <code class="command">restore</code>.  Они
	работают с приводом как с набором дисковых блоков, которые расположены
	ниже понятий файлов, связей и каталогов, создаваемых файловыми
	системами.  В отличие от других программ для резервного копирования,
	программа <code class="command">dump</code> выполняет резервное
	копирование всей файловой системы, располагающейся на устройстве.
	Невозможно выполнить резервное копирование части файловой системы или
	дерева каталогов, которые располагаются более чем в одной файловой
	системе.  Утилита <code class="command">dump</code> не записывает на ленту файлы
	и каталоги, она записывает блоки данных, из которых строятся файлы и
	каталоги.  Утилита <code class="command">restore</code> по умолчанию настроена
	так, что в процессе своей работы она сохраняет временные файлы в
	каталог <code class="filename">/tmp/</code>.  В некоторых ситуациях доступного
	в <code class="filename">/tmp/</code> места бывает недостаточно: например, если
	вы работаете с диска восстановления (recovery disk).  В таких
	случаях для успешной работы утилиты необходимо указать в переменной
	окружения <code class="envar">TMPDIR</code> путь к каталогу на менее заполненной
	файловой системе.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Если вы используете программу <code class="command">dump</code> для работы
	  с корневым каталогом, при этом не будет выполняться резервное
	  копирование
	  <code class="filename">/home</code>, <code class="filename">/usr</code> и многих других
	  каталогов, так как они обычно являются точками монтирования других
	  файловых систем или символическими ссылками на эти файловые
	  системы.</p></div><p>В программе <code class="command">dump</code> имеются некоторые неудобства,
	оставшиеся
	от её ранних дней в составе Version 6 операционной системы AT&amp;T
	UNIX (примерно 1975).  Параметры, используемые по умолчанию, подходят
	для 9-дорожечных лент (6250 bpi), но не для современных носителей с
	высокой плотностью записи информации (до 62,182 ftpi).  Для
	использования ёмкостей нынешних накопителей на магнитной ленте эти
	параметры могут быть заданы в командной строке.</p><a id="idp91739472" class="indexterm"></a><p>При помощи <code class="command">rdump</code> и <code class="command">rrestore</code>
	возможно резервное
	копирование данных по сети на накопитель, подключенный к другому
	компьютеру.  Обе программы используют в работе <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rcmd&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">rcmd</span>(3)</span></a> и
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ruserok&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">ruserok</span>(3)</span></a> для доступа к накопителю на магнитной ленте на
	удалённом компьютере.  Поэтому пользователь, выполняющий резервное
	копирование, должен быть указан в файле <code class="filename">.rhosts</code> на
	удалённом компьютере.  Аргументы для <code class="command">rdump</code> и
	<code class="command">rrestore</code> должны подходить для использования на
	другом компьютере.  При выполнении копирования по команде
	<code class="command">rdump</code> на компьютере с FreeBSD на накопитель Exabyte,
	подключенный к машине Sun по имени <code class="systemitem">komodo</code>, используйте
	такую команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/sbin/rdump 0dsbfu 54000 13000 126 komodo:/dev/nsa8 /dev/da0a 2&gt;&amp;1</code></strong></pre><p>Будьте осторожны: есть проблемы с обеспечением безопасности при
	аутентификации посредством <code class="filename">.rhosts</code>.  Внимательно
	рассмотрите вашу ситуацию.</p><p>Программы <code class="command">dump</code> и <code class="command">restore</code>
	можно использовать в более защищённом режиме посредством
	<code class="command">ssh</code>.</p><div class="example"><a id="idp91748048"></a><div class="example-title">Пример 17.1. Использование <code class="command">dump</code> через
	  <span class="application">ssh</span></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/sbin/dump -0uan -f - /usr | gzip -2 | ssh -c blowfish \
targetuser@targetmachine.example.com dd of=/mybigfiles/dump-usr-l0.gz</code></strong></pre></div></div><br class="example-break" /><p>Либо воспользуйтесь встроенной в <code class="command">dump</code>
	возможностью, задав переменную окружения <code class="envar">RSH</code>:</p><div class="example"><a id="idp91751632"></a><div class="example-title">Пример 17.2. Использование <code class="command">dump</code> при работе через
	  <span class="application">ssh</span> с заданием <code class="envar">RSH</code></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>RSH=/usr/bin/ssh /sbin/dump -0uan -f targetuser@targetmachine.example.com:/dev/sa0 /usr</code></strong></pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91754448"></a>17.12.2. <code class="command">tar</code></h3></div></div></div><a id="idp91755344" class="indexterm"></a><p>Утилита <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tar&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a> также восходит корнями к Version 6 системы
	AT&amp;T UNIX (около 1975).  <code class="command">tar</code> работает с
	файловой системой, записывая на ленту файлы и
	каталоги.  Эта утилита
	поддерживает не полный набор опций, имеющихся в <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cpio&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cpio</span>(1)</span></a>, однако
	не требует необычного перенаправления в командной строке, которое
	используется в утилите <code class="command">cpio</code>.</p><a id="idp91759312" class="indexterm"></a><p>Чтобы скопировать
	данные на накопитель Exabyte, подключенный к машине Sun по имени
	<code class="systemitem">komodo</code>, используйте такую команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tar cf - . | rsh komodo dd of=<em class="replaceable"><code>tape-device</code></em> obs=20b</code></strong></pre><p>Если вы беспокоитесь о безопасности создания резервных копий по
	сети, то вместо <code class="command">rsh</code> вам нужно использовать
	<code class="command">ssh</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91767504"></a>17.12.3. <code class="command">cpio</code></h3></div></div></div><a id="idp91768272" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cpio&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cpio</span>(1)</span></a> является оригинальной программой <span class="trademark">UNIX</span>(R) для обмена
	файлами на магнитных носителях.  В утилите <code class="command">cpio</code>
	имеются опции (кроме всего прочего), позволяющие выполнять изменение
	порядка следования байтов, поддерживающие различные форматы архивов и
	выполняющие перенаправление данных другим программам.  Последняя
	возможность делает <code class="command">cpio</code> прекрасным выбором для
	целей установки.  <code class="command">cpio</code> не знает о том, как
	работать с каталогами, список файлов должен даваться через
	<code class="filename">stdin</code>.</p><a id="idp91772624" class="indexterm"></a><p><code class="command">cpio</code> не поддерживает создание резервных
	копий по сети.  Вы можете воспользоваться перенаправлением вывода и
	программой <code class="command">rsh</code> для посылки данных на удалённый
	накопитель.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>for f in <em class="replaceable"><code>directory_list</code></em>; do</code></strong>
<strong class="userinput"><code>find $f &gt;&gt; backup.list</code></strong>
<strong class="userinput"><code>done</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cpio -v -o --format=newc &lt; backup.list | ssh <em class="replaceable"><code>user</code></em>@<em class="replaceable"><code>host</code></em> "cat &gt; <em class="replaceable"><code>backup_device</code></em>"</code></strong></pre><p>Где directory_list это список директорий, c которых Вы хотите
	создать резервные копии,
	<em class="replaceable"><code>user</code></em>@<em class="replaceable"><code>host</code></em> это
	комбинация пользователь/хост которая описывает того кто
	занимается резервированием, и <em class="replaceable"><code>backup_device</code></em>
	это устройство куда копии должны быть записаны (например,
	<code class="filename">/dev/nsa0</code>).</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91784528"></a>17.12.4. <code class="command">pax</code></h3></div></div></div><a id="idp91785296" class="indexterm"></a><a id="idp91786576" class="indexterm"></a><a id="idp91787216" class="indexterm"></a><a id="idp91791952" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pax&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">pax</span>(1)</span></a> является ответом IEEE/<span class="trademark">POSIX</span>(R) на утилиты
	<code class="command">tar</code> и <code class="command">cpio</code>.  В течение многих лет
	различные версии программ <code class="command">tar</code> и
	<code class="command">cpio</code> получались не совсем совместимыми.  Так что
	вместо того, чтобы попытаться полностью их стандартизировать, <span class="trademark">POSIX</span>(R)
	создал новую утилиту для работы с архивами.  <code class="command">pax</code>
	пытается читать и писать различные форматы <code class="command">cpio</code>
	и <code class="command">tar</code>, и, кроме
	того, свои собственные новые форматы.  Набор команд этой утилиты больше
	напоминает <code class="command">cpio</code>, чем <code class="command">tar</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="backups-programs-amanda"></a>17.12.5. <span class="application">Amanda</span></h3></div></div></div><a id="idp91798992" class="indexterm"></a><a id="idp91804496" class="indexterm"></a><p><span class="application">Amanda</span> (Advanced Maryland Network Disk
	Archiver) является целой клиент/серверной системой резервного
	копирования, а не отдельной программой.  Сервер
	<span class="application">Amanda</span> сможет осуществлять резервное
	копирование на единственный накопитель любого количества компьютеров,
	на которых имеется клиент <span class="application">Amanda</span> и которые
	могут связываться по сети с сервером <span class="application">Amanda</span>.
	Общей проблемой систем с большим количеством больших дисков является
	то, что время, требуемое для непосредственной записи данных на ленту,
	превышает лимит времени, выделенный на эту задачу.
	<span class="application">Amanda</span> решает эту проблему.
	<span class="application">Amanda</span> может использовать
	<span class="quote"><<<span class="quote">промежуточный диск</span>>></span> для резервного копирования нескольких
	файловых систем одновременно.  <span class="application">Amanda</span>
	создаёт <span class="quote"><<<span class="quote">наборы архивов</span>>></span>: группа лент, используемых в
	некоторый период времени для создания полных копий всех файловых
	систем, перечисленных в конфигурационном файле системы
	<span class="application">Amanda</span>.  <span class="quote"><<<span class="quote">Архивный
	набор</span>>></span> содержит также создаваемый каждую ночь инкрементальные
	(или дифференциальные) резервные копии всех файловых систем.
	Восстановление повреждённой файловой системы требует наличия самой
	последней полной копии и инкрементальных резервных копий.</p><p>Конфигурационный файл даёт прекрасный механизм для управления
	процессом резервного копирования и объёмом трафика, генерируемого
	системой <span class="application">Amanda</span>.
	<span class="application">Amanda</span> сможет использовать любую из
	перечисленных выше программ для записи данных на ленту.
	<span class="application">Amanda</span> имеется в виде как
	порта, так и пакета, и по умолчанию она не установлена.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91811792"></a>17.12.6. Не делать ничего</h3></div></div></div><p><span class="quote"><<<span class="quote">Не делать ничего</span>>></span> - это не программа для компьютера,
	и в то же время это наиболее широко используемая стратегия резервного
	копирования.  Здесь нет никаких первоначальных затрат.  Здесь нет
	расписания, которому нужно следовать.  Просто скажите нет.  Если что-то
	случится с вашими данными, улыбнитесь и забудьте о них!</p><p>Если ваше время и данные практически ничего не стоят, то <span class="quote"><<<span class="quote">не
	делать ничего</span>>></span> является самой подходящей программой для вашего
	компьютера.  Но будьте осторожны, <span class="trademark">POSIX</span>(R) является весьма полезным
	инструментом, и через полгода вы можете обнаружить, что у вас есть
	набор файлов, представляющих для вас определенную ценность.</p><p><span class="quote"><<<span class="quote">Ничего не делать</span>>></span> является правильным методом
	резервного копирования для <code class="filename">/usr/obj</code> и других
	деревьев каталогов, которые могут быть в точности перегенерированы
	вашим компьютером.  Примером являются файлы, представляющие страницы
	этого Руководства в форматах HTML или <span class="trademark">PostScript</span>(R).  Они генерируются
	из входных файлов в формате SGML.  Создавать резервные копии файлов в
	форматах HTML и <span class="trademark">PostScript</span>(R) не нужно.  Исходные файлы в формате SGML
	копируются регулярно.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91841232"></a>17.12.7. Какая программа резервного копирования самая лучшая?</h3></div></div></div><a id="idp91841872" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> <span class="emphasis"><em>Точка.</em></span> Elizabeth D. Zwicky
      протестировала все программы резервного копирования, обсуждаемые здесь.
      Беспроигрышным вариантом для сохранения всех ваших данных и
      особенностей файловых систем <span class="trademark">UNIX</span>(R) является <code class="command">dump</code>.
      Элизабет создала файловые системы, содержащие большое количество
      необычных элементов (и некоторых не так уж необычных) и тестировала
      каждую из программ, выполняя резервное копирование и последующее
      восстановление этих файловых систем.  В число необычных элементов
      входили: файлы с дырами, файлы с дырами и блоком пустого места, файлы с
      необычными символами в их именах, нечитаемые и незаписываемые файлы,
      устройства, меняющие свой размер во время резервного копирования, файлы,
      создаваемые и удаляемые во время копирования и тому подобное.  Она
      представила результаты на конференции LISA V в октябре 1991 года.
      Посмотрите ссылку на сайте <a class="link" href="http://www.coredumps.de/doc/dump/zwicky/testdump.doc.html" target="_top">
      torture-testing Backup and Archive Programs</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91845712"></a>17.12.8. Процедура восстановления при сбое</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91846352"></a>17.12.8.1. До того, как случится катастрофа</h4></div></div></div><p>Вам нужно выполнить всего лишь четыре шага для того, чтобы быть
	готовым к любому сбою.</p><a id="idp91847376" class="indexterm"></a><p>Во-первых, распечатайте разметку диска для всех ваших дисков
	(к примеру, <code class="command">bsdlabel da0 | lpr</code>), таблицу файловых
	систем (<code class="filename">/etc/fstab</code>) и все сообщения, выводимые
	при загрузке, каждого по два экземпляра.</p><a id="idp91849424" class="indexterm"></a><p>Во-вторых, запишите CD диск с <span class="quote"><<<span class="quote">livefs</span>>></span>.  Этот диск
	  позволяет загружаться в режим аварийного восстановления FreeBSD,
	  давая возможность пользователю выполнять ряд утилит, среди которых
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=restore&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">restore</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fdisk&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">fdisk</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a>,
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> и т.д.  Образ CD с <span class="quote"><<<span class="quote">livefs</span>>></span>
	  для FreeBSD/i386 10.1-RELEASE находится
	  по адресу <code class="uri"><a class="uri" href="ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/10.1/FreeBSD-10.1-RELEASE-i386-livefs.iso" target="_top">ftp://ftp.FreeBSD.org/pub/FreeBSD/releases/i386/ISO-IMAGES/10.1/FreeBSD-10.1-RELEASE-i386-livefs.iso</a></code>.</p><p>В-третьих, регулярно создавайте резервные копии на ленте.  Любые
	изменения, которые вы делали после последнего резервного копирования,
	могут быть безвозвратно потеряны.  На лентах включайте защиту от
	записи.</p><p>В-четвертых, проверяйте работу CD диска
	(который вы сделали при выполнении второго шага) и лент
	с резервными копиями.  Ведите журнал выполняемых действий.  Храните
	эти записи вместе с загрузочным CD диском, распечатками и лентами.
	Вы просто обезумеете при восстановлении данных, если окажется, что
	записи помогли бы избежать разрушения ваших резервных копий (Каким
	образом?  Вместо команды <code class="command">tar xvf /dev/sa0</code> вы
	могли случайно набрать <code class="command">tar cvf /dev/sa0</code> и тем
	самым перезаписать вашу резервную копию).</p><p>Для дополнительной страховки, каждый раз создавайте загрузочный
	CD диск с <span class="quote"><<<span class="quote">livefs</span>>></span> и две резервные копии на ленте.
	Храните одну из копий в
	каком-то удаленном месте и НЕ в том же здании, где находится ваш
	офис.  Достаточно большое количество компаний во Всемирном Торговом
	Центре изучило это на своей шкуре.  Это удаленное хранилище должно
	быть физически отделено на большое расстояние от ваших компьютеров и
	дисковых устройств.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91866960"></a>17.12.8.2. После сбоя</h4></div></div></div><p>Главный вопрос: выжило ли ваше оборудование?  Вы регулярно делали
	резервные копии, так что нет нужды беспокоиться о программном
	обеспечении.</p><p>Если оборудование было повреждено, должны быть заменены
	неисправные компоненты.</p><p>Если с оборудованием всё в порядке, вставьте CD диск
	  с <span class="quote"><<<span class="quote">livefs</span>>></span> в привод и загрузите
	компьютер.  На экран будет выведено оригинальное меню установки.
	  Выберите требуемую страну, потом - пункт меню
	  <span class="guimenuitem">Fixit -- Repair mode with CDROM/DVD/floppy or
	  start a shell.</span>, а в нём выберите пункт
	  <span class="guimenuitem">CDROM/DVD -- Use the live filesystem
	  CDROM/DVD</span>.  Утилита
	<code class="command">restore</code> и другие
	нужные вам программы находятся в каталоге <code class="filename">/mnt2/rescue</code>.</p><p>Восстановите по отдельности каждую файловую систему.</p><a id="idp91883472" class="indexterm"></a><a id="idp91884112" class="indexterm"></a><a id="idp91884624" class="indexterm"></a><a id="idp91885264" class="indexterm"></a><p>Попробуйте выполнить команду <code class="command">mount</code> (например,
	<code class="command">mount /dev/da0a /mnt</code>) по отношению к корневому
	разделу вашего первого диска.  Если метка диска была испорчена,
	то воспользуйтесь командой <code class="command">bsdlabel</code> для
	переразбиения на
	разделы и разметки диска так, чтобы получившаяся метка совпала с той,
	которая вами была распечатана и сохранена.  Для повторного создания
	файловых систем используйте утилиту <code class="command">newfs</code>.  Повторно
	смонтируйте корневой раздел диска в режиме чтения-записи
	(<code class="command">mount -u -o rw /mnt</code>).  Воспользуйтесь вашей
	программой резервного копирования и резервными копиями на лентах для
	восстановления данных для этой файловой системы (например.
	<code class="command">restore vrf /dev/sa0</code>).  Размонтируйте файловую
	систему (например, <code class="command">umount /mnt</code>).  Повторите эту
	процедуру для каждой файловой системы, которая была повреждена.</p><p>Как только ваша система заработает, сделайте резервную копию на
	новые ленты.  Что бы ни вызвало сбой или потерю данных, это может
	случиться снова.  Ещё один час, потраченный в этот момент, может
	спасти вас от неприятностей в будущем.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="backup-strategies.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="disks-virtual.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">17.11. Стратегии резервного копирования </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 17.13. Сетевые файловые системы, файловые системы в памяти и с отображением
      в файл</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>