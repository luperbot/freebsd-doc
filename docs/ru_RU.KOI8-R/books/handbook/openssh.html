<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>14.11. OpenSSH</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="security.html" title="Глава 14. Безопасность" /><link rel="prev" href="ipsec.html" title="14.10. VPN через IPsec" /><link rel="next" href="fs-acl.html" title="14.12. Списки контроля доступа файловой системы (ACL)" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.11. OpenSSH</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ipsec.html">Пред.</a> </td><th width="60%" align="center">Глава 14. Безопасность</th><td width="20%" align="right"> <a accesskey="n" href="fs-acl.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="openssh"></a>14.11. OpenSSH</h2></div><div><span class="authorgroup">Предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div></div></div><a id="idp89225936" class="indexterm"></a><a id="idp89226448" class="indexterm"></a><p><span class="application">OpenSSH</span> это набор сетевых инструментов,
      используемых для защищенного доступа к удаленным компьютерам.
      Он может быть использован в качестве непосредственной замены
      <code class="command">rlogin</code>, <code class="command">rsh</code>,
      <code class="command">rcp</code> и <code class="command">telnet</code>.
      Кроме того, через SSH могут быть безопасно туннелированы и/или
      перенаправлены произвольные TCP/IP соединения.
      <span class="application">OpenSSH</span> шифрует весь трафик, эффективно
      предотвращая кражу данных, перехват соединения и другие сетевые
      атаки.</p><p><span class="application">OpenSSH</span> поддерживается проектом
      OpenBSD, он основан на SSH v1.2.12 со всеми последними исправлениями
      и обновлениями, совместим с протоколами SSH версий 1 и 2.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89235024"></a>14.11.1. Преимущества использования OpenSSH</h3></div></div></div><p>Обычно при использовании <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnet&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">telnet</span>(1)</span></a> или <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rlogin&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rlogin</span>(1)</span></a>
	данные пересылаются по сети в незашифрованной форме.  Перехватчик
	пакетов в любой точке сети между клиентом и сервером может
	похитить информацию о пользователе/пароле или данные, передаваемые
	через соединение.  Для предотвращения этого
	<span class="application">OpenSSH</span> предлагает различные методы
	шифрования.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89238096"></a>14.11.2. Включение sshd</h3></div></div></div><a id="idp89238736" class="indexterm"></a><p>В FreeBSD даемон <span class="application">sshd</span> должен
	быть разрешен в процессе инсталляции.  За запуск ответственна
	следующая строка в файле <code class="filename">rc.conf</code>:</p><pre class="screen">sshd_enable="YES"</pre><p>При следующей загрузке системы будет запущен <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a>, даемон для
	<span class="application">OpenSSH</span>.  Вы можете также воспользоваться
	скриптом <code class="filename">/etc/rc.d/sshd</code> системы <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a>
	для запуска <span class="application">OpenSSH</span>:</p><pre class="programlisting">/etc/rc.d/sshd start</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89245136"></a>14.11.3. SSH клиент</h3></div></div></div><a id="idp89245776" class="indexterm"></a><p>Утилита <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> работает подобно <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rlogin&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rlogin</span>(1)</span></a>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ssh <em class="replaceable"><code>user@example.com</code></em></code></strong>
Host key not found from the list of known hosts.
Are you sure you want to continue connecting (yes/no)? <strong class="userinput"><code>yes</code></strong>
Host 'example.com' added to the list of known hosts.
user@example.com's password: <strong class="userinput"><code>*******</code></strong></pre><p>Вход продолжится так же, как если бы сессия была инициирована
	с использованием <code class="command">rlogin</code> или
	<code class="command">telnet</code>.  SSH использует систему опознавательных
	ключей для проверки подлинности сервера при подключении клиента.
	Пользователю предлагается <code class="literal">yes</code> только при первом
	подключении.  Дальнейшие попытки входа предваряются проверкой
	сохраненного ключа сервера.  SSH клиент сообщит вам, если сохраненный
	ключ будет отличаться от только что полученного.  Ключи серверов
	сохраняются в <code class="filename">~/.ssh/known_hosts</code>, или в
	<code class="filename">~/.ssh/known_hosts2</code> для SSH v2.</p><p>По умолчанию современные серверы <span class="application">OpenSSH</span>
	настроены на приём только соединений SSH v2.  Клиент будет
	использовать версию 2 там, где это возможно, а затем версию 1.
	Также, клиент можно заставить использовать конкретную версию при помощи
	опций <code class="option">-1</code> и <code class="option">-2</code> для указания
	соответствующей версии протокола.  Версия 1 поддерживается ради
	совместимости со старыми серверами.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89254864"></a>14.11.4. Безопасное копирование</h3></div></div></div><a id="idp89255504" class="indexterm"></a><a id="idp89264976" class="indexterm"></a><p>Команда <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a> работает подобно <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rcp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rcp</span>(1)</span></a>; она копирует
	файл с удаленного компьютера, но делает это безопасным
	способом.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code> scp <em class="replaceable"><code>user@example.com:/COPYRIGHT COPYRIGHT</code></em></code></strong>
user@example.com's password: <strong class="userinput"><code>*******</code></strong>
COPYRIGHT            100% |*****************************|  4735       00:00
<code class="prompt">#</code></pre><p>Поскольку в предыдущем примере ключ сервера уже был сохранен,
	в этом примере он проверяется при использовании <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a>.</p><p>Параметры, передаваемые <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a>, похожи на параметры
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cp</span>(1)</span></a>, с файлом или файлами в качестве первого аргумента и
	приемником копирования во втором.  Поскольку файлы файлы передаются
	по сети через SSH, один или более аргументов принимают форму
	<code class="option">user@host:&lt;path_to_remote_file&gt;</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89273168"></a>14.11.5. Настройка</h3></div></div></div><a id="idp89273808" class="indexterm"></a><p>Системные файлы настройки для даемона и клиента
	<span class="application">OpenSSH</span> расположены в каталоге
	<code class="filename">/etc/ssh</code>.</p><p>Файл <code class="filename">ssh_config</code> используется для настройки
	клиента, а <code class="filename">sshd_config</code> для даемона.</p><p>Кроме того, параметры <code class="option">sshd_program</code>
	(по умолчанию <code class="filename">/usr/sbin/sshd</code>), и
	<code class="option">sshd_flags</code> <code class="filename">rc.conf</code>
	дают дополнительные возможности настройки.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ssh-keygen"></a>14.11.6. ssh-keygen</h3></div></div></div><p>Вместо использования паролей, с помощью <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a>
	можно создать ключи DSA или RSA, которыми
	пользователи могут аутентифицироваться:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh-keygen -t <em class="replaceable"><code>dsa</code></em></code></strong>
Generating public/private dsa key pair.
Enter file in which to save the key (/home/user/.ssh/id_dsa):
Created directory '/home/user/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/user/.ssh/id_dsa.
Your public key has been saved in /home/user/.ssh/id_dsa.pub.
The key fingerprint is:
bb:48:db:f2:93:57:80:b6:aa:bc:f5:d5:ba:8f:79:17 user@host.example.com
</pre><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a> создаст пару публичного и приватного
	ключей, используемых для аутентификации.  Приватный ключ сохраняется
	в <code class="filename">~/.ssh/id_dsa</code> или
	<code class="filename">~/.ssh/id_rsa</code>, а публичный в
	<code class="filename">~/.ssh/id_dsa.pub</code> или
	<code class="filename">~/.ssh/id_rsa.pub</code> (для ключей DSA и RSA
	соответственно).  Для включения
	аутентификации по ключам публичный ключ должен
	быть помещен в файл <code class="filename">~/.ssh/authorized_keys</code>
	на удаленном компьютере.</p><p>Это позволяет соединяться с удаленным компьютером с помощью
	SSH-ключей вместо паролей.</p><p>Если при генерации ключей был использован пароль, каждый раз
	для при использовании приватного ключа он будет запрашиваться
	у пользователя.  Для того, чтобы избежать непрерывного набора
	кодовой фразы, можно использовать утилиту <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a>,
	как описано в разделе <a class="xref" href="openssh.html#security-ssh-agent" title="14.11.7. Утилиты ssh-agent и ssh-add">Раздел 14.11.7, <<Утилиты ssh-agent и ssh-add>></a>
	ниже.</p><div xmlns="" class="warning"><h3 class="admontitle">Предупреждение: </h3><p xmlns="http://www.w3.org/1999/xhtml">Параметры и имена файлов могут различаться для разных
	версий <span class="application">OpenSSH</span>, установленных в системе,
	для решения проблем обратитесь к странице справочника
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-ssh-agent"></a>14.11.7. Утилиты ssh-agent и ssh-add</h3></div></div></div><p>Утилиты <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-add&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-add</span>(1)</span></a> позволяют
	сохранять ключи <span class="application">SSH</span> в памяти, чтобы
	не набирать кодовые фразы при каждом использовании ключа.</p><p>Утилита <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> обеспечивает процесс аутентификации
	загруженными в нее секретными ключами; для этого утилита
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> должна запустить внешний процесс.  В самом простом
	случае это может быть шелл-процесс; в чуть более продвинутом -
	оконный менеджер.</p><p>Для использования <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> совместно с шеллом,
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> должен быть запущен с именем этого шелла
	в качестве аргумента.  После этого в его память при помощи
	утилиты  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-add&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-add</span>(1)</span></a> могут быть добавлены необходимые ключи;
	при этом будут запрошены соответствующие кодовые фразы.
	Добавленные ключи могут затем использоваться для <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a>
	на машины, на которых установлены соответствующие публичные
	ключи:</p><pre class="screen"><code class="prompt">%</code> ssh-agent <em class="replaceable"><code>csh</code></em>
<code class="prompt">%</code> ssh-add
Enter passphrase for /home/user/.ssh/id_dsa:
Identity added: /home/user/.ssh/id_dsa (/home/user/.ssh/id_dsa)
<code class="prompt">%</code></pre><p>Для того чтобы использовать <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> в X11,
	вызов <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a>должен быть помещен в файл
	<code class="filename">~/.xinitrc</code>.  Это обеспечит поддержкой
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> все программы, запущенные в X11.  Файл
	<code class="filename">~/.xinitrc</code> может выглядеть, например,
	так:</p><pre class="programlisting">exec ssh-agent <em class="replaceable"><code>startxfce4</code></em></pre><p>При этом будет запущен <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a>, который, в свою
	очередь, вызовет запуск <span class="application">XFCE</span>, при каждом
	старте X11.  После запуска X11, выполните команду <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-add&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-add</span>(1)</span></a>
	для добавления ваших SSH-ключей.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-ssh-tunneling"></a>14.11.8. Туннелирование SSH</h3></div></div></div><a id="idp89340368" class="indexterm"></a><p><span class="application">OpenSSH</span> поддерживает возможность
	создания туннеля для пропуска соединения по другому протоколу
	через защищенную сессию.</p><p>Следующая команда указывает <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> создать туннель для
	<span class="application">telnet</span>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L <em class="replaceable"><code>5023:localhost:23 user@foo.example.com</code></em></code></strong>
<code class="prompt">%</code></pre><p>Команда <code class="command">ssh</code> используется со следующими
	параметрами:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-2</code></span></dt><dd><p>Указывает <code class="command">ssh</code> использовать версию
	      2 протокола (не используйте этот параметр, если работаете
	      со старыми SSH серверами).</p></dd><dt><span class="term"><code class="option">-N</code></span></dt><dd><p>Означает использование в не-командном режиме, только для
	      туннелирования.  Если этот параметр опущен,
	      <code class="command">ssh</code> запустит обычную сессию.</p></dd><dt><span class="term"><code class="option">-f</code></span></dt><dd><p>Указывает <code class="command">ssh</code> запускаться в фоновом
	      режиме.</p></dd><dt><span class="term"><code class="option">-L</code></span></dt><dd><p>Означает локальный туннель в стиле
	      <em class="replaceable"><code>localport:remotehost:remoteport</code></em>.</p></dd><dt><span class="term"><code class="option">user@foo.example.com</code></span></dt><dd><p>Удаленный сервер SSH.</p></dd></dl></div><p>Туннель SSH создается путем создания прослушивающего сокета
	на определенном порту <code class="systemitem">localhost</code>.  Затем все
	принятые на локальном хосту/порту соединения переправляются на
	через SSH на определенный удаленный хост и порт.</p><p>В этом примере, порт <em class="replaceable"><code>5023</code></em> на
	<code class="systemitem">localhost</code> перенаправляется на порт
	<em class="replaceable"><code>23</code></em> на <code class="systemitem">localhost</code>
	удаленного компьютера.  Поскольку <em class="replaceable"><code>23</code></em>
	это порт <span class="application">telnet</span>, будет создано защищенное
	соединение <span class="application">telnet</span> через туннель
	SSH.</p><p>Этот метод можно использовать для любого числа небезопасных
	протоколов, таких как SMTP, POP3, FTP, и так далее.</p><div class="example"><a id="idp89360848"></a><div class="example-title">Пример 14.1. Использование SSH для создания защищенного туннеля на
	  SMTP</div><div class="example-contents"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L <em class="replaceable"><code>5025:localhost:25 user@mailserver.example.com</code></em></code></strong>
user@mailserver.example.com's password: <strong class="userinput"><code>*****</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>telnet localhost 5025</code></strong>
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
220 mailserver.example.com ESMTP</pre><p>Этот метод можно использовать вместе с <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a>
	  и дополнительными пользовательскими учётными записями для
	  создания более удобного автоматического SSH туннелирования.
	  Ключи могут быть использованы вместо паролей, и туннели
	  могут запускаться от отдельных пользователей.</p></div></div><br class="example-break" /><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89373520"></a>14.11.8.1. Практические примеры SSH туннелирования</h4></div></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89374160"></a>14.11.8.1.1. Защищенный доступ к серверу POP3</h5></div></div></div><p>На работе находится SSH сервер, принимающий соединения
	    снаружи.  В этой же офисной сети находится почтовый сервер,
	    поддерживающий протокол POP3.  Сеть или сетевое соединение
	    между вашим домом и офисом могут быть или не быть полностью
	    доверяемыми.  По этой причине вам потребуется проверять
	    почту через защищенное соединение.  Решение состоит в создании
	    SSH соединения к офисному серверу SSH и туннелирование
	    через него к почтовому серверу.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L <em class="replaceable"><code>2110:mail.example.com:110 user@ssh-server.example.com</code></em></code></strong>
user@ssh-server.example.com's password: <strong class="userinput"><code>******</code></strong></pre><p>Когда туннель включен и работает, вы можете настроить
	    почтовый клиент для отправки запросов POP3 на
	    <code class="systemitem">localhost</code>, порт 2110.  Соединение будет
	    безопасно переправлено через туннель на
	    <code class="systemitem">mail.example.com</code>.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89378000"></a>14.11.8.1.2. Прохождение через Драконовский Брандмауэр</h5></div></div></div><p>Некоторые сетевые администраторы устанавливают
	    на брандмауэрах драконовские правила,
	    фильтруя не только входящие соединения, но и исходящие.
	    Вам может быть разрешен доступ к удаленным компьютерам только
	    по портам 22 и 80, для SSH и просмотра сайтов.</p><p>Вам может потребоваться доступ к другому (возможно, не
	    относящемуся к работе) сервису, такому как Ogg Vorbis
	    для прослушивания музыки.  Если этот сервер Ogg Vorbis
	    выдает поток не с портов 22 или 80, вы не сможете получить
	    к нему доступ.</p><p>Решение состоит в создании SSH соединения с компьютером
	    вне брандмауэра и использование его для туннелирования
	    сервера Ogg Vorbis.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L <em class="replaceable"><code>8888:music.example.com:8000 user@unfirewalled-system.example.org</code></em></code></strong>
user@unfirewalled-system.example.org's password: <strong class="userinput"><code>*******</code></strong></pre><p>Клиентскую программу теперь можно настроить на
	    <code class="systemitem">localhost</code> порт 8888, который будет перенаправлен
	    на <code class="systemitem">music.example.com</code> порт 8000, успешно
	    обойдя брандмауэр.</p></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89382992"></a>14.11.9. Параметр ограничения пользователей
	<code class="varname">AllowUsers</code></h3></div></div></div><p>Зачастую хорошие результаты даёт ограничение того, какие
	именно пользователи и откуда могут регистрироваться в системе.
	Задание параметра <code class="literal">AllowUsers</code> является хорошим
	способом добиться этого.  К примеру, для разрешения регистрации только
	пользователю <code class="systemitem">root</code> с машины <code class="systemitem">192.168.1.32</code>, в файле
	<code class="filename">/etc/ssh/sshd_config</code> нужно указать нечто вроде
	следующего:</p><pre class="programlisting">AllowUsers root@192.168.1.32</pre><p>Для разрешения регистрации пользователя <code class="systemitem">admin</code>
	из любой точки, просто укажите имя пользователя:</p><pre class="programlisting">AllowUsers admin</pre><p>Несколько пользователей должны перечислять в одной строке, как
	здесь:</p><pre class="programlisting">AllowUsers root@192.168.1.32 admin</pre><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Важно, чтобы бы перечислили всех пользователей, которые должны
	  регистрироваться на этой машине; в противном случае они будут
	  заблокированы.</p></div><p>После внесения изменений в
	<code class="filename">/etc/ssh/sshd_config</code> вы должны указать
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> на повторную загрузку конфигурационных файлов, выполнив
	следующую команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/sshd reload</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89404240"></a>14.11.10. Дополнительная литература</h3></div></div></div><p><a class="link" href="http://www.openssh.com/" target="_top">OpenSSH</a></p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a>
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-add&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-add</span>(1)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh_config&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ssh_config</span>(5)</span></a></p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sftp-server&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sftp-server</span>(8)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sshd_config&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">sshd_config</span>(5)</span></a></p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ipsec.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="fs-acl.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">14.10. VPN через IPsec </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 14.12. Списки контроля доступа файловой системы (ACL)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>