<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>22.4. Входящие соединения по модему</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="serialcomms.html" title="Глава 22. Последовательные соединения" /><link rel="prev" href="term.html" title="22.3. Терминалы" /><link rel="next" href="dialout.html" title="22.5. Исходящие соединения по модему" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">22.4. Входящие соединения по модему</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="term.html">Пред.</a> </td><th width="60%" align="center">Глава 22. Последовательные соединения</th><td width="20%" align="right"> <a accesskey="n" href="dialout.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dialup"></a>22.4. Входящие соединения по модему</h2></div><div><span class="authorgroup">Предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Guy</span> <span class="surname">Helmer</span></span>. </span></div><div><span class="authorgroup">Дополнил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Sean</span> <span class="surname">Kelly</span></span>. </span></div></div></div><a id="idp94676688" class="indexterm"></a><p>Настройка системы FreeBSD для поддержки входящих соединений
      очень похожа на подсоединение терминалов за исключением того,
      что вы работаете с модемами вместо терминалов.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94677584"></a>22.4.1. Внешние и внутренние модемы</h3></div></div></div><p>Внешние модемы более удобны для дозвона, поскольку легко могут
	  быть настроены с помощью параметров, сохраняемых в энергонезависимой
	  памяти.  На них обычно есть индикаторы, отображающие состояние
	  основных RS-232 сигналов.  Мигающие индикаторы впечатляют,
	  но кроме того они также очень полезны для индикации правильной
	  работы модема.</p><p>Внутренние модемы обычно не снабжаются энергонезависимой
	  памятью, поэтому их настройка может ограничиваться установкой
	  DIP переключателей.  Если на внутреннем модеме есть индикаторы,
	  их обычно сложно увидеть при закрытой крышке корпуса.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94678992"></a>22.4.1.1. Модемы и кабели</h4></div></div></div><a id="idp94683856" class="indexterm"></a><p>Если вы используете внешний модем, несомненно потребуется
	  подходящий кабель.  Стандартный RS-232C кабель должен подойти, если
	  подключены все обычные сигналы:</p><div class="table"><a id="serialcomms-signal-names"></a><div class="table-title">Таблица 22.4. Наименования сигналов</div><div class="table-contents"><table summary="Наименования сигналов" width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">Сокращение</th><th align="left">Наименование</th><th align="left">Назначение</th></tr></thead><tbody><tr><td><acronym class="acronym">RD</acronym></td><td>Received Data</td><td>Принимаемые данные</td></tr><tr><td><acronym class="acronym">TD</acronym></td><td>Transmitted Data</td><td>Передаваемые данные</td></tr><tr><td><acronym class="acronym">DTR</acronym></td><td>Data Terminal Ready</td><td>Готовность терминала</td></tr><tr><td><acronym class="acronym">DSR</acronym></td><td>Data Set Ready</td><td>Готовность данных</td></tr><tr><td><acronym class="acronym">DCD</acronym></td><td>Data Carrier Detect</td><td>Наличие несущей</td></tr><tr><td><acronym class="acronym">SG</acronym></td><td>Signal Ground</td><td>Сигнальная земля</td></tr><tr><td><acronym class="acronym">RTS</acronym></td><td>Request to Send</td><td>Запрос на посылку</td></tr><tr><td><acronym class="acronym">CTS</acronym></td><td>Clear to Send</td><td>Готовность к приему</td></tr></tbody></table></div></div><br class="table-break" /><p>FreeBSD требуются сигналы <acronym class="acronym">RTS</acronym> и
	  <acronym class="acronym">CTS</acronym> для контроля передачи на скоростях выше
	  2400 bps, сигнал <acronym class="acronym">CD</acronym> для определения, был ли
	  ответ на сигнал или произошло отключение линии, и сигнал
	  <acronym class="acronym">DTR</acronym> для сброса модема после завершения
	  сессии.  Некоторые кабели не поддерживают все необходимые
	  сигналы, поэтому, если вы столкнулись с проблемами, например,
	  если сессия не завершается после отсоединения линии, причиной
	  возможно являются проблемы с кабелем.</p><p>Как и другие <span class="trademark">UNIX</span>(R) подобные операционные системы, FreeBSD
	  использует аппаратные сигналы для определения того, был ли
	  ответ на звонок или линия была отключена и требуется
	  завершить работу модема и сбросить его в начальное состояние.
	  FreeBSD избегает отправлять команды модему или просматривать
	  отчеты о статусе от модема.  Если вы знакомы с настройкой
	  BBS, это может показаться неудобным.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94713936"></a>22.4.2. Рекомендации по последовательным интерфейсам</h3></div></div></div><p>FreeBSD поддерживает интерфейсы, основанные на NS8250, NS16450,
	  NS16550, и NS16550A EIA RS-232C (CCITT V.24).  Устройства 8250 и
	  16450 снабжены односимвольным буфером.  Устройство 16550 снабжено
	  16-ти символьным буфером, который повышает производительность
	  системы.  (Ошибки в 16550 делают невозможным использование
	  16-символьного буфера, поэтому используйте 16550A если возможно).
	  Поскольку устройства с односимвольным буфером предъявляют большие
	  требования к операционной системе, чем с 16-ти символьным буфером,
	  предпочтительны устройства на 16550A.  Если в системе много
	  активных последовательных портов или нагрузка велика,
	  устройства на 16550A лучше подходят для поддержки соединений с
	  малым количеством ошибок.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94715088"></a>22.4.3. Краткий обзор</h3></div></div></div><a id="idp94715728" class="indexterm"></a><p>Как и с терминалами, <code class="command">init</code> запускает процесс
	<code class="command">getty</code> на каждом настроенном для входящих
	звонков последовательном порту.  Например, если модем подключен
	к <code class="filename">/dev/ttyd0</code>, команда <code class="command">ps ax</code>
	может вывести следующее:</p><pre class="screen"> 4850 ??  I      0:00.09 /usr/libexec/getty V19200 ttyd0</pre><p>Когда пользователь дозванивается на подключенный модем, модем
	выдает сигнал <acronym class="acronym">CD</acronym> (Carrier Detect).
	Ядро определяет, что несущая обнаружена и завершает открытие порта
	командой <code class="command">getty</code>.  <code class="command">getty</code>
	отправляет приглашение <code class="prompt">login:</code> на указанной скорости.
	<code class="command">getty</code> ожидает в ответ набор символов, и, как
	правило, получает неправильный набор (обычно это происходит
	из-за того, что скорость соединения модема отличается от скорости
	<code class="command">getty</code>).  <code class="command">getty</code> пробует
	подобрать скорость линии до тех пор, пока не получит правильный
	набор символов.</p><a id="idp94721744" class="indexterm"></a><p>После того, как будет введено имя пользователя,
	<code class="command">getty</code> выполняет
	<code class="filename">/usr/bin/login</code>, которая завершает вход,
	запрашивая пароль пользователя и запуская оболочку.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94723920"></a>22.4.4. Файлы настройки</h3></div></div></div><p>Есть три файла настройки системы в каталоге
	<code class="filename">/etc</code>, которые возможно потребуется
	отредактировать для включения удаленного доступа по модему в FreeBSD.
	Первый, <code class="filename">/etc/gettytab</code>, содержит информацию по
	настройке даемона <code class="filename">/usr/libexec/getty</code>.
	Второй, <code class="filename">/etc/ttys</code>, содержит информацию,
	указывающую <code class="filename">/sbin/init</code> на каких устройствах
	<code class="filename">tty</code> должны быть запущены процессы
	<code class="command">getty</code>.  Наконец, вы можете поместить команды
	инициализации портов в скрипт /etc/rc.d/serial.</p><p>В <span class="trademark">UNIX</span>(R) есть две школы настройки модемов для входящих соединений.
	Одна предпочитает настраивать модемы и системы так, что не
	важно на какой скорости подсоединяется удаленный пользователь.
	Локальный интерфейс RS-232 компьютер-модем работает на жестко
	заданной скорости.  Преимущество этой настройки в том, что
	удаленный пользователь всегда сразу видит приглашение ко входу.
	Обратная сторона в том, что система не знает, какова на самом
	деле скорость передачи данных, поэтому полноэкранные программы,
	такие как Emacs, не настраивают свои методы отображения на экране
	для работы с медленными соединениями.</p><p>Другая школа настраивает интерфейс RS-232 для работы с различной
	скоростью в зависимости от скорости подсоединения удаленного
	пользователя.  Например, соединение модемов по протоколу V.32bis
	(14.4 Кбит/с) установит скорость порта RS-232 равной
	19.2 Кбит/с, а соединение на скорости 2400 бит/с
	установит скорость RS-232 равной 2400 бит/с. Поскольку
	<code class="command">getty</code> не понимает сообщений модема о
	скорости соединения, <code class="command">getty</code> выдает
	приглашение <code class="prompt">login:</code> на установленной по умолчанию
	скорости и считывает символы, полученные в ответе. Если пользователь
	видит <span class="quote"><<<span class="quote">мусор</span>>></span> вместо приглашения ко входу, это означает,
	что нужно нажимать <span class="keycode">Enter</span> до тех пор, пока не
	появится приглашение ко входу.  Если скорости не совпадают,
	<code class="command">getty</code> получает все, что вводит пользователь, в
	виде <span class="quote"><<<span class="quote">мусора</span>>></span>, пробует переключиться на другую скорость
	и выдает приглашение <code class="prompt">login:</code> опять.  Эта процедура
	может продолжаться до отвращения, но обычно требуется одно или два
	нажатия клавиши перед появлением нормально выглядящего приглашения.
	Очевидно, эта последовательность входа не так хороша, как метод
	с фиксированной скоростью, но при низкой скорости соединения
	работать с полноэкранными программами станет проще.</p><p>В этом разделе делается попытка дать сбалансированную информацию
	для настройки, но предпочтение будет отдано установке скорости
	соединения с модемом в соответствие скорости подключения.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94732624"></a>22.4.4.1. <code class="filename">/etc/gettytab</code></h4></div></div></div><a id="idp94745808" class="indexterm"></a><p><code class="filename">/etc/gettytab</code> это файл в стиле
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=termcap&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">termcap</span>(5)</span></a>, содержащей информацию по настройке <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getty&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">getty</span>(8)</span></a>.
	  Пожалуйста, обратитесь к странице справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gettytab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">gettytab</span>(5)</span></a>
	  за полной информацией о формате файла и за списком
	  возможностей <code class="command">getty</code>.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94750032"></a>22.4.4.1.1. Настройка фиксированной скорости</h5></div></div></div><p>Если вы зафиксировали скорость соединения модема на
	    определенной скорости, редактировать файл
	    <code class="filename">/etc/gettytab</code> скорее всего не
	    потребуется.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94751696"></a>22.4.4.1.2. Настройка изменяемой скорости</h5></div></div></div><p>Вам потребуется сделать запись в
	    <code class="filename">/etc/gettytab</code> для предоставления
	    <code class="command">getty</code> информации о скоростях, которые
	    предполагается использовать для модема.  Если у вас
	    2400 бит/с модем, возможно, подойдет существующая
	    запись <code class="literal">D2400</code>.</p><pre class="programlisting">#
# Fast dialup terminals, 2400/1200/300 rotary (can start either way)
#
D2400|d2400|Fast-Dial-2400:\
        :nx=D1200:tc=2400-baud:
3|D1200|Fast-Dial-1200:\
        :nx=D300:tc=1200-baud:
5|D300|Fast-Dial-300:\
        :nx=D2400:tc=300-baud:</pre><p>Если у вас более скоростной модем, вам возможно потребуется
	    добавить запись в <code class="filename">/etc/gettytab</code>; вот запись,
	    которую вы можете использовать для 14.4 Кбит/с модема с
	    максимальной скоростью интерфейса 19.2 Кбит/с:</p><pre class="programlisting">#
# Additions for a V.32bis Modem
#
um|V300|High Speed Modem at 300,8-bit:\
        :nx=V19200:tc=std.300:
un|V1200|High Speed Modem at 1200,8-bit:\
        :nx=V300:tc=std.1200:
uo|V2400|High Speed Modem at 2400,8-bit:\
        :nx=V1200:tc=std.2400:
up|V9600|High Speed Modem at 9600,8-bit:\
        :nx=V2400:tc=std.9600:
uq|V19200|High Speed Modem at 19200,8-bit:\
        :nx=V9600:tc=std.19200:</pre><p>Эта настройка включает 8-битные соединения без программного
	    контроля четности.</p><p>В примере выше скорость порта будет переключаться в цикле
	    начиная с 19.2 Кбит/с (для соединения по V.32bis), затем
	    9600 бит/с (для V.32), 2400 бит/с, 1200 бит/с,
	    300 бит/с, и обратно на 19.2 Кбит/с.
	    Переключение скоростей в цикле реализовано с помощью
	    <code class="literal">nx=</code> (<span class="quote"><<<span class="quote">next table</span>>></span>).
	    Каждая из линий использует <code class="literal">tc=</code> (<span class="quote"><<<span class="quote">table
	    continuation</span>>></span>) для указания <span class="quote"><<<span class="quote">стандартных</span>>></span>
	    (std) настроек на каждой скорости.</p><p>Если у вас 28.8 Кбит/с модем и/или вы хотите получить
	    преимущество от сжатия на скорости 14.4 Кбит/с, потребуются
	    скорости выше, чем 19.2 Кбит/с.  Вот пример записи из
	    <code class="filename">gettytab</code> для начала соединения на скорости
	    57.6 Кбит/с:</p><pre class="programlisting">#
# Additions for a V.32bis or V.34 Modem
# Starting at 57.6 Kbps
#
vm|VH300|Very High Speed Modem at 300,8-bit:\
        :nx=VH57600:tc=std.300:
vn|VH1200|Very High Speed Modem at 1200,8-bit:\
        :nx=VH300:tc=std.1200:
vo|VH2400|Very High Speed Modem at 2400,8-bit:\
        :nx=VH1200:tc=std.2400:
vp|VH9600|Very High Speed Modem at 9600,8-bit:\
        :nx=VH2400:tc=std.9600:
vq|VH57600|Very High Speed Modem at 57600,8-bit:\
        :nx=VH9600:tc=std.57600:</pre><p>Если у вас медленный CPU или сильно загруженная система
	    без последовательных портов на базе 16550A, на скорости
	    57.6 Кбит/с могут возникнуть ошибки
	    <span class="errorname">sio</span> <span class="quote"><<<span class="quote">silo</span>>></span>.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="dialup-ttys"></a>22.4.4.2. <code class="filename">/etc/ttys</code></h4></div></div></div><a id="idp94770128" class="indexterm"></a><p>Настройка файла <code class="filename">/etc/ttys</code>
	  была описана в <a class="xref" href="term.html#ex-etc-ttys" title="Пример 22.1. Добавление записей терминалов в /etc/ttys">Пример 22.1, <<Добавление записей терминалов в
	    <code class="filename">/etc/ttys</code>>></a>.
	  Настройка модемов похожа, но потребуется передавать
	  <code class="command">getty</code> различные аргументы и
	  указывать различные типы терминалов.  Общий формат
	  для фиксированной и переменной скорости такой:</p><pre class="programlisting">ttyd0   "/usr/libexec/getty <em class="replaceable"><code>xxx</code></em>"   dialup on</pre><p>Первый пункт в строке выше это специальный файл устройства для
	  этой записи - <code class="literal">ttyd0</code> означает,
	  что <code class="command">getty</code> будет запущена на
	  <code class="filename">/dev/ttyd0</code>.  Второй пункт,
	  <code class="literal">"/usr/libexec/getty
	    <em class="replaceable"><code>xxx</code></em>"</code>
	  (<em class="replaceable"><code>xxx</code></em> будет замещено на запись из
	  <code class="filename">gettytab</code> для начальной скорости), это процесс,
	  который будет запущен на данном устройстве.  Третий пункт,
	  <code class="literal">dialup</code>, это тип терминала по умолчанию.
	  Четвертый параметр, <code class="literal">on</code>, указывает
	  <code class="command">init</code>, что линия включена.  Может быть пятый
	  параметр, <code class="literal">secure</code>, но он должен использоваться
	  только для терминалов, которые физически безопасны (таких как
	  системная консоль).</p><p>Тип терминала по умолчанию (<code class="literal">dialup</code> в примере
	  выше) может зависеть от личных предпочтений.
	  <code class="literal">dialup</code> это традиционный тип терминала по
	  умолчанию на линиях для дозвона, который позволяет пользователям,
	  зная что тип терминала <code class="literal">dialup</code>, автоматически
	  настраивать свой тип терминала.  Однако, автор находит более
	  легким указание <code class="literal">vt102</code> в качестве типа терминала
	  по умолчанию, поскольку пользователи работают на своих
	  удаленных системах с эмулятором терминала VT102.</p><p>После внесения изменений в <code class="filename">/etc/ttys</code>,
	  вы можете отправить процессу <code class="command">init</code> сигнал
	  <acronym class="acronym">HUP</acronym> перечитать файл.  Используйте команду

	</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP 1</code></strong></pre><p>

	  для отправки сигнала.  Если вы настраиваете систему в первый раз,
	  то возможно захотите подождать, пока модем(ы) правильно
	  настроятся и соединятся перед отправкой сигнала
	  <code class="command">init</code>.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94787024"></a>22.4.4.2.1. Настройка фиксированной скорости</h5></div></div></div><p>Для настройки соединения с фиксированной скоростью, в файле
	    <code class="filename">ttys</code> должна быть запись с фиксированной
	    скоростью для <code class="command">getty</code>.  Для модема, скорость порта
	    которого фиксирована на значении 19.2 Кбит/с, строка в
	    <code class="filename">ttys</code> может выглядеть так:</p><pre class="programlisting">ttyd0   "/usr/libexec/getty std.19200"   dialup on</pre><p>Если скорость модема фиксирована на другом значении,
	    подставьте соответствующее значение в
	    <code class="literal">std.<em class="replaceable"><code>speed</code></em></code>
	    вместо <code class="literal">std.19200</code>.  Убедитесь, что вы
	    используете тип, описанный в
	    <code class="filename">/etc/gettytab</code>.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94791760"></a>22.4.4.2.2. Настройка переменной скорости</h5></div></div></div><p>В настройке с переменной скоростью, запись в
	    <code class="filename">ttys</code> должна обращаться к соответствующей
	    <span class="quote"><<<span class="quote">auto-baud</span>>></span> (sic) записи в
	    <code class="filename">/etc/gettytab</code>.  Например, если вы добавите
	    предложенную выше запись для подключения модема с переменной
	    скоростью, которая начинается с 19.2 Кбит/с (запись в
	    <code class="filename">gettytab</code> начинается с
	    <code class="literal">V19200</code>), запись в
	    <code class="filename">ttys</code> может выглядеть так:</p><pre class="programlisting">ttyd0   "/usr/libexec/getty V19200"   dialup on</pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94795728"></a>22.4.4.3. <code class="filename">/etc/rc.d/serial</code></h4></div></div></div><a id="idp94796496" class="indexterm"></a><p>Для высокоскоростных модемов, таких как V.32, V.32bis и V.34,
	  требуется использование аппаратного контроля передачи
	  (<code class="literal">RTS/CTS</code>).  Вы можете добавить команды
	  <code class="command">stty</code> к файлу <code class="filename">/etc/rc.d/serial</code>
	  для установки флага аппаратного контроля передачи в ядре
	  FreeBSD для модемных портов.</p><p>Например, для установки флага <code class="literal">termios</code>
	  <code class="varname">crtscts</code> на последовательном порту номер 1
	  (<code class="filename">COM2</code>) при инициализации устройств
	  для входящей и исходящей связи, в
	  <code class="filename">/etc/rc.d/serial</code>должны быть добавлены
	  следующие строки:</p><pre class="programlisting"># Serial port initial configuration
stty -f /dev/ttyd1.init crtscts
stty -f /dev/cuad1.init crtscts</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94806224"></a>22.4.5. Настройка модема</h3></div></div></div><p>Если параметры вашего модема могут быть сохранены в
	энергонезависимой памяти, потребуется использовать
	терминальную программу (например, Telix под <span class="trademark">MS-DOS</span>(R) или
	<code class="command">tip</code> под FreeBSD) для установки
	параметров.  Подсоединитесь к модему, используя ту же скорость
	соединения, которую использует <code class="command">getty</code> в
	качестве начальной скорости, и настройте модем для
	соответствия следующим требованиям:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><acronym class="acronym">CD</acronym> включен после соединения</p></li><li class="listitem"><p><acronym class="acronym">DTR</acronym> включен во время работы; сброс DTR
	    отключает линию и переводит модем в начальное состояние</p></li><li class="listitem"><p><acronym class="acronym">CTS</acronym> контроль переданных данных</p></li><li class="listitem"><p>Контроль потока <acronym class="acronym">XON/XOFF</acronym> отключен</p></li><li class="listitem"><p><acronym class="acronym">RTS</acronym> контроль принятых данных</p></li><li class="listitem"><p><span class="quote"><<<span class="quote">Тихий</span>>></span> режим (без кодов возврата)</p></li><li class="listitem"><p>Эхо команд отключено</p></li></ul></div><p>Прочтите документацию на модем для определения какие команды
	и/или DIP переключатели требуются чтобы установить эти
	настройки.</p><p>Например, для установки вышеуказанных параметров на внешнем
	14,400 модеме <span class="trademark">U.S. Robotics</span>(R) <span class="trademark">Sportster</span>(R), требуется отправить
	модему следующие команды:</p><pre class="programlisting">ATZ
AT&amp;C1&amp;D2&amp;H1&amp;I0&amp;R2&amp;W</pre><p>Вы, возможно, захотите настроить и другие параметры модема,
	такие как использование сжатия V.42bis и/или MNP5.</p><p>Внешний <span class="trademark">U.S. Robotics</span>(R) <span class="trademark">Sportster</span>(R) 14,400 модем также снабжен
	некоторыми DIP переключателями, которые требуется установить;
	для других модемов эти настройки могут быть использованы в
	качестве примера:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Переключатель 1: вверх - нормальный DTR</p></li><li class="listitem"><p>Переключатель 2: N/A (визуальные коды возврата/числовые коды
	    возврата)</p></li><li class="listitem"><p>Переключатель 3: вверх - подавление кодов возврата</p></li><li class="listitem"><p>Переключатель 4: вниз - без эхо, offline команды</p></li><li class="listitem"><p>Переключатель 5: вверх - авто ответ</p></li><li class="listitem"><p>Переключатель 6: вверх - нормальный контроль
	    несущей</p></li><li class="listitem"><p>Переключатель 7: вверх - загрузить установки по
	    умолчанию из NVRAM</p></li><li class="listitem"><p>Переключатель 8: N/A (Smart/Dumb режимы)</p></li></ul></div><p>Коды возврата должны быть отключены/подавлены для устранения
	проблем, которые могут возникнуть, если <code class="command">getty</code>
	ошибочно выдаст приглашение <code class="prompt">login:</code> модему в
	командном режиме и модем вернет (echo) эту команду или код
	возврата.  Эта последовательность может привести к дополнительному
	и бессмысленному обмену командами между <code class="command">getty</code>
	и модемом.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94832592"></a>22.4.5.1. Настройка фиксированной скорости</h4></div></div></div><p>Для настройки фиксированной скорости вам потребуется настроить
	  модем с поддержкой постоянной скорости обмена данными
	  модем-компьютер независимо от скорости соединения.  На внешнем
	  модеме <span class="trademark">U.S. Robotics</span>(R) <span class="trademark">Sportster</span>(R) 14,400 эти команды зафиксируют
	  скорость передачи модем-компьютер на скорости, которая установлена
	  при выполнении команды:</p><pre class="programlisting">ATZ
AT&amp;B1&amp;W</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94835152"></a>22.4.5.2. Настройка переменной скорости</h4></div></div></div><p>Для настройки переменной скорости вам потребуется настроить модем
	  с поддержкой изменения скорости передачи данных через последовательный
	  порт в соответствии через скоростью соединения.  Следующие команды
	  зафиксируют скорость передачи данных с коррекцией ошибок внешнего
	  модема <span class="trademark">U.S. Robotics</span>(R) <span class="trademark">Sportster</span>(R) 14,400 на значении, которое
	  установлено при выполнении команды, но сделают возможным изменение
	  скорости последовательного порта для соединений без коррекции
	  ошибок:</p><pre class="programlisting">ATZ
AT&amp;B2&amp;W</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94837712"></a>22.4.5.3. Проверка настроек модема</h4></div></div></div><p>Большинство высокоскоростных модемов предоставляют команды для
	  просмотра текущих параметров модема в виде, отчасти приспособленном
	  для чтения.  Для внешних модемов <span class="trademark">U.S. Robotics</span>(R) <span class="trademark">Sportster</span>(R) 14,400
	  команда <code class="command">ATI5</code> отображает установки, сохраненные в
	  энергонезависимой памяти.  Для просмотра действующих параметров
	  модема (с учетом положения DIP переключателей), используйте
	  команду <code class="command">ATZ</code>, а затем <code class="command">ATI4</code>.</p><p>Если ваш модем другого производителя, проверьте руководство
	  к модему для аккуратной проверки параметров настройки модема.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94841680"></a>22.4.6. Решение проблем</h3></div></div></div><p>Вот несколько шагов, которые нужно выполнить для проверки
	настроек.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94842832"></a>22.4.6.1. Проверьте систему FreeBSD</h4></div></div></div><p>Подсоедините модем к системе FreeBSD, загрузите систему, и,
	  если на модеме есть индикаторы, посмотрите, загорелся ли
	  индикатор <acronym class="acronym">DTR</acronym> при появлении приглашения
	  <code class="prompt">login:</code> на системной консоли - если он
	  загорелся, это означает, что FreeBSD запустила процесс
	  <code class="command">getty</code> на соответствующем коммуникационном
	  порту и модем ожидает входящего звонка.</p><p>Если индикатор <acronym class="acronym">DTR</acronym> не загорелся, войдите
	  на консоль системы FreeBSD и выполните команду <code class="command">ps
	  ax</code>, чтобы увидеть, пытается ли FreeBSD запустить процесс
	  <code class="command">getty</code> на соответствующем порту.  Вы должны
	  увидеть строки вроде этих среди показанных процессов:</p><pre class="screen">  114 ??  I      0:00.10 /usr/libexec/getty V19200 ttyd0
  115 ??  I      0:00.10 /usr/libexec/getty V19200 ttyd1</pre><p>Если вы видите что-то другое, вроде этого:</p><pre class="screen">  114 d0  I      0:00.10 /usr/libexec/getty V19200 ttyd0</pre><p>и модем все еще не принимает звонок, это означает, что
	  <code class="command">getty</code> завершила открытие коммуникационного
	  порта.  Это может означать проблему с кабелем или неправильную
	  настройку модема, поскольку <code class="command">getty</code> не должна
	  открывать коммуникационный порт, пока модем не установит
	  <acronym class="acronym">CD</acronym> (обнаружение несущей).</p><p>Если вы не видите процессов <code class="command">getty</code>, ожидающих
	  открытия соответствующего порта
	  <code class="filename">ttyd<em class="replaceable"><code>N</code></em></code>,
	  внимательно проверьте записи в <code class="filename">/etc/ttys</code>
	  и попробуйте найти ошибки, если они есть.  Проверьте также лог файл
	  <code class="filename">/var/log/messages</code>, нет ли там сообщений от
	  <code class="command">init</code> или <code class="command">getty</code>, имеющих
	  отношение к проблеме.  Если сообщения есть, проверьте еще раз
	  файлы настройки <code class="filename">/etc/ttys</code> и
	  <code class="filename">/etc/gettytab</code>, как и соответствующие
	  специальные файлы устройств <code class="filename">/dev/ttydN</code>, чтобы
	  обнаружить ошибки, отсутствующие записи или отсутствующие
	  специальные файлы устройств.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp94862032"></a>22.4.6.2. Попробуйте позвонить на модем</h4></div></div></div><p>Попробуйте дозвониться до системы; убедитесь, что используете
	  8 бит без четности и 1 стоп бит на удаленной системе.  Если
	  вы не получите приглашение сразу, или получите случайные
	  данные, попробуйте нажимать <span class="keycode">Enter</span> примерно
	  раз в секунду.  Если вы все еще не видите приглашения
	  <code class="prompt">login:</code> после нескольких попыток, попробуйте
	  отправить команду <code class="command">BREAK</code>.  Если вы используете
	  для дозвона высокоскоростной модем, попробуйте позвонить еще раз
	  после фиксирования скорости интерфейса дозванивающегося модема
	  (например, с помощью команды <code class="command">AT&amp;B1</code> для
	  модема <span class="trademark">U.S. Robotics</span>(R) <span class="trademark">Sportster</span>(R)).</p><p>Если вы все еще не можете получить приглашение
	  <code class="prompt">login:</code>, проверьте
	  <code class="filename">/etc/gettytab</code> еще раз и убедитесь,
	  что</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Имя параметра <code class="command">getty</code>, указанного в
	      <code class="filename">/etc/ttys</code>, совпадает с именем параметра в
	      <code class="filename">/etc/gettytab</code></p></li><li class="listitem"><p>Каждая запись <code class="literal">nx=</code> соответствует
	      имени другой записи в <code class="filename">gettytab</code></p></li><li class="listitem"><p>Каждая запись <code class="literal">tc=</code> соответствует
	      имени другой записи в <code class="filename">gettytab</code></p></li></ul></div><p>Если система FreeBSD не отвечает на звонок, убедитесь, что
	  модем настроен для ответа на звонок при включении
	  <acronym class="acronym">DTR</acronym>.  Если модем настроен правильно, проверьте,
	  что <acronym class="acronym">DTR</acronym> включается, взглянув на индикаторы
	  модема (если они есть).</p><p>Если вы проверили все несколько раз и все еще не добились
	  результата, сделайте перерыв и вернитесь к настройкам позже.
	  Если опять ничего не получилось, возможно вам потребуется
	  отправить письмо в <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">Список рассылки, посвящённый вопросам и ответам пользователей FreeBSD</a>, описав модем
	  и возникшую проблему, участники рассылки попробуют помочь
	  вам.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="term.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="serialcomms.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="dialout.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">22.3. Терминалы </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 22.5. Исходящие соединения по модему</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>