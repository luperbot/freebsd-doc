<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>12.7. Использование rc во FreeBSD 5.X и последующих версиях</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="config-tuning.html" title="Глава 12. Настройка и оптимизация" /><link rel="prev" href="configtuning-cron.html" title="12.6. Настройка утилиты cron" /><link rel="next" href="config-network-setup.html" title="12.8. Настройка карт сетевых интерфейсов" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">12.7. Использование rc во FreeBSD 5.X и последующих версиях</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="configtuning-cron.html">Пред.</a> </td><th width="60%" align="center">Глава 12. Настройка и оптимизация</th><td width="20%" align="right"> <a accesskey="n" href="config-network-setup.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configtuning-rcd"></a>12.7. Использование rc во FreeBSD 5.X и последующих версиях</h2></div><div><span class="authorgroup">Предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p>Во FreeBSD недавно была интегрирована из NetBSD система
      <code class="filename">rc.d</code>, используемая для старта системы.
      Многие из файлов в каталоге <code class="filename">/etc/rc.d</code>
      предназначены для основных сервисов, они могут управляться
      параметрами <code class="option">start</code>,
      <code class="option">stop</code>, и
      <code class="option">restart</code>.  Например, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> может быть
      перезапущен следующей командой:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/sshd restart</code></strong></pre><p>Эта процедура похожа для других сервисов.  Конечно, сервисы
      обычно запускаются автоматически при загрузке системы, как указано в <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>.
      Например, включение даемона Network Address Translation
      при запуске выполняется простым добавлением следующей строки
      в <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">natd_enable="YES"</pre><p>Если <code class="option">natd_enable="NO"</code> уже присутствует,
      просто измените <code class="option">NO</code> на <code class="option">YES</code>.
      Скрипты rc автоматически загрузят все другие зависимые
      сервисы, как описано ниже.</p><p>Поскольку система <code class="filename">rc.d</code> в основном предназначена
      для запуска/отключения сервисов во время запуска/отключения
      системы, стандартные параметры <code class="option">start</code>,
      <code class="option">stop</code> и <code class="option">restart</code> будут работать
      только если установлена соответствующая переменная в
      <code class="filename">/etc/rc.conf</code>.  Например, команда выше
      <code class="command">sshd restart</code> будет работать только если
      переменная <code class="varname">sshd_enable</code> в файле
      <code class="filename">/etc/rc.conf</code> установлена в <code class="option">YES</code>.
      Для выполнения скриптов независимо от установок в
      <code class="filename">/etc/rc.conf</code>, параметры <code class="option">start</code>,
      <code class="option">stop</code> или <code class="option">restart</code> необходимо
      задавать с префиксом <span class="quote"><<<span class="quote">force</span>>></span>.  Например, для
      перезапуска <code class="command">sshd</code> независимо от установок в
      <code class="filename">/etc/rc.conf</code>, выполните следующую
      команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/sshd forcerestart</code></strong></pre><p>Проверить состояние переменной в файле
      <code class="filename">/etc/rc.conf</code> легко: запустите соответствующий
      скрипт из <code class="filename">rc.d</code> с параметром
      <code class="option">rcvar</code>.  Проверка переменной для
      <code class="command">sshd</code> выполняется следующей командой:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/sshd rcvar</code></strong>
# sshd
$sshd_enable=YES</pre><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Вторая строка (<code class="literal"># sshd</code>) это вывод
	команды <code class="command">sshd</code>, а не консоль
	<code class="systemitem">root</code>.</p></div><p>Чтобы определить, запущен ли сервис, существует параметр
      <code class="option">status</code>.  Например для проверки того, запущен ли
      <code class="command">sshd</code>, выполните:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/sshd status</code></strong>
sshd is running as pid 433.</pre><p>В некоторых случаях возможна также перегрузка (<code class="option">reload</code>) сервиса.
      Скрипт, запущенный с этим параметром, попытается отправить сервису
      сигнал, вызывающий перезагрузку файлов настройки.  В большинстве
      случаев это означает отправку сервису сигнала
      <code class="literal">SIGHUP</code>.  Следует помнить, что эту функцию
      поддерживают не все сервисы.</p><p>Система <code class="filename">rc.d</code> используется не только для
      сетевых серверов, она отвечает также за большую часть инициализации
      системы.
      Рассмотрим, к примеру, файл <code class="filename">bgfsck</code>.  Во время
      выполнения этот скрипт выводит следующее сообщение:</p><pre class="screen">Starting background file system checks in 60 seconds.</pre><p>Следовательно, этот файл используется для фоновой проверки файловых
      систем, которая выполняется только в процессе инициализации
      системы.</p><p>Функционирование многих сервисов системы зависит от корректной
      работы других сервисов.  Например, NIS и другие основанные на
      RPC сервисы могут не запуститься, пока не загрузится
      <code class="command">rpcbind</code> (portmapper).  Для разрешения этой
      проблемы, в начале каждого скрипта в комментарии включаются
      информация о зависимостях и другие метаданные.  Программа
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rcorder&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rcorder</span>(8)</span></a> используется для разбора этих комментариев во время старта
      системы для определения порядка, в котором должны вызываться
      системные сервисы в соответствии с зависимостями.  В начало
      каждого стартового файла должны быть включены следующие
      строки:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">PROVIDE</code>: Задает имя сервиса, предоставляемого этим файлом.</p></li><li class="listitem"><p><code class="literal">REQUIRE</code>: Список сервисов, необходимых этому сервису.  Этот
	  файл будет запущен <span class="emphasis"><em>после</em></span> указанных
	  сервисов.</p></li><li class="listitem"><p><code class="literal">BEFORE</code>: Список сервисов, зависящих от этого сервиса.  Этот
	  файл будет запущен <span class="emphasis"><em>до</em></span> указанных
	  сервисов.</p></li></ul></div><p>Используя этот метод, администратор может легко контролировать
      системные сервисы без использования <span class="quote"><<<span class="quote">уровней запуска</span>>></span>,
      как в некоторых других операционных системах <span class="trademark">UNIX</span>(R).</p><p>Дополнительную информацию о системе <code class="filename">rc.d</code>
      можно найти на страницах справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a> и
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.subr&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rc.subr</span>(8)</span></a>.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="configtuning-cron.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="config-tuning.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="config-network-setup.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">12.6. Настройка утилиты <code class="command">cron</code> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 12.8. Настройка карт сетевых интерфейсов</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>