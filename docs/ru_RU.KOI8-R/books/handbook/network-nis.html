<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>25.4. Network Information System (NIS/YP)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="network-servers.html" title="Глава 25. Сетевые серверы" /><link rel="prev" href="network-nfs.html" title="25.3. Network File System (NFS)" /><link rel="next" href="network-dhcp.html" title="25.5. Автоматическая настройка сети (DHCP)" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">25.4. Network Information System (NIS/YP)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-nfs.html">Пред.</a> </td><th width="60%" align="center">Глава 25. Сетевые серверы</th><td width="20%" align="right"> <a accesskey="n" href="network-dhcp.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-nis"></a>25.4. Network Information System (NIS/YP)</h2></div><div><span class="authorgroup">Текст создал <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Bill</span> <span class="surname">Swingle</span></span>. </span></div><div><span class="authorgroup">Внёс добавления <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Eric</span> <span class="surname">Ogren</span></span>  <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Udo</span> <span class="surname">Erdelhoff</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97376976"></a>25.4.1. Что это такое?</h3></div></div></div><a id="idp97377616" class="indexterm"></a><a id="idp97378128" class="indexterm"></a><a id="idp97378640" class="indexterm"></a><a id="idp97383376" class="indexterm"></a><a id="idp97383888" class="indexterm"></a><a id="idp97384400" class="indexterm"></a><a id="idp97384912" class="indexterm"></a><p><acronym class="acronym">NIS</acronym>,
	что является сокращением от Network Information Services
	(Сетевые Информационные Службы), которые были разработаны компанией
	Sun Microsystems для централизованного администрирования систем <span class="trademark">UNIX</span>(R)
	(изначально <span class="trademark">SunOS</span>TM).  В настоящее время эти службы практически стали
	промышленным стандартом; все основные <span class="trademark">UNIX</span>(R)-подобные системы
	(<span class="trademark">Solaris</span>TM, HP-UX, <span class="trademark">AIX</span>(R), Linux, NetBSD, OpenBSD, FreeBSD и так далее)
	поддерживают <acronym class="acronym">NIS</acronym>.</p><a id="idp97389008" class="indexterm"></a><p><acronym class="acronym">NIS</acronym>
	первоначально назывались Yellow Pages (или yp), но из-за
	проблем с торговым знаком Sun изменила это название.  Старое название
	(и yp) всё ещё часто употребляется.</p><a id="idp97390928" class="indexterm"></a><p>Это система клиент/сервер на основе вызовов RPC, которая позволяет
	группе машин в одном домене NIS совместно использовать общий набор
	конфигурационных файлов.  Системный администратор может настроить
	клиентскую систему NIS только с минимальной настроечной информацией, а
	затем добавлять, удалять и модифицировать настроечную информацию из
	одного места.</p><a id="idp97392592" class="indexterm"></a><p>Это похоже на систему доменов <span class="trademark">Windows NT</span>(R); хотя их внутренние
	реализации не так уж и похожи, основные функции сравнимы.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97394128"></a>25.4.2. Термины/программы, о которых вы должны знать</h3></div></div></div><p>Существует несколько терминов и некоторое количество
	пользовательских программ, которые будут нужны, когда вы будете
	пытаться сделать NIS во FreeBSD, и в случае создания сервера, и
	в случае работы в качестве клиента NIS:</p><a id="idp97395152" class="indexterm"></a><a id="idp97396048" class="indexterm"></a><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Термин</th><th>Описание</th></tr></thead><tbody><tr><td>Имя домена NIS</td><td>Главный сервер NIS и все его клиенты (включая вторичные
		серверы), имеют доменное имя NIS.  Как и в случае с именем
		домена <span class="trademark">Windows NT</span>(R), имя домена NIS не имеет ничего общего с
		DNS.</td></tr><tr><td><span class="application">rpcbind</span></td><td>Для обеспечения работы RPC (Remote Procedure Call,
		Удалённого Вызова Процедур, сетевого протокола, используемого
		NIS), должен быть запущен даемон <span class="application">rpcbind</span>.
		Если даемон <span class="application">rpcbind</span> не запущен, невозможно
		будет запустить сервер NIS, или работать как
		NIS-клиент.</td></tr><tr><td><span class="application">ypbind</span></td><td><span class="quote"><<<span class="quote">Связывает</span>>></span>
		NIS-клиента с его NIS-сервером.  Он определяет имя NIS-домена
		системы, и при помощи RPC подключается к серверу.
		<span class="application">ypbind</span> является основой клиент-серверного
		взаимодействия в среде NIS; если на клиентской машине
		программа <span class="application">ypbind</span> перестанет работать, то
		эта машина не сможет получить доступ к серверу NIS.</td></tr><tr><td><span class="application">ypserv</span></td><td>Программа <code class="command">ypserv</code>, которая должна
		запускаться только на серверах NIS: это и есть
		сервер NIS.  Если <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a> перестанет работать, то
		сервер не сможет отвечать на запросы NIS (к счастью, на этот
		случай предусмотрен вторичный сервер).  Есть несколько
		реализаций NIS (к FreeBSD это не относится), в которых не
		производится попыток подключиться к другому серверу, если ранее
		используемый сервер перестал работать.  Зачастую единственным
		средством, помогающим в этой ситуации, является перезапуск
		серверного процесса (или сервера полностью) или процесса
		<span class="application">ypbind</span> на клиентской машине.</td></tr><tr><td><span class="application">rpc.yppasswdd</span></td><td>Программа <code class="command">rpc.yppasswdd</code>, другой
		процесс, который запускается только на главных NIS-серверах:
		это даемон, позволяющий клиентам NIS изменять свои
		пароли NIS.  Если этот даемон не запущен, то пользователи
		должны будут входить на основной сервер NIS и там менять свои
		пароли.</td></tr></tbody></table></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97416016"></a>25.4.3. Как это работает?</h3></div></div></div><p>В системе NIS существует три типа хостов: основные (master)
      серверы, вторичные (slave) серверы и клиентские машины.  Серверы
      выполняют роль централизованного хранилища информации о конфигурации
      хостов.  Основные серверы хранят оригиналы этой информации, когда как
      вторичные серверы хранят ее копию для обеспечения избыточности.
      Клиенты связываются с серверами, чтобы предоставить им эту
      информацию.</p><p>Информация во многих файлах может совместно использоваться
      следующим образом.  Файлы <code class="filename">master.passwd</code>,
      <code class="filename">group</code> и <code class="filename">hosts</code> используются
      совместно через NIS.  Когда процессу, работающему на клиентской машине,
      требуется информация, как правило, находящаяся в этих файлах локально,
      то он делает запрос к серверу NIS, с которым связан.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97418576"></a>25.4.3.1. Типы машин</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>Основной сервер NIS</em></span><a id="idp97420240" class="indexterm"></a>.
	    Такой сервер, по аналогии с первичным контроллером домена
	    <span class="trademark">Windows NT</span>(R), хранит файлы, используемые всеми клиентами NIS.  Файлы
	    <code class="filename">passwd</code>, <code class="filename">group</code> и
	    различные другие файлы, используемые клиентами NIS, находятся
	    на основном сервере.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Возможно использование одной машины в качестве сервера для
	      более чем одного домена NIS.  Однако, в этом введении такая
	      ситуация не рассматривается, и предполагается менее масштабное
	      использование NIS.</p></div></li><li class="listitem"><p><span class="emphasis"><em>Вторичные серверы NIS</em></span><a id="idp97423952" class="indexterm"></a>.  Похожие на
	    вторичные контроллеры доменов <span class="trademark">Windows NT</span>(R), вторичные серверы
	    NIS содержат копии оригинальных файлов данных NIS.	Вторичные
	    серверы NIS обеспечивают избыточность, что нужно в критичных
	    приложениях.  Они также помогают распределять нагрузку на
	    основной сервер: клиенты NIS всегда подключаются к тому серверу
	    NIS, который ответил первым, в том числе и к вторичным
	    серверам.</p></li><li class="listitem"><p><span class="emphasis"><em>Клиенты NIS</em></span><a id="idp97426128" class="indexterm"></a>.
	    Клиенты NIS, как и большинство рабочих станций <span class="trademark">Windows NT</span>(R),
	    аутентифицируются на сервере NIS (или на контроллере домена
	    <span class="trademark">Windows NT</span>(R) для рабочих станций <span class="trademark">Windows NT</span>(R)) во время
	    входа в систему.</p></li></ul></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97433296"></a>25.4.4. Использование NIS/YP</h3></div></div></div><p>В этом разделе приводится пример настройки NIS.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97434320"></a>25.4.4.1. Планирование</h4></div></div></div><p>Давайте предположим, что вы являетесь администратором в маленькой
	университетской лаборатории.  В настоящий момент в этой лаборатории
	с 15 машинами отсутствует единая точка администрирования; на каждой
	машине имеются собственные файлы <code class="filename">/etc/passwd</code> и
	<code class="filename">/etc/master.passwd</code>.  Эти файлы синхронизируются
	друг с другом только вручную; сейчас, когда вы добавляете
	пользователя в лаборатории, вы должны выполнить команду
	<code class="command">adduser</code> на всех 15 машинах.	Понятно, что такое
	положение вещей нужно исправлять, так что вы решили перевести
	сеть на использование NIS, используя две машины в качестве
	серверов.</p><p>Итак, конфигурация лаборатории сейчас выглядит примерно
	так:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Имя машины</th><th>IP-адрес</th><th>Роль машины</th></tr></thead><tbody><tr><td><code class="systemitem">ellington</code></td><td><code class="systemitem">10.0.0.2</code></td><td>Основной сервер NIS</td></tr><tr><td><code class="systemitem">coltrane</code></td><td><code class="systemitem">10.0.0.3</code></td><td>Вторичный сервер NIS</td></tr><tr><td><code class="systemitem">basie</code></td><td><code class="systemitem">10.0.0.4</code></td><td>Факультетская рабочая станция</td></tr><tr><td><code class="systemitem">bird</code></td><td><code class="systemitem">10.0.0.5</code></td><td>Клиентская машина</td></tr><tr><td><code class="systemitem">cli[1-11]</code></td><td><code class="systemitem">10.0.0.[6-17]</code></td><td>Другие клиентские машины</td></tr></tbody></table></div><p>Если вы определяете схему NIS первый раз, ее нужно хорошо
	обдумать.  Вне зависимости от размеров вашей сети, есть несколько
	ключевых моментов, которые требуют принятия решений.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97454800"></a>25.4.4.1.1. Выбор имени домена NIS</h5></div></div></div><a id="idp97455440" class="indexterm"></a><p>Это имя не должно быть <span class="quote"><<<span class="quote">именем домена</span>>></span>, которое
	  вы использовали.  Более точно это имя называется <span class="quote"><<<span class="quote">именем
	  домена NIS</span>>></span>.  Когда клиент рассылает запросы на получение
	  информации, он включает в них имя домена NIS, частью которого
	  является.  Таким способом многие сервера в сети могут указать,
	  какой сервер на какой запрос должен отвечать.  Думайте о домене
	  NIS как об имени группы хостов, которые каким-то образом
	  связаны.</p><p>Некоторые организации в качестве имени домена NIS используют
	  свой домен Интернет.	Это не рекомендуется, так как может вызвать
	  проблемы в процессе решения сетевых проблем.	Имя домена NIS должно
	  быть уникальным в пределах вашей сети и хорошо, если оно будет
	  описывать группу машин, которые представляет.  Например,
	  художественный отдел в компании Acme Inc. может находиться в
	  домене NIS с именем <span class="quote"><<<span class="quote">acme-art</span>>></span>.  В нашем примере
	  положим, что мы выбрали имя <code class="literal">test-domain</code>.</p><a id="idp97458896" class="indexterm"></a><p>Несмотря на это, некоторые операционные системы (в частности,
	  <span class="trademark">SunOS</span>TM) используют свое имя домена NIS в качестве имени домена
	  Интернет.  Если одна или более машин в вашей сети имеют такие
	  ограничения, вы <span class="emphasis"><em>обязаны</em></span> использовать имя
	  домена Интернет в качестве имени домена NIS.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97460944"></a>25.4.4.1.2. Требования к серверу</h5></div></div></div><p>Есть несколько вещей, которые нужно иметь в виду при выборе
	  машины для использования в качестве сервера NIS.  Одной из
	  обескураживающей вещью, касающейся NIS, является уровень
	  зависимости клиентов от серверов.  Если клиент не может
	  подключиться к серверу своего домена NIS, зачастую машину просто
	  становится нельзя использовать.  Отсутствие информации о
	  пользователях и группах приводит к временной остановке работы
	  большинства систем.  Зная это, вы должны выбрать машину, которая
	  не должна подвергаться частым перезагрузкам и не используется
	  для разработки.  Сервер NIS в идеале должен быть отдельно стоящей
	  машиной, единственным целью в жизни которой является быть сервером
	  NIS.  Если вы работаете в сети, которая не так уж сильно загружена,
	  то можно поместить сервер NIS на машине, на которой запущены и
	  другие сервисы, просто имейте в виду, что если сервер NIS
	  становится недоступным, то это негативно отражается на
	  <span class="emphasis"><em>всех</em></span> клиентах NIS.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97462608"></a>25.4.4.2. Серверы NIS</h4></div></div></div><p>Оригинальные копии всей информации NIS хранится на единственной
	машине, которая называется главным сервером NIS.  Базы данных,
	которые используются для хранения информации, называются картами NIS.
	Во FreeBSD эти карты хранятся в
	<code class="filename">/var/yp/[domainname]</code>, где
	<code class="filename">[domainname]</code> является именем обслуживаемого
	домена NIS.  Один сервер NIS может поддерживать одновременно
	несколько доменов, так что есть возможность иметь несколько таких
	каталогов, по одному на каждый обслуживаемый домен.  Каждый домен
	будет иметь свой собственный независимый от других набор карт.</p><p>Основной и вторичный серверы обслуживают все запросы NIS с
	помощью даемона <code class="command">ypserv</code>.  <code class="command">ypserv</code>
	отвечает за получение входящих запросов от клиентов NIS,
	распознавание запрашиваемого домена и отображение имени в путь к
	соответствующему файлы базы данных, а также передаче информации из
	базы данных обратно клиенту.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97465552"></a>25.4.4.2.1. Настройка основного сервера NIS</h5></div></div></div><a id="idp97466192" class="indexterm"></a><p>Настройка основного сервера NIS может оказаться сравнительно
	  простой, в зависимости от ваших потребностей.  В поставку FreeBSD
	  сразу включена поддержка NIS.  Все, что вам нужно, это добавить
	  следующие строки в файл <code class="filename">/etc/rc.conf</code>, а
	  FreeBSD сделает за вас всё остальное..</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><pre class="programlisting">nisdomainname="test-domain"</pre><p>
	      В этой строке задается имя домена NIS, которое будет
	      <code class="literal">test-domain</code>, еще до настройки сети
	      (например, после перезагрузки).</p></li><li class="step"><pre class="programlisting">nis_server_enable="YES"</pre><p>
	      Здесь указывается FreeBSD на запуск процессов серверов NIS,
	      когда дело доходит до сетевых настроек.</p></li><li class="step"><pre class="programlisting">nis_yppasswdd_enable="YES"</pre><p>
	      Здесь указывается на запуск даемона
	      <code class="command">rpc.yppasswdd</code>, который, как это отмечено
	      выше, позволит пользователям менять свой пароль NIS с
	      клиентской машины.</p></li></ol></div><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">В зависимости от ваших настроек NIS, вам могут понадобиться
	    дополнительные строки.  Обратитесь к <a class="link" href="network-nis.html#network-nis-server-is-client" title="25.4.10. Серверы NIS, которые также являются клиентами NIS">разделу о серверах NIS,
	    которые являются и клиентами NIS</a> ниже для получения
	    подробной информации.</p></div><p>После добавления вышеприведенных строк, запустите команду
	  <code class="command">/etc/netstart</code>, работая как администратор.	По
	  ней произойдет настройка всего, при этом будут использоваться
	  значения, заданные в файле <code class="filename">/etc/rc.conf</code>.
	  И наконец, перед инициализацией карт NIS, запустите вручную
	  демон <span class="application">ypserv</span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/ypserv start</code></strong></pre></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97484624"></a>25.4.4.2.2. Инициализация карт NIS</h5></div></div></div><a id="idp97485392" class="indexterm"></a><p><span class="emphasis"><em>Карты NIS</em></span> являются файлами баз данных,
	  которые хранятся в каталоге <code class="filename">/var/yp</code>.
	  Они генерируются из конфигурационных файлов, находящихся в каталоге
	  <code class="filename">/etc</code> основного сервера NIS, за одним
	  исключением: файл <code class="filename">/etc/master.passwd</code>.
	  На это есть весомая причина, вам не нужно распространять пароли
	  пользователя <code class="systemitem">root</code> и других административных
	  пользователей на все серверы в домене NIS.  По этой причине, прежде
	  чем инициализировать карты NIS, вы должны сделать вот что:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp /etc/master.passwd /var/yp/master.passwd</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /var/yp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>vi master.passwd</code></strong></pre><p>Вы должны удалить все записи, касающиеся системных
	  пользователей (<code class="systemitem">bin</code>, <code class="systemitem">tty</code>,
	  <code class="systemitem">kmem</code>, <code class="systemitem">games</code> и так далее), а
	  также записи, которые вы не хотите распространять клиентам NIS
	  (например, <code class="systemitem">root</code> и другие пользователи с UID,
	  равным 0 (администраторы)).</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Проверьте, чтобы файл
	    <code class="filename">/var/yp/master.passwd</code> был недоступен для
	    записи ни для группы, ни для остальных пользователей (режим
	    доступа 600)!  Воспользуйтесь командой <code class="command">chmod</code>,
	    если это нужно.</p></div><a id="idp97496016" class="indexterm"></a><p>Когда с этим будет покончено, самое время инициализировать
	  карты NIS!  В поставку FreeBSD включен скрипт с именем
	  <code class="command">ypinit</code>, который делает это (обратитесь к его
	  справочной странице за дополнительной информацией).  Отметьте, что
	  этот скрипт имеется в большинстве операционных систем <span class="trademark">UNIX</span>(R), но не
	  во всех.  В системе Digital Unix/Compaq Tru64 UNIX он называется
	  <code class="command">ypsetup</code>.  Так как мы генерируем карты для
	  главного сервера NIS, то при вызове программы
	  <code class="command">ypinit</code> мы передаем ей параметр
	  <code class="option">-m</code>.	Для генерации карт NIS в предположении, что
	  вы уже сделали шаги, описанные выше, выполните следующее:</p><pre class="screen">ellington<code class="prompt">#</code> <strong class="userinput"><code>ypinit -m test-domain</code></strong>
Server Type: MASTER Domain: test-domain
Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.
Do you want this procedure to quit on non-fatal errors? [y/n: n] <strong class="userinput"><code>n</code></strong>
Ok, please remember to go back and redo manually whatever fails.
If you don't, something might not work.
At this point, we have to construct a list of this domains YP servers.
rod.darktech.org is already known as master server.
Please continue to add any slave servers, one per line. When you are
done with the list, type a &lt;control D&gt;.
master server	:  ellington
next host to add:  <strong class="userinput"><code>coltrane</code></strong>
next host to add:  <strong class="userinput"><code>^D</code></strong>
The current list of NIS servers looks like this:
ellington
coltrane
Is this correct?  [y/n: y] <strong class="userinput"><code>y</code></strong>

[..вывод при генерации карт..]

NIS Map update completed.
ellington has been setup as an YP master server without any errors.</pre><p>Программа <code class="command">ypinit</code> должна была создать файл
	  <code class="filename">/var/yp/Makefile</code> из
	  <code class="filename">/var/yp/Makefile.dist</code>.  При создании этого
	  файла предполагается, что вы работаете в окружении с единственным
	  сервером NIS и только с машинами FreeBSD.  Так как в домене
	  <code class="literal">test-domain</code> имеется также и вторичный сервер,
	  то вы должны отредактировать файл
	  <code class="filename">/var/yp/Makefile</code>:</p><pre class="screen">ellington<code class="prompt">#</code> <strong class="userinput"><code>vi /var/yp/Makefile</code></strong></pre><p>Вы должны закомментировать строку, в которой указано</p><pre class="programlisting">NOPUSH = "True"</pre><p>(она уже не раскомментирована).</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97506512"></a>25.4.4.2.3. Настройка вторичного сервера NIS</h5></div></div></div><a id="idp97507152" class="indexterm"></a><p>Настройка вторичного сервера NIS осуществляется ещё проще,
	  чем настройка главного сервера.  Войдите на вторичный сервер и
	  отредактируйте файл <code class="filename">/etc/rc.conf</code> точно также,
	  как вы делали это ранее.  Единственным отличием является то, что
	  при запуске программы <code class="command">ypinit</code> мы теперь должны
	  использовать опцию <code class="option">-s</code>.  Применение опции
	  <code class="option">-s</code> требует также указание имени главного сервера
	  NIS, так что наша команда должна выглядеть так:</p><pre class="screen">coltrane<code class="prompt">#</code> <strong class="userinput"><code>ypinit -s ellington test-domain</code></strong>

Server Type: SLAVE Domain: test-domain Master: ellington

Creating an YP server will require that you answer a few questions.
Questions will all be asked at the beginning of the procedure.

Do you want this procedure to quit on non-fatal errors? [y/n: n]  <strong class="userinput"><code>n</code></strong>

Ok, please remember to go back and redo manually whatever fails.
If you don't, something might not work.
There will be no further questions. The remainder of the procedure
should take a few minutes, to copy the databases from ellington.
Transferring netgroup...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byuser...
ypxfr: Exiting: Map successfully transferred
Transferring netgroup.byhost...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byuid...
ypxfr: Exiting: Map successfully transferred
Transferring passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring group.bygid...
ypxfr: Exiting: Map successfully transferred
Transferring group.byname...
ypxfr: Exiting: Map successfully transferred
Transferring services.byname...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring rpc.byname...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.byname...
ypxfr: Exiting: Map successfully transferred
Transferring master.passwd.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byname...
ypxfr: Exiting: Map successfully transferred
Transferring networks.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring netid.byname...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byaddr...
ypxfr: Exiting: Map successfully transferred
Transferring protocols.bynumber...
ypxfr: Exiting: Map successfully transferred
Transferring ypservers...
ypxfr: Exiting: Map successfully transferred
Transferring hosts.byname...
ypxfr: Exiting: Map successfully transferred

coltrane has been setup as an YP slave server without any errors.
Don't forget to update map ypservers on ellington.</pre><p>Теперь у вас должен быть каталог с именем
	  <code class="filename">/var/yp/test-domain</code>.  Копии карт главного
	  сервера NIS должны быть в этом каталоге.  Вы должны удостовериться,
	  что этот каталог обновляется.  Следующие строки в
	  <code class="filename">/etc/crontab</code> вашего вторичного сервера должны
	  это делать:</p><pre class="programlisting">20	*	*	*	*	root   /usr/libexec/ypxfr passwd.byname
21	*	*	*	*	root   /usr/libexec/ypxfr passwd.byuid</pre><p>Эти две строки заставляют вторичный сервер синхронизировать
	  свои карты с картами главного сервера.  Эти строки не являются
	  обязательными, так как главный сервер автоматически пытается
	  передать вторичным серверам все изменения в своих картах NIS.
	  Однако, учитывая важность информации о паролях для клиентов,
	  зависящих от вторичного сервера, рекомендуется выполнять частые
	  обновления карт с паролями.  Это особенно важно в загруженных
	  сетях, в которых обновления карт могут не всегда завершаться
	  успешно.</p><p>А теперь точно также запустите команду
	  <code class="command">/etc/netstart</code> на вторичном сервере, по которой
	  снова выполнится запуск сервера NIS.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97518928"></a>25.4.4.3. Клиенты NIS</h4></div></div></div><p>Клиент NIS выполняет так называемую привязку к конкретному
	серверу NIS при помощи даемона <code class="command">ypbind</code>.
	<code class="command">ypbind</code> определяет домен, используемый в системе
	по умолчанию (тот, который устанавливается по команде
	<code class="command">domainname</code>), и начинает широковещательную рассылку
	запросов RPC в локальной сети.	В этих запросах указано имя домена,
	к серверу которого <code class="command">ypbind</code> пытается осуществить
	привязку.  Если сервер, который был настроен для обслуживания
	запрашиваемого домена, получит широковещательный запрос, он ответит
	<code class="command">ypbind</code>, который, в свою очередь запомнит адрес
	сервера.  Если имеется несколько серверов (например, главный и
	несколько вторичных), то <code class="command">ypbind</code> будет использовать
	адрес первого ответившего.  С этого момента клиентская система будет
	направлять все свои запросы NIS на этот сервер.  Время от времени
	<code class="command">ypbind</code> будет <span class="quote"><<<span class="quote">пинать</span>>></span> сервер для
	проверки его работоспособности.
	Если на один из тестовых пакетов не удастся получить ответа за
	разумное время, то <code class="command">ypbind</code> пометит этот домен как
	домен, с которым связка разорвана, и снова начнет процесс посылки
	широковещательных запросов в надежде найти другой сервер.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97531728"></a>25.4.4.3.1. Настройка клиента NIS</h5></div></div></div><a id="idp97532368" class="indexterm"></a><p>Настройка машины с FreeBSD в качестве клиента NIS достаточно
	  проста.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Отредактируйте файл <code class="filename">/etc/rc.conf</code>,
	      добавив туда следующие строки для того, чтобы задать имя домена
	      NIS и запустить <code class="command">ypbind</code> во время запуска
	      сетевых служб:</p><pre class="programlisting">nisdomainname="test-domain"
nis_client_enable="YES"</pre></li><li class="step"><p>Для импортирования всех возможных учётных записей от сервера
	      NIS, удалите все записи пользователей из вашего файла
	      <code class="filename">/etc/master.passwd</code> и воспользуйтесь
	      командой <code class="command">vipw</code> для добавления следующей строки
	      в конец файла:</p><pre class="programlisting">+:::::::::</pre><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Эта строчка даст всем пользователям с корректной учетной
		записью в картах учетных баз пользователей доступ к этой
		системе.  Есть множество способов настроить ваш клиент NIS,
		изменив эту строку.  Посмотрите ниже текст, касающийся <a class="link" href="network-nis.html#network-netgroups" title="25.4.7. Использование сетевых групп">сетевых групп</a>, чтобы
		получить более подробную информацию.  Дополнительная информация
		для изучения находится в книге издательства O'Reilly под
		названием <code class="literal">Managing NFS and NIS</code>.</p></div><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Вы должны оставить хотя бы одну локальную запись (то есть
		не импортировать ее через NIS) в вашем
		<code class="filename">/etc/master.passwd</code> и эта запись должна
		быть также членом группы <code class="systemitem">wheel</code>.  Если
		с NIS что-то случится, эта запись может использоваться для
		удаленного входа в систему, перехода в режим администратора и
		исправления неисправностей.</p></div></li><li class="step"><p>Для импортирования всех возможных записей о группах с
		сервера NIS, добавьте в ваш файл
		<code class="filename">/etc/group</code> такую строчку:</p><pre class="programlisting">+:*::</pre></li></ol></div><p>Для немедленного запуска клиента NIS выполните следующую
	    команду с правами пользователя <code class="systemitem">root</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/netstart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/ypbind start</code></strong></pre><p>После завершения выполнения этих шагов у вас должно получиться
	    запустить команду <code class="command">ypcat passwd</code> и увидеть
	    карту учетных записей сервера NIS.</p></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97600464"></a>25.4.5. Безопасность NIS</h3></div></div></div><p>В общем-то любой пользователь, зная имя вашего домена, может
      выполнить запрос RPC к <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a> и получить содержимое ваших карт
      NIS.  Для предотвращения такого неавторизованного обмена <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a>
      поддерживает так называемую систему <span class="quote"><<<span class="quote">securenets</span>>></span>, которая может
      использоваться для ограничения доступа к некоторой группе хостов.  При
      запуске <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a> будет пытаться загрузить информацию, касающуюся
      securenets, из файла <code class="filename">/var/yp/securenets</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Имя каталога зависит от параметра, указанного вместе с опцией
	<code class="option">-p</code>.  Этот файл содержит записи, состоящие из
	указания сети и сетевой маски, разделенных пробелом.  Строчки,
	начинающиеся со знака <span class="quote"><<<span class="quote">#</span>>></span>, считаются комментариями.
	Примерный файл securenets может иметь примерно такой вид:</p></div><pre class="programlisting"># allow connections from local host -- mandatory
127.0.0.1     255.255.255.255
# allow connections from any host
# on the 192.168.128.0 network
192.168.128.0 255.255.255.0
# allow connections from any host
# between 10.0.0.0 to 10.0.15.255
# this includes the machines in the testlab
10.0.0.0      255.255.240.0</pre><p>Если <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypserv&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypserv</span>(8)</span></a> получает запрос от адреса, который соответствует
      одному из этих правил, он будет отрабатывать запрос обычным образом.
      Если же адрес не подпадает ни под одно правило, запрос будет
      проигнорирован и в журнал будет записано предупреждающее сообщение.  Если
      файл <code class="filename">/var/yp/securenets</code> не существует,
      <code class="command">ypserv</code> будет обслуживать соединения от любого
      хоста.</p><p>Программа <code class="command">ypserv</code> также поддерживает пакет программ
      <span class="application">TCP Wrapper</span> от Wietse Venema.  Это позволяет
      администратору для ограничения доступа вместо
      <code class="filename">/var/yp/securenets</code> использовать конфигурационные
      файлы <span class="application">TCP Wrapper</span>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Хотя оба этих метода управления доступом обеспечивают некоторую
	безопасность, они, как основанные на проверке привилегированного
	порта, оба подвержены атакам типа <span class="quote"><<<span class="quote">IP spoofing</span>>></span>.  Весь
	сетевой трафик, связанный с работой NIS, должен блокироваться вашим
	брандмауэром.</p><p xmlns="http://www.w3.org/1999/xhtml">Серверы, использующие файл <code class="filename">/var/yp/securenets</code>,
	могут быть не в состоянии обслуживать старых клиентов NIS с древней
	реализацией протокола TCP/IP.  Некоторые из этих реализаций при
	рассылке широковещательных запросов устанавливают все биты машинной
	части адреса в ноль и/или не в состоянии определить маску подсети при
	вычислении адреса широковещательной рассылки.  Хотя некоторые из этих
	проблем могут быть решены изменением конфигурации клиента, другие
	могут привести к отказу от использования
	<code class="filename">/var/yp/securenets</code>.</p><p xmlns="http://www.w3.org/1999/xhtml">Использование <code class="filename">/var/yp/securenets</code> на сервере
	с такой архаичной реализацией TCP/IP является весьма плохой идеей, и
	приведёт к потере работоспособности NIS в большой части вашей
	сети.</p><a xmlns="http://www.w3.org/1999/xhtml" id="idp97617616" class="indexterm"></a><p xmlns="http://www.w3.org/1999/xhtml">Использование пакета <span class="application">TCP Wrapper</span> увеличит
	время отклика вашего сервера NIS.  Дополнительной задержки может
	оказаться достаточно для возникновения тайм-аутов в клиентских
	программах, особенно в загруженных сетях или с медленными серверами
	NIS.  Если одна или более ваших клиентских систем страдают от таких
	проблем, вы должны преобразовать такие клиентские системы во вторичные
	серверы NIS и сделать принудительную их привязку к самим себе.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97619152"></a>25.4.6. Запрет входа некоторых пользователей</h3></div></div></div><p>В нашей лаборатории есть машина <code class="systemitem">basie</code>, о которой
      предполагается, что она является исключительно факультетской рабочей
      станцией.  Мы не хотим исключать эту машину из домена NIS, однако
      файл <code class="filename">passwd</code> на главном сервере NIS содержит
      учетные записи как для работников факультета, так и студентов.  Что мы
      можем сделать?</p><p>Есть способ ограничить вход некоторых пользователей на этой машине,
      даже если они присутствуют в базе данных NIS.  Чтобы это сделать, вам
      достаточно добавить
      <code class="literal">-<em class="replaceable"><code>username</code></em></code> в конец файла
      <code class="filename">/etc/master.passwd</code> на клиентской машине, где
      <em class="replaceable"><code>username</code></em> является именем пользователя,
      которому вы хотите запретить вход.  Рекомендуется сделать это с помощью
      утилиты <code class="command">vipw</code>, так как <code class="command">vipw</code>
      проверит ваши изменения в <code class="filename">/etc/master.passwd</code>, а
      также автоматически перестроит базу данных паролей по окончании
      редактирования.  Например, если мы хотим запретить пользователю
      <code class="systemitem">bill</code> осуществлять вход на машине
      <code class="systemitem">basie</code>, то мы сделаем следующее:</p><pre class="screen">basie<code class="prompt">#</code> <strong class="userinput"><code>vipw</code></strong>
<strong class="userinput"><code>[add -bill to the end, exit]</code></strong>
vipw: rebuilding the database...
vipw: done

basie<code class="prompt">#</code> <strong class="userinput"><code>cat /etc/master.passwd</code></strong>

root:[password]:0:0::0:0:The super-user:/root:/bin/csh
toor:[password]:0:0::0:0:The other super-user:/root:/bin/sh
daemon:*:1:1::0:0:Owner of many system processes:/root:/sbin/nologin
operator:*:2:5::0:0:System &amp;:/:/sbin/nologin
bin:*:3:7::0:0:Binaries Commands and Source,,,:/:/sbin/nologin
tty:*:4:65533::0:0:Tty Sandbox:/:/sbin/nologin
kmem:*:5:65533::0:0:KMem Sandbox:/:/sbin/nologin
games:*:7:13::0:0:Games pseudo-user:/usr/games:/sbin/nologin
news:*:8:8::0:0:News Subsystem:/:/sbin/nologin
man:*:9:9::0:0:Mister Man Pages:/usr/share/man:/sbin/nologin
bind:*:53:53::0:0:Bind Sandbox:/:/sbin/nologin
uucp:*:66:66::0:0:UUCP pseudo-user:/var/spool/uucppublic:/usr/libexec/uucp/uucico
xten:*:67:67::0:0:X-10 daemon:/usr/local/xten:/sbin/nologin
pop:*:68:6::0:0:Post Office Owner:/nonexistent:/sbin/nologin
nobody:*:65534:65534::0:0:Unprivileged user:/nonexistent:/sbin/nologin
+:::::::::
-bill

basie<code class="prompt">#</code></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-netgroups"></a>25.4.7. Использование сетевых групп</h3></div><div><span class="authorgroup">Текст предоставил <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Udo</span> <span class="surname">Erdelhoff</span></span>. </span></div></div></div><a id="idp97634512" class="indexterm"></a><p>Способ, описанный в предыдущем разделе, работает достаточно хорошо,
	если вам нужны особые правила для очень малой группы пользователей или
	машин.	В более крупных сетях вы <span class="emphasis"><em>забудете</em></span> о
	запрете входа определенных пользователей на важные машины или даже
	будете настраивать каждую машину по отдельности, теряя таким образом
	главное преимущество использования NIS:
	<span class="emphasis"><em>централизованное</em></span> администрирование.</p><p>Ответом разработчиков NIS на эту проблему являются
	<span class="emphasis"><em>сетевые группы</em></span>.  Их назначение и смысл можно
	сравнить с обычными группами, используемыми в файловых системах <span class="trademark">UNIX</span>(R).
	Главное отличие заключается в отсутствии числового идентификатора и
	возможности задать сетевую группу включением как пользователей, так и
	других сетевых групп.</p><p>Сетевые группы были разработаны для работы с большими, сложными
	сетями с сотнями пользователей и машин.  С одной стороны, хорошо, если
	вам приходится с такой ситуацией.  С другой стороны, эта сложность
	делает невозможным описание сетевых групп с помощью простых примеров.
	Пример, используемый в дальнейшем, демонстрирует эту проблему.</p><p>Давайте предположим, что успешное внедрение системы NIS в вашей
	лаборатории заинтересовало ваше руководство.  Вашим следующим заданием
	стало расширение домена NIS для включения в него некоторых других
	машин студенческого городка.  В двух таблицах перечислены имена
	новых машин и пользователей, а также их краткое описание.</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Имена пользователей</th><th>Описание</th></tr></thead><tbody><tr><td><code class="systemitem">alpha</code>, <code class="systemitem">beta</code></td><td>Обычные служащие IT-департамента</td></tr><tr><td><code class="systemitem">charlie</code>, <code class="systemitem">delta</code></td><td>Практиканты IT-департамента</td></tr><tr><td><code class="systemitem">echo</code>, <code class="systemitem">foxtrott</code>, <code class="systemitem">golf</code>, ...</td><td>Обычные сотрудники</td></tr><tr><td><code class="systemitem">able</code>, <code class="systemitem">baker</code>, ...</td><td>Проходящие интернатуру</td></tr></tbody></table></div><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Имена машин</th><th>Описание</th></tr></thead><tbody><tr><td><code class="systemitem">war</code>, <code class="systemitem">death</code>, <code class="systemitem">famine</code>, <code class="systemitem">pollution</code></td><td>Ваши самые важные серверы.  Только служащим IT позволяется
	    входить на эти машины.</td></tr><tr><td><code class="systemitem">pride</code>, <code class="systemitem">greed</code>, <code class="systemitem">envy</code>, <code class="systemitem">wrath</code>, <code class="systemitem">lust</code>, <code class="systemitem">sloth</code></td><td>Менее важные серверы.	Все сотрудники департамента IT могут
	    входить на эти машины.</td></tr><tr><td><code class="systemitem">one</code>, <code class="systemitem">two</code>, <code class="systemitem">three</code>, <code class="systemitem">four</code>, ...</td><td>Обычные рабочие станции.  Только
	    <span class="emphasis"><em>реально нанятым</em></span> служащим позволяется
	    использовать эти машины.</td></tr><tr><td><code class="systemitem">trashcan</code></td><td>Очень старая машина без каких-либо критичных данных.  Даже
	    проходящим интернатуру разрешено ее использовать.</td></tr></tbody></table></div><p>Если вы попытаетесь реализовать эти требования, ограничивая
	каждого пользователя по отдельности, то вам придется добавить на каждой
	машине в файл <code class="filename">passwd</code> по одной строчке
	<code class="literal">-<em class="replaceable"><code>user</code></em></code> для каждого пользователя, которому
	запрещено входить на эту систему.  Если вы забудете даже одну строчку,
	у вас могут начаться проблемы.	Гораздо проще делать это правильно во
	время начальной установки, однако вы постепенно <span class="emphasis"><em>будете
	забывать</em></span> добавлять строчки для новых пользователей во время
	повседневной работы.  В конце концов, Мерфи был оптимистом.</p><p>Использование в этой ситуации сетевых групп дает несколько
	преимуществ.  Нет необходимости описывать по отдельности каждого
	пользователя; вы ставите в соответствие пользователю одну или
	несколько сетевых групп и разрешаете или запрещаете вход всем членам
	сетевой группы.  Если вы добавляете новую машину, вам достаточно
	определить ограничения на вход для сетевых групп.  Если добавляется
	новый пользователь, вам достаточно добавить его к одной или большему
	числу сетевых групп.  Эти изменения независимы друг от друга: нет
	больше комбинаций <span class="quote"><<<span class="quote">для каждого пользователя и машины</span>>></span>.
	Если настройка вашей системы NIS тщательно спланирована, то для
	разрешения или запрещения доступа к машинам вам нужно будет
	модифицировать единственный конфигурационный файл.</p><p>Первым шагом является инициализация карты NIS по имени netgroup.
	Программа <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypinit&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypinit</span>(8)</span></a> во FreeBSD по умолчанию этой карты не
	создаёт, хотя реализация NIS будет её поддерживает, как только она
	будет создана.  Чтобы создать пустую карту, просто наберите</p><pre class="screen">ellington<code class="prompt">#</code> <strong class="userinput"><code>vi /var/yp/netgroup</code></strong></pre><p>и начните добавлять содержимое.  Например, нам нужно по крайней
	мере четыре сетевых группы: сотрудники IT, практиканты IT, обычные
	сотрудники и интернатура.</p><pre class="programlisting">IT_EMP	(,alpha,test-domain)	(,beta,test-domain)
IT_APP	(,charlie,test-domain)	(,delta,test-domain)
USERS	(,echo,test-domain)	(,foxtrott,test-domain) \
	(,golf,test-domain)
INTERNS (,able,test-domain)	(,baker,test-domain)</pre><p><code class="literal">IT_EMP</code>, <code class="literal">IT_APP</code> и так далее
	являются именами сетевых групп.  Несколько слов в скобках служат для
	добавления пользователей в группу.  Три поля внутри группы обозначают
	следующее:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Имя хоста или хостов, к которым применимы последующие записи.
	    Если имя хоста не указано, то запись применяется ко всем хостам.
	    Если же указывается имя хоста, то вы получите мир темноты, ужаса
	    и страшной путаницы.</p></li><li class="listitem"><p>Имя учетной записи, которая принадлежит этой сетевой
	    группе.</p></li><li class="listitem"><p>Домен NIS для учетной записи.  Вы можете импортировать в вашу
	    сетевую группу учетные записи из других доменов NIS, если вы один
	    из тех несчастных, имеющих более одного домена NIS.</p></li></ol></div><p>Каждое из этих полей может содержать шаблоны, подробности даны в
	странице справочника по <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=netgroup&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">netgroup</span>(5)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><a xmlns="http://www.w3.org/1999/xhtml" id="idp97686864" class="indexterm"></a><p xmlns="http://www.w3.org/1999/xhtml">Не нужно использовать имена сетевых групп длиннее 8 символов,
	  особенно если в вашем домене NIS имеются машины, работающие под
	  управлением других операционных систем.  Имена чувствительны к
	  регистру; использование заглавных букв для имен сетевых групп
	  облегчает распознавание пользователей, имен машин и сетевых
	  групп.</p><p xmlns="http://www.w3.org/1999/xhtml">Некоторые клиенты NIS (отличные от FreeBSD) не могут работать
	  с сетевыми группами, включающими большое количество записей.
	  Например, в некоторых старых версиях <span class="trademark">SunOS</span>TM возникают проблемы, если
	  сетевая группа содержит более 15 <span class="emphasis"><em>записей</em></span>.  Вы
	  можете обойти это ограничение, создав несколько подгрупп с 15 или
	  меньшим количеством пользователей и настоящую сетевую группу,
	  состоящую из подгрупп:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">BIGGRP1  (,joe1,domain)  (,joe2,domain)  (,joe3,domain) [...]
BIGGRP2  (,joe16,domain)  (,joe17,domain) [...]
BIGGRP3  (,joe31,domain)  (,joe32,domain)
BIGGROUP  BIGGRP1 BIGGRP2 BIGGRP3</pre><p xmlns="http://www.w3.org/1999/xhtml">Вы можете повторить этот процесс, если вам нужно иметь более 225
	  пользователей в одной сетевой группе.</p></div><p>Активация и распространение вашей карты NIS проста:</p><pre class="screen">ellington<code class="prompt">#</code> <strong class="userinput"><code>cd /var/yp</code></strong>
ellington<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong></pre><p>Это приведет к созданию трех карт NIS
	<code class="filename">netgroup</code>, <code class="filename">netgroup.byhost</code> и
	<code class="filename">netgroup.byuser</code>.  Воспользуйтесь утилитой
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypcat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ypcat</span>(1)</span></a> для проверки доступности ваших новых карт NIS:</p><pre class="screen">ellington<code class="prompt">%</code> <strong class="userinput"><code>ypcat -k netgroup</code></strong>
ellington<code class="prompt">%</code> <strong class="userinput"><code>ypcat -k netgroup.byhost</code></strong>
ellington<code class="prompt">%</code> <strong class="userinput"><code>ypcat -k netgroup.byuser</code></strong></pre><p>Вывод первой команды должен соответствовать содержимому файла
	<code class="filename">/var/yp/netgroup</code>.	Вторая команда не выведет
	ничего, если вы не зададите сетевые группы, специфичные для хоста.
	Третья команда может использоваться пользователем для получения
	списка сетевых групп.</p><p>Настройка клиента достаточно проста.  Чтобы настроить сервер
	<code class="systemitem">war</code>, вам достаточно запустить <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vipw&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">vipw</span>(8)</span></a>
	и заменить строку</p><pre class="programlisting">+:::::::::</pre><p>на</p><pre class="programlisting">+@IT_EMP:::::::::</pre><p>Теперь только данные, касающиеся пользователей, определенных в
	сетевой группе <code class="literal">IT_EMP</code>, импортируются в
	базу паролей машины <code class="systemitem">war</code> и только этим
	пользователям будет разрешен вход.</p><p>К сожалению, это ограничение также касается и функции <code class="literal">~</code> командного
	процессора и всех подпрограмм, выполняющих преобразование между
	именами пользователей и их числовыми ID.  Другими
	словами, команда <code class="command">cd ~<em class="replaceable"><code>user</code></em></code>
	работать не будет, команда <code class="command">ls -l</code> будет выдавать
	числовые идентификаторы вместо имён пользователей, а
	<code class="command">find . -user joe -print</code> работать откажется, выдавая
	сообщение <span class="errorname">No such user</span>.  Чтобы это исправить,
	вам нужно будет выполнить импорт всех записей о пользователях
	<span class="emphasis"><em>без разрешения на вход на ваши серверы</em></span>.</p><p>Это можно сделать, добавив еще одну строку в файл
	<code class="filename">/etc/master.passwd</code>.  Эта строка должна
	содержать:</p><p><code class="literal">+:::::::::/sbin/nologin</code>, что означает
	<span class="quote"><<<span class="quote">Произвести импортирование всех записей с заменой командного
	процессора на <code class="filename">/sbin/nologin</code> в импортируемых
	записях</span>>></span>.  Вы можете заменить любое поле в строке с паролем,
	указав значение по умолчанию в вашем
	<code class="filename">/etc/master.passwd</code>.</p><div xmlns="" class="warning"><h3 class="admontitle">Предупреждение: </h3><p xmlns="http://www.w3.org/1999/xhtml">Проверьте, что строка
	  <code class="literal">+:::::::::/sbin/nologin</code> помещена после
	  <code class="literal">+@IT_EMP:::::::::</code>.  В противном случае все
	  пользовательские записи, импортированные из NIS, будут иметь
	  <code class="filename">/sbin/nologin</code> в качестве оболочки.</p></div><p>После этого изменения при появлении нового сотрудника IT вам будет
	достаточно изменять только одну карту NIS.  Вы можете применить
	подобный метод для менее важных серверов, заменяя
	старую строку <code class="literal">+:::::::::</code> в их файлах
	<code class="filename">/etc/master.passwd</code> на нечто, подобное
	следующему:</p><pre class="programlisting">+@IT_EMP:::::::::
+@IT_APP:::::::::
+:::::::::/sbin/nologin</pre><p>Соответствующие строки для обычных рабочих станций могут иметь
	такой вид:</p><pre class="programlisting">+@IT_EMP:::::::::
+@USERS:::::::::
+:::::::::/sbin/nologin</pre><p>И все было прекрасно до того момента, когда через несколько
	недель изменилась политика: Департамент IT начал нанимать интернатуру.
	Интернатуре в IT позволили использовать обычные рабочие станции и
	менее важные серверы; практикантам позволили входить на главные
	серверы.  Вы создали новую сетевую группу <code class="literal">IT_INTERN</code>, добавили в нее
	новую интернатуру и начали изменять настройки на всех и каждой
	машине...  Как говорит старая мудрость: <span class="quote"><<<span class="quote">Ошибки в
	централизованном планировании приводят к глобальному
	хаосу</span>>></span>.</p><p>Возможность в NIS создавать сетевые группы из других сетевых
	групп может использоваться для предотвращения подобных ситуаций.  Одним
	из вариантов является создание сетевых групп на основе ролей.
	Например, вы можете создать сетевую группу с именем
	<code class="literal">BIGSRV</code> для задания ограничений на вход на
	важные серверы, другую сетевую группу с именем
	<code class="literal">SMALLSRV</code> для менее важных серверов и третью
	сетевую группу под названием <code class="literal">USERBOX</code> для
	обычных рабочих станций.  Каждая из этих сетевых групп содержит
	сетевые группы, которым позволено входить на эти машины.  Новые записи
	для вашей карты NIS сетевой группы должны выглядеть таким
	образом:</p><pre class="programlisting">BIGSRV	  IT_EMP  IT_APP
SMALLSRV  IT_EMP  IT_APP  ITINTERN
USERBOX   IT_EMP  ITINTERN USERS</pre><p>Этот метод задания ограничений на вход работает весьма хорошо,
	если вы можете выделить группы машин с одинаковыми ограничениями.  К
	сожалению, такая ситуация может быть исключением, но не правилом.  В
	большинстве случаев вам нужна возможность определять ограничения на
	вход индивидуально для каждой машины.</p><p>Задание сетевых групп в зависимости от машин является другой
	возможностью, которой можно воспользоваться при изменении политики,
	описанной выше.  При таком развитии событий файл
	<code class="filename">/etc/master.passwd</code> на каждой машине содержит две
	строки, начинающиеся с <span class="quote"><<<span class="quote">+</span>>></span>.  Первая из них добавляет
	сетевую группу с учётными записями, которым разрешено входить на эту
	машину, а вторая добавляет все оставшиеся учетные записи с
	<code class="filename">/sbin/nologin</code> в качестве командного процессора.
	Хорошей идеей является использование <span class="quote"><<<span class="quote">ИМЕНИ МАШИНЫ</span>>></span> заглавными буквами
	для имени сетевой группы.  Другими словами, строки должны иметь такой
	вид:</p><pre class="programlisting">+@<em class="replaceable"><code>BOXNAME</code></em>:::::::::
+:::::::::/sbin/nologin</pre><p>Как только вы завершите эту работу для всех ваших машин, вам не
	нужно будет снова модифицировать локальные версии
	<code class="filename">/etc/master.passwd</code>.  Все будущие изменения могут
	быть выполнены изменением карты NIS.  Вот пример возможной карты
	сетевой группы для этого случая с некоторыми полезными
	дополнениями:</p><pre class="programlisting"># Сначала определяем группы пользователей
IT_EMP	  (,alpha,test-domain)	  (,beta,test-domain)
IT_APP	  (,charlie,test-domain)  (,delta,test-domain)
DEPT1	  (,echo,test-domain)	  (,foxtrott,test-domain)
DEPT2	  (,golf,test-domain)	  (,hotel,test-domain)
DEPT3	  (,india,test-domain)	  (,juliet,test-domain)
ITINTERN  (,kilo,test-domain)	  (,lima,test-domain)
D_INTERNS (,able,test-domain)	  (,baker,test-domain)
#
# Теперь задаем несколько групп на основе ролей
USERS	  DEPT1   DEPT2     DEPT3
BIGSRV	  IT_EMP  IT_APP
SMALLSRV  IT_EMP  IT_APP    ITINTERN
USERBOX   IT_EMP  ITINTERN  USERS
#
# И группы для специальных задач
# Открыть пользователям echo и golf доступ к антивирусной машине
SECURITY  IT_EMP  (,echo,test-domain)  (,golf,test-domain)
#
# Сетевые группы, специфичные для машин
# Наши главные серверы
WAR	  BIGSRV
FAMINE	  BIGSRV
# Пользователю india необходим доступ к этому серверу
POLLUTION  BIGSRV  (,india,test-domain)
#
# Этот очень важен и ему требуются большие ограничения доступа
DEATH	  IT_EMP
#
# Антивирусная машина, упомянутая выше
ONE	  SECURITY
#
# Ограничить машину единственным пользователем
TWO	  (,hotel,test-domain)
# [...далее следуют другие группы]</pre><p>Если вы используете какие-либо базы данных для управления
	учетными записями ваших пользователей, вы должны смочь создать первую
	часть карты с помощью инструментов построения отчетов вашей базы
	данных.  В таком случае новые пользователи автоматически получат
	доступ к машинам.</p><p>И последнее замечание: Не всегда бывает разумно использовать
	сетевые группы на основе машин.  Если в студенческих лабораториях вы
	используете несколько десятков или даже сотен одинаковых машин, то
	вам нужно использовать сетевые группы на основе ролей, а не основе
	машин, для того, чтобы размеры карты NIS оставались в разумных
	пределах.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97728848"></a>25.4.8. Важные замечания</h3></div></div></div><p>Есть некоторые действия, которые нужно будет выполнять по-другому,
      если вы работаете с NIS.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Каждый раз, когда вы собираетесь добавить пользователя в
	  лаборатории, вы должны добавить его <span class="emphasis"><em>только</em></span> на
	  главном сервере NIS и <span class="emphasis"><em>обязательно перестроить карты
	  NIS</em></span>.  Если вы забудете сделать это, то новый
	  пользователь не сможет нигде войти, кроме как на главном сервере
	  NIS.  Например, если в лаборатории нам нужно добавить нового
	  пользователя <code class="systemitem">jsmith</code>, мы делаем вот что:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw useradd jsmith</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /var/yp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make test-domain</code></strong></pre><p>Вместо <code class="command">pw useradd jsmith</code> вы можете также
	  запустить команду <code class="command">adduser jsmith</code>.</p></li><li class="listitem"><p><span class="emphasis"><em>Не помещайте административные учетные записи в карты
	  NIS</em></span>.  Вам не нужно распространять административных
	  пользователей и их пароли на машины, которые не должны иметь доступ
	  к таким учётным записям.</p></li><li class="listitem"><p><span class="emphasis"><em>Сделайте главный и вторичные серверы NIS безопасными
	  и минимизируйте их время простоя</em></span>.	Если кто-то либо
	  взломает, либо просто отключит эти машины, то люди без права
	  входа в лабораторию с легкостью получат доступ.</p><p>Это основное уязвимое место в любой централизованно
	  администрируемой системе.  Если вы не
	  защищаете ваши серверы NIS, вы будете иметь дело с толпой
	  разозлённых пользователей!</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97738576"></a>25.4.9. Совместимость с NIS v1</h3></div></div></div><p><span class="application">ypserv</span> из поставки FreeBSD имеет
      встроенную поддержку для обслуживания клиентов NIS v1.  Реализация
      NIS
      во FreeBSD использует только протокол NIS v2, хотя другие реализации
      имеют поддержку протокола v1 для совместимости со старыми системами.
      Даемоны <span class="application">ypbind</span>, поставляемые с такими
      системами, будут пытаться осуществить привязку к серверу NIS v1, даже
      если это им не нужно (и они будут постоянно рассылать широковещательные
      запросы в поиске такого сервера даже после получения ответа от сервера
      v2).  Отметьте, что хотя имеется поддержка обычных клиентских вызовов,
      эта версия <span class="application">ypserv</span> не отрабатывает запросы на передачу карт v1;
      следовательно, она не может использоваться в качестве главного или
      вторичного серверов вместе с другими серверами NIS, поддерживающими
      только протокол v1.  К счастью, скорее всего, в настоящий момент
      такие серверы практически не используются.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-nis-server-is-client"></a>25.4.10. Серверы NIS, которые также являются клиентами NIS</h3></div></div></div><p>Особое внимание следует уделить использованию
	<span class="application">ypserv</span> в домене со
	многими серверами, когда серверные машины являются также клиентами
	NIS.
	Неплохо бы заставить серверы осуществить привязку к самим себе,
	запретив рассылку запросов на привязку и возможно, перекрестную
	привязку друг к другу.  Если один сервер выйдет из строя, а другие
	будут зависеть от него, то в результате могут возникнуть странные
	ситуации.  Постепенно все клиенты попадут в тайм-аут и попытаются
	привязаться к другим серверам, но полученная задержка может быть
	значительной, а странности останутся, так как серверы снова могут
	привязаться друг к другу.</p><p>Вы можете заставить хост выполнить привязку к конкретному серверу,
	запустив команду <code class="command">ypbind</code> с флагом
	<code class="option">-S</code>.  Если вы не хотите делать это вручную каждый
	раз при перезагрузке
	вашего сервера NIS, то можете добавить в файл
	<code class="filename">/etc/rc.conf</code> такие строки:</p><pre class="programlisting">nis_client_enable="YES"   # run client stuff as well
nis_client_flags="-S <em class="replaceable"><code>NIS domain</code></em>,<em class="replaceable"><code>server</code></em>"</pre><p>Дополнительную информацию можно найти на странице справки по
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ypbind&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ypbind</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp97783376"></a>25.4.11. Форматы паролей</h3></div></div></div><a id="idp97784016" class="indexterm"></a><p>Одним из общих вопросов, которые возникают в начале работы с NIS,
	является вопрос совместимости форматов паролей.  Если ваш сервер NIS
	использует пароли, зашифрованные алгоритмом DES, то он будет
	поддерживать только тех клиентов, что также используют DES.  К
	примеру, если в вашей сети имеются клиенты NIS, использующие <span class="trademark">Solaris</span>TM,
	то вам, скорее всего, необходимо использовать пароли с шифрованием по
	алгоритму DES.</p><p>Чтобы понять, какой формат используют ваши серверы и клиенты,
	загляните в файл <code class="filename">/etc/login.conf</code>.  Если хост
	настроен на использование паролей, зашифрованных по алгоритму DES,
	то класс <code class="literal">default</code> будет содержать запись вроде
	следующей:</p><pre class="programlisting">default:\
	:passwd_format=des:\
	:copyright=/etc/COPYRIGHT:\
	[Последующие строки опущены]</pre><p>Другими возможными значениями для <code class="literal">passwd_format</code>
	являются <code class="literal">blf</code> и <code class="literal">md5</code> (для паролей,
	шифруемых по стандартам Blowfish и MD5 соответственно).</p><p>Если вы внесли изменения в файл
	<code class="filename">/etc/login.conf</code>, то вам также нужно перестроить
	базу данных параметров входа в систему, что достигается запуском
	следующей команды пользователем <code class="systemitem">root</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Формат паролей, которые уже находятся в файле
	  <code class="filename">/etc/master.passwd</code>, не будет изменён до тех пор,
	  пока пользователь не сменит свой пароль <span class="emphasis"><em>после</em></span>
	  перестроения базы данных параметров входа в систему.</p></div><p>После этого, чтобы удостовериться в том, что пароли зашифрованы
	в том формате, который выбран вами, нужно проверить, что строка
	<code class="literal">crypt_default</code> в <code class="filename">/etc/auth.conf</code>
	указывает предпочтение выбранного вами формата паролей.  Для этого
	поместите выбранный формат первым в списке.  Например, при
	использовании DES-шифрования паролей строка будет выглядеть так:</p><pre class="programlisting">crypt_default	=	des blf md5</pre><p>Выполнив вышеперечисленные шаги на каждом из серверов и клиентов
	NIS, работающих на FreeBSD, вы можете обеспечить их согласованность
	относительно используемого в вашей сети формата паролей.  Если у вас
	возникли проблемы с аутентификацией клиента NIS, начать
	её решать определённо стоит отсюда.  Запомните: если вы хотите
	использовать сервер NIS в гетерогенной сети, вам, наверное, нужно
	будет использовать DES на всех системах в силу того, что это
	минимальный общий стандарт.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-nfs.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="network-servers.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="network-dhcp.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">25.3. Network File System (NFS) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 25.5. Автоматическая настройка сети (DHCP)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>