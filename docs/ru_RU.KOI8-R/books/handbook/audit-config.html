<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>16.3. Настройка системы аудита</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="audit.html" title="Глава 16. Аудит событий безопасности" /><link rel="prev" href="audit-inline-glossary.html" title="16.2. Ключевые понятия" /><link rel="next" href="audit-administration.html" title="16.4. Работа с журналами аудита" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">16.3. Настройка системы аудита</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="audit-inline-glossary.html">Пред.</a> </td><th width="60%" align="center">Глава 16. Аудит событий безопасности</th><td width="20%" align="right"> <a accesskey="n" href="audit-administration.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="audit-config"></a>16.3. Настройка системы аудита</h2></div></div></div><p>Пользовательская часть системы аудита входит в базовую
      систему FreeBSD, системная часть включена в ядро
      <code class="filename">GENERIC</code>, старт демона <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a>
      активируется включением следующей записи в
      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">auditd_enable="YES"</pre><p>Затем нужно запустить демон аудита:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service auditd start</code></strong></pre><p>Пользователям, предпочитающим строить специализированное
      ядро, необходимо включить следующую запись в файл конфигурации
      ядра:</p><pre class="programlisting">options	AUDIT</pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90511184"></a>16.3.1. Выражения выбора событий</h3></div></div></div><p>Выражения выбора используются в нескольких местах
	конфигурации для отбора событий, подлежащих аудиту.
	Выражения содержат перечень классов событий, с которым
	сравнивается происшедшее событие.  Выражения выбора
	рассматриваются слева направо, и два выражения объединяются
	добавлением первого выражения ко второму.</p><p><a class="xref" href="audit-config.html#event-selection" title="Таблица 16.1. Классы событий системы аудита">Таблица 16.1, <<Классы событий системы аудита>></a> перечисляет имеющиеся
	по умолчанию записи:</p><div class="table"><a id="event-selection"></a><div class="table-title">Таблица 16.1. Классы событий системы аудита</div><div class="table-contents"><table summary="Классы событий системы аудита" width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Имя класса</th><th>Расшифровка</th><th>Действие</th></tr></thead><tbody><tr><td>all</td><td>all</td><td>Соответствует всем классам событий.</td></tr><tr><td>aa</td><td>authentication and authorization</td><td> </td></tr><tr><td>ad</td><td>administrative</td><td>Аудит административных действий, произошедших в
		системе.</td></tr><tr><td>ap</td><td>application</td><td>События, определяемые каким-либо
		приложением.</td></tr><tr><td>cl</td><td>file close</td><td>Аудит вызовов системной функции
		<code class="function">close</code>.</td></tr><tr><td>ex</td><td>exec</td><td>Аудит запуска приложения.  Аудит аргументов
		командной строки и переменных окружения контролируется
		через <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=audit_control&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">audit_control</span>(5)</span></a> используя параметры
		<code class="literal">argv</code> и <code class="literal">envv</code>
		в опции <code class="literal">policy</code>.</td></tr><tr><td>fa</td><td>file attribute access</td><td>Аудит доступа к атрибутам объектов, например
		таких как <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=stat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">stat</span>(1)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pathconf&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">pathconf</span>(2)</span></a>.</td></tr><tr><td>fc</td><td>file create</td><td>Аудит событий, в результате которых создаются
		файлы.</td></tr><tr><td>fd</td><td>file delete</td><td>Аудит событий, в результате которых удаляются
		файлы.</td></tr><tr><td>fm</td><td>file attribute modify</td><td>Аудит событий, в результате которых изменяются
		атрибуты файлов, например, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chown&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">chown</span>(8)</span></a>,
		<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=flock&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">flock</span>(2)</span></a>.</td></tr><tr><td>fr</td><td>file read</td><td>Аудит событий, в результате которых происходит
		чтение данных или открываются файлы на чтение.</td></tr><tr><td>fw</td><td>file write</td><td>Аудит событий, в результате которых происходит
		запись данных, запись или изменение файлов.</td></tr><tr><td>io</td><td>ioctl</td><td>Аудит вызовов системной функции
		<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ioctl&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">ioctl</span>(2)</span></a>.</td></tr><tr><td>ip</td><td>ipc</td><td>Аудит различных видов взаимодействия процессов,
		включая создание неименованных каналов (POSIX pipe) и
		взаимодействие процессов в стиле System V
		<acronym class="acronym">IPC</acronym>.</td></tr><tr><td>lo</td><td>login_logout</td><td>Аудит событий <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">login</span>(1)</span></a> и
		<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=logout&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">logout</span>(1)</span></a>.</td></tr><tr><td>na</td><td>non attributable</td><td>Аудит неприписываемых событий.</td></tr><tr><td>no</td><td>invalid class</td><td>Не соответствует никаким событиям аудита.</td></tr><tr><td>nt</td><td>network</td><td>Аудит событий, связанных с сетевыми
		подключениями, например <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=connect&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">connect</span>(2)</span></a> и
		<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=accept&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">accept</span>(2)</span></a>.</td></tr><tr><td>ot</td><td>other</td><td>Аудит различных событий.</td></tr><tr><td>pc</td><td>process</td><td>Аудит действий процессов, таких как <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exec&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">exec</span>(3)</span></a>
		и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exit&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">exit</span>(3)</span></a>.</td></tr></tbody></table></div></div><br class="table-break" /><p>Эти классы событий могут быть настроены изменением
	конфигурационных файлов <code class="filename">audit_class</code> и
	<code class="filename">audit_event</code>.</p><p>Каждый класс аудита можно скомбинировать с префиксом,
	показывающим, какие операции будут учитываться -
	удачные или неудачные, а также то, включает ли данная запись
	аудит для данного класса и типа, либо отключает его.  <a class="xref" href="audit-config.html#event-prefixes" title="Таблица 16.2. Префиксы классов аудита событий">Таблица 16.2, <<Префиксы классов аудита событий>></a> обобщает доступные
	префиксы:</p><div class="table"><a id="event-prefixes"></a><div class="table-title">Таблица 16.2. Префиксы классов аудита событий</div><div class="table-contents"><table summary="Префиксы классов аудита событий" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Префикс</th><th>Действие</th></tr></thead><tbody><tr><td>+</td><td>Аудит успешных событий в данном классе.</td></tr><tr><td>-</td><td>Аудит ошибочных событий в данном классе.</td></tr><tr><td>^</td><td>Отключение аудита как успешных, так и ошибочных
		событий в данном классе.</td></tr><tr><td>^+</td><td>Отключение аудита успешных событий в данном
		классе.</td></tr><tr><td>^-</td><td>Отключение аудита ошибочных событий в данном
		классе.</td></tr></tbody></table></div></div><br class="table-break" /><p>Если префикс не указан, то аудиту подлежат как успешные,
	так и неуспешные события.</p><p>Следующий пример выбирает успешные и неуспешные события
	входа в систему и выхода из нее, и только успешные события
	выполнения приложения:</p><pre class="programlisting">lo,+ex</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp90597456"></a>16.3.2. Конфигурационные файлы</h3></div></div></div><p>В каталоге <code class="filename">/etc/security</code> находятся
	следующие конфигурационные файлы системы аудита:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">audit_class</code>: содержит определения
	    классов аудита.</p></li><li class="listitem"><p><code class="filename">audit_control</code>: контроллирует
	    некоторые аспекты системы аудита, такие как классы по
	    умолчанию, минимальное дисковое пространство, которое
	    должно оставаться на разделе журнала аудита, максимальный
	    размер журнала аудита.</p></li><li class="listitem"><p><code class="filename">audit_event</code>: связывает
	    идентификаторы событий (eventnum) с их текстовыми
	    именами, описаниями и классами событий.</p></li><li class="listitem"><p><code class="filename">audit_user</code>: уточняет настройки
	    аудита для конкретных пользователей; они комбинируются
	    с глобальными настройками при входе пользователя
	    в систему.</p></li><li class="listitem"><p><code class="filename">audit_warn</code>: настраиваемый скрипт
	    командного интерпретатора, который вызывается
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a> для генерации предупреждений в
	    исключительных ситуациях, таких как исчерпание дискового
	    пространства записями аудита или при ротации журнала
	    аудита.</p></li></ul></div><div xmlns="" class="warning"><h3 class="admontitle">Предупреждение: </h3><p xmlns="http://www.w3.org/1999/xhtml">Файлы конфигурации аудита должны редактироваться и
	  изменяться с осторожностью, так как ошибки в конфигурации
	  могут привести к сохранению бесполезных записей.</p></div><p>В большинстве случаев администратору придется вносить
	изменения только в два конфигурационных файла системы аудита:
	<code class="filename">audit_control</code> и
	<code class="filename">audit_user</code>.  Первый из них содержит
	общие настройки системы аудита, второй может использоваться
	для уточнения настроек аудита для конкретных
	пользователей.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="audit-auditcontrol"></a>16.3.2.1. Файл <code class="filename">audit_control</code></h4></div></div></div><p>Ниже приведен перечень настроек по умолчанию,
	  содержащихся в <code class="filename">audit_control</code>:</p><pre class="programlisting">dir:/var/audit
dist:off
flags:lo,aa
minfree:5
naflags:lo,aa
policy:cnt,argv
filesz:2M
expire-after:10M</pre><p>Запись <code class="option">dir</code> используется для установки
	  одного или более каталогов, в которых будет сохраняться
	  журнал системы аудита.  Если указан более чем один каталог,
	  то указанные каталоги будут использоваться по очереди, по
	  мере заполнения.  Как правило, система аудита настраивается
	  на хранение журнала аудита на отдельном разделе, чтобы
	  предотвратить взаимное влияние подсистемы аудита и
	  остальных подсистем в случае исчерпания свободного
	  места на разделе.</p><p>Если опция <code class="option">dist</code> имеет значение
	  <code class="literal">on</code> или <code class="literal">yes</code>, то для
	  всех журналов аудита будут создаваться жесткие ссылки,
	  сохраняемые в <code class="filename">/var/audit/dist</code>.</p><p>Запись <code class="option">flags</code> используется для
	  установки глобальной маски предварительного выбора для
	  приписываемых событий.  В примере выше аудиту будут
	  подвергаться как успешные, так и неудачные попытки входа в
	  систему и выхода из нее, а также - аутентификация
	  и авторизация для всех пользователей.</p><p>Запись <code class="option">minfree</code> определяет минимальное
	  количество свободного дискового пространства на разделе, в
	  который сохраняются файлы журналов аудита.</p><p>Запись <code class="option">naflags</code> определяет классы
	  аудита для неприписываемых событий, например, процессов
	  входа в систему и системных демонов.</p><p>Запись <code class="option">policy</code> определяет разделяемый
	  запятыми список флагов политики, определяющей различные
	  аспекты поведения аудита.  Флаг <code class="literal">cnt</code>
	  указывает, что система должна продолжать работать, несмотря
	  на ошибки аудита (данный флаг настоятельно рекомендуется).
	  Второй флаг, <code class="literal">argv</code>, заставляет подвергать
	  аудиту аргументы командной строки при вызове системного
	  вызова <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a>.</p><p>Запись <code class="option">filesz</code> определяет максимальный
	  размер журнала событий аудита, по достижении которого
	  журнал будет автоматически закончен и подвергнут ротации.
	  Значение <code class="literal">0</code> запрещает автоматическую
	  ротацию логов.  Если указанный размер ниже минимального
	  значения 512К, то он будет проигнорирован, и будет
	  сгенерировано предупреждающее сообщение в логах.</p><p>Поле <code class="option">expire-after</code> определяет момент
	  времени, при достижении которого журнальные файлы считаются
	  неактуальными и удаляются.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="audit-audituser"></a>16.3.2.2. Файл <code class="filename">audit_user</code></h4></div></div></div><p>Администратор может определить дополнительные
	  требования к аудиту для конкретных пользователей в файле
	  <code class="filename">audit_user</code>.  Каждая строка позволяет
	  уточнить настройки аудита для пользователя при помощи двух
	  полей: <code class="literal">alwaysaudit</code> - определяющее
	  набор событий, которые должны всегда подвергаться аудиту
	  для данного пользователя, и <code class="literal">neveraudit</code>
	  - перечисляющее набор событий, которые никогда не
	  должны подвергаться аудиту для пользователя.</p><p>Нижеследующий пример настраивает аудит всех событий
	  входа в систему, выхода из системы, а также аудит всех
	  успешных выполнений команд для пользователя <code class="systemitem">root</code>, а также - аудит
	  всех событий, связанных с созданием файлов и успешным
	  выполнением команд пользователем <code class="systemitem">www</code>.  С настройками по
	  умолчанию в <code class="filename">audit_control</code> запись
	  <code class="literal">lo</code> для <code class="systemitem">root</code> является избыточной,
	  кроме того, события входа в систему и выхода из системы
	  будут подвергаться аудиту и для пользователя <code class="systemitem">www</code>.</p><pre class="programlisting">root:lo,+ex:no
www:fc,+ex:no</pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="audit-inline-glossary.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="audit.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="audit-administration.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">16.2. Ключевые понятия </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 16.4. Работа с журналами аудита</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>