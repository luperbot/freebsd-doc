<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>5.8. Зависимости</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD по созданию портов" /><link rel="up" href="makefiles.html" title="Глава 5. Настройка файла Makefile" /><link rel="prev" href="makefile-portscout.html" title="5.7. PORTSCOUT" /><link rel="next" href="makefile-masterdir.html" title="5.9. MASTERDIR" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.8. Зависимости</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="makefile-portscout.html">Пред.</a> </td><th width="60%" align="center">Глава 5. Настройка файла Makefile</th><td width="20%" align="right"> <a accesskey="n" href="makefile-masterdir.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="makefile-depend"></a>5.8. Зависимости</h2></div></div></div><p>Многие порты зависят от других портов.  Это очень удобная
      замечательная особенность большинства Unix-подобных
      операционных систем, включая FreeBSD.  Множество портов могут
      использовать общую зависимость совместно, а не включать её в
      состав каждого порта или пакета, который в ней нуждается.
      Имеется семь переменных, которые вы можете использовать для
      обеспечения того, что всё требуемое находится на машине
      пользователя.  Имеется также несколько предопределённых
      переменных, отражающих зависимости для общих случаев, плюс ещё
      несколько для управления поведением зависимостей.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76404176"></a>5.8.1. <code class="varname">LIB_DEPENDS</code></h3></div></div></div><p>Эта переменная указывает, от каких совместно используемых
	библиотек зависит порт.  Это список пар
	<em class="replaceable"><code>lib</code></em>:<em class="replaceable"><code>dir</code></em>,
	где <em class="replaceable"><code>lib</code></em> - это имя библиотеки,
	<em class="replaceable"><code>dir</code></em> - это каталог, в котором можно
	ее найти в случае, если ее нет на машине.  Например,</p><pre class="programlisting">LIB_DEPENDS=	libjpeg.so:${PORTSDIR}/graphics/jpeg</pre><p>проверит наличие библиотеки jpeg с любым номером версии и
	перейдет в подкаталог <code class="filename">graphics/jpeg</code>
	вашего дерева портов для ее построения и установки, если
	библиотека отсутствует.</p><p>Зависимость проверяется дважды, один раз внутри цели
	<code class="buildtarget">build</code>, а затем из цели
	<code class="buildtarget">install</code>.  Кроме того, имя
	зависимости помещается в пакет, так что
	<code class="command">pkg install</code> (см. <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pkg-install&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pkg-install</span>(8)</span></a>)
	будет автоматически её устанавливать, если её нет на
	пользовательской системе.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76414672"></a>5.8.2. <code class="varname">RUN_DEPENDS</code></h3></div></div></div><p>В этой переменной перечисляются выполнимые файлы или
	файлы, от которых зависит работа порта.  Это список пар вида
	<em class="replaceable"><code>path</code></em>:<em class="replaceable"><code>dir</code></em>[<span class="optional">:target</span>],
	где <em class="replaceable"><code>path</code></em> - это имя программы или
	файла, а <em class="replaceable"><code>dir</code></em> - каталог, в котором
	можно найти порт в случае, если его нет в системе, и
	<em class="replaceable"><code>target</code></em> - это цель, которую нужно
	вызвать в этом каталоге.  Если
	<em class="replaceable"><code>path</code></em> начинается со слэша
	(<code class="literal">/</code>), он воспринимается как файл и его
	существование проверяется командой
	<code class="command">test -e</code>; в противном случае
	предполагается, что это выполнимый файл, и для определения
	того, имеется ли программа в пути поиска, используется
	команда <code class="command">which -s</code>.</p><p>Например,</p><pre class="programlisting">RUN_DEPENDS=	${LOCALBASE}/news/bin/innd:${PORTSDIR}/news/inn \
		xmlcatmgr:${PORTSDIR}/textproc/xmlcatmgr</pre><p>проверит существование файла или каталога
	<code class="filename">/usr/local/news/bin/innd</code>, и если ничего
	не будет найдено, то построит и установит порт из подкаталога
	<code class="filename">news/inn</code> дерева портов.  Также будет
	выполнена проверка, присутствует ли в пути поиска исполняемый
	файл с именем <code class="command">xmlcatmgr</code>, и перейдет в
	подкаталог <code class="filename">textproc/xmlcatmgr</code> вашего
	дерева портов для его построения и установки, если он не
	будет найден.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">В приведенном примере <code class="command">innd</code> является
	  выполнимым файлом; если выполнимый файл находится в месте,
	  которое отсутствует в списке путей файлов, то вы должны
	  указать полный путь к файлу.</p></div><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Официальным значением переменной поиска
	  <code class="envar">PATH</code>, используемым в кластере построения
	  портов является</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin</pre></div><p>Зависимость проверяется внутри цели
	<code class="buildtarget">install</code>.  Кроме того, имя
	зависимости помещается в пакет, так что
	<code class="command">pkg install</code> (см. <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pkg-install&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pkg-install</span>(8)</span></a>)
	будет автоматически его устанавливать, если он не будет
	найден в пользовательской системе.  Часть
	<em class="replaceable"><code>target</code></em> может быть опущена, если
	она совпадает с <code class="varname">DEPENDS_TARGET</code>.</p><p>Довольно распространенной является ситуация, когда
	<code class="varname">RUN_DEPENDS</code> буквально такая же как
	<code class="varname">BUILD_DEPENDS</code>, особенно если переносимое
	программное обеспечение написано на языке сценариев, или если
	оно требует такое же окружение для исполнения, как и
	используемое во время построения.  В этом случае, очень
	заманчивым или довольно естественным является присвоение
	одного другому:</p><pre class="programlisting">RUN_DEPENDS=	${BUILD_DEPENDS}</pre><p>Тем не менее, подобные присвоения могут загрязнять
	зависимости времени исполнения содержимым, не заданным в
	<code class="varname">BUILD_DEPENDS</code> исходного порта.  Такое
	случается из-за ленивого вычисления в <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>
	присваиваемых переменных.  Представьте
	<code class="filename">Makefile</code> с переменными
	<code class="varname">USE_<em class="replaceable"><code>*</code></em></code>, которые
	обрабатываются в <code class="filename">ports/Mk/bsd.*.mk</code> для
	пополнения первоначальных зависимостей построения.  Например,
	<code class="literal">USES= gmake</code> добавляет <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/devel/gmake/pkg-descr">devel/gmake</a> в
	<code class="varname">BUILD_DEPENDS</code>.  Для предотвращения
	загрязнения <code class="varname">RUN_DEPENDS</code> подобными
	дополнительными зависимостями проявляйте осторожность с
	присвоением с раскрытием, т.е. с раскрытием значения перед
	его присвоением переменной:</p><pre class="programlisting">RUN_DEPENDS:=	${BUILD_DEPENDS}</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76434768"></a>5.8.3. <code class="varname">BUILD_DEPENDS</code></h3></div></div></div><p>В этой переменной перечисляются выполнимые или обычные
	файлы, которые требуются порту для его построения.  Как и
	<code class="varname">RUN_DEPENDS</code>, это список пар
	<em class="replaceable"><code>path</code></em>:<em class="replaceable"><code>dir</code></em>[<span class="optional">:target</span>].
	Например,</p><pre class="programlisting">BUILD_DEPENDS=	unzip:${PORTSDIR}/archivers/unzip</pre><p>будет проверять наличие выполнимого фала с именем
	<code class="command">unzip</code> и перейдет в подкаталог
	<code class="filename">archivers/unzip</code> вашего дерева портов для
	его построения и установки, если последний не будет
	найден.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Под <span class="quote"><<<span class="quote">построением</span>>></span> здесь понимается всё, от
	  распаковки до компиляции.  Зависимость проверяется из цели
	  <code class="buildtarget">extract</code>.  Часть
	  <em class="replaceable"><code>target</code></em> может быть опущена, если
	  она совпадает с <code class="varname">DEPENDS_TARGET</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76445520"></a>5.8.4. <code class="varname">FETCH_DEPENDS</code></h3></div></div></div><p>В этой переменной перечисляются выполняемые файлы или
	просто файлы, которые требуются порту для сгрузки.  Как и
	предыдущие две переменные, это список пар
	<em class="replaceable"><code>path</code></em>:<em class="replaceable"><code>dir</code></em>[<span class="optional">:target</span>].
	Например,</p><pre class="programlisting">FETCH_DEPENDS=	ncftp2:${PORTSDIR}/net/ncftp2</pre><p>будет проверять наличие выполняемого файла с именем
	<code class="command">ncftp2</code> и перейдет в каталог
	<code class="filename">net/ncftp2</code> вашего дерева портов для его
	построения и установки, если тот не будет найден.</p><p>Зависимость проверяется при выполнении цели
	<code class="buildtarget">fetch</code>.  Часть
	<em class="replaceable"><code>target</code></em> может быть опущена, если
	она совпадает с <code class="varname">DEPENDS_TARGET</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76459216"></a>5.8.5. <code class="varname">EXTRACT_DEPENDS</code></h3></div></div></div><p>В этой переменной указываются программы или файлы,
	которые требуются для распаковки порта.  Как и в предыдущих
	случаях, это список пар вида
	<em class="replaceable"><code>path</code></em>:<em class="replaceable"><code>dir</code></em>[<span class="optional">:target</span>].
	Например,</p><pre class="programlisting">EXTRACT_DEPENDS=	unzip:${PORTSDIR}/archivers/unzip</pre><p>будет проверять наличие программы с именем
	<code class="command">unzip</code>, и перейдёт в подкаталог
	<code class="filename">archivers/unzip</code> вашего дерева портов для
	её построения и установки, если такой программы не будет
	найдено.</p><p>Зависимость проверяется внутри цели
	<code class="buildtarget">extract</code>.  Часть
	<em class="replaceable"><code>target</code></em> может быть опущена, если
	она совпадает с <code class="varname">DEPENDS_TARGET</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Используйте эту переменную, только если распаковка не
	  работает (по умолчанию предполагается использование
	  <code class="command">gzip</code>) и это не исправляется при помощи
	  <code class="varname">USE_ZIP</code> или
	  <code class="varname">USE_BZIP2</code>, которые описаны в <a class="xref" href="makefile-depend.html#use-vars" title="5.8.8. USE_*">Раздел 5.8.8, <<<code class="varname">USE_<em class="replaceable"><code>*</code></em></code>>></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76467024"></a>5.8.6. <code class="varname">PATCH_DEPENDS</code></h3></div></div></div><p>Эта переменная указывает на программы или файлы, которые
	нужны порту для применения патчей.  Как и в предыдущих
	случаях, это список пар вида
	<em class="replaceable"><code>path</code></em>:<em class="replaceable"><code>dir</code></em>[<span class="optional">:target</span>].
	Например,</p><pre class="programlisting">PATCH_DEPENDS=	${NONEXISTENT}:${PORTSDIR}/java/jfc:extract</pre><p>будет переходить в подкаталог
	<code class="filename">java/jfc</code> вашего дерева портов для
	распаковки.</p><p>Зависимость проверяется внутри цели
	<code class="buildtarget">patch</code>.  Часть
	<em class="replaceable"><code>target</code></em> может быть опущена, если
	она совпадает с <code class="varname">DEPENDS_TARGET</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="uses"></a>5.8.7. <code class="varname">USES</code></h3></div></div></div><p>Могут быть добавлены параметры для определения различных
	характерных особенностей и зависимостей, которыми обладает
	данный порт.  Они указываются путём добавления в
	<code class="filename">Makefile</code> этой строки:</p><pre class="programlisting">USES= feature[:arguments]</pre><p>Для получения полного списка значений смотрите
	<a class="xref" href="appendices.html#uses-values" title="15.1. Значения USES">Раздел 15.1, <<Значения <code class="varname">USES</code>>></a>.</p><div xmlns="" class="warning"><h3 class="admontitle">Предупреждение: </h3><p xmlns="http://www.w3.org/1999/xhtml">Значение <code class="varname">USES</code> нельзя присваивать
	  после подключения
	  <code class="filename">bsd.port.pre.mk</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="use-vars"></a>5.8.8. <code class="varname">USE_<em class="replaceable"><code>*</code></em></code></h3></div></div></div><p>Для определения общих зависимостей, совместно
	используемых многими портами, предназначено несколько
	переменных.  Их использование является необязательным, но
	помогает упростить избыточность файлов
	<code class="filename">Makefile</code> порта.  Каждый из них
	оформляется как
	<code class="varname">USE_<em class="replaceable"><code>*</code></em></code>.  Эти
	переменные можно использовать только в
	<code class="filename">Makefile</code> порта и
	<code class="filename">ports/Mk/bsd.*.mk</code>.  Они не предназначены
	для установки пользователями параметров - используйте
	для этих целей <code class="varname">PORT_OPTIONS</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Установка любых
	  <code class="varname">USE_<em class="replaceable"><code>*</code></em></code> в
	  <code class="filename">/etc/make.conf</code>
	  <span class="emphasis"><em>всегда</em></span> является ошибочным действием.
	  В частности, установка</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">USE_GCC=X.Y</pre><p xmlns="http://www.w3.org/1999/xhtml">(где X.Y соответствует версии) добавит зависимость от
	  gccXY к каждому порту, включая и сам
	  <code class="literal">lang/gccXY</code>!</p></div><div class="table"><a id="idp76487888"></a><div class="table-title">Таблица 5.2. Переменные
	  <code class="varname">USE_<em class="replaceable"><code>*</code></em></code></div><div class="table-contents"><table summary="Переменные&#10;&#9;  USE_*" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Переменная</th><th>Значение</th></tr></thead><tbody><tr><td><code class="varname">USE_BZIP2</code></td><td>tar-архивы порта упакованы при помощи
		<code class="command">bzip2</code>.</td></tr><tr><td><code class="varname">USE_ZIP</code></td><td>tar-архивы порта упакованы при помощи
		<code class="command">zip</code>.</td></tr><tr><td><code class="varname">USE_GCC</code></td><td>Для сборки порта требуется GCC
		(<code class="command">gcc</code> или <code class="command">g++</code>).
		Некоторым портам подходит любая версия, для других
		требуются последние современные версии.  Обычно
		используется со значением <code class="literal">any</code> (в
		этом случае используется встроенный GCC в тех версиях
		FreeBSD, в состав которых он всё ещё входит, или
		устанавливается порт <code class="literal">lang/gcc</code>,
		когда Clang является компилятором C/C++ по умолчанию)
		или <code class="literal">yes</code> (всегда используется
		стабильная современная версия GCC из порта
		<code class="literal">lang/gcc</code>).  Также в значении
		переменной можно указать точную версию, например
		<code class="literal">4.7</code>.  Минимально допустимую версию
		можно указать как <code class="literal">4.6+</code>.
		GCC из основной системы используется в случае, если
		его версия удовлетворяет запрошенной, иначе
		собирается подходящая версии компилятора из порта с
		соответствующей коррекцией переменных
		<code class="varname">CC</code> и
		<code class="varname">CXX</code>.</td></tr></tbody></table></div></div><br class="table-break" /><p>Переменные, относящиеся к
	<span class="application">gmake</span> и сценарию
	<code class="filename">configure</code>, описаны в <a class="xref" href="building.html" title="6.4. Механизмы построения">Раздел 6.4, <<Механизмы построения>></a>, а
	<span class="application">autoconf</span>,
	<span class="application">automake</span> и
	<span class="application">libtool</span> описаны в <a class="xref" href="using-autotools.html" title="6.5. Использование GNU Autotools">Раздел 6.5, <<Использование GNU Autotools>></a>.  Переменные, связанные с
	<span class="application">Perl</span>, описаны в <a class="xref" href="using-perl.html" title="6.7. Использование Perl">Раздел 6.7, <<Использование <span class="application">Perl</span>>></a>.  Переменные X11 перечислены в <a class="xref" href="using-x11.html" title="6.8. Использование X11">Раздел 6.8, <<Использование X11>></a>.  <a class="xref" href="using-gnome.html" title="6.9. Использование GNOME">Раздел 6.9, <<Использование GNOME>></a>
	работает с переменными GNOME и <a class="xref" href="using-kde.html" title="6.11. Использование KDE">Раздел 6.11, <<Использование KDE>></a> с
	KDE.  <a class="xref" href="using-java.html" title="6.12. Использование Java">Раздел 6.12, <<Использование Java>></a> описывает переменные Java,
	а <a class="xref" href="using-php.html" title="6.13. Веб-приложения, Apache и PHP">Раздел 6.13, <<Веб-приложения, Apache и PHP>></a> содержит информацию об
	<span class="application">Apache</span>,
	<span class="application">PHP</span> и модулях PEAR.
	<span class="application">Python</span> обсуждается в <a class="xref" href="using-python.html" title="6.14. Использование Python">Раздел 6.14, <<Использование Python>></a>, а <span class="application">Ruby</span>
	в <a class="xref" href="using-ruby.html" title="6.17. Использование Ruby">Раздел 6.17, <<Использование Ruby>></a>.  <a class="xref" href="using-sdl.html" title="6.18. Использование SDL">Раздел 6.18, <<Использование SDL>></a>
	предоставляет переменные, используемые для приложений
	<span class="application">SDL</span>, и, наконец, <a class="xref" href="using-xfce.html" title="6.22. Использование Xfce">Раздел 6.22, <<Использование Xfce>></a> содержит информацию о приложении
	<span class="application">Xfce</span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76530768"></a>5.8.9. Минимальная версия зависимости</h3></div></div></div><p>Минимальная версия зависимости может быть указана в любой
	переменной <code class="varname">*_DEPENDS</code>, за исключением
	<code class="varname">LIB_DEPENDS</code>, с использованием следующего
	синтаксиса:</p><pre class="programlisting">p5-Spiffy&gt;=0.26:${PORTSDIR}/devel/p5-Spiffy</pre><p>Первое поле содержит название зависимого пакета, которое
	обязано совпадать с записью в базе данные пакетов, знак
	сравнения и версию пакета.  Зависимость удовлетворяется, если
	на машине установлен p5-Spiffy-0.26 или новее.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76533456"></a>5.8.10. Замечания касательно зависимостей</h3></div></div></div><p>Как уже отмечено выше, целью, которая вызывается по
	умолчанию в случае, когда это требует зависимость, является
	<code class="buildtarget">DEPENDS_TARGET</code>.  Она по умолчанию
	есть <code class="literal">install</code>.  Это пользовательская
	переменная; она нигде не определена в файле
	<code class="filename">Makefile</code> порта.  Если вашему порту
	требуется особый метод обработки зависимости, воспользуйтесь
	частью <code class="literal">:target</code> переменной
	<code class="varname">*_DEPENDS</code> вместо того, чтобы
	переопределять <code class="varname">DEPENDS_TARGET</code>.</p><p>Когда вы набираете команду <code class="command">make clean</code>,
	эта операция также выполняется и над зависимостями этого
	порта.  Если вы не хотите, чтобы это случилось, определите
	переменную <code class="varname">NOCLEANDEPENDS</code> в вашем
	окружении.  Это может быть особенно нужным, если порт имеет
	нечто, что занимает много времени на построение, в своём
	списке зависимостей, например, KDE, GNOME или Mozilla.</p><p>Чтобы безусловно зависеть от другого порта, укажите
	переменную <code class="varname">${NONEXISTENT}</code> в качестве
	первого поля переменной <code class="varname">BUILD_DEPENDS</code> или
	<code class="varname">RUN_DEPENDS</code>.  Пользуйтесь этим, только
	когда вам нужно иметь исходный код другого порта.  Вы можете
	сэкономить время на компиляции, указав также и цель.
	Например,</p><pre class="programlisting">BUILD_DEPENDS=	${NONEXISTENT}:${PORTSDIR}/graphics/jpeg:extract</pre><p>всегда будет переходить в каталог с портом
	<code class="literal">jpeg</code> и распаковывать его.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76541008"></a>5.8.11. Зацикленные зависимости фатальны</h3></div></div></div><div xmlns="" class="important"><h3 class="admontitle">Важно: </h3><p xmlns="http://www.w3.org/1999/xhtml">Не помещайте зацикливающиеся зависимости в дерево
	  портов!</p></div><p>Технология построения портов не защищена от зацикленных
	зависимостей.  Если вы создадите такую, то у кого-нибудь и
	где-нибудь установка FreeBSD будет немедленно сломана, а у
	остальных сломается несколько позже.  Это на самом деле очень
	трудно распознать; если вы сомневаетесь, то перед внесением
	изменений проверьте, что выполнили следующее:
	<code class="command">cd /usr/ports; make index</code>.  Этот процесс
	может быть достаточно медленным на старых машинах, хотя вы
	сможете спасти большое количество людей-включая
	себя-от грядущих бед.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76543312"></a>5.8.12. Автоматические зависимости и проблемы, которые они
	вызывают</h3></div></div></div><p>Зависимости должны быть указаны либо явно, либо с
	использованием <a class="link" href="makefile-options.html" title="5.12. Опции для Makefile">фреймворка
	  OPTIONS</a>.  Использование прочих методов, таких как
	автоматическое обнаружение зависимостей, усложняет
	индексирование, что вызывает проблемы в управлении портами и
	пакетами.</p><div class="example"><a id="idp76545104"></a><div class="example-title">Пример 5.8. Некорректное объявление необязательной
	  зависимости</div><div class="example-contents"><pre class="programlisting">.include &lt;bsd.port.pre.mk&gt;

.if exists(${LOCALBASE}/bin/foo)
LIB_DEPENDS=	libbar.so:${PORTSDIR}/foo/bar
.endif</pre></div></div><br class="example-break" /><p>Проблема автоматического добавления зависимостей
	заключается в том, что файлы и настройки за пределами порта
	могут произвольно меняться.  Пример: после построения индекса
	устанавливается набор портов.  При этом один из них
	устанавливает проверяемый файл.  На этом этапе индекс будет
	неправильным, потому что установленный порт неожиданно
	получит новую зависимость.  Индекс может быть по прежнему
	неправильным даже после его перестроения, в случае если
	другие порты также определят дополнительные зависимости,
	основываясь на существовании других файлов.</p><div class="example"><a id="idp76546768"></a><div class="example-title">Пример 5.9. Корректное объявление необязательной
	  зависимости</div><div class="example-contents"><pre class="programlisting">OPTIONS_DEFINE=	BAR
BAR_DESC=	Bar support

.include &lt;bsd.port.options.mk&gt;

.if ${PORT_OPTIONS:MBAR}
LIB_DEPENDS=	libbar.so:${PORTSDIR}/foo/bar
.endif</pre></div></div><br class="example-break" /><p>Правильным способом является проверка переменных
	параметров.  Этот способ не приводит к несоответствиям в
	индексе набора портов, поскольку параметры определены до
	построения индекса.  При этом можно использовать простые
	скрипты для автоматизации построения, установки и обновления
	этих портов и соответствующих им пакетов.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="use-want"></a>5.8.13. <code class="varname">USE_</code> и
	<code class="varname">WANT_</code></h3></div></div></div><p>Переменные <code class="varname">USE_</code> задаются мейнтейнером
	порта для определения программного обеспечения, от которого
	этот порт зависит.  Порт, для которого нужен Firefox,
	укажет</p><pre class="programlisting">USE_FIREFOX=	yes</pre><p>Некоторые переменные <code class="varname">USE_</code> могут
	принимать номера версий или другие параметры.  Например,
	порт, который требует Apache 2.2, укажет</p><pre class="programlisting">USE_APACHE=	22</pre><p>В некоторых случаях для большего контроля над
	зависимостями используются переменные
	<code class="varname">WANT_</code>, которые позволяют указывать
	требования в более точной форме.  Например, взгляните на порт
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/mail/squirrelmail/pkg-descr">mail/squirrelmail</a>.  Этому
	порту нужны несколько модулей PHP, которые перечислены в
	переменной <code class="varname">USE_PHP</code>:</p><pre class="programlisting">USE_PHP=	session mhash gettext mbstring pcre openssl xml</pre><p>Эти модули доступны в версиях CLI и web, поэтому версия
	web выбрана с переменной <code class="varname">WANT_</code>:</p><pre class="programlisting">WANT_PHP_WEB=	yes</pre><p>Имеющиеся переменные <code class="varname">USE_</code> и
	<code class="varname">WANT_</code> определены в файлах в
	<code class="filename">/usr/ports/Mk</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="makefile-portscout.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="makefiles.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="makefile-masterdir.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">5.7. <code class="varname">PORTSCOUT</code> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 5.9. <code class="varname">MASTERDIR</code></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>