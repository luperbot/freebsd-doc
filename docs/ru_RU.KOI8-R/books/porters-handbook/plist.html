<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>Глава 7. Продвинутые практики pkg-plist</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD по созданию портов" /><link rel="up" href="index.html" title="Руководство FreeBSD по созданию портов" /><link rel="prev" href="requiring-kernel-sources.html" title="6.27. Порты, требующие наличия исходных текстов ядра" /><link rel="next" href="plist-cleaning.html" title="7.2. Пустые каталоги" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Глава 7. Продвинутые практики <code class="filename">pkg-plist</code></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="requiring-kernel-sources.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="plist-cleaning.html">След.</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist"></a>Глава 7. Продвинутые практики <code class="filename">pkg-plist</code></h1></div></div></div><div class="toc"><div class="toc-title">Содержание</div><dl class="toc"><dt><span class="sect1"><a href="plist.html#plist-sub">7.1. Изменение содержимого <code class="filename">pkg-plist</code> в
      зависимости от make-переменных</a></span></dt><dt><span class="sect1"><a href="plist-cleaning.html">7.2. Пустые каталоги</a></span></dt><dt><span class="sect1"><a href="plist-config.html">7.3. Конфигурационные файлы</a></span></dt><dt><span class="sect1"><a href="plist-dynamic.html">7.4. Динамический или статический список упаковки</a></span></dt><dt><span class="sect1"><a href="plist-autoplist.html">7.5. Автоматическое создание списка упаковки</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="plist-sub"></a>7.1. Изменение содержимого <code class="filename">pkg-plist</code> в
      зависимости от make-переменных</h2></div></div></div><p>Некоторые порты, в частности, порты <code class="literal">p5-</code>,
      должны менять содержимое своих файлов
      <code class="filename">pkg-plist</code> в зависимости от того, с какими
      параметрами они были отконфигурированы (или в зависимости от
      версии языка <code class="literal">perl</code> в случае портов
      <code class="literal">p5-</code>).  Чтобы облегчить этот процесс, любые
      вхождения ключевых слов <code class="literal">%%OSREL%%</code>,
      <code class="literal">%%PERL_VER%%</code> и
      <code class="literal">%%PERL_VERSION%%</code> в файле
      <code class="filename">pkg-plist</code> будут заменяться
      соответствующими значениями.  Значением
      <code class="literal">%%OSREL%%</code> является номер версии операционной
      системы (например, <code class="literal">4.9</code>).
      <code class="literal">%%PERL_VERSION%%</code> и
      <code class="literal">%%PERL_VER%%</code> обозначают полный номер версии
      <code class="command">perl</code> (например, <code class="literal">5.8.9</code>).
      Некоторые другие <code class="literal">%%VARS%%</code>, имеющие отношение
      к файлам документации порта, описаны в <a class="link" href="install.html#install-documentation" title="5.15.4. Установка дополнительной документации">соответствующем
	разделе</a>.</p><p>Если вам нужно сделать другие подстановки, вы можете
      указать в переменной <code class="varname">PLIST_SUB</code> список пар
      <code class="literal">VAR=VALUE</code>, и все вхождения
      <code class="literal">%%VAR%%</code> в файле
      <code class="filename">pkg-plist</code> будут заменяться на значение
      <em class="replaceable"><code>VALUE</code></em>.</p><p>Например, если у вас имеется порт, который устанавливает
      много файлов в каталог, зависящий от версии, вы можете задать
      нечто типа</p><pre class="programlisting">OCTAVE_VERSION=	2.0.13
PLIST_SUB=	OCTAVE_VERSION=${OCTAVE_VERSION}</pre><p>в файле <code class="filename">Makefile</code> и использовать
      <code class="literal">%%OCTAVE_VERSION%%</code> везде, где нужно указать
      номер версии в файле <code class="filename">pkg-plist</code>.  Таким
      образом, при обновлении порта вам не нужно будет менять десятки
      (а в некоторых случаях и сотни) строк в файле
      <code class="filename">pkg-plist</code>.</p><p>Если ваш порт устанавливает файлы в соответствии с
      установленными в порту опциями, то обычным способом управления
      является добавление префиксов <code class="literal">%%TAG%%</code> для
      строк <code class="filename">pkg-plist</code> с добавлением этого
      <code class="literal">TAG</code> в переменную
      <code class="varname">PLIST_SUB</code> внутри
      <code class="filename">Makefile</code> со специальным значением
      <code class="literal">@comment</code>, которое указывает пакетным
      инструментам игнорировать эти строки:</p><pre class="programlisting">.if defined(WITH_X11)
PLIST_SUB+=	X11=""
.else
PLIST_SUB+=	X11="@comment "
.endif</pre><p>и в самом <code class="filename">pkg-plist</code>:</p><pre class="programlisting">%%X11%%bin/foo-gui</pre><p>Эта подстановка будет сделана между выполнением целей
      <code class="buildtarget">pre-install</code> и
      <code class="buildtarget">do-install</code>, посредством чтения файла
      <code class="filename">PLIST</code> и записью в файл
      <code class="filename">TMPPLIST</code> (по умолчанию это файл
      <code class="filename">WRKDIR/.PLIST.mktmp</code>).  Так что если ваш
      порт строит <code class="filename">PLIST</code> на лету, делайте это во
      время или до выполнения цели
      <code class="buildtarget">pre-install</code>.  Кроме того, если
      вашему порту требуется отредактировать получающийся файл,
      делайте это в цели <code class="buildtarget">post-install</code>
      изменением файла <code class="filename">TMPPLIST</code>.</p><p>Другой способ изменения списка сборки порта основан на
      определении значений переменных <code class="varname">PLIST_FILES</code>,
      <code class="varname">PLIST_DIRS</code> и
      <code class="varname">PLIST_DIRSTRY</code>.  Каждое из них
      рассматривается как перечень путей для записи в
      <code class="filename">TMPPLIST</code> содержимого
      <code class="filename">PLIST</code>.  Имена, перечисленные в
      <code class="varname">PLIST_FILES</code>, <code class="varname">PLIST_DIRS</code> и
      <code class="varname">PLIST_DIRSTRY</code> подвергаются подстановке
      <code class="literal">%%VAR%%</code>, как описано выше.  За исключением
      этого, имена из <code class="varname">PLIST_FILES</code> будут появляться
      в окончательном варианте перечня сборки без изменений, тогда
      как <code class="literal">@dirrm</code> и <code class="literal">@dirrmtry</code>
      будут соответственно предшествовать именам из
      <code class="varname">PLIST_DIRS</code> и
      <code class="varname">PLIST_DIRSTRY</code>.  Для того чтобы изменения
      вступили в силу, <code class="varname">PLIST_FILES</code>,
      <code class="varname">PLIST_DIRS</code> и
      <code class="varname">PLIST_DIRSTRY</code> должны задаваться до того, как
      будет записываться <code class="filename">TMPPLIST</code>, то есть в
      цели <code class="buildtarget">pre-install</code> или ещё
      раньше.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="requiring-kernel-sources.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="plist-cleaning.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">6.27. Порты, требующие наличия исходных текстов ядра </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 7.2. Пустые каталоги</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>