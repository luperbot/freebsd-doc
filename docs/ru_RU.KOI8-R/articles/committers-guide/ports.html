<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>12. FAQ по работе с портами</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Справочник коммиттера" /><link rel="up" href="index.html" title="Справочник коммиттера" /><link rel="prev" href="archs.html" title="11. Поддержка различных архитектур" /><link rel="next" href="perks.html" title="13. Пряники и прочие льготы" /><link rel="copyright" href="trademarks.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">12. FAQ по работе с портами</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="archs.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="perks.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ports"></a>12. FAQ по работе с портами</h2></div></div></div><div class="qandaset"><a id="idp75978064"></a><dl><dt>12.1.  <a href="ports.html#idp75978320">Добавление нового порта</a></dt><dd><dl><dt>12.1.1. <a href="ports.html#idp75978960">Как добавить новый порт?</a></dt><dt>12.1.2. <a href="ports.html#idp75984336">Что еще следует сделать, добавляя новый порт?</a></dt></dl></dd><dt>12.2.  <a href="ports.html#idp76026960">Удаление порта</a></dt><dd><dl><dt>12.2.1. <a href="ports.html#idp76027600">Как удалить существующий порт?</a></dt></dl></dd><dt>12.3.  <a href="ports.html#idp76054608">Репозиторное копирование</a></dt><dd><dl><dt>12.3.1. <a href="ports.html#idp76055248">Когда требуется репозиторное копирование?</a></dt><dt>12.3.2. <a href="ports.html#idp76058704">Когда репозиторное копирование не
	      требуется?</a></dt><dt>12.3.3. <a href="ports.html#idp76061904">Что нужно делать?</a></dt></dl></dd><dt>12.4.  <a href="ports.html#idp76126672">Заморозка портов</a></dt><dd><dl><dt>12.4.1. <a href="ports.html#idp76127312">Что такое <<заморозка портов>>?</a></dt><dt>12.4.2. <a href="ports.html#idp76130896">Сколько длится заморозка?</a></dt><dt>12.4.3. <a href="ports.html#idp76132944">Что это значит для меня?</a></dt><dt>12.4.4. <a href="ports.html#idp76136912">Откуда я узнаю о начале периода заморозки?</a></dt><dt>12.4.5. <a href="ports.html#idp76139728">Как узнать, когда период заморозки портов закончился?</a></dt></dl></dd><dt>12.5.  <a href="ports.html#idp76175184">Создание новой категории</a></dt><dd><dl><dt>12.5.1. <a href="ports.html#idp76175824">Какова процедура создания новой категории портов?</a></dt><dt>12.5.2. <a href="ports.html#idp76195920">Как устроен процесс?</a></dt></dl></dd><dt>12.6.  <a href="ports.html#idp76263888">Прочие вопросы</a></dt><dd><dl><dt>12.6.1. <a href="ports.html#idp76264528">Как мне проверить, что мой порт корректно собирается?</a></dt><dt>12.6.2. <a href="ports.html#idp76275152">Я добавил новый порт.  Нужно ли добавлять его в файл
	      INDEX?</a></dt><dt>12.6.3. <a href="ports.html#idp76278608">Какие еще файлы я не должен трогать?</a></dt><dt>12.6.4. <a href="ports.html#idp76286288">Каков корректный порядок обновления порта, когда его
	      исходный архив поменялся, но не сменил имя?</a></dt></dl></dd></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h4 class="title"><a id="idp75978320"></a>12.1. Добавление нового порта</h4></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>12.1.1. <a href="ports.html#idp75978960">Как добавить новый порт?</a></dt><dt>12.1.2. <a href="ports.html#idp75984336">Что еще следует сделать, добавляя новый порт?</a></dt></dl></td></tr><tr class="question"><td align="left" valign="top"><a id="idp75978960"></a><a id="idp75979216"></a><p><strong>12.1.1.</strong></p></td><td align="left" valign="top"><p>Как добавить новый порт?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Для начала прочитайте раздел, посвященный репозиторному
	      копированию.</p><p>Самым простым будет использовать скрипт
	      <code class="command">addport</code> на машине
	      <code class="systemitem">freefall</code>.  Он добавит порт из указанного вами
	      каталоге, определив нужную категорию из файла
	      <code class="filename">Makefile</code>, добавит строку в файл
	      <code class="filename">CVSROOT/modules</code> и в файл
	      <code class="filename">Makefile</code> для нужной категории.
	      Скрипт был написан Michael Haro <code class="email">&lt;<a xmlns="" class="email" href="mailto:mharo@FreeBSD.org">mharo@FreeBSD.org</a>&gt;</code> и Will Andrews <code class="email">&lt;<a xmlns="" class="email" href="mailto:will@FreeBSD.org">will@FreeBSD.org</a>&gt;</code>; вопросы и исправления
	      по поводу <code class="command">addport</code> следует отправлять Уиллу,
	      как текущему мейнтейнеру.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp75984336"></a><a id="idp75984592"></a><p><strong>12.1.2.</strong></p></td><td align="left" valign="top"><p>Что еще следует сделать, добавляя новый порт?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Проверьте его.  Желательно убедиться в том, что порт и
	      соответствующий пакет корректно собираются.  Рекомендуемая
	      последовательность действий такова:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make package</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make deinstall</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pkg_add <em class="replaceable"><code>имя собранного пакета</code></em></code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make deinstall</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make reinstall</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make package</code></strong>
	    </pre><p>Более подробные инструкции можно найти в
	      <a class="link" href="../../../../doc/ru_RU.KOI8-R/books/porters-handbook/index.html" target="_top">Руководстве
	      FreeBSD по созданию портов</a>.</p><p>Пользуйтесь <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=portlint&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">portlint</span>(1)</span></a> для проверки корректности порта.
	      Не обязательно добиваться полного отсутствия предупреждений,
	      но по крайней мере исправьте простейшие из них.</p><p>Если новый порт прислал человек, еще не упомянутый в
	      <a class="link" href="../../../../doc/en_US.ISO8859-1/articles/contributors/contrib-additional.html" target="_top">Списке
	      прочих участников</a>, добавьте его имя туда.</p><p>Закройте PR, если новый порт пришел в виде PR.  Для этого
	      воспользуйтесь командой
	      <strong class="userinput"><code>edit-pr <em class="replaceable"><code>PR#</code></em></code></strong>
	      на машине <code class="systemitem">freefall</code> и измените значение в строке
	      <code class="varname">state</code> с <code class="constant">open</code> на
	      <code class="constant">closed</code>.  Затем опишите причину смены
	      статуса, и на этом работа закончена.</p></td></tr><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h4 class="title"><a id="idp76026960"></a>12.2. Удаление порта</h4></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>12.2.1. <a href="ports.html#idp76027600">Как удалить существующий порт?</a></dt></dl></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76027600"></a><a id="idp76027856"></a><p><strong>12.2.1.</strong></p></td><td align="left" valign="top"><p>Как удалить существующий порт?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Для начала прочтите раздел о репозиторном копировании.
	      Прежде чем удалить порт, вы должны проверить, что удаление не
	      затронет другие порты коллекции.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Убедитесь, что другие порты не зависят от удаляемого:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Имя пакета (PKGNAME) должно встречаться в свежем
			файле INDEX ровно один раз.</p></li><li class="listitem"><p>В файлах Makefile* других портов не должно
			встречаться ни одной ссылки на каталог удаляемого
			порта или имя его пакета (PKGNAME).</p></li></ul></div></li><li class="listitem"><p>Удалите порт:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Удалите файлы порта командой
		      <code class="command">cvs remove</code>.</p></li><li class="step"><p>Удалите строку <code class="varname">SUBDIR</code> для
		      удаляемого порта из файла <code class="filename">Makefile</code>
		      категории.</p></li><li class="step"><p>Удалите запись для порта из файла модулей
		      <code class="filename">CVSROOT/modules</code>.</p></li><li class="step"><p>Добавьте соответствующую строку в файл
		      <code class="filename">ports/MOVED</code>.</p></li><li class="step"><p>Если порт упоминается в файле
		      <code class="filename">ports/LEGAL</code>, удалите его оттуда.
		    </p></li></ol></div></li></ul></div><p>Вы можете воспользоваться скриптом <code class="command">rmport</code>
	      из каталога <code class="filename">ports/Tools/scripts</code>.
	      Этот скрипт написал Vasil Dimov <code class="email">&lt;<a xmlns="" class="email" href="mailto:vd@FreeBSD.org">vd@FreeBSD.org</a>&gt;</code>, и он же его поддерживает, так что
	      вопросы, исправления и замечания по поводу  <code class="command">rmport</code>
	      следует посылать непосредственно ему.</p></td></tr><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h4 class="title"><a id="idp76054608"></a>12.3. Репозиторное копирование</h4></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>12.3.1. <a href="ports.html#idp76055248">Когда требуется репозиторное копирование?</a></dt><dt>12.3.2. <a href="ports.html#idp76058704">Когда репозиторное копирование не
	      требуется?</a></dt><dt>12.3.3. <a href="ports.html#idp76061904">Что нужно делать?</a></dt></dl></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76055248"></a><a id="idp76055504"></a><p><strong>12.3.1.</strong></p></td><td align="left" valign="top"><p>Когда требуется репозиторное копирование?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>При необходимости добавления порта, имеющего отношение
	      к другому, уже находящемуся в репозитории в другом каталоге,
	      необходимо произвести репозиторное копирование.  В данном
	      случае <em class="wordasword">имеющий отношение</em> означает
	      другую версию или небольшую модификацию.  Примерами могут
	      служить различные версии
	      <code class="filename">print/ghostscript*</code> и английская и
	      локализованные версии
	      <code class="filename">x11-wm/windowmaker*</code>.</p><p>Другим примером является необходимость перенести порт из
	      одного подкаталога в другой, или переименовать каталог, когда
	      автор меняет имя своей программы.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76058704"></a><a id="idp76058960"></a><p><strong>12.3.2.</strong></p></td><td align="left" valign="top"><p>Когда репозиторное копирование <span class="emphasis"><em>не</em></span>
	      требуется?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Если нет истории, которую стоило бы сохранять.  Для порта,
	      добавленного в неправильную категорию и сразу же перемещенного,
	      будет вполне достаточно выполнить команды
	      <code class="command">cvs remove</code> для старого варианта и
	      <code class="command">addport</code> для нового.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76061904"></a><a id="idp76062160"></a><p><strong>12.3.3.</strong></p></td><td align="left" valign="top"><p>Что нужно делать?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Создайте в <span class="application">GNATS</span> PR, описав
	      причины репозиторного копирования.  Поменяйте ответственного
	      на <code class="literal">portmgr</code> и установите статус
	      (<code class="varname">state</code>) в состояние
	      <code class="literal">repocopy</code>.  Если ваш запрос будет одобрен
	      группой Группа Менеджеров Дерева Портов FreeBSD <code class="email">&lt;<a xmlns="" class="email" href="mailto:portmgr@FreeBSD.org">portmgr@FreeBSD.org</a>&gt;</code>, он будет переадресован на
	      <code class="literal">pcvs</code>.  Группа Менеджеров Дерева Портов FreeBSD <code class="email">&lt;<a xmlns="" class="email" href="mailto:portmgr@FreeBSD.org">portmgr@FreeBSD.org</a>&gt;</code> может произвести
	      копирование каталогов самостоятельно; в противном случае
	      группа Администраторы Репозитория Портов<code class="email">&lt;<a xmlns="" class="email" href="mailto:pcvs@FreeBSD.org">pcvs@FreeBSD.org</a>&gt;</code> произведет собственно
	      копирование и вернет вам ваш PR.  После этого, вам необходимо
	      проделать следующее:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>После репозиторного копирования порта:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Обновите новый вариант порта до новой версии.
		      Не забудьте изменить строку <code class="varname">LATEST_LINK</code>,
		      чтобы не получить двух портов с одним именем.  В
		      некоторых исключительных случаях может быть необходимо
		      изменить переменную <code class="varname">PORTNAME</code> вместо
		      <code class="varname">LATEST_LINK</code>, но это должно быть сделано
		      только тогда когда это действительно нужно.  Например,
		      при использовании существующего порта в качестве основы для
		      весьма похожей программы с другим именем или при обновлении
		      порта до новой основной версии программы, при котором изменяется
		      имя самого дистрибутива, как в случае перехода с
		      <code class="filename">textproc/libxml</code> на
		      <code class="filename">textproc/libxml2</code>.  В большинстве случаев
		      изменение <code class="varname">LATEST_LINK</code> должно быть достаточно.</p></li><li class="step"><p>Добавьте новый каталог в список
		      <code class="varname">SUBDIR</code> в родительском файле
		      <code class="filename">Makefile</code>.
		      Для проверки вы можете воспользоваться
		      командой <code class="command">make checksubdirs</code>.</p></li><li class="step"><p>Если порт менял категорию, измените строку
		      <code class="varname">CATEGORIES</code> в файле
		      <code class="filename">Makefile</code>.</p></li><li class="step"><p>Добавьте строку для нового модуля в
		      <code class="filename">CVSROOT/modules</code>.</p></li><li class="step"><p>Добавьте строку в файл
		      <code class="filename">ports/MOVED</code>, в случае
		      если вы удалили первоначальный порт.</p></li></ol></div></li><li class="listitem"><p>При удалении порта:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Тщательно проверьте коллекцию на предмет портов,
		      зависящих от удаляемого и обновите их при необходимости.
		      Выполнение команды <code class="command">grep</code> по содержимому
		      файла <code class="filename">INDEX</code> недостаточно, поскольку
		      некоторые порты могут быть сконфигурированы на этапе
		      сборки.  Рекомендуется использовать полный поиск при
		      помощи команды <code class="command">grep -r</code>.</p></li><li class="step"><p>Удалите старый порт, запись <code class="varname">SUBDIR</code>
		      и строку, описывающую модуль.</p></li><li class="step"><p>Добавьте строку в файл
		      <code class="filename">ports/MOVED</code>.</p></li></ol></div></li><li class="listitem"><p>После репозиторного перемещения (операции
		  <span class="quote"><<<span class="quote">переименования</span>>></span>, когда после копирования
		  старый вариант удаляется):</p><div class="procedure"><ul class="procedure"><li class="step"><p>Используйте процедуры из предыдущих двух пунктов для
		      активации нового порта и удаления старого.</p></li></ul></div></li></ul></div></td></tr><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h4 class="title"><a id="idp76126672"></a>12.4. Заморозка портов</h4></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>12.4.1. <a href="ports.html#idp76127312">Что такое <<заморозка портов>>?</a></dt><dt>12.4.2. <a href="ports.html#idp76130896">Сколько длится заморозка?</a></dt><dt>12.4.3. <a href="ports.html#idp76132944">Что это значит для меня?</a></dt><dt>12.4.4. <a href="ports.html#idp76136912">Откуда я узнаю о начале периода заморозки?</a></dt><dt>12.4.5. <a href="ports.html#idp76139728">Как узнать, когда период заморозки портов закончился?</a></dt></dl></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76127312"></a><a id="idp76127568"></a><p><strong>12.4.1.</strong></p></td><td align="left" valign="top"><p>Что такое <span class="quote"><<<span class="quote">заморозка портов</span>>></span>?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Перед выпуском релиза для сохранения целостности различных
	      частей системы требуется на некоторое время ограничить
	      коммиты в дерево портов.  Этот процесс и называется
	      <span class="quote"><<<span class="quote">заморозкой портов</span>>></span>.</p><p>За дополнительной информацией по поводу правил поведения
	      во время заморозки обращайтесь к документу
	      <a class="link" href="../../../../ru/portmgr/qa.html" target="_top">Задачи контроля
	      качества для Группы управления портами</a>.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76130896"></a><a id="idp76131152"></a><p><strong>12.4.2.</strong></p></td><td align="left" valign="top"><p>Сколько длится заморозка?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Обычно неделю или две.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76132944"></a><a id="idp76133200"></a><p><strong>12.4.3.</strong></p></td><td align="left" valign="top"><p>Что это значит для меня?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Во время заморозки вы не можете производить какие-либо
	      коммиты в дерево портов без прямого разрешения группы порт-менеджеров.
	      <span class="quote"><<<span class="quote">Прямое разрешение</span>>></span> здесь означает, что вы послали
	      свой патч группе порт-менеджеров и получили ответ
	      <span class="quote"><<<span class="quote">Вперед, производите коммит</span>>></span>.
	    </p><p>В период заморозки не все изменения могут быть внесены
	      в дерево.  За подробностями обращайтесь к документу
	      <a class="link" href="../../../../ru/portmgr/qa.html" target="_top">Задачи контроля
	      качества для Группы управления портами</a>.
	    </p><p>Отметим, что у вас нет подразумеваемого разрешения
	      исправлять неработающий порт в период заморозки только потому,
	      что порт не работает.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76136912"></a><a id="idp76137168"></a><p><strong>12.4.4.</strong></p></td><td align="left" valign="top"><p>Откуда я узнаю о начале периода заморозки?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Обычно за 2-3 недели до начала периода заморозки
	      кто-либо из группы порт-менеджеров посылает письмо с предупреждением об этом в
	      <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports" target="_top">Список рассылки, посвящённый Портам FreeBSD</a> и Список рассылки коммиттеров FreeBSD.  Точное время начала периода
	      заморозки определяется за несколько дней до собственно
	      релиза, поскольку фиксируемое дерево портов должно быть
	      синхронизировано с релизом, а точная дата выпуска
	      определяется по ходу дела.</p><p>Разумеется, после начала периода заморозки в
	      Список рассылки коммиттеров FreeBSD будет отправлено еще одно предупреждение.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76139728"></a><a id="idp76139984"></a><p><strong>12.4.5.</strong></p></td><td align="left" valign="top"><p>Как узнать, когда период заморозки портов закончился?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Завершение периода заморозки анонсируется группой порт-менеджеров
	      посылкой письма в <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-ports" target="_top">Список рассылки, посвящённый Портам FreeBSD</a> и Список рассылки коммиттеров FreeBSD через несколько
	      часов после релиза.  Отметим, что факт выпуска релиза не
	      означает автоматического завершения заморозки.  Нам потребуется
	      убедиться, что в последние минуты не произошло ничего
	      непредвиденного, что заставило бы перевыпускать релиз.</p></td></tr><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h4 class="title"><a id="idp76175184"></a>12.5. Создание новой категории</h4></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>12.5.1. <a href="ports.html#idp76175824">Какова процедура создания новой категории портов?</a></dt><dt>12.5.2. <a href="ports.html#idp76195920">Как устроен процесс?</a></dt></dl></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76175824"></a><a id="idp76176080"></a><p><strong>12.5.1.</strong></p></td><td align="left" valign="top"><p>Какова процедура создания новой категории портов?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Разработчик, предлагающий новую категорию, должен
	      подготовить детальное обоснование ее создания, в том числе
	      описание причин, по которым текущий список категорий
	      недостаточен, а также список портов, переносимых в новую
	      категорию.</p><p>Прежде чем отправлять запрос, помните, что процесс потребует
	      приложения немалых сил от многих участников, затронет всякого,
	      кто поддерживает актуальное состояние дерева портов целиком, и,
	      наконец, что подобные предложения неизбежно вызовут споры и
	      расхождения во мнениях.</p><p>Обратитесь к разделу
	      <a class="link" href="../../../../doc/ru_RU.KOI8-R/books/porters-handbook/makefile-categories.html#PROPOSING-CATEGORIES" target="_top">
	      Proposing a New Category</a> Руководства по созданию портов.
	      После передачи PR группе Группа Менеджеров Дерева Портов FreeBSD <code class="email">&lt;<a xmlns="" class="email" href="mailto:portmgr@FreeBSD.org">portmgr@FreeBSD.org</a>&gt;</code> решение о создании категории
	      остается за ней.  В случае утверждения новой категории кто-либо
	      из Группа Менеджеров Дерева Портов FreeBSD <code class="email">&lt;<a xmlns="" class="email" href="mailto:portmgr@FreeBSD.org">portmgr@FreeBSD.org</a>&gt;</code> делает следующее:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Производит нужные репозиторные копирования.</p></li><li class="step"><p>Обновляет определения <code class="varname">VALID_CATEGORIES</code>
		  в файле <code class="filename">ports/Mk/bsd.port.mk</code>.
		</p></li><li class="step"><p>Возвращает PR вам.</p></li></ol></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76195920"></a><a id="idp76196176"></a><p><strong>12.5.2.</strong></p></td><td align="left" valign="top"><p>Как устроен процесс?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Процедура является надстройкой над уже описанной процедурой
	      репозиторного копирования отдельного порта.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Обновите файлы <code class="filename">Makefile</code> для всех
		    перенесенных портов.  Пока не добавляйте новую категорию
		    в процесс построения индекса.</p><p>Для этого вам необходимо:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Сменить для всех портов значение переменной
			  <code class="varname">CATEGORIES</code> (это и было нашей
			  целью, не правда ли?)  Новая категория должна быть
			  указано в списке <span class="emphasis"><em>первой</em></span>, это
			  поможет проверить, правильно ли установлена
			  переменная <code class="varname">PKGORIGIN</code>.</p></li><li class="step"><p>Выполните команду <code class="command">make
			  describe</code>.  Поскольку процедура построения
			  главного индекса <code class="command">make index</code>,
			  которую вам предстоит выполнить несколько позже,
			  использует именно <code class="command">make describe</code>,
			  обнаружение ошибок сейчас сэкономит вам немало
			  времени в будущем.</p></li><li class="step"><p>Если вы хотите быть совсем честным, самое время
			 запустить <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=portlint&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">portlint</span>(1)</span></a>.</p></li></ol></div></li><li class="step"><p>Проверьте корректность переменных
		    <code class="varname">PKGORIGIN</code>.  Система работы с портами
		    использует значение переменной
		    <code class="varname">CATEGORIES</code> для установки переменной
		    <code class="varname">PKGORIGIN</code>, которая затем используется
		    для связи установленных пакетов с каталогами дерева
		    портов.  Если эта связь установлена неправильно, перестанут
		    правильно функционировать утилиты работы с портами, такие
		    как <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pkg_version&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">pkg_version</span>(1)</span></a> и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=portupgrade&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">portupgrade</span>(1)</span></a>.</p><p>Для проверки следует использовать скрипт
		    <code class="filename">chkorigin.sh</code>: <code class="command">env
		    PORTSDIR=<em class="replaceable"><code>/path/to/ports</code></em>
		    sh -e <em class="replaceable"><code>/path/to/ports</code></em>/Tools/scripts/chkorigin.sh
		    </code>.  Эта команда проверит
		    <span class="emphasis"><em>каждый</em></span> порт в дереве, в том числе и
		    те, что не включены в процесс сборки, так что ее можно
		    использовать сразу после репозиторного копирования.
		    Совет: не забудьте проверить <code class="varname">PKGORIGIN</code>
		    для зависимых от изменяемых вами портов!</p></li><li class="step"><p>Протестируйте изменения локально, на вашей машине:
		    закомментируйте строки <code class="varname">SUBDIR</code> для
		    старых портов, затем разрешите обработку новой
		    категории в файле <code class="filename">ports/Makefile</code>.
		    Запустите <code class="command">make checksubdirs</code> в
		    затрагиваемых категориях.  Наконец, выполните в каталоге
		    <code class="filename">ports/</code> команду
		    <code class="command">make index</code>.  Ее выполнение может занять
		    до 40 минут даже на современной машине, однако, это
		    необходимые затраты для того, чтобы не создать проблем
		    для других.</p></li><li class="step"><p>После завершения этой операции вы можете вносить в
		    репозиторий изменения <code class="filename">ports/Makefile</code>
		    для включения новой категории в процесс сборки, а также
		    производить коммит изменений <code class="filename">Makefile</code>
		    для старых категорий.</p></li><li class="step"><p>Добавьте в файл <code class="filename">CVSROOT-ports/modules</code>
		    строку
		    </p><pre class="programlisting">ports_<em class="replaceable"><code>categoryname</code></em>   <em class="replaceable"><code>categoryname</code></em></pre><p>
		  </p><p>Поля должны быть разделены табуляцией.</p><p>Если <em class="replaceable"><code>categoryname</code></em>
		    содержит дефисы, замените их на подчеркивания.</p></li><li class="step"><p>Поменяйте строки для затронутых модулей в файле
		    <code class="filename">CVSROOT-ports/modules</code>.</p></li><li class="step"><p>Добавьте нужные строки в файл
		    <code class="filename">ports/MOVED</code>.</p></li><li class="step"><p>Обновите инструкции для <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cvsup&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cvsup</span>(1)</span></a>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
			Добавьте категорию в файл
			<code class="filename">distrib/cvsup/sup/README</code>
		      </p></li><li class="listitem"><p>
			Добавьте в каталог
			<code class="filename">distrib/cvsup/sup/ports-<em class="replaceable"><code>categoryname</code></em></code>
			два файла:
			<code class="filename">list.cvs</code> и
			<code class="filename">releases</code>.</p></li><li class="listitem"><p>
			Добавьте категорию в файл
			<code class="filename">src/share/examples/cvsup/ports-supfile</code>
		      </p></li></ul></div><p>
		    (Обратите внимание: эти
		    файлы расположены в репозитории src, а не ports).
		    Если вы не являетесь коммиттером src, вам потребуется
		    создать PR.</p></li><li class="step"><p>Обновите список категорий, используемый в <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a>
		    в <code class="filename">src/usr.sbin/sysinstall</code>.</p></li><li class="step"><p>Обновите документацию:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
		    <a class="link" href="../../../../doc/ru_RU.KOI8-R/books/porters-handbook/makefile-categories.html#PORTING-CATEGORIES" target="_top">
		    Руководство FreeBSD по созданию портов</a></p></li><li class="listitem"><p>
			Файл <code class="filename">www/en/ports/categories</code>.
			Обратите внимание, что строки в них сгруппированы по
			категориям, описанным в файле
			<code class="filename">www/en/ports/categories.descriptions</code>.
		      </p></li><li class="listitem"><p>Раздел Руководства, перечисляющий
			<a class="link" href="../../../../doc/ru_RU.KOI8-R/books/handbook/cvsup.html#CVSUP-COLLEC" target="_top">
			cvsup коллекции</a>.</p></li></ul></div><p>(Внимание: все эти файлы находятся в репозитории
		    документации.  Если вы не являетесь коммиттером в этой области,
		    создайте PR в категории документации (doc).</p></li><li class="step"><p>Старые варианты портов могут быть удалены из
		    репозитория только после того, как все описанные процедуры
		    будут завершены, и никто не жалуется на новую структуру.</p></li></ol></div><p>Специально обновлять <a class="link" href="../../../../ports/index.html" target="_top">веб-страницу портов</a>
		при добавлении новой категории не нужно: изменение файла
		<code class="filename">www/en/ports/categories</code> будет учтено при
		ежедневной перестройке списка портов
		(<code class="filename">INDEX</code>) автоматически.
	      </p></td></tr><tr class="qandadiv"><td align="left" valign="top" colspan="2"><h4 class="title"><a id="idp76263888"></a>12.6. Прочие вопросы</h4></td></tr><tr class="toc"><td align="left" valign="top" colspan="2"><dl><dt>12.6.1. <a href="ports.html#idp76264528">Как мне проверить, что мой порт корректно собирается?</a></dt><dt>12.6.2. <a href="ports.html#idp76275152">Я добавил новый порт.  Нужно ли добавлять его в файл
	      INDEX?</a></dt><dt>12.6.3. <a href="ports.html#idp76278608">Какие еще файлы я не должен трогать?</a></dt><dt>12.6.4. <a href="ports.html#idp76286288">Каков корректный порядок обновления порта, когда его
	      исходный архив поменялся, но не сменил имя?</a></dt></dl></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76264528"></a><a id="idp76264784"></a><p><strong>12.6.1.</strong></p></td><td align="left" valign="top"><p>Как мне проверить, что мой порт корректно собирается?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>В первую очередь проверьте свой порт по адресу
	      <code class="uri"><a class="uri" href="http://pointyhat.FreeBSD.org/errorlogs/" target="_top">http://pointyhat.FreeBSD.org/errorlogs/</a></code>.
	      Там вы найдете журналы сборки пакетов на всех поддерживаемых
	      архитектурах для большинства последних ветвей разработки.</p><p>Впрочем, отсутствие вашего порта среди журналов с ошибками
	      еще не значит, что он успешно собирается (например, может не
	      собираться один из зависимых портов).  Необходимую информацию вы
	      можете найти на машине <code class="systemitem">pointyhat</code> в каталогах
	      <code class="filename">/a/portbuild/&lt;arch&gt;/&lt;major_version&gt;</code>.
	      Каждая пара архитектуры и базовой версии содержит следующие
	      подкаталоги:</p><pre class="programlisting">errors        журналы ошибок последней сборки версии &lt;major_version&gt; на платформе &lt;arch&gt;
logs          все журналы последней сборки версии &lt;major_version&gt; на платформе &lt;arch&gt;
packages      свежесобранные пакеты для версии &lt;major_version&gt; на платформе &lt;arch&gt;
bak/errors    журналы ошибок последней полной сборки версии &lt;major_version&gt; на платформе &lt;arch&gt;
bak/logs      все журналы последней полной сборки версии &lt;major_version&gt; на платформе &lt;arch&gt;
bak/packages  пакеты последней полной сборки версии &lt;major_version&gt; на платформе &lt;arch&gt;</pre><p>Общее правило: пакет, присутствующий в каталоге
	      <code class="filename">packages</code> или каталоге
	      <code class="filename">logs</code>, и при этом отсутствующий в
	      <code class="filename">errors</code>, собрался успешно.  (Именно каталоги
	      <code class="filename">errors</code> вы видите на веб-сервере
	      <code class="systemitem">pointyhat</code>).</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76275152"></a><a id="idp76275408"></a><p><strong>12.6.2.</strong></p></td><td align="left" valign="top"><p>Я добавил новый порт.  Нужно ли добавлять его в файл
	      <code class="filename">INDEX</code>?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Нет.  <code class="filename">INDEX</code> больше не хранится
	      в CVS репозитории.  Данный файл может быть сгенерирован
	      с помощью команды <code class="command">make index</code> или
	      уже сгенерированная версия может быть загружена с помощью
	      <code class="command">make fetchindex</code>.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76278608"></a><a id="idp76278864"></a><p><strong>12.6.3.</strong></p></td><td align="left" valign="top"><p>Какие еще файлы я не должен трогать?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Любой файл в на верхнем уровне <code class="filename">ports/</code>,
	      а также все файлы в каталогах, имена которых начинаются с
	      прописной буквы (например, <code class="filename">Mk/</code>,
	      <code class="filename">Tools/</code> и т.п.).  В частности, упаси вас
	      Бог трогать файлы <code class="filename">ports/Mk/bsd.port*.mk</code>,
	      если вы не хотите привести порт-менеджеров в ярость!</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp76286288"></a><a id="idp76286544"></a><p><strong>12.6.4.</strong></p></td><td align="left" valign="top"><p>Каков корректный порядок обновления порта, когда его
	      исходный архив поменялся, но не сменил имя?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>При возникновении ситуации, когда автор обновляет
	      дистрибутивный архив без изменения идентификатора версии,
	      сообщение о коммите должно содержать аннотацию различий между
	      предыдущим и обновленным состоянием архива, чтобы можно было
	      убедиться, что архив не испорчен и не подменен злоумышленником.
	      Если текущая версия порта существовала достаточное время, копии
	      архива будут доступны на ftp-серверах проекта; в противном
	      случае следует связаться с автором или мейнтейнером порта для
	      выяснения причин замены архива.</p></td></tr></tbody></table></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="archs.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="perks.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">11. Поддержка различных архитектур </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 13. Пряники и прочие льготы</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>