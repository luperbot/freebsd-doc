<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>3. Построение релизов</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Подготовка релизов FreeBSD" /><link rel="up" href="index.html" title="Подготовка релизов FreeBSD" /><link rel="prev" href="release-proc.html" title="2. Процесс выпуска релиза" /><link rel="next" href="distribution.html" title="4. Распространение" /><link rel="copyright" href="trademarks.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. Построение релизов</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="release-proc.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="distribution.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="release-build"></a>3. Построение релизов</h2></div></div></div><p><span class="quote"><<<span class="quote">Релизы</span>>></span> FreeBSD могут быть построены любым человеком,
      имеющим быстродействующую машину и доступ к хранилищу исходных текстов.
      (Это должен быть любой, так как мы предоставляем анонимный доступ к CVS!
      Обратитесь к Руководству для прояснения деталей.)
      <span class="emphasis"><em>Единственным</em></span> особым требованием является наличие
      устройства <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=md&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">md</span>(4)</span></a>.  Если устройство в вашем ядре
      не подгружено, то модуль ядра должен быть подгружен автоматически при
      выполнении команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mdconfig</span>(8)</span></a> на этапе создания носителя для
      загрузки.  Все инструменты, необходимые для построения релиза, доступны
      из хранилища CVS в каталоге <code class="filename">src/release</code>.  Эти
      инструменты предоставляют единый метод построения релизов FreeBSD.
      Полный релиз может быть реально построен при помощи лишь одной команды,
      включая создание <acronym class="acronym">ISO</acronym>-образов, подходящих для записи на
      CDROM, установочных дискет и установочного каталога FTP.  Эта команда
      называется соответствующим образом: <code class="command">make
      release</code>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72371920"></a>3.1. <code class="command">make release</code></h3></div></div></div><p>Для успешного построения релиза вы должны сначала заполнить каталог
	<code class="filename">/usr/obj</code>, запустив команду <code class="command">make
	world</code> или просто <code class="command">make buildworld</code>.  Цель,
	выполняемая для построения релиза, требует корректного задания
	нескольких переменных, используемых при его сборке:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">CHROOTDIR</code> - Каталог, используемый в среде с
	    изменённой корневой файловой системой при построении полного
	    релиза.</p></li><li class="listitem"><p><code class="varname">BUILDNAME</code> - Наименование строящегося
	    релиза.</p></li><li class="listitem"><p><code class="varname">CVSROOT</code> - Местонахождение
	    CVS-хранилища.</p></li><li class="listitem"><p><code class="varname">RELEASETAG</code> - Тэг CVS, соответствующий
	    релизу, который вы собираетесь строить.</p></li></ul></div><p>Если у вас ещё нет доступа к локальному CVS-хранилищу, то вы можете
	зеркалировать одно из них при помощи <a class="link" href="http://www.FreeBSD.org/doc/ru_RU.KOI8-R/books/handbook/synching.html#CVSUP" target="_top">
	CVSup</a>.  Поставляемый sup-файл,
	<code class="filename">/usr/share/examples/cvsup/cvs-supfile</code>, может
	служить хорошей отправной точкой для зеркалирования хранилища
	CVS.</p><p>Если <code class="varname">RELEASETAG</code> опущен, то релиз будет строиться
	из ветки <code class="literal">HEAD</code> (известной как -CURRENT).  Релизы,
	строящиеся из этой ветки обычно называют <span class="quote"><<<span class="quote">снэпшотами
	-CURRENT</span>>></span>.</p><p>Для настройки построения релиза существует много других переменных
	Большинство из этих переменных описаны в начале файла
	<code class="filename">src/release/Makefile</code>.  Точная команда, служащая
	для построения официального релиза FreeBSD 4.7 (x86) такова:</p><pre class="screen"><code class="command">make release CHROOTDIR=/local3/release \
	BUILDNAME=4.7-RELEASE \
	CVSROOT=/host/cvs/usr/home/ncvs \
	RELEASETAG=RELENG_4_7_0_RELEASE</code></pre><p><code class="filename">Makefile</code> для релиза может быть разбит на
	несколько различных шагов.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Создание чистого системного окружения в отдельной иерархии
	    каталогов по команде <span class="quote"><<<span class="quote"><code class="command">make
	    installworld</code></span>>></span>.</p></li><li class="listitem"><p>Выгрузка из CVS чистой версии исходных текстов системы,
	    документации и портов в иерархию для построения релиза.</p></li><li class="listitem"><p>Создание копии <code class="filename">/etc</code> и
	    <code class="filename">/dev</code> в окружении с изменённым корнем файловой
	    системы.</p></li><li class="listitem"><p>Смена корневой файловой системы на иерархию построения релиза,
	    чтобы избежать влияния внешнего окружения на построение.</p></li><li class="listitem"><p>Выполнение <code class="command">make world</code> в окружении с
	    изменённой корневой файловой системой.</p></li><li class="listitem"><p>Построение бинарных файлов для работы с Kerberos.</p></li><li class="listitem"><p>Построение ядра <code class="filename">GENERIC</code>.</p></li><li class="listitem"><p>Создание промежуточного дерева каталогов, где будут строиться
	    бинарные файлы и формироваться дистрибутивы.</p></li><li class="listitem"><p>Построение и установка инструментов для работы с документацией,
	    необходимых для преобразования исходных текстов документации (SGML)
	    в формат HTML и текстовые документы, которые сопутствуют
	    релиз.</p></li><li class="listitem"><p>Построение и установка актуальной документации (руководства
	    пользователей, учебники, замечания к релизу, перечень аппаратной
	    совместимости и так далее.)</p></li><li class="listitem"><p>Построение <span class="quote"><<<span class="quote">свёрнутых</span>>></span> бинарных файлов,
	    используемых на установочных дискетах.</p></li><li class="listitem"><p>Подготовка дистрибутивных архивов бинарных файлов и исходных
	    текстов.</p></li><li class="listitem"><p>Создание загрузочного носителя
	    и <span class="quote"><<<span class="quote">fixit</span>>></span>-дискеты.</p></li><li class="listitem"><p>Создание иерархии для установки при помощи FTP.</p></li><li class="listitem"><p><span class="emphasis"><em>(опционально)</em></span> Создание образов ISO для
	    носителей CDROM/DVD.</p></li></ul></div><p>Для получения более полной информации об инфраструктуре построения
	релизов, пожалуйста, обратитесь к справочной странице
	по <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=release&amp;sektion=7"><span class="citerefentry"><span class="refentrytitle">release</span>(7)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Важно, чтобы из файла <code class="filename">/etc/make.conf</code> были
	  удалены все установки, специфичные для конкретного хоста.  К примеру,
	  будет глупо распространять бинарные файлы, построенные на системе с
	  переменной <code class="varname">CPUTYPE</code>, указывающей на определённый
	  тип процессора.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72461136"></a>3.2. Программное обеспечение третьих лиц (<span class="quote"><<<span class="quote">ports</span>>></span>)</h3></div></div></div><p><a class="link" href="http://www.FreeBSD.org/ports" target="_top">Коллекция портов
	FreeBSD</a> содержит более 24,000 программных пакетов
	сторонних разработчиков, которые доступны для FreeBSD.  За поддержку
	целостности дерева портов, которое может использоваться для создания
	бинарных пакетов, поставляемых с официальными релизами FreeBSD,
	отвечает Группа Менеджеров Дерева Портов FreeBSD <code class="email">&lt;<a xmlns="" class="email" href="mailto:portmgr@FreeBSD.org">portmgr@FreeBSD.org</a>&gt;</code>.</p><p>Рассмотрение работ с нашей коллекцией пакетов сторонних
	разработчиков при подготовке релизов выходит за рамки этого
	документа.  Этот вопрос глубоко рассмотрен в отдельной
	статье, <a class="link" href="{{{url.articles.releng-packages}}}/article.html" target="_top">The Release Engineering of Third Party Packages</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72472144"></a>3.3. ISO с релизами</h3></div></div></div><p>Начиная с FreeBSD 4.4, Проект FreeBSD принял решение распространять
	все четыре образа ISO, ранее продаваемые через
	<span class="emphasis"><em>BSDi/Wind River Systems/FreeBSD Mall</em></span> как
	<span class="quote"><<<span class="quote">официальные</span>>></span> дистрибутивы на CDROM.  Каждый из четырёх
	дисков должен содержать файл <code class="filename">README.TXT</code>,
	описывающий содержимое диска, файл <code class="filename">CDROM.INF</code>, в
	котором находятся мета-данные о диске для того, чтобы
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a> мог проверять и использовать содержимое, а также
	файл <code class="filename">filename.txt</code>, содержащий перечень содержимого
	на диске.  Этот <span class="emphasis"><em>перечень</em></span> может быть создан простой
	командой:</p><pre class="screen">/stage/cdrom<code class="prompt">#</code> <strong class="userinput"><code>find . -type f | sed -e 's/^\.\///' | sort &gt; filename.txt</code></strong></pre><p>Специфичные требования для каждого CD описываются ниже.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72493264"></a>3.3.1. Диск 1</h4></div></div></div><p>Первый диск практически полностью создаётся командой
	  <code class="command">make release</code>.  Единственным изменением, которое
	  нужно внести в каталог <code class="filename">disc1</code>, является
	  добавление подкаталога <code class="filename">tools</code>,
	  а также перенос максимально
	  возможного количества программных пакетов сторонних разработчиков,
	  которые поместятся на диск.  Каталог <code class="filename">tools</code>
	  содержит программное обеспечение, позволяющее пользователям создавать
	  установочные дискеты из других операционных систем.  Этот диск нужно
	  сделать загрузочным, чтобы пользователям современных ПК не нужно было
	  создавать установочные дискеты.</p><p>Если в релиз необходимо включить специализированное ядро, то
	  необходимо модифицировать <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a> и <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=release&amp;sektion=7"><span class="citerefentry"><span class="refentrytitle">release</span>(7)</span></a>,
	  добавив в них инструкции по установке.  Соответствующий код
	  находится в <code class="filename">src/release</code> и
	  <code class="filename">src/usr.sbin/sysinstall</code>.  В частности,
	  в <code class="filename">src/usr.sbin/sysinstall</code> необходимо будет
	  редактировать <code class="filename">src/release/Makefile</code>,
	  <code class="filename">dist.c</code>, <code class="filename">dist.h</code>,
	  <code class="filename">menus.c</code>, <code class="filename">install.c</code> и
	  <code class="filename">Makefile</code>.  Также может потребоваться обновить
	  <code class="filename">sysinstall.8</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72514768"></a>3.3.2. Диск 2</h4></div></div></div><p>Второй диск также в основном создаётся по команде <code class="command">make
	  release</code>.  Он содержит <span class="quote"><<<span class="quote">живую файловую
	  систему</span>>></span>, которую можно использовать из <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a> для
	  исправления процесса установки FreeBSD.  Этот диск должен быть
	  загрузочным и содержать также упакованную копию хранилища CVS в
	  каталоге <code class="filename">CVSROOT</code> и демонстрационные версии
	  коммерческого программного обеспечения в каталоге
	  <code class="filename">commerce</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72532048"></a>3.3.3. Диски 3 и 4</h4></div></div></div><p>Оставшиеся два диска содержат дополнительные программные пакеты
	  для FreeBSD.  Они должны быть объединены в группы (кластеры), чтобы
	  отдельный пакет и все его <span class="emphasis"><em>зависимости</em></span> находились
	  на одном и том же диске.  Дополнительная информация о создании этих
	  дисков находится в статье <a class="link" href="{{{url.articles.releng-packages}}}/article.html" target="_top">The Release Engineering of Third Party Packages</a>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp72538448"></a>3.3.4. Поддержка нескольких дисков</h4></div></div></div><p><span class="application">Sysinstall</span> поддерживает установку
	  пакетов с нескольких дисков.  Для это нужно, чтобы на каждом диске
	  был файл <code class="filename">INDEX</code>, содержащий названия всех пакетов
	  со всех дисков, с дополнительным полем, указывающем на каком диске
	  содержится данный конкретный пакет.  Также, на каждом диске, в файле
	  <code class="filename">cdrom.inf</code> должна быть указана переменная
	  <code class="literal">CD_VOLUME</code> для того, чтобы sysinstall мог
	  определить какой этой диск.  Когда пользователь будет пытаться
	  установить пакет, которого нет на текущем диске, sysinstall выдаст
	  запрос на вставку соответствующего диска.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="release-proc.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="distribution.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">2. Процесс выпуска релиза </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 4. Распространение</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>