<?xml version="1.0" encoding="koi8-r"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>Универсальная Система Печати Unix на FreeBSD</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="description" content="Эта статья посвящена конфигурированию Универсальной Системы Печати UNIX (CUPS) на FreeBSD." /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div xml:lang="ru" class="article" lang="ru"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69771728"></a>Универсальная Система Печати Unix на FreeBSD</h1></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Chess</span> <span class="surname">Griffin</span></h3><div class="affiliation"><div class="address"><p><code class="email">&lt;<a xmlns="" class="email" href="mailto:chess@chessgriffin.com">chess@chessgriffin.com</a>&gt;</code></p></div></div></div></div></div><div>Издание: <a href="https://svnweb.freebsd.org/changeset/doc/"><span class="svnref"></span></a></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="legalnotice"><a id="trademarks"></a><p>FreeBSD это зарегистрированная торговая
  марка FreeBSD Foundation.</p><p>Многие из обозначений, используемые
  производителями и продавцами для обозначения своих продуктов, заявляются
  в качестве торговых марок.  Когда такие обозначения появляются в этом
  документе, и Проекту FreeBSD известно о торговой марке, к обозначению
  добавляется знак <span class="quote"><<<span class="quote">TM</span>>></span> или
  <span class="quote"><<<span class="quote">(R)</span>>></span>.</p></div></div><div>    .</div><div><div xmlns="http://www.w3.org/1999/xhtml" class="abstract"><div class="abstract-title">Аннотация</div><p>Эта статья посвящена конфигурированию Универсальной Системы Печати
	UNIX (CUPS) на FreeBSD.</p></div></div></div><hr /></div><div class="toc"><div class="toc-title">Содержание</div><dl class="toc"><dt><span class="sect1"><a href="#printing-cups">1. Знакомимся с Универсальной Системой Печати UNIX (CUPS)</a></span></dt><dt><span class="sect1"><a href="#printing-cups-install">2. Установка сервера печати CUPS</a></span></dt><dt><span class="sect1"><a href="#printing-cups-configuring-server">3. Настройка сервера печати CUPS</a></span></dt><dt><span class="sect1"><a href="#printing-cups-configuring-printers">4. Настройка принтеров на сервере печати CUPS</a></span></dt><dt><span class="sect1"><a href="#printing-cups-clients">5. Конфигурирование клиентов CUPS</a></span></dt><dt><span class="sect1"><a href="#printing-cups-troubleshooting">6. Устранение неполадок с CUPS</a></span></dt><dt><span class="index"><a href="#idp70053840">Предметный указатель</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-cups"></a>1. Знакомимся с Универсальной Системой Печати UNIX (CUPS)</h2></div></div></div><a id="idp69799120" class="indexterm"></a><a id="idp69800272" class="indexterm"></a><p>Универсальная Система Печати UNIX (Common Unix Printing System, или
      сокращенно <span class="application">CUPS</span>), предоставляет переносимую
      среду печати для <span class="trademark">UNIX</span>(R) и <span class="trademark">UNIX</span>(R)-подобных операционных систем.  Она была
      разработана компанией Easy Software Products, чтобы предоставить
      стандартное решение в печати для всех разработчиков и пользователей
      <span class="trademark">UNIX</span>(R).</p><p>Универсальная Система Печати UNIX использует протокол межсетевой
      печати (Internet Printing Protocol, <acronym class="acronym">IPP</acronym>) как
      основу для управления заданиями на печать и очередями.  Также
      частично поддерживаются следующие протоколы: <acronym class="acronym">LPD</acronym>,
      <acronym class="acronym">SMB</acronym> и AppSocket (также известный как JetDirect).
      <span class="application">CUPS</span> дает возможность обзора сетевых
      принтеров и использования опций, базирующихся на ПостСкрипт Описании
      Принтеров (PostScript Printer Definition, <acronym class="acronym">PPD</acronym>),
      чтобы поддерживать в <span class="trademark">UNIX</span>(R) общепринятые традиции печати.  В результате
      <span class="application">CUPS</span> идеально подходит для совместного
      использования принтеров в смешанной среде из FreeBSD, <span class="trademark">Linux</span>(R),
      <span class="trademark">Mac OS</span>(R) X или <span class="trademark">Windows</span>(R).</p><p>Официальный сайт Универсальной Системы Печати UNIX -
	<code class="uri"><a class="uri" href="http://www.cups.org/" target="_top">http://www.cups.org/</a></code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-cups-install"></a>2. Установка сервера печати CUPS</h2></div></div></div><p>Для установки <span class="application">CUPS</span> используя пакет,
      запустите на выполнение такую команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install cups</code></strong></pre><p>Другие необязательные, но рекомендуемые к установке
      пакеты это <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print/gutenprint-cups/pkg-descr">print/gutenprint-cups</a>
      и <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print/hplip/pkg-descr">print/hplip</a>, каждый из которых
      добавляет драйвера и утилиты для разнообразных принтеров.  После
      установки файлы конфигурации <span class="application">CUPS</span> могут быть
      найдены в директории <code class="filename">/usr/local/etc/cups</code>.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-cups-configuring-server"></a>3. Настройка сервера печати CUPS</h2></div></div></div><p>Чтобы настроить сервер <span class="application">CUPS</span> необходимо
      отредактировать несколько конфигурационных файлов.  Для начала создайте
      или исправьте файл <code class="filename">/etc/devfs.rules</code> и добавьте
      следующую информацию для того, чтобы установить соответствующие права
      на все потенциальные файлы устройств принтеров и связать принтеры
      с группой пользователей <code class="systemitem">cups</code>:</p><pre class="programlisting">[system=10]
add path 'unlpt*' mode 0660 group cups
add path 'ulpt*' mode 0660 group cups
add path 'lpt*' mode 0660 group cups
add path 'usb/<em class="replaceable"><code>X</code></em>.<em class="replaceable"><code>Y</code></em>.<em class="replaceable"><code>Z</code></em>' mode 0660 group cups</pre><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Замените <em class="replaceable"><code>X</code></em>,
	<em class="replaceable"><code>Y</code></em> и <em class="replaceable"><code>Z</code></em> номерами
	соответствующего принтеру целевого устройства USB, отображаемого
	в каталоге <code class="filename">/dev/usb</code>.  Чтобы
	найти требуемые значения, просмотрите вывод <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> и найдите
	связанное с вашим принтером имя специального устройства
	<code class="filename">ugen<em class="replaceable"><code>X</code></em>.<em class="replaceable"><code>Y</code></em></code>,
	последнее будет символической ссылкой на искомое устройство в каталоге
	<code class="filename">/dev/usb</code>.</p></div><p>Затем, добавьте следующие две записи в
      <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">cupsd_enable="YES"
devfs_system_ruleset="system"</pre><p>Эти две записи будут запускать сервер печати
      <span class="application">CUPS</span> во время загрузки системы и
      применять локальное правило devfs, созданное выше.</p><p>Для того, чтобы печать <span class="application">CUPS</span> стала
      доступна для некоторых <span class="trademark">Microsoft</span>(R) <span class="trademark">Windows</span>(R) клиентов, необходимо
      раскомментировать следующую запись в
      <code class="filename">/usr/local/etc/cups/mime.types</code> и
      <code class="filename">/usr/local/etc/cups/mime.convs</code>:</p><pre class="programlisting">application/octet-stream</pre><p>По окончанию внесения изменений службы <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> и
      <span class="application">CUPS</span> необходимо перезапустить, для чего
      перезагрузите операционную систему или выполните от пользователя
      <code class="systemitem">root</code> следующие две команды:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/devfs restart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>/usr/local/etc/rc.d/cupsd restart</code></strong></pre></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-cups-configuring-printers"></a>4. Настройка принтеров на сервере печати CUPS</h2></div></div></div><p>После того, как система <span class="application">CUPS</span> была
      установлена и сконфигурирована, системный администратор может начать
      конфигурирование локальных принтеров, подключенных к серверу печати
      <span class="application">CUPS</span>.  Эта часть процесса очень похожа,
      если не идентична настройке принтеров <span class="application">CUPS</span>
      в других <span class="trademark">UNIX</span>(R)-подобных операционных системах, таких как
      дистрибутивы <span class="trademark">Linux</span>(R).</p><p>Основным способом управления и администрирования сервера
      <span class="application">CUPS</span> является веб-интерфейс,
      на который можно попасть запустив веб-браузер и набрав
      <code class="uri"><a class="uri" href="http://localhost:631" target="_top">http://localhost:631</a></code> в его адресной строке.
      Если сервер <span class="application">CUPS</span> находится на другой
      машине в сети, замените <code class="systemitem">localhost</code> на
      <acronym class="acronym">IP</acronym> адрес сервера.  Веб-интерфейс
      <span class="application">CUPS</span> достаточно очевиден, там есть разделы
      для управления принтерами и заданиями на печать, авторизацией
      пользователей и т.п.  Кроме того, в правой части страницы
      администрирования есть несколько флажков (check-box), дающих
      удобный доступ к часто меняемым установкам, таким как разрешение
      публичного доступа к подключенным к системе принтерам, предоставление
      удаленного управления сервером <span class="application">CUPS</span>,
      изменение уровня доступа пользователей к принтерам и их заданиям
      на печать.</p><p>Добавление принтера в общем такое же простое, как нажатие
      <span class="quote"><<<span class="quote">Add Printer</span>>></span> на странице администрирования
      веб-интерфейса сервера <span class="application">CUPS</span> или как нажатие
      одной из кнопок <span class="quote"><<<span class="quote">New Printers Found</span>>></span> на той же
      странице администрирования.  Когда перед вами предстанет выпадающий
      список <span class="quote"><<<span class="quote">Device</span>>></span>, просто выберите требуемый локально
      подключенный принтер, а дальше следуйте подсказкам интерфейса.
      В случае если были установлены порты или пакеты
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print/gutenprint-cups/pkg-descr">print/gutenprint-cups</a> или
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print/hplip/pkg-descr">print/hplip</a>, как указывалось выше,
      дополнительные драйвера печати будут доступны на последующих
      страницах, что может обеспечить большую надежность и расширенные
      возможности.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-cups-clients"></a>5. Конфигурирование клиентов CUPS</h2></div></div></div><p>После того, как сервер <span class="application">CUPS</span> был настроен,
      принтеры добавлены и сделаны доступными в сети, следующий шаг -
      это настройка клиентов или машин, которые будут иметь доступ к серверу
      <span class="application">CUPS</span>.  Если у вас единственный настольный
      компьютер, который работает одновременно и сервером и клиентом,
      то в большинстве этой информации вы не нуждаетесь.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-cups-clients-unix"></a>5.1. <span class="trademark">UNIX</span>(R) клиенты</h3></div></div></div><p>На <span class="trademark">UNIX</span>(R) клиентах также потребуется установить
	<span class="application">CUPS</span>.  После установки системы
	печати на клиенте, <span class="application">CUPS</span>-принтеры,
	присутствующие в сети, чаще всего автоматически находятся
	менеджерами принтеров разных графических оболочек, таких как
	<span class="application">GNOME</span> или <span class="application">KDE</span>.
	В качестве альтернативы, вы можете воспользоваться веб-интерфейсом
	<span class="application">CUPS</span> на клиентской машине по адресу
	<code class="uri"><a class="uri" href="http://localhost:631" target="_top">http://localhost:631</a></code> и на странице
	администрирования выбрать <span class="quote"><<<span class="quote">Add Printer</span>>></span>.  Когда
	перед вами предстанет выпадающий список <span class="quote"><<<span class="quote">Device</span>>></span>,
	просто выберите сетевой <span class="application">CUPS</span> принтер, если
	он был обнаружен автоматически, или выберите <code class="literal">ipp</code>
	или <code class="literal">http</code> и введите <acronym class="acronym">IPP</acronym> или
	<acronym class="acronym">HTTP</acronym> адрес (<acronym class="acronym">URI</acronym>) сетевого
	<span class="application">CUPS</span> принтера:</p><pre class="programlisting">ipp://<em class="replaceable"><code>server-name-or-ip</code></em>/printers/<em class="replaceable"><code>printername</code></em></pre><pre class="programlisting">http://<em class="replaceable"><code>server-name-or-ip</code></em>:631/printers/<em class="replaceable"><code>printername</code></em></pre><p>Если <span class="application">CUPS</span> клиент не находит в сети
	принтеры, доступные через сервер <span class="application">CUPS</span>,
	то иногда помогает создание или изменение файла
	<code class="filename">/usr/local/etc/cups/client.conf</code> с добавлением
	единственной записи, подобной следующей:</p><pre class="programlisting">ServerName <em class="replaceable"><code>server-ip</code></em></pre><p>В этом случае <em class="replaceable"><code>server-ip</code></em> необходимо
	заменить на <acronym class="acronym">IP</acronym> адрес сервера
	<span class="application">CUPS</span> в сети.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-cups-clients-windows"></a>5.2. <span class="trademark">Windows</span>(R)-клиенты</h3></div></div></div><p>Версии <span class="trademark">Windows</span>(R), предшествующие XP, не имели встроенной
	поддержки протокола <acronym class="acronym">IPP</acronym>.  Однако <span class="trademark">Windows</span>(R) XP
	и более поздние версии уже обладают такой возможностью.  Следовательно,
	добавить <span class="application">CUPS</span> принтер в этих версиях
	<span class="trademark">Windows</span>(R) довольно просто.  В большинстве случаев, администратору
	<span class="trademark">Windows</span>(R) потребуется запустить мастера установки принтера
	(<code class="literal">Add Printer</code>) выбрать сетевой принтер
	(<code class="literal">Network Printer</code>), а затем ввести
	<acronym class="acronym">URI</acronym> следующего формата:</p><pre class="programlisting">http://<em class="replaceable"><code>server-name-or-ip</code></em>:631/printers/<em class="replaceable"><code>printername</code></em></pre><p>Если используется версия <span class="trademark">Windows</span>(R) без поддержки протокола
	<acronym class="acronym">IPP</acronym>, то общим случаем подключения к
	<span class="application">CUPS</span>-принтеру будет совместное
	использование <span class="application">CUPS</span> и
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/samba3/pkg-descr">net/samba3</a>.  Описание этой
	возможности выходит за рамки данной статьи.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-cups-troubleshooting"></a>6. Устранение неполадок с CUPS</h2></div></div></div><p>Проблемы c <span class="application">CUPS</span> часто возникают
      из-за неверных прав доступа.  Сначала дважды проверьте права доступа
      в <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> (сверьтесь с уже описанными выше).  Затем, проверьте
      реальные права устройств, созданных в файловой системе.  Также бывает
      полезным удостовериться, что ваш пользователь входит в группу
      <code class="systemitem">cups</code>.  Если у вас складывается впечатление,
      что флажки прав доступа на странице администрирования веб-интерфейса
      <span class="application">CUPS</span> не работают, то иным решением
      может быть резервное копирование конфигурационного файла
      <code class="filename">/usr/local/etc/cups/cupsd.conf</code> и редактирование
      разных опций конфигурации с подбором их комбинаций.
      Ниже приведено содержимое тестового файла конфигурации
      <code class="filename">/usr/local/etc/cups/cupsd.conf</code>.
      Пожалуйста, обратите внимание на то, что безопасность в этом примере
      <code class="filename">cupsd.conf</code> была пожертвована в угоду простоте
      настройки; как только администратор успешно подсоединится к серверу
      <span class="application">CUPS</span> и сконфигурирует клиентов,
      рекомендуется пересмотреть данную конфигурацию и добавить разграничение
      доступа.</p><pre class="programlisting"># Log general information in error_log - change "info" to "debug" for
# troubleshooting...
LogLevel info

# Administrator user group...
SystemGroup wheel

# Listen for connections on Port 631.
Port 631
#Listen localhost:631
Listen /var/run/cups.sock

# Show shared printers on the local network.
Browsing On
BrowseOrder allow,deny
#BrowseAllow @LOCAL
BrowseAllow 192.168.1.* # change to local LAN settings
BrowseAddress 192.168.1.* # change to local LAN settings

# Default authentication type, when authentication is required...
DefaultAuthType Basic
DefaultEncryption Never # comment this line to allow encryption

# Allow access to the server from any machine on the LAN
&lt;Location /&gt;
  Order allow,deny
  #Allow localhost
  Allow 192.168.1.* # change to local LAN settings
&lt;/Location&gt;

# Allow access to the admin pages from any machine on the LAN
&lt;Location /admin&gt;
  #Encryption Required
  Order allow,deny
  #Allow localhost
  Allow 192.168.1.* # change to local LAN settings
&lt;/Location&gt;

# Allow access to configuration files from any machine on the LAN
&lt;Location /admin/conf&gt;
  AuthType Basic
  Require user @SYSTEM
  Order allow,deny
  #Allow localhost
  Allow 192.168.1.* # change to local LAN settings
&lt;/Location&gt;

# Set the default printer/job policies...
&lt;Policy default&gt;
  # Job-related operations must be done by the owner or an adminstrator...
  &lt;Limit Send-Document Send-URI Hold-Job Release-Job Restart-Job Purge-Jobs \
Set-Job-Attributes Create-Job-Subscription Renew-Subscription Cancel-Subscription \
Get-Notifications Reprocess-Job Cancel-Current-Job Suspend-Current-Job Resume-Job \
CUPS-Move-Job&gt;
    Require user @OWNER @SYSTEM
    Order deny,allow
  &lt;/Limit&gt;

  # All administration operations require an adminstrator to authenticate...
  &lt;Limit Pause-Printer Resume-Printer Set-Printer-Attributes Enable-Printer \
Disable-Printer Pause-Printer-After-Current-Job Hold-New-Jobs Release-Held-New-Jobs \
Deactivate-Printer Activate-Printer Restart-Printer Shutdown-Printer Startup-Printer \
Promote-Job Schedule-Job-After CUPS-Add-Printer CUPS-Delete-Printer CUPS-Add-Class \
CUPS-Delete-Class CUPS-Accept-Jobs CUPS-Reject-Jobs CUPS-Set-Default&gt;
    AuthType Basic
    Require user @SYSTEM
    Order deny,allow
  &lt;/Limit&gt;

  # Only the owner or an administrator can cancel or authenticate a job...
  &lt;Limit Cancel-Job CUPS-Authenticate-Job&gt;
    Require user @OWNER @SYSTEM
    Order deny,allow
  &lt;/Limit&gt;

  &lt;Limit All&gt;
    Order deny,allow
  &lt;/Limit&gt;
&lt;/Policy&gt;</pre></div><div class="index"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70053840"></a>Предметный указатель</h2></div></div></div><div class="index"><div class="indexdiv"><h3>C</h3><dl><dt>CUPS, <a class="indexterm" href="#printing-cups">Знакомимся с Универсальной Системой Печати UNIX (CUPS)</a></dt></dl></div><div class="indexdiv"><h3>P</h3><dl><dt>printing, <a class="indexterm" href="#printing-cups">Знакомимся с Универсальной Системой Печати UNIX (CUPS)</a></dt></dl></div></div></div></div></body></html>