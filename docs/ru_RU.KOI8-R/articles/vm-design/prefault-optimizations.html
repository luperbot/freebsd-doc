<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>5. Оптимизация ошибок доступа к страницам и их обнуления</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Элементы архитектуры системы виртуальной памяти во FreeBSD" /><link rel="up" href="index.html" title="Элементы архитектуры системы виртуальной памяти во FreeBSD" /><link rel="prev" href="freeing-pages.html" title="4. Когда освобождать страницу" /><link rel="next" href="pre-table-optimizations.html" title="6. Оптимизация таблицы страниц" /><link rel="copyright" href="trademarks.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. Оптимизация ошибок доступа к страницам и их обнуления</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="freeing-pages.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="pre-table-optimizations.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="prefault-optimizations"></a>5. Оптимизация ошибок доступа к страницам и их обнуления</h2></div></div></div><p>Полагая, что ошибка доступа к странице памяти в VM не является
      операцией с большими накладными расходами, если страница уже находится в
      основной памяти и может быть просто отображена в адресное пространство
      процесса, может оказаться, что это станет весьма накладно, если их
      будет оказываться регулярно много.  Хорошим примером этой ситуации
      является запуск таких программ, как <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> или <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a>, снова и
      снова.  Если бинарный файл программы отображен в память, но не отображен
      в таблицу страниц, то все страницы, к которым обращалась программа,
      окажутся недоступными при каждом запуске программы.  Это не так уж
      необходимо, если эти страницы уже присутствуют в кэше VM, так что FreeBSD
      будет пытаться восстанавливать таблицы страниц процесса из тех страниц,
      что уже располагаются в VM-кэше.  Однако во FreeBSD пока не выполняется
      предварительное копирование при записи определенных страниц при выполнении
      вызова exec.  Например, если вы запускаете программу <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a>
      одновременно с работающей <code class="command">vmstat 1</code>, то заметите, что
      она всегда выдает некоторое количество ошибок доступа к страницам, даже
      когда вы запускаете ее снова и снова.  Это ошибки заполнения нулями, а не
      ошибки кода программы (которые уже были обработаны).  Предварительное
      копирование страниц при выполнении вызовов exec или fork находятся в
      области, требующей более тщательного изучения.</p><p>Большой процент ошибок доступа к страницам, относится к ошибкам при
      заполнении нулями.  Вы можете обычно видеть это, просматривая вывод
      команды <code class="command">vmstat -s</code>.  Это происходит, когда процесс
      обращается к страницам в своей области BSS.  Область BSS предполагается
      изначально заполненной нулями, но VM-система не заботится о выделении
      памяти до тех пор, пока процесс реально к ней не обратится.  При
      возникновении ошибки VM-система должна не только выделить новую страницу,
      но и заполнить ее нулями.  Для оптимизации операции по заполнению нулями
      в системе VM имеется возможность предварительно обнулять страницы и
      помечать их, и запрашивать уже обнуленные страницы при возникновении
      ошибок заполнения нулями.  Предварительное заполнение нулями происходит,
      когда CPU простаивает, однако количество страниц, которые система заранее
      заполняет нулями, ограничено, для того, чтобы не переполнить кэши памяти.
      Это прекрасный пример добавления сложности в VM-систему ради оптимизации
      критического пути.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="freeing-pages.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="pre-table-optimizations.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">4. Когда освобождать страницу </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 6. Оптимизация таблицы страниц</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>