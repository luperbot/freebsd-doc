<?xml version="1.0" encoding="koi8-r"?>
<!--
     The FreeBSD Russian Documentation Project

     $FreeBSDru: frdp/doc/ru_RU.KOI8-R/articles/pam/article.xml,v 1.12 2004/07/16 12:06:10 den Exp $

     Original revision: r18148
-->
<!--
  - Copyright (c) 2001-2003 Networks Associates Technology, Inc.
  - All rights reserved.
  -
  - This software was developed for the FreeBSD Project by ThinkSec AS and
  - Network Associates Laboratories, the Security Research Division of
  - Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
  - ("CBOSS"), as part of the DARPA CHATS research program.
  -
  - Redistribution and use in source and binary forms, with or without
  - modification, are permitted provided that the following conditions
  - are met:
  - 1. Redistributions of source code must retain the above copyright
  -    notice, this list of conditions and the following disclaimer.
  - 2. Redistributions in binary form must reproduce the above copyright
  -    notice, this list of conditions and the following disclaimer in the
  -    documentation and/or other materials provided with the distribution.
  - 3. The name of the author may not be used to endorse or promote
  -    products derived from this software without specific prior written
  -    permission.
  -
  - THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
  - ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  - IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  - ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
  - FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  - DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
  - OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
  - HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
  - LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
  - OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
  - SUCH DAMAGE.
  -->
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:lang="ru">
  <info><title xmlns:xlink="http://www.w3.org/1999/xlink">Подключаемые Модули Аутентификации (PAM)</title>
    

    <pubdate xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</pubdate>

    <abstract xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">В этой статье описываются принципы и механизмы, лежащие в основе
        библиотеки Подключаемых Модулей Аутентификации (PAM - Pluggable
        Authentication Modules), и рассказывается, как настроить PAM, как
        интегрировать PAM в приложения и как создавать модули PAM.</para>
    </abstract>

    <copyright xmlns:xlink="http://www.w3.org/1999/xlink">
      <year xmlns:xlink="http://www.w3.org/1999/xlink">2001</year>

      <year xmlns:xlink="http://www.w3.org/1999/xlink">2002</year>

      <year xmlns:xlink="http://www.w3.org/1999/xlink">2003</year>

      <holder xmlns:xlink="http://www.w3.org/1999/xlink">Networks Associates Technology, Inc.</holder>
    </copyright>

    <authorgroup xmlns:xlink="http://www.w3.org/1999/xlink">
      <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Dag-Erling</firstname><surname xmlns:xlink="http://www.w3.org/1999/xlink">Smorgrav</surname></personname><contrib xmlns:xlink="http://www.w3.org/1999/xlink">Текст предоставил</contrib></author>
    </authorgroup>

    <legalnotice xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-legalnotice">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Эта статья была написана для Проекта FreeBSD компаниями
        ThinkSec AS и Network Associates Laboratories, Security
        Research Division of Network Associates, Inc. в рамках работ по
        контракту N66001-01-C-8035 с DARPA/SPAWAR (<quote xmlns:xlink="http://www.w3.org/1999/xlink">CBOSS</quote>),
        как часть исследовательской программы DARPA CHATS.</para>
    </legalnotice>

    <legalnotice xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="trademarks" role="trademarks">
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">FreeBSD это зарегистрированная торговая
  марка FreeBSD Foundation.</para>
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Linux это зарегистрированная торговая марка
  Linus Torvalds.</para>
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Motif, OSF/1 и UNIX это
  зарегистрированные торговые марки, а IT DialTone и The Open Group это
  торговые марки Open Group в Соединенных Штатах и других
  странах.</para>
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Sun, Sun Microsystems, Java, Java Virtual Machine,
  JDK, JRE, JSP, JVM, Netra, Solaris, StarOffice,
  SunOS это торговые марки или
  зарегистрированные торговые марки Sun Microsystems, Inc. в Соединенных
  Штатах и других странах.</para>
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Многие из обозначений, используемые
  производителями и продавцами для обозначения своих продуктов, заявляются
  в качестве торговых марок.  Когда такие обозначения появляются в этом
  документе, и Проекту FreeBSD известно о торговой марке, к обозначению
  добавляется знак <quote xmlns:xlink="http://www.w3.org/1999/xlink">TM</quote> или
  <quote xmlns:xlink="http://www.w3.org/1999/xlink">(R)</quote>.</para>
    </legalnotice>

    <releaseinfo xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</releaseinfo>
  </info>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-intro">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-intro.title">Введение</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Библиотека Pluggable Authentication Modules (PAM) является обобщённым
      API для служб, связанных с аутентификацией, которые позволяют системному
      администратору добавлять новые методы аутентификации простой установкой
      новых модулей PAM, и изменять политику аутентификации посредством
      редактирования конфигурационных файлов.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">PAM описали и разработали Vipin Samar и Charlie Lai из Sun
      Microsystems в 1995 году, с тех он сильно не менялся.  В 1997 году Open
      Group опубликовала предварительные спецификации на X/Open Single Sign-on
      (XSSO), что стандартизовало API для PAM и добавило расширения для
      одноразовой (или достаточно интегрированной) подписи.  На момент
      написания этого документа эта спецификация ещё не была принята за
      стандарт.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Хотя эта статья посвящена в основном FreeBSD 5.x, в которой
      используется OpenPAM, она подойдёт для FreeBSD 4.x, использующей
      Linux-PAM, и других операционных систем, таких, как Linux и
      <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Solaris</trademark>.</para>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-terms">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-terms.title">Термины и соглашения</title>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-definitions">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-definitions.title">Определения</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Терминология, используемая в PAM, достаточно запутана.  Ни
        оригинальная работа Samar и Lai, ни спецификация XSSO не делают никаких
        попыток формально определить термины для различных объектов и
        участвующих в PAM сторон, а термины, которые они используют (но не
        определяют) иногда неверны и неоднозначны.  Первой попыткой создать
        недвусмысленную и согласованную терминологию была работа, которую
        написал Andrew G. Morgan (автор Linux-PAM) в 1999 году.  Хотя выбор
        терминологии, которую сделал Морган, был гигантским скачком вперед,
        это, по мнению автора данной статьи, не означает ее правильность.
        Далее делается попытка, в значительной степени на основе работы
        Моргана, дать точные и недвусмысленные определения терминов для всех
        участников и объектов PAM.</para>

      <glosslist xmlns:xlink="http://www.w3.org/1999/xlink">
        <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
          <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">учётная запись (account)</glossterm>

	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Набор полномочий, которые аппликант запрашивает от
              арбитратора.</para>
	  </glossdef>
        </glossentry>

        <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
          <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">аппликант (applicant)</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Пользователь или объект, запрашивающие аутентификацию.</para>
          </glossdef>
        </glossentry>

        <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
          <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">арбитратор (arbitrator)</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Пользователь или объект, имеющий привилегии, достаточные
              для проверки полномочий аппликанта и права подтвердить или
              отклонить запрос.</para>
	  </glossdef>
        </glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">цепочка (chain)</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Последовательность модулей, которые будут вызваны в ответ на
              запрос PAM.  В цепочку включена информация о последовательности
              вызовов модулей, аргументах, которые нужно им передать, и о том,
              как интерпретировать результаты.</para>
	  </glossdef>
	</glossentry>

        <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
          <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">клиент (client)</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Приложение, отвечающее за инициирование запроса на
              аутентификацию от имени аппликанта и получающее от него
              необходимую для аутентификации информацию.</para>
	  </glossdef>
        </glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">подсистема (facility)</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Одна из четырех основных групп функциональности, которые дает
              PAM: аутентификация, управление учетными записями, управление
              сеансом и обновление ключом аутентификации.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">модуль (module)</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Набор из одной или большего количества связанных функций,
              реализующих определенную подсистему аутентификации, собранный в
              один (обычно динамически загружаемый) двоичный файл,
              идентифицируемый по имени.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">политика (policy)</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Полный набор конфигурационных деклараций, описывающих, как
              обрабатывать запросы PAM к определенной услуге.  Политика обычно
              состоит из четырех цепочек, по одной для каждой подсистемы, хотя
              некоторые службы используют не все четыре подсистемы.</para>
	  </glossdef>
	</glossentry>

        <glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
          <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">сервер (server)</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Приложение, выступающее от имени арбитратора для общения с
              клиентом, запрашивания аутентификационной информации, проверки
              полномочий аппликанта и подтверждающее или отклоняющее
              запрос.</para>
	  </glossdef>
        </glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">сервис (service)</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Класс серверов, предоставляющих похожую или связанную
              функциональность, и требующую подобную аутентификацию.  Политики
              PAM задаются на основе сервисов, так что ко всем серверам,
              объявляющим одно и тоже имя сервиса, будет применяться одна и та
              же политика.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">сеанс (session)</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Контекст, в котором сервис оказывается аппликанту сервером.
              Одна из четырех подсистем PAM, управление сеансом, касается
              исключительно настройке и очистке этого контекста.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">ключ (token)</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Блок информации, связанный с учётной записью, например,
              пароль или ключевая фраза, которую аппликант должен предоставить
              для своей идентификации.</para>
	  </glossdef>
	</glossentry>

	<glossentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <glossterm xmlns:xlink="http://www.w3.org/1999/xlink">транзакция (transaction)</glossterm>
	  <glossdef xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Последовательность запросов от одного и того же аппликанта к
              одному и тому же экземпляру того же самого сервера, начиная с
              аутентификации и установления сеанса и заканчивая закрытием
              сеанса.</para>
	  </glossdef>
	</glossentry>
      </glosslist>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-usage-examples">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-usage-examples.title">Примеры использования</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Этот раздел предназначен для иллюстрации значений некоторых
        терминов, определенных выше, при помощи простых примеров.</para>

      <section xmlns:xlink="http://www.w3.org/1999/xlink">
        <title xmlns:xlink="http://www.w3.org/1999/xlink">Объединенные клиент и сервер</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">В этом простом примере показывается пользователь
          <literal xmlns:xlink="http://www.w3.org/1999/xlink">alice</literal>, выполняющий команду <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> для
          того, чтобы стать пользователем <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal>.</para>

        <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">whoami</userinput>
alice
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ls -l `which su`</userinput>
-r-sr-xr-x  1 root  wheel  10744 Dec  6 19:06 /usr/bin/su
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">su -</userinput>
Password: <userinput xmlns:xlink="http://www.w3.org/1999/xlink">xi3kiune</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> whoami
root</screen>

	<itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Аппликантом является <literal xmlns:xlink="http://www.w3.org/1999/xlink">alice</literal>.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Учетной записью является <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal>.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Процесс <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> является как клиентом, так и
              сервером.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Аутентификационным ключом является
              <literal xmlns:xlink="http://www.w3.org/1999/xlink">xi3kiune</literal>.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Арбитратором выступает <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal>, и именно
              поэтому у команды <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> выставлен бит выполнения с
              правами <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal>.</para>
	  </listitem>
	</itemizedlist>
      </section>

      <section xmlns:xlink="http://www.w3.org/1999/xlink">
        <title xmlns:xlink="http://www.w3.org/1999/xlink">Клиент и сервер разделены</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">В примере ниже рассматривается пользователь
          <literal xmlns:xlink="http://www.w3.org/1999/xlink">eve</literal>, пытающийся установить <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">ssh</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>-соединение
          с <literal xmlns:xlink="http://www.w3.org/1999/xlink">login.example.com</literal>, и успешно входя как
	  пользователь <literal xmlns:xlink="http://www.w3.org/1999/xlink">bob</literal>.  Боб должен был выбрать пароль
          получше!</para>

        <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">whoami</userinput>
eve
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ssh bob@login.example.com</userinput>
bob@login.example.com's password: <userinput xmlns:xlink="http://www.w3.org/1999/xlink">god</userinput>
Last login: Thu Oct 11 09:52:57 2001 from 192.168.0.1
Copyright (c) 1980, 1983, 1986, 1988, 1990, 1991, 1993, 1994
        The Regents of the University of California.  All rights reserved.
FreeBSD 4.4-STABLE (LOGIN) #4: Tue Nov 27 18:10:34 PST 2001

Welcome to FreeBSD!
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">%</prompt></screen>

	<itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Аппликантом является <literal xmlns:xlink="http://www.w3.org/1999/xlink">eve</literal>.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Клиентом является процесс <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">ssh</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> пользователя
              Eve.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Сервером является процесс <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">sshd</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> на машине
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">login.example.com</literal></para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Учетной записью является <literal xmlns:xlink="http://www.w3.org/1999/xlink">bob</literal>.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Ключом аутентификации является
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">god</literal>.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Хотя этого не видно в примере, но арбитратором является
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal>.</para>
	  </listitem>
	</itemizedlist>
      </section>

      <section xmlns:xlink="http://www.w3.org/1999/xlink">
        <title xmlns:xlink="http://www.w3.org/1999/xlink">Пример политики</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Следующее является политикой, используемой во FreeBSD по
          умолчанию для <literal xmlns:xlink="http://www.w3.org/1999/xlink">sshd</literal>:</para>

        <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">sshd   auth            required        pam_nologin.so  no_warn
sshd   auth            required        pam_unix.so     no_warn try_first_pass
sshd   account         required        pam_login_access.so
sshd   account         required        pam_unix.so
sshd   session         required        pam_lastlog.so  no_fail
sshd   password        required        pam_permit.so</programlisting>

	<itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
            <para xmlns:xlink="http://www.w3.org/1999/xlink">Эта политика применяется к службе <literal xmlns:xlink="http://www.w3.org/1999/xlink">sshd</literal>
              (что не обязательно ограничено сервером <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">sshd</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry>).</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">auth</literal>, <literal xmlns:xlink="http://www.w3.org/1999/xlink">account</literal>,
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">session</literal> и
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">password</literal> являются подсистемами.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><filename xmlns:xlink="http://www.w3.org/1999/xlink">pam_nologin.so</filename>,
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam_unix.so</filename>,
              <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam_login_access.so</filename>,
              <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam_lastlog.so</filename> и
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam_permit.so</filename> являются модулями.  Из этого
              примера видно, что <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam_unix.so</filename>
	      реализует по крайней мере две подсистемы (аутентификацию и
              управление учётными записями).</para>
	  </listitem>
	</itemizedlist>
      </section>
    </section>

<!--
    <section id="pam-conventions">
      <title id="pam-conventions.title">Соглашения</title>

      <para>Этот раздел ещё не был написан.</para>
    </section>
-->
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-essentials">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-essentials.title">Основы PAM</title>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-facilities-primitives">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-facilities-primitives.title">Подсистемы и
        примитивы</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">API для PAM предоставляет шесть различных примитивов для
        аутентификации, сгруппированных в четыре подсистемы, каждая из которых
        описывается ниже.</para>

      <variablelist xmlns:xlink="http://www.w3.org/1999/xlink">
        <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">auth</literal></term>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Аутентификация.</emphasis> Эта подсистема,
              собственно говоря, реализует аутентификацию аппликанта и
              выяснение полномочий учётной записи.  Она предоставляет два
              примитива:</para>

	    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	        <para xmlns:xlink="http://www.w3.org/1999/xlink">Функция <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_authenticate</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> аутентифицирует
                  аппликанта, обычно запрашивая аутентификационный ключ и
                  сравнивая его со значением, хранящимся в базе данных или
                  получаемым от сервера аутентификации.</para>
	      </listitem>

	      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	        <para xmlns:xlink="http://www.w3.org/1999/xlink">Функция <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_setcred</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> устанавливает полномочия
                  учётной записи, такие, как идентификатор пользователя,
                  членство в группах и ограничения на использование
                  ресурсов.</para>
	      </listitem>
	    </itemizedlist>
	  </listitem>
	</varlistentry>

        <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">account</literal></term>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Управление учётной записью.</emphasis> Эта
              подсистема обрабатывает вопросы доступности учетной записи, не
              связанные с аутентификацией, такие, как ограничения в доступе на
              основе времени суток или загрузки сервера.  Он предоставляет
              единственный примитив:</para>

	    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	        <para xmlns:xlink="http://www.w3.org/1999/xlink">Функция <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_acct_mgmt</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> проверяет, доступна ли
                  запрашиваемая учётная запись.</para>
	      </listitem>
	    </itemizedlist>
	  </listitem>
	</varlistentry>

        <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">session</literal></term>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Управление сеансом.</emphasis> Эта подсистема
              отрабатывает задачи, связанные с установлением и закрытием
              сеанса, такие, как учет входов пользователей.  Она предоставляет
              два примитива:</para>

	    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	        <para xmlns:xlink="http://www.w3.org/1999/xlink">Функция <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_open_session</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> выполняет действия,
                  связанные с установлением сеанса: добавление записей в базы
                  данных <filename xmlns:xlink="http://www.w3.org/1999/xlink">utmp</filename> и <filename xmlns:xlink="http://www.w3.org/1999/xlink">wtmp</filename>,
                  запуск агента SSH и так далее.</para>
	      </listitem>

	      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	        <para xmlns:xlink="http://www.w3.org/1999/xlink">Функция <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_close_session</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> выполняет
                  действия, связанные с закрытием сеанса: добавление записей в
                  базы данных <filename xmlns:xlink="http://www.w3.org/1999/xlink">utmp</filename> и
                  <filename xmlns:xlink="http://www.w3.org/1999/xlink">wtmp</filename>, завершение работы агента SSH и так
                  далее.</para>
	      </listitem>
	    </itemizedlist>
	  </listitem>
	</varlistentry>

        <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
	  <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">password</literal></term>
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Управление паролем.</emphasis>  Эта подсистема
              используется для изменения ключа аутентификации, связанного с
              учетной записью, по причине истечения его срока действия или
              желания пользователя изменить его.  Она предоставляет
              единственный примитив:</para>

	    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	        <para xmlns:xlink="http://www.w3.org/1999/xlink">Функция <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_chauthtok</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> изменяет ключ
                  аутентификации, опционально проверяя, что он труден для
                  подбора, не использовался ранее и так далее.</para>
	      </listitem>
	    </itemizedlist>
	  </listitem>
	</varlistentry>
      </variablelist>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules.title">Модули</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модули являются центральной концепцией в PAM; в конце концов, им
        соответствует буква <quote xmlns:xlink="http://www.w3.org/1999/xlink">M</quote> в сокращении <quote xmlns:xlink="http://www.w3.org/1999/xlink">PAM</quote>.
        Модуль PAM представляет собой самодостаточный кусок программного кода,
        который реализует примитивы одной или большего количества подсистем
        одного конкретного механизма; к возможным механизмам для подсистемы
        аутентификации, к примеру, относятся базы данных паролей <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark>,
        системы NIS, LDAP или Radius.</para>

      <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-module-naming">
        <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-module-naming.title">Именование модулей</title>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">Во FreeBSD каждый механизм реализуется в отдельном модуле с
          именем <literal xmlns:xlink="http://www.w3.org/1999/xlink">pam_<replaceable xmlns:xlink="http://www.w3.org/1999/xlink">mechanism</replaceable>.so</literal>
          (например, <literal xmlns:xlink="http://www.w3.org/1999/xlink">pam_unix.so</literal> для механизма <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark>.)
          В других реализациях иногда отдельные модули используются для разных
          подсистем, и в их имя включается, кроме названия механизма, и имя
          подсистемы.  К примеру, в <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Solaris</trademark> имеется модуль
          <literal xmlns:xlink="http://www.w3.org/1999/xlink">pam_dial_auth.so.1</literal>, который часто используется
          для аутентификации пользователей, работающих по коммутируемым
          каналам связи.</para>
      </section>

      <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-module-versioning">
        <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-module-versioning.title">Версии модулей</title>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">Изначальная реализация PAM во FreeBSD, которая была основана на
          Linux-PAM, не использовала номера версий для модулей PAM.  Это будет
          приводить к проблемам при работе унаследованных приложений, которые
          могут быть скомпонованы со старыми версиями системных библиотек, так
          как способа подгрузить соответствующую версию требуемых модулей
          нет.</para>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">OpenPAM, с другой стороны, ищет модули, которые имеют тот же
          самый номер версии, что и библиотека PAM (на данный момент 2), и
          использует модуль без версии, только если модуль с известной версией
          не был загружен.  Поэтому для старых приложений могут предоставляться
          старые модули, при этом новые (или заново построенные) приложения
          будут использовать все возможности последних версий модулей.</para>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">Хотя модули PAM в <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Solaris</trademark> имеют номер версии, по-настоящему
          номер версии в них не отслеживается, потому что номер является частью
          имени и должен включаться в конфигурацию.</para>
      </section>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-chains-policies">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-chains-policies.title">Цепочки и политики</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Когда сервер инициирует PAM-транзакцию, библиотека PAM
        пытается загрузить политику для службы, указанной при вызове функции
        <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_start</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry>.  Политика определяет, как должны
        обрабатываться запросы на аутентификацию, и задаётся в
        конфигурационном файле.  Это составляет другую основополагающую
        концепцию PAM: возможность администратору настраивать политику
        безопасности системы (в самом широком её понимании) простым
        редактированием текстового файла.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Политика состоит из четырёх цепочек, по одной на каждый из
        методов PAM.  Каждое звено представляет собой последовательность
        конфигурационных утверждений, задающих вызываемый модуль, некоторые
        (необязательные) параметры для передачи в модуль, и управляющий флаг,
        описывающий, как интерпретировать возвращаемый из модуля код.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Понимание смысла управляющего флага необходимо для понимания
        конфигурационных файлов PAM.  Существуют четыре различных управляющих
        флага:</para>

      <variablelist xmlns:xlink="http://www.w3.org/1999/xlink">
        <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
          <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">binding</literal></term>

          <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
            <para xmlns:xlink="http://www.w3.org/1999/xlink">Если модуль отработал успешно, и ни один из предыдущих
              модулей в цепочке не сработал отрицательно, то цепочка
              прерывается, а запрос подтверждается.  Если же модуль отработает
              неудачно, то выполняется оставшаяся часть цепочки, однако
              запрос отвергается.</para>

            <para xmlns:xlink="http://www.w3.org/1999/xlink">Этот управляющий флаг был добавлен компанией Sun в <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Solaris</trademark>
              9 (<trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">SunOS</trademark> 5.9), и поддерживается в OpenPAM.</para>
          </listitem>
        </varlistentry>

        <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
          <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">required</literal></term>

          <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
            <para xmlns:xlink="http://www.w3.org/1999/xlink">Если модуль возвратил положительный ответ, выполняется
              оставшаяся часть цепочки, запрос удовлетворяется, если никакой
              другой модуль не отработает отрицательно.  Если же модуль
              возвратит отрицательный ответ, остаток цепочки тоже
              отрабатывается, но запрос отвергается.</para>
          </listitem>
        </varlistentry>

        <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
          <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">requisite</literal></term>

          <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
            <para xmlns:xlink="http://www.w3.org/1999/xlink">Если модуль возвращает положительный ответ, выполняется
              оставшаяся часть цепочки, запрос удовлетворяется, если никакой
              другой модуль не отработает отрицательно.  Если же модуль
              отрабатывает отрицательно, то отработка цепочки немедленно
              прекращается, а запрос отвергается.</para>
          </listitem>
        </varlistentry>

        <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
          <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">sufficient</literal></term>

          <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
            <para xmlns:xlink="http://www.w3.org/1999/xlink">Если модуль возвратит положительный ответ, и ни один из
              предыдущих модулей в цепочке на отработал отрицательно, то
              отработка цепочки немедленно прекращается, а запрос
              удовлетворяется.  Если модуль отработал отрицательно, то
              результат игнорируется и цепочка отрабатывается дальше.</para>

            <para xmlns:xlink="http://www.w3.org/1999/xlink">Так как семантика этого флага может оказаться запутанной,
              особенно при его использовании с последним модулем в цепочке,
              рекомендуется вместо него использовать управляющий флаг
              <literal xmlns:xlink="http://www.w3.org/1999/xlink">binding</literal>, если реализация его
              поддерживает.</para>
          </listitem>
        </varlistentry>

        <varlistentry xmlns:xlink="http://www.w3.org/1999/xlink">
          <term xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">optional</literal></term>

          <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
            <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль отрабатывается, но результат выполнения игнорируется.
              Если все модули в цепочке помечены как
              <literal xmlns:xlink="http://www.w3.org/1999/xlink">optional</literal>, то удовлетворяться будут все
              запросы.</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Когда сервер вызывает один из шести PAM-примитивов, PAM
        запрашивает цепочку подсистемы, к которой принадлежит примитив, и
        запускает каждый модуль, перечисленный в цепочке в порядке их
        перечисления, пока список не будет исчерпан либо не будет определено,
        что дальнейшей обработки не нужно (по причине достижение модуля,
        вернувшего положительный ответ при условии <literal xmlns:xlink="http://www.w3.org/1999/xlink">binding</literal>
        или <literal xmlns:xlink="http://www.w3.org/1999/xlink">sufficient</literal>, либо отрицательный с условием
        <literal xmlns:xlink="http://www.w3.org/1999/xlink">requisite</literal>).  Запрос подтверждается, если только
        был вызван по крайней мере один модуль, и все неопциональные модули
        вернули положительный ответ.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Заметьте, что возможно, хотя это не распространено, перечислять
        один и тот же модуль несколько раз в одной цепочке.  К примеру,
        модуль, просматривающий имена и пароли пользователя в сервере
        каталога может быть вызван несколько раз с различными параметрами,
        задающими различные серверы каталогов для связи.  PAM считает
        различные появления одного модуля в той же самой цепочке разными и
        не связанными модулями.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-transactions">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-transactions.title">Транзакции</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Жизненный цикл типичной PAM-транзакции описан ниже.  Заметьте,
        что в случае, если любой из перечисленных шагов оканчивается неудачно,
        сервер должен выдать клиенту соответствующее сообщение об ошибке
        и прервать транзакцию.</para>

      <orderedlist xmlns:xlink="http://www.w3.org/1999/xlink">
        <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
          <para xmlns:xlink="http://www.w3.org/1999/xlink">Если это необходимо, сервер получает полномочия арбитратора
            через независимый от PAM механизм-чаще всего по факту
            запуска пользователем <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal> или с установленным
            setuid-битом <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal>.</para>
        </listitem>

        <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
          <para xmlns:xlink="http://www.w3.org/1999/xlink">Сервер вызывает функцию <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_start</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> для
            инициализации библиотеки PAM и задания имени сервиса и целевой
            учётной записи, а также регистрации подходящего способа
            общения.</para>
        </listitem>

        <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
          <para xmlns:xlink="http://www.w3.org/1999/xlink">Сервер получает различную информацию, относящуюся к транзакции
            (такую, как имя пользователя аппликанта и имя хоста, на котором
            запущен клиент), и отправляет её в PAM при помощи функции
            <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_set_item</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry>.</para>
        </listitem>

        <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
          <para xmlns:xlink="http://www.w3.org/1999/xlink">Сервер вызывает функцию <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_authenticate</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry>
            для аутентификации аппликанта.</para>
        </listitem>

        <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
          <para xmlns:xlink="http://www.w3.org/1999/xlink">Сервер вызывает функцию <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_acct_mgmt</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> для проверки
            того, что запрошенная учётная запись доступна и корректна.  Если
            пароль верен, но его срок истёк, <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_acct_mgmt</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> возвратит
            результат <literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_NEW_AUTHTOK_REQD</literal>, а не
            <literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_SUCCESS</literal>.</para>
        </listitem>

        <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
          <para xmlns:xlink="http://www.w3.org/1999/xlink">Если на предыдущем шаге был получен результат
            <literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_NEW_AUTHTOK_REQD</literal>, то сервер вызывает функцию
            <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_chauthtok</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> для того, чтобы вынудить клиента
            изменить ключ аутентификации для запрошенной учётной записи.</para>
        </listitem>

        <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
          <para xmlns:xlink="http://www.w3.org/1999/xlink">Теперь, когда аппликант полностью аутентифицирован, сервер
            вызывает функцию <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_setcred</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> для получения
            полномочий запрошенной учётной записи.  Сделать это возможно,
            потому что он работает как арбитратор, и оставляет за собой
            полномочия арбитратора.</para>
        </listitem>

        <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
          <para xmlns:xlink="http://www.w3.org/1999/xlink">После получения необходимых полномочий, сервер вызывает функцию
            <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_open_session</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> для установления сеанса.</para>
        </listitem>

        <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
          <para xmlns:xlink="http://www.w3.org/1999/xlink">Теперь сервер выполняет тот сервис, который затребовал
            клиент-например, предоставляет аппликанту оболочку.</para>
        </listitem>

        <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
          <para xmlns:xlink="http://www.w3.org/1999/xlink">После того, как сервер закончил обслуживание клиента, он
            вызывает функцию <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_close_session</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> для закрытия
            сеанса.</para>
        </listitem>

        <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
          <para xmlns:xlink="http://www.w3.org/1999/xlink">Наконец, сервер вызывает функцию <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_end</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry>
            для оповещения библиотеки PAM о том, что работа с ней завершена и
            какие-либо выделенные в течение сеанса ресурсы можно
            освободить.</para>
        </listitem>
      </orderedlist>
    </section>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config.title">Настройка PAM</title>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-file">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-file.title">Файлы политик PAM</title>

      <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-pam.conf">
        <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-pam.conf.title">Файл
          <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.conf</filename></title>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">Традиционно файлом политик PAM является
          <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.conf</filename>.  Он содержит все политики PAM
          для вашей системы.  Каждая строка файла описывает один шаг в цепочке,
          как показано ниже:</para>

        <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">login   auth    required        pam_nologin.so  no_warn</programlisting>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">Поля следуют в таком порядке: имя службы, имя подсистемы,
          управляющий флаг, имя модуля и параметры модуля.  Любые
          дополнительные поля интерпретируются как дополнительные параметры
          модуля.</para>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">Для каждой пары сервис/подсистема составляется отдельная цепочка,
          и тогда получается, что, хотя порядок следования строк для одной и той
          же услуги и подсистемы является значимым, порядок перечисления
          отдельных сервисов не значим.  В примерах из оригинальной
          работы по PAM строки конфигурации сгруппированы по подсистемам, в
          поставляемом с <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Solaris</trademark> файле <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam.conf</filename> именно
          так и сделано, но в стандартном конфигурационном файле из поставки
          FreeBSD строки настроек сгруппированы по сервисам.  Подходит любой
          из этих способов; они имеют один и тот же смысл.</para>
      </section>

      <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-pam.d">
        <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-pam.d.title">Каталог
          <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.d</filename></title>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">OpenPAM и Linux-PAM поддерживают альтернативный механизм
          настройки, который для FreeBSD является предпочтительным.  В этой
          схеме каждая политика содержится в отдельном файле с именем,
          соответствующем сервису, к которому она применяется.  Эти файлы
          размещаются в каталоге <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.d/</filename>.</para>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">Такие файлы политик, ориентированные на сервисы, имеют только
          четыре поля, вместо пяти полей в файле <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam.conf</filename>:
          поле имени сервиса опущено.  Таким образом, вместо примера строки
          файла <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam.conf</filename> из предыдущего раздела получится
          следующая строка в файле <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.d/login</filename>:</para>

        <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">auth    required        pam_nologin.so  no_warn</programlisting>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">Как следствие такого упрощённого синтаксиса, возможно
          использование одних и тех же политик для нескольких сервисов,
          связывая каждое имя сервиса с тем же самым файлом политик.  К
          примеру, для использования той же самой политики для сервисов
          <literal xmlns:xlink="http://www.w3.org/1999/xlink">su</literal> и <literal xmlns:xlink="http://www.w3.org/1999/xlink">sudo</literal>, можно сделать
          следующее:</para>

        <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">cd /etc/pam.d</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ln -s su sudo</userinput></screen>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">Это работает, потому что имя сервиса определяется именем файла, а
          не его указанием в файле политики, так что один и тот же файл может
          использоваться для нескольких сервисов с разными названиями.</para>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">Так как политика каждого сервиса хранится в отдельном файле,
          то механизм <filename xmlns:xlink="http://www.w3.org/1999/xlink">pam.d</filename> делает установку
          дополнительных политик для программных пакетов сторонних
          разработчиков очень лёгкой задачей.</para>
      </section>

      <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-file-order">
        <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-file-order.title">Порядок поиска политик</title>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">Как вы видели выше, политики PAM могут находиться в нескольких
          местах.  Что будет, если политики для одного и того же сервиса
          имеются в разных местах?</para>

        <para xmlns:xlink="http://www.w3.org/1999/xlink">Необходимо осознать, что система конфигурации PAM ориентирована
          на цепочки.<!-- XXX --></para>
      </section>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-breakdown">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-config-breakdown.title">Структура строки настройки</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Как это объяснено в <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="pam-config-file"/>,
        каждая строка файла
        <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.conf</filename> состоит из четырёх или большего
        количества полей: имени сервиса, имени подсистемы, управляющего флага,
        имени модуля и дополнительных параметров модуля, которые могут
        отсутствовать.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Имя сервиса обычно (хотя не всегда) является именем приложения,
        которое этот сервис обслуживает.  Если вы не уверены, обратитесь к
        документации по конкретному приложению для определения используемого
        имени сервиса.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Заметьте, что если вы используете <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.d/</filename>
        вместо <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pam.conf</filename>, то имя сервиса задается
        именем файла политики, и опускается из строк настройки, которые в таком
        случае начинаются с названия подсистемы.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Имя подсистемы представляет собой одно из четырёх ключевых слов,
        описанных в <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="pam-facilities-primitives"/>.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Точно также управляющий флаг является одним из четырёх ключевых
        слов, описанных в <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="pam-chains-policies"/>,
        в котором рассказано, как
        интерпретировать возвращаемый из модуля код.  В Linux-PAM
        поддерживается альтернативный синтаксис, который позволяет указать
        действие, связанной с каждый возможным кодом возврата, но этого
        следует избегать, так как он не является стандартным и
        тесно связан со способом диспетчеризации вызовов сервисов в Linux-PAM
        (а он значительно отличается от способа взаимодействия в <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Solaris</trademark> и
        OpenPAM).  Не вызывает удивления тот факт, что в OpenPAM этот синтаксис
        не поддерживается.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-policies">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-policies.title">Политики</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Для корректной настройки PAM необходимо понимать, как происходит
        интерпретация политик.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">В момент, когда приложение вызывает функцию <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_start</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry>,
        библиотека PAM загружает политику для указанного сервиса и выстраивает
        четыре цепочки модулей (по одной для каждой подсистемы).  Если
        одна или большее количество этих цепочек являются пустыми, то
        будут выполняться подстановки соответствующих цепочек из политики для
        сервиса <literal xmlns:xlink="http://www.w3.org/1999/xlink">other</literal>.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Когда затем приложение вызывает одну из шести примитивов PAM,
        библиотека PAM выделяет из цепочки нужную подсистему и вызывает
        функцию, соответствующую сервису, в каждом модуле, перечисленном в
        цепочке, в том порядке, в каком они перечислены в конфигурации.  После
        каждого обращения к функции сервиса, тип модуля и возвращённый из этой
        функции код результата выполнения используются для того, что делать
        дальше.  За некоторыми исключениями, которые будут описаны ниже,
        применяется такая таблица:</para>

      <table xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Сводная таблица отработки цепочек PAM</title>

	<tgroup xmlns:xlink="http://www.w3.org/1999/xlink" cols="4">
	  <colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="1*" colname="type"/>

	  <colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="1*" colname="success"/>

	  <colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="1*" colname="ignore"/>

	  <colspec xmlns:xlink="http://www.w3.org/1999/xlink" colwidth="1*" colname="other"/>

	  <thead xmlns:xlink="http://www.w3.org/1999/xlink">
	    <row xmlns:xlink="http://www.w3.org/1999/xlink">
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="type"/>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="success"><literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_SUCCESS</literal></entry>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="ignore"><literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_IGNORE</literal></entry>

 	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="other"><literal xmlns:xlink="http://www.w3.org/1999/xlink">other</literal></entry>
	    </row>
	  </thead>

	  <tbody xmlns:xlink="http://www.w3.org/1999/xlink">
	    <row xmlns:xlink="http://www.w3.org/1999/xlink">
              <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="type">binding</entry>

              <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="success">if (!fail) break;</entry>

              <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="ignore">-</entry>

              <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="other">fail = true;</entry>
            </row>

            <row xmlns:xlink="http://www.w3.org/1999/xlink">
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="type">required</entry>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="success">-</entry>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="ignore">-</entry>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="other">fail = true;</entry>
	    </row>

	    <row xmlns:xlink="http://www.w3.org/1999/xlink">
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="type">requisite</entry>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="success">-</entry>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="ignore">-</entry>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="other">fail = true; break;</entry>
	    </row>

	    <row xmlns:xlink="http://www.w3.org/1999/xlink">
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="type">sufficient</entry>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="success">if (!fail) break;</entry>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="ignore">-</entry>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="ignore">-</entry>
	    </row>

	    <row xmlns:xlink="http://www.w3.org/1999/xlink">
	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="type">optional</entry>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="success">-</entry>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="ignore">-</entry>

	      <entry xmlns:xlink="http://www.w3.org/1999/xlink" colname="other">-</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Если переменная <varname xmlns:xlink="http://www.w3.org/1999/xlink">fail</varname> принимает истинное
        значение в конце отработки цепочки, или когда достигнут
        <quote xmlns:xlink="http://www.w3.org/1999/xlink">break</quote>, диспетчер возвращает код ошибки, возвращённый
        первым модулем, отработавшим неудачно.  В противном случае
        возвращается <literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_SUCCESS</literal>.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Первым исключением является то, что код ошибки
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_NEW_AUTHTOK_REQD</literal> интерпретируется как успешный
        результат, кроме случая, когда модуль отработал успешно, и по крайней
        мере один модуль возвратил <literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_NEW_AUTHTOK_REQD</literal>,
        тогда диспетчер возвратит результат
        <literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_NEW_AUTHTOK_REQD</literal>.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Вторым исключением является то, что <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_setcred</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> считает,
        что модули <literal xmlns:xlink="http://www.w3.org/1999/xlink">binding</literal> и <literal xmlns:xlink="http://www.w3.org/1999/xlink">sufficient</literal>
        являются равнозначными <literal xmlns:xlink="http://www.w3.org/1999/xlink">required</literal>.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Третьим и последним исключением является то, что функция
	<citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_chauthtok</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> отрабатывает полную цепочку дважды (один раз для
        предварительных проверок, и ещё раз для реального задания пароля), и
        на подготовительной фазе она считает, что модули
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">binding</literal> и <literal xmlns:xlink="http://www.w3.org/1999/xlink">sufficient</literal> являются
	равнозначными <literal xmlns:xlink="http://www.w3.org/1999/xlink">required</literal>.</para>
    </section>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-freebsd-modules">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-freebsd-modules.title">Модули PAM во FreeBSD</title>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-deny">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-deny.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_deny</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_deny</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> является одним из простейших доступных
        модулей; на любой запрос он возвращает результат
        <literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_AUTH_ERR</literal>.
        Он полезен для быстрого отключения сервиса (добавьте его на верх
        каждой цепочки) или завершения цепочек модулей
        <literal xmlns:xlink="http://www.w3.org/1999/xlink">sufficient</literal>.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-echo">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-echo.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_echo</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_echo</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> просто передаёт свои параметры в функцию
        взаимодействия как сообщение <literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_TEXT_INFO</literal>.  В
        основном полезна для отладки, но также может использоваться для
        вывода сообщений, таких как <quote xmlns:xlink="http://www.w3.org/1999/xlink">Unauthorized access will be
        prosecuted</quote> до запуска процедуры аутентификации.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-exec">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-exec.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_exec</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_exec</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> воспринимает первый переданный ему
        параметр как имя программы для выполнения, а остальные аргументы
        передаются этой программе в качестве параметров командной строки.
        Одним из возможных применений является его использование для запуска
        в момент регистрации в системе программы монтирования домашнего
        каталога пользователя.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-ftpusers">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-ftpusers.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_ftpusers</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_ftpusers</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-group">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-group.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_group</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_group</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> принимает или отвергает аппликантов в
        зависимости от их членства в определённой файловой группе (обычно
        <literal xmlns:xlink="http://www.w3.org/1999/xlink">wheel</literal> для <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>).  В первую очередь
        предназначен для сохранения традиционного поведения утилиты
        BSD <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>, хотя имеет и много других применений, таких как
        отключение определённых групп пользователей от некоторого
        сервиса.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-guest">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-guest.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_guest</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_guest</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> позволяет осуществлять гостевые входы
        с использованием фиксированных имён входа в систему.  На пароль могут
        накладываться различные ограничения, однако действием по умолчанию
        является ввод любого пароля при использовании имени, соответствующего
        гостевому входу.  Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_guest</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> можно легко использовать
        для реализации анонимных входов на FTP.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-krb5">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-krb5.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_krb5</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_krb5</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-ksu">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-ksu.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_ksu</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_ksu</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-lastlog">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-lastlog.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_lastlog</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_lastlog</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-login-access">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-login-access.title">
        <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_login_access</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_login_access</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> предоставляет реализацию примитива
        для управления учётными записями, который вводит в действие
        ограничения на вход, задаваемые в таблице <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">login.access</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">5</manvolnum></citerefentry>.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-nologin">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-nologin.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_nologin</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_nologin</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> отвергает любые входы не пользователем
        root, если существует файл <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/run/nologin</filename>.
        Обычно этот файл создаётся утилитой <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">shutdown</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry>, когда до
        запланированного завершения работы системы остаётся менее пяти
        минут.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-opie">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-opie.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> реализует метод аутентификации
        <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">4</manvolnum></citerefentry>.  Система <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">4</manvolnum></citerefentry> является механизмом работы по
        схеме запрос-ответ, при котором ответ на каждый запрос является
        прямой функцией от запроса и ключевой фразы, так что ответ может быть
        легко и <quote xmlns:xlink="http://www.w3.org/1999/xlink">вовремя</quote> вычислен любым, знающим ключевую фразу,
        что избавляет от необходимости передавать пароль.  Кроме того, так
        как в <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">4</manvolnum></citerefentry> никогда повторно не используется запрос, ответ на
        который был корректно получен, эта схема является устойчивой к
        атакам, основанным на повторе действий.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-opieaccess">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-opieaccess.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opieaccess</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opieaccess</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> дополняет модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry>.
        Его работа заключается в выполнении ограничений, задаваемых файлом
        <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">opieaccess</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">5</manvolnum></citerefentry>, который определяет условия, при которых
        пользователь, нормально прошедший аутентификацию посредством
        <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">4</manvolnum></citerefentry>, может использовать альтернативные методы.  Чаще всего
        он используется для запрета использования аутентификации на основе
        паролей с непроверенных хостов.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Для эффективности модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opieaccess</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> должен быть
        определён в цепочке <literal xmlns:xlink="http://www.w3.org/1999/xlink">auth</literal> как
        <literal xmlns:xlink="http://www.w3.org/1999/xlink">requisite</literal> сразу же после записи
        <literal xmlns:xlink="http://www.w3.org/1999/xlink">sufficient</literal> для <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_opie</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry>, но перед любыми
        другими модулями.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-passwdqc">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-passwdqc.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_passwdqc</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_passwdqc</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-permit">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-permit.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_permit</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_permit</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> является одним из самых простым из
        имеющихся; на любой запрос он отвечает <literal xmlns:xlink="http://www.w3.org/1999/xlink">PAM_SUCCESS</literal>.
        Он полезен в качестве замены пустого места для сервисов, когда
        одна или большее количество цепочек в противном случае останутся
        пустыми.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-radius">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-radius.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_radius</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_radius</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-rhosts">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-rhosts.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_rhosts</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_rhosts</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-rootok">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-rootok.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_rootok</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_rootok</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> возвращает положительный результат в том
        и только в том случае, если реальный id пользователя процесса, его
        вызвавшего (предполагается, что его запускает аппликант) равен 0.  Это
        полезно для несетевых сервисов, таких как <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> или
        <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">passwd</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>, к которым пользователь <literal xmlns:xlink="http://www.w3.org/1999/xlink">root</literal> должен
        иметь автоматический доступ.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-securetty">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-securetty.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_securetty</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_securetty</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-self">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-self.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_self</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_self</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> возвращает положительный результат тогда и
        только тогда, когда имена аппликанта соответствуют целевой учётной
        записи.  Больше всего это пригодится в несетевых сервисах, таких как
        <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>, в которых идентификация аппликанта может быть с лёгкостью
        проверена.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-ssh">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-ssh.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_ssh</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_ssh</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> предоставляет как сервис аутентификации,
        так и сеанса.  Сервис аутентификации позволяет пользователям, имеющим
        секретные ключи SSH, защищённые паролями, в своих каталогах
        <filename xmlns:xlink="http://www.w3.org/1999/xlink">~/.ssh</filename>, аутентифицироваться посредством этих
        паролей.  Сеансовый сервис запускает <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">ssh-agent</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> и загружает
        ключи, которые были расшифрованы на фазе аутентификации.  Такая
        возможность, в частности, полезна для локальных входов в систему,
        как в систему X (посредством <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" vendor="xfree86"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">xdm</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> или другого X-менеджера
        входов, умеющего работать с PAM), так и на консоль.</para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-tacplus">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-tacplus.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_tacplus</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_tacplus</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></para>
    </section>

    <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-unix">
      <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-modules-unix.title"><citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_unix</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry></title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Модуль <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_unix</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> реализует традиционную аутентификацию
        <trademark xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" class="registered">UNIX</trademark> на основе паролей, использующую функцию <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">getpwnam</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> для
        получения пароля целевой учётной записи и сравнивающую её с тем, что
        представил аппликант.  Он также предоставляет средства управления
        учётными записями (отслеживая время действия учётной записи и пароля) и
        смены паролей.  Наверное, это самый полезный модуль, так как
        подавляющее большинство администраторов хотят сохранить исторически
        сложившееся поведение по крайней мере некоторых сервисов.</para>
    </section>
  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-appl-prog">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-appl-prog.title">Программирование приложений с PAM</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><!--XXX-->Этот раздел ещё не написан.</para>

    <!--

      Заметьте, что, хотя в оригинальной работе о PAM включен пример
      PAM-приложения, вызывающего pam_open_session() перед pam_setcred(),
      в документации по Linux-PAM указывается, что сначала должны вызываться
      функция pam_setcred(), что имеет больше смысла.

      Отметьте также, что пример из той работы вызывает setgid(),
      initgroups() и setuid() самостоятельно, вместо того, чтобы полагаться
      на функцию pam_setcred().

      -->

  </section>

  <section xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-module-prog">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-module-prog.title">Программирование модуля PAM</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><!--XXX-->Этот раздел ещё не написан.</para>
  </section>

  <appendix xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-sample-appl">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-sample-appl.title">Пример PAM-приложения</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Далее следует минимальная реализация программы <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">su</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> с
      использованием PAM.  Заметьте, что в ней используется специфичная для
      OpenPAM функция взаимодействия <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">openpam_ttyconv</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry>, объявление
      которой расположено в файле <filename xmlns:xlink="http://www.w3.org/1999/xlink">security/openpam.h</filename>.
      Если вы собираетесь строить это приложение в системе с другой
      библиотекой PAM, вам необходимо будет создать собственную функцию
      взаимодействия.  Надёжную функцию взаимодействия неожиданно трудно
      написать; та, что находится в <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="pam-sample-conv"/>,
      хороша в качестве отправной
      точки, но в реальных приложениях использоваться не может.</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">
/*-
 * Copyright (c) 2002,2003 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * ("CBOSS"), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $P4: //depot/projects/openpam/bin/su/su.c#10 $
 * $FreeBSD$
 */

#include &lt;sys/param.h&gt;
#include &lt;sys/wait.h&gt;

#include &lt;err.h&gt;
#include &lt;pwd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;syslog.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_appl.h&gt;
#include &lt;security/openpam.h&gt;	/* for openpam_ttyconv() */

extern char **environ;

static pam_handle_t *pamh;
static struct pam_conv pamc;

static void
usage(void)
{

	fprintf(stderr, "Usage: su [login [args]]\n");
	exit(1);
}

int
main(int argc, char *argv[])
{
	char hostname[MAXHOSTNAMELEN];
	const char *user, *tty;
	char **args, **pam_envlist, **pam_env;
	struct passwd *pwd;
	int o, pam_err, status;
	pid_t pid;

	while ((o = getopt(argc, argv, "h")) != -1)
		switch (o) {
		case 'h':
		default:
			usage();
		}

	argc -= optind;
	argv += optind;

	if (argc &gt; 0) {
		user = *argv;
		--argc;
		++argv;
	} else {
		user = "root";
	}

	/* initialize PAM */
	pamc.conv = &amp;openpam_ttyconv;
	pam_start("su", user, &amp;pamc, &amp;pamh);

	/* set some items */
	gethostname(hostname, sizeof(hostname));
	if ((pam_err = pam_set_item(pamh, PAM_RHOST, hostname)) != PAM_SUCCESS)
		goto pamerr;
	user = getlogin();
	if ((pam_err = pam_set_item(pamh, PAM_RUSER, user)) != PAM_SUCCESS)
		goto pamerr;
	tty = ttyname(STDERR_FILENO);
	if ((pam_err = pam_set_item(pamh, PAM_TTY, tty)) != PAM_SUCCESS)
		goto pamerr;

	/* authenticate the applicant */
	if ((pam_err = pam_authenticate(pamh, 0)) != PAM_SUCCESS)
		goto pamerr;
	if ((pam_err = pam_acct_mgmt(pamh, 0)) == PAM_NEW_AUTHTOK_REQD)
		pam_err = pam_chauthtok(pamh, PAM_CHANGE_EXPIRED_AUTHTOK);
	if (pam_err != PAM_SUCCESS)
		goto pamerr;

	/* establish the requested credentials */
	if ((pam_err = pam_setcred(pamh, PAM_ESTABLISH_CRED)) != PAM_SUCCESS)
		goto pamerr;

	/* authentication succeeded; open a session */
	if ((pam_err = pam_open_session(pamh, 0)) != PAM_SUCCESS)
		goto pamerr;

	/* get mapped user name; PAM may have changed it */
	pam_err = pam_get_item(pamh, PAM_USER, (const void **)&amp;user);
	if (pam_err != PAM_SUCCESS || (pwd = getpwnam(user)) == NULL)
		goto pamerr;

	/* export PAM environment */
	if ((pam_envlist = pam_getenvlist(pamh)) != NULL) {
		for (pam_env = pam_envlist; *pam_env != NULL; ++pam_env) {
			putenv(*pam_env);
			free(*pam_env);
		}
		free(pam_envlist);
	}

	/* build argument list */
	if ((args = calloc(argc + 2, sizeof *args)) == NULL) {
		warn("calloc()");
		goto err;
	}
	*args = pwd-&gt;pw_shell;
	memcpy(args + 1, argv, argc * sizeof *args);

	/* fork and exec */
	switch ((pid = fork())) {
	case -1:
		warn("fork()");
		goto err;
	case 0:
		/* child: give up privs and start a shell */

		/* set uid and groups */
		if (initgroups(pwd-&gt;pw_name, pwd-&gt;pw_gid) == -1) {
			warn("initgroups()");
			_exit(1);
		}
		if (setgid(pwd-&gt;pw_gid) == -1) {
			warn("setgid()");
			_exit(1);
		}
		if (setuid(pwd-&gt;pw_uid) == -1) {
			warn("setuid()");
			_exit(1);
		}
		execve(*args, args, environ);
		warn("execve()");
		_exit(1);
	default:
		/* parent: wait for child to exit */
		waitpid(pid, &amp;status, 0);

		/* close the session and release PAM resources */
		pam_err = pam_close_session(pamh, 0);
		pam_end(pamh, pam_err);

		exit(WEXITSTATUS(status));
	}

pamerr:
	fprintf(stderr, "Sorry\n");
err:
	pam_end(pamh, pam_err);
	exit(1);
}

    </programlisting>
  </appendix>

  <appendix xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-sample-module">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-sample-module.title">Пример PAM-модуля</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Далее приведена минимальная реализация <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_unix</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry>,
      предоставляющая только сервисы аутентификации.  Она должна строиться и
      работать с большинством из реализаций PAM, но использует возможности
      расширений OpenPAM, если они присутствуют: отметьте использование
      функции <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">pam_get_authtok</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry>, которая кардинально упрощает
      организацию ввода пароля пользователем.</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">
/*-
 * Copyright (c) 2002 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * ("CBOSS"), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $P4: //depot/projects/openpam/modules/pam_unix/pam_unix.c#3 $
 * $FreeBSD$
 */

#include &lt;sys/param.h&gt;

#include &lt;pwd.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_modules.h&gt;
#include &lt;security/pam_appl.h&gt;

#ifndef _OPENPAM
static char password_prompt[] = "Password:";
#endif

#ifndef PAM_EXTERN
#define PAM_EXTERN
#endif

PAM_EXTERN int
pam_sm_authenticate(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{
#ifndef _OPENPAM
	struct pam_conv *conv;
	struct pam_message msg;
	const struct pam_message *msgp;
	struct pam_response *resp;
#endif
	struct passwd *pwd;
	const char *user;
	char *crypt_password, *password;
	int pam_err, retry;

	/* identify user */
	if ((pam_err = pam_get_user(pamh, &amp;user, NULL)) != PAM_SUCCESS)
		return (pam_err);
	if ((pwd = getpwnam(user)) == NULL)
		return (PAM_USER_UNKNOWN);

	/* get password */
#ifndef _OPENPAM
	pam_err = pam_get_item(pamh, PAM_CONV, (const void **)&amp;conv);
	if (pam_err != PAM_SUCCESS)
		return (PAM_SYSTEM_ERR);
	msg.msg_style = PAM_PROMPT_ECHO_OFF;
	msg.msg = password_prompt;
	msgp = &amp;msg;
#endif
	for (retry = 0; retry &lt; 3; ++retry) {
#ifdef _OPENPAM
		pam_err = pam_get_authtok(pamh, PAM_AUTHTOK,
		    (const char **)&amp;password, NULL);
#else
		resp = NULL;
		pam_err = (*conv-&gt;conv)(1, &amp;msgp, &amp;resp, conv-&gt;appdata_ptr);
		if (resp != NULL) {
			if (pam_err == PAM_SUCCESS)
				password = resp-&gt;resp;
			else
				free(resp-&gt;resp);
			free(resp);
		}
#endif
		if (pam_err == PAM_SUCCESS)
			break;
	}
	if (pam_err == PAM_CONV_ERR)
		return (pam_err);
	if (pam_err != PAM_SUCCESS)
		return (PAM_AUTH_ERR);

	/* compare passwords */
	if ((!pwd-&gt;pw_passwd[0] &amp;&amp; (flags &amp; PAM_DISALLOW_NULL_AUTHTOK)) ||
	    (crypt_password = crypt(password, pwd-&gt;pw_passwd)) == NULL ||
	    strcmp(crypt_password, pwd-&gt;pw_passwd) != 0)
		pam_err = PAM_AUTH_ERR;
	else
		pam_err = PAM_SUCCESS;
#ifndef _OPENPAM
	free(password);
#endif
	return (pam_err);
}

PAM_EXTERN int
pam_sm_setcred(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_acct_mgmt(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_open_session(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_close_session(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SUCCESS);
}

PAM_EXTERN int
pam_sm_chauthtok(pam_handle_t *pamh, int flags,
	int argc, const char *argv[])
{

	return (PAM_SERVICE_ERR);
}

#ifdef PAM_MODULE_ENTRY
PAM_MODULE_ENTRY("pam_unix");
#endif

    </programlisting>
  </appendix>

  <appendix xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-sample-conv">
    <title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-sample-conv.title">Пример функции взаимодействия
      PAM</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Функция взаимодействия, приводимая ниже, является значительно
      упрощённой версией функции <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">openpam_ttyconv</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> из OpenPAM.  Она
      полнофункциональна, и должна послужить источником идей о том, как
      должна себя вести функция взаимодействия, однако она слишком проста для
      реальных приложений.  Даже если вы не используете OpenPAM, можете
      сгрузить исходный код и использовать <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">openpam_ttyconv</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">3</manvolnum></citerefentry> в своих
      целях; мы надеемся, что она достаточно надёжна в качестве функции
      для взаимодействия с терминальными устройствами.</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">
/*-
 * Copyright (c) 2002 Networks Associates Technology, Inc.
 * All rights reserved.
 *
 * This software was developed for the FreeBSD Project by ThinkSec AS and
 * Network Associates Laboratories, the Security Research Division of
 * Network Associates, Inc.  under DARPA/SPAWAR contract N66001-01-C-8035
 * ("CBOSS"), as part of the DARPA CHATS research program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. The name of the author may not be used to endorse or promote
 *    products derived from this software without specific prior written
 *    permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * $FreeBSD$
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;

#include &lt;security/pam_appl.h&gt;

int
converse(int n, const struct pam_message **msg,
	struct pam_response **resp, void *data)
{
	struct pam_response *aresp;
	char buf[PAM_MAX_RESP_SIZE];
	int i;

	data = data;
	if (n &lt;= 0 || n &gt; PAM_MAX_NUM_MSG)
		return (PAM_CONV_ERR);
	if ((aresp = calloc(n, sizeof *aresp)) == NULL)
		return (PAM_BUF_ERR);
	for (i = 0; i &lt; n; ++i) {
		aresp[i].resp_retcode = 0;
		aresp[i].resp = NULL;
		switch (msg[i]-&gt;msg_style) {
		case PAM_PROMPT_ECHO_OFF:
			aresp[i].resp = strdup(getpass(msg[i]-&gt;msg));
			if (aresp[i].resp == NULL)
				goto fail;
			break;
		case PAM_PROMPT_ECHO_ON:
			fputs(msg[i]-&gt;msg, stderr);
			if (fgets(buf, sizeof buf, stdin) == NULL)
				goto fail;
			aresp[i].resp = strdup(buf);
			if (aresp[i].resp == NULL)
				goto fail;
			break;
		case PAM_ERROR_MSG:
			fputs(msg[i]-&gt;msg, stderr);
			if (strlen(msg[i]-&gt;msg) &gt; 0 &amp;&amp;
			    msg[i]-&gt;msg[strlen(msg[i]-&gt;msg) - 1] != '\n')
				fputc('\n', stderr);
			break;
		case PAM_TEXT_INFO:
			fputs(msg[i]-&gt;msg, stdout);
			if (strlen(msg[i]-&gt;msg) &gt; 0 &amp;&amp;
			    msg[i]-&gt;msg[strlen(msg[i]-&gt;msg) - 1] != '\n')
				fputc('\n', stdout);
			break;
		default:
			goto fail;
		}
	}
	*resp = aresp;
	return (PAM_SUCCESS);
 fail:
        for (i = 0; i &lt; n; ++i) {
                if (aresp[i].resp != NULL) {
                        memset(aresp[i].resp, 0, strlen(aresp[i].resp));
                        free(aresp[i].resp);
                }
        }
        memset(aresp, 0, n * sizeof *aresp);
	*resp = NULL;
	return (PAM_CONV_ERR);
}

    </programlisting>
  </appendix>

  <bibliography xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-further">
    <info><title xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="pam-further.title">Дополнительная литература</title>
    

    <abstract xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Это список документов, относящихся к PAM и связанным вопросам.
        Он, несомненно, не является полным.</para>
    </abstract>
    </info>

    <bibliodiv xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Работы</title>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
        <citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.sun.com/software/solaris/pam/pam.external.pdf">
	  Making Login Services Independent of Authentication
          Technologies</link></citetitle>

        <authorgroup xmlns:xlink="http://www.w3.org/1999/xlink">
          <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><surname xmlns:xlink="http://www.w3.org/1999/xlink">Samar</surname><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Vipin</firstname></personname></author>

          <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><surname xmlns:xlink="http://www.w3.org/1999/xlink">Lai</surname><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Charlie</firstname></personname></author>
        </authorgroup>

        <orgname xmlns:xlink="http://www.w3.org/1999/xlink">Sun Microsystems</orgname>
      </biblioentry>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
        <citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.opengroup.org/pubs/catalog/p702.htm">X/Open
          Single Sign-on Preliminary Specification</link></citetitle>

        <orgname xmlns:xlink="http://www.w3.org/1999/xlink">The Open Group</orgname>

        <biblioid xmlns:xlink="http://www.w3.org/1999/xlink" class="isbn">1-85912-144-6</biblioid>

        <pubdate xmlns:xlink="http://www.w3.org/1999/xlink">Июнь 1997</pubdate>
      </biblioentry>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
        <citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.kernel.org/pub/linux/libs/pam/pre/doc/current-draft.txt">
          Pluggable Authentication Modules</link></citetitle>

        <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><surname xmlns:xlink="http://www.w3.org/1999/xlink">Morgan</surname><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Andrew</firstname><othername xmlns:xlink="http://www.w3.org/1999/xlink" role="mi">G.</othername></personname></author>

        <pubdate xmlns:xlink="http://www.w3.org/1999/xlink">6 октября 1999</pubdate>
      </biblioentry>
    </bibliodiv>

    <bibliodiv xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Руководства пользователя</title>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
        <citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.sun.com/software/solaris/pam/pam.admin.pdf">PAM
          Administration</link></citetitle>

        <orgname xmlns:xlink="http://www.w3.org/1999/xlink">Sun Microsystems</orgname>
      </biblioentry>
    </bibliodiv>

    <bibliodiv xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Web-страницы по данной тематике</title>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
        <citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://openpam.sourceforge.net/">Домашняя страница
          OpenPAM</link></citetitle>

        <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><surname xmlns:xlink="http://www.w3.org/1999/xlink">Smorgrav</surname><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Dag-Erling</firstname></personname></author>

        <orgname xmlns:xlink="http://www.w3.org/1999/xlink">ThinkSec AS</orgname>
      </biblioentry>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
        <citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.kernel.org/pub/linux/libs/pam/">Домашняя
          страница Linux-PAM</link></citetitle>

        <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><surname xmlns:xlink="http://www.w3.org/1999/xlink">Morgan</surname><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Andrew</firstname><othername xmlns:xlink="http://www.w3.org/1999/xlink" role="mi">G.</othername></personname></author>
      </biblioentry>

      <biblioentry xmlns:xlink="http://www.w3.org/1999/xlink">
        <citetitle xmlns:xlink="http://www.w3.org/1999/xlink"><link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://wwws.sun.com/software/solaris/pam/">Домашняя
          страница Solaris PAM</link></citetitle>

        <orgname xmlns:xlink="http://www.w3.org/1999/xlink">Sun Microsystems</orgname>
      </biblioentry>
    </bibliodiv>
  </bibliography>
</article>
