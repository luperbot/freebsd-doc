<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>3. Основы PAM</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Подключаемые Модули Аутентификации (PAM)" /><link rel="up" href="index.html" title="Подключаемые Модули Аутентификации (PAM)" /><link rel="prev" href="pam-terms.html" title="2. Термины и соглашения" /><link rel="next" href="pam-config.html" title="4. Настройка PAM" /><link rel="copyright" href="pam-legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. Основы PAM</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="pam-terms.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="pam-config.html">След.</a></td></tr></table><hr /></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="pam-essentials"></a>3. Основы PAM</h2></div></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-facilities-primitives"></a>3.1. Подсистемы и
        примитивы</h3></div></div></div><p>API для PAM предоставляет шесть различных примитивов для
        аутентификации, сгруппированных в четыре подсистемы, каждая из которых
        описывается ниже.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">auth</code></span></dt><dd><p><span class="emphasis"><em>Аутентификация.</em></span> Эта подсистема,
              собственно говоря, реализует аутентификацию аппликанта и
              выяснение полномочий учётной записи.  Она предоставляет два
              примитива:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Функция <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_authenticate&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_authenticate</span>(3)</span></a> аутентифицирует
                  аппликанта, обычно запрашивая аутентификационный ключ и
                  сравнивая его со значением, хранящимся в базе данных или
                  получаемым от сервера аутентификации.</p></li><li class="listitem"><p>Функция <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_setcred&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_setcred</span>(3)</span></a> устанавливает полномочия
                  учётной записи, такие, как идентификатор пользователя,
                  членство в группах и ограничения на использование
                  ресурсов.</p></li></ul></div></dd><dt><span class="term"><code class="literal">account</code></span></dt><dd><p><span class="emphasis"><em>Управление учётной записью.</em></span> Эта
              подсистема обрабатывает вопросы доступности учетной записи, не
              связанные с аутентификацией, такие, как ограничения в доступе на
              основе времени суток или загрузки сервера.  Он предоставляет
              единственный примитив:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Функция <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_acct_mgmt&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_acct_mgmt</span>(3)</span></a> проверяет, доступна ли
                  запрашиваемая учётная запись.</p></li></ul></div></dd><dt><span class="term"><code class="literal">session</code></span></dt><dd><p><span class="emphasis"><em>Управление сеансом.</em></span> Эта подсистема
              отрабатывает задачи, связанные с установлением и закрытием
              сеанса, такие, как учет входов пользователей.  Она предоставляет
              два примитива:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Функция <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_open_session&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_open_session</span>(3)</span></a> выполняет действия,
                  связанные с установлением сеанса: добавление записей в базы
                  данных <code class="filename">utmp</code> и <code class="filename">wtmp</code>,
                  запуск агента SSH и так далее.</p></li><li class="listitem"><p>Функция <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_close_session&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_close_session</span>(3)</span></a> выполняет
                  действия, связанные с закрытием сеанса: добавление записей в
                  базы данных <code class="filename">utmp</code> и
                  <code class="filename">wtmp</code>, завершение работы агента SSH и так
                  далее.</p></li></ul></div></dd><dt><span class="term"><code class="literal">password</code></span></dt><dd><p><span class="emphasis"><em>Управление паролем.</em></span>  Эта подсистема
              используется для изменения ключа аутентификации, связанного с
              учетной записью, по причине истечения его срока действия или
              желания пользователя изменить его.  Она предоставляет
              единственный примитив:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Функция <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_chauthtok&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_chauthtok</span>(3)</span></a> изменяет ключ
                  аутентификации, опционально проверяя, что он труден для
                  подбора, не использовался ранее и так далее.</p></li></ul></div></dd></dl></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-modules"></a>3.2. Модули</h3></div></div></div><p>Модули являются центральной концепцией в PAM; в конце концов, им
        соответствует буква <span class="quote"><<<span class="quote">M</span>>></span> в сокращении <span class="quote"><<<span class="quote">PAM</span>>></span>.
        Модуль PAM представляет собой самодостаточный кусок программного кода,
        который реализует примитивы одной или большего количества подсистем
        одного конкретного механизма; к возможным механизмам для подсистемы
        аутентификации, к примеру, относятся базы данных паролей <span class="trademark">UNIX</span>(R),
        системы NIS, LDAP или Radius.</p><div class="section"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-module-naming"></a>3.2.1. Именование модулей</h4></div></div></div><p>Во FreeBSD каждый механизм реализуется в отдельном модуле с
          именем <code class="literal">pam_<em class="replaceable"><code>mechanism</code></em>.so</code>
          (например, <code class="literal">pam_unix.so</code> для механизма <span class="trademark">UNIX</span>(R).)
          В других реализациях иногда отдельные модули используются для разных
          подсистем, и в их имя включается, кроме названия механизма, и имя
          подсистемы.  К примеру, в <span class="trademark">Solaris</span>TM имеется модуль
          <code class="literal">pam_dial_auth.so.1</code>, который часто используется
          для аутентификации пользователей, работающих по коммутируемым
          каналам связи.</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-module-versioning"></a>3.2.2. Версии модулей</h4></div></div></div><p>Изначальная реализация PAM во FreeBSD, которая была основана на
          Linux-PAM, не использовала номера версий для модулей PAM.  Это будет
          приводить к проблемам при работе унаследованных приложений, которые
          могут быть скомпонованы со старыми версиями системных библиотек, так
          как способа подгрузить соответствующую версию требуемых модулей
          нет.</p><p>OpenPAM, с другой стороны, ищет модули, которые имеют тот же
          самый номер версии, что и библиотека PAM (на данный момент 2), и
          использует модуль без версии, только если модуль с известной версией
          не был загружен.  Поэтому для старых приложений могут предоставляться
          старые модули, при этом новые (или заново построенные) приложения
          будут использовать все возможности последних версий модулей.</p><p>Хотя модули PAM в <span class="trademark">Solaris</span>TM имеют номер версии, по-настоящему
          номер версии в них не отслеживается, потому что номер является частью
          имени и должен включаться в конфигурацию.</p></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-chains-policies"></a>3.3. Цепочки и политики</h3></div></div></div><p>Когда сервер инициирует PAM-транзакцию, библиотека PAM
        пытается загрузить политику для службы, указанной при вызове функции
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_start&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_start</span>(3)</span></a>.  Политика определяет, как должны
        обрабатываться запросы на аутентификацию, и задаётся в
        конфигурационном файле.  Это составляет другую основополагающую
        концепцию PAM: возможность администратору настраивать политику
        безопасности системы (в самом широком её понимании) простым
        редактированием текстового файла.</p><p>Политика состоит из четырёх цепочек, по одной на каждый из
        методов PAM.  Каждое звено представляет собой последовательность
        конфигурационных утверждений, задающих вызываемый модуль, некоторые
        (необязательные) параметры для передачи в модуль, и управляющий флаг,
        описывающий, как интерпретировать возвращаемый из модуля код.</p><p>Понимание смысла управляющего флага необходимо для понимания
        конфигурационных файлов PAM.  Существуют четыре различных управляющих
        флага:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">binding</code></span></dt><dd><p>Если модуль отработал успешно, и ни один из предыдущих
              модулей в цепочке не сработал отрицательно, то цепочка
              прерывается, а запрос подтверждается.  Если же модуль отработает
              неудачно, то выполняется оставшаяся часть цепочки, однако
              запрос отвергается.</p><p>Этот управляющий флаг был добавлен компанией Sun в <span class="trademark">Solaris</span>TM
              9 (<span class="trademark">SunOS</span>TM 5.9), и поддерживается в OpenPAM.</p></dd><dt><span class="term"><code class="literal">required</code></span></dt><dd><p>Если модуль возвратил положительный ответ, выполняется
              оставшаяся часть цепочки, запрос удовлетворяется, если никакой
              другой модуль не отработает отрицательно.  Если же модуль
              возвратит отрицательный ответ, остаток цепочки тоже
              отрабатывается, но запрос отвергается.</p></dd><dt><span class="term"><code class="literal">requisite</code></span></dt><dd><p>Если модуль возвращает положительный ответ, выполняется
              оставшаяся часть цепочки, запрос удовлетворяется, если никакой
              другой модуль не отработает отрицательно.  Если же модуль
              отрабатывает отрицательно, то отработка цепочки немедленно
              прекращается, а запрос отвергается.</p></dd><dt><span class="term"><code class="literal">sufficient</code></span></dt><dd><p>Если модуль возвратит положительный ответ, и ни один из
              предыдущих модулей в цепочке на отработал отрицательно, то
              отработка цепочки немедленно прекращается, а запрос
              удовлетворяется.  Если модуль отработал отрицательно, то
              результат игнорируется и цепочка отрабатывается дальше.</p><p>Так как семантика этого флага может оказаться запутанной,
              особенно при его использовании с последним модулем в цепочке,
              рекомендуется вместо него использовать управляющий флаг
              <code class="literal">binding</code>, если реализация его
              поддерживает.</p></dd><dt><span class="term"><code class="literal">optional</code></span></dt><dd><p>Модуль отрабатывается, но результат выполнения игнорируется.
              Если все модули в цепочке помечены как
              <code class="literal">optional</code>, то удовлетворяться будут все
              запросы.</p></dd></dl></div><p>Когда сервер вызывает один из шести PAM-примитивов, PAM
        запрашивает цепочку подсистемы, к которой принадлежит примитив, и
        запускает каждый модуль, перечисленный в цепочке в порядке их
        перечисления, пока список не будет исчерпан либо не будет определено,
        что дальнейшей обработки не нужно (по причине достижение модуля,
        вернувшего положительный ответ при условии <code class="literal">binding</code>
        или <code class="literal">sufficient</code>, либо отрицательный с условием
        <code class="literal">requisite</code>).  Запрос подтверждается, если только
        был вызван по крайней мере один модуль, и все неопциональные модули
        вернули положительный ответ.</p><p>Заметьте, что возможно, хотя это не распространено, перечислять
        один и тот же модуль несколько раз в одной цепочке.  К примеру,
        модуль, просматривающий имена и пароли пользователя в сервере
        каталога может быть вызван несколько раз с различными параметрами,
        задающими различные серверы каталогов для связи.  PAM считает
        различные появления одного модуля в той же самой цепочке разными и
        не связанными модулями.</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-transactions"></a>3.4. Транзакции</h3></div></div></div><p>Жизненный цикл типичной PAM-транзакции описан ниже.  Заметьте,
        что в случае, если любой из перечисленных шагов оканчивается неудачно,
        сервер должен выдать клиенту соответствующее сообщение об ошибке
        и прервать транзакцию.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Если это необходимо, сервер получает полномочия арбитратора
            через независимый от PAM механизм-чаще всего по факту
            запуска пользователем <code class="literal">root</code> или с установленным
            setuid-битом <code class="literal">root</code>.</p></li><li class="listitem"><p>Сервер вызывает функцию <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_start&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_start</span>(3)</span></a> для
            инициализации библиотеки PAM и задания имени сервиса и целевой
            учётной записи, а также регистрации подходящего способа
            общения.</p></li><li class="listitem"><p>Сервер получает различную информацию, относящуюся к транзакции
            (такую, как имя пользователя аппликанта и имя хоста, на котором
            запущен клиент), и отправляет её в PAM при помощи функции
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_set_item&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_set_item</span>(3)</span></a>.</p></li><li class="listitem"><p>Сервер вызывает функцию <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_authenticate&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_authenticate</span>(3)</span></a>
            для аутентификации аппликанта.</p></li><li class="listitem"><p>Сервер вызывает функцию <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_acct_mgmt&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_acct_mgmt</span>(3)</span></a> для проверки
            того, что запрошенная учётная запись доступна и корректна.  Если
            пароль верен, но его срок истёк, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_acct_mgmt&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_acct_mgmt</span>(3)</span></a> возвратит
            результат <code class="literal">PAM_NEW_AUTHTOK_REQD</code>, а не
            <code class="literal">PAM_SUCCESS</code>.</p></li><li class="listitem"><p>Если на предыдущем шаге был получен результат
            <code class="literal">PAM_NEW_AUTHTOK_REQD</code>, то сервер вызывает функцию
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_chauthtok&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_chauthtok</span>(3)</span></a> для того, чтобы вынудить клиента
            изменить ключ аутентификации для запрошенной учётной записи.</p></li><li class="listitem"><p>Теперь, когда аппликант полностью аутентифицирован, сервер
            вызывает функцию <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_setcred&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_setcred</span>(3)</span></a> для получения
            полномочий запрошенной учётной записи.  Сделать это возможно,
            потому что он работает как арбитратор, и оставляет за собой
            полномочия арбитратора.</p></li><li class="listitem"><p>После получения необходимых полномочий, сервер вызывает функцию
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_open_session&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_open_session</span>(3)</span></a> для установления сеанса.</p></li><li class="listitem"><p>Теперь сервер выполняет тот сервис, который затребовал
            клиент-например, предоставляет аппликанту оболочку.</p></li><li class="listitem"><p>После того, как сервер закончил обслуживание клиента, он
            вызывает функцию <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_close_session&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_close_session</span>(3)</span></a> для закрытия
            сеанса.</p></li><li class="listitem"><p>Наконец, сервер вызывает функцию <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_end&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_end</span>(3)</span></a>
            для оповещения библиотеки PAM о том, что работа с ней завершена и
            какие-либо выделенные в течение сеанса ресурсы можно
            освободить.</p></li></ol></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pam-terms.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="pam-config.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">2. Термины и соглашения </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 4. Настройка PAM</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>