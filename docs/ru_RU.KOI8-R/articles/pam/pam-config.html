<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>4. Настройка PAM</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Подключаемые Модули Аутентификации (PAM)" /><link rel="up" href="index.html" title="Подключаемые Модули Аутентификации (PAM)" /><link rel="prev" href="pam-essentials.html" title="3. Основы PAM" /><link rel="next" href="pam-freebsd-modules.html" title="5. Модули PAM во FreeBSD" /><link rel="copyright" href="pam-legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. Настройка PAM</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="pam-essentials.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="pam-freebsd-modules.html">След.</a></td></tr></table><hr /></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="pam-config"></a>4. Настройка PAM</h2></div></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-config-file"></a>4.1. Файлы политик PAM</h3></div></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-config-pam.conf"></a>4.1.1. Файл
          <code class="filename">/etc/pam.conf</code></h4></div></div></div><p>Традиционно файлом политик PAM является
          <code class="filename">/etc/pam.conf</code>.  Он содержит все политики PAM
          для вашей системы.  Каждая строка файла описывает один шаг в цепочке,
          как показано ниже:</p><pre class="programlisting">login   auth    required        pam_nologin.so  no_warn</pre><p>Поля следуют в таком порядке: имя службы, имя подсистемы,
          управляющий флаг, имя модуля и параметры модуля.  Любые
          дополнительные поля интерпретируются как дополнительные параметры
          модуля.</p><p>Для каждой пары сервис/подсистема составляется отдельная цепочка,
          и тогда получается, что, хотя порядок следования строк для одной и той
          же услуги и подсистемы является значимым, порядок перечисления
          отдельных сервисов не значим.  В примерах из оригинальной
          работы по PAM строки конфигурации сгруппированы по подсистемам, в
          поставляемом с <span class="trademark">Solaris</span>TM файле <code class="filename">pam.conf</code> именно
          так и сделано, но в стандартном конфигурационном файле из поставки
          FreeBSD строки настроек сгруппированы по сервисам.  Подходит любой
          из этих способов; они имеют один и тот же смысл.</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-config-pam.d"></a>4.1.2. Каталог
          <code class="filename">/etc/pam.d</code></h4></div></div></div><p>OpenPAM и Linux-PAM поддерживают альтернативный механизм
          настройки, который для FreeBSD является предпочтительным.  В этой
          схеме каждая политика содержится в отдельном файле с именем,
          соответствующем сервису, к которому она применяется.  Эти файлы
          размещаются в каталоге <code class="filename">/etc/pam.d/</code>.</p><p>Такие файлы политик, ориентированные на сервисы, имеют только
          четыре поля, вместо пяти полей в файле <code class="filename">pam.conf</code>:
          поле имени сервиса опущено.  Таким образом, вместо примера строки
          файла <code class="filename">pam.conf</code> из предыдущего раздела получится
          следующая строка в файле <code class="filename">/etc/pam.d/login</code>:</p><pre class="programlisting">auth    required        pam_nologin.so  no_warn</pre><p>Как следствие такого упрощённого синтаксиса, возможно
          использование одних и тех же политик для нескольких сервисов,
          связывая каждое имя сервиса с тем же самым файлом политик.  К
          примеру, для использования той же самой политики для сервисов
          <code class="literal">su</code> и <code class="literal">sudo</code>, можно сделать
          следующее:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /etc/pam.d</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s su sudo</code></strong></pre><p>Это работает, потому что имя сервиса определяется именем файла, а
          не его указанием в файле политики, так что один и тот же файл может
          использоваться для нескольких сервисов с разными названиями.</p><p>Так как политика каждого сервиса хранится в отдельном файле,
          то механизм <code class="filename">pam.d</code> делает установку
          дополнительных политик для программных пакетов сторонних
          разработчиков очень лёгкой задачей.</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-config-file-order"></a>4.1.3. Порядок поиска политик</h4></div></div></div><p>Как вы видели выше, политики PAM могут находиться в нескольких
          местах.  Что будет, если политики для одного и того же сервиса
          имеются в разных местах?</p><p>Необходимо осознать, что система конфигурации PAM ориентирована
          на цепочки.</p></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-config-breakdown"></a>4.2. Структура строки настройки</h3></div></div></div><p>Как это объяснено в <a class="xref" href="pam-config.html#pam-config-file" title="4.1. Файлы политик PAM">Раздел 4.1, <<Файлы политик PAM>></a>,
        каждая строка файла
        <code class="filename">/etc/pam.conf</code> состоит из четырёх или большего
        количества полей: имени сервиса, имени подсистемы, управляющего флага,
        имени модуля и дополнительных параметров модуля, которые могут
        отсутствовать.</p><p>Имя сервиса обычно (хотя не всегда) является именем приложения,
        которое этот сервис обслуживает.  Если вы не уверены, обратитесь к
        документации по конкретному приложению для определения используемого
        имени сервиса.</p><p>Заметьте, что если вы используете <code class="filename">/etc/pam.d/</code>
        вместо <code class="filename">/etc/pam.conf</code>, то имя сервиса задается
        именем файла политики, и опускается из строк настройки, которые в таком
        случае начинаются с названия подсистемы.</p><p>Имя подсистемы представляет собой одно из четырёх ключевых слов,
        описанных в <a class="xref" href="pam-essentials.html#pam-facilities-primitives" title="3.1. Подсистемы и примитивы">Раздел 3.1, <<Подсистемы и
        примитивы>></a>.</p><p>Точно также управляющий флаг является одним из четырёх ключевых
        слов, описанных в <a class="xref" href="pam-essentials.html#pam-chains-policies" title="3.3. Цепочки и политики">Раздел 3.3, <<Цепочки и политики>></a>,
        в котором рассказано, как
        интерпретировать возвращаемый из модуля код.  В Linux-PAM
        поддерживается альтернативный синтаксис, который позволяет указать
        действие, связанной с каждый возможным кодом возврата, но этого
        следует избегать, так как он не является стандартным и
        тесно связан со способом диспетчеризации вызовов сервисов в Linux-PAM
        (а он значительно отличается от способа взаимодействия в <span class="trademark">Solaris</span>TM и
        OpenPAM).  Не вызывает удивления тот факт, что в OpenPAM этот синтаксис
        не поддерживается.</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-policies"></a>4.3. Политики</h3></div></div></div><p>Для корректной настройки PAM необходимо понимать, как происходит
        интерпретация политик.</p><p>В момент, когда приложение вызывает функцию <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_start&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_start</span>(3)</span></a>,
        библиотека PAM загружает политику для указанного сервиса и выстраивает
        четыре цепочки модулей (по одной для каждой подсистемы).  Если
        одна или большее количество этих цепочек являются пустыми, то
        будут выполняться подстановки соответствующих цепочек из политики для
        сервиса <code class="literal">other</code>.</p><p>Когда затем приложение вызывает одну из шести примитивов PAM,
        библиотека PAM выделяет из цепочки нужную подсистему и вызывает
        функцию, соответствующую сервису, в каждом модуле, перечисленном в
        цепочке, в том порядке, в каком они перечислены в конфигурации.  После
        каждого обращения к функции сервиса, тип модуля и возвращённый из этой
        функции код результата выполнения используются для того, что делать
        дальше.  За некоторыми исключениями, которые будут описаны ниже,
        применяется такая таблица:</p><div class="table"><a id="idp72416592"></a><div class="table-title">Таблица 1. Сводная таблица отработки цепочек PAM</div><div class="table-contents"><table summary="Сводная таблица отработки цепочек PAM" border="1"><colgroup><col class="type" /><col class="success" /><col class="ignore" /><col class="other" /></colgroup><thead><tr><th> </th><th><code class="literal">PAM_SUCCESS</code></th><th><code class="literal">PAM_IGNORE</code></th><th><code class="literal">other</code></th></tr></thead><tbody><tr><td>binding</td><td>if (!fail) break;</td><td>-</td><td>fail = true;</td></tr><tr><td>required</td><td>-</td><td>-</td><td>fail = true;</td></tr><tr><td>requisite</td><td>-</td><td>-</td><td>fail = true; break;</td></tr><tr><td>sufficient</td><td>if (!fail) break;</td><td>-</td><td>-</td></tr><tr><td>optional</td><td>-</td><td>-</td><td>-</td></tr></tbody></table></div></div><br class="table-break" /><p>Если переменная <code class="varname">fail</code> принимает истинное
        значение в конце отработки цепочки, или когда достигнут
        <span class="quote"><<<span class="quote">break</span>>></span>, диспетчер возвращает код ошибки, возвращённый
        первым модулем, отработавшим неудачно.  В противном случае
        возвращается <code class="literal">PAM_SUCCESS</code>.</p><p>Первым исключением является то, что код ошибки
	<code class="literal">PAM_NEW_AUTHTOK_REQD</code> интерпретируется как успешный
        результат, кроме случая, когда модуль отработал успешно, и по крайней
        мере один модуль возвратил <code class="literal">PAM_NEW_AUTHTOK_REQD</code>,
        тогда диспетчер возвратит результат
        <code class="literal">PAM_NEW_AUTHTOK_REQD</code>.</p><p>Вторым исключением является то, что <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_setcred&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_setcred</span>(3)</span></a> считает,
        что модули <code class="literal">binding</code> и <code class="literal">sufficient</code>
        являются равнозначными <code class="literal">required</code>.</p><p>Третьим и последним исключением является то, что функция
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_chauthtok&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_chauthtok</span>(3)</span></a> отрабатывает полную цепочку дважды (один раз для
        предварительных проверок, и ещё раз для реального задания пароля), и
        на подготовительной фазе она считает, что модули
	<code class="literal">binding</code> и <code class="literal">sufficient</code> являются
	равнозначными <code class="literal">required</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pam-essentials.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="pam-freebsd-modules.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">3. Основы PAM </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 5. Модули PAM во FreeBSD</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>