<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>4. Создание файловой системы с нуля</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD и твердотельные устройства" /><link rel="up" href="index.html" title="FreeBSD и твердотельные устройства" /><link rel="prev" href="ro-fs.html" title="3. Подсистема rc и файловые системы в режиме только чтения" /><link rel="next" href="strategies.html" title="5. Стратегии работы с системой для случаев небольших и доступных только для чтения файловых систем" /><link rel="copyright" href="trademarks.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. Создание файловой системы с нуля</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ro-fs.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="strategies.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp72034384"></a>4. Создание файловой системы с нуля</h2></div></div></div><p>Так как совместимые с ATA компактные флэш-карты распознаются во FreeBSD
      как обычные жесткие диски IDE, то теоретически вы можете установить FreeBSD
      по сети при помощи дискет kern и mfsroot или с компакт-диска.</p><p>Однако даже маленькая установка FreeBSD при помощи обычных процедур
      установки может привести к созданию системы размером, превышающим 200
      мегабайт.  Так как большинство людей используют устройства флэш-памяти
      меньшего размера (128 мегабайт считается весьма большим - 32 или даже 16
      мегабайт используются гораздо чаще), то установка обычным образом не
      подходит-просто на диске нет места даже для самой минимальной
      установки.</p><p>Самым простым способом обойти это ограничение на объем является
      установка FreeBSD обычным образом на обычный жесткий диск.  После окончания
      установки, обрежьте операционную систему до размера, который помещается
      на ваш флэш-носитель, а затем полностью заархивируйте файловую систему.
      Следующие шаги поведут вас через процесс подготовки части флэш-памяти
      для вашей заархивированной файловой системы.  Запомните, что из-за того,
      что обычная установка не выполнялась, такие операции, как разбиение
      на разделы, разметка, создание файловой системы и так далее должны быть
      выполнены вручную.  Кроме дискет kern и mfsroot вам также нужно
      воспользоваться дискетой fixit.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Разбиение вашего флэш-носителя на разделы</strong></p><p>После загрузки при помощи дискет kern и mfsroot, выберите пункт
	  <code class="literal">custom</code> из меню установки.  Из следующего пункта
	  меню выберите <code class="literal">partition</code>.  В меню работы с
	  разделами вы должны удалить все существующие разделы при помощи
	  клавиши <span class="keycap"><strong>d</strong></span>.  После удаления всех имеющихся разделов
	  создайте раздел при помощи клавиши <span class="keycap"><strong>c</strong></span> и согласитесь
	  с предлагаемым по умолчанию размером раздела.  Когда вы будете
	  опрошены на предмет типа раздела, удостоверьтесь, что значение типа
	  равно <code class="literal">165</code>.  Теперь запишите эту таблицу разделов
	  на диск, нажав клавишу <span class="keycap"><strong>w</strong></span> (на этом экране эта опция
	  скрыта).  Если вы используете компактную флэш-карту, совместимую
	  с ATA, вы должны выбрать FreeBSD Boot Manager.  Теперь нажмите
	  клавишу <span class="keycap"><strong>q</strong></span> для выхода из меню работы с разделами.
	  Должно быть выдано еще раз меню для выбора менеджера загрузки -
	  повторите то, что вы выбирали ранее.</p></li><li class="step"><p class="title"><strong>Создание файловых систем на вашем устройстве флэш-памяти</strong></p><p>Выйдите из меню установки custom, и из главного меню установки
	  выберите пункт <code class="literal">fixit</code>.  После входа в режим работы
	  fixit, введите следующую команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>disklabel -e /dev/ad0c</code></strong></pre><p>В этот момент вы войдете в редактор vi из-под команды disklabel.
	  Затем, вам нужно добавить строку <code class="literal">a:</code> в конце файла.
	  Эта строка <code class="literal">a:</code> должна выглядеть примерно так:</p><pre class="programlisting">a:      <em class="replaceable"><code>123456</code></em>  0       4.2BSD  0       0</pre><p>Здесь <em class="replaceable"><code>123456</code></em> является числом, в
	  точности совпадающим с тем, что характеризует размер имеющейся записи
	  для <code class="literal">c:</code>.  В общем, вы копируете существующую
	  строку для <code class="literal">c:</code> для строки <code class="literal">a:</code>,
	  не забывая определить fstype как <code class="literal">4.2BSD</code>.
	  Сохраните файл и завершите редактирование.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>disklabel -B -r /dev/ad0c</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/ad0a</code></strong></pre></li><li class="step"><p class="title"><strong>Размещение вашей файловой системы на флэш-носителе</strong></p><p>Смонтируйте только что подготовленный флэш-носитель:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /dev/ad0a /flash</code></strong></pre><p>Подключите эту машину к сети, чтобы можно было перенести наш
	  tar-файл и распаковать его в файловую систему на флэш-носителе.  Вот
	  пример того, как это можно сделать:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig xl0 192.168.0.10 netmask 255.255.255.0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>route add default 192.168.0.1</code></strong></pre><p>Теперь, когда машина находится в сети, перепишите ваш tar-файл.
	  Здесь вы можете столкнуться с некоторой проблемой - если объем вашей
	  флэш-памяти равен, к примеру, 128 мегабайтам, а ваш tar-файл
	  превышает 64 мегабайта, то вы не можете одновременно разместить
	  tar-файл на флэш-носителе и распаковать его - вам не хватит места.
	  Одним из решений этой проблемы, если вы используете FTP, является
	  распаковка файла во время его передачи по FTP.  Если вы передаете
	  файл именно так, то вы никогда не получите на диске одновременно
	  архивный файл и его содержимое:</p><pre class="screen"><code class="prompt">ftp&gt;</code> <strong class="userinput"><code>get tarfile.tar "| tar xvf -"</code></strong></pre><p>Если ваш файл обработан утилитой gzip, вы также можете этого
	  добиться:</p><pre class="screen"><code class="prompt">ftp&gt;</code> <strong class="userinput"><code>get tarfile.tar "| zcat | tar xvf -"</code></strong></pre><p>После того, как вы получили содержимое вашей заархивированной
	  файловой системы на файловой системе флэш-памяти, вы можете
	  размонтировать флэш-память и выполнить перезагрузку:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>umount /flash</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong></pre><p>Полагая, что вы правильно настроили вашу файловую систему при
	  ее построении на обычном диске (с вашей файловой системой,
	  смонтированной в режиме доступа только для чтения, и необходимыми
	  параметрами, присутствующими в ядре) вы должны успешно загрузить вашу
	  встраиваемую систему на основе FreeBSD.</p></li></ol></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ro-fs.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="strategies.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">3. Подсистема <code class="literal">rc</code> и файловые системы в режиме только
      чтения </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 5. Стратегии работы с системой для случаев небольших и доступных
      только для чтения файловых систем</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>