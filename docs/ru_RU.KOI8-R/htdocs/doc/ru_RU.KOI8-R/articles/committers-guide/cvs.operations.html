<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>3. Работа с CVS</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Справочник коммиттера" /><link rel="up" href="index.html" title="Справочник коммиттера" /><link rel="prev" href="committer.types.html" title="2. Типы коммит битов" /><link rel="next" href="conventions.html" title="4. Соглашения и традиции" /><link rel="copyright" href="trademarks.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. Работа с CVS</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="committer.types.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="conventions.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="cvs.operations"></a>3. Работа с CVS</h2></div></div></div><p>Подразумевается, что вы уже имеете опыт базовой работы с CVS.</p><p>Администраторы Главного CVS Репозитория <code class="email">&lt;<a xmlns="" class="email" href="mailto:cvsadm@FreeBSD.org">cvsadm@FreeBSD.org</a>&gt;</code> являются <span class="quote"><<<span class="quote">владельцами</span>>></span> репозитория CVS и
      ответственны за все прямые его изменения (в целях чистки или исправления
      каких-либо вопиющих ошибок коммиттеров при работе с CVS).  Если в
      результате ваших действий с частью репозитория произошел несчастный
      случай, например, после неверной операции <code class="command">cvs import</code>
      или <code class="command">cvs tag</code>, пошлите письмо соответствующей подгруппе
      Администраторы Главного CVS Репозитория <code class="email">&lt;<a xmlns="" class="email" href="mailto:cvsadm@FreeBSD.org">cvsadm@FreeBSD.org</a>&gt;</code> (см. следующую таблицу) и сообщите о проблеме.  В наиболее
      серьезных случаях, касающихся не только какой-либо части репозитория, а
      дерева CVS в целом, вы можете написать Администраторы Главного CVS Репозитория <code class="email">&lt;<a xmlns="" class="email" href="mailto:cvsadm@FreeBSD.org">cvsadm@FreeBSD.org</a>&gt;</code>.  Пожалуйста,
      <span class="emphasis"><em>не надо</em></span> писать группе Администраторы Главного CVS Репозитория <code class="email">&lt;<a xmlns="" class="email" href="mailto:cvsadm@FreeBSD.org">cvsadm@FreeBSD.org</a>&gt;</code> по поводу
      репозиторного копирования и прочих вопросов, которые может решить
      соответствующая подгруппа.</p><p><a id="repomeisters"></a>Напрямую изменять содержимое репозитория может только группа
      CVS-мастеров; для обеспечения этого, только CVS-мастера имеют учетные
      записи на машинах, поддерживающих основной репозиторий.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Адреса, на которые следует посылать запросы, зависят от области
      репозитория, которую требуется поправить:</p><div xmlns="http://www.w3.org/1999/xhtml" class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ncvs@ - репозиторий <code class="filename">
	    /home/ncvs</code>, основные исходные тексты
	  </p></li><li class="listitem"><p>pcvs@ - репозиторий <code class="filename">
	    /home/pcvs</code>, порты</p></li><li class="listitem"><p>dcvs@ - репозиторий <code class="filename">
	    /home/dcvs</code>, документация</p></li><li class="listitem"><p>projcvs@ - репозиторий <code class="filename">
	    /home/projcvs</code>, прочие проекты</p></li></ul></div></div><p>Дерево CVS в настоящее время разделено на четыре независимых
      репозитория: <code class="literal">doc</code>, <code class="literal">ports</code>,
      <code class="literal">projects</code> и <code class="literal">src</code>.  Для удобства
      работы пользователей при распространении через
      <span class="application">CVSup</span> различные деревья комбинируются в
      одно, с одним служебным каталогом <code class="literal">CVSROOT</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Обратите внимание, что модуль <code class="literal">www</code>, содержащий
      исходные тексты
      <a class="link" href="http://www.FreeBSD.org" target="_top">веб-сайта FreeBSD</a>, расположен
      в репозитории <code class="literal">doc</code>.</p></div><p>В настоящее время, все репозитории CVS располагаются на одной машине,
      <code class="systemitem">ncvs.FreeBSD.org</code>, однако, для обеспечения
      возможности в будущем разнести их по физически различным машинам, для
      каждой поддерживается отдельное имя хоста.  Их и следует использовать
      коммиттерам.  Наконец, каждый репозиторий расположен в отдельном каталоге.
      В итоге, общая картина выглядит так:</p><div class="table"><a id="cvs-repositories-and-hosts"></a><div class="table-title">Таблица 1. Репозитории CVS FreeBSD, хосты и каталоги</div><div class="table-contents"><table summary="Репозитории CVS FreeBSD, хосты и каталоги" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Репозиторий</th><th>Хост</th><th>Каталог</th></tr></thead><tbody><tr><td>doc</td><td>dcvs.FreeBSD.org</td><td>/home/dcvs</td></tr><tr><td>ports</td><td>pcvs.FreeBSD.org</td><td>/home/pcvs</td></tr><tr><td>projects</td><td>projcvs.FreeBSD.org</td><td>/home/projcvs</td></tr><tr><td>src</td><td>ncvs.FreeBSD.org</td><td>/home/ncvs</td></tr></tbody></table></div></div><br class="table-break" /><p>Операции с CVS производятся удаленно, путем установки переменной
      окружения <code class="envar">CVSROOT</code> (она должна указывать на соответствующий
      хост и каталог верхнего уровня, например
      <code class="systemitem">ncvs.FreeBSD.org</code><code class="literal">:</code><code class="filename">/home/ncvs</code>)
      и последующего выполнения команд выгрузки и коммита.  Многие коммиттеры
      определяют команды-синонимы, разворачивающиеся в запуск
      <span class="application">cvs</span> с правильными параметрами.  В частности,
      пользователи оболочки <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcsh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcsh</span>(1)</span></a> могут добавить следующие строки в
      свой скрипт начальной загрузки <code class="filename">.cshrc</code>:</p><pre class="programlisting">alias dcvs cvs -d <em class="replaceable"><code>user</code></em>@dcvs.FreeBSD.org:/home/dcvs
alias pcvs cvs -d <em class="replaceable"><code>user</code></em>@pcvs.FreeBSD.org:/home/pcvs
alias projcvs cvs -d <em class="replaceable"><code>user</code></em>@projcvs.FreeBSD.org:/home/projcvs
alias scvs cvs -d <em class="replaceable"><code>user</code></em>@ncvs.FreeBSD.org:/home/ncvs</pre><p>Теперь все операции с CVS могут выполняться на локальной машине,
      а для внесения изменений в официальное дерево CVS следует использовать
      команду <code class="command"><em class="replaceable"><code>X</code></em>cvs commit</code>.
      Если вам нужно добавить в проект что-либо совершенно новое (например,
      исходные тексты сторонних разработчиков), нужно использовать команду
      <code class="command">cvs import</code>; обратитесь к странице справочника по
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cvs&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cvs</span>(1)</span></a> за подробностями.</p><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Пожалуйста, <span class="emphasis"><em>не используйте</em></span> команды
	<code class="command">cvs checkout</code> или
	<code class="command">cvs update</code> для синхронизации ваших исходных текстов.
	Протокол CVS не оптимизирован для удаленной работы и требует
	значительных накладных расходов со стороны сервера.  Пожалуйста,
	используйте метод синхронизации посредством <code class="command">cvsup</code>,
	а основной хост используйте только для собственно коммитов.
	Наша распределенная сеть серверов cvsup достаточно развита. При
	необходимости синхронизации с самыми свежими изменениями вы можете
	пользоваться машиной <code class="systemitem">cvsup-master</code>, которая обладает
	достаточными ресурсами для удаленной работы с CVS; за нее отвечает
	Jun Kuriyama <code class="email">&lt;<a xmlns="" class="email" href="mailto:kuriyama@FreeBSD.org">kuriyama@FreeBSD.org</a>&gt;</code>.
      </p></div><p>Если вам нужно использовать команды CVS <code class="command">add</code> и
      <code class="command">delete</code>, так чтобы в реальности переместить часть
      исходных текстов подобно действию команды <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mv&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">mv</span>(1)</span></a>, нужно запросить
      операцию <span class="quote"><<<span class="quote">репозиторного копирования</span>>></span> (repository copy).
      При этом кто-либо из <a class="link" href="cvs.operations.html#repomeisters">CVS-мастеров</a>
      скопирует необходимые файлы внутри репозитория на нужное место и даст вам
      знать об этом.  Репозиторное копирование производится для сохранения
      истории (журналов изменения).  Возможность отследить историю изменений
      очень ценна для всего проекта FreeBSD.</p><p>Документация по CVS, учебные материалы и FAQ можно найти по адресу:
      <code class="uri"><a class="uri" href="http://www.cvshome.org/docs/" target="_top">http://www.cvshome.org/docs/</a></code>.
      Очень полезна также книга Карла Фогеля (Karl Fogel)
      <a class="link" href="http://cvsbook.red-bean.com/cvsbook.html" target="_top">Open Source
      Development with CVS</a>.
      Некоторая полезная информация о CVS на русском языке может быть найдена
      <a class="link" href="http://alexm.here.ru/cvs-ru/" target="_top">здесь</a>.</p><p>Dag-Erling C. Smorgrav <code class="email">&lt;<a xmlns="" class="email" href="mailto:des@FreeBSD.org">des@FreeBSD.org</a>&gt;</code> написал такой <span class="quote"><<<span class="quote">мини-пример</span>>></span> работы с CVS:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Извлечение нужного модуля из репозитория: команда
	  <code class="command">co</code> или <code class="command">checkout</code>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs checkout shazam</code></strong></pre><p>Эта команда извлечет копию модуля <code class="filename">shazam</code>.
	  Если модуль с таким именем не существует (не описан в файле modules),
	  будет произведена попытка извлечь директорию верхнего уровня
	  <code class="filename">shazam</code>.</p><div class="table"><a id="idp72196048"></a><div class="table-title">Таблица 2. Полезные опции команды <code class="command">cvs checkout</code></div><div class="table-contents"><table summary="Полезные опции команды cvs checkout" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="option">-P</code></td><td>Не создавать (точнее, удалить после завершения
		  выполнения) пустые каталоги</td></tr><tr><td><code class="option">-l</code></td><td>Извлекать один уровень каталогов (без
		  подкаталогов)</td></tr><tr><td><code class="option">-r<em class="replaceable"><code>rev</code></em></code></td><td>Извлечь ревизию, ветвь или тег
		  <em class="replaceable"><code>rev</code></em> для указанного модуля</td></tr><tr><td><code class="option">-D<em class="replaceable"><code>date</code></em></code></td><td>Извлечь состояние модуля в репозитории на момент
		  <em class="replaceable"><code>date</code></em></td></tr></tbody></table></div></div><br class="table-break" /><p>Примеры в применении к FreeBSD:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Извлечь модуль <code class="filename">miscfs</code>, расположенный в
	      каталоге репозитория <code class="filename">src/sys/miscfs</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs co miscfs</code></strong></pre><p>После выполнения вы получите каталог
	      <code class="filename">miscfs</code>, содержащий подкаталоги
	      <code class="filename">CVS</code>, <code class="filename">deadfs</code>,
	      <code class="filename">devfs</code> и т.д.  Один из них
	      (<code class="filename">linprocfs</code>) будет пустым.</p></li><li class="listitem"><p>Извлечь те же файлы, но с полным путем:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs co src/sys/miscfs</code></strong></pre><p>Теперь у вас есть каталог <code class="filename">src</code>,
	      содержащий подкаталоги <code class="filename">CVS</code> и
	      <code class="filename">sys</code>.  Каталог <code class="filename">src/sys</code>
	      содержит подкаталоги <code class="filename">CVS</code> и
	      <code class="filename">miscfs</code> и т.д.</p></li><li class="listitem"><p>Извлечь те же файлы, удалив при этом пустые
	      подкаталоги:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs co -P miscfs</code></strong></pre><p>Вы получите каталог
	      <code class="filename">miscfs</code> с подкаталогами
	      <code class="filename">CVS</code>, <code class="filename">deadfs</code>,
	      <code class="filename">devfs</code>... однако без подкаталога
	      <code class="filename">linprocfs</code>, поскольку он не содержит файлов.</p></li><li class="listitem"><p>Извлечь каталог <code class="filename">miscfs</code> без
	      подкаталогов:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs co -l miscfs</code></strong></pre><p>Теперь в каталоге <code class="filename">miscfs</code> будет только
	      один подкаталог <code class="filename">CVS</code>.</p></li><li class="listitem"><p>Извлечь модуль <code class="filename">miscfs</code> из ветви
	      6.X:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs co -rRELENG_6 miscfs</code></strong></pre><p>Теперь вы можете изменить исходные тексты и произвести коммит
	      в эту ветвь.</p></li><li class="listitem"><p>Извлечь модуль <code class="filename">miscfs</code> по состоянию на
	      момент выхода 6.0-RELEASE:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs co -rRELENG_6_0_0_RELEASE miscfs</code></strong></pre><p>В этом случае вы не сможете внести изменения в репозиторий,
	      поскольку <code class="literal">RELENG_6_0_0_RELEASE</code> описывает
	      момент времени, а не ветвь разработки.</p></li><li class="listitem"><p>Извлечь модуль <code class="filename">miscfs</code> по состоянию на
	      15 января 2000 г:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs co -D'01/15/2000' miscfs</code></strong></pre><p>Как и в предыдущем случае, изменения не могут быть
	      записаны.</p></li><li class="listitem"><p>Извлечь модуль <code class="filename">miscfs</code>, каким он был
	      неделю назад:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs co -D'last week' miscfs</code></strong></pre><p>И вновь, изменения не могут быть записаны.</p></li></ul></div><p>Обратите внимание, что мета-данные хранятся в подкаталогах
	  <code class="filename">CVS</code>.</p><p>Аргументы опций <code class="option">-D</code> and <code class="option">-r</code>
	  сохраняются (являются <span class="quote"><<<span class="quote">клейкими</span>>></span>, sticky), например,
	  при последующем использовании команды
	  <code class="command">cvs update</code>.</p></li><li class="listitem"><p>Проверка состояния извлеченных файлов: команда
	  <code class="command">status</code>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs status shazam</code></strong></pre><p>Эта команда покажет статус файла <code class="filename">shazam</code>
	  или каждого файла в директории <code class="filename">shazam</code>.
	  Для каждого из файлов статус может быть одним из:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td>Up-to-date</td><td>Файл соответствует репозиторию и не
		  модифицировался</td></tr><tr><td>Needs Patch</td><td>Файл не изменялся, но репозиторий содержит обновленную
		  версию</td></tr><tr><td>Locally Modified</td><td>Файл соответствует репозиторию, но был изменен
		  локально</td></tr><tr><td>Needs Merge</td><td>Файл изменен локально; вместе с тем, файл изменен и в
		  репозитории</td></tr><tr><td>File had conflicts on merge</td><td>После последнего обновления возникли конфликты, и они
		  все еще не устранены</td></tr></tbody></table></div><p>Кроме того, будут показаны локальная версия и дата модификации,
	  версия и дата последней из доступных (если вы применяли
	  <span class="quote"><<<span class="quote">клейкие</span>>></span> дату, тег или ветвь, последняя доступная версия
	  может отличаться от вашей), а также клейкие теги, временные метки
	  и опции.</p></li><li class="listitem"><p>Обновление извлеченного модуля: команда
	  <code class="command">update</code>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs update shazam</code></strong></pre><p>Эта команда обновит состояние файла <code class="filename">shazam</code>
	  или файлов в каталоге <code class="filename">shazam</code> до наиболее
	  свежих версий выбранной вами при извлечении ветви.  Если выбирался
	  <span class="quote"><<<span class="quote">момент времени</span>>></span>, не произойдет ничего, если только
	  за истекшее время в репозитории не был перемещен тег или не
	  произошло чего-нибудь еще непредвиденного.</p><p>Полезные опции в дополнение к уже описанным для команды
	  <code class="command">checkout</code>:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="option">-d</code></td><td>Извлечь вновь появившиеся или пропущенные ранее
		  подкаталоги</td></tr><tr><td><code class="option">-A</code></td><td>Обновиться до текущего состояния головной ветви</td></tr><tr><td><code class="option">-j<em class="replaceable"><code>rev</code></em></code></td><td>магическая опция (см. ниже)</td></tr></tbody></table></div><p>Если вы извлекали модуль с опциями <code class="option">-r</code> или
	  <code class="option">-D</code>, выполнение команды <code class="command">cvs update</code>
	  с другими параметрами <code class="option">-r</code> или <code class="option">-D</code>
	  или с опцией <code class="option">-A</code> приведет к выбору новой ветви,
	  ревизии или даты.  Использование опции <code class="option">-A</code>
	  удаляет использованные ранее клейкие свойства; опции
	  <code class="option">-r</code> и <code class="option">-D</code>, наоборот, фиксируют
	  их.</p><p>Теоретически использование <code class="literal">HEAD</code> в качестве
	  аргумента опции <code class="option">-r</code> должно дать тот же результат, что
	  и указание опции <code class="option">-A</code>, однако это верно лишь
	  в теории.</p><p>Опция <code class="option">-d</code> полезна, если:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>после извлечения вами модуля кем-либо еще в него были
	      добавлены дополнительные каталоги;</p></li><li class="listitem"><p>вы извлекали верхний уровень модуля при помощи опции
	      <code class="option">-l</code>, а в дальнейшем решили извлечь и
	      подкаталоги;</p></li><li class="listitem"><p>вы удалили какие-либо подкаталоги и теперь хотите
	      вновь извлечь их.</p></li></ul></div><p><span class="emphasis"><em>Обращайте внимание на вывод команды <code class="command">cvs
	  update</code>.</em></span>  Действие, произведенное с файлом,
	  обозначается буквой перед его именем:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="literal">U</code></td><td>Файл был успешно обновлен.</td></tr><tr><td><code class="literal">P</code></td><td>Файл был успешно обновлен (произведен успешный патч
		  из удаленного репозитория).</td></tr><tr><td><code class="literal">M</code></td><td>Файл был изменен, и при этом обновлен успешно.</td></tr><tr><td><code class="literal">C</code></td><td>Файл был изменен, и при объединении изменений возникли
		  конфликты.</td></tr></tbody></table></div><p>Объединение (merging) производится, если вы выгрузили рабочую
	  копию какого-то модуля, изменили его, затем кто-либо еще произвел
	  коммит собственных изменений, и, наконец, вы выполняете команду
	  <code class="command">cvs update</code>.  CVS знает, что производились локальные
	  изменения, и пытается объединить ваши изменения с теми, что произошли
	  в репозитории (от состоянии версии, которую вы выгружали, до версии,
	  до которой вы пытаетесь обновиться).  Если изменения происходили с
	  различными частями файла, объединение почти всегда произойдет успешно
	  (хотя результат при этом может не быть синтаксически или семантически
	  корректным).</p><p>CVS выводит букву <code class="literal">M</code> перед именем всех локально
	  измененных файлов, даже если у них нет новых версий в репозитории,
	  так что команда <code class="command">cvs update</code> удобна для быстрого
	  получения списка файлов, которые вы изменяли.</p><p>Если в результате вы видите букву <code class="literal">C</code>, ваши
	  изменения конфликтуют с изменениями, внесенными в репозиторий
	  (изменения были в одних и тех же или рядом расположенных строках,
	  либо вы изменили файл настолько, что при сравнении
	  <code class="command">cvs</code> не смогла удержать контекст и приложить
	  изменения из репозитория).  Вам необходимо устранить конфликты,
	  вручную редактируя файл.  Конфликтующие фрагменты помечаются
	  строками из знаков <code class="literal">&lt;</code>, <code class="literal">=</code> и
	  <code class="literal">&gt;</code>.  В начале каждого из конфликтов присутствует
	  строка из семи знаков <code class="literal">&lt;</code> и имени файла, затем
	  идет фрагмент, содержащий внесенные вами изменения, разделитель
	  из семи знаков <code class="literal">=</code>, соответствующий фрагмент из
	  версии файла, содержащейся в репозитории, и, наконец, строка из семи
	  знаков <code class="literal">&gt;</code> совместно с номером версии, до которой
	  вы обновляли файл.</p><p>Опция <code class="option">-j</code> содержит некоторое количество черной
	  магии.  При ее наличии локальный файл обновляется до указанной версии
	  так же, как и при использовании опции <code class="option">-r</code>, но
	  отслеживаемые номер версии или ветвь не изменяются.  Эта опция умеет
	  смысл лишь при парном использовании: при этом делается попытка
	  применить изменения между двумя указанными версиями к локальной
	  копии файла.</p><p>К примеру, вы внесли изменения и произвели коммит в файл
	  <code class="filename">shazam/shazam.c</code> в FreeBSD-CURRENT, а позднее
	  хотите перенести обновления в FreeBSD-STABLE (Merge-From-Current, MFC).
	  Версия, которая требует переноса - 1.15:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Извлеките текущую версию модуля <code class="filename">shazam</code>
	      для ветви FreeBSD-STABLE:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs co -rRELENG_6 shazam</code></strong></pre></li><li class="listitem"><p>Приложите изменения между версиями 1.14 и 1.15:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs update -j1.14 -j1.15 shazam/shazam.c</code></strong></pre></li></ul></div><p>Почти наверняка вы получите конфликт в строках, содержащих
	  идентификатор файла (<code class="literal">$Id: article.xml,v 1.19 2007-05-09 06:08:50 bvs Exp $</code> или, в случае FreeBSD,
	  <code class="literal">$FreeBSD$</code>).
	  Вам потребуется отредактировать файл для устранения конфликта
	  (в данном случае достаточно убрать строки-разделители и вторую строку
	  <code class="literal">$Id: article.xml,v 1.19 2007-05-09 06:08:50 bvs Exp $</code>, оставив лишь строку с <code class="literal">$Id: article.xml,v 1.19 2007-05-09 06:08:50 bvs Exp $</code>
	  для FreeBSD-STABLE).</p></li><li class="listitem"><p>Просмотр изменение между локальной версией и версией из
	  репозитория: команда <code class="command">diff</code>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs diff shazam</code></strong></pre><p>Эта команда покажет все отличия локального состояния файла (или
	  файлов модуля) <code class="filename">shazam</code> от состояния, сохраненного
	  в репозитории.</p><div class="table"><a id="idp72529616"></a><div class="table-title">Таблица 3. Полезные опции команды <code class="command">cvs diff</code></div><div class="table-contents"><table summary="Полезные опции команды cvs diff" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="option">-u</code></td><td>Использовать унифицированный (unified) формат.</td></tr><tr><td><code class="option">-c</code></td><td>Использовать контекстный (context) формат.</td></tr><tr><td><code class="option">-N</code></td><td>Показывать отсутствующие или созданные файлы.</td></tr></tbody></table></div></div><br class="table-break" /><p>Всегда имеет смысл пользоваться опцией <code class="option">-u</code>,
	  поскольку унифицированный формат гораздо удобнее и лучше читаем,
	  чем почти все другие (в некоторых случаях контекстный формат,
	  генерируемый опцией <code class="option">-c</code> может быть несколько лучше,
	  но он гораздо более громоздок).  Унифицированный формат различий
	  состоит из серии фрагментов, каждый из которых начинается со строки,
	  состоящей из двух символов <code class="literal">@</code> и номеров строк,
	  описывающих положение изменившегося участка.  Затем следует группа
	  строк: те, что начинаются с пробела, описывают контекст, начинающиеся
	  с символа <code class="literal">-</code> определяют удаленные строки, наконец,
	  начинающиеся с символа <code class="literal">+</code> -
	  добавленные.</p><p>Вы можете сравнивать текущее состояние с версией, отличающейся
	  от той, с которой вы извлекали файл, указав опцию <code class="option">-r</code>
	  или <code class="option">-D</code> подобно командам <code class="command">checkout</code>
	  и <code class="command">update</code>, или даже получить список изменений между
	  любыми двумя версиями (вне зависимости от того, что лежит в вашей
	  локальной копии), указав <span class="emphasis"><em>две</em></span> версии при помощи
	  опций <code class="option">-r</code> или <code class="option">-D</code>.</p></li><li class="listitem"><p>Просмотр журнала изменений: команда <code class="command">log</code>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs log shazam</code></strong></pre><p>Если <code class="filename">shazam</code> является обычным файлом, эта
	  команда выдаст на экран <span class="emphasis"><em>заголовок</em></span> с информацией
	  о файле, в частности, его местоположении в репозитории, какая версия
	  соответствует текущему состоянию (<code class="literal">HEAD</code>), в каких
	  ветвях разработки файл присутствует, а также перечислит теги, которыми
	  он помечен.  Затем, для каждой версии файла выводится соответствующее
	  ей журнальное сообщение, включающее дату, время и автора коммита,
	  количество добавленных и удаленных строк и собственно журнального
	  сообщения, написанного коммиттером.</p><p>Если <code class="filename">shazam</code> является каталогом, вышеописанная
	  процедура выполняется для каждого файла в каталоге.  Если при этом
	  команде <code class="command">log</code> не был указан флаг <code class="option">-l</code>,
	  процедура рекурсивно повторяется для всех подкаталогов.</p><p>Команда <code class="command">log</code> используется для просмотра истории
	  одного или нескольких файлов в том виде, как она сохранена в
	  репозитории CVS.  Используя опцию
	  <code class="option">-r<em class="replaceable"><code>rev</code></em></code>, вы можете
	  посмотреть журнальное сообщение к одной определенной версии:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs log -r1.2 shazam</code></strong></pre><p>Эта команда покажет журнальное сообщение для версии
	  <code class="literal">1.2</code> файла <code class="filename">shazam</code> (или для
	  версий <code class="literal">1.2</code> каждого из файлов в каталоге
	  <code class="filename">shazam</code>).</p></li><li class="listitem"><p>Кто что делал: команда <code class="command">annotate</code>.
	  Эта команда показывает перед каждой строкой указанного файла (файлов)
	  имя пользователя, вносившего последние изменения в эту строку.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs annotate shazam</code></strong></pre></li><li class="listitem"><p>Добавление новых файлов: команда <code class="command">add</code>.</p><p>Создайте файл, выполните для него команду
	  <code class="command">cvs add</code>, затем произведите запись в репозиторий
	  (коммит): <code class="command">cvs commit</code>.</p><p>Точно так же, новые каталоги добавляются в репозиторий путем
	  создания и последующего выполнения команды <code class="command">cvs add</code>.
	  Заметьте, что выполнять коммит после добавления каталога не
	  надо.</p></li><li class="listitem"><p>Удаление устаревших файлов: команда
	  <code class="command">remove</code>.</p><p>Удалите файл, затем выполните команду <code class="command">cvs rm</code>
	  с его именем в качестве параметра, наконец, выполните для него
	  <code class="command">cvs commit</code>.</p></li><li class="listitem"><p>Внесение изменений в репозиторий: команда
	  <code class="command">commit</code> или <code class="command">checkin</code>.</p><div class="table"><a id="idp72630736"></a><div class="table-title">Таблица 4. Useful <code class="command">cvs commit</code> options</div><div class="table-contents"><table summary="Useful cvs commit options" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="option">-f</code></td><td>Форсировать внесение изменений для не модифицированного
		  файла.</td></tr><tr><td><code class="option">-m<em class="replaceable"><code>msg</code></em></code></td><td>Указать сообщение для журнала в командной строке (не
		  запускать текстовый редактор).</td></tr></tbody></table></div></div><br class="table-break" /><p>Опцию <code class="option">-f</code> следует использовать, если вы поняли,
	  что забыли указать какую-либо важную информацию в журнале
	  изменений.</p><p>Хорошие журнальные сообщения очень важны.  Они дают возможность
	  другим узнать, зачем вы производили изменения, причем не только в
	  момент их произведения, но и месяцы или годы спустя, когда кто-либо
	  заинтересуется, почему выглядящий нелогично или неэффективно фрагмент
	  кода попал в каши исходные тексты.  Кроме того, это очень помогает
	  в оценке того, нужно ли переносить соответствующий код в FreeBSD-STABLE
	  (MFC).</p><p>Сообщения должны быть ясными, краткими, четкими, и представлять
	   из себя разумную аннотацию, какие изменения были произведены и
	   почему.</p><p>Сообщения должны достаточно ясно показывать сторонним
	  разработчикам, насколько их касаются изменения и нужно ли
	  им исследовать изменения подробно.</p><p>Избегайте внесения нескольких не связанных друг с другом
	  изменений за один раз.  Это затрудняет объединение изменений,
	  а также, при обнаружении ошибок, усложняет поиск ответственного
	  за ошибки участка.</p><p>Избегайте смешивания в одном коммите изменений функциональности
	  со стилистическими правками или исправлениями в пробелах.
	  Это усложняет объединение, и, кроме того, затрудняет понимание того,
	  какие именно функциональные изменения были внесены.  В случае коммита
	  в файлы документации, это затруднит работу групп поддержки перевода,
	  поскольку становится сложнее отделить изменения, требующие
	  перевода.</p><p>Избегайте коммита большой группы файлов за один раз с одним
	  общим и невнятным сообщением.  Напротив, вносите изменения в отдельные
	  файлы (или небольшие группы связанных файлов) с адекватными
	  сообщениями для журналирования.</p><p>Перед коммитом, <span class="emphasis"><em>обязательно</em></span>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>проверьте, что вы будете выполнять коммит в правильную ветвь,
	      посредством команды <code class="command">cvs status</code>.</p></li><li class="listitem"><p>проверьте ваши изменения при помощи команды
	      <code class="command">cvs diff</code></p></li></ul></div><p>Кроме того, ВСЕГДА указывайте, в какие именно файлы вы вносите
	  изменения, так чтобы не включить в этот список лишних файлов.
	  Команда <code class="command">cvs commit</code> без аргументов включит
	  все измененные файлы в текущем каталоге и всех подкаталогах.
	</p></li></ol></div><p>Еще несколько полезных советов:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Часто используемые опции можно занести в файл
	  <code class="filename">~/.cvsrc</code>, например:</p><pre class="programlisting">cvs -z3
diff -Nu
update -Pd
checkout -P</pre><p>Для данного случая:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>всегда использовать компрессию уровня 3 для связи с удаленным
	      сервером CVS.  В случае медленного соединения это избавит вас от
	      лишней головной боли.</p></li><li class="listitem"><p>всегда использовать опции <code class="option">-N</code> (показывать
	      добавленные или удаленные файлы) и <code class="option">-u</code>
	      (унифицированный формат) для <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a>.</p></li><li class="listitem"><p>всегда использовать опции <code class="option">-P</code> (удалять пустые
	      каталоги) и <code class="option">-d</code> (добавлять новые каталоги)
	      при обновлении.</p></li><li class="listitem"><p>всегда использовать опцию <code class="option">-P</code> (удалять пустые
	      каталоги) при извлечении файлов и модулей.</p></li></ul></div></li><li class="listitem"><p>Пользуйтесь скриптом Эйвинда Эклунда (Eivind Eklund)
	  <code class="command">cdiff</code> для просмотра изменению унифицированного
	  формата.  Он является оберткой для <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=less&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">less</span>(1)</span></a>, добавляющей
	  цветовые коды ANSI для выделения заголовком, добавленных и удаленных
	  строк; прочие строки не модифицируются.  Помимо этого, скрипт
	  корректно разворачивает табуляции (которые часто выглядят неправильно
	  в изменениях из-за дополнительного символа в начале строки).</p><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/textproc/cdiff/pkg-descr">textproc/cdiff</a></p><p>Просто используйте его вместо <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=more&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">more</span>(1)</span></a> или <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=less&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">less</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs diff -Nu shazam | cdiff</code></strong></pre><p>Помимо этого, некоторые текстовые редакторы, такие как <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vim&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">vim</span>(1)</span></a>
	  (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/editors/vim/pkg-descr">editors/vim</a>) поддерживают
	  цветовую синтаксическую разметку многих типов файлов, в том числе
	  файлов изменений и журналов CVS/RCS.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>echo "syn on" &gt;&gt; ~/.vimrc </code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cvs diff -Nu shazam | vim -</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cvs log shazam | vim -</code></strong> </pre></li><li class="listitem"><p>CVS - старая, загадочная и порой слабо предсказуемая
	  в своем поведении программа. 
	  Ни один человек не способен удержать в голове все тонкости ее работы,
	  так что не бойтесь спрашивать совета у Искусственного Интеллекта
	  (а именно Администраторы Главного CVS Репозитория <code class="email">&lt;<a xmlns="" class="email" href="mailto:cvsadm@FreeBSD.org">cvsadm@FreeBSD.org</a>&gt;</code>).</p></li><li class="listitem"><p>Не оставляйте компьютер в процессе работы команды
	  <code class="command">cvs commit</code> (в редакторе при написании журнального
	  сообщения) слишком надолго (более чем на 2-3 минуты).  Эта
	  команда блокирует каталог репозитория, в котором она запущена, и не
	  позволяет другим разработчикам изменять его содержимое.  Если вам
	  нужно написать длинное журнальное сообщение, подготовьте его заранее
	  и вставьте в редакторе во время выполнения команды
	  <code class="command">cvs commit</code>, либо запишите его в файл и используйте
	  опцию CVS <code class="option">-F</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>vi logmsg</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cvs ci -F logmsg shazam</code></strong></pre><p>Это самый быстрый способ передать журнальное сообщение CVS;
	  однако, вы должны быть внимательны при редактировании файла
	  <code class="filename">logmsg</code>, поскольку при выполнении коммита
	  у вас не будет шансов его поправить.</p></li><li class="listitem"><p>Вы можете существенно ускорить скорость работы CVS с центральным
	  репозиторием, используя постоянное соединение с репозиторием.
	  Для этого добавьте в файл <code class="filename">~/.ssh/config</code> строки
	</p><pre class="programlisting">Host ncvs.FreeBSD.org
      ControlPath /home/<em class="replaceable"><code>user</code></em>/.ssh/cvs.cpath
Host dcvs.FreeBSD.org
      ControlPath /home/<em class="replaceable"><code>user</code></em>/.ssh/cvs.cpath
Host projcvs.FreeBSD.org
      ControlPath /home/<em class="replaceable"><code>user</code></em>/.ssh/cvs.cpath
Host pcvs.FreeBSD.org
      ControlPath /home/<em class="replaceable"><code>user</code></em>/.ssh/cvs.cpath</pre><p>Затем откройте постоянное соединение с машиной repoman:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh -fNM ncvs.FreeBSD.org</code></strong></pre><p>Теперь команды CVS должны выполняться быстрее, поскольку
	  используют существующее соединение с репозиторием.  Учтите, что
	  регистр в именах хостов имеет значение.</p></li></ol></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="committer.types.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="conventions.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">2. Типы коммит битов </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 4. Соглашения и традиции</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>