<?xml version="1.0" encoding="koi8-r" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=koi8-r" /><title>12.16. Использование и отладка FreeBSD ACPI</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Руководство FreeBSD" /><link rel="up" href="config-tuning.html" title="Глава 12. Настройка и оптимизация" /><link rel="prev" href="acpi-overview.html" title="12.15. Управление питанием и ресурсами" /><link rel="next" href="boot.html" title="Глава 13. Процесс загрузки FreeBSD" /><link rel="copyright" href="legalnotice.html" title="Юридическое уведомление" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">12.16. Использование и отладка FreeBSD <acronym class="acronym">ACPI</acronym></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="acpi-overview.html">Пред.</a> </td><th width="60%" align="center">Глава 12. Настройка и оптимизация</th><td width="20%" align="right"> <a accesskey="n" href="boot.html">След.</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ACPI-debug"></a>12.16. Использование и отладка FreeBSD <acronym class="acronym">ACPI</acronym></h2></div><div><span class="authorgroup">Написал <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Nate</span> <span class="surname">Lawson</span></span>. </span></div><div><span class="authorgroup">При помощи <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Peter</span> <span class="surname">Schultz</span></span>  <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><p><acronym class="acronym">ACPI</acronym> это фундаментально новый способ
      обнаружения устройств, управления энергопотреблением и предоставления
      стандартизированного доступа к различному оборудованию,
      ранее управлявшемуся <acronym class="acronym">BIOS</acronym>.  Был достигнут
      определенный прогресс в приспособлении <acronym class="acronym">ACPI</acronym>
      к работе со всеми системами, но все еще встречаются ошибки
      в байткоде <em class="firstterm"><acronym class="acronym">ACPI</acronym> Machine
      Language</em> (<acronym class="acronym">AML</acronym>) некоторых материнских плат,
      незавершенные участки кода в подсистемах ядра FreeBSD и ошибки в
      интерпретаторе <span class="trademark">Intel</span>(R) <acronym class="acronym">ACPI-CA</acronym>.</p><p>Этот раздел предназначен для того, чтобы упростить ваше
      содействие разработчикам FreeBSD <acronym class="acronym">ACPI</acronym> в
      определении причин наблюдаемых вами проблем, выполнении отладки
      и выработке решения.  Спасибо за помощь и надеемся, что мы сможем
      помочь в решении проблем вашей системы.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-submitdebug"></a>12.16.1. Отправка отладочной информации</h3></div></div></div><div xmlns="" class="note"><h3 class="admontitle">Примечание: </h3><p xmlns="http://www.w3.org/1999/xhtml">Перед отправкой сообщения об ошибке убедитесь, что
	  у вас последняя версия <acronym class="acronym">BIOS</acronym>, и, если
	  доступна, последняя версия firmware встроенного
	  контроллера.</p></div><p>Те из вас, кто желает составить сообщение о проблеме прямо
	сейчас, могут воспользоваться адресом
	<a class="link" href="mailto:freebsd-acpi@FreeBSD.org" target="_top">
	freebsd-acpi@FreeBSD.org</a>, отправив на него следующую
	информацию:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Описание неправильного поведения, включая тип системы, модель
	    и все, что приводит к появлению ошибки.  Кроме того, сообщите
	    настолько точно, насколько возможно, когда появилась ошибка,
	    если ранее вы ее не видели.</p></li><li class="listitem"><p>Вывод <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> после <span class="quote"><<<span class="quote">boot
	    <code class="command">-v</code></span>>></span>, включая все сообщения, появившиеся
	    при изучении ошибки.</p></li><li class="listitem"><p>Вывод <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> после <span class="quote"><<<span class="quote">boot
	    <code class="command">-v</code></span>>></span> с выключенным <acronym class="acronym">ACPI</acronym>,
	    если его отключение помогает решить проблему.</p></li><li class="listitem"><p>Вывод <code class="command">sysctl hw.acpi</code>.  Это также хороший
	    способ получения списка возможностей системы.</p></li><li class="listitem"><p><acronym class="acronym">URL</acronym> где можно найти ваш
	    <em class="firstterm"><acronym class="acronym">ACPI</acronym> Source Language</em>
	    (<acronym class="acronym">ASL</acronym>).  <span class="emphasis"><em>Не</em></span> отправляйте
	    <acronym class="acronym">ASL</acronym> непосредственно в список рассылки,
	    поскольку он может быть очень большим.  Копия
	    <acronym class="acronym">ASL</acronym> может быть создана командой:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>acpidump -t -d &gt; <em class="replaceable"><code>name</code></em>-<em class="replaceable"><code>system</code></em>.asl</code></strong></pre><p>(Замените вашим логином
	    <code class="filename">name</code> и производителем/моделью
	    <code class="filename">system</code>.  Пример:
	    <code class="filename">njl-FooCo6000.asl</code>)</p></li></ul></div><p>Большинство разработчиков читают <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">Список рассылки, посвящённый обсуждению FreeBSD-CURRENT</a>,
	но для уверенности, что проблему увидят, отправьте ее в
	<a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a>.  Будьте терпеливы, все мы заняты полный рабочий день где-то
	еще.  Если ваше сообщение не заметили сразу, мы возможно
	попросим вас отправить <acronym class="acronym">PR</acronym> (сообщение о проблеме)
	через <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=send-pr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">send-pr</span>(1)</span></a>.  При вводе <acronym class="acronym">PR</acronym>,
	включайте ту же информацию, что запрошена выше.  Это поможет
	нам отследить проблему и решить ее.  Не отправляйте
	<acronym class="acronym">PR</acronym> без предварительной отправки письма в
	<a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a>, поскольку мы используем <acronym class="acronym">PR</acronym> в качестве
	напоминаний о существующих проблемах, а не как механизм сообщений
	об ошибках.  Вероятно, о вашей проблеме кто-то уже сообщал
	ранее.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-background"></a>12.16.2. Общие сведения</h3></div></div></div><a id="idp87432016" class="indexterm"></a><p><acronym class="acronym">ACPI</acronym> представлен во всех современных
	компьютерах, соответствующих архитектурам ia32 (x86),
	ia64 (Itanium) и amd64 (AMD).  Полный стандарт включает множество
	возможностей, в том числе управление производительностью
	<acronym class="acronym">CPU</acronym>, уровнем питания, температурой,
	различными системами аккумуляторов, встроенными контроллерами
	и опросом шины.  В большинстве систем стандарт реализован не
	полностью.  Например, настольные системы обычно реализуют только
	опрос шины, а портативные компьютеры кроме того могут поддерживать
	управление охлаждением и энергопотреблением.  Они также поддерживают
	приостановку и последующий запуск системы различного уровня
	сложности.</p><p><acronym class="acronym">ACPI</acronym>-совместимые системы состоят из
	различных компонентов.  Производители <acronym class="acronym">BIOS</acronym>
	и чипсетов предоставляют различные жестко заданные таблицы,
	(например, <acronym class="acronym">FADT</acronym>), которые определяют
	функции вроде карты <acronym class="acronym">APIC</acronym> (используется для
	<acronym class="acronym">SMP</acronym>), регистры настройки и простые
	значения параметров.  Кроме того, предоставляется таблица
	байткода (<em class="firstterm">Differentiated System Description
	Table</em>, <acronym class="acronym">DSDT</acronym>), определяющая древоподобное
	пространство имен устройств и методов.</p><p>Драйвер <acronym class="acronym">ACPI</acronym> должен прочесть заданные
	таблицы, реализовать интерпретатор для байткода, модифицировать
	драйвера устройств и ядро для приема информации от подсистемы
	<acronym class="acronym">ACPI</acronym>.  Для FreeBSD <span class="trademark">Intel</span>(R) предоставила
	интерпретатор (<acronym class="acronym">ACPI-CA</acronym>), тот же что для
	Linux и NetBSD.  Исходный код <acronym class="acronym">ACPI-CA</acronym>
	находится в каталоге
	<code class="filename">src/sys/contrib/dev/acpica</code>.
	Код для приспособления <acronym class="acronym">ACPI-CA</acronym> к работе в
	FreeBSD, находится в <code class="filename">src/sys/dev/acpica/Osd</code>.
	Наконец, драйвера, реализующие различные <acronym class="acronym">ACPI</acronym>
	устройства, находятся в
	<code class="filename">src/sys/dev/acpica</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-comprob"></a>12.16.3. Часто встречающиеся проблемы</h3></div></div></div><a id="idp87446352" class="indexterm"></a><p>Для правильной работы <acronym class="acronym">ACPI</acronym> все ее части должны
	работать правильно.  Вот некоторые часто встречающиеся проблемы, в порядке
	частоты появления, и некоторые обходные пути или исправления.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87448272"></a>12.16.3.1. Проблемы с мышью</h4></div></div></div><p>В некоторых случаях при возобновлении работы после приостановки
	  перестает работать мышь.  Известным решением проблемы является
	  добавление строки <code class="literal">hint.psm.0.flags="0x3000"</code>
	  в файл <code class="filename">/boot/loader.conf</code>.  Если это не помогло,
	  стоит сообщить о проблеме, как описано выше.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87450192"></a>12.16.3.2. Приостановка/возобновление работы</h4></div></div></div><p><acronym class="acronym">ACPI</acronym> поддерживает три состояния приостановки в
	  <acronym class="acronym">RAM</acronym> (<acronym class="acronym">STR</acronym>),
	  <code class="literal">S1</code>-<code class="literal">S3</code>, и одно состояние
	  приостановки на диск (<code class="literal">STD</code>), называемое
	  <code class="literal">S4</code>.  <code class="literal">S5</code> это
	  <span class="quote"><<<span class="quote">мягкое выключение</span>>></span> и это нормальное состояние системы,
	  когда она подключена к сети, но не включена.  <code class="literal">S4</code>
	  может быть реализован двумя различными путями.
	  <code class="literal">S4</code><acronym class="acronym">BIOS</acronym> это
	  <acronym class="acronym">BIOS</acronym>-поддерживаемая приостановка на диск.
	  <code class="literal">S4</code><acronym class="acronym">OS</acronym> реализуется полностью
	  операционной системой.</p><p>Начните с проверки переменных <code class="command">sysctl
	  hw.acpi</code>,
	  относящихся к приостановке (suspend).
	  Вот результат для Thinkpad:</p><pre class="screen">hw.acpi.supported_sleep_state: S3 S4 S5
hw.acpi.s4bios: 0</pre><p>Это означает, что мы можем использовать <code class="command">acpiconf
	  -s</code> для тестирования <code class="literal">S3</code>,
	  <code class="literal">S4</code><acronym class="acronym">OS</acronym>, и
	  <code class="literal">S5</code>.  Если <code class="option">s4bios</code> был единицей
	  (<code class="literal">1</code>), это означает поддержку
	  <code class="literal">S4</code><acronym class="acronym">BIOS</acronym> вместо
	  <code class="literal">S4</code><acronym class="acronym">OS</acronym>.</p><p>При тестировании приостановки/возобновления работы, начните
	  с <code class="literal">S1</code>, если этот режим поддерживается.
	  Это состояние скорее всего поддерживается, поскольку не требует
	  слишком серьезной поддержки со стороны драйвера.  Никто не
	  реализовал <code class="literal">S2</code>, который похож на
	  <code class="literal">S1</code>.  Следующий режим для тестирования это
	  <code class="literal">S3</code>.  Это наиболее глубокое <acronym class="acronym">STR</acronym>
	  состояние, оно требует существенной поддержки со стороны
	  драйвера, чтобы правильно реинициализировать оборудование.
	  Если у вас возникли проблемы при выходе из этого состояния,
	  отправьте письмо в рассылку <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a>, но не ждите, что
	  проблема будет обязательно решена, поскольку существует
	  множество драйверов/оборудования, нуждающихся в дальнейшем
	  тестировании и разработке.</p><p>Для изоляции проблемы удалите из ядра столько драйверов,
	  сколько возможно.  Если это работает, вы можете выяснить,
	  какой драйвер вызывает проблему путем загрузки драйверов
	  до тех пор, пока опять не произойдет сбой.  Обычно бинарные
	  драйвера, такие как <code class="filename">nvidia.ko</code>,
	  драйвера дисплея X11 и
	  <acronym class="acronym">USB</acronym> вызывают большинство проблем, а драйвера
	  Ethernet интерфейсов как правило работают отлично.  Если вы
	  можете нормально загрузить/выгрузить драйвера, автоматизируйте
	  этот процесс, поместив соответствующие команды в
	  <code class="filename">/etc/rc.suspend</code> и
	  <code class="filename">/etc/rc.resume</code>.  Это закомментированные
	  примеры выгрузки и загрузки драйверов.  Попробуйте
	  установить параметр <code class="option">hw.acpi.reset_video</code>
	  в нуль (<code class="literal">0</code>), если ваш дисплей не включается
	  после возобновления
	  работы.  Попробуйте установить большие или меньшие значения
	  для <code class="option">hw.acpi.sleep_delay</code>, чтобы проверить,
	  поможет ли это.</p><p>Другой способ, который можно попробовать, это запуск
	  последнего дистрибутива Linux с поддержкой
	  <acronym class="acronym">ACPI</acronym> и тестирование поддержки
	  остановки/возобновления работы на том же оборудовании.
	  Если она работает на Linux, проблема скорее всего в
	  драйверах FreeBSD и поиск драйвера, вызывающего проблему,
	  поможет разрешить ситуацию.  Имейте ввиду, что разработчики
	  <acronym class="acronym">ACPI</acronym> обычно не поддерживают другие
	  драйверы (звук, <acronym class="acronym">ATA</acronym>, и т.п.), так что
	  все результаты работы по поиску проблемы возможно необходимо
	  отправить в список рассылки <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">freebsd-current</a> и человеку,
	  поддерживающему драйвер.  Если вы решитесь заняться
	  отладкой, поместите соответствующий код (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=printf&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">printf</span>(3)</span></a>)
	  в вызывающий проблему драйвер для обнаружения места, где
	  прерывается функция восстановления.</p><p>Наконец, попробуйте отключить <acronym class="acronym">ACPI</acronym> и
	  включить <acronym class="acronym">APM</acronym>.  Если приостановка/возобновление
	  работает с <acronym class="acronym">APM</acronym>, вам возможно лучше подойдет
	  <acronym class="acronym">APM</acronym>, особенно на старом оборудовании (до
	  2000).  Включение корректной поддержки <acronym class="acronym">ACPI</acronym>
	  поставщиками оборудования требует времени и вероятно в старом
	  оборудовании поддержка <acronym class="acronym">ACPI</acronym> в
	  <acronym class="acronym">BIOS</acronym> была некорректна.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87482832"></a>12.16.3.3. Система останавливается (временно или постоянно)</h4></div></div></div><p>Большинство систем останавливаются в результате потери
	  прерываний или <span class="quote"><<<span class="quote">шторма</span>>></span> прерываний.  В чипсетах
	  существует много проблем, связанных с тем, как
	  <acronym class="acronym">BIOS</acronym> настраивает прерывания перед загрузкой,
	  правильностью таблицы <acronym class="acronym">APIC</acronym>
	  (<acronym class="acronym">MADT</acronym>), и маршрутизации
	  <em class="firstterm">System Control Interrupt</em>
	  (<acronym class="acronym">SCI</acronym>).</p><a id="idp87486160" class="indexterm"></a><p><span class="quote"><<<span class="quote">Шторм</span>>></span> прерываний может быть обнаружен по
	  потерянным прерываниям путем проверки вывода строки с
	  <code class="literal">acpi0</code> команды <code class="command">vmstat -i</code>.
	  Если счетчик увеличивается более, чем
	  несколько раз в секунду, это <span class="quote"><<<span class="quote">шторм</span>>></span> прерываний.
	  Если система останавливается, попробуйте войти в
	  <acronym class="acronym">DDB</acronym>
	  (<span class="keycap"><strong>CTRL</strong></span>+<span class="keycap"><strong>ALT</strong></span>+<span class="keycap"><strong>ESC</strong></span> на
	  консоли) и ввести <code class="literal">show interrupts</code>.</p><a id="idp87494992" class="indexterm"></a><p>Наиболее надежный способ избавиться от проблемы с прерываниями,
	  это отключение поддержки <acronym class="acronym">APIC</acronym> с помощью
	  параметра <code class="filename">loader.conf</code>
	  <code class="literal">hint.apic.0.disabled="1"</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87497808"></a>12.16.3.4. Паника</h4></div></div></div><p>Паника, связанная с <acronym class="acronym">ACPI</acronym>, случается довольно
	  редко и имеет наибольший приоритет исправления.  Первый шаг
	  это изоляция действий, приводящих к панике (если это возможно)
	  и получение отладки.  Следуйте инструкции по включению
	  <code class="literal">options DDB</code> и настройке последовательной консоли
	  (смотрите <a class="xref" href="serialconsole-setup.html#serialconsole-ddb" title="22.6.5.3. Вход в отладчик DDB с последовательной линии">Раздел 22.6.5.3, <<Вход в отладчик DDB с последовательной линии>></a>)
	  или настройке раздела <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a>.  Вы можете получить отладочную
	  информацию <acronym class="acronym">DDB</acronym> с помощью <code class="literal">tr</code>.
	  Если вы записываете отладку вручную, убедитесь, что переписали
	  как минимум пять (5) строк снизу и пять (5) строк сверху.</p><p>Затем попробуйте изолировать проблему, загрузившись с
	  выключенным <acronym class="acronym">ACPI</acronym>.  Если это работает, вы можете
	  изолировать подсистему <acronym class="acronym">ACPI</acronym>, используя
	  различные параметры <code class="option">debug.acpi.disable</code>.
	  Обратитесь к странице справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a> за примерами.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87508432"></a>12.16.3.5. Система включается после приостановки или завершения
	  работы</h4></div></div></div><p>Во-первых, попробуйте установить в <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a> параметр
	  <code class="literal">hw.acpi.disable_on_poweroff="0"</code>.
	  Это предотвращает отключение различных событий в
	  <acronym class="acronym">ACPI</acronym> во время завершения работы.
	  В некоторых системах этот параметр необходимо установить
	  в <code class="literal">1</code> (по умолчанию) по тем же причинам.  Обычно это
	  решает проблему, если система неожиданно включается после
	  приостановки или отключения питания.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87515856"></a>12.16.3.6. Другие проблемы</h4></div></div></div><p>Если вы наблюдаете другие проблемы с <acronym class="acronym">ACPI</acronym>
	  (работа с внешним оборудованием, проблемы с обнаружением устройств,
	  и т.д.), отправьте описание проблемы в список рассылки;
	  однако, некоторые из этих проблем могут относиться к незавершенным
	  частям подсистемы <acronym class="acronym">ACPI</acronym>, поэтому может
	  потребоваться время на их реализацию.  Будьте терпеливы, и
	  подготовьтесь к тестированию исправлений, которые мы можем вам
	  выслать.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-aslanddump"></a>12.16.4. <acronym class="acronym">ASL</acronym>, <code class="command">acpidump</code>, и
	<acronym class="acronym">IASL</acronym></h3></div></div></div><a id="idp87519568" class="indexterm"></a><p>Наиболее часто встречается проблема, связанная с предоставлением
	поставщиками <acronym class="acronym">BIOS</acronym> некорректного (или полностью
	ошибочного!) байткода.  Это обычно проявляется появлением
	консольных сообщений ядра, подобных этому:</p><pre class="screen">ACPI-1287: *** Error: Method execution failed [\\_SB_.PCI0.LPC0.FIGD._STA] \\
       (Node 0xc3f6d160), AE_NOT_FOUND</pre><p>Зачастую вы можете разрешить эти проблемы путем обновления
	<acronym class="acronym">BIOS</acronym> до последней ревизии.  Большинство консольных
	сообщений безвредны, но если существуют другие проблемы, такие как
	не работающий статус батареи, возможно существуют проблемы в
	<acronym class="acronym">AML</acronym>.  Байткод, известный как
	<acronym class="acronym">AML</acronym>, компилируется из исходного текста на
	языке <acronym class="acronym">ASL</acronym>.  <acronym class="acronym">AML</acronym> находится
	в таблице, известной как <acronym class="acronym">DSDT</acronym>.  Для получения
	копии <acronym class="acronym">ASL</acronym>, используйте <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpidump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">acpidump</span>(8)</span></a>.
	Вы можете использовать оба параметра <code class="option">-t</code>
	(показывать содержимое постоянных таблиц) и <code class="option">-d</code>
	(дизассемблировать <acronym class="acronym">AML</acronym> в <acronym class="acronym">ASL</acronym>).
	Обратитесь к разделу <a class="link" href="ACPI-debug.html#ACPI-submitdebug" title="12.16.1. Отправка отладочной информации">Отправка
	отладочной информации</a> за примером синтаксиса.</p><p>Простейшая первая проверка, которую вы можете провести,
	это перекомпиляция <acronym class="acronym">ASL</acronym> для поиска ошибок.
	Предупреждения обычно могут быть проигнорированы, но ошибки
	обычно не позволяют <acronym class="acronym">ACPI</acronym> работать правильно.
	Для перекомпиляции <acronym class="acronym">ASL</acronym>, выполните следующую
	команду:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>iasl your.asl</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-fixasl"></a>12.16.5. Исправление <acronym class="acronym">ASL</acronym></h3></div></div></div><a id="idp87535824" class="indexterm"></a><p>В дальней перспективе, наша задача состоит в том, чтобы
	обеспечить поддержку <acronym class="acronym">ACPI</acronym> практически для
	каждой системы без вмешательства пользователя.  Однако, на данный
	момент мы все еще разрабатываем обходные пути для ошибок,
	которые часто делают поставщики <acronym class="acronym">BIOS</acronym>.
	Интерпретатор <span class="trademark">Microsoft</span>(R) (<code class="filename">acpi.sys</code> и
	<code class="filename">acpiec.sys</code>) не занимается проверкой
	четкости соблюдения стандартов, поэтому многие поставщики
	<acronym class="acronym">BIOS</acronym>, проверяющие <acronym class="acronym">ACPI</acronym>
	только под <span class="trademark">Windows</span>(R), никогда не исправляют <acronym class="acronym">ASL</acronym>.
	Мы надеемся продолжать обнаружение и документацию нестандартных
	поведений, позволяемых интерпретатором <span class="trademark">Microsoft</span>(R), и воспроизводить
	их, чтобы FreeBSD могла работать без необходимости исправления
	<acronym class="acronym">ASL</acronym> пользователями.  В качестве обходного пути
	для обнаружения неправильного поведения, вы можете исправить
	<acronym class="acronym">ASL</acronym> вручную.  Если исправления будут работать,
	пожалуйста отправьте <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> между старым и новым
	<acronym class="acronym">ASL</acronym>, чтобы мы могли реализовать обходной
	путь для неправильного поведения <acronym class="acronym">ACPI-CA</acronym>,
	чтобы исправление вручную больше не требовалось.</p><a id="idp87544016" class="indexterm"></a><p>Вот список наиболее часто встречающихся проблем, их причин и
	способы исправления:</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87549776"></a>12.16.5.1. OS зависимости</h4></div></div></div><p>Некоторые <acronym class="acronym">AML</acronym> предполагают, что мир состоит
	  из различных версий <span class="trademark">Windows</span>(R).  Вы можете настроить FreeBSD, чтобы
	  она сообщала любое другое имя <acronym class="acronym">OS</acronym> и посмотреть,
	  исправит ли это имеющуюся проблему.  Простой способ указания
	  другого имени системы это установка переменной
	  <code class="filename">/boot/loader.conf</code>
	  <code class="literal">hw.acpi.osname="Windows 2001"</code>
	  или в другое подобное значение, имеющееся в
	  <acronym class="acronym">ASL</acronym>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87553360"></a>12.16.5.2. Отсутствие возврата значения</h4></div></div></div><p>Некоторые методы не возвращают значение явно, как того
	  требует стандарт.  Хотя <acronym class="acronym">ACPI-CA</acronym> не обрабатывает
	  эту ситуацию, в FreeBSD существует обходной путь, позволяющей ей
	  явно возвращать значение.  Вы можете также добавить явные операторы
	  Return (возврат) там, где требуется, если знаете, что значение
	  должно быть возвращено.  Для принудительного компилирования
	  <acronym class="acronym">ASL</acronym> командой <code class="command">iasl</code>, используйте
	  флаг <code class="option">-f</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87556048"></a>12.16.5.3. Перезапись <acronym class="acronym">AML</acronym> по умолчанию</h4></div></div></div><p>После настройки <code class="filename">your.asl</code> для
	  компиляции запустите:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>iasl your.asl</code></strong></pre><p>Вы можете добавить флаг <code class="option">-f</code> для создания
	  <acronym class="acronym">AML</acronym> даже при наличии ошибок компиляции.
	  Помните, что некоторые ошибки (например, отсутствующие операторы
	  Return), автоматически обходятся интерпретатором.</p><p>Файл <code class="filename">DSDT.aml</code> используется
	  <code class="command">iasl</code> по умолчанию.  Вы можете загрузить его
	  вместо ошибочной копии <acronym class="acronym">BIOS</acronym> (которая
	  остается в постоянной памяти) путем редактирования
	  <code class="filename">/boot/loader.conf</code>:</p><pre class="programlisting">acpi_dsdt_load="YES"
acpi_dsdt_name="/boot/DSDT.aml"</pre><p>Убедитесь, что скопировали <code class="filename">DSDT.aml</code> в
	  каталог <code class="filename">/boot</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-debugoutput"></a>12.16.6. Получение отладочной информации
	<acronym class="acronym">ACPI</acronym></h3></div></div></div><a id="idp87577168" class="indexterm"></a><a id="idp87578320" class="indexterm"></a><p>Возможности отладки драйвера <acronym class="acronym">ACPI</acronym> очень
	гибкие.  Они позволяют вам указывать набор подсистем, а также
	уровень отладки.  Подсистемы, которые вы хотите отлаживать,
	указываются как <span class="quote"><<<span class="quote">слои</span>>></span>, и подразделяются на
	компоненты <acronym class="acronym">ACPI-CA</acronym> (ACPI_ALL_COMPONENTS)
	и поддержку оборудования <acronym class="acronym">ACPI</acronym> (ACPI_ALL_DRIVERS).
	Уровень отладки варьируется от ACPI_LV_ERROR (только сообщать об
	ошибках) до ACPI_LV_VERBOSE (все сообщения).  Уровень отладки
	представляет собой битовую маску, поэтому возможна одновременная
	установка нескольких параметров, разделенных пробелами.
	На практике, при использовании для получения отладочной информации
	последовательной консоли, слишком большое количество информации
	может переполнить буфер консоли.  Полный список отдельных слоев
	и уровней можно найти на странице справочника <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a>.</p><p>Вывод отладочной информации по умолчанию не включен.
	Для его включения добавьте параметр
	<code class="literal">options ACPI_DEBUG</code> к файлу настройки ядра, если
	<acronym class="acronym">ACPI</acronym> встроен в ядро.  Вы можете добавить параметр
	<code class="literal">ACPI_DEBUG=1</code> в файл
	<code class="filename">/etc/make.conf</code> для глобального включения
	этого параметра.  Если вы используете модуль
	<code class="filename">acpi.ko</code> , его можно пересобрать
	индивидуально:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /sys/modules/acpi/acpi
&amp;&amp; make clean &amp;&amp; make
ACPI_DEBUG=1</code></strong></pre><p>Установите <code class="filename">acpi.ko</code> в
	<code class="filename">/boot/kernel</code> и добавьте
	предпочитаемый уровень и слой к <code class="filename">loader.conf</code>.
	Этот пример включает отладочные сообщения для всех компонентов
	<acronym class="acronym">ACPI-CA</acronym> и всех драйверов оборудования
	<acronym class="acronym">ACPI</acronym> (<acronym class="acronym">CPU</acronym>,
	<acronym class="acronym">LID</acronym> и т.д.).  Будут выводиться только сообщения
	об ошибках, наименьший уровень отладки.</p><pre class="programlisting">debug.acpi.layer="ACPI_ALL_COMPONENTS ACPI_ALL_DRIVERS"
debug.acpi.level="ACPI_LV_ERROR"</pre><p>Если требуемая информация получается в результате определенного
	события (скажем, приостановка и восстановление), вы можете
	не изменять <code class="filename">loader.conf</code> и использовать
	для указания слоя и уровня <code class="command">sysctl</code>
	после загрузки и подготовки системы к определенному событию.
	Имена переменных <code class="command">sysctl</code> те же, что и имена
	параметров настройки в <code class="filename">loader.conf</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-References"></a>12.16.7. Ссылки</h3></div></div></div><p>Дальнейшую информацию о <acronym class="acronym">ACPI</acronym> можно найти
	по следующим ссылкам:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">Список рассылки FreeBSD ACPI</a></p></li><li class="listitem"><p>Архивы списка рассылки <acronym class="acronym">ACPI</acronym>
	    <code class="uri"><a class="uri" href="http://lists.freebsd.org/pipermail/freebsd-acpi/" target="_top">http://lists.freebsd.org/pipermail/freebsd-acpi/</a></code></p></li><li class="listitem"><p>Старые архивы списка рассылки <acronym class="acronym">ACPI</acronym>
	    <code class="uri"><a class="uri" href="http://home.jp.FreeBSD.org/mail-list/acpi-jp/" target="_top">http://home.jp.FreeBSD.org/mail-list/acpi-jp/</a></code></p></li><li class="listitem"><p>Спецификация <acronym class="acronym">ACPI</acronym> 2.0
	    <code class="uri"><a class="uri" href="http://acpi.info/spec.htm" target="_top">http://acpi.info/spec.htm</a></code></p></li><li class="listitem"><p>Страницы справочника FreeBSD: <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a>,
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi_thermal&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi_thermal</span>(4)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpidump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">acpidump</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=iasl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">iasl</span>(8)</span></a>,
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpidb&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">acpidb</span>(8)</span></a></p></li><li class="listitem"><p><a class="link" href="http://www.cpqlinux.com/acpi-howto.html#fix_broken_dsdt" target="_top">
	    Ресурс по отладке <acronym class="acronym">DSDT</acronym></a>.
	    (Использует в качестве примера Compaq, но обычно полезен.)</p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="acpi-overview.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="config-tuning.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="boot.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">12.15. Управление питанием и ресурсами </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> Глава 13. Процесс загрузки FreeBSD</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Этот, и другие документы, могут быть скачаны с
    <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>По вопросам, связанным с FreeBSD, прочитайте
    <a href="http://www.FreeBSD.org/ru/docs.html">документацию</a> прежде чем писать в
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    По вопросам, связанным с этой документацией, пишите в рассылку
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.<br></br></small></p></body></html>