<?xml version="1.0" encoding="iso-8859-2"?>
<!--
     The FreeBSD Polish Documentation Project

     $FreeBSD$
     Original revision: 1.12
-->
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:lang="pl">
  <info><title xmlns:xlink="http://www.w3.org/1999/xlink">Mosty filtruj±ce</title>
    

    <authorgroup xmlns:xlink="http://www.w3.org/1999/xlink">
      <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Alex</firstname><surname xmlns:xlink="http://www.w3.org/1999/xlink">Dupre</surname></personname><affiliation xmlns:xlink="http://www.w3.org/1999/xlink">
          <address xmlns:xlink="http://www.w3.org/1999/xlink"><email xmlns:xlink="http://www.w3.org/1999/xlink">sysadmin@alexdupre.com</email></address>
        </affiliation></author>
    </authorgroup>

    <pubdate xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</pubdate>

    <releaseinfo xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</releaseinfo>

    <abstract xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Czêstokroæ zdarza siê, ¿e trzeba podzieliæ jedn± sieæ fizyczn±
        (np. Ethernet) na dwa oddzielne segmenty, nie tworz±c przy tym
	podsieci, a oba segmenty po³±czyæ ze sob± ruterem. Urz±dzenie
	³±cz±ce w ten sposób dwie sieci nazywane jest mostem. Komputer z
	FreeBSD posiadaj±cy dwa interfejsy sieciowe mo¿e z powodzeniem
	pracowaæ jako most.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Zadaniem mostu jest analizowanie adresów <acronym xmlns:xlink="http://www.w3.org/1999/xlink">MAC</acronym>
        (adresów ethernetowych) nale¿±cych do urz±dzeñ przy³±czonych do obu
	interefejsów sieciowych, a nastêpnie przekazywaniu danych pomiêdzy
	obiema sieciami tylko wtedy, gdy nadawca i odbiorca nale¿± do
	innych segmentów. Pod wieloma wzglêdami most przypomina prze³±cznik
	ethernetowy wyposa¿ony w jedynie dwa porty.</para>
    </abstract>
  </info>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="filtering-bridges-why">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Dlaczego korzysta siê z mostów filtruj±cych?</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Dziêki obni¿aj±cym siê kosztom szerokopasmowych po³±czeñ
      internetowych (xDSL), jak równie¿ z powodu niewielkiej liczby dostêpnych
      adresów IPv4, coraz czê¶ciej zdarza siê, ¿e firmy dysponuj± sta³ym
      po³±czeniem z Internetem, nie posiadaj±c przy tym zbyt wielu adresów IP.
      W takiej sytuacji przydatne jest stosowanie firewalla filtruj±cego
      pakiety wysy³ane do Internetu i z niego nadchodz±ce. Mo¿e siê jednak
      zdarzyæ, ¿e filtrowania pakietów na poziomie rutera nie da siê
      zrealizowaæ, na przyk³ad ze wzglêdu na podzia³ sieci,
      lub dlatego, ¿e to dostawca us³ug interentowych jest w³a¶cicielem
      rutera, b±d¼ te¿ sam ruter nie umo¿liwia takiego rozwi±zania. Wtedy
      w³a¶nie wskazane jest skorzystanie z mostu filtruj±cego.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Firewall bêd±cy jednocze¶nie mostem mo¿e byæ wstawiony pomiêdzy
      ruter xDSL a koncentrator/prze³±cznik ethernetowy. Jego konfiguracja
      nie wymaga zajmowania siê numeracj± IP.</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="filtering-bridges-how">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Instalacja</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">W FreeBSD w³±czenie funkcji mostu nie jest trudnym przedsiêwziêciem.
      Pocz±wszy od wydania 4.5 owe funkcje mog± byæ do³±czone jako modu³y, nie
      trzeba wiêc przebudowywaæ j±dra, co jest znacznym udogodnieniem.
      Poni¿ej opisujê obydwa sposoby.</para>

    <important xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink"><emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Nie nale¿y</emphasis> postêpowaæ wed³ug obu poni¿szych
        przepisów: skorzystanie z jednego z nich
	<emphasis xmlns:xlink="http://www.w3.org/1999/xlink">wyklucza</emphasis> korzystanie z drugiego. Wybór powinien
	zale¿eæ od w³asnych potrzeb i mo¿liwo¶ci.</para>
    </important>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Przed rozpoczêciem nale¿y upewniæ siê, ¿e dysponujemy przynajmniej
      dwiema kartami sieciowymi zdolnymi do pracy w trybie po¶redniczenia
      zarówno przy odbiorze, jak i nadawaniu; karty bêd± wysy³aæ pakiety
      opatrzone niekoniecznie ich w³asnymi adresami. Co wiêcej, by osi±gn±æ
      dobr± wydajno¶æ, powinny byæ to karty PCI obs³uguj±ce zarz±dzanie
      magistral±. Do takich nale¿± karty Intel EtherExpress Pro, a tak¿e
      karty 3Com z serii 3c9xx. Dla uproszczenia konfiguracji firewalla
      po¿ytecznym okazaæ siê mo¿e posiadanie kart dwóch ró¿nych producentów
      (korzystaj±cych z innych sterowników), by ³atwiej by³o odró¿niæ
      interfejs pod³±czony do rutera od interfejsu po³±czonego z sieci±
      wewnêtrzn±.</para>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="filtering-bridges-kernel">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Konfigurowanie j±dra</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Pierwsza z metod jest starsza, lecz sprawdzona. Na pocz±tek
        nale¿y dodaæ nastêpuj±ce wiersze do pliku konfiguracyjnego
	j±dra:</para>

      <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">options BRIDGE
options IPFIREWALL
options IPFIREWALL_VERBOSE</programlisting>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Pierwszy wiersz w³±cza do j±dra obs³ugê mostu, drugi obs³ugê
        firewalla, a trzeci funkcje rejestruj±ce firewalla.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Teraz trzeba skompilowaæ i zainstalowaæ nowe j±dro. Szczegó³owy
        opis tych czynno¶ci znale¼æ mo¿na w Podrêczniku FreeBSD, w czê¶ci
	"<link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="../../books/handbook/kernelconfig-building.html">Building
	and Installing a Custom Kernel</link>".</para>
    </sect2>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="filtering-bridges-modules">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">£adowanie modu³ów</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Ta metoda instalacji jest nowsza i prostsza, polega jedynie
        na dodaniu poni¿szego wiersza do
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/boot/loader.conf</filename>:</para>

      <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">bridge_load="YES"</programlisting>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">W efekcie podczas ³adowania systemu wraz z j±drem zostanie
        za³adowany modu³ <filename xmlns:xlink="http://www.w3.org/1999/xlink">bridge.ko</filename>. Nie trzeba dodawaæ
	analogicznego wiersza dla modu³u <filename xmlns:xlink="http://www.w3.org/1999/xlink">ipfw.ko</filename>, gdy¿
	zostanie on za³adowany automatycznie po wykonaniu czynno¶ci
	opisanych w nastêpnej czê¶ci.</para>
    </sect2>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="filtering-bridges-finalprep">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Przygotowanie do pracy</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Przed ponownym uruchomieniem systemu oraz za³adowaniem nowego j±dra
      lub modu³ów (w zale¿no¶ci od wybranej metody instalacji), trzeba
      jeszcze dokonaæ kilku zmian w pliku konfiguracyjnym
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.conf</filename>. Domy¶ln± regu³± firewalla jest
      zatrzymywanie wszystkich pakietów IP. Zaczniemy od skonfigurowania
      firewalla <option xmlns:xlink="http://www.w3.org/1999/xlink">otwartego</option>, by sprawdziæ jego dzia³anie przy
      wy³±czonym filtrowaniu (dziêki temu maszyna bêdzie mog³a utrzymaæ
      po³±czenie z sieci±, co jest niezbêdne w przypadku, gdy konfiguracja
      przeprowadzana jest poprzez sieæ).
      W pliku <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.conf</filename> nale¿y umie¶ciæ poni¿sze
      wpisy:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">firewall_enable="YES"
firewall_type="open"
firewall_quiet="YES"
firewall_logging="YES"</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Pierwszy wiersz powoduje uruchomienie firewalla (³adowany jest
      modu³ <filename xmlns:xlink="http://www.w3.org/1999/xlink">ipfw.ko</filename>, je¶li nie zosta³ wkompilowany do
      j±dra), w drugim ustawiany jest
      <option xmlns:xlink="http://www.w3.org/1999/xlink">otwarty</option> tryb jego pracy (zgodnie z opisem w
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.firewall</filename>). Nastêpny wiersz nakazuje nie
      pokazywaæ ³adowanych regu³, a w ostatnim w³±czane jest
      rejestrowanie.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Interfejsy sieciowe s± najczê¶ciej skonfigurowane tak, ¿e tylko
      jedna z kart sieciowych ma przypisany adres IP, jednak¿e most dzia³a
      tak samo równie¿ wtedy, gdy adresy przypisane s± do obu kart lub nie s±
      przypisane do ¿adnej z nich. W tym ostatnim przypadku (brak IP) maszyna
      pe³ni±ca rolê mostu bêdzie jeszcze bardziej ukryta, gdy¿ nie bêdzie
      dostêpna z sieci; dostêp do niej mo¿liwy bêdzie poprzez konsolê lub
      trzeci interfejs sieciowy odseparowany od mostu. Niekiedy dostêp do
      sieci potrzebny jest programom uruchamianym podczas
      ³adowania systemu, na przyk³ad do okre¶lenia nazwy domeny. W takiej
      sytuacji adres IP nale¿y przydzieliæ interfejsowi zewnêtrznemu (czyli
      temu, który po³±czony jest z Internetem, gdzie znajduje siê serwer
      <acronym xmlns:xlink="http://www.w3.org/1999/xlink">DNS</acronym>), poniewa¿ most bêdzie uruchomiony dopiero w
      koñcowej fazie uruchamiania systemu. Oznacza to, ¿e interfejs
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">fxp0</filename> (jak w przyk³adzie) musi byæ uwzglêdniony
      w sekcji ifconfig pliku <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.conf</filename>, w
      przeciwieñstwie do interfejsu <filename xmlns:xlink="http://www.w3.org/1999/xlink">xl0</filename>.
      Przydzielanie adresów IP obu kartom sieciowym nie ma raczej sensu,
      chyba, ¿e podczas uruchamiania systemu programy potrzebuj± dostêpu
      do obu segmentów sieci.</para>


    <para xmlns:xlink="http://www.w3.org/1999/xlink">Nale¿y mieæ na uwadze, ¿e w sieci IP opartej na Ethernecie dzia³aj±
      w rzeczywisto¶ci dwa protoko³y: jednym jest oczywi¶cie IP, drugim
      jest <acronym xmlns:xlink="http://www.w3.org/1999/xlink">ARP</acronym>. Zadaniem protoko³u <acronym xmlns:xlink="http://www.w3.org/1999/xlink">ARP</acronym>
      jest przekszta³cenie adresu IP stacji na jej adres ethernetowy (adres
      <acronym xmlns:xlink="http://www.w3.org/1999/xlink">MAC</acronym>). By mo¿liwa by³a komunikacja miêdzy dwoma
      stacjami znajduj±cymi siê po dwóch stronach mostu, pakiety
      <acronym xmlns:xlink="http://www.w3.org/1999/xlink">ARP</acronym> musz± byæ przekazywane przez most. Protokó³
      <acronym xmlns:xlink="http://www.w3.org/1999/xlink">ARP</acronym> nie jest sk³adnikiem warstwy IP, poniewa¿
      jest u¿ywany tylko wtedy, gdy IP dzia³a w sieci Ethernet. Filtrowanie
      pakietów przez firewall w FreeBSD dotyczy warstwy IP, wiêc pakiety
      innego typu (w tym tak¿e <acronym xmlns:xlink="http://www.w3.org/1999/xlink">ARP</acronym>) bêd± przekazywane
      dalej bez filtrowania, nawet je¶li konfiguracja firewalla nakazuje
      blokowanie wszystkiego.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Mo¿na ju¿ uruchomiæ system ponownie i korzystaæ z niego jak
      dotychczas. Pojawi± siê nowe komunikaty dotycz±ce mostu i firewalla,
      most jednak nie bêdzie jeszcze pracowaæ, natomiast firewall bêdzie
      dzia³aæ w trybie <option xmlns:xlink="http://www.w3.org/1999/xlink">otwartym</option>, bez jakiegokolwiek
      blokowania.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Je¶li pojawi± siê jakiekolwiek problemy, nale¿y siê z nimi
      uporaæ przed przyst±pieniem do kolejnego etapu pracy.</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="filtering-bridges-enabling">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Uruchamianie mostu</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Uruchomienie mostu polega na wykonaniu nastêpuj±cej sekwencji
      poleceñ (nazwy przyk³adowych interfejsów sieciowych
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">fxp0</filename> i <filename xmlns:xlink="http://www.w3.org/1999/xlink">xl0</filename> nale¿y
      zast±piæ nazwami w³asnych interfejsów):</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">sysctl net.link.ether.bridge_cfg=fxp0:0,xl0:0</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">sysctl net.link.ether.bridge_ipfw=1</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">sysctl net.link.ether.bridge=1</userinput></screen>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Pierwsze polecenie wskazuje interfejsy obs³ugiwane przez most,
      drugie w³±cza firewalla, wreszcie trzecie polecenie w³±cza sam
      most.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Tak skonfigurowana maszyna mo¿e zostaæ w³±czona miêdzy dwie grupy
      po³±czonych w sieæ komputerów bez zak³ócania ich wzajemnej komunikacji.
      Je¶li to siê powiedzie, mo¿na dodaæ do pliku
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/sysctl.conf</filename> wpisy
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">net.link.ether.[co¶]=[co¶]</literal>
      zgodne z powy¿szymi, by zosta³y uwzglêdnione przy ³adowaniu systemu.</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="filtering-bridges-ipfirewall">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Konfiguracja firewalla</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Nastêpnym krokiem jest przygotowanie regu³ firewalla,
      zabezpieczaj±cych sieæ wewnêtrzn±. Wi±¿e siê to z pewnymi utrudnieniami,
      gdy¿ nie wszystkie mo¿liwo¶ci firewalla mog± byæ wykorzystywane w
      przypadku pakietów przechodz±cych przez most. Trzeba te¿ wiedzieæ, ¿e
      miêdzy pakietami przekazywanymi, a odbieranymi przez maszynê lokaln±
      jest pewna ró¿nica. Pakiety przychodz±ce przechodz± przez firewall
      tylko raz, a nie dwa razy jak w zwyk³ych warunkach. Mówi±c dok³adniej,
      s± one filtrowane tylko przy odbiorze, tak wiêc regu³y zawieraj±ce
      <option xmlns:xlink="http://www.w3.org/1999/xlink">out</option> lub <option xmlns:xlink="http://www.w3.org/1999/xlink">xmit</option> bêd± bezu¿yteczne.
      Ja osobi¶cie u¿ywam starszej sk³adni <option xmlns:xlink="http://www.w3.org/1999/xlink">in via</option>, któr±
      rozs±dniej siê czyta. Trzeba równie¿ pamiêtaæ, ¿e filtruj±c pakiety
      przechodz±ce przez most, mo¿na u¿ywaæ tylko poleceñ
      <option xmlns:xlink="http://www.w3.org/1999/xlink">pass</option> lub <option xmlns:xlink="http://www.w3.org/1999/xlink">drop</option>. Bardziej wymy¶lne
      polecenia, jak <option xmlns:xlink="http://www.w3.org/1999/xlink">divert</option>, <option xmlns:xlink="http://www.w3.org/1999/xlink">forward</option> czy
      <option xmlns:xlink="http://www.w3.org/1999/xlink">reject</option> s± niedozwolone. Mo¿na z nich korzystaæ tylko
      w odniesieniu do pakietów wysy³anych przez maszynê mostu lub do niej
      przychodz±cych (je¶li oczywi¶cie ma ona adres IP).</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Nowo¶ci± w FreeBSD 4.0 jest filtrowanie z utrzymywaniem stanu. Jest
      ono znacznym u³atwieniem obs³ugi komunikacji przez
      <acronym xmlns:xlink="http://www.w3.org/1999/xlink">UDP</acronym>, polegaj±cej najczê¶ciej na wys³aniu ¿±dania, a
      za chwilê odebraniu odpowiedzi, z takimi samymi adresami IP i numerami
      portów (przy czym nadawca i odbiorca s± oczywi¶cie zamienieni
      miejscami). Praktycznie nie da siê potraktowaæ takiej wymiany jako
      pojedynczej sesji,
      pos³uguj±c siê firewallem nie przechowuj±cym informacji o stanie
      po³±czenia. Jednak¿e gdy firewall potrafi <quote xmlns:xlink="http://www.w3.org/1999/xlink">zapamiêtaæ</quote>
      wychodz±cy pakiet <acronym xmlns:xlink="http://www.w3.org/1999/xlink">UDP</acronym> i zezwoliæ na odpowied¼ w
      ci±gu kilku nastêpnych minut, wówczas zarz±dzanie komunikacj±
      <acronym xmlns:xlink="http://www.w3.org/1999/xlink">UDP</acronym> staje siê dziecinnie proste. Jak to zrobiæ,
      pokazuje poni¿szy przyk³ad. Podobnie mo¿na traktowaæ pakiety
      <acronym xmlns:xlink="http://www.w3.org/1999/xlink">TCP</acronym>, chroni to przed niektórymi atakami przez
      uniemo¿liwienie dzia³ania oraz innymi figlami, prowadzi jednak do
      szybkiego rozrastania siê tablicy stanów.</para>


    <para xmlns:xlink="http://www.w3.org/1999/xlink">Spójrzmy na przyk³adow± konfiguracjê. Zwróæmy uwagê, ¿e na pocz±tku
      pliku <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.firewall</filename> umieszczono domy¶lne regu³y
      dla interfejsu pseudosieci <filename xmlns:xlink="http://www.w3.org/1999/xlink">lo0</filename>, nie trzeba
      siê wiêc ju¿ nimi przejmowaæ. Inne regu³y powinny byæ umieszczone w
      oddzielnym pliku (np. <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.firewall.local</filename>),
      który by³by do³±czany podczas ³adowania systemu dziêki zmianie
      w pliku <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.conf</filename> tego wiersza, w którym
      typ firewalla by³ zdefiniowany jako <option xmlns:xlink="http://www.w3.org/1999/xlink">otwarty</option>:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">firewall_type="/etc/rc.firewall.local"</programlisting>

    <important xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Nale¿y tu podaæ <emphasis xmlns:xlink="http://www.w3.org/1999/xlink">pe³n±</emphasis> ¶cie¿kê, w przeciwnym
        razie plik nie zostanie za³adowany, co grozi utrat± dostêpu do
	sieci.</para>
    </important>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Na potrzeby przyk³adu przyjmujemy, ¿e interfejs
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">fxp0</filename> po³±czony jest z Internetem, natomiast
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">xl0</filename> z sieci± wewnêtrzn±
      (<acronym xmlns:xlink="http://www.w3.org/1999/xlink">LAN</acronym>). Adres IP maszyny mostu to
      <systemitem xmlns:xlink="http://www.w3.org/1999/xlink" class="ipaddress">1.2.3.4</systemitem> (w rzeczywisto¶ci dostawca
      us³ug interenetowych nie móg³by przydzieliæ adresu klasy A, jednak
      ¶wietnie nadaje siê on jako przyk³ad).</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink"># Szybkie przepuszczanie pakietów, których stan zosta³ zapamiêtany
add check-state

# Blokada sieci z RFC 1918
add drop all from 10.0.0.0/8 to any in via fxp0
add drop all from 172.16.0.0/12 to any in via fxp0
add drop all from 192.168.0.0/16 to any in via fxp0

# Maszyna bêd±ca mostem mo¿e wysy³aæ co tylko zechce
# (je¶li maszyna nie ma adresu IP, pomiñ poni¿sze wiersze)
add pass tcp from 1.2.3.4 to any setup keep-state
add pass udp from 1.2.3.4 to any keep-state
add pass ip from 1.2.3.4 to any

# Stacje sieci wewnêtrznej mog± wysy³aæ co tylko zechc±
add pass tcp from any to any in via xl0 setup keep-state
add pass udp from any to any in via xl0 keep-state
add pass ip from any to any in via xl0

# Protokó³ TCP
# Przepuszczanie SSH
add pass tcp from any to any 22 in via fxp0 setup keep-state
# Przepuszczanie SMTP jedynie do serwera poczty
add pass tcp from any to relay 25 in via fxp0 setup keep-state
# Informacje o obszarach mog± byæ przesy³ane tylko przez podrzêdny
# serwer nazw [dns2.nic.it]
add pass tcp from 193.205.245.8 to ns 53 in via fxp0 setup keep-state
# Przepuszczanie zapytañ ident - takie rozwi±zanie jest lepsze
# ni¿ oczekiwanie na przekroczenie czasu
add pass tcp from any to any 113 in via fxp0 setup keep-state
# Przepuszczenie zakresu portów dynamicznych
add pass tcp from any to any 49152-65535 in via fxp0 setup keep-state

# Protokó³ UDP
# Przepuszczanie zapytañ DNS jedynie do serwera DNS
add pass udp from any to ns 53 in via fxp0 keep-state
# Przepuszczenie zakresu portów dynamicznych
add pass udp from any to any 49152-65535 in via fxp0 keep-state

# Protokó³ ICMP
# Przepuszczanie 'pingów'
add pass icmp from any to any icmptypes 8 keep-state
# Przepuszczanie komunikatów o b³êdach generowanych przez 'traceroute'
add pass icmp from any to any icmptypes 3
add pass icmp from any to any icmptypes 11

# Wszystko inne jest podejrzane
add drop log all from any to any</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Czytelnicy maj±cy ju¿ do¶wiadczenie z konfiguracj± firewalla mog±
      zwróciæ uwagê na brak pewnych rzeczy. W szczególno¶ci, brakuje regu³
      zapobiegaj±cych podszywaniu siê. Rzeczywi¶cie, w¶ród powy¿szych regu³
      <emphasis xmlns:xlink="http://www.w3.org/1999/xlink">nie by³o</emphasis> takiej:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">add deny all from 1.2.3.4/8 to any in via fxp0</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Nakazuje ona odrzucanie pakietów, które nadchodz± z zewn±trz, a
      udaj±, ¿e s± z sieci wewnêtrznej. Jest to zwykle stosowane w celu
      zabezpieczenia siê przed próbami prze¶lizniêcia siê przez filtrowanie,
      polegaj±cymi na tworzeniu fa³szywych pakietów, wygl±daj±cych jak
      wys³ane z sieci wewnêtrznej. K³opot w tym, ¿e jest
      <emphasis xmlns:xlink="http://www.w3.org/1999/xlink">co najmniej</emphasis> jedna stacja po³±czona z interfejsem
      zewnêtrznym, której nie mo¿na zignorowaæ: jest ni± ruter. Zwykle
      jednak ochrona przed podszywaniem siê realizowana jest przez
      dostawcê us³ug internetowych na jego ruterze, nie trzeba siê wiêc
      tym przejmowaæ.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Ostatnia regu³a jest bardzo podobna do regu³y przyjmowanej
      domy¶lnie, czyli odrzucania wszystkiego, co nie jest ¶ci¶le dozwolone.
      Jest jednak ró¿nica: wszystko, co jest podejrzane, jest
      rejestrowane.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Dwie regu³y odpowiedzialne s± za przekazywanie pakietów
      <acronym xmlns:xlink="http://www.w3.org/1999/xlink">SMTP</acronym> i <acronym xmlns:xlink="http://www.w3.org/1999/xlink">DNS</acronym> do serwera poczty i
      serwera nazw, o ile takowe serwery s±. Zestaw regu³ powinien byæ
      oczywi¶cie dostosowany do w³asnych potrzeb, tutaj pokazany jest tylko
      pewien przyk³ad (sk³adnia regu³ jest dok³adnie opisana w dokumentacji
      systemowej <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">ipfw</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry>). Trzeba mieæ na uwadze, ¿e aby poprawnie
      dzia³a³y
      <quote xmlns:xlink="http://www.w3.org/1999/xlink">relay</quote> i <quote xmlns:xlink="http://www.w3.org/1999/xlink">ns</quote>, wymagane jest, by zapytania
      DNS dzia³a³y <emphasis xmlns:xlink="http://www.w3.org/1999/xlink">zanim</emphasis> pracê rozpoczyna most. Dziêki
      temu mo¿na te¿ siê przekonaæ, czy adres IP zosta³ przypisany do
      w³a¶ciwiej karty sieciowej. Alternatywnym rozwi±zaniem jest
      wpisanie adresu IP zamiast nazwy stacji (jest to jedyna mo¿liwo¶æ
      w przypadku, gdy maszyna nie ma adresu IP).</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Osoby, które ju¿ kiedy¶ mia³y pewne do¶wiadczenia z konfiguracj±
      firewalla, przyzwyczajone s± zapewne do regu³ <option xmlns:xlink="http://www.w3.org/1999/xlink">reset</option>
      lub <option xmlns:xlink="http://www.w3.org/1999/xlink">forward</option> dla pakietów ident (port
      <acronym xmlns:xlink="http://www.w3.org/1999/xlink">TCP</acronym> o numerze 113). Niestety, w przypadku mostu
      takie rozwi±zanie nie wchodzi w grê, najlepiej jest po prostu
      przepu¶ciæ owe pakiety do ich adresata. Jest to stosunkowo niegro¼ne,
      gdy adresat ma wy³±czon± us³ugê ident. Mo¿na tak¿e blokowaæ po³±czenia
      z portem 113, co powoduje pewne problemy np. z us³ug±
      <acronym xmlns:xlink="http://www.w3.org/1999/xlink">IRC</acronym> (poniewa¿ zapytanie ident musi przekroczyæ
      czas oczekiwania).</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Niezrozumia³a mo¿e wydaæ siê obecno¶æ oddzielnych regu³, z
      których jedne zezwalaja na wysy³anie maszynie bêd±cej mostem, drugie
      natomiast stacjom sieci wewnêtrznej. Jest tak dlatego, ¿e pakiety
      wysy³ane przez maszynê lokaln± docieraj± do filtra inn± drog± ni¿
      pakiety wys³ane z sieci wewnêtrznej. Te ostatnie musz± przej¶æ przez
      most, natomiast pakiety wys³ane lokalnie trafiaj± na stos IP maszyny.
      Osobne zestawy regu³ obs³uguj± obydwa przypadki. Z kolei regu³y
      zawieraj±ce <literal xmlns:xlink="http://www.w3.org/1999/xlink">in via fxp0</literal>
      odnosz± siê do obu rodzajów pakietów. Mówi±c ogólnie, pisz±c regu³y
      <option xmlns:xlink="http://www.w3.org/1999/xlink">in via</option> trzeba zrobiæ wyj±tek dla pakietów wysy³anych
      z lokalnej maszyny, poniewa¿ one nie przysz³y przez ¿aden z
      interfejsów.</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="filtering-bridges-contributors">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Podziêkowania</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Du¿a czê¶æ niniejszego artyku³u zaczerpniêta zosta³a ze starego
      dokumentu o mostach autorstwa Nicka Sayera. Inspiracj± by³o równie¿
      wprowadzenie do tematyki mostów napisane przez Steve'a Petersona.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Bardzo dziêkujê Luigiemu Rizzo za implementacjê kodu mostu w
      FreeBSD, jak równie¿ za czas po¶wiêcony na odpowiedzi na moje
      pytania.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Dziêkujê te¿ Tomowi Rhodesowi, który zechcia³ przyjrzeæ siê
      mojemu t³umaczeniu tego artyku³u z w³oskiego (w takim jêzyku napisany
      by³ orygina³) na angielski.</para>
  </sect1>
</article>
