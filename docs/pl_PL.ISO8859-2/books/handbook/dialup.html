<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>22.4. Dial-in Service</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="serialcomms.html" title="Rozdzia³ 22. Serial Communications" /><link rel="prev" href="term.html" title="22.3. Terminals" /><link rel="next" href="dialout.html" title="22.5. Dial-out Service" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">22.4. Dial-in Service</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="term.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 22. Serial Communications</th><td width="20%" align="right"> <a accesskey="n" href="dialout.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dialup"></a>22.4. Dial-in Service</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Guy</span> <span class="surname">Helmer</span></span>. </span></div><div><span class="authorgroup">Additions by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Sean</span> <span class="surname">Kelly</span></span>. </span></div></div></div><a id="idp91293648" class="indexterm"></a><p>Configuring your FreeBSD system for dial-in service is very
      similar to connecting terminals except that you are dealing with
      modems instead of terminals.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91294544"></a>22.4.1. External vs. Internal Modems</h3></div></div></div><p>External modems seem to be more convenient for dial-up, because
	  external modems often can be semi-permanently configured via
	  parameters stored in non-volatile RAM and they usually provide
	  lighted indicators that display the state of important RS-232
	  signals.  Blinking lights impress visitors, but lights are also very
	  useful to see whether a modem is operating properly.</p><p>Internal modems usually lack non-volatile RAM, so their
	  configuration may be limited only to setting DIP switches.  If your
	  internal modem has any signal indicator lights, it is probably
	  difficult to view the lights when the system's cover is in
	  place.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91295952"></a>22.4.1.1. Modems and Cables</h4></div></div></div><a id="idp91296720" class="indexterm"></a><p>If you are using an external modem, then you will of
	  course need the proper cable.  A standard RS-232C serial
	  cable should suffice as long as all of the normal signals
	  are wired:</p><div class="table"><a id="serialcomms-signal-names"></a><div class="table-title">Tabela 22.4. Signal Names</div><div class="table-contents"><table summary="Signal Names" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Acronyms</th><th align="left">Names</th></tr></thead><tbody><tr><td><acronym class="acronym">RD</acronym></td><td>Received Data</td></tr><tr><td><acronym class="acronym">TD</acronym></td><td>Transmitted Data</td></tr><tr><td><acronym class="acronym">DTR</acronym></td><td>Data Terminal Ready</td></tr><tr><td><acronym class="acronym">DSR</acronym></td><td>Data Set Ready</td></tr><tr><td><acronym class="acronym">DCD</acronym></td><td>Data Carrier Detect (RS-232's Received Line
		    Signal Detector)</td></tr><tr><td><acronym class="acronym">SG</acronym></td><td>Signal Ground</td></tr><tr><td><acronym class="acronym">RTS</acronym></td><td>Request to Send</td></tr><tr><td><acronym class="acronym">CTS</acronym></td><td>Clear to Send</td></tr></tbody></table></div></div><br class="table-break" /><p>FreeBSD needs the <acronym class="acronym">RTS</acronym> and
	  <acronym class="acronym">CTS</acronym> signals for flow control at speeds above
	  2400 bps, the <acronym class="acronym">CD</acronym> signal to detect when a call has
	  been answered or the line has been hung up, and the
	  <acronym class="acronym">DTR</acronym> signal to reset the modem after a session is
	  complete.  Some cables are wired without all of the needed signals,
	  so if you have problems, such as a login session not going away when
	  the line hangs up, you may have a problem with your cable.</p><p>Like other <span class="trademark">UNIX</span>(R) like operating systems, FreeBSD uses the
	  hardware signals to find out when a call has been answered
	  or a line has been hung up and to hangup and reset the modem
	  after a call.  FreeBSD avoids sending commands to the modem
	  or watching for status reports from the modem.  If you are
	  familiar with connecting modems to PC-based bulletin board
	  systems, this may seem awkward.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91323344"></a>22.4.2. Serial Interface Considerations</h3></div></div></div><p>FreeBSD supports NS8250-, NS16450-, NS16550-, and NS16550A-based
	  EIA RS-232C (CCITT V.24) communications interfaces.  The 8250 and
	  16450 devices have single-character buffers.  The 16550 device
	  provides a 16-character buffer, which allows for better system
	  performance.  (Bugs in plain 16550's prevent the use of the
	  16-character buffer, so use 16550A's if possible).  Because
	  single-character-buffer devices require more work by the operating
	  system than the 16-character-buffer devices, 16550A-based serial
	  interface cards are much preferred. If the system has many active
	  serial ports or will have a heavy load, 16550A-based cards are
	  better for low-error-rate communications.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91324496"></a>22.4.3. Quick Overview</h3></div></div></div><a id="idp91325136" class="indexterm"></a><p>As with terminals, <code class="command">init</code> spawns a
	<code class="command">getty</code> process for each configured serial
	port for dial-in connections.  For example, if a modem is
	attached to <code class="filename">/dev/ttyd0</code>, the command
	<code class="command">ps ax</code> might show this:</p><pre class="screen"> 4850 ??  I      0:00.09 /usr/libexec/getty V19200 ttyd0</pre><p>When a user dials the modem's line and the modems connect, the
	<acronym class="acronym">CD</acronym> (Carrier Detect) line is reported by the modem.
	The kernel
	notices that carrier has been detected and completes
	<code class="command">getty</code>'s open of the port.  <code class="command">getty</code>
	sends a <code class="prompt">login:</code> prompt at the specified initial line
	speed.  <code class="command">getty</code> watches to see if legitimate
	characters are received, and, in a typical configuration, if it finds
	junk (probably due to the modem's connection speed being different
	than <code class="command">getty</code>'s speed), <code class="command">getty</code> tries
	adjusting the line speeds until it receives reasonable
	characters.</p><a id="idp91335376" class="indexterm"></a><p>After the user enters his/her login name,
	<code class="command">getty</code> executes
	<code class="filename">/usr/bin/login</code>, which completes the login
	by asking for the user's password and then starting the user's
	shell.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91337552"></a>22.4.4. Configuration Files</h3></div></div></div><p>There are three system configuration files in the
	<code class="filename">/etc</code> directory that you will probably need to
	edit to allow dial-up access to your FreeBSD system.  The first,
	<code class="filename">/etc/gettytab</code>, contains configuration information
	for the <code class="filename">/usr/libexec/getty</code> daemon.  Second,
	<code class="filename">/etc/ttys</code> holds information that tells
	<code class="filename">/sbin/init</code> what <code class="filename">tty</code> devices
	should have <code class="command">getty</code> processes running on them.
	Lastly, you can place port initialization commands in the
	<code class="filename">/etc/rc.d/serial</code> script.</p><p>There are two schools of thought regarding dial-up modems on <span class="trademark">UNIX</span>(R).
	One group likes to configure their modems and systems so that no matter
	at what speed a remote user dials in, the local computer-to-modem
	RS-232 interface runs at a locked speed.  The benefit of this
	configuration is that the remote user always sees a system login
	prompt immediately.  The downside is that the system does not know
	what a user's true data rate is, so full-screen programs like Emacs
	will not adjust their screen-painting methods to make their response
	better for slower connections.</p><p>The other school configures their modems' RS-232 interface to vary
	its speed based on the remote user's connection speed.  For example,
	V.32bis (14.4 Kbps) connections to the modem might make the modem run
	its RS-232 interface at 19.2 Kbps, while 2400 bps connections make the
	modem's RS-232 interface run at 2400 bps. Because
	<code class="command">getty</code> does not understand any particular modem's
	connection speed reporting, <code class="command">getty</code> gives a
	<code class="prompt">login:</code> message at an initial speed and watches the
	characters that come back in response.  If the user sees junk, it is
	assumed that they know they should press the
	<span class="keycode">Enter</span> key until they see a recognizable
	prompt.  If the data rates do not match, <code class="command">getty</code> sees
	anything the user types as <span class="quote">"<span class="quote">junk</span>"</span>, tries going to the next
	speed and gives the <code class="prompt">login:</code> prompt again.  This
	procedure can continue ad nauseam, but normally only takes a keystroke
	or two before the user sees a good prompt.  Obviously, this login
	sequence does not look as clean as the former
	<span class="quote">"<span class="quote">locked-speed</span>"</span> method, but a user on a low-speed
	connection should receive better interactive response from full-screen
	programs.</p><p>This section will try to give balanced configuration information,
	but is biased towards having the modem's data rate follow the
	connection rate.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91346640"></a>22.4.4.1. <code class="filename">/etc/gettytab</code></h4></div></div></div><a id="idp91347408" class="indexterm"></a><p><code class="filename">/etc/gettytab</code> is a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=termcap&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">termcap</span>(5)</span></a>-style
	  file of configuration information for <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getty&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">getty</span>(8)</span></a>.  Please see the
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gettytab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">gettytab</span>(5)</span></a> manual page for complete information on the
	  format of the file and the list of capabilities.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91355472"></a>22.4.4.1.1. Locked-speed Config</h5></div></div></div><p>If you are locking your modem's data communications rate at a
	    particular speed, you probably will not need to make any changes
	    to <code class="filename">/etc/gettytab</code>.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91357008"></a>22.4.4.1.2. Matching-speed Config</h5></div></div></div><p>You will need to set up an entry in
	    <code class="filename">/etc/gettytab</code> to give
	    <code class="command">getty</code> information about the speeds you wish to
	    use for your modem.  If you have a 2400 bps modem, you can
	    probably use the existing <code class="literal">D2400</code> entry.</p><pre class="programlisting">#
# Fast dialup terminals, 2400/1200/300 rotary (can start either way)
#
D2400|d2400|Fast-Dial-2400:\
        :nx=D1200:tc=2400-baud:
3|D1200|Fast-Dial-1200:\
        :nx=D300:tc=1200-baud:
5|D300|Fast-Dial-300:\
        :nx=D2400:tc=300-baud:</pre><p>If you have a higher speed modem, you will probably need to
	    add an entry in <code class="filename">/etc/gettytab</code>; here is an
	    entry you could use for a 14.4 Kbps modem with a top interface
	    speed of 19.2 Kbps:</p><pre class="programlisting">#
# Additions for a V.32bis Modem
#
um|V300|High Speed Modem at 300,8-bit:\
        :nx=V19200:tc=std.300:
un|V1200|High Speed Modem at 1200,8-bit:\
        :nx=V300:tc=std.1200:
uo|V2400|High Speed Modem at 2400,8-bit:\
        :nx=V1200:tc=std.2400:
up|V9600|High Speed Modem at 9600,8-bit:\
        :nx=V2400:tc=std.9600:
uq|V19200|High Speed Modem at 19200,8-bit:\
        :nx=V9600:tc=std.19200:</pre><p>This will result in 8-bit, no parity connections.</p><p>The example above starts the communications rate at 19.2 Kbps
	    (for a V.32bis connection), then cycles through 9600 bps (for
	    V.32), 2400 bps, 1200 bps, 300 bps, and back to 19.2 Kbps.
	    Communications rate cycling is implemented with the
	    <code class="literal">nx=</code> (<span class="quote">"<span class="quote">next table</span>"</span>) capability.
	    Each of the lines uses a <code class="literal">tc=</code> (<span class="quote">"<span class="quote">table
	    continuation</span>"</span>) entry to pick up the rest of the
	    <span class="quote">"<span class="quote">standard</span>"</span> settings for a particular data rate.</p><p>If you have a 28.8 Kbps modem and/or you want to take
	    advantage of compression on a 14.4 Kbps modem, you need to use a
	    higher communications rate than 19.2 Kbps.  Here is an example of
	    a <code class="filename">gettytab</code> entry starting a 57.6 Kbps:</p><pre class="programlisting">#
# Additions for a V.32bis or V.34 Modem
# Starting at 57.6 Kbps
#
vm|VH300|Very High Speed Modem at 300,8-bit:\
        :nx=VH57600:tc=std.300:
vn|VH1200|Very High Speed Modem at 1200,8-bit:\
        :nx=VH300:tc=std.1200:
vo|VH2400|Very High Speed Modem at 2400,8-bit:\
        :nx=VH1200:tc=std.2400:
vp|VH9600|Very High Speed Modem at 9600,8-bit:\
        :nx=VH2400:tc=std.9600:
vq|VH57600|Very High Speed Modem at 57600,8-bit:\
        :nx=VH9600:tc=std.57600:</pre><p>If you have a slow CPU or a heavily loaded system and do
	    not have 16550A-based serial ports, you may receive
	    <span class="errorname">sio</span>
	    <span class="quote">"<span class="quote">silo</span>"</span> errors at 57.6 Kbps.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="dialup-ttys"></a>22.4.4.2. <code class="filename">/etc/ttys</code></h4></div></div></div><a id="idp91367120" class="indexterm"></a><p>Configuration of the <code class="filename">/etc/ttys</code> file
	  was covered in <a class="xref" href="term.html#ex-etc-ttys" title="Przyk³ad 22.1. Adding Terminal Entries to /etc/ttys">Przyk³ad 22.1, "Adding Terminal Entries to
	    <code class="filename">/etc/ttys</code>"</a>.
	  Configuration for modems is similar but we must pass a
	  different argument to <code class="command">getty</code> and specify a
	  different terminal type.  The general format for both
	  locked-speed and matching-speed configurations is:</p><pre class="programlisting">ttyd0   "/usr/libexec/getty <em class="replaceable"><code>xxx</code></em>"   dialup on</pre><p>The first item in the above line is the device special file for
	  this entry - <code class="literal">ttyd0</code> means
	  <code class="filename">/dev/ttyd0</code> is the file that this
	  <code class="command">getty</code> will be watching.  The second item,
	  <code class="literal">"/usr/libexec/getty
	    xxx"</code>
	  (<em class="replaceable"><code>xxx</code></em> will be replaced by the initial
	  <code class="filename">gettytab</code> capability) is the process
	  <code class="command">init</code> will run on the device.  The third item,
	  <code class="literal">dialup</code>, is the default terminal type.  The fourth
	  parameter, <code class="literal">on</code>, indicates to
	  <code class="command">init</code> that the line is operational.  There can be
	  a fifth parameter, <code class="literal">secure</code>, but it should only be
	  used for terminals which are physically secure (such as the system
	  console).</p><p>The default terminal type (<code class="literal">dialup</code> in the
	  example above) may depend on local preferences.
	  <code class="literal">dialup</code> is the traditional default terminal type
	  on dial-up lines so that users may customize their login scripts to
	  notice when the terminal is <code class="literal">dialup</code> and
	  automatically adjust their terminal type.  However, the author finds
	  it easier at his site to specify <code class="literal">vt102</code> as the
	  default terminal type, since the users just use VT102 emulation on
	  their remote systems.</p><p>After you have made changes to <code class="filename">/etc/ttys</code>,
	  you may send the <code class="command">init</code> process a
	  <acronym class="acronym">HUP</acronym> signal to re-read the file.  You can use the
	  command

	</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP 1</code></strong></pre><p>

	  to send the signal.  If this is your first time setting up the
	  system, you may want to wait until your modem(s) are properly
	  configured and connected before signaling <code class="command">init</code>.
	  </p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91388368"></a>22.4.4.2.1. Locked-speed Config</h5></div></div></div><p>For a locked-speed configuration, your
	    <code class="filename">ttys</code> entry needs to have a fixed-speed entry
	    provided to <code class="command">getty</code>.  For a modem whose port
	    speed is locked at 19.2 Kbps, the <code class="filename">ttys</code> entry
	    might look like this:</p><pre class="programlisting">ttyd0   "/usr/libexec/getty std.19200"   dialup on</pre><p>If your modem is locked at a different data rate,
	    substitute the appropriate value for
	    <code class="literal">std.speed</code>
	    instead of <code class="literal">std.19200</code>.  Make sure that
	    you use a valid type listed in
	    <code class="filename">/etc/gettytab</code>.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91392592"></a>22.4.4.2.2. Matching-speed Config</h5></div></div></div><p>In a matching-speed configuration, your
	    <code class="filename">ttys</code> entry needs to reference the appropriate
	    beginning <span class="quote">"<span class="quote">auto-baud</span>"</span> (sic) entry in
	    <code class="filename">/etc/gettytab</code>.  For example, if you added the
	    above suggested entry for a matching-speed modem that starts at
	    19.2 Kbps (the <code class="filename">gettytab</code> entry containing the
	    <code class="literal">V19200</code> starting point), your
	    <code class="filename">ttys</code> entry might look like this:</p><pre class="programlisting">ttyd0   "/usr/libexec/getty V19200"   dialup on</pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91396688"></a>22.4.4.3. <code class="filename">/etc/rc.d/serial</code></h4></div></div></div><a id="idp91397456" class="indexterm"></a><p>High-speed modems, like V.32, V.32bis, and V.34 modems,
	  need to use hardware (<code class="literal">RTS/CTS</code>) flow
	  control. You can add <code class="command">stty</code> commands to
	  <code class="filename">/etc/rc.d/serial</code> to set the hardware flow
	  control flag in the FreeBSD kernel for the modem
	  ports.</p><p>For example to set the <code class="literal">termios</code> flag
	  <code class="varname">crtscts</code> on serial port #1's
	  (<code class="filename">COM2</code>) dial-in and dial-out initialization
	  devices, the following lines could be added to
	  <code class="filename">/etc/rc.d/serial</code>:</p><pre class="programlisting"># Serial port initial configuration
stty -f /dev/ttyd1.init crtscts
stty -f /dev/cuad1.init crtscts</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91402960"></a>22.4.5. Modem Settings</h3></div></div></div><p>If you have a modem whose parameters may be permanently set in
	non-volatile RAM, you will need to use a terminal program (such as
	Telix under <span class="trademark">MS-DOS</span>(R) or <code class="command">tip</code> under FreeBSD) to set the
	parameters.  Connect to the modem using the same communications speed
	as the initial speed <code class="command">getty</code> will use and configure
	the modem's non-volatile RAM to match these requirements:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><acronym class="acronym">CD</acronym> asserted when connected</p></li><li class="listitem"><p><acronym class="acronym">DTR</acronym> asserted for operation; dropping DTR
	    hangs up line and resets modem</p></li><li class="listitem"><p><acronym class="acronym">CTS</acronym> transmitted data flow control</p></li><li class="listitem"><p>Disable <acronym class="acronym">XON/XOFF</acronym> flow control</p></li><li class="listitem"><p><acronym class="acronym">RTS</acronym> received data flow control</p></li><li class="listitem"><p>Quiet mode (no result codes)</p></li><li class="listitem"><p>No command echo</p></li></ul></div><p>Please read the documentation for your modem to find out what
	commands and/or DIP switch settings you need to give it.</p><p>For example, to set the above parameters on a <span class="trademark">U.S. Robotics</span>(R)
	<span class="trademark">Sportster</span>(R) 14,400 external modem, one could give these commands to
	the modem:</p><pre class="programlisting">ATZ
AT&amp;C1&amp;D2&amp;H1&amp;I0&amp;R2&amp;W</pre><p>You might also want to take this opportunity to adjust other
	settings in the modem, such as whether it will use V.42bis and/or MNP5
	compression.</p><p>The <span class="trademark">U.S. Robotics</span>(R) <span class="trademark">Sportster</span>(R) 14,400 external modem also has some DIP switches
	that need to be set; for other modems, perhaps you can use these
	settings as an example:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Switch 1: UP - DTR Normal</p></li><li class="listitem"><p>Switch 2: N/A (Verbal Result Codes/Numeric Result
	    Codes)</p></li><li class="listitem"><p>Switch 3: UP - Suppress Result Codes</p></li><li class="listitem"><p>Switch 4: DOWN - No echo, offline commands</p></li><li class="listitem"><p>Switch 5: UP - Auto Answer</p></li><li class="listitem"><p>Switch 6: UP - Carrier Detect Normal</p></li><li class="listitem"><p>Switch 7: UP - Load NVRAM Defaults</p></li><li class="listitem"><p>Switch 8: N/A (Smart Mode/Dumb Mode)</p></li></ul></div><p>Result codes should be disabled/suppressed for dial-up modems to
	avoid problems that can occur if <code class="command">getty</code> mistakenly
	gives a <code class="prompt">login:</code> prompt to a modem that is in command
	mode and the modem echoes the command or returns a result
	code.  This sequence can result in a extended, silly conversation
 	between <code class="command">getty</code> and the modem.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91433168"></a>22.4.5.1. Locked-speed Config</h4></div></div></div><p>For a locked-speed configuration, you will need to configure the
	  modem to maintain a constant modem-to-computer data rate independent
	  of the communications rate.  On a <span class="trademark">U.S. Robotics</span>(R) <span class="trademark">Sportster</span>(R) 14,400 external
	  modem, these commands will lock the modem-to-computer data rate at
	  the speed used to issue the commands:</p><pre class="programlisting">ATZ
AT&amp;B1&amp;W</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91435984"></a>22.4.5.2. Matching-speed Config</h4></div></div></div><p>For a variable-speed configuration, you will need to configure
	  your modem to adjust its serial port data rate to match the incoming
	  call rate.  On a <span class="trademark">U.S. Robotics</span>(R) <span class="trademark">Sportster</span>(R) 14,400 external modem, these commands
	  will lock the modem's error-corrected data rate to the speed used to
	  issue the commands, but allow the serial port rate to vary for
	  non-error-corrected connections:</p><pre class="programlisting">ATZ
AT&amp;B2&amp;W</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91438544"></a>22.4.5.3. Checking the Modem's Configuration</h4></div></div></div><p>Most high-speed modems provide commands to view the modem's
	  current operating parameters in a somewhat human-readable fashion.
	  On the <span class="trademark">U.S. Robotics</span>(R) <span class="trademark">Sportster</span>(R) 14,400 external modems, the command
	  <code class="command">ATI5</code> displays the settings that are stored in the
	  non-volatile RAM.  To see the true operating parameters of the modem
	  (as influenced by the modem's DIP switch settings), use the commands
	  <code class="command">ATZ</code> and then <code class="command">ATI4</code>.</p><p>If you have a different brand of modem, check your modem's
	  manual to see how to double-check your modem's configuration
	  parameters.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91442384"></a>22.4.6. Troubleshooting</h3></div></div></div><p>Here are a few steps you can follow to check out the dial-up modem
	on your system.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91443408"></a>22.4.6.1. Checking Out the FreeBSD System</h4></div></div></div><p>Hook up your modem to your FreeBSD system, boot the system, and,
	  if your modem has status indication lights, watch to see whether the
	  modem's <acronym class="acronym">DTR</acronym> indicator lights when the
	  <code class="prompt">login:</code> prompt appears on the system's console
	  - if it lights up, that should mean that FreeBSD has started a
	  <code class="command">getty</code> process on the appropriate communications
	  port and is waiting for the modem to accept a call.</p><p>If the <acronym class="acronym">DTR</acronym> indicator does not light, login to
	  the FreeBSD system through the console and issue a <code class="command">ps
	    ax</code> to see if FreeBSD is trying to run a
	  <code class="command">getty</code> process on the correct port. You should see
	  lines like these among the processes displayed:</p><pre class="screen">  114 ??  I      0:00.10 /usr/libexec/getty V19200 ttyd0
  115 ??  I      0:00.10 /usr/libexec/getty V19200 ttyd1</pre><p>If you see something different, like this:</p><pre class="screen">  114 d0  I      0:00.10 /usr/libexec/getty V19200 ttyd0</pre><p>and the modem has not accepted a call yet, this means that
	  <code class="command">getty</code> has completed its open on the
	  communications port.  This could indicate a problem with the cabling
	  or a mis-configured modem, because <code class="command">getty</code> should
	  not be able to open the communications port until
	  <acronym class="acronym">CD</acronym> (carrier detect) has been asserted by the
	  modem.</p><p>If you do not see any <code class="command">getty</code> processes waiting
	  to open the desired
	  <code class="filename">ttydN</code> port,
	  double-check your entries in <code class="filename">/etc/ttys</code> to see
	  if there are any mistakes there.  Also, check the log file
	  <code class="filename">/var/log/messages</code> to see if there are any log
	  messages from <code class="command">init</code> or <code class="command">getty</code>
	  regarding any problems.  If there are any messages, triple-check the
	  configuration files <code class="filename">/etc/ttys</code> and
	  <code class="filename">/etc/gettytab</code>, as well as the appropriate
	  device special files <code class="filename">/dev/ttydN</code>, for any
	  mistakes, missing entries, or missing device special files.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91458256"></a>22.4.6.2. Try Dialing In</h4></div></div></div><p>Try dialing into the system; be sure to use 8 bits, no parity,
	  and 1
	  stop bit on the remote system.  If you do not get a prompt right
	  away, or get garbage, try pressing <span class="keycode">Enter</span>
	  about once per second.  If you still do not see a
	  <code class="prompt">login:</code> prompt after a while, try sending a
	  <code class="command">BREAK</code>. If you are using a high-speed modem to do
	  the dialing, try dialing again after locking the dialing modem's
	  interface speed (via <code class="command">AT&amp;B1</code> on a <span class="trademark">U.S. Robotics</span>(R)
	  <span class="trademark">Sportster</span>(R) modem, for example).</p><p>If you still cannot get a <code class="prompt">login:</code> prompt, check
	  <code class="filename">/etc/gettytab</code> again and double-check
	  that</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The initial capability name specified in
	      <code class="filename">/etc/ttys</code> for the line matches a name of a
	      capability in <code class="filename">/etc/gettytab</code></p></li><li class="listitem"><p>Each <code class="literal">nx=</code> entry matches another
	      <code class="filename">gettytab</code> capability name</p></li><li class="listitem"><p>Each <code class="literal">tc=</code> entry matches another
	      <code class="filename">gettytab</code> capability name</p></li></ul></div><p>If you dial but the modem on the FreeBSD system will not answer,
	  make sure that the modem is configured to answer the phone when
	  <acronym class="acronym">DTR</acronym> is asserted.  If the modem seems to be
	  configured correctly, verify that the <acronym class="acronym">DTR</acronym> line is
	  asserted by checking the modem's indicator lights (if it has
	  any).</p><p>If you have gone over everything several times and it still does
	  not work, take a break and come back to it later.  If it still does
	  not work, perhaps you can send an electronic mail message to the
	  <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">Ogólna lista dyskusyjna FreeBSD</a> describing your modem and your problem, and the good
	  folks on the list will try to help.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="term.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="serialcomms.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="dialout.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">22.3. Terminals </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 22.5. Dial-out Service</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>