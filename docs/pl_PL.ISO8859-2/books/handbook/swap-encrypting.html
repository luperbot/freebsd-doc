<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>17.17. Encrypting Swap Space</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="disks.html" title="Rozdzia³ 17. Storage" /><link rel="prev" href="disks-encrypting.html" title="17.16. Encrypting Disk Partitions" /><link rel="next" href="GEOM.html" title="Rozdzia³ 18. GEOM: Modular Disk Transformation Framework" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">17.17. Encrypting Swap Space</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="disks-encrypting.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 17. Storage</th><td width="20%" align="right"> <a accesskey="n" href="GEOM.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="swap-encrypting"></a>17.17. Encrypting Swap Space</h2></div><div><span class="authorgroup">Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Christian</span> <span class="surname">Brüffer</span></span>. </span></div></div></div><a id="idp89478736" class="indexterm"></a><p>Swap encryption in FreeBSD is easy to configure and has been
      available since FreeBSD 5.3-RELEASE.  Depending on which version
      of FreeBSD is being used, different options are available
      and configuration can vary slightly.  From FreeBSD 6.0-RELEASE onwards,
      the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> or <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> encryption systems can be used
      for swap encryption.  With earlier versions, only <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> is
      available.  Both systems use the <code class="filename">encswap</code>
      <a class="link" href="configtuning-rcd.html" title="11.7. Using rc under FreeBSD">rc.d</a> script.</p><p>The previous section, <a class="link" href="disks-encrypting.html" title="17.16. Encrypting Disk Partitions">Encrypting
      Disk Partitions</a>, includes a short discussion on the different
      encryption systems.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89484368"></a>17.17.1. Why should Swap be Encrypted?</h3></div></div></div><p>Like the encryption of disk partitions, encryption of swap space
	is done to protect sensitive information.  Imagine an application
	that e.g. deals with passwords.  As long as these passwords stay in
	physical memory, all is well.  However, if the operating system starts
	swapping out memory pages to free space for other applications, the
	passwords may be written to the disk platters unencrypted and easy to
	retrieve for an adversary.  Encrypting swap space can be a solution for
	this scenario.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89485520"></a>17.17.2. Preparation</h3></div></div></div><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">For the remainder of this section, <code class="filename">ad0s1b</code>
	  will be the swap partition.</p></div><p>Up to this point the swap has been unencrypted.  It is possible that
	there are already passwords or other sensitive data on the disk platters
	in cleartext.  To rectify this, the data on the swap partition should be
	overwritten with random garbage:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/random of=/dev/ad0s1b bs=1m</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89488848"></a>17.17.3. Swap Encryption with <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a></h3></div></div></div><p>If FreeBSD 6.0-RELEASE or newer is being used, the
	<code class="literal">.bde</code> suffix should be added to the device in the
	respective <code class="filename">/etc/fstab</code> swap line:</p><pre class="screen">
# Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/ad0s1b.bde         none            swap    sw              0       0
      </pre><p>For systems prior to FreeBSD 6.0-RELEASE, the following line
	in <code class="filename">/etc/rc.conf</code> is also needed:</p><pre class="programlisting">gbde_swap_enable="YES"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89492944"></a>17.17.4. Swap Encryption with <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a></h3></div></div></div><p>Alternatively, the procedure for using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> for swap
	encryption is similar to that of using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a>.  The
	<code class="literal">.eli</code> suffix should be added to the device in the
	respective <code class="filename">/etc/fstab</code> swap line:</p><pre class="screen">
# Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/ad0s1b.eli         none            swap    sw              0       0
      </pre><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> uses the <acronym class="acronym">AES</acronym> algorithm with
	a key length of 256 bit by default.</p><p>Optionally, these defaults can be altered using the
	<code class="literal">geli_swap_flags</code> option in
	<code class="filename">/etc/rc.conf</code>.  The following line tells the
	<code class="filename">encswap</code> rc.d script to create <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> swap
	partitions using the Blowfish algorithm with a key length of 128 bit,
	a sectorsize of 4 kilobytes and the <span class="quote">"<span class="quote">detach on last close</span>"</span>
	option set:</p><pre class="programlisting">geli_swap_flags="-a blowfish -l 128 -s 4096 -d"</pre><p>Please refer to the description of the <code class="command">onetime</code> command
	in the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> manual page for a list of possible options.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89516112"></a>17.17.5. Verifying that it Works</h3></div></div></div><p>Once the system has been rebooted, proper operation of the
	encrypted swap can be verified using the
	<code class="command">swapinfo</code> command.</p><p>If <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gbde&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gbde</span>(8)</span></a> is being used:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>swapinfo</code></strong>
Device          1K-blocks     Used    Avail Capacity
/dev/ad0s1b.bde    542720        0   542720     0%
      </pre><p>If <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=geli&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">geli</span>(8)</span></a> is being used:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>swapinfo</code></strong>
Device          1K-blocks     Used    Avail Capacity
/dev/ad0s1b.eli    542720        0   542720     0%
      </pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="disks-encrypting.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="GEOM.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">17.16. Encrypting Disk Partitions </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> Rozdzia³ 18. GEOM: Modular Disk Transformation Framework</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>