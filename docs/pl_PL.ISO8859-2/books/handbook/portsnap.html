<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>A.6. Using Portsnap</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="mirrors.html" title="Dodatek A. Obtaining FreeBSD" /><link rel="prev" href="cvsup.html" title="A.5. Using CVSup" /><link rel="next" href="cvs-tags.html" title="A.7. CVS Tags" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">A.6. Using Portsnap</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="cvsup.html">Poprzedni</a> </td><th width="60%" align="center">Dodatek A. Obtaining FreeBSD</th><td width="20%" align="right"> <a accesskey="n" href="cvs-tags.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="portsnap"></a>A.6. Using Portsnap</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="portsnap-intro"></a>A.6.1. Introduction</h3></div></div></div><p><span class="application">Portsnap</span> is a system for securely
	distributing the FreeBSD ports tree.  Approximately once an hour,
	a <span class="quote">"<span class="quote">snapshot</span>"</span> of the ports tree is generated,
	repackaged, and cryptographically signed.  The resulting files
	are then distributed via HTTP.</p><p>Like <span class="application">CVSup</span>,
	<span class="application">Portsnap</span> uses a
	<span class="emphasis"><em>pull</em></span> model of updating: The packaged and
	signed ports trees are placed on a web server which waits
	passively for clients to request files.  Users must either run
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=portsnap&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">portsnap</span>(8)</span></a> manually to download updates
	or set up a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> job to download updates
	automatically on a regular basis.</p><p>For technical reasons, <span class="application">Portsnap</span>
	does not update the <span class="quote">"<span class="quote">live</span>"</span> ports tree in
	<code class="filename">/usr/ports/</code> directly; instead, it works
	via a compressed copy of the ports tree stored in
	<code class="filename">/var/db/portsnap/</code> by default.  This
	compressed copy is then used to update the live ports tree.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">If <span class="application">Portsnap</span> is installed from
	the FreeBSD Ports Collection, then the default location for its
	compressed snapshot will be <code class="filename">/usr/local/portsnap/</code>
	instead of <code class="filename">/var/db/portsnap/</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="portsnap-install"></a>A.6.2. Installation</h3></div></div></div><p>On FreeBSD 6.0 and more recent versions,
	<span class="application">Portsnap</span> is contained in the FreeBSD
	base system.  On older versions of FreeBSD, it can be installed
	using the <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/sysutils/portsnap/pkg-descr">sysutils/portsnap</a>
	port.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="portsnap-config"></a>A.6.3. Portsnap Configuration</h3></div></div></div><p><span class="application">Portsnap</span>'s operation is controlled
	by the <code class="filename">/etc/portsnap.conf</code> configuration
	file.  For most users, the default configuration file will
	suffice; for more details, consult the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=portsnap.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">portsnap.conf</span>(5)</span></a>
	manual page.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">If <span class="application">Portsnap</span> is installed from
	  the FreeBSD Ports Collection, it will use the configuration file
	  <code class="filename">/usr/local/etc/portsnap.conf</code> instead of
	  <code class="filename">/etc/portsnap.conf</code>.  This configuration
	  file is not created when the port is installed, but a sample
	  configuration file is distributed; to copy it into place, run
	  the following command:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/local/etc &amp;&amp; cp portsnap.conf.sample portsnap.conf</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98132560"></a>A.6.4. Running <span class="application">Portsnap</span> for the First
	Time</h3></div></div></div><p>The first time <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=portsnap&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">portsnap</span>(8)</span></a> is run,
	it will need to download a compressed snapshot of the entire
	ports tree into <code class="filename">/var/db/portsnap/</code> (or
	<code class="filename">/usr/local/portsnap/</code> if
	<span class="application">Portsnap</span> was installed from the
	Ports Collection).  For the beginning of 2006 this is approximately a 41 MB
	download.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch</code></strong></pre><p>Once the compressed snapshot has been downloaded, a
	<span class="quote">"<span class="quote">live</span>"</span> copy of the ports tree can be extracted into
	<code class="filename">/usr/ports/</code>.  This is necessary even if a
	ports tree has already been created in that directory (e.g., by
	using <span class="application">CVSup</span>), since it establishes a
	baseline from which <code class="command">portsnap</code> can
	determine which parts of the ports tree need to be updated
	later.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap extract</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">In the default installation
	  <code class="filename">/usr/ports</code> is not
	  created.  If you run FreeBSD 6.0-RELEASE, it should be created before
	  <code class="command">portsnap</code> is used.  On more recent
	  versions of FreeBSD or <span class="application">Portsnap</span>,
	  this operation will be done automatically at first use
	  of the <code class="command">portsnap</code> command.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98146256"></a>A.6.5. Updating the Ports Tree</h3></div></div></div><p>After an initial compressed snapshot of the ports tree has
	been downloaded and extracted into <code class="filename">/usr/ports/</code>,
	updating the ports tree consists of two steps:
	<span class="emphasis"><em>fetch</em></span>ing updates to the compressed
	snapshot, and using them to <span class="emphasis"><em>update</em></span> the
	live ports tree.  These two steps can be specified to
	<code class="command">portsnap</code> as a single command:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch update</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some older versions of <code class="command">portsnap</code>
	  do not support this syntax; if it fails, try instead the
	  following:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portsnap fetch</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>portsnap update</code></strong></pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98156880"></a>A.6.6. Running Portsnap from cron</h3></div></div></div><p>In order to avoid problems with <span class="quote">"<span class="quote">flash crowds</span>"</span>
	accessing the <span class="application">Portsnap</span> servers,
	<code class="command">portsnap fetch</code> will not run from
	a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a> job.  Instead, a special
	<code class="command">portsnap cron</code> command exists, which
	waits for a random duration up to 3600 seconds before fetching
	updates.</p><p>In addition, it is strongly recommended that
	<code class="command">portsnap update</code> not be run from a
	<code class="command">cron</code> job, since it is liable to cause
	major problems if it happens to run at the same time as a port
	is being built or installed.  However, it is safe to update
	the ports' <code class="filename">INDEX</code> files, and this can be done by passing the
	<code class="option">-I</code> flag to
	<code class="command">portsnap</code>.  (Obviously, if
	<code class="command">portsnap -I update</code> is run from
	<code class="command">cron</code>, then it will be necessary to run
	<code class="command">portsnap update</code> without the <code class="option">-I</code>
	flag at a later time in order to update the rest of the tree.)</p><p>Adding the following line to <code class="filename">/etc/crontab</code>
	will cause <code class="command">portsnap</code> to update its
	compressed snapshot and the <code class="filename">INDEX</code> files in
	<code class="filename">/usr/ports/</code>, and will send an email if any
	installed ports are out of date:</p><pre class="programlisting">0 3 * * * root portsnap -I cron update &amp;&amp; pkg_version -vIL=</pre><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">If the system clock is not set to the local time zone,
	  please replace <code class="literal">3</code> with a random
	  value between 0 and 23, in order to spread the load on the
	  <span class="application">Portsnap</span> servers more evenly.</p></div><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">Some older versions of <code class="command">portsnap</code>
	  do not support listing multiple commands (e.g., <code class="literal">cron update</code>)
	  in the same invocation of <code class="command">portsnap</code>.  If
	  the line above fails, try replacing
	  <code class="command">portsnap -I cron update</code> with
	  <code class="command">portsnap cron &amp;&amp; portsnap -I update</code>.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="cvsup.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="mirrors.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="cvs-tags.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">A.5. Using CVSup </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> A.7. CVS Tags</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>