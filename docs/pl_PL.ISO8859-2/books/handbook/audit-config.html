<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>16.4. Audit Configuration</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="audit.html" title="Rozdzia³ 16. Security Event Auditing" /><link rel="prev" href="audit-install.html" title="16.3. Installing Audit Support" /><link rel="next" href="audit-administration.html" title="16.5. Event Audit Administration" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">16.4. Audit Configuration</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="audit-install.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 16. Security Event Auditing</th><td width="20%" align="right"> <a accesskey="n" href="audit-administration.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="audit-config"></a>16.4. Audit Configuration</h2></div></div></div><p>All configuration files for security audit are found in
      <code class="filename">/etc/security</code>.  The following
      files must be present before the audit daemon is started:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">audit_class</code> - Contains the
	  definitions of the audit classes.</p></li><li class="listitem"><p><code class="filename">audit_control</code> - Controls aspects
	  of the audit subsystem, such as default audit classes,
	  minimum disk space to leave on the audit log volume,
	  etc.</p></li><li class="listitem"><p><code class="filename">audit_event</code> - Defines the kernel
	  audit events.  These map, mostly, to system calls.</p></li><li class="listitem"><p><code class="filename">audit_user</code> - The events to audit
	  for individual users.  Users not appearing here will be
	  subject to the default configuration in the control
	  configuration file.</p></li><li class="listitem"><p><code class="filename">audit_warn</code> - A shell script
	  used by auditd to generate warning messages in
	  exceptional situations, such as when space for audit
	  records is running low.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87958352"></a>16.4.1. Audit File Syntax</h3></div></div></div><p>The configuration file syntax is rather arcane, albeit easy
	to work with.  One thing an administrator must be leery about
	is overriding system defaults.  This could create potential
	openings for audit data to not be collected properly.</p><p>The audit subsystem will accept both the short name and
	long name with regards to configuration syntax.  A syntax
	map has been included below.</p><p>The following list contains all supported audit
	classes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="option">all</code> - <code class="literal">all</code> - All
	    audit flags set.</p></li><li class="listitem"><p><code class="option">ad</code> - <code class="literal">administrative</code>
	    - Administrative actions performed on the system as a
	    whole.</p></li><li class="listitem"><p><code class="option">ap</code> - <code class="literal">application</code> -
	    Application defined action.</p></li><li class="listitem"><p><code class="option">cl</code> - <code class="literal">file_close</code> -
	    Audit calls to the <code class="function">close</code> system
	    call.</p></li><li class="listitem"><p><code class="option">ex</code> - <code class="literal">exec</code> - Audit
	    program or utility execution.</p></li><li class="listitem"><p><code class="option">fa</code> - <code class="literal">file_attr_acc</code>
	    - Audit the access of object attributes such as
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=stat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">stat</span>(1)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pathconf&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">pathconf</span>(2)</span></a> and similar events.</p></li><li class="listitem"><p><code class="option">fc</code> - <code class="literal">file_creation</code>
	    - Audit events where a file is created as a result.</p></li><li class="listitem"><p><code class="option">fd</code> - <code class="literal">file_deletion</code>
	    - Audit events where file deletion occurs.</p></li><li class="listitem"><p><code class="option">fm</code> - <code class="literal">file_attr_mod</code>
	    - Audit events where file attribute modification occurs,
	    such as <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chown&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">chown</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=flock&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">flock</span>(2)</span></a>,
	    etc.</p></li><li class="listitem"><p><code class="option">fr</code> - <code class="literal">file_read</code>
	    - Audit events in which data is read, files are opened for
	    reading, etc.</p></li><li class="listitem"><p><code class="option">fw</code> - <code class="literal">file_write</code> -
	    Audit events in which data is written, files are written
	    or modified, etc.</p></li><li class="listitem"><p><code class="option">io</code> - <code class="literal">ioctl</code> - Audit
	    use of the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ioctl&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">ioctl</span>(2)</span></a> system call.</p></li><li class="listitem"><p><code class="option">ip</code> - <code class="literal">ipc</code> - Audit
	    various forms of Inter-Process Communication, including POSIX
	    pipes and System V <acronym class="acronym">IPC</acronym> operations.</p></li><li class="listitem"><p><code class="option">lo</code> - <code class="literal">login_logout</code> -
	    Audit <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">login</span>(1)</span></a> and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=logout&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">logout</span>(1)</span></a> events occurring
	    on the system.</p></li><li class="listitem"><p><code class="option">na</code> - <code class="literal">non_attrib</code> -
	    Audit non-attributable events.</p></li><li class="listitem"><p><code class="option">no</code> - <code class="literal">no_class</code> -
	    Null class used to disable event auditing.</p></li><li class="listitem"><p><code class="option">nt</code> - <code class="literal">network</code> -
	    Audit events related to network actions, such as
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=connect&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">connect</span>(2)</span></a> and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=accept&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">accept</span>(2)</span></a>.</p></li><li class="listitem"><p><code class="option">ot</code> - <code class="literal">other</code> -
	    Audit miscellaneous events.</p></li><li class="listitem"><p><code class="option">pc</code> - <code class="literal">process</code> -
	    Audit process operations, such as <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exec&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">exec</span>(3)</span></a> and
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exit&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">exit</span>(3)</span></a>.</p></li></ul></div><p>Following is a list of all supported audit prefixes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">none</code> - Audit both the success
	    or failure of an event.  For example, just listing a
	    class will result in the auditing of both success and
	    failure.</p></li><li class="listitem"><p><code class="literal">+</code> - Audit successful events
	    only.</p></li><li class="listitem"><p><code class="literal">-</code> - Audit failed events
	    only.</p></li></ul></div><div xmlns="" class="warning"><h3 class="admontitle">Ostrze¿enie: </h3><p xmlns="http://www.w3.org/1999/xhtml">Using the <code class="option">all</code> class with either the
	  positive or negative prefix can generate a large amount
	  of data at an extremely rapid rate.</p></div><p>Extra prefixes used to modify the default configuration
	values:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>^- - Disable auditing of failed events.</p></li><li class="listitem"><p>^+ - Enable auditing of successful events.</p></li><li class="listitem"><p>^ - Disable auditing of both successful and failed
	    events.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp88022864"></a>16.4.2. Configuration Files</h3></div></div></div><p>In most cases, administrators will need to modify only two files
	when configuring the audit system: <code class="filename">audit_control</code>
	and <code class="filename">audit_user</code>.  The first controls system-wide
	audit paramaters and defaults for both attributable and
	non-attributable events.  The second may be used to tune the level
	and nature of auditing for individual users.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="audit-auditcontrol"></a>16.4.2.1. The <code class="filename">audit_control</code> File</h4></div></div></div><p>The <code class="filename">audit_control</code> file contains some basic
	  defaults that the administrator may wish to modify.  Perhaps
	  even set some new ones.  Viewing the contents of this file,
	  we see the following:</p><pre class="programlisting">dir:/var/audit
flags:lo
minfree:20
naflags:lo</pre><p>The <code class="option">dir</code> option is used to set the default
	  directory where audit logs are stored.  Audit is frequently
	  configured so that audit logs are stored on a dedicated file
	  system, so as to prevent interference between the audit
	  subsystem and other subsystems when file systems become full.
	  </p><p>The <code class="option">flags</code> option is used to set the
	  system-wide defaults.  The current setting, <code class="option">lo</code>
	  configures the auditing of all <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">login</span>(1)</span></a> and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=logout&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">logout</span>(1)</span></a>
	  actions.  A more complex example,
	  <code class="option">lo,ad,-all,^-fa,^-fc,^-cl</code> audits all system
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">login</span>(1)</span></a> and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=logout&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">logout</span>(1)</span></a> actions, all administrator
	  actions, all failed events in the system, and finally disables
	  auditing of failed attempts for <code class="option">fa</code>,
	  <code class="option">fc</code>, and <code class="option">cl</code>.  Even though
	  the <code class="option">-all</code> turned on the auditing of all
	  failed attempts, the <code class="option">^-</code> prefix will override
	  that for the latter options.</p><p>Notice that the previous paragraph shows the file is
	  read from left to right.  As such, values further on the
	  right side may override a previous value specified to
	  its left.</p><p>The <code class="option">minfree</code> option defines the minimum
	  percentage of free space for audit file systems.  This
	  relates to the file system where audit logs are stored.
	  For example, if the <code class="option">dir</code> specifies
	  <code class="filename">/var/audit</code> and
	  <code class="option">minfree</code> is set to twenty (20), warning
	  messages will be generated when the
	  <code class="filename">/var</code> file system grows
	  to eighty (80) percent full.</p><p>The <code class="option">naflags</code> option specifies audit
	  classes to be audited for non-attributed events -
	  that is, events for which there is no authenticated user.
	  </p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="audit-audituser"></a>16.4.2.2. The <code class="filename">audit_user</code> File</h4></div></div></div><p>The <code class="filename">audit_user</code> file permits the
	  administrator to determine which classes of audit events
	  should be logged for which system users.</p><p>The following is the defaults currently placed in
	  the <code class="filename">audit_user</code> file:</p><pre class="programlisting">root:lo:no
audit:fc:no</pre><p>Notice how the default is to audit all cases of
	  <code class="command">login</code>/<code class="command">logout</code>
	  and disable auditing of all other actions for
	  <code class="systemitem">root</code>.  This configuration
	  also audits all file creation and disables all
	  other auditing for the <code class="systemitem">audit</code>
	  user.  While event auditing does not require a special
	  user exist, some configurations, specifically environments
	  making use of <acronym class="acronym">MAC</acronym>, may require it.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="audit-install.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="audit.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="audit-administration.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">16.3. Installing Audit Support </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 16.5. Event Audit Administration</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>