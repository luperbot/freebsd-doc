<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>8.3. Budowanie i instalowanie indywidualnego j±dra</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="kernelconfig.html" title="Rozdzia³ 8. Konfiguracja j±dra FreeBSD" /><link rel="prev" href="kernelconfig-custom-kernel.html" title="8.2. Po co budowaæ indywidualne j±dro?" /><link rel="next" href="kernelconfig-config.html" title="8.4. Plik konfiguracyjny" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">8.3. Budowanie i instalowanie indywidualnego j±dra</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kernelconfig-custom-kernel.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 8. Konfiguracja j±dra FreeBSD</th><td width="20%" align="right"> <a accesskey="n" href="kernelconfig-config.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-building"></a>8.3. Budowanie i instalowanie indywidualnego j±dra</h2></div></div></div><a id="idp80661840" class="indexterm"></a><p>Omówmy pokrótce katalog kompilacji j±dra.  Wszystkie wspomniane
      za chwilê katalogi bêd± relatywnymi wzglêdem <code class="filename">/usr/src/sys</code>,
      do którego mo¿na tak¿e doj¶æ przez <code class="filename">/sys</code>.  Mo¿na tam znale¼æ
      wiele ró¿nych podkatalogów, jednak dla nas najwa¿niejszym bêdzie
      <code class="filename">arch/conf</code>.  W nim w³a¶nie dokonamy
      edycji pliku konfiguracyjnego j±dra oraz je skompilujemy, bêd± to kolejne etapy
      w ca³ym procesie budowy.  <em class="replaceable"><code>arch</code></em> oznacza architekturê,
      do wyboru: <code class="filename">i386</code>, <code class="filename">alpha</code>,
      <code class="filename">amd64</code>, <code class="filename">ia64</code>,
      <code class="filename">powerpc</code>, <code class="filename">sparc64</code>, lub
      <code class="filename">pc98</code> (alternatywna ga³±¼ sprzêtu PC, popularna w Japonii).
      Wszystko, co znajduje siê w katalogu danej architektury dotyczy ¶ci¶le
      tylko jej.  Reszta ¼róde³ jest dla wszystkich architektur taka sama.
      Zwróæmy uwagê na logiczn± strukturê katalogów z ka¿dym wspieranym urz±dzeniem,
      systemem plików, opcjami dodatkowymi - wszystko posiada swój
      w³asny podkatalog.</p><p>Przyk³ady w niniejszym rozdziale zak³adaj±, ¿e wykorzystujemy architekturê i386.
      Je¶li tak nie jest, bêdziemy musieli dokonaæ odpowiednich zmian w nazwach
      ¶cie¿ek dostêpu dla architektury naszego systemu.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">Je¶li <span class="emphasis"><em>nie</em></span> mamy katalogu <code class="filename">/usr/src/sys</code>,
        oznacza to, ¿e nie dysponujemy zainstalowanymi ¼ród³ami j±dra.  Najprostszym sposobem
        na zainstalowanie jest uruchomienie jako <code class="systemitem">root</code>
        <code class="command">sysinstall</code>'a, wybranie <span class="guimenuitem">Configure</span>,
        nastêpnie <span class="guimenuitem">Distributions</span>, pó¼niej <span class="guimenuitem">src</span>,
        a na koñcu <span class="guimenuitem">sys</span>.  Je¶li jednak jeste¶my osobami maj±cymi
        awersjê do konfiguratorów mo¿emy zainstalowaæ ¼ród³a j±dra rêcznie.  W poni¿szym
        przyk³adzie instalacja z <span class="quote">"<span class="quote">oficjalnej</span>"</span> p³yty CD FreeBSD:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount /cdrom</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /usr/src/sys</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /usr/src/sys /sys</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cat /cdrom/src/ssys.[a-d]* | tar -xzvf -</code></strong></pre></div><p>Nastêpnie wchodzimy do katalogu <code class="filename">arch/conf</code>
      i kopiujemy domy¶lny plik konfiguracyjny o nazwie <code class="filename">GENERIC</code> tworz±c
      plik z nazw± jak± chcemy nadaæ swojemu j±dru. Na przyk³ad:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/i386/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC MYKERNEL</code></strong></pre><p>Tradycyjnie nazwa j±dra pisana jest wielkimi literami.  Dodatkowo dobrym pomys³em
      jest, by nazywaæ j±dra tak jak komputery, co pomaga rozró¿niæ j±dra, gdy mamy wiele
      komputerów z ró¿nym sprzêtem.  Dla potrzeb tego przyk³adu nazwiemy j±dro
      <code class="filename">MYKERNEL</code>.</p><div xmlns="" class="tip"><h3 class="admontitle">Podpowied¼: </h3><p xmlns="http://www.w3.org/1999/xhtml">Nie jest najlepszym pomys³em trzymanie pliku konfiguracyjnego j±dra bezpo¶rednio
        w katalogu <code class="filename">/usr/src</code>.  Je¶li podczas kompilacji mamy k³opot,
        czasem mo¿e siê okazaæ kusz±cym pomys³em po prostu wykasowaæ ca³y katalog
        <code class="filename">/usr/src</code> i rozpocz±æ od pocz±tku. Wtedy zwykle, kilka sekund
        po usuniêciu katalogu, przypomina nam siê, ¿e usunêli¶my tak¿e plik konfiguracyjny
        j±dra.  Podobnie, nie powinni¶my edytowaæ bezpo¶rednio <code class="filename">GENERIC</code>,
        gdy¿ mo¿e zostaæ nadpisany przy kolejnej <a class="link" href="cutting-edge.html" title="Rozdzia³ 21. The Cutting Edge">aktualizacji
        naszego drzewa ¼róde³</a> i zmiany, które wprowadzili¶my zostan± utracone.</p><p xmlns="http://www.w3.org/1999/xhtml">Mo¿emy chcieæ trzymaæ plik konfiguracyjny j±dra gdziekolwiek, a nastêpnie utworzyæ
        symboliczne dowi±zanie do pliku w katalogu
        <code class="filename">i386</code>.</p><p xmlns="http://www.w3.org/1999/xhtml">Przyk³adowo:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/sys/i386/conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /root/kernels</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp GENERIC /root/kernels/MYKERNEL</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /root/kernels/MYKERNEL</code></strong></pre></div><p>Przyszed³ czas na edycjê pliku konfiguracyjnego j±dra.  W przyk³adzie nazywa
      siê on <code class="filename">MYKERNEL</code>.  Je¶li dopiero zainstalowali¶my system,
      jedynym z dostêpnych edytorów mo¿e byæ <span class="application">vi</span>.  Mimo, ¿e jest
      dobrze udokumentowany, opisany w wielu <a class="link" href="bibliography.html" title="Dodatek B. Bibliografia">ksi±¿kach</a>, dla pocz±tkuj±cych wydaje siê on nieco
      zbyt skomplikowany.  FreeBSD zaopatrzony jest równie¿ w drugi edytor, znacznie prostszy
      w obs³udze, o nazwie <span class="application">ee</span>.  Je¶li dopiero zaczynamy,
      <span class="application">ee</span> powinien byæ naszym wyborem.  Nie krêpujmy siê i zmieñmy
      warto¶ci na górze pliku, szczególnie te, odró¿niaj±ce nasz w³asny plik
      od <code class="filename">GENERIC</code>.</p><a id="idp80697680" class="indexterm"></a><p>Je¶li ju¿ kompilowali¶my j±dro w <span class="trademark">SunOS</span>TM lub innych systemach BSD, du¿a czê¶æ
      pliku konfiguracyjnego powinna byæ nam znajoma.  Je¶li natomiast jeste¶my lepiej
      zaznajomieni z systemami typu DOS, plik konfiguracyjny mo¿e wydaæ siê nam nieco obcy.
      W tym przypadku przeczytajmy uwa¿nie ka¿d± opcjê oraz komentarz w
      <a class="link" href="kernelconfig-config.html" title="8.4. Plik konfiguracyjny">pliku konfiguracyjnym</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">Je¶li <a class="link" href="cutting-edge.html" title="Rozdzia³ 21. The Cutting Edge">synchronizujemy nasze drzewo ¼ród³owe</a> z najnowszymi
        ¼ród³ami projektu FreeBSD, nale¿y zawsze, nim rozpoczniemy jakiekolwiek
        dzia³ania aktualizuj±ce, zapoznaæ siê z zawarto¶ci± pliku
        <code class="filename">/usr/src/UPDATING</code>.  W pliku tym zapisane s± wszelkie niezbêdne
        zagadnienia zwi±zane z aktualizacj± FreeBSD. Plik <code class="filename">/usr/src/UPDATING</code>
        zawsze pasuje do ¼ród³a naszej wersji FreeBSD, jest przez to bardziej odpowiednim ¼ród³em
        informacji ni¿ Podrêcznik.</p></div><p>Musimy teraz skompilowaæ kod ¼ród³owy j±dra.  Istniej± dwie procedury, za pomoc± których
      mo¿na tego dokonaæ.  Wybór zale¿eæ bêdzie od tego w jakim celu kompilujemy j±dro oraz od wykorzystywanej
      wersji FreeBSD.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Je¶li zainstalowali¶my <span class="emphasis"><em>tylko</em></span> ¼ród³a j±dra, wykorzystamy
          procedurê 1.</p></li><li class="listitem"><p>Je¶li budujemy nowe j±dro, bez aktualizowania ¼róde³ (na przyk³ad, by dodaæ dodatkowe
          opcje, np. <code class="literal">IPFIREWALL</code>), mo¿emy u¿yæ dowolnej z procedur.</p></li><li class="listitem"><p>Je¶li przebudowujemy j±dro jako czê¶æ procesu <code class="command">make buildworld</code>,
          powinni¶my u¿yæ procedury 2.
        </p></li></ul></div><a id="idp80714064" class="indexterm"></a><a id="idp80714960" class="indexterm"></a><a id="idp80715472" class="indexterm"></a><p>Je¶li <span class="emphasis"><em>nie</em></span> aktualizowali¶my naszych ¼róde³
      w ¿aden sposób od ostatniego, zakoñczonego powodzeniem cyklu
      <code class="buildtarget">buildworld</code>-<code class="buildtarget">installworld</code>
      (nie uruchamiali¶my <span class="application">CVSup</span>,
      <span class="application">CTM</span>, ani nie korzystali¶my
      z <span class="application">anoncvs</span>), wówczas bezpiecznym jest skorzystaæ z sekwencji
      <code class="command">config</code>, <code class="command">make depend</code>,
      <code class="command">make</code> i <code class="command">make install</code>.
    </p><div class="procedure"><a id="idp80721104"></a><div class="procedure-title">Procedura 8.1. Procedura 1. Budowanie j±dra w <span class="quote">"<span class="quote">tradycyjny</span>"</span> sposób.</div><ol class="procedure" type="1"><li class="step"><p>By wygenerowaæ kod ¼ród³owy j±dra, nale¿y uruchomiæ <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=config&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">config</span>(8)</span></a>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/sbin/config MYKERNEL</code></strong></pre></li><li class="step"><p>Nastêpnie, przenie¶my siê do katalogu w którym dokonuje siê budowy.  Po ponownym
          uruchomieniu <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=config&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">config</span>(8)</span></a> wy¶wietlona zostanie nazwa katalogu.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd ../compile/MYKERNEL</code></strong></pre></li><li class="step"><p>Skompilujmy j±dro.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make depend</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong></pre></li><li class="step"><p>Zainstalujmy nowe j±dro.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong></pre></li></ol></div><div class="procedure"><a id="idp80731472"></a><div class="procedure-title">Procedura 8.2. Procedura 2. Budowanie j±dra w <span class="quote">"<span class="quote">nowy</span>"</span> sposób.</div><ol class="procedure" type="1"><li class="step"><p>Wejd¼my do katalogu <code class="filename">/usr/src</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong></pre></li><li class="step"><p>Skompilujmy j±dro.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make buildkernel KERNCONF=MYKERNEL</code></strong></pre></li><li class="step"><p>Zainstalujmy nowe j±dro.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make installkernel KERNCONF=MYKERNEL</code></strong></pre></li></ol></div><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ta metoda kompilacji j±dra wymaga wszystkich plików ¼ród³owych.  Je¶li zainstalowali¶my
        jedynie ¼ród³a j±dra, powinni¶my skorzystaæ z opisanej powy¿ej metody tradycyjnej.</p></div><div xmlns="" class="tip"><h3 class="admontitle">Podpowied¼: </h3><p xmlns="http://www.w3.org/1999/xhtml">Domy¶lnie, podczas kompilacji indywidualnego j±dra,
	<span class="emphasis"><em>wszystkie</em></span> modu³y j±dra zostan± równie¿ zrekompilowane.
        Je¶li chcemy zaktualizowaæ j±dro szybciej b±d¼ zbudowaæ tylko w³asne modu³y,
        powinni¶my przed rozpoczêciem kompilacji j±dra zmodyfikowaæ plik
        <code class="filename">/etc/make.conf</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">MODULES_OVERRIDE = linux acpi sound/sound sound/driver/ds1 ntfs</pre><p xmlns="http://www.w3.org/1999/xhtml">Zmienna ta definiuje listê modu³ów do kompilacji zamiast wszystkich.
	Inne zmienne przydatne w procesie kompilacji j±dra opisane zosta³y
	w podrêczniku systemowym <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">make.conf</span>(5)</span></a>.</p></div><a id="idp80750160" class="indexterm"></a><p>Nowe j±dro zostanie skopiowane do katalogu <code class="filename">/boot/kernel</code> jako <code class="filename">/boot/kernel/kernel</code>
      , a dotychczasowe zostanie przeniesione do <code class="filename">/boot/kernel.old/kernel</code>.
      Teraz nale¿y ponownie uruchomiæ komputer.  W razie jakby co¶ posz³o ¼le, na koñcu tego
      rozdzia³u przedstawionych zosta³o kilka <a class="link" href="kernelconfig-trouble.html" title="8.5. Je¶li pojawi± siê k³opoty">awaryjnych</a>
      rozwi±zañ.  Przeczytajmy równie¿ rozdzia³y opisuj±ce co zrobiæ w razie, gdy system <a class="link" href="kernelconfig-trouble.html#kernelconfig-noboot">nie chce siê ponownie uruchomiæ</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">Inne pliki zwi±zane z procesem uruchamiania, np. takie jak
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a> czy pliki konfiguracyjne s± przechowywane w katalogu
	<code class="filename">/boot</code>.  W³asne modu³y jak i modu³y innych producentów,
        mo¿na umieszczaæ w katalogu <code class="filename">/boot/kernel</code>, jednak¿e
	u¿ytkownicy powinni byæ ¶wiadomi, i¿ synchronizacja modu³ów ze skompilowanym j±drem
	jest bardzo wa¿na.  Modu³y nie przygotowane do pracy z danym j±drem mog± doprowadziæ do
	niestabilno¶ci czy b³êdów.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kernelconfig-custom-kernel.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="kernelconfig.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="kernelconfig-config.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">8.2. Po co budowaæ indywidualne j±dro? </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 8.4. Plik konfiguracyjny</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>