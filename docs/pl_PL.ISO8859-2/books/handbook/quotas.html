<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>17.15. File System Quotas</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="disks.html" title="Rozdzia³ 17. Storage" /><link rel="prev" href="snapshots.html" title="17.14. File System Snapshots" /><link rel="next" href="disks-encrypting.html" title="17.16. Encrypting Disk Partitions" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">17.15. File System Quotas</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="snapshots.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 17. Storage</th><td width="20%" align="right"> <a accesskey="n" href="disks-encrypting.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="quotas"></a>17.15. File System Quotas</h2></div></div></div><a id="idp89213648" class="indexterm"></a><a id="idp89214800" class="indexterm"></a><p>Quotas are an optional feature of the operating system that
      allow you to limit the amount of disk space and/or the number of
      files a user or members of a group may allocate on a per-file
      system basis. This is used most often on timesharing systems where
      it is desirable to limit the amount of resources any one user or
      group of users may allocate.  This will prevent one user or group
      of users from consuming all of the available disk space.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89215824"></a>17.15.1. Configuring Your System to Enable Disk Quotas</h3></div></div></div><p>Before attempting to use disk quotas, it is necessary to make
	sure that quotas are configured in your kernel.  This is done by
	adding the following line to your kernel configuration
	file:</p><pre class="programlisting">options QUOTA</pre><p>The stock <code class="filename">GENERIC</code> kernel does not have
	this enabled by default, so you will have to configure, build and
	install a custom kernel in order to use disk quotas.  Please refer
	to <a class="xref" href="kernelconfig.html" title="Rozdzia³ 8. Konfiguracja j±dra FreeBSD">Rozdzia³ 8, <em>Konfiguracja j±dra FreeBSD</em></a> for more information on kernel
	configuration.</p><p>Next you will need to enable disk quotas in
	<code class="filename">/etc/rc.conf</code>.  This is done by adding the
	line:</p><pre class="programlisting">enable_quotas="YES"</pre><a id="idp89219536" class="indexterm"></a><p>For finer control over your quota startup, there is an
	additional configuration variable available. Normally on bootup,
	the quota integrity of each file system is checked by the
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a> program.  The
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a> facility insures that the data in
	the quota database properly reflects the data on the file system.
	This is a very time consuming process that will significantly
	affect the time your system takes to boot. If you would like to
	skip this step, a variable in <code class="filename">/etc/rc.conf</code>
	is made available for the purpose:</p><pre class="programlisting">check_quotas="NO"</pre><p>Finally you will need to edit <code class="filename">/etc/fstab</code>
	to enable disk quotas on a per-file system basis.  This is where
	you can either enable user or group quotas or both for all of your
	file systems.</p><p>To enable per-user quotas on a file system, add the
	<code class="option">userquota</code> option to the options field in the
	<code class="filename">/etc/fstab</code> entry for the file system you want
	to enable quotas on.  For example:</p><pre class="programlisting">/dev/da1s2g   /home    ufs rw,userquota 1 2</pre><p>Similarly, to enable group quotas, use the
	<code class="option">groupquota</code> option instead of
	<code class="option">userquota</code>.  To enable both user and
	group quotas, change the entry as follows:</p><pre class="programlisting">/dev/da1s2g    /home    ufs rw,userquota,groupquota 1 2</pre><p>By default, the quota files are stored in the root directory of
	the file system with the names <code class="filename">quota.user</code> and
	<code class="filename">quota.group</code> for user and group quotas
	respectively.  See <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> for more
	information.  Even though the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> manual page says that
	you can specify
	an alternate location for the quota files, this is not recommended
	because the various quota utilities do not seem to handle this
	properly.</p><p>At this point you should reboot your system with your new
	kernel.  <code class="filename">/etc/rc</code> will automatically run the
	appropriate commands to  create the initial quota files for all of
	the quotas you enabled in <code class="filename">/etc/fstab</code>, so
	there is no need to manually create any zero length quota
	files.</p><p>In the normal course of operations you should not be required
	to run the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a>,
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotaon&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotaon</span>(8)</span></a>, or <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotaoff&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotaoff</span>(8)</span></a>
	commands manually.  However, you may want to read their manual pages
	just to be familiar with their operation.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89242576"></a>17.15.2. Setting Quota Limits</h3></div></div></div><a id="idp89243216" class="indexterm"></a><p>Once you have configured your system to enable quotas, verify
	that they really are enabled.  An easy way to do this is to
	run:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>quota -v</code></strong></pre><p>You should see a one line summary of disk usage and current
	quota limits for each file system that quotas are enabled
	on.</p><p>You are now ready to start assigning quota limits with the
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a> command.</p><p>You have several options on how to enforce limits on the
	amount of disk space a user or group may allocate, and how many
	files they may create.  You may limit allocations based on disk
	space (block quotas) or number of files (inode quotas) or a
	combination of both.  Each of these limits are further broken down
	into two categories: hard and soft limits.</p><a id="idp89247696" class="indexterm"></a><p>A hard limit may not be exceeded.  Once a user reaches his
	hard limit he may not make any further allocations on the file
	system in question.  For example, if the user has a hard limit of
	500 kbytes on a file system and is currently using 490 kbytes, the
	user can only allocate an additional 10 kbytes.  Attempting to
	allocate an additional 11 kbytes will fail.</p><a id="idp89248720" class="indexterm"></a><p>Soft limits, on the other hand, can be exceeded for a limited
	amount of time.  This period of time is known as the grace period,
	which is one week by default.  If a user stays over his or her
	soft limit longer than the grace period, the soft limit will
	turn into a hard limit and no further allocations will be allowed.
	When the user drops back below the soft limit, the grace period
	will be reset.</p><p>The following is an example of what you might see when you run
	the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a> command.  When the
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a> command is invoked, you are placed into
	the editor specified by the <code class="envar">EDITOR</code> environment
	variable, or in the <span class="application">vi</span> editor if the
	<code class="envar">EDITOR</code> variable is not set, to allow you to edit
	the quota limits.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>edquota -u test</code></strong></pre><pre class="programlisting">Quotas for user test:
/usr: kbytes in use: 65, limits (soft = 50, hard = 75)
        inodes in use: 7, limits (soft = 50, hard = 60)
/usr/var: kbytes in use: 0, limits (soft = 50, hard = 75)
        inodes in use: 0, limits (soft = 50, hard = 60)</pre><p>You will normally see two lines for each file system that has
	quotas enabled.  One line for the block limits, and one line for
	inode limits.  Simply change the value you want updated to modify
	the quota limit.  For example, to raise this user's block limit
	from a soft limit of 50 and a hard limit of 75 to a soft limit of
	500 and a hard limit of 600, change:</p><pre class="programlisting">/usr: kbytes in use: 65, limits (soft = 50, hard = 75)</pre><p>to:</p><pre class="programlisting">/usr: kbytes in use: 65, limits (soft = 500, hard = 600)</pre><p>The new quota limits will be in place when you exit the
	editor.</p><p>Sometimes it is desirable to set quota limits on a range of
	UIDs.  This can be done by use of the <code class="option">-p</code> option
	on the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a> command.  First, assign the
	desired quota limit to a user, and then run
	<code class="command">edquota -p protouser startuid-enduid</code>.  For
	example, if user <code class="systemitem">test</code> has the desired quota
	limits, the following command can be used to duplicate those quota
	limits for UIDs 10,000 through 19,999:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>edquota -p test 10000-19999</code></strong></pre><p>For more information see <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a> manual page.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89260624"></a>17.15.3. Checking Quota Limits and Disk Usage</h3></div></div></div><a id="idp89261264" class="indexterm"></a><p>You can use either the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a> or the
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=repquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">repquota</span>(8)</span></a> commands to check quota limits and
	disk usage.  The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a> command can be used to
	check individual user or group quotas and disk usage.  A user
	may only examine his own quota, and the quota of a group he
	is a member of. Only the super-user may view all user and group
	quotas.  The
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=repquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">repquota</span>(8)</span></a> command can be used to get a summary
	of all quotas and disk usage for file systems with quotas
	enabled.</p><p>The following is some sample output from the
	<code class="command">quota -v</code> command for a user that has quota
	limits on two file systems.</p><pre class="programlisting">Disk quotas for user test (uid 1002):
     Filesystem  usage    quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</pre><a id="idp89271248" class="indexterm"></a><p>On the <code class="filename">/usr</code> file system in the above
	example, this user is currently 15 kbytes over the soft limit of
	50 kbytes and has 5 days of the grace period left.  Note the
	asterisk <code class="literal">*</code> which indicates that the user is
	currently over his quota limit.</p><p>Normally file systems that the user is not using any disk
	space on will not show up in the output from the
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a> command, even if he has a quota limit
	assigned for that file system.  The <code class="option">-v</code> option
	will display those file systems, such as the
	<code class="filename">/usr/var</code> file system in the above
	example.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp89274960"></a>17.15.4. Quotas over NFS</h3></div></div></div><a id="idp89275600" class="indexterm"></a><p>Quotas are enforced by the quota subsystem on the NFS server.
	The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rpc.rquotad&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rpc.rquotad</span>(8)</span></a> daemon makes quota information available
	to the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a> command on NFS clients, allowing users on
	those machines to see their quota statistics.</p><p>Enable <code class="command">rpc.rquotad</code> in
	<code class="filename">/etc/inetd.conf</code> like so:</p><pre class="programlisting">rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</pre><p>Now restart <code class="command">inetd</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP `cat /var/run/inetd.pid`</code></strong></pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="snapshots.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="disks-encrypting.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">17.14. File System Snapshots </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 17.16. Encrypting Disk Partitions</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>