<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>3.8. Demony, sygna³y i unicestwianie procesów</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="basics.html" title="Rozdzia³ 3. Podstawy Uniksa" /><link rel="prev" href="basics-processes.html" title="3.7. Procesy" /><link rel="next" href="shells.html" title="3.9. Pow³oki" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3.8. Demony, sygna³y i unicestwianie procesów</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="basics-processes.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 3. Podstawy Uniksa</th><td width="20%" align="right"> <a accesskey="n" href="shells.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="basics-daemons"></a>3.8. Demony, sygna³y i unicestwianie procesów</h2></div></div></div><p>Kiedy korzystamy z edytora tekstu, mo¿emy go w prosty sposób
      obs³ugiwaæ, wczytywaæ pliki, itp. Jest to mo¿liwe dziêki cechom
      samego edytora oraz dziêki temu, ¿e edytor jest pod³±czony do
      <em class="firstterm">terminala</em>. Jednak¿e, niektóre programy
      pracuj± bez ci±g³ej komunikacji z u¿ytkownikiem, s± wiêc od³±czone
      od terminala. Przyk³adem takiego programu mo¿e byæ serwer WWW,
      nieustannie odpowiadaj±cy na ¿±dania pochodz±ce z sieci, bez potrzeby
      komunikacji z u¿ytkownikiem. Inny przyk³ad to programy przesy³aj±ce
      emaile pomiêdzy komputerami.</p><p>Takie programy nazywane s± <em class="firstterm">demonami</em> (ang. daemons).
      Demony to postaci z mitologii greckiej - niewielkie us³u¿ne istoty,
      ani dobre, ani z³e, które w rozmaity sposób pomaga³y ludziom. Podobnie
      pomagaj± dzisiejsze serwery pocztowe i serwery WWW. Dlatego w³a¶nie od
      d³ugiego czasu maskotk± BSD jest weso³y demon z wid³ami i w</p><p>Przyjêto, i¿ programy uruchamiane jako demony maj± nazwy zakoñczone
      liter± <span class="quote">"<span class="quote">d</span>"</span>. <span class="application">BIND</span> (Berkeley Internet
      Name Daemon) jest serwerem nazw uruchamianym przez program
      <code class="command">named</code>, serwer WWW <span class="application">Apache</span>
      nosi nazwê <code class="command">httpd</code>, demon kolejkowania drukarki (line printer
      spooling daemon) to <code class="command">lpd</code>, itd. Nie jest to sztywna regu³a,
      lecz przyjêta konwencja; na przyk³ad g³ówny demon pocztowy programu
      <span class="application">Sendmail</span> nazywa siê <code class="command">sendmail</code>,
      a nie jak mo¿na by przypuszczaæ <code class="command">maild</code>.</p><p>Niekiedy istnieje potrzeba komunikacji z procesem - demonem.
      Odbywa siê ona poprzez <em class="firstterm">sygna³y</em>, to znaczy mo¿emy
      porozumieæ siê z demonem (lub jakimkolwiek dzia³aj±cym procesem) wysy³aj±c
      mu sygna³. S± ró¿ne rodzaje sygna³ów, które mo¿emy wys³aæ - niektóre
      z nich maj± okre¶lone znaczenie, inne s± odpowiednio interpretowane przez
      aplikacjê, co powinno byæ opisane w dokumentacji aplikacji. Sygna³ mo¿emy
      wys³aæ tylko do procesu, którego jeste¶my w³a¶cicielem. Wys³anie sygna³u
      do procesu nale¿±cego do kogo¶ innego za po¶rednictwem <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> lub
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">kill</span>(2)</span></a> spowoduje odmowê dostêpu. Wyj±tkiem jest u¿ytkownik
      <code class="systemitem">root</code>, który mo¿e wysy³aæ sygna³y do dowolnego
      procesu, niezale¿nie od jego w³a¶ciciela.</p><p>Zdarza siê, ¿e samo FreeBSD równie¿ wysy³a aplikacjom sygna³y.
      Je¿eli niew³a¶ciwie napisany program próbuje dostaæ siê do niedostêpnego
      dla niego obszaru pamiêci, FreeBSD wysy³a procesowi sygna³ <em class="firstterm">Segmentation
        Violation</em> (<code class="literal">SIGSEGV</code>). Aplikacja mo¿e skorzystaæ
      z funkcji systemowej <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=alarm&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">alarm</span>(3)</span></a>, wówczas po up³yniêciu pewnego czasu
      zostanie do niej wys³any sygna³ Alarm (<code class="literal">SIGALRM</code>).
      I tak dalej.</p><p>Do zatrzymania procesu mo¿na wykorzystaæ dwa sygna³y: <code class="literal">SIGTERM</code>
      i <code class="literal">SIGKILL</code>. Pierwszy z nich jest ³agodnym sposobem
      unicestwienia procesu; proces mo¿e <span class="emphasis"><em>przechwyciæ</em></span>
      ten sygna³, nastêpnie zakoñczyæ swoj± pracê, np. zamykaj±c pliki,
      które otworzy³. Czasami proces mo¿e zignorowaæ sygna³ <code class="literal">SIGTERM</code>,
      je¶li akurat zajmuje siê czym¶, co nie powinno byæ przerywane.</p><p>Sygna³ <code class="literal">SIGKILL</code> nie mo¿e zostaæ zignorowany.
      Dzia³a wed³ug zasady <span class="quote">"<span class="quote">Nie obchodzi mnie, co robisz, w tej
      chwili przestañ</span>"</span>. Wys³anie procesowi sygna³u <code class="literal">SIGKILL</code>
      powoduje, i¿ FreeBSD natychmiast go wstrzymuje<a href="#ftn.idp78157776" class="footnote" id="idp78157776"><sup class="footnote">[4]</sup></a>.</p><p>Inne u¿yteczne sygna³y to
      <code class="literal">SIGHUP</code>, <code class="literal">SIGUSR1</code> i
      <code class="literal">SIGUSR2</code>. S± to sygna³y ogólnego przeznaczenia,
      ró¿ne aplikacje reaguj± na nie w ró¿ny sposób.</p><p>Powiedzmy, ¿e dokonali¶my zmiany w pliku konfiguracji
      serwera WWW, i chcemy nakazaæ serwerowi, aby konfiguracja zosta³a
      ponownie wczytana. Mogliby¶my zatrzymaæ i ponownie uruchomiæ
      <code class="command">httpd</code>, ale ubocznym efektem takiego postêpowania
      by³aby chwilowa przerwa w pracy serwera, co jest raczej niepo¿±dane.
      Wiêkszo¶æ demonów dzia³a w taki sposób, i¿ po otrzymaniu sygna³u
      <code class="literal">SIGHUP</code> dokonuj± ponownego przeczytania swojego
      pliku konfiguracyjnego. Dziêki temu zamiast unicestwiania i ponownego
      uruchamiania <code class="command">httpd</code> mo¿emy wys³aæ mu sygna³
      <code class="literal">SIGHUP</code>. Nie jest jednoznacznie okre¶lone,
      jak procesy reaguj± na sygna³ <code class="literal">SIGHUP</code>, dlatego
      ró¿ne demony mog± zachowywaæ siê w ró¿ny sposób - w razie
      niepewno¶ci warto zapoznaæ siê z dokumentacj± konkretnego demona.</p><p>Sygna³y wysy³ane s± przy u¿yciu polecenia <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a>, jak
      w poni¿szym przyk³adzie.</p><div class="procedure"><a id="idp78164048"></a><div class="procedure-title">Procedura 3.1. Wysy³anie sygna³u do procesu</div><p>W tym przyk³adzie zaprezentowano wysy³anie sygna³u do <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>.
        Plik konfiguracyjny dla <code class="command">inetd</code> to
        <code class="filename">/etc/inetd.conf</code>. Wys³anie sygna³u
        <code class="literal">SIGHUP</code> spowoduje ponowne przeczytanie tego pliku.</p><ol class="procedure" type="1"><li class="step"><p>Trzeba ustaliæ PID procesu, do którego wysy³aæ bêdziemy sygna³
          - do tego celu pos³u¿± polecenia <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> i <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=grep&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">grep</span>(1)</span></a>.
          Polecenia <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=grep&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">grep</span>(1)</span></a> u¿ywamy do odnalezienia podanego ci±gu
          znaków. Poniewa¿ polecenia wydajemy jako zwyk³y u¿ytkownik,
          a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> dzia³a jako <code class="systemitem">root</code>, polecenie
          <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> musimy wywo³aæ z opcj± <code class="option">ax</code>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ps -ax | grep inetd</code></strong>
  198  ??  IWs    0:00.00 inetd -wW</pre><p>Jak widaæ, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> ma PID o warto¶ci 198. Niekiedy w
          przedstawionym powy¿ej przyk³adzie mo¿e siê tak¿e pojawiæ proces
          <code class="literal">grep inetd</code>, wynika to ze sposobu, w jaki
          <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> odnajduje dzia³aj±ce procesy.</p></li><li class="step"><p>Sygna³ wysy³amy przy pomocy polecenia <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a>.
          Najpierw skorzystamy jednak z polecenia <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> by staæ siê
          rootem, gdy¿ <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> dzia³a jako
          <code class="systemitem">root</code>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>su</code></strong>
<code class="prompt">Password:</code>
<code class="prompt">#</code> <strong class="userinput"><code>/bin/kill -s HUP 198</code></strong></pre><p>Podobnie jak wiele poleceñ w systemach <span class="trademark">UNIX</span>(R), <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a>
          nie wy¶wietla ¿adnego komunikatu w przypadku powodzenia. Je¿eli
          natomiast sygna³ zosta³ wys³any do procesu, którego nie jest siê
          w³a¶cicielem, pojawi siê informacja: <span class="errorname">kill:
            <em class="replaceable"><code>PID</code></em>: Operation not
	    permitted</span> (niedozwolona operacja). B³êdne wpisanie
          PID-u spowoduje albo wys³anie sygna³u do niew³a¶ciwego procesu,
          co mo¿e skoñczyæ siê ¼le, albo te¿ wys³anie sygna³u do PID-u,
          który nie jest w danej chwili wykorzystywany - pojawi siê
          wówczas komunikat <span class="errorname">kill:
	    <em class="replaceable"><code>PID</code></em>: No such process</span>
          (nie ma takiego procesu).</p><div xmlns="" class="note"><h3 class="admontitle">Dlaczego warto korzystaæ z <code xmlns="http://www.w3.org/1999/xhtml" class="command">/bin/kill</code>?: </h3><p xmlns="http://www.w3.org/1999/xhtml">W wielu pow³okach polecenie <code class="command">kill</code> jest wbudowane;
            oznacza to, ¿e sama pow³oka zajmuje siê wysy³aniem sygna³u, nie
            wywo³uj±c <code class="filename">/bin/kill</code>. Mo¿e to byæ u¿yteczne,
            jednak¿e w ró¿nych pow³okach stosowana jest ró¿na sk³adnia do
            okre¶lenia nazwy sygna³u, który ma byæ wys³any. Zamiast wiêc
            zapamiêtywania wszystkich mo¿liwych sk³adni, ³atwiej jest po
            prostu korzystaæ z polecenia
            <code class="command">/bin/kill ...</code></p></div></li></ol></div><p>Inne sygna³y wysy³a siê t± sam± metod±, wystarczy zast±piæ
      <code class="literal">TERM</code> lub <code class="literal">KILL</code> w odpowiedni
      sposób.</p><div xmlns="" class="important"><h3 class="admontitle">Wa¿ne: </h3><p xmlns="http://www.w3.org/1999/xhtml"> Unicestwianie losowo wybranego procesu jest raczej z³ym pomys³em.
        Szczególne znaczenie ma <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a>, proces o PID równym 1.
        Wydanie polecenia <code class="command">/bin/kill -s KILL 1</code> jest szybk±
        metod± wy³±czenia systemu. Nale¿y zawsze sprawdzaæ poprawno¶æ
        argumentów polecenia <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a>  przed naci¶niêciem klawisza
        <span class="keycap"><strong>Return</strong></span>.</p></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp78157776" class="footnote"><p><a href="#idp78157776" class="para"><sup class="para">[4] </sup></a>Nie do koñca jest to prawd± - w kilku przypadkach nie
          mo¿na przerwaæ procesu. Na przyk³ad gdy proces stara siê przeczytaæ
          plik znajduj±cy siê na innym komputerze w sieci, a ów inny komputer
          z jakiego¶ powodu bêdzie niedostêpny (na skutek awarii sieci,
          lub po prostu zostanie wy³±czony), to proces stanie siê
          <span class="quote">"<span class="quote">nieprzerywalny</span>"</span>. Po chwili (zwykle po dwóch
          minutach) proces przekroczy czas oczekiwania, wówczas
          zostanie unicestwiony.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="basics-processes.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="basics.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="shells.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">3.7. Procesy </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 3.9. Pow³oki</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>