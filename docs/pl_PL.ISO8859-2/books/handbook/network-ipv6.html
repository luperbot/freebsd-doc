<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>27.10. IPv6</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Podrêcznik FreeBSD" /><link rel="up" href="advanced-networking.html" title="Rozdzia³ 27. Advanced Networking" /><link rel="prev" href="network-plip.html" title="27.9. Parallel Line IP (PLIP)" /><link rel="next" href="network-atm.html" title="27.11. Asynchronous Transfer Mode (ATM)" /><link rel="copyright" href="legalnotice.html" title="Informacja Prawna" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">27.10. IPv6</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-plip.html">Poprzedni</a> </td><th width="60%" align="center">Rozdzia³ 27. Advanced Networking</th><td width="20%" align="right"> <a accesskey="n" href="network-atm.html">Nastêpny</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-ipv6"></a>27.10. IPv6</h2></div><div><span class="authorgroup">Originally Written by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Aaron</span> <span class="surname">Kaplan</span></span>. </span></div><div><span class="authorgroup">Restructured and Added by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div><div><span class="authorgroup">Extended by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Brad</span> <span class="surname">Davis</span></span>. </span></div></div></div><p>IPv6 (also know as IPng <span class="quote">"<span class="quote">IP next generation</span>"</span>) is
      the new version of the well known IP protocol (also know as
      <acronym class="acronym">IPv4</acronym>).  Like the other current *BSD systems,
      FreeBSD includes the KAME IPv6 reference implementation.
      So your FreeBSD system comes with all you will need to experiment with IPv6.
      This section focuses on getting IPv6 configured and running.</p><p>In the early 1990s, people became aware of the rapidly
      diminishing address space of IPv4.  Given the expansion rate of the
      Internet there were two major concerns:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Running out of addresses.  Today this is not so much of a concern
	  anymore since RFC1918 private address space
	  (<code class="systemitem">10.0.0.0/8</code>,
	  <code class="systemitem">172.16.0.0/12</code>, and
	  <code class="systemitem">192.168.0.0/16</code>)
	  and Network Address Translation (<acronym class="acronym">NAT</acronym>) are
	  being employed.</p></li><li class="listitem"><p>Router table entries were getting too large.  This is
	  still a concern today.</p></li></ul></div><p>IPv6 deals with these and many other issues:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>128 bit address space.  In other words theoretically there are
	  340,282,366,920,938,463,463,374,607,431,768,211,456 addresses
	  available.  This means there are approximately
	  6.67 * 10^27 IPv6 addresses per square meter on our planet.</p></li><li class="listitem"><p>Routers will only store network aggregation addresses in their routing
	  tables thus reducing the average space of a routing table to 8192
	  entries.</p></li></ul></div><p>There are also lots of other useful features of IPv6 such as:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Address autoconfiguration (<a class="link" href="http://www.ietf.org/rfc/rfc2462.txt" target="_top">RFC2462</a>)</p></li><li class="listitem"><p>Anycast addresses (<span class="quote">"<span class="quote">one-out-of many</span>"</span>)</p></li><li class="listitem"><p>Mandatory multicast addresses</p></li><li class="listitem"><p>IPsec (IP security)</p></li><li class="listitem"><p>Simplified header structure</p></li><li class="listitem"><p>Mobile <acronym class="acronym">IP</acronym></p></li><li class="listitem"><p>IPv6-to-IPv4 transition mechanisms</p></li></ul></div><p>For more information see:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>IPv6 overview at <a class="link" href="http://playground.sun.com/pub/ipng/html/ipng-main.html" target="_top">playground.sun.com</a></p></li><li class="listitem"><p><a class="link" href="http://www.kame.net" target="_top">KAME.net</a></p></li><li class="listitem"><p><a class="link" href="http://www.6bone.net" target="_top">6bone.net</a></p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96787024"></a>27.10.1. Background on IPv6 Addresses</h3></div></div></div><p>There are different types of IPv6 addresses: Unicast, Anycast and
	Multicast.</p><p>Unicast addresses are the well known addresses.  A packet sent
	to a unicast address arrives exactly at the interface belonging to
	the address.</p><p>Anycast addresses are syntactically indistinguishable from unicast
	addresses but they address a group of interfaces.  The packet destined for
	an anycast address will arrive at the nearest (in router metric)
	interface.  Anycast addresses may only be used by routers.</p><p>Multicast addresses identify a group of interfaces.  A packet destined
	for a multicast address will arrive at all interfaces belonging to the
	multicast group.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">The IPv4 broadcast address (usually <code class="systemitem">xxx.xxx.xxx.255</code>) is expressed
	  by multicast addresses in IPv6.</p></div><div class="table"><a id="idp96790224"></a><div class="table-title">Tabela 27.2. Reserved IPv6 addresses</div><div class="table-contents"><table summary="Reserved IPv6 addresses" border="0"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>IPv6 address</th><th>Prefixlength (Bits)</th><th>Description</th><th>Notes</th></tr></thead><tbody><tr><td><code class="systemitem">::</code></td><td>128 bits</td><td>unspecified</td><td>cf. <code class="systemitem">0.0.0.0</code> in
		IPv4</td></tr><tr><td><code class="systemitem">::1</code></td><td>128 bits</td><td>loopback address</td><td>cf. <code class="systemitem">127.0.0.1</code> in
		IPv4</td></tr><tr><td><code class="systemitem">::00:xx:xx:xx:xx</code></td><td>96 bits</td><td>embedded IPv4</td><td>The lower 32 bits are the IPv4 address.  Also
		called <span class="quote">"<span class="quote">IPv4 compatible IPv6
		address</span>"</span></td></tr><tr><td><code class="systemitem">::ff:xx:xx:xx:xx</code></td><td>96 bits</td><td>IPv4 mapped IPv6 address</td><td>The lower 32 bits are the IPv4 address.
		For hosts which do not support IPv6.</td></tr><tr><td><code class="systemitem">fe80::</code> - <code class="systemitem">feb::</code></td><td>10 bits</td><td>link-local</td><td>cf. loopback address in IPv4</td></tr><tr><td><code class="systemitem">fec0::</code> - <code class="systemitem">fef::</code></td><td>10 bits</td><td>site-local</td><td> </td></tr><tr><td><code class="systemitem">ff::</code></td><td>8 bits</td><td>multicast</td><td> </td></tr><tr><td><code class="systemitem">001</code> (base
		2)</td><td>3 bits</td><td>global unicast</td><td>All global unicast addresses are assigned from
		this pool.  The first 3 bits are
		<span class="quote">"<span class="quote">001</span>"</span>.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96830160"></a>27.10.2. Reading IPv6 Addresses</h3></div></div></div><p>The canonical form is represented as: <code class="systemitem">x:x:x:x:x:x:x:x</code>, each
	<span class="quote">"<span class="quote">x</span>"</span> being a 16 Bit hex value.  For example
	<code class="systemitem">FEBC:A574:382B:23C1:AA49:4592:4EFE:9982</code></p><p>Often an address will have long substrings of all zeros
	therefore one such substring per address can be abbreviated by <span class="quote">"<span class="quote">::</span>"</span>.
	Also up to three leading <span class="quote">"<span class="quote">0</span>"</span>s per hexquad can be omitted.
	For example <code class="systemitem">fe80::1</code>
	corresponds to the canonical form
	<code class="systemitem">fe80:0000:0000:0000:0000:0000:0000:0001</code>.</p><p>A third form is to write the last 32 Bit part in the
	well known (decimal) IPv4 style with dots <span class="quote">"<span class="quote">.</span>"</span>
	as separators.  For example
	<code class="systemitem">2002::10.0.0.1</code>
	corresponds to the (hexadecimal) canonical representation
	<code class="systemitem">2002:0000:0000:0000:0000:0000:0a00:0001</code>
	which in turn is equivalent to
	writing <code class="systemitem">2002::a00:1</code>.</p><p>By now the reader should be able to understand the following:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig</code></strong></pre><pre class="programlisting">rl0: flags=8943&lt;UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; mtu 1500
         inet 10.0.0.10 netmask 0xffffff00 broadcast 10.0.0.255
         inet6 fe80::200:21ff:fe03:8e1%rl0 prefixlen 64 scopeid 0x1
         ether 00:00:21:03:08:e1
         media: Ethernet autoselect (100baseTX )
         status: active</pre><p><code class="systemitem">fe80::200:21ff:fe03:8e1%rl0</code>
	is an auto configured link-local address.  It is generated from the MAC
	address as part of the auto configuration.</p><p>For further information on the structure of IPv6 addresses
	see <a class="link" href="http://www.ietf.org/rfc/rfc3513.txt" target="_top">RFC3513</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96843856"></a>27.10.3. Getting Connected</h3></div></div></div><p>Currently there are four ways to connect to other IPv6 hosts and networks:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Join the experimental 6bone</p></li><li class="listitem"><p>Getting an IPv6 network from your upstream provider.  Talk to your
	    Internet provider for instructions.</p></li><li class="listitem"><p>Tunnel via 6-to-4 (<a class="link" href="http://www.ietf.org/rfc/rfc3068.txt" target="_top">RFC3068</a>)</p></li><li class="listitem"><p>Use the <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/freenet6/pkg-descr">net/freenet6</a> port if you are on a dial-up connection.</p></li></ul></div><p>Here we will talk on how to connect to the 6bone since it currently seems
	to be the most popular way.</p><p>First take a look at the <a class="link" href="http://www.6bone.net/" target="_top">6bone</a> site and find a 6bone connection nearest to
	you.  Write to the responsible person and with a little bit of luck you
	will be given instructions on how to set up your connection.  Usually this
	involves setting up a GRE (gif) tunnel.</p><p>Here is a typical example on setting up a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gif&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">gif</span>(4)</span></a> tunnel:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig gif0 create</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig gif0</code></strong>
gif0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig gif0 tunnel MY_IPv4_ADDR MY_IPv4_REMOTE_TUNNEL_ENDPOINT_ADDR</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig gif0 inet6 alias MY_ASSIGNED_IPv6_TUNNEL_ENDPOINT_ADDR MY_IPv6_REMOTE_TUNNEL_ENDPOINT_ADDR</code></strong></pre><p>Replace the capitalized words by the information you received from the
	upstream 6bone node.</p><p>This establishes the tunnel.  Check if the tunnel is working by <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ping6&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ping6</span>(8)</span></a>
	'ing <code class="systemitem">ff02::1%gif0</code>.  You should receive two ping replies.</p><div xmlns="" class="note"><h3 class="admontitle">Uwaga: </h3><p xmlns="http://www.w3.org/1999/xhtml">In case you are intrigued by the address <code class="systemitem">ff02:1%gif0</code>, this is a
	  multicast address.  <code class="literal">%gif0</code> states that the multicast address at network
	  interface <code class="filename">gif0</code> is to be used.  Since we <code class="command">ping</code> a multicast address the
	  other endpoint of the tunnel should reply as well.</p></div><p>By now setting up a route to your 6bone uplink should be rather
	straightforward:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>route add -inet6 default -interface gif0</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ping6 -n MY_UPLINK</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>traceroute6 www.jp.FreeBSD.org</code></strong>
(3ffe:505:2008:1:2a0:24ff:fe57:e561) from 3ffe:8060:100::40:2, 30 hops max, 12 byte packets
     1  atnet-meta6  14.147 ms  15.499 ms  24.319 ms
     2  6bone-gw2-ATNET-NT.ipv6.tilab.com  103.408 ms  95.072 ms *
     3  3ffe:1831:0:ffff::4  138.645 ms  134.437 ms  144.257 ms
     4  3ffe:1810:0:6:290:27ff:fe79:7677  282.975 ms  278.666 ms  292.811 ms
     5  3ffe:1800:0:ff00::4  400.131 ms  396.324 ms  394.769 ms
     6  3ffe:1800:0:3:290:27ff:fe14:cdee  394.712 ms  397.19 ms  394.102 ms</pre><p>This output will differ from machine to machine.  By now you should be
	able to reach the IPv6 site <a class="link" href="http://www.kame.net" target="_top">www.kame.net</a>
	and see the dancing tortoise - that is if you have a IPv6 enabled browser such as
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/mozilla/pkg-descr">www/mozilla</a>, <span class="application">Konqueror</span>,
	which is part of <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/x11/kdebase3/pkg-descr">x11/kdebase3</a>,
	or <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/epiphany/pkg-descr">www/epiphany</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96873168"></a>27.10.4. DNS in the IPv6 World</h3></div></div></div><p>There used to be two types of DNS records for IPv6.  The IETF
	has declared A6 records obsolete.  AAAA records are the standard
	now.</p><p>Using AAAA records is straightforward.  Assign your hostname to the new
	IPv6 address you just received by adding:</p><pre class="programlisting">MYHOSTNAME           AAAA    MYIPv6ADDR</pre><p>To your primary zone DNS file.  In case you do not serve your own
	<acronym class="acronym">DNS</acronym> zones ask your <acronym class="acronym">DNS</acronym> provider.
	Current versions of <span class="application">bind</span> (version 8.3 and 9)
	and <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/dns/djbdns/pkg-descr">dns/djbdns</a> (with the IPv6 patch)
	support AAAA records.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96877136"></a>27.10.5. Applying the needed changes to <code class="filename">/etc/rc.conf</code></h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96878032"></a>27.10.5.1. IPv6 Client Settings</h4></div></div></div><p>These settings will help you configure a machine that will be on
	  your LAN and act as a client, not a router.  To have <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rtsol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rtsol</span>(8)</span></a>
	  autoconfigure your interface on boot all you need to add is:</p><pre class="programlisting">ipv6_enable="YES"</pre><p>To statically assign an IP address such as <code class="systemitem">
	  2001:471:1f11:251:290:27ff:fee0:2093</code>, to your
	  <code class="filename">fxp0</code> interface, add:</p><pre class="programlisting">ipv6_ifconfig_fxp0="2001:471:1f11:251:290:27ff:fee0:2093"</pre><p>To assign a default router of
	  <code class="systemitem">2001:471:1f11:251::1</code>
	  add the following to <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">ipv6_defaultrouter="2001:471:1f11:251::1"</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96883664"></a>27.10.5.2. IPv6 Router/Gateway Settings</h4></div></div></div><p>This will help you take the directions that your tunnel provider,
	  such as the <a class="link" href="http://www.6bone.net/" target="_top">6bone</a>, has
	  given you and convert it into settings that will persist through reboots.
	  To restore your tunnel on startup use something like the following in
	  <code class="filename">/etc/rc.conf</code>:</p><p>List the Generic Tunneling interfaces that will be configured, for
	  example <code class="filename">gif0</code>:</p><pre class="programlisting">gif_interfaces="gif0"</pre><p>To configure the interface with a local endpoint of
	  <em class="replaceable"><code>MY_IPv4_ADDR</code></em> to a remote endpoint of
	  <em class="replaceable"><code>REMOTE_IPv4_ADDR</code></em>:</p><pre class="programlisting">gifconfig_gif0="<em class="replaceable"><code>MY_IPv4_ADDR REMOTE_IPv4_ADDR</code></em>"</pre><p>To apply the IPv6 address you have been assigned for use as your
	  IPv6 tunnel endpoint, add:</p><pre class="programlisting">ipv6_ifconfig_gif0="<em class="replaceable"><code>MY_ASSIGNED_IPv6_TUNNEL_ENDPOINT_ADDR</code></em>"</pre><p>Then all you have to do is set the default route for IPv6.  This is
	  the other side of the IPv6 tunnel:</p><pre class="programlisting">ipv6_defaultrouter="<em class="replaceable"><code>MY_IPv6_REMOTE_TUNNEL_ENDPOINT_ADDR</code></em>"</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96891216"></a>27.10.5.3. IPv6 Tunnel Settings</h4></div></div></div><p>If the server is to route IPv6 between the rest of your network
	  and the world, the following <code class="filename">/etc/rc.conf</code>
	  setting will also be needed:</p><pre class="programlisting">ipv6_gateway_enable="YES"</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp96893264"></a>27.10.6. Router Advertisement and Host Auto Configuration</h3></div></div></div><p>This section will help you setup <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rtadvd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rtadvd</span>(8)</span></a> to advertise the
	IPv6 default route.</p><p>To enable <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rtadvd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rtadvd</span>(8)</span></a> you will need the following in your
	<code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">rtadvd_enable="YES"</pre><p>It is important that you specify the interface on which to do
	IPv6 router solicitation.  For example to tell <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rtadvd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rtadvd</span>(8)</span></a> to use
	<code class="filename">fxp0</code>:</p><pre class="programlisting">rtadvd_interfaces="fxp0"</pre><p>Now we must create the configuration file,
	<code class="filename">/etc/rtadvd.conf</code>.  Here is an example:</p><pre class="programlisting">fxp0:\
	:addrs#1:addr="2001:471:1f11:246::":prefixlen#64:tc=ether:</pre><p>Replace <code class="filename">fxp0</code> with the interface you
	are going to be using.</p><p>Next, replace <code class="systemitem">2001:471:1f11:246::</code>
	with the prefix of your allocation.</p><p>If you are dedicated a <code class="systemitem">/64</code> subnet
	you will not need to change anything else.  Otherwise, you will need to
	change the <code class="literal">prefixlen#</code> to the correct value.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-plip.html">Poprzedni</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Pocz±tek rozdzia³u</a></td><td width="40%" align="right"> <a accesskey="n" href="network-atm.html">Nastêpny</a></td></tr><tr><td width="40%" align="left" valign="top">27.9. Parallel Line IP (PLIP) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Spis tre¶ci</a></td><td width="40%" align="right" valign="top"> 27.11. Asynchronous Transfer Mode (ATM)</td></tr></table></div><p xmlns="" align="center"><small>All FreeBSD documents are available for download
    at <a href="http://ftp.FreeBSD.org/pub/FreeBSD/doc/">http://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="" align="center"><small>Questions that are not answered by the
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> may be
    sent to &lt;<a href="mailto:freebsd-questions@FreeBSD.org">freebsd-questions@FreeBSD.org</a>&gt;.<br />
    Send questions about this document to &lt;<a href="mailto:freebsd-doc@FreeBSD.org">freebsd-doc@FreeBSD.org</a>&gt;.</small></p></body></html>