<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>第6章 カーネルコンフィグレーション</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 2.X、3.X、4.X についての FAQ (よくある質問とその答え)" /><link rel="up" href="index.html" title="FreeBSD 2.X、3.X、4.X についての FAQ (よくある質問とその答え)" /><link rel="prev" href="applications.html" title="第5章 ユーザアプリケーション" /><link rel="next" href="admin.html" title="第7章 システム管理" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第6章 カーネルコンフィグレーション</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="applications.html">戻る</a>〓</td><th width="60%" align="center">〓</th><td width="20%" align="right">〓<a accesskey="n" href="admin.html">次へ</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="kernelconfig"></a>第6章 カーネルコンフィグレーション</h1></div></div></div><p>
      <span class="emphasis"><em>訳:
        はらだ きろう <code class="email">&lt;<a xmlns="" class="email" href="mailto:kiroh@jp.FreeBSD.org">kiroh@jp.FreeBSD.org</a>&gt;</code>、
        1997 年 11 月 10 日
      </em></span>
    </p><div class="qandaset"><a id="idp80921680"></a><dl><dt>6.1. <a href="kernelconfig.html#idp80921936">カーネルをカスタマイズしたいんですが、難しいですか?</a></dt><dt>6.2. <a href="kernelconfig.html#idp80926288">_hw_float
            が無いので、カーネルのコンパイルがうまくいきません。</a></dt><dt>6.3. <a href="kernelconfig.html#idp80930896">わたしのカーネルはどうしてこんなに大きい (10MB 以上)
            のでしょうか?</a></dt><dt>6.4. <a href="kernelconfig.html#idp80945360">
            マルチポートシリアルのコードで割り込みが衝突しています。
          </a></dt><dt>6.5. <a href="kernelconfig.html#idp80948176">カーネルを構築にいつも失敗します。
            GENERIC カーネルも構築できません。</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp80921936"></a><a id="make-kernel"></a><p><strong>6.1.</strong></p></td><td align="left" valign="top"><p>カーネルをカスタマイズしたいんですが、難しいですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>
            全然難しくありません。
            <a class="link" href="../handbook/kernelconfig.html" target="_top">カーネルの再構築</a>を調べてください。
          </p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">うまく動作するカーネルができたら、
                日付入りのカーネルのスナップショットを
                <code class="filename">kernel.YYMMDD</code>
                のように作成することをおすすめします。
                こうしておけば、次にカーネルの構築をやってうまくいかなくなってしまっても、
                <code class="filename">kernel.GENERIC</code> にわざわざ戻る必要がなくなります。
                これは、GENERIC カーネルでサポートされないデバイスから起動している場合は、
                特に重要です。
              </p></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp80926288"></a><a id="missing-hw-float"></a><p><strong>6.2.</strong></p></td><td align="left" valign="top"><p><code class="literal">_hw_float</code>
            が無いので、カーネルのコンパイルがうまくいきません。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>
            推測ですが、数値演算コプロセッサを持ってないからと思って、
            <code class="filename">npx0</code> (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=npx&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">npx</span>(4)</span></a> 参照)
            をカーネルコンフィグファイルから削除してしまったのではないでしょうか?
            <code class="filename">npx0</code> は<span class="emphasis"><em>必須</em></span>です。
            コプロセッサがなくても、<code class="filename">npx0</code>
            デバイスは削除してはいけません。
          </p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp80930896"></a><a id="why-kernel-big"></a><p><strong>6.3.</strong></p></td><td align="left" valign="top"><p>わたしのカーネルはどうしてこんなに大きい (10MB 以上)
            のでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>これは<span class="emphasis"><em>デバッグモード</em></span>でカーネルを構築していることが原因です。
            デバッグモードで構築されたカーネルは、
            デバッグに用いられる膨大なシンボル情報を含んでいるため、
            カーネルのサイズが非常に大きくなります。
            ただし FreeBSD 3.0 とそれ以降のシステムの場合は
            カーネルのサイズは小さくなりますし、
            デバッグカーネルを実行する時のパフォーマンスの低下もありません。
            また、そのカーネルはシステムがパニックした場合に有用です。</p><p>しかし、容量の小さなディスクでシステムを運用していたり、
            単にデバッグカーネルを実行したくない場合は、
            以下の両方が当てはまっているかどうか確認してください。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>カーネルコンフィグファイルに以下の行が書かれていないこと。</p><pre class="programlisting">makeoptions DEBUG=-g</pre></li><li class="listitem"><p><code class="command">config</code> を実行する際、
                <code class="option">-g</code> オプションを付けていないこと。</p></li></ul></div><p>上に書かれた指定は両方ともカーネルをデバッグモードで構築するためのものです。
            上の手順を従っている限り、カーネルを普通に構築してサイズの小さなカーネルを得ることができます。
            その場合のカーネルサイズは、およそ 1.5MB から 2MB 程度になります。</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp80945360"></a><a id="multiport-serial-interrupts"></a><p><strong>6.4.</strong></p></td><td align="left" valign="top"><p>
            マルチポートシリアルのコードで割り込みが衝突しています。
          </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>
            マルチポートシリアルを
            サポートするコードを含んだカーネルをコンパイルしようとすると、
            最初のポートだけ検出され、
            残りのポートは割り込みの競合のためスキップされたと言われます。
            どうやったらいいでしょうか?
          </p><p>
            ここでの問題は、FreeBSD
            にはハードウェアまたはソフトウェアの競合により、
            カーネルがクラッシュするのを防ぐコードが含まれているという点です。
            解決するには、最初のポートにだけ IRQ の設定を書き、
            残りは IRQ の設定を削除します。
            以下に例を示します。
          </p><pre class="programlisting"># Multiport high-speed serial line - 16550 UARTS
#
device sio2 at isa? port 0x2a0 tty irq 5 flags 0x501 vector siointr
device sio3 at isa? port 0x2a8 tty flags 0x501 vector siointr
device sio4 at isa? port 0x2b0 tty flags 0x501 vector siointr
device sio5 at isa? port 0x2b8 tty flags 0x501 vector siointr</pre></td></tr><tr class="question"><td align="left" valign="top"><a id="idp80948176"></a><a id="generic-kernel-build-failure"></a><p><strong>6.5.</strong></p></td><td align="left" valign="top"><p>カーネルを構築にいつも失敗します。
            GENERIC カーネルも構築できません。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>さまざまな理由が考えられます。以下、順に列記します。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>あなたは新しい
                <code class="command">make buildkernel</code> や
                <code class="command">make installkernel</code>
                ターゲットを使わず、
                現在走っているシステムを構築した時と異なるソースツリーを
                構築しようとしている (たとえば、4.0-RELEASE のシステム上で
                4.3-RELEASE を構築しようとしている) のではないでしょうか?
                もしシステムをアップグレードしようとしているのなら、
                <code class="filename">/usr/src/UPDATING</code> ファイルを
                <span class="quote">「<span class="quote">共通項目 (COMMON ITEMS)</span>」</span>
                節に注意しながら最後までお読みください。</p></li><li class="listitem"><p>あなたは新しい <code class="command">make buildkernel</code> や
                <code class="command">make installkernel</code> ターゲットを
                使っているのにも関わらず、
                <code class="command">make buildworld</code>
                を行なっていないのではないでしょうか?
                <code class="command">make buildkernel</code> ターゲットは、
                <code class="command">make buildworld</code>
                ターゲットによって作られるファイルに依存しています
                そのため、<code class="command">make buildkernel</code>
                が正常に終了するためには
                <code class="command">make buildworld</code>
                ターゲットが正常に完了している必要があります。</p></li><li class="listitem"><p>構築しようとしているのが
                <a class="link" href="preface.html#stable" title="6.">FreeBSD-STABLE</a>
                だったとしても、あなたが入手したソースツリーが何らかの理由で
                書き換わったり、壊れてしまっているのかも知れません。
                <a class="link" href="preface.html#stable" title="6.">FreeBSD-STABLE</a>
                はほとんどの場合、きちんと構築できるようになっていますが、
                確実に構築可能であることが保証されているのは
                リリース版だけです。一度ソースツリーを再取得して、
                問題が解決しないかどうか試してみてください。
                また、あるサーバから取得した時に問題が発生したら、
                別のサーバを試すのも効果があるかも知れません。</p></li></ul></div></td></tr></tbody></table></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="applications.html">戻る</a>〓</td><td width="20%" align="center">〓</td><td width="40%" align="right">〓<a accesskey="n" href="admin.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">第5章 ユーザアプリケーション〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓第7章 システム管理</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>