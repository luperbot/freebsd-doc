<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>19.4. ダイアルインサービス</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="serialcomms.html" title="第19章 シリアル通信" /><link rel="prev" href="term.html" title="19.3. シリアル端末" /><link rel="next" href="dialout.html" title="19.5. ダイアルアウトサービス" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">19.4. ダイアルインサービス</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="term.html">戻る</a>〓</td><th width="60%" align="center">第19章 シリアル通信</th><td width="20%" align="right">〓<a accesskey="n" href="dialout.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dialup"></a>19.4. ダイアルインサービス</h2></div><div><span class="authorgroup">寄稿: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Helmer</span> <span class="firstname">Guy</span> [FAMILY Given]</span>. </span></div><div><span class="authorgroup">改訂: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Kelly</span> <span class="firstname">Sean</span> [FAMILY Given]</span>. </span></div></div></div><a id="idp93486928" class="indexterm"></a><p><span class="emphasis"><em>訳: 中根 雅文 <code class="email">&lt;<a xmlns="" class="email" href="mailto:max@FreeBSD.org">max@FreeBSD.org</a>&gt;</code>.
	6 September 1996.</em></span></p><p>FreeBSD システムをダイアルインサービス用に設定することは、
      端末の代わりにモデムを扱うこと以外は、
      端末の接続によく似ています。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93489104"></a>19.4.1. 外づけモデムと内蔵モデムについて</h3></div></div></div><p>ダイアルアップのサービスに関していえば、
	  外づけのモデムの方が適している ようです。これは、
	  多くの外づけのモデムは設定を不揮発ラムに書き込んで半
	  永久的に保存することができますし、また RS-232
	  に関する重要な情報を知る
	  ための点滅するライトによるインディケータが
	  搭載されているからです。点滅 するライトは、
	  システムを見に来た訪問者に強い印象を与えるという効果だけ
	  でなく、モデムが適切に動作しているかどうかを知るためにも
	  有効です。</p><p>一方、たいていの内蔵型のモデムには
	  不揮発性ラムが搭載されていないため、ディップ
	  スイッチの変更以外に設定を保存する方法がありません。また、も
	  しインディケータがついていても、おそらくコンピュータのケース
	  カバーが 外されていなければその状態を確認するのは
	  難しいでしょう。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93490512"></a>19.4.1.1. モデムとケーブル</h4></div></div></div><a id="idp93491152" class="indexterm"></a><p>外付けモデムを使用しているなら、
	  それにあったケーブルが必要です。
	  通常の信号が全て接続されている限り、標準的な RS-232C
	  ケーブルで十分でしょう。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Transmitted Data (<acronym class="acronym">SD</acronym>)</p></li><li class="listitem"><p>Received Data (<acronym class="acronym">RD</acronym>)</p></li><li class="listitem"><p>Request to Send (<acronym class="acronym">RTS</acronym>)</p></li><li class="listitem"><p>Clear to Send (<acronym class="acronym">CTS</acronym>)</p></li><li class="listitem"><p>Data Set Ready (<acronym class="acronym">DSR</acronym>)</p></li><li class="listitem"><p>Data Terminal Ready (<acronym class="acronym">DTR</acronym>)</p></li><li class="listitem"><p>Carrier Detect (<acronym class="acronym">CD</acronym>)</p></li><li class="listitem"><p>Signal Ground (<acronym class="acronym">SG</acronym>)</p></li></ul></div><p>FreeBSD で 2400bps 以上の転送速度を利用する場合には、
	  フロー制御のため に <acronym class="acronym">RTS</acronym> 信号と
	  <acronym class="acronym">CTS</acronym> 信号が必要です。また、
	  接続の確立と回線の切 断を検出するために
	  <acronym class="acronym">CD</acronym> 信号を利用します。さらに、
	  <acronym class="acronym">DTR</acronym> 信号を使っ
	  て回線切断後のモデムのリセットを行います。ケーブルの中には、
	  総ての必要 な信号線が接続されていないものもありますので、
	  たとえば、回線切断後でも ログイン
	  セッションが残ってしまうといった問題が発生した場合などには、
	  ケーブルに問題がある可能性もあります。</p><p>FreeBSD も他の Unix 系 OS と同様、回線の接続およ
	  び切断の検出や回線の切断および回線切断後の
	  モデムの初期化にハードウェア  シグナルを利用します。FreeBSD
	  は、モデムに対するコマンドの送信やモデ
	  ムの状態の監視を行いません。パソコンで運用されている BBS
	  への接続に慣 れている方にとっては、
	  ちょっとめんどうかもしれませんね。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93524944"></a>19.4.2. シリアル インタフェースについて</h3></div></div></div><p>FreeBSD では、NS8250-、NS16450-、NS16550- および
	  NS16550A- に基づ いた EIA RS-232C (CCITT V.24)
	  規格のシリアル インタフェースをサポート しています。8250
	  および 16450 ベースのディバイスには1文字のキャラクタ
	  バッファが搭載されています。また、16550 系のディバイスには、
	  16文字分 のバッファが搭載されていて、
	  はるかによいパフォーマンスを得られます (ただし、無印の
	  16550 では、バグがあって 16 文字バッファが利用できませ
	  んので、可能であれば 16550A
	  系のディバイスを利用してください)。1文字 のバッファの物は、
	  16550 系のものと比べて OS にかける負荷が大きいので、16550A
	  系ディバイスの利用を強く推奨します。多数のシリアル
	  ポートを利 用する場合や、負荷の高いシステムにおいては、
	  16550A 系ディバイスを使う ことで、
	  エラー発生率を低く押さえることができます。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93526096"></a>19.4.3. 概要</h3></div></div></div><a id="idp93526736" class="indexterm"></a><p>端末に関しては、
	ダイアルイン接続に割り当てられたそれぞれのシリアルポートに対して、
	<code class="command">init</code> が <code class="command">getty</code>
	を起動します。たとえば、モデムが <code class="filename">/dev/ttyd0</code>
	に割り当てられていたら、<code class="command">ps ax</code>
	コマンドを実行すると、以下のような出力が得られるはずです。</p><pre class="screen"> 4850 ??  I      0:00.09 /usr/libexec/getty V19200 ttyd0</pre><p>ユーザがモデムに電話をかけ、モデム同士が接続されると、
	モデムの <acronym class="acronym">CD</acronym> (Carrier Detect) が検出されます。その結果、
	kernel がキャリア信号を検出して、<code class="command">getty</code>
	によるポートのオープンの処理が終了します。
	<code class="command">getty</code> は、<code class="prompt">login:</code>
	プロンプトを指定されている初期回線速度で送信します。
	<code class="command">getty</code> は、
	正常に文字列を受信できるかどうか監視し、通常の設定では、
	もし異常な文字列を検出した場合 (理由としては、
	<code class="command">getty</code> の速度とモデ
	ムの接続速度が異なっているような場合が考えられます)、
	正常に文字列が 受信できるまで、<code class="command">getty</code>
	は速度を変え続けます。</p><a id="idp93532880" class="indexterm"></a><p>ユーザがログイン名を入力すると、
	<code class="command">getty</code>  は
	<code class="filename">/usr/bin/login</code> を起動して、
	パスワードの入力を要求し、その
	後ユーザのシェルを起動します。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93535056"></a>19.4.4. 設定ファイル</h3></div></div></div><p>FreeBSD
	のシステムへのダイアルアップによるアクセスを実現するために編集が必要と思われる設定ファイルが、
	<code class="filename">/etc</code> ディレクトリに 3 つあります。まず、
	<code class="filename">/etc/gettytab</code> には、
	<code class="filename">/usr/libexec/getty</code>
	デーモンの設定を記述します。つぎに、
	<code class="filename">/etc/ttys</code> に保存されている情報から、
	<code class="filename">/sbin/init</code> はどの
	<code class="filename">tty</code> デバイスに対して
	<code class="command">getty</code> のプロセスを実行するべきか判断します。
	最後に、<code class="filename">/etc/rc.serial</code> スクリプトに、
	シリアルポートの初期化のためのコマンドを記述することができます。</p><p>Unix にダイアルアップモデムを接続する方法には、
	二つの考え方があります。一つの方法は、
	ダイアルインしてくるユーザの接続速度に関係なく、
	常にモデムとローカルのコンピュータの RS-232
	インタフェースの接続速度を一定に保つように設定する方法です。
	この設定の長所は、ユーザがダイアルインして接続されると、
	即座にシステムからのログインプロンプトが送信されるということです。
	短所は、システムが実際のモデム間の速度を知ることができないために、
	Emacs のようなフルスクリーンのプログラムが、
	端末との接続速度が遅い場合でも、
	そのような場合に効果的な方法で画面出力を行わない点です。</p><p>もう一つは、モデムの RS-232
	インタフェースとコンピュータの接続速度を、
	モデム間の接続速度に応じて変化させるような設定です。たとえば、
	モデム間 の接続が V.32bis (14.4 Kbps) ならば、
	モデムとコンピュータの間の接続を 19.2 Kbps とし、
	モデム間の接続が 2400 bps の時には、モデムとコンピュータ間も
	2400 bps で接続するような設定をします。この場合、
	<code class="command">getty</code>
	は、モデムが返すリザルトコードからモデムとコンピュータの接続速度を認識することができませんので、
	<code class="command">getty</code> は、まず初期速度で
	<code class="prompt">login:</code>
	という文字列を送信して、それに対する応答の文字列を監視します。
	ここで、ユーザ側の端末に無意味な文字列が表示された場合、
	ユーザは意味のある文字列を受信するまで
	<span class="keycode">Enter</span>
	キーを繰り返し押さなければならないということを知っていると仮定しています。
	もし接続速度が間違っている場合、<code class="command">getty</code> は、
	ユーザから送られた文字を無意味な文字列として扱い、
	次の速度を試します。そして、ここで再度 <code class="prompt">login:</code>
	プロンプトを送信します。
	この一連の動作が異常な回数繰り返されることも考えられますが、
	普通は 1 度か 2 度のキー入力があれば、
	ユーザはまともなプロンプトを受信できます。
	このログインの動作が前者の固定速度による方法に比べて美しくないのは明らかですが、
	この方法では、低速度で接続しているユーザに対するフルスクリーンのプログラムからのレスポンスが改善されます。</p><p>このセクションでは、両方の設定方法について解説しますが、
	どちらかというとモデム間の速度に応じて RS-232
	インタフェースの速度が変化するような
	設定の方に偏った説明になってしまうと思います。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93542864"></a>19.4.4.1. <code class="filename">/etc/gettytab</code></h4></div></div></div><a id="idp93543632" class="indexterm"></a><p><code class="filename">/etc/gettytab</code> は、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getty&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">getty</span>(8)</span></a>
	  の設定ファイルで、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=termcap&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">termcap</span>(5)</span></a>
	  と同様の形式で記述されます。ファイルのフォーマットや定
	  義できる機能についての詳細については、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gettytab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">gettytab</span>(5)</span></a>
	  のマニュアルを
	  ご覧ください。</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93547472"></a>19.4.4.1.1. 固定速度の設定</h5></div></div></div><p>モデムとコンピュータ間の通信速度を固定して使う場合、
	    おそらく  <code class="filename">/etc/gettytab</code>
	    に特に変更を加える必要はないはずです。</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93557456"></a>19.4.4.1.2. 可変速度の設定</h5></div></div></div><p><code class="command">getty</code>
	    が利用するモデムとコンピュータの接続速度に関する情報を
	    <code class="filename">/etc/gettytab</code>
	    に記述する必要があります。もし、2400 bps のモ
	    デムをお使いになるのであれば、既存の
	    <code class="literal">D2400</code> のエントリがそのまま利
	    用できるでしょう。</p><pre class="programlisting">#
# Fast dialup terminals, 2400/1200/300 rotary (can start either way)
#
D2400|d2400|Fast-Dial-2400:\
        :nx=D1200:tc=2400-baud:
3|D1200|Fast-Dial-1200:\
        :nx=D300:tc=1200-baud:
5|D300|Fast-Dial-300:\
        :nx=D2400:tc=300-baud:</pre><p>高速モデムをお使いの場合は、おそらく
	    <code class="filename">/etc/gettytab</code>
	    に新たなエントリを追加する必要があります。
	    以下の例は、14.4 Kbps のモデムを、
	    最大インタフェース速度を 19.2 Kbps
	    として利用するためのエントリです。</p><pre class="programlisting">#
# Additions for a V.32bis Modem
#
um|V300|High Speed Modem at 300,8-bit:\
        :nx=V19200:tc=std.300:
un|V1200|High Speed Modem at 1200,8-bit:\
        :nx=V300:tc=std.1200:
uo|V2400|High Speed Modem at 2400,8-bit:\
        :nx=V1200:tc=std.2400:
up|V9600|High Speed Modem at 9600,8-bit:\
        :nx=V2400:tc=std.9600:
uq|V19200|High Speed Modem at 19200,8-bit:\
        :nx=V9600:tc=std.19200:</pre><p>上記の例を利用した場合、
	    パリティなし、8ビットの接続が行われます。</p><p>上記の例では、まず 19.2 Kbps (V.32bis)
	    によるモデムとコンピュータ間の接続を試み、続いて 9600 bps
	    (V.32)、2400 bps、1200 bps、300 bpsと順に試み、再び
	    19.2 Kbps による接続を試みるという循環に入ります。
	    この接続速度の循環は、<code class="literal">nx=</code>(<span class="quote">「<span class="quote">next
	    table</span>」</span>) の機能で実現されています。また、
	    各行はそれぞれ <code class="literal">tc=</code>(<span class="quote">「<span class="quote">table
	    continuation</span>」</span>) の機能を使って、
	    その他の接続速度に依存した <span class="quote">「<span class="quote">標準的な</span>」</span>
	    設定を取り込んでいます。</p><p>もし、お使いのモデムが 28.8 Kbps であったり、14.4 Kbps
	    の圧縮転送の機能を有効に利用したい場合は、19.2 Kbps
	    よりも速い速度を利用するように設定する必要があります。
	    以下に 57.6 Kbps から接続を試みる
	    <code class="filename">gettytab</code>
	    の設定例を示しておきます。</p><pre class="programlisting">#
# Additions for a V.32bis or V.34 Modem
# Starting at 57.6 Kbps
#
vm|VH300|Very High Speed Modem at 300,8-bit:\
        :nx=VH57600:tc=std.300:
vn|VH1200|Very High Speed Modem at 1200,8-bit:\
        :nx=VH300:tc=std.1200:
vo|VH2400|Very High Speed Modem at 2400,8-bit:\
        :nx=VH1200:tc=std.2400:
vp|VH9600|Very High Speed Modem at 9600,8-bit:\
        :nx=VH2400:tc=std.9600:
vq|VH57600|Very High Speed Modem at 57600,8-bit:\
        :nx=VH9600:tc=std.57600:</pre><p>もし、お使いの CPU が低速のものであったり、CPU
	    に対する負荷が高い場合で、16550A
	    系のシリアルポートをお使いでない場合、
	    57.6 Kbps の接続において、<span class="errorname">sio</span> の
	    <span class="quote">「<span class="quote">silo</span>」</span> エラーが発生するかもしれません。</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="dialup-ttys"></a>19.4.4.2. <code class="filename">/etc/ttys</code></h4></div></div></div><a id="idp93571408" class="indexterm"></a><p><code class="filename">/etc/ttys</code>
	  ファイルの設定は、<a class="xref" href="term.html#ex-etc-ttys" title="例19.1 端末の項目を /etc/ttys に追加する">例19.1「端末の項目を <code class="filename">/etc/ttys</code>
	    に追加する」</a>
	  で扱われています。
	  モデムの設定も似たようなものですが、<code class="command">getty</code>
	  に異なる引数を渡して、異なる端末種別を指定しなければなりません。
	  固定速度および可変速度両方に共通する形式は次のようになります。</p><pre class="programlisting">ttyd0   "/usr/libexec/getty <em class="replaceable"><code>xxx</code></em>"   dialup on</pre><p>1 番目の項目は、このエントリで対象とするデバイススペシャルファイルです。
	  上の例では <code class="literal">ttyd0</code> として、
	  <code class="filename">/dev/ttyd0</code> を <code class="command">getty</code>
	  に監視させることを表しています。2 番目の項目
	  <code class="literal">"/usr/libexec/getty
	    xxx"</code>
	  (<em class="replaceable"><code>xxx</code></em> は初期段階で使われる
	  <code class="filename">gettytab</code>
	  のエントリに置き換えてください) が、<code class="command">init</code>
	  がこのディバイスに対して起動するプロセスです。3 番目の
	  <code class="literal">dialup</code> は、デフォルトのターミナルタイプです。
	  4 番目の <code class="literal">on</code> は、
	  この行が有効であることを <code class="command">init</code>
	  に対して示しています。5 番目の項目に <code class="literal">secure</code>
	  を指定することもできますが、これは、
	  たとえばシステムのコンソールのように、
	  物理的に安全な端末に対してのみ指定するようにしてください。</p><p>デフォルトのターミナルタイプ (上記の例では
	  <code class="literal">dialup</code>)
	  は、ローカルのユーザの好みによって異なってきます。
	  ユーザがログインスクリプトをカスタマイズして、ターミナルタイプが
	  <code class="literal">dialup</code>
	  の時には自動的に他のターミナルタイプを設定できるように、
	  ダイアルアップのポートのデフォルトのターミナルタイプには
	  <code class="literal">dialup</code> が伝統的に用いられています。
	  しかし、筆者のサイトでは、ほとんどのユーザが VT102
	  エミュレーションを使っているので、
	  ダイアルアップのポートのデフォルトターミナルタイプとして
	  <code class="literal">vt102</code> を指定しています。</p><p><code class="filename">/etc/ttys</code> の修正がすんだら、
	  以下のようなコマンドを使って
	  <code class="command">init</code> プロセスに <acronym class="acronym">HUP</acronym>
	  シグナルを送り、<code class="filename">/etc/ttys</code>
	  を読み込み直させてください。

	  </p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP 1</code></strong></pre><p>

	  ただ、もし初めてシステムを設定しているのであれば、
	  モデムが適切に設定されて接続されるまでは、
	  <code class="command">init</code>
	  に対してシグナルを送らない方がいいかもしれません。</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93596752"></a>19.4.4.2.1. 固定速度の設定</h5></div></div></div><p>速度を固定する設定では、<code class="filename">/etc/ttys</code>
	    の中で、<code class="command">getty</code> に対し
	    て固定速度のエントリを指定する必要があります。たとえば、
	    以下の例はポートのスピードが 19.2 Kbps
	    に固定されたモデムのための <code class="filename">ttys</code>
	    のエントリです。</p><pre class="programlisting">ttyd0   "/usr/libexec/getty std.19200"   dialup on</pre><p>モデムが異なる速度で固定されている場合は、
	    <code class="literal">std.19200</code> のかわりに
	    <code class="literal">std.speed</code>
	    を適切な値に置き換えたものにしてください。
	    <code class="filename">/etc/gettytab</code>
	    に挙がっている適切な種類を使うようにしてください。</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93601104"></a>19.4.4.2.2. 可変速度の設定</h5></div></div></div><p>可変速度の設定では、<code class="filename">ttys</code>
	    のエントリが、<code class="filename">/etc/gettytab</code>
	    の中の適切な <span class="quote">「<span class="quote">自動速度調整</span>」</span>
	    の初期設定のエントリを参照していなければな りません。
	    たとえば、もし前述の 19.2 Kbps
	    から接続を試みる可変速度の設定例
	    (<code class="literal">V19200</code> の
	    <code class="filename">gettytab</code> エントリ)をそのまま
	    <span class="emphasis"><em>ttys</em></span> に追加したのであれば、
	    <code class="filename">ttys</code>
	    エントリは以下のようになります。</p><pre class="programlisting">ttyd0   "/usr/libexec/getty V19200"   dialup on</pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93605584"></a>19.4.4.3. <code class="filename">/etc/rc.serial</code></h4></div></div></div><a id="idp93610576" class="indexterm"></a><p>V.32、V.32bis または V.34
	  モデムのような高速モデムを利用する場合、ハードウェア
	  (<code class="filename">RTS/CTS</code>)
	  フロー制御を行う必要があります。FreeBSD kernel
	  のモデムポートにハードウェアフロー制御のフラグを設定するための
	  <code class="command">stty</code> コマンドを、
	  <code class="filename">/etc/rc.serial</code> に記述できます。</p><p>たとえば、シリアルポート 1 番
	  (<code class="filename">COM2</code>)
	  のダイヤルインおよびダイヤルアウト初期化デバイスに
	  <code class="literal">termios</code> フラグ <code class="varname">crtscts</code>
	  を設定するには、次の行を <code class="filename">/etc/rc.serial</code>
	  に追加するとよいでしょう。</p><pre class="programlisting"># Serial port initial configuration
stty -f /dev/ttyid1 crtscts
stty -f /dev/cuai01 crtscts</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93615952"></a>19.4.5. モデムの設定</h3></div></div></div><p>もし、あなたのモデムがパラメータを不揮発ラムに
	保存できるタイプならば、MS-DOS 上の Telix や FreeBSD 上の
	<code class="command">tip</code> などのような通信プログラム を使って、
	パラメータを設定してください。<code class="command">getty</code>
	が利用する初期速度でモデムに接続して、以下の条件を満たすよ
	うに不揮発ラムの設定を変更してください。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>接続時に <acronym class="acronym">CD</acronym> 信号がオンになる</p></li><li class="listitem"><p>接続時に <acronym class="acronym">DTR</acronym> がオンになり、
	    <abbr class="abbrev">DTR</abbr> オフで回線を切断しモ
	    デムをリセットする。</p></li><li class="listitem"><p>送信時フロー制御には <acronym class="acronym">CTS</acronym> を利用。</p></li><li class="listitem"><p><acronym class="acronym">XON/XOFF</acronym>
	    によるフロー制御を行わない。</p></li><li class="listitem"><p>受信時のフロー制御は <acronym class="acronym">RTS</acronym> を使用。</p></li><li class="listitem"><p>Quiet mode (リザルト コードを返さない)</p></li><li class="listitem"><p>コマンド エコーを返さない。</p></li></ul></div><p>これらを実現するためのコマンドやディップ
	スイッチの設定に関しては、モ
	デムのマニュアルを参照してください。</p><p>以下に、USRobotics Sportster の 14,400 bps
	の外づけモデムの設定例を示 しておきます。</p><pre class="programlisting">ATZ
AT&amp;C1&amp;D2&amp;H1&amp;I0&amp;R2&amp;W</pre><p>ことのついでに、たとえば、V42.bis や MNP5
	のデータ圧縮を使用するかど
	うかなどのモデムの他の設定について確認、
	調整しておくのもよいかもしれま せん。</p><p>さらに、USRobotics Sportster の 14,400 bps
	の外づけモデムでは、以下の ようなディップ
	スイッチの設定も必要です。他のモデムをお使いの方も、以
	下の例を設定の参考にしてください。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>スイッチ 1: UP ― DTR 標準</p></li><li class="listitem"><p>スイッチ 2: N/A
	    (リザルトコードを単語形式にするか数値形式にするか)</p></li><li class="listitem"><p>スイッチ 3: UP ― リザルトコードを返さない</p></li><li class="listitem"><p>スイッチ 4: DOWN ― コマンドエコーを返さない</p></li><li class="listitem"><p>スイッチ 5: UP ― 自動着信</p></li><li class="listitem"><p>スイッチ 6: UP ― CD 標準</p></li><li class="listitem"><p>スイッチ 7: UP ―
	    不揮発ラムからデフォルト値をロードする</p></li><li class="listitem"><p>スイッチ 8: N/A (Smart Mode/Dumb Mode)</p></li></ul></div><p>リザルト コードを返さないように設定しておかないと、
	<code class="command">getty</code> が誤っ て <code class="prompt">login:</code>
	プロンプトをコマンド モードのモデムに送信してしまった場 合に、
	モデムがこの入力をエコーしたり、この入力に対するリザルト
	コード を返してしまったりすることになります。この結果として、
	モデムと  <code class="command">getty</code>
	の間で延々と無意味なやりとりが続いてしまう可能性があります。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93644240"></a>19.4.5.1. 固定速度の設定</h4></div></div></div><p>固定速度の設定では、
	  モデムとコンピュータ間の通信速度をモデムとモデム間
	  の接続速度に関係なく、常に一定に保つように、
	  モデムを設定する必要があり ます。USRobotics Sportster の
	  14,400 bps 外づけモデムの場合、以下のコ マンドで、
	  モデムとコンピュータ間の速度が、コマンド送信時の速度に固定さ
	  れます。</p><pre class="programlisting">ATZ
AT&amp;B1&amp;W</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93645776"></a>19.4.5.2. 可変速度の設定</h4></div></div></div><p>可変速度の設定では、シリアル ポートの速度が、
	  着信速度に応じて変化する ように設定しなければいけません。
	  USRobotics Sporster の 14,400 bps 外 づけモデムの場合、
	  以下のコマンドで、エラー訂正機能を利用した通信の場合 は、
	  コマンドを送信した時の通信速度にシリアル
	  ポートの速度を固定し、エ ラー訂正機能を利用しない接続では、
	  シリアル ポートの速度が変化するよう に設定されます。</p><pre class="programlisting">ATZ
AT&amp;B2&amp;W</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93647312"></a>19.4.5.3. モデムの設定の確認</h4></div></div></div><p>ほとんどの高速モデムには、
	  現在の設定をある程度人間にも理解できる形式に
	  して表示させるコマンドがあります。USRobotics Sporster の
	  14,400 bps  外づけモデムの場合は、<code class="command">ATI5</code>
	  コマンドで、現在の不揮発ラムの設定を 表示することができます。
	  さらに、ディップ スイッチの設定も含めた現在の
	  設定を確認するためには、<code class="command">ATZ</code>
	  コマンドを送信してから、<code class="command">ATI4</code>
	  コマンドを送信してください。</p><p>他のメーカーのモデムをお使いの場合は、
	  モデムのマニュアルで設定値の確認
	  方法を確認してください。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93650128"></a>19.4.6. トラブルシューティング</h3></div></div></div><p>以下の手順でダイアル アップ
	モデムの動作を確認することができます。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93651152"></a>19.4.6.1. FreeBSD システムの動作確認</h4></div></div></div><p>モデムを FreeBSD システムに接続し、
	  システムをブートします。あなたのモ
	  デムにモデムの状態を確認するためのインジケータがあれば、
	  <acronym class="acronym">DTR</acronym> のイ
	  ンジケータの状態に注目してください。もし、
	  システムのコンソールに  <code class="prompt">login:</code>
	  プロンプトが表示された時に、<acronym class="acronym">DTR</acronym>
	  のインジケータが点灯 すれば、FreeBSD が適切なポートに対して
	  <code class="command">getty</code> を起動し、モデムへ
	  の着信を待っている状態であることを意味しています。</p><p>もし <acronym class="acronym">DTR</acronym>
	  のインジケータが点灯しない場合は、システムのコンソールから
	  FreeBSD にログインして、<code class="command">ps ax</code> を実行し、
	  FreeBSD が適切なポートに対して<code class="command">getty</code>
	  プロセスを起動しようとしているのかどうか確認してください。
	  プロセスに関する情報の中に、
	  以下のような行が表示されるはずです。</p><pre class="screen">  114 ??  I      0:00.10 /usr/libexec/getty V19200 ttyd0
  115 ??  I      0:00.10 /usr/libexec/getty V19200 ttyd1</pre><p>モデムにまだ着信がない状態の時に、
	  以下のように上とは異なる出力があった
	  場合、<code class="command">getty</code> は既にモデム
	  ポートのオープンを終了したということに
	  なります。

	  </p><pre class="screen">  114 d0  I      0:00.10 /usr/libexec/getty V19200 ttyd0</pre><p>

	  <code class="command">getty</code> は、<acronym class="acronym">CD</acronym>
	  (carrier detect) 信号がオンの状態になるまで、
	  ポートのオープンを完了することはできませんので、
	  この場合は接続に問題が
	  あるか、あるいはモデムの設定に問題があることが考えられます。
	</p><p>もし、期待した
	  <code class="filename">ttydN</code>
	  ポートをオープンしようとしている
	  <code class="command">getty</code> が見あたらない場合は、再度
	  <code class="filename">/etc/ttys</code> の内容を確認し、
	  書式などに誤りがないか 調べてみてください。また、ログ
	  ファイル <code class="filename">/var/log/messages</code> に
	  <code class="command">init</code> および <code class="command">getty</code>
	  から何か出力がないかどうかも確認してみてく ださい。
	  もし何かメッセージが記録されていたら、再度
	  <code class="filename">/etc/ttys</code>、
	  <code class="filename">/etc/gettytab</code> の二つの設定ファイルと、
	  ディバイス スペシャルファイル
	  <code class="filename">/dev/ttydN</code> を確認し、
	  記述に誤りがないか、足りないエントリがないか、
	  足りないディバイス スペシャルファイルがないかといった
	  点について調べてみてください。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp93662288"></a>19.4.6.2. モデムで接続してみる</h4></div></div></div><p>実際にモデムを使って別のコンピュータから
	  接続してみてください。この時、8 ビット、パリティなし、
	  1 ストップビットで接続するようにしてください。
	  接続後すぐにプロンプトが返ってこない場合や、
	  無意味な文字列が表示される 場合は、1秒に1回くらいの割合で
	  <span class="keycode">Enter</span> キーを押してみてください。
	  しばらくたって、なおも <code class="prompt">login:</code>
	  プロンプトが現れない場合 は、<code class="command">BREAK</code>
	  信号を送信してみてください。この時、端末側で使って
	  いるモデムが高速モデムならば、
	  このモデムのインタフェースの接続速度を固 定してから、
	  再度ダイアル インしてみてください。(たとえば、USRobotics
	  Sportster の場合は、<code class="command">AT&amp;B1</code>)</p><p>それでもまだ <code class="prompt">login:</code>
	  プロンプトが表示されない場合は、
	  <code class="filename">/etc/gettytab</code>
	  の以下の点について再度確認してみてください。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">/etc/ttys</code> の対応する行の
	      2番目の項目で、<code class="filename">/etc/gettytab</code>
	      の中で定義されているエントリが指定されているか</p></li><li class="listitem"><p>各 <code class="literal">nx=</code> で
	      <code class="filename">/etc/gettytab</code>
	      の中で定義されているもの が指定されているか</p></li><li class="listitem"><p>各 <code class="literal">tc=</code> で
	      <code class="filename">/etc/gettytab</code>
	      の中で定義されているもの が指定されているか</p></li></ul></div><p>もしダイアル インしても、FreeBSD
	  システム側のモデムが応答しない場合は、FreeBSD 側のモデムが
	  <acronym class="acronym">DTR</acronym>
	  がオンになった時に電話にでるように設定さ
	  れているかを確認してください。
	  もしモデムの設定に問題がなさそうならば、
	  モデムのインジケータ (がもしあれば) で、
	  <acronym class="acronym">DTR</acronym> がオンになっているか
	  を確認してください。</p><p>この確認のステップを数回繰り返しても
	  うまくいかない場合は、一度休憩して、
	  しばらくたってから挑戦してみましょう。それでもだめなら、
	  おそらく <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">FreeBSD general questions メーリングリスト</a>
	  にあなたのモデムについての情報と問題を書いたメールを送れ ば、
	  メーリング
	  リストのメンバーが問題の解決を助けるべく努力してくれる
	  でしょう。</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="term.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="serialcomms.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="dialout.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">19.3. シリアル端末〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓19.5. ダイアルアウトサービス</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>