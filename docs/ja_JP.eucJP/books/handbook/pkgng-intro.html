<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>5.4. pkg によるバイナリ package の管理</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="ports.html" title="第5章 アプリケーションのインストール - packages と ports" /><link rel="prev" href="ports-finding-applications.html" title="5.3. ソフトウェアの探し方" /><link rel="next" href="ports-using.html" title="5.5. Ports Collection の利用" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.4. <span class="application">pkg</span> によるバイナリ
      package の管理</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ports-finding-applications.html">戻る</a>〓</td><th width="60%" align="center">第5章 アプリケーションのインストール - packages と ports</th><td width="20%" align="right">〓<a accesskey="n" href="ports-using.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="pkgng-intro"></a>5.4. <span class="application">pkg</span> によるバイナリ
      package の管理</h2></div></div></div><p><span class="application">pkg</span> は、FreeBSD における伝統的な 
      package 管理ツールの置き換えとなる次世代の管理ツールで、
      バイナリ packages をより早く、
      より簡単に管理できるようにする数多くの機能を提供します。</p><p><span class="application">pkg</span> は
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portmaster/pkg-descr">ports-mgmt/portmaster</a> や
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ports-mgmt/portupgrade/pkg-descr">ports-mgmt/portupgrade</a> などの
      port 管理ツールの置き換えではありません。
      これらのツールは、
      サードパーティ製ソフトウェアをバイナリ packages と
      Ports Collection の両形式からインストールできますが、
      一方で <span class="application">pkg</span> はバイナリ packages
      のみをインストールします。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-initial-setup"></a>5.4.1. <span class="application">pkg</span> 入門</h3></div></div></div><p>FreeBSD 8.4 以降では、
	<span class="application">pkg</span> とマニュアルページをダウンロードし、
	インストールするためのブートストラップユーティリティが用意されています。</p><p>システムをブートストラップするためには、
	以下を実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/sbin/pkg</code></strong></pre><p>これより前のバージョンの FreeBSD では、かわりに Ports Collection
	または packages を用いてインストールする必要があります。</p><p>port をインストールするには以下を実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/ports-mgmt/pkg</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install clean</code></strong></pre><p>古い package システムを用いているシステムをアップグレードする際には、
	新しいツールがすでにインストールされている package に認識するよう、
	データベースを新しいフォーマットへと変換する必要があります。    
	<span class="application">pkg</span> をインストールしたら、
	以下のコマンドを実行して、package
	データベースをこれまでの伝統的なフォーマットから新しいフォーマットへと変換する必要があります。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg2ng</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">このステップは、
	サードパーティ製ソフトウェアがまだインストールされていないような、
	新しくインストールされた直後のシステムでは必要ありません。</p></div><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">このステップは非可逆です。
	  一度 package データベースを <span class="application">pkg</span>
	  フォーマットへと変換したら、伝統的な <span class="application">pkg_*</span>
	  ツールを使うべきではありません。</p></div><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">package データベースを変換する際には、
	  新しいバージョンへのデータ変換に伴ったエラーが出力されることがあります。
	  通常、これらのエラーは無視して構いませんが、
	  <code class="command">pkg2ng</code> 終了後に表示される、
	  変換に失敗したサードパーティ製ソフトウェアの一覧については、
	  これらのソフトウェアを手動で再インストールする必要があります。</p></div><p>FreeBSD のバージョンが
	10.<em class="replaceable"><code>X</code></em> より前であれば、
	以下の行を <code class="filename">/etc/make.conf</code> に追加して、
	FreeBSD Ports Collection がソフトウェアの登録に、伝統的な
	package のフォーマットではなく、<span class="application">pkg</span>
	を用いるように設定してください。</p><pre class="programlisting">WITH_PKGNG=	yes</pre><p><span class="application">pkg</span> package 管理システムでは、
	ほとんどのコマンドに対して package リポジトリを使います。
	デフォルトの package リポジトリは
	<code class="filename">/usr/local/etc/pkg.conf</code> または
	<code class="envar">PACKAGESITE</code> 環境変数で定義されます。
	この環境変数は、設定ファイルを上書きします。</p><p>その他の <span class="application">pkg</span>
	の設定オプションは、pkg.conf(5) に記述されています。</p><p><span class="application">pkg</span> の利用情報は、
	pkg(8) マニュアルページや、
	<code class="command">pkg</code> を引数なしに実行すると表示されます。</p><p>各 <span class="application">pkg</span> コマンドの引数は、
	コマンドに固有なマニュアルページに記述されています。
	たとえば、<code class="command">pkg install</code> のマニュアルページを読むには、
	以下のコマンドのどちらかを実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg help install</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>man pkg-install</code></strong></pre><p>以下の節では、<span class="application">pkg</span>
	を用いた通常のバイナリ package の管理について説明します。
	各コマンドでは、カスタマイズのために、
	多くのオプションが使われています。
	詳細や、他の例については、
	コマンドのヘルプやマニュアルページを参照してください。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-pkg-info"></a>5.4.2. インストールされている package の情報を入手する</h3></div></div></div><p>オプションを使用しないで <code class="command">pkg info</code>
	を実行すると、
	システムにインストールされているすべての package もしくは、
	ある特定の package の情報が得られます。</p><p>たとえば、インストールされている
	<span class="application">pkg</span> の情報を調べるには、
	以下のように実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg info pkg</code></strong>
pkg-1.1.4_1</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-installing-deinstalling"></a>5.4.3. package のインストールと削除</h3></div></div></div><p>バイナリ package をインストールするには、
	以下のコマンドを使ってください。
	ここで <em class="replaceable"><code>packagename</code></em> は、インストールする
	package の名前です。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install <em class="replaceable"><code>packagename</code></em></code></strong></pre><p>このコマンドは、リポジトリデータを使用して、
	インストールすべきソフトウェアのバージョン、および、
	インストールされていない依存ソフトウェアがあるかどうかを調べます。
	たとえば、<span class="application">curl</span>
	をインストールするには以下を実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install curl</code></strong>
Updating repository catalogue
/usr/local/tmp/All/curl-7.31.0_1.txz          100% of 1181 kB 1380 kBps 00m01s

/usr/local/tmp/All/ca_root_nss-3.15.1_1.txz   100% of  288 kB 1700 kBps 00m00s

Updating repository catalogue
The following 2 packages will be installed:

        Installing ca_root_nss: 3.15.1_1
        Installing curl: 7.31.0_1

The installation will require 3 MB more space

0 B to be downloaded

Proceed with installing packages [y/N]: <strong class="userinput"><code>y</code></strong>
Checking integrity... done
[1/2] Installing ca_root_nss-3.15.5_1... done
[2/2] Installing curl-7.31.0_1... done
Cleaning up cache files...Done</pre><p>新しい package と依存関係から追加された package は、
	  インストール済み package 一覧に表示されます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg info</code></strong>
ca_root_nss-3.15.5_1	The root certificate bundle from the Mozilla Project
curl-7.31.0_1	Non-interactive tool to get files from FTP, GOPHER, HTTP(S) servers
pkg-1.1.4_6	New generation package manager</pre><p>必要のなくなった packages は、
	  <code class="command">pkg delete</code> を使って削除できます。
	  たとえば、以下のようにして削除できます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg delete curl</code></strong>
The following packages will be deleted:

	curl-7.31.0_1

The deletion will free 3 MB

Proceed with deleting packages [y/N]: <strong class="userinput"><code>y</code></strong>
[1/1] Deleting curl-7.31.0_1... done</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-upgrading"></a>5.4.4. インストールされている package のアップグレード</h3></div></div></div><p>以下のコマンドを実行すると、
	インストールされている packages
	が最新のバージョンにアップグレードされます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg upgrade</code></strong></pre><p>このコマンドは、インストールされているソフトウェアのバージョンと、
	リポジトリのカタログから利用できるバージョンとを比較し、
	リポジトリからアップグレードします。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-auditing"></a>5.4.5. インストールされている package の検証</h3></div></div></div><p>時折、
	サードウェア製のアプリケーションに脆弱性が見つかることがあります。
	脆弱性を調べるために、
	<span class="application">pkg</span> は、検証機能を持っています。
	システムにインストールされているソフトウェアに既知の脆弱性がないかどうかを調べるには、
	以下のように実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg audit -F</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-autoremove"></a>5.4.6. リーフ依存 ports の自動削除</h3></div></div></div><p>package を削除すると、不必要な依存 ports
	が残されることがあります。
	依存のために導入され、現在は不必要になった package は、
	以下のようにすると自動的に検出され、削除されます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg autoremove</code></strong>
Packages to be autoremoved:
	ca_root_nss-3.13.5

The autoremoval will free 723 kB

Proceed with autoremoval of packages [y/N]: <strong class="userinput"><code>y</code></strong>
Deinstalling ca_root_nss-3.15.1_1... done</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-backup"></a>5.4.7. package データベースのリストア</h3></div></div></div><p>伝統的な package 管理システムとは異なり、
	<span class="application">pkg</span> には package
	データベースをバックアップするメカニズムがあります。
	この機能はデフォルトで有効に設定されています。</p><div xmlns="" class="tip"><h3 class="admontitle">ヒント: </h3><p xmlns="http://www.w3.org/1999/xhtml">スクリプトによる定期的な
	  package データベースのバックアップを無効にするには、
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=periodic.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">periodic.conf</span>(5)</span></a> の中で、
	  <code class="literal">daily_backup_pkgdb_enable="NO"</code> 
	  と設定してください。</p></div><p>過去にバックアップした package
	データベースの中身をリストアするには、
	以下のコマンドを実行してください。
	以下のコマンドの <em class="replaceable"><code>/path/to/pkg.sql</code></em>
	については、バックアップのある場所に置き換えて実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg backup -r <em class="replaceable"><code>/path/to/pkg.sql</code></em></code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">システムの定期的なスクリプトによって取得されたバックアップをリストアする場合には、
	  リストアの前に展開しておく必要があります。</p></div><p>手動で <span class="application">pkg</span>
	データベースをバックアップするには、以下のコマンドを実行してください。
	以下のコマンドの <em class="replaceable"><code>/path/to/pkg.sql</code></em>
	については、適切なファイル名と場所に置き換えて下さい。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg backup -d <em class="replaceable"><code>/path/to/pkg.sql</code></em></code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-clean"></a>5.4.8. 古くなった package の削除</h3></div></div></div><p>デフォルトでは、<span class="application">pkg</span>
	は、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pkg.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">pkg.conf</span>(5)</span></a> の	<code class="envar">PKG_CACHEDIR</code>
	変数で定義されるキャッシュディレクトリにバイナリ
	packages を保存します。
	インストールされている package の最新のコピーのみが保存されます。
	古いバージョンの <span class="application">pkg</span> では、
	過去にインストールされたすべての package が保存されていました。
	これらの古くなったバイナリ package を削除するには、
	以下を実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg clean</code></strong></pre><p>キャッシュ全体を削除するには以下を実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg clean -a</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pkgng-set"></a>5.4.9. package メタデータの変更</h3></div></div></div><p>FreeBSD Ports Collection
	では、メジャーバージョン番号が変更になることがあります。
	これに対応するために、<span class="application">pkg</span> には、
	package の情報をアップデートするコマンドが組み込まれています。
	たとえば、<code class="filename">lang/php5</code> が、
	バージョン <code class="literal">5.4</code> を表すようになり、
	<code class="filename">lang/php5</code> を
	<code class="filename">lang/php53</code>
	と名前を変更する必要があるような場合に、有用です。</p><p>上記の例の package の情報を変更するには、
	以下のように実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg set -o lang/php5:lang/php53</code></strong></pre><p>別の例として、<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/lang/ruby18/pkg-descr">lang/ruby18</a> を
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/lang/ruby19/pkg-descr">lang/ruby19</a> にアップデートするには、
	以下のようにしてください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg set -o lang/ruby18:lang/ruby19</code></strong></pre><p>最後の例として、
	<code class="filename">libglut</code> 共有ライブラリの情報を
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/graphics/libglut/pkg-descr">graphics/libglut</a> から
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/graphics/freeglut/pkg-descr">graphics/freeglut</a> へと変更するには、
	以下のように実行してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg set -o graphics/libglut:graphics/freeglut</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">package の情報を変更したら、
	  情報が変更された package に依存している
	  packages を再インストールすることが重要となります。
	  依存 packages を再インストールするには、
	  以下のように実行してください。</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg install -Rf <em class="replaceable"><code>graphics/freeglut</code></em></code></strong></pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ports-finding-applications.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="ports.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="ports-using.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">5.3. ソフトウェアの探し方〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓5.5. Ports Collection の利用</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>