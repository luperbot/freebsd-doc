<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>16.4. RAID</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="disks.html" title="第16章 ストレージ" /><link rel="prev" href="disks-adding.html" title="16.3. ディスクの追加" /><link rel="next" href="creating-cds.html" title="16.5. 光メディア (CD &amp; DVD) の作成と使用" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">16.4. RAID</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="disks-adding.html">戻る</a>〓</td><th width="60%" align="center">第16章 ストレージ</th><td width="20%" align="right">〓<a accesskey="n" href="creating-cds.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="raid"></a>16.4. RAID</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="raid-soft"></a>16.4.1. ソフトウェア RAID</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ccd"></a>16.4.1.1. Concatenated Disk Driver (CCD) の設定</h4></div><div><span class="authorgroup">原作: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Shumway</span> <span class="firstname">Christopher</span> [FAMILY Given]</span>. </span></div><div><span class="authorgroup">改訂: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Brown</span> <span class="firstname">Jim</span> [FAMILY Given]</span>. </span></div></div></div><a id="idp90917712" class="indexterm"></a><a id="idp90918864" class="indexterm"></a><p>大容量記録に関する解決法を選択する際にもっとも重視すべき要素は、
	  速度、信頼性、そして費用です。
	  三つを同時にバランスよく実現することは稀です。
	  通常、速くて信頼性のある大容量記録装置は高価であり、
	  費用を抑えようとすると速度または信頼性のどちらかが犠牲になります。</p><p>ここで例にあげるシステムの設計においては、
	  費用が最も重要な要素として、次に速度、最後に信頼性が選択されています。
	  このシステムでのデータ転送速度は結局のところネットワークによって制限されます。
	  信頼性は大変重要です。ただし、以下で説明する CCD ドライブは、
	  データ自体はすでに CD-R に完全にバックアップしてあるもの
	  (したがって交換は簡単にできます)
	  の、オンラインデータの役割をさせています。</p><p>あなた自身の要求事項を決定することは、
	  大容量記録に関する解決法を選択することの最初の段階です。
	  もしあなたの要求事項が費用より速度または信頼性を優先するなら、
	  解決法はこのシステムとは違うものになるでしょう。</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ccd-installhw"></a>16.4.1.1.1. ハードウェアのインストール</h5></div></div></div><p>IDE システムディスクに加えて、Western Digital 製の
	    30GB, 5400RPM の IDE ディスク三台を使って、
	    以下に説明されているような約 90GB のオンラインストレージとなる
	    CCD ディスクを作成しました。各 IDE ディスクがそれぞれの
	    IDE コントローラとケーブルをもっていることが理想的ですが、
	    費用を最低限にするために、
	    IDE コントローラを追加していません。その代わり、それぞれの IDE
	    コントローラがマスタデバイスを一つ、
	    スレーブデバイスを一つ持つように、
	    ディスクはジャンパを使って設定されています。</p><p>再起動の際に、システム BIOS
	    が接続されたディスクを自動的に検出するように設定されました。
	    より重要なことは、FreeBSD が再起動の際にそれらを検出することです。</p><pre class="programlisting">ad0: 19574MB &lt;WDC WD205BA&gt; [39770/16/63] at ata0-master UDMA33
ad1: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata0-slave UDMA33
ad2: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata1-master UDMA33
ad3: 29333MB &lt;WDC WD307AA&gt; [59598/16/63] at ata1-slave UDMA33</pre><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD がディスクをすべて検出しないときは、
	      ジャンパを正しく設定してあるか確認してください。多くの IDE
	      ドライブは <span class="quote">「<span class="quote">ケーブルセレクト</span>」</span>
	      ジャンパを持っています。
	      これはマスタ/スレーブの関係を設定するジャンパでは
	      <span class="emphasis"><em>ありません</em></span>。ドライブの文書を参照して、
	      正しいジャンパ設定を見つけてください。</p></div><p>次に、ファイルシステムの一部分として、
	    それらをどのように接続するのかを考慮します。<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vinum&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">vinum</span>(8)</span></a>
	    
	    および <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a>
	    の両方を検討すべきでしょう。この設定では、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a>
	    を選択しました。</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ccd-setup"></a>16.4.1.1.2. CCD の設定</h5></div></div></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a> ドライバは、いくつかの同じディスクを使って、
	    一つの論理的ファイルシステムに連結することができます。
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a> を使用するためには、カーネルが <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a>
	    に対応している必要があります。
	    次の行をカーネルコンフィギュレーションファイルに追加して、
	    カーネルを再構築し、再インストールしてください。</p><pre class="programlisting">pseudo-device   ccd     4</pre><p>5.X システムでは、
	    上記の代わりに次の行を追加しなければなりません。</p><pre class="programlisting">device   ccd</pre><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD 5.X では <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a>
	      デバイスの数を指定する必要はありません。<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a>
	      デバイスドライバは自己複製するようになりました ―
	      新しいデバイスインスタンスは、
	      必要に応じてその都度自動的に作成されます。</p></div><p>FreeBSD 3.0 以降では、
	    カーネルモジュールを読み込んで
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a> に対応することもできます。</p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a> を設定するために、まず <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=disklabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">disklabel</span>(8)</span></a>
	    を使用してディスクにラベルを書き込まなくてはなりません。</p><pre class="programlisting">disklabel -r -w ad1 auto
disklabel -r -w ad2 auto
disklabel -r -w ad3 auto</pre><p>このコマンドはディスク全体を示す
	    <code class="filename">ad1c</code>,
	    <code class="filename">ad2c</code> および
	    <code class="filename">ad3c</code> に対するディスクラベルを作成します。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD 5.1-RELEASE から、従来の <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=disklabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">disklabel</span>(8)</span></a>
	      プログラムは <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a>
	      ユーティリティに置き換えられました。<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a> では、
	      使用されていない数多くのオプションやパラメタが削除されました。
	      たとえば <code class="option">-r</code> オプションは <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a>
	      では取り除かれました。詳細については <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a>
	      のマニュアルページを参照してください。</p></div><p>次に、ディスクラベルのタイプを変更します。
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=disklabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">disklabel</span>(8)</span></a> を使用してディスクラベルを編集してください。</p><pre class="programlisting">disklabel -e ad1
disklabel -e ad2
disklabel -e ad3</pre><p>このコマンドは <code class="envar">EDITOR</code>
	    環境変数に設定されているエディタ (一般的には <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a>)
	    でそれぞれのディスクの現在のディスクラベルを開きます。</p><p>変更されていないディスクラベルは以下のようになります。</p><pre class="programlisting">8 partitions:
#        size   offset    fstype   [fsize bsize bps/cpg]
  c: 60074784        0    unused        0     0     0   # (Cyl.    0 - 59597)</pre><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a> で使用する <code class="literal">e</code>
	    パーティションを作成します。通常では <code class="literal">c</code>
	    パーティションの行をコピーすれば良いでしょう。しかし、
	    <code class="option">fstype</code> は <strong class="userinput"><code>4.2BSD</code></strong>
	    でなければ <span class="emphasis"><em>なりません</em></span>。
	    ディスクラベルは以下のようになるでしょう。</p><pre class="programlisting">8 partitions:
#        size   offset    fstype   [fsize bsize bps/cpg]
  c: 60074784        0    unused        0     0     0   # (Cyl.    0 - 59597)
  e: 60074784        0    4.2BSD        0     0     0   # (Cyl.    0 - 59597)</pre></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ccd-buildingfs"></a>16.4.1.1.3. ファイルシステムの構築</h5></div></div></div><p><code class="filename">ccd0c</code>
	    デバイスノードはまだ存在していないかも知れません。
	    そのときは、次のコマンドを実行して作成してください。</p><pre class="programlisting">cd /dev
sh MAKEDEV ccd0</pre><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD 5.0 では <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs</span>(5)</span></a> が
	      <code class="filename">/dev</code> 以下のデバイスノードを自動的に管理するので、
	      <code class="command">MAKEDEV</code>を使用する必要はありません。</p></div><p>すべてのディスクにラベルを書き込んだので、
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a> を構築してください。
	    これを行うためには、以下のようなオプションで
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ccdconfig</span>(8)</span></a> を使います。</p><pre class="programlisting">ccdconfig ccd0<a id="co-ccd-dev"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span> 32<a id="co-ccd-interleave"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span> 0<a id="co-ccd-flags"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span> /dev/ad1e<a id="co-ccd-devs"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span> /dev/ad2e /dev/ad3e</pre><p>各オプションの使用法と意味は以下の通りです。</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co-ccd-dev"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>一番目の引数は設定するデバイスです。この例の場合は
		<code class="filename">/dev/ccd0c</code> です。
		<code class="filename">/dev/</code> の部分はオプションです。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ccd-interleave"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>ファイルシステムに対するインタリーブです。インタリーブは、
		ディスクブロック内のストライプサイズを定義します。
		ディスクブロックは通常 512 バイトです。したがって 32
		インタリーブは 16,384 バイトとなります。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ccd-flags"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>これは <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ccdconfig</span>(8)</span></a> に対するフラグです。
		ドライブミラーリングを有効にしたい場合、
		ここにフラグを指定します。
		この設定では <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a> に対するミラーリングは提供しませんので、
		0 (ゼロ) を指定しています。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co-ccd-devs"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>この <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ccdconfig</span>(8)</span></a> に対する最後の引数は、
		アレイ内に置くデバイスです。
		それぞれのデバイスに対する完全なパス名を使用します。</p></td></tr></table></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccdconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ccdconfig</span>(8)</span></a> を実行すると <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a> が設定されます。
	    これでファイルシステムをインストールすることが可能です。
	    オプションについて <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newfs</span>(8)</span></a> を参照するか、
	    次のように実行してください。</p><pre class="programlisting">newfs /dev/ccd0c</pre></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ccd-auto"></a>16.4.1.1.4. 自動的に設定する</h5></div></div></div><p>一般的に、再起動するたびに <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a>
	    をマウントしたいと思うでしょう。これを行うために、
	    まず設定をしなければなりません。次のコマンドを用いて、
	    現在の設定を <code class="filename">/etc/ccd.conf</code> に書き出します。</p><pre class="programlisting">ccdconfig -g &gt; /etc/ccd.conf</pre><p><code class="filename">/etc/ccd.conf</code> が存在すると、
	    再起動の際に <code class="command">/etc/rc</code> スクリプトが
	    <code class="command">ccdconfig -C</code> を実行します。これにより、
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a> は自動的に設定された後、マウントされます。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">シングルユーザモードで起動している場合には、
	      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a> を <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> する前に、
	      アレイを設定するために次のコマンドを実行する必要があります。</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">ccdconfig -C</pre></div><p>自動的に <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a> をマウントするには、
	    <code class="filename">/etc/fstab</code> に <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a>
	    のエントリ追加します。このように設定すると起動時にマウントされます。</p><pre class="programlisting">/dev/ccd0c              /media       ufs     rw      2       2</pre></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="vinum"></a>16.4.1.2. Vinum ボリュームマネージャ</h4></div></div></div><a id="idp91047376" class="indexterm"></a><a id="idp91048528" class="indexterm"></a><p>Vinum ボリュームマネージャは、
	  仮想ディスクドライブを実装したブロックデバイスドライバです。
	  Vinum は、ディスクハードウェアをブロックデバイスインタフェースから
	  分離し、データを配置します。
	  その結果、ディスク記憶装置を従来のスライスで扱うのと比較して、
	  柔軟性、性能および信頼性が向上しています。
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vinum&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">vinum</span>(8)</span></a> は RAID-0, RAID-1 および RAID-5 モデル、
	  そしてそれぞれの組合せを実装しています。</p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vinum&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">vinum</span>(8)</span></a> の詳細については Vinum ボリュームマネジャ
	  
	  を参照してください。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="raid-hard"></a>16.4.2. ハードウェア RAID</h3></div></div></div><a id="idp91053392" class="indexterm"></a><p>FreeBSD は、さまざまなハードウェア <acronym class="acronym">RAID</acronym>
	コントローラにも対応しています。これらのデバイスはアレイを制御するための
	特別なソフトウェアを FreeBSD で必要することなく、
	<acronym class="acronym">RAID</acronym> サブシステムを制御します。</p><p>カード上の <acronym class="acronym">BIOS</acronym> を使用して、
	カードはそれ自身でディスク操作のほとんどを制御します。以下は
	<acronym class="acronym">Promise IDE RAID</acronym>
	コントローラを使用した設定の簡単な説明です。
	このカードがインストールされ、システムが起動したときには、
	情報の入力を促すプロンプトを表示します。
	指示にしたがってカードの設定画面に進んでください。
	接続されたドライブを組み合わせるように設定することができます。
	設定後、ディスクは FreeBSD に対して単一のドライブのように見えます。
	他の <acronym class="acronym">RAID</acronym> レベルは適宜設定できます。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91057488"></a>16.4.3. ATA RAID1 アレイの再構築</h3></div></div></div><p>FreeBSD はアレイ内の障害ディスクを動作中に交換できます。
	ただし、再起動前にそれを検知していることが必要です。</p><p><code class="filename">/var/log/messages</code> または <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a>
	の出力に次のような行があるでしょう。</p><pre class="programlisting">ad6 on monster1 suffered a hard error.
ad6: READ command timeout tag=0 serv=0 - resetting
ad6: trying fallback to PIO mode
ata3: resetting devices .. done
ad6: hard error reading fsbn 1116119 of 0-7 (ad6 bn 1116119; cn 1107 tn 4 sn 11) status=59 error=40
ar0: WARNING - mirror lost</pre><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=atacontrol&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">atacontrol</span>(8)</span></a> を使用して詳細を調べてください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>atacontrol list</code></strong>
ATA channel 0:
	Master:      no device present
	Slave:   acd0 &lt;HL-DT-ST CD-ROM GCR-8520B/1.00&gt; ATA/ATAPI rev 0

ATA channel 1:
	Master:      no device present
	Slave:       no device present

ATA channel 2:
	Master:  ad4 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
	Slave:       no device present

ATA channel 3:
	Master:  ad6 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
	Slave:       no device present

<code class="prompt">#</code> <strong class="userinput"><code>atacontrol status ar0</code></strong>
ar0: ATA RAID1 subdisks: ad4 ad6 status: DEGRADED</pre><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>ディスクを安全に取り外すために、
	    まずアレイから切り離します。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>atacontrol detach 3</code></strong></pre></li><li class="step"><p>ディスクを取り外します。</p></li><li class="step"><p>スペアのディスクを取り付けます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>atacontrol attach 3</code></strong>
Master:  ad6 &lt;MAXTOR 6L080J4/A93.0500&gt; ATA/ATAPI rev 5
Slave:   no device present</pre></li><li class="step"><p>アレイを再構築します。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>atacontrol rebuild ar0</code></strong></pre></li><li class="step"><p>再構築コマンドは完了するまで他の操作を受け付けません。しかし、
	    もう一つ別のターミナルを
	    (<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F<em class="replaceable"><code>n</code></em></strong></span>
	    を押して) 開き、
	    次のコマンドを実行すると進行状態を確認することができます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dmesg | tail -10</code></strong>
[output removed]
ad6: removed from configuration
ad6: deleted from ar0 disk1
ad6: inserted into ar0 disk1 as spare

<code class="prompt">#</code> <strong class="userinput"><code>atacontrol status ar0</code></strong>
ar0: ATA RAID1 subdisks: ad4 ad6 status: REBUILDING 0% completed</pre></li><li class="step"><p>操作が完了するまでお待ちください。</p></li></ol></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="disks-adding.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="disks.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="creating-cds.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">16.3. ディスクの追加〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓16.5. 光メディア (CD &amp; DVD) の作成と使用</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>