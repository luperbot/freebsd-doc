<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>11.2. インストール</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="linuxemu.html" title="第11章 Linux バイナリ互換機能" /><link rel="prev" href="linuxemu.html" title="第11章 Linux バイナリ互換機能" /><link rel="next" href="linuxemu-mathematicau.html" title="11.3. Mathematica のインストール" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">11.2. インストール</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="linuxemu.html">戻る</a>〓</td><th width="60%" align="center">第11章 Linux バイナリ互換機能</th><td width="20%" align="right">〓<a accesskey="n" href="linuxemu-mathematicau.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-lbc-install"></a>11.2. インストール</h2></div></div></div><a id="idp87694928" class="indexterm"></a><p>Linux バイナリ互換機能は、デフォルトでは有効ではありません。
      この機能を有効にする最も簡単な方法は、
      <code class="literal">linux</code> KLD オブジェクト
      (<span class="quote">「<span class="quote">Kernel LoaDable object</span>」</span>) を読み込むことです。
      コマンドプロンプトで <code class="command">linux</code>
      と打つだけでモジュールを読み込むことができます。</p><p>Linux 互換機能を常に有効にする場合には、
      <code class="filename">/etc/rc.conf</code> に以下の行を追加してください。</p><pre class="programlisting">linux_enable="YES"</pre><p>この設定により、<code class="filename">/etc/rc.i386</code>
      では次のような操作が行なわれます。</p><pre class="programlisting"># Start the Linux binary compatibility if requested.
#
case ${linux_enable} in
[Yy][Ee][Ss])
	echo -n ' linux';	linux &gt; /dev/null 2&gt;&amp;1
	;;
esac
    </pre><p>望みの KLD モジュールがロードされているか確認したい時には
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldstat</span>(8)</span></a> コマンドを利用します。</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>kldstat</code></strong>
Id Refs Address    Size     Name
 1    2 0xc0100000 16bdb8   kernel
 7    1 0xc24db000 d000     linux.ko</pre><a id="idp87701712" class="indexterm"></a><p>
      何らかの理由で Linux KLD をロードしたくない、
      あるいはロードできないような場合には、
      <code class="literal">options  LINUX</code>
      をカーネルの設定ファイルに指定して、
      Linux バイナリ互換機能をカーネルにスタティックリンクしてください。
      そして、<a class="xref" href="kernelconfig.html" title="第9章 FreeBSD カーネルのコンフィグレーション">9章<em>FreeBSD カーネルのコンフィグレーション</em></a>
      の記述にしたがって新しいカーネルをインストールしてください。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87704016"></a>11.2.1. Linux ランタイムライブラリのインストール</h3></div></div></div><a id="idp87704784" class="indexterm"></a><p>これは、<a class="link" href="linuxemu-lbc-install.html#linuxemu-libs-port" title="11.2.1.1. linux_base の port を用いたインストール">linux_base</a>
	port を用いるか、もしくは <a class="link" href="linuxemu-lbc-install.html#linuxemu-libs-manually" title="11.2.1.2. 手動でのライブラリのインストール">手動で</a> インストールします。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="linuxemu-libs-port"></a>11.2.1.1. linux_base の port を用いたインストール</h4></div></div></div><a id="idp87712336" class="indexterm"></a><p>ランタイムライブラリをインストールするには最も簡単な方法です。
	  <a class="link" href="http://www.FreeBSD.org/ja/ports/" target="_top">Ports Collection</a> から他の port
	  をインストールするのと全く同じようにできます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/ports/emulators/linux_base</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install distclean</code></strong></pre><p>これで Linux バイナリ互換機能が使えるはずです。
	  いくつかのプログラムはシステムライブラリのマイナーバージョンが違うと文句を言うかもしれませんが一般的には大した問題ではありません。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="linuxemu-libs-manually"></a>11.2.1.2. 手動でのライブラリのインストール</h4></div></div></div><p><span class="quote">「<span class="quote">ports</span>」</span> コレクションをインストールしていない場合、
	  代わりに手動でライブラリをインストールすることができます。
	  プログラムが必要とする Linux のシェアードライブラリとランタイムリンカが必要です。
	  また Linux ライブラリ用の <span class="quote">「<span class="quote">shadow root</span>」</span> ディレクトリ、
	  <code class="filename">/compat/linux</code> を作成する必要があります。
	  FreeBSD で動作する Linux プログラムが使用するシェアードライブラリは、
	  まずこのファイルツリーから検索されます。例えば、
	  Linux のプログラムが <code class="filename">/lib/libc.so</code>
	  をロードしようとした場合には、FreeBSD はまず
	  <code class="filename">/compat/linux/lib/libc.so</code>
	  を開こうとします。これが存在しなかった場合には、次に
	  <code class="filename">/lib/libc.so</code> を試します。
	  シェアードライブラリは、Linux の <code class="command">ld.so</code>
	  が報告するパスではなく、
	  <code class="filename">/compat/linux/lib</code>
	  以下にインストールする必要があります。</p><p>Linux のプログラムが必要とする
	  シェアードライブラリを探す必要があるのは、FreeBSD
	  のシステムに Linux
	  のプログラムをインストールする最初の数回だけでしょう。
	  それが過ぎれば、十分な Linux のシェアードライブラリがシステムにインストールされ、
	  新しくインストールした Linux のバイナリも余計な作業をせずに動作させることができるようになります。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87724880"></a>11.2.1.3. シェアードライブラリの追加</h4></div></div></div><a id="idp87725520" class="indexterm"></a><p><code class="filename">linux_base</code> port をインストールした後に、
	  アプリケーションが必要なライブラリが存在しないというエラーを出したらどうしたらよいでしょうか?
	  Linux のバイナリがどのシェアードライブラリを必要とし、
	  そしてどこで入手できるか、どのように探したらよいでしょうか?
	  基本的には、以下の 2 種類の方法があります (以下の手順に従う場合には、
	  必要なインストール作業をおこなう FreeBSD システム上で root
	  として作業をおこなう必要があります)。</p><p>Linux システムにアクセス可能ならば、
	  そのアプリケーションがどういうシェアードライブラリを必要としているのか調べ、
	  単に FreeBSD にそのライブラリをコピーするだけです。
	  次の例を見てみましょう。</p><div class="informalexample"><p>FTP を使って Doom の Linux バイナリを取ってきて、
	    アクセスできる Linux システムに置いたとしましょう。
	    次のように <code class="command">ldd linuxdoom</code> とするだけでどのシェアードライブラリが必要かチェックできます。</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ldd linuxxdoom</code></strong>
libXt.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libXt.so.3.1.0
libX11.so.3 (DLL Jump 3.1) =&gt; /usr/X11/lib/libX11.so.3.1.0
libc.so.4 (DLL Jump 4.5pl26) =&gt; /lib/libc.so.4.6.29</pre><a id="idp87729104" class="indexterm"></a><p>最後のカラムに表示されているすべてのファイルを持って来て、
	  <code class="filename">/compat/linux</code> の下に置き、
	  最初のカラムに示されるファイル名にシンボリックリンクを張ります。
	  すなわち、FreeBSD システムでは以下のようなファイルが必要となります。</p><pre class="screen">/compat/linux/usr/X11/lib/libXt.so.3.1.0
/compat/linux/usr/X11/lib/libXt.so.3 -&gt; libXt.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3.1.0
/compat/linux/usr/X11/lib/libX11.so.3 -&gt; libX11.so.3.1.0
/compat/linux/lib/libc.so.4.6.29 /compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</pre><div class="blockquote"><blockquote class="blockquote"><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">最初のカラムに表示されているファイルとメジャーバージョンが同じ
	        Linux シェアードライブラリを既にインストールしている場合は、
		新たにコピーする 必要はありません。
		既にあるライブラリで動作するはずです。
		ただ、新しいバージョンのものをコピーすることをお奨めします。
		新しいライブラリにシンボリックリンクを変更したら、
		古いライブラリは削除してかまいません。</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">/compat/linux/lib/libc.so.4.6.27
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.27</pre><p xmlns="http://www.w3.org/1999/xhtml">従って、以上のようなライブラリがインストールされており、
	        新しいバイナリに対する <code class="command">ldd</code>
	        の出力が以下のようになる場合を考えます。</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">libc.so.4 (DLL Jump 4.5pl26) -&gt; libc.so.4.6.29</pre><p xmlns="http://www.w3.org/1999/xhtml">このように最後の番号が 1 つか 2 つ古いだけならば、普通は
	        <code class="filename">/lib/libc.so.4.6.29</code>
	        をコピーする必要はありません。わずかに古いライブラリでもプログラムは動作するはずだからです。
	        もちろん、以下のように新しいライブラリと置き換えても構いません。</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">/compat/linux/lib/libc.so.4.6.29
/compat/linux/lib/libc.so.4 -&gt; libc.so.4.6.29</pre></div></blockquote></div><div class="blockquote"><blockquote class="blockquote"><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">シンボリックリンクのメカニズムは Linux
	      バイナリに<span class="emphasis"><em>のみ</em></span>必要なことに注意してください。
	      FreeBSD のランタイムリンカはメジャーリビジョン番号の一致したライブラリを検索するので、
	      ユーザが気にする必要はありません。</p></div></blockquote></div></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87736912"></a>11.2.2. Linux の ELF バイナリのインストール</h3></div></div></div><a id="idp87737552" class="indexterm"></a><p>ELF のバイナリを使うためには、
	<span class="quote">「<span class="quote">マークをつける (branding)</span>」</span> 作業が必要になります。
	マークのない ELF バイナリを実行しようとすると以下のようなエラーメッセージを受けとってしまうことでしょう。</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>./my-linux-elf-binary</code></strong>
ELF binary type not known
Abort</pre><p>カーネルが FreeBSD の ELF バイナリと Linux のバイナリとを
	見分けられるようにするためには、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>
	ユーティリティを以下のようにして使ってください。</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>brandelf -t Linux my-linux-elf-binary</code></strong></pre><a id="idp87746896" class="indexterm"></a><p>今では GNU のツールたちが
	ELF バイナリに自動的に適切なマークを付加するようになったので、
	今後はこの作業もだんだんと必要なくなってゆくでしょう。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87747920"></a>11.2.3. ホストネームリゾルバの設定</h3></div></div></div><p>DNS がうまく動作しなかったり、
	以下のようなエラーメッセージが表示され
	る場合は、<code class="filename">/compat/linux/etc/host.conf</code>
	ファイルを設定する必要があります。</p><pre class="screen">resolv+: "bind" is an invalid keyword resolv+:
"hosts" is an invalid keyword</pre><p>ファイルの内容を以下のように設定してください。</p><pre class="programlisting">order hosts, bind
multi on</pre><p>ここで、order は <code class="filename">/etc/hosts</code> を最初に検索し、
	次に DNS を検索するように指定します。
	<code class="filename">/compat/linux/etc/host.conf</code>
	がインストールされていない場合、
	Linux アプリケーションは FreeBSD の
	<code class="filename">/etc/host.conf</code> を使用しようとして、
	文法の違いによる警告を出力します。
	<code class="filename">/etc/resolv.conf</code> を利用してネームサーバの設定をしていない場合には、
	<code class="literal">bind</code> を削除してください。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="linuxemu.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="linuxemu.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="linuxemu-mathematicau.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">第11章 Linux バイナリ互換機能〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓11.3. Mathematica のインストール</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>