<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>14.4. ユーザへの制限</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="users.html" title="第14章 ユーザと基本的なアカウントの管理" /><link rel="prev" href="users-modifying.html" title="14.3. アカウント情報の管理" /><link rel="next" href="users-groups.html" title="14.5. グループの管理" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.4. ユーザへの制限</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="users-modifying.html">戻る</a>〓</td><th width="60%" align="center">第14章 ユーザと基本的なアカウントの管理</th><td width="20%" align="right">〓<a accesskey="n" href="users-groups.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="users-limiting"></a>14.4. ユーザへの制限</h2></div></div></div><a id="idp89210192" class="indexterm"></a><a id="idp89210704" class="indexterm"></a><p>FreeBSD は、
      個々のユーザが利用できるシステム資源の量を管理者が制限できる方法をいくつも用意しています。
      その種の制限は、ディスククォータ (quota)
      とその他の資源の制限の 2 つの章で説明します。</p><a id="idp89212368" class="indexterm"></a><a id="idp89212880" class="indexterm"></a><a id="idp89214032" class="indexterm"></a><p>ディスククォータは、ユーザが利用できるディスク容量を制限し、
      その都度計算しなくてもディスク使用量を簡単に確認できる手段も提供しています。
      クォータについては、<a class="xref" href="quotas.html" title="16.12. ファイルシステムクォータ">「ファイルシステムクォータ」</a> で解説しています。</p><p>その他のリソースの制限とは、ユーザが消費できる
      CPU、メモリなどのリソースを制限する手段のことです。
      これはログインクラスを用いて定義されているもので、
      この後で解説しています。</p><a id="idp89215696" class="indexterm"></a><p>ログインクラスは <code class="filename">/etc/login.conf</code>
      で定義します。詳細な説明は
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a> に詳しく記載されています。
      各ユーザアカウントにはログインクラスが割り当てられていて
      (デフォルトでは <code class="literal">default</code> です)、
      それぞれのログインクラスにはログインケーパビリティの集合が割り当てられています。
      ログインケーパビリティとは、
      <code class="literal">名称=値</code>
      の組のことで、<em class="replaceable"><code>名称</code></em>
      は周知の識別子、<em class="replaceable"><code>値</code></em>
      は、<em class="replaceable"><code>名称</code></em> に応じて処理される任意の文字列です。
      ログインクラスとケーパビリティを設定するのはどちらかといえば簡単なことで、
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a> でも説明されています。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD は通常、直接 <code class="filename">/etc/login.conf</code>
	から設定を読み込まず、
	より速く検索できる
	<code class="filename">/etc/login.conf.db</code>
	データベースから読み込みます。<code class="filename">/etc/login.conf</code>
	を編集する時には <code class="filename">/etc/login.conf.db</code>
	を次のコマンドを実行してアップデートする必要があります。</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre></div><p>リソースの制限は、
      2 つの点で標準的なログインケーパビリティと異なっています。
      第一に、どの制限についても、ソフト (現在の)
      リミットとハードリミットがあります。
      ソフトリミットは、ユーザやアプリケーションが調整できますが、
      ハードリミットを超えることはできません。
      ユーザはハードリミットを下げることはできますが、
      上げることはスーパユーザのみができます。
      第二に、ほとんどのリソースの制限は特定のユーザに対してプロセス毎に適用されるもので、
      そのユーザが利用するリソースの総量を制限するものではありません。
      ただし、この違いは制限を特別扱いすることで実現されるものであり、
      ログインケーパビリティフレームワークの実装によるものではありません。</p><p>以下が最もよく使われるリソースの制限になります。
      残りは、他のすべてのログインケーパビリティと並んで
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a> に書かれています。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">coredumpsize</code></span></dt><dd><p>プログラムが生成する core
	    ファイルのサイズ<a id="idp89264080" class="indexterm"></a>にかかる制限は、
	    <code class="literal">filesize</code> やディスククォータなどの、
	    ほかのディスク使用に関する制限<a id="idp89273296" class="indexterm"></a>に従属します。
	    この制限は、ディスク領域の消費を制御するあまり厳しくない手段としてよく使われています。
	    ユーザは core ファイルを自分で生成するわけではなく、
	    削除しないことも多いので、
	    これを設定すれば大きなプログラムが異常終了してもディスクの空きがなくならずに済みます。</p></dd><dt><span class="term"><code class="literal">cputime</code></span></dt><dd><p>そのユーザのプロセスが消費できる CPU 時間<a id="idp89275728" class="indexterm"></a><a id="idp89276112" class="indexterm"></a> の上限です。
	    これを超えたプロセスは、カーネルにより終了されます。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">これは、消費される CPU <span class="emphasis"><em>時間</em></span>
	      についての制限であって、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a> や <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a>
	      のフィールドで表示される
	      CPU の割合に関するものではありません。</p></div></dd><dt><span class="term"><code class="literal">filesize</code></span></dt><dd><p>ユーザが所有できるファイルの大きさ<a id="idp89281360" class="indexterm"></a><a id="idp89281744" class="indexterm"></a>の上限です。<a class="link" href="quotas.html" title="16.12. ファイルシステムクォータ">ディスククォータ</a> と違い、
	    この制限はユーザのファイルをすべてまとめた集合にではなく、
	    個々のファイルにかかります。</p></dd><dt><span class="term"><code class="literal">maxproc</code></span></dt><dd><p>ユーザが実行できるプロセス数の上限<a id="idp89284688" class="indexterm"></a><a id="idp89285072" class="indexterm"></a>です。
	    フォアグラウンドプロセスとバックグラウンドプロセスの両方を扱います。
	    この上限は、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> 変数
	    <code class="varname">kern.maxproc</code>
	    で指定されたシステムの制限を超えることはできません。
	    同時に複数ログインすることや、
	    パイプライン実行することは便利なことが多いので、
	    この値をあまり小さな値に設定すると、
	    そのユーザの生産性が悪化する可能性があります。
	    大きなプログラムをコンパイルする場合のように、
	    タスクによっては複数のプロセスやプリプロセッサが実行されます。</p></dd><dt><span class="term"><code class="literal">memorylocked</code></span></dt><dd><p>これは、1 つのプロセスが <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mlock&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">mlock</span>(2)</span></a>
	    によりメインメモリにロックされることを要求できるメモリ<a id="idp89289552" class="indexterm"></a><a id="idp89289936" class="indexterm"></a>の最大容量です。
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> のようなシステムで重要なプログラムは、
	    メインメモリへロックして、システムがスワップする際に、
	    ディスクのスラッシングを引き起こさないようにします。</p></dd><dt><span class="term"><code class="literal">memoryuse</code></span></dt><dd><p>これは、どの時点かを問わず、
	    あるプロセスが消費できる最大のメモリ容量<a id="idp89293136" class="indexterm"></a><a id="idp89293520" class="indexterm"></a>です。
	    これは、メインメモリとスワップの使用量を合わせたものです。
	    メモリ消費を抑えるための包括的な制限ではありませんが、
	    手始めにはよいでしょう。</p></dd><dt><span class="term"><code class="literal">openfiles</code></span></dt><dd><p>これは、あるプロセスが開いておける最大のファイル数<a id="idp89295952" class="indexterm"></a><a id="idp89296336" class="indexterm"></a>です。
	    FreeBSD では、ファイルはまた、ソケットや
	    IPC チャンネルを表わすのにも使われています。
	    ですから、あまり低い値に設定しないよう注意してください。
	    これに対応するシステム全体の制限は
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	    <code class="varname">kern.maxfiles</code> で定義されています。</p></dd><dt><span class="term"><code class="literal">sbsize</code></span></dt><dd><p>これは、あるユーザが消費できるネットワークメモリ
	    (つまり mbuf<a id="idp89304144" class="indexterm"></a><a id="idp89304528" class="indexterm"></a>) の上限の量です。ユーザは、
	    ネットワーク通信を制限するのに使えます。</p></dd><dt><span class="term"><code class="literal">stacksize</code></span></dt><dd><p>これは、プロセスのスタックサイズ<a id="idp89306960" class="indexterm"></a><a id="idp89307344" class="indexterm"></a>の上限です。
	    あるプログラムが使用しうるメモリの量を制限するには、
	    これだけでは十分ではありません。
	    したがって、他の制限と組み合わせて使わなければなりません。</p></dd></dl></div><p>リソースの制限を設定するにあたり、
      ほかにもいくつか覚えておかなければならないことがあります。
      以下は、一般的なこつやお勧め、さまざまなコメントになります。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>システム起動時に <code class="filename">/etc/rc</code>
	  から起動されたプロセスは、<code class="literal">daemon</code>
	  ログインクラスに割り当てられます。</p></li><li class="listitem"><p>システムに付属していた
	  <code class="filename">/etc/login.conf</code>
	  はほとんどの制限について妥当な値になっていますが、
	  すべてのシステムにおいてふさわしいというわけではありません。
	  制限をあまり緩くするとシステムを悪用しやすくしてしまいますし、
	  厳しくしすぎると生産性を悪化させてしまいます。</p></li><li class="listitem"><p><span class="application">Xorg</span> のユーザには、
	  他のユーザより多くのリソースを与えるべきかもしれません。
	  <span class="application">Xorg</span>
	  そのものが多くのリソースを使うだけでなく、
	  より多くのプログラムを並行して使うことをユーザに促します。</p></li><li class="listitem"><p>多くの制限は個々のプロセスにかかるもので、
	  一人のユーザにまとめてかかるものではありません。
	  例えば、<code class="varname">openfiles</code> を 50 に設定することは、
	  ユーザが動かすそれぞれのプロセスが最大
	  50 個のファイルを開けるということです。
	  あるユーザが開けるファイルの総数は、
	  <code class="literal">openfiles</code> の値に <code class="literal">maxproc</code>
	  をかけたものになります。
	  同じことがメモリ消費量にもあてはまります。</p></li></ul></div><p>リソースの制限と、ログインクラス、
      ログインケーパビリティ一般についての詳しい情報は、
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cap_mkdb&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cap_mkdb</span>(1)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getrlimit&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">getrlimit</span>(2)</span></a> および <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a>
      をご覧ください。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="users-modifying.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="users.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="users-groups.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">14.3. アカウント情報の管理〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓14.5. グループの管理</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>