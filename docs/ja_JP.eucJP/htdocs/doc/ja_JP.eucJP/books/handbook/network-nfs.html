<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>22.6. NFS</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="advanced-networking.html" title="第22章 高度なネットワーク" /><link rel="prev" href="network-bridging.html" title="22.5. ブリッジ" /><link rel="next" href="network-diskless.html" title="22.7. ディスクレス稼働" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">22.6. NFS</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-bridging.html">戻る</a>〓</td><th width="60%" align="center">第22章 高度なネットワーク</th><td width="20%" align="right">〓<a accesskey="n" href="network-diskless.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-nfs"></a>22.6. NFS</h2></div><div><span class="authorgroup">追記と再編成: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Rhodes</span> <span class="firstname">Tom</span> [FAMILY Given]</span>. </span></div><div><span class="authorgroup">原作: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Swingle</span> <span class="firstname">Bill</span> [FAMILY Given]</span>. </span></div></div></div><a id="idp95901648" class="indexterm"></a><p>FreeBSD がサポートしている多くのファイルシステムの中には、
      <acronym class="acronym">NFS</acronym>
      とも呼ばれているネットワークファイルシステムがあります。
      <acronym class="acronym">NFS</acronym> はあるマシンから他のマシンへと、
      ネットワークを通じてディレクトリとファイルを共有することを可能にします。
      <acronym class="acronym">NFS</acronym> を使うことで、
      ユーザやプログラムはリモートシステムのファイルを、
      それがローカルファイルであるかのようにアクセスすることができます。
    </p><p><acronym class="acronym">NFS</acronym>
      が提供可能な最も特筆すべき利点いくつかは以下のものです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>一般的に使われるデータを単一のマシンに納めることができ、
	  ユーザはネットワークを通じてデータにアクセスできるため、
	  ローカルワークステーションが使用するディスク容量が減ります。</p></li><li class="listitem"><p>ネットワーク上のすべてのマシンに、
	  ユーザが別々にホームディレクトリを持つ必要がありません。
	  <acronym class="acronym">NFS</acronym> サーバ上にホームディレクトリが設定されれば、
	  ネットワークのどこからでもアクセス可能です。</p></li><li class="listitem"><p>フロッピーディスクや CDROM ドライブ、
	  ZIP ドライブなどのストレージデバイスを、
	  ネットワーク上の他のマシンで利用することができます。
	  ネットワーク全体のリムーバブルドライブの数を減らせるかもしれません。</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95907408"></a>22.6.1. <acronym class="acronym">NFS</acronym> はどのように動作するのか</h3></div></div></div><p><acronym class="acronym">NFS</acronym> は最低二つの主要な部分、
	サーバと一つ以上のクライアントからなります。
	クライアントはサーバマシン上に格納されたデータにリモートからアクセスします。
	これが適切に機能するには、
	いくつかのプロセスが設定されて実行されていなければなりません。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD 5.X では <code class="command">portmap</code> ユーティリティは
	  <span class="application">rpcbind</span> ユーティリティに置き換わりました。
	  したがって FreeBSD 5.X では、ユーザは下記の例で、
	  <span class="application">portmap</span> の例のすべてを
	  <code class="command">rpcbind</code> に置き換える必要があります。</p></div><p>サーバは以下のデーモンを動作させなければなりません。</p><a id="idp95915600" class="indexterm"></a><a id="idp95916752" class="indexterm"></a><a id="idp95917648" class="indexterm"></a><a id="idp95918544" class="indexterm"></a><div class="informaltable"><table border="0"><colgroup><col /><col /></colgroup><thead><tr><th>デーモン</th><th>説明</th></tr></thead><tbody><tr><td>nfsd</td><td><acronym class="acronym">NFS</acronym>
		クライアントからのリクエストを処理する
		<acronym class="acronym">NFS</acronym> デーモン</td></tr><tr><td>mountd</td><td><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=nfsd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">nfsd</span>(8)</span></a> から渡されたリクエストを実際に実行する
		<acronym class="acronym">NFS</acronym> マウントデーモン</td></tr><tr><td>portmap</td><td><acronym class="acronym">NFS</acronym> サーバの利用しているポートを
		<acronym class="acronym">NFS</acronym>
		クライアントから取得できるようにするためのポートマッパデーモン</td></tr></tbody></table></div><p>クライアント側では <span class="application">nfsiod</span>
	というデーモンも実行できます。
	<span class="application">nfsiod</span> デーモンは <acronym class="acronym">NFS</acronym>
	サーバからのリクエストを処理します。
	これは任意であり、性能を改善しますが、
	通常の正しい動作には必要としません。詳細については <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=nfsiod&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">nfsiod</span>(8)</span></a>
	マニュアルページを参照してください。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-configuring-nfs"></a>22.6.2. <acronym class="acronym">NFS</acronym> の設定</h3></div></div></div><a id="idp95936336" class="indexterm"></a><p><acronym class="acronym">NFS</acronym> の設定は比較的素直な工程です。
	動かさなければならないプロセスは <code class="filename">/etc/rc.conf</code>
	ファイルを少し変更すれば起動時に実行させられます。</p><p><acronym class="acronym">NFS</acronym> サーバでは
	<code class="filename">/etc/rc.conf</code> ファイルの中で、
	以下のオプションが設定されていることを確かめてください。</p><pre class="programlisting">portmap_enable="YES"
nfs_server_enable="YES"
mountd_flags="-r"</pre><p><code class="command">mountd</code> は
	<acronym class="acronym">NFS</acronym> サーバが有効になっていれば、
	自動的に実行されます。</p><p>クライアント側では <code class="filename">/etc/rc.conf</code>
	内に以下の設定があることを確認してください。</p><pre class="programlisting">nfs_client_enable="YES"</pre><p><code class="filename">/etc/exports</code> ファイルは <acronym class="acronym">NFS</acronym>
	サーバがどのファイルシステムをエクスポート
	(ときどき <span class="quote">「<span class="quote">共有</span>」</span> と呼ばれます) するのかを指定します。
	<code class="filename">/etc/exports</code> ファイル中の各行は、
	エクスポートするファイルシステム、
	およびそのファイルシステムにアクセスできるマシンを指定します。
	ファイルシステムにアクセスできるマシンとともに、
	アクセスオプションも指定できます。
	このファイルで指定できるオプションはたくさんありますが、
	ここではほんの少しだけ言及します。<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exports&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">exports</span>(5)</span></a>
	マニュアルページを読めば、
	他のオプションは簡単にみつけられるでしょう。
      </p><p>いくつか <code class="filename">/etc/exports</code> の設定例を示します。</p><a id="idp95949776" class="indexterm"></a><p>以下の例はファイルシステムのエクスポートの考え方を示しますが、
	あなたの環境とネットワーク設定に応じて設定は少し変わるでしょう。
	たとえば次の行は <code class="filename">/cdrom</code>
	ディレクトリを、サーバと同じドメイン名か
	(そのため、いずれもドメイン名がありません)、
	<code class="filename">/etc/hosts</code>
	に記述されている三つの例となるマシンに対してエクスポートします。
	<code class="option">-ro</code>
	フラグは共有されるファイルシステムを読み込み専用にします。
	このフラグにより、
	リモートシステムは共有されたファイルシステムに対して何の変更も行えなくなります。</p><pre class="programlisting">/cdrom -ro host1 host2 host3</pre><p>以下の設定は IP アドレスで指定した 3 つのホストに対して
	<code class="filename">/home</code> をエクスポートします。
	この設定はプライベートネットワークで
	<acronym class="acronym">DNS</acronym> が設定されていない場合に便利でしょう。
	内部のホスト名に対して <code class="filename">/etc/hosts</code>
	を設定するという手段もあります。
	詳細については <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts</span>(5)</span></a> を参照してください。
	<code class="option">-alldirs</code>
	フラグはサブディレクトリがマウントポイントとなることを認めます。
	言い替えると、これはサブディレクトリをマウントしませんが、
	クライアントが要求するか、
	または必要とするディレクトリだけをマウントできるようにします。</p><pre class="programlisting">/home  -alldirs  10.0.0.2 10.0.0.3 10.0.0.4</pre><p>以下の設定は、サーバとは異なるドメイン名の
	2 台のクライアントがアクセスできるように
	<code class="filename">/a</code> をエクスポートします。
	<code class="option">-maproot=root</code> フラグは、リモートシステムの
	<code class="systemitem">root</code> ユーザが、
	エクスポートされたファイルシステムに <code class="systemitem">root</code>
	として書き込むことを許可します。
	<code class="literal">-maproot=root</code> フラグが無ければ、
	リモートマシンの <code class="systemitem">root</code> 権限を持っていても、
	共有されたファイルシステム上のファイルを変更することはできないでしょう。</p><pre class="programlisting">/a  -maproot=root  host.example.com box.example.org</pre><p>クライアントがエクスポートされたファイルシステムにアクセスするためには、
	そうする権限が与えられていなければなりません。
	<code class="filename">/etc/exports</code> ファイルに
	クライアントが含まれているかどうか確認してください。
      </p><p><code class="filename">/etc/exports</code> ファイルでは、
	それぞれの行が一つのファイルシステムを一つのホストにエクスポートすることを表します。
	リモートホストはファイルシステム毎に一度だけ指定することができ、
	それに加えて一つのデフォルトエントリを置けます。たとえば
	<code class="filename">/usr</code> が単一のファイルシステムであると仮定します。
	次の <code class="filename">/etc/exports</code> は無効です。</p><pre class="programlisting">/usr/src   client
/usr/ports client</pre><p>単一のファイルシステムである <code class="filename">/usr</code>
	は、2 行に渡って、同じホスト <code class="systemitem">client</code>
	へエクスポートされています。
	この場合、正しい書式は次のとおりです。</p><pre class="programlisting">/usr/src /usr/ports  client</pre><p>あるホストにエクスポートされるある
	1 つのファイルシステムのプロパティは、
	1 行ですべて指定しなければなりません。
	クライアントの指定のない行は、単一のホストとして扱われます。
	これはファイルシステムをエクスポートできる方法を制限しますが、
	多くの場合これは問題になりません。</p><p>下記は、
	<code class="filename">/usr</code> および <code class="filename">/exports</code>
	がローカルファイルシステムである場合の、
	有効なエクスポートリストの例です。</p><pre class="programlisting"># Export src and ports to client01 and client02, but only
# client01 has root privileges on it
/usr/src /usr/ports -maproot=root    client01
/usr/src /usr/ports               client02
# The client machines have root and can mount anywhere
# on /exports. Anyone in the world can mount /exports/obj read-only
/exports -alldirs -maproot=root      client01 client02
/exports/obj -ro</pre><p>変更が有効となるように、
	<code class="filename">/etc/exports</code> が変更されたら
	<code class="command">mountd</code> を再起動しなければなりません。
	これは <code class="command">mountd</code>
	プロセスに HUP シグナルを送ることで実行できます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP `cat /var/run/mountd.pid`</code></strong></pre><p>他には、再起動すれば、FreeBSD はすべてを適切に設定します。
	しかしながら、再起動は必須ではありません。
	<code class="systemitem">root</code>
	権限で以下のコマンドを実行すれば、すべてが起動するでしょう。</p><p><acronym class="acronym">NFS</acronym> サーバでは</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>portmap</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>nfsd -u -t -n 4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mountd -r</code></strong></pre><p><acronym class="acronym">NFS</acronym> クライアントでは</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>nfsiod -n 4</code></strong></pre><p>これでリモートのファイルシステムを実際にマウントする準備がすべてできました。
	この例では、サーバの名前は <code class="literal">server</code> で、
	クライアントの名前は <code class="literal">client</code> とします。
	リモートファイルシステムを一時的にマウントするだけ、
	もしくは設定をテストするだけなら、クライアント上で
	<code class="systemitem">root</code>
	権限で以下のコマンドを実行するだけです。</p><a id="idp95975760" class="indexterm"></a><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount server:/home /mnt</code></strong></pre><p>これで、サーバの <code class="filename">/home</code>
	ディレクトリが、クライアントの <code class="filename">/mnt</code>
	にマウントされます。もしすべてが正しく設定されていれば、
	クライアントの /mnt に入り、
	サーバにあるファイルすべてを見れるはずです。
      </p><p>リモートファイルシステムを起動のたびに自動的にマウントしたいなら、
	ファイルシステムを <code class="filename">/etc/fstab</code>
	ファイルに追加してください。
	例としてはこのようになります。</p><pre class="programlisting">server:/home	/mnt	nfs	rw	0	0</pre><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a>
	マニュアルページに利用可能なオプションがすべて掲載されています。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp95989584"></a>22.6.3. 実用的な使い方</h3></div></div></div><p><acronym class="acronym">NFS</acronym> には実用的な使用法がいくつもあります。
	ここで典型的な使用法をいくつか紹介しましょう。</p><a id="idp95990864" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>何台ものマシンで CDROM
	    などのメディアを共有するように設定します。
	    これは安上がりで、たいていは、
	    複数のマシンにソフトウェアをインストールするのにより便利な方法です。</p></li><li class="listitem"><p>大規模なネットワークでは、
	    すべてのユーザのホームディレクトリを格納するメイン
	    <acronym class="acronym">NFS</acronym>
	    サーバを構築すると、ずっと便利でしょう。
	    どのワークステーションにログインしても、
	    ユーザがいつでも同じホームディレクトリを利用できるように、
	    これらのホームディレクトリはネットワークに向けてエクスポートされます。</p></li><li class="listitem"><p>何台ものマシンで <code class="filename">/usr/ports/distfiles</code>
	    ディレクトリを共有できます。こうすると、
	    何台ものマシン上に port をインストールする必要がある時に、
	    それぞれのマシンでソースコードをダウンロードすることなく、
	    直ちにソースにアクセスできます。</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-amd"></a>22.6.4. <span class="application">amd</span> による自動マウント</h3></div><div><span class="authorgroup">寄稿: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Stilwell</span> <span class="firstname">Wylie</span> [FAMILY Given]</span>. </span></div><div><span class="authorgroup">再構成: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Lee</span> <span class="firstname">Chern</span> [FAMILY Given]</span>. </span></div></div></div><a id="idp96000208" class="indexterm"></a><a id="idp96000720" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> (自動マウントデーモン) は、
	ファイルシステム内のファイルまたはディレクトリがアクセスされると、
	自動的にリモートファイルシステムをマウントします。
	また、一定の間アクセスされないファイルシステムは
	<span class="application">amd</span>
	によって自動的にアンマウントされます。
	<span class="application">amd</span> を使用することは、通常
	<code class="filename">/etc/fstab</code>
	内に記述する恒久的なマウントに対する、
	単純な代替案となります。</p><p><span class="application">amd</span> はそれ自身を NFS サーバとして
	<code class="filename">/host</code> および <code class="filename">/net</code>
	ディレクトリに結びつけることによって動作します。
	このディレクトリ内のどこかでファイルがアクセスされると、
	<span class="application">amd</span> は対応するリモートマウントを調べて、
	自動的にそれをマウントします。
	<code class="filename">/net</code> が、エクスポートされたファイルシステムを
	IP アドレスで指定してマウントするのに利用される一方で、
	<code class="filename">/host</code>
	は、エクスポートされたファイルシステムをリモートホスト名で指定してマウントするのに利用されます。</p><p><code class="filename">/host/foobar/usr</code>
	内のファイルにアクセスすると、
	<span class="application">amd</span> はホスト
	<code class="systemitem">foobar</code> からエクスポートされた
	<code class="filename">/usr</code> をマウントします。</p><div class="example"><a id="idp96008016"></a><div class="example-title">例22.1 <span class="application">amd</span>
	  によるエクスポートされたファイルシステムのマウント</div><div class="example-contents"><p><code class="command">showmount</code> コマンドを用いて、
	  リモートホストのマウントで利用できるものが見られます。
	  たとえば、<code class="systemitem">foobar</code>
	  と名付けられたホストのマウントを見るために次のように利用できます。</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>showmount -e foobar</code></strong>
Exports list on foobar:
/usr                               10.10.10.0
/a                                 10.10.10.0
<code class="prompt">%</code> <strong class="userinput"><code>cd /host/foobar/usr</code></strong></pre></div></div><br class="example-break" /><p>例のように <code class="command">showmount</code> はエクスポートとして
	<code class="filename">/usr</code> を表示します。
	<code class="filename">/host/foobar/usr</code> にディレクトリを変更すると、
	<span class="application">amd</span> はホスト名 <code class="systemitem">foobar</code>
	を解決し、お望みのエクスポートをマウントしようと試みます。</p><p><span class="application">amd</span> は
	<code class="filename">/etc/rc.conf</code> 内に次の行を記述すれば、
	起動スクリプトによって起動されます。</p><pre class="programlisting">amd_enable="YES"</pre><p>さらに <code class="varname">amd_flags</code> オプションによって
	<span class="application">amd</span>
	にフラグをカスタマイズして渡せます。デフォルトでは
	<code class="varname">amd_flags</code> は次のように設定されています。</p><pre class="programlisting">amd_flags="-a /.amd_mnt -l syslog /host /etc/amd.map /net /etc/amd.map"</pre><p><code class="filename">/etc/amd.map</code> ファイルは、
	エクスポートがマウントされるデフォルトオプションを決定します。
	<code class="filename">/etc/amd.conf</code> ファイルは、
	<span class="application">amd</span>
	のより高度な機能の一部を設定します。</p><p>詳細については <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a> および <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">amd.conf</span>(5)</span></a>
	マニュアルページを参照してください。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-nfs-integration"></a>22.6.5. 他のシステムとの統合についての問題</h3></div><div><span class="authorgroup">寄稿: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Lind</span> <span class="firstname">John</span> [FAMILY Given]</span>. </span></div></div></div><p><span class="emphasis"><em>訳: 渡辺 智雄 <code class="email">&lt;<a xmlns="" class="email" href="mailto:tomo@jp.FreeBSD.org">tomo@jp.FreeBSD.org</a>&gt;</code>. 6 September 1996.</em></span></p><p>ISA バス用のイーサネットアダプタの中には性能が悪いため、
	ネットワーク、特に NFS で深刻な問題がおきるものがあります。
	これは FreeBSD に限ったことではありませんが
	FreeBSD でも起こり得ます。</p><p>この問題は (FreeBSD を使用した) PC
	がシリコングラフィックス社やサン・マイクロシステムズ社などの高性能なワークステーションにネットワーク接続されている場合に頻繁に起こります。
	NFS マウントはうまく動作するでしょう。
	また、いくつかの操作もうまく動作するかもしれませんが、
	他のシステムに対する要求や応答は続いていても、
	突然サーバがクライアントの要求に対して応答しなくなります。これは、
	クライアントが FreeBSD
	か上記のワークステーションであるときにクライアント側に起きる現象です。
	多くのシステムでは、いったんこの問題が現われると、
	行儀良くクライアントを終了する手段はありません。
	NFS がこの状態に陥ってしまうと正常に戻すことはできないため、
	多くの場合クライアントをリセットすることが唯一の解決法となります。</p><p><span class="quote">「<span class="quote">正しい</span>」</span>
	解決法は、より高性能のイーサネットアダプタを
	FreeBSD システムにインストールすることですが、
	満足に動作させる簡単な方法があります。
	FreeBSD システムが <span class="emphasis"><em>サーバ</em></span> になるのなら、
	クライアントからのマウント時に <code class="option">-w=1024</code>
	オプションをつけて下さい。FreeBSD システムが
	<span class="emphasis"><em>クライアント</em></span> になるのなら、
	NFS ファイルシステムを
	<code class="option">-r=1024</code> オプションつきでマウントして下さい。
	これらのオプションは自動的にマウントをおこなう場合には
	クライアントの <code class="filename">fstab</code>
	エントリの 4 番目のフィールドに指定してもよいですし、
	手動マウントの場合は mount コマンドの <code class="option">-o</code>
	パラメータで指定してもよいでしょう。</p><p>NFS サーバとクライアントが別々のネットワーク上にあるような場合、
	これと間違えやすい他の問題が起きることに注意して下さい。
	そのような場合は、ルータが必要な
	UDP 情報をきちんとルーティングしているかを確かめて下さい。
	していなければ、たとえあなたが何をしようと解決できないでしょう。</p><p>次の例では <code class="systemitem">fastws</code>
	は高性能ワークステーションのホスト (インタフェース) 名で、
	<code class="systemitem">freebox</code> は低性能のイーサネットアダプタを備えた
	FreeBSD システムのホスト (インタフェース) 名です。
	また <code class="filename">/sharedfs</code> はエクスポートされる
	NFS ファイルシステムであり (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=exports&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">exports</span>(5)</span></a> を参照) 、
	<code class="filename">/project</code> はエクスポートされたファイルシステムの、
	クライアント上のマウントポイントとなります。
	すべての場合において、アプリケーションによっては
	<code class="option">hard</code> や <code class="option">soft</code>,	<code class="option">bg</code>
	といった追加オプションがふさわしいかもしれないことに注意して下さい。</p><p>クライアント側 FreeBSD システム (<code class="systemitem">freebox</code>)
	の <code class="filename">/etc/fstab</code> の例は以下のとおりです。</p><pre class="programlisting">fastws:/sharedfs /project nfs rw,-r=1024 0 0</pre><p><code class="systemitem">freebox</code> 上で手動で mount
	コマンドを実行する場合は次のようにして下さい。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -t nfs -o -r=1024 fastws:/sharedfs /project</code></strong></pre><p>サーバ側 FreeBSD システム (<code class="systemitem">fastws</code>)
	の <code class="filename">/etc/fstab</code> の例は以下のとおりです。</p><pre class="programlisting">freebox:/sharedfs /project nfs rw,-w=1024 0 0</pre><p><code class="systemitem">fastws</code> 上で手動で mount
	コマンドで実行する場合は次のようにして下さい。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -t nfs -o -w=1024 freebox:/sharedfs /project</code></strong></pre><p>近いうちにどのような
	16 ビットのイーサネットアダプタでも、上記の読み出し、
	書き込みサイズの制限なしで操作できるようになるでしょう。</p><p>失敗が発生したとき何が起きているか関心のある人に、
	なぜ回復不可能なのかも含めて説明します。NFS は通常
	(より小さいサイズへ分割されるかもしれませんが)
	8 K の <span class="quote">「<span class="quote">ブロック</span>」</span> サイズで動作します。
	イーサネットのパケットサイズは最大 1500 バイト程度なので、
	上位階層のコードにとっては 1 つのユニットであって、
	NFS <span class="quote">「<span class="quote">ブロック</span>」</span>
	は複数のイーサネットパケットに分割されるものの、
	上位階層のコードにとっては 1 つのユニットであって、
	ユニットとして受信され、組み立て直され、
	<span class="emphasis"><em>肯定応答</em></span> (ACK) されなければなりません。
	高性能のワークステーションは次々に NFS ユニットを構成するパケットを、
	標準の許す限り間隔を詰めて次々に送り出すことができます。
	小さく、容量の低いカードでは、
	同じユニットの前のパケットがホストに転送される前に、
	後のパケットがそれを踏みつぶしてしまいます。
	このため全体としてのユニットは、再構成も肯定応答もできません。
	その結果、
	ワークステーションはタイムアウトして再送を試みますが、
	8 K のユニット全体を再送しようとするので、
	このプロセスは際限無く繰り返されてしまいます。</p><p>ユニットサイズをイーサネットのパケットサイズの
	制限以下に抑えることにより、
	受信した完全なイーサネットパケットについて個々に肯定応答を返せることが保証されるので、
	デッドロック状態を避けられるようになります。</p><p>それでも、高性能なワークステーションが力任せに次々と
	PC システムにデータを送ったときには踏みつぶしが起きるかもしれません。
	しかし、高性能のカードを使っていれば、NFS <span class="quote">「<span class="quote">ユニット</span>」</span>
	で必ずそのような踏みつぶしが起きるとは限りません。
	踏みつぶしが起きたら、影響を受けたユニットは再送されて、
	受信され、組み立てられ、肯定応答される十分な見込みがあります。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-bridging.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="network-diskless.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">22.5. ブリッジ〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓22.7. ディスクレス稼働</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>