<?xml version="1.0" encoding="euc-jp" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=euc-jp" /><title>8.2. サウンドカードの設定</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD ハンドブック" /><link rel="up" href="multimedia.html" title="第8章 マルチメディア" /><link rel="prev" href="multimedia.html" title="第8章 マルチメディア" /><link rel="next" href="sound-mp3.html" title="8.3. MP3 オーディオ" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">8.2. サウンドカードの設定</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="multimedia.html">戻る</a>〓</td><th width="60%" align="center">第8章 マルチメディア</th><td width="20%" align="right">〓<a accesskey="n" href="sound-mp3.html">次へ</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="sound-setup"></a>8.2. サウンドカードの設定</h2></div><div><span class="authorgroup">寄稿: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Moore</span> <span class="firstname">Moses</span> [FAMILY Given]</span>. </span></div><div><span class="authorgroup">再構成: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Fonvieille</span> <span class="firstname">Marc</span> [FAMILY Given]</span>. </span></div></div></div><a id="idp84990928" class="indexterm"></a><a id="idp84991440" class="indexterm"></a><p>設定をはじめる前に、サウンドカードのモデル、
      そのカードが使用しているチップを確認してください。
      FreeBSD は サウンドカードに幅広く対応しています。
      使用しているカードが対応しているかどうか、
      どの FreeBSD ドライバを使うかについて、
      <a class="link" href="http://www.FreeBSD.org/releases/10.1R/hardware.html" target="_top">ハードウェアノート</a>
      の対応オーディオデバイスの一覧を確認してください。</p><a id="idp84992976" class="indexterm"></a><p>サウンドデバイスを使うためには、
      デバイスドライバを読み込まなければいけません。
      もっとも簡単な方法は <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>
      を使ってサウンドカードのカーネルモジュールを読み込むことです。
      次の例は、Intel
      仕様のビルトインオーディオチップセットのドライバを読み込む例です。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_hda</code></strong></pre><p>このドライバを起動時に読み込むように設定するためには、
      <code class="filename">/boot/loader.conf</code> にドライバを追加してください。
      このドライバの場合は以下の行になります。</p><pre class="programlisting">snd_hda_load="YES"</pre><p>他に利用可能な読み込み可能なサウンドモジュールは
      <code class="filename">/boot/defaults/loader.conf</code>
      に記載されています。
      どのドライバを利用すればいいか確かでなければ、
      <code class="filename">snd_driver</code>
      モジュールを読み込んでください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload snd_driver</code></strong></pre><p><code class="filename">snd_driver</code> モジュールは、
      一般に使用されるカードに対応したドライバをまとめて一度に読み込むメタドライバです。
      このドライバを使用すれば、速やかに正しいドライバを探し出すことができます。
      <code class="filename">/boot/loader.conf</code> ファイルを使用して、
      すべてのサウンドドライバを読み込むこともできます。</p><p><code class="filename">snd_driver</code> メタドライバの読み込み後に、
      どのドライバがサウンドカードに選択されたのかを知るには、
      <code class="command">cat /dev/sndstat</code> と入力してください。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85017936"></a>8.2.1. サウンドに対応したカスタムカーネルを設定する</h3></div></div></div><p>この節は、
	サウンドカードのドライバをカーネルへ静的に組み込もうと考えているユーザ向けです。
	カーネル再構築の詳細は
	<a class="xref" href="kernelconfig.html" title="第9章 FreeBSD カーネルのコンフィグレーション">9章<em>FreeBSD カーネルのコンフィグレーション</em></a> を参照してください。</p><p>サウンドに対応したカスタムカーネルを使うときには、
	オーディオフレームワークドライバをカーネルコンフィグレーションファイルに追加してください。</p><pre class="programlisting">device sound</pre><p>次に、サウンドカードに対応したドライバを追加します。
	前節の Intel 仕様のビルトインオーディオチップセットの例では、
	カスタムカーネルコンフィグレーションファイルに以下の行を追加してください。</p><pre class="programlisting">device snd_hda</pre><p>ドライバのマニュアルページを読んで、
	ドライバが使用するデバイス名を調べてください。</p><p>PnP 非対応の ISA サウンドカードでは、
	IRQ および I/O ポートの設定を
	<code class="filename">/boot/device.hints</code>　
	に指定する必要があるかもしれません。
	システムの起動時に、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>
	はこのファイルを読み、設定情報をカーネルに渡します。
	たとえば、PnP 非対応の古い Creative <span class="trademark">SoundBlaster</span>® 16 (ISA 接続)
	には <code class="literal">snd_sb16</code> とともに
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a> ドライバを使用します。
	このカードを使用する場合には、
	カーネルコンフィグレーションファイルに以下の行を追加してください。</p><pre class="programlisting">device snd_sbc
device snd_sb16</pre><p>もしカードが <code class="literal">0x220</code> I/O port と
	IRQ <code class="literal">5</code> を使用している場合には、
	<code class="filename">/boot/device.hints</code>
	に以下の行を追加してください。</p><pre class="programlisting">hint.sbc.0.at="isa"
hint.sbc.0.port="0x220"
hint.sbc.0.irq="5"
hint.sbc.0.drq="1"
hint.sbc.0.flags="0x15"</pre><p>この例では、
	I/O ポートに <code class="literal">0x220</code> を、
	IRQ に <code class="literal">5</code> を使用します。</p><p><code class="filename">/boot/device.hints</code>
	に用いるべき構文は、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sound&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">sound</span>(4)</span></a> および、
	サウンドカードの各ドライバのマニュアルページに記載されています。</p><p>これまでの設定はデフォルトのものです。
	カードを使用する状況によっては、
	IRQ やその他の設定を変更する必要があるかもしれません。
	このカードについての詳細は、
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snd_sbc&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">snd_sbc</span>(4)</span></a> をご覧ください。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-testing"></a>8.2.2. サウンドのテスト</h3></div></div></div><p>必要となるモジュールを読み込むか、カスタムカーネルで再起動すると、
	サウンドカードが検出されます。
	確認をするには、<code class="command">dmesg | grep pcm</code> と実行してください。
	この例は、ビルトイン Conexant CX20590
	チップセットを搭載したシステムのものです。</p><pre class="screen">pcm0: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; at nid 5 on hdaa0
pcm1: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; at nid 6 on hdaa0
pcm2: &lt;Conexant CX20590 (Analog 2.0+HP/2.0)&gt; at nid 31,25 and 35,27 on hdaa1</pre><p>サウンドカードの状態は、
	以下のコマンドを使用して確認することもできます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat /dev/sndstat</code></strong>
FreeBSD Audio Driver (newpcm: 64bit 2009061500/amd64)
Installed devices:
pcm0: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; (play)
pcm1: &lt;NVIDIA (0x001c) (HDMI/DP 8ch)&gt; (play)
pcm2: &lt;Conexant CX20590 (Analog 2.0+HP/2.0)&gt; (play/rec) default</pre><p>この出力は、サウンドカードによって異なります。
	<code class="filename">pcm</code> デバイスがなければ、
	適切なデバイスドライバが読み込まれているか、
	カーネルに追加されてコンパイルされているかどうかを確認してください。
	次の節では、良くある問題とその解決方法をリストアップしています。</p><p>すべてうまくいけば、サウンドカードが FreeBSD で機能するでしょう。
	<acronym class="acronym">CD</acronym> または <acronym class="acronym">DVD</acronym>
	ドライブのオーディオ出力端子がサウンドカードと適切に接続されていれば、
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cdcontrol&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cdcontrol</span>(1)</span></a> を使ってドライブ内のオーディオ
	<acronym class="acronym">CD</acronym> を再生できます。</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cdcontrol -f /dev/acd0 play 1</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">警告: </h3><p xmlns="http://www.w3.org/1999/xhtml">オーディオ <acronym class="acronym">CD</acronym>
	  は特別なエンコーディングが行われているため、
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> を使ってマウントすべきではありません。</p></div><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/audio/workman/pkg-descr">audio/workman</a> のように、
	よりよいインタフェースを提供するさまざまなアプリケーションがあります。
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/audio/mpg123/pkg-descr">audio/mpg123</a> port
	をインストールして MP3 オーディオファイルを聞くことができます。</p><p>手っ取り早くカードをテストするには、
	<code class="filename">/dev/dsp</code>
	デバイスにデータを送ってみてください。</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cat <em class="replaceable"><code>filename</code></em> &gt; /dev/dsp</code></strong></pre><p>ここで <code class="filename"><em class="replaceable"><code>filename</code></em></code>
	は、どのような形式のファイルでも構いません。
	このコマンドラインを実行すると雑音が発生するはずです。
	これにより、サウンドカードが動作していることを確認できます。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="filename">/dev/dsp*</code> デバイスノードは、
	  必要に応じて自動的に作成されます。
	  デバイスノードが使用されていない場合には存在せず、
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> の出力に表示されません。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="troubleshooting"></a>8.2.3. サウンドカードの問題についてのトラブルシューティング</h3></div></div></div><a id="idp85075920" class="indexterm"></a><a id="idp85076432" class="indexterm"></a><a id="idp85076944" class="indexterm"></a><a id="idp85077456" class="indexterm"></a><p>表 8.1 は、良くあるエラーメッセージとその解決法の一覧です。</p><div class="table"><a id="idp85078352"></a><div class="table-title">表8.1 良くあるエラーメッセージ</div><div class="table-contents"><table summary="良くあるエラーメッセージ" width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>エラー</th><th>解決方法</th></tr></thead><tbody><tr><td><span class="errorname">sb_dspwr(XX) timed
		  out</span></td><td><p>使用する
		I/O ポートが適切に設定されていません。</p></td></tr><tr><td><span class="errorname">bad irq XX</span></td><td><p>使用する IRQ が正しく設定されていません。
		サウンドカードの IRQ と設定した IRQ
		が同じかどうか確かめてください。</p></td></tr><tr><td><span class="errorname">xxx: gus pcm not attached, out of
		  memory</span></td><td><p>デバイスを使用するのに十分なメモリを確保できません。</p></td></tr><tr><td><span class="errorname">xxx: can't open
		  /dev/dsp!</span></td><td><p><code class="command">fstat | grep dsp</code>
		と入力して、
		他のアプリケーションがデバイスを使用しているか調べてください。
		注目すべきトラブルメーカは
		<span class="application">esound</span> と
		<span class="application">KDE</span>
		のサウンド機能です。</p></td></tr></tbody></table></div></div><br class="table-break" /><p>最近のグラフィックカードの中には、
	<acronym class="acronym">HDMI</acronym> を利用するため、
	グラフィックカード自身がサウンドカードを持つものがあります。
	このようなサウンドデバイスには、
	時としてサウンドカードより若い番号が付けられることがあります。
	そのような場合には、
	サウンドカードをデフォルトプレイバックデバイスとして利用できません。
	このことが原因かどうかを確認するには、<span class="application">dmesg</span> を実行して
	<code class="literal">pcm</code> を探してください。
	以下のような出力を得るかもしれません。</p><pre class="programlisting">...
hdac0: HDA Driver Revision: 20100226_0142
hdac1: HDA Driver Revision: 20100226_0142
hdac0: HDA Codec #0: NVidia (Unknown)
hdac0: HDA Codec #1: NVidia (Unknown)
hdac0: HDA Codec #2: NVidia (Unknown)
hdac0: HDA Codec #3: NVidia (Unknown)
pcm0: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 0 nid 1 on hdac0
pcm1: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 1 nid 1 on hdac0
pcm2: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 2 nid 1 on hdac0
pcm3: &lt;HDA NVidia (Unknown) PCM #0 DisplayPort&gt; at cad 3 nid 1 on hdac0
hdac1: HDA Codec #2: Realtek ALC889
pcm4: &lt;HDA Realtek ALC889 PCM #0 Analog&gt; at cad 2 nid 1 on hdac1
pcm5: &lt;HDA Realtek ALC889 PCM #1 Analog&gt; at cad 2 nid 1 on hdac1
pcm6: &lt;HDA Realtek ALC889 PCM #2 Digital&gt; at cad 2 nid 1 on hdac1
pcm7: &lt;HDA Realtek ALC889 PCM #3 Digital&gt; at cad 2 nid 1 on hdac1
...</pre><p>この例では、グラフィックカード (<code class="literal">NVidia</code>)
	には、サウンドカード (<code class="literal">Realtek ALC889</code>)
	より若い番号が付けられています。
	サウンドカードをデフォルトのプレイバックデバイスとして利用するには、
	<code class="literal">hw.snd.default_unit</code>
	をプレイバックで使用するユニット番号に変更してください。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.default_unit=<em class="replaceable"><code>n</code></em></code></strong></pre><p>ここで、<code class="literal">n</code> は使用するサウンドデバイスの番号です。
	この例では <code class="literal">4</code> です。
	<code class="filename">/etc/sysctl.conf</code> に以下の行を入れると、
	設定の変更が常に反映されるようになります。</p><pre class="programlisting">hw.snd.default_unit=<em class="replaceable"><code>4</code></em></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound-multiple-sources"></a>8.2.4. 複数音源の利用</h3></div><div><span class="authorgroup">寄稿: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Chopra</span> <span class="firstname">Munish</span> [FAMILY Given]</span>. </span></div></div></div><p>同時に再生することのできる音源を複数実装していることは、
      多くの場合望ましいことです。
      FreeBSD では、<span class="quote">「<span class="quote">仮想サウンドチャネル</span>」</span>
      を使ってカーネル内でサウンドを合成することにより、
      サウンドカードの再生を多重化することができます。</p><p>仮想チャネルの数を決めるのに三つの <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
      変数を設定できます。</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl dev.pcm.0.play.vchans=4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl dev.pcm.0.rec.vchans=4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl hw.snd.maxautovchans=4</code></strong></pre><p>この例では四つの仮想チャネルを設定しています。
      これは通常利用する上で十分実用的な数です。
      <code class="varname">dev.pcm.0.play.vchans=4</code> と
      <code class="varname">dev.pcm.0.rec.vchans=4</code> は、
      デバイスが取り付けられた後で設定できます。
      これらは <code class="filename">pcm0</code>
      が再生や録音のために持っている仮想チャネルの数です。
      <code class="literal">hw.snd.maxautovchans</code> は、
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kldload&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">kldload</span>(8)</span></a>
      を用いて認識された新しいデバイスの仮想チャネル数です。
      <code class="filename">pcm</code>
      モジュールはハードウェアドライバとは独立して読み込むことができるので、
      <code class="varname">hw.snd.maxautovchans</code>
      は、オーディオデバイスが取り付けられた時に、
      デバイスに与えられる仮想チャネルの数を表しています。
      より詳細な情報については <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> を参照してください。</p><div xmlns="" class="note"><h3 class="admontitle">注記: </h3><p xmlns="http://www.w3.org/1999/xhtml">デバイスを使用しているときに仮想チャンネルの数を変更することはできません。
	まず、ミュージックプレーヤやサウンドデーモンといった
	デバイスを使用しているすべてのプログラムを終了してください。</p></div><p>
      <code class="filename">/dev/dsp0</code>
      を必要とするプログラムが意識しなくても、
      適切な <code class="filename">pcm</code>
      デバイスが自動的に設定されます。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85126352"></a>8.2.5. ミキサチャネルの初期値を設定する</h3></div><div><span class="authorgroup">寄稿: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">El-Rayes</span> <span class="firstname">Josef</span> [FAMILY Given]</span>. </span></div></div></div><p>各ミキサチャネルの初期値は
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> ドライバのソースコードにハードコーディングされています。
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mixer&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mixer</span>(8)</span></a>
      および他のサードパーティ製のアプリケーションやデーモンによって、
      サウンドカードのミキサレベルを変更できますが、
      永続的な解決方法ではありません。
      そのかわり以下の例のように、
      適切な値を <code class="filename">/boot/device.hints</code>
      ファイルに記述することによって、
      ドライバレベルでミキサの初期値を設定することができます。</p><pre class="programlisting">hint.pcm.0.vol="50"</pre><p>この例では、<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pcm&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">pcm</span>(4)</span></a> が読み込まれたと同時に、
      ボリュームチャネルの初期値を <code class="literal">50</code>
      に設定します。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="multimedia.html">戻る</a>〓</td><td width="20%" align="center"><a accesskey="u" href="multimedia.html">上に戻る</a></td><td width="40%" align="right">〓<a accesskey="n" href="sound-mp3.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">第8章 マルチメディア〓</td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top">〓8.3. MP3 オーディオ</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文書、および他の文書は
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    からダウンロードできます。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD に関する質問がある場合には、
    <a href="http://www.FreeBSD.org/ja/docs.html">ドキュメント</a> を読んだ上で
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt; まで (英語で) 連絡してください。<br></br>
    本文書に関する質問については、
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt; まで電子メールを (英語で) 送ってください。</small></p></body></html>