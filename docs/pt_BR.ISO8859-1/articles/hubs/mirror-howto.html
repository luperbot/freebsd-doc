<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>3. Como espelhar o FreeBSD</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Espelhando o FreeBSD" /><link rel="up" href="index.html" title="Espelhando o FreeBSD" /><link rel="prev" href="mirror-requirements.html" title="2. Requisitos para espelhar o FreeBSD" /><link rel="next" href="mirror-where.html" title="4. De onde espelhar" /><link rel="copyright" href="trademarks.html" title="Nota Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. Como espelhar o FreeBSD</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mirror-requirements.html">Anterior</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="mirror-where.html">Próxima</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mirror-howto"></a>3. Como espelhar o FreeBSD</h2></div></div></div><p>Ok, agora você conhece os requisitos e sabe como oferecer
      os serviços, mas não sabe como começar. :-)
      Esta sessão explica como realizar realmente o
      espelhamento de várias partes do FreeBSD, que ferramentas
      utilizar e a partir de onde espelhar.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-ftp"></a>3.1. FTP</h3></div></div></div><p>A área de FTP representa o maior volume de dados a
	serem espelhados.  Ele inclui os <span class="emphasis"><em>conjuntos de
	distribuição</em></span> os quais são
	requeridos para as instalações via rede, os
	ramos (<span class="emphasis"><em>branches</em></span>) do sistema dos quais se
	tira snapshots a partir da árvore de código
	fonte, as <span class="emphasis"><em>imagens ISO</em></span> para gravar CDs de
	instalação do sistema, um sistema de arquivos
	vivo, a árvore do ports, os distifiles (código
	fonte necessários para compilar o ports) e uma
	quantidade enorme de pacotes.  Tudo, é claro, para as
	várias versões do FreeBSD, e para as
	várias arquiteturas.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-ftp-ftp"></a>3.1.1. Espelhando com FTP</h4></div></div></div><p>Você pode utilizar um aplicativo de espelhamento
	  de FTP para obter os arquivos.  Alguns dos mais utilizados
	  são:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/mirror/pkg-descr">ftp/mirror</a></p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/ftpmirror/pkg-descr">ftp/ftpmirror</a></p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/emirror/pkg-descr">ftp/emirror</a></p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/spegla/pkg-descr">ftp/spegla</a></p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/omi/pkg-descr">ftp/omi</a></p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/wget/pkg-descr">ftp/wget</a></p></li></ul></div><p>O <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/mirror/pkg-descr">ftp/mirror</a> era 
	  muito popular, mas parece ter alguns inconvenientes, como
	  ele está escrito em <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=perl&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">perl</span>(1)</span></a> ele possui alguns
	  problemas reais para espelhar grandes diretórios
	  como os de um site espelho do FreeBSD.  Existem rumores de
	  que a versão atual corrigiu isso ao permitir que
	  seja especificado um algoritmo diferente para comparar a
	  estrutura de diretórios.</p><p>Em geral o FTP não é muito bom para 
	  tarefas de espelhamento.  Ele transfere o arquivo inteiro 
	  se o mesmo for alterado, e não cria um fluxo 
	  único de dados do qual ele se beneficiaria no caso 
	  de ocorrer uma grande janela de congestionamento TCP.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-ftp-rsync"></a>3.1.2. Espelhando com o Rsync</h4></div></div></div><p>A melhor forma de espelhar a área FTP é
	  através do uso do <span class="application">rsync</span>.
	  Você pode instalar o port <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/rsync/pkg-descr">net/rsync</a> e então
	  utilizá-lo para sincronizar com o seu servidor de
	  <code class="literal">upstream</code>.  O
	  <span class="application">rsync</span> já foi mencionado na
	  <a class="xref" href="mirror-requirements.html#mirror-serv-rsync" title="2.4.2. Rsync (opcional para o conjunto de arquivos do FTP)">Seção 2.4.2, &#8220;Rsync (opcional para o conjunto de arquivos 
	  do FTP)&#8221;</a>.  Uma vez que a
	  disponibilização de acesso via
	  <span class="application">rsync</span> não é
	  obrigatória, o seu site preferido de
	  <code class="literal">upstream</code> pode não disponibilizá-lo.  
	  Você pode precisar gastar algum tempo procurando até 
	  encontrar um servidor que permita o acesso via
	  <span class="application">rsync</span>.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Uma vez que o número de clientes
	      <span class="application">rsync</span> gera um impacto
	      significativo no servidor, muitos administradores
	      definem limites para o número de acessos
	      simultâneos aos seus servidores.  Você deve
	      consultar o responsável pelo servidor de
	      <code class="literal">upstream</code> que você está
	      utilizando, sobre as regras do servidor, e sobre a
	      possibilidade dele abrir uma exceção para o seu
	      servidor (uma vez que você é um site
	      espelho).</p></div><p>A linha de comando para espelhar o FreeBSD será
	    parecida com esta:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>rsync -vaz --delete ftp4.de.FreeBSD.org::FreeBSD/ /pub/FreeBSD/</code></strong>
          </pre><p>Consulte a documentação do
	    <span class="application">rsync</span>, a qual está
	    disponível em <a class="link" href="http://rsync.samba.org/" target="_top">http://rsync.samba.org/</a>,
	    para conhecer as várias opções que
	    podem ser utilizadas com o
	    <span class="application">rsync</span>.  Se você
	    sincronizar o módulo inteiro (ao contrário
	    de apenas alguns subdiretórios), esteja ciente de
	    que o módulo-diretório (normalmente
	    "FreeBSD") não será criado, de forma que
	    você não deve omitir o diretório alvo.
	    Além disso, você pode desejar criar um script
	    de trabalho para ser executado pelo <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>, para
	    automatizar o processo de espelhamento.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-ftp-cvsup"></a>3.1.3. Espelhando com o CVSup</h4></div></div></div><p>Alguns sites, incluindo o <code class="systemitem">ftp-master.FreeBSD.org</code> 
	  oferecem acesso via <span class="application">CVSup</span> para
	  espelhamento do conteúdo da área de FTP.
	  Você precisa instalar um cliente
	  <span class="application">CVSup</span>, preferencialmente a partir
	  do port <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/cvsup/pkg-descr">net/cvsup</a>.
	  (consulte também a <a class="xref" href="mirror-requirements.html#mirror-serv-cvsup" title="2.4.4. CVSup (desejado para repositórios CVS)">Seção 2.4.4, &#8220;CVSup (desejado para repositórios CVS)&#8221;</a>).  Abaixo você encontra um
	  exemplo de arquivo <code class="filename">supfile</code> pronto para
	  uso com o
	  <code class="systemitem">ftp-master.FreeBSD.org</code>:</p><pre class="programlisting">
          #
          # FreeBSD archive supfile from master server
          #
          *default host=ftp-master.FreeBSD.org
          *default base=/usr
          *default prefix=/pub
          #*default release=all
          *default delete use-rel-suffix
          *default umask=002

          # If your network link is a T1 or faster, comment out the following line.
          #*default compress

          FreeBSD-archive release=all preserve
          </pre><p>Ao que parece o <span class="application">CVSup</span> 
	    seria a melhor opção para espelhar os arquivos em 
	    termos eficiência, mas infelizmente ele só 
	    está disponível em alguns poucos
	    sites.</p><div xmlns="" class="note"><h3 class="admontitle"><a xmlns="http://www.w3.org/1999/xhtml" id="mirror-cvsup-s-option"></a>Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Por favor, consulte a documentação do
	      <span class="application">CVSup</span>, como por exemplo a
	      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cvsup&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cvsup</span>(1)</span></a> e considere o uso da opção
	      <code class="option">-s</code>.  Esta opção reduz as
	      operações de leitura e escrita para o seu
	      disco rígido, assumindo que as
	      informações gravadas sobre cada arquivo
	      estão corretas.</p></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-cvs"></a>3.2. Espelhando o repositório CVS</h3></div></div></div><p>Existem várias formas de se espelhar o
	repositório CVS.  O <span class="application">CVSup</span> 
	é o método mais comum.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-cvs-cvsup"></a>3.2.1. Usando o CVSup</h4></div></div></div><p>O <span class="application">CVSup</span> foi descrito com 
	  algum detalhe na <a class="xref" href="mirror-requirements.html#mirror-serv-cvsup" title="2.4.4. CVSup (desejado para repositórios CVS)">Seção 2.4.4, &#8220;CVSup (desejado para repositórios CVS)&#8221;</a> e na 
	  <a class="xref" href="mirror-howto.html#mirror-ftp-cvsup" title="3.1.3. Espelhando com o CVSup">Seção 3.1.3, &#8220;Espelhando com o CVSup&#8221;</a>.</p><p>É muito fácil configurar um site espelho
	  com o <span class="application">CVSup</span>.  Basta instalar o 
	  port <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/cvsup-mirror/pkg-descr">net/cvsup-mirror</a>
	  para que você tenha todos os programas
	  necessários instalados, e para que todas as 
	  informações necessárias para a
	  configuração do site espelho sejam
	  coletadas.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Por favor não se esqueça de avaliar a
	    sugestão mencionada na <a class="link" href="mirror-howto.html#mirror-cvsup-s-option" title="Nota">nota acima</a></p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-cvs-other"></a>3.2.2. Utilizando outros métodos</h4></div></div></div><p>A utilização de outros métodos que
	  não o <span class="application">CVSup</span> geralmente
	  não é recomendada.  De qualquer forma,
	  nós vamos descrevê-los rapidamente aqui.  Uma
	  vez que a maioria dos sites oferece o repositório
	  CVS como parte da área de FTP, sob o caminho
	  <code class="filename">/pub/FreeBSD/development/FreeBSD-CVS</code>,
	  os seguintes métodos podem ser utilizados:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="application">FTP</span></p></li><li class="listitem"><p><span class="application">Rsync</span></p></li><li class="listitem"><p><span class="application">HTTP</span></p></li></ul></div><div xmlns="" class="important"><h3 class="admontitle">Importante: </h3><p xmlns="http://www.w3.org/1999/xhtml">O <span class="emphasis"><em>AnonCVS</em></span> não pode ser
	      utilizado para espelhar o repositório CVS, uma
	      vez que o CVS não permite que você acesse o
	      próprio repositório em si (arquivos ",v"),
	      permitindo o acesso somente as versões limpas dos
	      módulos.</p></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-www"></a>3.3. Espelhando as páginas WWW</h3></div></div></div><p>A melhor forma é realizar um <span class="quote">&#8220;<span class="quote"><code class="literal">check
	out</code></span>&#8221;</span> da distribuição www do
	servidor de CVS.  Se você tem um mirror local do
	repositório CVS, isto será tão simples
	quanto executar:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs -d /home/ncvs co www</code></strong></pre><p>e agendar uma tarefa no <span class="emphasis"><em>cron</em></span>, 
	que execute periodicamente o comando 
	<code class="command">cvs up -d -P</code>,  imediatamente
	após a execução do processo que atualiza
	o seu repositório.  É claro que os arquivos
	precisam ser colocados em um diretório disponível para
	acesso público via WWW.  A instalação e
	configuração de um servidor web não
	serão abordadas neste artigo.</p><p>Se você não tem um repositório local,
	você pode utilizar o <span class="application">CVSup</span>
	para manter uma <span class="quote">&#8220;<span class="quote">cópia atualizada</span>&#8221;</span> das
	páginas www.  Um supfile de exemplo para esta tarefa
	pode ser encontrado em
	<code class="filename">/usr/share/examples/cvsup/www-supfile</code>, o
	qual irá se parecer com isto:</p><pre class="programlisting">
        #
        # WWW module supfile for FreeBSD
        #
        *default host=cvsup3.de.FreeBSD.org
        *default base=/usr
        *default prefix=/usr/local
        *default release=cvs tag=.
        *default delete use-rel-suffix

        # If your network link is a T1 or faster, comment out the following line.
        *default compress

        # This collection retrieves the www/ tree of the FreeBSD repository
        www
        </pre><p>A utilização do <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/wget/pkg-descr">ftp/wget</a> ou de outras ferramentas
	de espelhamento web (<code class="literal">web-mirror</code>) 
	não é recomendado.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-www-doc"></a>3.3.1. Espelhando a documentação do FreeBSD</h4></div></div></div><p>Uma vez que a documentação é referenciada em diversas 
	 páginas web, é recomendado que você também espelhe a 
	 documentação do FreeBSD.  No entanto, isto não é tão 
	 trivial quanto o espelhamento das páginas www 
	 isoladamente.</p><p>Em primeiro lugar, você deve obter os fontes da
	 documentação, e recomendamos que você faça isso 
	 preferencialmente via <span class="application">CVSup</span>.  
	 Aqui está um exemplo de supfile para esta tarefa:</p><pre class="programlisting">
         #
         # FreeBSD documentation supfile
         #
         *default host=cvsup3.de.FreeBSD.org
         *default base=/usr
         *default prefix=/usr/share
         *default release=cvs tag=.
         *default delete use-rel-suffix

         # If your network link is a T1 or faster, comment out the following line.
         #*default compress

         # This will retrieve the entire doc branch of the FreeBSD repository.
         # This includes the handbook, FAQ, and translations thereof.
         doc-all
         </pre><p>Então você precisará instalar alguns
	 ports.  Mas você está com sorte pois existe um
	 meta-port, o <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/textproc/docproj/pkg-descr">textproc/docproj</a>, para fazer o
	 trabalho por você.  Você precisa configurar
	 algumas variáveis de ambiente, como por exemplo
	 <code class="literal">SGML_CATALOG_FILES</code>.  Também de uma
	 olhada no seu <code class="filename">/etc/make.conf</code>
	 (faça uma cópia do
	 <code class="filename">/usr/share/examples/etc/make.conf</code> se
	 você não possuir um), e verifique a
	 variável <code class="literal">DOC_LANG</code>.  Agora
	 você provavelmente já está pronto para
	 executar o comando <code class="command">make</code> dentro do
	 diretório com os fontes da documentação
	 (<code class="filename">/usr/share/doc</code> por padrão) para
	 construí-la.  De novo, você precisa tornar os arquivos 
	 acessíveis através do seu servidor web, certificando-se de 
	 que os links apontam para o local correto.</p><div xmlns="" class="important"><h3 class="admontitle">Importante: </h3><p xmlns="http://www.w3.org/1999/xhtml">A construção da documentação, assim como as diversas 
	    tarefas associadas ao processo, estão documentadas
	    no <a class="link" href="../../../../doc/en_US.ISO8859-1/books/fdp-primer" target="_top">FreeBSD Documentation
	    Project Primer</a>.  Por favor, leia este documento,
	    especialmente se você está tendo problemas
	    para construir a documentação.</p></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-how-often"></a>3.4. Com que frequência devo espelhar?</h3></div></div></div><p>Todo site espelho deve ser atualizado regularmente.  
       Você certamente irá precisar de alguns scripts 
       para automatizar este processo de atualização 
       com a ajuda do <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>.  Uma vez que praticamente cada
       administrador implementa este procedimento do seu
       próprio jeito, nós não temos como fornecer
       instruções específicas de como proceder.
       O processo poderia ser resumido em:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Coloque o comando para executar a sua
	   aplicação de espelhamento em um script.  O
	   uso de um script simples em <code class="command">/bin/sh</code>
	   é recomendado.</p></li><li class="step"><p>Adicione alguns redirecionamentos para arquivo das
	   mensagens dos programas, de forma que possa usar o mesmo 
	   com a finalidade de diagnóstico de problemas.</p></li><li class="step"><p>Teste se o seu script funciona.  Verifique o arquivo de
	   log.</p></li><li class="step"><p>Utilize o <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">crontab</span>(1)</span></a> para adicionar o script ao
	   <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">crontab</span>(5)</span></a> do usuário apropriado.  O qual deve
	   ser um usuário diferente do usuário sob o
	   qual o servidor de FTP é executado, desta forma
	   não será permitido o acesso via FTP
	   anônimo aos arquivos presentes na área de FTP,
	   os quais não possuam permissões que
	   possibilitem a leitura por todos os demais usuários.
	   Isto é utilizado para a fase de <span class="quote">&#8220;<span class="quote">stage</span>&#8221;</span>
	   das novas distribuições &#8212; garantindo
	   que todos os sites espelhos oficiais possuam todos os
	   arquivos necessários de uma
	   distribuição, no dia em que a mesma é
	   liberada.</p></li></ol></div><p>Aqui estão alguns exemplos da periodicidade
       recomendada para atualização de um site
       espelho:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Conjunto de arquivos do FTP: diária</p></li><li class="listitem"><p>Repositório CVS: horária</p></li><li class="listitem"><p>Páginas WWW: diária</p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mirror-requirements.html">Anterior</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="mirror-where.html">Próxima</a></td></tr><tr><td width="40%" align="left" valign="top">2. Requisitos para espelhar o FreeBSD </td><td width="20%" align="center"><a accesskey="h" href="index.html">Principal</a></td><td width="40%" align="right" valign="top"> 4. De onde espelhar</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Este, e outros documentos, podem ser obtidos em
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Para perguntas sobre FreeBSD, leia a
    <a href="http://www.FreeBSD.org/docs.html">documentação</a> antes de contatar
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Para perguntas sobre esta documentação, envie e-mail para
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>