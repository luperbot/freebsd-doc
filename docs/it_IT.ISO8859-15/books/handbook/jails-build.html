<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>15.4. Creare e Controllare la Jail</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuale di FreeBSD" /><link rel="up" href="jails.html" title="Capitolo 15. Jail" /><link rel="prev" href="jails-intro.html" title="15.3. Introduzione" /><link rel="next" href="jails-tuning.html" title="15.5. Messa a Punto ed Amministrazione" /><link rel="copyright" href="legalnotice.html" title="Nota Legale" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">15.4. Creare e Controllare la Jail</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="jails-intro.html">Indietro</a> </td><th width="60%" align="center">Capitolo 15. Jail</th><td width="20%" align="right"> <a accesskey="n" href="jails-tuning.html">Avanti</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="jails-build"></a>15.4. Creare e Controllare la Jail</h2></div></div></div><p>Alcuni amministratori dividono le jail nei seguenti due tipi:
      jail <span class="quote">«<span class="quote">complete</span>»</span>, che sono simili ad un sistema FreeBSD reale,
      e jail <span class="quote">«<span class="quote">di servizio</span>»</span>, dedicate ad un'unica applicazione
      o servizio, possibilmente in esecuzione con privilegi.  Questa è
      solo una divisione concettuale ed il processo di creazione della
      jail non viene modificato da ciò.  La pagina man <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>
      è abbastanza chiara a riguardo della procedura di creazione di una
      jail:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setenv D /qui/c'e'/la/jail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p $D</code></strong> <a id="jailpath"></a><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make world DESTDIR=$D</code></strong> <a id="jailworld"></a><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd etc/</code></strong> <a href="#ftn.idp84059472" class="footnote" id="idp84059472"><sup class="footnote">[7]</sup></a>
<code class="prompt">#</code> <strong class="userinput"><code>make distribution DESTDIR=$D</code></strong> <a id="jaildistrib"></a><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span>
<code class="prompt">#</code> <strong class="userinput"><code>mount_devfs devfs $D/dev</code></strong> <a id="jaildevfs"></a><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#jailpath"><span><img src="./imagelib/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Selezionare una directory per la jail è
          il miglior punto in cui iniziare.  Questo sarà il punto
          in cui la jail risiederà fisicamente nel file system del
          sistema host.  Una buona scelta può essere
          <code class="filename">/usr/jail/nomejail</code>,
          dove <em class="replaceable"><code>nomejail</code></em> è il nome host
          che identifica la jail.  Il file system
          <code class="filename">/usr/</code> in genere ha abbastanza
          spazio vuoto per il file system delle jail, che per una
          jail <span class="quote">«<span class="quote">completa</span>»</span> è, in pratica, una replica di
          ogni file presente in una installazione base di FreeBSD</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jailworld"><span><img src="./imagelib/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Questo comando popolerà la sotto-directory
          scelta come locazione fisica della jail con
          i binari necessari, le librerie, le pagine man
          e cosí via.  Tutto è fatto nello stile tipico di
          FreeBSD - prima tutto viene creato/compilato, poi installato
          nel percorso di destinazione.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildistrib"><span><img src="./imagelib/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Il target <code class="buildtarget">distribution</code> per
          <span class="application">make</span> installa ogni file di
          configuazione richiesto.  In parole povere, installa ogni
          file di
          <code class="filename">/usr/src/etc/</code> nella
          directory <code class="filename">/etc</code>
          dell'ambiente jail:
          <code class="filename">$D/etc/</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#jaildevfs"><span><img src="./imagelib/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>Non è richiesto di montare il file system <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a>
          all'interno della jail.  D'altro lato, ogni applicazione o quasi ha
          bisogno di accedere ad almeno un dispositivo, a seconda dello scopo
          dell'applicazione stessa.  È molto importante controllare
          l'accesso ai dispositivi dall'interno della jail, dato che con
          dei settaggi impropri un attaccante potrebbe compiere azioni dannose
          nella jail.  Il controllo su <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> è gestito attraverso
          le regole che sono descritte nelle pagine man di <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">devfs</span>(8)</span></a> e
          <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs.conf</span>(5)</span></a>.</p></td></tr></table></div><p>Una volta che una jail è installata, può essere
      avviata usando l'utility <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>.  L'utility <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>
      prende quattro argomenti obbligatori che sono descritti nella
      <a class="xref" href="jails-intro.html#jails-what" title="15.3.1. Cosa è una Jail">Sezione 15.3.1, «Cosa è una Jail»</a>.  Possono essere specificati altri argomenti,
      ad esempio, per eseguire il programma nella jail con le credenziali
      di un utente specifico.  L'argomento
      <code class="option"><em class="replaceable"><code>comando</code></em></code>
      dipende dal tipo di jail; per un <span class="emphasis"><em>sistema virtuale</em></span>,
      <code class="filename">/etc/rc</code> è una buona scelta, dato che
      replicherà la sequenza di avvio di un sistema FreeBSD reale.
      Per una jail <span class="emphasis"><em>di servizio</em></span>, dipenderà
      dal servizio o dalla applicazione che sarà eseguita
      all'interno della jail.</p><p>Le jail spesso sono avviate al momento di boot
      e il meccanismo <code class="filename">rc</code> di FreeBSD fornisce
      un modo semplice per farlo.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Una lista delle jail che sono abilitate al boot
          dovrebbe essere aggiunta al file <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>:</p><pre class="programlisting">jail_enable="YES"   # NO per disabilitare l'avvio delle jail
jail_list="<em class="replaceable"><code>www</code></em>"  # Lista dei nomi delle jail separati da spazi</pre></li><li class="step"><p>Per ogni jail elencata in <code class="varname">jail_list</code>,
          dovrebbe essere aggiunto un gruppo di impostazioni di <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>,
          che descrive la jail:</p><pre class="programlisting">jail_<em class="replaceable"><code>www</code></em>_rootdir="/usr/jail/www"     # directory root della jail
jail_<em class="replaceable"><code>www</code></em>_hostname="<em class="replaceable"><code>www</code></em>.example.org"  # nome-host della jail
jail_<em class="replaceable"><code>www</code></em>_ip="192.168.0.10"           # indirizzo IP della jail
jail_<em class="replaceable"><code>www</code></em>_devfs_enable="YES"          # dispositivi di mount devfs nella jail
jail_<em class="replaceable"><code>www</code></em>_devfs_ruleset="<em class="replaceable"><code>www_ruleset</code></em>" # regole devfs da applicare alla jail</pre><p>L'avvio di default delle jail configurate in
          <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a> eseguirà lo script
          della jail in <code class="filename">/etc/rc</code>, che assume che la
          jail sia un completo sistema virtuale.  Per jail di servizio,
          il comando di default di avvio della jail dovrebbe essere cambiato,
          impostando l'opzione
          <code class="varname">jail_<em class="replaceable"><code>nomejail</code></em>_exec_start</code>
          in modo appropriato.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Per una lista completa delle opzioni disponibili, per favore
            consulta la pagina man <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>.</p></div></li></ol></div><p>Lo script <code class="filename">/etc/rc.d/jail</code> può
      essere usato per avviare o fermare una jail a mano, se esiste una entry
      in <code class="filename">rc.conf</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/jail start www</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/jail stop www</code></strong></pre><p>Un modo pulito per spegnere una <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a> non è disponibile
      al momento.  Questo perchè i comandi usati normalmente per fare
      uno shutdown pulito non possono essere usati all'interno della jail.
      Il modo migliore per spegnere una jail è eseguire il seguente
      comando all'interno della jail stessa o usando l'utility <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jexec&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jexec</span>(8)</span></a>
      da fuori della jail:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh /etc/rc.shutdown</code></strong></pre><p>Maggiori informazioni al riguardo possono essere trovate nella
      pagina man <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>.</p><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp84059472" class="footnote"><p><a href="#idp84059472" class="para"><sup class="para">[7] </sup></a>Questo step non
è richiesto su FreeBSD 6.0 e successivi.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jails-intro.html">Indietro</a> </td><td width="20%" align="center"><a accesskey="u" href="jails.html">Risali</a></td><td width="40%" align="right"> <a accesskey="n" href="jails-tuning.html">Avanti</a></td></tr><tr><td width="40%" align="left" valign="top">15.3. Introduzione </td><td width="20%" align="center"><a accesskey="h" href="index.html">Partenza</a></td><td width="40%" align="right" valign="top"> 15.5. Messa a Punto ed Amministrazione</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Questo, ed altri documenti, possono essere scaricati da
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Per domande su FreeBSD, leggi la
    <a href="http://www.FreeBSD.org/docs.html">documentazione</a> prima di contattare
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Per domande su questa documentazione, invia una e-mail a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>