<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>6.5. 使用 GNU gettext</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter 手册" /><link rel="up" href="special.html" title="第 6 章 特殊情况" /><link rel="prev" href="using-autotools.html" title="6.4. 利用 GNU autotools" /><link rel="next" href="using-perl.html" title="6.6. 使用 perl" /><link rel="copyright" href="trademarks.html" title="法律声明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.5. 使用 GNU <code class="literal">gettext</code></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="using-autotools.html">上一页</a> </td><th width="60%" align="center">第 6 章 特殊情况</th><td width="20%" align="right"> <a accesskey="n" href="using-perl.html">下一页</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-gettext"></a>6.5. 使用 GNU <code class="literal">gettext</code></h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68352592"></a>6.5.1. 基本用法</h3></div></div></div><p>如果您的 port 需要使用 <code class="literal">gettext</code>，
	  只要将 <code class="varname">USE_GETTEXT</code> 设置为 <code class="literal">yes</code>，
	  您的 port 就会增加对 <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/devel/gettext/pkg-descr">devel/gettext</a> 的依赖。
	  <code class="varname">USE_GETTEXT</code> 也可以指定为所需的
	  <code class="literal">libintl</code> 库的版本，
	  它是 <code class="literal">gettext</code> 的基本组成部分，
	  尽管如此， <span class="emphasis"><em>强烈建议您不要</em></span> 使用这个功能：
	  您的 port 应能与目前版本的
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/devel/gettext/pkg-descr">devel/gettext</a> 配合工作。</p><p>在 port 中相当常见的情况下， 会需要同时使用
	  <code class="literal">gettext</code> 和 <code class="command">configure</code>。
	  一般而言， GNU <code class="command">configure</code> 能够自动定位到 <code class="literal">gettext</code>。
	  如果它没有成功地完成这项工作， 则可以通过类似下面这样的
	  <code class="envar">CPPFLAGS</code> 和 <code class="envar">LDFLAGS</code> 将
	  <code class="literal">gettext</code> 的位置告诉它：</p><pre class="programlisting">USE_GETTEXT=    yes
CPPFLAGS+=      -I${LOCALBASE}/include
LDFLAGS+=       -L${LOCALBASE}/lib

GNU_CONFIGURE=  yes
CONFIGURE_ENV=  CPPFLAGS="${CPPFLAGS}" \
                LDFLAGS="${LDFLAGS}"</pre><p>当然， 不需要传参数给 <code class="command">configure</code> 时， 代码可以更为简练：</p><pre class="programlisting">USE_GETTEXT=    yes
GNU_CONFIGURE=  yes
CONFIGURE_ENV=  CPPFLAGS="-I${LOCALBASE}/include" \
                LDFLAGS="-L${LOCALBASE}/lib"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68366032"></a>6.5.2. 可选用法</h3></div></div></div><p>一些软件产品提供了禁用 NLS 的能力，
	  例如， 在 <code class="command">configure</code> 时， 指定
	  <code class="option">--disable-nls</code> 参数。 如果您 port
	  的软件支持这种配置， 则应根据 <a class="link" href="makefile-options.html#knobs-without-nls"><code class="varname">WITHOUT_NLS</code></a>
	  的设置来有条件地使用 <code class="literal">gettext</code>。
	  对于比较简单和不太复杂的 port， 您可以使用下列结构：</p><pre class="programlisting">GNU_CONFIGURE=          yes

.if !defined(WITHOUT_NLS)
USE_GETTEXT=            yes
PLIST_SUB+=             NLS=""
.else
CONFIGURE_ARGS+=        --disable-nls
PLIST_SUB+=             NLS="@comment "
.endif</pre><p>您要做的下一件事是合理地安排装箱单文件，
	  使其根据用户配置来决定是否将消息编录 (message catalog)
	  文件放入最终的装箱单。 前面已经介绍了在 <code class="filename">Makefile</code>
	  中所需的写法， 这种做法在 <a class="link" href="plist.html#plist-sub" title="7.1. 根据 make 变量对 pkg-plist 进行修改">高级
	  <code class="filename">pkg-plist</code> 用法</a> 这节中进行了介绍。
	  简单地说， 在 <code class="filename">pkg-plist</code>
	  中出现的 <code class="literal">%%NLS%%</code> 均会在禁用 NLS 时自动替换为
	  <span class="quote">“<span class="quote"><code class="literal">@comment </code></span>”</span>，
	  反之则替换为空串。 这样， 在最终的装箱单中带 <code class="literal">%%NLS%%</code> 的行，
	  在 NLS 关闭的情况下就会变为注释， 反之， 这些前缀就会自动删掉。
	  现在需要做的事情就是把 <code class="literal">%%NLS%%</code> 插到 <code class="filename">pkg-plist</code>
	  中的消息编录文件的那些行开头， 例如：</p><pre class="programlisting">%%NLS%%share/locale/fr/LC_MESSAGES/foobar.mo
%%NLS%%share/locale/no/LC_MESSAGES/foobar.mo</pre><p>在比较复杂的情形中， 您可能需要使用更高级的技术， 例如 <a class="link" href="plist-dynamic.html" title="7.4. 动态装箱单与静态装箱单的对比">动态生成装箱单</a> 等。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp68383312"></a>6.5.3. 处理消息编录目录</h3></div></div></div><p>在安装消息编录文件时还有一个需要注意的地方。 这些文件会放到
	  <code class="filename">LOCALBASE/share/locale</code>
	  下与语言对应的目录中， 这些目录一般您的 port 不需要创建和删除。
	  最常用的语言的目录已经在 <code class="filename">/etc/mtree/BSD.local.dist</code>
	  中列出； 也就是说， 它们是基本系统的一部分。 其他一些语言的目录， 则由 <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/devel/gettext/pkg-descr">devel/gettext</a> 控制。
	  您最好查看一下 <code class="filename">pkg-plist</code>，
	  以确定是否正在安装某种不常用语言的文件。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="using-autotools.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="special.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="using-perl.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">6.4. 利用 GNU autotools </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 6.6. 使用 <code class="literal">perl</code></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文档和其它文档可从这里下载：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>如果对于FreeBSD有问题，请先阅读
    <a href="http://www.FreeBSD.org/docs.html">文档</a>，如不能解决再联系
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    关于本文档的问题请发信联系
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>