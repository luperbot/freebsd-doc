<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>5.4. 源码包文件</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter 手册" /><link rel="up" href="makefile.html" title="第 5 章 配置 Makefile" /><link rel="prev" href="makefile-categories.html" title="5.3. 分类" /><link rel="next" href="makefile-maintainer.html" title="5.5. MAINTAINER (监护人)" /><link rel="copyright" href="trademarks.html" title="法律声明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.4. 源码包文件</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="makefile-categories.html">上一页</a> </td><th width="60%" align="center">第 5 章 配置 Makefile</th><td width="20%" align="right"> <a accesskey="n" href="makefile-maintainer.html">下一页</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="makefile-distfiles"></a>5.4. 源码包文件</h2></div></div></div><p>在 <code class="filename">Makefile</code> 中的第二部分是描述用于联编 port
	所必需下载的文件， 以及到什么地方去下载它们。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67350096"></a>5.4.1. <code class="varname">DISTVERSION/DISTNAME</code> (源码包版本号/名称)</h3></div></div></div><p><code class="varname">DISTNAME</code> 是作者称呼您所 port 软件的名字。
	  <code class="varname">DISTNAME</code> 的默认值是
	  <code class="literal">${PORTNAME}-${PORTVERSION}</code>，
	  因此只有在需要时才应手工指定。
	  <code class="varname">DISTNAME</code> 只在两个地方用到。 第一处是源码包文件列表
	  (<code class="varname">DISTFILES</code>)， 其默认值是
	  <code class="varname">${DISTNAME}</code><code class="varname">${EXTRACT_SUFX}</code>。
	  第二处是源码包应被展开到的目录名，
	  即 <code class="varname">WRKSRC</code> 所指定的目录，
	  其默认值是 <code class="filename">work/${DISTNAME}</code>。</p><p>某些软件作者发布源码包的时候并不采取
	  <code class="literal">${PORTNAME}-${PORTVERSION}</code> 这样的模式，
	  这可以通过设置 <code class="varname">DISTVERSION</code> 来自动处理。
	  <code class="varname">PORTVERSION</code> 和 <code class="varname">DISTNAME</code>
	  会自动地展开， 当然， 也可以改掉它。 下表给出了一些例子：</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th><code class="varname">DISTVERSION</code></th><th><code class="varname">PORTVERSION</code></th></tr></thead><tbody><tr><td>0.7.1d</td><td>0.7.1.d</td></tr><tr><td>10Alpha3</td><td>10.a3</td></tr><tr><td>3Beta7-pre2</td><td>3.b7.p2</td></tr><tr><td>8:f_17</td><td>8f.17</td></tr></tbody></table></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="varname">PKGNAMEPREFIX</code> 和
	    <code class="varname">PKGNAMESUFFIX</code> 并不影响
	    <code class="varname">DISTNAME</code>。 此外还应注意
	    <code class="varname">WRKSRC</code> 等于
	    <code class="filename">work/${PORTNAME}-${PORTVERSION}</code>，
	    而源代码的压缩包则可能是
	    <code class="varname">${PORTNAME}-${PORTVERSION}${EXTRACT_SUFX}</code>
	    以外的其它名字。 一般情况下应该保持 <code class="varname">DISTNAME</code>
	    不变 ── 更好的方法是定义
	    <code class="varname">DISTFILES</code> 而不是同时设置
	    <code class="varname">DISTNAME</code> 和 <code class="varname">WRKSRC</code>
	    (可能还有 <code class="varname">EXTRACT_SUFX</code>)。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67369808"></a>5.4.2. <code class="varname">MASTER_SITES</code> (主流下载站点)</h3></div></div></div><p>记录 FTP/HTTP-URL 指向 <code class="varname">MASTER_SITES</code>
	  中原始压缩档的目录部分。 不要忘了结尾的斜线
	  (<code class="filename">/</code>)！</p><p><code class="command">make</code> 宏将尝试使用
	  <code class="varname">FETCH</code> 来抓取所指定的源码包文件，
	  如果无法在本地系统中找到这些文件的话。</p><p>建议您指定多个镜像站点， 最好是在不同的大洲上的。
	  这样将有效地防止由于大范围网络问题所导致无法下载的问题。
	  我们甚至打算增加自动检测距离最近的站点并从那里下载的功能；
	  使用多个站点是这样做的重要一步。</p><p>如果原始的源码包可以从比较流行的软件下载站点，
	  例如 SourceForge、 GNU 或是 Perl CPAN 等等来获得，
	  您可能会希望使用类似
	  <code class="varname">MASTER_SITE_<em class="replaceable"><code>*</code></em></code>
	  这样的缩写来表示它们
	  (例如 <code class="varname">MASTER_SITE_SOURCEFORGE</code>、
	  <code class="varname">MASTER_SITE_GNU</code> 以及
	  <code class="varname">MASTER_SITE_PERL_CPAN</code>)。 只需将
	  <code class="varname">MASTER_SITES</code> 设为这些变量， 并使用
	  <code class="varname">MASTER_SITE_SUBDIR</code> 来指定路径就可以了。
	  下面是一个例子：</p><pre class="programlisting">MASTER_SITES=         ${MASTER_SITE_GNU}
MASTER_SITE_SUBDIR=   make</pre><p>此外， 您还可以用更为简略的格式：</p><pre class="programlisting">MASTER_SITES=	GNU/make</pre><p>这些变量是在
	  <code class="filename">/usr/ports/Mk/bsd.sites.mk</code> 中定义的。
	  新项目会随时增加， 因此在您提交 port 之前，
	  应先看一看这个文件的最新版本。</p><p>针对常用软件下载站的许多 <span class="emphasis"><em>暗黑魔法</em></span> 宏，
	  还能够自动判断目录的结构。 对于这些站点，
	  只要使用与之对应的缩写， 系统便会自动为您生成相关的子目录配置。</p><pre class="programlisting">MASTER_SITES=	SF</pre><p>如果系统猜测的路径不对， 则可以使用下面这样的配置来替换。</p><pre class="programlisting">MASTER_SITES=	SF/stardict/WyabdcRealPeopleTTS/${PORTVERSION}</pre><div class="table"><a id="idp67388624"></a><div class="table-title">表 5.1. 常用的魔术 <code class="varname">MASTER_SITES</code> 宏</div><div class="table-contents"><table summary="常用的魔术 MASTER_SITES 宏" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>宏</th><th>自动猜测的子目录</th></tr></thead><tbody><tr><td><code class="varname">APACHE_JAKARTA</code></td><td><code class="varname">/dist/jakarta/${PORTNAME:S,-,,/,}/source</code></td></tr><tr><td><code class="varname">BERLIOS</code></td><td><code class="varname">/${PORTNAME:L}</code></td></tr><tr><td><code class="varname">CHEESESHOP</code></td><td><code class="varname">/packages/source/source/${DISTNAME:C/(.).*/\1/}/${DISTNAME:C/(.*)-[0-9].*/\1/}</code></td></tr><tr><td><code class="varname">DEBIAN</code></td><td><code class="varname">/debian/pool/main/${PORTNAME:C/^((lib)?.).*$/\1/}/${PORTNAME}</code></td></tr><tr><td><code class="varname">GCC</code></td><td><code class="varname">/pub/gcc/releases/${DISTNAME}</code></td></tr><tr><td><code class="varname">GNOME</code></td><td><code class="varname">/pub/GNOME/sources/${PORTNAME}/${PORTVERSION:C/^([0-9]+\.[0-9]+).*/\1/}</code></td></tr><tr><td><code class="varname">GNU</code></td><td><code class="varname">/gnu/${PORTNAME}</code></td></tr><tr><td><code class="varname">MOZDEV</code></td><td><code class="varname">/pub/mozdev/${PORTNAME:L}</code></td></tr><tr><td><code class="varname">PERL_CPAN</code></td><td><code class="varname">/pub/CPAN/modules/by-module/${PORTNAME:C/-.*//}</code></td></tr><tr><td><code class="varname">PYTHON</code></td><td><code class="varname">/ftp/python/${PYTHON_PORTVERSION:C/rc[0-9]//}</code></td></tr><tr><td><code class="varname">RUBYFORGE</code></td><td><code class="varname">/${PORTNAME:L}</code></td></tr><tr><td><code class="varname">SAVANNAH</code></td><td><code class="varname">/${PORTNAME:L}</code></td></tr><tr><td><code class="varname">SF</code></td><td><code class="varname">/project/${PORTNAME:L}/${PORTNAME:L}/${PORTVERSION}</code></td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67415120"></a>5.4.3. <code class="varname">EXTRACT_SUFX</code> (压缩包所用的扩展名)</h3></div></div></div><p>如果您有一个源码包文件，
	  而它使用了某种怪异的扩展名来表达压缩方法， 应设置
	  <code class="varname">EXTRACT_SUFX</code>。</p><p>例如， 如果源码包文件的名字是
	  <code class="filename">foo.tgz</code> 而非更为一般的
	  <code class="filename">foo.tar.gz</code>， 您应写上：</p><pre class="programlisting">DISTNAME=      foo
EXTRACT_SUFX=  .tgz</pre><p><code class="varname">USE_BZIP2</code> 和 <code class="varname">USE_ZIP</code>
	  变量会自动根据需要将 <code class="varname">EXTRACT_SUFX</code> 设置为
	  <code class="literal">.tar.bz2</code> 或 <code class="literal">.zip</code>。
	  如果这两个都没设置， 则 <code class="varname">EXTRACT_SUFX</code> 的
	  默认值将是 <code class="literal">.tar.gz</code>。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">任何时候都不需要同时设置 <code class="varname">EXTRACT_SUFX</code> 和
	    <code class="varname">DISTFILES</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67423184"></a>5.4.4. <code class="varname">DISTFILES</code> (全部源代码包)</h3></div></div></div><p>有些时候所下载的文件名字和 port 的名字没有任何联系。
	  例如， 可能是 <code class="filename">source.tar.gz</code>，
	  或者与此类似的其它名字。 也有一些其它的应用软件，
	  它们的源代码可能被存放到了不同的压缩包中， 而且全都需要下载。</p><p>如果遇到这种情况， 可以将 <code class="varname">DISTFILES</code>
	  设置为以空格分隔的一组需要下载的文件列表。</p><pre class="programlisting">DISTFILES=     source1.tar.gz source2.tar.gz</pre><p>如果没有予以明确的设置， <code class="varname">DISTFILES</code> 的默认值将是
	  <code class="literal">${DISTNAME}${EXTRACT_SUFX}</code>。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67427408"></a>5.4.5. <code class="varname">EXTRACT_ONLY</code> (只解压缩部分源文件)</h3></div></div></div><p>如果只有一部分 <code class="varname">DISTFILES</code> 需要解压缩
	  ── 例如， 其中的一个是源代码， 而其它则是未压缩的文档 ──
	  此时应把那些需要解压缩的文件加到
	  <code class="varname">EXTRACT_ONLY</code> 中。</p><pre class="programlisting">DISTFILES=     source.tar.gz manual.html
EXTRACT_ONLY=  source.tar.gz</pre><p>如果 <code class="varname">DISTFILES</code> 中 <span class="emphasis"><em>没有</em></span>
	  需要解压缩的文件， 则应将 <code class="varname">EXTRACT_ONLY</code> 设为空串。</p><pre class="programlisting">EXTRACT_ONLY=</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="porting-patchfiles"></a>5.4.6. <code class="varname">PATCHFILES</code> (通过下载得到的补丁文件)</h3></div></div></div><p>如果您的 port 需要来自 FTP 或 HTTP 的一些额外的补丁，
	  应将 <code class="varname">PATCHFILES</code> 设置为这些文件的名字，
	  并将 <code class="varname">PATCH_SITES</code> 指向包含这些文件的目录的 URL
	  (格式与 <code class="varname">MASTER_SITES</code> 相同)。</p><p>如果这些补丁， 由于包含了其它的目录名，
	  而导致它们不是相对于源代码目录的顶级目录
	  (也就是 <code class="varname">WRKSRC</code>) 的话，
	  就需要相应地设置 <code class="varname">PATCH_DIST_STRIP</code> 了。
	  例如， 如果补丁中所有的目录名前面都有一个多余的
	  <code class="literal">foozolix-1.0/</code>， 就应设置
	  <code class="literal">PATCH_DIST_STRIP=-p1</code>。</p><p>不需要担心补丁文件本身是否是压缩的； 如果文件名以
	  <code class="filename">.gz</code> or <code class="filename">.Z</code>
	  结尾， 系统会自动解压缩。</p><p>如果补丁是同某些其它文件， 例如文档， 一同以 gzip 压缩的 tar
	  格式发布的， 就不能简单地使用
	  <code class="varname">PATCHFILES</code> 了。 这种情况下，
	  您应将这些补丁包的文件和位置加入到
	  <code class="varname">DISTFILES</code> 和 <code class="varname">MASTER_SITES</code>
	  中。 然后， 用 <code class="varname">EXTRA_PATCHES</code> 变量来指出这些文件，
	  这样 <code class="filename">bsd.port.mk</code> 就会自动地为您应用这些补丁了。
	  需要特别注意的是， <span class="emphasis"><em>不要</em></span> 将补丁文件复制到
	  <code class="varname">PATCHDIR</code> 目录中 ── 这个目录可能是不可写的。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">压缩包会以同源代码一样的方式解压缩， 因此不需要自行完成解压缩操作，
	    并复制补丁文件。 如果您一定要这样做， 就要注意，
	    不要让解压缩出来的文件覆盖先前已经存在的文件。
	    此外， 这么做还需要手工增加命令，
	    以便在 <code class="buildtarget">pre-clean</code> target
	    中删除这些复制出来的文件。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="porting-master-sites-n"></a>5.4.7. 来自不同站点的多个源代码包或补丁文件
	  (<code class="literal">MASTER_SITES:n</code>)</h3></div></div></div><p>(这一节在某种程度上应被视作 <span class="quote">“<span class="quote">进阶话题</span>”</span>；
	  刚开始阅读这份文档的读者可能会希望先跳过这一部分)。</p><p>这一节提供了被称作 <code class="literal">MASTER_SITES:n</code> 和
	  <code class="literal">MASTER_SITES_NN</code> 的下载控制机制。
	  这里我们把它们称为 <code class="literal">MASTER_SITES:n</code>。</p><p>首先给出一些背景。 OpenBSD 在其 <code class="varname">DISTFILES</code> 和
	  <code class="varname">PATCHFILES</code> 变量中提供了一个很棒的功能，
	  即， 允许这些文件和补丁拥有 <code class="literal">:n</code>
	  后缀， 其中 <code class="literal">n</code> 可以使用
	  <code class="literal">[0-9]</code>， 来表达组。 例如：</p><pre class="programlisting">DISTFILES=      alpha:0 beta:1</pre><p>在 OpenBSD 中， 源码包文件 <code class="filename">alpha</code>
	  应被关联到变量
	  <code class="varname">MASTER_SITES0</code> 而不是公共的
	  <code class="varname">MASTER_SITES</code> 变量上； 而
	  <code class="filename">beta</code> 则应关联到
	  <code class="varname">MASTER_SITES1</code> 上。</p><p>这是一个很有意思的功能，
	  它可以避免无休止地搜索正确的下载站点的过程。</p><p>想象 <code class="varname">DISTFILES</code> 中指定了 2 个文件，
	  而 <code class="varname">MASTER_SITES</code> 包含了 20 个站点的情形，
	  这其中许多站点慢如蜗牛， 而 <code class="filename">beta</code> 可以在
	  <code class="varname">MASTER_SITES</code> 的所有站点找到， 而
	  <code class="filename">alpha</code> 只能在第 20 个上面找到。
	  如果监护人了解这一点， 那么检查所有的站点无疑是在浪费时间，
	  不是吗？ 这显然不是开始一个愉快周末的好办法！</p><p>现在您有了一个感性的认识了， 想象一下
	  <code class="varname">DISTFILES</code> 和更多的
	  <code class="varname">MASTER_SITES</code>。 显然， 我们的
	  <span class="quote">“<span class="quote">distfiles 调查员先生</span>”</span>
	  会感谢您减少他浪费在等待下载上所耗费的时间。</p><p>下一节中， 将按照 FreeBSD 对上述想法的实现来加以阐释。
	  我们对 OpenBSD 所提出的概念进行了一些改进。</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67467856"></a>5.4.7.1. 简化信息</h4></div></div></div><p>这一节将介绍如何迅速地对从不同的站点以及子目录下载多个源码包和补丁进行精确的控制。
	    这里， 我们将描述 <code class="literal">MASTER_SITES:n</code> 的一种简化用法。
	    对于多数情况而言这样做是足够的。 然而， 如果您需要更多信息，
	    还需要参考下面的几节。</p><p>一些应用程序需要从多个站点下载不同的源码包。 例如，
	    <span class="application">Ghostscript</span> 包括了程序核心本身，
	    以及大量的驱动文件， 以及则取决于用户的打印机品牌和型号的驱动程序。
	    某些驱动文件已经随程序核心附带， 但也有很多需要从其它站点下载。</p><p>为了适应这种需要， 每一个
	    <code class="varname">DISTFILES</code> 项应跟随一个冒号，
	    以及一个 <span class="quote">“<span class="quote">标签名</span>”</span>。 在
	    <code class="varname">MASTER_SITES</code> 的每个站点也应跟随冒号和标签名，
	    以便指定从哪个网站下载源码包文件。</p><p>例如， 考虑一个将源代码包分为两部分，
	    即 <code class="filename">source1.tar.gz</code>
	    和 <code class="filename">source2.tar.gz</code> 的软件，
	    它必须从两个不同的站点下载。 port 的
	    <code class="filename">Makefile</code> 应包括类似
	    <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-simple-use-one-file-per-site" title="例 5.1. 简化的 MASTER_SITES:n 用法， 每个文件来自一个站点">例 5.1 “简化的 <code class="literal">MASTER_SITES:n</code>
	      用法， 每个文件来自一个站点”</a>
	    的配置。</p><div class="example"><a id="ports-master-sites-n-example-simple-use-one-file-per-site"></a><div class="example-title">例 5.1. 简化的 <code class="literal">MASTER_SITES:n</code>
	      用法， 每个文件来自一个站点</div><div class="example-contents"><pre class="programlisting">MASTER_SITES=   ftp://ftp.example1.com/:source1 \
		ftp://ftp.example2.com/:source2
DISTFILES=      source1.tar.gz:source1 \
		source2.tar.gz:source2</pre></div></div><br class="example-break" /><p>多个源码包可以使用同一个标签。 继续前面的例子，
	    假定增加了第三个源码包， <code class="filename">source3.tar.gz</code>，
	    应从 <code class="systemitem">ftp.example2.com</code> 下载。
	    <code class="filename">Makefile</code> 的这部分应写成
	    <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-simple-use-more-than-one-file-per-site" title="例 5.2. 简化的 MASTER_SITES:n 用法， 其中同一个站点上提供了不止一个文件">例 5.2 “简化的 <code class="literal">MASTER_SITES:n</code> 用法，
	      其中同一个站点上提供了不止一个文件”</a>
	    的样子。</p><div class="example"><a id="ports-master-sites-n-example-simple-use-more-than-one-file-per-site"></a><div class="example-title">例 5.2. 简化的 <code class="literal">MASTER_SITES:n</code> 用法，
	      其中同一个站点上提供了不止一个文件</div><div class="example-contents"><pre class="programlisting">MASTER_SITES=   ftp://ftp.example1.com/:source1 \
		ftp://ftp.example2.com/:source2
DISTFILES=      source1.tar.gz:source1 \
		source2.tar.gz:source2 \
		source3.tar.gz:source2</pre></div></div><br class="example-break" /></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67491536"></a>5.4.7.2. 深入介绍</h4></div></div></div><p>前面的例子无法满足您的需求？ 这一节，
	    我们将详细介绍 <code class="literal">MASTER_SITES:n</code>
	    的精细控制是如何工作的， 以及如何修改您的 port
	    来使用它们。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>元素可以包含
		<code class="literal">:n</code> 这样的后缀， 其中
		<em class="replaceable"><code>n</code></em> 是
		<code class="literal">[^:,]+</code>， 概念上即
		<em class="replaceable"><code>n</code></em> 可以取任意数字或字母，
		但我们目前将其限定为
		<code class="literal">[a-zA-Z_][0-9a-zA-Z_]+</code>。</p><p>此外， 字符串匹配时对大小写是敏感的；
		换言之， <code class="literal">n</code> 与
		<code class="literal">N</code> 不同。</p><p>但是， 由于表达特殊的意义， 下列单词不能用于后缀：
		<code class="literal">default</code>、 <code class="literal">all</code> 和
		<code class="literal">ALL</code> (它们会在 <a class="xref" href="makefile-distfiles.html#porting-master-sites-n-what-changes-in-port-targets">ii</a>
		中介绍的部分用到)。 此外， <code class="literal">DEFAULT</code>
		是一个有特殊用途的词 (请参见 <a class="xref" href="makefile-distfiles.html#porting-master-sites-n-DEFAULT-group">3</a>)。</p></li><li class="listitem"><p>后缀为 <code class="literal">:n</code>
		的项目属于 <code class="literal">n</code> 组， 而
		<code class="literal">:m</code> 属于
		<code class="literal">m</code> 组， 依此类推。</p></li><li class="listitem"><p><a id="porting-master-sites-n-DEFAULT-group"></a>没有后缀的元素是无组的， 也就是它们都属于那个特殊的
		<code class="literal">DEFAULT</code> 组。 给元素加入
		<code class="literal">DEFAULT</code> 后缀通常是多余的，
		除非您有同时属于 <code class="literal">DEFAULT</code> 和其它组的元素
		(参见 <a class="xref" href="makefile-distfiles.html#porting-master-sites-n-comma-operator">5</a>)。</p><p>下面的例子是等价的， 但通常应适用第一个：</p><pre class="programlisting">MASTER_SITES=   alpha

MASTER_SITES=   alpha:DEFAULT</pre></li><li class="listitem"><p>组之间不是互斥的， 同一元素可以同时隶属于多个组，
		而组则可以为空或者有任意多个元素。 同一组中的重复元素，
		并不会被自动消去。</p></li><li class="listitem"><p><a id="porting-master-sites-n-comma-operator"></a>如果希望同一元素同时属于多个组， 可以用逗号
		(<code class="literal">,</code>) 分开。</p><p>这种办法可以避免仅为指定不同的组而多次重复同一元素。 例如
		<code class="literal">:m,n,o</code> 表示这个元素同时属于
		<code class="literal">m</code>、 <code class="literal">n</code> 和 <code class="literal">o</code>
		这三组。</p><p>下面这些写法都是等价的， 但只推荐使用最后一种：</p><pre class="programlisting">MASTER_SITES=   alpha alpha:SOME_SITE

MASTER_SITES=   alpha:DEFAULT alpha:SOME_SITE

MASTER_SITES=   alpha:SOME_SITE,DEFAULT

MASTER_SITES=   alpha:DEFAULT,SOME_SITE</pre></li><li class="listitem"><p>同一组中的所有站点， 会根据
		<code class="varname">MASTER_SORT_AWK</code> 排序。
		在 <code class="varname">MASTER_SITES</code> 和
		<code class="varname">PATCH_SITES</code> 中的组也会进行排序。</p></li><li class="listitem"><p><a id="porting-master-sites-n-group-semantics"></a>在 <code class="varname">MASTER_SITES</code>、
		<code class="varname">PATCH_SITES</code>、
		<code class="varname">MASTER_SITE_SUBDIR</code>、
		<code class="varname">PATCH_SITE_SUBDIR</code>、
		<code class="varname">DISTFILES</code>， 以及
		<code class="varname">PATCHFILES</code> 中， 都可以使用组，
		其语法为：</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>所有 <code class="varname">MASTER_SITES</code>、
		    <code class="varname">PATCH_SITES</code>、
		    <code class="varname">MASTER_SITE_SUBDIR</code> 以及
		    <code class="varname">PATCH_SITE_SUBDIR</code> 的元素， 都必须以
		    <code class="literal">/</code> 字符结尾。 如果有元素属于某些组，
		    则组后缀
		    <code class="literal">:n</code>
		    必须出现在终结符
		    <code class="literal">/</code> 之后。
		    <code class="literal">MASTER_SITES:n</code> 机制依赖于
		    <code class="literal">/</code> 的存在， 以避免在 <code class="literal">:n</code>
		    是元素一部分， 而 <code class="literal">:n</code> 同时又表示组
		    <code class="literal">n</code> 时发生混淆。 为了兼容性的考虑，
		    因为之前 <code class="literal">/</code> 终结符在
		    <code class="varname">MASTER_SITE_SUBDIR</code> 和
		    <code class="varname">PATCH_SITE_SUBDIR</code> 元素中都不是必需的，
		    如果后缀所紧跟的字符不是 <code class="literal">/</code>，
		    则 <code class="literal">:n</code> 将被认为是元素的一部分，
		    而不被当作组后缀， 即使元素拥有 <code class="literal">:n</code>
		    后缀。 请参见 <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-master-site-subdir" title="例 5.3. 在 MASTER_SITE_SUBDIR 中 MASTER_SITES:n 的详细用法">例 5.3 “在 <code class="varname">MASTER_SITE_SUBDIR</code> 中
		      <code class="literal">MASTER_SITES:n</code> 的详细用法”</a>
		    和 <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-complete-example-master-sites" title="例 5.4. 用到逗号分隔符、 多个文件， 多个站点和 不同子目录的 MASTER_SITES:n 详细用法">例 5.4 “用到逗号分隔符、 多个文件， 多个站点和
			不同子目录的 <code class="literal">MASTER_SITES:n</code>
			详细用法”</a>
		    以了解进一步的细节。</p><div class="example"><a id="ports-master-sites-n-example-detailed-use-master-site-subdir"></a><div class="example-title">例 5.3. 在 <code class="varname">MASTER_SITE_SUBDIR</code> 中
		      <code class="literal">MASTER_SITES:n</code> 的详细用法</div><div class="example-contents"><pre class="programlisting">MASTER_SITE_SUBDIR=     old:n new/:NEW</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>组 <code class="literal">DEFAULT</code> 中的目录
			  -&gt; old:n</p></li><li class="listitem"><p>组 <code class="literal">NEW</code> 中的目录
			  -&gt; new</p></li></ul></div></div></div><br class="example-break" /><div class="example"><a id="ports-master-sites-n-example-detailed-use-complete-example-master-sites"></a><div class="example-title">例 5.4. 用到逗号分隔符、 多个文件， 多个站点和
			不同子目录的 <code class="literal">MASTER_SITES:n</code>
			详细用法</div><div class="example-contents"><pre class="programlisting">MASTER_SITES=   http://site1/%SUBDIR%/ http://site2/:DEFAULT \
		http://site3/:group3 http://site4/:group4 \
		http://site5/:group5 http://site6/:group6 \
		http://site7/:DEFAULT,group6 \
		http://site8/%SUBDIR%/:group6,group7 \
		http://site9/:group8
DISTFILES=      file1 file2:DEFAULT file3:group3 \
		file4:group4,group5,group6 file5:grouping \
		file6:group7
MASTER_SITE_SUBDIR=     directory-trial:1 directory-n/:groupn \
			directory-one/:group6,DEFAULT \
			directory</pre><p>前述的例子的结果是下述的对于下载行为的精细控制。
		      站点的列表按照使用的顺序给出。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">file1</code> 将从</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site1/directory-trial:1/</p></li><li class="listitem"><p>http://site1/directory-one/</p></li><li class="listitem"><p>http://site1/directory/</p></li><li class="listitem"><p>http://site2/</p></li><li class="listitem"><p>http://site7/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div><p>下载。</p></li><li class="listitem"><p><code class="filename">file2</code> 将和
			  <code class="filename">file1</code> 以同样的方式下载，
			  因为它们属于同一组</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site1/directory-trial:1/</p></li><li class="listitem"><p>http://site1/directory-one/</p></li><li class="listitem"><p>http://site1/directory/</p></li><li class="listitem"><p>http://site2/</p></li><li class="listitem"><p>http://site7/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div></li><li class="listitem"><p><code class="filename">file3</code> 将从</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site3/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div><p>下载。</p></li><li class="listitem"><p><code class="filename">file4</code> 将从</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site4/</p></li><li class="listitem"><p>http://site5/</p></li><li class="listitem"><p>http://site6/</p></li><li class="listitem"><p>http://site7/</p></li><li class="listitem"><p>http://site8/directory-one/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div><p>下载。</p></li><li class="listitem"><p><code class="filename">file5</code> 将从</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div><p>下载。</p></li><li class="listitem"><p><code class="filename">file6</code> 将从</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code></p></li><li class="listitem"><p>http://site8/</p></li><li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code></p></li></ul></div><p>下载。</p></li></ul></div></div></div><br class="example-break" /></li></ol></div></li><li class="listitem"><p>如何对来自
		<code class="filename">bsd.sites.mk</code> 的特殊变量， 例如
		<code class="varname">MASTER_SITE_SOURCEFORGE</code> 进行分组？</p><p>参见 <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-master-site-sourceforge" title="例 5.5. MASTER_SITE_SOURCEFORGE 中 MASTER_SITES:n 的详细用法">例 5.5 “<code class="varname">MASTER_SITE_SOURCEFORGE</code> 中
		  <code class="literal">MASTER_SITES:n</code> 的详细用法”</a>。</p><div class="example"><a id="ports-master-sites-n-example-detailed-use-master-site-sourceforge"></a><div class="example-title">例 5.5. <code class="varname">MASTER_SITE_SOURCEFORGE</code> 中
		  <code class="literal">MASTER_SITES:n</code> 的详细用法</div><div class="example-contents"><pre class="programlisting">MASTER_SITES=   http://site1/ ${MASTER_SITE_SOURCEFORGE:S/$/:sourceforge,TEST/}
DISTFILES=      something.tar.gz:sourceforge</pre></div></div><br class="example-break" /><p><code class="filename">something.tar.gz</code> 将从所有
		<code class="varname">MASTER_SITE_SOURCEFORGE</code> 中的站点下载。</p></li><li class="listitem"><p>如何与 <code class="varname">PATCH*</code> 变量连用？</p><p>前面的例子介绍的都是
		<code class="varname">MASTER*</code> 变量，
		但对于 <code class="varname">PATCH*</code> 也是完全一样的，
		它们在 <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-patch-sites" title="例 5.6. 简化的 PATCH_SITES 中的 MASTER_SITES:n 用法。">例 5.6 “简化的 <code class="varname">PATCH_SITES</code> 中的
		  <code class="literal">MASTER_SITES:n</code> 用法。”</a>
		有所介绍。</p><div class="example"><a id="ports-master-sites-n-example-detailed-use-patch-sites"></a><div class="example-title">例 5.6. 简化的 <code class="varname">PATCH_SITES</code> 中的
		  <code class="literal">MASTER_SITES:n</code> 用法。</div><div class="example-contents"><pre class="programlisting">PATCH_SITES=    http://site1/ http://site2/:test
PATCHFILES=     patch1:test</pre></div></div><br class="example-break" /></li></ol></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67618640"></a>5.4.7.3. 会改变 ports 的哪些行为？ 哪些不会？</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p>所有普通的 ports 的行为都会保持不变。
		<code class="literal">MASTER_SITES:n</code> 功能的代码，
		只有在某些元素包含了前述， 特别是 <a class="xref" href="makefile-distfiles.html#porting-master-sites-n-group-semantics">7</a>
		中所提及语法的
		<code class="literal">:n</code> 后缀时，
		才会启用。</p></li><li class="listitem"><p><a id="porting-master-sites-n-what-changes-in-port-targets"></a>不受影响的 port target：
		<code class="buildtarget">checksum</code>、
		<code class="buildtarget">makesum</code>、
		<code class="buildtarget">patch</code>、
		<code class="buildtarget">configure</code>、
		<code class="buildtarget">build</code>， 等等。
		显然， <code class="buildtarget">do-fetch</code>、
		<code class="buildtarget">fetch-list</code>、
		<code class="buildtarget">master-sites</code> 和
		<code class="buildtarget">patch-sites</code> 的行为会发生变化。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="buildtarget">do-fetch</code>： 会按照新的、
		    带有组后缀的
		    <code class="varname">DISTFILES</code> 和
		    <code class="varname">PATCHFILES</code> 在
		    <code class="varname">MASTER_SITES</code> 和
		    <code class="varname">PATCH_SITES</code> 所匹配的组元素， 以及
		    <code class="varname">MASTER_SITE_SUBDIR</code> 和
		    <code class="varname">PATCH_SITE_SUBDIR</code> 来进行。
		    请参见 <a class="xref" href="makefile-distfiles.html#ports-master-sites-n-example-detailed-use-complete-example-master-sites" title="例 5.4. 用到逗号分隔符、 多个文件， 多个站点和 不同子目录的 MASTER_SITES:n 详细用法">例 5.4 “用到逗号分隔符、 多个文件， 多个站点和
			不同子目录的 <code class="literal">MASTER_SITES:n</code>
			详细用法”</a>。</p></li><li class="listitem"><p><code class="buildtarget">fetch-list</code>： 和旧式的
		    <code class="buildtarget">fetch-list</code> 类似， 但以同
		    <code class="buildtarget">do-fetch</code> 相似的方式处理组。</p></li><li class="listitem"><p><code class="buildtarget">master-sites</code> 和
		    <code class="buildtarget">patch-sites</code>：
		    (与旧版本不兼容) 仅返回组 <code class="literal">DEFAULT</code>
		    的元素； 事实上， 它们会执行
		    <code class="buildtarget">master-sites-default</code> 和
		    <code class="buildtarget">patch-sites-default</code>
		    这两个 target。</p><p>更进一步， 使用
		    <code class="buildtarget">master-sites-all</code> 或
		    <code class="buildtarget">patch-sites-all</code> 这两个
		    target 之一， 要比直接检查
		    <code class="buildtarget">MASTER_SITES</code> 或
		    <code class="buildtarget">PATCH_SITES</code> 更好。
		    此外， 未来版本可能不再保证直接检查能够正确工作。
		    请参见 <a class="xref" href="makefile-distfiles.html#porting-master-sites-n-new-port-targets-master-sites-all">B</a>
		    以了解关于这些新 target 的更多技术细节。</p></li></ul></div></li><li class="listitem"><p>port 中的新 target</p><div class="orderedlist"><ol class="orderedlist" type="A"><li class="listitem"><p>一系列
		    <code class="buildtarget">master-sites-<em class="replaceable"><code>n</code></em></code>
		    和
		    <code class="buildtarget">patch-sites-<em class="replaceable"><code>n</code></em></code>
		    target 可以分别用来列出 <code class="varname">MASTER_SITES</code> 和
		    <code class="varname">PATCH_SITES</code> 中的 <em class="replaceable"><code>n</code></em>
		    组的内容。 例如，
		    <code class="buildtarget">master-sites-DEFAULT</code> 和
		    <code class="buildtarget">patch-sites-DEFAULT</code> 都会返回
		    <code class="literal">DEFAULT</code> 组的内容， 而
		    <code class="buildtarget">master-sites-test</code> 和
		    <code class="buildtarget">patch-sites-test</code> 则返回
		    <code class="literal">test</code> 组的内容， 等等。</p></li><li class="listitem"><p><a id="porting-master-sites-n-new-port-targets-master-sites-all"></a>新增的
		    <code class="buildtarget">master-sites-all</code> 和
		    <code class="buildtarget">patch-sites-all</code> 这两个 target，
		    会完成先前
		    <code class="buildtarget">master-sites</code> 和
		    <code class="buildtarget">patch-sites</code> 所做的工作。
		    它们会返回所有组的元素， 就像这些元素都属于同一组一样，
		    并且会列出与
		    <code class="varname">MASTER_SITE_BACKUP</code> 或
		    <code class="varname">MASTER_SITE_OVERRIDE</code> 中在
		    <code class="varname">DISTFILES</code> 或
		    <code class="varname">PATCHFILES</code> 中指定的同样多个； 分别对于
		    <code class="buildtarget">master-sites-all</code> 和
		    <code class="buildtarget">patch-sites-all</code>。</p></li></ol></div></li></ol></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67653328"></a>5.4.8. <code class="varname">DIST_SUBDIR</code> (独立的源码包子目录)</h3></div></div></div><p>避免让您的 port 使
	  <code class="filename">/usr/ports/distfiles</code> 陷入混乱。
	  如果您的 port 需要下载很多文件， 或者需要下载可能与其它 port
	  的源文件名冲突的文件 (例如，
	  <code class="filename">Makefile</code>)， 则应将 <code class="varname">DIST_SUBDIR</code>
	  设置为 port 的名字 (通常可以用 <code class="literal">${PORTNAME}</code> 或
	  <code class="literal">${PKGNAMEPREFIX}${PORTNAME}</code>)。 这将把
	  <code class="varname">DISTDIR</code> 从默认的
	  <code class="filename">/usr/ports/distfiles</code> 改为
	  <code class="filename">/usr/ports/distfiles/DIST_SUBDIR</code>，
	  并将与您的 port 有关的文件放到那个目录中。</p><p>此外， 它也会在备份文件主服务器 <code class="filename">ftp.FreeBSD.org</code>
	  上查找同一子目录下的文件 (直接在您的
	  <code class="varname">Makefile</code> 中设置 <code class="varname">DISTDIR</code>
	  则不会有这样的效果， 因此您应使用
	  <code class="varname">DIST_SUBDIR</code>。)</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">这一设置并不影响您在  <code class="filename">Makefile</code>
	    中定义的 <code class="varname">MASTER_SITES</code>。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67665744"></a>5.4.9. <code class="varname">ALWAYS_KEEP_DISTFILES</code> (一直保存源码包)</h3></div></div></div><p>如果您的 port 采用的是预编译的包，
	  但却采用了某种要求源代码必须与预编译版本一同提供的授权，
	  例如 GPL， 则应使用 <code class="varname">ALWAYS_KEEP_DISTFILES</code>
	  来告诉 FreeBSD 联编集群保留一份在 <code class="varname">DISTFILES</code>
	  中文件的副本。 一般来说这些 port 的用户并不需要这些文件，
	  因此， 只在定义了
	  <code class="varname">PACKAGE_BUILDING</code> 符的时候，
	  才将源代码包文件加入 <code class="varname">DISTFILES</code> 是个好主意。
	</p><div class="example"><a id="ports-master-sites-n-example-always-keep-distfiles"></a><div class="example-title">例 5.7. 如何使用 <code class="varname">ALWAYS_KEEP_DISTFILES</code>。</div><div class="example-contents"><pre class="programlisting">.if defined(PACKAGE_BUILDING)
DISTFILES+=             <em class="replaceable"><code>foo.tar.gz</code></em>
ALWAYS_KEEP_DISTFILES=  yes
.endif</pre></div></div><br class="example-break" /><p>当您在 <code class="varname">DISTFILES</code> 加入其它文件时，
	  请务必确保这些文件也出现在了 <code class="filename">distinfo</code> 中。
	  此外， 这些额外的文件通常也会展开到
	  <code class="varname">WRKDIR</code> 中， 对于某些 ports，
	  这可能导致一些不希望的副作用， 因而需要进行特别的处理。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="makefile-categories.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="makefile.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="makefile-maintainer.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">5.3. 分类 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 5.5. <code class="varname">MAINTAINER</code> (监护人)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文档和其它文档可从这里下载：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>如果对于FreeBSD有问题，请先阅读
    <a href="http://www.FreeBSD.org/docs.html">文档</a>，如不能解决再联系
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    关于本文档的问题请发信联系
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>