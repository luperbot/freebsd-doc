<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>6.9. 使用 Qt</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter 手册" /><link rel="up" href="special.html" title="第 6 章 特殊情况" /><link rel="prev" href="using-gnome.html" title="6.8. 使用 GNOME" /><link rel="next" href="using-kde.html" title="6.10. 使用 KDE" /><link rel="copyright" href="trademarks.html" title="法律声明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.9. 使用 Qt</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="using-gnome.html">上一页</a> </td><th width="60%" align="center">第 6 章 特殊情况</th><td width="20%" align="right"> <a accesskey="n" href="using-kde.html">下一页</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-qt"></a>6.9. 使用 Qt</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="qt-common"></a>6.9.1. 在 port 中使用 Qt</h3></div></div></div><div class="table"><a id="idp68533072"></a><div class="table-title">表 6.7. 用于使用 Qt 的 port 的变量</div><div class="table-contents"><table summary="用于使用 Qt 的 port 的变量" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="varname">USE_QT_VER</code></td><td>表示 port 用到了 Qt 工具套件。
		  可用的值包括 <code class="literal">3</code> 和 <code class="literal">4</code>；
		  用于指定使用的 Qt 的主版本。 此外， 系统会自动为 <code class="command">configure</code>
		  脚本和 <code class="command">make</code> 命令提供必要的参数。</td></tr><tr><td><code class="varname">QT_PREFIX</code></td><td>这个变量会自动设为 Qt 的安装路径 (只读变量)。</td></tr><tr><td><code class="varname">MOC</code></td><td>这个变量会自动设为 <code class="command">moc</code> 的路径
		  (只读变量)。 默认值与
		  <code class="varname">USE_QT_VER</code> 变量的值有关。</td></tr><tr><td><code class="varname">QTCPPFLAGS</code></td><td>通过
		  <code class="varname">CONFIGURE_ENV</code> 传给 Qt 工具套件的编译参数。
		  默认配置与
		  <code class="varname">USE_QT_VER</code> 有关。</td></tr><tr><td><code class="varname">QTCFGLIBS</code></td><td>通过
		  <code class="varname">CONFIGURE_ENV</code> 传给 Qt 工具套件的连接库。
		  默认配置与
		  <code class="varname">USE_QT_VER</code> 有关。</td></tr><tr><td><code class="varname">QTNONSTANDARD</code></td><td>禁止系统自动修改
		  <code class="varname">CONFIGURE_ENV</code>、
		  <code class="varname">CONFIGURE_ARGS</code> 和
		  <code class="varname">MAKE_ENV</code>。</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp68556112"></a><div class="table-title">表 6.8. 其他用于使用 Qt 4.x 的变量</div><div class="table-contents"><table summary="其他用于使用 Qt 4.x 的变量" border="0"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="varname">QT_COMPONENTS</code></td><td>用于指定 Qt4 工具和函数库的依赖。
		  详情见后。</td></tr><tr><td><code class="varname">UIC</code></td><td>这个变量会自动设为 <code class="command">uic</code> 的路径 (只读变量)。
		  默认值与
		  <code class="varname">USE_QT_VER</code> 有关。</td></tr><tr><td><code class="varname">QMAKE</code></td><td>这个变量会自动设为 <code class="command">qmake</code> 的路径
		  (只读变量)。 其默认值与
		  <code class="varname">USE_QT_VER</code> 有关。</td></tr><tr><td><code class="varname">QMAKESPEC</code></td><td>这个变量会自动设为
		  <code class="command">qmake</code> 配置文件的路径 (只读变量)。
		  其默认值与 <code class="varname">USE_QT_VER</code>
		  有关。</td></tr></tbody></table></div></div><br class="table-break" /><p>当设置了 <code class="varname">USE_QT_VER</code> 时，
	  系统自动会给 <code class="command">configure</code> 脚本传一系列有用的参数：</p><pre class="programlisting">CONFIGURE_ARGS+= --with-qt-includes=${QT_PREFIX}/include \
                 --with-qt-libraries=${QT_PREFIX}/lib \
                 --with-extra-libs=${LOCALBASE}/lib \
                 --with-extra-includes=${LOCALBASE}/include
CONFIGURE_ENV+=  MOC="${MOC}" CPPFLAGS="${CPPFLAGS} ${QTCPPFLAGS}" LIBS="${QTCFGLIBS}" \
                 QTDIR="${QT_PREFIX}" KDEDIR="${KDE_PREFIX}"</pre><p>如果将 <code class="varname">USE_QT_VER</code> 设为 <code class="literal">4</code>，
	  则还会进行下列配置：</p><pre class="programlisting">CONFIGURE_ENV+= UIC="${UIC}" QMAKE="${QMAKE}" QMAKESPEC="${QMAKESPEC}"
MAKE_ENV+=      QMAKESPEC="${QMAKESPEC}"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="qt4-components"></a>6.9.2. 组件的选择 (仅限 Qt 4.x)</h3></div></div></div><p>当把 <code class="varname">USE_QT_VER</code> 设为 4 时， 就可以通过
	  <code class="varname">QT_COMPONENTS</code> 变量来指定对
	  Qt4 工具和函数库的依赖了。 通过在组件的名称后面添加 <code class="literal">_build</code> 或 <code class="literal">_run</code>
	  这样的后缀， 则可相应地将这依赖关系限于联编或运行时刻。
	  在没有指定后缀时， 系统默认在联编和运行时刻均依赖该组件。
	  通常情况下在指明函数库一类的组件时应不使用后缀，
	  联编工具类组件应使用 <code class="literal">_build</code> 后缀，
	  而插件类组件， 则应使用 <code class="literal">_run</code> 后缀。
	  下表中列出了一些最常用的组件 (全部可用的组件， 则在
	  <code class="filename">/usr/ports/Mk/bsd.qt.mk</code>
	  中的 <code class="varname">_QT_COMPONENTS_ALL</code> 列出)：</p><div class="table"><a id="idp68573136"></a><div class="table-title">表 6.9. 可用的 Qt4 函数库组件</div><div class="table-contents"><table summary="可用的 Qt4 函数库组件" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>名字</th><th>描述</th></tr></thead><tbody><tr><td><code class="literal">corelib</code></td><td>核心库 (在 port 只使用 <code class="literal">corelib</code> 而没有用到其他库时可以省略)</td></tr><tr><td><code class="literal">gui</code></td><td>图形用户界面库</td></tr><tr><td><code class="literal">network</code></td><td>网络函数库</td></tr><tr><td><code class="literal">opengl</code></td><td>OpenGL 函数库</td></tr><tr><td><code class="literal">qt3support</code></td><td>Qt3 兼容支持函数库</td></tr><tr><td><code class="literal">qtestlib</code></td><td>单元测试函数库</td></tr><tr><td><code class="literal">script</code></td><td>脚本函数库</td></tr><tr><td><code class="literal">sql</code></td><td>SQL 函数库</td></tr><tr><td><code class="literal">xml</code></td><td>XML 函数库</td></tr></tbody></table></div></div><br class="table-break" /><p>您可以通过在成功编译之后， 通过在主可执行文件上运行
	  <code class="command">ldd</code> 来确定所需的库。</p><div class="table"><a id="idp68597584"></a><div class="table-title">表 6.10. 可用的 Qt4 工具组件</div><div class="table-contents"><table summary="可用的 Qt4 工具组件" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>名字</th><th>描述</th></tr></thead><tbody><tr><td><code class="literal">moc</code></td><td>元对象编译器 (几乎所有的 Qt 应用程序在联编过程中都需要它)</td></tr><tr><td><code class="literal">qmake</code></td><td>Makefile 生成器 / 联编工具</td></tr><tr><td><code class="literal">rcc</code></td><td>资源编译器 (如果应用程序中包含
		  <code class="filename">*.rc</code> 或 <code class="filename">*.qrc</code>
		  文件， 就需要它)</td></tr><tr><td><code class="literal">uic</code></td><td>用户界面编译器 (如果应用程序中包含使用 Qt Designer
		  创建的 <code class="filename">*.ui</code> 文件时就需要它
		  - 一般说来 Qt 应用程序都会使用 GUI 的)</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="idp68607312"></a><div class="table-title">表 6.11. 可用的 Qt4 插件组件</div><div class="table-contents"><table summary="可用的 Qt4 插件组件" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>名字</th><th>描述</th></tr></thead><tbody><tr><td><code class="literal">iconengines</code></td><td>SVG 图标引擎插件 (如果应用程序使用 SVG 图标)</td></tr><tr><td><code class="literal">imageformats</code></td><td>用于 GIF、 JPEG、 MNG 和
		  SVG 的 imageformat 插件 (如果应用程序使用图片文件)</td></tr></tbody></table></div></div><br class="table-break" /><div class="example"><a id="qt4-components-example"></a><div class="example-title">例 6.3. 选择 Qt4 组件</div><div class="example-contents"><p>在这个例子中， 我们将要移植的应用程序用到了
	    Qt4 图形用户界面函数库、 Qt4 核心 (core) 函数库、
	    所有 Qt4 代码生成工具以及 Qt4 的
	    Makefile 生成器。 由于 gui 函数库会自动附带对核心函数库的依赖，
	    因此并不需要明确指出需要 corelib 的依赖关系。 Qt4 代码生成工具 moc、
	    uic 和 rcc 以及 Makefile 生成器
	    qmake 只在联编过程中才会用到，
	    因此可以指定 <code class="literal">_build</code> 后缀：</p><pre class="programlisting">USE_QT_VER=    4
QT_COMPONENTS= gui moc_build qmake_build rcc_build uic_build</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="qt-additional"></a>6.9.3. 其他考虑</h3></div></div></div><p>如果应用程序没有提供
	  <code class="filename">configure</code> 文件， 而是给了一个 <code class="filename">.pro</code>
	  文件， 则应这样：</p><pre class="programlisting">HAS_CONFIGURE=	yes

do-configure:
        @cd ${WRKSRC} &amp;&amp; ${SETENV} ${CONFIGURE_ENV} \
                ${QMAKE} -unix PREFIX=${PREFIX} texmaker.pro</pre><p>请注意， 这与系统提供的 <code class="filename">BUILD.sh</code>
	  中的 <code class="command">qmake</code> 类似。 传递
	  <code class="varname">CONFIGURE_ENV</code> 能够确保 <code class="command">qmake</code>
	  可以看到 <code class="varname">QMAKESPEC</code> 变量，
	  否则它可能无法正常工作。 <code class="command">qmake</code> 会生成标准的
	  Makefile， 因此无需自行编写
	  <code class="buildtarget">build</code> target。</p><p>Qt 应用程序通常会编写为能够跨平台使用， 通常 X11/Unix 并不是开发它的平台，
	  有时这会导致一些边边角角的问题， 例如：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>缺少必要的 includepaths。</em></span>
	      许多应用程序会使用托盘图标支持， 但忽略了这些头或库文件需要在 X11
	      目录中查找。 您可以通过命令行告诉 <code class="command">qmake</code>
	      将这些头文件和函数库加入到搜索路径中， 例如：</p><pre class="programlisting">${QMAKE} -unix PREFIX=${PREFIX} INCLUDEPATH+=${LOCALBASE}/include \
	LIBS+=-L${LOCALBASE}/lib sillyapp.pro</pre></li><li class="listitem"><p><span class="emphasis"><em>有问题的安装路径。</em></span>
	      有时， 类似图标或 .desktop 文件这样的一些数据， 默认情况下没有安装到
	      XDG-兼容的程序会扫描的路径中。 <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/editors/texmaker/pkg-descr">editors/texmaker</a>
	      就是一个这样的例子 - 请参考这个 port 的 <code class="filename">files</code>
	      目录中的 <code class="filename">patch-texmaker.pro</code>，
	      以了解如何在 Qmake 工程文件中修正这个问题。</p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="using-gnome.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="special.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="using-kde.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">6.8. 使用 GNOME </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 6.10. 使用 KDE</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文档和其它文档可从这里下载：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>如果对于FreeBSD有问题，请先阅读
    <a href="http://www.FreeBSD.org/docs.html">文档</a>，如不能解决再联系
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    关于本文档的问题请发信联系
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>