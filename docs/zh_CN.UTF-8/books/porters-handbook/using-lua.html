<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>6.19. 使用 Lua</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter 手册" /><link rel="up" href="special.html" title="第 6 章 特殊情况" /><link rel="prev" href="using-wx.html" title="6.18. 使用 wxWidgets" /><link rel="next" href="using-xfce.html" title="6.20. 使用 Xfce" /><link rel="copyright" href="trademarks.html" title="法律声明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.19. 使用 <span class="application">Lua</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="using-wx.html">上一页</a> </td><th width="60%" align="center">第 6 章 特殊情况</th><td width="20%" align="right"> <a accesskey="n" href="using-xfce.html">下一页</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-lua"></a>6.19. 使用 <span class="application">Lua</span></h2></div></div></div><p>这一节描述了在 ports 系统中的
	<span class="application">Lua</span> 库的现状， 以及它与 ports 系统的集成。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-introduction"></a>6.19.1. 介绍</h3></div></div></div><p>许多不同版本的 <span class="application">Lua</span>
	  库和相关的解释器之间是相互冲突的 (它们会安装同名的文件)。
	  在 ports 系统中， 这一问题是通过将不同版本的文件以不同的版本号作为后缀名解决的。</p><p>这样做最大的一个问题是， 每个程序都需要进行修改才能找到它所需要的版本。
	  不过， 通过将适当的参数传给编译器和连接器很容易解决这个问题。</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-version"></a>6.19.2. 选择版本</h3></div></div></div><p>要让您的 port 使用指定版本的
	  <span class="application">Lua</span>，
	  可以定义两个变量的值 (如果只定义了其中的一个， 则另一个会使用默认值)：</p><div class="table"><a id="lua-ver-sel-table"></a><div class="table-title">表 6.34. 用于选择 <span class="application">Lua</span>
	    版本的变量</div><div class="table-contents"><table summary="用于选择 Lua&#10;&#9;    版本的变量" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>变量</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><code class="varname">USE_LUA</code></td><td>port 能够使用的 Lua 版本列表</td><td>全部可用版本</td></tr><tr><td><code class="varname">USE_LUA_NOT</code></td><td>与 port 不兼容的版本列表</td><td>无</td></tr></tbody></table></div></div><br class="table-break" /><p>下面是目前 ports 系统提供的可用
	  <span class="application">Lua</span> 版本和对应的目录：</p><div class="table"><a id="idp69258960"></a><div class="table-title">表 6.35. 可用的 <span class="application">Lua</span> 版本</div><div class="table-contents"><table summary="可用的 Lua 版本" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>版本</th><th>Port</th></tr></thead><tbody><tr><td><code class="literal">4.0</code></td><td><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/lang/lua4/pkg-descr">lang/lua4</a></td></tr><tr><td><code class="literal">5.0</code></td><td><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/lang/lua50/pkg-descr">lang/lua50</a></td></tr><tr><td><code class="literal">5.1</code></td><td><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/lang/lua/pkg-descr">lang/lua</a></td></tr></tbody></table></div></div><br class="table-break" /><p>在 <a class="xref" href="using-lua.html#lua-ver-sel-table" title="表 6.34. 用于选择 Lua 版本的变量">表 6.34 “用于选择 <span class="application">Lua</span>
	    版本的变量”</a> 中的变量，
	  可以设置为下面的版本之一， 或用空格分隔的若干版本：</p><div class="table"><a id="idp69275984"></a><div class="table-title">表 6.36. 指定 <span class="application">Lua</span> 版本</div><div class="table-contents"><table summary="指定 Lua 版本" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>说明</th><th>例子</th></tr></thead><tbody><tr><td>一个版本</td><td><code class="literal">4.0</code></td></tr><tr><td>某个版本或更高版本</td><td><code class="literal">5.0+</code></td></tr><tr><td>不高于某个版本</td><td><code class="literal">5.0-</code></td></tr><tr><td>版本范围 (低版本必须在前)</td><td><code class="literal">5.0-5.1</code></td></tr></tbody></table></div></div><br class="table-break" /><p>除此之外， 也有一些用来从可用版本中选择推荐版本的其它变量。 这些变量也可以设置为一组版本，
	  而前面的版本优先级较高。</p><div class="table"><a id="idp69289552"></a><div class="table-title">表 6.37. 用于选择推荐 <span class="application">Lua</span>
	    版本的变量</div><div class="table-contents"><table summary="用于选择推荐 Lua&#10;&#9;    版本的变量" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>变量名</th><th>用于</th></tr></thead><tbody><tr><td><code class="varname">WANT_LUA_VER</code></td><td>port</td></tr><tr><td><code class="varname">WITH_LUA_VER</code></td><td>用户</td></tr></tbody></table></div></div><br class="table-break" /><div class="example"><a id="lua-version-example"></a><div class="example-title">例 6.9. 选择 <span class="application">Lua</span> 版本</div><div class="example-contents"><p>下面是一个用到
	    <span class="application">Lua</span> 版本 <code class="literal">5.0</code> 或
	    <code class="literal">5.1</code>， 并默认使用 <code class="literal">5.0</code>
	    的 port 的片段。 这个默认值可以通过
	    <code class="varname">WITH_LUA_VER</code> 来另外指定。</p><pre class="programlisting">USE_LUA=      5.0-5.1
WANT_LUA_VER= 5.0</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-components"></a>6.19.3. 组件的选择</h3></div></div></div><p>也有一些其它的应用， 尽管本身并不是
	  <span class="application">Lua</span> 库， 但却与它们相关。
	  这些应用可以通过 <code class="varname">LUA_COMPS</code>
	  变量来指定。 可用的组件如下：</p><div class="table"><a id="idp69302224"></a><div class="table-title">表 6.38. 可用的 <span class="application">Lua</span> 组件</div><div class="table-contents"><table summary="可用的 Lua 组件" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名字</th><th>说明</th><th>版本限制</th></tr></thead><tbody><tr><td><code class="literal">lua</code></td><td>主库</td><td>无</td></tr><tr><td><code class="literal">tolua</code></td><td>用于访问 C/C++ 代码的库</td><td><code class="literal">4.0-5.0</code></td></tr><tr><td><code class="literal">ruby</code></td><td>Ruby 绑定</td><td><code class="literal">4.0-5.0</code></td></tr></tbody></table></div></div><br class="table-break" /><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">还有一些其它的组件， 但这些组件是由解释器，
	    而不是由应用程序使用的 (也就是不被其它模块使用)。</p></div><p>每个组件的依赖关系类型可以通过手工添加分隔符为冒号的后缀来指定。
	  如果不指定， 则会采用默认类型 (请参见 <a class="xref" href="using-lua.html#lua-def-dep-types" title="表 6.40. 默认的 Lua 依赖关系类型">表 6.40 “默认的 <span class="application">Lua</span> 依赖关系类型”</a>)。
	  以下是可用的依赖关系类型：</p><div class="table"><a id="idp69329744"></a><div class="table-title">表 6.39. 可用的 <span class="application">Lua</span> 依赖关系类型</div><div class="table-contents"><table summary="可用的 Lua 依赖关系类型" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>名字</th><th>说明</th></tr></thead><tbody><tr><td><code class="literal">build</code></td><td>这个组件是联编过程所必需的， 相当于
		  <code class="varname">BUILD_DEPENDS</code></td></tr><tr><td><code class="literal">run</code></td><td>在运行时需要这个组件， 相当于
		  <code class="varname">RUN_DEPENDS</code></td></tr><tr><td><code class="literal">lib</code></td><td>这个组件在联编和运行时都需要，
		  相当于 <code class="varname">LIB_DEPENDS</code></td></tr></tbody></table></div></div><br class="table-break" /><p>组件的默认依赖关系类型如下：</p><div class="table"><a id="lua-def-dep-types"></a><div class="table-title">表 6.40. 默认的 <span class="application">Lua</span> 依赖关系类型</div><div class="table-contents"><table summary="默认的 Lua 依赖关系类型" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>组件</th><th>依赖关系类型</th></tr></thead><tbody><tr><td><code class="literal">lua</code></td><td>对于 <code class="literal">4.0-5.0</code> 是 <code class="literal">lib</code>
		  (动态连接) 而对于 <code class="literal">5.1</code> 则是
		  <code class="literal">build</code> (静态连接)</td></tr><tr><td><code class="literal">tolua</code></td><td><code class="literal">build</code> (静态连接)</td></tr><tr><td><code class="literal">ruby</code></td><td><code class="literal">lib</code> (动态连接)</td></tr></tbody></table></div></div><br class="table-break" /><div class="example"><a id="lua-components-example"></a><div class="example-title">例 6.10. 选择 <span class="application">Lua</span> 组件</div><div class="example-contents"><p>下面是一个使用了
	    <span class="application">Lua</span> 版本 <code class="literal">4.0</code>
	    及其 <span class="application">Ruby</span> 绑定的 port 片段。</p><pre class="programlisting">USE_LUA=      4.0
LUA_COMPS=    lua ruby</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-version-detection"></a>6.19.4. 检测系统中已安装的版本</h3></div></div></div><p>要检测系统中已安装的版本， 您必须定义
	  <code class="varname">WANT_LUA</code>。 如果没有将其设定为具体的版本，
	  则组件会包含版本后缀。 在检测之后，
	  <code class="varname">HAVE_LUA</code> 变量将设为检测到的版本。</p><div class="example"><a id="lua-ver-det-example"></a><div class="example-title">例 6.11. 检测已安装的 <span class="application">Lua</span> 版本和组件</div><div class="example-contents"><p>下面是一个如果系统中有安装
	    <span class="application">Lua</span> 或选择了选项时使用它的 port 片段。</p><pre class="programlisting">WANT_LUA=       yes

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_LUA5) || ${HAVE_LUA:Mlua-5.[01]} != ""
USE_LUA=        5.0-5.1
CONFIGURE_ARGS+=--enable-lua5
.endif</pre><p>下面的这段 port 在系统中已经有安装， 或用户选择了
	    <span class="application">tolua</span> 和
	    <span class="application">Lua</span> 支持时加以安装， 版本均选择
	    <code class="literal">4.0</code>。</p><pre class="programlisting">USE_LUA=        4.0
LUA_COMPS=      lua
WANT_LUA=       4.0

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_TOLUA) || ${HAVE_LUA:Mtolua} != ""
LUA_COMPS+=     tolua
CONFIGURE_ARGS+=--enable-tolua
.endif</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-defined-variables"></a>6.19.5. 定义的变量</h3></div></div></div><p>在 port 中可以使用下列变量 (在定义了
	  <a class="xref" href="using-lua.html#lua-ver-sel-table" title="表 6.34. 用于选择 Lua 版本的变量">表 6.34 “用于选择 <span class="application">Lua</span>
	    版本的变量”</a> 中至少一个变量之后)。</p><div class="table"><a id="idp69363920"></a><div class="table-title">表 6.41. 为用到
	    <span class="application">Lua</span> 的 port 定义的变量</div><div class="table-contents"><table summary="为用到&#10;&#9;    Lua 的 port 定义的变量" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>变量名</th><th>说明</th></tr></thead><tbody><tr><td><code class="varname">LUA_VER</code></td><td>将要使用的 <span class="application">Lua</span> 版本。
		  (例如， <code class="literal">5.1</code>)</td></tr><tr><td><code class="varname">LUA_VER_SH</code></td><td><span class="application">Lua</span> 动态连接库的主版本
		  (例如， <code class="literal">1</code>)</td></tr><tr><td><code class="varname">LUA_VER_STR</code></td><td>不带点的 <span class="application">Lua</span> 版本
		  (例如， <code class="literal">51</code>)</td></tr><tr><td><code class="varname">LUA_PREFIX</code></td><td>安装 <span class="application">Lua</span> (及其组件) 使用的后缀</td></tr><tr><td><code class="varname">LUA_SUBDIR</code></td><td>在 <code class="filename">${PREFIX}/bin</code>、
		  <code class="filename">${PREFIX}/share</code> 和
		  <code class="filename">${PREFIX}/lib</code> 中用于安装
		  <span class="application">Lua</span> 的子目录</td></tr><tr><td><code class="varname">LUA_INCDIR</code></td><td>用以安装 <span class="application">Lua</span> 和
		  <span class="application">tolua</span> 头文件的目录</td></tr><tr><td><code class="varname">LUA_LIBDIR</code></td><td>用以安装 <span class="application">Lua</span> 和
		  <span class="application">tolua</span> 库文件的目录</td></tr><tr><td><code class="varname">LUA_MODLIBDIR</code></td><td>用以安装 <span class="application">Lua</span>
		  模块动态连接库 (<code class="filename">.so</code>) 的目录</td></tr><tr><td><code class="varname">LUA_MODSHAREDIR</code></td><td>用以安装 <span class="application">Lua</span>
		  模块 (<code class="filename">.lua</code>) 的目录</td></tr><tr><td><code class="varname">LUA_PKGNAMEPREFIX</code></td><td><span class="application">Lua</span> 模块包的后缀名</td></tr><tr><td><code class="varname">LUA_CMD</code></td><td>到 <span class="application">Lua</span>
		  解释器的路径</td></tr><tr><td><code class="varname">LUAC_CMD</code></td><td>到 <span class="application">Lua</span>
		  编译器的路径</td></tr><tr><td><code class="varname">TOLUA_CMD</code></td><td>到 <span class="application">tolua</span>
		  程序的路径</td></tr></tbody></table></div></div><br class="table-break" /><div class="example"><a id="lua-variables-example"></a><div class="example-title">例 6.12. 告诉 port 到什么地方去找
	    <span class="application">Lua</span></div><div class="example-contents"><p>下面的 port 片段展示了如何告诉使用的
	    configure 脚本去什么地方查找 <span class="application">Lua</span>
	    的头文件和库文件。</p><pre class="programlisting">
USE_LUA=        4.0
GNU_CONFIGURE=  yes
CONFIGURE_ENV=  CPPFLAGS="-I${LUA_INCDIR}" LDFLAGS="-L${LUA_LIBDIR}"</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-premk"></a>6.19.6. 在 <code class="filename">bsd.port.pre.mk</code> 时进行处理</h3></div></div></div><p>如果您需要在使用引用 <code class="filename">bsd.port.pre.mk</code> 之后就得到变量，
	  以便将其用于执行一些命令， 需要定义 <code class="varname">LUA_PREMK</code>。</p><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">如果您定义了 <code class="varname">LUA_PREMK</code>， 则在您引用
	    <code class="filename">bsd.port.pre.mk</code> <span class="emphasis"><em>之后</em></span>，
	    即使修改了 <span class="application">Lua</span> port 变量，
	    版本和依赖关系也都不会随之发生变化了。</p></div><div class="example"><a id="lua-premk-example"></a><div class="example-title">例 6.13. 在命令中使用 <span class="application">Lua</span> 变量</div><div class="example-contents"><p>下面的片段展示了如何利用
	    <code class="varname">LUA_PREMK</code>， 并运行
	    <span class="application">Lua</span> 解释器得到完整的版本串，
	    将其赋值给一个变量， 并传递给程序。</p><pre class="programlisting">USE_LUA=        5.0
LUA_PREMK=      yes

.include &lt;bsd.port.pre.mk&gt;

.if exists(${LUA_CMD})
VER_STR!=       ${LUA_CMD} -v

CFLAGS+=        -DLUA_VERSION_STRING="${VER_STR}"
.endif</pre></div></div><br class="example-break" /><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">在 target 中的 <span class="application">Lua</span> 变量可以在命令中安全的使用，
	    而无需使用
	    <code class="varname">LUA_PREMK</code>。</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="using-wx.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="special.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="using-xfce.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">6.18. 使用 <span class="application">wxWidgets</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 6.20. 使用 Xfce</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文档和其它文档可从这里下载：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>如果对于FreeBSD有问题，请先阅读
    <a href="http://www.FreeBSD.org/docs.html">文档</a>，如不能解决再联系
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    关于本文档的问题请发信联系
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>