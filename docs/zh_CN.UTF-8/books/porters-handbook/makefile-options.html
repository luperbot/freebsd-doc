<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>5.11. Makefile 选项</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter 手册" /><link rel="up" href="makefile.html" title="第 5 章 配置 Makefile" /><link rel="prev" href="makefile-info.html" title="5.10. Info 文件" /><link rel="next" href="makefile-wrkdir.html" title="5.12. 指定工作临时目录" /><link rel="copyright" href="trademarks.html" title="法律声明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.11. Makefile 选项</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="makefile-info.html">上一页</a> </td><th width="60%" align="center">第 5 章 配置 Makefile</th><td width="20%" align="right"> <a accesskey="n" href="makefile-wrkdir.html">下一页</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="makefile-options"></a>5.11. Makefile 选项</h2></div></div></div><p>某些大型应用程序可以在联编时使用一系列配置选项，
	用以在系统中已经安装了某些库或应用程序时增加一些功能。
	例如， 选择某种自然 (人类的) 语言， GUI 或命令行界面，
	由于并不是所有的用户都希望使用这些库或者应用程序， port
	系统提供了一组方便的机制， 来让 port 的作者控制联编时的配置。
	支持这些特性可以让用户体验更好， 并达到事半功倍的效果。</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67899600"></a>5.11.1. 开关 (Knobs)</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67908560"></a>5.11.1.1. <code class="varname">WITH_<em class="replaceable"><code>*</code></em></code> 和
	    <code class="varname">WITHOUT_<em class="replaceable"><code>*</code></em></code></h4></div></div></div><p>这些变量是为系统管理员准备的。 许多这样的变量被标准化并置于
	    <a class="link" href="http://www.freebsd.org/cgi/cvsweb.cgi/ports/KNOBS?rev=HEAD&amp;content-type=text/x-cvsweb-markup" target="_top"><code class="filename">ports/KNOBS</code></a>
	    文件。</p><p>在创建一个 port 的时候，不要使用某个应用程序专有的 knob
            名称，比如对于 Avahi 这个 port，应该用
	    <code class="varname">WITHOUT_MDNS</code> 而不是
	    <code class="varname">WITHOUT_AVAHI_MDNS</code>。</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">您不应假定每一个
	      <code class="varname">WITH_<em class="replaceable"><code>*</code></em></code>
	      都会有对应的
	      <code class="varname">WITHOUT_<em class="replaceable"><code>*</code></em></code>
	      变量， 反之亦然。 一般而言， 会使用默认值。</p></div><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">除非另有说明， 这些变量都是测试是否定义，
	      而不是它们设置了 <code class="literal">YES</code> 或
	      <code class="literal">NO</code>。</p></div><div class="table"><a id="idp67915984"></a><div class="table-title">表 5.3. 常见的 <code class="varname">WITH_<em class="replaceable"><code>*</code></em></code>
	      和 <code class="varname">WITHOUT_<em class="replaceable"><code>*</code></em></code>
	      变量</div><div class="table-contents"><table summary="常见的 WITH_*&#10;&#9;      和 WITHOUT_*&#10;&#9;      变量" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>变量</th><th>意义</th></tr></thead><tbody><tr><td><a id="knobs-without-nls"></a><code class="varname">WITHOUT_NLS</code></td><td>表示不需要国际化支持， 这可以节省编译所消耗的时间。
		    默认情况下， 会启用国际化支持。</td></tr><tr><td><code class="varname">WITH_OPENSSL_BASE</code></td><td>使用基本系统中的 OpenSSL 版本。</td></tr><tr><td><code class="varname">WITH_OPENSSL_PORT</code></td><td>从 <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/openssl/pkg-descr">security/openssl</a>
                    安装 OpenSSL，即使基本系统中的版本是最新的。</td></tr><tr><td><code class="varname">WITHOUT_X11</code></td><td>如果 port 能够在是否包含
		    X 支持的情况下分别联编， 则一般情况应该默认以包含
		    X 支持的配置来联编。 如果定义了这一变量，
		    则应联编不包含 X 支持的版本。</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67934800"></a>5.11.1.2. 开关 (knob) 的命名</h4></div></div></div><p>我们建议 port 的开发人员使用相似的开关， 以便最终用户使用，
	      并减少开关名称的总数。 最为常用的开关名字可以在
	      <a class="link" href="http://www.freebsd.org/cgi/cvsweb.cgi/ports/KNOBS?rev=HEAD&amp;content-type=text/x-cvsweb-markup" target="_top">KNOBS</a>
	      文件中找到。</p><p>开关的名字应反映其功能。 如果 port 的 <code class="varname">PORTNAME</code>
	      包括 lib- 前缀， 则开关名中应删去 lib- 前缀。</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67937360"></a>5.11.2. <code class="varname">OPTIONS</code> (菜单式可选项)</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67938256"></a>5.11.2.1. 背景</h4></div></div></div><p><code class="varname">OPTIONS</code> 将为正在安装 port
	      的用户提供一个包含可用选项的对话框，
	      并将用户的选择保存到 <code class="filename">/var/db/ports/portname/options</code> 中。
	      下次重新联编 port 时， 这些选项将被再次使用。
	      这样一来， 就不需要劳神去记忆您之前联编 port 时的那几十个
	      <code class="varname">WITH_<em class="replaceable"><code>*</code></em></code> 和
	      <code class="varname">WITHOUT_<em class="replaceable"><code>*</code></em></code>选项了！</p><p>当用户运行 <code class="command">make config</code> (或首次运行
	      <code class="command">make build</code>) 时， 框架会首先检查
	      <code class="filename">/var/db/ports/portname/options</code>。
	      如果这个文件不存在， 则它会使用
	      <code class="varname">OPTIONS</code> 的值来生成一个可以启用或禁用各个选项的对话框。
	      随后， 用户的选择将保存到
	      <code class="filename">options</code> 文件中，
	      并被用于联编 port。</p><p>如果新版本的 port 新增了
	      <code class="varname">OPTIONS</code>， 则系统会再次给出对话框，
	      并根据先前的 <code class="varname">OPTIONS</code>
	      配置预设先前存在的配置。</p><p>使用 <code class="command">make showconfig</code> 可以查看保存的配置。
	      此外， <code class="command">make rmconfig</code> 可以删除已经保存的配置。</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67946064"></a>5.11.2.2. 语法</h4></div></div></div><p><code class="varname">OPTIONS</code> 变量的语法是：

</p><pre class="programlisting">OPTIONS=	OPTION	"说明性文字" 默认值 ...
</pre><p>

	      默认值必须是 <code class="literal">ON</code> 和
	      <code class="literal">OFF</code> 之一。 这种三元组可以使用多次。</p><p>定义 <code class="varname">OPTIONS</code> 变量的值，
	      必须在引入 <code class="filename">bsd.port.options.mk</code> 之前进行。
	      而 <code class="varname">WITH_*</code> 和 <code class="varname">WITHOUT_*</code>
	      变量则只能在引入了
	      <code class="filename">bsd.port.options.mk</code> 之后才可以进行检测。 使用
	      <code class="filename">bsd.port.pre.mk</code> 也可以达到同样的目的，
	      在系统开始提供 <code class="filename">bsd.port.options.mk</code> 之前的许多
	      port 都在使用这种用法。 不过， 请注意
	      <code class="filename">bsd.port.pre.mk</code> 会要求某些变量已经进行过定义， 如
	      <code class="varname">USE_*</code> 等。</p><div class="example"><a id="ports-options-simple-use"></a><div class="example-title">例 5.8. 简单的 <code class="varname">OPTIONS</code> 用法</div><div class="example-contents"><pre class="programlisting">OPTIONS=      FOO "启用 foo 选项" On \
              BAR "支持 bar 功能" Off

.include &lt;bsd.port.options.mk&gt;

.if defined(WITHOUT_FOO)
CONFIGURE_ARGS+=	--without-foo
.else
CONFIGURE_ARGS+=	--with-foo
.endif

.if defined(WITH_BAR)
RUN_DEPENDS+=	bar:${PORTSDIR}/bar/bar
.endif

.include &lt;bsd.port.mk&gt;</pre></div></div><br class="example-break" /><div class="example"><a id="ports-options-old-style-use"></a><div class="example-title">例 5.9. Old style use of <code class="varname">OPTIONS</code></div><div class="example-contents"><pre class="programlisting">OPTIONS=      FOO "Enable option foo" On

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITHOUT_FOO)
CONFIGURE_ARGS+=	--without-foo
.else
CONFIGURE_ARGS+=	--with-foo
.endif

.include &lt;bsd.port.post.mk&gt;</pre></div></div><br class="example-break" /></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67968592"></a>5.11.3. 自动激活的特性</h3></div></div></div><p>在使用 GNU configure 脚本时， 一定要小心有些特性会由其自动检测而激活。
	  您应通过明确地指定相应的
	  <code class="literal">--without-xxx</code> 或 <code class="literal">--disable-xxx</code>
	  参数到 <code class="varname">CONFIGURE_ARGS</code> 来禁用不希望的特性。</p><div class="example"><a id="idp67970896"></a><div class="example-title">例 5.10. 处理选项时的错误做法</div><div class="example-contents"><pre class="programlisting">.if defined(WITH_FOO)
LIB_DEPENDS+=		foo.0:${PORTSDIR}/devel/foo
CONFIGURE_ARGS+=	--enable-foo
.endif</pre></div></div><br class="example-break" /><p>在前面的例子中， 假设系统中已经安装了 libfoo 库。 用户可能并不希望应用程序使用 libfoo，
	  因此他在 <code class="literal">make config</code> 对话框中关掉了这个选项。
	  但是， 应用程序的 configure 脚本检测到了系统中存在这个库，
	  并将其加入到了最终可执行文件支持的功能中。 现在， 如果用户决定从系统中卸载 libfoo 时，
	  ports 系统就无法保护这个应用程序免遭破坏了 (因为没有记录 libfoo 的依赖关系)。</p><div class="example"><a id="idp67972816"></a><div class="example-title">例 5.11. 处理选项时的正确做法</div><div class="example-contents"><pre class="programlisting">.if defined(WITH_FOO)
LIB_DEPENDS+=		foo.0:${PORTSDIR}/devel/foo
CONFIGURE_ARGS+=	--enable-foo
.else
CONFIGURE_ARGS+=	--disable-foo
.endif</pre></div></div><br class="example-break" /><p>在第二个例子中， libfoo 库被明确禁用。 即使系统中已经安装了这个库，
	  configure 脚本也不会启用相应的功能了。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="makefile-info.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="makefile.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="makefile-wrkdir.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">5.10. Info 文件 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 5.12. 指定工作临时目录</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文档和其它文档可从这里下载：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>如果对于FreeBSD有问题，请先阅读
    <a href="http://www.FreeBSD.org/docs.html">文档</a>，如不能解决再联系
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    关于本文档的问题请发信联系
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>