<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>4.4. Fehlerbehebung (Patches)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Das FreeBSD Porter-Handbuch" /><link rel="up" href="slow.html" title="Kapitel 4. Einen Port in aller Ruhe erstellen" /><link rel="prev" href="slow-modifying.html" title="4.3. Den Port bearbeiten" /><link rel="next" href="slow-configure.html" title="4.5. Konfigurieren" /><link rel="copyright" href="trademarks.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.4. Fehlerbehebung (Patches)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="slow-modifying.html">Zurück</a> </td><th width="60%" align="center">Kapitel 4. Einen Port in aller Ruhe erstellen</th><td width="20%" align="right"> <a accesskey="n" href="slow-configure.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="slow-patch"></a>4.4. Fehlerbehebung (Patches)</h2></div></div></div><p>Bei der Vorbereitung eines Ports können die Dateien,
	die hinzugefügt oder verändert wurden, mittels
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> abgefangen werden, um Sie später an
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=patch&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">patch</span>(1)</span></a> zu übergeben. Jeder Patch, der dem
	Quelltext übergeben werden soll, sollte in einer Datei
	<code class="filename">patch-*</code>
	abgelegt werden, wobei <em class="replaceable"><code>*</code></em> dem
	Pfadnamen der zu korrigierenden Datei entspricht, wie er auch
	in <code class="filename">patch-Imakefile</code> oder im
	<code class="filename">patch-src-config.h</code> erscheint. Diese
	Dateien sollten in <code class="varname">PATCHDIR</code> (normalerweise
	<code class="filename">files</code>) abgelegt sein, von wo sie
	automatisch übernommen werden. Alle Patches müssen
	sich relativ zur <code class="varname">WRKSRC</code>-Variable
	(normalerweise dem Verzeichnis, in dem sich der Quelltext des
	Ports entpackt und wo auch der Bau stattfindet)
	befinden.</p><p>Um Korrekturen und Updates zu vereinfachen, sollte es
	vermieden werden, mehr als einen Patch für eine Datei zu
	nutzen (z.B. <code class="filename">patch-file</code> und
	<code class="filename">patch-file2</code>, welche beide
	<code class="filename">WRKSRC/foobar.c</code>
	verändern). Beachten Sie, dass, falls der Pfad einer zu
	korrigierenden Datei einen Unterstrich (<code class="literal">_</code>)
	enthält, der Patch stattdessen zwei Unterstriche im Namen
	haben muss. Zum Beispiel muss der Patch, der eine Datei namens
	<code class="filename">src/freeglut_joystick.c</code> korrigieren soll,
	<code class="filename">patch-src-freeglut__joystick.c</code> genannt
	werden.</p><p>Für die Benennung der Patches sollten nur die Zeichen
	<code class="literal">[-+._a-zA-Z0-9]</code> genutzt werden. Bitte
	verwenden Sie keine weiteren Zeichen als die angegebenen. Die
	Namensvergabe sollte nicht <code class="filename">patch-aa</code> oder
	<code class="filename">patch-ab</code> etc. entsprechen, erwähnen
	Sie immer den Pfad und Dateinamen.</p><p>RCS-Zeichenketten sollten vermieden werden, da CVS diese
	verstümmeln würde, sobald wir diese Dateien in die
	Ports-Sammlung einpflegen. Wenn wir die Dateien wieder abrufen
	wären diese verändert und der Patch würde
	fehlschlagen. RCS-Zeichenketten sind in Dollar-Zeichen
	(<code class="literal">$</code>) eingefügte Zeichen und
	beginnen üblicherweise mit <code class="literal">$Id</code>
	oder <code class="literal">$RCS</code>.</p><p>Die Option rekursiv (<code class="option">-r</code>) zu nutzen
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a>, um Patches zu erstellen, ist zulässig,
	jedoch sollte  der Patch anschließend geprüft
	werden, um Unnötiges aus dem Patch zu entfernen. Im
	Einzelnen bedeutet dies, dass Diffs zwischen zwei
	Backup-Dateien, <code class="filename">Makefile</code>s oder wenn der
	Port <code class="command">Imake</code> oder GNU
	<code class="command">configure</code> usw. nutzt, überflüssig
	sind und entfernt werden sollten. Falls es es notwendig war,
	<code class="filename">configure.in</code> zu bearbeiten und es soll
	<code class="command">autoconf</code> zum Neuerstellen von
	<code class="command">configure</code> genutzt werden, sollten die Diffs
	aus <code class="command">configure</code> nicht genutzt werden (diese
	werden oft einige tausend Zeilen
	groß!); &#8211; hier sollte
	<code class="literal">USE_AUTOTOOLS=autoconf:261</code> definiert und
	das Diff aus <code class="filename">configure.in</code> genutzt
	werden.</p><p>Zusätzlich sollte man unnötige
	Markup-Änderungen in Patches/Änderungen möglichst
	vermeiden. In der Open Source-Welt teilen sich Projekte
	häufig große Teile des Quellcodes.  Allerdings
	verwenden die einzelnen Projekte oft unterschiedliche
	Programmierstile und Vorgaben für Einrückungen. Wenn
	man also einen funktionierenden Teil einer Funktion aus einem
	Projekt verwendet, um ein ähnliches Problem in einem anderen
	Projekt zu lösen, sollte man besonders vorsichtig sein, weil
	sich ansonsten die CVS-Änderungseinträge mit
	überflüssigen Einträgen füllen, die nur
	das Markup des Quellcodes betreffen, ohne dass sich an der
	Funktion des eigentlichen Quellcode etwas ändert
	(<span class="quote">&#8222;<span class="quote">withspace-only changes</span>&#8220;</span>).  Solche Änderungen
	vergrößern nicht nur das CVS-Repository, sondern
	erschweren es auch die Ursache für eventuell auftretende
	Probleme zu finden.</p><p>War es notwendig eine Datei zu entfernen, wird dies besser
	mittels des <code class="buildtarget">post-extract</code>-Targets als
	über den Patch selbst realisiert.</p><p>Ein einfacher Austausch kann direkt über das
	<code class="filename">Makefile</code> des Ports umgesetzt werden,
	indem der in-place-Modus von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sed&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">sed</span>(1)</span></a> genutzt wird. Dies
	ist sehr hilfreich, wenn variable Werte korrigiert werden
	sollen. Beispiel:</p><pre class="programlisting">post-patch:
      @${REINPLACE_CMD} -e 's|for Linux|for FreeBSD|g' ${WRKSRC}/README
	  @${REINPLACE_CMD} -e 's|-pthread|${PTHREAD_LIBS}|' ${WRKSRC}/configure
      </pre><p>Relativ häufig ergibt sich die Situation, in der die
	portierte Software die CR/LF-Konventionen für Zeilenenden
	nutzt (dies ist bei unter <span class="trademark">Windows</span>® entwickelter Software
	häufig der Fall). Dies kann bei weiteren Patches Probleme
	(Compiler-Warnungen, Fehlermeldungen bei der Ausführung
	von Skripten wie z.B. <code class="command">/bin/sh^M</code> not found)
	und anderes ergeben. Um schnell alle Dateien von CR/LF
	nach LF zu konvertieren, kann
	<code class="literal">USE_DOS2UNIX=yes</code> in das
	<code class="filename">Makefile</code> des Ports geschrieben werden.
	Hierzu kann eine Liste der zu konvertierenden Dateien erstellt
	werden:</p><pre class="programlisting">USE_DOS2UNIX=    util.c util.h</pre><p>Sollen Gruppen von Dateien über verschiedene
	Unterverzeichnisse konvertiert werden, kann
	<code class="varname">DOS2UNIX_REGEX</code> genutzt werden, dessen
	Argumente <code class="command">find</code>-kompatible, reguläre
	Ausdrücke sind. Mehr zur Formatierung findet sich in
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=re_format&amp;sektion=7"><span class="citerefentry"><span class="refentrytitle">re_format</span>(7)</span></a>. Diese Option ist beim Konvertieren aller
	Dateien mit definierter Endung, z.B. aller Dateien im
	Quellcode, wobei binäre Dateien unberührt bleiben,
	sinnvoll:</p><pre class="programlisting">USE_DOS2UNIX=    yes
      DOS2UNIX_REGEX=  .*\.(c|cpp|h)</pre><p>Wenn Sie einen Patch zu einer bereits existierenden Datei
	erstellen wollen, können Sie von ihr eine Kopie mit der
	Endung <code class="filename">.orig</code> erstellen und
	anschließend die Originaldatei bearbeiten. Das make-Ziel
	<code class="buildtarget">makepatch</code> führt dann zu
	einer entsprechenden Patch-Datei im Verzeichnis <code class="filename">files</code> des Ports.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="slow-modifying.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="slow.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="slow-configure.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">4.3. Den Port bearbeiten </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> 4.5. Konfigurieren</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>