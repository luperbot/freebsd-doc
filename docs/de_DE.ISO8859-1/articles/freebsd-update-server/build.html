<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>5. Den Update Code bauen</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Einen eigenen FreeBSD Update Server bauen" /><link rel="up" href="index.html" title="Einen eigenen FreeBSD Update Server bauen" /><link rel="prev" href="Configuration.html" title="4. Konfiguration: Installation &amp; Setup" /><link rel="next" href="patch.html" title="6. Eine Fehlerkorrektur erstellen" /><link rel="copyright" href="trademarks.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. Den Update Code bauen</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="Configuration.html">Zurück</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="patch.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="build"></a>5. Den Update Code bauen</h2></div></div></div><p>Der erste Schritt ist das Ausführen von
      <code class="filename">scripts/make.sh</code>.  Dieses Skript baut einige
      Binärdateien, erstellt Verzeichnisse und einen RSA
      Signaturschlüssel für die Genehmigung des Bau.  In diesem
      Schritt müssen Sie auch eine Passphrase für die Erstellung des
      Signaturschlüssels angeben.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh scripts/make.sh</code></strong>
cc -O2 -fno-strict-aliasing -pipe   findstamps.c  -o findstamps
findstamps.c: In function 'usage':
findstamps.c:45: warning: incompatible implicit declaration of built-in function 'exit'
cc -O2 -fno-strict-aliasing -pipe   unstamp.c  -o unstamp
install findstamps ../bin
install unstamp ../bin
rm -f findstamps unstamp
Generating RSA private key, 4096 bit long modulus
................................................................................++
...................++
e is 65537 (0x10001)

Public key fingerprint:
27ef53e48dc869eea6c3136091cc6ab8589f967559824779e855d58a2294de9e

Encrypting signing key for root
enter aes-256-cbc encryption password:
Verifying - enter aes-256-cbc encryption password:</pre><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Notieren Sie sich den Fingerabdruck des erzeugten
	Schlüssels.  Dieser Wert wird in
	<code class="filename">/etc/freebsd-update.conf</code> für die binären
	Updates benötigt.</p></div><p>An dieser Stelle sind wir bereit, den Bauprozess zu starten.</p><div class="informalexample"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/local/freebsd-update-server</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sh scripts/init.sh amd64 7.2-RELEASE</code></strong></pre></div><p>Hier folgt ein Beispiel für einen
      <span class="emphasis"><em>ersten</em></span> Bauprozess.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh scripts/init.sh amd64 7.2-RELEASE</code></strong>
Mon Aug 24 16:04:36 PDT 2009 Starting fetch for FreeBSD/amd64 7.2-RELEASE
/usr/local/freebsd-update-server/work/7.2-RELE100% of  588 MB  359 kBps 00m00s
Mon Aug 24 16:32:38 PDT 2009 Verifying disc1 hash for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:32:44 PDT 2009 Extracting components for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:34:05 PDT 2009 Constructing world+src image for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 16:35:57 PDT 2009 Extracting world+src for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 23:36:24 UTC 2009 Building world for FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:31:29 UTC 2009 Distributing world for FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:32:36 UTC 2009 Building and distributing kernels for FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:44:44 UTC 2009 Constructing world components for FreeBSD/amd64 7.2-RELEASE
Tue Aug 25 00:44:56 UTC 2009 Distributing source for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:46:18 PDT 2009 Moving components into staging area for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:46:33 PDT 2009 Identifying extra documentation for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:47:13 PDT 2009 Extracting extra docs for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:47:18 PDT 2009 Indexing release for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 17:50:44 PDT 2009 Indexing world0 for FreeBSD/amd64 7.2-RELEASE

Files built but not released:
Files released but not built:
Files which differ by more than contents:
Files which differ between release and build:
kernel|generic|/GENERIC/hptrr.ko
kernel|generic|/GENERIC/kernel
src|sys|/sys/conf/newvers.sh
world|base|/boot/loader
world|base|/boot/pxeboot
world|base|/etc/mail/freebsd.cf
world|base|/etc/mail/freebsd.submit.cf
world|base|/etc/mail/sendmail.cf
world|base|/etc/mail/submit.cf
world|base|/lib/libcrypto.so.5
world|base|/usr/bin/ntpq
world|base|/usr/lib/libalias.a
world|base|/usr/lib/libalias_cuseeme.a
world|base|/usr/lib/libalias_dummy.a
world|base|/usr/lib/libalias_ftp.a
...</pre><p>Anschließend wird das Basissystem mit den dazugehörigen
      Patches erneut gebaut.  Eine detaillierte Erklärung dazu finden
      Sie in <code class="filename">scripts/build.subr</code>.</p><div xmlns="" class="warning"><h3 class="admontitle">Warnung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Während der zweiten Bauphase wird der Network Time
	Protocol Dienst, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ntpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ntpd</span>(8)</span></a>, ausgeschaltet.  Per
	Colin Percival, emeritierter Security Officer von FreeBSD, "Der
	<a class="link" href="http://svnweb.freebsd.org/base/user/cperciva/freebsd-update-build/" target="_top">freebsd-update-server</a>
	Code muss Zeitstempel, welche in Dateien gespeichert sind,
	identifizieren, sodass festgestellt werden kann, welche
	Dateien aktualisiert werden müssen.  Dies geschieht, indem
	zwei Builds erstellt werden die 400 Tage auseinander liegen
	und anschließend die Ergebnisse verglichen werden."</p></div><pre class="screen">Mon Aug 24 17:54:07 PDT 2009 Extracting world+src for FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 00:54:34 UTC 2010 Building world for FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 01:49:42 UTC 2010 Distributing world for FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 01:50:50 UTC 2010 Building and distributing kernels for FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 02:02:56 UTC 2010 Constructing world components for FreeBSD/amd64 7.2-RELEASE
Wed Sep 29 02:03:08 UTC 2010 Distributing source for FreeBSD/amd64 7.2-RELEASE
Tue Sep 28 19:04:31 PDT 2010 Moving components into staging area for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:04:46 PDT 2009 Extracting extra docs for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:04:51 PDT 2009 Indexing world1 for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:08:04 PDT 2009 Locating build stamps for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:19 PDT 2009 Cleaning staging area for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:19 PDT 2009 Preparing to copy files into staging area for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 19:10:20 PDT 2009 Copying data files into staging area for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 12:16:57 PDT 2009 Copying metadata files into staging area for FreeBSD/amd64 7.2-RELEASE
Mon Aug 24 12:16:59 PDT 2009 Constructing metadata index and tag for FreeBSD/amd64 7.2-RELEASE

Files found which include build stamps:
kernel|generic|/GENERIC/hptrr.ko
kernel|generic|/GENERIC/kernel
world|base|/boot/loader
world|base|/boot/pxeboot
world|base|/etc/mail/freebsd.cf
world|base|/etc/mail/freebsd.submit.cf
world|base|/etc/mail/sendmail.cf
world|base|/etc/mail/submit.cf
world|base|/lib/libcrypto.so.5
world|base|/usr/bin/ntpq
world|base|/usr/include/osreldate.h
world|base|/usr/lib/libalias.a
world|base|/usr/lib/libalias_cuseeme.a
world|base|/usr/lib/libalias_dummy.a
world|base|/usr/lib/libalias_ftp.a
...</pre><p>Schlussendlich wird der Bauprozess fertiggestellt.</p><pre class="screen">Values of build stamps, excluding library archive headers:
v1.2 (Aug 25 2009 00:40:36)
v1.2 (Aug 25 2009 00:38:22)
@(#)FreeBSD 7.2-RELEASE #0: Tue Aug 25 00:38:29 UTC 2009
FreeBSD 7.2-RELEASE #0: Tue Aug 25 00:38:29 UTC 2009
    root@server.myhost.com:/usr/obj/usr/src/sys/GENERIC
7.2-RELEASE
Mon Aug 24 23:55:25 UTC 2009
Mon Aug 24 23:55:25 UTC 2009
##### built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
##### built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
##### built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
##### built by root@server.myhost.com on Tue Aug 25 00:16:15 UTC 2009
Mon Aug 24 23:46:47 UTC 2009
ntpq 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 (1)
 * Copyright (c) 1992-2009 The FreeBSD Project.
Mon Aug 24 23:46:47 UTC 2009
Mon Aug 24 23:55:40 UTC 2009
Aug 25 2009
ntpd 4.2.4p5-a Mon Aug 24 23:55:52 UTC 2009 (1)
ntpdate 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 (1)
ntpdc 4.2.4p5-a Mon Aug 24 23:55:53 UTC 2009 (1)
Tue Aug 25 00:21:21 UTC 2009
Tue Aug 25 00:21:21 UTC 2009
Tue Aug 25 00:21:21 UTC 2009
Mon Aug 24 23:46:47 UTC 2009

FreeBSD/amd64 7.2-RELEASE initialization build complete.  Please
review the list of build stamps printed above to confirm that
they look sensible, then run
# sh -e approve.sh amd64 7.2-RELEASE
to sign the release.</pre><p>Genehmigen Sie den Bau, wenn alles korrekt ist.  Weitere
      Informationen zur korrekten Bestimmung finden Sie in der
      Quelldatei namens <code class="filename">USAGE</code>.  Führen Sie, wie
      angegeben <code class="filename">scripts/approve.sh</code> aus.  Dieser
      Schritt unterschreibt das Release und verschiebt die Komponenten
      an einen Sammelpunkt, wo sie für den Upload verwendet werden
      können.</p><div class="informalexample"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/local/freebsd-update-server</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sh scripts/mountkey.sh</code></strong></pre></div><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh -e scripts/approve.sh amd64 7.2-RELEASE</code></strong>
Wed Aug 26 12:50:06 PDT 2009 Signing build for FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to patch source directories for FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:06 PDT 2009 Copying files to upload staging area for FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Updating databases for FreeBSD/amd64 7.2-RELEASE
Wed Aug 26 12:50:07 PDT 2009 Cleaning staging area for FreeBSD/amd64 7.2-RELEASE</pre><p>Nachdem der Genehmigungsprozess abgeschlossen ist, kann der
      Upload gestartet werden.</p><div class="informalexample"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/local/freebsd-update-server</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sh scripts/upload.sh amd64 7.2-RELEASE</code></strong></pre></div><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Wenn der Update-Code erneut hochgeladen werden muss, kann
	dies durch die Änderung des öffentlichen
	Distributionsverzeichnisses für das Ziel-Release und der
	Aktualisierung der Attribute für die
	<span class="emphasis"><em>hochgeladene</em></span> Datei geschehen.</p><div xmlns="http://www.w3.org/1999/xhtml" class="informalexample"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/local/freebsd-update-server/pub/7.2-RELEASE/amd64</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>touch -t 200801010101.01 uploaded</code></strong></pre></div></div><p>Um die Updates zu verteilen, müssen die hochgeladenen
      Dateien im Document Root des Webservers liegen.  Die genaue
      Konfiguration hängt von dem verwendeten Webserver ab.  Für den
      <span class="application">Apache</span> Webserver, beziehen Sie sich
      bitte auf das Kapitel <a class="link" href="../../../../doc/de_DE.ISO8859-1/books/handbook/network-apache.html" target="_top">Konfiguration
	des Apache Servers</a> im Handbuch.</p><p>Aktualisieren Sie <code class="literal">KeyPrint</code> und
      <code class="literal">ServerName</code> in der
      <code class="filename">/etc/freebsd-update.conf</code> des Clients und
      führen Sie das Update, wie im Kapitel <a class="link" href="../../../../doc/de_DE.ISO8859-1/books/handbook/updating-upgrading-freebsdupdate.html" target="_top">FreeBSD
	Update</a> des Handbuchs beschrieben, aus.</p><div xmlns="" class="important"><h3 class="admontitle">Wichtig: </h3><p xmlns="http://www.w3.org/1999/xhtml">Damit <span class="application">FreeBSD Update Server</span> ordnungsgemäß funktioniert, muss sowohl
	das <span class="emphasis"><em>current</em></span> Release als auch das Release
	<span class="emphasis"><em>auf welches Sie aktualisieren wollen</em></span> neu
	gebaut werden.  Dies ist notwendig, um die Unterschiede von
	Dateien zwischen den beiden Releases bestimmen zu können.  Zum
	Beispiel beim Upgrade eines FreeBSD Systems von 7.1-RELEASE auf
	7.2-RELEASE, müssen für beide Versionen Updates gebaut und auf
	den Webserver hochgeladen werden.</p></div><p>Als Referenz wird der gesamte Verlauf von <a class="link" href="init.txt" target="_top"><code class="filename">init.sh</code></a>
      beigefügt.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="Configuration.html">Zurück</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="patch.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">4. Konfiguration: Installation &amp; Setup </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> 6. Eine Fehlerkorrektur erstellen</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>