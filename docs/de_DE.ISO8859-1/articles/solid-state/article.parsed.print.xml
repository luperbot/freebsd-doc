<?xml version="1.0" encoding="iso-8859-1"?>
<!-- Copyright (c) 2001 The FreeBSD Documentation Project

     Redistribution and use in source (SGML DocBook) and 'compiled' forms
     (SGML, HTML, PDF, PostScript, RTF and so forth) with or without
     modification, are permitted provided that the following conditions
     are met:

      1. Redistributions of source code (SGML DocBook) must retain the above
         copyright notice, this list of conditions and the following
         disclaimer as the first lines of this file unmodified.

      2. Redistributions in compiled form (transformed to other DTDs,
         converted to PDF, PostScript, RTF and other formats) must reproduce
         the above copyright notice, this list of conditions and the
         following disclaimer in the documentation and/or other materials
         provided with the distribution.

     THIS DOCUMENTATION IS PROVIDED BY THE FREEBSD DOCUMENTATION PROJECT "AS
     IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
     THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
     PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL NIK CLAYTON BE LIABLE FOR ANY
     DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
     DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
     OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
     HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
     STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
     ANY WAY OUT OF THE USE OF THIS DOCUMENTATION, EVEN IF ADVISED OF THE
     POSSIBILITY OF SUCH DAMAGE.

     $FreeBSD$
     $FreeBSDde: de-docproj/articles/solid-state/article.xml,v 1.2 2010/09/18 21:55:49 jkois Exp $
     basiert auf: 1.18
-->
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:lang="de">
  <info><title xmlns:xlink="http://www.w3.org/1999/xlink">FreeBSD und Solid State-Geräte</title>
    

    <authorgroup xmlns:xlink="http://www.w3.org/1999/xlink">
      <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><firstname xmlns:xlink="http://www.w3.org/1999/xlink">John</firstname><surname xmlns:xlink="http://www.w3.org/1999/xlink">Kozubik</surname></personname><affiliation xmlns:xlink="http://www.w3.org/1999/xlink">
	  <address xmlns:xlink="http://www.w3.org/1999/xlink"><email xmlns:xlink="http://www.w3.org/1999/xlink">john@kozubik.com</email></address>
	</affiliation></author>
    </authorgroup>

    <copyright xmlns:xlink="http://www.w3.org/1999/xlink">
      <year xmlns:xlink="http://www.w3.org/1999/xlink">2001</year>
      <year xmlns:xlink="http://www.w3.org/1999/xlink">2009</year>
      <holder xmlns:xlink="http://www.w3.org/1999/xlink">The FreeBSD Documentation Project</holder>
    </copyright>

    <legalnotice xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="trademarks" role="trademarks">
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">FreeBSD ist ein eingetragenes
  Warenzeichen der FreeBSD Foundation.</para>
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Viele Produktbezeichnungen von
  Herstellern und Verkäufern sind Warenzeichen.  Soweit dem
  FreeBSD Project das Warenzeichen bekannt ist, werden die in diesem
  Dokument vorkommenden Bezeichnungen mit dem Symbol
  <quote xmlns:xlink="http://www.w3.org/1999/xlink">&#8482;</quote> oder dem Symbol <quote xmlns:xlink="http://www.w3.org/1999/xlink">®</quote>
  gekennzeichnet.</para>
    </legalnotice>

    
<legalnotice xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="legalnotice">
  <para xmlns:xlink="http://www.w3.org/1999/xlink">Redistribution and use in source (SGML DocBook) and 'compiled'
    forms (SGML, HTML, PDF, PostScript, RTF and so forth) with or without
    modification, are permitted provided that the following conditions are
    met:</para>

  <orderedlist xmlns:xlink="http://www.w3.org/1999/xlink">
    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Redistributions of source code (SGML DocBook) must retain the
        above copyright notice, this list of conditions and the following
        disclaimer as the first lines of this file unmodified.</para>
    </listitem>

    <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Redistributions in compiled form (transformed to other DTDs,
        converted to PDF, PostScript, RTF and other formats) must
        reproduce the above copyright notice, this list of conditions and
        the following disclaimer in the documentation and/or other
        materials provided with the distribution.</para>
    </listitem>
  </orderedlist>

  <important xmlns:xlink="http://www.w3.org/1999/xlink">
    <para xmlns:xlink="http://www.w3.org/1999/xlink">THIS DOCUMENTATION IS PROVIDED BY THE FREEBSD DOCUMENTATION
      PROJECT "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
      BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
      FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL
      THE FREEBSD DOCUMENTATION PROJECT BE LIABLE FOR ANY DIRECT, INDIRECT,
      INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
      BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS
      OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
      ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
      TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
      USE OF THIS DOCUMENTATION, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
      DAMAGE.</para>
  </important>
</legalnotice>


    <pubdate xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</pubdate>

    <releaseinfo xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</releaseinfo>

    <abstract xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Dieser Artikel behandelt die Verwendung von Solid State Festplatten
        in FreeBSD, um eingebettete Systeme zu erstellen.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Eingebettete Systeme haben den Vorteil, dass sie eine
	höhere Stabilität aufgrund des fehlens von beweglichen
	Bauteilen (Festplatten) besitzen.  Es muss jedoch beachtet
	werden, dass generell weniger Speicherplatz zur Verfügung
	steht und die Lebensdauer des Speichermediums geringer
	ist.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Spezielle Themen die behandelt werden beinhalten die Typen
	und Attribute von Solid State Datenträgern, die in FreeBSD
	verwendet werden, Kernel-Optionen die in solch einer Umgebung
	von Interesse sind, der
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">rc.initdiskless</filename>-Mechanismus, welcher die
	Initalisierung solcher Systeme automatisiert, sowie die
	Notwendigkeit von Nur-Lese-Dateisystemen und das Erstellen von
	Dateisystemen von Grund auf.  Der Artikel schliesst mit ein
	paar generellen Strategien für kleine und Nur-Lese-FreeBSD
	Umgebungen.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink"><emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Übersetzt von Benedict
	  Reuschling</emphasis>.</para>
    </abstract>
  </info>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="intro">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Solid State Festplattengeräte</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Der Umfang des Artikels ist auf Solid State Geräte
      beschränkt, die auf Flash-Speicher basieren.  Flash-Speicher ist
      ein Solid State Speicher (keine beweglichen Teile), der nicht
      flüchtig ist (der Speicher behält die Daten sogar nachdem alle
      Energiequellen ausgeschaltet wurden).  Flash-Speicher kann
      grossen physischen Schock aushalten und ist vergleichsweise
      schnell (die Flash-Speicher Lösungen, die in diesem Artikel
      behandelt werden, sind nur wenig langsamer als eine
      EIDE-Festplatte in der Schreibgeschwindigkeit und viel schneller
      bei Lese-Operationen).  Ein sehr wichtiger Aspekt von
      Flash-Speichern, dessen Auswirkungen später in diesem Artikel
      diskutiert werden, ist, dass jeder Sektor eine begrenzte
      Kapazität zur Wiederbeschreibung besitzt.  Man kann nur eine
      bestimmte Anzahl von Schreib-, Lösch- und
      Wiederbeschreibungsvorgängen durchführen, bevor der Sektor
      permanent unbrauchbar wird.  Obwohl viele Flash-Speicher
      Produkte automatisch schlechte Blöcke markieren und manche
      Geräte Schreiboperationen gleichmässig verteilen, bleibt
      weiterhin die Anzahl der durchführbaren Schreibvorgänge
      begrenzt.  Verschiedene Geräteeinheiten besitzen zwischen
      1,000,000 und 10,000,000 Schreibzyklen pro Sektor in ihren
      Spezifikationen.  Diese Zahlen variieren aufgrund der
      Umgebungstemperatur.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Im Speziellen werden wir ATA-kompatible Compact-Flash-Karten
      betrachten, welche als Speichermedien für Digitalkameras
      ziemlich populär sind.  Von besonderem Interesse ist der
      Umstand, dass diese direkt an den IDE-Bus angeschlossen werden
      und kompatibel zu den ATA-Befehlen sind.  Aus diesem Grund
      können diese Geräte mit einem einfachen und billigen Adapter
      direkt an den IDE-Bus eines Computers angeschlossen werden.  Auf
      diese Weise sehen Betriebssysteme wie FreeBSD diese Geräte dann als
      normale (wenn auch sehr kleine) Festplatten an.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Andere Solid State Plattenlösungen existieren, jedoch
      platzieren deren Kosten, Obskurität und ihre Unhandlichkeit sie
      aussserhalb des Umfangs dieses Artikels.</para>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="kernel">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Kerneloptionen</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Ein paar Kerneloptionen sind von besonderem Interesse für
      diejenigen, welche diese eingebetteten FreeBSD-Systeme erstellen
      möchten.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Alle eingebetteten FreeBSD-Systeme, die Flash-Speicher als
      Systemplatte verwenden, sind interessant für Dateisysteme im
      Hauptspeicher und RAM-Disks.  Wegen der begrenzten Anzahl von
      Schreibzyklen, die auf Flash-Speicher durchgeführt werden
      können, werden die Platte und die Dateisysteme darauf mit
      grosser Wahrscheinlichkeit nur lesend eingehängt werden.  In
      dieser Umgebung werden Dateisysteme wie
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/tmp</filename> und <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> als
      RAM-Disks eingebunden, um dem System zu erlauben, Logdateien
      anzulegen und Zähler sowie temporäre Dateien zu aktualisieren.
      RAM-Disks sind eine kritische Komponente für eine erfolgreiche
      Solid State Umsetzung in FreeBSD.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Sie sollten dafür sorgen, dass die folgenden Zeilen in Ihrer
      Kernelkonfigurationsdatei vorhanden sind:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">options         MFS             # Memory Filesystem
options         MD_ROOT         # md device usable as a potential root device
pseudo-device   md              # memory disk</programlisting>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="ro-fs">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Die <literal xmlns:xlink="http://www.w3.org/1999/xlink">rc</literal>-Subsysteme und nur-Lese
      Dateisysteme</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Die Initialisierung nach dem Bootvorgang eines eingebetteten
      FreeBSD-Systems wird von <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.initdiskless</filename>
      kontrolliert.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> hängt
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> als RAM-Disk ein, erstellt eine
      konfigurierbare Liste von Verzeichnissen in
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> mittels des <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">mkdir</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>-Kommandos
      und ändert die Attribute von ein paar dieser Verzeichnisse.  Bei
      der Ausführung von <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> kommt eine
      andere <filename xmlns:xlink="http://www.w3.org/1999/xlink">rc.conf</filename>-Variable ins Spiel:
      <literal xmlns:xlink="http://www.w3.org/1999/xlink">varsize</literal>.  Die Datei <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename>
      erstellt eine <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename>-Partition basierend auf
      dem Wert dieser Variable in <filename xmlns:xlink="http://www.w3.org/1999/xlink">rc.conf</filename>:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">varsize=8192</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Standardmässig wird dieser Wert in Sektoren
      angegeben.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Der Fakt, dass es sich bei <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> um ein
      nur-Lese Dateisystem handelt, ist eine wichtige Unterscheidung,
      da die <filename xmlns:xlink="http://www.w3.org/1999/xlink">/</filename>-Partition (und jede andere
      Partition, die Sie auf Ihrem Flash-Medium haben) nur lesend
      eingehängt wird.  Erinnern Sie sich, dass in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="intro"/> die Beschränkungen von Flash-Speichern
      erläutert wurden, speziell deren begrenzte Kapazität zum
      Schreiben.  Die Notwendigkeit, Dateisysteme auf Flash-Speichern
      nur lesend einzubinden und keine Swap-Dateien zu verwenden, kann
      nicht oft genug erwähnt werden.  Eine Swap-Datei auf einem
      ausgelasteten System kann in weniger als einem Jahr den gesamten
      Flash-Speicher aufbrauchen. Häufige Protokollierung oder das
      Erstellen und Löschen von temporären Dateien kann das gleiche
      verursachen.  Aus diesem Grund sollten Sie zusätzlich zum
      entfernen des <literal xmlns:xlink="http://www.w3.org/1999/xlink">swap</literal>-Eintrags aus ihrer
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/fstab</filename>-Datei auch noch die
      Optionsfelder für jedes Dateisystem auf <literal xmlns:xlink="http://www.w3.org/1999/xlink">ro</literal>
      wie folgt stellen:</para>

    <programlisting xmlns:xlink="http://www.w3.org/1999/xlink"># Device                Mountpoint      FStype  Options         Dump    Pass#
/dev/ad0s1a             /               ufs     ro              1       1</programlisting>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Ein paar Anwendungen im normalen System werden sofort nach
      dieser Änderung ausfallen.  Beispielsweise wird Cron nicht
      richtig funktionieren, aufgrund von fehlenden Cron-Tabellen in
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> die von
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> erstellt wurden.  Syslog und
      DHCP werden ebenfalls Probleme durch das nur-Lese Dateisystem
      und fehlende Elemente im Verzeichnis <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename>
      verursachen, die <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> erstellt
      hat.  Diese Probleme sind jedoch nur vorübergehend und werden
      zusammen mit Lösungen zur Ausführung von anderen gebräuchlichen
      Softwarepaketen in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="strategies"/>
      angesprochen.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Eine wichtige Sache, an die man sich erinnern sollte, ist,
      dass ein Dateisystem, welches als nur lesend in
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/fstab</filename> eingebunden wurde, jederzeit als
      schreibend durch das folgende Kommando eingehängt werden
      kann:</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">/sbin/mount -uw partition</userinput></screen>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">und auch wieder zurück auf nur lesend durch den Befehl:</para>

    <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">/sbin/mount -ur partition</userinput></screen>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Ein Dateisystem von Grund auf neu erstellen</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Wenn ATA-kompatible Compact-Flash-Karten von FreeBSD als
      normale IDE-Festplatten erkannt werden, könnten Sie theoretisch
      FreeBSD aus dem Netzwerk mittels der Kern- und mfsroot-Floppies
      oder einer CD installieren.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Jedoch kann selbst eine kleine Installation von FreeBSD durch
      die normale Installationsprozedur ein System erzeugen, dass
      grösser als 200 MB ist.  Da die meisten Leute kleinere
      Flash-Speichermedien einsetzen (128 MB wird hier als gross
      angesehen - 32 oder sogar 16 MB sind gebräuchlich) ist eine
      gewöhnliche Installation mit normalen Methoden nicht möglich, da
      es einfach nicht genug freien Plattenplatz gibt, selbst für die
      kleinste Installationsart.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Der einfachste Weg, diese Speicherlimitierung zu umgehen,
      ist, FreeBSD auf konventionelle Weise auf eine normale Festplatte
      zu installieren.  Nachdem die Installation abgeschlossen wurde,
      kürzen Sie das Betriebssystem auf das nötigste, bis Sie eine
      Grösse erreicht hat, die auf das Flash-Medium passt und benutzen
      Sie dann tar auf dem gesamten Dateisystem.  Die folgenden
      Schritte werden Sie durch den Prozess der Vorbereitung eines
      Flash-Mediums für ihr getartes Dateisystem führen.  Beachten
      Sie, dass Operationen wie Partitionierung, Benennung, Erstellung
      von Dateisystemen, etc. von Hand durchgeführt werden müssen, da
      eine normale Installation nicht möglich ist.  Zusätzlich zu den
      Kern- und mfsroot-Disketten benötigen Sie auch die
      fixit-Floppy.</para>

    <procedure xmlns:xlink="http://www.w3.org/1999/xlink">
      <step xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Partitionierung Ihrer Flash-Medien</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Wählen Sie nach dem Starten der Kern- und
	  mfsroot-Disketten, <literal xmlns:xlink="http://www.w3.org/1999/xlink">custom</literal> aus dem
	  Installationsmenü.  In diesem Menü wählen Sie dann
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">partition</literal> aus.  Dort sollten Sie alle
	  bestehenden Partitionen mit Hilfe der Taste
	  <keycap xmlns:xlink="http://www.w3.org/1999/xlink">d</keycap> löschen.  Nachdem alle bestehenden
	  Partitionen gelöscht wurden, erstellen Sie mittels der Taste
	  <keycap xmlns:xlink="http://www.w3.org/1999/xlink">c</keycap> eine Partition und akzeptieren Sie den
	  Standardwert für die Grösse der Partition.  Wenn Sie nach
	  dem Typ der Partition gefragt werden, stellen Sie sicher,
	  dass der Wert auf <literal xmlns:xlink="http://www.w3.org/1999/xlink">165</literal> eingestellt ist.
	  Schreiben Sie jetzt diese Partitionstabelle auf die Platte
	  durch betätigen der Taste <keycap xmlns:xlink="http://www.w3.org/1999/xlink">w</keycap> (dies ist die
	  versteckte Option auf diesem Bildschirm).  Wenn Sie eine
	  ATA-kompatible Compact Flash-Karte verwenden, sollten Sie
	  den FreeBSD Bootmanager auswählen.  Drücken Sie nun die Taste
	  <keycap xmlns:xlink="http://www.w3.org/1999/xlink">q</keycap>, um das Partitionsmenü zu verlassen.  Sie
	  werden das Menü des Bootmanagers noch ein weiteres Mal
	  gezeigt bekommt.  In diesem Fall wiederholen Sie die Auswahl
	  von vorher.</para>
      </step>

      <step xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Anlegen von Dateisystemen auf Ihrem
	  Flashspeicher-Gerät</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Verlassen Sie das Installationsmenü und wählen Sie aus
	  dem Hauptinstallationsmenü die Option
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">fixit</literal>.  In der fixit-Umgebung angelangt,
	  geben Sie den folgenden Befehl ein:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">disklabel -e /dev/ad0c</userinput></screen>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Zu diesem Zeitpunkt sollten Sie sich im vi-Editor unter
	  der Herrschaft des disklabel-Kommandos befinden.  Als
	  nächstes müssen Sie die eine <literal xmlns:xlink="http://www.w3.org/1999/xlink">a:</literal>-Zeile an
	  das Ende der Datei hinzufügen.  Diese
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">a:</literal>-Zeile sollte wie folgt
	  aussehen:</para>

	<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">a:      <replaceable xmlns:xlink="http://www.w3.org/1999/xlink">123456</replaceable>  0       4.2BSD  0       0</programlisting>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Wobei <replaceable xmlns:xlink="http://www.w3.org/1999/xlink">123456</replaceable> eine Zahl
	  darstellt, die exakt der gleichen Zahl in der bestehenden
	  Zeile mit dem <literal xmlns:xlink="http://www.w3.org/1999/xlink">c:</literal>-Eintrag entspricht.  Sie
	  kopieren quasi die bestehende Zeile <literal xmlns:xlink="http://www.w3.org/1999/xlink">c:</literal>
	  als eine neue Zeile <literal xmlns:xlink="http://www.w3.org/1999/xlink">a:</literal> und stellen
	  sicher, dass fstype <literal xmlns:xlink="http://www.w3.org/1999/xlink">4.2BSD</literal> entspricht.
	  Speichern Sie die Datei und verlassen Sie den Editor.</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">disklabel -B -r /dev/ad0c</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">newfs /dev/ad0a</userinput></screen>
      </step>

      <step xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Schreiben des Dateisystems auf Ihr Flash-Medium</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Hängen Sie das neu erstellte Flash-Medium ein:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">mount /dev/ad0a /flash</userinput></screen>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Verbinden Sie diese Maschine mit dem Netzwerk, um die
	  tar-Datei zu übertragen und extrahieren Sie es auf das
	  Dateisystem des Flash-Mediums.  Ein Beispiel dazu wäre
	  folgendes:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ifconfig xl0 192.168.0.10 netmask 255.255.255.0</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">route add default 192.168.0.1</userinput></screen>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Jetzt da die Maschine ans Netzwerk angeschlossen ist,
	  kopieren Sie die tar-Datei.  An diesem Punkt werden Sie
	  möglicherweise mit einem Dilemma konfrontiert - sollte Ihr
	  Flash-Speicher beispielsweise 128 MB gross sein und
	  Ihre tar-Datei grösser als 64 MB, können Sie ihre
	  tar-Datei auf dem Flash-Speicher nicht entpacken - Ihnen
	  wird vorher der Speicherplatz ausgehen.  Eine Lösung für
	  dieses Problem, sofern Sie FTP verwenden, ist, dass Sie die
	  Datei entpacken können, während es von FTP übertragen wird.
	  Wenn Sie die Übertragung auf diese Weise durchführen, haben
	  Sie niemals die tar-Datei und deren Inhalt zur gleichen Zeit
	  auf Ihrem Medium:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns:xlink="http://www.w3.org/1999/xlink">ftp&gt;</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">get tarfile.tar "| tar xvf -"</userinput></screen>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Sollte Ihre tar-Datei gezippt sein, können Sie dies
	  ebenso bewerkstelligen:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns:xlink="http://www.w3.org/1999/xlink">ftp&gt;</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">get tarfile.tar "| zcat | tar xvf -"</userinput></screen>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Nachdem der Inhalt Ihrer tar-Datei auf dem Dateisystem
	  des Flash-Mediums abgelegt wurden, können Sie den
	  Flash-Speicher aushängen und neu starten:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">cd /</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">umount /flash</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">exit</userinput></screen>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">In der Annahme, dass Sie Ihr Dateisystem richtig
	  konfiguriert haben, als es noch auf der gewöhnlichen
	  Festplatte gebaut wurde (mit Ihren Nur-Lese-Dateisystemen
	  und den nötigen Optionen im Kernel), sollten Sie nun
	  erfolgreich von Ihrem FreeBSD Embedded-System starten
	  können.</para>
      </step>
    </procedure>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="strategies">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Systemstrategien für kleine und Nur-Lese-Umgebungen</title>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">In <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="ro-fs"/> wurde darauf hingewiesen, dass
      das <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename>-Dateisystem von
      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> konstruiert wurde und die
      Präsenz eines Nur-Lese-Wurzeldateisystems Probleme mit vielen in
      FreeBSD gebrächlichen Softwarepaketen verursacht.  In diesem
      Artikel werden Vorschläge für das erfolgreiche Betreiben von
      cron, syslog, Installationen von Ports und dem Apache-Webserver
      unterbreitet.</para>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">cron</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Während des Bootvorgangs wird <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> von
        <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> anhand der Liste aus
        <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/mtree/BSD.var.dist</filename> gefüllt, damit
        <filename xmlns:xlink="http://www.w3.org/1999/xlink">cron</filename>, <filename xmlns:xlink="http://www.w3.org/1999/xlink">cron/tabs</filename>, <filename xmlns:xlink="http://www.w3.org/1999/xlink">at</filename> und ein paar weitere
        Standardverzeichnisse erstellt werden.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Jedoch löst das noch nicht das Problem, Crontabs über
	Neustarts des Systems hinaus zu erhalten.  Wenn das System neu
	gestartet wird, verschwindet das
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename>-Dateiystem, welches sich im
	Hauptspeicher befunden hat und jegliche Crontabs, die Sie
	hatten werden ebenfalls verschwinden. Aus diesem Grund besteht
	eine Lösung darin, Crontabs für diejenigen Benutzer zu
	erstellen, die diese auch benötigen.  Dazu sollte das
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/</filename>-Dateisystem lesend und schreibend
	eingehängt und diese Crontabs an einen sicheren Ort kopiert
	werden, wie beispielsweise <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/tabs</filename>.
	Fügen Sie dann eine Zeile an das Ende der Datei
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.initdiskless</filename> hinzu, die diese
	Crontabs in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/cron/tabs</filename> kopiert,
	nachdem dieses Verzeichnis während der Systeminitialisierung
	erstellt wurde.  Sie werden auch eine Zeile hinzufügen mössen,
	welche die Besitzer und Berechtigungen auf diesen
	Verzeichnissen, die Sie erstellen und den dazugehörigen
	Dateien, die Sie mittels
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.initdiskless</filename> kopieren,
	setzen.</para>
    </sect2>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">syslog</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Die Datei <filename xmlns:xlink="http://www.w3.org/1999/xlink">syslog.conf</filename> spezifiziert
	den Ort von bestimmten Logdateien, welche in
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/log</filename> existieren.  Diese Dateien
	werden nicht von <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> während
	der Systeminitialisierung erstellt.  Aus diesem Grund müssen
	Sie irgendwo in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> nach dem
	Abschnitt, der die Verzeichnisse in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename>
	erstellt, eine Zeile ähnlich der folgenden hinzufügen:</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">touch /var/log/security /var/log/maillog /var/log/cron /var/log/messages</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">chmod 0644 /var/log/*</userinput></screen>
    </sect2>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Installation von Ports</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Bevor die notwendigen Änderungen erkärt werden, einen
	Ports-Baum zu verwenden, ist es notwendig, Sie an die
	Nur-Lese-Besonderheit Ihres Dateisystems auf dem Flash-Medium
	zu erinnern.  Da dieses nur lesend verfügbar ist, müssen Sie
	es vorübergehend mit Schreibrechten ausstatten, indem Sie die
	mount-Syntax, wie in <xref xmlns:xlink="http://www.w3.org/1999/xlink" linkend="ro-fs"/> dargestellt wird,
	verwenden.  Sie sollten immer diese Dateisysteme erneut mit
	nur-Lese-Rechten einhängen wenn Sie damit fertig sind -
	unnötige Schreibvorgänge auf dem Flash-Medium kann dessen
	Lebenszeit erheblich verkürzen.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Um es zu ermöglichen, in das Ports-Verzeichnis zu wechseln
	und erfolgreich <command xmlns:xlink="http://www.w3.org/1999/xlink">make</command>
	<buildtarget>install</buildtarget> auszuführen, müssen wir ein
	Paketverzeichnis auf einem Nicht-Hauptspeicherdateisystem
	erstellen, welches die Pakete über Neustarts hinweg im Auge
	behält.  Weil es sowieso nötig ist, Ihre Dateisysteme mit
	Lese-Schreibrechten für die Installation eines Pakets
	einzuhängen, ist es sinnvoll anzunehmen, dass ein Bereich
	Ihres Flash-Mediums ebenfalls für Paketinformationen, die
	darauf abgespeichert werden, verwendet wird.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Erstellen Sie zuerst ein Verzeichnis für die
	Paketdatenbank.  Normalerweise ist dies
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/db/pkg</filename>, jedoch können wir es dort
	nicht unterbringen, da es jedesmal verschwinden wird, wenn das
	System neu gestartet wird.</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">mkdir /etc/pkg</userinput></screen>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Fügen Sie nun eine Zeile in
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> hinzu, welche das
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pkg</filename>-Verzeichnis mit
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/db/pkg</filename> verknüpft.  Ein
	Beispiel:</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ln -s /etc/pkg /var/db/pkg</userinput></screen>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Nun wird jedes Mal, wenn Sie Ihre Dateisysteme mit
	Lese-Schreibrechten einbinden und ein Paket installieren, der
	Befehl <command xmlns:xlink="http://www.w3.org/1999/xlink">make</command>
	<buildtarget>install</buildtarget> funktionieren und
	Paketinformationen werden erfolgreich nach
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/pkg</filename> geschrieben (da zu diesem
	Zeitpunkt das Dateisystem mit Lese-Schreibrechten eingebunden
	ist), welche dann stets dem Betriebssystem als
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/db/pkg</filename> zur Verfügung stehen.</para>
    </sect2>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Apache Webserver</title>

      <note xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Die Anweisungen in diesem Abschnitt sind nur notwendig,
	  wenn Apache so eingerichtet ist, dass dieser seine PID oder
	  Protokollierungsinformationen ausserhalb von <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> ablegt.  Standardmässig
	  bewahrt Apache seine PID-Datei in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/run/httpd.pid</filename> und seine
	  Protokolldateien in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/log</filename> auf.</para>
      </note>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Es wird nun davon ausgegangen, dass Apache seine
	Protokolldateien in einem Verzeichnis namens <filename xmlns:xlink="http://www.w3.org/1999/xlink">apache_log_dir</filename>
	ausserhalb von <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename>
	speichert.  Wenn dieses Verzeichnis auf einem
	nur-Lese-Dateisystem existiert, wird Apache nicht in der Lage
	sein, Protokolldateien zu speichern und wird vermutlich nicht
	richtig funktionieren.  Wenn dies der Fall ist, muss ein neues
	Verzeichnis zu der Liste der Verzeichnisse in
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> hinzugefügt werden, um
	dieses in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> zu erstellen und um
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">apache_log_dir</filename>
	nach <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var/log/apache</filename> zu verknüpfen.  Es
	ist auch nötig, Berechtigungen und Besitzer auf diesem neuen
	Verzeichnis zu setzen.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Fügen Sie zuerst das Verzeichnis
	<literal xmlns:xlink="http://www.w3.org/1999/xlink">log/apache</literal> zu der Liste von Verzeichnissen
	hinzu, die in <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> angelegt
	werden sollen.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Danach tragen Sie die folgenden Befehle in
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/rc.d/var</filename> nach dem Abschnitt zum
	Erstellen der Verzeichnisse ein:</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">chmod 0774 /var/log/apache</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">chown nobody:nobody /var/log/apache</userinput></screen>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Schliesslich löschen Sie das bestehende <filename xmlns:xlink="http://www.w3.org/1999/xlink">apache_log_dir</filename>
	Verzeichnis und ersetzen es mit einer Verknüpfung:</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">rm -rf apache_log_dir</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ln -s /var/log/apache apache_log_dir</userinput></screen>
    </sect2>
  </sect1>
</article>
