<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>15.7. Kerberos5</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Das FreeBSD-Handbuch" /><link rel="up" href="security.html" title="Kapitel 15. Sicherheit" /><link rel="prev" href="tcpwrappers.html" title="15.6. TCP-Wrapper" /><link rel="next" href="openssl.html" title="15.8. OpenSSL" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">15.7. <span class="application">Kerberos5</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="tcpwrappers.html">Zurück</a> </td><th width="60%" align="center">Kapitel 15. Sicherheit</th><td width="20%" align="right"> <a accesskey="n" href="openssl.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kerberos5"></a>15.7. <span class="application">Kerberos5</span></h2></div><div><span class="authorgroup">Beigetragen von <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tillman</span> <span class="surname">Hodgson</span></span>. </span></div><div><span class="authorgroup">Beruht auf einem Beitrag von <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Mark</span> <span class="surname">Murray</span></span>. </span></div></div></div><p><span class="application">Kerberos</span> ist ein Netzwerk-Protokoll,
      das Benutzer mithilfe eines sicheren Servers authentifiziert.
      Mit Risiken behaftete Dienste, wie das Anmelden an entfernten
      Systemen oder das Kopieren von Daten auf entfernte Systeme,
      werden durch <span class="application">Kerberos</span> erheblich
      sicherer und lassen sich leichter steuern.</p><p><span class="application">Kerberos</span> hat eine Aufgabe:
      Die sichere Prüfung der Identität eines Benutzers
      (Authentifizierung) über das Netzwerk.  Das System
      überprüft weder die Berechtigungen der Benutzer
      (Autorisierung), noch verfolgt es die durchgeführten
      Aktionen (Audit).  Daher sollte <span class="application">Kerberos</span>
      zusammen mit anderen Sicherheits-Systemen eingesetzt werden, die
      diese Funktionen bereitstellen.  Die Daten einer Kommunikation
      können verschlüsselt werden, nachdem die
      Kommunikationspartner mit <span class="application">Kerberos</span>
      ihre Identität geprüft haben.</p><p>Die folgenden Anweisungen beschreiben, wie Sie das mit
      FreeBSD gelieferte <span class="application">Kerberos</span> einrichten.
      Eine vollständige Beschreibung des Systems entnehmen
      Sie bitte den entsprechenden Hilfeseiten.</p><p>Die Beschreibung der
      <span class="application">Kerberos</span>-Installation benutzt
      folgende Namensräume:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Die <acronym class="acronym">DNS</acronym>-Domain (Zone) heißt
	  example.org.</p></li><li class="listitem"><p>Das <span class="application">Kerberos</span>-Realm
	  heißt EXAMPLE.ORG.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Benutzen Sie echte Domain-Namen, wenn Sie
	<span class="application">Kerberos</span> einrichten.  Damit
	vermeiden Sie <acronym class="acronym">DNS</acronym>-Probleme und stellen
	die Zusammenarbeit mit anderen
	<span class="application">Kerberos</span>-Realms sicher.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78544080"></a>15.7.1. Geschichte</h3></div></div></div><a id="idp78544720" class="indexterm"></a><p>Das <acronym class="acronym">MIT</acronym> entwickelte
        <span class="application">Kerberos</span>, um Sicherheitsprobleme
	auf dem Netzwerk zu lösen.  Das
	<span class="application">Kerberos</span>-Protokoll verwendet
	starke Kryptographie, sodass ein Server die Identität
	eines Clients (der umgekehrte Vorgang ist auch möglich)
	über ein unsicheres Netzwerk feststellen kann.</p><p>Der Begriff Kerberos wird sowohl für das Protokoll
	als auch für Programme verwendet, die
	<span class="application">Kerberos</span> benutzen (wie
	<span class="application">Kerberos</span>-Telnet).  Die aktuelle
	Protokollversion ist 5 und wird in
	<acronym class="acronym">RFC</acronym> 1510 beschrieben.</p><p>Mehrere Implementierungen des Protokolls stehen frei
	zur Verfügung und decken viele Betriebssysteme ab.
	Das Massachusetts Institute of Technology
	(<acronym class="acronym">MIT</acronym>), an dem <span class="application">Kerberos</span>
	ursprünglich entwickelt wurde, entwickelt seine
	<span class="application">Kerberos</span>-Version weiter.  In den
	<acronym class="acronym">USA</acronym> wird diese Version häufig
	eingesetzt, unterlag aber Export-Beschränkungen,
	da sie in den <acronym class="acronym">USA</acronym> entwickelt wurde.
	Die <acronym class="acronym">MIT</acronym>-Version von
	<span class="application">Kerberos</span> befindet sich im Port
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/krb5/pkg-descr">security/krb5</a>.
	Heimdal ist eine weitere Implementierung der Protokollversion 5.
	Sie wurde außerhalb der <acronym class="acronym">USA</acronym> entwickelt
	und unterliegt daher keinen Export-Beschränkungen.
	Heimdal-<span class="application">Kerberos</span> befindet sich
	im Port <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/heimdal/pkg-descr">security/heimdal</a>
	und das Basissystem von FreeBSD enthält eine minimale
	Installation von Heimdal.</p><p>Um möglichst viele Benutzer anzusprechen, verwenden
	die folgenden Beispiele die in FreeBSD enthaltene
	Heimdal-Distribution.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78562640"></a>15.7.2. Das Heimdal <acronym class="acronym">KDC</acronym> einrichten</h3></div></div></div><a id="idp78563664" class="indexterm"></a><p><span class="application">Kerberos</span> authentifiziert
	Benutzer an einer zentralen Stelle: dem Key Distribution
	Center (<acronym class="acronym">KDC</acronym>).  Das <acronym class="acronym">KDC</acronym>
	verteilt <em class="firstterm">Tickets</em>, mit denen ein
	Dienst die Identität eines Benutzers feststellen kann.
	Alle Mitglieder eines <span class="application">Kerberos</span>-Realms
	vertrauen dem <acronym class="acronym">KDC</acronym>, daher gelten für
	das <acronym class="acronym">KDC</acronym> erhöhte
	Sicherheitsanforderungen.</p><p>Obwohl das <acronym class="acronym">KDC</acronym> wenig Ressourcen eines
	Rechners benötigt, sollte es wegen der
	Sicherheitsanforderungen auf einem separaten Rechner
	installiert werden.</p><p>Das <acronym class="acronym">KDC</acronym> wird in
        <code class="filename">/etc/rc.conf</code> wie folgt aktiviert:</p><pre class="programlisting">kerberos5_server_enable="YES"
kadmind5_server_enable="YES"</pre><p>Danach wird die Konfigurationsdatei von
        <span class="application">Kerberos</span>,
	<code class="filename">/etc/krb5.conf</code>, erstellt:</p><pre class="programlisting">[libdefaults]
    default_realm = EXAMPLE.ORG
[realms]
    EXAMPLE.ORG = {
        kdc = kerberos.example.org
	admin_server = kerberos.example.org
    }
[domain_realm]
    .example.org = EXAMPLE.ORG</pre><p>Diese Einstellungen setzen voraus, dass der voll
	qualifizierte Name des <acronym class="acronym">KDC</acronym>s
	<code class="systemitem">kerberos.example.org</code> ist.
	Wenn Ihr <acronym class="acronym">KDC</acronym> einen anderen Namen hat,
	müssen Sie in der DNS-Zone einen Alias-Eintrag (CNAME-Record)
	für das <acronym class="acronym">KDC</acronym> hinzufügen.</p><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Auf großen Netzwerken mit einem ordentlich
	  konfigurierten <acronym class="acronym">BIND</acronym>
	  <acronym class="acronym">DNS</acronym>-Server kann die Datei verkürzt
	  werden:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">[libdefaults]
      default_realm = EXAMPLE.ORG</pre><p xmlns="http://www.w3.org/1999/xhtml">Die Zonendatei von <code class="systemitem">example.org</code>
	  muss dann die folgenden Zeilen enthalten:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">_kerberos._udp      IN  SRV     01 00 88 kerberos.example.org.
_kerberos._tcp      IN  SRV     01 00 88 kerberos.example.org.
_kpasswd._udp       IN  SRV     01 00 464 kerberos.example.org.
_kerberos-adm._tcp  IN  SRV     01 00 749 kerberos.example.org.
_kerberos           IN  TXT     EXAMPLE.ORG</pre></div><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Damit Klienten die
	  <span class="application">Kerberos</span>-Dienste benutzen
	  können, muss die Datei <code class="filename">/etc/krb5.conf</code>
	  entweder die vollständige Konfiguration enthalten
	  oder eine minimale Konfiguration enthalten
	  <span class="emphasis"><em>und</em></span> zusätzlich ein DNS-Server
	  richtig eingerichtet sein.</p></div><p>Im nächsten Schritt wird die
        <span class="application">Kerberos</span>-Datenbank eingerichtet.
	Die Datenbank enthält die Schlüssel aller Prinzipale
	und ist mit einem Passwort geschützt.  Dieses Passwort
	brauchen Sie nicht zu behalten, da ein davon abgeleiteter
	Schlüssel in der Datei <code class="filename">/var/heimdal/m-key</code>
	gespeichert wird.  Den Schlüssel erstellen Sie, indem
	Sie das Programm <code class="command">kstash</code> aufrufen und
	ein Passwort eingeben.</p><p>Nachdem Sie den Schlüssel in
        <code class="filename">/var/heimdal/m-key</code> erstellt haben,
	können Sie die Datenbank mit dem Kommando
	<code class="command">kadmin</code> initialisieren.  Verwenden
	Sie hierbei die Option <code class="option">-l</code> (lokal).  Mit
	dieser Option wird die Datenbank lokal modifiziert.  Normal
	würde der <code class="command">kadmind</code>-Dienst benutzt,
	der aber zu diesem Zeitpunkt noch nicht läuft.  An
	der Eingabeaufforderung von <code class="command">kadmin</code>
	können Sie mit dem Kommando <code class="command">init</code>
	die Datenbank des Realms einrichten.</p><p>Zuletzt erstellen Sie mit dem Kommando <code class="command">add</code>
	Ihren ersten Prinzipal.  Benutzen Sie die voreingestellten
	Optionen;  Sie können die Einstellungen später
	mit dem Kommando <code class="command">modify</code> ändern.
	An der Eingabeaufforderung zeigt das Kommando
	<code class="command">?</code> Hilfetexte an.</p><p>Zusammengefasst wird die Datenbank wie folgt
	eingerichtet:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kstash</code></strong>
Master key: <strong class="userinput"><code>xxxxxxxx</code></strong>
Verifying password - Master key: <strong class="userinput"><code>xxxxxxxx</code></strong>

<code class="prompt">#</code> <strong class="userinput"><code>kadmin -l</code></strong>
kadmin&gt; <strong class="userinput"><code>init EXAMPLE.ORG</code></strong>
Realm max ticket life [unlimited]:
kadmin&gt; <strong class="userinput"><code>add tillman</code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Attributes []:
Password: <strong class="userinput"><code>xxxxxxxx</code></strong>
Verifying password - Password: <strong class="userinput"><code>xxxxxxxx</code></strong></pre><p>Jetzt kann das <acronym class="acronym">KDC</acronym> gestartet werden.
	Führen Sie zum Start der Dienste die Kommandos
	<code class="command">/etc/rc.d/kerberos start</code> und
	<code class="command">/etc/rc.d/kadmind start</code> aus.  Obwohl
	zu diesem Zeitpunkt noch keine kerberisierten Dienste
	laufen, können Sie die Funktion des <acronym class="acronym">KDC</acronym>s
	schon überprüfen.  Für den eben angelegten
	Benutzer können Sie sich vom <acronym class="acronym">KDC</acronym>
	Tickets holen und diese Tickets anzeigen:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>kinit tillman</code></strong>
tillman@EXAMPLE.ORG's Password:

<code class="prompt">%</code> <strong class="userinput"><code>klist</code></strong>
Credentials cache: FILE: <code class="filename">/tmp/krb5cc_500</code>
        Principal: tillman@EXAMPLE.ORG

  Issued           Expires          Principal
Aug 27 15:37:58  Aug 28 01:37:58  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG</pre><p>Dieses Ticket kann, nachdem Sie Ihre Arbeit beendet haben,
	zurückgezogen werden:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>kdestroy</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78599888"></a>15.7.3. Heimdal <span class="application">Kerberos</span>-Dienste
	einrichten</h3></div></div></div><a id="idp78600912" class="indexterm"></a><p>Alle Rechner, die kerberisierte Dienste anbieten,
	müssen eine Kopie der
	<span class="application">Kerberos</span>-Konfigurationsdatei
	<code class="filename">/etc/krb5.conf</code> besitzen.  Sie
	können die Datei einfach vom <acronym class="acronym">KDC</acronym>
	kopieren.</p><p>Anschließend müssen Sie die Datei
	<code class="filename">/etc/krb5.keytab</code> erzeugen.  Im
	Gegensatz zu normalen Workstations benötigt jeder
	Server eine <code class="filename">keytab</code>.
	Diese Datei enthält den Schlüssel des
	Servers, mit dem sich der Server und das
	<acronym class="acronym">KDC</acronym> gegenseitig authentifizieren
	können.  Die Datei muss sicher auf den Server
	transportiert werden (beispielsweise mit <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a>
	oder einer Diskette).  Unter keinen Umständen
	darf die Datei im Klartext, zum Beispiel mit
	<acronym class="acronym">FTP</acronym>, übertragen werden,
	da sonst die Sicherheit des Servers gefährdet
	ist.</p><p>Sie können die <code class="filename">keytab</code> auch
	mit dem Programm <code class="command">kadmin</code> übertragen.
	Da Sie mit <code class="command">kadmin</code> sowieso einen Host-Prinzipal
	für den Server einrichten müssen, ist das ganz
	praktisch.</p><p>Sie müssen allerdings schon ein Ticket
	besitzen und berechtigt sein, <code class="command">kadmin</code>
	auszuführen.  Die Berechtigung erhalten Sie durch
	einen Eintrag in der Zugriffskontrollliste
	<code class="filename">kadmind.acl</code>.  Weitere Informationen
	über Zugriffskontrolllisten erhalten Sie in den
	Heimdal-Info-Seiten (<code class="command">info heimdal</code>)
	im Abschnitt <span class="quote">&#8222;<span class="quote">Remote administration</span>&#8220;</span>.  Wenn
	der Zugriff auf <code class="command">kadmin</code> von entfernten
	Maschinen verboten ist, müssen Sie sich sicher
	auf dem <acronym class="acronym">KDC</acronym> anmelden (lokale Konsole,
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> oder kerberisiertes Telnet) und die
	<code class="filename">keytab</code> lokal mit
	<code class="command">kadmin -l</code> erzeugen.</p><p>Nachdem Sie die Datei <code class="filename">/etc/krb5.conf</code>
	installiert haben, können Sie das Kommando
	<code class="command">kadmin</code> benutzen.  An der Eingabeaufforderung
	von <code class="command">kadmin</code> erstellt das Kommando
	<code class="command">add --random-key</code> den Host-Prinzipal
	und das Kommando <code class="command">ext</code> extrahiert den
	Schlüssel des Prinzipals in eine Datei:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt; <strong class="userinput"><code>add --random-key host/myserver.example.org</code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Attributes []:
kadmin&gt; <strong class="userinput"><code>ext host/myserver.example.org</code></strong>
kadmin&gt; <strong class="userinput"><code>exit</code></strong></pre><p>Das Kommando <code class="command">ext</code> (von
	<span class="foreignphrase"><em class="foreignphrase">extract</em></span>) speichert den
	extrahierten Schlüssel in der Datei
	<code class="filename">/etc/krb5.keytab</code>.</p><p>Wenn auf dem <acronym class="acronym">KDC</acronym>, vielleicht aus
	Sicherheitsgründen, <code class="command">kadmind</code>
	nicht läuft, können Sie das Kommando
	<code class="command">kadmin</code> von entfernten Rechnern nicht
	benutzen.  In diesem Fall legen Sie den Host-Prinzipal
	<code class="systemitem">host/myserver.EXAMPLE.ORG</code> direkt
	auf dem <acronym class="acronym">KDC</acronym> an.  Den Schlüssel
	extrahieren Sie in eine temporäre Datei (damit
	die Datei <code class="filename">/etc/krb5.keytab</code> nicht
	überschrieben wird):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt; <strong class="userinput"><code>ext --keytab=/tmp/example.keytab host/myserver.example.org</code></strong>
kadmin&gt; <strong class="userinput"><code>exit</code></strong></pre><p>Anschließend müssen Sie die erzeugte
	<code class="filename">example.keytab</code> sicher auf den
	Server kopieren (mit <code class="command">scp</code> oder
	mithilfe einer Diskette).  Geben Sie auf jeden Fall
	einen anderen Namen für die <code class="filename">keytab</code>
	an, weil sonst die <code class="filename">keytab</code> des
	<acronym class="acronym">KDC</acronym>s überschrieben würde.</p><p>Wegen der Datei <code class="filename">krb5.conf</code> kann
	der Server nun mit dem <acronym class="acronym">KDC</acronym> kommunizieren
	und seine Identität mithilfe der Datei
	<code class="filename">krb5.keytab</code> nachweisen.  Jetzt
	können wir kerberisierte Dienste aktivieren.
	Für <code class="command">telnet</code> muss die folgende
	Zeile in <code class="filename">/etc/inetd.conf</code> eingefügt
	werden:</p><pre class="programlisting">telnet    stream  tcp     nowait  root    /usr/libexec/telnetd  telnetd -a user</pre><p>Ausschlaggebend ist, dass die Authentifizierungs-Methode
	mit <code class="option">-a</code> auf <code class="literal">user</code> gesetzt
	wird.  Weitere Details entnehmen Sie bitte der Hilfeseite
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">telnetd</span>(8)</span></a>.</p><p>Nachdem sie die Zeile in <code class="filename">/etc/inetd.conf</code>
	eingefügt haben, starten Sie <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> mit
	dem Kommando <code class="command">/etc/rc.d/inetd restart</code>
	durch.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78652624"></a>15.7.4. Heimdal <span class="application">Kerberos</span>-Clients
	einrichten</h3></div></div></div><a id="idp78653648" class="indexterm"></a><p>Ein Client lässt sich leicht einrichten.
	Sie benötigen nur die
	<span class="application">Kerberos</span>-Konfigurationsdatei
	<code class="filename">/etc/krb5.conf</code>.  Kopieren Sie
	die Konfigurationsdatei einfach vom <acronym class="acronym">KDC</acronym>
	auf den Client.</p><p>Sie können jetzt mit <code class="command">kinit</code>
        Tickets anfordern, mit <code class="command">klist</code> Tickets
	anzeigen und mit <code class="command">kdestroy</code> Tickets
	löschen.  Sie können mit
	<span class="application">Kerberos</span>-Anwendungen kerberisierte
	Server ansprechen.  Wenn das nicht funktioniert,
	Sie aber Tickets anfordern können, hat wahrscheinlich
	der  kerberisierte Server ein Problem und nicht der
	Client oder das <acronym class="acronym">KDC</acronym>.</p><p>Wenn Sie eine Anwendung wie <code class="command">telnet</code>
	testen, können Sie mit einem Paket-Sniffer
	(beispielsweise <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a>) überprüfen,
	dass Passwörter verschlüsselt übertragen
	werden.  Probieren Sie auch die Option <code class="option">-x</code>
	von <code class="command">telnet</code>, die den gesamten Datenverkehr
	verschlüsselt (analog zu <code class="command">ssh</code>).</p><p>Zu Heimdal gehören noch weitere Anwendungen.
	Allerdings enthält das FreeBSD-Basissystem nur eine
	minimale Heimdal-Installation mit nur einer
	kerberisierten Anwendung: <code class="command">telnet</code>.</p><p>Der Heimdal-Port enthält noch mehr kerberisierte
	Anwendungen wie <code class="command">ftp</code>, <code class="command">rsh</code>,
	<code class="command">rcp</code> und <code class="command">rlogin</code>.
	Der <acronym class="acronym">MIT</acronym>-Port enthält ebenfalls
	weitere kerberisierte Anwendungen.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78673232"></a>15.7.5. Die Benutzerkonfigurationsdateien
	<code class="filename">.k5login</code> und
	<code class="filename">.k5users</code></h3></div></div></div><a id="idp78674512" class="indexterm"></a><a id="idp78675408" class="indexterm"></a><p>Normalerweise wird ein
	<span class="application">Kerberos</span>-Prinzipal wie
	<code class="systemitem">tillman@EXAMPLE.ORG</code> auf ein lokales
	Benutzerkonto, beispielsweise <code class="systemitem">tillman</code>,
	abgebildet.  Daher benötigen Client-Anwendungen (zum
	Beispiel <code class="command">telnet</code>) keinen Benutzernamen.</p><p>Manchmal wird aber Zugriff auf ein lokales Benutzerkonto
	benötigt, zu dem es keinen passenden
	<span class="application">Kerberos</span>-Prinzipal gibt.
	Der Prinzipal <code class="systemitem">tillman@EXAMPLE.ORG</code>
	bräuchte beispielsweise Zugriff auf das Konto
	<code class="systemitem">webdevelopers</code>.  Ebenso könnten
	andere Prinzipale auf dieses Konto zugreifen wollen.</p><p>Die Dateien <code class="filename">.k5login</code> und
	<code class="filename">.k5users</code> im Heimatverzeichnis eines
	Benutzerkontos gewähren Zugriffe ähnlich wie
	die Dateien <code class="filename">.hosts</code> und
	<code class="filename">.rhosts</code>.  Um den Prinzipalen
	<code class="systemitem">tillman@example.org</code> und
	<code class="systemitem">jdoe@example.org</code> auf das Konto
	<code class="systemitem">webdevelopers</code> zu geben, wird im
	Heimatverzeichnis von <code class="systemitem">webdevelopers</code>
	die Datei <code class="filename">.k5login</code> mit folgendem
	Inhalt angelegt:</p><pre class="screen">tillman@example.org
jdoe@example.org</pre><p>Die angegebenen Prinzipale haben nun ohne ein gemeinsames
	Passwort Zugriff auf das Konto.</p><p>Einzelheiten entnehmen Sie bitte den Hilfeseiten
	zu diesen Dateien.  Die Datei <code class="filename">.k5users</code>
	wird in der Hilfeseite des Kommandos <code class="command">ksu</code>
	beschrieben.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78691024"></a>15.7.6. Tipps und Fehlersuche</h3></div></div></div><a id="idp78691664" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Wenn Sie den Heimdal-Port oder den
	    <acronym class="acronym">MIT</acronym>-Port benutzen, muss in der
	    Umgebungsvariable <code class="envar">PATH</code> der Pfad zu
	    den Programmen des Ports vor dem Pfad zu den
	    <span class="application">Kerberos</span>-Programmen des Systems
	    stehen.</p></li><li class="listitem"><p>Sind die Uhrzeiten der Systeme synchronisiert?
	    Wenn nicht, schlägt vielleicht die Authentifizierung
	    fehl.  <a class="xref" href="network-ntp.html" title="31.10. Die Uhrzeit mit NTP synchronisieren">Abschnitt 31.10, &#8222;Die Uhrzeit mit NTP synchronisieren&#8220;</a> beschreibt, wie
	    Sie mithilfe von <acronym class="acronym">NTP</acronym> die Uhrzeiten
	    synchronisieren.</p></li><li class="listitem"><p>Die <acronym class="acronym">MIT</acronym>- und Heimdal-Systeme
	    arbeiten bis auf <code class="command">kadmin</code> gut zusammen.
	    Für <code class="command">kadmin</code> wurde das Protokoll
	    nicht normiert.</p></li><li class="listitem"><p>Wenn Sie den Namen eines Rechners ändern,
	    müssen Sie auch den <code class="systemitem">host/</code>-Prinzipal
	    ändern und die Datei <code class="filename">keytab</code>
	    aktualisieren.  Dies betrifft auch spezielle Einträge
	    wie den Prinzipal für Apaches <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/mod_auth_kerb/pkg-descr">www/mod_auth_kerb</a>.</p></li><li class="listitem"><p>Die Rechnernamen müssen vor- und
	    rückwärts aufgelöst werden (im
	    <acronym class="acronym">DNS</acronym> oder in
	    <code class="filename">/etc/hosts</code>).
	    <acronym class="acronym">CNAME</acronym>-Einträge im
	    <acronym class="acronym">DNS</acronym> funktionieren, aber die
	    entsprechenden A- und PTR-Einträge müssen
	    vorhanden und richtig sein.  Wenn sich Namen nicht
	    auflösen lassen, ist die Fehlermeldung nicht
	    gerade selbstsprechend: <span class="errorname">Kerberos5 refuses
	      authentication because Read req
	      failed: Key table entry not found</span>.</p></li><li class="listitem"><p>Einige Betriebssysteme installieren
	    <code class="command">ksu</code> mit falschen Zugriffsrechten;
	    es fehlt das Set-UID-Bit für <code class="systemitem">root</code>.
	    Das mag aus Sicherheitsgründen richtig sein,
	    doch funktioniert <code class="command">ksu</code> dann nicht.
	    Dies ist kein Fehler des <acronym class="acronym">KDC</acronym>s.</p></li><li class="listitem"><p>Wenn Sie für einen Prinzipal unter
	    <acronym class="acronym">MIT</acronym>-<span class="application">Kerberos</span>
	    Tickets mit einer längeren Gültigkeit als
	    der vorgegebenen zehn Stunden einrichten wollen,
	    müssen Sie zwei Sachen ändern.  Benutzen
	    Sie das <code class="command">modify_principal</code> von
	    <code class="command">kadmin</code>, um die maximale
	    Gültigkeitsdauer für den Prinzipal selbst
	    und den Prinzipal <code class="systemitem">krbtgt</code>
	    zu erhöhen.</p></li><li class="listitem"><p>Mit einem Packet-Sniffer können Sie feststellen,
	    dass Sie sofort nach dem Aufruf von <code class="command">kinit</code>
	    eine Antwort vom <acronym class="acronym">KDC</acronym>
	    bekommen &#8211; noch bevor Sie überhaupt ein
	    Passwort eingegeben haben!  Das ist in Ordnung:
	    Das <acronym class="acronym">KDC</acronym> händigt
	    ein Ticket-Granting-Ticket (<acronym class="acronym">TGT</acronym>)
	    auf Anfrage aus, da es durch einen vom Passwort
	    des Benutzers abgeleiteten Schlüssel
	    geschützt ist.  Wenn das Passwort
	    eingegeben wird, wird es nicht zum <acronym class="acronym">KDC</acronym>
	    gesendet, sondern zum Entschlüsseln der
	    Antwort des <acronym class="acronym">KDC</acronym>s benutzt, die
	    <code class="command">kinit</code> schon erhalten hat.
	    Wird die Antwort erfolgreich entschlüsselt,
	    erhält der Benutzer einen Sitzungs-Schlüssel
	    für die künftige verschlüsselte
	    Kommunikation mit dem <acronym class="acronym">KDC</acronym> und das
	    Ticket-Granting-Ticket.  Das Ticket-Granting-Ticket
	    wiederum ist mit dem Schlüssel des <acronym class="acronym">KDC</acronym>s
	    verschlüsselt.  Diese Verschlüsselung ist
	    für den Benutzer völlig transparent und
	    erlaubt dem <acronym class="acronym">KDC</acronym>,
	    die Echtheit jedes einzelnen <acronym class="acronym">TGT</acronym>
	    zu prüfen.</p></li><li class="listitem"><p>Wenn Sie <span class="application">OpenSSH</span> verwenden
	    und Tickets mir einer langen Gültigkeit
	    (beispielsweise einer Woche) benutzen, setzen Sie die Option
	    <code class="option">TicketCleanup</code> in der Datei
	    <code class="filename">sshd_config</code> auf <code class="literal">no</code>.
	    Ansonsten werden Ihre Tickets gelöscht, wenn Sie
	    sich abmelden.</p></li><li class="listitem"><p>Host-Prinzipale können ebenfalls Tickets mit
	    längerer Gültigkeit besitzen.  Wenn der
	    Prinzipal eines Benutzers über ein Ticket verfügt,
	    das eine Woche gültig ist, das Ticket des
	    Host-Prinzipals aber nur neun Stunden gültig ist,
	    funktioniert der Ticket-Cache nicht wie erwartet.
	    Im Cache befindet sich dann ein abgelaufenes Ticket
	    des Host-Prinzipals.</p></li><li class="listitem"><p>Wenn Sie mit <code class="filename">krb5.dict</code> die
	    Verwendung schlechter Passwörter verhindern wollen,
	    geht das nur mit Prinzipalen, denen eine Passwort-Policy
	    zugewiesen wurde.  Die Hilfeseite von
	    <code class="command">kadmind</code> beschreibt kurz, wie
	    <code class="filename">krb5.dict</code> verwendet wird.  Das
	    Format von <code class="filename">krb5.dict</code> ist
	    einfach:  Die Datei enthält pro Zeile ein Wort.
	    Sie können daher einen symbolischen Link auf
	    <code class="filename">/usr/share/dict/words</code> erstellen.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78723920"></a>15.7.7. Unterschiede zum <acronym class="acronym">MIT</acronym>-Port</h3></div></div></div><p>Der Hauptunterschied zwischen
	<acronym class="acronym">MIT</acronym>-<span class="application">Kerberos</span>
	und Heimdal-<span class="application">Kerberos</span>
	ist das Kommando <code class="command">kadmin</code>.
	Die Befehlssätze des Kommandos (obwohl funktional
	gleichwertig) und das verwendete
	Protokoll unterscheiden sich in beiden Varianten.
	Das <acronym class="acronym">KDC</acronym> lässt sich nur mit
	dem <code class="command">kadmin</code> Kommando der passenden
	<span class="application">Kerberos</span>-Variante verwalten.</p><p>Für dieselbe Funktion können auch die
	Client-Anwendungen leicht geänderte Kommandozeilenoptionen
	besitzen.  Folgen Sie bitte der Anleitung auf der
	<span class="application">Kerberos</span>-Seite
	(<code class="uri"><a class="uri" href="http://web.mit.edu/Kerberos/www/" target="_top">http://web.mit.edu/Kerberos/www/</a></code>) des
	<acronym class="acronym">MIT</acronym>s.  Achten Sie besonders auf den
	Suchpfad für Anwendungen.  Der <acronym class="acronym">MIT</acronym>-Port
	wird standardmäßig in
	<code class="filename">/usr/local/</code>
	installiert.  Wenn die Umgebungsvariable <code class="envar">PATH</code>
	zuerst die Systemverzeichnisse enthält, werden die
	Systemprogramme anstelle der <acronym class="acronym">MIT</acronym>-Programme
	ausgeführt.</p><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Wenn Sie den <acronym class="acronym">MIT</acronym>-Port
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/krb5/pkg-descr">security/krb5</a> verwenden,
	  erscheint bei der Anmeldung mit <code class="command">telnetd</code>
	  und <code class="command">klogind</code> die Fehlermeldung
	  <span class="errorname">incorrect permissions on cache file</span>.
	  Lesen Sie dazu bitte die im Port enthaltene Datei
	  <code class="filename">/usr/local/share/doc/krb5/README.FreeBSD</code>.
	  Wichtig ist, dass zur Authentifizierung die Binärdatei
	  <code class="command">login.krb5</code> verwendet wird, die
	  für durchgereichte Berechtigungen die Eigentümer
	  korrekt ändert.</p></div><p>In der Datei <code class="filename">rc.conf</code> müssen
	folgende Zeilen aufgenommen werden:</p><pre class="programlisting">kerberos5_server="/usr/local/sbin/krb5kdc"
kadmind5_server="/usr/local/sbin/kadmind"
kerberos5_server_enable="YES"
kadmind5_server_enable="YES"</pre><p>Diese Zeilen sind notwendig, weil die Anwendungen
	von <acronym class="acronym">MIT</acronym>-Kerberos Binärdateien
	unterhalb von <code class="filename">/usr/local</code> installieren.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78745552"></a>15.7.8. Beschränkungen von
	<span class="application">Kerberos</span></h3></div></div></div><a id="idp78746448" class="indexterm"></a><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78747600"></a>15.7.8.1. <span class="application">Kerberos</span> muss ganzheitlich
	  verwendet werden</h4></div></div></div><p>Jeder über das Netzwerk angebotetene Dienst
	  muss mit <span class="application">Kerberos</span>
	  zusammenarbeiten oder auf anderen Wegen gegen Angriffe
	  aus dem Netzwerk geschützt sein.  Andernfalls
	  können Berechtigungen gestohlen und wiederverwendet
	  werden.  Es ist beispielsweise nicht sinnvoll, für
	  Anmeldungen mit <code class="command">rsh</code> und
	  <code class="command">telnet</code> <span class="application">Kerberos</span>
	  zu benutzen, dagegen aber <acronym class="acronym">POP3</acronym>-Zugriff
	  auf einen Mail-Server zu erlauben, da <acronym class="acronym">POP3</acronym>
	  Passwörter im Klartext versendet.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78751568"></a>15.7.8.2. <span class="application">Kerberos</span> ist für
	  Einbenutzer-Systeme gedacht</h4></div></div></div><p>In Mehrbenutzer-Umgebungen ist
	  <span class="application">Kerberos</span> unsicherer als in
	  Einbenutzer-Umgebungen, da die Tickets im für alle
	  lesbaren Verzeichnis <code class="filename">/tmp</code>
	  gespeichert werden.  Wenn ein Rechner von mehreren
	  Benutzern verwendet wird, ist es möglich, dass
	  Tickets gestohlen werden.</p><p>Dieses Problem können Sie lösen, indem Sie mit
	  der Kommandozeilenoption <code class="option">-c</code> oder besser
	  mit der Umgebungsvariablen <code class="envar">KRB5CCNAME</code> einen
	  Ort für die Tickets vorgeben.  Diese Vorgehensweise
	  wird leider selten benutzt.  Es reicht, die Tickets
	  im Heimatverzeichnis eines Benutzers zu speichern und
	  mit Zugriffsrechten zu schützen.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78754896"></a>15.7.8.3. Das <acronym class="acronym">KDC</acronym> ist verwundbar</h4></div></div></div><p>Das <acronym class="acronym">KDC</acronym> muss genauso abgesichert
	  werden wie die auf ihm befindliche Passwort-Datenbank.
	  Auf dem <acronym class="acronym">KDC</acronym> dürfen keine anderen
	  Dienste laufen und der Rechner sollte physikalisch
	  gesichert sein.  Die Gefahr ist groß, da
	  <span class="application">Kerberos</span> alle Passwörter
	  mit einem Schlüssel, dem Haupt-Schlüssel,
	  verschlüsselt.  Der Haupt-Schlüssel wiederum
	  wird in einer Datei auf dem <acronym class="acronym">KDC</acronym>
	  gespeichert.</p><p>Ein kompromittierter Haupt-Schlüssel ist nicht
	  ganz so schlimm wie allgemein angenommen.  Der
	  Haupt-Schlüssel wird nur zum Verschlüsseln
	  der Passwort-Datenbank und zum Initialisieren des
	  Zufallsgenerators verwendet.  Solange der Zugriff
	  auf das <acronym class="acronym">KDC</acronym> abgesichert ist, kann
	  ein Angreifer wenig mit dem Haupt-Schlüssel
	  anfangen.</p><p>Wenn das <acronym class="acronym">KDC</acronym> nicht zur Verfügung
	  steht, vielleicht wegen eines Denial-of-Service Angriffs
	  oder wegen eines Netzwerkproblems, ist eine Authentifizierung
	  unmöglich.  Damit können die Netzwerk-Dienste
	  nicht benutzt werden; das <acronym class="acronym">KDC</acronym> ist
	  also ein optimales Ziel für einen Denial-of-Service
	  Angriff.  Sie können diesem Angriff ausweichen,
	  indem Sie mehrere <acronym class="acronym">KDC</acronym>s (einen Master
	  und einen oder mehrere Slaves) verwenden.  Der Rückfall
	  auf ein sekundäres <acronym class="acronym">KDC</acronym> oder
	  eine andere Authentifizierungs-Methode (dazu ist
	  <acronym class="acronym">PAM</acronym> bestens geeignet) muss sorgfältig
	  eingerichtet werden.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78761296"></a>15.7.8.4. Mängel von
	  <span class="application">Kerberos</span></h4></div></div></div><p>Mit <span class="application">Kerberos</span> können
	  sich Benutzer, Rechner und Dienste gegenseitig
	  authentifizieren.  Allerdings existiert kein Mechanismus,
	  der das <acronym class="acronym">KDC</acronym> gegenüber Benutzern,
	  Rechnern oder Diensten authentifiziert.  Ein verändertes
	  <code class="command">kinit</code> könnte beispielsweise alle
	  Benutzernamen und Passwörter abfangen.  Die von
	  veränderten Programmen ausgehende Gefahr können
	  Sie lindern, indem Sie die Integrität von Dateien
	  mit Werkzeugen wie
	  <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/tripwire/pkg-descr">security/tripwire</a>
	  prüfen.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78764368"></a>15.7.9. Weiterführende Dokumentation</h3></div></div></div><a id="idp78765008" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.faqs.org/faqs/Kerberos-faq/general/preamble.html" target="_top">The
            Kerberos FAQ</a></p></li><li class="listitem"><p><a class="link" href="http://web.mit.edu/Kerberos/www/dialogue.html" target="_top">Designing
	    an Authentication System: a Dialogue in Four
	    Scenes</a></p></li><li class="listitem"><p><a class="link" href="http://www.ietf.org/rfc/rfc1510.txt?number=1510" target="_top">RFC 1510,
	    The <span class="application">Kerberos</span> Network
	    Authentication Service (V5)</a></p></li><li class="listitem"><p><a class="link" href="http://web.mit.edu/Kerberos/www/" target="_top"><acronym class="acronym">MIT</acronym>
	    <span class="application">Kerberos</span>-Seite</a></p></li><li class="listitem"><p><a class="link" href="http://www.pdc.kth.se/heimdal/" target="_top">Heimdal
	    <span class="application">Kerberos</span>-Seite</a></p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="tcpwrappers.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="openssl.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">15.6. TCP-Wrapper </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> 15.8. OpenSSL</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>