<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>10.4. Erweiterte Drucker-Konfiguration</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Das FreeBSD-Handbuch" /><link rel="up" href="printing.html" title="Kapitel 10. Drucken" /><link rel="prev" href="printing-intro-setup.html" title="10.3. Grund-Konfiguration" /><link rel="next" href="printing-using.html" title="10.5. Drucker verwenden" /><link rel="copyright" href="legalnotice.html" title="Rechtlicher Hinweis" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">10.4. Erweiterte Drucker-Konfiguration</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="printing-intro-setup.html">Zurück</a> </td><th width="60%" align="center">Kapitel 10. Drucken</th><td width="20%" align="right"> <a accesskey="n" href="printing-using.html">Weiter</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="printing-advanced"></a>10.4. Erweiterte Drucker-Konfiguration</h2></div><div><span class="authorgroup">Übersetzt von <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Johann</span> <span class="surname">Kois</span></span>. </span></div></div></div><p>Dieser Abschnitt beschreibt den Einsatz von Filtern für
      das Drucken speziell formatierter Seiten oder von
      Deckblättern, das Drucken über ein Netzwerk sowie die
      Beschränkung und Verrechnung der Druckernutzung.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-filter-intro"></a>10.4.1. Filter</h3></div></div></div><a id="idp74151120" class="indexterm"></a><p>Obwohl <span class="application">LPD</span> Netzwerkprotokolle,
	Warteschlangen, Zugriffskontrollen und andere für das
	Drucken wichtige Aspekte prinzipiell unterstützt, passiert
	ein Großteil der <span class="emphasis"><em>wirklichen</em></span> Arbeit
	in den sogenannten <span class="emphasis"><em>Filtern</em></span>.  Dabei handelt
	es sich um Programme, die direkt mit einem Drucker kommunizieren
	und deren Gerätespezifika und spezielle Anforderungen
	erfüllen.  Im einfachsten Fall installiert man nur einen reinen
	Textfilter, der mit beinahe allen Druckern funktionieren sollte.
	(Lesen Sie dazu auch den Abschnitt <a class="link" href="printing-intro-setup.html#printing-textfilter" title="10.3.1.5.6. Den Textfilter installieren">Den Text-Filter
	installieren</a>.)</p><p>Um die erweiterten Fähigkeiten von Druckern auch
	einsetzen zu können, sollten Sie verstehen, wie Filter
	arbeiten, da diese für die Bereitstellung dieser Funktionen
	zuständig sind.  Die schlechte Nachricht ist, dass
	<span class="emphasis"><em>Sie</em></span> diese Filter bereitstellen müssen.
	Die gute Nachricht ist allerdings, dass diese in der Regel
	bereits vorhanden sind.  Ist dies nicht der Fall, können
	Sie einen Filter meist relativ einfach selbst erstellen.</p><p>Der Filter <code class="filename">/usr/libexec/lpr/lpf</code> wird
	bereits mit FreeBSD geliefert.  Er kümmert sich um die
	korrekte Behandlung von gelöschten Zeichen (das sogenannte
	<span class="foreignphrase"><em class="foreignphrase">Backspacing</em></span>), um im Text
	enthaltene Tabulatoren, sowie um die Verrechnung von
	Druckaufträgen.  Das ist aber auch alles, was dieser
	Filter kann.  Zusätzliche Filter und für die Funktion
	von Filtern nötige Komponenten finden sich aber in der
	FreeBSD Ports-Sammlung.</p><p>Dieser Abschnitt behandelt folgende Themen:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Der Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-filters" title="10.4.1.1. Die Funktionsweise von Filtern">
	    Die Funktionsweise von Filtern</a> versucht, einen
	    Überblick über die Rolle von Filtern innerhalb des
	    Druckprozesses zu geben.  Sie sollten diesen Abschnitt lesen,
	    damit Sie verstehen, was <span class="quote">&#8222;<span class="quote">unter der Haube</span>&#8220;</span>
	    passiert, wenn <span class="application">LPD</span> einen Filter
	    verwendet.  Dieses Wissen wird Ihnen dabei helfen, Probleme,
	    die bei Installation von Filtern für verschiedene Drucker
	    entstehen können, vorauszusehen und zu beheben.</p></li><li class="listitem"><p><span class="application">LPD</span> geht davon aus, dass
	    jeder Drucker in der Lage ist, normalen Text zu drucken.
	    Für <span class="trademark">PostScript</span>®- (oder andere sprachbasierte) Drucker
	    stellt dies allerdings ein Problem dar, da diese nicht in
	    der Lage sind, normalen Text direkt zu drucken.  Der
	    Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-if-conversion" title="10.4.1.2. Normalen Text auf PostScript®-Druckern drucken">Normalen Text auf
	    <span class="trademark">PostScript</span>®-Druckern drucken</a> beschreibt, wie Sie
	    dieses Problem lösen können.  Besitzen Sie einen
	    <span class="trademark">PostScript</span>®-Drucker, sollten Sie diesen Abschnitt lesen.</p></li><li class="listitem"><p><span class="trademark">PostScript</span>® ist ein populäres Ausgabeformat, das
	    von vielen Programmen unterstützt wird.  Es ist sogar
	    möglich, <span class="trademark">PostScript</span>®-Code direkt zu schreiben.  Leider
	    sind <span class="trademark">PostScript</span>®-Drucker in der Regel relativ teuer.  Der
	    Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-ps" title="10.4.1.3. PostScript® auf Nicht-PostScript®-Druckern emulieren"><span class="trademark">PostScript</span>®
	    auf Nicht-<span class="trademark">PostScript</span>®-Druckern emulieren</a> beschreibt,
	    wie Sie einen Textfilter anpassen müssen, um
	    <span class="trademark">PostScript</span>®-Daten auf einem
	    <span class="emphasis"><em>nicht-<span class="trademark">PostScript</span>®-fähigen Drucker</em></span>
	    auszugeben.  Haben Sie keinen <span class="trademark">PostScript</span>®-Drucker, sollten
	    Sie insbesondere diesen Abschnitt lesen.</p></li><li class="listitem"><p>Der Abschnitt
	    <a class="link" href="printing-advanced.html#printing-advanced-convfilters" title="10.4.1.4. Konvertierungsfilter">
	    Konvertierungsfilter</a> beschreibt eine Möglichkeit
	    zur automatischen Konvertierung verschiedener Dateiformate
	    in ein von Ihrem Drucker unterstütztes Format.  Nachdem
	    Sie diesen Abschnitt gelesen haben, werden Sie in der Lage
	    sein, Ihren Drucker so zu konfigurieren, dass Sie durch die
	    Eingabe von <code class="command">lpr -t</code> troff-Daten,
	    von <code class="command">lpr -d</code> <span class="application">TeX</span>-DVI-Daten,
	    oder von <code class="command">lpr -v</code> Rasterbilddaten
	    drucken können.
	    Daher sollten Sie diesen Abschnitt auf jeden Fall lesen.</p></li><li class="listitem"><p>Im Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-of" title="10.4.1.5. Ausgabefilter">
	    Ausgabefilter</a> wird eine nur selten genutzte
	    Eigenschaft von <span class="application">LPD</span>, die
	    sogenannten Ausgabefilter, beschrieben.  Wenn Sie keine
	    <a class="link" href="printing-advanced.html#printing-advanced-header-pages" title="10.4.2. Deckblätter">
	    Deckblätter</a> drucken müssen, können
	    Sie diesen Abschnitt überspringen.</p></li><li class="listitem"><p>Der Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-lpf" title="10.4.1.6. lpf: Ein Textfilter">lpf:
	    Ein Textfilter</a> beschreibt <code class="command">lpf</code>,
	    einen kompletten, wenn auch einfachen Textfilter für
	    Zeilendrucker (oder auch Laserdrucker, die sich analog
	    verhalten), der bereits mit FreeBSD geliefert wird.  Wenn
	    Sie nur am Ausdruck von reinem Text interessiert sind, oder
	    wenn Ihr Drucker nur <span class="quote">&#8222;<span class="quote">Schrott</span>&#8220;</span> produziert, wenn
	    er auf Backspace-Zeichen trifft, sollten Sie sich
	    <code class="command">lpf</code> näher ansehen.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Eine Kopie der verschiedenen Skripte finden Sie im
	  Verzeichnis <code class="filename">/usr/share/examples/printing</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-filters"></a>10.4.1.1. Die Funktionsweise von Filtern</h4></div></div></div><p>Bei einem Filter handelt es sich um ein ausführbares
	  Programm, das von <span class="application">LPD</span> gestartet
	  wird, um den geräteabhängigen Teil der Kommunikation
	  mit einem Drucker zu übernehmen.</p><p>Wenn <span class="application">LPD</span> eine Datei über
	  einen Druckauftrag drucken will, startet es ein Filterprogramm.
	  Danach setzt es die Standardeingabe des Filters auf die zu
	  druckende Datei, die Standardausgabe auf den Drucker und die
	  Standardfehlerausgabe auf <code class="filename">/dev/console</code> (Voreinstellung) oder auf
	  die über die Option <code class="literal">lf</code> in
	  <code class="filename">/etc/printcap</code> festgelegte Datei.</p><a id="idp74192464" class="indexterm"></a><p>Welcher Filter von <span class="application">LPD</span> mit
	  welchen Argumenten geladen wird, wird in der Datei
	  <code class="filename">/etc/printcap</code> oder durch die Argumente,
	  die der Anwender <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a> auf der Kommandozeile
	  übergibt, festgelegt.  Gibt der Anwender beispielsweise
	  <code class="command">lpr -t</code> ein, startet
	  <span class="application">LPD</span> über die
	  <code class="literal">tf</code>-Fähigkeit den troff-Filter für
	  den gewünschten Drucker.  Wollen Sie hingegen normalen
	  Text drucken, wird der <code class="literal">if</code>-Filter gestartet.
	  (Für Ausnahmen von diesem Vorgehen lesen Sie bitte den
	  Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-of" title="10.4.1.5. Ausgabefilter">
	  Ausgabefilter</a>.)</p><p>Es gibt drei Arten von Filtern, die Sie in
	  <code class="filename">/etc/printcap</code> angeben können:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>Textfilter</em></span> (die in der
	      <span class="application">LPD</span>-Dokumentation als
	      <span class="emphasis"><em>input filter</em></span> bezeichnet werden) sind
	      für den Druck von normalem Text zuständig.
	      Es handelt sich dabei um eine Art Standardfilter, da
	      <span class="application">LPD</span> von jedem Drucker erwartet,
	      dass er normalen Text drucken kann.  Aufgabe des
	      Textfilters ist es, sicherzustellen, dass gelöschte
	      Zeichen (<span class="foreignphrase"><em class="foreignphrase">Backspaces</em></span>),
	      Tabulatoren und andere Sonderzeichen Ihren Drucker nicht
	      verwirren.  Falls Sie für die Nutzung eines Druckers
	      bezahlen müssen, kann der Textfilter über die
	      Anzahl der gedruckten Zeilen auch die Anzahl der von Ihnen
	      gedruckten Seiten ermitteln.  Der Textfilter wird mit
	      folgenden Argumenten gestartet:</p><div class="cmdsynopsis"><p><code class="command">filter-name</code> [-c]  -w <em class="replaceable"><code>width</code></em>   -l <em class="replaceable"><code>length</code></em>   -i <em class="replaceable"><code>indent</code></em>   -n <em class="replaceable"><code>login</code></em>   -h <em class="replaceable"><code>host</code></em>   <em class="replaceable"><code>acct-file</code></em> </p></div><p>Die einzelnen Argumente haben folgende Bedeutung:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-c</code></span></dt><dd><p>Notwendig, wenn <code class="command">lpr
                      -l</code> verwendet wird.</p></dd><dt><span class="term"><em class="replaceable"><code>width</code></em></span></dt><dd><p>Der Wert der in
                      <code class="filename">/etc/printcap</code> festgelegten
                      Option <code class="literal">pw</code> (<span class="foreignphrase"><em class="foreignphrase">page
                      width</em></span>).  In der Voreinstellung
                      ist dieser Wert auf 132 gesetzt.</p></dd><dt><span class="term"><em class="replaceable"><code>length</code></em></span></dt><dd><p>Der Wert der
                      <code class="literal">pl</code>-Fähigkeit
                      (<span class="foreignphrase"><em class="foreignphrase">page length</em></span>),
                      Voreinstellung 66.</p></dd><dt><span class="term"><em class="replaceable"><code>indent</code></em></span></dt><dd><p>Der durch <code class="command">lpr
                      -i</code> festgelegte Einzug,
                      Voreinstellung 0.</p></dd><dt><span class="term"><em class="replaceable"><code>login</code></em></span></dt><dd><p>Der Name des Benutzers, der die Datei
                      druckt.</p></dd><dt><span class="term"><em class="replaceable"><code>host</code></em></span></dt><dd><p>Der Rechner, auf dem der Druckauftrag
                      gestartet wurde.</p></dd><dt><span class="term"><em class="replaceable"><code>acct-file</code></em></span></dt><dd><p>Der Name der Verrechnungsdatei, in der die
                      Ergebnisse der
                      <code class="literal">af</code>-Fähigkeit gespeichert
                      werden.</p></dd></dl></div></li><li class="listitem"><p>Ein
	    <span class="emphasis"><em>Konvertierungsfilter</em></span><a id="idp74231376" class="indexterm"></a>
	      konvertiert verschiedene Dateiformate in ein Format, das
	      Ihr Drucker auf Papier ausgeben kann.  So kann etwa der
	      ditroff-Schriftsatz nicht direkt gedruckt werden, daher
	      müssen Sie einen Konvertierungsfilter installieren, um
	      diese Daten in ein Format zu bringen, das Ihr Drucker
	      verarbeiten und drucken kann.  Der Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-convfilters" title="10.4.1.4. Konvertierungsfilter">
	      Konvertierungsfilter</a> enthält ausführliche
	      Informationen zu diesen Filtern.  Konvertierungsfilter
	      können auch zur Verrechnung verwendet werden.  Sie
	      werden mit folgenden Argumenten gestartet:</p><div class="cmdsynopsis"><p><code class="command">filter-name</code>  -x <em class="replaceable"><code>pixel-width</code></em>   -y <em class="replaceable"><code>pixel-height</code></em>   -n <em class="replaceable"><code>login</code></em>   -h <em class="replaceable"><code>host</code></em>   <em class="replaceable"><code>acct-file</code></em> </p></div><p><em class="replaceable"><code>pixel-width</code></em> ist der Wert
                der <code class="literal">px</code>-Fähigkeit (Voreinstellung 0),
                während <em class="replaceable"><code>pixel-height</code></em> dem Wert
                der <code class="literal">py</code>-Fähigkeit (Voreinstellung
                ebenfalls 0) entspricht.</p></li><li class="listitem"><p><span class="emphasis"><em>Ausgabefilter</em></span> werden nur verwendet, wenn
              keine Textfilter vorhanden sind oder wenn Deckblätter
              benötigt werden.  Der Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-of" title="10.4.1.5. Ausgabefilter">Ausgabefilter</a>
              enthält weitere Informationen.  Ausgabefilter
              unterstützen nur zwei Argumente:</p><div class="cmdsynopsis"><p><code class="command">filter-name</code>  -w <em class="replaceable"><code>width</code></em>   -l <em class="replaceable"><code>length</code></em> </p></div><p>Beide Argumente entsprechen den Optionen
                <code class="option">-w</code> und <code class="option">-l</code> der
                Textfilter.</p></li></ul></div><p>Alle Filter sollten mit folgenden Rückgabewerten
          (Exitcodes) <span class="emphasis"><em>beendet</em></span> werden:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">exit 0</span></dt><dd><p>Der Filter hat die Datei erfolgreich gedruckt.</p></dd><dt><span class="term">exit 1</span></dt><dd><p>Der Filter war nicht in der Lage, die Datei zu
                drucken und meldet diesen Exitcode an
                <span class="application">LPD</span>, um die Datei erneut
                zu drucken.  <span class="application">LPD</span> startet
                daraufhin den Filter erneut.</p></dd><dt><span class="term">exit 2</span></dt><dd><p>Der Filter war nicht in der Lage, die Datei zu
                drucken.  Bei diesem Exitcode soll
                <span class="application">LPD</span> aber nicht versuchen,
                die Datei erneut zu drucken, sondern den Druckauftrag
                verwerfen.</p></dd></dl></div><p><code class="filename">/usr/libexec/lpr/lpf</code>, der mit FreeBSD
	  gelieferte Textfilter, nutzt die Argumente <span class="foreignphrase"><em class="foreignphrase">page
	  width</em></span> und <span class="foreignphrase"><em class="foreignphrase">page
	  length</em></span>, um festzulegen, wann ein Seitenumbruch
	  (<span class="foreignphrase"><em class="foreignphrase">form feed</em></span>) gesendet werden
	  soll sowie zur Verrechnung von Druckaufträgen.  Dazu werden
	  der Benutzername, der für den Druckauftrag verwendete
	  Rechner sowie die Verrechnungsdatei ausgewertet, um die
	  entsprechenden Einträge zu erstellen.</p><p>Wenn Sie auf der Suche nach Filtern sind, achten Sie
	  darauf, dass diese LPD-kompatibel sind.  Dazu müssen
	  diese die oben beschriebenen Argumente unterstützen.
	  Wenn Sie planen, Ihre Filter selbst zu erstellen, müssen
	  diese ebenfalls die gleichen Argumente und Exitcodes
	  unterstützen.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-if-conversion"></a>10.4.1.2. Normalen Text auf <span class="trademark">PostScript</span>®-Druckern drucken</h4></div></div></div><a id="idp74280272" class="indexterm"></a><p>Sie sind der alleinige Benutzer Ihres Computers und Ihres
	  <span class="trademark">PostScript</span>®-Druckers und Sie sind sich sicher, dass Sie
	  niemals normalen Text an Ihren Drucker senden werden?
	  Außerdem werden Sie niemals ein Programm verwenden,
	  um normalen Text auszudrucken?  Nur wenn dies alles zutrifft,
	  können Sie diesen Abschnitt überspringen.</p><p>Wollen Sie allerdings sowohl <span class="trademark">PostScript</span>® als auch
	  normalen Text drucken, müssen Sie Ihren Drucker zuvor
	  entsprechend konfigurieren.  Dazu muss Ihr Textfilter in der
	  Lage sein, zu unterscheiden, ob es sich bei einem ankommenden
	  Druckauftrag um normalen Text oder um <span class="trademark">PostScript</span>®-Daten
	  handelt.  Jeder <span class="trademark">PostScript</span>®-Druckauftrag muss mit den Zeichen
	  <code class="literal">%!</code> beginnen (sehen Sie in Ihrem
	  Druckerhandbuch nach, ob Ihr Drucker weitere Sprachen
	  unterstützt).  Sind dies die beiden ersten Zeichen eines
	  Druckauftrages, so handelt es sich um <span class="trademark">PostScript</span>®-Daten, die
	  direkt gedruckt werden können.  Fehlen diese Zeichen allerdings,
	  muss der Textfilter den Inhalt der Datei nach <span class="trademark">PostScript</span>®
	  konvertieren, bevor die Datei gedruckt werden kann.</p><p>Wie funktioniert diese Unterscheidung?</p><a id="idp74285520" class="indexterm"></a><p>Haben Sie einen seriellen Drucker, können Sie
	  <code class="command">lprps</code> installieren.
	  <code class="command">lprps</code> ist ein <span class="trademark">PostScript</span>®-Druckerfilter,
	  der eine Zweiwegekommunikation mit einem Drucker
	  ermöglicht.  Er aktualisiert die Druckerstatusdatei mit
	  Protokollinformationen des Druckers.  Dadurch sind Anwender
	  und Administratoren in der Lage, den genauen Zustand des
	  Druckers zu prüfen (durch Meldungen wie <span class="errorname">toner
	  low</span> oder <span class="errorname">paper jam</span>).
	  Wichtiger ist allerdings, dass <code class="command">lprps</code>
	  <code class="command">psif</code> enthält, ein Programm, das
	  feststellen kann, ob ein ankommender Druckauftrag normalen
	  Text enthält.  Ist dies der Fall, wird
	  <code class="command">textps</code> (das ebenfalls mit
	  <code class="command">lprps</code> geliefert wird) aufgerufen und die
	  Datei nach <span class="trademark">PostScript</span>® konvertiert.  Danach kann
	  <code class="command">lprps</code> die Datei an den Drucker senden.</p><p><code class="command">lprps</code> ist in der FreeBSD
	  <a class="link" href="ports.html" title="Kapitel 5. Installieren von Anwendungen: Pakete und Ports">Ports-Sammlung</a> enthalten.  Je
	  nach der von Ihnen verwendeten Papiergröße
	  installieren Sie dazu den Port <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print/lprps-a4/pkg-descr">print/lprps-a4</a> oder <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print/lprps-letter/pkg-descr">print/lprps-letter</a>.  Nach
	  der Installation müssen Sie nur noch den Pfad zum
	  Programm <code class="command">psif</code> angeben, das als Teil von
	  <code class="command">lprps</code> installiert wird.  Haben Sie
	  <code class="command">lprps</code> über die Ports-Sammlung installiert,
	  fügen Sie folgende Zeile in den Eintrag Ihres
	  <span class="trademark">PostScript</span>®-Druckers in
	  <code class="filename">/etc/printcap</code> ein:</p><pre class="programlisting">:if=<code class="filename">/usr/local/libexec/psif</code>:</pre><p>Zusätzlich sollten Sie die
	  <code class="literal">rw</code>-Fähigkeit aktivieren, um
	  <span class="application">LPD</span> im Schreib- und Lesemodus
	  zu öffnen.</p><p>Haben Sie hingegen einen parallelen <span class="trademark">PostScript</span>®-Drucker,
	 was eine Zweiwegekommunikation mit Ihrem Drucker (auf die
	 <code class="command">lprps</code> angewiesen ist) unmöglich
	 macht, können Sie das folgende Shell-Skript verwenden:</p><pre class="programlisting">#!/bin/sh
#
#  psif - Drucke PostScript oder normalen Text auf einem PostScript-Drucker
#  Script-Version; das ist NICHT die mit lprps gelieferte Version!
#  Installiert unter:  /usr/local/libexec/psif
#

IFS="" read -r first_line
first_two_chars=`expr "$first_line" : '\(..\)'`

if [ "$first_two_chars" = "%!" ]; then
    #
    #  PostScript - einfach drucken.
    #
    echo "$first_line" &amp;&amp; cat &amp;&amp; printf "\004" &amp;&amp; exit 0
    exit 2
else
    #
    #  Normaler Text - zuerst konvertieren, dann drucken.
    #
    ( echo "$first_line"; cat ) | /usr/local/bin/textps &amp;&amp; printf "\004" &amp;&amp; exit 0
    exit 2
fi      </pre><p>Für dieses Skript wurde <code class="command">textps</code>
	  als seperates Programm installiert, um normalen Text nach
	  <span class="trademark">PostScript</span>® zu konvertieren.  Sie können aber auch jeden
	  anderen Text-nach-<span class="trademark">PostScript</span>®-Konverter verwenden.  Die
	  FreeBSD <a class="link" href="ports.html" title="Kapitel 5. Installieren von Anwendungen: Pakete und Ports">Ports-Sammlung</a>
	  enthält mit <code class="literal">a2ps</code> ein umfangreiches
	  Programm zur Konvertierung von normalem Text nach
	  <span class="trademark">PostScript</span>®.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-ps"></a>10.4.1.3. <span class="trademark">PostScript</span>® auf Nicht-<span class="trademark">PostScript</span>®-Druckern emulieren</h4></div></div></div><a id="idp74308432" class="indexterm"></a><a id="idp74309584" class="indexterm"></a><p>Bei <span class="trademark">PostScript</span>® handelt es sich um den
	  <span class="emphasis"><em>de facto</em></span>-Standard für hochwertigen
	  Schriftsatz und Druck.  Leider ist <span class="trademark">PostScript</span>® aber auch ein
	  <span class="emphasis"><em>teurer</em></span> Standard.  Glücklicherweise
	  hat Aladdin Enterprises daher eine freie
	  <span class="trademark">PostScript</span>®-ähnliche Implementierung namens
	  <span class="application">Ghostscript</span> entwickelt, die auch
	  unter FreeBSD lauffähig ist.
	  <span class="application">Ghostscript</span> kann fast jede
	  <span class="trademark">PostScript</span>®-Datei lesen und auf den verschiedensten
	  Geräten ausgeben, darunter auch auf vielen
	  Nicht-<span class="trademark">PostScript</span>®-Druckern.  Durch die Installation von
	  <span class="application">Ghostscript</span> und die Nutzung eines
	  speziellen Textfilters erreichen Sie, dass sich Ihr
	  Nicht-<span class="trademark">PostScript</span>®-Drucker wie ein echter <span class="trademark">PostScript</span>®-Drucker
	  verhält.</p><p><span class="application">Ghostscript</span> ist in
	  verschiedenen Versionen in der FreeBSD Ports-Sammlung enhalten,
	  die am häfigsten verwendete Version ist <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print/ghostscript-gpl/pkg-descr">print/ghostscript-gpl</a>.</p><p>Um <span class="trademark">PostScript</span>® zu emulieren, muss der Textfilter erkennen, ob er
	  eine <span class="trademark">PostScript</span>®-Datei drucken soll.  Ist dies nicht der Fall, wird
	  die Datei direkt an den Drucker geschickt.  Anderenfalls wird die
	  Datei an <span class="application">Ghostscript</span> übergeben, das
	  die Datei in ein Format konvertiert, das Ihr Drucker versteht.</p><p>Dazu ein Beispiel.  Das folgende Skript ist ein Textfilter
	  für den Drucker DeskJet 500 von Hewlett Packard.  Nutzen
	  Sie einen anderen Drucker, müssen Sie die Option
	  <code class="option">-sDEVICE</code> beim Aufruf von <code class="command">gs</code>
	  (Ghostscript) entsprechend anpassen.  Eine Liste der von
	  <span class="application">Ghostscript</span> unterstützten
	  Geräte erhalten Sie durch die Eingabe von
	  <code class="command">gs -h</code> auf der
	  Kommandozeile.</p><pre class="programlisting">#!/bin/sh
#
#  ifhp - Ghostscript-emuliertes PostScript auf einem HP DeskJet 500 drucken
#  Installiert unter:  /usr/local/libexec/ifhp

#
#  LF als CR+LF behandeln (um einen "Treppeneffekt" auf HP/PCL-Drucker
#  zu vermeiden)
#
printf "\033&amp;k2G" || exit 2

#
#  Lies die ersten zwei Zeichen der Datei
#
IFS="" read -r first_line
first_two_chars=`expr "$first_line" : '\(..\)'`

if [ "$first_two_chars" = "%!" ]; then
    #
    #  Oh.  Es ist PostScript; mit Ghostscript konvertieren, danach drucken.
    #
    /usr/local/bin/gs -dSAFER -dNOPAUSE -q -sDEVICE=djet500 \
      -sOutputFile=- - &amp;&amp; exit 0
else
    #
    #  Normaler Text oder HP/PCL, einfach direkt drucken.  Ans Ende setzen wir
    #  einen Seitenumbruch (also ein Form Feed), damit auch die letzte Seite
    #  ausgeworfen wird.
    #
    echo "$first_line" &amp;&amp; cat &amp;&amp; printf "\033&amp;l0H" &amp;&amp;
exit 0
fi

exit 2</pre><p>Zuletzt müssen Sie <span class="application">LPD</span>
	  noch durch die <code class="literal">if</code>-Fähigkeit über
	  den neuen Filter informieren:</p><pre class="programlisting">:if=<code class="filename">/usr/local/libexec/ifhp</code>:</pre><p>Das ist alles.  Ab sofort sollte sowohl ein <code class="command">lpr
	  normaler.text</code>
	  als auch ein <code class="command">lpr wasauchimmer.ps</code>
	  funktionieren und beide Dateien sollten problemlos gedruckt
	  werden.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-convfilters"></a>10.4.1.4. Konvertierungsfilter</h4></div></div></div><p>Nachdem Sie Ihren Drucker wie unter <a class="link" href="printing-intro-setup.html#printing-simple" title="10.3.1. Einfache Drucker-Konfiguration">Einfache Drucker-Konfiguration</a>
	  eingerichtet haben, wollen Sie wahrscheinlich einige
	  Konvertierungsfilter installieren, damit Sie (abgesehen von
	  ASCII-Text) auch Ihre Lieblings-Dateiformate drucken
	  können.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74334800"></a>10.4.1.4.1. Warum sollte ich einen Konvertierungsfilter
	    installieren?</h5></div></div></div><a id="idp74335440" class="indexterm"></a><p>Konvertierungsfilter erleichtern das Drucken von
	    verschiedenen Dateiformaten.  Nehmen wir beispielsweise an,
	    dass Sie sehr viel mit dem <span class="application">TeX</span>-Satzsystem arbeiten und
	    über einen <span class="trademark">PostScript</span>®-Drucker verfügen.  Eine
	    vom <span class="application">TeX</span>-System erzeugte DVI-Datei kann erst dann gedruckt
	    werden, nachdem diese nach <span class="trademark">PostScript</span>® konvertiert wurde.
	    Dazu geben Sie Folgendes ein:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>dvips seaweed-analysis.dvi</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>lpr seaweed-analysis.ps</code></strong></pre><p>Haben Sie einen Konvertierungsfilter für DVI-Dateien
	    installiert, können Sie die manuelle Konvertierung
	    überspringen, da dies nun <span class="application">LPD</span>
	    für Sie erledigt.  Wollen Sie eine DVI-Datei drucken, geben
	    Sie nur noch den folgenden Befehl ein:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpr -d seaweed-analysis.dvi</code></strong></pre><p>Durch die Verwendung der Option <code class="option">-d</code>
	    wurde <span class="application">LPD</span> angewiesen, unsere
	    DVI-Datei vor dem Druck zu konvertieren.  Der Abschnitt
	    <a class="link" href="printing-using.html#printing-lpr-options-format" title="10.5.4.1. Formatierungs- und Konvertierungsoptionen">Formatierungs-
	    und Konvertierungsoptionen</a> beschreibt die dabei
	    möglichen Optionen.</p><p>Für jede Konvertierungsoption, die Ihr Drucker
	    unterstützen soll, müssen Sie einen eigenen
	    <span class="emphasis"><em>Konvertierungsfilter</em></span> installieren und
	    dessen Pfad in der Datei <code class="filename">/etc/printcap</code>
	    angeben.  Ein Konvertierungsfilter verhält sich im
	    Prinzip wie ein Textfilter bei einer einfachen
	    Druckerkonfiguration (lesen Sie dazu auch den Abschnitt <a class="link" href="printing-intro-setup.html#printing-textfilter" title="10.3.1.5.6. Den Textfilter installieren">Den Textfilter installieren</a>),
	    allerdings konvertiert er die Datei in ein Format, das Ihr Drucker
	    versteht, anstatt normalen Text zu drucken.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74345936"></a>10.4.1.4.2. Welche Konvertierungsfilter sollte ich installieren?</h5></div></div></div><p>Sie sollten nur Filter installieren, die Sie auch
	    benötigen.  Wenn Sie sehr viele DVI-Dateien drucken,
	    sollten Sie auch einen DVI-Konvertierungsfilter installieren.
	    Müssen Sie viele troff-Daten drucken, ist ein troff-Filter
	    hilfreich.</p><p>Die folgende Tabelle listet die von
	    <span class="application">LPD</span> unterstützten Filter
	    sowie die Einträge in <code class="filename">/etc/printcap</code> auf,
	    mit denen Sie diese Fähigkeiten aktivieren.  Zusätzlich
	    wird angegeben, wie Sie <code class="command">lpr</code> jeweils
	    aufrufen müssen:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Dateityp</th><th><code class="filename">/etc/printcap</code>-Fähigkeit</th><th><code class="command">lpr</code>-Option</th></tr></thead><tbody><tr><td>cifplot</td><td><code class="literal">cf</code></td><td><code class="option">-c</code></td></tr><tr><td>DVI</td><td><code class="literal">df</code></td><td><code class="option">-d</code></td></tr><tr><td>plot</td><td><code class="literal">gf</code></td><td><code class="option">-g</code></td></tr><tr><td>ditroff</td><td><code class="literal">nf</code></td><td><code class="option">-n</code></td></tr><tr><td>FORTRAN-Text</td><td><code class="literal">rf</code></td><td><code class="option">-f</code></td></tr><tr><td>troff</td><td><code class="literal">tf</code></td><td><code class="option">-f</code></td></tr><tr><td>Rasterdaten</td><td><code class="literal">vf</code></td><td><code class="option">-v</code></td></tr><tr><td>Normaler Text</td><td><code class="literal">if</code></td><td>keine, <code class="option">-p</code>, or
                    <code class="option">-l</code></td></tr></tbody></table></div><p>Wollen Sie also <code class="command">lpr -d</code>
	    verwenden, muss die <code class="literal">df</code>-Fähigkeit in
	    <code class="filename">/etc/printcap</code> aktiviert sein.</p><a id="idp74377424" class="indexterm"></a><p>Obwohl manche Leute etwas anderes behaupten, sind
	    Formate wie FORTRAN-Text und -Plot inzwischen nahezu
	    obsolet.  Wenn Sie diese Formate dennoch benötigen,
	    installieren Sie einfach einen angepassten Filter.  Wollen
	    Sie beispielsweise zwar Printerleaf-Dateien (also Dateien des
	    Desktop Publishing-Programms von Interleaf), aber keine
	    Plotdateien drucken, so können Sie einen
	    Printerleaf-Konvertierungsfilter installieren, der es durch
	    die Aktivierung der <code class="literal">gf</code>-Fähigkeit
	    erlaubt, diese Dateien direkt zu drucken.  Nun müssen
	    Sie Ihren Mitarbeitern nur noch mitteilen, dass
	    <code class="command">lpr -g</code> nun für
	    <span class="quote">&#8222;<span class="quote">drucke Printerleaf-Dateien</span>&#8220;</span> steht.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74379600"></a>10.4.1.4.3. Konvertierungsfilter installieren</h5></div></div></div><p>Da Konvertierungsfilter nicht zum Basissystem von FreeBSD
	    gehören, sollten diese unter <code class="filename">/usr/local</code> installiert werden.
	    Häufig wird das Verzeichnis <code class="filename">/usr/local/libexec</code> verwendet, da es
	    sich bei Konvertierungsfiltern um spezielle Programme
	    handelt, die nur von <span class="application">LPD</span>, aber
	    nicht von einem normalen Benutzer gestartet werden.</p><p>Um einen Konvertierungsfilter zu aktivieren, müssen
	    Sie dessen Pfad zusätzlich zur benötigten Fähigkeit
	    in der Datei <code class="filename">/etc/printcap</code> eintragen.</p><p>In unserem Beispiel wollen wir einen
	    DVI-Konvertierungsfilter für den Drucker
	    <code class="literal">bamboo</code> installieren.  Unsere bereits
	    bekannte <code class="filename">/etc/printcap</code> wurde
	    allerdings um die <code class="literal">df</code>-Fähigkeit
	    für den Drucker <code class="literal">bamboo</code> erweitert:</p><pre class="programlisting">#
#  /etc/printcap des Rechners rose - neuer df-Filter für bamboo
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=<code class="filename">/var/spool/lpd/rattan</code>:\
        :lp=<code class="filename">/dev/lpt0</code>:\
        :if=<code class="filename">/usr/local/libexec/if-simple</code>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<code class="filename">/var/spool/lpd/bamboo</code>:\
        :lp=<code class="filename">/dev/ttyu5</code>:ms#-parenb cs8 clocal crtscts:rw:\
        :if=<code class="filename">/usr/local/libexec/psif</code>:\
        :df=<code class="filename">/usr/local/libexec/psdf</code>:</pre><p>Beim DVI-Filter handelt es sich um ein Shell-Skript
	    namens <code class="filename">/usr/local/libexec/psdf</code>:</p><pre class="programlisting">#!/bin/sh
#
#  psdf - DVI-nach-PostScript Druckerfilter
#  Installiert unter:  /usr/local/libexec/psdf
#
#  Wird von lpd aktiviert, wenn der Nutzer lpr -d eingibt.
#
exec /usr/local/bin/dvips -f | /usr/local/libexec/lprps "$@"</pre><p>Dieses Skript startet <code class="command">dvips</code> im
	    Filtermodus (durch das Argument <code class="option">-f</code> wird der
	    Druckauftrag über die Standardeingabe entgegengenommen).
	    Danach wird der <span class="trademark">PostScript</span>®-Druckerfilter
	    <code class="command">lprps</code> (lesen Sie dazu auch den Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-if-conversion" title="10.4.1.2. Normalen Text auf PostScript®-Druckern drucken">Drucken von reinen
	    Textdateien auf einem <span class="trademark">PostScript</span>®-Drucker</a>) mit den von
	    <span class="application">LPD</span> übergebenen Argumenten
	    gestartet.  Das <code class="command">lprps</code>-Werkzeug wiederum nutzt
	    diese Argumente, um die gedruckten Seiten zu verrechnen.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74401104"></a>10.4.1.4.4. Beispiele für Konvertierungsfilter</h5></div></div></div><p>Da es keine verbindliche Prozedur zur Installation eines
	    Druckerfilters gibt, folgen nun weitere Beispiele in diesem
	    Abschnitt.  Verwenden Sie diese, um Ihre eigenen Filter zu
	    erstellen.  Falls ein Filter Ihren Anforderungen bereits
	    entspricht, können Sie ihn auch direkt verwenden.</p><p>Das erste Beispiel beschreibt einen Konvertierungsfilter
            für GIF-Dateien für den Drucker LaserJet III-Si von
            Hewlett Packard:</p><pre class="programlisting">#!/bin/sh
#
#  hpvf - Konvertiert GIF-Dateien nach HP/PCL, danach wird gedruckt.
#  Installiert unter:  /usr/local/libexec/hpvf

PATH=/usr/X11R6/bin:$PATH; export PATH
giftopnm | ppmtopgm | pgmtopbm | pbmtolj -resolution 300 \
    &amp;&amp; exit 0 \
    || exit 2</pre><p>Dieser Filter konvertiert eine GIF-Datei in eine portable
	    Anymap, diese in ein portables Graustufenbild, dieses wiederum in
	    eine portable Bitmap, die schließlich in ein
	    LaserJet/PCL-kompatibles Format umgewandelt wird.</p><p><code class="filename">/etc/printcap</code> muss für einen Drucker,
	    der diesen Filter nutzen will, folgenden Eintrag enthalten:</p><pre class="programlisting">#
#  /etc/printcap des Rechners orchid
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=<code class="filename">/dev/lpt0</code>:sh:sd=<code class="filename">/var/spool/lpd/teak</code>:mx#0:\
        :if=<code class="filename">/usr/local/libexec/hpif</code>:\
        :vf=<code class="filename">/usr/local/libexec/hpvf</code>:</pre><p>Das folgende Skript ist ein Konvertierungsfilter, der
	    das Drucken von troff-Daten des groff-Textsatzsystems
	    auf dem <span class="trademark">PostScript</span>®-Drucker <code class="literal">bamboo</code>
	    ermöglicht:</p><pre class="programlisting">#!/bin/sh
#
#  pstf - Konvertiert groff's troff-Daten nach PS, dann wird gedruckt.
#  Installiert unter:  /usr/local/libexec/pstf
#
exec grops | /usr/local/libexec/lprps "$@"</pre><p>Dieses Skript nutzt wiederum <code class="command">lprps</code>,
	    um mit dem Drucker zu kommunizieren.  Wäre der Drucker
	    an einem parallelen Port angeschlossen, würde das Skript
	    so aussehen:</p><pre class="programlisting">#!/bin/sh
#
#  pstf - Konvertiert groff's troff-Daten nach PS, danach wird gedruckt.
#  Installiert unter:  /usr/local/libexec/pstf
#
exec grops</pre><p>Das ist alles.  Um den Filter verwenden zu können,
	    müssen Sie ihn allerdings noch in
	    <code class="filename">/etc/printcap</code> aktivieren:</p><pre class="programlisting">:tf=<code class="filename">/usr/local/libexec/pstf</code>:</pre><p>Das nächste Skript ist ein FORTRAN-Textfilter
	    für jeden Drucker, der normalen Text direkt drucken
	    kann und der hier für den Drucker
	    <code class="literal">teak</code> installiert wird:</p><pre class="programlisting">#!/bin/sh
#
# hprf - FORTRAN-Textfilter für den Drucker LaserJet 3si:
# Installiert unter:  /usr/local/libexec/hprf
#

printf "\033&amp;k2G" &amp;&amp; fpr &amp;&amp; printf "\033&amp;l0H" &amp;&amp;
 exit 0
exit 2    </pre><p>Zusätzlich benötigen wir wiederum einen Eintrag in
	    <code class="filename">/etc/printcap</code>, um diesen Filter für den
	    Drucker <code class="literal">teak</code> zu aktivieren:</p><pre class="programlisting">:rf=<code class="filename">/usr/local/libexec/hprf</code>:</pre><p>Das letzte Beispiel ist etwas komplexer.  Es soll ein
	    DVI-Filter für den bereits erwähnten
	    LaserJet-Drucker <code class="literal">teak</code> installiert werden.
	    Der erste Teil ist einfach:  Sie müssen den Pfad des
	    DVI-Filters in <code class="filename">/etc/printcap</code> eintragen:</p><pre class="programlisting">:df=<code class="filename">/usr/local/libexec/hpdf</code>:</pre><p>Nun kommt der schwierige Teil:  Sie müssen den
	    Filter funktionsfähig machen.  Dazu benötigen Sie
	    einen DVI-nach-LaserJet/PCL-Konverter.
	    Glücklicherweise enthält die FreeBSD <a class="link" href="ports.html" title="Kapitel 5. Installieren von Anwendungen: Pakete und Ports">Ports-Sammlung</a> mit <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print/dvi2xx/pkg-descr">print/dvi2xx</a> ein solches Programm.  Nach
	    der Installation des Pakets verfügen wir über das
	    Programm <code class="command">dvilj2p</code>, das zur Konvertierung
	    von DVI-Daten in zu den Druckern LaserJet IIp, LaserJet III,
	    sowie LaserJet 2000 kompatible Codes benötigt wird.</p><p>Durch den Einsatz von <code class="command">dvilj2p</code> wird
	    der Filter <code class="command">hpdf</code> relativ komplex, da
	    <code class="command">dvilj2p</code> nicht von der Standardeingabe
	    lesen kann, sondern als Eingabe einen Dateinamen erwartet.
	    Zusätzlich muss der Dateiname auf <code class="filename">.dvi</code>
	    enden, daher ist die Verwendung von <code class="filename">/dev/fd/0</code> als Standardeingabe
	    problematisch.  Wir können diese Problem aber umgehen, indem
	    wir einen temporären Dateinamen symbolisch nach <code class="filename">/dev/fd/0</code> linken.
	    Dadurch wird <code class="command">dvilj2p</code> gezwungen, dennoch von der
	    Standardeingabe zu lesen.</p><p>Das letzte Problem, das wir noch lösen müssen,
	    ist, dass wir <code class="filename">/tmp</code> nicht als
	    temporären Link verwenden können.  Symbolische
	    Links gehören dem User sowie der Gruppe
	    <code class="systemitem">bin</code>.  Der Filter läuft aber als
	    User <code class="systemitem">daemon</code>.  Außerdem ist
	    <code class="filename">/tmp</code> durch ein Sticky-Bit
	    gesichert.  Daher kann der Filter den Link zwar erzeugen, ein
	    Aufräumen ist aber nicht mehr möglich, weil sich
	    die Eigentümer des Filters und des temporären
	    Verzeichnisses unterscheiden.</p><p>Daher legt der Filter den symbolischen Link im
	    Arbeitsverzeichnis an, das gleichzeitig als Spooling-Verzeichnis
	    dient (festgelegt durch die Aktivierung
	    der <code class="literal">sd</code>-Fähigkeit in
	    <code class="filename">/etc/printcap</code>).  Das Arbeitsverzeichnis
	    ist ein idealer Ort für den Filter, insbesondere da dieses
	    (manchmal) sogar über mehr freien Speicherplatz als <code class="filename">/tmp</code> verfügt.</p><p>Mit diesen Informationen sind wir nun in der Lage, den
	    Filter zu entwickeln:</p><pre class="programlisting">#!/bin/sh
#
#  hpdf - DVI-Daten auf einen HP/PCL-Drucker drucken
#  Installiert unter:  /usr/local/libexec/hpdf

PATH=/usr/local/bin:$PATH; export PATH

#
#  Eine Funktion zum Aufräumen unserer temporären Dateien.
#  Diese finden sich im Arbeitsverzeichnis, das wir auch als
#  Spooling-Verzeichnis für unseren Drucker verwenden werden.
#
cleanup() {
   rm -f hpdf$$.dvi
}

#
#  Eine Funktion, um fatale Fehler zu behandeln.  Dazu die Meldung
#  ausgeben, danach ein exit 2.  Dadurch weiß LPD, dass es
#  den Auftrag nicht noch einmal drucken soll.
#
fatal() {
    echo "$@" 1&gt;&amp;2
    cleanup
    exit 2
}

#
#  Wenn ein Anwender den Auftrag entfernt, sendet LPD ein SIGINT, daher
#  wollen wir SIGINT und einige andere Signale abfangen (trappen), um
#  nach der Konvertierung aufräumen zu können.
#
trap cleanup 1 2 15

#
#  Bevor wir anfangen, räumen wir noch auf.  Sicher ist sicher.
#
cleanup

#
#  Die DVI-Eingabedatei auf die Standardeingabe linken (die zu druckende
#  Datei).
#
ln -s /dev/fd/0 hpdf$$.dvi || fatal "Konnte Symlink nicht anlegen!"

#
#  Umwandeln: LF = CR+LF
#
printf "\033&amp;k2G" || fatal "Konnte Drucker nicht initialisieren!"

#
#  Konvertieren und drucken.  Da der Rückgabewert von dvilj2p
#  unzuverlässig ist, ignorieren wir ihn einfach.
#
dvilj2p -M1 -q -e- dfhp$$.dvi

#
#  Aufräumen und beenden.
#
cleanup
exit 0    </pre></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-autoconv"></a>10.4.1.4.5. Automatische Konvertierung:  Eine Alternative zu
	    Konvertierungsfiltern</h5></div></div></div><p>Alle in diesem Abschnitt besprochenen Konvertierungsfilter sind
	    zwar sehr hilfreich, allerdings müssen Sie nach wie vor bei
	    jedem Aufruf von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a> angeben, welchen Filter sie verwenden
	    wollen, was mit der Zeit sicher nervend wird.  Schlimmer ist
	    allerdings, dass die Auswahl eines unpassenden Filters dazu
	    führen kann, dass Sie Hunderte Seiten Papier ausdrucken.</p><p>Statt also Konvertierungsfilter zu installieren,
	    könnten Sie den Textfilter (der ohnehin der
	    Standardfilter ist) verwenden, um den zu druckenden
	    Dateityp zu erkennen und anschließend den korrekten
	    Konvertierungsfilter auszuwählen.  Um den Dateityp
	    zu bestimmen, können Sie beispielsweise
	    <code class="command">file</code> verwenden.  Leider ist es bei
	    <span class="emphasis"><em>einigen</em></span> Dateitypen problematisch, diese zu
	    unterscheiden.  Daher könnten Sie für diese Dateitypen
	    dennoch einen Konvertierungsfilter installieren.</p><a id="idp74428240" class="indexterm"></a><a id="idp74428752" class="indexterm"></a><p>Die FreeBSD Ports-Sammlung enthält mit
	    <code class="command">apsfilter</code> (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/print/apsfilter/pkg-descr">print/apsfilter</a>) einen Textfilter, der
	    diese automatische Konvertierung durchführen kann.  Er ist
	    in der Lage, normalen Text, <span class="trademark">PostScript</span>®, DVI und beinahe jede
	    Art von Datei zu erkennen, diese zu konvertieren und auf
	    Ihren Drucker auszugeben.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-of"></a>10.4.1.5. Ausgabefilter</h4></div></div></div><p><span class="application">LPD</span> unterstützt noch eine
	  weitere Filterart, die sogenannten Ausgabefilter.  Diese sind
	  &#8211; analog zu einem Textfilter &#8211; 
	  für den Druck von normalem Text ausgelegt, allerdings
	  verfügen sie im Vergleich zu diesen nur über
	  sehr eingeschränkte Fähigkeiten.  Wenn Sie einen
	  Ausgabefilter (aber keinen Textfilter) verwenden, dann</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>startet <span class="application">LPD</span> nur einen
	      Ausgabefilter für den kompletten Druckauftrag, statt
	      für jede Datei des Auftrags einen eigenen Filter zu
	      starten.</p></li><li class="listitem"><p>kümmert sich <span class="application">LPD</span> nicht
	      darum, den Beginn oder das Ende einer Datei innerhalb des
	      Druckauftrages zu finden.</p></li><li class="listitem"><p>übergibt <span class="application">LPD</span> weder
	      den Benutzer- noch den Rechnernamen desjenigen, der den
	      Druckauftrag erteilt hat, an den Ausgabefilter, was
	      eine Verrechnung von Druckaufträgen unmöglich
	      macht.  Ausgabefilter unterstützen insgesamt nur
	      zwei Argumente:</p><div class="cmdsynopsis"><p><code class="command">filter-name</code>  -w <em class="replaceable"><code>width</code></em>   -l <em class="replaceable"><code>length</code></em> </p></div><p><em class="replaceable"><code>width</code></em> basiert auf der
	      <code class="literal">pw</code>-Fähigkeit,
	      <em class="replaceable"><code>length</code></em> hingegen auf der
	      <code class="literal">pl</code>-Fähigkeit des gewählten
	      Druckers.</p></li></ul></div><p>Lassen Sie sich von dieser angeblichen Einfachheit eines
	  Ausgabefilters nicht täuschen.  Ausgabefilter sind
	  beispielsweise <span class="emphasis"><em>nicht dazu in der Lage</em></span>,
	  jede Datei eines Druckauftrages auf einer neuen Seite zu
	  drucken.  Dazu benötigen Sie einen Textfilter (die im
	  Abschnitt <a class="link" href="printing-intro-setup.html#printing-textfilter" title="10.3.1.5.6. Den Textfilter installieren">Den Textfilter
	  installieren</a> beschrieben werden).  Außerdem
	  sind Ausgabefilter in Wirklichkeit
	  <span class="emphasis"><em>komplexer</em></span>, da sie den gesendeten
	  Bytestrom nicht nur auf Sonderzeichen hin untersuchen
	  müssen, sondern auch die Übertragung von Signalen
	  für <span class="application">LPD</span> übernehmen
	  müssen.</p><p>Sie <span class="emphasis"><em>benötigen</em></span> Ausgabefilter
	  aber dann, wenn Sie Deckblätter drucken wollen, da
	  dazu Escape-Sequenzen und Initialisierungsstrings
	  erforderlich sind.  (Es ist allerdings <span class="emphasis"><em>nicht
	  möglich</em></span>, den Druck dieser Deckblätter
	  zu verrechnen, da <span class="application">LPD</span>
	  keine Benutzer- oder Rechnerinformationen an den Ausgabefilter
	  übergibt.)</p><p><span class="application">LPD</span> kann für den gleichen
	  Drucker sowohl Ausgabefilter als auch Textfilter verwenden.
	  In solchen Fällen verwendet <span class="application">LPD</span>
	  den Ausgabefilter nur für den Druck von Deckblättern
	  (die im Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-header-pages" title="10.4.2. Deckblätter">Deckblätter</a>
	  näher beschrieben werden).  Nach dem Druck des Deckblattes
	  erwartet <span class="application">LPD</span>, dass sich der
	  Ausgabefilter <span class="emphasis"><em>selbst beendet</em></span>.  Dazu werden
	  zwei Bytes an den Ausgabefilter gesendet:  ASCII 031, gefolgt
	  von ASCII 001.  Wenn ein Ausgabefilter diese zwei Bytes
          (031, 001) empfängt, sendet er das Signal
	  <code class="literal">SIGSTOP</code> an sich selbst.  Nachdem
	  <span class="application">LPD</span> den Rest des Druckauftrages
	  erledigt hat, wird der Ausgabefilter erneut gestartet, indem
	  ein <code class="literal">SIGCONT</code> an den Ausgabefilter
	  gesendet wird.</p><p>Haben Sie nur einen Ausgabefilter, aber
	  <span class="emphasis"><em>keinen</em></span> Textfilter installiert, dann
	  verwendet <span class="application">LPD</span> den Ausgabefilter auch
	  für den Druck von normalem Text.  Wie bereits erwähnt,
	  werden dabei allerdings alle Dateien des Druckauftrags unmittelbar
	  hintereinander gedruckt, Seitenumbrüche oder ein
	  zusätzlicher Papiervorschub sind also nicht möglich.
	  Da dieses Verhalten von Ihnen wahrscheinlich
	  <span class="emphasis"><em>nicht</em></span> gewünscht wird, werden Sie in
	  fast allen Fällen einen zusätzlichen Textfilter
	  benötigen.</p><p>Der weiter oben beschriebene Textfilter
	  <code class="command">lpf</code> kann auch als Ausgabefilter verwendet
	  werden.  Wenn Sie nur einen funktionierenden Ausgabefilter
	  benötigen, aber nicht den dafür benötigten
	  Code (zur Zeichenerkennung und zum Senden von Signalen)
	  schreiben wollen, sollten Sie sich <code class="command">lpf</code>
	  näher ansehen.  Sie können <code class="command">lpf</code>
	  auch in ein Shell-Skript einbinden, um von Ihrem Drucker
	  benötigte Initialisierungscodes zu verarbeiten.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-lpf"></a>10.4.1.6. <code class="command">lpf</code>:  Ein Textfilter</h4></div></div></div><p>Der Textfilter (Eingabefilter)
	  <code class="filename">/usr/libexec/lpr/lpf</code> wird bereits mit
	  FreeBSD geliefert.  Er erlaubt das Einrücken der
	  Ausgabe (über <code class="command">lpr -i</code>), die
	  Übergabe von Zeichen-Literalen
	  (über <code class="command">lpr -l</code>), das Anpassen
	  der Druckposition bei gelöschten Zeichen
	  (<span class="foreignphrase"><em class="foreignphrase">Backspaces</em></span>) oder Tabulatoren,
	  sowie die Verrechnung gedruckter Seiten.  Zusätzlich
	  kann dieser Textfilter auch als Ausgabefilter arbeiten.</p><p><code class="command">lpf</code> ist für viele verschiedene
	  Druckumgebungen geeignet.  Zwar ist dieser Textfilter nicht
	  in der Lage, Initialisierungssequenzen an einen Drucker
	  zu senden, dieses Problem kann allerdings durch das Schreiben
	  und Ausführen eines Shell-Skripts (das diese Funktion
	  übernimmt) und das anschließende Aufrufen von
	  <code class="command">lpf</code> gelöst werden.</p><a id="idp74468560" class="indexterm"></a><a id="idp74469072" class="indexterm"></a><p>Damit Sie <code class="command">lpf</code> für die Verrechnung
	  von Druckaufträgen einsetzen können, müssen Sie
	  die korrekten Werte für die <code class="literal">pw</code>- und
	  <code class="literal">pl</code>-Fähigkeiten in
	  <code class="filename">/etc/printcap</code> eintragen.
	  <code class="command">lpf</code> verwendet diese Werte, um festzustellen,
	  wieviel Text auf eine Seite passt und wieviele Seiten im
	  Druckauftrag enthalten sind.  Weitere Informationen zur
	  Verrechnung der Druckernutzung enthält der Abschnitt
	  <a class="link" href="printing-advanced.html#printing-advanced-acct" title="10.4.5. Die Druckernutzung verrechnen">Die Druckernutzung
	  verrechnen</a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-header-pages"></a>10.4.2. Deckblätter</h3></div></div></div><p>Wenn Sie <span class="emphasis"><em>viele</em></span> Benutzer mit verschiedenen
        Druckern verwalten müssen, sollten Sie
        <span class="emphasis"><em>Deckblätter</em></span> als notwendiges Übel
	akzeptieren.</p><a id="idp74479440" class="indexterm"></a><a id="idp74480592" class="indexterm"></a><p>Deckblätter (manchmal auch als
	<span class="emphasis"><em>Bannerseiten</em></span> oder
	<span class="emphasis"><em>burst pages</em></span> bezeichnet) geben an, wem
	die Ausgabe eines Druckauftrags gehört.  Sie werden
	normalerweise in großen fetten Buchstaben gedruckt,
	manchmal sogar mit zusätzlicher Umrandung, damit man
	sie leichter von den tatsächlichen Seiten eines
	Druckauftrages unterscheiden kann.  Der Nachteil von
	Deckblättern ist allerdings, dass es sich dabei um
	eine zusätzliche zu druckende Seite handelt, die in
	der Regel bereits nach wenigen Minuten wieder im Papierkorb
	landet.  Da aber für jeden Druckauftrag nur ein einziges
	Deckblatt gedruckt wird, ist der Papierverbrauch in den
	meisten Fällen tolerierbar.</p><p>Das <span class="application">LPD</span>-System kann
	Deckblätter automatisch erzeugen, <span class="emphasis"><em>wenn</em></span>
	Ihr Drucker normalen Text direkt drucken kann.  Haben Sie
	hingegen einen <span class="trademark">PostScript</span>®-Drucker, benötigen Sie ein
	externes Programm, um die Deckblätter zu generieren
	(Lesen Sie dazu auch den Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-header-pages-ps" title="10.4.2.4. Deckblätter auf PostScript®-Druckern ausgeben">Deckblätter
	auf <span class="trademark">PostScript</span>®-Druckern erzeugen</a>.).</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-header-pages-enabling"></a>10.4.2.1. Deckblätter aktivieren</h4></div></div></div><p>Im Abschnitt <a class="link" href="printing-intro-setup.html#printing-simple" title="10.3.1. Einfache Drucker-Konfiguration">Einfache
	  Drucker-Konfiguration</a> haben wir die Ausgabe von
	  Deckblättern durch die die Angabe der Option
	  <code class="literal">sh</code>
	  (<span class="foreignphrase"><em class="foreignphrase">suppress header</em></span>) in
	  <code class="filename">/etc/printcap</code> deaktiviert.  Um die
	  Ausgabe von Deckblättern wieder zu aktivieren,
	  müssen Sie daher die <code class="literal">sh</code>-Fähigkeit
	  wieder entfernen.</p><p>Das klingt zu einfach?  Wo ist der Haken?</p><p>Sie haben recht.  Es ist <span class="emphasis"><em>möglich</em></span>,
	  dass Sie einen Ausgabefilter verwenden müssen, um die
	  nötigen Initialisierungsstrings an den Drucker zu senden.
	  Das folgende Beispiel beschreibt einen Ausgabefilter für
	  PCL-kompatible Drucker von Hewlett Packard:</p><pre class="programlisting">#!/bin/sh
#
#  hpof - Ausgabefilter für PCL-kompatible Drucker von Hewlett Packard
#  Installiert unter:  /usr/local/libexec/hpof

printf "\033&amp;k2G" || exit 2
exec /usr/libexec/lpr/lpf</pre><p>Geben Sie den Pfad des Ausgabefilters über die
	  <code class="literal">of</code>-Fähigkeit an.  Weitere Informationen
	  finden Sie im Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-of" title="10.4.1.5. Ausgabefilter">Ausgabefilter</a>.</p><p>Das nächste Beispiel beschreibt die Datei
	  <code class="filename">/etc/printcap</code> des bereits erwähnten
	  Druckers <code class="literal">teak</code>.  Allerdings sind nun die
	  Ausgabe von Deckblättern sowie der vorhin beschriebene
	  Ausgabefilter enthalten:</p><pre class="programlisting">#
#  /etc/printcap für den Rechner orchid
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=<code class="filename">/dev/lpt0</code>:sd=<code class="filename">/var/spool/lpd/teak</code>:mx#0:\
        :if=<code class="filename">/usr/local/libexec/hpif</code>:\
        :vf=<code class="filename">/usr/local/libexec/hpvf</code>:\
        :of=<code class="filename">/usr/local/libexec/hpof</code>:</pre><p>Wenn ein Anwender nun einen Druckauftrag an den Drucker
	  <code class="literal">teak</code> schickt, wird für jeden
	  Druckauftrag ein Deckblatt erstellt.  Benötigt ein
	  Anwender keine Deckblätter, kann er die Ausgabe dieser
	  Seiten durch die Verwendung von <code class="command">lpr
	  -h</code> unterdrücken.  Weitere, für
	  die Ausgabe von Deckblättern interessante <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a>-Optionen
	  finden Sie im Abschnitt <a class="link" href="printing-using.html#printing-lpr-options-misc" title="10.5.4.3. Deckblatt-Optionen">Deckblattoptionen</a>.</p><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="application">LPD</span> verwendet ein
	    <span class="foreignphrase"><em class="foreignphrase">Form Feed</em></span>, um das Deckblatt
	    abzuschließen.  Wenn Ihr Drucker ein anderes Zeichen
	    verwendet, um eine Seite auszuwerfen, geben Sie dieses
	    über die <code class="literal">ff</code>-Fähigkeit in
	    <code class="filename">/etc/printcap</code> an.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-header-pages-controlling"></a>10.4.2.2. Deckblätter kontrollieren</h4></div></div></div><p>Haben Sie die Ausgabe von Deckblättern aktiviert,
	  gibt <span class="application">LPD</span> eine ganze Seite in
	  großen Buchstaben aus, die den Anwender, den
	  verwendeten Rechner sowie den Druckauftrag beschreiben.
	  Das folgende Beispiel ist ein Deckblatt für den
	  Druckauftrag <span class="quote">&#8222;<span class="quote">outline</span>&#8220;</span>, der von
	  <code class="systemitem">kelly</code> auf dem Rechner <code class="systemitem">rose</code>
	  erstellt wurde:</p><pre class="screen">      k                   ll       ll
      k                    l        l
      k                    l        l
      k   k     eeee       l        l     y    y
      k  k     e    e      l        l     y    y
      k k      eeeeee      l        l     y    y
      kk k     e           l        l     y    y
      k   k    e    e      l        l     y   yy
      k    k    eeee      lll      lll     yyy y
                                               y
                                          y    y
                                           yyyy


                                   ll
                          t         l        i
                          t         l
       oooo    u    u   ttttt       l       ii     n nnn     eeee
      o    o   u    u     t         l        i     nn   n   e    e
      o    o   u    u     t         l        i     n    n   eeeeee
      o    o   u    u     t         l        i     n    n   e
      o    o   u   uu     t  t      l        i     n    n   e    e
       oooo     uuu u      tt      lll      iii    n    n    eeee









      r rrr     oooo     ssss     eeee
      rr   r   o    o   s    s   e    e
      r        o    o    ss      eeeeee
      r        o    o      ss    e
      r        o    o   s    s   e    e
      r         oooo     ssss     eeee







                                              Job:  outline
                                              Date: Sun Sep 17 11:04:58 1995</pre><p><span class="application">LPD</span> fügt ein
	  <span class="foreignphrase"><em class="foreignphrase">Form Feed</em></span> an diesen Text an,
	  damit der eigentliche Druckauftrag auf einer neuen Seite
	  gestartet wird (es sei denn, Sie haben die
	  <code class="literal">sf</code>-Fähigkeit (<span class="foreignphrase"><em class="foreignphrase">suppress
	  form feeds</em></span>) des jeweiligen Druckers in
	  <code class="filename">/etc/printcap</code> aktiviert).</p><p>Wenn Sie dies wüschen, kann
	  <span class="application">LPD</span> auch nur ein <span class="emphasis"><em>kurzes
	  Deckblatt</em></span> ausgeben.  Dazu verwenden Sie die
	  Option <code class="literal">sb</code>
	  (<span class="foreignphrase"><em class="foreignphrase">short banner</em></span>)
	  in <code class="filename">/etc/printcap</code>.  Dadurch erhalten Sie
	  ein Deckblatt ähnlich dem folgenden:</p><pre class="screen">rose:kelly  Job: outline  Date: Sun Sep 17 11:07:51 1995</pre><p>In der Voreinstellung druckt <span class="application">LPD</span>
	  zuerst das Deckblatt und danach den eigentlichen Druckauftrag.
	  Um diese Reihenfolge umzukehren, geben Sie die Option
	  <code class="literal">hl</code> (<span class="foreignphrase"><em class="foreignphrase">header
	  last</em></span>) in <code class="filename">/etc/printcap</code>
	  ans.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-header-pages-accounting"></a>10.4.2.3. Deckblätter verrechnen</h4></div></div></div><p>Wenn Sie die in <span class="application">LPD</span> eingebaute
	  Funktion zur Erstellung von Deckblättern verwenden,
	  werden Sie auf folgendes Paradigma stoßen:
	  Deckblätter müssen <span class="emphasis"><em>kostenlos</em></span>
	  sein.</p><p>Warum ist das so?</p><p>Weil der Ausgabefilter das einzige externe Programm ist,
	  das zum Zeitpunkt der Erstellung des Deckblatts eine
	  Verrechnung durchführen könnte.  Da Ausgabefilter
	  aber weder über <span class="emphasis"><em>Benutzer- noch über
	  Rechnerinformationen</em></span> verfügen, ist es nicht
	  möglich, einen Druckauftrag einem bestimmten Benutzer
	  zuzuordnen.  Da ein Benutzer die Ausgabe von Deckblättern
	  über <code class="command">lpr -h</code>
	  unterdrücken kann, ist es auch nicht möglich, die Vorgabe
	  <span class="quote">&#8222;<span class="quote">verrechne eine zusätzliche Seite</span>&#8220;</span> in den Text-
	  oder Konvertierungsfilter (die über die zur Verrechnung
	  nötigen Benutzer- und Rechnerinformationen verfügen)
	  aufzunehmen, weil Benutzer sonst für Deckblätter
	  bezahlen müssten, die sie nicht gedruckt haben.</p><p>Es ist <span class="emphasis"><em>ebenfalls nicht ausreichend</em></span>,
	  jeden Filter eigene Deckblätter erzeugen zu lassen (und
	  sie dadurch verrechnen zu können).  Wollte ein Benutzer
	  durch ein <code class="command">lpr -h</code> die Ausgabe
	  eines Deckblattes unterdrücken, würde dieses nun trotzdem
	  verrechnet werden, da <span class="application">LPD</span> keine
	  Informationen über die Verwendung der Option
	  <code class="option">-h</code> an einen Filter weitergibt.</p><p>Welche Möglichkeiten habe ich nun?</p><p>Sie können:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Das Paradigma von <span class="application">LPD</span> einfach
	      akzeptieren und die Deckblätter gratis abgeben.</p></li><li class="listitem"><p>Eine alternatives Drucksystem wie
	      <span class="application">LPRng</span><a id="idp74670544" class="indexterm"></a>
	      installieren. Der Abschnitt <a class="link" href="printing-lpd-alternatives.html" title="10.6. Alternativen zum LPD-Drucksystem"> Alternativen zum
	      Standard-Drucksystem</a> beschreibt verschiedene
	      Drucksysteme, die <span class="application">LPD</span>
	      ersetzen können.</p></li><li class="listitem"><p>Schreiben Sie einen <span class="emphasis"><em>intelligenten</em></span>
	      Ausgabefilter.  Normalerweise kümmert sich ein
	      Ausgabefilter nur um die Initialisierung des Druckers oder
	      um eine einfache Zeichenkonvertierung.  Außerdem
	      eignet er sich für die Ausgabe von Deckblättern
	      und normalem Text, wenn Sie keinen Text- oder Eingabefilter
	      installiert haben.  Haben Sie allerdings einen Textfilter
	      installiert, verwendet <span class="application">LPD</span>
	      Ausgabefilter nur für die Ausgabe von Deckblättern.
	      Ein Ausgabefilter kann den Text des von
	      <span class="application">LPD</span> erzeugten Deckblattes
	      untersuchen, um festzustellen, welcher Benutzer und welcher
	      Rechner den Druckauftrag gestartet hat.  Leider weiß
	      der Ausgabefilter auch mit dieser Methode nicht, welche
	      Datei er zur Verrechnung verwenden soll (da der Name dieser
	      Datei durch die <code class="literal">af</code>-Fähigkeit
	      übergeben wird).  Wenn Sie eine
	      Standard-Verrechnungsdatei verwenden, können Sie diese
	      in den Ausgabefilter einbauen.  Um den Text des Deckblattes
	      zu untersuchen, verwenden Sie die
	      <code class="literal">sh</code>-Fähigkeit
	      (<span class="foreignphrase"><em class="foreignphrase">short header</em></span>) in
	      <code class="filename">/etc/printcap</code>.  Falls Ihnen das zuviel
	      Aufwand ist, freuen sich Ihre Benutzer sicher darüber,
	      wenn Sie ihnen den kostenlosen Druck von Deckblättern
	      erlauben.</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-header-pages-ps"></a>10.4.2.4. Deckblätter auf <span class="trademark">PostScript</span>®-Druckern ausgeben</h4></div></div></div><p>In der Regel erzeugt <span class="application">LPD</span> ein Deckblatt
	  mit normalem Text, das für viele verschiedene Drucker geeignet
	  ist.  Da <span class="trademark">PostScript</span>®-Drucker normalen Text aber nicht drucken
	  können, ist die <span class="application">LPD</span>-Funktion zur
	  Erstellung von Deckblättern auf diesen Drucker relativ
	  sinnlos.</p><p>Es sei denn, jeder Text- und Konvertierungsfilter erzeugt
	  über den Benutzer- und Rechnernamen sein eigenes, für
	  den jeweiligen Drucker geeignetes Deckblatt.  Das Problem
	  dieser Methode ist allerdings, dass ein Anwender auch dann ein
	  Deckblatt erhält, wenn er dies über
	  <code class="command">lpr -h</code> verhindern wollte.</p><p>Das folgende Skript benötigt drei Argumente (den
	  Loginnamen des Benutzers, den Rechnernamen und den Namen
	  des Druckauftrages), um daraus ein einfaches
	  <span class="trademark">PostScript</span>®-Deckblatt zu erzeugen:</p><pre class="programlisting">#!/bin/sh
#
#  make-ps-header - ein PostScript-Deckblatt auf stdout ausgeben
#  Installiert unter:  /sr/local/libexec/make-ps-header
#

#
#  Die folgenden Werte sind PostScript-Einheiten (72 pro Zoll).
#  Passen Sie diese Werte für A4 oder die von Ihnen verwendete
#  Papiergröße an:
#
page_width=612
page_height=792
border=72

#
#  Argumente prüfen
#
if [ $# -ne 3 ]; then
    echo "Usage: `basename $0` &lt;user&gt; &lt;host&gt; &lt;job&gt;" 1&gt;&amp;2
    exit 1
fi

#
#  Diese Werte in Variablen speichern, damit der PostScript-Code
#  übersichtlicher wird.
#
user=$1
host=$2
job=$3
date=`date`

#
#  Sende den PostScript-Code an stdout.
#
exec cat &lt;&lt;EOF
%!PS

%
%  Sicherstellen, dass es keine unerwünschten Wechselwirkungen mit
%  dem folgenden Druckauftrag gibt.
%
save

%
%  Ziehe eine fette Umrandung.
%
$border $border moveto
$page_width $border 2 mul sub 0 rlineto
0 $page_height $border 2 mul sub rlineto
currentscreen 3 -1 roll pop 100 3 1 roll setscreen
$border 2 mul $page_width sub 0 rlineto closepath
0.8 setgray 10 setlinewidth stroke 0 setgray

%
%  Zeige den Benutzernamen groß und fett an.
%
/Helvetica-Bold findfont 64 scalefont setfont
$page_width ($user) stringwidth pop sub 2 div $page_height 200 sub moveto
($user) show

%
%  Und nun zeige noch die Einzelheiten an.
%
/Helvetica findfont 14 scalefont setfont
/y 200 def
[ (Job:) (Host:) (Date:) ] {
200 y moveto show /y y 18 sub def }
forall

/Helvetica-Bold findfont 14 scalefont setfont
/y 200 def
[ ($job) ($host) ($date) ] {
        270 y moveto show /y y 18 sub def
} forall

%
% Das wars.
%
restore
showpage
EOF     </pre><p>Nun kann jeder Konvertierungs- oder Textfilter dieses
	  Skript aufrufen, um zuerst das Deckblatt zu erzeugen und
	  danach den Druckauftrag zu drucken.  Das nächste
	  Beispiel enthält den bereits beschriebenen
	  DVI-Konvertierungsfilter, der hier um die Funktion zur
	  Erzeugung eines Deckblatts erweitert wurde:</p><pre class="programlisting">#!/bin/sh
#
#  psdf - DVI-nach-PostScript - Druckerfilter
#  Installiert unter:  /usr/local/libexec/psdf
#
#  Wird von lpd aufgerufen, wenn der Benutzer lpr -d verwendet.
#

orig_args="$@"

fail() {
    echo "$@" 1&gt;&amp;2
    exit 2
}

while getopts "x:y:n:h:" option; do
    case $option in
        x|y)  ;; # Ignore
        n)    login=$OPTARG ;;
        h)    host=$OPTARG ;;
        *)    echo "LPD started `basename $0` wrong." 1&gt;&amp;2
              exit 2
              ;;
    esac
done

[ "$login" ] || fail "No login name"
[ "$host" ] || fail "No host name"

( /usr/local/libexec/make-ps-header $login $host "DVI File"
  /usr/local/bin/dvips -f ) | eval /usr/local/libexec/lprps $orig_args</pre><p>Beachten Sie, dass der Filter die Liste der Argumente
	  überprüft, um den Benutzer- und den Rechnernamen
	  zu ermitteln.  Dieser Vorgang ist prinzipiell für alle
	  Filter identisch.  Der Textfilter benötigt allerdings
	  etwas andere Argumente, die im Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-filters" title="10.4.1.1. Die Funktionsweise von Filtern">Die Funktionsweise von
	  Filtern</a> beschrieben werden.</p><p>Wie bereits erwähnt, deaktiviert diese Methode
	  leider die <span class="quote">&#8222;<span class="quote">suppress header page</span>&#8220;</span>-Option
	  (also die Option <code class="option">-h</code>) von
	  <code class="command">lpr</code>.  Benutzer können danach den
	  Ausdruck eines Deckblattes nicht mehr verhindern, da der
	  angepasste Filter zu jedem Druckauftrag automatisch ein
	  Deckblatt erstellt.</p><p>Damit ein Benutzer bei Bedarf den Ausdruck eines
	  Deckblatts dennoch unterbinden kann, müssen Sie
	  auch hier den im Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-header-pages-accounting" title="10.4.2.3. Deckblätter verrechnen">
	  Deckblätter verrechnen</a> beschriebenen
	  Trick einsetzen:   Schreiben Sie einen Ausgabefilter, der
	  das von LPD erzeugte Deckblatt untersucht und daraus
	  eine <span class="trademark">PostScript</span>®-Version erzeugt.  Wenn der Benutzer
	  den Druckauftrag mit <code class="command">lpr -h</code>
	  verschickt, erzeugt <span class="application">LPD</span> kein Deckblatt,
	  was in weiterer Folge auch für Ihren Ausgabefilter gilt.
	  Soll hingegen ein Deckblatt erzeugt werden, liest der
	  Ausgabefilter den von <span class="application">LPD</span>
	  übergebenen Text und erzeugt daraus ein für
	  Ihren <span class="trademark">PostScript</span>®-Drucker geeignetes Deckblatt.</p><p>Haben Sie Ihren <span class="trademark">PostScript</span>®-Drucker über eine
	  serielle Verbindung angeschlossen, können Sie auch
	  <code class="command">lprps</code> verwenden.  In diesem Paket ist
	  mit <code class="command">psof</code> auch ein Ausgabefilter
	  enthalten, der die eben beschriebenen Funktionen
	  übernehmen kann.  Beachten Sie aber, dass Sie mit
	  <code class="command">psof</code> keine Deckblätter verrechnen
	  können.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-network-printers"></a>10.4.3. Drucken über ein Netzwerk</h3></div></div></div><a id="idp74703184" class="indexterm"></a><a id="idp74712656" class="indexterm"></a><p>FreeBSD unterstützt das Drucken über ein Netzwerk, also den
        Versand von Druckaufträgen an einen entfernten Drucker.  Man
        unterscheidet dabei zwei Möglichkeiten:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Den Zugriff auf einen an einem entfernten Rechner
	    angeschlossenen Drucker.  Sie konfigurieren dabei auf Ihrem
	    System einen Drucker, der über eine konventionelle
	    serielle oder parallele Verbindung an einem anderen Rechner
	    angeschlossen ist.  Danach richten Sie
	    <span class="application">LPD</span> auf dem entfernten System
	    so ein, dass andere Drucker über das Netzwerk auf
	    diesen Drucker zugreifen können.  Der Abschnitt
	    <a class="link" href="printing-advanced.html#printing-advanced-network-rm" title="10.4.3.1. Auf entfernten Rechnern installierte Drucker">Auf entfernten
	    Rechnern installierte Drucker</a> beschreibt, wie Sie
	    dazu vorgehen müssen.</p></li><li class="listitem"><p>Den Zugriff auf einen direkt an ein Netzwerk
	    angeschlossenen Drucker.  Ein solcher Drucker verfügt
	    anstelle (oder zusätzlich zu) einer parallelen oder
	    seriellen Schnittstelle über eine Netzwerkschnittstelle.
	    Ein solcher Drucker kann sich auf zwei Arten verhalten:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Er kann das <span class="application">LPD</span>-Protokoll
	        direkt unterstützen und sogar Druckjobs von entfernten
	        Rechner verwalten.  In diesem Fall verhält sich der
	        Drucker wie ein normaler Rechner, auf dem
	        <span class="application">LPD</span> läuft.  Lesen Sie den
	        Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-network-rm" title="10.4.3.1. Auf entfernten Rechnern installierte Drucker">
	        Auf entfernten Rechnern installierte Drucker</a>, um
	        einen solchen Drucker einzurichten.</p></li><li class="listitem"><p>Er könnte Verbindungen über ein
	        Netzwerk unterstützen.  In diesem Fall
	        <span class="quote">&#8222;<span class="quote">verbinden</span>&#8220;</span> Sie den Drucker mit einem
	        Rechner Ihres Netzwerks, der danach für die
	        Verwaltung von Druckaufträgen sowie den
	        tatsächlichen Druck verantwortlich ist.  Der
	        Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-network-net-if" title="10.4.3.2. Drucker mit direkter TCP-Schnittstelle">Drucker mit
	        direkter TCP-Schnittstelle</a> enthält
	        Hinweise zur Installation derartiger Drucker.</p></li></ul></div></li></ul></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-network-rm"></a>10.4.3.1. Auf entfernten Rechnern installierte Drucker</h4></div></div></div><p>Das <span class="application">LPD</span>-Drucksystem
	  unterstützt den Versand von Druckaufträgen an
	  andere Rechner, auf denen entweder
	  <span class="application">LPD</span> läuft oder die zu
	  <span class="application">LPD</span> kompatibel sind.  Dadurch
	  können Sie einen Drucker auf einem Rechner installieren
	  und von anderen Rechnern des Netzwerks darauf zugreifen.
	  Außerdem werden Drucker mit direkter TCP-Schnittstelle
	  unterstützt, wenn diese das
	  <span class="application">LPD</span>-Protokoll
	  unterstützen.</p><p>Um diese Art des Druckens über ein Netzwerk zu
	  aktivieren, installieren Sie zuerst Ihren Drucker auf einem
	  Rechner Ihres Netzwerks, dem sogenannten
	  <span class="emphasis"><em>printer host</em></span>.  Die dazu nötigen
	  Schritte werden im Abschnitt <a class="link" href="printing-intro-setup.html#printing-simple" title="10.3.1. Einfache Drucker-Konfiguration">
	  Einfache Drucker-Konfiguration</a> beschrieben.  Falls
	  Sie eine erweiterte Druckerkonfiguration benötigen,
	  sollten Sie auch den Abschnitt <a class="link" href="printing-advanced.html" title="10.4. Erweiterte Drucker-Konfiguration">Erweiterte
	  Drucker-Konfiguration</a> lesen.  Danach testen Sie, ob
	  der Drucker alle von Ihnen aktivierten
	  <span class="application">LPD</span>-Fähigkeiten
	  unterstützt.  Stellen Sie auch sicher, dass Ihr
	  <span class="emphasis"><em>lokales System</em></span> berechtigt ist, den
	  <span class="application">LPD</span>-Dienst auf dem
	  <span class="emphasis"><em>entfernten System</em></span> zu nutzen (lesen
	  Sie dazu den Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-restricting-remote" title="10.4.4.4. Druckaufträge von entfernten Rechnern beschränken">
	  Druckaufträge auf entfernten Druckern
	  beschränken</a>).</p><a id="idp74727248" class="indexterm"></a><a id="idp74728528" class="indexterm"></a><p>Wenn Sie einen Drucker mit einer zu
	  <span class="application">LPD</span> kompatiblen
	  Netzwerkschnittstelle verwenden, handelt es sich beim
	  <span class="emphasis"><em>printer host</em></span> um den Drucker selbst,
	  und der <span class="emphasis"><em>Druckername</em></span> ist der von Ihnen
	  für diesen Drucker vorgegebene Name.  Lesen Sie die
	  Dokumentation Ihres Druckers und/oder der Netzwerkschnittstelle
	  Ihres Druckers, um dies zu klären.</p><div xmlns="" class="tip"><h3 class="admontitle">Tipp: </h3><p xmlns="http://www.w3.org/1999/xhtml">Wenn Sie einen Hewlett Packard Laserjet-Drucker
	    verwenden, sorgt der Druckername <code class="literal">text</code>
	    für eine automatische LF-zu-CRLF-Konvertierung.  In
	    diesem Fall wird das <code class="filename">hpif</code>-Skript
	    nicht benötigt.</p></div><p>Danach müssen Sie auf jedem Rechner, der auf diesen
	  Drucker zugreifen soll, einen entsprechenden Eintrag in
	  deren <code class="filename">/etc/printcap</code> aufnehmen.  Dazu
	  werden folgende Informationen benötigt:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Der Name des Eintrags.  Entspricht in der Regel dem
	      Eintrag auf dem <span class="emphasis"><em>printer host</em></span>.</p></li><li class="listitem"><p>Lassen Sie den Eintrag für die
	      <code class="literal">lp</code>-Fähigkeit leer, schreiben Sie
	      also <code class="literal">:lp=:</code>.</p></li><li class="listitem"><p>Erzeugen Sie ein Spooling-Verzeichnis und geben Sie
	      dessen Pfad über die
	      <code class="literal">sd</code>-Fähigkeit an.
	      <span class="application">LPD</span> speichert Ihre
	      Druckaufträge in diesem Verzeichnis, bevor sie an den
	      Drucker geschickt werden.</p></li><li class="listitem"><p>Geben Sie den Namen des <span class="emphasis"><em>printer
	      hosts</em></span> über die
	      <code class="literal">rm</code>-Fähigkeit an.</p></li><li class="listitem"><p>Geben Sie den Namen des Druckers (auf dem
	      <span class="emphasis"><em>printer host</em></span>) über die
	      <code class="literal">rp</code>-Fähigkeit an.</p></li></ol></div><p>Das ist alles.  Sie benötigen weder
	  Konvertierungsfilter, noch Seitengrößen oder
	  sonstige Angaben in Ihrer lokalen
	  <code class="filename">/etc/printcap</code>.</p><p>Dazu ein Beispiel.  Der Rechner <code class="systemitem">rose</code>
	  verfügt über zwei Drucker, <code class="literal">bamboo</code>
	  und <code class="literal">rattan</code>.  Wir wollen nun allen Benutzern
	  des Rechners <code class="systemitem">orchid</code> erlauben, diese Drucker
	  zu verwenden.  Es folgt nun wieder die bereits aus dem Abschnitt
	  <a class="link" href="printing-advanced.html#printing-advanced-header-pages-enabling" title="10.4.2.1. Deckblätter aktivieren">
	  Deckblätter verwenden</a> bekannte
	  <code class="filename">/etc/printcap</code> für den Rechner
	  <code class="systemitem">orchid</code>.  Diese enthielt bereits einen Eintrag
	  für den Drucker <code class="literal">teak</code>.  Zusätzlich
	  tragen wir nun die zwei Drucker des Rechners
	  <code class="systemitem">rose</code> ein:</p><pre class="programlisting">#
#  /etc/printcap für den Rechner orchid - mit zusätzlichen
#  Einträgen für die (entfernten) Drucker auf dem Rechner rose
#

#
#  teak ist ein lokaler Drucker und direkt mit orchid verbunden:
#
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=<code class="filename">/dev/lpt0</code>:sd=<code class="filename">/var/spool/lpd/teak</code>:mx#0:\
        :if=<code class="filename">/usr/local/libexec/ifhp</code>:\
        :vf=<code class="filename">/usr/local/libexec/vfhp</code>:\
        :of=<code class="filename">/usr/local/libexec/ofhp</code>:

#
#  rattan ist mit rose verbunden, Druckaufträge für rattan gehen daher
#  an den Rechner rose:
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :lp=:rm=rose:rp=rattan:sd=<code class="filename">/var/spool/lpd/rattan</code>:

#
#  bamboo ist ebenfalls mit rose verbunden:
#
bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :lp=:rm=rose:rp=bamboo:sd=<code class="filename">/var/spool/lpd/bamboo</code>:</pre><p>Nun müssen wir nur noch die Spooling-Verzeichnisse
	  auf dem Rechner <code class="systemitem">orchid</code> erzeugen:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /var/spool/lpd/rattan /var/spool/lpd/bamboo</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 770 /var/spool/lpd/rattan /var/spool/lpd/bamboo</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chown daemon:daemon /var/spool/lpd/rattan /var/spool/lpd/bamboo</code></strong></pre><p>Damit können Benutzer des Rechners
	  <code class="systemitem">orchid</code> die Drucker <code class="literal">rattan</code>
	  und <code class="literal">bamboo</code> verwenden.  Ein Benutzer gibt
	  auf <code class="systemitem">orchid</code> beispielsweise ein:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpr -P bamboo -d sushi-review.dvi</code></strong></pre><p>Die Anwendung <span class="application">LPD</span> auf dem Rechner
	  <code class="systemitem">orchid</code> kopiert daraufhin den Druckauftrag in das
	  Spooling-Verzeichnis <code class="filename">/var/spool/lpd/bamboo</code> und stellt fest,
	  dass es sich um einen DVI-Auftrag handelt.  Sobald
	  <code class="systemitem">rose</code> über genug freien Platz im
	  <code class="literal">bamboo</code>-Spooling-Verzeichnis verfügt,
	  würden die beiden <span class="application">LPD</span> die Datei auf
	  den Rechner <code class="systemitem">rose</code> transferieren.  Diese Datei
	  verbleibt danach in der Druckerwarteschlange des Rechners
	  <code class="systemitem">rose</code>, bis der Ausdruck der Datei abgeschlossen ist.
	  Vor dem Ausdruck würde die Datei noch von DVI nach <span class="trademark">PostScript</span>®
	  konvertiert werden, da es sich bei <code class="literal">bamboo</code> um einen
	  an den Rechner <code class="systemitem">rose</code> angeschlossenen
	  <span class="trademark">PostScript</span>®-Drucker handelt.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-network-net-if"></a>10.4.3.2. Drucker mit direkter TCP-Schnittstelle</h4></div></div></div><p>Wenn Sie eine Netzwerkkarte für Ihren Drucker kaufen,
	  können Sie zwei verschiedene Versionen wählen:
	  Eine Version, die ein Drucksystem emuliert (die teure Version),
	  oder eine Version, die sich verhält, als wäre der
	  Drucker an eine serielle oder parallele Schnittstelle
	  angeschlossen (die billige Version).  Dieser Abschnitt
	  beschreibt die billige Variante.  Bevorzugen Sie die teure
	  Variante, sollten Sie den Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-network-rm" title="10.4.3.1. Auf entfernten Rechnern installierte Drucker">Auf entfernten
	  Rechnern installierte Drucker</a> nochmals lesen.</p><p>Das Format der Datei <code class="filename">/etc/printcap</code>
	  erlaubt es Ihnen, anzugeben, welche serielle oder parallele
	  Schnittstelle verwendet werden soll und (falls Sie eine
	  serielle Schnittstelle verwenden) welche Parameter (Baudrate,
	  Flußkontrolle, Behandlung von Tabulatoren, Konvertierung
	  von neuen Zeilen und andere mehr) Sie verwenden wollen.  Es
	  gibt allerdings keine Möglichkeit, eine Verbindung zu
	  einem Drucker zu definieren, der einen TCP/IP- oder einem
	  anderem Netzwerkport auf Druckaufträge hin abfragt.</p><p>Um Daten an einen Netzwerkdrucker zu schicken, müssen
	  Sie daher ein Kommunikationsprogramm entwickeln, das von
	  Text- und Konvertierungsfiltern aufgerufen werden kann.  Dazu
	  ein Beispiel.  Das Skript <code class="command">netprint</code>
	  übernimmt alle Daten von der Standardeingabe und schickt
	  sie an einen Netzwerkdrucker.  <code class="command">netprint</code>
	  erwartet zwei Argumente:  Als erstes Argument wird der Hostname
	  des Druckers und als zweites Argument der Port, über den
	  die Verbindung erfolgen soll, übergeben.  Dabei handelt
	  sich allerdings um eine Ein-Wege-Kommunikation (von FreeBSD zum
	  Drucker).  Viele Netzwerkdrucker unterstützen aber auch
	  eine Zwei-Wege-Kommunikation, deren Vorteile (Abfrage des
	  Druckerstatus, die Verrechnung von Druckaufträgen und
	  andere mehr) Sie vielleicht nutzen wollen.</p><pre class="programlisting">#!/usr/bin/perl
#
#  netprint - Textfilter für einen Netzwerkdrucker
#  Installiert unter:  /usr/local/libexec/netprint
#
$#ARGV eq 1 || die "Usage: $0 &lt;printer-hostname&gt; &lt;port-number&gt;";

$printer_host = $ARGV[0];
$printer_port = $ARGV[1];

require 'sys/socket.ph';

($ignore, $ignore, $protocol) = getprotobyname('tcp');
($ignore, $ignore, $ignore, $ignore, $address)
    = gethostbyname($printer_host);

$sockaddr = pack('S n a4 x8', &amp;AF_INET, $printer_port, $address);

socket(PRINTER, &amp;PF_INET, &amp;SOCK_STREAM, $protocol)
    || die "Can't create TCP/IP stream socket: $!";
connect(PRINTER, $sockaddr) || die "Can't contact $printer_host: $!";
while (&lt;STDIN&gt;) { print PRINTER; }
exit 0; </pre><p>Dieses Skript kann für verschiedene Filter
	  eingesetzt werden.  Das folgende Beispiel verwendet den
	  an ein Netzwerk angeschlossenen Zeilendrucker Diablo 750-N.
	  Dieser Drucker empfängt zu druckende Daten auf dem
	  Port 5100.  Der Hostname des Druckers lautet
	  <code class="systemitem">scrivener</code>.
	  Daher sieht der Textfilter für diesen Drucker wie folgt
	  aus:</p><pre class="programlisting">#!/bin/sh
#
#  diablo-if-net - Textfilter für den Diablo-Drucker `scrivener'.
#  Drucker lauscht auf Port 5100.
#  Installiert unter:  /usr/local/libexec/diablo-if-net
#
exec /usr/libexec/lpr/lpf "$@" | /usr/local/libexec/netprint scrivener 5100</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-restricting"></a>10.4.4. Den Druckerzugriff beschränken</h3></div></div></div><a id="idp74807632" class="indexterm"></a><p>Dieser Abschnitt beschreibt, wie Sie den Druckerzugriff
	beschränken können.  Das
	<span class="application">LPD</span>-Drucksystem erlaubt Ihnen die
	Kontrolle darüber, wer lokal oder über ein Netzwerk
	auf einen Drucker zugreifen darf, ob mehrere Kopien erstellt
	werden dürfen und wie groß Druckaufträge und
	Druckerwarteschlangen werden dürfen.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-restricting-copies"></a>10.4.4.1. Den Ausdruck von mehreren Kopien verhindern</h4></div></div></div><p>Das <span class="application">LPD</span>-System macht es dem
	  einzelnen Benutzer einfach, mehrere Kopien einer Datei zu
	  drucken.  So werden mit <code class="command">lpr -#5</code>
	  beispielsweise fünf Kopien jeder Datei des Druckauftrags
	  erstellt.  Ob dies gut oder schlecht ist, müssen Sie
	  selbst entscheiden.</p><p>Wenn Sie der Meinung sind, dass multiple Kopien eine
	  unnötige Beanspruchung Ihres Druckers darstellen,
	  sollten Sie die <code class="option">-#</code>-Opion von <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a>
	  deaktivieren, indem Sie die
	  <code class="literal">sc</code>-Fähigkeit in Ihre
	  <code class="filename">/etc/printcap</code> aufnehmen.  Verwendet ein
	  Benutzer dennoch die Option <code class="option">-#</code>, erhält
	  er daraufhin folgende Meldung:</p><pre class="screen">lpr: multiple copies are not allowed</pre><p>Wenn Sie den Zugriff auf einen entfernten Drucker
	  (wie in Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-network-rm" title="10.4.3.1. Auf entfernten Rechnern installierte Drucker">Auf entfernten
	  Rechnern installierte Drucker</a> beschrieben) konfiguriert
	  haben, müssen Sie die <code class="literal">sc</code>-Fähigkeit
	  auch auf den entfernten Rechnern, die auf Ihren Drucker
	  zugreifen dürfen, in <code class="filename">/etc/printcap</code>
	  eintragen, damit Benutzer diese Vorgabe nicht durch den Wechsel
	  auf einen anderen Rechner umgehen können.</p><p>Dazu ein Beispiel.  Es handelt sich dabei um die Datei
	  <code class="filename">/etc/printcap</code> auf dem Rechner
	  <code class="systemitem">rose</code>.  Der Drucker <code class="literal">rattan</code>
	  soll multiple Kopien zulassen, auf dem Laserdrucker
	  <code class="literal">bamboo</code> sollen multiple Kopien hingegen
	  nicht erlaubt sein, daher müssen wir für diesen
	  Drucker die <code class="literal">sc</code>-Fähigkeit
	  aktivieren:</p><pre class="programlisting">#
#  /etc/printcap für den Rechner rose - multiple Kopien auf bamboo verbieten
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=<code class="filename">/var/spool/lpd/rattan</code>:\
        :lp=<code class="filename">/dev/lpt0</code>:\
        :if=<code class="filename">/usr/local/libexec/if-simple</code>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<code class="filename">/var/spool/lpd/bamboo</code>:sc:\
        :lp=<code class="filename">/dev/ttyu5</code>:ms#-parenb cs8 clocal crtscts:rw:\
        :if=<code class="filename">/usr/local/libexec/psif</code>:\
        :df=<code class="filename">/usr/local/libexec/psdf</code>:</pre><p>Außerdem müssen wir noch die
	  <code class="literal">sc</code>-Fähigkeit in der Datei
          <code class="filename">/etc/printcap</code> des Rechners
	  <code class="systemitem">orchid</code> aktivieren.  Parallel dazu untersagen
	  wir das Erstellen von multiplen Kopien auf dem Drucker
	  <code class="literal">teak</code>:</p><pre class="programlisting">#
#  /etc/printcap für den Rechner orchid - lokal machen wir keine multiplen Kopien
#  Lokaler Drucker teak oder entfernter Drucker bamboo:
teak|hp|laserjet|Hewlett Packard LaserJet 3Si:\
        :lp=<code class="filename">/dev/lpt0</code>:sd=<code class="filename">/var/spool/lpd/teak</code>:mx#0:sc:\
        :if=<code class="filename">/usr/local/libexec/ifhp</code>:\
        :vf=<code class="filename">/usr/local/libexec/vfhp</code>:\
        :of=<code class="filename">/usr/local/libexec/ofhp</code>:

rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :lp=:rm=rose:rp=rattan:sd=<code class="filename">/var/spool/lpd/rattan</code>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :lp=:rm=rose:rp=bamboo:sd=<code class="filename">/var/spool/lpd/bamboo</code>:sc:</pre><p>Durch die Verwendung der
	  <code class="literal">sc</code>-Fähigkeit ist zwar die Verwendung
	  von <code class="command">lpr -#</code> nicht mehr
	  möglich, ein Benutzer kann aber weiterhin <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lpr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">lpr</span>(1)</span></a> mehrmals
	  hintereinander aufrufen oder eine Datei mehrfach in den gleichen
	  Druckauftrag aufnehmen:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>lpr forsale.sign forsale.sign forsale.sign forsale.sign forsale.sign</code></strong></pre><p>Auch dieser Mißbrauch Ihres Druckers kann verhindert
	  werden, falls Sie dies wünschen.  Diese Maßnahmen
	  werden in diesem Abschnitt allerdings nicht behandelt.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-restricting-access"></a>10.4.4.2. Den Zugriff auf bestimmte Drucker beschränken</h4></div></div></div><p>Sie können angeben, wer auf welchem Drucker drucken
	  darf, wenn Sie den Gruppenmechanismus von <span class="trademark">UNIX</span>® in Kombination
	  mit der <code class="literal">rg</code>-Fähigkeit von
	  <code class="filename">/etc/printcap</code> einsetzen.  Weisen Sie dazu
	  alle Benutzer, die auf einen Drucker zugreifen dürfen,
	  einer gemeinsamen Gruppe zu und geben Sie diese Gruppe
	  über die <code class="literal">rg</code>-Fähigkeit an.</p><p>Wenn Benutzer, die dieser Gruppe nicht angehören (dies
	  gilt auch für <code class="systemitem">root</code>), werden diese durch
	  die Meldung begrüsst, wenn Sie diesen Drucker verwenden
	  wollen.</p><pre class="screen">lpr: Not a member of the restricted group</pre><p>Analog zur <code class="literal">sc</code>-Fähigkeit
	  (<span class="emphasis"><em>suppress multiple copies</em></span>) müssen
	  Sie die <code class="literal">rg</code>-Fähigkeit auch auf allen
	  entfernten Rechnern aktivieren, die auf Ihren Drucker
	  zugreifen dürfen (lesen Sie dazu auch den Abschnitt
	  <a class="link" href="printing-advanced.html#printing-advanced-network-rm" title="10.4.3.1. Auf entfernten Rechnern installierte Drucker">Auf entfernten
	  Rechnern installierte Drucker</a>).</p><p>Wollen wir beispielsweise allen Benutzern die Verwendung
	  des Druckers <code class="literal">rattan</code>, aber nur Mitgliedern
	  der Gruppe <code class="systemitem">artists</code> die Verwendung des
	  Druckers <code class="literal">bamboo</code> erlauben, passen wir die
	  bereits bekannte <code class="filename">/etc/printcap</code> des
	  Rechners <code class="systemitem">rose</code> entsprechend an:</p><pre class="programlisting">#
#  /etc/printcap des Rechners rose - Zugriffsbeschränkung für bamboo
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:sd=<code class="filename">/var/spool/lpd/rattan</code>:\
        :lp=<code class="filename">/dev/lpt0</code>:\
        :if=<code class="filename">/usr/local/libexec/if-simple</code>:

bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<code class="filename">/var/spool/lpd/bamboo</code>:sc:rg=artists:\
        :lp=<code class="filename">/dev/ttyu5</code>:ms#-parenb cs8 clocal crtscts:rw:\
        :if=<code class="filename">/usr/local/libexec/psif</code>:\
        :df=<code class="filename">/usr/local/libexec/psdf</code>:</pre><p>Die Datei <code class="filename">/etc/printcap</code> des Rechners
	  <code class="systemitem">orchid</code> wird dadurch nicht beeinflusst.  Jeder
	  Benutzer des Rechners <code class="systemitem">orchid</code> kann also
	  weiterhin den Drucker <code class="literal">bamboo</code> verwenden.</p><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Für jeden Drucker kann nur eine einzige
	    priviligierte Gruppe erstellt werden.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-restricting-sizes"></a>10.4.4.3. Die Größe von Druckaufträgen kontrollieren</h4></div></div></div><a id="idp74903248" class="indexterm"></a><p>Wenn Sie viele Benutzer haben, die Ihre Drucker verwenden
	  dürfen, werden Sie wahrscheinlich eine Obergrenze für
	  Dateien angeben wollen, die Benutzer an Ihren Drucker senden
	  dürfen.  Dies ist sinnvoll, weil Speicherplatz für
	  Spooling-Verzeichnisse nur begrenzt verfügbar ist und Sie stets
	  sicherstellen müssen, dass auch die Druckaufträge anderer
	  Benutzer verarbeitet werden können.</p><a id="idp74904144" class="indexterm"></a><p><span class="application">LPD</span> verwendet die
	  <code class="literal">mx</code>-Fähigkeit, um die maximal erlaubte
	  Größe von Dateien eines Druckauftrags anzugeben.
	  Dieser Wert wird in 1.024 Bytes großen
	  <code class="literal">BUFSIZ</code>-Blöcken angegeben.  Setzen Sie
	  diesen Wert auf Null, gibt es keine
	  Größenbeschränkung.  Existiert die
	  <code class="literal">mx</code>-Fähigkeit hingegen überhaupt
	  nicht, so gilt ein Limit von 1.000 Blöcken.</p><div xmlns="" class="note"><h3 class="admontitle">Anmerkung: </h3><p xmlns="http://www.w3.org/1999/xhtml">Diese Limits gelten nur für die Größe
	    von <span class="emphasis"><em>Dateien</em></span> innerhalb eines
	    Druckauftrages, <span class="emphasis"><em>nicht aber</em></span> für
	    die Gesamtgröße des Druckauftrags.</p></div><p><span class="application">LPD</span> lehnt eine Datei auch dann
	  nicht ab, wenn sie das Limit des Druckers überschreitet.
	  Vielmehr wird die Datei bis zum Erreichen des Limits in die
	  Warteschlange geladen, danach wird der Druck gestartet.  Der
	  das Limit überschreitende Rest wird hingegen verworfen
	  und nicht gedruckt!</p><p>Mit diesem Wissen können wir nun Limits für die
	  Drucker <code class="literal">rattan</code> und <code class="literal">bamboo</code>
	  definieren.  Da <span class="trademark">PostScript</span>®-Dateien der Gruppe
	  <code class="systemitem">artists</code> in der Regel sehr groß
	  sind, setzen wir ein Limit von fünf Megabytes.  Für
	  den Druck von normalen Text (auf dem Drucker
	  <code class="literal">rattan</code>) setzen wir hingegen kein Limit:</p><pre class="programlisting">#
#  /etc/printcap für den Rechner rose
#

#
#  Kein Größenlimit:
#
rattan|line|diablo|lp|Diablo 630 Line Printer:\
        :sh:mx#0:sd=<code class="filename">/var/spool/lpd/rattan</code>:\
        :lp=<code class="filename">/dev/lpt0</code>:\
        :if=<code class="filename">/usr/local/libexec/if-simple</code>:

#
#  Ein Limit von 5 Megabyte:
#
bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<code class="filename">/var/spool/lpd/bamboo</code>:sc:rg=artists:mx#5000:\
        :lp=<code class="filename">/dev/ttyu5</code>:ms#-parenb cs8 clocal crtscts:rw:\
        :if=<code class="filename">/usr/local/libexec/psif</code>:\
        :df=<code class="filename">/usr/local/libexec/psdf</code>:</pre><p>Auch diese Limits gelten nur für lokale Benutzer.
	  Wenn Sie den Zugriff auf Ihren Drucker auch über ein
	  Netzwerk erlauben wollen, unterliegen die Benutzer dieser
	  Rechner diesen Limits nicht.  Daher müssen Sie diese
	  Limits über die <code class="literal">mx</code>-Fähigkeit
	  auch in der <code class="filename">/etc/printcap</code> jedes
	  Rechners definieren, der Ihren Drucker verwenden darf.
	  Der Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-network-rm" title="10.4.3.1. Auf entfernten Rechnern installierte Drucker">
	  Auf entfernten Rechnern installierte Drucker</a>
	  enthält weitere Informationen zum Drucken über
	  ein Netzwerk.</p><p>Es gibt eine weitere Möglichkeit, um die
	  Größe von Druckaufträgen von entfernten
	  Rechnern zu beschränken.  Lesen Sie dazu den Abschnitt
	  <a class="link" href="printing-advanced.html#printing-advanced-restricting-remote" title="10.4.4.4. Druckaufträge von entfernten Rechnern beschränken">
	  Druckaufträge von entfernten Rechnern
	  beschränken</a>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-restricting-remote"></a>10.4.4.4. Druckaufträge von entfernten Rechnern
	  beschränken</h4></div></div></div><p>Das <span class="application">LPD</span>-System bietet mehrere
	  Möglichkeiten, um Druckaufträge zu beschränken,
	  die auf entfernten Rechnern gestartet wurden:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Rechner beschränken</span></dt><dd><p>Sie können festlegen, von welchen entfernten
	        Rechnern ein lokaler <span class="application">LPD</span>
	        Druckaufträge annimmt, indem Sie die Dateien
	        <code class="filename">/etc/hosts.equiv</code> sowie
	        <code class="filename">/etc/hosts.lpd</code> entsprechend
	        anpassen.  <span class="application">LPD</span>
	        überprüft diese Dateien, um festzustellen,
	        ob ein Druckauftrag von einem Rechner stammt, der in
	        einer dieser Dateien aufgeführt ist.  Ist dies
	        nicht der Fall, lehnt <span class="application">LPD</span>
	        den Druckauftrag ab.</p><p>Der Aufbau dieser Datei ist sehr einfach:  Jede
	        Zeile enthält einen einzigen Rechnernamen.
	        Beachten Sie aber, dass
	        <code class="filename">/etc/hosts.equiv</code> auch vom
	        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ruserok&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">ruserok</span>(3)</span></a>-Protokoll benötigt wird und
	        Änderungen dieser Datei auch Programme wie
	        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rsh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rsh</span>(1)</span></a> und <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rcp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rcp</span>(1)</span></a> beeinflussen
	        können.</p><p>Das folgende Beispiel beschreibt die Datei
	        <code class="filename">/etc/hosts.lpd</code> auf dem Rechner
	        <code class="systemitem">rose</code>:</p><pre class="programlisting">orchid
violet
madrigal.fishbaum.de</pre><p>Durch diese Vorgaben akzeptiert <code class="systemitem">rose</code>
	        nur noch Druckaufträge von den Rechnern
	        <code class="systemitem">orchid</code>, <code class="systemitem">violet</code>,
	        und <code class="systemitem">madrigal.fishbaum.de</code>.
	        Versucht ein anderer Rechner, auf den
	        <span class="application">LPD</span> von
	        <code class="systemitem">rose</code> zuzugreifen, wird dieser
	        Druckauftrag abgelehnt werden.</p></dd><dt><span class="term">Größenbeschränkungen</span></dt><dd><p>Sie können festlegen, wieviel Speicherplatz
	        auf dem Dateisystem, in dem das Spooling-Verzeichnis
	        liegt, mindestens frei sein muss.  Dazu erzeugen Sie im
	        Spooling-Verzeichnis Ihres lokalen Druckers die Datei
	        <code class="filename">minfree</code>.  In dieser Datei geben
	        Sie an, wieviele 512 Byte große
	        Blöcke auf Ihrer Platte frei sein müssen,
	        damit ein Druckauftrag von einem entfernten Rechner
	        akzeptiert wird.</p><p>Durch diese Vorgabe können Sie sicherstellen,
	        dass Benutzer von entfernten Rechnern Ihr Dateisystem
	        nicht <span class="quote">&#8222;<span class="quote">zumüllen</span>&#8220;</span>.  Außerdem
	        können Sie damit lokale Benutzer bevorzugen, da
	        diese auch dann noch Druckaufträge erteilen
	        dürfen, wenn der verfügbare Plattenplatz
	        unter das in der Datei <code class="filename">minfree</code>
	        definierte Limit gefallen ist.</p><p>Legen wir nun die Datei <code class="filename">minfree</code>
	        für den Drucker <code class="literal">bamboo</code> an.  Zuerst
	        untersuchen wir <code class="filename">/etc/printcap</code>, um
	        das Spooling-Verzeichnis für diesen Drucker zu
	        finden.  Das folgende Beispiel zeigt den Eintrag
	        für den Drucker <code class="literal">bamboo</code>:</p><pre class="programlisting">bamboo|ps|PS|S|panasonic|Panasonic KX-P4455 PostScript v51.4:\
        :sh:sd=<code class="filename">/var/spool/lpd/bamboo</code>:sc:rg=artists:mx#5000:\
        :lp=<code class="filename">/dev/ttyu5</code>:ms#-parenb cs8 clocal crtscts:rw:mx#5000:\
        :if=<code class="filename">/usr/local/libexec/psif</code>:\
        :df=<code class="filename">/usr/local/libexec/psdf</code>:</pre><p>Das Spooling-Verzeichnis wird über die
	        <code class="literal">sd</code>-Fähigkeit festgelegt.
	        Wir wollen, dass mindestens drei Megabyte
	        (also 6144 Blöcke) freier Plattenplatz
	        vorhanden sein müssen, damit
	        <span class="application">LPD</span> einen Druckauftrag
	        von einem entfernten Rechner akzeptiert:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 6144 &gt; /var/spool/lpd/bamboo/minfree</code></strong></pre></dd><dt><span class="term">Benutzer beschränken</span></dt><dd><p>Sie können auch festlegen, welche entfernten
	        Benutzer Ihren lokalen Drucker verwenden dürfen,
	        indem Sie die <code class="literal">rs</code>-Fähigkeit in
	        <code class="filename">/etc/printcap</code> definieren.  Wenn
	        für den Eintrag eines lokalen Druckers die
	        <code class="literal">rs</code>-Fähigkeit definiert ist,
	        akzeptiert <span class="application">LPD</span>
	        Druckaufträge von entfernten Rechnern nur dann,
	        <span class="emphasis"><em>wenn</em></span> der Benutzer, der den
	        Druckauftrag gesendet hat, auch über ein
	        gleichnamiges Benutzerkonto auf dem lokalen Rechner
	        verfügt.  Ist dies nicht der Fall, lehnt
	        <span class="application">LPD</span> den Druckauftrag ab.</p><p>Diese Fähigkeit ist besonders in Umgebungen
	        nützlich, in denen beispielsweise verschiedene
	        Abteilungen ein gemeinsames Netzwerk teilen, wobei
	        einige Benutzer zu mehreren Abteilungen gehören.
	        Haben diese Benutzer auch ein Benutzerkonto auf Ihrem
	        System, so können sie Ihren Drucker auch von
	        ihrer eigenen Abteilung aus nutzen.  Wollen Sie zwar
	        den Zugriff auf Ihren Drucker, <span class="emphasis"><em>nicht
	        aber</em></span> den Zugriff auf Ihre übrigen
	        Ressourcen erlauben, können Sie für diese
	        Benutzer einen sogenannten <span class="quote">&#8222;<span class="quote">Token-Account</span>&#8220;</span>
	        ohne Heimatverzeichnis und mit einer nutzlosen Shell
	        wie <code class="filename">/usr/bin/false</code> erstellen.</p></dd></dl></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="printing-advanced-acct"></a>10.4.5. Die Druckernutzung verrechnen</h3></div></div></div><a id="idp74955088" class="indexterm"></a><p>Sie wollen die Nutzung Ihrer Drucker kostenpflichtig machen?
	Warum auch nicht?  Papier und Tinte kosten Geld.  Auch eine
	regelmäßige Wartung muss bezahlt werden.  Nachdem Sie
	einen Preis festgelegt haben, den Sie für jede
	gedruckte Seite verrechnen wollen, stellt sich die Frage, wie Sie
	die Verrechnung der Druckkosten technisch umsetzen
	können.</p><p>Die schlechte Nachricht ist, dass das
	<span class="application">LPD</span>-System dabei wenig hilfreich ist.
	Die Verrechnung von Druckaufträgen hängt stark vom
	verwendeten Drucker, den zu druckenden Dateiformaten und
	<span class="emphasis"><em>Ihren</em></span> Anforderungen an die Verrechnung
	der Druckernutzung ab.</p><p>Um die Verrechnung der Druckernutzung zu implementieren,
	müssen Sie sowohl Ihre Textfilter (um den Druck von
	normalem Text abzurechnen) als auch Ihre Konvertierungsfilter
	(um den Druck sonstiger Formate abzurechnen) entsprechend
	anpassen, damit diese die Zahl der gedruckten Seiten
	ermitteln können.  Leider können Sie dazu nicht
	einen einfachen Ausgabefilter verwenden, da diese die
	Verrechnung von Druckaufträgen nicht unterstützen.
	Weitere Informationen zu den verschiedenen Filterarten finden
	Sie im Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-filter-intro" title="10.4.1. Filter">Filter</a>.</p><p>Prinzipiell gibt es zwei Möglichkeiten, wie Sie diese
	Verrechnung umsetzen können:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Die <span class="emphasis"><em>periodische Verrechnung</em></span> wird
	    häufiger verwendet, da sie einfacher zu implementieren
	    ist.  Wenn ein Druckauftrag ausgeführt wird,
	    schreibt der Filter den Benutzer, den verwendeten Rechner
	    sowie die Anzahl der gedruckten Seiten in eine
	    Verrechnungsdatei.  Nach einem zu definierenden Zeitraum
	    werden diese Dateien ausgewertet, die Gesamtzahl der
	    von einem Benutzer gedruckten Seiten bestimmt und dem
	    jeweiligen Benutzer verrechnet.  Danach werden alle
	    Protokolldateien zurückgesetzt, und die Protokollierung
	    beginnt von Neuem.</p></li><li class="listitem"><p>Die <span class="emphasis"><em>unmittelbare Verrechnung</em></span> wird
	    nur selten eingesetzt, das sie schwieriger zu implementieren
	    ist.  Bei dieser Methode wird der Druckauftrag verrechnet,
	    sobald der Drucker verwendet wird.  Dadurch können Sie
	    beispielsweise verhindern, dass ein Benutzer seine erlaubte
	    <span class="quote">&#8222;<span class="quote">Druckquote</span>&#8220;</span> überschreitet.
	    Zusätzlich können Sie es Ihren Benutzern erlauben,
	    deren Druckquote abzufragen oder anzupassen.  Allerdings
	    benötigen Sie eine Datenbank, um Benutzer und deren
	    Quoten verwalten zu können.</p></li></ul></div><p>Das <span class="application">LPD</span>-Drucksystem
	unterstützt beide Methoden.  Allerdings müssen Sie
	die benötigen Filter sowie den zur Verrechnung nötigen
	Code selbst bereitstellen.  Der Vorteil dabei ist allerdings,
	dass Sie in der Wahl Ihrer Verrechnungsmethode äußerst
	flexibel sind.  So können Sie sich etwa für die
	periodische oder die unmittelbare Verrechnung entscheiden.  Sie
	können festlegen, welche Informationen Sie erfassen wollen:
	Benutzernamen, Rechnernamen, die Art der Druckaufträge,
	die Anzahl der gedruckten Seiten, den Papierverbrauch, den
	Zeitaufwand für die Bearbeitung eines Druckauftrages und
	viele andere mehr.  Dazu müssen Sie Ihre Filter entsprechend
	anpassen, damit diese Informationen erfassst und gespeichert
	werden.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp74991696"></a>10.4.5.1. Kurzanleitung für die Implementierung der
	  Druckerverrechnung</h4></div></div></div><p>FreeBSD bietet Ihnen zwei Programme, um eine periodische
	  Verrechnung rasch zu implementieren.  Dabei handelt es sich
	  um den im Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-lpf" title="10.4.1.6. lpf: Ein Textfilter">lpf:  Ein Textfilter</a>
	  behandelten Textfilter sowie um <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a>, ein Programm,
	  mit dem Sie Einträge aus Verrechnungsdateien auslesen
	  und aufsummieren können.</p><p>Wie bereits im Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-filters" title="10.4.1.1. Die Funktionsweise von Filtern">Filter</a> erwähnt,
	  startet <span class="application">LPD</span> den Text- oder
	  Konvertierungsfilter mit dem Namen der Verrechnungsdatei als
	  Argument.  Dadurch weiß der Filter, in welche Datei
	  er einen Verrechnungseintrag schreiben soll.  Der Name dieser
	  Datei wird über die <code class="literal">af</code>-Fähigkeit
	  in <code class="filename">/etc/printcap</code> festgelegt.  Falls die
	  Datei nicht über einen absoluten Pfad angegeben wird,
	  handelt es sich um einen Pfad relativ zum
	  Spooling-Verzeichnis.</p><p><span class="application">LPD</span> startet
	  <code class="command">lpf</code> mit den Argumenten <span class="emphasis"><em>page width
	  und page length</em></span>, die über die
	  <code class="literal">pw</code>- und <code class="literal">pl</code>-Fähigkeit
	  definiert werden.  Das Kommando <code class="command">lpf</code> verwendet
	  diese Argumente danach, um den Papierverbrauch zu bestimmen.  Nachdem
	  die Datei an den Drucker geschickt wurde, wird ein
	  Verrechnungseintrag in die Verrechnungsdatei geschrieben.  Ein
	  solcher Eintrag sieht dabei ähnlich den folgenden aus:</p><pre class="programlisting">2.00 rose:andy
3.00 rose:kelly
3.00 orchid:mary
5.00 orchid:mary
2.00 orchid:zhang</pre><p>Sie sollten für jeden Drucker eine eigene
	  Verrechnungsdatei verwenden, da <code class="command">lpf</code>
	  die Verrechnungsdatei nicht sperren kann.  Sind also
	  gleichzeitig zwei <code class="command">lpf</code>-Instanzen aktiv,
	  kann es dazu kommen, dass Ihre Verrechnungsdatei zerstört
	  wird, wenn beide Instanzen gleichzeitig in die gleiche Datei
	  schreiben.  Damit für jeden Drucker eine eigene
	  Verrechnungsdatei angelegt wird, fügen Sie den
	  Eintrag <code class="literal">af=acct</code> in
	  <code class="filename">/etc/printcap</code> ein.  Dadurch wird für
	  jeden Drucker eine separate Verrechnungsdatei mit dem Namen
	  <code class="filename">acct</code> im Spooling-Verzeichnis des
	  jeweiligen Druckers erzeugt.</p><p>Wenn Sie Ihre Daten erfasst haben und die entstandenen
	  Kosten Ihren Benutzern verrechnen wollen, starten Sie
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a>.  Dazu wechseln Sie in das Spooling-Verzeichnis
	  des auszuwertenden Druckers und geben <code class="command">pac</code>
	  ein.  Dadurch erhalten Sie eine Ausgabe ähnlich
	  der folgenden:</p><pre class="screen">  Login               pages/feet   runs    price
orchid:kelly                5.00    1   $  0.10
orchid:mary                31.00    3   $  0.62
orchid:zhang                9.00    1   $  0.18
rose:andy                   2.00    1   $  0.04
rose:kelly                177.00  104   $  3.54
rose:mary                  87.00   32   $  1.74
rose:root                  26.00   12   $  0.52

total                     337.00  154   $  6.74</pre><p>Folgende Argumente können an <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a>
	  übergeben werden:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-P<em class="replaceable"><code>Drucker</code></em></code></span></dt><dd><p>Gibt an, welcher <em class="replaceable"><code>Drucker</code></em>
	        ausgewertet werden soll.  Diese Option setzt voraus,
	        dass für die <code class="literal">af</code>-Fähigkeit
	        in <code class="filename">/etc/printcap</code> ein absoluter
	        Pfad angegeben wurde.</p></dd><dt><span class="term"><code class="option">-c</code></span></dt><dd><p>Sortiert die Ausgabe nach den verursachten Kosten
	        anstelle einer alphabetischen Sortierung der
	        Benutzernamen.</p></dd><dt><span class="term"><code class="option">-m</code></span></dt><dd><p>Ignoriert den Rechnernamen in Verrechnungsdateien.
	        Ist diese Option gesetzt, ist der Benutzer
	        <code class="systemitem">smith</code> auf dem Rechner
	        <code class="systemitem">alpha</code> mit dem Benutzer
	        <code class="systemitem">smith</code> auf dem Rechner
	        <code class="systemitem">gamma</code> identisch.  Ist diese Option
	        nicht gesetzt, handelt es sich um unterschiedliche
	        Benutzer.</p></dd><dt><span class="term"><code class="option">-p<em class="replaceable"><code>Preis</code></em></code></span></dt><dd><p>Berechnet die entstandenen Kosten aus dem
	        <em class="replaceable"><code>Preis</code></em> in Dollar pro Seite
	        statt aus dem über die
	        <code class="literal">pc</code>-Fähigkeit in
	        <code class="filename">/etc/printcap</code> definierten Preis.
	        In der Voreinstellung sind dies zwei Cent pro Seite.
	        Sie können aber auch einen eigenen
	        <em class="replaceable"><code>Preis</code></em> in Form einer
	        Gleitkommazahl angeben.</p></dd><dt><span class="term"><code class="option">-r</code></span></dt><dd><p>Die Sortierreihenfolge umkehren.</p></dd><dt><span class="term"><code class="option">-s</code></span></dt><dd><p>Die Verrechnungsdatei in einer neuen Datei
	        aufsummieren und die originale Verrechnungsdatei
	        zurücksetzen.</p></dd><dt><span class="term"><em class="replaceable"><code>name</code></em>
	      <em class="replaceable"><code>&#8230;</code></em></span></dt><dd><p>Verrechnungsinformationen nur für die
	        angegebenen Benutzernamen ausgeben.</p></dd></dl></div><p>In der Voreinstellung gibt <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a> aus, wieviele
	  Seiten von welchem Benutzer auf welchem Rechner gedruckt
	  wurden.  Wenn Rechnernamen für Sie uninteressant sind
	  (weil sich Benutzer beispielsweise auf jedem Rechner
	  anmelden können), sollten Sie <code class="command">pac
	  -m</code> verwenden, um die folgende Ausgabe zu
	  erhalten:</p><pre class="screen">  Login               pages/feet   runs    price
andy                        2.00    1   $  0.04
kelly                     182.00  105   $  3.64
mary                      118.00   35   $  2.36
root                       26.00   12   $  0.52
zhang                       9.00    1   $  0.18

total                     337.00  154   $  6.74</pre><p>Um den zu verrechnenden Betrag zu ermitteln, verwendet
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a> die <code class="literal">pc</code>-Fähigkeit von
	  <code class="filename">/etc/printcap</code> (Voreinstellung 200, dieser
	  Wert entspricht 2 Cents).  Geben Sie hier (als Hundertfaches
	  des tatsächlichen Wertes) den Preis pro Seite an, den
	  Sie verrechnen wollen. Sie können diesen Wert
	  überschreiben, wenn Sie <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a> mit der Option
	  <code class="option">-p</code> ausführen.  Beachten Sie dabei aber,
	  dass Sie in diesem Fall die Einheiten in Dollar angeben, und
	  nicht als Hundertfaches des tatsächlichen Cent-Betrages.
	  So steht</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pac -p1.50</code></strong></pre><p>beispielsweise für einen Preis von einem Dollar und
	  fünfzig Cent pro Seite.</p><p>Der Aufruf von <code class="command">pac -s</code>
          führt schließlich dazu, dass die aufsummierten
          Informationen in einer eigenen Auswertedatei gespeichert werden.
          Diese hat den gleichen Namen wie die Verrechnungsdatei, es wird
	  lediglich ein <code class="literal">_sum</code> an den Dateinamen
	  angehängt.   Danach wird die Verrechnungsdatei
	  zurückgesetzt.  Wenn Sie <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pac</span>(8)</span></a> erneut aufrufen,
	  wird die Auswertedatei eingelesen, um die Startbeträge
	  zu erhalten, alle weiteren Informationen stammen danach
	  aus der normalen Verrechnungsdatei.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75043536"></a>10.4.5.2. Wie kann man die Anzahl der gedruckten Seiten
	  ermitteln?</h4></div></div></div><p>Um die Druckernutzung auch nur annähernd genau
	  verrechnen zu können, müssen Sie ermitteln, wieviel
	  Papier ein Druckauftrag verbraucht.  Die Bestimmung dieses
	  Wertes ist das zentrale Problem, das Sie lösen müssen,
	  wenn Sie Druckaufträge kostenpflichtig machen wollen.</p><p>Normaler Text stellt in der Regel kein Problem dar:  Sie
	  zählen dazu nur die Zeilen des Druckauftrages und
	  dividieren diesen Wert durch die Anzahl der Zeilen pro Seite,
	  die Ihr Drucker bietet.  Allerdings dürfen Sie dabei
	  nicht vergessen, dass gelöschte Zeichen
	  (<span class="foreignphrase"><em class="foreignphrase">Backspaces</em></span>) Zeilen
	  überschreiben.  Außerdem können sich lange
	  logische Zeilen (im Druckauftrag) über mehrere
	  physikalische Zeilen (am Ausdruck) erstrecken.</p><p>Der im Abschnitt <a class="link" href="printing-advanced.html#printing-advanced-lpf" title="10.4.1.6. lpf: Ein Textfilter">lpf:
	  Ein Textfilter</a> vorgestellte Textfilter
	  <code class="command">lpf</code> berücksichtigt diese
	  Besonderheiten. Wenn Sie einen eigenen Textfilter für
	  die Verrechnung der Druckernutzung schreiben wollen, sollten
	  Sie sich daher den Quellcode von <code class="command">lpf</code>
	  näher ansehen.</p><p>Aber was ist mit anderen Dateiformaten?</p><p>Für die DVI-nach-LaserJet- oder für die
	  DVI-nach-<span class="trademark">PostScript</span>®-Konvertierung können Sie die
	  Protokolldateien von <code class="command">dvilj</code> oder
	  <code class="command">dvips</code> auslesen, um festzustellen, wieviele
	  Seiten konvertiert wurden.  Die gleiche Methode könnte
	  auch mit anderen Dateitypen funktionieren.</p><p>Alle diese Methoden haben aber das Problem, dass ein
	  Drucker möglicherweise nicht alle Seiten des
	  Druckauftrages drucken kann.  So könnte es etwa zu einem
	  Papierstau kommen, der Toner könnte zu Ende gehen oder
	  es könnte ein Druckerdefekt
	  auftreten &#8211; trotzdem würden alle Seiten
	  des Druckauftrages verrechnet werden.</p><p>Was kann man dagegen tun?</p><p>Es gibt nur eine einzige <span class="emphasis"><em>sichere</em></span>
	  Methode, um die Druckernutzung <span class="emphasis"><em>exakt</em></span>
	  zu bestimmen.  Besorgen Sie sich einen Drucker, der das
	  verbrauchte Papier protokolliert und verbinden Sie ihn
	  über eine serielle oder eine Netzwerkverbindung.
	  Nahezu alle <span class="trademark">PostScript</span>®-Drucker, aber auch viele andere
	  Modelle und Druckertypen (beispielsweise Laserdrucker von
	  Imagen) sind dazu in der Lage.  Passen Sie die Filter
	  für diese Drucker entsprechend an, damit diese
	  nach jedem Druckauftrag die Anzahl der gedruckten Seiten
	  ermitteln und verrechnen Sie Druckaufträge
	  <span class="emphasis"><em>ausschließlich</em></span> über diesen
	  Wert.  Danach müssen Sie sich um die Anzahl
	  der gedruckten Zeilen oder um mögliche Druckerprobleme
	  nie mehr kümmern.</p><p>Sie können aber auch großzügig sein und alle
          Ausdrucke kostenlos abgeben.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="printing-intro-setup.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="printing.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="printing-using.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">10.3. Grund-Konfiguration </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> 10.5. Drucker verwenden</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Wenn Sie Fragen zu FreeBSD haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-questions@de.FreeBSD.org">de-bsd-questions@de.FreeBSD.org</a>&gt;.<br></br>
    Wenn Sie Fragen zu dieser Dokumentation haben, schicken Sie eine E-Mail an
    &lt;<a href="mailto:de-bsd-translators@de.FreeBSD.org">de-bsd-translators@de.FreeBSD.org</a>&gt;.</small></p></body></html>