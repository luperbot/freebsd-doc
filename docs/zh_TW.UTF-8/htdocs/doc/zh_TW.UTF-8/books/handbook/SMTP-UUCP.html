<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>28.7. SMTP with UUCP</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="mail.html" title="章 28. 電子郵件" /><link rel="prev" href="mail-advanced.html" title="28.6. Advanced Topics" /><link rel="next" href="outgoing-only.html" title="28.8. Setting Up to Send Only" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">28.7. SMTP with UUCP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mail-advanced.html">前一頁</a> </td><th width="60%" align="center">章 28. 電子郵件</th><td width="20%" align="right"> <a accesskey="n" href="outgoing-only.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="SMTP-UUCP"></a>28.7. SMTP with UUCP</h2></div></div></div><p>The <span class="application">sendmail</span> configuration that ships with FreeBSD is
      designed for sites that connect directly to the Internet.  Sites
      that wish to exchange their mail via UUCP must install another
      <span class="application">sendmail</span> configuration file.</p><p>Tweaking <code class="filename">/etc/mail/sendmail.cf</code> manually
      is an advanced topic. <span class="application">sendmail</span> version 8 generates config files
      via <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=m4&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">m4</span>(1)</span></a> preprocessing, where the actual configuration
      occurs on a higher abstraction level. The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=m4&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">m4</span>(1)</span></a>
      configuration files can be found under
      <code class="filename">/usr/share/sendmail/cf</code>.  The file
      <code class="filename">README</code> in the <code class="filename">cf</code>
      directory can serve as a basic introduction to <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=m4&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">m4</span>(1)</span></a>
      configuration.</p><p>The best way to support UUCP delivery is to use the
      <code class="literal">mailertable</code> feature.  This creates a database
      that <span class="application">sendmail</span> can use to make routing decisions.</p><p>First, you have to create your <code class="filename">.mc</code>
      file.  The directory
      <code class="filename">/usr/share/sendmail/cf/cf</code> contains a
      few examples.  Assuming you have named your file
      <code class="filename">foo.mc</code>, all you need to do in order to
      convert it into a valid <code class="filename">sendmail.cf</code>
      is:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /etc/mail</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make foo.cf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cp foo.cf /etc/mail/sendmail.cf</code></strong></pre><p>A typical <code class="filename">.mc</code> file might look
        like:</p><pre class="programlisting">VERSIONID(`<em class="replaceable"><code>Your version number</code></em>') OSTYPE(bsd4.4)

FEATURE(accept_unresolvable_domains)
FEATURE(nocanonify)
FEATURE(mailertable, `hash -o /etc/mail/mailertable')

define(`UUCP_RELAY', <em class="replaceable"><code>your.uucp.relay</code></em>)
define(`UUCP_MAX_SIZE', 200000)
define(`confDONT_PROBE_INTERFACES')

MAILER(local)
MAILER(smtp)
MAILER(uucp)

Cw    <em class="replaceable"><code>your.alias.host.name</code></em>
Cw    <em class="replaceable"><code>youruucpnodename.UUCP</code></em></pre><p>The lines containing
      <code class="literal">accept_unresolvable_domains</code>,
      <code class="literal">nocanonify</code>, and
      <code class="literal">confDONT_PROBE_INTERFACES</code> features will
      prevent any usage of the DNS during mail delivery.  The
      <code class="literal">UUCP_RELAY</code> clause is needed to support UUCP
      delivery.  Simply put an Internet hostname there that is able to
      handle .UUCP pseudo-domain addresses; most likely, you will
      enter the mail relay of your ISP there.</p><p>Once you have this, you need an
      <code class="filename">/etc/mail/mailertable</code> file.  If you have
      only one link to the outside that is used for all your mails,
      the following file will suffice:</p><pre class="programlisting">#
# makemap hash /etc/mail/mailertable.db &lt; /etc/mail/mailertable
.                             uucp-dom:<em class="replaceable"><code>your.uucp.relay</code></em></pre><p>A more complex example might look like this:</p><pre class="programlisting">#
# makemap hash /etc/mail/mailertable.db &lt; /etc/mail/mailertable
#
horus.interface-business.de   uucp-dom:horus
.interface-business.de        uucp-dom:if-bus
interface-business.de         uucp-dom:if-bus
.heep.sax.de                  smtp8:%1
horus.UUCP                    uucp-dom:horus
if-bus.UUCP                   uucp-dom:if-bus
.                             uucp-dom:</pre><p>The first three lines handle special cases where
      domain-addressed mail should not be sent out to the default
      route, but instead to some UUCP neighbor in order to
      <span class="quote">“<span class="quote">shortcut</span>”</span> the delivery path. The next line handles
      mail to the local Ethernet domain that can be delivered using
      SMTP. Finally, the UUCP neighbors are mentioned in the .UUCP
      pseudo-domain notation, to allow for a
      <code class="literal">uucp-neighbor
      !recipient</code>
      override of the default rules. The last line is always a single
      dot, matching everything else, with UUCP delivery to a UUCP
      neighbor that serves as your universal mail gateway to the
      world. All of the node names behind the
      <code class="literal">uucp-dom:</code> keyword must be valid UUCP
      neighbors, as you can verify using the command
      <code class="literal">uuname</code>.</p><p>As a reminder that this file needs to be converted into a
      DBM database file before use.  The command line to accomplish
      this is best placed as a comment at the top of the <code class="filename">mailertable</code> file.
      You always have to execute this command each time you change
      your <code class="filename">mailertable</code> file.</p><p>Final hint: if you are uncertain whether some particular
      mail routing would work, remember the <code class="option">-bt</code>
      option to <span class="application">sendmail</span>. It starts <span class="application">sendmail</span> in <span class="emphasis"><em>address test
      mode</em></span>; simply enter <code class="literal">3,0</code>, followed
      by the address you wish to test for the mail routing.  The last
      line tells you the used internal mail agent, the destination
      host this agent will be called with, and the (possibly
      translated) address. Leave this mode by typing <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sendmail -bt</code></strong>
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &lt;ruleset&gt; &lt;address&gt;
<code class="prompt">&gt;</code> <strong class="userinput"><code>3,0 foo@example.com</code></strong>
canonify           input: foo @ example . com
...
parse            returns: $# uucp-dom $@ <em class="replaceable"><code>your.uucp.relay</code></em> $: foo &lt; @ example . com . &gt;
<code class="prompt">&gt;</code> <strong class="userinput"><code>^D</code></strong></pre></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mail-advanced.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="mail.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="outgoing-only.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">28.6. Advanced Topics </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 28.8. Setting Up to Send Only</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>