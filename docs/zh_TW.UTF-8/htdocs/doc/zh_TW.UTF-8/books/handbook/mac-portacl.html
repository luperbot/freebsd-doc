<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>16.8. The MAC portacl Module</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="mac.html" title="章 16. Mandatory Access Control" /><link rel="prev" href="mac-ifoff.html" title="16.7. The MAC ifoff Module" /><link rel="next" href="mac-labelingpolicies.html" title="16.9. MAC Policies with Labeling Features" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">16.8. The MAC portacl Module</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mac-ifoff.html">前一頁</a> </td><th width="60%" align="center">章 16. Mandatory Access Control</th><td width="20%" align="right"> <a accesskey="n" href="mac-labelingpolicies.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-portacl"></a>16.8. The MAC portacl Module</h2></div></div></div><a id="idp79636048" class="indexterm"></a><p>Module name: <code class="filename">mac_portacl.ko</code></p><p>Kernel configuration line:
      <code class="literal">MAC_PORTACL</code></p><p>Boot option: <code class="literal">mac_portacl_load="YES"</code></p><p>The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a> module is used to limit binding to
      local <acronym class="acronym">TCP</acronym> and <acronym class="acronym">UDP</acronym> ports
      using a variety of <code class="command">sysctl</code> variables.  In
      essence <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a> makes it possible to allow
      non-<code class="systemitem">root</code> users to bind to specified
      privileged ports, i.e. ports fewer than 1024.</p><p>Once loaded, this module will enable the
      <acronym class="acronym">MAC</acronym> policy on all sockets.  The following
      tunables are available:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">security.mac.portacl.enabled</code> will
	  enable/disable the policy completely.<a href="#ftn.idp79644240" class="footnote" id="idp79644240"><sup class="footnote">[11]</sup></a></p></li><li class="listitem"><p><code class="literal">security.mac.portacl.port_high</code> will set
	  the highest port number that <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a>
	  will enable protection for.</p></li><li class="listitem"><p><code class="literal">security.mac.portacl.suser_exempt</code> will,
	  when set to a non-zero value, exempt the
	  <code class="systemitem">root</code> user from this policy.</p></li><li class="listitem"><p><code class="literal">security.mac.portacl.rules</code> will
	  specify the actual mac_portacl policy; see below.</p></li></ul></div><p>The actual <code class="literal">mac_portacl</code> policy, as
      specified in the <code class="literal">security.mac.portacl.rules</code>
      sysctl, is a text string of the form:
      <code class="literal">rule[,rule,...]</code> with as many rules as
      needed.  Each rule is of the form:
      <code class="literal">idtype:id:protocol:port</code>.  The
      <em class="parameter"><code>idtype</code></em> parameter can be
      <code class="literal">uid</code> or <code class="literal">gid</code> and used to
      interpret the <em class="parameter"><code>id</code></em> parameter as either a
      user id or group id, respectively.  The
      <em class="parameter"><code>protocol</code></em> parameter is used to determine if
      the rule should apply to <acronym class="acronym">TCP</acronym> or
      <acronym class="acronym">UDP</acronym> by setting the parameter to
      <code class="literal">tcp</code> or <code class="literal">udp</code>.  The final
      <em class="parameter"><code>port</code></em> parameter is the port number to allow
      the specified user or group to bind to.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">Since the ruleset is interpreted directly by the kernel
	only numeric values can be used for the user ID, group ID, and
	port parameters.  I.e. user, group, and port service names
	cannot be used.</p></div><p>By default, on <span class="trademark">UNIX</span>®-like systems, ports fewer than 1024
      can only be used by/bound to privileged processes,
      i.e. those run as <code class="systemitem">root</code>.  For
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a> to allow non-privileged processes to bind
      to ports below 1024 this standard <span class="trademark">UNIX</span>® restriction has to be
      disabled.  This can be accomplished by setting the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
      variables <code class="literal">net.inet.ip.portrange.reservedlow</code> and
      <code class="literal">net.inet.ip.portrange.reservedhigh</code>
      to zero.</p><p>See the examples below or review the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a>
      manual page for further information.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79678800"></a>16.8.1. Examples</h3></div></div></div><p>The following examples should illuminate the above
	discussion a little better:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl security.mac.portacl.port_high=1023</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl net.inet.ip.portrange.reservedlow=0 net.inet.ip.portrange.reservedhigh=0</code></strong></pre><p>First we set <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a> to cover the standard
	privileged ports and disable the normal <span class="trademark">UNIX</span>® bind
	restrictions.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl security.mac.portacl.suser_exempt=1</code></strong></pre><p>The <code class="systemitem">root</code> user should not be crippled
	by this policy, thus set the
	<code class="literal">security.mac.portacl.suser_exempt</code> to a
	non-zero value.  The <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac_portacl&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">mac_portacl</span>(4)</span></a> module
	has now been set up to behave the same way <span class="trademark">UNIX</span>®-like systems
	behave by default.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl security.mac.portacl.rules=uid:80:tcp:80</code></strong></pre><p>Allow the user with <acronym class="acronym">UID</acronym> 80 (normally
	the <code class="systemitem">www</code> user) to bind to port 80.
	This can be used to allow the <code class="systemitem">www</code>
	user to run a web server without ever having
	<code class="systemitem">root</code> privilege.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl security.mac.portacl.rules=uid:1001:tcp:110,uid:1001:tcp:995</code></strong></pre><p>Permit the user with the <acronym class="acronym">UID</acronym> of
	1001 to	bind to the <acronym class="acronym">TCP</acronym> ports 110
	(<span class="quote">“<span class="quote">pop3</span>”</span>) and 995 (<span class="quote">“<span class="quote">pop3s</span>”</span>).
	This will permit this user to start a server that accepts
	connections on ports 110 and 995.</p></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp79644240" class="footnote"><p><a href="#idp79644240" class="para"><sup class="para">[11] </sup></a>Due to
	  a bug the <code class="literal">security.mac.portacl.enabled</code>
	  <code class="command">sysctl</code> variable will not work on
	  FreeBSD 5.2.1 or previous releases.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mac-ifoff.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="mac.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="mac-labelingpolicies.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">16.7. The MAC ifoff Module </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 16.9. MAC Policies with Labeling Features</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>