<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>9.6. If Something Goes Wrong</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="kernelconfig.html" title="章 9. 設定 FreeBSD Kernel" /><link rel="prev" href="kernelconfig-config.html" title="9.5. kernel 設定檔解說" /><link rel="next" href="printing.html" title="章 10. 列印" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">9.6. If Something Goes Wrong</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kernelconfig-config.html">前一頁</a> </td><th width="60%" align="center">章 9. 設定 FreeBSD Kernel</th><td width="20%" align="right"> <a accesskey="n" href="printing.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kernelconfig-trouble"></a>9.6. If Something Goes Wrong</h2></div></div></div><p>There are five categories of trouble that can occur when
      building a custom kernel.  They are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="command">config</code> fails:</span></dt><dd><p>If the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=config&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">config</span>(8)</span></a> command fails when you
	    give it your kernel description, you have probably made a
	    simple error somewhere.  Fortunately,
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=config&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">config</span>(8)</span></a> will print the line number that it
	    had trouble with, so that you can quickly locate the line
	    containing the error.  For example, if you see:</p><pre class="screen">config: line 17: syntax error</pre><p>Make sure the
	    keyword is typed correctly by comparing it to the
	    <code class="filename">GENERIC</code> kernel or another
	    reference.</p></dd><dt><span class="term"><code class="command">make</code> fails:</span></dt><dd><p>If the <code class="command">make</code> command fails, it usually
	    signals an error in your kernel description which is not severe
	    enough for <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=config&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">config</span>(8)</span></a> to catch.  Again, look
	    over your configuration, and if you still cannot resolve the
	    problem, send mail to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">FreeBSD general questions 郵遞論壇</a> with your kernel
	    configuration, and it should be diagnosed quickly.</p></dd><dt><span class="term">The kernel does not boot:<a id="kernelconfig-noboot"></a></span></dt><dd><p>If your new kernel does not boot, or fails to
	    recognize your devices, do not panic!  Fortunately, FreeBSD has
	    an excellent mechanism for recovering from incompatible
	    kernels.  Simply choose the kernel you want to boot from at
	    the FreeBSD boot loader. You can access this when the system
	    boot menu appears.  Select the <span class="quote">“<span class="quote">Escape to a loader
            prompt</span>”</span> option, number six.  At the prompt, type
            <code class="command">unload kernel</code>
            and then type
	    <code class="command">boot /boot/kernel.old/kernel</code>,
            or the filename of any other kernel that will boot properly.
            When reconfiguring a kernel, it is always a good idea to keep
            a kernel that is known to work on hand.</p><p>After booting with a good kernel you can check over your
	    configuration file and try to build it again.  One helpful
	    resource is the <code class="filename">/var/log/messages</code> file
	    which records, among other things, all of the kernel messages
	    from every successful boot.  Also, the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> command
	    will print the kernel messages from the current boot.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">If you are having trouble building a kernel, make sure
	      to keep a <code class="filename">GENERIC</code>, or some other kernel
	      that is known to work on hand as a different name that will
	      not get erased on the next build.  You cannot rely on
	      <code class="filename">kernel.old</code> because when installing a
	      new kernel, <code class="filename">kernel.old</code> is overwritten
	      with the last installed kernel which may be non-functional.
	      Also, as soon as possible, move the working kernel to the
	      proper <code class="filename">/boot/kernel</code>
	      location or commands such
	      as <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> may not work properly.  To do this, simply
	      rename the directory containing the good kernel:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mv /boot/kernel /boot/kernel.bad</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv /boot/kernel.good /boot/kernel</code></strong></pre></div></dd><dt><span class="term">The kernel works, but <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> does not work
	  any more:</span></dt><dd><p>If you have installed a different version of the kernel
	    from the one that the system utilities have been built with,
	    for example, a -CURRENT kernel on a -RELEASE, many system-status
	    commands like <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a> and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vmstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">vmstat</span>(8)</span></a> will not work any
	    more.  You should <a class="link" href="makeworld.html" title="24.6. 重新編譯 World">recompile and install
	    a world</a> built with the same version of the source tree as
	    your kernel.  This is one reason it is
	    not normally a good idea to use a different version of the
	    kernel from the rest of the operating system.</p></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kernelconfig-config.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="kernelconfig.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="printing.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">9.5. kernel 設定檔解說 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 章 10. 列印</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>