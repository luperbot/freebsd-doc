<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>5.2. Contributed Software</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Developers' Handbook" /><link rel="up" href="policies.html" title="章 5. Source Tree Guidelines and Policies" /><link rel="prev" href="policies.html" title="章 5. Source Tree Guidelines and Policies" /><link rel="next" href="policies-encumbered.html" title="5.3. Encumbered Files" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.2. Contributed Software</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="policies.html">前一頁</a> </td><th width="60%" align="center">章 5. Source Tree Guidelines and Policies</th><td width="20%" align="right"> <a accesskey="n" href="policies-encumbered.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="policies-contributed"></a>5.2. Contributed Software</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Poul-Henning</span> <span class="surname">Kamp</span></span> 且 <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">David</span> <span class="surname">O'Brien</span></span>. </span></div></div></div><a id="idp67516752" class="indexterm"></a><p>Some parts of the FreeBSD distribution consist of software that is
      actively being maintained outside the FreeBSD project.  For historical
      reasons, we call this <span class="emphasis"><em>contributed</em></span> software.  Some
      examples are <span class="application">sendmail</span>, <span class="application">gcc</span> and <span class="application">patch</span>.</p><p>Over the last couple of years, various methods have been used in
      dealing with this type of software and all have some number of
      advantages and drawbacks.  No clear winner has emerged.</p><p>Since this is the case, after some debate one of these methods has
      been selected as the <span class="quote">“<span class="quote">official</span>”</span> method and will be required
      for future imports of software of this kind.  Furthermore, it is
      strongly suggested that existing contributed software converge on this
      model over time, as it has significant advantages over the old method,
      including the ability to easily obtain diffs relative to the
      <span class="quote">“<span class="quote">official</span>”</span> versions of the source by everyone (even without
      cvs access).  This will make it significantly easier to return changes
      to the primary developers of the contributed software.</p><p>Ultimately, however, it comes down to the people actually doing the
      work.  If using this model is particularly unsuited to the package being
      dealt with, exceptions to these rules may be granted only with the
      approval of the core team and with the general consensus of the other
      developers.  The ability to maintain the package in the future will be a
      key issue in the decisions.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">Because of some unfortunate design limitations with the RCS file
	format and CVS's use of vendor branches, minor, trivial and/or
	cosmetic changes are <span class="emphasis"><em>strongly discouraged</em></span> on
	files that are still tracking the vendor branch.  <span class="quote">“<span class="quote">Spelling
	fixes</span>”</span> are explicitly included here under the
	<span class="quote">“<span class="quote">cosmetic</span>”</span> category and are to be avoided for files with
	revision 1.1.x.x.  The repository bloat impact from a single character
	change can be rather dramatic.</p></div><p>The <span class="application">Tcl</span> embedded programming
      language will be used as example of how this model works:</p><p><code class="filename">src/contrib/tcl</code> contains the source as
      distributed by the maintainers of this package.  Parts that are entirely
      not applicable for FreeBSD can be removed.  In the case of Tcl, the
      <code class="filename">mac</code>, <code class="filename">win</code> and
      <code class="filename">compat</code> subdirectories were eliminated before the
      import.</p><p><code class="filename">src/lib/libtcl</code> contains only a <span class="application">bmake</span> style
      <code class="filename">Makefile</code> that uses the standard
      <code class="filename">bsd.lib.mk</code> makefile rules to produce the library
      and install the documentation.</p><p><code class="filename">src/usr.bin/tclsh</code> contains only a bmake style
      <code class="filename">Makefile</code> which will produce and install the
      <code class="command">tclsh</code> program and its associated man-pages using the
      standard <code class="filename">bsd.prog.mk</code> rules.</p><p><code class="filename">src/tools/tools/tcl_bmake</code> contains a couple of
      shell-scripts that can be of help when the tcl software needs updating.
      These are not part of the built or installed software.</p><p>The important thing here is that the
      <code class="filename">src/contrib/tcl</code> directory is created according to
      the rules: it is supposed to contain the sources as distributed (on a
      proper CVS vendor-branch and without RCS keyword expansion) with as few
      FreeBSD-specific changes as possible.  The 'easy-import' tool on
      <code class="systemitem">freefall</code> will assist in doing the import, but if there are any doubts on
      how to go about it, it is imperative that you ask first and not blunder
      ahead and hope it <span class="quote">“<span class="quote">works out</span>”</span>.  CVS is not forgiving of
      import accidents and a fair amount of effort is required to back out
      major mistakes.</p><p>Because of the previously mentioned design limitations with CVS's
      vendor branches, it is required that <span class="quote">“<span class="quote">official</span>”</span> patches from
      the vendor be applied to the original distributed sources and the result
      re-imported onto the vendor branch again.  Official patches should never
      be patched into the FreeBSD checked out version and <span class="quote">“<span class="quote">committed</span>”</span>, as this
      destroys the vendor branch coherency and makes importing future versions
      rather difficult as there will be conflicts.</p><p>Since many packages contain files that are meant for compatibility
      with other architectures and environments that FreeBSD, it is
      permissible to remove parts of the distribution tree that are of no
      interest to FreeBSD in order to save space.  Files containing copyright
      notices and release-note kind of information applicable to the remaining
      files shall <span class="emphasis"><em>not</em></span> be removed.</p><p>If it seems easier, the <code class="command">bmake</code>
      <code class="filename">Makefile</code>s can be produced from the dist tree
      automatically by some utility, something which would hopefully make it
      even easier to upgrade to a new version.  If this is done, be sure to
      check in such utilities (as necessary) in the
      <code class="filename">src/tools</code> directory along with the port itself so
      that it is available to future maintainers.</p><p>In the <code class="filename">src/contrib/tcl</code> level directory, a file
      called <code class="filename">FREEBSD-upgrade</code> should be added and it
      should state things like:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Which files have been left out.</p></li><li class="listitem"><p>Where the original distribution was obtained from and/or the
	  official master site.</p></li><li class="listitem"><p>Where to send patches back to the original authors.</p></li><li class="listitem"><p>Perhaps an overview of the FreeBSD-specific changes that have
	  been made.</p></li></ul></div><p>However, please do not import <code class="filename">FREEBSD-upgrade</code>
      with the contributed source. Rather you should <code class="command">cvs add
	FREEBSD-upgrade ; cvs ci</code> after the initial import.  Example
      wording from <code class="filename">src/contrib/cpio</code> is below:</p><pre class="programlisting">This directory contains virgin sources of the original distribution files
on a "vendor" branch.  Do not, under any circumstances, attempt to upgrade
the files in this directory via patches and a cvs commit.  New versions or
official-patch versions must be imported.  Please remember to import with
"-ko" to prevent CVS from corrupting any vendor RCS Ids.

For the import of GNU cpio 2.4.2, the following files were removed:

        INSTALL         cpio.info       mkdir.c
        Makefile.in     cpio.texi       mkinstalldirs

To upgrade to a newer version of cpio, when it is available:
        1. Unpack the new version into an empty directory.
           [Do not make ANY changes to the files.]

        2. Remove the files listed above and any others that don't apply to
           FreeBSD.

        3. Use the command:
                cvs import -ko -m 'Virgin import of GNU cpio v&lt;version&gt;' \
                        src/contrib/cpio GNU cpio_&lt;version&gt;

           For example, to do the import of version 2.4.2, I typed:
                cvs import -ko -m 'Virgin import of GNU v2.4.2' \
                        src/contrib/cpio GNU cpio_2_4_2

        4. Follow the instructions printed out in step 3 to resolve any
           conflicts between local FreeBSD changes and the newer version.

Do not, under any circumstances, deviate from this procedure.

To make local changes to cpio, simply patch and commit to the main
branch (aka HEAD).  Never make local changes on the GNU branch.

All local changes should be submitted to "cpio@gnu.ai.mit.edu" for
inclusion in the next vendor release.

obrien@FreeBSD.org - 30 March 1997</pre></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="policies.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="policies.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="policies-encumbered.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">章 5. Source Tree Guidelines and Policies </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 5.3. Encumbered Files</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>