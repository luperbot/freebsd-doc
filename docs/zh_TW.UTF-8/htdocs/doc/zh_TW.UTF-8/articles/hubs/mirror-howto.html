<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>3. How to Mirror FreeBSD</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Mirroring FreeBSD" /><link rel="up" href="index.html" title="Mirroring FreeBSD" /><link rel="prev" href="mirror-requirements.html" title="2. 成為 FreeBSD mirrors 的必備條件" /><link rel="next" href="mirror-where.html" title="4. Where to mirror from" /><link rel="copyright" href="trademarks.html" title="法律聲明" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. How to Mirror FreeBSD</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mirror-requirements.html">前一頁</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="mirror-where.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mirror-howto"></a>3. How to Mirror FreeBSD</h2></div></div></div><p>
      Ok, now you know the requirements and how to offer
      the services, but not how to get it. :-)
      This section explains how to actually mirror
      the various parts of FreeBSD, what tools to use,
      and where to mirror from.
    </p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-ftp"></a>3.1. FTP</h3></div></div></div><p>
        The FTP area is the largest amount of data that
        needs to be mirrored. It includes the <span class="emphasis"><em>distribution
        sets</em></span> required for network installation, the
        <span class="emphasis"><em>branches</em></span> which are actually snapshots
        of checked-out source trees, the <span class="emphasis"><em>ISO Images</em></span>
        to write CD-ROMs with the installation distribution,
        a live file system, lots of packages, the ports tree,
        distfiles, and a huge amount of packages. All of course
        for various FreeBSD versions,
        and various architectures.
      </p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-ftp-ftp"></a>3.1.1. With FTP mirror</h4></div></div></div><p>
          You can use a <span class="application">FTP mirror</span>
          program to get the files. Some of the most commonly used are:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/mirror/pkg-descr">ftp/mirror</a></p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/ftpmirror/pkg-descr">ftp/ftpmirror</a></p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/emirror/pkg-descr">ftp/emirror</a></p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/spegla/pkg-descr">ftp/spegla</a></p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/omi/pkg-descr">ftp/omi</a></p></li><li class="listitem"><p><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/wget/pkg-descr">ftp/wget</a></p></li></ul></div><p>

          <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/mirror/pkg-descr">ftp/mirror</a> was very popular, but seemed
          to have some drawbacks, as it is written in <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=perl&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">perl</span>(1)</span></a>,
          and had real problems with mirroring large
          directories like a FreeBSD site. There are rumors that
          the current version has fixed this by allowing
          a different algorithm for comparing
          the directory structure to be specified.
        </p><p>
          In general FTP is not really good for mirroring.  It transfers
          the whole file if it has changed, and does
          not create a single data stream which would benefit from
          a large TCP congestion window.
        </p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-ftp-rsync"></a>3.1.2. With rsync</h4></div></div></div><p>
          A better way to mirror the FTP area is <span class="application">rsync</span>.
          You can install the port <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/rsync/pkg-descr">net/rsync</a> and then use
          rsync to sync with your upstream host.
          <span class="application">rsync</span> is already mentioned
          in <a class="xref" href="mirror-requirements.html#mirror-serv-rsync" title="2.4.2. Rsync (optional for FTP fileset)">節 2.4.2, “Rsync (optional for FTP fileset)”</a>.
          Since <span class="application">rsync</span> access is not
          required, your preferred upstream site may not allow it.
          You may need to hunt around a little bit to find a site
          that allows <span class="application">rsync</span> access.
          </p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">
              Since the number of <span class="application">rsync</span>
              clients will have a significant impact on the server
              machine, most admins impose limitations on their
              server. For a mirror, you should ask the site maintainer
              you are syncing from about their policy, and maybe
              an exception for your host (since you are a mirror).
            </p></div><p>
          A command line to mirror FreeBSD might look like:
          </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>rsync -vaz --delete ftp4.de.FreeBSD.org::FreeBSD/ /pub/FreeBSD/</code></strong>
          </pre><p>
          Consult the documentation for <span class="application">rsync</span>,
          which is also available at
          <a class="link" href="http://rsync.samba.org/" target="_top">http://rsync.samba.org/</a>,
          about the various options to be used with rsync.
		  If you sync the whole module (unlike subdirectories),
		  be aware that the module-directory (here "FreeBSD")
		  will not be created, so you cannot omit the target directory.
          Also you might
          want to set up a script framework that calls such a command
          via <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>.
        </p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-ftp-cvsup"></a>3.1.3. With CVSup</h4></div></div></div><p>
          A few sites, including the one-and-only <code class="systemitem">ftp-master.FreeBSD.org</code>
          even offer <span class="application">CVSup</span> to mirror the contents of
          the FTP space. You need to install a <span class="application">CVSup</span>
          client, preferably from the port <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/cvsup/pkg-descr">net/cvsup</a>.
          (Also reread <a class="xref" href="mirror-requirements.html#mirror-serv-cvsup" title="2.4.4. CVSup (desired for CVS repository)">節 2.4.4, “CVSup (desired for CVS repository)”</a>.)
          A sample <code class="filename">supfile</code> suitable for <code class="systemitem">ftp-master.FreeBSD.org</code>
          looks like this:
          </p><pre class="programlisting">
          #
          # FreeBSD archive supfile from master server
          #
          *default host=ftp-master.FreeBSD.org
          *default base=/usr
          *default prefix=/pub
          #*default release=all
          *default delete use-rel-suffix
          *default umask=002

          # If your network link is a T1 or faster, comment out the following line.
          #*default compress

          FreeBSD-archive release=all preserve
          </pre><p>

          It seems <span class="application">CVSup</span> would be the best
          way to mirror the archive in terms of efficiency, but
          it is only available from few sites.
          </p><div xmlns="" class="note"><h3 class="admontitle"><a xmlns="http://www.w3.org/1999/xhtml" id="mirror-cvsup-s-option"></a>注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">
              Please have look at the <span class="application">CVSup</span> documentation
              like <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cvsup&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cvsup</span>(1)</span></a> and consider using the <code class="option">-s</code>
	      option. This reduces I/O operations by assuming the
	      recorded information about each file is correct.</p></div><p>
        </p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-cvs"></a>3.2. Mirroring the CVS repository</h3></div></div></div><p>There are various ways to mirror the CVS repository.
        <span class="application">CVSup</span> is the most common method.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-cvs-cvsup"></a>3.2.1. Using CVSup</h4></div></div></div><p>
          <span class="application">CVSup</span> is described in some
          detail in <a class="xref" href="mirror-requirements.html#mirror-serv-cvsup" title="2.4.4. CVSup (desired for CVS repository)">節 2.4.4, “CVSup (desired for CVS repository)”</a> and <a class="xref" href="mirror-howto.html#mirror-ftp-cvsup" title="3.1.3. With CVSup">節 3.1.3, “With CVSup”</a>.
        </p><p>It is very easy to setup a
           <span class="application">CVSup</span> mirror. Installing
           <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/cvsup-mirror/pkg-descr">net/cvsup-mirror</a> will
           make sure all of the needed programs are installed and then
           gather all the needed information to configure the mirror.</p><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">
            Please do not forget to consider the hint
            mentioned in <a class="link" href="mirror-howto.html#mirror-cvsup-s-option" title="注意">this note</a>
            above.
          </p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-cvs-other"></a>3.2.2. Using other methods</h4></div></div></div><p>
          Using other methods than <span class="application">CVSup</span> is
          generally not recommended. We describe them in short here
          anyway. Since most sites offer the CVS repository as
          part of the FTP fileset under the path
          <code class="filename">/pub/FreeBSD/development/FreeBSD-CVS</code>,
          the following methods could be used.
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="application">FTP</span></p></li><li class="listitem"><p><span class="application">Rsync</span></p></li><li class="listitem"><p><span class="application">HTTP</span></p></li></ul></div><p>

          </p><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">AnonCVS cannot be used to mirror the CVS repository
              since CVS does not allow you to access the repository
              itself, only checked out versions of the modules.</p></div><p>
        </p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-www"></a>3.3. Mirroring the WWW pages</h3></div></div></div><p>
        The best way is to check out the <span class="emphasis"><em>www</em></span>
        distribution from CVS. If you have a local mirror of the
        CVS repository, it is as easy as:
        </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs -d /home/ncvs co www</code></strong></pre><p>
        and a <span class="emphasis"><em>cronjob</em></span>, that calls <code class="command">cvs up -d -P</code>
        on a regular basis, maybe just after your repository was updated.
        Of course, the files need to remain in a directory available
        for public WWW access. The installation and configuration of a
        web server is not discussed here.
      </p><p>
        If you do not have a local repository, you can use
        <span class="application">CVSup</span> to maintain an <span class="quote">“<span class="quote">up to date copy</span>”</span>
        of the www pages. A sample supfile can be found in
        <code class="filename">/usr/share/examples/cvsup/www-supfile</code> and
        could look like this:
        </p><pre class="programlisting">
        #
        # WWW module supfile for FreeBSD
        #
        *default host=cvsup3.de.FreeBSD.org
        *default base=/usr
        *default prefix=/usr/local
        *default release=cvs tag=.
        *default delete use-rel-suffix

        # If your network link is a T1 or faster, comment out the following line.
        *default compress

        # This collection retrieves the www/ tree of the FreeBSD repository
        www
        </pre><p>
     </p><p>
       Using <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/ftp/wget/pkg-descr">ftp/wget</a> or other web-mirror tools is
       not recommended.
     </p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-www-doc"></a>3.3.1. Mirroring the FreeBSD documentation</h4></div></div></div><p>
         Since the documentation is referenced a lot from the
         web pages, it is recommended that you mirror the
         FreeBSD documentation as well. However, this is not
         as trivial as the www-pages alone.
       </p><p>
         First of all, you should get the doc sources,
         again preferably via <span class="application">CVSup</span>.
         Here is a corresponding sample supfile:
         </p><pre class="programlisting">
         #
         # FreeBSD documentation supfile
         #
         *default host=cvsup3.de.FreeBSD.org
         *default base=/usr
         *default prefix=/usr/share
         *default release=cvs tag=.
         *default delete use-rel-suffix

         # If your network link is a T1 or faster, comment out the following line.
         #*default compress

         # This will retrieve the entire doc branch of the FreeBSD repository.
         # This includes the handbook, FAQ, and translations thereof.
         doc-all
         </pre><p>
       </p><p>
         Then you need to install a couple of ports.
         You are lucky, there is a meta-port:
         <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/textproc/docproj/pkg-descr">textproc/docproj</a> to do the work
         for you. You need to set up some
         environment variables, like
         <code class="literal">SGML_CATALOG_FILES</code>.
         Also have a look at your <code class="filename">/etc/make.conf</code>
         (copy <code class="filename">/usr/share/examples/etc/make.conf</code> if
         you do not have one), and look at the
         <code class="literal">DOC_LANG</code> variable.
         Now you are probably ready to run <code class="command">make</code>
         in your doc directory (<code class="filename">/usr/share/doc</code>
         by default) and build the documentation.
         Again you need to make it accessible for your web server
         and make sure the links point to the right location.
         </p><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">
             The building of the documentation, as well as lots
             of side issues, is documented itself in the
	     <a class="link" href="../../../../doc/zh_TW.UTF-8/books/fdp-primer" target="_top">FreeBSD Documentation
             Project Primer</a>.
             Please read this piece of documentation, especially if you
             have problems building the documentation.
           </p></div><p>
       </p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mirror-how-often"></a>3.4. How often should I mirror?</h3></div></div></div><p>
       Every mirror should be updated on a regular
       basis. You will certainly need some script
       framework for it that will be called by
       <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cron&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">cron</span>(8)</span></a>. Since nearly every admin
       does this his own way, we cannot give
       specific instructions. It could work
       like this:
     </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
           Put the command to run your mirroring application
           in a script. Use of a plain <code class="command">/bin/sh</code>
           script is recommended.
         </p></li><li class="step"><p>
           Add some output redirections so diagnostic
           messages are logged to a file.
         </p></li><li class="step"><p>
           Test if your script works. Check the logs.
         </p></li><li class="step"><p>
	   Use <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">crontab</span>(1)</span></a> to add the script to the
	   appropriate user's <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=crontab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">crontab</span>(5)</span></a>.  This should be a
	   different user than what your FTP daemon runs as so that
	   if file permissions inside your FTP area are not
	   world-readable those files can not be accessed by anonymous
	   FTP.  This is used to <span class="quote">“<span class="quote">stage</span>”</span> releases ——
	   making sure all of the official mirror sites have all of the
	   necessary release files on release day.
         </p></li></ol></div><p>
       Here are some recommended schedules:
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>FTP fileset: daily</p></li><li class="listitem"><p>CVS repository: hourly</p></li><li class="listitem"><p>WWW pages: daily</p></li></ul></div><p>
     </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mirror-requirements.html">前一頁</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="mirror-where.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">2. 成為 FreeBSD mirrors 的必備條件 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 4. Where to mirror from</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>