<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>6.17. Using Lua</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="special.html" title="章 6. Special considerations" /><link rel="prev" href="using-wx.html" title="6.16. Using wxWidgets" /><link rel="next" href="using-xfce.html" title="6.18. Using Xfce" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.17. Using <span class="application">Lua</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="using-wx.html">前一頁</a> </td><th width="60%" align="center">章 6. Special considerations</th><td width="20%" align="right"> <a accesskey="n" href="using-xfce.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="using-lua"></a>6.17. Using <span class="application">Lua</span></h2></div></div></div><p>This section describes the status of the
	<span class="application">Lua</span> libraries in the ports tree and its
	integration with the ports system.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-introduction"></a>6.17.1. Introduction</h3></div></div></div><p>There are many versions of the <span class="application">Lua</span>
	  libraries and corresponding interpreters, which conflict between
	  them (install files under the same name).  In the ports tree this
	  problem has been solved by installing each version under a different
	  name using version number suffixes.</p><p>The obvious disadvantage of this is that each application has to
	  be modified to find the expected version.  But it can be solved by
	  adding some additional flags to the compiler and linker.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-version"></a>6.17.2. Version selection</h3></div></div></div><p>To make your port use a specific version of
	  <span class="application">Lua</span> there are two variables available
	  for defining (if only one is defined the other will be set to a
	  default value):</p><div class="table"><a id="lua-ver-sel-table"></a><div class="table-title">表格 6.32. Variables to select <span class="application">Lua</span>
	    versions</div><div class="table-contents"><table summary="Variables to select Lua&#10;&#9;    versions" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Variable</th><th>Description</th><th>Default value</th></tr></thead><tbody><tr><td><code class="varname">USE_LUA</code></td><td>List of versions the port can use</td><td>All available versions</td></tr><tr><td><code class="varname">USE_LUA_NOT</code></td><td>List of versions the port can not use</td><td>None</td></tr></tbody></table></div></div><br class="table-break" /><p>The following is a list of available
	  <span class="application">Lua</span> versions and the corresponding ports
	  in the tree:</p><div class="table"><a id="idp69066704"></a><div class="table-title">表格 6.33. Available <span class="application">Lua</span> versions</div><div class="table-contents"><table summary="Available Lua versions" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Version</th><th>Port</th></tr></thead><tbody><tr><td><code class="literal">4.0</code></td><td><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/lang/lua4/pkg-descr">lang/lua4</a></td></tr><tr><td><code class="literal">5.0</code></td><td><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/lang/lua50/pkg-descr">lang/lua50</a></td></tr><tr><td><code class="literal">5.1</code></td><td><a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/lang/lua/pkg-descr">lang/lua</a></td></tr></tbody></table></div></div><br class="table-break" /><p>The variables in <a class="xref" href="using-lua.html#lua-ver-sel-table" title="表格 6.32. Variables to select Lua versions">表格 6.32, “Variables to select <span class="application">Lua</span>
	    versions”</a> can be set
	  to one or more of the following combinations separated by
	  spaces:</p><div class="table"><a id="idp69075536"></a><div class="table-title">表格 6.34. <span class="application">Lua</span> version specifications</div><div class="table-contents"><table summary="Lua version specifications" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Description</th><th>Example</th></tr></thead><tbody><tr><td>Single version</td><td><code class="literal">4.0</code></td></tr><tr><td>Ascending range</td><td><code class="literal">5.0+</code></td></tr><tr><td>Descending range</td><td><code class="literal">5.0-</code></td></tr><tr><td>Full range (must be ascending)</td><td><code class="literal">5.0-5.1</code></td></tr></tbody></table></div></div><br class="table-break" /><p>There are also some variables to select the preferred versions
	  from the available ones.  They can be set to a list of versions, the
	  first ones will have higher priority.</p><div class="table"><a id="idp69088848"></a><div class="table-title">表格 6.35. Variables to select preferred <span class="application">Lua</span>
	    versions</div><div class="table-contents"><table summary="Variables to select preferred Lua&#10;&#9;    versions" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Name</th><th>Designed for</th></tr></thead><tbody><tr><td><code class="varname">WANT_LUA_VER</code></td><td>the port</td></tr><tr><td><code class="varname">WITH_LUA_VER</code></td><td>the user</td></tr></tbody></table></div></div><br class="table-break" /><div class="example"><a id="lua-version-example"></a><div class="example-title">範例 6.8. Selecting the <span class="application">Lua</span> version</div><div class="example-contents"><p>The following fragment is from a port which can use
	    <span class="application">Lua</span> version <code class="literal">5.0</code> or
	    <code class="literal">5.1</code>, and uses <code class="literal">5.0</code> by
	    default.  It can be overriden by the user using
	    <code class="varname">WITH_LUA_VER</code>.</p><pre class="programlisting">USE_LUA=      5.0-5.1
WANT_LUA_VER= 5.0</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-components"></a>6.17.3. Component selection</h3></div></div></div><p>There are other applications that, while not being
	  <span class="application">Lua</span> libraries, are related to them.
	  These applications can be specified in the
	  <code class="varname">LUA_COMPS</code> variable. The following components are
	  available:</p><div class="table"><a id="idp69109584"></a><div class="table-title">表格 6.36. Available <span class="application">Lua</span> components</div><div class="table-contents"><table summary="Available Lua components" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Name</th><th>Description</th><th>Version restriction</th></tr></thead><tbody><tr><td><code class="literal">lua</code></td><td>main library</td><td>none</td></tr><tr><td><code class="literal">tolua</code></td><td>Library for accesing C/C++ code</td><td><code class="literal">4.0-5.0</code></td></tr><tr><td><code class="literal">ruby</code></td><td>Ruby bindings</td><td><code class="literal">4.0-5.0</code></td></tr></tbody></table></div></div><br class="table-break" /><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">There are more components but they are modules for the
	    interpreter, not used by applications (only by other
	    modules).</p></div><p>The dependency type can be selected for each component by adding
	  a suffix separated by a semicolon.  If not present then a default
	  type will be used (see <a class="xref" href="using-lua.html#lua-def-dep-types" title="表格 6.38. Default Lua dependency types">表格 6.38, “Default <span class="application">Lua</span> dependency
	    types”</a>).  The
	  following types are available:</p><div class="table"><a id="idp69120720"></a><div class="table-title">表格 6.37. Available <span class="application">Lua</span> dependency
	    types</div><div class="table-contents"><table summary="Available Lua dependency&#10;&#9;    types" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">build</code></td><td>Component is required for building, equivalent to
		  <code class="varname">BUILD_DEPENDS</code></td></tr><tr><td><code class="literal">run</code></td><td>Component is required for running, equivalent to
		  <code class="varname">RUN_DEPENDS</code></td></tr><tr><td><code class="literal">lib</code></td><td>Component is required for building and running,
		  equivalent to <code class="varname">LIB_DEPENDS</code></td></tr></tbody></table></div></div><br class="table-break" /><p>The default values for the components are detailed in the
	  following table:</p><div class="table"><a id="lua-def-dep-types"></a><div class="table-title">表格 6.38. Default <span class="application">Lua</span> dependency
	    types</div><div class="table-contents"><table summary="Default Lua dependency&#10;&#9;    types" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Component</th><th>Dependency type</th></tr></thead><tbody><tr><td><code class="literal">lua</code></td><td><code class="literal">lib</code> for <code class="literal">4.0-5.0</code>
		  (shared) and <code class="literal">build</code> for
		  <code class="literal">5.1</code> (static)</td></tr><tr><td><code class="literal">tolua</code></td><td><code class="literal">build</code> (static)</td></tr><tr><td><code class="literal">ruby</code></td><td><code class="literal">lib</code> (shared)</td></tr></tbody></table></div></div><br class="table-break" /><div class="example"><a id="lua-components-example"></a><div class="example-title">範例 6.9. Selecting <span class="application">Lua</span> components</div><div class="example-contents"><p>The following fragment corresponds to a port which uses
	    <span class="application">Lua</span> version <code class="literal">4.0</code> and
	    its <span class="application">Ruby</span> bindings.</p><pre class="programlisting">USE_LUA=      4.0
LUA_COMPS=    lua ruby</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-version-detection"></a>6.17.4. Detecting installed versions</h3></div></div></div><p>To detect an installed version you have to define
	  <code class="varname">WANT_LUA</code>.  If you do not set it to a specific
	  version then the components will have a version suffix.  The
	  <code class="varname">HAVE_LUA</code> variable will be filled after
	  detection.</p><div class="example"><a id="lua-ver-det-example"></a><div class="example-title">範例 6.10. Detecting installed <span class="application">Lua</span> versions
	    and components</div><div class="example-contents"><p>The following fragment can be used in a port that uses
	    <span class="application">Lua</span> if it is installed, or an option is
	    selected.</p><pre class="programlisting">WANT_LUA=       yes

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_LUA5) || ${HAVE_LUA:Mlua-5.[01]} != ""
USE_LUA=        5.0-5.1
CONFIGURE_ARGS+=--enable-lua5
.endif</pre><p>The following fragment can be used in a port that enables
	    <span class="application">tolua</span> support if it is installed or if
	    an option is selected, in addition to
	    <span class="application">Lua</span>, both version
	    <code class="literal">4.0</code>.</p><pre class="programlisting">USE_LUA=        4.0
LUA_COMPS=      lua
WANT_LUA=       4.0

.include &lt;bsd.port.pre.mk&gt;

.if defined(WITH_TOLUA) || ${HAVE_LUA:Mtolua} != ""
LUA_COMPS+=     tolua
CONFIGURE_ARGS+=--enable-tolua
.endif</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-defined-variables"></a>6.17.5. Defined variables</h3></div></div></div><p>The following variables are available in the port (after
	  defining one from <a class="xref" href="using-lua.html#lua-ver-sel-table" title="表格 6.32. Variables to select Lua versions">表格 6.32, “Variables to select <span class="application">Lua</span>
	    versions”</a>).</p><div class="table"><a id="idp69179472"></a><div class="table-title">表格 6.39. Variables defined for ports that use
	    <span class="application">Lua</span></div><div class="table-contents"><table summary="Variables defined for ports that use&#10;&#9;    Lua" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code class="varname">LUA_VER</code></td><td>The <span class="application">Lua</span> version that is
		  going to be used (e.g., <code class="literal">5.1</code>)</td></tr><tr><td><code class="varname">LUA_VER_SH</code></td><td>The <span class="application">Lua</span> shared library major
		  version (e.g., <code class="literal">1</code>)</td></tr><tr><td><code class="varname">LUA_VER_STR</code></td><td>The <span class="application">Lua</span> version without the
		  dots (e.g., <code class="literal">51</code>)</td></tr><tr><td><code class="varname">LUA_PREFIX</code></td><td>The prefix where <span class="application">Lua</span> (and
		  components) is installed</td></tr><tr><td><code class="varname">LUA_SUBDIR</code></td><td>The directory under <code class="filename">${PREFIX}/bin</code>,
		  <code class="filename">${PREFIX}/share</code> and
		  <code class="filename">${PREFIX}/lib</code> where
		  <span class="application">Lua</span> is installed</td></tr><tr><td><code class="varname">LUA_INCDIR</code></td><td>The directory where <span class="application">Lua</span> and
		  <span class="application">tolua</span> header files are
		  installed</td></tr><tr><td><code class="varname">LUA_LIBDIR</code></td><td>The directory where <span class="application">Lua</span> and
		  <span class="application">tolua</span> libraries are
		  installed</td></tr><tr><td><code class="varname">LUA_MODLIBDIR</code></td><td>The directory where <span class="application">Lua</span>
		  module libraries (<code class="filename">.so</code>) are
		  installed</td></tr><tr><td><code class="varname">LUA_MODSHAREDIR</code></td><td>The directory where <span class="application">Lua</span>
		  modules (<code class="filename">.lua</code>) are installed</td></tr><tr><td><code class="varname">LUA_PKGNAMEPREFIX</code></td><td>The package name prefix used by
		  <span class="application">Lua</span> modules</td></tr><tr><td><code class="varname">LUA_CMD</code></td><td>The path to the <span class="application">Lua</span>
		  interpreter</td></tr><tr><td><code class="varname">LUAC_CMD</code></td><td>The path to the <span class="application">Lua</span>
		  compiler</td></tr><tr><td><code class="varname">TOLUA_CMD</code></td><td>The path to the <span class="application">tolua</span>
		  program</td></tr></tbody></table></div></div><br class="table-break" /><div class="example"><a id="lua-variables-example"></a><div class="example-title">範例 6.11. Telling the port where to find
	    <span class="application">Lua</span></div><div class="example-contents"><p>The following fragment shows how to tell a port that uses a
	    configure script where the <span class="application">Lua</span> header
	    files and libraries are.</p><pre class="programlisting">
USE_LUA=        4.0
GNU_CONFIGURE=  yes
CONFIGURE_ENV=  CPPFLAGS="-I${LUA_INCDIR}" LDFLAGS="-L${LUA_LIBDIR}"</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="lua-premk"></a>6.17.6. Processing in <code class="filename">bsd.port.pre.mk</code></h3></div></div></div><p>If you need to use the variables for running commands right
	  after including <code class="filename">bsd.port.pre.mk</code> you need to
	  define <code class="varname">LUA_PREMK</code>.</p><div xmlns="" class="important"><h3 class="admontitle">重要: </h3><p xmlns="http://www.w3.org/1999/xhtml">If you define <code class="varname">LUA_PREMK</code>, then the version,
	    dependencies, components and defined variables will not change if
	    you modify the <span class="application">Lua</span> port variables
	    <span class="emphasis"><em>after</em></span> including
	    <code class="filename">bsd.port.pre.mk</code>.</p></div><div class="example"><a id="lua-premk-example"></a><div class="example-title">範例 6.12. Using <span class="application">Lua</span> variables in
	    commands</div><div class="example-contents"><p>The following fragment illustrates the use of
	    <code class="varname">LUA_PREMK</code> by running the
	    <span class="application">Lua</span> interpreter to obtain the full
	    version string, assign it to a variable and pass it to the
	    program.</p><pre class="programlisting">USE_LUA=        5.0
LUA_PREMK=      yes

.include &lt;bsd.port.pre.mk&gt;

.if exists(${LUA_CMD})
VER_STR!=       ${LUA_CMD} -v

CFLAGS+=        -DLUA_VERSION_STRING="${VER_STR}"
.endif</pre></div></div><br class="example-break" /><div xmlns="" class="note"><h3 class="admontitle">注意: </h3><p xmlns="http://www.w3.org/1999/xhtml">The <span class="application">Lua</span> variables can be safely
	    used in commands when they are inside targets without the need of
	    <code class="varname">LUA_PREMK</code>.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="using-wx.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="special.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="using-xfce.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">6.16. Using <span class="application">wxWidgets</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 6.18. Using Xfce</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>