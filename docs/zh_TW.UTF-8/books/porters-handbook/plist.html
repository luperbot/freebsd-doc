<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>章 7. Advanced pkg-plist practices</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="up" href="index.html" title="FreeBSD Porter's Handbook" /><link rel="prev" href="rc-scripts.html" title="6.20. Starting and stopping services (rc scripts)" /><link rel="next" href="plist-cleaning.html" title="7.2. Empty directories" /><link rel="copyright" href="trademarks.html" title="Legal Notice" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">章 7. Advanced <code class="filename">pkg-plist</code> practices</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="rc-scripts.html">前一頁</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="plist-cleaning.html">下一頁</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="plist"></a>章 7. Advanced <code class="filename">pkg-plist</code> practices</h1></div></div></div><div class="toc"><div class="toc-title">內容目錄</div><dl class="toc"><dt><span class="sect1"><a href="plist.html#plist-sub">7.1. Changing <code class="filename">pkg-plist</code> based on make
	  variables</a></span></dt><dt><span class="sect1"><a href="plist-cleaning.html">7.2. Empty directories</a></span></dt><dt><span class="sect1"><a href="plist-config.html">7.3. Configuration files</a></span></dt><dt><span class="sect1"><a href="plist-dynamic.html">7.4. Dynamic vs. static package list</a></span></dt><dt><span class="sect1"><a href="plist-autoplist.html">7.5. 自動產生 package list</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="plist-sub"></a>7.1. Changing <code class="filename">pkg-plist</code> based on make
	  variables</h2></div></div></div><p>Some ports, particularly the <code class="literal">p5-</code> ports,
	  need to change their <code class="filename">pkg-plist</code> depending on
	  what options they are configured with (or version of
	  <code class="literal">perl</code>, in the case of <code class="literal">p5-</code>
	  ports).  To make this easy, any instances in the
	  <code class="filename">pkg-plist</code> of <code class="literal">%%OSREL%%</code>,
	  <code class="literal">%%PERL_VER%%</code>, and
	  <code class="literal">%%PERL_VERSION%%</code> will be substituted for
	  appropriately.  The value of <code class="literal">%%OSREL%%</code> is the
	  numeric revision of the operating system (e.g.,
	  <code class="literal">4.9</code>).  <code class="literal">%%PERL_VERSION%%</code> is
	  the full version number of <code class="command">perl</code> (e.g.,
	  <code class="literal">5.00502</code>) and <code class="literal">%%PERL_VER%%</code>
	  is the <code class="command">perl</code> version number minus
	  the patchlevel (e.g., <code class="literal">5.005</code>).  Several other
	  <code class="literal">%%VARS%%</code> related to
	  port's documentation files are described in <a class="link" href="install.html#install-documentation" title="5.14.4. Install additional documentation">the relevant section</a>.</p><p>If you need to make other substitutions, you can set the
	  <code class="varname">PLIST_SUB</code> variable with a list of
	  <code class="literal">VAR=VALUE</code>
	  pairs and instances of
	  <code class="literal">%%VAR%%</code> will be
	  substituted with <em class="replaceable"><code>VALUE</code></em> in the
	  <code class="filename">pkg-plist</code>.</p><p>For instance, if you have a port that installs many files in a
	  version-specific subdirectory, you can put something like</p><pre class="programlisting">OCTAVE_VERSION= 2.0.13
PLIST_SUB=      OCTAVE_VERSION=${OCTAVE_VERSION}</pre><p>in the <code class="filename">Makefile</code> and use
	  <code class="literal">%%OCTAVE_VERSION%%</code> wherever the version shows up
	  in <code class="filename">pkg-plist</code>.  That way, when you upgrade the port,
	  you will not have to change dozens (or in some cases, hundreds) of
	  lines in the <code class="filename">pkg-plist</code>.</p><p>This substitution (as well as addition of any <a class="link" href="makefile-manpages.html" title="5.9. Manpages">manual pages</a>) will be done between
	  the <code class="buildtarget">pre-install</code> and
	  <code class="buildtarget">do-install</code> targets, by reading from
	  <code class="filename">PLIST</code> and writing to
	  <code class="filename">TMPPLIST</code>
	  (default:
	  <code class="filename">WRKDIR/.PLIST.mktmp</code>).  So if
	  your port builds <code class="filename">PLIST</code>
	  on the fly, do so in or
	  before <code class="buildtarget">pre-install</code>.  Also, if your port
	  needs to edit the resulting file, do so in
	  <code class="buildtarget">post-install</code> to a file named
	  <code class="filename">TMPPLIST</code>.</p><p>Another possibility to modify port's packing list is based
	  on setting the variables <code class="varname">PLIST_FILES</code> and
	  <code class="varname">PLIST_DIRS</code>.  The value of each variable
	  is regarded as a list of pathnames to
	  write to <code class="filename">TMPPLIST</code>
	  along with <code class="filename">PLIST</code>
	  contents.  Names listed in <code class="varname">PLIST_FILES</code>
	  and <code class="varname">PLIST_DIRS</code> are subject to
	  <code class="literal">%%VAR%%</code>
	  substitution, as described above.
	  Except for that, names from <code class="varname">PLIST_FILES</code>
	  will appear in the final packing list unchanged,
	  while <code class="literal">@dirrm</code> will be
	  prepended to names from <code class="varname">PLIST_DIRS</code>.
	  To take effect, <code class="varname">PLIST_FILES</code> and
	  <code class="varname">PLIST_DIRS</code> must be set before
	  <code class="filename">TMPPLIST</code> is written,
	  i.e. in <code class="buildtarget">pre-install</code> or earlier.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="rc-scripts.html">前一頁</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="plist-cleaning.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">6.20. Starting and stopping services (rc scripts) </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 7.2. Empty directories</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>