<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>24.7. 追蹤多追蹤多部機器</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD 使用手冊" /><link rel="up" href="updating-upgrading.html" title="章 24. 更新、升級 FreeBSD" /><link rel="prev" href="makeworld.html" title="24.6. 重新編譯 World" /><link rel="next" href="dtrace.html" title="章 25. DTrace" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">24.7. 追蹤多追蹤多部機器</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="makeworld.html">前一頁</a> </td><th width="60%" align="center">章 24. 更新、升級 FreeBSD</th><td width="20%" align="right"> <a accesskey="n" href="dtrace.html">下一頁</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="small-lan"></a>24.7. 追蹤多追蹤多部機器</h2></div><div><span class="authorgroup">Contributed by <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Mike</span> <span class="surname">Meyer</span></span>. </span></div></div></div><a id="idp84502224" class="indexterm"></a><p>當有多部機器需要追蹤同一個原始碼樹，
      會浪費磁碟空間，網路頻寬，和
      <acronym class="acronym">中央處理器</acronym>周期來讓每個系統下載原始碼和編譯所有東西。
      解決方法是有解決方法是有一台機器做大部份的工作，剩下的機器經由
      <acronym class="acronym">NFS</acronym>來掛載這個工作。這一節概述了一個如此做的方法。
      更多關於使用 <acronym class="acronym">NFS</acronym>的資訊，請參考<a class="xref" href="network-nfs.html" title="29.3. Network File System (NFS)">節 29.3, “Network File System (NFS)”</a>。</p><p>First, identify a set of machines which will run the same
      set of binaries, known as a <em class="firstterm">build set</em>.
      Each machine can have a custom kernel, but will run the same
      userland binaries.  From that set, choose a machine to be the
      <em class="firstterm">build machine</em> that the world and kernel
      are built on.  Ideally, this is a fast machine that has
      sufficient spare <acronym class="acronym">CPU</acronym> to run <code class="command">make
	buildworld</code> and <code class="command">make
	buildkernel</code>.</p><p>Select a machine to be the <em class="firstterm">test
	machine</em>, which will test software updates before
      they are put into production.  This <span class="emphasis"><em>must</em></span> be
      a machine that can afford to be down for an extended period of
      time.  It can be the build machine, but need not be.</p><p>All the machines in this build set need to mount
      <code class="filename">/usr/obj</code> and <code class="filename">/usr/src</code>
      from the build machine via <acronym class="acronym">NFS</acronym>.  For multiple
      build sets, <code class="filename">/usr/src</code> should be on one build
      machine, and <acronym class="acronym">NFS</acronym> mounted on the rest.</p><p>Ensure that <code class="filename">/etc/make.conf</code> and
      <code class="filename">/etc/src.conf</code> on all the machines in the
      build set agree with the build machine.  That means that the
      build machine must build all the parts of the base system that
      any machine in the build set is going to install.  Also, each
      build machine should have its kernel name set with
      <code class="varname">KERNCONF</code> in
      <code class="filename">/etc/make.conf</code>, and the build machine
      should list them all in its <code class="varname">KERNCONF</code>,
      listing its own kernel first.  The build machine must have the
      kernel configuration files for each machine in its <code class="filename">/usr/src/sys/<em class="replaceable"><code>arch</code></em>/conf</code>.</p><p>On the build machine, build the kernel and world as
      described in <a class="xref" href="makeworld.html" title="24.6. 重新編譯 World">節 24.6, “重新編譯 World”</a>, but do not install
      anything on the build machine.  Instead, install the built
      kernel on the test machine.  On the test machine, mount
      <code class="filename">/usr/src</code> and
      <code class="filename">/usr/obj</code> via <acronym class="acronym">NFS</acronym>.  Then,
      run <code class="command">shutdown now</code> to go to single-user mode in
      order to install the new kernel and world and run
      <code class="command">mergemaster</code> as usual.  When done, reboot to
      return to normal multi-user operations.</p><p>After verifying that everything on the test machine is
      working properly, use the same procedure to install the new
      software on each of the other machines in the build set.</p><p>The same methodology can be used for the ports tree.  The
      first step is to share <code class="filename">/usr/ports</code> via
      <acronym class="acronym">NFS</acronym> to all the machines in the build set.  To
      configure <code class="filename">/etc/make.conf</code> to share
      distfiles, set <code class="varname">DISTDIR</code> to a common shared
      directory that is writable by whichever user <code class="systemitem">root</code> is mapped to by the
      <acronym class="acronym">NFS</acronym> mount.  Each machine should set
      <code class="varname">WRKDIRPREFIX</code> to a local build directory, if
      ports are to be built locally.  Alternately, if the build system
      is to build and distribute packages to the machines in the build
      set, set <code class="varname">PACKAGES</code> on the build system to a
      directory similar to <code class="varname">DISTDIR</code>.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="makeworld.html">前一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="updating-upgrading.html">上一層</a></td><td width="40%" align="right"> <a accesskey="n" href="dtrace.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">24.6. 重新編譯 World </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 章 25. DTrace</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>本文及其他文件，可由此下載：
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>。</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>若有 FreeBSD 方面疑問，請先閱讀
    <a href="http://www.FreeBSD.org/docs.html">FreeBSD 相關文件</a>，如不能解決的話，再洽詢
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;。<br></br>
    關於本文件的問題，請洽詢
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;。</small></p></body></html>