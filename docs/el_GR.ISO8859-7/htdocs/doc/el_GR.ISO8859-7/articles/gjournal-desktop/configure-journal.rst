=========================
4. ??????? ??? Journaling
=========================

.. raw:: html

   <div class="navheader">

4. ??????? ??? Journaling
`????? <reserve-space.html>`__?
?
?\ `??????? <troubleshooting-gjournal.html>`__

--------------

.. raw:: html

   </div>

.. raw:: html

   <div class="sect1">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

4. ??????? ??? Journaling
-------------------------

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

4.1. ???????? ??? ??????? ``gjournal``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

??????? ???????????? ???? ??? ??????????? ???????????, ????? ???????
???? ?? ?????????? ?? journaling. ?? ?????? ?? ????????? ?? ?????????
???? ??????, ??? ?? ???? ???? ????????? ??? ??????? ?? ``root`` ???
??????:

.. code:: screen

    # shutdown now

?????? **Enter** ??? ?? ?????? ??? ????????????? ???????. ?? ?????? ??
???????????????? ??? ??????????? ???? ?????? ?? ????? ?? journaling, ???
?????????? ??? ??? ``/usr`` ??? ``/var``:

.. code:: screen

    # umount /usr /var

???????? ?? ??????? ??? ?????? ??? ?????????? ??? ?? journaling:

.. code:: screen

    # gjournal load

?????????????? ???? ??? ?????????? ??? ??? ?? ?????????? ???? ?????????
??????????????? ??? ???? ??????????. ??? ?????????? ???, ?? ``/usr``
????????? ??? ``ad0s1f`` ??? ?? ?????????? ??? ?? ????? ??? ``ad0s1g``,
??? ?? ``/var`` ????? ??? ``ad0s1d`` ??? ?? ?????????? ??? ?? ????? ???
``ad0s1h``. ?? ??????????? ??? ???????? ???????:

.. code:: screen

    # gjournal label ad0s1f ad0s1g

    GEOM_JOURNAL: Journal 2948326772: ad0s1f contains data.
    GEOM_JOURNAL: Journal 2948326772: ad0s1g contains journal.

    # gjournal label ad0s1d ad0s1h

    GEOM_JOURNAL: Journal 3193218002: ad0s1d contains data.
    GEOM_JOURNAL: Journal 3193218002: ad0s1h contains journal.

.. raw:: html

   <div class="note" xmlns="">

????????:
~~~~~~~~~

?? ? ?????????? ?????? ??????? ??? ??? ??????????? ????? ?? ?????, ?
?????? ``gjournal`` ?? ??? ?????????? ??? ?????? ??????. ?? ?????? ??
?????????? ??? ?????? ??????????????? ??? ????????? ``-f`` ?? ??? ?????
?? ??????????? ??? ??????????? ??? ?????, ?.?.:

.. code:: screen

    # gjournal label -f ad0s1d ad0s1h

??? ??? ????????? ??? ??? ???????????, ????? ?????? ??????? ??
??????????? ?????? ????????.

.. raw:: html

   </div>

??? ?????? ???? ?????????????? ??? ???? ????????, ?? ``ad0s1d.journal``
??? ``ad0s1f.journal``. ????? ??????????????? ??? ??????????? ``/var``
??? ``/usr`` ??? ?? ?????? ?? ?????????????. ???? ??? ?????????????
??????, ?? ?????? ?? ??????? ??? ??????? journal ??? ?? ??????????? ???
??????? Soft Updates:

.. code:: screen

    # tunefs -J enable -n disable ad0s1d.journal

    tunefs: gjournal set
    tunefs: soft updates cleared

    # tunefs -J enable -n disable ad0s1f.journal

    tunefs: gjournal set
    tunefs: soft updates cleared

??????????? ???? ??????????? ??? ???? ???????? ??? ?????????? ??????
??????????? (????????? ??? ???????? ????? ?? ???????????????? ???
??????? ``async`` ???? ??? ??????????):

.. code:: screen

    # mount -o async /dev/ad0s1d.journal /var
    # mount -o async /dev/ad0s1f.journal /usr

?????????????? ?? ?????? ``/etc/fstab`` ??? ????????? ??? ????????????
??? ??? ??????????? ``/usr`` ??? ``/var``:

.. code:: programlisting

    /dev/ad0s1f.journal     /usr            ufs     rw,async      2       2
    /dev/ad0s1d.journal     /var            ufs     rw,async      2       2

.. raw:: html

   <div class="warning" xmlns="">

?????????????:
~~~~~~~~~~~~~~

??????????? ??? ?? ???????? ???????????? ????? ??????, ??????????? ??
????? ???????? ?? ?????????? ???????? ???? ??????? ???????????? ???
?????????? ???.

.. raw:: html

   </div>

?????, ?????????????? ?? ?????? ``/boot/loader.conf`` ??? ????????? ???
???????? ?????? ???? ?? ?????????? ?? ???????
`gjournal(8) <http://www.FreeBSD.org/cgi/man.cgi?query=gjournal&sektion=8>`__
?? ???? ????????:

.. code:: programlisting

    geom_journal_load="YES"

????????????! ?? ??????? ??? ????? ???? ?????? ??? journaling. ????????
?? ??????? **``exit``** ??? ?? ??????????? ???? ???????? ??????????
(????????? ???????) ? ?? ?????????????? ?? ??????? ??? (??????????) ???
?? ???????? ??? ????????? ???. ???? ??? ????????, ?? ????? ???????? ????
?? ????????:

.. code:: screen

    ad0: 76293MB XEC XE800JD-00HBC0 08.02D08 at ata0-master SATA150
    GEOM_JOURNAL: Journal 2948326772: ad0s1g contains journal.
    GEOM_JOURNAL: Journal 3193218002: ad0s1h contains journal.
    GEOM_JOURNAL: Journal 3193218002: ad0s1d contains data.
    GEOM_JOURNAL: Journal ad0s1d clean.
    GEOM_JOURNAL: Journal 2948326772: ad0s1f contains data.
    GEOM_JOURNAL: Journal ad0s1f clean.

???? ??? ??? ???????????? ?????????? ?? ????? ???????? ???? ?? ????????:

.. code:: screen

    GEOM_JOURNAL: Journal ad0s1d consistent.

???? ??????? ???????? ??? ??
`gjournal(8) <http://www.FreeBSD.org/cgi/man.cgi?query=gjournal&sektion=8>`__
????????????? ??? ??????????? ??? ??????????? ??? ?? ?????????? ??
??????? ??????? ?? ??????? ?????????.

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

4.2. ????? ??? Journaling ?? ???? ???????????
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ??? ? ???????? ?????????? ????? ?????????? ??? ?? ???????????????
journaling ?? ??????????? ??? ????? ??? ????????, ? ??????????
?????????? ??? ???? ??????????? ????? ??? ????. ???? ????????? ????,
?????? ?? ?????????????? ? ????? ???????? ???? ??? ?? ???????? ??? ???
??? ?? ??????????. ??? ??????????, ???????? ??? ????? ????????? ??? ???
????? ??? ????? ???????????? ??? ????????? ``/dev/ad1s1d``. ? ??????????
??? ??????????? ????? ?????? ???? ??? ???????? ????????:

.. code:: screen

    # gjournal label ad1s1d

?? ????????????? ??????? ??? ??????????? ????? 1?GB. ???????? ?????? ??
?? ????????? ??????????????? ??? ??????? ``-s``. ???????? ?? ??????
????? ?? bytes, ? ?? ?????? ???? ??? ???? ??? ??? ?? ???????? ``K``,
``M`` ? ``G`` ??? ?? ???????? Kilobytes, Megabytes ? Gigabytes
??????????. ????????? ??? ? ?????? ``gjournal``, ??? ?? ??? ????????? ??
????????????? ?????????? ??? ?? ????? ?????????? ???? ?????? ????????.

??? ??????????, ??? ?? ????????????? ??? ?????????? ???????? 2?GB,
???????? ?? ??????????????? ??? ???????? ??????:

.. code:: screen

    # gjournal label -s 2G ad1s1d

???????? ?????? ?? ????????????? ??? ??????? ??????? ??? ??? ???
?????????, ??? ?????????? ?? ?????????????? ?? journaling,
??????????????? ??? ??????? ``-J``:

.. code:: screen

    # newfs -J /dev/ad1s1d.journal

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

4.3. ?????????? ??? Journaling ?? ????????????? ??????
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ??? ?????? ?? ????????? ?? ``geom_journal`` ?? ???????, ???????? ??
???????????? ??? ??????????? ??? ???? ????????????? ?????? ???.
?????????????? ?? ?????? ????????? ??? ??????, ??? ??????????? ???
???????????? ??? ????????? ??? ???????:

.. code:: programlisting

    options UFS_GJOURNAL # ????????: ? ??????? ???? ??????? ??? GENERIC

    options GEOM_JOURNAL # ?? ?????? ?? ?????????? ???? ?? ??????

????????????? ??? ???????????????? ??? ?????? ??? ??????????????? ???
???????? `??????? ??? ?????????? ???
FreeBSD. <../../../../doc/el_GR.ISO8859-7/books/handbook/kernelconfig.html>`__

??? ???????? ?? ?????????? ??? ?????????? ?????????? ?load? ??? ??
?????? ``/boot/loader.conf`` ?? ??? ?????? ?????????????? ????????????.

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="navfooter">

--------------

+-----------------------------------------------+-------------------------+--------------------------------------------------+
| `????? <reserve-space.html>`__?               | ?                       | ?\ `??????? <troubleshooting-gjournal.html>`__   |
+-----------------------------------------------+-------------------------+--------------------------------------------------+
| 3. ?????? ???? ??? ??????????? ??? FreeBSD?   | `???? <index.html>`__   | ?5. ???????????? ???????????                     |
+-----------------------------------------------+-------------------------+--------------------------------------------------+

.. raw:: html

   </div>

???? ?? ???????, ??? ???? ???????, ?????? ?? ?????? ???
ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/

| ??? ????????? ??????? ?? ?? FreeBSD, ???????? ???
  `?????????? <http://www.FreeBSD.org/docs.html>`__ ???? ??
  ?????????????? ?? ??? <questions@FreeBSD.org\ >.
|  ??? ????????? ??????? ?? ???? ??? ??????????, ??????? e-mail ????
  <doc@FreeBSD.org\ >.
