<?xml version="1.0" encoding="iso-8859-7" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-7" /><title>Κεφάλαιο 14. PPP</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Συχνές Ερωτήσεις για το FreeBSD 6.X και 7.X" /><link rel="up" href="index.html" title="Συχνές Ερωτήσεις για το FreeBSD 6.X και 7.X" /><link rel="prev" href="security.html" title="Κεφάλαιο 13. Ασφάλεια" /><link rel="next" href="serial.html" title="Κεφάλαιο 15. Σειριακές Επικοινωνίες" /><link rel="copyright" href="legalnotice.html" title="Νομική Σημείωση" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Κεφάλαιο 14. PPP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="security.html">Προηγ</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="serial.html">Επόμενο</a></td></tr></table><hr /></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ppp"></a>Κεφάλαιο 14. PPP</h1></div></div></div><div class="qandaset"><a id="idp78206288"></a><dl><dt>14.1. <a href="ppp.html#idp78206544">I cannot make ppp(8) work.  What am I doing wrong?</a></dt><dt>14.2. <a href="ppp.html#idp78219472">Why does ppp(8) hang when I run it?</a></dt><dt>14.3. <a href="ppp.html#idp78234320">Why will ppp(8) not dial in -auto
            mode?</a></dt><dt>14.4. <a href="ppp.html#idp78243920">What does No route to host mean?</a></dt><dt>14.5. <a href="ppp.html#idp78249552">Why does my connection drop after about 3 minutes?</a></dt><dt>14.6. <a href="ppp.html#idp78260816">Why does my connection drop under heavy load?</a></dt><dt>14.7. <a href="ppp.html#idp78275664">Why does my connection drop after a random amount of
            time?</a></dt><dt>14.8. <a href="ppp.html#idp78279376">Why does my connection hang after a random amount of
            time?</a></dt><dt>14.9. <a href="ppp.html#idp78303056">The remote end is not responding.  What can I do?</a></dt><dt>14.10. <a href="ppp.html#idp78313296">ppp(8) has hung.  What can I do?</a></dt><dt>14.11. <a href="ppp.html#idp78321104">Why does nothing happen after the «Login OK!»
            message?</a></dt><dt>14.12. <a href="ppp.html#idp78326736">I keep seeing errors about magic being the same.  What does
            it mean?</a></dt><dt>14.13. <a href="ppp.html#idp78350416">LCP negotiations continue until the connection is
            closed.  What is wrong?</a></dt><dt>14.14. <a href="ppp.html#idp78381392">Why does ppp(8) lock up when I shell out to test
            it?</a></dt><dt>14.15. <a href="ppp.html#idp78393040">Why does ppp(8) over a null-modem cable never exit?</a></dt><dt>14.16. <a href="ppp.html#idp78397392">Why does ppp(8) dial for no reason in -auto mode?</a></dt><dt>14.17. <a href="ppp.html#idp78412368">What do these CCP errors mean?</a></dt><dt>14.18. <a href="ppp.html#idp78416336">Why does ppp(8) not log my connection speed?</a></dt><dt>14.19. <a href="ppp.html#idp78425552">Why does ppp(8) ignore the \ character
            in my chat script?</a></dt><dt>14.20. <a href="ppp.html#idp78451408">Why does ppp(8) get a seg-fault, but I see no
            ppp.core file?</a></dt><dt>14.21. <a href="ppp.html#idp78478416">Why does the process that forces a dial in auto mode never
            connect?</a></dt><dt>14.22. <a href="ppp.html#idp78504144">Why do most games not work with the -nat switch?</a></dt><dt>14.23. <a href="ppp.html#idp78544080">Has anybody made a list of useful port numbers?</a></dt><dt>14.24. <a href="ppp.html#idp78566608">What are FCS errors?</a></dt><dt>14.25. <a href="ppp.html#PPPoEwithNAT">Why do Mac OS(R) and Windows(R) 98 connections freeze when
            running PPPoE on the gateway?</a></dt><dt>14.26. <a href="ppp.html#idp78605136">None of this helps - I am desperate!  What can I do?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp78206544"></a><a id="userppp"></a><p><strong>14.1.</strong></p></td><td align="left" valign="top"><p>I cannot make <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> work.  What am I doing wrong?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>You should first read the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> manual page and
            the <a class="link" href="../../../../doc/el_GR.ISO8859-7/books/handbook/ppp-and-slip.html#USERPPP" target="_top">
            PPP section of the handbook</a>.  Enable logging with
            the command</p><pre class="programlisting">set log Phase Chat Connect Carrier lcp ipcp ccp command</pre><p>This command may be typed at the <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> command
            prompt or it may be entered in the
            <code class="filename">/etc/ppp/ppp.conf</code> configuration file
            (the start of the <code class="literal">default</code> section is
            the best place to put it).  Make sure that
            <code class="filename">/etc/syslog.conf</code> (see
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslog.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">syslog.conf</span>(5)</span></a>) contains the lines</p><pre class="programlisting">!ppp
*.*        /var/log/ppp.log</pre><p>and that the file <code class="filename">/var/log/ppp.log</code>
            exists.  You can now find out a lot about what is going on
            from the log file.  Do not worry if it does not all make sense.
            If you need to get help from someone, it may make sense to
            them.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78219472"></a><a id="ppp-hangs"></a><p><strong>14.2.</strong></p></td><td align="left" valign="top"><p>Why does <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> hang when I run it?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>This is usually because your hostname will not resolve.
            The best way to fix this is to make sure that
            <code class="filename">/etc/hosts</code> is consulted by your
            resolver first by editing <code class="filename">/etc/host.conf</code>
            and putting the <code class="literal">hosts</code> line first.  Then,
            simply put an entry in <code class="filename">/etc/hosts</code> for
            your local machine.  If you have no local network, change your
            <code class="systemitem">localhost</code> line:</p><pre class="programlisting">127.0.0.1        foo.example.com foo localhost</pre><p>Otherwise, simply add another entry for your host.
            Consult the relevant manual pages for more details.</p><p>You should be able to successfully <code class="command">ping -c1
            `hostname`</code> when you are done.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78234320"></a><a id="ppp-nodial-auto"></a><p><strong>14.3.</strong></p></td><td align="left" valign="top"><p>Why will <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> not dial in <code class="literal">-auto</code>
            mode?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>First, check that you have got a default route.  By
            running <code class="command">netstat -rn</code> (see
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=netstat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">netstat</span>(1)</span></a>), you should see two entries like
            this:</p><pre class="programlisting">Destination        Gateway            Flags     Refs     Use     Netif Expire
default            10.0.0.2           UGSc        0        0      tun0
10.0.0.2           10.0.0.1           UH          0        0      tun0</pre><p>This is assuming that you have used the addresses from the
            handbook, the manual page or from the ppp.conf.sample file.
            If you do not have a default route, it may be because you are
            running an old version of <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>
            that does not understand the word <code class="literal">HISADDR</code>
            in the ppp.conf file.</p><p>Another reason for the default route line being
            missing is that you have mistakenly set up a default
            router in your <code class="filename">/etc/rc.conf</code> (see
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>) file
            and you have omitted the line saying</p><pre class="programlisting">delete ALL</pre><p>from <code class="filename">ppp.conf</code>.  If this is the
            case, go back to the <a class="link" href="../../../../doc/el_GR.ISO8859-7/books/handbook/ppp-and-slip.html#USERPPP-FINAL" target="_top"> Final
            system configuration</a> section of the
            handbook.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78243920"></a><a id="no-route-to-host"></a><p><strong>14.4.</strong></p></td><td align="left" valign="top"><p>What does <span class="errorname">No route to host</span> mean?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>This error is usually due to a missing</p><pre class="programlisting">MYADDR:
  delete ALL
  add 0 0 HISADDR</pre><p>section in your <code class="filename">/etc/ppp/ppp.linkup</code>
            file.  This is only necessary if you have a dynamic IP address
            or do not know the address of your gateway.  If you are using
            interactive mode, you can type the following after entering
            <code class="literal">packet mode</code> (packet mode is
            indicated by the capitalized <acronym class="acronym">PPP</acronym> in the
            prompt):</p><pre class="programlisting">delete ALL
add 0 0 HISADDR</pre><p>Refer to the <a class="link" href="../../../../doc/el_GR.ISO8859-7/books/handbook/ppp-and-slip.html#USERPPP-DYNAMICIP" target="_top">
            PPP and Dynamic IP addresses</a> section of the handbook
            for further details.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78249552"></a><a id="connection-threeminutedrop"></a><p><strong>14.5.</strong></p></td><td align="left" valign="top"><p>Why does my connection drop after about 3 minutes?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>The default PPP timeout is 3 minutes.  This can be
            adjusted with the line</p><pre class="programlisting">set timeout <em class="replaceable"><code>NNN</code></em></pre><p>where <em class="replaceable"><code>NNN</code></em> is the number of
            seconds of inactivity before the connection is closed.  If
            <em class="replaceable"><code>NNN</code></em> is zero, the connection is never
            closed due to a timeout. It is possible to put this command in
            the <code class="filename">ppp.conf</code> file, or to type it at the
            prompt in interactive mode. It is also possible to adjust it on
            the fly while the line is active by connecting to
            <span class="application">ppp</span>'s server socket using
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnet&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">telnet</span>(1)</span></a> or <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pppctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pppctl</span>(8)</span></a>.
            Refer to the
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> man
            page for further details.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78260816"></a><a id="ppp-drop-heavy-load"></a><p><strong>14.6.</strong></p></td><td align="left" valign="top"><p>Why does my connection drop under heavy load?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If you have Link Quality Reporting (LQR) configured,
            it is possible that too many LQR packets are lost between
            your machine and the peer.  Ppp deduces that the line must
            therefore be bad, and disconnects.  Prior to FreeBSD version
            2.2.5, LQR was enabled by default.  It is now disabled by
            default. LQR can be disabled with the line</p><pre class="programlisting">disable lqr</pre></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78275664"></a><a id="ppp-drop-random"></a><p><strong>14.7.</strong></p></td><td align="left" valign="top"><p>Why does my connection drop after a random amount of
            time?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Sometimes, on a noisy phone line or even on a line with
            call waiting enabled, your modem may hang up because it
            thinks (incorrectly) that it lost carrier.</p><p>There is a setting on most modems for determining how
            tolerant it should be to temporary losses of carrier.  On a
            USR <span class="trademark">Sportster</span>(R) for example, this is measured by the S10
            register in tenths of a second.  To make your modem more
            forgiving, you could add the following send-expect sequence
            to your dial string:</p><pre class="programlisting">set dial "...... ATS10=10 OK ......"</pre><p>Refer to your modem manual for details.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78279376"></a><a id="ppp-hangs-random"></a><p><strong>14.8.</strong></p></td><td align="left" valign="top"><p>Why does my connection hang after a random amount of
            time?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Many people experience hung connections with no apparent
            explanation.  The first thing to establish is which side of
            the link is hung.</p><p>If you are using an external modem, you can simply try
            using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> to see if the <acronym class="acronym">TD</acronym>
            light is flashing when you transmit data.  If it flashes
            (and the <acronym class="acronym">RD</acronym> light does not), the
            problem is with the remote end. If <acronym class="acronym">TD</acronym>
            does not flash, the problem is local. With an internal
            modem, you will need to use the <code class="literal">set
            server</code> command in your
            <code class="filename">ppp.conf</code> file. When the hang occurs,
            connect to <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> using <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pppctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">pppctl</span>(8)</span></a>. If your
            network connection suddenly revives (PPP was revived due
            to the activity on the diagnostic socket) or if you cannot
            connect (assuming the <code class="literal">set socket</code>
            command succeeded at startup time), the problem is
            local. If you can connect and things are still hung,
            enable local async logging with <code class="literal">set log local
            async</code> and use <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> from another window
            or terminal to make use of the link. The async logging
            will show you the data being transmitted and received on
            the link. If data is going out and not coming back, the
            problem is remote.</p><p>Having established whether the problem is local or remote,
            you now have two possibilities:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If the problem is remote, read on entry <a class="xref" href="ppp.html#ppp-remote-not-responding" title="14.9.">Ε: 14.9</a>.</p></li><li class="listitem"><p>If the problem is local, read on entry <a class="xref" href="ppp.html#ppp-hung" title="14.10.">Ε: 14.10</a>.</p></li></ul></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78303056"></a><a id="ppp-remote-not-responding"></a><p><strong>14.9.</strong></p></td><td align="left" valign="top"><p>The remote end is not responding.  What can I do?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>There is very little you can do about this.  Most ISPs
            will refuse to help if you are not running a Microsoft OS.
            You can <code class="literal">enable lqr</code> in your
            <code class="filename">ppp.conf</code> file, allowing <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to detect
            the remote failure and hang up, but this detection is
            relatively slow and therefore not that useful.  You may want to
            avoid telling your ISP that you are running user-PPP...</p><p>First, try disabling all local compression by adding the
            following to your configuration:</p><pre class="programlisting">disable pred1 deflate deflate24 protocomp acfcomp shortseq vj
deny pred1 deflate deflate24 protocomp acfcomp shortseq vj</pre><p>Then reconnect to ensure that this makes no difference.
            If things improve or if the problem is solved completely,
            determine which setting makes the difference through trial
            and error.  This will provide good ammunition when you contact
            your ISP (although it may make it apparent that you are not
            running a Microsoft product).</p><p>Before contacting your ISP, enable async logging
            locally and wait until the connection hangs again.  This
            may use up quite a bit of disk space.  The last data read
            from the port may be of interest.  It is usually ascii
            data, and may even describe the problem (<span class="quote">«<span class="quote">Memory
            fault, core dumped</span>»</span>?).</p><p>If your ISP is helpful, they should be able to enable
            logging on their end, then when the next link drop occurs,
            they may be able to tell you why their side is having a
            problem.  Feel free to send the details to Brian Somers, or
            even to ask your ISP to contact me directly.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78313296"></a><a id="ppp-hung"></a><p><strong>14.10.</strong></p></td><td align="left" valign="top"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> has hung.  What can I do?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Your best bet here is to rebuild <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> by adding
            <code class="literal">CFLAGS+=-g</code> and
            <code class="literal">STRIP=</code> to the end of the Makefile, then
            doing a <code class="command">make clean &amp;&amp; make &amp;&amp;
            make install</code>.  When <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> hangs, find the
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> process id with <code class="command">ps ajxww | fgrep
            ppp</code> and run <code class="command">gdb ppp
            PID</code>.  From the gdb
            prompt, you can then use <code class="command">bt</code> to get a
            stack trace.</p><p>Send the results to Brian Somers.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78321104"></a><a id="ppp-loginok-thennothing"></a><p><strong>14.11.</strong></p></td><td align="left" valign="top"><p>Why does nothing happen after the <span class="quote">«<span class="quote">Login OK!</span>»</span>
            message?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Prior to FreeBSD version 2.2.5, once the link was
            established, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> would wait for the peer to
            initiate the Line Control Protocol (LCP).  Many ISPs will
            not initiate negotiations and expect the client to do so.
            To force <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to initiate the LCP, use the
            following line:</p><pre class="programlisting">set openmode active</pre><div xmlns="" class="note"><h3 class="admontitle">Σημείωση: </h3><p xmlns="http://www.w3.org/1999/xhtml">It usually does no harm if both sides initiate
                negotiation, so openmode is now active by default.
                However, the next section explains when it
                <span class="emphasis"><em>does</em></span> do some harm.</p></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78326736"></a><a id="ppp-same-magic"></a><p><strong>14.12.</strong></p></td><td align="left" valign="top"><p>I keep seeing errors about magic being the same.  What does
            it mean?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Occasionally, just after connecting, you may see messages
            in the log that say <span class="quote">«<span class="quote">magic is the same</span>»</span>.
            Sometimes, these messages are harmless, and sometimes one side
            or the other exits.  Most PPP implementations cannot survive
            this problem, and even if the link seems to come up, you will see
            repeated configure requests and configure acknowledgments in
            the log file until <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> eventually gives up and closes the
            connection.</p><p>This normally happens on server machines with slow
            disks that are spawning a getty on the port, and executing
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> from a login script or program after login.  I
            have also heard reports of it happening consistently when
            using slirp.  The reason is that in the time taken between
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getty&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">getty</span>(8)</span></a> exiting and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> starting, the
            client-side <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> starts sending Line Control
            Protocol (LCP) packets.  Because ECHO is still switched on
            for the port on the server, the client <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> sees
            these packets <span class="quote">«<span class="quote">reflect</span>»</span> back.</p><p>One part of the LCP negotiation is to establish a
            magic number for each side of the link so that
            <span class="quote">«<span class="quote">reflections</span>»</span> can be detected. The protocol
            says that when the peer tries to negotiate the same magic
            number, a NAK should be sent and a new magic number should
            be chosen.  During the period that the server port has
            ECHO turned on, the client <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> sends LCP packets,
            sees the same magic in the reflected packet and NAKs
            it. It also sees the NAK reflect (which also means
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> must change its magic). This produces a
            potentially enormous number of magic number changes, all
            of which are happily piling into the server's tty
            buffer. As soon as <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> starts on the server, it is
            flooded with magic number changes and almost immediately
            decides it has tried enough to negotiate LCP and gives
            up. Meanwhile, the client, who no longer sees the
            reflections, becomes happy just in time to see a hangup
            from the server.</p><p>This can be avoided by allowing the peer to start
            negotiating with the following line in your ppp.conf
            file:</p><pre class="programlisting">set openmode passive</pre><p>This tells <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to wait for the server to initiate LCP
            negotiations.  Some servers however may never initiate
            negotiations.  If this is the case, you can do something
            like:</p><pre class="programlisting">set openmode active 3</pre><p>This tells <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to be passive for 3 seconds, and then to
            start sending LCP requests.  If the peer starts sending
            requests during this period, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> will immediately respond
            rather than waiting for the full 3 second period.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78350416"></a><a id="ppp-lcp-constant"></a><p><strong>14.13.</strong></p></td><td align="left" valign="top"><p>LCP negotiations continue until the connection is
            closed.  What is wrong?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>There is currently an implementation mis-feature in
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> where it does not associate
            LCP, CCP &amp; IPCP responses with their original requests. As
            a result, if one PPP
            implementation is more than 6 seconds slower than the other
            side, the other side will send two additional LCP configuration
            requests. This is fatal.</p><p>Consider two implementations,
            <code class="systemitem">A</code> and
            <code class="systemitem">B</code>. <code class="systemitem">A</code> starts
            sending LCP requests immediately after connecting and
            <code class="systemitem">B</code> takes 7 seconds to start. When
            <code class="systemitem">B</code> starts, <code class="systemitem">A</code>
            has sent 3 LCP REQs. We are assuming the line has ECHO switched
            off, otherwise we would see magic number problems as described in
            the previous section. <code class="systemitem">B</code> sends a
            REQ, then an ACK to the first of
            <code class="systemitem">A</code>'s REQs. This results in
            <code class="systemitem">A</code> entering the <acronym class="acronym">OPENED</acronym>
            state and sending and ACK (the first) back to
            <code class="systemitem">B</code>. In the meantime,
            <code class="systemitem">B</code> sends back two more ACKs in response to
            the two additional REQs sent by <code class="systemitem">A</code>
            before <code class="systemitem">B</code> started up.
            <code class="systemitem">B</code> then receives the first ACK from
            <code class="systemitem">A</code> and enters the
            <acronym class="acronym">OPENED</acronym> state.
            <code class="systemitem">A</code> receives the second ACK from
            <code class="systemitem">B</code> and goes back to the
            <acronym class="acronym">REQ-SENT</acronym> state, sending another (forth) REQ
            as per the RFC. It then receives the third ACK and enters the
            <acronym class="acronym">OPENED</acronym> state. In the meantime,
            <code class="systemitem">B</code> receives the forth REQ from
            <code class="systemitem">A</code>, resulting in it reverting to the
            <acronym class="acronym">ACK-SENT</acronym> state and sending
            another (second) REQ and (forth) ACK as per the RFC.
            <code class="systemitem">A</code> gets the REQ, goes into
            <acronym class="acronym">REQ-SENT</acronym> and sends another REQ. It
            immediately receives the following ACK and enters
            <acronym class="acronym">OPENED</acronym>.</p><p>This goes on until one side figures out that they are
            getting nowhere and gives up.</p><p>The best way to avoid this is to configure one side to be
            <code class="literal">passive</code> - that is, make one side
            wait for the other to start negotiating.  This can be done
            with the</p><pre class="programlisting">set openmode passive</pre><p>command.  Care should be taken with this option.  You
            should also use the</p><pre class="programlisting">set stopped N</pre><p>command to limit the amount of time that
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> waits for the peer to begin
            negotiations.  Alternatively, the</p><pre class="programlisting">set openmode active N</pre><p>command (where <em class="replaceable"><code>N</code></em> is the
            number of seconds to wait before starting negotiations) can be
            used.  Check the manual page for details.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78381392"></a><a id="ppp-shell-test-lockup"></a><p><strong>14.14.</strong></p></td><td align="left" valign="top"><p>Why does <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> lock up when I shell out to test
            it?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>When you execute the <code class="command">shell</code> or
            <code class="command">!</code> command, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> executes a
            shell (or if you have passed any arguments,
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> will execute those arguments). Ppp will
            wait for the command to complete before continuing. If you
            attempt to use the PPP link while running the command, the link
            will appear to have frozen. This is because
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> is waiting for the command to
            complete.</p><p>If you wish to execute commands like this, use the
            <code class="command">!bg</code> command instead.  This will execute
            the given command in the background, and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> can
            continue to service the link.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78393040"></a><a id="ppp-nullmodem"></a><p><strong>14.15.</strong></p></td><td align="left" valign="top"><p>Why does <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> over a null-modem cable never exit?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>There is no way for <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to
            automatically determine that a direct connection has been
            dropped.  This is due to the lines that are used in a
            null-modem serial cable.  When using this sort of connection,
            LQR should always be enabled with the line</p><pre class="programlisting">enable lqr</pre><p>LQR is accepted by default if negotiated by the peer.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78397392"></a><a id="ppp-auto-noreasondial"></a><p><strong>14.16.</strong></p></td><td align="left" valign="top"><p>Why does <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> dial for no reason in -auto mode?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> is dialing unexpectedly, you must
            determine the cause, and set up Dial filters (dfilters) to
            prevent such dialing.</p><p>To determine the cause, use the following line:</p><pre class="programlisting">set log +tcp/ip</pre><p>This will log all traffic through the connection.  The
            next time the line comes up unexpectedly, you will see the
            reason logged with a convenient timestamp next to
            it.</p><p>You can now disable dialing under these circumstances.
            Usually, this sort of problem arises due to DNS lookups.
            To prevent DNS lookups from establishing a connection
            (this will <span class="emphasis"><em>not</em></span> prevent <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>
            from passing the packets through an established
            connection), use the following:</p><pre class="programlisting">set dfilter 1 deny udp src eq 53
set dfilter 2 deny udp dst eq 53
set dfilter 3 permit 0/0 0/0</pre><p>This is not always suitable, as it will effectively
            break your demand-dial capabilities - most programs will
            need a DNS lookup before doing any other network related
            things.</p><p>In the DNS case, you should try to determine what is
            actually trying to resolve a host name.  A lot of the
            time, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sendmail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sendmail</span>(8)</span></a> is the culprit.  You should make
            sure that you tell sendmail not to do any DNS lookups in
            its configuration file.  See the section on <a class="link" href="../../../../doc/el_GR.ISO8859-7/books/handbook/smtp-dialup.html" target="_top">using email with a
            dialup connection</a> in the FreeBSD Handbook for
            details on how to create your own configuration file and
            what should go into it.  You may also want to add the
            following line to your <code class="filename">.mc</code>
            file:</p><pre class="programlisting">define(`confDELIVERY_MODE', `d')dnl</pre><p>This will make sendmail queue everything until the
            queue is run (usually, sendmail is invoked with
            <code class="option">-bd -q30m</code>, telling it to run the queue
            every 30 minutes) or until a <code class="command">sendmail
            -q</code> is done (perhaps from your ppp.linkup
            file).</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78412368"></a><a id="ccp-errors"></a><p><strong>14.17.</strong></p></td><td align="left" valign="top"><p>What do these CCP errors mean?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>I keep seeing the following errors in my log file:</p><pre class="programlisting">CCP: CcpSendConfigReq
CCP: Received Terminate Ack (1) state = Req-Sent (6)</pre><p>This is because <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> is trying to negotiate Predictor1
            compression, and the peer does not want to negotiate any
            compression at all.  The messages are harmless, but if you
            wish to remove them, you can disable Predictor1 compression
            locally too:</p><pre class="programlisting">disable pred1</pre></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78416336"></a><a id="ppp-connectionspeed"></a><p><strong>14.18.</strong></p></td><td align="left" valign="top"><p>Why does <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> not log my connection speed?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>In order to log all lines of your modem
            <span class="quote">«<span class="quote">conversation</span>»</span>, you must enable the
            following:</p><pre class="programlisting">set log +connect</pre><p>This will make <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> log
            everything up until the last requested <span class="quote">«<span class="quote">expect</span>»</span>
            string.</p><p>If you wish to see your connect speed and are using PAP
            or CHAP (and therefore do not have anything to
            <span class="quote">«<span class="quote">chat</span>»</span> after the CONNECT in the dial script - no
            <code class="literal">set login</code> script), you must make sure that
            you instruct <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to <span class="quote">«<span class="quote">expect</span>»</span> the whole CONNECT
            line, something like this:</p><pre class="programlisting">set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 4 \
  \"\" ATZ OK-ATZ-OK ATDT\\T TIMEOUT 60 CONNECT \\c \\n"</pre><p>Here, we get our CONNECT, send nothing, then expect a
            line-feed, forcing <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to read
            the whole CONNECT response.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78425552"></a><a id="ppp-ignores-backslash"></a><p><strong>14.19.</strong></p></td><td align="left" valign="top"><p>Why does <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> ignore the <code class="literal">\</code> character
            in my chat script?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Ppp parses each line in your config files so that it can
            interpret strings such as
            <code class="literal">set phone "123 456 789"</code> correctly and
            realize that the number is actually only
            <span class="emphasis"><em>one</em></span> argument. In order to specify a
            <code class="literal">"</code> character, you must escape it
            using a backslash (<code class="literal">\</code>).</p><p>When the chat interpreter parses each argument, it
            re-interprets the argument in order to find any special
            escape sequences such as <code class="literal">\P</code> or
            <code class="literal">\T</code> (see the manual page).  As a result of this
            double-parsing, you must remember to use the correct number of
            escapes.</p><p>If you wish to actually send a <code class="literal">\</code>
            character to (say) your modem, you would need something
            like:</p><pre class="programlisting">set dial "\"\" ATZ OK-ATZ-OK AT\\\\X OK"</pre><p>resulting in the following sequence:</p><pre class="programlisting">ATZ
OK
AT\X
OK</pre><p>or</p><pre class="programlisting">set phone 1234567
set dial "\"\" ATZ OK ATDT\\T"</pre><p>resulting in the following sequence:</p><pre class="programlisting">ATZ
OK
ATDT1234567</pre></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78451408"></a><a id="ppp-segfault-nocore"></a><p><strong>14.20.</strong></p></td><td align="left" valign="top"><p>Why does <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> get a seg-fault, but I see no
            <code class="filename">ppp.core</code> file?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Ppp (or any other program for that matter) should
            never dump core.  Because <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> runs with an
            effective user id of 0, the operating system will not
            write <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>'s core image to disk before terminating
            it.  If, however <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> is actually terminating due
            to a segmentation violation or some other signal that
            normally causes core to be dumped,
            <span class="emphasis"><em>and</em></span> you are sure you are using the
            latest version (see the start of this section), then you
            should do the following:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>tar xfz ppp-*.src.tar.gz</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cd ppp*/ppp</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>echo STRIP= &gt;&gt;Makefile</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>echo CFLAGS+=-g &gt;&gt;Makefile</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>make clean all</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>su</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 555 /usr/sbin/ppp</code></strong></pre><p>You will now have a debuggable version of <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>
            installed.  You will have to be <code class="systemitem">root</code>
            to run <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> as all of its privileges have been
            revoked.  When you start <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>, take a careful note
            of what your current directory was at the time.</p><p>Now, if and when <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> receives the segmentation
            violation, it will dump a core file called
            <code class="filename">ppp.core</code>.  You should then do the
            following:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>su</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gdb /usr/sbin/ppp ppp.core</code></strong>
<code class="prompt">(gdb)</code> <strong class="userinput"><code>bt</code></strong>
.....
<code class="prompt">(gdb)</code> <strong class="userinput"><code>f 0</code></strong>
....
<code class="prompt">(gdb)</code> <strong class="userinput"><code>i args</code></strong>
....
<code class="prompt">(gdb)</code> <strong class="userinput"><code>l</code></strong>
.....</pre><p>All of this information should be given alongside your
            question, making it possible to diagnose the problem.</p><p>If you are familiar with gdb, you may wish to find out some
            other bits and pieces such as what actually caused the dump and
            the addresses &amp; values of the relevant variables.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78478416"></a><a id="ppp-autodialprocess-noconnect"></a><p><strong>14.21.</strong></p></td><td align="left" valign="top"><p>Why does the process that forces a dial in auto mode never
            connect?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>This was a known problem with
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> set up to negotiate a
            dynamic local IP number with the peer in auto mode.  It is
            fixed in the latest version - search the manual page for
            <code class="literal">iface</code>.</p><p>The problem was that when that initial program calls
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=connect&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">connect</span>(2)</span></a>, the IP number of the tun interface is assigned
            to the socket endpoint. The kernel creates the first outgoing
            packet and writes it to the tun device.
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> then reads the packet and
            establishes a connection. If, as a result of
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>'s dynamic IP assignment, the
            interface address is changed, the original socket endpoint will
            be invalid. Any subsequent packets sent to the peer will
            usually be dropped. Even if they are not, any responses will
            not route back to the originating machine as the IP number is
            no longer owned by that machine.</p><p>There are several theoretical ways to approach this
            problem. It would be nicest if the peer would re-assign the
            same IP number if possible <code class="literal">:-)</code>
            The current version of <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> does
            this, but most other implementations do not.</p><p>The easiest method from our side would be to never
            change the tun interface IP number, but instead to change
            all outgoing packets so that the source IP number is
            changed from the interface IP to the negotiated IP on the
            fly. This is essentially what the
            <code class="literal">iface-alias</code> option in the latest
            version of <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> is doing (with the help of
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=libalias&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">libalias</span>(3)</span></a> and <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>'s <code class="option">-nat</code>
            switch) - it is maintaining all previous interface
            addresses and NATing them to the last negotiated
            address.</p><p>Another alternative (and probably the most reliable) would
            be to implement a system call that changes all bound sockets
            from one IP to another.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> would
            use this call to modify the sockets of all existing programs
            when a new IP number is negotiated. The same system call could
            be used by dhcp clients when they are forced to re-bind() their
            sockets.</p><p>Yet another possibility is to allow an interface to be
            brought up without an IP number. Outgoing packets would be
            given an IP number of 255.255.255.255 up until the first
            SIOCAIFADDR ioctl is done. This would result in fully binding
            the socket. It would be up to <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>
            to change the source IP number, but only if it is set to
            255.255.255.255, and only the IP number and IP checksum would
            need to change. This, however is a bit of a hack as the kernel
            would be sending bad packets to an improperly configured
            interface, on the assumption that some other mechanism is
            capable of fixing things retrospectively.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78504144"></a><a id="ppp-nat-games"></a><p><strong>14.22.</strong></p></td><td align="left" valign="top"><p>Why do most games not work with the -nat switch?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>The reason games and the like do not work when libalias
            is in use is that the machine on the outside will try to open a
            connection or send (unsolicited) UDP packets to the machine on
            the inside. The NAT software does not know that it should send
            these packets to the interior machine.</p><p>To make things work, make sure that the only thing
            running is the software that you are having problems with, then
            either run tcpdump on the tun interface of the gateway or
            enable <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> tcp/ip logging (<code class="literal">set log +tcp/ip</code>)
            on the gateway.</p><p>When you start the offending software, you should see
            packets passing through the gateway machine. When
            something comes back from the outside, it will be dropped
            (that is the problem). Note the port number of these
            packets then shut down the offending software. Do this a
            few times to see if the port numbers are consistent. If
            they are, then the following line in the relevant section
            of <code class="filename">/etc/ppp/ppp.conf</code> will make the
            software functional:</p><pre class="programlisting">nat port <em class="replaceable"><code>proto</code></em> <em class="replaceable"><code>internalmachine</code></em>:<em class="replaceable"><code>port</code></em> <em class="replaceable"><code>port</code></em></pre><p>where <em class="replaceable"><code>proto</code></em> is either
            <code class="literal">tcp</code> or <code class="literal">udp</code>,
            <em class="replaceable"><code>internalmachine</code></em> is the machine that
            you want the packets to be sent to and
            <em class="replaceable"><code>port</code></em> is the destination port number
            of the packets.</p><p>You will not be able to use the software on other machines
            without changing the above command, and running the software
            on two internal machines at the same time is out of the question
            - after all, the outside world is seeing your entire internal
            network as being just a single machine.</p><p>If the port numbers are not consistent, there are three
            more options:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Submit support in libalias. Examples of
                <span class="quote">«<span class="quote">special cases</span>»</span> can be found in
                <code class="filename">/usr/src/lib/libalias/alias_*.c</code>
                (<code class="filename">alias_ftp.c</code> is a good
                prototype). This usually involves reading certain
                recognised outgoing packets, identifying the
                instruction that tells the outside machine to initiate
                a connection back to the internal machine on a
                specific (random) port and setting up a
                <span class="quote">«<span class="quote">route</span>»</span> in the alias table so that the
                subsequent packets know where to go.</p><p>This is the most difficult solution, but it is the
                best and will make the software work with multiple
                machines.</p></li><li class="listitem"><p>Use a proxy.  The application may support socks5
                for example, or (as in the <span class="quote">«<span class="quote">cvsup</span>»</span> case)
                may have a <span class="quote">«<span class="quote">passive</span>»</span> option that avoids
                ever requesting that the peer open connections back to
                the local machine.</p></li><li class="listitem"><p>Redirect everything to the internal machine using
                <code class="literal">nat addr</code>.  This is the
                sledge-hammer approach.</p></li></ol></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78544080"></a><a id="useful-port-numbers"></a><p><strong>14.23.</strong></p></td><td align="left" valign="top"><p>Has anybody made a list of useful port numbers?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Not yet, but this is intended to grow into such a list
            (if any interest is shown).  In each example,
            <em class="replaceable"><code>internal</code></em> should be replaced with
            the IP number of the machine playing the game.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="application">Asheron's Call</span></p><p><code class="literal">nat port udp
                internal
                :65000 65000</code></p><p>Manually change the port number within the game to
                65000. If you have got a number of machines that you wish
                to play on assign a unique port number for each (i.e.
                65001, 65002, etc) and add a <code class="literal">nat port</code>
                line for each one.</p></li><li class="listitem"><p><span class="application">Half Life</span></p><p><code class="literal">nat port udp
                internal:27005
                27015</code></p></li><li class="listitem"><p><span class="application">PCAnywhere 8.0</span></p><p><code class="literal">nat port udp
                internal:5632
                5632</code></p><p><code class="literal">nat port tcp
                internal:5631
                5631</code></p></li><li class="listitem"><p><span class="application">Quake</span></p><p><code class="literal">nat port udp
                internal:6112
                6112</code></p></li><li class="listitem"><p><span class="application">Quake 2</span></p><p><code class="literal">nat port udp
                internal:27901
                27910</code></p><p><code class="literal">nat port udp
                internal:60021
                60021</code></p><p><code class="literal">nat port udp
                internal:60040
                60040</code></p></li><li class="listitem"><p><span class="application">Red Alert</span></p><p><code class="literal">nat port udp
                internal:8675
                8675</code></p><p><code class="literal">nat port udp
                internal:5009
                5009</code></p></li></ul></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78566608"></a><a id="fcs-errors"></a><p><strong>14.24.</strong></p></td><td align="left" valign="top"><p>What are FCS errors?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>FCS stands for <code class="literal">F</code>rame
            <code class="literal">C</code>heck <code class="literal">S</code>equence.
            Each PPP packet has a checksum attached to ensure that the
            data being received is the data being sent.  If the FCS of
            an incoming packet is incorrect, the packet is dropped and
            the HDLC FCS count is increased.  The HDLC error values
            can be displayed using the <code class="literal">show hdlc</code>
            command.</p><p>If your link is bad (or if your serial driver is dropping
            packets), you will see the occasional FCS error.  This is not
            usually worth worrying about although it does slow down the
            compression protocols substantially.  If you have an external
            modem, make sure your cable is properly shielded from
            interference - this may eradicate the problem.</p><p>If your link freezes as soon as you have connected and you
            see a large number of FCS errors, this may be because your link
            is not 8 bit clean. Make sure your modem is not using software
            flow control (XON/XOFF). If your datalink
            <span class="emphasis"><em>must</em></span> use software flow control, use the
            command <code class="literal">set accmap 0x000a0000</code> to tell
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> to escape the <code class="literal">^Q</code> and
            <code class="literal">^S</code> characters.</p><p>Another reason for seeing too many FCS errors may be
            that the remote end has stopped talking
            <acronym class="acronym">PPP</acronym>. You may want to enable
            <code class="literal">async</code> logging at this point to
            determine if the incoming data is actually a login or
            shell prompt. If you have a shell prompt at the remote
            end, it is possible to terminate <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a> without
            dropping the line by using the <code class="literal">close
            lcp</code> command (a following <code class="literal">term</code>
            command will reconnect you to the shell on the remote
            machine.</p><p>If nothing in your log file indicates why the link might
            have been terminated, you should ask the remote administrator
            (your ISP?) why the session was terminated.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="PPPoEwithNAT"></a><a id="macos-win98-pppoe-freeze"></a><p><strong>14.25.</strong></p></td><td align="left" valign="top"><p>Why do <span class="trademark">Mac OS</span>(R) and <span class="trademark">Windows</span>(R) 98 connections freeze when
            running PPPoE on the gateway?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Thanks to Michael Wozniak
            <code class="email">&lt;<a xmlns="" class="email" href="mailto:mwozniak@netcom.ca">mwozniak@netcom.ca</a>&gt;</code> for figuring this out and
            Dan Flemming <code class="email">&lt;<a xmlns="" class="email" href="mailto:danflemming@mac.com">danflemming@mac.com</a>&gt;</code> for the Mac
            solution:</p><p>This is due to what is called a <span class="quote">«<span class="quote">Black Hole</span>»</span>
            router.  <span class="trademark">Mac OS</span>(R) and <span class="trademark">Windows</span>(R) 98 (and maybe other Microsoft OSs)
            send TCP packets with a requested segment size too big to fit
            into a PPPoE frame (MTU is 1500 by default for Ethernet)
            <span class="emphasis"><em>and</em></span> have the <span class="quote">«<span class="quote">do not
            fragment</span>»</span> bit set (default of TCP) and the Telco router
            is not sending ICMP <span class="quote">«<span class="quote">must fragment</span>»</span> back to the
            www site you are trying to load.  (Alternatively, the router is
            sending the ICMP packet correctly, but the firewall at the www
            site is dropping it.)  When the www server is sending
            you frames that do not fit into the PPPoE pipe the Telco router
            drops them on the floor and your page does not load (some
            pages/graphics do as they are smaller than a MSS.) This seems
            to be the default of most Telco PPPoE configurations (if only
            they knew how to program a router... sigh...)</p><p>One fix is to use regedit on your 95/98 boxes to add the
            following registry entry...</p><pre class="programlisting">HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Class\NetTrans\0000\MaxMTU</pre><p>It should be a string with a value
            <span class="quote">«<span class="quote">1436</span>»</span>, as some ADSL routers are reported to
            be unable to deal with packets larger than this.  This
            registry key has been changed to
            <code class="literal">Tcpip\Parameters\Interfaces\ID for
            adapter\MTU</code> in <span class="trademark">Windows</span>(R) 2000 and
            becomes a DWORD.</p><p>Refer to the Microsoft Knowledge Base documents <a class="link" href="http://support.microsoft.com/support/kb/articles/Q158/4/74.asp" target="_top">Q158474
            - Windows TCPIP Registry Entries</a> and <a class="link" href="http://support.microsoft.com/support/kb/articles/Q120/6/42.asp" target="_top">Q120642
            - TCPIP &amp; NBT Configuration Parameters for <span class="trademark">Windows NT</span>(R)
            </a> for more information on changing <span class="trademark">Windows</span>(R) MTU to
            work with a NAT router.</p><p>Another regedit possibility under <span class="trademark">Windows</span>(R) 2000 is to
            set the
            <code class="literal">Tcpip\Parameters\Interfaces\ID for
            adapter\EnablePMTUBHDetect</code> DWORD
            to 1 as mentioned in the Microsoft document 120642
            mentioned above.</p><p>Unfortunately, <span class="trademark">Mac OS</span>(R) does not provide an interface for
            changing TCP/IP settings. However, there is commercial software
            available, such as OTAdvancedTuner (OT for OpenTransport, the
            <span class="trademark">Mac OS</span>(R) TCP/IP stack) by <a class="link" href="http://www.softworks.com/" target="_top">Sustainable Softworks</a>,
            that will allow users to customize TCP/IP settings. <span class="trademark">Mac OS</span>(R) NAT
            users should select <code class="literal">ip_interface_MTU</code> from
            the drop-down menu, enter <code class="literal">1450</code> instead of
            <code class="literal">1500</code> in the box, click the box next to
            <code class="literal">Save as Auto Configure</code>, and click
            <code class="literal">Make Active</code>.</p><p>The latest version of <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>
            (2.3 or greater) has an <code class="command">enable tcpmssfixup</code>
            command that will automatically adjust the MSS to an appropriate
            value.  This facility is enabled by default.  If you are stuck
            with an older version of <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>, you
            may want to look at the <span class="application">tcpmssd</span>
            port.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp78605136"></a><a id="desperation"></a><p><strong>14.26.</strong></p></td><td align="left" valign="top"><p>None of this helps - I am desperate!  What can I do?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>If all else fails, send as much information as you can,
            including your config files, how you are starting
            <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ppp&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ppp</span>(8)</span></a>, the relevant parts of your
            log file and the output of the <code class="command">netstat -rn</code>
            command (before and after connecting) to the <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">ηλεκτρονική λίστα γενικών ερωτήσεων του FreeBSD</a> or
            the <a class="link" href="news:comp.unix.bsd.freebsd.misc" target="_top">
            comp.unix.bsd.freebsd.misc</a> news group, and someone
            should point you in the right direction.</p></td></tr></tbody></table></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="security.html">Προηγ</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="serial.html">Επόμενο</a></td></tr><tr><td width="40%" align="left" valign="top">Κεφάλαιο 13. Ασφάλεια </td><td width="20%" align="center"><a accesskey="h" href="index.html">Αρχή</a></td><td width="40%" align="right" valign="top"> Κεφάλαιο 15. Σειριακές Επικοινωνίες</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Αυτό το κείμενο, και άλλα κείμενα, μπορεί να βρεθεί στο
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Για ερωτήσεις σχετικά με το FreeBSD, διαβάστε την
    <a href="http://www.FreeBSD.org/docs.html">τεκμηρίωση</a> πριν να επικοινωνήσετε με την
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Για ερωτήσεις σχετικά με αυτή την τεκμηρίωση, στείλτε e-mail στην
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>