===============================
25.4. ??????????????? ?? DTrace
===============================

.. raw:: html

   <div class="navheader">

25.4. ??????????????? ?? DTrace
`????? <dtrace-enable.html>`__?
???????? 25. DTrace
?\ `??????? <dtrace-language.html>`__

--------------

.. raw:: html

   </div>

.. raw:: html

   <div class="sect1">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

25.4. ??????????????? ?? DTrace
-------------------------------

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

???? ??????????????? ??? ??????????? ??? DTrace, ?? ?????? ?? ??????? ?
?????????? ???????. ??? ?? ????????? ?? ???????, ?? ?????? ?? ?????? ???
???????? ??????:

.. code:: screen

    # kldload dtraceall

?? ?????? ?? ????? ????? ?????????? DTrace. ??? ?? ????? ??? ?? probes,
?? ?????? ?? ?????????? ?? ???????????? ??? ???????? ??????:

.. code:: screen

    # dtrace -l | more

??? ? ?????? ??????? ???? ??? ?????????? ???????????? ``more``,
??????????? ??????? ?? ??????????? ??? ????????? ????? ??? ??????. ???
?????? ????, ?? ?????? ?? ???????? ??? ?? DTrace ??????????. ????? ?????
??? ?? ?????????? ???? ?? ????? ?????????.

? ????? ??? ????????? ????? ??? ??????? ??? ?????? scripts ???
??????????? ?? ?? DTrace ???? ?? ????????? ??????????? ??????? ?? ??
???????. ???????? scripts ??? ???????? ??? ??????? ??????, ?? ?????, ??
????? ??? CPU ??? ????? ?????. ????? ??????? ??? scripts ?? ??? ????????
??????:

.. code:: screen

    # gunzip -c DTraceToolkit* | tar xvf -

????????????? ???? ???????? ??? ?? ????????????? ?? ??? ?????? ``cd``
??? ??????? ?? ?????????? ????????? ?? ??? ?? ??????, ???? ??? ?????? ??
?? ????? ????????, ?? ``755``.

?? ????????? ?? ?????? ??????? ??? ??????????? ?? ??? ?? scripts. ???
????????? ?? ``/usr/bin/ksh`` ?? ?????? ?? ????????? ??
``/usr/local/bin/ksh``, ?? ???? ??? ????????? ?? ``/usr/bin/sh`` ??
?????? ?? ????????? ?? ``/bin/sh``, ??? ????? ???? ??? ????????? ??
``/usr/bin/perl`` ?? ?????? ?? ????????? ?? ``/usr/local/bin/perl``.

.. raw:: html

   <div class="important" xmlns="">

?????????:
~~~~~~~~~~

??? ?????? ???? ????? ????????? ?? ????????????? ???? ????????? ??? ?
?????????? DTrace ??? FreeBSD ????? *??????* ??? ???????????. ????? ???
???? ?? scripts ??? ?? ?????????????, ????? ????? ???? ????
???????????????? ??? SolarisTM, ? ????????????? probes ?? ????? ???
?????????????? ?? ???????? ??????.

.. raw:: html

   </div>

?? ?????? ??? ????????? ????? ?? ???????, ???? ??? scripts ??? ?? ?????
????????? ??? DTrace ?????????????? ?????? ??? FreeBSD: ?? ``hotkernel``
??? ?? ``procsystime``. ???? ?? ??? ?? ????????????? ??? ??????? ???????
????? ??? ????????.

?? ``hotkernel`` ???? ?????????? ?? ??????????? ???? ?????????
??????????? ?? ?????????? ????? ???? ??????. ?????????? ?? ??? ?????????
????????, ?? ????? ????? ???????? ?? ??? ????????:

.. code:: screen

    # ./hotkernel
    Sampling... Hit Ctrl-C to end.

? ???????????? ??? ?????????? ?? ?????? ?? ?????????????? ?? ?????????
???????? **Ctrl**+**C** ??? ?? ?????????? ?? ?????????. ?? ???
?????????? ???, ?? script ?? ??????????? ??? ????? ??? ??????????? ???
?????? ??? ??????????? ??????? ?? ?? ????? ????, ???????????? ??? ??
??????? ????? ??????? ?? ?? ?????:

.. code:: screen

    kernel`_thread_lock_flags                                   2   0.0%
    0xc1097063                                                  2   0.0%
    kernel`sched_userret                                        2   0.0%
    kernel`kern_select                                          2   0.0%
    kernel`generic_copyin                                       3   0.0%
    kernel`_mtx_assert                                          3   0.0%
    kernel`vm_fault                                             3   0.0%
    kernel`sopoll_generic                                       3   0.0%
    kernel`fixup_filename                                       4   0.0%
    kernel`_isitmyx                                             4   0.0%
    kernel`find_instance                                        4   0.0%
    kernel`_mtx_unlock_flags                                    5   0.0%
    kernel`syscall                                              5   0.0%
    kernel`DELAY                                                5   0.0%
    0xc108a253                                                  6   0.0%
    kernel`witness_lock                                         7   0.0%
    kernel`read_aux_data_no_wait                                7   0.0%
    kernel`Xint0x80_syscall                                     7   0.0%
    kernel`witness_checkorder                                   7   0.0%
    kernel`sse2_pagezero                                        8   0.0%
    kernel`strncmp                                              9   0.0%
    kernel`spinlock_exit                                       10   0.0%
    kernel`_mtx_lock_flags                                     11   0.0%
    kernel`witness_unlock                                      15   0.0%
    kernel`sched_idletd                                       137   0.3%
    0xc10981a5                                              42139  99.3%

?? script ???? ?????????? ?????? ?? ????????? ??? ??????. ??? ??
??????????????? ???? ?? ??????????????, ????????? ?? ?? ??? ???????
``-m``:

.. code:: screen

    # ./hotkernel -m
    Sampling... Hit Ctrl-C to end.
    ^C
    MODULE                                                  COUNT   PCNT
    0xc107882e                                                  1   0.0%
    0xc10e6aa4                                                  1   0.0%
    0xc1076983                                                  1   0.0%
    0xc109708a                                                  1   0.0%
    0xc1075a5d                                                  1   0.0%
    0xc1077325                                                  1   0.0%
    0xc108a245                                                  1   0.0%
    0xc107730d                                                  1   0.0%
    0xc1097063                                                  2   0.0%
    0xc108a253                                                 73   0.0%
    kernel                                                    874   0.4%
    0xc10981a5                                             213781  99.6%

?? ``procsystime`` script ??????????? ??? ??????? ??? ????? ??? ???????
?????????? ??? ??? ???????????? ????????? ???? ??? PID ? ??? ????????
???. ??? ???????? ?????????? ?????? ????????? ??? ??? ????????? ???
``/bin/csh``. ?????????? ?? ``procsystime`` ??? ?? ??????? ???? ???????
????? ??????? ??????? ??????? ??? ``csh`` ??? ?????? ???????. ???? ?????
?? ???????????? ??? ??????? ???:

.. code:: screen

    # ./procsystime -n csh
    Tracing... Hit Ctrl-C to end...
    ^C

    Elapsed Times for processes csh,

             SYSCALL          TIME (ns)
              getpid               6131
           sigreturn               8121
               close              19127
               fcntl              19959
                 dup              26955
             setpgid              28070
                stat              31899
           setitimer              40938
               wait4              62717
           sigaction              67372
         sigprocmask             119091
        gettimeofday             183710
               write             263242
              execve             492547
               ioctl             770073
               vfork            3258923
          sigsuspend            6985124
                read         3988049784

???? ????????, ? ????? ??? ?????????? ??? ???????? (``read()``) ?????
???? ??? ??????????? ??? ??????????? ????? ?? ????????????????, ??? ??
???????? ??? ??????????? ? ????? ?????????? ``getpid()``.

.. raw:: html

   </div>

.. raw:: html

   <div class="navfooter">

--------------

+----------------------------------------------+--------------------------+-----------------------------------------+
| `????? <dtrace-enable.html>`__?              | `???? <dtrace.html>`__   | ?\ `??????? <dtrace-language.html>`__   |
+----------------------------------------------+--------------------------+-----------------------------------------+
| 25.3. ???????????? ??? ??????????? DTrace?   | `???? <index.html>`__    | ?25.5. ? ?????? D                       |
+----------------------------------------------+--------------------------+-----------------------------------------+

.. raw:: html

   </div>

???? ?? ???????, ??? ???? ???????, ?????? ?? ?????? ???
ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/

| ??? ????????? ??????? ?? ?? FreeBSD, ???????? ???
  `?????????? <http://www.FreeBSD.org/docs.html>`__ ???? ??
  ?????????????? ?? ??? <questions@FreeBSD.org\ >.
|  ??? ????????? ??????? ?? ???? ??? ??????????, ??????? e-mail ????
  <doc@FreeBSD.org\ >.
