<?xml version="1.0" encoding="iso-8859-7" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-7" /><title>15.5. One-time Passwords</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Εγχειρίδιο του FreeBSD" /><link rel="up" href="security.html" title="Κεφάλαιο 15. Ασφάλεια" /><link rel="prev" href="crypt.html" title="15.4. DES, MD5, and Crypt" /><link rel="next" href="tcpwrappers.html" title="15.6. TCP Wrappers" /><link rel="copyright" href="legalnotice.html" title="Νομική Σημείωση" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">15.5. One-time Passwords</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="crypt.html">Προηγ</a> </td><th width="60%" align="center">Κεφάλαιο 15. Ασφάλεια</th><td width="20%" align="right"> <a accesskey="n" href="tcpwrappers.html">Επόμενο</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="one-time-passwords"></a>15.5. One-time Passwords</h2></div></div></div><a id="idp87522896" class="indexterm"></a><a id="idp87523408" class="indexterm"></a><p>By default, FreeBSD includes support for OPIE (One-time Passwords
      In Everything), which uses the MD5 hash by default.</p><p>There are three different sorts of passwords which we will discuss
      below.  The first is your usual <span class="trademark">UNIX</span>(R) style or
      Kerberos password; we will call this a <span class="quote">«<span class="quote"><span class="trademark">UNIX</span>(R) password</span>»</span>.
      The second sort is the one-time password which is generated by the OPIE
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=opiekey&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">opiekey</span>(1)</span></a> program and accepted by the
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=opiepasswd&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">opiepasswd</span>(1)</span></a> program
      and the login prompt; we will
      call this a <span class="quote">«<span class="quote">one-time password</span>»</span>.  The final sort of
      password is the secret password which you give to the
      <code class="command">opiekey</code> program (and
      sometimes the
      <code class="command">opiepasswd</code> programs)
      which it uses to generate
      one-time passwords; we will call it a <span class="quote">«<span class="quote">secret password</span>»</span>
      or just unqualified <span class="quote">«<span class="quote">password</span>»</span>.</p><p>The secret password does not have anything to do with your <span class="trademark">UNIX</span>(R)
      password; they can be the same but this is not recommended.
      OPIE secret passwords are not limited to 8 characters like old
      <span class="trademark">UNIX</span>(R) passwords<a href="#ftn.idp87531600" class="footnote" id="idp87531600"><sup class="footnote">[8]</sup></a>,
      they can be as long as you like.  Passwords of six or
      seven word long phrases are fairly common.  For the most part, the
      OPIE system operates completely independently of the <span class="trademark">UNIX</span>(R)
      password system.</p><p>Besides the password, there are two other pieces of data that
      are important to OPIE.  One is what is known as the
      <span class="quote">«<span class="quote">seed</span>»</span> or <span class="quote">«<span class="quote">key</span>»</span>, consisting of two letters
      and five digits.  The other is what is called the <span class="quote">«<span class="quote">iteration
      count</span>»</span>, a number between 1 and 100.  OPIE creates the
      one-time password by concatenating the seed and the secret password,
      then applying the MD5 hash as many times as specified by the
      iteration count and turning the result into six short English words.
      These six English words are your one-time password.  The
      authentication system (primarily PAM) keeps
      track of the last one-time password used, and the user is
      authenticated if the hash of the user-provided password is equal to
      the previous password.  Because a one-way hash is used it is
      impossible to generate future one-time passwords if a successfully
      used password is captured; the iteration count is decremented after
      each successful login to keep the user and the login program in
      sync.  When the iteration count gets down to 1, OPIE must be
      reinitialized.</p><p>There are a few programs involved in each system
      which we will discuss below.  The
      <code class="command">opiekey</code> program accepts an iteration
      count, a seed, and a secret password, and generates a one-time
      password or a consecutive list of one-time passwords.  The
      <code class="command">opiepasswd</code>
      program is used to initialize OPIE,
      and to change passwords, iteration counts, or seeds; it
      takes either a secret passphrase, or an iteration count,
      seed, and a one-time password.  The
      <code class="command">opieinfo</code> program will examine the
      relevant credentials files
      (<code class="filename">/etc/opiekeys</code>) and print out the invoking user's
      current iteration count and seed.</p><p>There are four different sorts of operations we will cover.  The
      first is using
      <code class="command">opiepasswd</code> over a secure connection to set up
      one-time-passwords for the first time,  or to change your password
      or seed.  The second operation is using
      <code class="command">opiepasswd</code> over an insecure connection, in
      conjunction with <code class="command">opiekey</code>
      over a secure connection,  to do the same.  The third is using
      <code class="command">opiekey</code> to log in over
      an insecure connection.  The fourth is using
      <code class="command">opiekey</code> to generate a number of keys which
      can be written down or printed out to carry with you when going to
      some location without secure connections to anywhere.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87542864"></a>15.5.1. Secure Connection Initialization</h3></div></div></div><p>To initialize OPIE for the first time, execute the
        <code class="command">opiepasswd</code> command:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiepasswd -c</code></strong>
[grimreaper] ~ $ opiepasswd -f -c
Adding unfurl:
Only use this method from the console; NEVER from remote. If you are using
telnet, xterm, or a dial-in, type ^C now or exit with no password.
Then run opiepasswd without the -c parameter.
Using MD5 to compute responses.
Enter new secret pass phrase:
Again new secret pass phrase:
ID unfurl OTP key is 499 to4268
MOS MALL GOAT ARM AVID COED
</pre><p>At the <code class="prompt">Enter new secret pass phrase:</code> or
        <code class="prompt">Enter secret password:</code> prompts, you
	should enter a password or phrase.  Remember, this is not the
	password that you will use to login with, this is used to generate
	your one-time login keys.  The <span class="quote">«<span class="quote">ID</span>»</span> line gives the
	parameters of your particular instance: your login name, the
        iteration count, and seed.  When logging in the system
	will remember these parameters and present them back to you so you
	do not have to remember them.  The last line gives the particular
	one-time password which corresponds to those parameters and your
	secret password; if you were to re-login immediately, this
	one-time password is the one you would use.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87555280"></a>15.5.2. Insecure Connection Initialization</h3></div></div></div><p>To initialize or change your secret password over an
	insecure connection, you will need to already have a secure
	connection to some place where you can run
        <code class="command">opiekey</code>; this might be in the form of a shell
	prompt on a machine you
	trust.  You will also need to make up an iteration count (100 is
	probably a good value), and you may make up your own seed or use a
	randomly-generated one.  Over on the insecure connection (to the
	machine you are initializing), use <code class="command">opiepasswd</code>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiepasswd</code></strong>

Updating unfurl:
You need the response from an OTP generator.
Old secret pass phrase:
        otp-md5 498 to4268 ext
        Response: GAME GAG WELT OUT DOWN CHAT
New secret pass phrase:
        otp-md5 499 to4269
        Response: LINE PAP MILK NELL BUOY TROY

ID mark OTP key is 499 gr4269
LINE PAP MILK NELL BUOY TROY
</pre><p>To accept the default seed press <span class="keycap"><strong>Return</strong></span>.
	Then before entering an
	access password, move over to your secure connection and give it
	the same parameters:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiekey 498 to4268</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Don't use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT
</pre><p>Now switch back over to the insecure connection, and copy the
	one-time password generated over to the relevant program.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87560784"></a>15.5.3. Generating a Single One-time Password</h3></div></div></div><p>Once you have initialized OPIE and login, you will be
	presented with a prompt like this:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>telnet example.com</code></strong>
Trying 10.0.0.1...
Connected to example.com
Escape character is '^]'.

FreeBSD/i386 (example.com) (ttypa)

login: <strong class="userinput"><code>&lt;username&gt;</code></strong>
otp-md5 498 gr4269 ext
Password: </pre><p>As a side note, the OPIE prompts have a useful feature
	(not shown here): if you press <span class="keycap"><strong>Return</strong></span>
	at the password prompt, the
	prompter will turn echo on, so you can see what you are
	typing.  This can be extremely useful if you are attempting to
	type in a password by hand, such as from a printout.</p><a id="idp87564112" class="indexterm"></a><a id="idp87564624" class="indexterm"></a><a id="idp87565136" class="indexterm"></a><p>At this point you need to generate your one-time password to
	answer this login prompt.  This must be done on a trusted system
	that you can run
        <code class="command">opiekey</code> on.  (There are versions of these for DOS,
	<span class="trademark">Windows</span>(R) and <span class="trademark">Mac OS</span>(R) as well.) They need the iteration count and
	the seed as command line options.  You can cut-and-paste these
        right from the login prompt on the machine that you are logging
        in to.</p><p>On the trusted system:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiekey 498 to4268</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Don't use opiekey from telnet or dial-in sessions.
Enter secret pass phrase:
GAME GAG WELT OUT DOWN CHAT</pre><p>Now that you have your one-time password you can continue
	logging in.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87569488"></a>15.5.4. Generating Multiple One-time Passwords</h3></div></div></div><p>Sometimes you have to go places where you do not have
	access to a trusted machine or secure connection.  In this case,
	it is possible to use the
	<code class="command">opiekey</code> command to
	generate a number of one-time passwords beforehand to be printed
	out and taken with you.  For example:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>opiekey -n 5 30 zz99999</code></strong>
Using the MD5 algorithm to compute response.
Reminder: Don't use opiekey from telnet or dial-in sessions.
Enter secret pass phrase: <strong class="userinput"><code>&lt;secret password&gt;</code></strong>
26: JOAN BORE FOSS DES NAY QUIT
27: LATE BIAS SLAY FOLK MUCH TRIG
28: SALT TIN ANTI LOON NEAL USE
29: RIO ODIN GO BYE FURY TIC
30: GREW JIVE SAN GIRD BOIL PHI</pre><p>The <code class="option">-n 5</code> requests five keys in sequence, the
	<code class="option">30</code> specifies what the last iteration number
	should be.  Note that these are printed out in
	<span class="emphasis"><em>reverse</em></span> order of eventual use.  If you are
	really paranoid, you might want to write the results down by hand;
	otherwise you can cut-and-paste into <code class="command">lpr</code>.  Note
	that each line shows both the iteration count and the one-time
	password; you may still find it handy to scratch off passwords as
	you use them.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87574480"></a>15.5.5. Restricting Use of <span class="trademark">UNIX</span>(R) Passwords</h3></div></div></div><p>OPIE can restrict the use of <span class="trademark">UNIX</span>(R) passwords based on the IP
	address of a login session.  The relevant file
	is <code class="filename">/etc/opieaccess</code>, which is present by default.
	Please check <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=opieaccess&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">opieaccess</span>(5)</span></a>
	for more information on this file and which security considerations
	you should be aware of when using it.</p><p>Here is a sample <code class="filename">opieaccess</code> file:</p><pre class="programlisting">permit 192.168.0.0 255.255.0.0</pre><p>This line allows users whose IP source address (which is
	vulnerable to spoofing) matches the specified value and mask,
	to use <span class="trademark">UNIX</span>(R) passwords at any time.</p><p>If no rules in <code class="filename">opieaccess</code> are matched,
	the default is to deny non-OPIE logins.</p></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp87531600" class="footnote"><p><a href="#idp87531600" class="para"><sup class="para">[8] </sup></a>Under FreeBSD the standard login
      password may be up to 128 characters in length.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="crypt.html">Προηγ</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Πάνω</a></td><td width="40%" align="right"> <a accesskey="n" href="tcpwrappers.html">Επόμενο</a></td></tr><tr><td width="40%" align="left" valign="top">15.4. DES, MD5, and Crypt </td><td width="20%" align="center"><a accesskey="h" href="index.html">Αρχή</a></td><td width="40%" align="right" valign="top"> 15.6. TCP Wrappers</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Αυτό το κείμενο, και άλλα κείμενα, μπορεί να βρεθεί στο
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Για ερωτήσεις σχετικά με το FreeBSD, διαβάστε την
    <a href="http://www.FreeBSD.org/docs.html">τεκμηρίωση</a> πριν να επικοινωνήσετε με την
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Για ερωτήσεις σχετικά με αυτή την τεκμηρίωση, στείλτε e-mail στην
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>