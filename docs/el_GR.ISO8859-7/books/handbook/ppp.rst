=======================================
27.3. ??????????????? ?? PPP ??? ??????
=======================================

.. raw:: html

   <div class="navheader">

27.3. ??????????????? ?? PPP ??? ??????
`????? <userppp.html>`__?
???????? 27. PPP ??? SLIP
?\ `??????? <ppp-troubleshoot.html>`__

--------------

.. raw:: html

   </div>

.. raw:: html

   <div class="sect1">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

27.3. ??????????????? ?? PPP ??? ??????
---------------------------------------

.. raw:: html

   </div>

.. raw:: html

   <div>

?????? ??????? ??????????? ??? ?????? ?????????? ??? Gennady B.
Sorokopud ??? Robert Huff.

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="warning" xmlns="">

?????????????:
~~~~~~~~~~~~~~

? ??????? ???? ????? ?????? ??? ?????? ?? ?????????? ???? ?? ?????????
FreeBSD?7.X.

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

27.3.1. ??????????? ?? PPP ??? ??????
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

???? ?????????? ?? ????????? ?? PPP ??? ???????? ???, ??????????? ??? ??
``pppd`` ????????? ???? ???????? ``/usr/sbin`` ??? ??? ??????? ?
????????? ``/etc/ppp``.

?? ``pppd`` ???? ??? ??????????? ???????????:

.. raw:: html

   <div class="orderedlist">

#. ?? ??????? (?client?) - ???? ?????? ?? ????????? ?? ???????? ??? ??
   ??? ??? ????? ???? ????????? ???????? ???????? ? ??????? modem.

#. ?? ???????????? (?server?) - ?? ???????? ??? ????? ????????? ???
   ?????? ??? ??????????????? ??? ?? ???????? ?????? ???????????,
   ??????????????? ?? PPP.

.. raw:: html

   </div>

??? ???? ??? ??????????? ?? ????????? ?? ????????????? ??? ??????
???????? (``/etc/ppp/options`` ? ``~/.ppprc`` ?? ??? ???????? ???
???????? ???????????? ??? ???? ??????? ??? ????????????? ?? PPP).

?? ??????????? ?????? ??? ?????? ????????? ??? ????? ?? modem ???
????????? ????????? (???? ????????? ??
`comms/kermit <http://www.freebsd.org/cgi/url.cgi?ports/comms/kermit/pkg-descr>`__),
???? ?? ???????? ?? ???????? ??? ?? ?????????????? ?? ??????? ?? ???
????????????? ???????????.

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

27.3.2. ??????????????? ?? ``pppd`` ?? ???????
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   <div>

????????? ?? ??????????? ??? ??????? ? Trev Roydhouse.

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

???????? ?? ??????????????? ?? ``/etc/ppp/options`` ??? ????????
????????, ??? ?? ?????????? ?? ??? ?????? PPP ???? ???????????
?????????? (terminal server) ??? Cisco.

.. code:: programlisting

    crtscts         # enable hardware flow control
    modem           # modem control line
    noipdefault     # remote PPP server must supply your IP address
                    # if the remote host does not send your IP during IPCP
                    # negotiation, remove this option
    passive         # wait for LCP packets
    domain ppp.foo.com      # put your domain name here

    :remote_ip    # put the IP of remote PPP host here
                    # it will be used to route packets via PPP link
                    # if you didn't specified the noipdefault option
                    # change this line to local_ip:remote_ip

    defaultroute    # put this if you want that PPP server will be your
                    # default router

??? ?? ??????????:

.. raw:: html

   <div class="procedure">

#. ??????? ??? ????????????? ??????????? ??????????????? ?? Kermit (?
   ?????? ???? ????????? ??? modem) ??? ???????? ?? ????? ?????? ??? ???
   ?????? ??? (? ??? ???? ?????????? ??? ?? ?????????????? ?? PPP ????
   ????????????? ??????????).

#. ?????? ??? ?? Kermit (????? ?? ???????? ?? ??????).

#. ?????????????? ?? ????????:

   .. code:: screen

       # /usr/sbin/pppd /dev/tty01 19200

   ??????????? ??? ?????????????? ?? ????? ????? ???????? ??? ???
   ????????? ????????.

.. raw:: html

   </div>

? ??????????? ??? ????? ???? ?????????? ???? PPP. ?? ? ??????? ????????,
???????? ?? ??????????????? ??? ??????? ``debug`` ??? ??????
``/etc/ppp/options`` ??? ?? ???????? ?? ???????? ???? ??????? ??? ??
??????????? ?? ????????.

?? ???????? script ``/etc/ppp/pppup`` ????????????? ??? ?? 3 ??????:

.. code:: programlisting

    #!/bin/sh
    pgrep -l pppd
    pid=`pgrep pppd`
    if [ "X${pid}" != "X" ] ; then
            echo 'killing pppd, PID=' ${pid}
            kill ${pid}
    fi
    pgrep -l kermit
    pid=`pgrep kermit`
    if [ "X${pid}" != "X" ] ; then
            echo 'killing kermit, PID=' ${pid}
            kill -9 ${pid}
    fi

    ifconfig ppp0 down
    ifconfig ppp0 delete

    kermit -y /etc/ppp/kermit.dial
    pppd /dev/tty01 19200

?? ?????? ``/etc/ppp/kermit.dial`` ????? ??? script ??? ?? Kermit ??
????? ????? ??? ????? ??? ??? ??????????? ??? ?????? ???? ?????????????
?????????? (??? ????? ????? ??? ????????, ?? ?????? ??? ?????????? ???
??? ?????? script).

?????????????? ?? ???????? script ``/etc/ppp/pppdown`` ??? ??
???????????? ??? ?????? PPP:

.. code:: programlisting

    #!/bin/sh
    pid=`pgrep pppd`
    if [ X${pid} != "X" ] ; then
            echo 'killing pppd, PID=' ${pid}
            kill -TERM ${pid}
    fi

    pgrep -l kermit
    pid=`pgrep kermit`
    if [ "X${pid}" != "X" ] ; then
            echo 'killing kermit, PID=' ${pid}
            kill -9 ${pid}
    fi

    /sbin/ifconfig ppp0 down
    /sbin/ifconfig ppp0 delete
    kermit -y /etc/ppp/kermit.hup
    /etc/ppp/ppptest

??????? ?? ?????????? ????? ?? ``pppd``, ?????????? ??
``/usr/etc/ppp/ppptest``, ?? ????? ?? ??????? ?? ?? ????????:

.. code:: programlisting

    #!/bin/sh
    pid=`pgrep pppd`
    if [ X${pid} != "X" ] ; then
            echo 'pppd running: PID=' ${pid-NONE}
    else
            echo 'No pppd running.'
    fi
    set -x
    netstat -n -I ppp0
    ifconfig ppp0

??? ?? ???????? ??? ??????, ????????? ?? ``/etc/ppp/kermit.hup``, ??
????? ?? ?????? ?? ????????:

.. code:: programlisting

    set line /dev/tty01    ; put your modem device here
    set speed 19200
    set file type binary
    set file names literal
    set win 8
    set rec pack 1024
    set send pack 1024
    set block 3
    set term bytesize 8
    set command bytesize 8
    set flow none

    pau 1
    out +++
    inp 5 OK
    out ATH0\13
    echo \13
    exit

??? ??????????? ??????? ??? ???????????? ?? ``chat`` ???? ??? ??
``kermit``:

?? ???????? ??? ?????? ???????? ??? ?? ?????????? ???? ????????
``pppd``.

``/etc/ppp/options``:

.. code:: programlisting

    /dev/cuad1 115200

    crtscts     # enable hardware flow control
    modem       # modem control line
    connect "/usr/bin/chat -f /etc/ppp/login.chat.script"
    noipdefault # remote PPP serve must supply your IP address
                # if the remote host doesn't send your IP during
                    # IPCP negotiation, remove this option
    passive         # wait for LCP packets
    domain your.domain    # put your domain name here

    :       # put the IP of remote PPP host here
                # it will be used to route packets via PPP link
                    # if you didn't specified the noipdefault option
                    # change this line to local_ip:remote_ip

    defaultroute    # put this if you want that PPP server will be
                # your default router

``/etc/ppp/login.chat.script``:

.. raw:: html

   <div class="note" xmlns="">

????????:
~~~~~~~~~

?? ???????? ?? ?????? ?? ?????? ?? ??? ???? ??????.

.. raw:: html

   </div>

.. code:: programlisting

    ABORT BUSY ABORT 'NO CARRIER' "" AT OK ATDTphone.number
      CONNECT "" TIMEOUT 10 ogin:-\\r-ogin: login-id
      TIMEOUT 5 sword: password

????? ????????????? ??? ????????????? ????? ?? ???????? ??????, ?? ????
??? ?????????? ?? ?????? ????? ?? ?????????? ??? ?????? ``pppd``, ?? ???
????? ??? ???????? ????????:

.. code:: screen

    # pppd

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

27.3.3. ??????????????? ?? ``pppd`` ?? ???????????
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ``/etc/ppp/options`` ?? ?????? ?? ???????? ???? ?????????? ?? ??
????????:

.. code:: programlisting

    crtscts                         # Hardware flow control
    netmask 255.255.255.0           # netmask (not required)
    192.114.208.20:192.114.208.165  # IP's of local and remote hosts
                                    # local ip must be different from one
                                    # you assigned to the Ethernet (or other)
                                    # interface on your machine.
                                    # remote IP is IP address that will be
                                    # assigned to the remote machine
    domain ppp.foo.com              # your domain
    passive                         # wait for LCP
    modem                           # modem line

?? script ``/etc/ppp/pppserv`` ??? ???????? ????????, ?? ??? ??? pppd ??
???????????? ?? ????????????:

.. code:: programlisting

    #!/bin/sh
    pgrep -l pppd
    pid=`pgrep pppd`
    if [ "X${pid}" != "X" ] ; then
            echo 'killing pppd, PID=' ${pid}
            kill ${pid}
    fi
    pgrep -l kermit
    pid=`pgrep kermit`
    if [ "X${pid}" != "X" ] ; then
            echo 'killing kermit, PID=' ${pid}
            kill -9 ${pid}
    fi

    # reset ppp interface
    ifconfig ppp0 down
    ifconfig ppp0 delete

    # enable autoanswer mode
    kermit -y /etc/ppp/kermit.ans

    # run ppp
    pppd /dev/tty01 19200

?????????????? ?? ???????? script ``/etc/ppp/pppservdown`` ??? ??
??????????? ??? ???????????:

.. code:: programlisting

    #!/bin/sh
    pgrep -l pppd
    pid=`pgrep pppd`
    if [ "X${pid}" != "X" ] ; then
            echo 'killing pppd, PID=' ${pid}
            kill ${pid}
    fi
    pgrep -l kermit
    pid=`pgrep kermit`
    if [ "X${pid}" != "X" ] ; then
            echo 'killing kermit, PID=' ${pid}
            kill -9 ${pid}
    fi
    ifconfig ppp0 down
    ifconfig ppp0 delete

    kermit -y /etc/ppp/kermit.noans

?? ???????? script ??? ?? Kermit (``/etc/ppp/kermit.ans``) ?????? ??
??????????? ??? ?? ????????????? ??? ?????????? ????????? ????????? ???
modem ???.

.. code:: programlisting

    set line /dev/tty01
    set speed 19200
    set file type binary
    set file names literal
    set win 8
    set rec pack 1024
    set send pack 1024
    set block 3
    set term bytesize 8
    set command bytesize 8
    set flow none

    pau 1
    out +++
    inp 5 OK
    out ATH0\13
    inp 5 OK
    echo \13
    out ATS0=1\13   ; change this to out ATS0=0\13 if you want to disable
                    ; autoanswer mode
    inp 5 OK
    echo \13
    exit

???? ????????????? ??????????, ??????????????? ?? script
``/etc/ppp/kermit.dial`` ??? ????? ??? ??????????? ??? ??????. ?? ??????
?? ?? ????????????? ??????? ?? ??? ??????? ???. ????? ?? ????? ??????
??? ??? ?????? ??? ?? ???? ?? script. ?? ????????? ?????? ?? ????????
??? ?????? ??? ??? ?????? (input) ??????? ?? ??? ?????????? ??? ????? ??
modem ??? ??? ? ?????????????? ???????????.

.. code:: programlisting

    ;
    ; put the com line attached to the modem here:
    ;
    set line /dev/tty01
    ;
    ; put the modem speed here:
    ;
    set speed 19200
    set file type binary            ; full 8 bit file xfer
    set file names literal
    set win 8
    set rec pack 1024
    set send pack 1024
    set block 3
    set term bytesize 8
    set command bytesize 8
    set flow none
    set modem hayes
    set dial hangup off
    set carrier auto                ; Then SET CARRIER if necessary,
    set dial display on             ; Then SET DIAL if necessary,
    set input echo on
    set input timeout proceed
    set input case ignore
    def \%x 0                       ; login prompt counter
    goto slhup

    :slcmd                          ; put the modem in command mode
    echo Put the modem in command mode.
    clear                           ; Clear unread characters from input buffer
    pause 1
    output +++                      ; hayes escape sequence
    input 1 OK\13\10                ; wait for OK
    if success goto slhup
    output \13
    pause 1
    output at\13
    input 1 OK\13\10
    if fail goto slcmd              ; if modem doesn't answer OK, try again

    :slhup                          ; hang up the phone
    clear                           ; Clear unread characters from input buffer
    pause 1
    echo Hanging up the phone.
    output ath0\13                  ; hayes command for on hook
    input 2 OK\13\10
    if fail goto slcmd              ; if no OK answer, put modem in command mode

    :sldial                         ; dial the number
    pause 1
    echo Dialing.
    output atdt9,550311\13\10               ; put phone number here
    assign \%x 0                    ; zero the time counter

    :look
    clear                           ; Clear unread characters from input buffer
    increment \%x                   ; Count the seconds
    input 1 {CONNECT }
    if success goto sllogin
    reinput 1 {NO CARRIER\13\10}
    if success goto sldial
    reinput 1 {NO DIALTONE\13\10}
    if success goto slnodial
    reinput 1 {\255}
    if success goto slhup
    reinput 1 {\127}
    if success goto slhup
    if < \%x 60 goto look
    else goto slhup

    :sllogin                        ; login
    assign \%x 0                    ; zero the time counter
    pause 1
    echo Looking for login prompt.

    :slloop
    increment \%x                   ; Count the seconds
    clear                           ; Clear unread characters from input buffer
    output \13
    ;
    ; put your expected login prompt here:
    ;
    input 1 {Username: }
    if success goto sluid
    reinput 1 {\255}
    if success goto slhup
    reinput 1 {\127}
    if success goto slhup
    if < \%x 10 goto slloop         ; try 10 times to get a login prompt
    else goto slhup                 ; hang up and start again if 10 failures

    :sluid
    ;
    ; put your userid here:
    ;
    output ppp-login\13
    input 1 {Password: }
    ;
    ; put your password here:
    ;
    output ppp-password\13
    input 1 {Entering SLIP mode.}
    echo
    quit

    :slnodial
    echo \7No dialtone.  Check the telephone line!\7
    exit 1

    ; local variables:
    ; mode: csh
    ; comment-start: "; "
    ; comment-start-skip: "; "
    ; end:

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="navfooter">

--------------

+----------------------------------------+--------------------------------+----------------------------------------------------+
| `????? <userppp.html>`__?              | `???? <ppp-and-slip.html>`__   | ?\ `??????? <ppp-troubleshoot.html>`__             |
+----------------------------------------+--------------------------------+----------------------------------------------------+
| 27.2. ??????????????? ?? PPP ???????   | `???? <index.html>`__          | ?27.4. ???????????? ??????????? ?? ????????? PPP   |
+----------------------------------------+--------------------------------+----------------------------------------------------+

.. raw:: html

   </div>

???? ?? ???????, ??? ???? ???????, ?????? ?? ?????? ???
ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/

| ??? ????????? ??????? ?? ?? FreeBSD, ???????? ???
  `?????????? <http://www.FreeBSD.org/docs.html>`__ ???? ??
  ?????????????? ?? ??? <questions@FreeBSD.org\ >.
|  ??? ????????? ??????? ?? ???? ??? ??????????, ??????? e-mail ????
  <doc@FreeBSD.org\ >.
