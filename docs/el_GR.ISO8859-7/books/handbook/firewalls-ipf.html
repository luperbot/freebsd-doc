<?xml version="1.0" encoding="iso-8859-7" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-7" /><title>30.5. Το IPFILTER (IPF) Firewall</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Εγχειρίδιο του FreeBSD" /><link rel="up" href="firewalls.html" title="Κεφάλαιο 30. Firewalls" /><link rel="prev" href="firewalls-pf.html" title="30.4. Το Packet Filter (PF) και το ALTQ του OpenBSD" /><link rel="next" href="firewalls-ipfw.html" title="30.6. IPFW" /><link rel="copyright" href="legalnotice.html" title="Νομική Σημείωση" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">30.5. Το IPFILTER (IPF) Firewall</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="firewalls-pf.html">Προηγ</a> </td><th width="60%" align="center">Κεφάλαιο 30. Firewalls</th><td width="20%" align="right"> <a accesskey="n" href="firewalls-ipfw.html">Επόμενο</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="firewalls-ipf"></a>30.5. Το IPFILTER (IPF) Firewall</h2></div></div></div><a id="idp98959696" class="indexterm"></a><p>Ο συγγραφέας του IPFILTER είναι ο Darren Reed.  Το IPFILTER δεν
      εξαρτάται από το λειτουργικό σύστημα: είναι μια εφαρμογή ανοικτού
      κώδικα που έχει μεταφερθεί στο FreeBSD, το NetBSD, το OpenBSD, το
      <span class="trademark">SunOS</span>TM, το HP/UX και το <span class="trademark">Solaris</span>TM.  Το IPFILTER είναι υπό διαρκή
      και ενεργή ανάπτυξη και συντήρηση, και κυκλοφορούν τακτικά οι νέες
      εκδόσεις του.</p><p>Το IPFILTER είναι ένα firewall και μηχανισμός
      <acronym class="acronym">NAT</acronym> που λειτουργεί στον πυρήνα και μπορεί να
      ελέγχεται και να παρακολουθείται από προγράμματα χρήστη.  Οι κανόνες
      του firewall μπορούν να τίθενται σε ισχύ ή να διαγράφονται μέσω του
      βοηθητικού προγράμματος <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a>.  Οι κανόνες για το
      <acronym class="acronym">NAT</acronym> μπορούν να τίθενται σε ισχύ ή να διαγράφονται
      μέσω του βοηθητικού προγράμματος <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipnat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ipnat</span>(1)</span></a>.  Το βοηθητικό πρόγραμμα
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a> μπορεί να εκτυπώσει στατιστικά εκτέλεσης για το τμήμα
      του IPFILTER που εκτελείται στον πυρήνα.  Το πρόγραμμα <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipmon&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipmon</span>(8)</span></a>
      μπορεί να καταγράψει τις ενέργειες του IPFILTER στο αρχεία καταγραφής
      συμβάντων του συστήματος.</p><p>Το IPF γράφηκε αρχικά χρησιμοποιώντας μια λογική επεξεργασίας
      κανόνων του τύπου <span class="quote">«<span class="quote">ο τελευταίο κανόνας που ταιριάζει, είναι και
      ο νικητής</span>»</span> και χρησιμοποιούσε μόνο κανόνες τύπου stateless.
      Με την πάροδο του χρόνου, το IPF βελτιώθηκε για να περιλαμβάνει την
      επιλογή <span class="quote">«<span class="quote">quick</span>»</span> και την επιλογή <span class="quote">«<span class="quote">keep state</span>»</span>
      για stateful κανόνες.  Οι επιλογές αυτές εκσυγχρόνισαν δραματικά τη
      λογική επεξεργασίας των κανόνων.  Η επίσημη τεκμηρίωση του IPF καλύπτει
      μόνο τις παλιές παραμέτρους ρύθμισης και επεξεργασίας των κανόνων.
      Οι σύγχρονες λειτουργίες καλύπτονται μόνο ως πρόσθετες επιλογές, και
      έτσι δεν τονίζονται αρκετά τα πλεονεκτήματα τους στη δημιουργία ενός
      πολύ καλύτερου και ασφαλέστερου firewall.</p><p>Οι οδηγίες που περιέχονται σε αυτή την ενότητα, βασίζονται στη
      χρήση κανόνων που περιέχουν την επιλογή <span class="quote">«<span class="quote">quick</span>»</span> καθώς και
      την stateful επιλογή <span class="quote">«<span class="quote">keep state</span>»</span>.  Αυτό είναι και το
      βασικό πλαίσιο λειτουργιών για την δημιουργία του σετ κανόνων ενός
      inclusive firewall.</p><p>Για λεπτομέρειες σχετικά με τον παλιότερο τρόπο επεξεργασίας των
      κανόνων, δείτε: <code class="uri"><a class="uri" href="http://www.obfuscation.org/ipf/ipf-howto.html#TOC_1" target="_top">http://www.obfuscation.org/ipf/ipf-howto.html#TOC_1</a></code>
      και <code class="uri"><a class="uri" href="http://coombs.anu.edu.au/~avalon/ip-filter.html" target="_top">http://coombs.anu.edu.au/~avalon/ip-filter.html</a></code>.</p><p>Μπορείτε να δείτε το IPF FAQ στην τοποθεσία <code class="uri"><a class="uri" href="http://www.phildev.net/ipf/index.html" target="_top">http://www.phildev.net/ipf/index.html</a></code>.</p><p>Μπορείτε να βρείτε τις παλαιότερες δημοσιεύσεις τις λίστας
      ταχυδρομείου του IPFILTER στο <code class="uri"><a class="uri" href="http://marc.theaimsgroup.com/?l=ipfilter" target="_top">http://marc.theaimsgroup.com/?l=ipfilter</a></code>.  Παρέχεται
      δυνατότητα αναζήτησης.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98980688"></a>30.5.1. Ενεργοποιώντας το IPF</h3></div></div></div><a id="idp98981328" class="indexterm"></a><p>Το IPF περιλαμβάνεται στη βασική εγκατάσταση του FreeBSD ως άρθρωμα
	το οποίο μπορεί να φορτωθεί χωριστά.  Το σύστημα θα φορτώσει δυναμικά
	το άρθρωμα του IPF αν υπάρχει η καταχώριση
	<code class="literal">ipfilter_enable="YES"</code> στο αρχείο
	<code class="filename">/etc/rc.conf</code>.  Το άρθρωμα έχει δημιουργηθεί με
	ενεργοποιημένη την δυνατότητα καταγραφής και με την επιλογή
	<code class="literal">default pass all</code>.  Για να αλλάξετε αυτή την
	προεπιλογή σε <code class="literal">block all</code>, μπορείτε απλώς να
	προσθέσετε τον κανόνα απόρριψης (block all) στο τέλος των κανόνων σας.
	Δεν χρειάζεται να μεταγλωττίσετε την επιλογή IPF στο πυρήνα του FreeBSD
	για το σκοπό αυτό.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98984656"></a>30.5.2. Επιλογές για τον Πυρήνα</h3></div></div></div><a id="idp98985296" class="indexterm"></a><a id="idp98986448" class="indexterm"></a><a id="idp98987600" class="indexterm"></a><a id="idp98988752" class="indexterm"></a><p>Δεν είναι υποχρεωτικό να μεταγλωττίσετε τις παρακάτω επιλογές στον
	πυρήνα του FreeBSD για να ενεργοποιήσετε το IPF.  Η παρουσίαση τους εδώ
	είναι καθαρά ενημερωτική.  Αν μεταγλωττίσετε το IPF απευθείας
	στον πυρήνα, δεν θα χρησιμοποιηθεί ποτέ το αντίστοιχο άρθρωμα.</p><p>Στο αρχείο <code class="filename">/usr/src/sys/conf/NOTES</code> θα βρείτε
	παραδείγματα καταχωρίσεων IPF για το αρχείο ρύθμισης του πυρήνα.  Οι
	επιλογές αυτές φαίνονται επίσης παρακάτω:</p><pre class="programlisting">options IPFILTER
options IPFILTER_LOG
options IPFILTER_DEFAULT_BLOCK</pre><p>Η επιλογή <code class="literal">options IPFILTER</code> ενεργοποιεί την
	υποστήριξη για το <span class="quote">«<span class="quote">IPFILTER</span>»</span> firewall.</p><p>Η επιλογή <code class="literal">options IPFILTER_LOG</code> ενεργοποιεί την
	υποστήριξη καταγραφής του IPF, η οποία γράφει στην ψευδο-συσκευή
	καταγραφής πακέτων <code class="filename">ipl</code> για κάθε κανόνα που
	περιλαμβάνει την επιλογή <code class="literal">log</code>.</p><p>Η επιλογή <code class="literal">options IPFILTER_DEFAULT_BLOCK</code>
	αλλάζει την προεπιλεγμένη συμπεριφορά, ώστε κάθε πακέτο που δεν
	ταιριάζει με κάποιο κανόνα <code class="literal">pass</code> του firewall,
	να απορρίπτεται αυτόματα.</p><p>Οι παραπάνω επιλογές θα ενεργοποιηθούν μόνο αφού μεταγλωττίσετε
	και εγκαταστήσετε ένα προσαρμοσμένο πυρήνα που να τις
	περιλαμβάνει.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98995920"></a>30.5.3. Διαθέσιμες Επιλογές για το <code class="filename">rc.conf</code></h3></div></div></div><p>Χρειάζεστε τις παρακάτω καταχωρίσεις στο
	<code class="filename">/etc/rc.conf</code> για να ενεργοποιήσετε το IPF κατά
	την εκκίνηση του υπολογιστή:</p><pre class="programlisting">ipfilter_enable="YES"             # Start ipf firewall
ipfilter_rules="/etc/ipf.rules"   # loads rules definition text file
ipmon_enable="YES"                # Start IP monitor log
ipmon_flags="-Ds"                 # D = start as daemon
                                  # s = log to syslog
                                  # v = log tcp window, ack, seq
                                  # n = map IP &amp; port to names</pre><p>Αν πίσω από αυτό το firewall υπάρχει κάποιο LAN που χρησιμοποιεί
	δεσμευμένες ιδιωτικές διευθύνσεις, θα χρειαστεί να προσθέσετε τις
	παρακάτω καταχωρίσεις για να ενεργοποιήσετε τη λειτουργία
	<acronym class="acronym">NAT</acronym>:</p><pre class="programlisting">gateway_enable="YES"              # Enable as LAN gateway
ipnat_enable="YES"                # Start ipnat function
ipnat_rules="/etc/ipnat.rules"    # rules definition file for ipnat</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp98999248"></a>30.5.4. IPF</h3></div></div></div><a id="idp98999888" class="indexterm"></a><p>Η εντολή <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a> χρησιμοποιείται για να φορτώσει το αρχείο
	των κανόνων.  Φυσιολογικά, θα δημιουργήσετε ένα αρχείο με τους δικούς
	σας προσαρμοσμένους κανόνες και θα αντικαταστήσετε με αυτό
	εξ'ολοκλήρου τους ενσωματωμένους κανόνες του firewall:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipf -Fa -f /etc/ipf.rules</code></strong></pre><p>Η επιλογή <code class="option">-Fa</code> αδειάζει τους κανόνες από τους
	εσωτερικούς πίνακες του firewall.</p><p>Η επιλογή <code class="option">-f</code> καθορίζει το αρχείο των κανόνων που
	θα φορτωθεί.</p><p>Αυτό σας δίνει την δυνατότητα να αλλάξετε το αρχείο κανόνων σας,
	να εκτελέσετε την εντολή IPF που αναφέραμε παραπάνω, και
	να ανανεώσετε με αυτό τον τρόπο τους κανόνες στο firewall που
	εκτελείται ήδη με καινούργιους, χωρίς να χρειαστεί να επανεκκινήσετε
	το σύστημα σας.  Η μέθοδος αυτή είναι πολύ βολική για να δοκιμάσετε
	νέους κανόνες, καθώς μπορεί να επαναληφθεί όσες φορές θέλετε.</p><p>Δείτε τη σελίδα manual του <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a> για λεπτομέρειες σχετικά με
	τις υπόλοιπες επιλογές που μπορείτε να χρησιμοποιήσετε με την εντολή
	αυτή.</p><p>Η εντολή <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a> αναμένει ένα απλό αρχείο κειμένου ως αρχείο
	κανόνων.  Δεν θα δεχθεί αρχείο κανόνων γραμμένο ως script με
	συμβολικές αντικαταστάσεις.</p><p>Υπάρχει ωστόσο τρόπος να γράψετε κανόνες IPF που να χρησιμοποιούν
	την ισχύ των συμβολικών αντικαταστάσεων.  Για περισσότερες
	πληροφορίες, δείτε το
	<a class="xref" href="firewalls-ipf.html#firewalls-ipf-rules-script" title="30.5.9. Δημιουργία Script Κανόνων με Συμβολική Υποκατάσταση">Τμήμα 30.5.9, «Δημιουργία Script Κανόνων με Συμβολική Υποκατάσταση»</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99011920"></a>30.5.5. IPFSTAT</h3></div></div></div><a id="idp99012560" class="indexterm"></a><a id="idp99025616" class="indexterm"></a><p>Η προεπιλεγμένη συμπεριφορά του <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a> είναι να ανακτά
	και να απεικονίζει το σύνολο των στατιστικών που συγκεντρώθηκαν ως
	αποτέλεσμα της εφαρμογής των κανόνων του χρήστη στα πακέτα που
	εισέρχονται και εξέρχονται από το firewall, από τη στιγμή της
	τελευταίας του εκκίνησης ή από τον τελευταίο τους μηδενισμό μέσω της
	εντολής <code class="command">ipf -Z</code>.</p><p>Δείτε τη σελίδα manual <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a> για λεπτομέρειες.</p><p>Η προεπιλεγμένη έξοδος της εντολής <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a> θα μοιάζει με
	την παρακάτω:</p><pre class="screen">input packets: blocked 99286 passed 1255609 nomatch 14686 counted 0
 output packets: blocked 4200 passed 1284345 nomatch 14687 counted 0
 input packets logged: blocked 99286 passed 0
 output packets logged: blocked 0 passed 0
 packets logged: input 0 output 0
 log failures: input 3898 output 0
 fragment state(in): kept 0 lost 0
 fragment state(out): kept 0 lost 0
 packet state(in): kept 169364 lost 0
 packet state(out): kept 431395 lost 0
 ICMP replies: 0 <acronym class="acronym">TCP</acronym> RSTs sent: 0
 Result cache hits(in): 1215208 (out): 1098963
 IN Pullups succeeded: 2 failed: 0
 OUT Pullups succeeded: 0 failed: 0
 Fastroute successes: 0 failures: 0
 <acronym class="acronym">TCP</acronym> cksum fails(in): 0 (out): 0
 Packet log flags set: (0)</pre><p>Όταν χρησιμοποιηθεί η επιλογή <code class="option">-i</code> για τα
	εισερχόμενα ή η επιλογή <code class="option">-o</code> για τα εξερχόμενα πακέτα,
	η εντολή θα ανακτήσει και θα απεικονίσει την αντίστοιχη λίστα
	κανόνων που είναι εγκατεστημένη και χρησιμοποιείται από τον πυρήνα τη
	δεδομένη στιγμή.</p><p>Η εντολή <code class="command">ipfstat -in</code> δείχνει ένα αριθμημένο
	πίνακα κανόνων για εισερχόμενα πακέτα.</p><p>Η εντολή <code class="command">ipfstat -on</code> δείχνει ένα αριθμημένο
	πίνακα κανόνων για εξερχόμενα πακέτα.</p><p>Η έξοδος θα μοιάζει με την παρακάτω:</p><pre class="screen">@1 pass out on xl0 from any to any
@2 block out on dc0 from any to any
@3 pass out quick on dc0 proto tcp/udp from any to any keep state</pre><p>Η εντολή <code class="command">ipfstat -ih</code> δείχνει τον πίνακα
	κανόνων για τα εισερχόμενα πακέτα, τοποθετώντας μπροστά από τον
	κάθε κανόνα ένα αριθμό που δείχνει πόσες φορές έχει
	χρησιμοποιηθεί.</p><p>Η εντολή <code class="command">ipfstat -oh</code> δείχνει τον πίνακα
	κανόνων για τα εξερχόμενα πακέτα, τοποθετώντας μπροστά από τον
	κάθε κανόνα ένα αριθμό που δείχνει πόσες φορές έχει
	χρησιμοποιηθεί.</p><p>Η έξοδος θα μοιάζει με την παρακάτω:</p><pre class="screen">2451423 pass out on xl0 from any to any
354727 block out on dc0 from any to any
430918 pass out quick on dc0 proto tcp/udp from any to any keep state</pre><p>Μια από τις πιο σημαντικές λειτουργίες της εντολής
	<code class="command">ipfstat</code> είναι η επιλογή <code class="option">-t</code> η
	οποία απεικονίζει τον πίνακα καταστάσεων, με τρόπο όμοιο με αυτό
	που χρησιμοποιεί η εντολή <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a> για να δείξει τον πίνακα
	διεργασιών που εκτελούνται στο FreeBSD.  Όταν το firewall σας δέχεται
	επίθεση, η λειτουργία αυτή σας δίνει την δυνατότητα να αναγνωρίσετε
	και να εστιάσετε στα ίδια τα πακέτα που την αποτελούν.
	Οι προαιρετικές υπο-επιλογές σας δίνουν την δυνατότητα να επιλέξετε
	το IP αφετηρίας ή προορισμού, την θύρα, ή το πρωτόκολλο το οποίο
	θέλετε να παρακολουθήσετε σε πραγματικό χρόνο.  Δείτε τη σελίδα
	manual του <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipfstat&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipfstat</span>(8)</span></a> για περισσότερες λεπτομέρειες.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99073488"></a>30.5.6. IPMON</h3></div></div></div><a id="idp99074128" class="indexterm"></a><a id="idp99095376" class="indexterm"></a><p>Για να λειτουργήσει σωστά η εντολή <code class="command">ipmon</code>,
	θα πρέπει να ενεργοποιηθεί η επιλογή <code class="literal">IPFILTER_LOG</code>
	στον πυρήνα.  Η εντολή αυτή διαθέτει δύο διαφορετικούς τρόπους
	λειτουργίας.  Ο προεπιλεγμένος κανονικός τρόπος λειτουργίας
	ενεργοποιείται όταν η εντολή χρησιμοποιείται χωρίς την επιλογή
	<code class="option">-D</code>.</p><p>Η εντολή μπορεί να χρησιμοποιηθεί σε λειτουργία δαίμονα όταν
	επιθυμείτε να έχετε ένα συνεχόμενο αρχείο καταγραφής ώστε να μπορείτε
	να εξετάσετε τις προηγούμενες εγγραφές.  Αυτός είναι και ο τρόπος με
	τον οποίο έχει ρυθμιστεί να συνεργάζεται το FreeBSD με το IPFILTER.
	Το FreeBSD έχει ενσωματωμένη δυνατότητα εναλλαγής αρχείων καταγραφής.
	Για αυτό το λόγο, είναι καλύτερο η καταγραφή να γίνεται μέσω του
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> παρά σε ένα συνηθισμένο αρχείο.  Από προεπιλογή, η
	ρύθμιση <code class="literal">ipmon_flags</code> στο αρχείο
	<code class="filename">rc.conf</code> χρησιμοποιεί τις επιλογές
	<code class="option">-Ds</code>:</p><pre class="programlisting">ipmon_flags="-Ds" # D = start as daemon
                  # s = log to syslog
                  # v = log tcp window, ack, seq
                  # n = map IP &amp; port to names</pre><p>Τα πλεονεκτήματα της καταγραφής είναι προφανή.  Παρέχει την
	δυνατότητα επισκόπησης πληροφοριών όπως τα πακέτα που απορρίφθηκαν,
	τις διευθύνσεις από τις οποίες λήφθηκαν, και τον προορισμό τους.
	Έχετε έτσι ένα σημαντικό πλεονέκτημα όταν προσπαθείτε να αναγνωρίσετε
	ένα εισβολέα.</p><p>Ακόμα και όταν ενεργοποιήσετε την δυνατότητα καταγραφής, το IPF
	δεν θα καταγράψει τίποτα αν δεν έχει γίνει η αντίστοιχη ρύθμιση στους
	κανόνες.  Ο διαχειριστής του firewall αποφασίζει για ποιους κανόνες
	του σετ θέλει να ενεργοποιήσει την καταγραφή, και προσθέτει σε αυτούς
	την λέξη log.  Φυσιολογικά, η καταγραφή ενεργοποιείται μόνο σε κανόνες
	που απορρίπτουν πακέτα.</p><p>Είναι πολύ συνηθισμένο να περιλαμβάνεται ένας κανόνας στο τέλος
	του συνόλου, που να απορρίπτει από προεπιλογή όλα τα πακέτα που
	φτάνουν μέχρι εκεί (default deny).  Με τον τρόπο αυτό μπορείτε να
	δείτε όλα τα πακέτα που δεν ταίριαξαν με κανένα κανόνα του σετ.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99102032"></a>30.5.7. Καταγραφή του IPMON</h3></div></div></div><p>Το <span class="application">syslogd</span> χρησιμοποιεί τη δική του
	ειδική μέθοδο για το διαχωρισμό των δεδομένων καταγραφής.
	Διαθέτει ειδικές ομαδοποιήσεις που ονομάζονται
	<span class="quote">«<span class="quote">facility</span>»</span> και <span class="quote">«<span class="quote">level</span>»</span>.  Όταν το IPMON
	χρησιμοποιείται με την επιλογή <code class="option">-Ds</code>, χρησιμοποιεί
	από προεπιλογή το <code class="literal">local0</code> ως όνομα
	<span class="quote">«<span class="quote">facility</span>»</span>.  Αν το επιθυμείτε, μπορείτε να
	χρησιμοποιήσετε τα παρακάτω επίπεδα για περαιτέρω διαχωρισμό των
	δεδομένων καταγραφής:</p><pre class="screen">LOG_INFO - packets logged using the "log" keyword as the action rather than pass or block.
LOG_NOTICE - packets logged which are also passed
LOG_WARNING - packets logged which are also blocked
LOG_ERR - packets which have been logged and which can be considered short</pre><p>Για να ρυθμίσετε το IPFILTER να καταγράφει όλα τα δεδομένα στο
	<code class="filename">/var/log/ipfilter.log</code>, θα χρειαστεί να
	δημιουργήσετε από πριν το αρχείο.  Αυτό μπορεί να γίνει με την
	παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>touch /var/log/ipfilter.log</code></strong></pre><p>Η λειτουργία του <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> μπορεί να ρυθμιστεί με
	καταχωρίσεις στο αρχείο <code class="filename">/etc/syslog.conf</code>.
	Το αρχείο <code class="filename">syslog.conf</code> προσφέρει σημαντική
	ευελιξία στον τρόπο με τον οποίο το <span class="application">syslog</span>
	αντιμετωπίζει τα μηνύματα συστήματος που προέρχονται από εφαρμογές
	όπως το IPF.</p><p>Προσθέστε την παρακάτω καταχώριση στο αρχείο
	<code class="filename">/etc/syslog.conf</code>:</p><pre class="programlisting">local0.* /var/log/ipfilter.log</pre><p>Το <code class="literal">local0.*</code> σημαίνει ότι θα γίνεται
	καταγραφή όλων των μηνυμάτων αυτού του τύπου στην τοποθεσία που έχει
	οριστεί.</p><p>Για να ενεργοποιήσετε τις αλλαγές στο
	<code class="filename">/etc/syslog.conf</code> θα πρέπει να επανεκκινήσετε το
	μηχάνημα ή να αναγκάσετε το <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> να ξαναδιαβάσει το
	<code class="filename">/etc/syslog.conf</code>, εκτελώντας την εντολή
	<code class="command">/etc/rc.d/syslogd reload</code></p><p>Μην ξεχάσετε να τροποποιήσετε το
	<code class="filename">/etc/newsyslog.conf</code> ώστε να εναλλάσσει το αρχείο
	καταγραφής που δημιουργήσατε παραπάνω.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99119440"></a>30.5.8. Η Μορφή των Μηνυμάτων Καταγραφής</h3></div></div></div><p>Τα μηνύματα που παράγονται από την <code class="command">ipmon</code>
	αποτελούνται από πεδία δεδομένων που χωρίζονται από λευκό διάστημα.
	Τα πεδία που είναι κοινά σε όλα τα μηνύματα, είναι τα παρακάτω:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Η ημερομηνία παραλαβής του πακέτου</p></li><li class="listitem"><p>Η ώρα παραλαβής του πακέτου.  Έχει την μορφή HH:MM:SS.F,
	    η οποία υποδηλώνει ώρες, λεπτά, δευτερόλεπτα και κλάσματα
	    δευτερολέπτου (τα οποία μπορεί να είναι πολλά δεκαδικά
	    ψηφία).</p></li><li class="listitem"><p>Το όνομα της διεπαφής στην οποία έγινε η επεξεργασία του
	    πακέτου π.χ. <code class="filename">dc0</code>.</p></li><li class="listitem"><p>Ο αριθμός ομάδας και ο αύξων αριθμός του κανόνα, π.χ.
	    <code class="literal">@0:17</code>.</p></li></ol></div><p>Μπορείτε να δείτε τα παρακάτω με την εντολή
	<code class="command">ipfstat -in</code>:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Το είδος της ενέργειας: p αν το πακέτο πέρασε, b αν το πακέτο
	    απορρίφθηκε, S για σύντομο πακέτο, n αν δεν ταίριαξε με κανένα
	    κανόνα, L για κανόνα με καταγραφή.  Η σειρά προτεραιότητας στην
	    απεικόνιση των παραπάνω, είναι S, p, b, n, L.  Το κεφαλαίο P ή
	    το B σημαίνουν ότι η καταγραφή του πακέτου έγινε λόγω κάποιας
	    γενικής ρύθμισης καταγραφής και όχι εξαιτίας κάποιου
	    κανόνα.</p></li><li class="listitem"><p>Οι διευθύνσεις.  Πρόκειται στην πραγματικότητα για τρία
	    πεδία: τη διεύθυνση και τη θύρα αφετηρίας (χωρίζονται με κόμμα),
	    το σύμβολο -&gt; και την διεύθυνση και θύρα προορισμού, π.χ.
	    <code class="literal">209.53.17.22,80 -&gt; 198.73.220.17,1722</code>.</p></li><li class="listitem"><p>Το <code class="literal">PR</code> ακολουθούμενο από το όνομα ή τον
	    αριθμό του πρωτοκόλλου, π.χ. <code class="literal">PR tcp</code>.</p></li><li class="listitem"><p>Το <code class="literal">len</code> ακολουθούμενο από το μήκος της
	    επικεφαλίδας και το συνολικό μήκος του πακέτου, π.χ.
	    <code class="literal">len 20 40</code>.</p></li></ol></div><p>Αν πρόκειται για πακέτο <acronym class="acronym">TCP</acronym>, θα υπάρχει ένα
	επιπλέον πεδίο το οποίο θα ξεκινάει με μια παύλα και θα ακολουθείται
	από γράμματα τα οποία αντιστοιχούν στις επιλογές (flags) που έχουν
	τεθεί.  Δείτε τη σελίδα manual <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ipf</span>(5)</span></a> για τη λίστα των
	γραμμάτων και των αντίστοιχων flags.</p><p>Αν πρόκειται για πακέτο ICMP, θα υπάρχουν δύο πεδία στο τέλος,
	το πρώτο θα είναι πάντα <span class="quote">«<span class="quote">ICMP</span>»</span> και το επόμενο θα είναι
	ο τύπος του μηνύματος και του υπό-μηνύματος ICMP, χωρισμένα με μια
	κάθετο, π.χ. ICMP 3/3 για ένα μήνυμα μη προσβάσιμης θύρας (port
	unreachable).</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="firewalls-ipf-rules-script"></a>30.5.9. Δημιουργία Script Κανόνων με Συμβολική Υποκατάσταση</h3></div></div></div><p>Ορισμένοι έμπειροι χρήστες του IPF δημιουργούν ένα αρχείο
	κανόνων το οποίο μπορεί να εκτελεστεί ως script με δυνατότητα
	συμβολικής υποκατάστασης.  Το βασικό όφελος του παραπάνω, είναι ότι
	χρειάζεται να αλλάξετε μόνο την τιμή που σχετίζεται με το συμβολικό
	όνομα και όταν το script εκτελεστεί, η τιμή θα υποκατασταθεί σε όλους
	τους κανόνες που περιέχουν το όνομα αυτό.  Καθώς πρόκειται για
	script, μπορείτε να χρησιμοποιήσετε συμβολική υποκατάσταση για να
	κωδικοποιήσετε συχνά χρησιμοποιούμενες τιμές και να τις υποκαθιστάτε
	σε πολλαπλούς κανόνες.  Αυτό φαίνεται και στο παράδειγμα που
	ακολουθεί.</p><p>Η σύνταξη του script που χρησιμοποιείται εδώ, είναι συμβατή με τα
	κελύφη <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a>, και <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcsh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcsh</span>(1)</span></a>.</p><p>Τα πεδία στα οποία γίνεται συμβολική υποκατάσταση προσημειώνονται
	με το σήμα του δολαρίου: <code class="literal">$</code>.</p><p>Τα συμβολικά πεδία δεν έχουν την προσημείωση με το
	$.</p><p>Η τιμή που θα χρησιμοποιηθεί στο συμβολικό πεδίο, θα πρέπει να
	εσωκλείεται σε διπλά εισαγωγικά (<code class="literal">"</code>).</p><p>Ξεκινήστε το αρχείο των κανόνων σας με κάτι αντίστοιχο με το
	παρακάτω:</p><pre class="programlisting">############# Start of IPF rules script ########################

oif="dc0"            # name of the outbound interface
odns="192.0.2.11"    # ISP's DNS server IP address
myip="192.0.2.7"     # my static IP address from ISP
ks="keep state"
fks="flags S keep state"

# You can choose between building /etc/ipf.rules file
# from this script or running this script "as is".
#
# Uncomment only one line and comment out another.
#
# 1) This can be used for building /etc/ipf.rules:
#cat &gt; /etc/ipf.rules &lt;&lt; EOF
#
# 2) This can be used to run script "as is":
/sbin/ipf -Fa -f - &lt;&lt; EOF

# Allow out access to my ISP's Domain name server.
pass out quick on $oif proto tcp from any to $odns port = 53 $fks
pass out quick on $oif proto udp from any to $odns port = 53 $ks

# Allow out non-secure standard www function
pass out quick on $oif proto tcp from $myip to any port = 80 $fks

# Allow out secure www function https over TLS SSL
pass out quick on $oif proto tcp from $myip to any port = 443 $fks
EOF
################## End of IPF rules script ########################</pre><p>Αυτό είναι όλο.  Στο παραπάνω παράδειγμα δεν είναι σημαντικοί
	οι κανόνες, αλλά ο τρόπος με τον οποίο λειτουργούν και παίρνουν τιμές
	τα πεδία υποκατάστασης.  Αν το παραπάνω παράδειγμα βρίσκονταν σε ένα
	αρχείο με το όνομα <code class="filename">/etc/ipf.rules.script</code>,
	θα μπορούσατε να επαναφορτώσετε αυτούς τους κανόνες με την παρακάτω
	εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh /etc/ipf.rules.script</code></strong></pre><p>Υπάρχει ένα πρόβλημα όταν χρησιμοποιούνται αρχεία κανόνων με
	ενσωματωμένους συμβολισμούς:  Το IPF δεν καταλαβαίνει τη συμβολική
	υποκατάσταση, και δεν μπορεί να διαβάσει αυτά τα scripts άμεσα.</p><p>Ένα τέτοιο script μπορεί να χρησιμοποιηθεί με ένα από τους δύο
	παρακάτω τρόπους:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Αφαιρέστε το σχόλιο από τη γραμμή που ξεκινάει με
	    <code class="literal">cat</code>, και μετατρέψτε σε σχόλιο τη γραμμή που
	    ξεκινάει με <code class="literal">/sbin/ipf</code>.  Τοποθετήστε το
	    <code class="literal">ipfilter_enable="YES"</code> στο αρχείο
	    <code class="filename">/etc/rc.conf</code> όπως συνήθως, και εκτελέστε
	    το script μια φορά μετά από κάθε αλλαγή για να δημιουργήσετε ή να
	    ενημερώσετε το <code class="filename">/etc/ipf.rules</code>.</p></li><li class="listitem"><p>Απενεργοποιήστε το IPFILTER στα scripts εκκίνησης του
	    συστήματος, προσθέτοντας την καταχώριση
	    <code class="literal">ipfilter_enable="NO"</code> (πρόκειται για την
	    προεπιλεγμένη τιμή) στο αρχείο
	    <code class="filename">/etc/rc.conf</code>.</p><p>Προσθέστε ένα script όπως το παρακάτω στον κατάλογο εκκίνησης
	    <code class="filename">/usr/local/etc/rc.d/</code>.  Το
	    script θα πρέπει να έχει ένα προφανές όνομα, όπως
	    <code class="filename">ipf.loadrules.sh</code>.  Η επέκταση
	    <code class="filename">.sh</code> είναι υποχρεωτική.</p><pre class="programlisting">#!/bin/sh
sh /etc/ipf.rules.script</pre><p>Οι άδειες σε αυτό το αρχείο, θα πρέπει να επιτρέπουν ανάγνωση,
	    εγγραφή και εκτέλεση για τον χρήστη
	    <code class="systemitem">root</code>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chmod 700 /usr/local/etc/rc.d/ipf.loadrules.sh</code></strong></pre></li></ul></div><p>Οι κανόνες του IPF θα φορτώνονται πλέον κατά την εκκίνηση του
	συστήματος σας.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99160272"></a>30.5.10. Το Σύνολο Κανόνων του IPF</h3></div></div></div><p>Ως <span class="quote">«<span class="quote">σύνολο κανόνων</span>»</span> στο IPF, ορίζουμε μια ομάδα
	κανόνων που έχουν γραφεί για να επιτρέπουν ή να απορρίπτουν πακέτα
	ανάλογα με τις τιμές που περιέχονται σε αυτά.  Η διπλής κατεύθυνσης
	ανταλλαγή πακέτων μεταξύ υπολογιστών αποτελεί μια συνεδρία.
	Το σύνολο κανόνων του firewall επεξεργάζεται τόσο τα πακέτα που
	έρχονται από το Internet, όσο και τα πακέτα που παράγονται από το
	σύστημα ως απάντηση σε αυτά.  Κάθε υπηρεσία <acronym class="acronym">TCP/IP</acronym>
	(π.χ. telnet, www, mail, κ.λ.π.) καθορίζεται από το πρωτόκολλο και
	την προνομιακή (privileged) θύρα που χρησιμοποιεί για να δέχεται
	αιτήματα εξυπηρέτησης.  Τα πακέτα που προορίζονται για μια
	συγκεκριμένη υπηρεσία, ξεκινούν από τη διεύθυνση αφετηρίας
	χρησιμοποιώντας μια μη-προνομιακή θύρα και καταλήγουν στη
	συγκεκριμένη θύρα υπηρεσίας στον προορισμό.  Όλες οι παραπάνω
	παράμετροι (θύρες και διευθύνσεις) μπορούν να χρησιμοποιηθούν
	ως κριτήρια επιλογής για την δημιουργία κανόνων που επιτρέπουν
	ή εμποδίζουν την πρόσβαση σε υπηρεσίες.</p><a id="idp99162064" class="indexterm"></a><p>Το IPF γράφτηκε αρχικά χρησιμοποιώντας μια λογική επεξεργασίας
	κανόνων του τύπου <span class="quote">«<span class="quote">ο τελευταίος κανόνας που ταιριάζει, είναι ο
	νικητής</span>»</span> και χρησιμοποιούσε μόνο κανόνες stateless.  Με την
	πάροδο του χρόνου, το IPF ενισχύθηκε με την επιλογή
	<span class="quote">«<span class="quote">quick</span>»</span> και με δυνατότητα αποθήκευσης κατάστασης
	μέσω της επιλογής <span class="quote">«<span class="quote">keep state</span>»</span>.  Με τον τρόπο αυτό,
	εκσυγχρονίστηκε δραματικά η λογική επεξεργασίας των κανόνων.</p><p>Οι οδηγίες που περιέχονται σε αυτή την ενότητα βασίζονται στη
	χρήση κανόνων που περιέχουν την επιλογή <span class="quote">«<span class="quote">quick</span>»</span> και την
	επιλογή <span class="quote">«<span class="quote">keep state</span>»</span> για τη διατήρηση της κατάστασης.
	Αυτές είναι και οι βασικές λειτουργίες για την κωδικοποίηση του
	συνόλου κανόνων ενός inclusive firewall.</p><div xmlns="" class="warning"><h3 class="admontitle">Προειδοποίηση: </h3><p xmlns="http://www.w3.org/1999/xhtml">Όταν δουλεύετε με τους κανόνες του firewall, θα πρέπει να είστε
	  <span class="emphasis"><em>πολύ προσεκτικοί</em></span>.  Αν βάλετε λανθασμένες
	  ρυθμίσεις, μπορεί να <span class="emphasis"><em>κλειδωθείτε έξω</em></span> από τον
	  εξυπηρετητή σας.  Για να είστε ασφαλείς, είναι προτιμότερο να
	  κάνετε τις αρχικές σας ρυθμίσεις από την τοπική κονσόλα, παρά μέσω
	  απομακρυσμένης σύνδεσης (π.χ. μέσω
	  <span class="application">ssh</span>).</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99172176"></a>30.5.11. Συντακτικό Κανόνων</h3></div></div></div><a id="idp99172816" class="indexterm"></a><p>Το συντακτικό των κανόνων που παρουσιάζουμε εδώ, έχει απλοποιηθεί
	ώστε να απεικονίζει τη σύγχρονη stateful υλοποίηση και τη λογική
	του τύπου <span class="quote">«<span class="quote">ο πρώτος κανόνας που ταιριάζει είναι και ο
	νικητής</span>»</span>.  Για την περιγραφή του παλιότερου τρόπου λειτουργίας,
	διαβάστε τη σελίδα manual του <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipf&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ipf</span>(8)</span></a>.</p><p>Ο χαρακτήρας <code class="literal">#</code> χρησιμοποιείται για να
	επισημάνει την αρχή ενός σχολίου, και μπορεί να εμφανίζεται στο τέλος
	μιας γραμμής κανόνα ή στη δική του γραμμή.  Οι κενές γραμμές
	αγνοούνται.</p><p>Οι κανόνες περιέχουν λέξεις-κλειδιά.  Οι λέξεις αυτές θα πρέπει
	να κωδικοποιηθούν με συγκεκριμένη σειρά από τα αριστερά προς τα δεξιά
	της γραμμής.  Οι λέξεις-κλειδιά φαίνονται παρακάτω με έντονα γράμματα.
	Μερικές λέξεις έχουν υπο-επιλογές οι οποίες μπορεί να είναι επίσης
	λέξεις-κλειδιά και να περιλαμβάνουν επίσης περισσότερες υπο-επιλογές.
	Κάθε μια από τις επικεφαλίδες στο παράδειγμα που φαίνεται παρακάτω
	έχει μια κεφαλίδα με έντονα γράμματα η οποία επεξηγεί το περιεχόμενο
	της.</p><p><em class="replaceable"><code>ACTION IN-OUT OPTIONS SELECTION STATEFUL PROTO
	  SRC_ADDR,DST_ADDR OBJECT PORT_NUM TCP_FLAG
	  STATEFUL</code></em></p><p><em class="replaceable"><code>ACTION</code></em> = block | pass</p><p><em class="replaceable"><code>IN-OUT</code></em> = in | out</p><p><em class="replaceable"><code>OPTIONS</code></em> = log | quick | on
	  interface-name</p><p><em class="replaceable"><code>SELECTION</code></em> = proto value |
	  source/destination IP | port = number | flags
	  flag-value</p><p><em class="replaceable"><code>PROTO</code></em> = tcp/udp | udp | tcp |
	  icmp</p><p><em class="replaceable"><code>SRC_ADD,DST_ADDR</code></em> = all | from
	  object to object</p><p><em class="replaceable"><code>OBJECT</code></em> = IP address | any</p><p><em class="replaceable"><code>PORT_NUM</code></em> = port number</p><p><em class="replaceable"><code>TCP_FLAG</code></em> = S</p><p><em class="replaceable"><code>STATEFUL</code></em> = keep state</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99188304"></a>30.5.11.1. ACTION</h4></div></div></div><p>Η ενέργεια (action) δείχνει τι πρέπει να γίνει με το πακέτο αν
	  ταιριάζει με τον κανόνα του φίλτρου.  Κάθε κανόνας
	  <span class="emphasis"><em>πρέπει</em></span> να διαθέτει μια ενέργεια.  Οι ενέργειες
	  που αναγνωρίζονται, φαίνονται παρακάτω:</p><p>Το <code class="literal">block</code> δείχνει ότι το πακέτο θα πρέπει να
	  απορριφθεί αν ταιριάζει με τις παραμέτρους επιλογής του
	  κανόνα.</p><p>Το <code class="literal">pass</code> δείχνει ότι το πακέτο θα πρέπει να
	  εξέλθει από το firewall, αν ταιριάζει με τις παραμέτρους επιλογής
	  του κανόνα.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99191504"></a>30.5.11.2. IN-OUT</h4></div></div></div><p>Κάθε κανόνας του φίλτρου πρέπει υποχρεωτικά να διευκρινίζει
	  με σαφήνεια αν αναφέρεται στην είσοδο ή την έξοδο πακέτων.
	  Η επόμενη λέξη-κλειδί πρέπει να είναι <code class="literal">in</code> ή
	  <code class="literal">out</code> και αν δεν υπάρχει, ο κανόνας θα αποτύχει
	  κατά το συντακτικό έλεγχο.</p><p>Το <code class="literal">in</code> σημαίνει ότι ο κανόνας θα εφαρμοστεί
	  σε ένα εισερχόμενο πακέτο το οποίο μόλις λήφθηκε στη διεπαφή που
	  συνδέεται με το Διαδίκτυο.</p><p>Το <code class="literal">out</code> σημαίνει ότι ο κανόνας θα εφαρμοστεί
	  σε ένα πακέτο που προορίζεται για έξοδο μέσω της διεπαφής που
	  συνδέεται με το Διαδίκτυο.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99194960"></a>30.5.11.3. OPTIONS</h4></div></div></div><div xmlns="" class="note"><h3 class="admontitle">Σημείωση: </h3><p xmlns="http://www.w3.org/1999/xhtml">Οι παρακάτω επιλογές πρέπει να χρησιμοποιηθούν με τη σειρά
	    που φαίνονται εδώ.</p></div><p>Το <code class="literal">log</code> δείχνει ότι η επικεφαλίδα του πακέτου
	  θα γραφεί στο αρχείο καταγραφής του

	

	  <code class="filename">ipl</code> (όπως περιγράφεται στην ενότητα
	  LOGGING που ακολουθεί) αν οι παράμετροι της επιλογής ταιριάζουν με
	  το πακέτο.</p><p>To <code class="literal">quick</code> δείχνει ότι αν οι παράμετροι της
	  επιλογής ταιριάζουν με το πακέτο, ο συγκεκριμένος κανόνας θα είναι
	  και ο τελευταίος κανόνας που θα ελεγχθεί.  Η επιλογή αυτή είναι
	  υποχρεωτική για τη σύγχρονη λογική επεξεργασίας πακέτων.</p><p>Το <code class="literal">on</code> δείχνει το όνομα της διεπαφής που θα
	  ενσωματωθεί στις παραμέτρους επιλογής.  Τα ονόματα των διεπαφών
	  φαίνονται όταν εκτελείται η εντολή <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>.
	  Χρησιμοποιώντας την επιλογή αυτή, ο κανόνας θα ελεγχθεί μόνο αν το
	  πακέτο διέρχεται μέσω της συγκεκριμένης διεπαφής και προς τη
	  συγκεκριμένη κατεύθυνση (εισερχόμενα/εξερχόμενα).  Η επιλογή αυτή
	  είναι υποχρεωτική για την σύγχρονη λογική επεξεργασίας των
	  κανόνων.</p><p>Όταν γίνεται καταγραφή ενός πακέτου, οι επικεφαλίδες γράφονται
	  στην ψευδο-συσκευή καταγραφής πακέτων <acronym class="acronym">IPL</acronym>.
	  Μετά την εντολή <code class="literal">log</code>, μπορούν να χρησιμοποιηθούν
	  οι παρακάτω παράμετροι (με τη σειρά που φαίνονται):</p><p>Το <code class="literal">body</code> δείχνει ότι θα γίνει καταγραφή των
	  πρώτων 128 bytes των περιεχομένων του πακέτου, που βρίσκονται αμέσως
	  μετά την επικεφαλίδα.</p><p>Η επιλογή <code class="literal">first</code> συνίσταται να χρησιμοποιηθεί
	  αν η επιλογή <code class="literal">log</code> χρησιμοποιείται σε συνδυασμό
	  με την <code class="literal">keep state</code>.  Με τον τρόπο αυτό γίνεται
	  καταγραφή μόνο του πρώτου πακέτου (με το οποίο ξεκίνησε η
	  επικοινωνία), και όχι όλων των υπολοίπων τα οποία ταιριάζουν με την
	  πληροφορία <span class="quote">«<span class="quote">keep state</span>»</span>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99208272"></a>30.5.11.4. SELECTION</h4></div></div></div><p>Οι λέξεις κλειδιά που περιγράφονται σε αυτή την ενότητα,
	  χρησιμοποιούνται για να περιγράψουν ποιες ιδιότητες του πακέτου
	  θα διερευνηθούν για να καθοριστεί αν ταιριάζει ή όχι με τους
	  κανόνες.  Μια λέξη-κλειδί ορίζει το κεντρικό θέμα και ακολουθείται
	  από άλλες λέξεις που ορίζουν τις ακριβείς επιλογές.  Πρέπει πάντοτε
	  να επιλέγεται μια από αυτές τις λέξεις.  Παρέχονται οι παρακάτω
	  ιδιότητες γενικής χρήσης οι οποίες πρέπει να χρησιμοποιηθούν με
	  αυτή τη σειρά:</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99209424"></a>30.5.11.5. PROTO</h4></div></div></div><p>Το <code class="literal">proto</code> είναι η βασική λέξη, και πρέπει
	  να γράφεται μαζί με κάποια αντίστοιχη τιμή για περαιτέρω επιλογή.
	  Η τιμή επιτρέπει το ταίριασμα με ένα συγκεκριμένο πρωτόκολλο.  Είναι
	  υποχρεωτικό να χρησιμοποιηθεί για να λειτουργεί η σύγχρονη λογική
	  επεξεργασίας των κανόνων.</p><p>Τα ονόματα πρωτοκόλλων που αναγνωρίζονται και μπορούν να
	  χρησιμοποιηθούν, είναι τα
	  <code class="literal">tcp/udp | udp | tcp | icmp</code> ή οποιαδήποτε άλλα
	  εμφανίζονται στο <code class="filename">/etc/protocols</code>.  Μπορείτε να
	  χρησιμοποιήσετε το ειδικό όνομα <code class="literal">tcp/udp</code> το οποίο
	  ταιριάζει είτε με πακέτο <acronym class="acronym">TCP</acronym> είτε με
	  <acronym class="acronym">UDP</acronym>.  Η ειδική αυτή ονομασία προστέθηκε ώστε να
	  αποφεύγονται διπλοί, αλλά κατά τα άλλα όμοιοι, κανόνες.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99233872"></a>30.5.11.6. SRC_ADDR/DST_ADDR</h4></div></div></div><p>Η λέξη <code class="literal">all</code> είναι ουσιαστικά συνώνυμη με την
	  φράση <span class="quote">«<span class="quote">from any to any</span>»</span> χωρίς να υπάρχουν άλλες
	  παράμετροι για το ταίριασμα.</p><p>Όταν χρησιμοποιείται το <code class="literal">from src to dst</code>, οι
	  λέξεις <code class="literal">from</code> και <code class="literal">to</code> δηλώνουν
	  διευθύνσεις IP που θα χρησιμοποιηθούν για το ταίριασμα.  Οι κανόνες
	  πρέπει να καθορίζουν τις παραμέτρους τόσο της αφετηρίας όσο και του
	  προορισμού.  Η λέξη <code class="literal">any</code> έχει την ειδική ιδιότητα
	  να ταιριάζει με οποιαδήποτε διεύθυνση IP.  Παραδείγματα χρήσης:
	  <code class="literal">from any to any</code> ή
	  <code class="literal">from 0.0.0.0/0 to any</code> ή
	  <code class="literal">from any to 0.0.0.0/0</code> ή
	  <code class="literal">from 0.0.0.0 to any</code> ή
	  <code class="literal">from any to 0.0.0.0</code>.</p><p>Δεν υπάρχει τρόπος να περιγραφούν περιοχές IP διευθύνσεων που
	  δεν μπορούν να εκφραστούν εύκολα με τη μορφή αριθμών χωρισμένων με
	  τελείες / μάσκας υποδικτύου.  Μπορείτε να χρησιμοποιήσετε το
	  βοηθητικό πρόγραμμα <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/ipcalc/pkg-descr">net-mgmt/ipcalc</a> για διευκόλυνση σας
	  στους υπολογισμούς.  Δείτε την δικτυακή τοποθεσία του προγράμματος
	  για περισσότερες πληροφορίες: <code class="uri"><a class="uri" href="http://jodies.de/ipcalc" target="_top">http://jodies.de/ipcalc</a></code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99245136"></a>30.5.11.7. PORT</h4></div></div></div><p>Το ταίριασμα με κάποια συγκεκριμένη θύρα αφετηρίας ή/και
	  προορισμού (αν υπάρχει) εφαρμόζεται μόνο σε πακέτα
	  <acronym class="acronym">TCP</acronym> και <acronym class="acronym">UDP</acronym>.  Κατά την
	  δημιουργία συγκρίσεων με θύρες, μπορείτε είτε να χρησιμοποιήσετε τον
	  αριθμό της θύρας, είτε το όνομα της αντίστοιχης υπηρεσίας
	  από το αρχείο <code class="filename">/etc/services</code>.  Όταν η θύρα
	  εμφανίζεται ως τμήμα του αντικειμένου <code class="literal">from</code>, το
	  ταίριασμα θα γίνει με την θύρα της αφετηρίας.  Όταν εμφανίζεται ως
	  τμήμα του αντικειμένου <code class="literal">to</code>, το ταίριασμα θα γίνει
	  με τη θύρα προορισμού.  Για να λειτουργεί η σύγχρονη λογική
	  ταιριάσματος κανόνων, θα πρέπει οπωσδήποτε να υπάρχει η επιλογή
	  θύρας στο αντικείμενο <code class="literal">to</code>.  Παράδειγμα χρήσης:
	  <code class="literal">from any to any port = 80</code></p><p>Οι συγκρίσεις που αναφέρονται σε μια μόνο θύρα, μπορούν να
	  γίνουν με πολλούς διαφορετικούς τρόπους, χρησιμοποιώντας
	  διαφορετικούς τελεστές σύγκρισης.  Είναι επίσης δυνατόν να
	  καθοριστούν ολόκληρες περιοχές από θύρες.</p><p>port "=" | "!=" | "&lt;" | "&gt;" | "&lt;=" | "&gt;=" |
	  "eq" | "ne" | "lt" | "gt" | "le" | "ge".</p><p>Για να καθορίσετε περιοχές θυρών, χρησιμοποιήστε
	  port "&lt;&gt;" | "&gt;&lt;"</p><div xmlns="" class="warning"><h3 class="admontitle">Προειδοποίηση: </h3><p xmlns="http://www.w3.org/1999/xhtml">Μετά τις παραμέτρους για το ταίριασμα της αφετηρίας και του
	    προορισμού, οι παρακάτω δύο παράμετροι είναι υποχρεωτικές για να
	    λειτουργεί η σύγχρονη λογική επεξεργασίας των κανόνων.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99292112"></a>30.5.11.8. <acronym class="acronym">TCP</acronym>_FLAG</h4></div></div></div><p>Τα flags είναι ενεργά μόνο στο φιλτράρισμα του πρωτοκόλλου
	  <acronym class="acronym">TCP</acronym>.  Το κάθε γράμμα αντιπροσωπεύει ένα πιθανό
	  flag το για το οποίο γίνεται ανίχνευση στην επικεφαλίδα του πακέτου
	  <acronym class="acronym">TCP</acronym>.</p><p>Η σύγχρονη λογική επεξεργασίας των κανόνων, χρησιμοποιεί την
	  παράμετρο <code class="literal">flags S</code> για την αναγνώριση της έναρξης
	  μια συνεδρίας tcp.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99295056"></a>30.5.11.9. STATEFUL</h4></div></div></div><p>Σε ένα κανόνα που επιτρέπει (pass) το πέρασμα των πακέτων, η
	  επιλογή <code class="literal">keep state</code> δείχνει ότι θα πρέπει να
	  ενεργοποιείται η λειτουργία stateful filtering όταν το πακέτο
	  ταιριάζει με τα κριτήρια επιλογής.</p><div xmlns="" class="note"><h3 class="admontitle">Σημείωση: </h3><p xmlns="http://www.w3.org/1999/xhtml">Η επιλογή αυτή είναι υποχρεωτική για τη λειτουργία της
	    σύγχρονης λογικής επεξεργασίας κανόνων.</p></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99297616"></a>30.5.12. Φιλτράρισμα με Διατήρηση της Κατάστασης (stateful)</h3></div></div></div><a id="idp99298256" class="indexterm"></a><p>Το stateful φιλτράρισμα, αντιμετωπίζει την κίνηση του δικτύου ως
	μιας διπλής κατεύθυνσης ανταλλαγή πακέτων τα οποία δημιουργούν μια
	συνεδρία.  Όταν ενεργοποιηθεί, η διατήρηση της κατάστασης
	(keep-state) δημιουργεί δυναμικά εσωτερικούς κανόνες για κάθε πακέτο
	το οποίο ανταλλάσσεται κατά τη διάρκεια αυτής της συνεδρίας.
	Έχει επίσης τη δυνατότητα να διερευνήσει αν ακολουθούνται οι έγκυροι
	κανόνες ανταλλαγής μηνυμάτων μεταξύ του αποστολέα και του παραλήπτη.
	Οποιαδήποτε πακέτα δεν ταιριάζουν με το πρότυπο αυτής της
	επικοινωνίας, απορρίπτονται ως ψεύτικα.</p><p>Η διατήρηση της κατάστασης επιτρέπει επίσης να περάσουν τα
	πακέτα <acronym class="acronym">ICMP</acronym> που σχετίζονται με μια συνεδρία
	<acronym class="acronym">TCP</acronym> ή <acronym class="acronym">UDP</acronym>.  Έτσι, αν ληφθούν
	πακέτα <acronym class="acronym">ICMP</acronym> τύπου 3 code 4 ως απάντηση κατά τη
	διάρκεια της επίσκεψης σας σε μια ιστοσελίδα, (η οποία επιτρέπεται
	από τον αντίστοιχο κανόνα εξερχομένων), θα τους επιτραπεί η είσοδος.
	Οποιοδήποτε πακέτο για το οποίο το IPF είναι σίγουρο ότι πρόκειται
	για τμήμα μιας ενεργής συνεδρίας, θα περάσει ακόμα και αν είναι
	διαφορετικό πρωτόκολλο.</p><p>Αυτό που συμβαίνει είναι το παρακάτω:</p><p>Τα πακέτα που προορίζονται να εξέλθουν μέσω της διεπαφής που
	συνδέεται στο Internet, ελέγχονται αρχικά σύμφωνα με το δυναμικό
	πίνακα καταστάσεων.  Αν το πακέτο ταιριάζει με το επόμενο που
	αναμένεται σε μια ενεργή συνεδρία, εξέρχεται από το firewall και
	ταυτόχρονα ενημερώνεται η κατάσταση της συγκεκριμένης συνεδρίας στον
	παραπάνω δυναμικό πίνακα.  Τα υπόλοιπα πακέτα (που δεν ταιριάζουν με
	κάποια συνεδρία σε εξέλιξη) ελέγχονται σύμφωνα με το σύνολο κανόνων
	για τα εξερχόμενα πακέτα.</p><p>Τα πακέτα που έρχονται από τη διεπαφή που είναι συνδεμένη με το
	Internet, ελέγχονται αρχικά μέσω του δυναμικού πίνακα καταστάσεων.
	Αν το πακέτο ταιριάζει με το επόμενο που αναμένεται σε μια ενεργή
	συνεδρία, εξέρχεται από το firewall και ταυτόχρονα ενημερώνεται
	η κατάσταση της συγκεκριμένης συνεδρίας στον παραπάνω πίνακα.  Τα
	υπόλοιπα πακέτα (που δεν ταιριάζουν με κάποια συνεδρία σε εξέλιξη)
	ελέγχονται σύμφωνα με το σύνολο κανόνων για τα εισερχόμενα
	πακέτα.</p><p>Όταν η επικοινωνία ολοκληρωθεί, διαγράφεται από τον δυναμικό
	πίνακα καταστάσεων.</p><p>Το stateful φιλτράρισμα επιτρέπει να εστιάσουμε την προσοχή μας
	στην αποδοχή ή απόρριψη των νέων συνδέσεων.  Αν επιτραπεί μια νέα
	συνεδρία, όλα τα υπόλοιπα πακέτα της θα επιτρέπονται αυτόματα, ενώ
	τυχόν ψεύτικα πακέτα θα απορρίπτονται επίσης αυτόματα.  Το stateful
	φιλτράρισμα διαθέτει μια σειρά από προχωρημένες ικανότητες διερεύνησης
	των πακέτων, με δυνατότητα να αμύνεται σε πολλές διαφορετικές
	μεθόδους που χρησιμοποιούν οι επιτιθέμενοι.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99320784"></a>30.5.13. Παράδειγμα Συνόλου Κανόνων για ένα Inclusive Firewall</h3></div></div></div><p>Το παρακάτω σύνολο κανόνων δίνεται ως παράδειγμα για
	να φτιάξετε ένα ιδιαίτερα ασφαλές inclusive firewall.  Ένα inclusive
	firewall επιτρέπει το πέρασμα μόνο των υπηρεσιών που ταιριάζουν με
	τους κανόνες που έχει για αποδοχή πακέτων, και απορρίπτει όλα τα
	υπόλοιπα.  Τα firewalls που προστατεύουν άλλα μηχανήματα (τα οποία
	καλούνται και <span class="quote">«<span class="quote">network firewalls</span>»</span>) θα πρέπει να διαθέτουν
	τουλάχιστον δύο διεπαφές.  Η μια διεπαφή συνδέεται με το τοπικό δίκτυο
	(<acronym class="acronym">LAN</acronym>) το οποίο θεωρείται έμπιστο, και η άλλη με
	το δημόσιο Internet.  Εναλλακτικά, ένα firewall μπορεί να
	προστατεύει μόνο το σύστημα στο οποίο εκτελείται-αυτό καλείται
	<span class="quote">«<span class="quote">host based firewall</span>»</span> και είναι κατάλληλο ιδιαίτερα
	για εξυπηρετητές που λειτουργούν σε μη έμπιστα δίκτυα.</p><p>Όλα τα συστήματα τύπου <span class="trademark">UNIX</span>(R), συμπεριλαμβανομένου και του FreeBSD,
	έχουν σχεδιαστεί να χρησιμοποιούν την διεπαφή
	<code class="filename">lo0</code> και την IP διεύθυνση
	<code class="systemitem">127.0.0.1</code> για εσωτερική επικοινωνία
	μέσα στο ίδιο το λειτουργικό σύστημα.  Το firewall πρέπει να περιέχει
	κανόνες που να επιτρέπουν την ελεύθερη και χωρίς περιορισμούς κίνηση
	των ειδικών αυτών εσωτερικών πακέτων.</p><p>Οι κανόνες που εξουσιοδοτούν την πρόσβαση προς το Internet,
	ορίζονται στην διεπαφή του δικτύου που συνδέεται σε αυτό.  Οι κανόνες
	αυτοί ελέγχουν τόσο την εισερχόμενη όσο και την εξερχόμενη κίνηση
	στο Internet.  Η διεπαφή αυτή μπορεί να είναι η
	<code class="filename">tun0</code> που χρησιμοποιείται στο PPP χρήστη, ή
	ακόμα και η κάρτα δικτύου που συνδέεται σε ένα DSL router ή
	modem.</p><p>Σε περίπτωση που μια ή περισσότερες κάρτες δικτύου συνδέονται σε
	εσωτερικά ιδιωτικά δίκτυα πίσω από το firewall, θα πρέπει να υπάρχουν
	οι αντίστοιχοι κανόνες που να επιτρέπουν την ελεύθερη διακίνηση των
	πακέτων ανάμεσα στις διεπαφές αυτές ή/και στο Internet.</p><p>Οι κανόνες πρέπει να οργανώνονται σε τρεις κύριες ενότητες: αρχικά
	όλες οι διεπαφές στις οποίες επιτρέπεται η ελεύθερη διακίνηση
	δεδομένων, έπειτα η διεπαφή από την οποία εξέρχονται τα πακέτα προς
	το δημόσιο δίκτυο (Internet) και τέλος η διεπαφή από την οποία
	λαμβάνονται πακέτα από το Internet.</p><p>Σε κάθε μια από τις ενότητες των διεπαφών που
	συνδέονται στο Internet, πρέπει να τοποθετούνται πρώτοι οι κανόνες
	που ταιριάζουν συχνότερα με την αντίστοιχη κίνηση.  Ο τελευταίος
	κανόνας της ενότητας θα πρέπει να απορρίπτει και να καταγράφει όλα τα
	πακέτα της συγκεκριμένης διεπαφής/κατεύθυνσης.</p><p>Η ενότητα των Εξερχομένων (Outbound) στο ακόλουθο σύνολο κανόνων,
	περιέχει μόνο κανόνες τύπου <code class="literal">pass</code> οι οποίοι
	επιτρέπουν (μέσω κατάλληλων τιμών στις παραμέτρους τους) σε
	συγκεκριμένες υπηρεσίες να αποκτήσουν πρόσβαση στο Internet.  Όλοι οι
	κανόνες διαθέτουν τις επιλογές <code class="literal">quick</code>,
	<code class="literal">on</code>, <code class="literal">proto</code>,
	<code class="literal">port</code> και <code class="literal">keep state</code>.  Οι κανόνες
	<code class="literal">proto tcp</code> περιλαμβάνουν την επιλογή
	<code class="literal">flag</code> ώστε να αναγνωρίζουν την αίτηση έναρξης της
	συνεδρίας και να ενεργοποιούν τη λειτουργία διατήρησης της
	κατάστασης (stateful).</p><p>Στην ενότητα των εισερχόμενων πακέτων (Inbound) που φαίνεται
	παρακάτω, πρώτοι εμφανίζονται οι κανόνες που χρησιμοποιούνται για την
	απόρριψη των ανεπιθύμητων πακέτων.  Αυτό γίνεται για δύο διαφορετικούς
	λόγους.  Ο πρώτος είναι ότι τα κακόβουλα πακέτα μπορεί εν μέρει να
	ταιριάζουν με κάποια χαρακτηριστικά της έγκυρης κίνησης.  Τα πακέτα
	αυτά θα πρέπει να απορριφθούν, αντί να γίνουν δεκτά από κάποιο
	επόμενο κανόνα <code class="literal">allow</code>.  Ο δεύτερος είναι ότι
	μπορείτε να απορρίψετε συγκεκριμένα πακέτα τα οποία γνωρίζετε ότι δεν
	είναι έγκυρα, αλλά σας είναι αδιάφορη η καταγραφή τους.  Με τον τρόπο
	αυτό εμποδίζεται η λήψη και καταγραφή τους από τον τελευταίο κανόνα.
	Ο τελευταίος κανόνας τυπικά απορρίπτει και καταγράφει όλα τα πακέτα
	που έφτασαν μέχρι αυτόν.  Ο κανόνας αυτός χρησιμοποιείται για την
	παροχή νομικών αποδείξεων σε περίπτωση που κινήσετε δικαστική
	διαδικασία κατά ατόμων που προέβησαν σε επιθέσεις στο σύστημα
	σας.</p><p>Θα πρέπει επίσης να εξασφαλίσετε ότι το σύστημα σας δεν θα δώσει
	καμιά απάντηση σε κανένα από τα ανεπιθύμητα πακέτα.  Τα πακέτα αυτά
	θα πρέπει να απορριφθούν και να εξαφανιστούν.  Με τον τρόπο αυτό, ο
	επιτιθέμενος δεν έχει καμιά γνώση αν τα πακέτα του έφτασαν μέχρι το
	σύστημα σας.  Όσο λιγότερα μπορούν να μάθουν οι επιτιθέμενοι σχετικά
	με το σύστημα σας, τόσο περισσότερο χρόνο θα χρειαστεί να επενδύσουν
	για να καταφέρουν να σας βλάψουν στα αλήθεια.  Οι κανόνες με την
	επιλογή <code class="literal">log first</code> καταγράφουν το συμβάν μόνο την
	πρώτη φορά που ενεργοποιούνται.  Η επιλογή αυτή περιλαμβάνεται στον
	κανόνα <code class="literal">nmap OS fingerprint</code> στο παράδειγμα που
	φαίνεται παρακάτω.  Το βοηθητικό πρόγραμμα <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/nmap/pkg-descr">security/nmap</a> χρησιμοποιείται συχνά
	από κακόβουλα άτομα, που προσπαθούν με αυτό τον τρόπο να
	αναγνωρίσουν το λειτουργικό σύστημα του μηχανήματος σας.</p><p>Κάθε φορά που υπάρχει καταγραφή από κάποιο κανόνα με την επιλογή
	<code class="literal">log first</code>, θα πρέπει να εκτελέσετε την εντολή
	<code class="command">ipfstat -hio</code> για να δείτε πόσες φορές έχει
	ενεργοποιηθεί αυτός ο κανόνας συνολικά.  Έτσι θα ξέρετε αν π.χ. σας
	κάνουν επίθεση υπερχείλισης (flood).</p><p>Δείτε το αρχείο <code class="filename">/etc/services</code> για να βρείτε
	αριθμούς θυρών που δεν αναγνωρίζετε.  Μπορείτε επίσης να επισκεφθείτε
	την τοποθεσία <code class="uri"><a class="uri" href="http://www.securitystats.com/tools/portsearch.php" target="_top">http://www.securitystats.com/tools/portsearch.php</a></code>
	και να κάνετε αναζήτηση για τη συγκεκριμένη θύρα, ώστε να δείτε ποια
	υπηρεσία εξυπηρετεί.</p><p>Δείτε την επόμενη τοποθεσία για τις θύρες που χρησιμοποιούνται
	συνήθως από κακόβουλα προγράμματα (trojans): <code class="uri"><a class="uri" href="http://www.simovits.com/trojans/trojans.html" target="_top">http://www.simovits.com/trojans/trojans.html</a></code>.</p><p>Το παρακάτω σύνολο κανόνων είναι αρκετά πλήρες και πολύ ασφαλές.
	Δημιουργεί firewall τύπου <code class="literal">inclusive</code>, και έχει
	δοκιμαστεί σε πραγματικές συνθήκες λειτουργίας.  Μπορεί να
	εξυπηρετήσει το ίδιο καλά και το δικό σας σύστημα.  Απλώς μετατρέψτε
	σε σχόλιο τους κανόνες για τις υπηρεσίες που δεν θέλετε να
	ενεργοποιήσετε.</p><p>Για να αποφύγετε την καταγραφή ανεπιθύμητων μηνυμάτων,
	απλώς προσθέστε ένα αντίστοιχο κανόνα απόρριψης
	(<code class="literal">block</code>) στην ενότητα των εισερχομένων
	(inbound).</p><p>Θα πρέπει να αλλάξετε το όνομα της διεπαφής
	<code class="filename">dc0</code> του παραδείγματος, με το πραγματικό όνομα
	της κάρτας δικτύου που συνδέει το σύστημα σας με το Internet.  Για
	όσους χρησιμοποιούν το PPP χρήστη, το όνομα θα είναι
	<code class="filename">tun0</code>.</p><p>Προσθέστε τις ακόλουθες καταχωρίσεις στο αρχείο
	<code class="filename">/etc/ipf.rules</code>:</p><pre class="programlisting">#################################################################
# No restrictions on Inside LAN Interface for private network
# Not needed unless you have LAN
#################################################################

#pass out quick on xl0 all
#pass in quick on xl0 all

#################################################################
# No restrictions on Loopback Interface
#################################################################
pass in quick on lo0 all
pass out quick on lo0 all

#################################################################
# Interface facing Public Internet (Outbound Section)
# Match session start requests originating from behind the
# firewall on the private network
# or from this gateway server destined for the public Internet.
#################################################################

# Allow out access to my ISP's Domain name server.
# xxx must be the IP address of your ISP's DNS.
# Dup these lines if your ISP has more than one DNS server
# Get the IP addresses from /etc/resolv.conf file
pass out quick on dc0 proto tcp from any to xxx port = 53 flags S keep state
pass out quick on dc0 proto udp from any to xxx port = 53 keep state

# Allow out access to my ISP's DHCP server for cable or DSL networks.
# This rule is not needed for 'user ppp' type connection to the
# public Internet, so you can delete this whole group.
# Use the following rule and check log for IP address.
# Then put IP address in commented out rule &amp; delete first rule
pass out log quick on dc0 proto udp from any to any port = 67 keep state
#pass out quick on dc0 proto udp from any to z.z.z.z port = 67 keep state


# Allow out non-secure standard www function
pass out quick on dc0 proto tcp from any to any port = 80 flags S keep state

# Allow out secure www function https over TLS SSL
pass out quick on dc0 proto tcp from any to any port = 443 flags S keep state

# Allow out send &amp; get email function
pass out quick on dc0 proto tcp from any to any port = 110 flags S keep state
pass out quick on dc0 proto tcp from any to any port = 25 flags S keep state

# Allow out Time
pass out quick on dc0 proto tcp from any to any port = 37 flags S keep state

# Allow out nntp news
pass out quick on dc0 proto tcp from any to any port = 119 flags S keep state

# Allow out gateway &amp; LAN users' non-secure FTP ( both passive &amp; active modes)
# This function uses the IP<acronym class="acronym">NAT</acronym> built in FTP proxy function coded in
# the nat rules file to make this single rule function correctly.
# If you want to use the pkg_add command to install application packages
# on your gateway system you need this rule.
pass out quick on dc0 proto tcp from any to any port = 21 flags S keep state

# Allow out ssh/sftp/scp (telnet/rlogin/FTP replacements)
# This function is using SSH (secure shell)
pass out quick on dc0 proto tcp from any to any port = 22 flags S keep state

# Allow out insecure Telnet
pass out quick on dc0 proto tcp from any to any port = 23 flags S keep state

# Allow out FreeBSD CVSup function
pass out quick on dc0 proto tcp from any to any port = 5999 flags S keep state

# Allow out ping to public Internet
pass out quick on dc0 proto icmp from any to any icmp-type 8 keep state

# Allow out whois from LAN to public Internet
pass out quick on dc0 proto tcp from any to any port = 43 flags S keep state

# Block and log only the first occurrence of everything
# else that's trying to get out.
# This rule implements the default block
block out log first quick on dc0 all

#################################################################
# Interface facing Public Internet (Inbound Section)
# Match packets originating from the public Internet
# destined for this gateway server or the private network.
#################################################################

# Block all inbound traffic from non-routable or reserved address spaces
block in quick on dc0 from 192.168.0.0/16 to any    #RFC 1918 private IP
block in quick on dc0 from 172.16.0.0/12 to any     #RFC 1918 private IP
block in quick on dc0 from 10.0.0.0/8 to any        #RFC 1918 private IP
block in quick on dc0 from 127.0.0.0/8 to any       #loopback
block in quick on dc0 from 0.0.0.0/8 to any         #loopback
block in quick on dc0 from 169.254.0.0/16 to any    #DHCP auto-config
block in quick on dc0 from 192.0.2.0/24 to any      #reserved for docs
block in quick on dc0 from 204.152.64.0/23 to any   #Sun cluster interconnect
block in quick on dc0 from 224.0.0.0/3 to any       #Class D &amp; E multicast

##### Block a bunch of different nasty things. ############
# That I do not want to see in the log

# Block frags
block in quick on dc0 all with frags

# Block short tcp packets
block in quick on dc0 proto tcp all with short

# block source routed packets
block in quick on dc0 all with opt lsrr
block in quick on dc0 all with opt ssrr

# Block nmap OS fingerprint attempts
# Log first occurrence of these so I can get their IP address
block in log first quick on dc0 proto tcp from any to any flags FUP

# Block anything with special options
block in quick on dc0 all with ipopts

# Block public pings
block in quick on dc0 proto icmp all icmp-type 8

# Block ident
block in quick on dc0 proto tcp from any to any port = 113

# Block all Netbios service. 137=name, 138=datagram, 139=session
# Netbios is MS/Windows sharing services.
# Block MS/Windows hosts2 name server requests 81
block in log first quick on dc0 proto tcp/udp from any to any port = 137
block in log first quick on dc0 proto tcp/udp from any to any port = 138
block in log first quick on dc0 proto tcp/udp from any to any port = 139
block in log first quick on dc0 proto tcp/udp from any to any port = 81

# Allow traffic in from ISP's DHCP server. This rule must contain
# the IP address of your ISP's DHCP server as it's the only
# authorized source to send this packet type. Only necessary for
# cable or DSL configurations. This rule is not needed for
# 'user ppp' type connection to the public Internet.
# This is the same IP address you captured and
# used in the outbound section.
pass in quick on dc0 proto udp from z.z.z.z to any port = 68 keep state

# Allow in standard www function because I have apache server
pass in quick on dc0 proto tcp from any to any port = 80 flags S keep state

# Allow in non-secure Telnet session from public Internet
# labeled non-secure because ID/PW passed over public Internet as clear text.
# Delete this sample group if you do not have telnet server enabled.
#pass in quick on dc0 proto tcp from any to any port = 23 flags S keep state

# Allow in secure FTP, Telnet, and SCP from public Internet
# This function is using SSH (secure shell)
pass in quick on dc0 proto tcp from any to any port = 22 flags S keep state

# Block and log only first occurrence of all remaining traffic
# coming into the firewall. The logging of only the first
# occurrence avoids filling up disk with Denial of Service logs.
# This rule implements the default block.
block in log first quick on dc0 all
################### End of rules file #####################################</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99430992"></a>30.5.14. <acronym class="acronym">NAT</acronym></h3></div></div></div><a id="idp99431760" class="indexterm"></a><a id="idp99432272" class="indexterm"></a><a id="idp99433424" class="indexterm"></a><p>Το <acronym class="acronym">NAT</acronym> είναι ακρωνύμιο των λέξεων
	<span class="emphasis"><em>Network Address Translation</em></span> ή Μετάφραση
	Διευθύνσεων Δικτύου.  Για όσους είναι εξοικειωμένοι με το <span class="trademark">Linux</span>(R),
	βασίζεται στην αρχή του IP Masquerading.  Στην πραγματικότητα το
	<acronym class="acronym">NAT</acronym> και το IP Masquerading είναι το ίδιο πράγμα.
	Μια από τις πολλές δυνατότητες που παρέχει η λειτουργία
	<acronym class="acronym">NAT</acronym> του IPF, είναι και η δυνατότητα να έχουμε ένα
	ιδιωτικό τοπικό δίκτυο (LAN) πίσω από το firewall το οποίο να
	μοιράζεται μια μοναδική δημόσια διεύθυνση IP στο Internet.</p><p>Ίσως να αναρωτηθείτε γιατί να θέλει κάποιος να το κάνει αυτό.
	Οι ISPs συνήθως αποδίδουν δυναμικές διευθύνσεις σε μη εταιρικούς
	πελάτες.  Αυτό ουσιαστικά σημαίνει ότι η διεύθυνση IP που
	αποδίδεται στο μηχάνημα σας, μπορεί να είναι διαφορετική κάθε φορά
	που κάνετε κλήση για να συνδεθείτε.  Για τους χρήστες DSL modem και
	router, η αλλαγή διεύθυνσης πραγματοποιείται κάθε φορά που
	ενεργοποιείται το modem.  Η διεύθυνση IP που σας αποδίδεται από
	τον ISP σας, είναι αυτή με την οποία φαίνεστε στο Internet.</p><p>Ας υποθέσουμε τώρα ότι έχετε πέντε PC στο σπίτι σας, και
	χρειάζεστε σε όλα σύνδεση Internet.  Κανονικά, θα έπρεπε να πληρώσετε
	τον ISP σας χωριστό λογαριασμό για κάθε PC και να διαθέτετε πέντε
	γραμμές τηλεφώνου.</p><p>Με το <acronym class="acronym">NAT</acronym>, χρειάζεστε μόνο ένα λογαριασμό με
	τον ISP σας.  Μπορείτε απλώς να συνδέσετε τα τέσσερα PC σε ένα
	διανομέα ή switch στο οποίο θα συνδέσετε επίσης και το FreeBSD μηχάνημα
	σας.  Το μηχάνημα αυτό θα ενεργεί ως πύλη του τοπικού σας δικτύου για
	το Internet.  Το <acronym class="acronym">NAT</acronym> θα μεταφράσει αυτόματα τις
	ιδιωτικές διευθύνσεις IP του κάθε μηχανήματος στην μοναδική δημόσια
	IP διεύθυνση που έχετε, καθώς το πακέτο φεύγει από το firewall και
	κατευθύνεται προς το Internet.  Εκτελεί επίσης και την αντίστροφη
	μετάφραση για τα πακέτα που επιστρέφουν.</p><p>Υπάρχει μια ειδική περιοχή διευθύνσεων IP που έχουν παραχωρηθεί
	για χρήση σε τοπικά δίκτυα με <acronym class="acronym">NAT</acronym>.  Σύμφωνα με το
	RFC 1918, μπορείτε να χρησιμοποιήσετε για αυτό το σκοπό τις παρακάτω
	περιοχές, οι οποίες δεν δρομολογούνται ποτέ απευθείας στο δημόσιο
	Internet:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /></colgroup><tbody><tr><td>Αρχικό IP <code class="systemitem">10.0.0.0</code></td><td>-</td><td>Τελικό IP <code class="systemitem">10.255.255.255</code></td></tr><tr><td>Αρχικό IP <code class="systemitem">172.16.0.0</code></td><td>-</td><td>Τελικό IP <code class="systemitem">172.31.255.255</code></td></tr><tr><td>Αρχικό IP <code class="systemitem">192.168.0.0</code></td><td>-</td><td>Τελικό IP <code class="systemitem">192.168.255.255</code></td></tr></tbody></table></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99453776"></a>30.5.15. IP<acronym class="acronym">NAT</acronym></h3></div></div></div><a id="idp99454672" class="indexterm"></a><a id="idp99455824" class="indexterm"></a><p>Οι κανόνες του <acronym class="acronym">NAT</acronym> φορτώνονται με τη χρήση της
	εντολής <code class="command">ipnat</code>.  Τυπικά, οι κανόνες του
	<acronym class="acronym">NAT</acronym> αποθηκεύονται στο αρχείο
	<code class="filename">/etc/ipnat.rules</code>.  Δείτε τη σελίδα manual του
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipnat&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ipnat</span>(1)</span></a> για λεπτομέρειες.</p><p>Για να αλλάξετε τους κανόνες του <acronym class="acronym">NAT</acronym> καθώς αυτό
	εκτελείται, τροποποιήστε το αρχείο που τους περιέχει, και εκτελέστε
	την εντολή <code class="command">ipnat</code> με την παράμετρο
	<code class="option">-CF</code> για να διαγράψετε τους εσωτερικούς κανόνες του
	<acronym class="acronym">NAT</acronym> και να αδειάσετε όλες τις ενεργές καταχωρίσεις
	του πίνακα μεταφράσεων.</p><p>Για να φορτώσετε τους κανόνες του <acronym class="acronym">NAT</acronym> από την
	αρχή, εκτελέστε μια εντολή όπως την παρακάτω:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -CF -f /etc/ipnat.rules</code></strong></pre><p>Για να δείτε κάποια στατιστικά σχετικά με το
	<acronym class="acronym">NAT</acronym>, χρησιμοποιήστε την παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -s</code></strong></pre><p>Για να δείτε μια λίστα με τις τρέχουσες καταχωρίσεις του πίνακα
	<acronym class="acronym">NAT</acronym>, χρησιμοποιήστε την παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -l</code></strong></pre><p>Για να ενεργοποιήσετε την λεπτομερή απεικόνιση μηνυμάτων και να
	δείτε πληροφορίες που σχετίζονται με την επεξεργασία των κανόνων και
	τους ενεργούς κανόνες και καταχωρίσεις στον πίνακα, γράψτε:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ipnat -v</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99471952"></a>30.5.16. Κανόνες του IP<acronym class="acronym">NAT</acronym></h3></div></div></div><p>Οι κανόνες του <acronym class="acronym">NAT</acronym> είναι αρκετά ευέλικτοι,
	και διαθέτουν πλήθος δυνατοτήτων ώστε να καλύπτουν τις ανάγκες
	των οικιακών αλλά και των επιχειρησιακών χρηστών.</p><p>Η σύνταξη των κανόνων που παρουσιάζεται εδώ, έχει απλοποιηθεί
	ώστε να συμβαδίζει με τη συνήθη χρήση σε μη-εμπορικά περιβάλλοντα.
	Για πιο πλήρη περιγραφή της σύνταξης, δείτε τη σελίδα manual του
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ipnat&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ipnat</span>(5)</span></a>.</p><p>Η σύνταξη ενός κανόνα <acronym class="acronym">NAT</acronym> μοιάζει με την
	παρακάτω:</p><pre class="programlisting">map <em class="replaceable"><code>IF</code></em> <em class="replaceable"><code>LAN_IP_RANGE</code></em> -&gt; <em class="replaceable"><code>PUBLIC_ADDRESS</code></em></pre><p>Ο κανόνας ξεκινάει με τη λέξη <code class="literal">map</code>.</p><p>Αντικαταστήστε το <em class="replaceable"><code>IF</code></em> με την εξωτερική
	διεπαφή (τη κάρτα δικτύου που συνδέεται στο Internet).</p><p>Η παράμετρος <em class="replaceable"><code>LAN_IP_RANGE</code></em> είναι η
	περιοχή διευθύνσεων που χρησιμοποιείται από το εσωτερικό σας δίκτυο.
	Στην πραγματικότητα θα μοιάζει με κάτι σαν το <code class="systemitem">192.168.1.0/24</code>.</p><p>Η παράμετρος <em class="replaceable"><code>PUBLIC_ADDRESS</code></em> μπορεί να
	είναι είτε η εξωτερική IP διεύθυνση, είτε η ειδική λέξη
	<code class="literal">0/32</code>, η οποία σημαίνει ότι θα χρησιμοποιηθεί η
	IP διεύθυνση που έχει αποδοθεί στο
	<em class="replaceable"><code>IF</code></em>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99485648"></a>30.5.17. Πως Λειτουργεί το <acronym class="acronym">NAT</acronym></h3></div></div></div><p>Ένα πακέτο φτάνει στο firewall από το LAN με προορισμό το
	Internet.  Περνάει διαμέσου των κανόνων φιλτραρίσματος εξερχομένων,
	όπου γίνεται η επεξεργασία του από το <acronym class="acronym">NAT</acronym>.
	Οι κανόνες εφαρμόζονται από τον πρώτο και προς τα κάτω, και κερδίζει
	ο πρώτος που ταιριάζει.  Ο έλεγχος γίνεται με βάση τη διεπαφή από την
	οποία λήφθηκε το πακέτο και τη διεύθυνση IP από την οποία προέρχεται.
	Όταν το όνομα της διεπαφής ενός πακέτου ταιριάζει με κάποιο κανόνα του
	<acronym class="acronym">NAT</acronym>, η διεύθυνση IP της αφετηρίας (που προέρχεται
	από το ιδιωτικό δίκτυο) ελέγχεται για να εξακριβωθεί αν ταιριάζει με
	την περιοχή διευθύνσεων που καθορίζεται στην αριστερά πλευρά του
	συμβόλου (βέλος) του κανόνα <acronym class="acronym">NAT</acronym>.  Αν ταιριάζει, η
	διεύθυνση του πακέτου ξαναγράφεται, χρησιμοποιώντας τη δημόσια
	διεύθυνση IP η οποία παρέχεται από το <code class="literal">0/32</code>.  Το
	<acronym class="acronym">NAT</acronym> δημιουργεί μια καταχώριση στον εσωτερικό του
	πίνακα, έτσι ώστε όταν επιστρέψει η απάντηση από το Internet, να
	μπορεί να αντιστοιχηθεί ξανά στην αρχική ιδιωτική διεύθυνση IP και να
	περάσει έπειτα από τους κανόνες του φίλτρου για περαιτέρω
	επεξεργασία.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99488976"></a>30.5.18. Ενεργοποιώντας το IP<acronym class="acronym">NAT</acronym></h3></div></div></div><p>Για να ενεργοποιήσετε το IP<acronym class="acronym">NAT</acronym>, προσθέστε τις
	παρακάτω γραμμές στο <code class="filename">/etc/rc.conf</code>.</p><p>Για να επιτρέψετε στο μηχάνημα σας να δρομολογεί πακέτα μεταξύ
	διεπαφών δικτύου:</p><pre class="programlisting">gateway_enable="YES"</pre><p>Για να ξεκινάει αυτόματα το IP<acronym class="acronym">NAT</acronym> σε κάθε
	εκκίνηση:</p><pre class="programlisting">ipnat_enable="YES"</pre><p>Για να καθορίσετε από που επιθυμείτε να φορτώνονται οι κανόνες
	του IP<acronym class="acronym">NAT</acronym>:</p><pre class="programlisting">ipnat_rules="/etc/ipnat.rules"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99494480"></a>30.5.19. Το <acronym class="acronym">NAT</acronym> σε Ένα Μεγάλο Τοπικό Δίκτυο</h3></div></div></div><p>Για τοπικά δίκτυα με μεγάλο αριθμό υπολογιστών, ή για δίκτυα που
	διασυνδέουν περισσότερα από ένα LAN, η διαδικασία της μετατροπής όλων
	αυτών των ιδιωτικών διευθύνσεων σε μια μοναδική δημόσια διεύθυνση,
	δημιουργεί πρόβλημα κατανομής πόρων, καθώς χρησιμοποιούνται πολλές
	φορές οι ίδιοι αριθμοί θυρών, οδηγώντας τα PC του δικτύου σε
	συγκρούσεις.  Υπάρχουν δύο τρόποι για να ελαττώσουμε αυτό το
	πρόβλημα.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99495888"></a>30.5.19.1. Ανάθεση των θυρών που θα Χρησιμοποιηθούν</h4></div></div></div><p>Ένα συνηθισμένος κανόνας NAT μοιάζει με τον παρακάτω:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 0/32</pre><p>Στον παραπάνω κανόνα, η θύρα αφετηρίας του πακέτου παραμένει
	  αναλλοίωτη καθώς το πακέτο διέρχεται μέσω του
	  IP<acronym class="acronym">NAT</acronym>.  Αν προσθέσετε την λέξη-κλειδί
	  <code class="literal">portmap</code>, μπορείτε να ρυθμίσετε το
	  IP<acronym class="acronym">NAT</acronym> να χρησιμοποιεί θύρες που ανήκουν σε μια
	  καθορισμένη περιοχή.  Για παράδειγμα, ο παρακάτω κανόνας θα
	  οδηγήσει το <acronym class="acronym">NAT</acronym> να τροποποιήσει την θύρα της
	  αφετηρίας, ώστε να είναι μέσα στην περιοχή που φαίνεται:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp 20000:60000</pre><p>Μπορούμε επίσης να απλοποιήσουμε ακόμα περισσότερο τη
	  διαδικασία χρησιμοποιώντας τη λέξη <code class="literal">auto</code> ώστε το
	  IP<acronym class="acronym">NAT</acronym> να καθορίζει από μόνο του ποιες θύρες είναι
	  διαθέσιμες για χρήση:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp auto</pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99502032"></a>30.5.19.2. Χρησιμοποιώντας ένα Απόθεμα Δυναμικών Διευθύνσεων</h4></div></div></div><p>Σε ένα πολύ μεγάλο τοπικό δίκτυο, αργά ή γρήγορα φτάνουμε στο
	  σημείο που μια μοναδική δημόσια διεύθυνση δεν επαρκεί για να καλύψει
	  τόσες πολλές ιδιωτικές.  Αν υπάρχει διαθέσιμο ένα εύρος δημοσίων
	  διευθύνσεων, μπορούν να χρησιμοποιηθούν ως
	  <span class="quote">«<span class="quote">απόθεμα (pool)</span>»</span>, επιτρέποντας στην
	  IP<acronym class="acronym">NAT</acronym> να επιλέξει μια από αυτές καθώς αντιστοιχεί
	  τα πακέτα κατά την έξοδο τους προς το δημόσιο δίκτυο.</p><p>Για παράδειγμα, αντί να αντιστοιχούν όλα τα πακέτα μέσω μιας
	  μοναδικής δημόσιας IP διεύθυνσης όπως παρακάτω:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 204.134.75.1</pre><p>μπορούμε να χρησιμοποιήσουμε ένα εύρος IP διευθύνσεων, είτε με
	  τη χρήση μάσκας δικτύου:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 204.134.75.0/255.255.255.0</pre><p>είτε με συμβολισμό CIDR:</p><pre class="programlisting">map dc0 192.168.1.0/24 -&gt; 204.134.75.0/24</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99506384"></a>30.5.20. Ανακατεύθυνση Θυρών</h3></div></div></div><p>Είναι κοινή πρακτική να εγκαθίστανται υπηρεσίες όπως ο
	εξυπηρετητής ιστοσελίδων, ταχυδρομείου, βάσης δεδομένων και DNS σε
	διαφορετικά PC στο τοπικό δίκτυο.  Στην περίπτωση αυτή, η κίνηση
	πακέτων από αυτά τα μηχανήματα εξακολουθεί να χρειάζεται το
	<acronym class="acronym">NAT</acronym>, αλλά χρειάζεται επίσης να υπάρχει κάποιος
	τρόπος να κατευθύνεται η εισερχόμενη κίνηση στα σωστά PC του δικτύου.
	Το IP<acronym class="acronym">NAT</acronym> έχει τις κατάλληλες δυνατότητες για την
	επίλυση αυτού του προβλήματος.  Για παράδειγμα, έστω ότι ένας
	εξυπηρετητής ιστοσελίδων βρίσκεται στην διεύθυνση LAN <code class="systemitem">10.0.10.25</code> και η μοναδική δημόσια IP
	είναι <code class="systemitem">20.20.20.5</code>.  Ο κανόνας που θα
	γράφατε θα έμοιαζε με τον παρακάτω:</p><pre class="programlisting">rdr dc0 20.20.20.5/32 port 80 -&gt; 10.0.10.25 port 80</pre><p>ή:</p><pre class="programlisting">rdr dc0 0.0.0.0/0 port 80 -&gt; 10.0.10.25 port 80</pre><p>ή για ένα εξυπηρετητή DNS με διεύθυνση στο τοπικό δίκτυο <code class="systemitem">10.0.10.33</code> ο οποίος πρέπει να δέχεται
	  αναζητήσεις από το δημόσιο δίκτυο:</p><pre class="programlisting">rdr dc0 20.20.20.5/32 port 53 -&gt; 10.0.10.33 port 53 udp</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99516112"></a>30.5.21. FTP και <acronym class="acronym">NAT</acronym></h3></div></div></div><p>Το FTP είναι ένας δεινόσαυρος που έχει απομείνει από την εποχή
	που το Internet ήταν στα αρχικά του στάδια, όπου τα ερευνητικά
	εργαστήρια των πανεπιστήμιων ήταν συνδεμένα μεταξύ τους με
	μισθωμένες γραμμές και οι ερευνητές το χρησιμοποιούσαν για να
	στέλνουν αρχεία ο ένας στον άλλο.  Την εποχή εκείνη, δεν υπήρχαν
	ανησυχίες σχετικά με την ασφάλεια.  Με το πέρασμα του χρόνου, το
	FTP θάφτηκε στο πίσω μέρος του ταχέως εξελισσόμενου Internet.  Δεν
	εξελίχθηκε ποτέ ώστε να ξεπεράσει προβλήματα ασφάλειας, όπως π.χ. το
	γεγονός ότι στέλνει το όνομα και τον κωδικό του χρήστη ως απλό
	κείμενο.  Το FTP έχει δυο καταστάσεις λειτουργίας, την ενεργή και την
	παθητική.  Η διαφορά είναι στο πως γίνεται η ανάκτηση του καναλιού
	δεδομένων.  Η παθητική λειτουργία είναι πιο ασφαλής, καθώς το
	κανάλι δεδομένων αποτελεί το κύριο κανάλι της συνεδρίας.  Μπορείτε να
	βρείτε πολύ καλή περιγραφή του πρωτοκόλλου και των διαφορετικών τρόπων
	λειτουργίας του, στο <code class="uri"><a class="uri" href="http://www.slacksite.com/other/ftp.html" target="_top">http://www.slacksite.com/other/ftp.html</a></code>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99517904"></a>30.5.21.1. Κανόνες του IP<acronym class="acronym">NAT</acronym></h4></div></div></div><p>Το IP<acronym class="acronym">NAT</acronym> διαθέτει μια ειδική επιλογή για
	  διαμεσολάβηση FTP (proxy) η οποία μπορεί να καθοριστεί στον
	  κατάλληλο κανόνα του <acronym class="acronym">NAT</acronym>.  Μπορεί να
	  παρακολουθήσει όλα τα εξερχόμενα πακέτα για να ανιχνεύσει την
	  έναρξη μιας ενεργής ή παθητικής συνεδρίας FTP, και να δημιουργήσει
	  δυναμικά προσωρινούς κανόνες στο φίλτρο που να περιέχουν μόνο τον
	  αριθμό της θύρας που χρησιμοποιείται από το κανάλι δεδομένων.  Αυτό
	  εξαλείφει το πρόβλημα ασφάλειας που δημιουργείται από το γεγονός
	  ότι διαφορετικά θα χρειαζόταν να ανοιχθεί μια μεγάλη περιοχή θυρών
	  (στην υψηλή περιοχή) στο firewall.</p><p>Ο παρακάτω κανόνας χειρίζεται όλα τα δεδομένα για το εσωτερικό
	  δίκτυο (LAN):</p><pre class="programlisting">map dc0 10.0.10.0/29 -&gt; 0/32 proxy port 21 ftp/tcp</pre><p>Ο παρακάτω κανόνας χειρίζεται την κίνηση FTP από την
	  πύλη (gateway):</p><pre class="programlisting">map dc0 0.0.0.0/0 -&gt; 0/32 proxy port 21 ftp/tcp</pre><p>Ο παρακάτω κανόνας χειρίζεται όλη την κίνηση από το εσωτερικό
	  LAN που δεν ανήκει στο πρωτόκολλο FTP:</p><pre class="programlisting">map dc0 10.0.10.0/29 -&gt; 0/32</pre><p>Ο κανόνας χαρτογράφησης του FTP τοποθετείται πριν από τον
	  κανονικό κανόνα χαρτογράφησης.  Κάθε πακέτο ελέγχεται αρχικά από
	  τον κανόνα που βρίσκεται στην κορυφή.  Αν ταιριάζει στη διεπαφή και
	  στην ιδιωτική διεύθυνση IP και πρόκειται για πακέτο FTP,
	  ο διαμεσολαβητής FTP δημιουργεί προσωρινούς κανόνες στο φίλτρο
	  οι οποίοι επιτρέπουν την εισερχόμενη και εξερχόμενη κίνηση FTP ενώ
	  ταυτόχρονα εκτελούν και την απαραίτητη μετάφραση
	  <acronym class="acronym">NAT</acronym>.  Όλα τα πακέτα που δεν ανήκουν σε μετάδοση
	  FTP δεν ταιριάζουν με τον πρώτο κανόνα, έτσι κατευθύνονται στον
	  τρίτο κανόνα, εξετάζονται όσο αφορά τη διεπαφή και το IP από το
	  οποίο προέρχονται, και γίνεται η αντίστοιχη μετάφραση τους από το
	  <acronym class="acronym">NAT</acronym>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp99523792"></a>30.5.21.2. Κανόνες Φίλτρου για το IP<acronym class="acronym">NAT</acronym></h4></div></div></div><p>Όταν χρησιμοποιείται ο μεσολαβητής FTP, χρειάζεται μόνο ένας
	  κανόνας για το <acronym class="acronym">NAT</acronym>.</p><p>Χωρίς το μεσολαβητή FTP, χρειάζονται οι παρακάτω τρεις
	  κανόνες:</p><pre class="programlisting"># Allow out LAN PC client FTP to public Internet
# Active and passive modes
pass out quick on rl0 proto tcp from any to any port = 21 flags S keep state

# Allow out passive mode data channel high order port numbers
pass out quick on rl0 proto tcp from any to any port &gt; 1024 flags S keep state

# Active mode let data channel in from FTP server
pass in quick on rl0 proto tcp from any to any port = 20 flags S keep state</pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="firewalls-pf.html">Προηγ</a> </td><td width="20%" align="center"><a accesskey="u" href="firewalls.html">Πάνω</a></td><td width="40%" align="right"> <a accesskey="n" href="firewalls-ipfw.html">Επόμενο</a></td></tr><tr><td width="40%" align="left" valign="top">30.4. Το Packet Filter (PF) και το <acronym class="acronym">ALTQ</acronym> του
      OpenBSD </td><td width="20%" align="center"><a accesskey="h" href="index.html">Αρχή</a></td><td width="40%" align="right" valign="top"> 30.6. IPFW</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Αυτό το κείμενο, και άλλα κείμενα, μπορεί να βρεθεί στο
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Για ερωτήσεις σχετικά με το FreeBSD, διαβάστε την
    <a href="http://www.FreeBSD.org/docs.html">τεκμηρίωση</a> πριν να επικοινωνήσετε με την
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Για ερωτήσεις σχετικά με αυτή την τεκμηρίωση, στείλτε e-mail στην
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>