<?xml version="1.0" encoding="iso-8859-7" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-7" /><title>11.7. Προχωρημένα Θέματα</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Εγχειρίδιο του FreeBSD" /><link rel="up" href="linuxemu.html" title="Κεφάλαιο 11. Συμβατότητα με Εκτελέσιμα του Linux" /><link rel="prev" href="linuxemu-oracle.html" title="11.6. Εγκατάσταση της Oracle(R)" /><link rel="next" href="system-administration.html" title="Μέρος III. Διαχείριση Συστήματος" /><link rel="copyright" href="legalnotice.html" title="Νομική Σημείωση" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">11.7. Προχωρημένα Θέματα</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="linuxemu-oracle.html">Προηγ</a> </td><th width="60%" align="center">Κεφάλαιο 11. Συμβατότητα με Εκτελέσιμα του Linux</th><td width="20%" align="right"> <a accesskey="n" href="system-administration.html">Επόμενο</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-advanced"></a>11.7. Προχωρημένα Θέματα</h2></div></div></div><p>Αν έχετε την απορία πως λειτουργεί η συμβατότητα με εφαρμογές Linux,
      τότε θα πρέπει να διαβάσετε τη παρακάτω ενότητα. Τα περισσότερα από όσα
      έχουν γραφτεί είναι βασισμένα στην <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat" target="_top">ηλεκτρονική λίστα γενικών συζητήσεων του FreeBSD</a> και έχουν γραφτεί από τον
      Terry Lambert <code class="email">&lt;<a xmlns="" class="email" href="mailto:tlambert@primenet.com">tlambert@primenet.com</a>&gt;</code> (Message ID:
      <code class="literal">&lt;199906020108.SAA07001@usr09.primenet.com&gt;</code>).
    </p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85276496"></a>11.7.1. Πως Λειτουργεί;</h3></div></div></div><a id="idp85277136" class="indexterm"></a><p>Το FreeBSD περιέχει ένα επίπεδο αφαίρεσης (abstraction) που
	ονομάζεται <span class="quote">«<span class="quote">execution class loader</span>»</span>. Αυτό βασίζεται στο
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a>.</p><p>Αυτό που συμβαίνει είναι ότι το FreeBSD έχει μια λίστα φορτωτών
	(loaders), αντί για ένα που να καταφεύγει σε περίπτωση αποτυχίας
	στο <code class="literal">#!</code> για να τρέξει κάποιο shell interpreter ή
	shell script.</p><p>Ιστορικά, ο μόνος φορτωτής στη πλατφόρμα του <span class="trademark">UNIX</span>(R) έλεγχε τον
	μαγικό αριθμό (γενικά τα πρώτα 4 ή 8 bytes του αρχείου) για να δει αν
	είναι κάποιο εκτελέσιμο / εφαρμογή γνωστό στο σύστημα, και στην
        περίπτωση αυτή να καλέσει τον αντίστοιχο φορτωτή.</p><p>Αν το αρχείο δεν ήταν εκτελέσιμο με βάση τον τύπο του συστήματος,
        η κλήση στο <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> επέστρεφε κάποιο σφάλμα, και το shell
        προσπαθούσε να εκτελέσει το αρχείο σαν shell script.</p><p>Η γενική ιδέα ήταν <span class="quote">«<span class="quote">αν δεν είναι εκτελέσιμο,
        προσπάθησε να το τρέξεις ως shell script με βάση το τρέχον shell
	</span>»</span>.</p><p>Αργότερα, βρέθηκε ένας έξυπνος τρόπος ώστε το <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> να
        ελέγχει τους πρώτους δύο χαρακτήρες, και αν ήταν
        <code class="literal">:\n</code>, τότε καλούσε το shell <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a>
        (πιστεύουμε πως η λύση αυτή βρέθηκε αρχικά από τη SCO).</p><p>Αυτό που κάνει τώρα το FreeBSD είναι να διατρέχει τη λίστα με όλους
	τους φορτωτές, με ένα γενικό φορτωτή <code class="literal">#!</code> ο οποίος
	αναγνωρίζει ως διερμηνέα (interpreter) τους χαρακτήρες από το επόμενο
        κενό μετά το <code class="literal">!</code> και μέχρι το τέλος, ενώ αν δεν
        αναγνωριστεί κάποιος, χρησιμοποιείται ως έσχατη λύση το
        <code class="filename">/bin/sh</code>.</p><a id="idp85295056" class="indexterm"></a><p>Για την υποστήριξη του Linux ABI, το FreeBSD βλέπει τον μαγικό
	αριθμό του ELF binary (δε αναγνωρίζει τη διαφορά ανάμεσα  σε
        FreeBSD, <span class="trademark">Solaris</span>TM, Linux, ή κάποιο άλλο λειτουργικό σύστημα το οποίο
        χρησιμοποιεί αρχεία τύπου ELF).</p><a id="idp85296336" class="indexterm"></a><p>Ο φορτωτής ELF κοιτάει για ένα ειδικό <span class="emphasis"><em>brand</em></span>,
	το οποίο είναι μια ενότητα σχολίων μέσα στο ELF image, και το οποίο
        δεν υπάρχει σε ELF binaries για SVR4/<span class="trademark">Solaris</span>TM</p><p>Για να λειτουργήσουν τα εκτελέσιμα του Linux, θα πρέπει να
	γίνουν <span class="emphasis"><em>branded</em></span> (μαρκαριστούν)  ως
        <code class="literal">Linux</code> μέσω της <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>brandelf -t Linux file</code></strong></pre><p>Όταν γίνει αυτό, ο φορτωτής ELF θα βλέπει το
        <code class="literal">Linux</code> brand πάνω στο αρχείο.</p><a id="idp85301712" class="indexterm"></a><p>Όταν ο φορτωτής ELF δει το <code class="literal">Linux</code> brand, θα
	αντικαταστήσει έναν δείκτη μέσα στη δομή <code class="literal">proc</code>.
        Όλες οι  κλήσεις του συστήματος ταξινομούνται μέσα από αυτόν τον
        δείκτη (σε ένα παραδοσιακό σύστημα <span class="trademark">UNIX</span>(R), ο δείκτης θα ήταν ο
	πίνακας <code class="literal">sysent[]</code>, που περιέχει τις κλήσεις
	του συστήματος (system calls)). Επιπλέον, η διεργασία σημειώνεται για
	ειδική μεταχείριση του trap vector και άλλες (μικρές) διορθώσεις,
        τις οποίες χειρίζεται το άρθρωμα πυρήνα της συμβατότητας Linux.</p><p>Το system call vector του  Linux περιέχει, μεταξύ άλλων, μια λίστα
        με τα δεδομένα του <code class="literal">sysent[]</code> των οποίων
        οι διευθύνσεις βρίσκονται μέσα στο άρθρωμα του πυρήνα.</p><p>Όταν γίνεται μια κλήση συστήματος από μια εφαρμογή Linux, ο
	κώδικας (trap code) τροποποιεί τον δείκτη της μέσω της δομής που έχει
        εγγραφεί στο <code class="literal">proc</code>, και αλλάζει την διεύθυνση ώστε
        να δείχνει στο σημείο εισόδου της συνάρτησης του Linux, και όχι του
        FreeBSD.</p><p>Επίσης, το σύστημα συμβατότητας με Linux μπορεί και προσαρμόζει
        δυναμικά τις τοποθεσίες αναζήτησης. Ουσιαστικά αυτό κάνει και η
	επιλογή <code class="option">union</code> κατά την προσάρτηση ενός συστήματος
        αρχείων (<span class="emphasis"><em>δεν</em></span> εννοούμε εδώ το σύστημα
	αρχείων <code class="literal">unionfs</code>!). Αρχικά, γίνεται απόπειρα να
	βρεθεί το αρχείο στον κατάλογο
	<code class="filename">/compat/linux/original-path</code>, <span class="emphasis"><em>και μόνο</em></span>
	αν αυτό αποτύχει, θα γίνει αναζήτηση στον κατάλογο
	<code class="filename">/original-path</code>. Με
        τον τρόπο αυτό σιγουρεύουμε ότι τα εκτελέσιμα που χρειάζονται άλλα
        εκτελέσιμα θα τρέξουν (για παράδειγμα, το σύνολο εργαλείων του
        Linux μπορεί να εκτελεστεί μέσω της υποστήριξης του Linux ABI). Επίσης
        σημαίνει ότι τα εκτελέσιμα του Linux μπορούν να φορτώσουν και να
        εκτελέσουν αρχεία του FreeBSD αν δεν μπορούν να εντοπίσουν τα αντίστοιχα
        αρχεία στο Linux. Μπορείτε επίσης να τοποθετήσετε μια εντολή
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=uname&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">uname</span>(1)</span></a> μέσα στο <code class="filename">/compat/linux</code> προκειμένου
        τα αρχεία του Linux να μη μπορούν να αναγνωρίσουν ότι δεν
        χρησιμοποιούνται πραγματικά σε Linux.</p><p>Ουσιαστικά, υπάρχει ένας πυρήνας Linux μέσα στον πυρήνα
	του FreeBSD.  Οι διάφορες λειτουργίες οι οποίες υλοποιούν όλες τις
	υπηρεσίες που παρέχονται από τον πυρήνα είναι ίδιες τόσο στον πίνακα
        κλήσεων συστήματος του FreeBSD όσο και στον αντίστοιχο του Linux:
	λειτουργίες του συστήματος αρχείων, εικονική μνήμη, διαχείριση
        σημάτων, System V IPC κλπ.  Η μόνη διαφορά είναι ότι το εκτελέσιμα
        του FreeBSD κάνουν χρήση των συναρτήσεων <span class="emphasis"><em>glue</em></span> του
        FreeBSD, ενώ τα εκτελέσιμα του Linux, κάνουν χρήση των συναρτήσεων
        <span class="emphasis"><em>glue</em></span> του Linux (πολλά από τα παλιά λειτουργικά
        είχαν τις δικές τους συναρτήσεις <span class="emphasis"><em>glue</em></span>: οι
        διευθύνσεις των συναρτήσεων βρίσκονταν στο στατικό πίνακα
        <code class="literal">sysent[]</code>, αντί να διευκρινίζονται μέσω ενός
        δυναμικού δείκτη στη δομή <code class="literal">proc</code> της διεργασίας που
        πραγματοποιεί την κλήση).</p><p>Ποιο είναι όμως το εγγενές FreeBSD ABI; Δεν έχει και πολύ σημασία.
	Η μόνη βασική διαφορά είναι (κάτι το οποίο μπορεί εύκολα να
	αλλάξει σε μελλοντικές εκδόσεις, και πολύ πιθανόν να αλλάξει) ότι
        οι συναρτήσεις <span class="emphasis"><em>glue</em></span> του FreeBSD είναι στατικά
        συνδεδεμένες στο πυρήνα, ενώ οι αντίστοιχες του Linux μπορούν είτε να
        είναι συνδεδεμένες στατικά, είτε να είναι προσβάσιμες μέσω ενός
        αρθρώματος πυρήνα.</p><p>Είναι αυτό όμως πραγματική εξομοίωση; Όχι.  Είναι μια υλοποίηση
	του ABI, όχι εξομοίωση. Δεν υπάρχει καμία εξομοίωση (ή προσομοίωση,
	για να προλάβουμε την επόμενη σας ερώτηση).</p><p>Τότε γιατί μερικές φορές μιλάμε για <span class="quote">«<span class="quote">εξομοίωση
	Linux</span>»</span>; Για να δυσκολευτεί η προώθηση του FreeBSD! Η αρχική
        υλοποίηση έγινε την εποχή όπου δεν υπήρχε άλλη λέξη που να μπορούσε
        να περιγράψει το τι ακριβώς γινόταν. Το να
	λέγαμε ότι το FreeBSD έτρεχε εκτελέσιμα Linux δεν θα ήταν αλήθεια,
        μια και χρειαζόταν να ενσωματωθεί κάποιος κώδικας στον πυρήνα, ή να
        φορτωθεί κάποιο άρθρωμα. Χρειαζόταν κάποια λέξη που να περιγράφει τι
	φορτωνόταν-έτσι προέκυψε ο <span class="quote">«<span class="quote">εξομοιωτής Linux</span>»</span>.
      </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="linuxemu-oracle.html">Προηγ</a> </td><td width="20%" align="center"><a accesskey="u" href="linuxemu.html">Πάνω</a></td><td width="40%" align="right"> <a accesskey="n" href="system-administration.html">Επόμενο</a></td></tr><tr><td width="40%" align="left" valign="top">11.6. Εγκατάσταση της <span class="trademark">Oracle</span>(R) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Αρχή</a></td><td width="40%" align="right" valign="top"> Μέρος III. Διαχείριση Συστήματος</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Αυτό το κείμενο, και άλλα κείμενα, μπορεί να βρεθεί στο
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Για ερωτήσεις σχετικά με το FreeBSD, διαβάστε την
    <a href="http://www.FreeBSD.org/docs.html">τεκμηρίωση</a> πριν να επικοινωνήσετε με την
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Για ερωτήσεις σχετικά με αυτή την τεκμηρίωση, στείλτε e-mail στην
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>