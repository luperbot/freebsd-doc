================================
21.2. ?? ??????? ??????? Z (ZFS)
================================

.. raw:: html

   <div class="navheader">

21.2. ?? ??????? ??????? Z (ZFS)
`????? <filesystems.html>`__?
???????? 21. ?????????? ?????????? ???????
?\ `??????? <filesystems-linux.html>`__

--------------

.. raw:: html

   </div>

.. raw:: html

   <div class="sect1">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

21.2. ?? ??????? ??????? Z (ZFS)
--------------------------------

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ??????? ??????? Z, ??????????? ??? ??? SunTM, ??? ????? ??? ???
?????????? ??? ??????????? ??? ?? ??????? ?????????? ???? ??? ???????
pool. ???? ???????? ??? ???? ? ????????? ????? ?????????? ?? ???????,
??? ?????????? ???????? ?? ???? ??????? ??????? ??????? ?? ??? ???????
??????????? ?????????. ???? ?????? ?????????? ??? ?? ??????? ???????????
????????? ??? ??????????? ??????????? (snapshots) ?????????, ????????
????????? ??? ?????????? ??????? ????????? (checksums). ???? ?????
????????? ??? ??? ??????? ??? ?? ????????? ?????????? ??? ?????????,
?????? ?? RAID-Z. ?? ??????? RAID-Z ????? ???????? ?? ?? RAID5 ????
????? ??????????? ?? ??????? ????????? ??? ????????? ???? ??? ???????
????.

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

21.2.1. ?????????????? ??? ZFS
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ?????????? ZFS ???????????? ???????? ?????? ??? ??????????.
???????????????? ??? ????????? ??? ?????????? ???, ?? ????????? ??
??????? ??????? ???? ?????????? ?????. ????? ?? ZFS ????? ????? ??
??????????? ?????? ??? FreeBSD, ???? ???? ??????? ??????????. ??????,
??? ??? ???, ?????????? ?? ???????????? ?? ???????? ??????:

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

21.2.1.1. ?????
^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ???????? ??????? ?????? ??? ?????????? ?????? ?? ????? ???????????
??? gigabyte, ??? ?? ??????????? ??????? ????? ??? gigabytes ? ???
???????????. ?? ??? ?? ???????????? ??? ????????? ???, ?? ??????? ????
??? gigabyte ?????? ??? ?????? ?????? ??????????????? ??? ????????? ???.

????????? ??????? ???????? ?? ?? ??????????? ??? ?? ???????? ??? ???
gigabyte ??????, ???? ?? ???????? ???????????? ??????? ??????, ?????
?????? ?????? ?? ???????????? panic ???? ??? ???? ?????? ????????,
???????? ?????????? ???.

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

21.2.1.2. ??????? ??? ??????
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?????????? ?? ?????????? ?? ??????????? ???????? ??? ??? ???????? ???
??? ?????????????? ??? ?? ?????? ????????? ??? ??????. ????? ??
???????????? ?????? ???????? ??????????? ?????? ??? ?? ????? ??????????,
???????? ?? ???? ????????? ??????????????? ?? ??????
``/boot/loader.conf``.

?? ??????? ??? ?????????????? i386TM ?? ?????? ?? ?????????? ???
???????? ??????? ??? ?????? ????????? ??? ?????? ????, ?? ???
??????????????????? ??? ?? ?????????????? ?? ??????? ????:

.. code:: programlisting

    options     KVA_PAGES=512

? ??????? ???? ?? ????????? ??? ??????? ??????????? ??? ??????,
???????????? ???? ??? ?????? ????? ??? ??????????? ??????????
``vm.kvm_size`` ???? ??? ?? ?????? ???? ??? 1?GB (2?GB ??? ??????? PAE).
??? ?? ?????? ??? ????????????? ???? ??? ???? ??? ???????, ????????? ??
????????? ??????? ??? ???????? ??????????? ?? ?? ??????? (4). ????
????????? ????, ?????? ``512`` ??? ??????? 2?GB.

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

21.2.1.3. ????????? ???? ?????????? ??? Loader
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ?????? ?? ??????? ? ??????? ??????????? ``kmem`` ?? ???? ???
?????????????? ??? FreeBSD. ??? ??????????? ??? ???????, ?? ??? gigabyte
??????? ??????, ?????? ??????????? ?????????? ??????????????? ???
????????? ???????? ??? ?????? ``/boot/loader.conf`` ??? ??????????????
?? ??????? ???:

.. code:: programlisting

    vm.kmem_size="330M"
    vm.kmem_size_max="330M"
    vfs.zfs.arc_max="40M"
    vfs.zfs.vdev.cache.size="5M"

??? ?????????????? ????????? ??????? ?? ??? ?????????????? ??? ZFS,
????? ?? ``http://wiki.freebsd.org/ZFSTuningGuide``.

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

21.2.2. ??????????????? ?? ZFS
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

??????? ???? ?????????? ????????? ??? ????????? ??? FreeBSD ??
??????????? ZFS pools ???? ?? ???????? ??? ????????? ??? ??????????. ???
?? ??? ?????????, ????????? ??? ????????? ???????:

.. code:: screen

    # echo 'zfs_enable="YES"' >> /etc/rc.conf
    # /etc/rc.d/zfs start

?? ???????? ????? ??? ???????? ???????? ??? ????? ??????????? ????? SCSI
???????, ??? ??? ?? ??????? ???????? ???? ????? ``da0``, ``da1`` ???
``da2``. ???? ????????? ??????? IDE ?? ?????? ?? ???????????????
???????? ??? ????? ``ad`` ???? ??? ??? ??????????? SCSI.

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

21.2.2.1. Pool ?? ??? ???? ?????
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

??? ??? ?????????? ???? ZFS pool ?? ??? ???? ????? (????? ??????????
?????? ?????????), ?????????????? ??? ?????? ``zpool``:

.. code:: screen

    # zpool create example /dev/da0

??? ?? ????? ?? ??? pool, ???????? ??? ????? ??? ??????? ``df``:

.. code:: screen

    # df
    Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
    /dev/ad0s1a   2026030  235230  1628718    13%    /
    devfs               1       1        0   100%    /dev
    /dev/ad0s1d  54098308 1032846 48737598     2%    /usr
    example      17547136       0 17547136     0%    /example

? ?????? ???? ??????? ?????? ??? ?? ``example`` pool ??? ???? ????
????????????, ???? ???? ?????? *???????????* ??????. ????? ??????
????????? ?? ???????? ??????? ???????, ???????? ?? ????????????? ??????
?? ????, ??? ????? ??????? ??????? ?????? ?? ?? ????, ???? ???????? ???
???????? ??????????:

.. code:: screen

    # cd /example
    # ls
    # touch testfile
    # ls -al
    total 4
    drwxr-xr-x   2 root  wheel    3 Aug 29 23:15 .
    drwxr-xr-x  21 root  wheel  512 Aug 29 23:12 ..
    -rw-r--r--   1 root  wheel    0 Aug 29 23:15 testfile

???????? ???? ?? pool ??? ???????????? ?????? ??? ?? ????????????? ???
ZFS. ???????????? ??? ??????? ??????? ?? ???? ?? pool ??? ?????????????
?? ???? ?? ????????:

.. code:: screen

    # zfs create example/compressed
    # zfs set compression=gzip example/compressed

?? ??????? ??????? ``example/compressed`` ????? ????? ??? ???????????
ZFS ???????. ????????? ?? ??????????? ?????? ?????? ?????? ?? ????,
????????? ???? ???????? ``/example/compressed``.

???????? ???? ?? ???????????????? ?? ???????? ?????????:

.. code:: screen

    # zfs set compression=off example/compressed

??? ?? ??????????????? ?? ??????? ???????, ????????? ??? ???????? ??????
??? ??????????? ?? ?????????? ???? ??? ?????????? ???????????? ``df``:

.. code:: screen

    # zfs umount example/compressed
    # df
    Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
    /dev/ad0s1a   2026030  235232  1628716    13%    /
    devfs               1       1        0   100%    /dev
    /dev/ad0s1d  54098308 1032864 48737580     2%    /usr
    example      17547008       0 17547008     0%    /example

??????????? ???? ?? ??????? ???????, ???? ?? ????? ??? ???? ??????????,
??? ??????????? ?? ??????????????? ???? ??? ????, ??? ?????? ``df``:

.. code:: screen

    # zfs mount example/compressed
    # df
    Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
    /dev/ad0s1a          2026030  235234  1628714    13%    /
    devfs                      1       1        0   100%    /dev
    /dev/ad0s1d         54098308 1032864 48737580     2%    /usr
    example             17547008       0 17547008     0%    /example
    example/compressed  17547008       0 17547008     0%    /example/compressed

???????? ?????? ?? ????? ?? pool ??? ?? ??????? ??????? ??????????? ???
????? ??? ??????? ``mount``:

.. code:: screen

    # mount
    /dev/ad0s1a on / (ufs, local)
    devfs on /dev (devfs, local)
    /dev/ad0s1d on /usr (ufs, local, soft-updates)
    example on /example (zfs, local)
    example/data on /example/data (zfs, local)
    example/compressed on /example/compressed (zfs, local)

???? ???????????, ?? ??????? ??????? ZFS ?????? ?? ?????????????? ??
????? ??????? ??????? ???? ?? ?????????? ???. ??????, ???????? ??????
????? ???????????. ??? ???????? ?????????? ???????????? ??? ??? ???????
???????, ?? ``data``. ?? ????????????? ????????? ???????? ?? ????, ???
???? ?? ?????????? ???? ?? ??????? ??? ????????? ??? ???? ?????
?????????:

.. code:: screen

    # zfs create example/data
    # zfs set copies=2 example/data

???????? ???? ?? ????? ?? ???????? ??? ??? ?????????? ????? ????????
???? ??? ?????? ``df``:

.. code:: screen

    # df
    Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
    /dev/ad0s1a          2026030  235234  1628714    13%    /
    devfs                      1       1        0   100%    /dev
    /dev/ad0s1d         54098308 1032864 48737580     2%    /usr
    example             17547008       0 17547008     0%    /example
    example/compressed  17547008       0 17547008     0%    /example/compressed
    example/data        17547008       0 17547008     0%    /example/data

??????????? ??? ???? ??????? ??????? ??? pool ??????? ?? ???? ???????
?????????? ?????. ????? ????? ??? ? ????? ??? ?????????????? ??? ??????
``df`` ?? ??? ?? ????????????, ??? ?? ???????? ??? ?? ????????? ???????
????????????? ???? ?? ???? ??? ??????????? ??? ??? ??? ??????????? ???
???? ???? (?? ??????????? ??????? - pool). ??? ??????? ??????? ZFS
??????? ???? ?? ????? (volumes) ??? ?? ??????????? (partitions) ???
????? ?????. ????????, ????? ????????? ??????? ??????????? ??? ????
????, ?? pool. ???????? ?? ??????????? ?? ??????? ??????? ??? ??????? ??
???? ?? pool ???? ??? ?? ?????????? ?????:

.. code:: screen

    # zfs destroy example/compressed
    # zfs destroy example/data
    # zpool destroy example

?? ??????? ?????? ?? ??? ????? ??????, ????? ???????????. ???? ????
?????? ???????, ?? ???????? ??? ????????. ??? ??????? ??? ?? ??????????
??? ??????? ????????? ???????? ???? ?????????? ?????? ????? ??
?????????????? ??? ????????? RAID. ?? pools ??? ZFS ????? ??????????
???? ?? ???????????? ???? ?? ??????????????. ? ?????????? ???? ?????????
???? ??????? ???????.

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

21.2.2.2. ZFS RAID-Z
^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

???? ????????? ????????????, ? ??????? ???? ??????????? ???
?????????????? ????? ???????? SCSI ?? ??????? ???????? ``da0``, ``da1``
??? ``da2``. ??? ?? ?????????????? ??? pool ????? RAID-Z, ????????? ???
???????? ??????:

.. code:: screen

    # zpool create storage raidz da0 da1 da2

.. raw:: html

   <div class="note" xmlns="">

????????:
~~~~~~~~~

? SunTM ??????? ?? ???????????????? ??? ????? ?? ????? ???????? ??
?????????? ????? RAID-Z. ?? ?????????? ?? ????????????? ??? pool ??
????????????? ??? ???? ???????, ????? ??????????? ?? ?? ???????? ??
?????? ??? ????????? RAID-Z pools. ?? ????????? ???? ??? ??????? ????
?????????? ??? ?????????? ?????? ?????????, ???? ????? ???????? ??
??????????????? ??? ZFS mirror. ????? ?? ?????? manual ???
`zpool(8) <http://www.FreeBSD.org/cgi/man.cgi?query=zpool&sektion=8>`__
??? ???????????? ????????????.

.. raw:: html

   </div>

?? ???????????? ?? ``storage`` zpool. ???????? ?? ???????????? ??
?????????? ???????????????, ???? ??? ????????????, ??? ???????
`mount(8) <http://www.FreeBSD.org/cgi/man.cgi?query=mount&sektion=8>`__
??? `df(1) <http://www.FreeBSD.org/cgi/man.cgi?query=df&sektion=1>`__.
?? ?????????? ?? ???????????????? ????????????? ???????, ???????????? ??
??????? ???????? ???? ??? ????? ??? ???????? ??????. ???????????? ???
??? ??????? ??????? ??? pool, ?? ????? ?? ?????????? ``home`` ??? ????
?? ????????????? ?????? ?? ?????? ??? ???????:

.. code:: screen

    # zfs create storage/home

???????? ???? ?? ??????????????? ??? ???????? ??? ?? ??????? ????????
????????? ??? ????????? ??? ??? ????????? ??? ???????. ???? ???
????????????, ???????? ?? ?? ?????????? ??????????????? ??? ????????
???????:

.. code:: screen

    # zfs set copies=2 storage/home
    # zfs set compression=gzip storage/home

??? ?? ????? ????? ? ???? ????????? ??? ???????, ?????????? ?? ????????
???? ?? ????? ??? ???????????? ???? ??????????? ??????????? ???????:

.. code:: screen

    # cp -rp /home/* /storage/home
    # rm -rf /home /usr/home
    # ln -s /storage/home /home
    # ln -s /storage/home /usr/home

?? ???????? ??? ??????? ?? ????????????? ???? ??? ??? ??????? ???????
``/storage/home``. ??? ?? ?? ????????????, ???????????? ??? ??? ??????
??? ????????? ??? ??????? ?? ?? ??? ??????????.

????????? ?? ????????????? ??? ??????????? (snapshot) ??? ????? ??
???????? ?? ?????????? ????????:

.. code:: screen

    # zfs snapshot storage/home@08-30-08

????????? ??? ? ??????? ??????????? ???????????? ?????????? ???? ??
?????????? ??????? ???????, ??? ??? ?? ?????? ?????????? ???????? ?
??????. ? ?????????? ``@`` ??????????????? ?? ???????????? ?????? ???
?????????? ??????? ??? ??? ???????? ?????. ?? ??????????? ? ?????????
????????? ??????? ?????? ????????????? ??? ?? ??? ??????:

.. code:: screen

    # zfs rollback storage/home@08-30-08

??? ?? ????? ??? ????? ??? ?????????? ????????????, ????????? ??? ??????
``ls`` ???? ???????? ``.zfs/snapshot`` ??? ?????????? ???????. ???
??????????, ??? ?? ????? ?? ??????????? ??? ????????????? ????????????,
????????? ??? ???????? ??????:

.. code:: screen

    # ls /storage/home/.zfs/snapshot

????? ??????? ?? ??????? ?????? script ??? ?? ?????????? ???????
??????????? ??? ????????? ??? ???????. ??????, ?? ??? ?????? ??? ??????,
?? ??????????? ?? ???????????? ?????? ??????? ??? ????? ??? ?????.
???????? ?? ?????????? ?? ??????????? ??????????? ??????????????? ???
???????? ??????:

.. code:: screen

    # zfs destroy storage/home@08-30-08

??? ??????? ?????, ???? ??? ???? ????? ??? ???????, ?? ?????????? ??
``/storage/home`` ???? ??????? ????????? ???. ?????????? ?? ???
?????????? ??????? ??????? ``/home``:

.. code:: screen

    # zfs set mountpoint=/home storage/home

??????????????? ??? ??????? ``df`` ??? ``mount`` ?? ????? ??? ?? ???????
?????????? ????? ???? ?? ??????? ??????? ?? ?? ?????????? ``/home``:

.. code:: screen

    # mount
    /dev/ad0s1a on / (ufs, local)
    devfs on /dev (devfs, local)
    /dev/ad0s1d on /usr (ufs, local, soft-updates)
    storage on /storage (zfs, local)
    storage/home on /home (zfs, local)
    # df
    Filesystem   1K-blocks    Used    Avail Capacity  Mounted on
    /dev/ad0s1a    2026030  235240  1628708    13%    /
    devfs                1       1        0   100%    /dev
    /dev/ad0s1d   54098308 1032826 48737618     2%    /usr
    storage       26320512       0 26320512     0%    /storage
    storage/home  26320512       0 26320512     0%    /home

??? ????????????? ? ??????? ??? RAID-Z. ??? ?? ??????? ????????
?????????? ??????? ?? ?? ????????? ??????? ???? ?? ????????? ????????
???
`periodic(8) <http://www.FreeBSD.org/cgi/man.cgi?query=periodic&sektion=8>`__,
????? ??? ???????? ??????:

.. code:: screen

    # echo 'daily_status_zfs_enable="YES"' >> /etc/periodic.conf

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

21.2.2.3. ???????? ??? RAID-Z
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

???? ????????? RAID ???? ??? ?????? ??? ???????? ??? ?????????? ???, ???
?? ZFS ??? ???????? ????????. ???????? ?? ????? ??? ????????? ???
???????? ??? RAID-Z ??????????????? ??? ???????? ??????:

.. code:: screen

    # zpool status -x

?? ??? ?? pools ????? ?? ???? ?????????, ?? ?????? ?? ???????? ??????:

.. code:: screen

    all pools are healthy

?? ??????? ?????? ????????, ?.?. ??????? ?????? ???? ???? ?????
???????????, ?? ????? ??? ????????? ??? ?????????? ?? ??? ?????? ???? ??
????????:

.. code:: screen

      pool: storage
     state: DEGRADED
    status: One or more devices has been taken offline by the administrator.
        Sufficient replicas exist for the pool to continue functioning in a
        degraded state.
    action: Online the device using 'zpool online' or replace the device with
        'zpool replace'.
     scrub: none requested
    config:

        NAME        STATE     READ WRITE CKSUM
        storage     DEGRADED     0     0     0
          raidz1    DEGRADED     0     0     0
            da0     ONLINE       0     0     0
            da1     OFFLINE      0     0     0
            da2     ONLINE       0     0     0

    errors: No known data errors

?? ???????? ??????? ??? ? ??????? ?????? ????? ??????????? ??? ???
???????????. ???? ????? ??????? ??? ?? ???????????? ??????????. ??? ??
????? ? ?????? ?????, ??????????????? ? ???????? ??????:

.. code:: screen

    # zpool offline storage da1

???????? ???? ?? ???????????????? ?? ????? ``da1`` ???? ???
?????????????? ??? ??????????. ???? ?? ??????? ????????? ?? ??????????,
???????? ?? ???????????????? ??? ???????? ?????? ??? ?? ???????????? ??
??????? ??? ??? ????????????? ??? ??????:

.. code:: screen

    # zpool replace storage da1

??? ???, ???????? ?? ????????? ???? ??? ?????????, ???? ?? ???? ?????
??? ??????? ``-x``:

.. code:: screen

    # zpool status storage
     pool: storage
     state: ONLINE
     scrub: resilver completed with 0 errors on Sat Aug 30 19:44:11 2008
    config:

        NAME        STATE     READ WRITE CKSUM
        storage     ONLINE       0     0     0
          raidz1    ONLINE       0     0     0
            da0     ONLINE       0     0     0
            da1     ONLINE       0     0     0
            da2     ONLINE       0     0     0

    errors: No known data errors

???? ???????? ??? ??????????, ?? ????? ???????? ?? ???????????
???????????.

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

21.2.2.4. ?????????? ?????????
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

???? ????????? ????????????, ?? ZFS ???????????? ``checksums``
(?????????? ???????) ??? ?? ??????????? ??? ??????????? ???
????????????? ?????????. ?? ?????????? ??????? ??????????????? ????????
???? ??? ?????????? ??? ?????????? ???????, ??? ??????? ??
???????????????? ???? ??? ???????? ???????:

.. code:: screen

    # zfs set checksum=off storage/home

???? ??? ????? ?????? ???? ????, ????? ?? checksums ?????????????
???????? ???????????? ????, ??? ????? ???? ??? ??????? ?? ?? ??????
??????????????. ?????? ??? ???????? ?? ????????? ?????? ?????????
??????????? ? ??????????. ?? ?? checksums ??????????????, ???????? ??
????????? ??? ?? ZFS ?? ??????? ??? ??????????? ??? ?????????
??????????????? ?? ??? ??????????. ? ?????????? ???? ????? ?????? ??
?scrubbing.? ??? ?? ???????? ??? ??????????? ????????? ??? pool
``storage``, ?????????????? ??? ???????? ??????:

.. code:: screen

    # zpool scrub storage

? ?????????? ???? ?????? ?? ????? ?????? ???, ??????? ?? ??? ????????
??? ????????????? ?????????. ?????? ???????????? ???? ???? ?? ?????
(I/O), ???? ???? ?? ???? ???????? ?????? ?????? ?? ?????????? ???? ???
?????? ??????????. ???? ??? ?????????? ??? scrub, ?? ????????? ??? ?
??????? ??????????, ??? ????? ???????? ?? ????? ???????? ??? ?? ???
???????? ??????:

.. code:: screen

    # zpool status storage
     pool: storage
     state: ONLINE
     scrub: scrub completed with 0 errors on Sat Aug 30 19:57:37 2008
    config:

        NAME        STATE     READ WRITE CKSUM
        storage     ONLINE       0     0     0
          raidz1    ONLINE       0     0     0
            da0     ONLINE       0     0     0
            da1     ONLINE       0     0     0
            da2     ONLINE       0     0     0

    errors: No known data errors

??? ?????????? ??? ??????????? ??? ? ??????? ?????? ??? ???????????? ?
?????? scrub. ? ?????????? ???? ??? ??????????? ??????????? ????????? ??
?????? ????? ??????.

???????? ?????? ????? ???????? ??? ?? ??????? ??????? ?. ????? ???
??????? manual
`zfs(8) <http://www.FreeBSD.org/cgi/man.cgi?query=zfs&sektion=8>`__ ???
`zpool(8) <http://www.FreeBSD.org/cgi/man.cgi?query=zpool&sektion=8>`__.

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

21.2.2.5. ZFS Quotas
^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ZFS ??????????? ????????????? ?????? quota: ?? refquota, ?? ??????
quota, ?? quota ?????? ??? ?? quota ??????. ???? ??????? ???? ??
?????????? ??? ??????? ??????? ???? ????? ??? ?? ??????? ??????? ???????
??????.

?? quotas ???????????????? ??? ?? ??????????? ?? ???? ??? ????? ???
?????? ?? ??????????? ??? ??? dataset ??? ???? ????????? ???
(descendants) ??? ????? ??? ??? ?? ?????? ???????????? ??? ???? ???
?????? ?? ????????? ??? ??????????? (snapshot). ?? ????? ??????, ??
quotas ????? ??????? ??? ??? ?????????? ??? ????? ?????? ??? ?????? ??
???? ??? ??????? ??? ??????? ???????.

.. raw:: html

   <div class="note" xmlns="">

????????:
~~~~~~~~~

??? ???????? ?? ??????? quotas ?? ?????? (volumes) ????? ???? ??????????
??????? ??? ??? ??? ???????? ``volsize``.

.. raw:: html

   </div>

?? refquota, ``refquota=size``, ?????????? ?? ???? ??? ?????? ??
??????????? ??? dataset ???????? ??? ??????? ???? ????? (hard limit).
??????, ???? ?? ??????? ???? ??? ???????????? ?? ???? ???
??????????????? ??? ???? ????????? ??? dataset ???? ?? ????????? ???????
? ?? ???????????.

??? ?? ????????? ?????? quota 10?GB ??? ?? ``storage/home/bob``,
?????????????? ??? ???????? ??????:

.. code:: screen

    # zfs set quota=10G storage/home/bob

?? quotas ?????? ??????????? ??? ???????? ????? ??? ?????? ??
?????????????? ???? ????????????? ???????. ? ?????? ????? ?????
``userquota@user=size``, ??? ?? ????? ??? ?????? ?????? ?? ??????? ??
??? ??? ??? ???????? ??????:

.. raw:: html

   <div class="itemizedlist">

-  ????? ??????? ?? ?? POSIX, ??? ?????????? *``joe``*.

-  ????? ??????? ?? ?? ?????????? ????????????? (?D) ??? POSIX, ???
   ?????????? *``789``*.

-  ????? ???????? SID, ??? ?????????? *``joe.bloggs@example.com``*.

-  ????? ??????????? ?????????????? (ID) SID, ??? ??????????
   *``S-1-123-456-789``*.

.. raw:: html

   </div>

??? ??????????, ??? ?? ????????? quota 50?GB ??? ??? ?????? ?? ?????
*``joe``*, ?????????????? ??? ???????? ??????:

.. code:: screen

    # zfs set userquota@joe=50G

??? ?? ?????????? ?? quota ? ?? ??????????? ??? ??? ???? ?????,
?????????????? ??? ??????:

.. code:: screen

    # zfs set userquota@joe=none

?? ????????? ??? quota ??????? ??? ?????????????? ???? ??? ???????
``zfs get all``. ?? ??????? ????? ??? ``root`` ??????? ?? ???? ???? ??
???? ???? quotas ????? ?? ???? ???? ???????? ?? ???????? ``userquota``.
?? ??????? ?? ???? ?? ???????? ??????? ?? ???? ??? ?? ????????? ?o quota
???????????? ??????.

?? quota ?????? ?????????? ?? ????????? ???? ??? ?????? ??
?????????????? ??? ??? ???????????? ????? ???????. ? ?????? ????? ?????
``groupquota@group=size``.

??? ?? ?????? quota ??? ??? ????? ??????? *``firstgroup``* ?? 50?GB,
?????????????? ??? ???????? ??????:

.. code:: screen

    # zfs set groupquota@firstgroup=50G

??? ?? ?????????? ?? quota ? ?? ??????????? ??? ??? ???? ?????,
?????????????? ??? ??????:

.. code:: screen

    # zfs set groupquota@firstgroup=none

???? ??? ?? ??? ???????? quota ???????, ?? ??????? ????? ??? ``root``
??????? ?? ???? ???? ?? quota ??? ??????????? ?? ??? ?????? ???? ??????
???????. ??????, ? ??????? ``root`` ??? ???? ??????? ???? ????? ????
????? ?? ???????? ``groupquota`` ?????? ?? ??? ??? ?? ???????? ?? quota
??? ???? ??? ??????.

? ???-?????? ``zfs userspace`` ??????????? ??? ???????? ????? ???
??????????? ???? ??????? ??? ???????????? ??????? ??????? ? ???????????
????? ??? ?? ??????????? quota. ? ???-?????? ``zfs groupspace`` ???????
??????? ?? ???? ??? ?????? ???????. ??? ???????????? ??????????? ???????
?? ??? ???????? ????????? ? ??????????? ????? ??? ???????, ????? ??
`zfs(1) <http://www.FreeBSD.org/cgi/man.cgi?query=zfs&sektion=1>`__.

??? ?? ????? ?? quota ??? ?? ``storage/home/bob``, ?? ????? ?? ?????
???????? ? ????? ? ``root``, ?????????????? ??? ???????? ??????:

.. code:: screen

    # zfs get quota storage/home/bob

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

21.2.2.6. ????????? ????? (reservations) ??? ZFS
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ZFS ??????????? ??? ?????? ????????? ?????. ?? ???? ??? ??????? ??
?????????? ??? ??????? ??????? ???? ???? ??? ?? ??????? ??????? ???????
??????.

? ???????? ``reservation`` ??? ????????? ?? ???????????? ??????
????????? ???????? ???? ????? ??? ??? dataset ??? ???? ????????? ???.
???? ???????? ??? ?? ????? ??????? ????? 10?GB ??? ``storage/home/bob``
??? ? ?????????? ????? ??? ?????? ???????? ?????????, ?? ????????????
??????????? 10?GB ????? ??? ???? ?? dataset. ? ????????
``refreservation`` ????? ? ??????? ??? ???????? ???????? ????? ??? ????
???????? ??? ??? dataset ????? ???? ????????? ??? (?.?. ?? ???????????).
??? ??????????, ??? ?? ?????? ??? ??????????? ??? ``storage/home/bob``
?? ?????? ?? ????? ?????? ???? ????? ??? ????????? ``refreservation``
??? ?? ?????????? ???????? ?? ??????????. ?? ???????? ??? ?????? dataset
??? ????????????? ??? ??? ???????? ``refreservation`` ??? ??? ??????????
??? ???????? ???? ???.

?? ????????? ???? ????? ????? ???????? ?? ?????? ???????????, ???
?????????? ??? ????????? ??? ?????? ?????????????? ??? ????????? ?????
?? ??? ??? ??????? ? ??? ?????????? ?????????????? ??????? ?????????
????? ?? ??? ??????? ??? ??????????? ????????? ????????? (recovery).

? ?????? ????? ??? ????????? ``reservation`` ????? ``reservation=size``.
??? ?? ?????? ??????? 10?GB ??? ``storage/home/bob`` ?????????????? ???
???????? ??????:

.. code:: screen

    # zfs set reservation=10G storage/home/bob

??? ?? ?????????? ??? reservation ? ?? ??????????? ??? ??? ???? ?????,
????????? ??? ??????:

.. code:: screen

    # zfs set reservation=none storage/home/bob

???????? ?? ?????????? ??? ???? ?????? ???? ??? ??? ?? ?????? ???
???????? ``refreservation``, ??????????????? ?? ?????? ?????
``refreservation=size``.

??? ?? ???????? ?? ???????? reservations ? refreservations ???
``storage/home/bob``, ????????? ??? ??? ??? ???????? ???????:

.. code:: screen

    # zfs get reservation storage/home/bob
    # zfs get refreservation storage/home/bob

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="navfooter">

--------------

+-----------------------------------------------+-------------------------------+-------------------------------------------+
| `????? <filesystems.html>`__?                 | `???? <filesystems.html>`__   | ?\ `??????? <filesystems-linux.html>`__   |
+-----------------------------------------------+-------------------------------+-------------------------------------------+
| ???????? 21. ?????????? ?????????? ????????   | `???? <index.html>`__         | ?21.3. ????????? ??????? Linux(R)         |
+-----------------------------------------------+-------------------------------+-------------------------------------------+

.. raw:: html

   </div>

???? ?? ???????, ??? ???? ???????, ?????? ?? ?????? ???
ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/

| ??? ????????? ??????? ?? ?? FreeBSD, ???????? ???
  `?????????? <http://www.FreeBSD.org/docs.html>`__ ???? ??
  ?????????????? ?? ??? <questions@FreeBSD.org\ >.
|  ??? ????????? ??????? ?? ???? ??? ??????????, ??????? e-mail ????
  <doc@FreeBSD.org\ >.
