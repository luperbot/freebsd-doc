=======================
20.4. RAID1 - Mirroring
=======================

.. raw:: html

   <div class="navheader">

20.4. RAID1 - Mirroring
`????? <GEOM-striping.html>`__?
???????? 20. GEOM: ?????????? ?????????? ??????
?\ `??????? <GEOM-raid3.html>`__

--------------

.. raw:: html

   </div>

.. raw:: html

   <div class="sect1">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

20.4. RAID1 - Mirroring
-----------------------

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? mirroring (????????????) ????? ??? ?????????? ??? ??????????????? ???
?????? ???????? ??? ????????? ??????? ??? ?? ?????????? ?? ???????? ????
????? ????????. ?? ??? ??????? mirror, ? ?????? ? ????? ????? ??? ??????
????????? ??? ?????? ?. ? ?????? ?? ?????? ?+? ?? ????? ????????? ???
?????? A+B. ?????? ?? ??? ?????? ??????? ??? ??????, ?? ????????? ?????
??? ?? ??????????? ???? ?????? ? ???? ?????????? ????????????? ??
??????. ?? ??????????? ????? ?????? ???????? ?? ?????????????? ?? ??????
?????, ? ?? ??????????? ????? ?? ????????? ??????? ???? ????????? ???
??????????? ? ???? ???????? ??? ?????????. ??????? ????? ??? ??
??????????? ??? ?? ????????? ?? ????, ??????? ?????.

??? ?? ??????????, ??????????? ??? ?? ??????? ??? ???? ??? ????????
??????? ????? ????????. ??? ???????????? ??? ???????? ??? ?? ??????
????? ????? SCSI (????????? ?????????,
`da(4) <http://www.FreeBSD.org/cgi/man.cgi?query=da&sektion=4>`__).

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

20.4.1. Mirroring ????? ???????? ???????
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

??????????? ??? ?? FreeBSD ???? ???????????? ???? ????? ????? ``da0``,
?? ?????? ?? ????????? ??
`gmirror(8) <http://www.FreeBSD.org/cgi/man.cgi?query=gmirror&sektion=8>`__
?? ??????????? ???? ?? ?????? ???????? ???.

???? ????????????? ?? mirror, ????????????? ??? ?????????? ?????????
???????????? ???????????? (??? ?????? ?? ??? ????????? ?? ?????????
???????????) ??? ????????? ??? ????????? ???????? ??? ??????? ??????.
??? ?? ????? ???? ????? ?? ????????? ``kern.geom.debugflags`` ???
`sysctl(8) <http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&sektion=8>`__
???? ???????? ????:

.. code:: screen

    # sysctl kern.geom.debugflags=17

???????? ???? ?? ????????????? ?? mirror. ????????? ?? ??????????
????????????? ?? ????-???????? (meta-data) ???? ?????? ?????,
????????????? ?????????? ?? ??????? ``/dev/mirror/gm``. ??????????????
??? ???????? ??????:

.. raw:: html

   <div class="warning" xmlns="">

?????????????:
~~~~~~~~~~~~~~

? ?????????? mirror ??? ????? ????????? ?????? ?? ???? ?? ?????????? ???
??????? ?????????, ?? ? ?????????? ?????? ??? ?????? ???? ???
??????????????. ? ?????????? ???? ????? ???? ????????? ?? ?? mirror
???????????? ?????? ???? ??? ??? ??? ??????????? ??? FreeBSD. ? ????????
?????????? ????? ?????? ???????? ?? ??? ?????????????? ?????????
???????????? ??? FreeBSD?9.\ *``X``* ???? ?????? ??????????????? ??
??????? ??????????? GPT. To GEOM ??????????? ?? ???????????? ??? GPT,
??? ?? ?????????? ??????? ????????? ??? ?????? ???????? ????????? ???
??????????.

.. raw:: html

   </div>

.. code:: screen

    # gmirror label -vb round-robin gm0 /dev/da0

?? ??????? ?? ???????????? ?? ?? ???????? ??????:

.. code:: screen

    Metadata value stored on /dev/da0.
    Done.

????????????? ?? GEOM. ? ???????? ?????? ?? ???????? ?? ???????
``/boot/kernel/geom_mirror.ko`` ???? ??????:

.. code:: screen

    # gmirror load

.. raw:: html

   <div class="note" xmlns="">

????????:
~~~~~~~~~

?? ??? ??????? ???????? ????? ??? ???????, ????????????? ? ???????
``gm0`` ???? ???? ???????? ``/dev/mirror``.

.. raw:: html

   </div>

????????????? ?? ??????? ??? ?????????? ``geom_mirror.ko`` ???? ???
???????? ??? ??????????:

.. code:: screen

    # echo 'geom_mirror_load="YES"' >> /boot/loader.conf

?????????????? ?? ?????? ``/etc/fstab``, ??????????????? ??? ????????
???? ?????? ???????? ``da0`` ?? ??? ??????????? ?????????? ``gm0`` ???
??????????????? ?? mirror.

.. raw:: html

   <div class="note" xmlns="">

????????:
~~~~~~~~~

?? ?????????????? ??
`vi(1) <http://www.FreeBSD.org/cgi/man.cgi?query=vi&sektion=1>`__,
???????? ?? ???????????? ?? ???????? ?????? ??? ?? ???????????? ??????
???? ?? ??????????:

.. code:: screen

    # vi /etc/fstab

??? `vi(1) <http://www.FreeBSD.org/cgi/man.cgi?query=vi&sektion=1>`__,
???????? ????????? ????????? ??? ????????? ??????? ``fstab``
??????????????? **``:w /etc/fstab.bak``**. ?????? ?????????????? ????
??? ???????? ???? ?????? ???????? ``da0`` ?? ??? ???? ``gm0`` ?????????
**``:%s/da/mirror\/gm/g``**.

.. raw:: html

   </div>

?? ``fstab`` ??? ?? ????????, ?? ??????? ?? ?? ????????. ??? ????
??????? ?? ?? ?????? ???? ?????? SCSI ? ATA, ? ??????? RAID ?? ????
????? ?? ????? ``gm``.

.. code:: programlisting

    # Device                  Mountpoint  FStype      Options   Dump     Pass#
    /dev/mirror/gm0s1b        none        swap        sw        0        0
    /dev/mirror/gm0s1a        /           ufs         rw        1        1
    /dev/mirror/gm0s1d        /usr        ufs         rw        0        0
    /dev/mirror/gm0s1f        /home       ufs         rw        2        2
    #/dev/mirror/gm0s2d       /store      ufs         rw        2        2
    /dev/mirror/gm0s1e        /var        ufs         rw        2        2
    /dev/acd0                 /cdrom      cd9660      ro,noauto 0        0

????????????? ?? ???????:

.. code:: screen

    # shutdown -r now

???? ??? ???????? ??? ??????????, ?? ?????? ????? ?? ??????????????? ?
??????? ``gm0`` ???? ??? ??? ``da0``. ???? ?? ????? ??? ?????????,
???????? ?? ???????? ??? ??? ??????????? ?????, ??????????? ??? ?????
??? ??????? ``mount``:

.. code:: screen

    # mount
    Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
    /dev/mirror/gm0s1a   1012974  224604   707334    24%    /
    devfs                      1       1        0   100%    /dev
    /dev/mirror/gm0s1f  45970182   28596 42263972     0%    /home
    /dev/mirror/gm0s1d   6090094 1348356  4254532    24%    /usr
    /dev/mirror/gm0s1e   3045006 2241420   559986    80%    /var
    devfs                      1       1        0   100%    /var/named/dev

? ?????? ???????? ?????, ???? ??????????. ??????, ??? ?? ????????? ?
????????????, ???????? ??? ??? ??????? ``da1`` ??? mirror,
??????????????? ??? ???????? ??????:

.. code:: screen

    # gmirror insert gm0 /dev/da1

???? ?? ???????? ??? ???????????? ??? mirror, ???????? ?? ????? ???
?????? ??? ??????????? ?? ??? ???????? ??????:

.. code:: screen

    # gmirror status

???? ?? ????? ??? ??????? ??? mirror, ??? ???? ????? ???????????? ??? ??
????????, ? ?????? ??? ???????? ??????? ?? ??????? ?? ??? ????????:

.. code:: screen

          Name    Status  Components
    mirror/gm0  COMPLETE  da0
                          da1

?? ???????? ??????????, ? ?? ?? mirror ????????? ????? ??? ??????????
????????????, ?? ?????????? ?? ??????? ``DEGRADED`` ???? ???
``COMPLETE``.

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

20.4.2. ???????????? ???????????
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

20.4.2.1. ?? ??????? ???????? ?? ?????????
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ?? ??????? ??? ????????? ?? ??? ???????? ??? ??????? ?? ??? ????????:

.. code:: programlisting

    ffs_mountroot: can't find rootvp
    Root mount failed: 6
    mountroot>

????????????? ?? ??????? ??? ???? ??? ???????? ??????????? ? ???
???????? reset. ??? ????? ?????????, ???????? ?? (6). ?? ??? ????? ????
?? ???????? ???? ???????? ???
`loader(8) <http://www.FreeBSD.org/cgi/man.cgi?query=loader&sektion=8>`__.
???????? ??????????? ?? ??????? ???? ??????:

.. code:: screen

    OK? load geom_mirror
    OK? boot

?? ?? ???????? ????????????, ???? ??? ?????? ???? ?? ??????? ???
????????? ?????. ??????? ?? ????? ????? ? ??????? ?????????? ??? ??????
``/boot/loader.conf``. ?? ?? ???????? ?????????, ????????? ?? ??????:

.. code:: programlisting

    options    GEOM_MIRROR

??? ?????? ????????? ??? ?????? ???, ??????????????? ???
???????????????? ??? ?????? ???. ?? ???????? ??? ?? ?????? ?? ?????????.

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

20.4.3. ????????? ???? ??? ???????? ??????
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ?????????? ?? ?? mirroring ????? ??? ???? ???? ??????? ??????
???????, ???????? ?? ??? ??????????????? ????? ?? ?????? ???????
????????.

??????????? ??? ?????????????? ??? ????????? RAID1 ??? ???????
????????????, ?? ?????????? ??? ?????? ? ?????? ``da1`` ??? ?????? ??
??????????????. ??? ?? ??? ???????????????, ?????? ????? ?????? ?????
??? ??????????????? ?? ???????. ??? ?????? ????, ???????? ????? ??
??????????? ?? ????? ?? ??? ??? ??? ?? ?????????????? ???? ?? ???????.
???? ??? ???????????????? ??? ??????????, ???????? ?? ???????????????
??? ???????? ??????? ??? ?? ?????? ?? ?????????? ?? ??? ?????:

.. code:: screen

    # gmirror forget gm0

.. code:: screen

    # gmirror insert gm0 /dev/da1

?????????????? ??? ?????? ``gmirror`` ``status`` ??? ?? ??????????????
?? ?????????? ??? ????????????. ????? ??? ??????? ???? ????.

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="navfooter">

--------------

+-----------------------------------+-------------------------+----------------------------------------------------------------+
| `????? <GEOM-striping.html>`__?   | `???? <GEOM.html>`__    | ?\ `??????? <GEOM-raid3.html>`__                               |
+-----------------------------------+-------------------------+----------------------------------------------------------------+
| 20.3. RAID0 - Striping?           | `???? <index.html>`__   | ?20.5. RAID3 - Striping ?? ??????? Byte ?? ?????????? Parity   |
+-----------------------------------+-------------------------+----------------------------------------------------------------+

.. raw:: html

   </div>

???? ?? ???????, ??? ???? ???????, ?????? ?? ?????? ???
ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/

| ??? ????????? ??????? ?? ?? FreeBSD, ???????? ???
  `?????????? <http://www.FreeBSD.org/docs.html>`__ ???? ??
  ?????????????? ?? ??? <questions@FreeBSD.org\ >.
|  ??? ????????? ??????? ?? ???? ??? ??????????, ??????? e-mail ????
  <doc@FreeBSD.org\ >.
