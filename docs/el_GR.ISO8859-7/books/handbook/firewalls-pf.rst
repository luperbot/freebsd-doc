===================================================
30.4. ?? Packet Filter (PF) ??? ?? ALTQ ??? OpenBSD
===================================================

.. raw:: html

   <div class="navheader">

30.4. ?? Packet Filter (PF) ??? ?? ALTQ ??? OpenBSD
`????? <firewalls-apps.html>`__?
???????? 30. Firewalls
?\ `??????? <firewalls-ipf.html>`__

--------------

.. raw:: html

   </div>

.. raw:: html

   <div class="sect1">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

30.4. ?? Packet Filter (PF) ??? ?? ALTQ ??? OpenBSD
---------------------------------------------------

.. raw:: html

   </div>

.. raw:: html

   <div>

???????????? ??? ??????????? ??? ??? John Ferrell.

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

??? ?????? ??? 2003, ? ???????? firewall ??? OpenBSD (?????? ?? PF)
??????????? ??? FreeBSD ??? ????? ????????? ???? ??????? ??? Ports. ??
FreeBSD?5.3 ??? ??????????? ?? 2004, ???? ? ????? ??????? ?????? ? ?????
???????? ?? PF ?? ????? ??? ??????? ????? ??????????. ?? PF ????? ???
???????????? firewall, ?? ?????? ???????????????, ?? ????? ??????
???????? ??????????? ?????????? ??? ?? ALTQ (Alternate Queuing). ?? ALTQ
????????? ????????? ??????????? ????????? (Quality of Service, QoS).

?? OpenBSD?Project ????? ?????????? ??????? ??? ????????? ??? `PF
FAQ <http://www.openbsd.org/faq/pf/>`__. ??? ?? ???? ????, ? ???????
??????? ??? ??????????? ???????? ?????? ???? ?????????????? ??? PF ???
????? ?? FreeBSD, ??? ??????? ??? ??????? ??????? ??????????? ??????? ??
?? ????? ???. ??? ??? ??????????? ??????????? ??????? ?? ?? ????? ???
PF, ??????????? ???????? ?? `PF FAQ <http://www.openbsd.org/faq/pf/>`__.

???????????? ??????????? ??????? ?? ?? PF ??? FreeBSD ???????? ?? ??????
??? ``http://pf4freebsd.love2party.net/``.

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

30.4.1. ??????????????? ?? ????????? ?????? ??? ?? PF
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

??? ?? ????????? ?? ??????? ?????? ??? ?? PF, ????????? ??? ????????
?????? ??? ??? ``/etc/rc.conf``:

.. code:: programlisting

    pf_enable="YES"

????????? ?????? ?? script ????????? ??? ?? ????????? ?? ???????:

.. code:: screen

    # /etc/rc.d/pf start

????????? ??? ?? ??????? PF ??? ????????? ?? ???????? ?? ??? ???? ??
??????????? ?????? ???????. ?? ????????????? ?????? ????? ??
``/etc/pf.conf``. ?? ?? ?????? ??????? ????????? ?? ?????? ????
?????????, ???????? ?? ??? ?????????? ???????????? ??? ?????? ???? ???
???????? ??? ``/etc/rc.conf``:

.. code:: programlisting

    pf_rules="/path/to/pf.conf"

???????? ?? ?????? ??? ?????????? ??? ??????? ``pf.conf`` ???? ????????
``/usr/share/examples/pf``

?? ??????? PF ?????? ?????? ?? ???????? ??????????? ??? ??? ??????
???????:

.. code:: screen

    # kldload pf.ko

? ??????????? ?????????? ??? PF ????????? ??? ?? ??????? ``pflog.ko``
??? ???????? ?? ??? ????????? ???????????? ??? ???????? ?????? ???
``/etc/rc.conf``:

.. code:: programlisting

    pflog_enable="YES"

????????? ?????? ?? script ????????? ??? ?? ????????? ?? ???????:

.. code:: screen

    # /etc/rc.d/pflog start

?? ?????????? ?????? ??? ?? ??????????? ?????????????? ??? PF, ?? ??????
?? ?????????????? ??? ?????????? ??? ?? PF ????????? ???? ???? ??????.

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

30.4.2. ???????? ??? PF ??? ??? ??????
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ??? ??? ????? ?????????? ?? ?????????????? ??? ?????????? PF ????
???? ?????? ??? FreeBSD, ???? ?? ?????? ?? ??????????????? ??? ??? ??
??????????? ?????????????? ??? PF ?? ????? ??? ?????????????? ???
??????? ??? ??????: ??
`pfsync(4) <http://www.FreeBSD.org/cgi/man.cgi?query=pfsync&sektion=4>`__.
????????? ??? ??? ?????-??????? ? ????? ??????????? ?????????????
??????? ???? ?????? ??????????? ??? ??????????????? ??? ?? PF. ?????? ??
?????????? ?? ??
`carp(4) <http://www.FreeBSD.org/cgi/man.cgi?query=carp&sektion=4>`__
??? ?? ????????????? ?? ?? PF firewalls ?? ?????????? ????????? ???????
?? ????????? ????????? (failover). ???????????? ??????????? ??????? ??
?? CARP ???????? ?? ?????? ??? `??????31.12, ?Common Access Redundancy
Protocol (CARP)? <carp.html>`__ ??? ???????????.

???????? ?? ????? ???? ??? ???????? ?????? ??? ?? PF ??? ??????
``/usr/src/sys/conf/NOTES``. ?? ???????? ????????? ?????? ????????:

.. code:: programlisting

    device pf
    device pflog
    device pfsync

? ??????? ``device pf`` ??????????? ??? ?????????? ??? ?? firewall
?Packet Filter?
(`pf(4) <http://www.FreeBSD.org/cgi/man.cgi?query=pf&sektion=4>`__).

? ??????? ``device pflog`` ??????????? ??? ??????????? ?????-????????
???????
`pflog(4) <http://www.FreeBSD.org/cgi/man.cgi?query=pflog&sektion=4>`__
??? ?????? ?? ?????????????? ??? ??? ????????? ??? ??????? ?? ???
`bpf(4) <http://www.FreeBSD.org/cgi/man.cgi?query=bpf&sektion=4>`__
descriptor. ? ????????
`pflogd(8) <http://www.FreeBSD.org/cgi/man.cgi?query=pflogd&sektion=8>`__
?????? ?? ??????????? ??? ????????? ???? ??? ?????? ?????.

? ??????? ``device pfsync`` ??????????? ??? ??????????? ?????-????????
???????
`pfsync(4) <http://www.FreeBSD.org/cgi/man.cgi?query=pfsync&sektion=4>`__
? ????? ??????????????? ??? ?? ????????? ???????? ???????????.

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

30.4.3. ???????? ??? ``rc.conf``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? PF ??? ??
`pflog(4) <http://www.FreeBSD.org/cgi/man.cgi?query=pflog&sektion=4>`__
??????? ?? ?????????? ???? ??? ???????? ?? ??? ???????? ???????????? ???
`rc.conf(5) <http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&sektion=5>`__:

.. code:: programlisting

    pf_enable="YES"                 # Enable PF (load module if required)
    pf_rules="/etc/pf.conf"         # rules definition file for pf
    pf_flags=""                     # additional flags for pfctl startup
    pflog_enable="YES"              # start pflogd(8)
    pflog_logfile="/var/log/pflog"  # where pflogd should store the logfile
    pflog_flags=""                  # additional flags for pflogd startup

?? ???? ??? ???? ?? firewall ??????? ?????? ?????? ?????? (LAN) ???? ??
????? ?????????? ?? ?????????? ??????, ? ?? ?????? ?? ???????????????
NAT, ?? ??????????? ?????? ??? ??? ???????? ???????:

.. code:: programlisting

    gateway_enable="YES"            # Enable as LAN gateway

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

30.4.4. ?????????? ??????? ??????????????
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? PF ???????? ??? ????????? ??? ??? ??
`pf.conf(5) <http://www.FreeBSD.org/cgi/man.cgi?query=pf.conf&sektion=5>`__
(? ????????????? ????????? ????? ??? ``/etc/pf.conf``) ??? ??????????,
?????????? ? ?????????? ?????? ??????? ?? ???? ??????? ??? ???? ????????
??? ??????????? ?? ????. ? ??????????? ??? FreeBSD ???????????? ??????
??????????? ??????? ????????, ???? ?????????
``/usr/share/examples/pf/``. ??????????? ?? ????????? ?? `PF
FAQ <http://www.openbsd.org/faq/pf/>`__ ??? ????? ??????? ??? ???????
??? PF.

.. raw:: html

   <div class="warning" xmlns="">

?????????????:
~~~~~~~~~~~~~~

????? ????????? ?? `PF FAQ <http://www.openbsd.org/faq/pf/>`__, ?? ?????
????? ??? ??? ???????????? ???????? ??? FreeBSD ????????? ????????????
???????? ??? PF. ?? ???????? ??????, ?? FreeBSD?8.\ *``X``* ??? ??
???????????? ???????? ????????????? ??? ???? ?????? ??? PF ???
???????????? ??? ?? OpenBSD?4.1. ?? FreeBSD?9.\ *``X``* ??? ????????
???????? ????????????? ??? ???? ?????? ??? PF ?? ?? OpenBSD?4.5.

.. raw:: html

   </div>

? `??????????? ????? ??? FreeBSD ??? ?? packet filter
firewall <http://lists.FreeBSD.org/mailman/listinfo/freebsd-pf>`__ ?????
??? ???? ????? ??? ?? ?????? ????????? ???????? ?? ?? ??????? ??? ??
?????????? ??? PF firewall. ?? ???????? ?? ???????? ?? ?????? ??? ??????
???? ?????????? ??? ?????????!

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

30.4.5. ??????????? ?? ?? PF
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?????????????? ??
`pfctl(8) <http://www.FreeBSD.org/cgi/man.cgi?query=pfctl&sektion=8>`__
??? ?? ???????? ?? PF. ???????? ?? ?????? ??????? ???????? ???????
(??????????? ??? ????? ???????? ?? ?????? manual ???
`pfctl(8) <http://www.FreeBSD.org/cgi/man.cgi?query=pfctl&sektion=8>`__
??? ?? ????? ???? ??? ?????????? ????????):

.. raw:: html

   <div class="informaltable">

+----------------------------------------+---------------------------------------------------------------------------------------------------------------------+
| ??????                                 | ??????                                                                                                              |
+========================================+=====================================================================================================================+
| ``pfctl -e``                           | ???????????? ??? PF                                                                                                 |
+----------------------------------------+---------------------------------------------------------------------------------------------------------------------+
| ``pfctl -d``                           | ?????????????? ??? PF                                                                                               |
+----------------------------------------+---------------------------------------------------------------------------------------------------------------------+
| ``pfctl -F all -f /etc/pf.conf``       | ???????? ???? ??? ??????? (nat, filter, state, table, ?.?.?.) ??? ?? ???? ???????? ??? ?? ?????? ``/etc/pf.conf``   |
+----------------------------------------+---------------------------------------------------------------------------------------------------------------------+
| ``pfctl -s [ rules | nat | state ]``   | ???????? ???????? ??????? ?? ???? ??????? ??? ???????, ??? NAT, ? ??? ?????? ??????????                             |
+----------------------------------------+---------------------------------------------------------------------------------------------------------------------+
| ``pfctl -vnf /etc/pf.conf``            | ??????? ?? ``/etc/pf.conf`` ??? ????, ???? ??? ???????? ???? ???????                                                |
+----------------------------------------+---------------------------------------------------------------------------------------------------------------------+

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

30.4.6. ???????????? ??? ALTQ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ALTQ ?????????? ???? ?? ?????????????? ????????? ??? ?????????? ???
???? ???? ?????? ??? FreeBSD. ?? ALTQ ??? ????????????? ??? ??? ??
??????????? ???????? ?????? ???????. ??????????? ????? ?? ?????? manual
???
`altq(4) <http://www.FreeBSD.org/cgi/man.cgi?query=altq&sektion=4>`__
??? ?? ????? ??? ?????? ??? ?????????????? ???? ?????? ??? FreeBSD ???
?????????.

?? ???????? ???????? ??? ?????? ???????????? ?? ALTQ ??? ????????
???????????? ???????????:

.. code:: programlisting

    options         ALTQ
    options         ALTQ_CBQ        # Class Bases Queuing (CBQ)
    options         ALTQ_RED        # Random Early Detection (RED)
    options         ALTQ_RIO        # RED In/Out
    options         ALTQ_HFSC       # Hierarchical Packet Scheduler (HFSC)
    options         ALTQ_PRIQ       # Priority Queuing (PRIQ)
    options         ALTQ_NOPCC      # Required for SMP build

? ?????? ``options ALTQ`` ??????????? ?? ??????? ??????????? ALTQ.

? ?????? ``options ALTQ_CBQ`` ??????????? ?? *Class Based Queuing*
(CBQ). ?? CBQ ??? ????????? ?? ???????? ?? ????? ????? ???? ???????? ??
???????????? ??????? ? ?????, ???? ?? ???????? ?????????????? ????
?????? ??????? ?? ???? ??????? ??? ???????.

? ?????? ``options ALTQ_RED`` ??????????? ?? *Random Early Detection*
(RED). ?? RED ??????????????? ??? ?? ?????????? ? ????????? ??? ???????.
??? ?? ????? ????, ?? RED ??????? ?? ????? ??? ????? ??? ?? ????????? ??
?? ??????? ??? ???????? ???? ???. ?? ? ???? ????? ???? ??? ?? ???????,
??? ?? ??? ?????? ?? ?????????????. ??????? ??? ?? ?? ????? ???, ?? RED
?????????? ?????? ??? ???????? ????????? ?? ?????? ?????.

? ?????? ``options ALTQ_RIO`` ??????????? ?? *Random Early Detection In
and Out*.

? ?????? ``options ALTQ_HFSC`` ??????????? ?? *Hierarchical Fair Service
Curve Packet Scheduler*. ??? ???????????? ??????????? ??????? ?? ?? HFSC
?????: ``http://www-2.cs.cmu.edu/~hzhang/HFSC/main.html``.

? ?????? ``options ALTQ_PRIQ`` ??????????? ?? *Priority Queuing* (PRIQ).
?? PRIQ ??????? ??????? ????? ??? ?????? ?? ?? ?????????? ?????????????.

? ?????? ``options ALTQ_NOPCC`` ??????????? ??? ?????????? SMP ??? ??
ALTQ. ? ??????? ???? ?????????? ?? ????????? SMP.

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="navfooter">

--------------

+------------------------------------+-----------------------------+---------------------------------------+
| `????? <firewalls-apps.html>`__?   | `???? <firewalls.html>`__   | ?\ `??????? <firewalls-ipf.html>`__   |
+------------------------------------+-----------------------------+---------------------------------------+
| 30.3. ??????????? Firewall?        | `???? <index.html>`__       | ?30.5. ?? IPFILTER (IPF) Firewall     |
+------------------------------------+-----------------------------+---------------------------------------+

.. raw:: html

   </div>

???? ?? ???????, ??? ???? ???????, ?????? ?? ?????? ???
ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/

| ??? ????????? ??????? ?? ?? FreeBSD, ???????? ???
  `?????????? <http://www.FreeBSD.org/docs.html>`__ ???? ??
  ?????????????? ?? ??? <questions@FreeBSD.org\ >.
|  ??? ????????? ??????? ?? ???? ??? ??????????, ??????? e-mail ????
  <doc@FreeBSD.org\ >.
