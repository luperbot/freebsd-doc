<?xml version="1.0" encoding="iso-8859-7" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-7" /><title>21.2. Το Σύστημα Αρχείων Z (ZFS)</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Εγχειρίδιο του FreeBSD" /><link rel="up" href="filesystems.html" title="Κεφάλαιο 21. Υποστήριξη Συστημάτων Αρχείων" /><link rel="prev" href="filesystems.html" title="Κεφάλαιο 21. Υποστήριξη Συστημάτων Αρχείων" /><link rel="next" href="filesystems-linux.html" title="21.3. Συστήματα Αρχείων Linux(R)" /><link rel="copyright" href="legalnotice.html" title="Νομική Σημείωση" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">21.2. Το Σύστημα Αρχείων Z (ZFS)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="filesystems.html">Προηγ</a> </td><th width="60%" align="center">Κεφάλαιο 21. Υποστήριξη Συστημάτων Αρχείων</th><td width="20%" align="right"> <a accesskey="n" href="filesystems-linux.html">Επόμενο</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="filesystems-zfs"></a>21.2. Το Σύστημα Αρχείων Z (ZFS)</h2></div></div></div><p>Το σύστημα αρχείων Z, αναπτύχθηκε από την <span class="trademark">Sun</span>TM, και είναι μια νέα
      τεχνολογία που σχεδιάστηκε για να παρέχει αποθήκευση μέσω της μεθόδου
      pool.  Αυτό σημαίνει ότι όλος ο ελεύθερος χώρος διατίθεται ως
      απόθεμα, και διανέμεται δυναμικά σε κάθε σύστημα αρχείων ανάλογα με τις
      ανάγκες αποθήκευσης δεδομένων.  Έχει επίσης σχεδιαστεί για τη μέγιστη
      ακεραιότητα δεδομένων και υποστηρίζει στιγμιότυπα (snapshots) δεδομένων,
      πολλαπλά αντίγραφα και αθροίσματα ελέγχου δεδομένων (checksums).  Έχει
      ακόμα προστεθεί ένα νέο μοντέλο για τη διατήρηση αντιγράφων των
      δεδομένων, γνωστό ως <acronym class="acronym">RAID</acronym>-Z.  Το μοντέλο
      <acronym class="acronym">RAID</acronym>-Z είναι παρόμοιο με το
      <acronym class="acronym">RAID</acronym>5 αλλά είναι σχεδιασμένο να παρέχει προστασία
      των δεδομένων κατά την εγγραφή τους.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91876304"></a>21.2.1. Βελτιστοποίηση του ZFS</h3></div></div></div><p>Το υποσύστημα <acronym class="acronym">ZFS</acronym> χρησιμοποιεί αρκετούς πόρους
	του συστήματος.  Βελτιστοποιώντας τις ρυθμίσεις του συστήματος σας, θα
	επιτύχετε τη μέγιστη απόδοση στην καθημερινή χρήση.  Καθώς το
	<acronym class="acronym">ZFS</acronym> είναι ακόμα σε πειραματικό στάδιο στο FreeBSD,
	αυτό ίσως αλλάξει μελλοντικά.  Ωστόσο, για την ώρα, συνίσταται να
	ακολουθήσετε τα παρακάτω βήματα:</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91878224"></a>21.2.1.1. Μνήμη</h4></div></div></div><p>Το συνολικό μέγεθος μνήμης του συστήματος πρέπει να είναι
	  τουλάχιστον ένα gigabyte, ενώ το συνιστώμενο μέγεθος είναι δύο
	  gigabytes ή και περισσότερο.  Σε όλα τα παραδείγματα που φαίνονται
	  εδώ, το σύστημα έχει ένα gigabyte μνήμης και έχουμε επίσης
	  βελτιστοποιήσει τις ρυθμίσεις του.</p><p>Ορισμένοι χρήστες φαίνεται να τα καταφέρνουν και με λιγότερο
	  από ένα gigabyte μνήμης, αλλά με τέτοιους περιορισμούς φυσικής
	  μνήμης, είναι αρκετά πιθανό να δημιουργηθεί panic κάτω από βαρύ
	  φορτίο εργασίας, εξαιτίας εξάντλησης της.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91879760"></a>21.2.1.2. Ρύθμιση του Πυρήνα</h4></div></div></div><p>Συνίσταται να αφαιρέσετε τα προγράμματα οδήγησης και τις
	  επιλογές που δεν χρησιμοποιείτε από το αρχείο ρυθμίσεων του
	  πυρήνα.  Καθώς οι περισσότεροι οδηγοί συσκευών διατίθενται επίσης
	  και σε μορφή αρθρωμάτων, μπορείτε να τους φορτώσετε
	  χρησιμοποιώντας το αρχείο
	  <code class="filename">/boot/loader.conf</code>.</p><p>Οι χρήστες της αρχιτεκτονικής <span class="trademark">i386</span>TM θα πρέπει να προσθέσουν την
	  παρακάτω επιλογή στο αρχείο ρυθμίσεων του πυρήνα τους, να τον
	  επαναμεταγλωττίσουν και να επανεκκινήσουν το σύστημα τους:</p><pre class="programlisting">options 	KVA_PAGES=512</pre><p>Η επιλογή αυτή θα διευρύνει την περιοχή διευθύνσεων του πυρήνα,
	  επιτρέποντας έτσι την αύξηση τιμής της ρυθμιστικής μεταβλητής
	  <code class="varname">vm.kvm_size</code> πέρα από το τρέχον όριο του
	  1 GB (2 GB για πυρήνες <acronym class="acronym">PAE</acronym>).  Για να
	  βρείτε την καταλληλότερη τιμή για αυτή την επιλογή, διαιρέστε το
	  επιθυμητό μέγεθος της περιοχής διευθύνσεων με το τέσσερα (4).  Στην
	  περίπτωση αυτή, έχουμε <code class="literal">512</code> για μέγεθος
	  2 GB.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91883984"></a>21.2.1.3. Ρυθμίσεις στις Μεταβλητές του Loader</h4></div></div></div><p>Θα πρέπει να αυξηθεί η περιοχή διευθύνσεων
	  <code class="filename">kmem</code> σε όλες τις αρχιτεκτονικές του FreeBSD.
	  Στο δοκιμαστικό μας σύστημα, με ένα gigabyte φυσικής μνήμης,
	  είχαμε επιτυχημένο αποτέλεσμα χρησιμοποιώντας τις ακόλουθες
	  επιλογές στο αρχείο <code class="filename">/boot/loader.conf</code> και
	  επανεκκινώντας το σύστημα μας:</p><pre class="programlisting">vm.kmem_size="330M"
vm.kmem_size_max="330M"
vfs.zfs.arc_max="40M"
vfs.zfs.vdev.cache.size="5M"</pre><p>Για αναλυτικότερες ρυθμίσεις σχετικά με την βελτιστοποίηση του
	  ZFS, δείτε το <code class="uri"><a class="uri" href="http://wiki.freebsd.org/ZFSTuningGuide" target="_top">http://wiki.freebsd.org/ZFSTuningGuide</a></code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91887440"></a>21.2.2. Χρησιμοποιώντας το <acronym class="acronym">ZFS</acronym></h3></div></div></div><p>Υπάρχει ένας μηχανισμός εκκίνησης που επιτρέπει στο FreeBSD να
	προσαρτήσει <acronym class="acronym">ZFS</acronym> pools κατά τη διάρκεια της
	εκκίνησης του συστήματος.  Για να τον ρυθμίσετε, εκτελέστε τις
	ακόλουθες εντολές:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 'zfs_enable="YES"' &gt;&gt; /etc/rc.conf</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/zfs start</code></strong></pre><p>Το υπόλοιπο αυτού του κειμένου υποθέτει ότι έχετε διαθέσιμους
	τρεις <acronym class="acronym">SCSI</acronym> δίσκους, και ότι τα ονόματα συσκευών
	τους είναι <code class="filename">da0</code>,
	<code class="filename">da1</code> και
	<code class="filename">da2</code>.
	Όσοι διαθέτουν δίσκους <acronym class="acronym">IDE</acronym> θα
	πρέπει να χρησιμοποιήσουν συσκευές του τύπου
	<code class="filename">ad</code>
	αντί για τις αντίστοιχες <acronym class="acronym">SCSI</acronym>.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91893968"></a>21.2.2.1. Pool με Ένα Μόνο Δίσκο</h4></div></div></div><p>Για την δημιουργία ενός <acronym class="acronym">ZFS</acronym> pool με ένα
	  μόνο δίσκο (χωρίς δυνατότητα ανοχής σφαλμάτων), χρησιμοποιήστε την
	  εντολή <code class="command">zpool</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool create example /dev/da0</code></strong></pre><p>Για να δείτε το νέο pool, εξετάστε την έξοδο της εντολής
	  <code class="command">df</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235230  1628718    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032846 48737598     2%    /usr
example      17547136       0 17547136     0%    /example</pre><p>Η έξοδος αυτή δείχνει καθαρά ότι το <code class="literal">example</code>
	  pool όχι μόνο έχει δημιουργηθεί, αλλά έχει επίσης
	  <span class="emphasis"><em>προσαρτηθεί</em></span> κιόλας.  Είναι επίσης διαθέσιμο ως
	  κανονικό σύστημα αρχείων, μπορείτε να δημιουργήσετε αρχεία σε αυτό,
	  και άλλοι χρήστες μπορούν επίσης να το δουν, όπως φαίνεται στο
	  παρακάτω παράδειγμα:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /example</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>touch testfile</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ls -al</code></strong>
total 4
drwxr-xr-x   2 root  wheel    3 Aug 29 23:15 .
drwxr-xr-x  21 root  wheel  512 Aug 29 23:12 ..
-rw-r--r--   1 root  wheel    0 Aug 29 23:15 testfile</pre><p>Δυστυχώς αυτό το pool δεν χρησιμοποιεί κάποιο από τα
	  πλεονεκτήματα του <acronym class="acronym">ZFS</acronym>.  Δημιουργήστε ένα σύστημα
	  αρχείων σε αυτό το pool και ενεργοποιήστε σε αυτό τη
	  συμπίεση:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=gzip example/compressed</code></strong></pre><p>Το σύστημα αρχείων <code class="literal">example/compressed</code>
	  είναι πλέον ένα συμπιεσμένο <acronym class="acronym">ZFS</acronym> σύστημα.
	  Δοκιμάστε να αντιγράψετε μερικά μεγάλα αρχεία σε αυτό, απευθείας
	  στον κατάλογο
	  <code class="filename">/example/compressed</code>.</p><p>Μπορείτε τώρα να απενεργοποιήσετε τη συμπίεση γράφοντας:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=off example/compressed</code></strong></pre><p>Για να αποπροσαρτήσετε το σύστημα αρχείων, εκτελέστε την
	  ακόλουθη εντολή και επαληθεύστε το αποτέλεσμα μέσω του βοηθητικού
	  προγράμματος <code class="command">df</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs umount example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem  1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a   2026030  235232  1628716    13%    /
devfs               1       1        0   100%    /dev
/dev/ad0s1d  54098308 1032864 48737580     2%    /usr
example      17547008       0 17547008     0%    /example</pre><p>Προσαρτήστε ξανά το σύστημα αρχείων, ώστε να είναι και πάλι
	  προσβάσιμο, και επαληθεύστε το χρησιμοποιώντας όπως και πριν, την
	  εντολή <code class="command">df</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs mount example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
example             17547008       0 17547008     0%    /example
example/compressed  17547008       0 17547008     0%    /example/compressed</pre><p>Μπορείτε επίσης να δείτε το pool και το σύστημα αρχείων
	  εξετάζοντας την έξοδο της εντολής <code class="command">mount</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
/dev/ad0s1a on / (ufs, local)
devfs on /dev (devfs, local)
/dev/ad0s1d on /usr (ufs, local, soft-updates)
example on /example (zfs, local)
example/data on /example/data (zfs, local)
example/compressed on /example/compressed (zfs, local)</pre><p>Όπως παρατηρούμε, το σύστημα αρχείων <acronym class="acronym">ZFS</acronym>
	  μπορεί να χρησιμοποιηθεί ως κοινό σύστημα αρχείων μετά τη
	  δημιουργία του.  Ωστόσο, διαθέτει πολλές ακόμα λειτουργίες.  Στο
	  παρακάτω παράδειγμα δημιουργούμε ένα νέο σύστημα αρχείων, το
	  <code class="literal">data</code>.  θα αποθηκεύσουμε σημαντικά δεδομένα σε
	  αυτό, και έτσι το ρυθμίζουμε ώστε να κρατάει δύο αντίγραφα από
	  κάθε μπλοκ δεδομένων:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create example/data</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set copies=2 example/data</code></strong></pre><p>Μπορούμε τώρα να δούμε τα δεδομένα και την κατανάλωση χώρου
	  δίνοντας ξανά την εντολή <code class="command">df</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem         1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a          2026030  235234  1628714    13%    /
devfs                      1       1        0   100%    /dev
/dev/ad0s1d         54098308 1032864 48737580     2%    /usr
example             17547008       0 17547008     0%    /example
example/compressed  17547008       0 17547008     0%    /example/compressed
example/data        17547008       0 17547008     0%    /example/data</pre><p>Παρατηρήστε ότι κάθε σύστημα αρχείων στο pool δείχνει το ίδιο
	  μέγεθος διαθέσιμου χώρου.  Αυτός είναι και ο λόγος που
	  χρησιμοποιούμε την εντολή <code class="command">df</code> σε όλα τα
	  παραδείγματα, για να δείξουμε ότι τα συστήματα αρχείων
	  χρησιμοποιούν μόνο το χώρο που χρειάζονται και ότι όλα μοιράζονται
	  τον ίδιο χώρο (το κοινόχρηστο απόθεμα - pool).  Στο σύστημα
	  αρχείων <acronym class="acronym">ZFS</acronym> έννοιες όπως οι τόμοι (volumes) και
	  οι κατατμήσεις (partitions) δεν έχουν νόημα.  Αντίθετα, πολλά
	  συστήματα αρχείων μοιράζονται τον ίδιο χώρο, το pool.  Μπορείτε να
	  καταργήσετε το σύστημα αρχείων και κατόπιν το ίδιο το pool όταν
	  δεν τα χρειάζεστε πλέον:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs destroy example/compressed</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs destroy example/data</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zpool destroy example</code></strong></pre><p>Οι σκληροί δίσκοι με τον καιρό χαλάνε, είναι αναπόφευκτο.
	  Όταν ένας δίσκος χαλάσει, τα δεδομένα του χάνονται.  Μια μέθοδος
	  για να αποφύγουμε την απώλεια δεδομένων εξαιτίας ενός χαλασμένου
	  δίσκου είναι να δημιουργήσουμε μια συστοιχία
	  <acronym class="acronym">RAID</acronym>.  Τα pools του <acronym class="acronym">ZFS</acronym> έχουν
	  σχεδιασθεί ώστε να υποστηρίζουν αυτό το χαρακτηριστικό.
	  Η λειτουργία αυτή αναλύεται στην επόμενη ενότητα.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91937488"></a>21.2.2.2. <acronym class="acronym">ZFS</acronym> RAID-Z</h4></div></div></div><p>Όπως αναφέραμε προηγουμένως, η ενότητα αυτή προϋποθέτει ότι
	  χρησιμοποιούμε τρεις συσκευές
	  <acronym class="acronym">SCSI</acronym> με ονόματα συσκευών
	  <code class="filename">da0</code>, <code class="filename">da1</code> και
	  <code class="filename">da2</code>.  Για να δημιουργήσουμε ένα pool τύπου
	  <acronym class="acronym">RAID</acronym>-Z, εκτελούμε την ακόλουθη εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool create storage raidz da0 da1 da2</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Σημείωση: </h3><p xmlns="http://www.w3.org/1999/xhtml">Η <span class="trademark">Sun</span>TM συνιστά να χρησιμοποιούνται από τρεις ως εννιά
	    συσκευές σε συστοιχίες τύπου <acronym class="acronym">RAID</acronym>-Z.
	    Αν χρειάζεται να δημιουργήσετε ένα pool με περισσότερους από
	    δέκα δίσκους, είναι προτιμότερο να το χωρίσετε σε ομάδες από
	    μικρότερα <acronym class="acronym">RAID</acronym>-Z pools.  Αν διαθέτετε μόνο
	    δύο δίσκους αλλά χρειάζεστε την δυνατότητα ανοχής σφαλμάτων,
	    ίσως είναι καλύτερο να χρησιμοποιήσετε ένα
	    <acronym class="acronym">ZFS</acronym> mirror.  Δείτε τη σελίδα manual του
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a> για περισσότερες λεπτομέρειες.</p></div><p>Θα δημιουργηθεί το <code class="literal">storage</code> zpool.  Μπορείτε
	  να επαληθεύσετε το αποτέλεσμα χρησιμοποιώντας, όπως και
	  προηγουμένως, τις εντολές <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a> και <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=df&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">df</span>(1)</span></a>.  Θα
	  μπορούσαμε να χρησιμοποιήσουμε περισσότερους δίσκους, προσθέτοντας
	  τα ονόματα συσκευών τους στο τέλος της παραπάνω λίστας.
	  Δημιουργήστε ένα νέο σύστημα αρχείων στο pool, το οποίο θα
	  ονομάζεται <code class="literal">home</code> και όπου θα αποθηκεύονται τελικά
	  τα αρχεία των χρηστών:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs create storage/home</code></strong></pre><p>Μπορούμε τώρα να ενεργοποιήσουμε την συμπίεση και να κρατάμε
	  επιπλέον αντίγραφα των καταλόγων και των δεδομένων των χρηστών.
	  Όπως και προηγουμένως, μπορούμε να το επιτύχουμε χρησιμοποιώντας
	  τις παρακάτω εντολές:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set copies=2 storage/home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs set compression=gzip storage/home</code></strong></pre><p>Για να γίνει αυτός ο νέος κατάλογος των χρηστών, αντιγράψτε τα
	  δεδομένα τους σε αυτόν και δημιουργήστε τους κατάλληλους
	  συμβολικούς δεσμούς:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp -rp /home/* /storage/home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -rf /home /usr/home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /storage/home /home</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ln -s /storage/home /usr/home</code></strong></pre><p>Τα δεδομένα των χρηστών θα αποθηκεύονται τώρα στο νέο σύστημα
	  αρχείων <code class="filename">/storage/home</code>.
	  Για να το επαληθεύσετε, δημιουργήστε ένα νέο χρήστη και εισέλθετε
	  στο σύστημα με το νέο λογαριασμό.</p><p>Δοκιμάστε να δημιουργήσετε ένα στιγμιότυπο (snapshot) στο
	  οποίο θα μπορείτε να επανέλθετε αργότερα:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs snapshot storage/home@08-30-08</code></strong></pre><p>Σημειώστε ότι η επιλογή δημιουργίας στιγμιότυπου λειτουργεί
	  μόνο σε πραγματικό σύστημα αρχείων, και όχι σε κάποιο μεμονωμένο
	  κατάλογο ή αρχείο.  Ο χαρακτήρας <code class="literal">@</code>
	  χρησιμοποιείται ως διαχωριστικό μεταξύ του συστήματος αρχείων και
	  του ονόματος τόμου.  Αν καταστραφεί ο κατάλογος δεδομένων κάποιου
	  χρήστη αποκαταστήστε τον με την εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs rollback storage/home@08-30-08</code></strong></pre><p>Για να δείτε μια λίστα των διαθέσιμων στιγμιότυπων, εκτελέστε
	  την εντολή <code class="command">ls</code> στον κατάλογο
	  <code class="filename">.zfs/snapshot</code> του συστήματος
	  αρχείων.  Για παράδειγμα, για να δείτε το στιγμιότυπο που
	  δημιουργήσαμε προηγουμένως, εκτελέστε την παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ls /storage/home/.zfs/snapshot</code></strong></pre><p>Είναι δυνατόν να γράψετε κάποιο script που να δημιουργεί
	  μηνιαία στιγμιότυπα των δεδομένων των χρηστών.  Ωστόσο, με την
	  πάροδο του χρόνου, τα στιγμιότυπα θα καταναλώσουν μεγάλο ποσοστό
	  του χώρου στο δίσκο.  Μπορείτε να διαγράψετε το προηγούμενο
	  στιγμιότυπο χρησιμοποιώντας την παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs destroy storage/home@08-30-08</code></strong></pre><p>Δεν υπάρχει λόγος, μετά από όλες αυτές τις δοκιμές, να
	  κρατήσουμε το <code class="filename">/storage/home</code>
	  στην παρούσα κατάσταση του.  Μετατρέψτε το στο πραγματικό σύστημα
	  αρχείων <code class="filename">/home</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set mountpoint=/home storage/home</code></strong></pre><p>Χρησιμοποιώντας τις εντολές <code class="command">df</code> και
	  <code class="command">mount</code> θα δούμε ότι το σύστημα χειρίζεται πλέον
	  αυτό το σύστημα αρχείων ως το πραγματικό
	  <code class="filename">/home</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount</code></strong>
/dev/ad0s1a on / (ufs, local)
devfs on /dev (devfs, local)
/dev/ad0s1d on /usr (ufs, local, soft-updates)
storage on /storage (zfs, local)
storage/home on /home (zfs, local)
<code class="prompt">#</code> <strong class="userinput"><code>df</code></strong>
Filesystem   1K-blocks    Used    Avail Capacity  Mounted on
/dev/ad0s1a    2026030  235240  1628708    13%    /
devfs                1       1        0   100%    /dev
/dev/ad0s1d   54098308 1032826 48737618     2%    /usr
storage       26320512       0 26320512     0%    /storage
storage/home  26320512       0 26320512     0%    /home</pre><p>Εδώ ολοκληρώνεται η ρύθμιση του <acronym class="acronym">RAID</acronym>-Z.
	  Για να δέχεστε αναφορές κατάστασης σχετικά με τα συστήματα
	  αρχείων κατά τη νυκτερινή εκτέλεση του <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=periodic&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">periodic</span>(8)</span></a>, δώστε την
	  παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>echo 'daily_status_zfs_enable="YES"' &gt;&gt; /etc/periodic.conf</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91978064"></a>21.2.2.3. Ανάκτηση του <acronym class="acronym">RAID</acronym>-Z</h4></div></div></div><p>Κάθε λογισμικό <acronym class="acronym">RAID</acronym> έχει μια μέθοδο για
	  επίβλεψη της κατάστασής του, και το <acronym class="acronym">ZFS</acronym> δεν
	  αποτελεί εξαίρεση.  Μπορείτε να δείτε την κατάσταση των συσκευών
	  του <acronym class="acronym">RAID</acronym>-Z χρησιμοποιώντας την ακόλουθη
	  εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status -x</code></strong></pre><p>Αν όλα τα pools είναι σε υγιή κατάσταση, θα πάρετε το ακόλουθο
	  μήνυμα:</p><pre class="screen">all pools are healthy</pre><p>Αν υπάρχει κάποιο πρόβλημα, π.χ. κάποιος δίσκος έχει βγει
	  εκτός λειτουργίας, θα δείτε την περιγραφή της κατάστασης σε
	  ένα μήνυμα όπως το παρακάτω:</p><pre class="screen">  pool: storage
 state: DEGRADED
status: One or more devices has been taken offline by the administrator.
	Sufficient replicas exist for the pool to continue functioning in a
	degraded state.
action: Online the device using 'zpool online' or replace the device with
	'zpool replace'.
 scrub: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	storage     DEGRADED     0     0     0
	  raidz1    DEGRADED     0     0     0
	    da0     ONLINE       0     0     0
	    da1     OFFLINE      0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>Το παραπάνω δείχνει ότι η συσκευή τέθηκε εκτός λειτουργίας
	  από τον διαχειριστή.  Αυτό είναι αλήθεια για το συγκεκριμένο
	  παράδειγμα.  Για να τεθεί ο δίσκος εκτός, χρησιμοποιήθηκε η
	  παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool offline storage da1</code></strong></pre><p>Μπορούμε τώρα να αντικαταστήσουμε το δίσκο
	  <code class="filename">da1</code> μετά την απενεργοποίηση του
	  συστήματος.  Όταν το σύστημα επανέλθει σε λειτουργία, μπορούμε να
	  χρησιμοποιήσουμε την ακόλουθη εντολή για να ενημερώσουμε το
	  σύστημα για την αντικατάσταση του δίσκου:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool replace storage da1</code></strong></pre><p>Από εδώ, μπορούμε να ελέγξουμε ξανά την κατάσταση, αυτή τη
	  φορά χωρίς την επιλογή <code class="option">-x</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status storage</code></strong>
 pool: storage
 state: ONLINE
 scrub: resilver completed with 0 errors on Sat Aug 30 19:44:11 2008
config:

	NAME        STATE     READ WRITE CKSUM
	storage     ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>Όπως φαίνεται στο παράδειγμα, τα πάντα φαίνεται να λειτουργούν
	  φυσιολογικά.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91996880"></a>21.2.2.4. Επαλήθευση Δεδομένων</h4></div></div></div><p>Όπως αναφέραμε προηγουμένως, το <acronym class="acronym">ZFS</acronym>
	  χρησιμοποιεί <code class="literal">checksums</code> (αθροίσματα ελέγχου) για
	  να επαληθεύσει την ακεραιότητα των αποθηκευμένων δεδομένων.
	  Τα αθροίσματα ελέγχου ενεργοποιούνται αυτόματα κατά την δημιουργία
	  των συστημάτων αρχείων, και μπορούν να απενεργοποιηθούν μέσω της
	  επόμενης εντολής:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set checksum=off storage/home</code></strong></pre><p>Αυτό δεν είναι γενικά καλή ιδέα, καθώς τα checksums
	  καταλαμβάνουν ελάχιστο αποθηκευτικό χώρο, και είναι πολύ πιο
	  χρήσιμο να τα έχουμε ενεργοποιημένα.  Επίσης δεν φαίνεται να
	  προκαλούν κάποια σημαντική καθυστέρηση ή επιβάρυνση.  Με τα
	  checksums ενεργοποιημένα, μπορούμε να ζητήσουμε από το
	  <acronym class="acronym">ZFS</acronym> να ελέγξει την ακεραιότητα των δεδομένων
	  χρησιμοποιώντας τα για επαλήθευση.  Η διαδικασία αυτή είναι
	  γνωστή ως <span class="quote">«<span class="quote">scrubbing.</span>»</span>  Για να ελέγξετε την
	  ακεραιότητα δεδομένων του pool <code class="literal">storage</code>,
	  χρησιμοποιήστε την παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool scrub storage</code></strong></pre><p>Η διαδικασία αυτή μπορεί να πάρει αρκετή ώρα, ανάλογα με την
	  ποσότητα των αποθηκευμένων δεδομένων.  Επίσης χρησιμοποιεί πάρα
	  πολύ το δίσκο (<acronym class="acronym">I/O</acronym>), τόσο ώστε σε κάθε
	  δεδομένη στιγμή μπορεί να εκτελείται μόνο μια τέτοια διαδικασία.
	  Μετά την ολοκλήρωση του scrub, θα ανανεωθεί και η αναφορά
	  κατάστασης, την οποία μπορείτε να δείτε ζητώντας την με την
	  παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zpool status storage</code></strong>
 pool: storage
 state: ONLINE
 scrub: scrub completed with 0 errors on Sat Aug 30 19:57:37 2008
config:

	NAME        STATE     READ WRITE CKSUM
	storage     ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    da0     ONLINE       0     0     0
	    da1     ONLINE       0     0     0
	    da2     ONLINE       0     0     0

errors: No known data errors</pre><p>Στο παράδειγμα μας εμφανίζεται και η χρονική στιγμή που
	  ολοκληρώθηκε η εντολή scrub.  Η δυνατότητα αυτή μας εξασφαλίζει
	  ακεραιότητα δεδομένων σε μεγάλο βάθος χρόνου.</p><p>Υπάρχουν πολλές ακόμα επιλογές για το σύστημα αρχείων Ζ.  Δείτε
	  τις σελίδες manual <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=zfs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">zfs</span>(8)</span></a> και <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=zpool&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">zpool</span>(8)</span></a>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92010448"></a>21.2.2.5. ZFS Quotas</h4></div></div></div><p>Το ZFS υποστηρίζει διαφορετικούς τύπους quota: το refquota,
	  το γενικό quota, το quota χρήστη και το quota ομάδας.  Στην ενότητα
	  αυτή θα εξηγήσουμε τις βασικές έννοιες κάθε τύπου και θα δώσουμε
	  κάποιες οδηγίες χρήσης.</p><p>Τα quotas χρησιμοποιούνται για να περιορίσουν το χώρο στο δίσκο
	  που μπορεί να καταναλωθεί από ένα dataset και τους απογόνους του
	  (descendants) του καθώς και για να θέσουν περιορισμούς στο χώρο που
	  μπορεί να καταλάβει ένα στιγμιότυπο (snapshot).  Σε όρους χρήστη,
	  τα quotas είναι χρήσιμα για τον περιορισμό του χώρου δίσκου που
	  μπορεί να έχει στη διάθεση του κάποιος χρήστης.</p><div xmlns="" class="note"><h3 class="admontitle">Σημείωση: </h3><p xmlns="http://www.w3.org/1999/xhtml">Δεν μπορείτε να ορίσετε quotas σε τόμους (volumes) καθώς
	    αυτό ουσιαστικά γίνεται ήδη από την ιδιότητα
	    <code class="literal">volsize</code>.</p></div><p>Το refquota,
	  <code class="literal">refquota=size</code>,
	  περιορίζει το χώρο που μπορεί να καταναλώσει ένα dataset
	  θέτοντας ένα απόλυτο όριο χώρου (hard limit).  Ωστόσο, αυτό
	  το απόλυτο όριο δεν περιλαμβάνει το χώρο που χρησιμοποιείται
	  από τους απογόνους του dataset όπως τα συστήματα αρχείων ή
	  τα στιγμιότυπα.</p><p>Για να επιβάλετε γενικό quota 10 GB για το
	  <code class="filename">storage/home/bob</code>, χρησιμοποιήστε την
	  παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set quota=10G storage/home/bob</code></strong></pre><p>Τα quotas χρήστη περιορίζουν την ποσότητα χώρου που μπορεί να
	  χρησιμοποιήσει ένας συγκεκριμένος χρήστης.  Η γενική μορφή είναι
	  <code class="literal">userquota@user=size</code>,
	  και το όνομα του χρήστη πρέπει να δίνεται σε μια από τις παρακάτω
	  μορφές:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Μορφή συμβατή με το <acronym class="acronym">POSIX</acronym>,
	      για παράδειγμα <em class="replaceable"><code>joe</code></em>.</p></li><li class="listitem"><p>Μορφή συμβατή με το αριθμητικό αναγνωριστικό (ΙD) του
	      <acronym class="acronym">POSIX</acronym>,
	      για παράδειγμα <em class="replaceable"><code>789</code></em>.</p></li><li class="listitem"><p>Μορφή ονόματος <acronym class="acronym">SID</acronym>, για παράδειγμα
	      <em class="replaceable"><code>joe.bloggs@example.com</code></em>.</p></li><li class="listitem"><p>Μορφή αριθμητικού αναγνωριστικού (ID) <acronym class="acronym">SID</acronym>, για παράδειγμα
	      <em class="replaceable"><code>S-1-123-456-789</code></em>.</p></li></ul></div><p>Για παράδειγμα, για να επιβάλετε quota 50 GB για ένα
	  χρήστη με όνομα <em class="replaceable"><code>joe</code></em>, χρησιμοποιήστε
	  την παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set userquota@joe=50G</code></strong></pre><p>Για να αφαιρέσετε το quota ή να βεβαιωθείτε ότι δεν έχει τεθεί,
	  χρησιμοποιήστε την εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set userquota@joe=none</code></strong></pre><p>Οι ιδιότητες των quota χρηστών δεν απεικονίζονται μέσω της
	  εντολής <code class="command">zfs get all</code>.  Οι χρήστες εκτός του
	  <code class="systemitem">root</code> μπορούν να δουν μόνο τα δικά τους
	  quotas εκτός αν τους έχει αποδοθεί το προνόμιο
	  <code class="literal">userquota</code>.  Οι χρήστες με αυτό το προνόμιο
	  μπορούν να δουν και να ρυθμίσουν τo quota οποιουδήποτε
	  χρήστη.</p><p>Το quota ομάδας περιορίζει το διαθέσιμο χώρο που μπορεί να
	  χρησιμοποιηθεί από μια συγκεκριμένη ομάδα χρηστών.  Η γενική μορφή
	  είναι
	  <code class="literal">groupquota@group=size</code>.</p><p>Για να θέσετε quota για την ομάδα χρηστών
	  <em class="replaceable"><code>firstgroup</code></em> τα 50 GB, χρησιμοποιήστε
	  την παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set groupquota@firstgroup=50G</code></strong></pre><p>Για να αφαιρέσετε το quota ή να βεβαιωθείτε ότι δεν έχει τεθεί,
	  χρησιμοποιήστε την εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set groupquota@firstgroup=none</code></strong></pre><p>Όπως και με την ιδιότητα quota χρηστών, οι χρήστες εκτός του
	  <code class="systemitem">root</code> μπορούν να δουν μόνο τα quota που
	  σχετίζονται με τις ομάδες στις οποίες ανήκουν.  Ωστόσο, ο χρήστης
	  <code class="systemitem">root</code> και κάθε χρήστης στον οποίο έχει δοθεί
	  το προνόμιο <code class="literal">groupquota</code> μπορεί να δει και να
	  ρυθμίσει τα quota για όλες τις ομάδες.</p><p>Η υπο-εντολή <code class="command">zfs userspace</code> απεικονίζει
	  την ποσότητα χώρου που καταναλώνει κάθε χρήστης στο συγκεκριμένο
	  σύστημα αρχείων ή στιγμιότυπο καθώς και το καθορισμένο quota.
	  Η υπο-εντολή <code class="command">zfs groupspace</code> εκτελεί ακριβώς το
	  ίδιο για ομάδες χρηστών.  Για περισσότερες πληροφορίες σχετικά
	  με τις επιλογές εκτέλεσης ή απεικόνισης αυτών των εντολών, δείτε
	  το <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=zfs&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">zfs</span>(1)</span></a>.</p><p>Για να δειτε το quota για το
	  <code class="filename">storage/home/bob</code>, αν έχετε τα σωστά προνόμια
	  ή είστε ο <code class="systemitem">root</code>, χρησιμοποιήστε την παρακάτω
	  εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs get quota storage/home/bob</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp92046416"></a>21.2.2.6. Κρατήσεις Χώρου (reservations) στο ZFS</h4></div></div></div><p>Το ZFS υποστηρίζει δύο τύπους κρατήσεων χώρου.  Σε αυτή την
	  ενότητα θα εξηγήσουμε τις βασικές έννοιες κάθε τύπο και θα δώσουμε
	  κάποιες οδηγίες χρήσης.</p><p>Η ιδιότητα <code class="literal">reservation</code> μας επιτρέπει να
	  διαφυλάξουμε κάποιο εγγυημένο ελάχιστο ποσό χώρου για ένα dataset
	  και τους απογόνους του.  Αυτό σημαίνει ότι αν τεθεί κράτηση χώρου
	  10 GB στο <code class="filename">storage/home/bob</code> και ο διαθέσιμος
	  χώρος του δίσκου καταστεί ελάχιστος, θα διαφυλαχθούν τουλάχιστον
	  10 GB χώρου για αυτό το dataset.  Η ιδιότητα
	  <code class="literal">refreservation</code> θέτει ή δείχνει την ελάχιστη
	  ποσότητα χώρου που έχει κρατηθεί για ένα dataset χωρίς τους
	  απογόνους του (π.χ. τα στιγμιότυπα).  Για παράδειγμα, για να πάρετε
	  ένα στιγμιότυπο του <code class="filename">storage/home/bob</code> θα πρέπει
	  να έχετε επαρκή χώρο εκτός της ποσότητας
	  <code class="literal">refreservation</code> για να εκτελέσετε επιτυχώς τη
	  λειτουργία.  Οι απόγονοι του κυρίου dataset δεν προσμετρώνται από
	  την ιδιότητα <code class="literal">refreservation</code> και δεν καταπατούν
	  τον ελεύθερο χώρο του.</p><p>Οι κρατήσεις κάθε τύπου είναι χρήσιμες σε πολλές περιπτώσεις,
	  για παράδειγμα στο σχεδιασμό και δοκιμή καταλληλότητας της κατανομής
	  χώρου σε ένα νέο σύστημα ή την εξασφάλιση διαθεσιμότητας αρκετού
	  ελεύθερου χώρου σε ένα σύστημα για λειτουργίες ανάκτησης
	  δεδομένων (recovery).</p><p>Η γενική μορφή της ιδιότητας <code class="literal">reservation</code>
	  είναι
	  <code class="literal">reservation=size</code>.
	  Για να θέσετε κράτηση 10 GB στο
	  <code class="filename">storage/home/bob</code> χρησιμοποιήστε την
	  παρακάτω εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set reservation=10G storage/home/bob</code></strong></pre><p>Για να αφαιρέσετε ένα reservation ή να βεβαιωθείτε ότι δεν έχει
	  τεθεί, εκτελέστε την εντολή:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs set reservation=none storage/home/bob</code></strong></pre><p>Μπορείτε να εφαρμόσετε την ίδια βασική αρχή και για να θέσετε
	  την ιδιότητα <code class="literal">refreservation</code>, χρησιμοποιώντας τη
	  γενική μορφή
	  <code class="literal">refreservation=size</code>.</p><p>Για να ελέγξετε αν υπάρχουν reservations ή refreservations στο
	  <code class="filename">storage/home/bob</code>, εκτελέστε μια από τις
	  παρακάτω εντολές:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>zfs get reservation storage/home/bob</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>zfs get refreservation storage/home/bob</code></strong></pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="filesystems.html">Προηγ</a> </td><td width="20%" align="center"><a accesskey="u" href="filesystems.html">Πάνω</a></td><td width="40%" align="right"> <a accesskey="n" href="filesystems-linux.html">Επόμενο</a></td></tr><tr><td width="40%" align="left" valign="top">Κεφάλαιο 21. Υποστήριξη Συστημάτων Αρχείων </td><td width="20%" align="center"><a accesskey="h" href="index.html">Αρχή</a></td><td width="40%" align="right" valign="top"> 21.3. Συστήματα Αρχείων <span class="trademark">Linux</span>(R)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Αυτό το κείμενο, και άλλα κείμενα, μπορεί να βρεθεί στο
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Για ερωτήσεις σχετικά με το FreeBSD, διαβάστε την
    <a href="http://www.FreeBSD.org/docs.html">τεκμηρίωση</a> πριν να επικοινωνήσετε με την
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Για ερωτήσεις σχετικά με αυτή την τεκμηρίωση, στείλτε e-mail στην
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>