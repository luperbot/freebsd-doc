======================
2. ??????? ??? NanoBSD
======================

.. raw:: html

   <div class="navheader">

2. ??????? ??? NanoBSD
`????? <index.html>`__?
?
?\ `??????? <ix01.html>`__

--------------

.. raw:: html

   </div>

.. raw:: html

   <div class="sect1">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

2. ??????? ??? NanoBSD
----------------------

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

2.1. ? ???????? ??? NanoBSD
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

???? ??????? ??? ?????? ??? NanoBSD ?? ?????? ???????????? ????, ??????
?? ?????????????? ??? ?? ????????? ??? ??????? FreeBSD. ? ??????????????
?????????? ??? ????? ????????? ??????????? ??? ???? ????:

.. raw:: html

   <div class="itemizedlist">

-  ??? ???????????? ?????????: ``code#1`` ??? ``code#2``.

-  ?? ?????????? ?????????, ???? ?????? ?? ??????????? ???? ????????
   ``/cfg`` ??? ??? ??????????? ??? NanoBSD.

.. raw:: html

   </div>

???? ?? ???? ???????????? ???????? ????? ???????????? ???? ??? ????????.

?? ????????? ``/etc`` ??? ``/var`` ????? ????????? ??????
`md(4) <http://www.FreeBSD.org/cgi/man.cgi?query=md&sektion=4>`__
(malloc).

?? ?????????? ????????? ?????? ?? ??????????? ???? ???????? ``/cfg``.
???????? ?????? ?? ????? ????????????? ???? ???????? ``/etc``. ???? ???
???????? ??? ?????????? ?? ?????????? ????????? ??????????? ?????????
???? ??? ???????? ??? ????????????? ?? ?????? ??? ???? ????????
``/etc``. ????? ??? ?? ????? ?????? ?????? ????????? ??? ???????? ??? ??
?????? ????? ??? ???? ??? ???????????? ??? ??????????, ?????? ??
???????????? ??? ??? ???????? ``/etc`` ??? ?????????? ?????????, ????
???? ??????????? ??? ??????? ???? ???????? ``/cfg``.

.. raw:: html

   <div class="example">

.. raw:: html

   <div class="example-title">

?????????? 1. ???????? ??????? ??????? ??? ``/etc/resolv.conf``

.. raw:: html

   </div>

.. raw:: html

   <div class="example-contents">

.. code:: screen

    # vi /etc/resolv.conf
    [...]
    # mount /cfg
    # cp /etc/resolv.conf /cfg
    # umount /cfg

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="note" xmlns="">

????????:
~~~~~~~~~

?? ?????????? ?? ????? ???????? ??? ???????? ``/cfg`` ?????? ??
??????????? ???? ???? ??? ???????? ??? ???? ????? ????????????? ??
?????? ????????? ??? ``/cfg``.

??? ????? ???? ???? ?? ????? ?????? ???????????? ?? ?????????? ``/cfg``.
?? ??? ?????????? ????? ???????????? ??? ??????? ??? ?? ????????????
???? ??? NanoBSD ????????? ???????????? ?????? ?????? ???????? (????
?.?. ??????? ?????? CF), ?????? ?? ?????????? ???????? ?? ????????????
???? ?????? ? ??????? ?????? ???? ???? ????? ??????? ??? ??????????
(syncer).

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

2.2. ?????????? ???? ?????????????? ?????????? NanoBSD
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ?????? ??? NanoBSD ????????????? ??? ??? ???? ??????? ????????, ??
``nanobsd.sh``, ?? ????? ?????? ?? ?????? ???? ????????
``/usr/src/tools/nanobsd``. ???? ?? ??????? ?????????? ??? ??????
??????, ?? ????? ?????? ?? ?????????? ????????? ?? ?????? ????????????
???? ??????????????? ?? ?????????
`dd(1) <http://www.FreeBSD.org/cgi/man.cgi?query=dd&sektion=1>`__.

?? ??????????? ??????? ??????????? ?? ???????????? ??? ?????? ???
NanoBSD ????? ?? ????:

.. code:: screen

    # cd /usr/src/tools/tools/nanobsd 
    # sh nanobsd.sh 
    # cd /usr/obj/nanobsd.full 
    # dd if=_.disk.full of=/dev/da0 bs=64k 

.. raw:: html

   <div class="calloutlist">

+--------------------------------------+--------------------------------------+
| `|1| <#nbsd-cd>`__                   | ?????? ??? ??? ???????? ????????     |
|                                      | ???? ?????? ???????? ??? ????????    |
|                                      | ??????????? ??? NanoBSD.             |
+--------------------------------------+--------------------------------------+
| `|2| <#nbsd-sh>`__                   | ???????? ??? ??????????? ???         |
|                                      | ???????.                             |
+--------------------------------------+--------------------------------------+
| `|3| <#nbsd-cd2>`__                  | ?????? ??? ??? ???????? ????????     |
|                                      | ???? ???????? ??? ???????? ?? ?????? |
|                                      | ??? NanoBSD.                         |
+--------------------------------------+--------------------------------------+
| `|4| <#nbsd-dd>`__                   | ????????? ??? NanoBSD ?? ??? ????    |
|                                      | ???????????.                         |
+--------------------------------------+--------------------------------------+

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

2.3. ?????????????? ?? ?????? ??? NanoBSD
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

???? ????? ?????????? ?? ??? ????????? ??? ??? ?????????? ??????????????
??? NanoBSD. ???? ????? ??? ?? ????? ??? ??????????? ????????? ???
??????? NanoBSD ??? ?? ????? ?? ???????? ??? ?????? ??????? ??? ??????
????????????? ??? ???????.

? ???????? ?????? ?? ????? ?? ``nanobsd.sh`` ?? ???????? ??? ?????????
??? ??? ?? ?????? ``myconf.nano`` ??? ????????? ??? ???????? ????????:

.. code:: screen

    # sh nanobsd.sh -c myconf.nano

? ?????????? ??? ??????????????? ??? NanoBSD ??????? ??????? ?? ???
???????:

.. raw:: html

   <div class="itemizedlist">

-  ???????? ???????????

-  ?????????????? ???????????

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

2.3.1. ???????? ???????????
^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ????????? ??? NanoBSD ??????? ?? ??????????????? ??? ?? ????????
?????????????? ???????? ????????????? ??? ???????????? ??? FreeBSD.
????? ?? ???????? ?????????? ?? ?????? ``buildworld`` ???
``installworld`` ??? NanoBSD, ????? ??? ????? ???????? ??? ???????????
??? ??????? ???????. ?? ??? ?????????? ????????? ?? NanoBSD ?????? ??
???????? ?????? ?? ???????? ?????? ?? ??????? ??? ???? ????? ?????????
??? ??????? FreeBSD ?? ???? ????????? ??? 64MB. ???????? ?????? ??
??????????????? ??? ???????? ??? NanoBSD ??? ?? ????????????? ??? ??????
??? ???? ???? ??? ?????? ??? ???-???? ?????? ??? ?????? ???????.

?? ?????? ????????? ??? NanoBSD ???????? ??????? ?? ?????? ??????? ????
????? ??? ?????? ?????????????? ????????? ? ??????????? ??? ??????????
?????????. ?? ??? ?????????? ?????????? ????? ?? ????:

.. raw:: html

   <div class="itemizedlist">

-  ``NANO_NAME`` - ?? ????? ??? ??????? NanoBSD ??? ?? ????????????
   (??????????????? ??? ?? ??????? ?? ??????? ??? ????????? ????????).

-  ``NANO_SRC`` - ? ???????? ??? ??????? ??????? ?????? ?? ????? ??
   ?????????????? ??? ?? ????????????? ?? ??????.

-  ``NANO_KERNEL`` - ?? ????? ??? ??????? ????????? ?????? ?? ????? ??
   ?????????????? ??? ?? ??????? ? ??????? ??? ???????.

-  ``CONF_BUILD`` - ???????? ??? ??????? ??? ?????? ``buildworld`` ???
   ????????????? ??? FreeBSD.

-  ``CONF_INSTALL`` - ???????? ??? ??????? ??? ?????? ``installworld``
   ??? ????????????? ??? ???????.

-  ``CONF_WORLD`` - ???????? ??? ??????? ??? ??? ??? ?????? ???
   ????????????? ??? ???????, ??? ??? ``buildworld`` ??? ???
   ``installworld``.

-  ``FlashDevice`` - ?????? ??? ???? ??? ????? ??????????? ??? ??
   ??????????????. ??? ???????????? ???????????? ????? ?? ??????
   ``FlashDevise.sub``.

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

2.3.2. ?????????????? ???????????
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

??? ?????? ???????? ??? NanoBSD ?????? ?? ????????? ?????? ????
??????????? ??? ????????????? ??? ??????? ??? ??? ??????? ??????? ??
????? ?? ????????????. ??????????????? ?????? ??????????? ??????,
???????? ?? ?????????? ?? ?????. ??? ??????????, ???????? ?? ????????
????? ??? ??????? ?? ?????? ??????????????? ?? ?????? ?????? ?? ????:

.. code:: programlisting

    cust_foo () (
        echo "bar=topless" > \
            ${NANO_WORLDDIR}/etc/foo
    )
    customize_cmd cust_foo

??? ??? ??????? ?????????? ?????????? ??????, ? ????? ???????? ??????
????????? ??? ??????? ???????, ????? ???? ??? ?????????. ? ?????????
``cust_etc_size`` ??????? ??? ????????????? ???? ???????? ??? ?????????
``/etc`` ??? 5MB ?? 30MB:

.. code:: programlisting

    cust_etc_size () (
        cd ${NANO_WORLDDIR}/conf
        echo 30000 > default/etc/md_size
    )
    customize_cmd cust_etc_size

?? ??????? ?????? ??? ?????????? ?? NanoBSD ???? ??????? ???????
??????????? ?????? ?? ?????? ???????? ??????? ???????? ?????????:

.. raw:: html

   <div class="itemizedlist">

-  ``cust_comconsole`` - ????????????? ??
   `getty(8) <http://www.FreeBSD.org/cgi/man.cgi?query=getty&sektion=8>`__
   ???? ???????? VGA (?? ???????? ``/dev/ttyv*``) ??? ??????????? ???
   ????? ??? ????????? ????? COM1 ?? ??????? ??????????.

-  ``cust_allow_ssh_root`` - ????????? ??? ?????? ??? ?????? ``root``
   ???? ???
   `sshd(8) <http://www.FreeBSD.org/cgi/man.cgi?query=sshd&sektion=8>`__.

-  ``cust_install_files`` - ????????? ?????? ??? ??? ????????
   ``nanobsd/Files``. ?? ???? ??? ???????? ?????????? ?????? ???????
   ??????? ?????? ??? ?? ?????????? ???? ?????????? NanoBSD.

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

2.3.3. ???????????? ??????
^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ??? ?????? NanoBSD ??????? ?? ?????????? ??? ?????? ??????, ??? ?????
???????? ??? ???? ??????????????? ?? ??????? ??? Ports. ??? ?????????
?????? ?????? ?? ???????????? ????? ?????? ??? ??? ??? ?????????????? ??
??????. ??? ??????????, ? ???????? ????????? ?? ???????????? ??? ??????
??? ?? ?????? ??? ?????????? ???? ????????
``/usr/src/tools/tools/nanobsd/packages``:

.. code:: programlisting

    install_packages () (
    mkdir -p ${NANO_WORLDDIR}/packages
    cp /usr/src/tools/tools/nanobsd/packages/* ${NANO_WORLDDIR}/packages
    chroot ${NANO_WORLDDIR} sh -c 'cd packages; pkg_add -v *;cd ..;'
    rm -rf ${NANO_WORLDDIR}/packages
    )

    customize_cmd install_packages

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

2.3.4. ?????????? ??????? ????????? ??? NanoBSD
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

??? ?????? ?????????? ??????? ????????? ??? ?? NanoBSD, ?? ????????
????????? ??? ?? ???????????? ??? FreeBSD ??? ??? ???????????? ???
??????? ???????, ?????? ?? ??????? ????? ????:

.. code:: programlisting

    NANO_NAME=custom
    NANO_SRC=/usr/src
    NANO_KERNEL=MYKERNEL
    NANO_IMAGES=2

    CONF_BUILD='
    NO_KLDLOAD=YES
    NO_NETGRAPH=YES
    NO_PAM=YES
    '

    CONF_INSTALL='
    NO_ACPI=YES
    NO_BLUETOOTH=YES
    NO_CVS=YES
    NO_FORTRAN=YES
    NO_HTML=YES
    NO_LPR=YES
    NO_MAN=YES
    NO_SENDMAIL=YES
    NO_SHAREDOCS=YES
    NO_EXAMPLES=YES
    NO_INSTALLLIB=YES
    NO_CALENDAR=YES
    NO_MISC=YES
    NO_SHARE=YES
    '

    CONF_WORLD='
    NO_BIND=YES
    NO_MODULES=YES
    NO_KERBEROS=YES
    NO_GAMES=YES
    NO_RESCUE=YES
    NO_LOCALES=YES
    NO_SYSCONS=YES
    NO_INFO=YES
    '

    FlashDevice SanDisk 1G

    cust_nobeastie() (
        touch ${NANO_WORLDDIR}/boot/loader.conf
        echo "beastie_disable=\"YES\"" >> ${NANO_WORLDDIR}/boot/loader.conf
    )

    customize_cmd cust_comconsole
    customize_cmd cust_install_files
    customize_cmd cust_allow_ssh_root
    customize_cmd cust_nobeastie

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="sect2">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

2.4. ????????????? ?? NanoBSD
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

? ?????????? ?????????? ??? NanoBSD ????? ??????? ????:

.. raw:: html

   <div class="procedure">

#. ?????????? ???? ???? ??????? NanoBSD, ?? ?? ??????????? ?????.

#. ???????? ??? ???? ??????? ?? ??? ?????????????? ????????? ????
   ???????? ??? ?????? NanoBSD.

   ? ??? ????????? ??????? ????? ??? ??????? ??? ??? ?????? ???????????
   ??? NanoBSD ????? ??? ???? ???? ??? ??????? ``_.disk.full`` (?? ?????
   ???????? ?? ?????? ???? ????????? ??????), ????????????? ?? ??????
   ``_.disk.image`` (?? ????? ???????? ?? ?????? ???? ???? ??????????
   ??? ??????).

#. ???????? ??? ???????????? ??? ?????????? ??? ??? ??? ?????????????
   ?????????.

#. ?? ??? ???? ????, ? ?????????? ????????.

#. ?? ????????? ???? ??????, ????????????? ?? ??????? ??? ???
   ??????????? ????????? (? ????? ???????? ?? ????? ??????, ???
   ?????????? ?????). ???? ???????? ?? ??????????? ????? ?? ??????? ??
   ??????????? ?????????. ????????? ??????????? ?????????? ???? ?? ???
   ??????, ??? ??????????? ??? ??????????.

.. raw:: html

   </div>

??? ?? ???????????? ?? ??? ?????? ?? ??? ??????? NanoBSD, ?? ????? ???
????????? ?? ??????????, ?????? ?? ?????????????? ???? ?? ???????
``updatep1`` ???? ?? ``updatep2``. ???? ?? ??? ??????? ?????? ??????????
???? ???????? ``/root``.

??????? ?? ??? ????????? ??? ?????????? ??? ????? ????????????? ???
?????? NanoBSD, ?????? ?? ?????????? ??? ??? ?????? ??? ?????? ???????
?? ????????? ???????:

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

2.4.1. ??????????????? ?? `ftp(1) <http://www.FreeBSD.org/cgi/man.cgi?query=ftp&sektion=1>`__
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ??? ?????????? ? ???? ???????? ?????????, ?????????????? ?? FTP ???
?? ???????? ??? ???????:

.. code:: screen

    # ftp myhost
    get _.disk.image "| sh updatep1"

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

2.4.2. ??????????????? ?? `ssh(1) <http://www.FreeBSD.org/cgi/man.cgi?query=ssh&sektion=1>`__
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ??? ?????????? ? ???????? ??? ??????? ?? ????? ?? ?????? ????? ???
??? ????? ????????? ??? ?? ?????? ?????? ??
`ssh(1) <http://www.FreeBSD.org/cgi/man.cgi?query=ssh&sektion=1>`__,
?????????? ?? ???????? ???? SSH:

.. code:: screen

    # ssh myhost cat _.disk.image.gz | zcat | sh updatep1

.. raw:: html

   </div>

.. raw:: html

   <div class="sect3">

.. raw:: html

   <div class="titlepage" xmlns="">

.. raw:: html

   <div>

.. raw:: html

   <div>

2.4.3. ??????????????? ?? `nc(1) <http://www.FreeBSD.org/cgi/man.cgi?query=nc&sektion=1>`__
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

?? ?? ??????? ??? ????? ???? ???????????? ?? ??? ?????? ??? NanoBSD ???
?????? ????
`ftpd(8) <http://www.FreeBSD.org/cgi/man.cgi?query=ftpd&sektion=8>`__
????
`sshd(8) <http://www.FreeBSD.org/cgi/man.cgi?query=sshd&sektion=8>`__,
???????? ?? ??????????????? ???? ???????? ??? ?? ????????, ???? ??
`nc(1) <http://www.FreeBSD.org/cgi/man.cgi?query=nc&sektion=1>`__:

.. raw:: html

   <div class="procedure">

#. ????? ??????? ??? ??????????? TCP ??? ??????? ?? ????? ?? ??????? ??
   ??? ??????, ??? ?????? ?? ??? ?????? ?? ?????? ??? ?? ???????? ??? ??
   ????? ????????:

   .. code:: screen

       myhost# nc -l 2222 < _.disk.image

   .. raw:: html

      <div class="note" xmlns="">

   ????????:
   ~~~~~~~~~

   ???? ??? ???? ??????????? ??? ? ???? ??? ?????????????? ??? ???
   ??????????? ?????? ?? ?????? ???????????? ????????? ??? ?? ???????
   NanoBSD ???? ?? ??????? ??? ???????????, ??? ??? ???????????, ???
   ??????????, ??? ?????? ?????? ?????????? (?firewall?).

   .. raw:: html

      </div>

#. ?????????? ??? ?? NanoBSD ???? ???????????, ? ?????? ????? ???
   ??????? ?? ??????? ?? ??? ??????, ??? ????????????? ?? ??????? ??????
   ``updatep1`` ?? ??? ????? ??? ?????????
   `nc(1) <http://www.FreeBSD.org/cgi/man.cgi?query=nc&sektion=1>`__:

   .. code:: screen

       # nc myhost 2222 | sh updatep1

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   </div>

.. raw:: html

   <div class="navfooter">

--------------

+---------------------------+-------------------------+------------------------------+
| `????? <index.html>`__?   | ?                       | ?\ `??????? <ix01.html>`__   |
+---------------------------+-------------------------+------------------------------+
| ???????? ??? NanoBSD?     | `???? <index.html>`__   | ??????????                   |
+---------------------------+-------------------------+------------------------------+

.. raw:: html

   </div>

???? ?? ???????, ??? ???? ???????, ?????? ?? ?????? ???
ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/

| ??? ????????? ??????? ?? ?? FreeBSD, ???????? ???
  `?????????? <http://www.FreeBSD.org/docs.html>`__ ???? ??
  ?????????????? ?? ??? <questions@FreeBSD.org\ >.
|  ??? ????????? ??????? ?? ???? ??? ??????????, ??????? e-mail ????
  <doc@FreeBSD.org\ >.

.. |1| image:: ./imagelib/callouts/1.png
.. |2| image:: ./imagelib/callouts/2.png
.. |3| image:: ./imagelib/callouts/3.png
.. |4| image:: ./imagelib/callouts/4.png
