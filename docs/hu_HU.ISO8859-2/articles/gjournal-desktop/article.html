<?xml version="1.0" encoding="iso-8859-2"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>Naplózó UFS használata asztali számítógépeken</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="description" content="A naplózó állományrendszerek egy napló segítségével rögzítik az összes bennük lezajlott tranzakciót, ezzel igyekszenek megõrizni egy rendszeromlást vagy áramkimaradást követõen a rajtuk tárolt adatok épségét. Noha még így is elõfordulhat, hogy elveszítjük az adott pillanatban el nem mentett változtatásainkat, a naplózás viszont az állományrendszer számára tökéletes védelmet nyújt a rendszer szabálytalan leállása során keletkezõ sérülések ellen. Alkalmazása továbbá jelentõs mértékben lerövidíti a helyreállításhoz szükséges ellenõrzés idejét. A FreeBSD alaprendszerben megtalálható UFS állományrendszer önmagában nem tartalmaz naplózást, azonban a FreeBSD 7.X változataiban már megjelent egy olyan GEOM-osztály, amellyel az állományrendszertõl független módon ezt meg tudjuk valósítani. Ebben a cikkben bemutatjuk miként alakítsunk ki UFS alapú naplózást egy hétköznapi asztali számítógépen. Fordította: Páli Gábor, utolsó ellenõrzés: 2010.11.28." /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div xml:lang="hu" class="article" lang="hu"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp69893072"></a>Naplózó UFS használata asztali
      számítógépeken</h1></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="author"><h3 class="author"><span class="surname">Kiagias</span>, <span class="firstname">Manolis</span></h3><div class="affiliation"><div class="address"><p><code class="email">&lt;<a xmlns="" class="email" href="mailto:manolis@FreeBSD.org">manolis@FreeBSD.org</a>&gt;</code></p></div></div></div></div><div>Verzió: <a href="https://svnweb.freebsd.org/changeset/doc/"><span class="svnref"></span></a></div><div><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Szerzõi jog (c) 2008 Manolis Kiagias</p></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="legalnotice"><a id="trademarks"></a><p>A FreeBSD a FreeBSD Foundation
  bejegyzett védjegye.</p><p>A gyártók és terjesztõk által
  használt megnevezések közül sok védjegy
  jogot követel.  Ahol ilyen megnevezés tûnik fel ebben
  a dokumentumban, és a FreeBSD Projektnek tudomása volt a
  védjegyrõl, a megnevezést a <span class="quote">"<span class="quote">TM</span>"</span> vagy a
  <span class="quote">"<span class="quote">(R)</span>"</span> szimbólum követi.</p></div></div><div>   írta .</div><div><div xmlns="http://www.w3.org/1999/xhtml" class="abstract"><div class="abstract-title">Kivonat</div><p>A naplózó állományrendszerek egy
	napló segítségével
	rögzítik az összes bennük lezajlott
	tranzakciót, ezzel igyekszenek megõrizni egy
	rendszeromlást vagy áramkimaradást
	követõen a rajtuk tárolt adatok
	épségét.  Noha még így is
	elõfordulhat, hogy elveszítjük az adott
	pillanatban el nem mentett változtatásainkat, a
	naplózás viszont az állományrendszer
	számára tökéletes védelmet
	nyújt a rendszer szabálytalan
	leállása során keletkezõ
	sérülések ellen.  Alkalmazása
	továbbá jelentõs mértékben
	lerövidíti a helyreállításhoz
	szükséges ellenõrzés idejét.  A
	FreeBSD alaprendszerben megtalálható UFS
	állományrendszer önmagában nem
	tartalmaz naplózást, azonban a
	FreeBSD 7.<em class="replaceable"><code>X</code></em> változataiban
	már megjelent egy olyan GEOM-osztály, amellyel az
	állományrendszertõl független
	módon ezt meg tudjuk valósítani.  Ebben a
	cikkben bemutatjuk miként alakítsunk ki UFS
	alapú naplózást egy hétköznapi
	asztali számítógépen.</p><p><span class="emphasis"><em>Fordította: Páli Gábor,
	utolsó ellenõrzés:
	2010.11.28.</em></span></p></div></div></div><hr /></div><div class="toc"><div class="toc-title">Tartalom</div><dl class="toc"><dt><span class="sect1"><a href="#introduction">1. Bevezetés</a></span></dt><dt><span class="sect1"><a href="#understanding-journaling">2. Naplózás FreeBSD alatt</a></span></dt><dt><span class="sect1"><a href="#reserve-space">3. A FreeBSD telepítése során
      elvégzendõ lépések</a></span></dt><dt><span class="sect1"><a href="#configure-journal">4. A naplózás
      beállítása</a></span></dt><dt><span class="sect1"><a href="#troubleshooting-gjournal">5. A naplózás használata során
      felmerülõ hibák kezelése</a></span></dt><dt><span class="sect1"><a href="#further-reading">6. Ajánlott olvasmányok</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="introduction"></a>1. Bevezetés</h2></div></div></div><p>Míg az ipari szervereket általában
      alaposan felkészítik az esetlegesen
      bekövetkezõ váratlan leállásokra,
      addig egy átlagos asztali
      számítógép teljesen
      kiszolgáltatott az áramkimaradások, a
      véletlen újraindítások és
      minden más olyan beavatkozás számára,
      amelyek a rendszer nem szabályos
      leállását eredményezik.  A Soft
      Updates ilyen helyzetekben általában
      hatékonyan védelmezi az
      állományrendszert, ez azonban a legtöbb esetben
      egy hosszadalmasabb háttérbeli
      ellenõrzést von maga után.  Nagyon
      ritkán viszont az állományrendszer olyan
      mértékben károsodik, hogy a
      helyreállításához már
      felhasználói beavatkozás
      szükségeltetik és gyakran adatvesztéssel
      is jár.</p><p>A GEOM alrendszerhez nemrég hozzáadott új
      naplózási képesség az ilyen
      szituációkban remekül alkalmazható,
      és ennek köszönhetõen szinte
      egyáltalán nem igényel idõt a
      sérült állományrendszer
      ellenõrzése, illetve gondoskodik a legutolsó
      stabil állapot villámgyors
      visszaállításáról.</p><p>Ebben a cikkben bemutatunk egy eljárást, amely
      segítségével UFS
      állományrendszerekhez tudunk naplózást
      beállítani hagyományos asztali
      számítógépeken
      (feltételezzük, hogy az operációs
      rendszer és az adatok egyetlen merevlemezen helyezkednek
      el).  A folyamatot a FreeBSD telepítésén
      keresztül ismertetjük, és olyan lépesekre
      bontottuk, hogy lehetõleg kerüljük a bonyolultabb
      parancssori mûveleteket.</p><p>A cikk elolvasása során megismerjük:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>a FreeBSD telepítése során hogyan
	  hagyjunk helyet a napló számára;</p></li><li class="listitem"><p>hogyan töltsük be és
	  engedélyezzük a <code class="literal">geom_journal</code>
	  modult (vagy építsük be egy saját
	  rendszermagba);</p></li><li class="listitem"><p>hogyan alakítsuk át a már
	  meglevõ állományrendszereinket
	  naplózóvá, az
	  <code class="filename">/etc/fstab</code> állományban
	  milyen beállításokat kell megadnunk a
	  csatlakoztatásukhoz;</p></li><li class="listitem"><p>hogyan állítsuk be a naplózást
	  új (üres) partíciókon;</p></li><li class="listitem"><p>hogyan oldjuk meg a naplózással kapcsolatban
	  leggyakrabban jelentkezõ problémákat.</p></li></ul></div><p>A cikk elolvasásához ajánlott:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>a <span class="trademark">UNIX</span>(R) és a FreeBSD alapvetõ fogalmainak
      ismerete;</p></li><li class="listitem"><p>a FreeBSD telepítés menetének és
	  a <span class="application">sysinstall</span> alkalmazás
	  ismerete.</p></li></ul></div><div xmlns="" class="warning"><h3 class="admontitle">Figyelem: </h3><p xmlns="http://www.w3.org/1999/xhtml">Az itt megadott eljárás alapvetõen egy
	új rendszer telepítésének
	esetére vonatkozik, ahol még semmilyen
	felhasználói adatot nem tárolunk a lemezen.
	Természetesen ez a módszer
	átültethetõ mûködõ, éles
	rendszerekre is, azonban ilyenkor mindig
	készítsünk <span class="emphasis"><em>biztonsági
	mentést</em></span> mielõtt nekikezdenénk.
	Ugyanis amikor ilyen alacsony szinten dolgozunk lemezekkel
	és partíciókkal, bármilyen hiba
	könnyedén végzetesnek bizonyulhat az
	adatainkra nézve.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="understanding-journaling"></a>2. Naplózás FreeBSD alatt</h2></div></div></div><p>A FreeBSD 7.<em class="replaceable"><code>X</code></em>
      változataiban a GEOM részérõl
      felkínált naplózási
      lehetõség (eltérõen például
      a <span class="trademark">Linux</span>(R) típusú rendszerekben
      található ext3
      állományrendszertõl) nem kötõdik
      konkrét állományrendszerhez, de blokkok
      szintjén üzemel.  Habár ez arra utal, hogy
      különbözõ állományrendszerek
      esetén is használható, a FreeBSD 7.0-RELEASE
      kiadásában még csak az UFS2 felett
      mûködik.</p><p>Ezt a funkciót a <code class="filename">geom_journal.ko</code>
      modul betöltésével (vagy rendszermagba
      építésével) tudjuk aktiválni,
      majd a <code class="command">gjournal</code> paranccsal érjük el
      az állományrendszerek
      konfigurációjához szükséges
      felületet.  Általában nagyobb
      állományrendszereken, például a
      <code class="filename">/usr</code> partíción érdemes
      engedélyezni a naplózást.  Nem szabad
      elfelejtenünk, hogy ehhez azonban fenn kell tartanunk
      némi szabad területet a lemezen (errõl a
      következõ szakaszban lesz szó).</p><p>Amikor egy állományrendszeren bekapcsoljuk a
      naplózást, magát a naplót is
      tárolnunk kell valahol a lemezen.  A tényleges
      adatokat tároló lemezterületet
      <span class="emphasis"><em>adatterületnek</em></span>, míg a
      naplót tároló területet pedig
      <span class="emphasis"><em>naplóterületnek</em></span> nevezzük.
      Ha egy meglevõ (nem üres) partícióhoz
      akarunk naplózást társítani, akkor az
      adat- és naplóterületeknek külön
      partíciókon kell lenniük.  Amikor viszont egy
      teljesen új partícióhoz kapcsolunk
      naplózást, lehetõségünk van
      egyetlen területen tárolni az adatokat és a
      naplót.  Bármelyik esettel is van dolgunk, a
      <code class="command">gjournal</code> parancs a naplózó
      állományrendszer véglegesített
      változatát ezen két fajta terület
      egyesítésébõl hozza létre.
      Például:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A <code class="filename">/dev/ad0s1f</code>
	  eszközön található
	  <code class="filename">/usr</code> állományrendszeren
	  szeretnénk naplózást használni
	  (amely már eleve tartalmaz hasznos adatokat).</p></li><li class="listitem"><p>A partíciók létrehozása
	  során a <code class="filename">/dev/ad0s1g</code> eszközön
	  lefoglaltunk valamennyi helyet.</p></li><li class="listitem"><p>A <code class="command">gjournal</code> parancs
	  segítségével készítünk
	  egy <code class="filename">/dev/ad0s1f.journal</code>
	  eszközt, ahol a <code class="filename">/dev/ad0s1f</code> eszközön
	  tároljuk az adatokat és a <code class="filename">/dev/ad0s1g</code> eszközön a
	  naplót.  A továbbiakban ezt az új
	  eszközt fogjuk használni.</p></li></ul></div><p>A napló számára fenntartott hely
      mennyisége nem az adatok méretétõl, hanem
      az állományrendszer
      terheltségétõl függ.
      Például egy átlagos irodai
      számítógép esetén a
      <code class="filename">/usr</code> állományrendszerhez
      nagyjából egy 1 GB méretû
      naplózási terület remekül megfelel,
      viszont egy terheltebb rendszer (amellyel például
      videoanyagok vágását végezzük)
      számára ennél több kellhet.  A
      naplóterület idõ elõtti
      kimerülése a rendszermag
      összeomlásával jár.</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">A cikkben javasolt méretek
	használatával nagyon
	valószínûtlen, hogy hétköznapi
	feladataink (böngészés az interneten,
	szövegszerkesztés, különbözõ
	multimédia anyagok lejátszása) közben
	bármilyen problémát
	észlelnénk.  Ha viszont a lemezünk
	tartósabb terhelés alatt van, a
	következõ szabály betartásával
	érhetjük el a legjobb eredményt: a
	számítógépünkben levõ
	központi memória teljes tartalmának mindig el
	kell tudnia férni a naplóterület
	egyharmadán.  Tehát például ha a
	rendszerünk 1 GB memóriával rendelkezik,
	akkor egy közel 3,3 GB méretû
	naplóterület ajánlott.
	(Általánosan: Úgy kapjuk meg a
	naplóterület méretét, ha megszorozzuk
	a memória méretet 3,3-mal.)</p></div><p>A naplózásról részleteiben a
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gjournal&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gjournal</span>(8)</span></a> man oldalon olvashatunk.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="reserve-space"></a>3. A FreeBSD telepítése során
      elvégzendõ lépések</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp70014160"></a>3.1. Lemezterület lefoglalása a
	naplónak</h3></div></div></div><p>Az asztali számítógépekben
	többnyire csupán egyetlen merevlemez
	található, amelyen maga az operációs
	rendszer és az adatok helyezkednek el.  A
	<span class="application">sysinstall</span> által
	felajánlott alapértelmezett
	partícionálási séma
	alkalmassága vitatható: egy asztali gép
	esetén például nincs
	szükségünk akkora <code class="filename">/var</code>
	partícióra, viszont a <code class="filename">/usr</code>
	foglalja el a merevlemez legnagyobb részét, hiszen
	a felhasználók adatai és a rendszerre
	telepített csomagok ide fognak kerülni.</p><p>Az alapértelmezés szerinti felosztás
	(amely a <span class="application">Disklabel</span>
	partíciószerkesztõben az <span class="keycap"><strong>A</strong></span>
	billentyûvel érhetõ el) nem hagy semennyi
	lemezterületet szabadon.  Ahány
	partíciót naplózással akarunk
	ellátni, annyi további partícióra
	lesz szükségünk a naplókhoz.  Mivel a
	<code class="filename">/usr</code> lesz közülük a
	legnagyobb, próbáljuk meg ezen
	partíció méretének
	csökkentésével helyet csinálni a
	naplónak.</p><p>A példában most egy 80 GB
	méretû lemezt láthatunk.  Az
	ábrán most a telepítés közben a
	<span class="application">Disklabel</span> szerint
	alapértelmezetten kiosztott partíciókat
	láthatjuk:</p><div class="mediaobject"><img src="disklabel1.png" /></div><p>Amennyiben ez körülbelül megfelelõ a
	számunkra, akkor innen már nagyon egyszerû
	elõkészíteni a napló helyét.  A
	nyilak használatával válasszuk ki a
	<code class="filename">/usr</code> partíciót és a
	<span class="keycap"><strong>D</strong></span> billentyû lenyomásával
	töröljük le.</p><p>Ezután válasszuk ki a képernyõ
	felsõ részében a lemez nevét, majd a
	<span class="keycap"><strong>C</strong></span> billentyû lenyomásával
	hozzunk létre egy új partíciót a
	<code class="filename">/usr</code> számára.  Ez viszont
	legyen most 1 GB-tal (ha napló csak a
	<code class="filename">/usr</code> mellé lesz) vagy 2 GB-tal
	(ha egyaránt naplózni akarjuk a
	<code class="filename">/usr</code> és <code class="filename">/var</code>
	partíciókat is) kisebb.  A felbukkanó
	ablakban válasszuk az állományrendszer
	létrehozását és a
	<code class="filename">/usr</code> könyvtárat adjuk meg
	csatlakozási pontként.</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Szükségünk van-e naplóra a
	  <code class="filename">/var</code> partícióhoz?  A
	  naplózásnak alapvetõen csak
	  óriási méretû
	  partíciók esetében van értelme.
	  Ennek megfelelõen nem kell feltétlenül
	  engedélyeznünk a naplózást a
	  <code class="filename">/var</code> partíción is,
	  habár egy asztali gép esetében ez sosem
	  árthat.  Ha ezt az állományrendszert alig
	  használjuk (ami nagyon valószínû egy
	  asztali gépnél), kevesebb területet is
	  rendelhetünk a naplóhoz.</p><p xmlns="http://www.w3.org/1999/xhtml">A példánkban a <code class="filename">/usr</code>
	  és <code class="filename">/var</code> partíciókhoz
	  is kapcsoltunk naplókat.  Természetesen a
	  módszer ezen lépése igény szerint
	  megváltoztatható.</p></div><p>Mivel továbbra sem szeretnénk
	elbonyolítani a lépéseket, ezért a
	naplózás bevezetéséhez
	szükséges partíciók
	létrehozását szintén a
	<span class="application">sysinstall</span>
	segítésével végezzük.  A
	telepítés közben a
	<span class="application">sysinstall</span> feltétlenül
	ragaszkodik ahhoz, hogy minden létrehozott
	partícióhoz csatlakozási pontot is
	megadjunk.  A naplókat tároló
	partíciókhoz viszont ilyen nem tartozik, sõt,
	<span class="emphasis"><em>egyáltalán nem is kell</em></span>.  Ezek
	ugyanis nem olyan hétköznapi
	partíciók, amelyeket bármikor is
	csatlakoztatni fogunk.</p><p>A <span class="application">sysinstall</span> használata
	során ezt a problémát úgy tudjuk
	elkerülni, ha a naplózásnak szánt
	partíciókat lapozóterületként
	adjuk meg.  A lapozóterületet sem kell soha
	csatlakoztatni, és a
	<span class="application">sysinstall</span> ezekbõl
	tetszõleges mennyiségût képes
	készíteni.  A telepítést
	követõ újraindítás után
	természetesen majd át kell szerkesztenünk az
	<code class="filename">/etc/fstab</code> állományban az
	így létrehozott partíciók
	jellemzõit.</p><p>Lapozóterület
	kialakításához ismét a
	nyílbillentyûk használatával
	navigáljunk a <span class="application">Disklabel</span>
	alkalmazáshoz tartozó képernyõ
	felsõ részébe és válasszuk ki a
	lemez nevét.  Ezután nyomjuk le az
	<span class="keycap"><strong>N</strong></span> billentyût, majd adjuk meg a
	kívánt méretet
	(<em class="replaceable"><code>1024M</code></em>) és a
	következõ menübõl válasszuk a
	<span class="quote">"<span class="quote">swap space</span>"</span> (lapozóterület)
	típust.  Ismételjük meg az iménti
	mûveletet az összes napló esetén.  A
	példánkban ezen a módon
	készítettünk egy naplót a
	<code class="filename">/usr</code>, és még egyet a
	<code class="filename">/var</code> állományrendszer
	számára.  A végeredmény a
	következõ képen látható:</p><div class="mediaobject"><img src="disklabel2.png" /></div><p>Javasoljuk, ahogy befejeztük a partíciók
	létrehozását, jegyezzük fel a neveiket
	és a hozzá tartozó csatlakozási
	pontokat, így a soron következõ
	konfigurációs lépésekben
	könnyebben tudunk majd velük dolgozni.  Ez egyben
	segít mérsékelni a telepítést
	károsító hibák
	elkövetésének esélyét.  A
	következõ táblázatban a
	példában említett
	konfigurációhoz vettük fel ezeket az
	adatokat:</p><div class="table"><a id="idp70080848"></a><div class="table-title">1. táblázat - Partíciók és naplók</div><div class="table-contents"><table summary="Partíciók és naplók" width="100%" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Partíció</th><th>Csatlakozási pont</th><th>Napló</th></tr></thead><tbody><tr><td>ad0s1d</td><td>/var</td><td>ad0s1h</td></tr><tr><td>ad0s1f</td><td>/usr</td><td>ad0s1g</td></tr></tbody></table></div></div><br class="table-break" /><p>Ezután a megszokott módon folytassuk a
	telepítést.  Javasoljuk azonban, hogy a
	külsõ alkalmazásokat (csomagokat) addig
	még ne tegyünk fel a rendszerünkre, amíg
	teljesen be nem fejeztük a naplózás
	beállítását.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="first-boot"></a>3.2. A rendszer elsõ indítása</h3></div></div></div><p>A rendszerünk a szokásos módon fog
	indulni, de a naplók számára
	hozzáadott plusz lapozóterületekhez
	tartozó bejegyzéseket el kell
	távolítanunk az <code class="filename">/etc/fstab</code>
	állományból.  A lapozóterületek
	közül ténylegesen lapozásra
	általában a <span class="quote">"<span class="quote">b</span>"</span> (tehát a
	példánkban az <code class="filename">ad0s1b</code>)
	partíciót érdemes meghagyni.  Az
	összes többit egyszerûen töröljük
	ki, indítsuk újra a rendszerünket és a
	FreeBSD már nem fogja tovább használni
	ezeket.</p><p>Ahogy a rendszer újra elindul, készen is
	állunk a naplózás
	beállítására.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="configure-journal"></a>4. A naplózás
      beállítása</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="running-gjournal"></a>4.1. A <code class="command">gjournal</code> futtatása</h3></div></div></div><p>A naplózást nagyon könnyû lesz
	beállítani miután már
	elõkészítettük az ehhez
	szükséges partíciókat.
	Váltsunk át egyfelhasználós
	módba, tehát jelentkezzünk be
	<code class="systemitem">root</code> felhasználóként
	és gépeljük be:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown now</code></strong></pre><p>Ezután az <span class="keycap"><strong>Enter</strong></span> billentyû
	lenyomásával megkapjuk az alapértelmezett
	parancsértelmezõt.  Válasszuk le azokat a
	partíciókat, amelyeken engedélyezni
	kívánjuk a naplózást.  Ezek a
	példánkban a <code class="filename">/usr</code> és
	<code class="filename">/var</code> partíciók voltak:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>umount /usr /var</code></strong></pre><p>Töltsük be a naplózáshoz
	szükséges modult:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal load</code></strong></pre><p>Most pedig a korábbi feljegyzéseink
	alapján állapítsuk meg melyik
	naplóhoz melyik partíciót fogjuk rendelni.
	A példánkban a <code class="filename">/usr</code>
	csatlakozási ponthoz az <code class="filename">ad0s1f</code> eszköz tartozik,
	és ennek a naplója az <code class="filename">ad0s1g</code> eszköz lesz,
	miközben a <code class="filename">/var</code> ponthoz az <code class="filename">ad0s1d</code> eszközt
	rendeltük, és ezt az <code class="filename">ad0s1h</code> eszközön
	naplózzuk.  Ennek megfelelõen a következõ
	parancsokat kell kiadnunk:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal label ad0s1f ad0s1g</code></strong>

GEOM_JOURNAL: Journal 2948326772: ad0s1f contains data.
GEOM_JOURNAL: Journal 2948326772: ad0s1g contains journal.

<code class="prompt">#</code> <strong class="userinput"><code>gjournal label ad0s1d ad0s1h</code></strong>

GEOM_JOURNAL: Journal 3193218002: ad0s1d contains data.
GEOM_JOURNAL: Journal 3193218002: ad0s1h contains journal.</pre><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">A <code class="command">gjournal</code> hibát fog jelezni, ha
	  bármelyik partíció utolsó szektora
	  már használatban van.  Ilyen helyzetekben az
	  <code class="option">-f</code> kapcsoló
	  segítségével
	  felülírásra tudjuk
	  kényszeríteni a parancsot, mint
	  például:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal label -f ad0s1d ad0s1h</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">Mivel most telepítettük a rendszerünket,
	  elég kicsi a valószínûsége,
	  hogy így bármit is ténylegesen
	  felülírnánk.</p></div><p>Létrejött két új eszköz,
	név szerint az <code class="filename">ad0s1d.journal</code> és az
	<code class="filename">ad0s1f.journal</code>.  Ezek
	képviselik azokat a <code class="filename">/var</code> és
	<code class="filename">/usr</code> partíciókat, amelyeket
	valójában csatlakoztatnunk kell.  A
	csatlakoztatásuk elõtt azonban
	állítsuk be hozzájuk a
	naplózást és tiltsuk le a Soft Updates
	használatát:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tunefs -J enable -n disable ad0s1d.journal</code></strong>

tunefs: gjournal set
tunefs: soft updates cleared

<code class="prompt">#</code> <strong class="userinput"><code>tunefs -J enable -n disable ad0s1f.journal</code></strong>

tunefs: gjournal set
tunefs: soft updates cleared</pre><p>Ezt követõen parancssorból csatlakoztassuk
	az új eszközöket a nekik megfelelõ pontokra
	(itt most már használhatjuk az
	<code class="option">async</code> beállítást):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -o async /dev/ad0s1d.journal /var</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -o async /dev/ad0s1f.journal /usr</code></strong></pre><p>Nyissuk meg az <code class="filename">/etc/fstab</code>
	állományt, és az elõbbiek szerint
	javítsuk ki a <code class="filename">/usr</code> és a
	<code class="filename">/var</code> állományrendszerekhez
	tartozó bejegyzéseket:</p><pre class="programlisting">/dev/ad0s1f.journal     /usr            ufs     rw,async      2       2
/dev/ad0s1d.journal     /var            ufs     rw,async      2       2</pre><div xmlns="" class="warning"><h3 class="admontitle">Figyelem: </h3><p xmlns="http://www.w3.org/1999/xhtml">Figyelmesen ellenõrizzük a bejegyzéseket,
	  mert ha hibásan adjuk meg ezeket, akkor az
	  újraindítás után gondok lehetnek a
	  rendszer indításával!</p></div><p>Végezetül gondoskodjunk róla, hogy a
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gjournal&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gjournal</span>(8)</span></a> modul minden egyes indítás
	során betöltõdjön.  Ehhez nyissuk meg a
	<code class="filename">/boot/loader.conf</code> állományt
	és adjuk hozzá a következõ sort:</p><pre class="programlisting">geom_journal_load="YES"</pre><p>Gratulálunk, sikeresen beállítottuk a
	rendszerünkön a naplózást!  Innen vagy az
	<strong class="userinput"><code>exit</code></strong> begépelésével
	lépjünk vissza a többfelhasználós
	módba, vagy egy újraindítással
	próbáljuk ki a konfiguráció
	eredményét (mi ezt javasoljuk).  A
	rendszerindítás során a
	következõhöz hasonló üzeneteket kell
	majd látnunk:</p><pre class="screen">ad0: 76293MB XEC XE800JD-00HBC0 08.02D08 at ata0-master SATA150
GEOM_JOURNAL: Journal 2948326772: ad0s1g contains journal.
GEOM_JOURNAL: Journal 3193218002: ad0s1h contains journal.
GEOM_JOURNAL: Journal 3193218002: ad0s1d contains data.
GEOM_JOURNAL: Journal ad0s1d clean.
GEOM_JOURNAL: Journal 2948326772: ad0s1f contains data.
GEOM_JOURNAL: Journal ad0s1f clean.</pre><p>Szabálytalan leállások esetén az
	iménti üzenetek némileg változhatnak,
	például:</p><pre class="screen">GEOM_JOURNAL: Journal ad0s1d consistent.</pre><p>Ez általában arra utal, hogy a
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gjournal&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gjournal</span>(8)</span></a> a naplóterületen tárolt
	információk segítségével
	helyreállította az
	állományrendszert.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="gjournal-new"></a>4.2. A naplózás engedélyezése
	frissen létrehozott partíciókon</h3></div></div></div><p>Míg az elõbbiekben tárgyalt
	megoldást leginkább olyan partíciók
	esetén alkalmazhatjuk, amelyek már eleve
	tartalmaznak adatokat, addig egy újonnan
	létrehozott partíciót némileg
	könnyebb naplózással ellátni, mivel
	ilyenkor az adat- és a naplóterület egyazon
	partíción is kialakítható.
	Például most tegyük fel, hogy
	hozzáadtunk egy újabb lemezt a
	rendszerünkhöz, amelyen
	készítettünk egy új <code class="filename">/dev/ad1s1d</code> nevû
	partíciót.  A napló
	létrehozása ekkor csupán ennyi:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal label ad1s1d</code></strong></pre><p>A napló mérete alapértelmezés
	szerint 1 GB lesz, amelyet viszont a <code class="option">-s</code>
	opció használatával tetszés szerint
	átállíthatunk.  Az értéket
	megadhatjuk byte-okban, vagy a <code class="literal">K</code>,
	<code class="literal">M</code>, illetve <code class="literal">G</code>
	hozzáfûzésével kilobyte-okban,
	megabyte-okban, illetve gigabyte-okban is.  Arra azonban
	figyeljünk, hogy a <code class="command">gjournal</code> nem enged
	túlságosan kis méretû naplót
	létrehozni.</p><p>Például egy 2 GB méretû
	napló az alábbi paranccsal hozható
	létre:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal label -s 2G ad1s1d</code></strong></pre><p>Mellé hozzunk létre egy
	állományrendszert az új
	partíción, ahol a <code class="option">-J</code>
	kapcsolóval engedélyezzük a
	naplózást:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>newfs -J /dev/ad1s1d.journal</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="configure-kernel"></a>4.3. A naplózás támogatásának
	beépítése a rendszermagba</h3></div></div></div><p>Amennyiben nem kívánjuk betölteni a
	<code class="literal">geom_journal</code> modult,
	lehetõségünk van közvetlenül a
	rendszermagba beépíteni a
	hozzá tartozó funkcionalitást.  Ehhez
	nyissunk meg (vagy hozzunk létre) egy saját
	rendszermag-konfigurációs állományt,
	és vegyük fel benne a következõ két
	sort:</p><pre class="programlisting">options UFS_GJOURNAL # Megjegyzés: Ez része a GENERIC rendszermagnak
options GEOM_JOURNAL # Ezt se felejtsük ki</pre><p>A <a class="link" href="../../../../doc/hu_HU.ISO8859-2/books/handbook/kernelconfig.html" target="_top">FreeBSD
	kézikönyvben</a> szereplõ
	utasítások mentén fordítsuk le
	és telepítsük az új
	rendszermagot.</p><p>Ha korábban használtuk volna a modult, akkor
	ezzel együtt ne felejtsük el kivenni a
	<code class="filename">/boot/loader.conf</code>
	állományból sem a
	hozzá tartozó sort.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="troubleshooting-gjournal"></a>5. A naplózás használata során
      felmerülõ hibák kezelése</h2></div></div></div><p>Ebben a szakaszban a naplózás
      alkalmazásakor jelentkezõ gondokra vonatkozó
      gyakran ismételt kérdéseket foglaljuk
      össze.</p><div class="qandaset"><a id="idp70268240"></a><dl><dt>5.1. <a href="#idp70269136">A rendszer folyamatosan összeomlik komolyabb
	    lemezterhelés mellett.  Van ennek valamilyen köze
	    a naplózáshoz?</a></dt><dt>5.2. <a href="#idp70275280">Valamit nem sikerült rendesen
	    beállítani a konfiguráció
	    során, ezért most nem indul a rendszer.  Meg
	    lehet valahogy javítani?</a></dt><dt>5.3. <a href="#idp70303824">Visszavonható a naplózás, vissza
	    lehet valahogy térni a Soft Updates
	    használatához?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp70269136"></a><a id="kernel-panic"></a><p><strong>5.1.</strong></p></td><td align="left" valign="top"><p>A rendszer folyamatosan összeomlik komolyabb
	    lemezterhelés mellett.  Van ennek valamilyen köze
	    a naplózáshoz?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>A napló ilyenkor valószínûleg
	    gyorsabban betelik, mint ahogy kiíródhatna a
	    lemezre.  Nem szabad elfeledkeznünk róla, hogy
	    a napló méretének sosem az
	    adatterület méretével kell
	    arányosnak lennie, hanem a lemez
	    terheltségével.  Ha tehát a lemezeink
	    nagyobb terhelés alatt vannak, akkor egy nagyobb
	    területet kell hozzárendelnünk a
	    naplóhoz.  Ezzel kapcsolatban lásd a <a class="link" href="#understanding-journaling" title="2. Naplózás FreeBSD alatt">Naplózás
	    FreeBSD alatt</a> címû szakaszt.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp70275280"></a><a id="unable-boot"></a><p><strong>5.2.</strong></p></td><td align="left" valign="top"><p>Valamit nem sikerült rendesen
	    beállítani a konfiguráció
	    során, ezért most nem indul a rendszer.  Meg
	    lehet valahogy javítani?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Ilyenkor vagy elfelejtettük (vagy netalán
	    elírtuk) a <code class="filename">/boot/loader.conf</code>
	    állományban szükséges
	    bejegyzést, vagy az <code class="filename">/etc/fstab</code>
	    állományunk hibákat tartalmaz.  Az
	    ilyen jellegû problémákat viszonylag
	    könnyû helyrehozni.  Az <span class="keycap"><strong>Enter</strong></span>
	    billentyû lenyomásával hozzuk elõ az
	    egyfelhasználós módhoz tartozó
	    parancsértelmezõt.  Ha ez sikerült, akkor
	    kutassuk fel a probléma okát:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cat /boot/loader.conf</code></strong></pre><p>Ha innen hiányzik vagy nem helyesen szerepel a
	    <code class="literal">geom_journal_load</code> bejegyzés, akkor a
	    naplózás használatához
	    szükséges eszközök nem fognak
	    létrejönni.  Töltsük be a modult
	    manuálisan, csatlakoztassuk az összes
	    partíciót és folytassuk a
	    többfelhasználós mód
	    indítását:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal load</code></strong>

GEOM_JOURNAL: Journal 2948326772: ad0s1g contains journal.
GEOM_JOURNAL: Journal 3193218002: ad0s1h contains journal.
GEOM_JOURNAL: Journal 3193218002: ad0s1d contains data.
GEOM_JOURNAL: Journal ad0s1d clean.
GEOM_JOURNAL: Journal 2948326772: ad0s1f contains data.
GEOM_JOURNAL: Journal ad0s1f clean.

<code class="prompt">#</code> <strong class="userinput"><code>mount -a</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong>
<span class="emphasis"><em>(a rendszerindítás folytatódik)</em></span></pre><p>Ha viszont ezzel a bejegyzéssel kapcsolatban
	    semmilyen hibát nem találtunk, akkor
	    nézzük meg az <code class="filename">/etc/fstab</code>
	    állományt.  Akkor
	    valószínûleg itt fogunk találni
	    egy hibásan beírt vagy éppen
	    hiányzó bejegyzést.  Amennyiben
	    errõl lenne szó, csatlakoztassuk kézzel a
	    fennmaradó partíciókat és
	    folytassuk a többfelhasználós mód
	    indítását.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp70303824"></a><a id="remove-journaling"></a><p><strong>5.3.</strong></p></td><td align="left" valign="top"><p>Visszavonható a naplózás, vissza
	    lehet valahogy térni a Soft Updates
	    használatához?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Hogyne.  A most következõ módszer
	    segítségével megfordítható
	    az egész folyamat.  Miután
	    végeztünk, a naplózás
	    részére korábban kialakított
	    partíciók tetszés szerint
	    felhasználhatóak.</p><p>Jelentkezzük be <code class="systemitem">root</code>
	    felhasználóként és
	    váltsunk egyfelhasználós
	    módba:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown now</code></strong></pre><p>Válasszuk le a naplózást
	    alkalmazó partíciókat:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>umount /usr /var</code></strong></pre><p>Írassuk ki lemezre a naplók
	    tartalmát:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal sync</code></strong></pre><p>Állítsuk le a
	    naplózóterületek
	    használatát:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal stop ad0s1d.journal</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gjournal stop ad0s1f.journal</code></strong></pre><p>Töröljük le az eszközökön
	    tárolt összes naplózási
	    metainformációt:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gjournal clear ad0s1d</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gjournal clear ad0s1f</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gjournal clear ad0s1g</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>gjournal clear ad0s1h</code></strong></pre><p>Tiltsuk le az állományrendszer
	    naplózását és
	    állítsuk vissza a Soft Updates
	    használatát:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tunefs -J disable -n enable ad0s1d</code></strong>

tunefs: gjournal cleared
tunefs: soft updates set

<code class="prompt">#</code> <strong class="userinput"><code>tunefs -J disable -n enable ad0s1f</code></strong>

tunefs: gjournal cleared
tunefs: soft updates set</pre><p>Manuálisan csatlakoztassuk újra a
	    régi eszközöket:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -o rw /dev/ad0s1d /var</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -o rw /dev/ad0s1f /usr</code></strong></pre><p>Az <code class="filename">/etc/fstab</code>
	    állományban állítsunk vissza
	    mindent az eredeti állapotába:</p><pre class="programlisting">/dev/ad0s1f     /usr            ufs     rw      2       2
/dev/ad0s1d     /var            ufs     rw      2       2</pre><p>Végül a
	    <code class="filename">/boot/loader.conf</code>
	    állományból távolítsuk el
	    a <code class="literal">geom_journal</code> modul
	    betöltésére vonatkozó
	    bejegyzést és indítsuk újra a
	    rendszert.</p></td></tr></tbody></table></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="further-reading"></a>6. Ajánlott olvasmányok</h2></div></div></div><p>A naplózás még viszonylag
      újdonságnak számít a FreeBSD
      esetében, ezért nem feltétlenül
      találunk róla túlságosan sok
      dokumentációt.  Ettõl függetlenül
      azonban a következõ források elolvasása
      azért hasznosnak bizonyulhat:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A FreeBSD kézikönyv naplózással
	  foglalkozó <a class="link" href="../../../../doc/hu_HU.ISO8859-2/books/handbook/geom-gjournal.html" target="_top">szakasza</a>.</p></li><li class="listitem"><p>Pawel Jakub Dawidek, a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gjournal&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gjournal</span>(8)</span></a> fejlesztõjének a
	  <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">freebsd-current</a> levelezési listára
	  küldött <a class="link" href="http://lists.freebsd.org/pipermail/freebsd-current/2006-June/064043.html" target="_top">levele</a>.</p></li><li class="listitem"><p>Ivan Voras a <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">freebsd-questions</a> levelezési
	  listára küldött <a class="link" href="http://lists.freebsd.org/pipermail/freebsd-questions/2008-April/173501.html" target="_top">levele</a>.</p></li><li class="listitem"><p>A <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gjournal&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gjournal</span>(8)</span></a> és <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=geom&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">geom</span>(8)</span></a> man
	  oldalak.</p></li></ul></div></div></div></body></html>