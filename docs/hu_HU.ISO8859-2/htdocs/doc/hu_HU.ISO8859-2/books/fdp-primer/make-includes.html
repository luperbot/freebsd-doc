<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>7.3. A FreeBSD Dokumentációs Projekt .mk állományai</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="A FreeBSD Dokumentációs Projekt irányelvei kezdõknek" /><link rel="up" href="doc-build.html" title="7. fejezet - A dokumentáció elõállításának folyamata" /><link rel="prev" href="doc-build-makefiles.html" title="7.2. A dokumentációt tároló könyvtárban található Makefile állományok" /><link rel="next" href="the-website.html" title="8. fejezet - A honlap" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">7.3. A FreeBSD Dokumentációs Projekt
      <code class="filename">.mk</code> állományai</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="doc-build-makefiles.html">Vissza</a> </td><th width="60%" align="center">7. fejezet - A dokumentáció
    elõállításának folyamata</th><td width="20%" align="right"> <a accesskey="n" href="the-website.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="make-includes"></a>7.3. A FreeBSD Dokumentációs Projekt
      <code class="filename">.mk</code> állományai</h2></div></div></div><p>Ezek az állományok legjobban talán
      önmagukon keresztül mutathatóak be.  A
      következõ rendszerszintû <code class="filename">.mk</code>
      állományokat használjuk a FreeBSD
      Dokumentációs Projektben:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A <code class="filename">doc.project.mk</code> a központi
	  <code class="filename">.mk</code> állomány, amely
	  szükség szerint hivatkozik az összes
	  többi <code class="filename">.mk</code>
	  állományra.</p></li><li class="listitem"><p>Az elõállítás és a
	  telepítés során a
	  <code class="filename">doc.subdir.mk</code> felelõs a dokumentumokat
	  tároló könyvtárak
	  bejárásért.</p></li><li class="listitem"><p>A <code class="filename">doc.install.mk</code> tartalmazza a
	  karbantartóval és a telepítéssel
	  kapcsolatos változókat.</p></li><li class="listitem"><p>A <code class="filename">doc.docbook.mk</code>
	  állomány csak akkor kerül
	  feldolgozásra, ha a <code class="varname">DOCFORMAT</code>
	  értéke <code class="literal">docbook</code> és a
	  <code class="varname">DOC</code> változónak van
	  értéke.</p></li></ul></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76851152"></a>7.3.1. A <code class="filename">doc.project.mk</code>
	állomány</h3></div></div></div><p>Nézzünk bele:</p><pre class="programlisting">DOCFORMAT?=	docbook
MAINTAINER?=	doc@FreeBSD.org

PREFIX?=	/usr/local
PRI_LANG?=	en_US.ISO8859-1

.if defined(DOC)
.if ${DOCFORMAT} == "docbook"
.include "doc.docbook.mk"
.endif
.endif

.include "doc.subdir.mk"
.include "doc.install.mk"</pre><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76852944"></a>7.3.1.1. Változók</h4></div></div></div><p>Ha nem állítjuk be a dokumentum
	  <code class="filename">Makefile</code>
	  állományában, akkor a
	  <code class="varname">DOCFORMAT</code> és a
	  <code class="varname">MAINTAINER</code> változók ezen a
	  helyen kapnak értéket.</p><p>A <code class="varname">PREFIX</code> adja azt a
	  könyvtárat, amelyen belül
	  elérhetõek <a class="link" href="tools.html" title="2. fejezet - Eszközök">a
	    dokumentáció
	    elõállításához
	    szükséges eszközök</a>.
	  A csomagok és portok átlagos használata
	  esetén ez a <code class="filename">/usr/local</code>.</p><p>A <code class="varname">PRI_LANG</code> adja meg azt a nyelvet
	  és kódolást, amely a
	  dokumentációt olvasó
	  felhasználó számára
	  elsõdlegesként leginkább elfogadott.
	  Alapértelmezés szerint ez az amerikai
	  angol.</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">A <code class="varname">PRI_LANG</code> változó
	    semmilyen hatással nincs a dokumentumok
	    elõállítására.
	    Egyedül a FreeBSD dokumentáció
	    telepítésekor a leggyakrabban hivatkozott
	    dokumentumokhoz létrehozandó szimbolikus
	    linkek készítésénel van
	    szerepe.</p></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76859088"></a>7.3.1.2. Elágazások</h4></div></div></div><p>A <code class="literal">.if defined(DOC)</code> sorban a
	  <code class="filename">Makefile</code> állományokban
	  megadható elágazásokra láthatunk
	  példát.  Hasonlóan más
	  programokhoz, a <code class="filename">Makefile</code>
	  mûködését tudjuk meghatározni
	  egy logikai kifejezés
	  igazságértéktõl függõen.
	  Ebben a kifejezésben a <code class="literal">defined</code>
	  függvény, amely megadja, hogy a
	  paramétereként megadott változó
	  definiált-e.</p><p>A következõ elágazásban, vagyis az
	  <code class="literal">.if ${DOCFORMAT} == "docbook"</code>
	  utasításban azt vizsgáljuk meg, hogy a
	  <code class="varname">DOCFORMAT</code> változó
	  értéke <code class="literal">"docbook"</code> vagy sem.
	  Amennyiben a válasz erre igen (vagyis
	  <span class="quote">"<span class="quote">igaz</span>"</span>), beemeljük a
	  <code class="filename">doc.docbook.mk</code> tartalmát.</p><p>Az elõbb említett két
	  elágazást rendre az <code class="literal">.endif</code>
	  kulcsszóval zárjuk le.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76865232"></a>7.3.2. A <code class="filename">doc.subdir.mk</code>
	állomány</h3></div></div></div><p>Ez az állomány már
	túlságosan nagy ahhoz, hogy a fejezeten belül
	könnyen ki lehessen elemezni.  Ezért az
	elõzõ szakaszok alapján a részleteket a
	kedves Olvasóra bízzuk, ehhez adunk még itt
	némi segítséget.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76866640"></a>7.3.2.1. Változók</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A <code class="varname">SUBDIR</code> tartalmazza azokat az
	      alkönyvtárakat, amelyeket a feldolgozás
	      során be kell járnunk.</p></li><li class="listitem"><p>A <code class="varname">ROOT_SYMLINKS</code> a
	      dokumentáció
	      fõkönyvtárából
	      szimbolikusan linkelendõ könyvtárak
	      neveit adja meg, amennyiben az adott nyelv (a
	      <code class="varname">PRI_LANG</code> változó szerint)
	      az elsõdleges.</p></li><li class="listitem"><p>A <code class="varname">COMPAT_SYMLINK</code>
	      változót már korábban bemutattuk
	      <a class="link" href="doc-build-makefiles.html#sub-make" title="7.2.1. Az alkönyvtári Makefile állományok">az alkönyvtári
	      <code class="filename">Makefile</code>
	      állományok</a> címû
	      szakaszban.</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76876752"></a>7.3.2.2. Célok és makrók</h4></div></div></div><p>A függõségi viszonyokat
	  <code class="literal">cél:
	  függõség1
	  függõség2 ...</code>
	  formában írjuk fel, ahol így megmondjuk,
	  hogy a <code class="literal">cél</code>
	  létrehozásához elõször milyen
	  elemeknek kell létezniük.  Ezeket nevezzük
	  függõségeknek.</p><p>A függõségi viszony megadása alatt
	  lehetõségünk van részletezni a
	  függõségekbõl a cél
	  elõállításához
	  szükséges utasításokat.  Ezt akkor
	  kell megtenni, ha a cél és a
	  függõségek közti
	  átalakítást elõzõleg még
	  nem definiáltuk, vagy ha az adott esetben az
	  átalakítás eltér a
	  korábbiaktól.</p><p>A <code class="literal">.USE</code> nevû speciális
	  függõség egy makróval
	  egyenértékû eszköz
	  használatára ad lehetõséget.</p><pre class="programlisting">_SUBDIRUSE: .USE
.for entry in ${SUBDIR}
	@${ECHO} "===&gt; ${DIRPRFX}${entry}"
	@(cd ${.CURDIR}/${entry} &amp;&amp; \
	${MAKE} ${.TARGET:S/realpackage/package/:S/realinstall/install/} DIRPRFX=${DIRPRFX}${entry}/ )
.endfor</pre><p>A fenti kódrészletben tehát a
	  <code class="buildtarget">_SUBDIRUSE</code> most már egy
	  <span class="quote">"<span class="quote">makró</span>"</span> lesz, amely ha megjelenik a
	  függõségek között, akkor a
	  törzsében megadott parancsokat hajtja
	  végre.</p><p>Mi különbözteti meg ezt a makrót a
	  többi céltól?  Két lényeges
	  eltérés: elõször is, a benne megadott
	  utasítások a rá
	  függõségként hivatkozó
	  célhoz társított
	  átalakítást végzõ
	  utasítások <span class="emphasis"><em>után</em></span>
	  fognak lefutni, másrészt nem befolyásolja
	  a jelenleg feldolgozás alatt álló
	  cél nevét tároló
	  <code class="varname">.TARGET</code> változó
	  értékét.</p><pre class="programlisting">clean: _SUBDIRUSE
	rm -f ${CLEANFILES}</pre><p>Ebben a kódrészletben a tehát
	  <code class="buildtarget">clean</code> esetében csak az
	  <code class="command">rm -r ${CLEANFILES}</code> parancs lefutása
	  után fog végrehajtódni a
	  <code class="buildtarget">_SUBDIRUSE</code> makró tartalma.
	  Ennek hatására a <code class="buildtarget">clean</code>
	  megy egyre lentebb és lentebb a
	  könyvtárszerkezetben,
	  <span class="emphasis"><em>miközben</em></span> törli a
	  elõzõleg elõállított
	  állományokat.</p><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76889552"></a>7.3.2.2.1. Definiált célok</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Az <code class="buildtarget">install</code> és a
		<code class="buildtarget">package</code> célok
		egyaránt folyamatosan haladnak lefelé a
		könyvtárszerkezetben és az
		alkönyvtárakban hívják
		saját maguk tényleges
		változatát (ezek a
		<code class="buildtarget">realinstall</code> és
		<code class="buildtarget">realpackage</code>).</p></li><li class="listitem"><p>A <code class="buildtarget">clean</code>
		eltávolítja a folyamat során
		keletkezett állományokat (és az
		elõbbiekhez hasonlóan lefele halad a
		könyvtárszerkezetben).  A
		<code class="buildtarget">cleandir</code> ugyanezt
		csinálja, de ha talál a
		tárgykódokhoz tartozó
		könyvtárat, akkor azt is törli.</p></li></ul></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76894800"></a>7.3.2.3. Bõvebben a feltételes
	  kifejezésekrõl</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Az <code class="literal">exists</code> egy másik logikai
	      függvény, amellyel lekérdezhetjük,
	      hogy a paramétereként megadott
	      állomány létezik-e.</p></li><li class="listitem"><p>Az <code class="literal">empty</code> logikai
	      függvény igaz értékû, ha a
	      paramétereként megadott
	      változó értéke
	      üres.</p></li><li class="listitem"><p>A <code class="literal">target</code> logikai
	      függvény igaz értékû, ha a
	      paraméterként megadott cél még
	      nem létezik.</p></li></ul></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76899408"></a>7.3.2.4. Ciklusszerverzési lehetõségek
	  (<code class="literal">.for</code>)</h4></div></div></div><p>A <code class="literal">.for</code> utasítás
	  segítségével adott
	  utasításokat tudunk elvégezni egy
	  változó tartalmaként megadott,
	  szóközökkel határolt elemekre.  A
	  ciklus belsejében egy változóból
	  érhetjük el az aktuálisan feldolgozott
	  elemet.</p><pre class="programlisting">_SUBDIRUSE: .USE
.for entry in ${SUBDIR}
	@${ECHO} "===&gt; ${DIRPRFX}${entry}"
	@(cd ${.CURDIR}/${entry} &amp;&amp; \
	${MAKE} ${.TARGET:S/realpackage/package/:S/realinstall/install/} DIRPRFX=${DIRPRFX}${entry}/ )
.endfor</pre><p>A fenti kódrészletben ha a
	  <code class="varname">SUBDIR</code> üres, akkor nem
	  történik semmi.  Ha viszont egy vagy több
	  elemet is tartalmaz, akkor a <code class="literal">.for</code> és
	  az <code class="literal">.endfor</code> között megadott
	  utasítások megismétlõdnek minden
	  egyes elem esetén.  Ezek értékét a
	  ciklus belsejében rendre a <code class="varname">entry</code>
	  változóban veszi fel.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="doc-build-makefiles.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="doc-build.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="the-website.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">7.2. A dokumentációt tároló
      könyvtárban található
      <code class="filename">Makefile</code> állományok </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 8. fejezet - A honlap</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>