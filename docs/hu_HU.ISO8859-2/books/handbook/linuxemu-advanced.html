<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>10.8. Témák haladóknak</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="linuxemu.html" title="10. fejezet - Bináris Linux kompatibilitás" /><link rel="prev" href="sapr3.html" title="10.7. Az SAP(R) R/3(R) telepítése" /><link rel="next" href="system-administration.html" title="III. rész - Rendszeradminisztráció" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">10.8. Témák haladóknak</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="sapr3.html">Vissza</a> </td><th width="60%" align="center">10. fejezet - Bináris Linux kompatibilitás</th><td width="20%" align="right"> <a accesskey="n" href="system-administration.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="linuxemu-advanced"></a>10.8. Témák haladóknak</h2></div></div></div><p>Ha kíváncsiak vagyunk a Linux
      emuláció mûködésére,
      olvassuk el ezt a szakaszt.  Az itt leírtak
      leginkább Terry Lambert
      (<code class="email">&lt;<a xmlns="" class="email" href="mailto:tlambert@primenet.com">tlambert@primenet.com</a>&gt;</code>) <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-chat" target="_top">FreeBSD chat levelezési lista</a>
      címére írt levele nyomán kerülnek
      bemutatásra (Az üzenet azonosítója:
      <code class="literal">&lt;199906020108.SAA07001@usr09.primenet.com&gt;</code>).</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp84520784"></a>10.8.1. Hogyan mûködik?</h3></div></div></div><a id="idp84521552" class="indexterm"></a><p>A FreeBSD rendelkezik egy ún.
	<span class="quote">"<span class="quote">végrehajtási osztály
	betöltõvel</span>"</span> (execution class loader).  Ez
	lényegében a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a>
	rendszerhívás alatt meghúzódó
	absztrakciós réteg.</p><p>A FreeBSD-nek a <code class="literal">#!</code> karaktersorozat
	hatására parancsértelmezõk vagy a
	hozzájuk tartozó szkriptek
	betöltésére utasító
	biztonsági betöltõ helyett van egy
	listája az alkalmas betöltõkrõl.</p><p>A <span class="trademark">UNIX</span>(R) rendszerek a hagyományok szerint egyetlen
	betöltõvel rendelkeznek, ami elõször
	megvizsgálja a betölteni kívánt
	állomány bûvös számát (ami
	általában az elsõ 4 vagy 8 byte) és ez
	alapján eldönti, hogy az adott formátum
	támogatott-e.  Amennyiben ez így van,
	meghívja a betöltõt.</p><p>Ha a bináris típusa nem ismert a rendszer
	számára, akkor az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=execve&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a>
	hívás hibával tér vissza, és
	a parancsértelmezõ próbálja meg a
	saját parancsaiként értelmezni.</p><p>Eddig ez volt az alapértelmezés,
	<span class="quote">"<span class="quote">akármilyen parancsértelmezõnk is
	volt</span>"</span>.</p><p>Késõbb az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> kódjába
	bekerült egy aprócska okosítás, amivel
	megnézte az állomány elsõ két
	karakterét, és ha az <code class="literal">:\n</code> volt,
	akkor a futtatáshoz maga helyett a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=csh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">csh</span>(1)</span></a>
	parancsértelmezõt hívta meg (ezt
	állítólag elõször a SCO
	csinálta).</p><p>A FreeBSD viszont végignézi a betöltõk
	teljes listáját, amiben a sor végén
	szerepel egy általános <code class="literal">#!</code>
	formátumú betöltõ.  Ez az
	állomány futtatásához
	használatos értelmezõk kódját
	keresi, és ha egyet sem sikerül azonosítania,
	akkor a <code class="filename">/bin/sh</code> programot indítja
	el.</p><a id="idp84539088" class="indexterm"></a><p>A Linux ABI támogatását a FreeBSD
	úgy oldja meg, hogy elõször észleli az
	ELF bináris bûvös számát (ekkor
	még nem tesz különbséget a FreeBSD,
	<span class="trademark">Solaris</span>TM, Linux vagy más ELF típusú
	binárisokat használó
	operációs rendszerek közt).</p><a id="idp84540368" class="indexterm"></a><p>Ezután az ELF formátum betöltõje az
	ELF állomány megjegyzéseket
	tároló szakaszában
	<span class="emphasis"><em>bélyegek</em></span> (brand) után kutat,
	ami SVR4 és <span class="trademark">Solaris</span>TM ELF binárisok esetén
	nem létezik.</p><p>A Linux binárisokat
	mûködésükhöz a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a>
	segítségével <code class="literal">Linux</code>
	típusúnak kell
	<span class="emphasis"><em>megbélyegezni</em></span>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>brandelf -t Linux állomány</code></strong></pre><p>Miután ezt megcsináltuk, az ELF
	betöltõ észre fogja venni az
	állomány <code class="literal">Linux</code>
	típusát.</p><a id="idp84545616" class="indexterm"></a><p>Mikor az ELF betöltõ észleli, hogy az
	állomány <code class="literal">Linux</code>
	típusú, kicseréli egy mutató
	értékét a <code class="literal">proc</code>
	struktúrában.  Minden rendszerhívás
	ezen a mutatón keresztül érhetõ el (a
	hagyományos <span class="trademark">UNIX</span>(R) rendszerekben ez a
	rendszerhívásokat tartalmazó
	<code class="literal">sysent[]</code> struktúratömb).
	Emellett a frissen elindított program szoftveres
	megszakításait tartalmazó
	tömbjéhez beállítja a speciális
	jelzések kezelését, valamint a Linux modul
	által végzett néhány további
	(kisebb) javítást.</p><p>A Linux rendszerhívásokat tartalmazó
	tömb többek közt tartalmazza a
	<code class="literal">sysent[]</code> bejegyzések egy
	listáját, amelyek címei a rendszermag Linux
	moduljára mutatnak.</p><p>Amikor a Linux bináris hív egy
	rendszerhívást, a hozzá tartozó
	szoftveres megszakítás kódja a
	<code class="literal">proc</code> struktúrából a neki
	megfelelõ rendszerhívás kódját
	hivatkozza, így FreeBSD rendszerhívás
	belépési pontja helyett a Linuxét kapja
	meg.</p><p>Ráadásul Linux módban a
	különbözõ állományok
	hivatkozásai is
	<span class="emphasis"><em>átirányítódnak</em></span>.
	Ez lényegében olyan, mint amit az
	állományrendszerek
	csatlakoztatásánál a <code class="option">union</code>
	beállítás csinál (ami
	<span class="emphasis"><em>nem</em></span> egyezik meg az
	<code class="literal">unionfs</code> állományrendszerrel!).
	Ilyenkor az állományokat elõször a
	<code class="filename">/compat/linux/eredeti-hely</code>
	könyvtárában keresi, és
	<span class="emphasis"><em>majd</em></span> ha ott nem találja, csak akkor
	kezdi el keresni az
	<code class="filename">/eredeti-hely</code>
	ponton.  Ezzel oldhatjuk meg, hogy más binárisok
	futtatását igénylõ binárisok is
	képesek legyenek rendesen mûködni
	(például így az egész linuxos
	eszköztár tud futni a Linux ABI-n keresztül).
	Egyúttal arra is utal, hogy ha a Linux binárisok
	számára nem áll rendelkezésre a
	megfelelõ bináris, akkor FreeBSD binárisokat is
	el tudnak indítani.  Ha a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=uname&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">uname</span>(1)</span></a> programot pedig
	bemásoljuk a <code class="filename">/compat/linux</code>
	könyvtáron belülre, akkor a Linux
	binárisok képtelenek lesznek megmondani, hogy nem
	Linux alatt futnak.</p><p>Így lényegében egy Linux magot
	találunk a FreeBSD rendszermagjában.  A benne
	megtalálható különbözõ
	szolgáltatásokat megvalósító
	függvények: az állománymûveletek,
	a virtuális memória kezelése, a
	jelzések küldése és System V
	típusú folyamatok közti
	kommunikáció stb.  megegyeznek a FreeBSD és a
	Linux hívásai esetén egyaránt.
	Egyetlen eltérés, hogy a FreeBSD binárisok a
	FreeBSD <span class="emphasis"><em>segédfüggvényein</em></span>
	(glue function), a Linux binárisok pedig a Linux
	segédfüggvényein keresztül férnek
	hozzájuk (a legelsõ operációs
	rendszerek tulajdonképpen csak a saját
	segédfüggvényeiket tartalmazták: a
	hívást kezdeményezõ program
	<code class="literal">proc</code> struktúrájában a
	függvények dinamikusan beállított
	címe helyett egy globális
	<code class="literal">sysent[]</code> struktúratömbben
	tárolták a meghívható
	függvényeket).</p><p>Melyik közülük a FreeBSD natív ABI-ja?
	Ez teljesen lényegtelen.  Alapvetõen az egyetlen
	különbség csupán annyi (pillanatnyilag,
	de ez a jövõben még változhat,
	valószínûleg hamarosan), hogy a FreeBSD
	<span class="emphasis"><em>segédfüggvényei</em></span>
	statikusan megtalálhatóak a rendszermagban,
	míg a Linux
	<span class="emphasis"><em>segédfüggvényei</em></span>
	egyaránt elérhetõek modulból vagy
	statikus linkeléssel.</p><p>Na igen, de akkor ez most emuláció?  Nem.  Ez
	egy ABI, nem emuláció.  Itt szó sincs
	emulátorról (ahogy szimulátorról
	sincs).</p><p>De akkor mégis miért hívják ezt
	sokszor <span class="quote">"<span class="quote">Linux emulációnak</span>"</span>?
	Hát hogy nehezebb legyen eladni a FreeBSD-t!  Komolyra
	fordítva a szót: ennek a kezdeti változata
	akkoriban született meg, amikor erre még nem volt
	rendes szó.  Nem mondhattuk, hogy a FreeBSD
	befordítás vagy egy modul betöltése
	nélkül képes lett volna Linux
	binárisokat futtatni, ezért valamilyen
	módon meg kellett neveznünk az ilyenkor
	betöltött kódot - ebbõl lett
	<span class="quote">"<span class="quote">a Linux emulátor</span>"</span>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sapr3.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="linuxemu.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="system-administration.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">10.7. Az <span class="trademark">SAP</span>(R) <span class="trademark">R/3</span>(R) telepítése </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> III. rész - Rendszeradminisztráció</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>