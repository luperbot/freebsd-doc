<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>14.6. A TCP kapcsolatok burkolása</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="security.html" title="14. fejezet - Biztonság" /><link rel="prev" href="one-time-passwords.html" title="14.5. Egyszeri jelszavak" /><link rel="next" href="kerberosIV.html" title="14.7. KerberosIV" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.6. A TCP kapcsolatok burkolása</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="one-time-passwords.html">Vissza</a> </td><th width="60%" align="center">14. fejezet - Biztonság</th><td width="20%" align="right"> <a accesskey="n" href="kerberosIV.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="tcpwrappers"></a>14.6. A TCP kapcsolatok burkolása</h2></div><div><span class="authorgroup">Írta: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Rhodes</span>, <span class="firstname">Tom</span></span>. </span></div></div></div><a id="idp86970448" class="indexterm"></a><p>Aki ismeri az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> programot, az már biztosan
      hallott a <acronym class="acronym">TCP</acronym> kapcsolatok
      burkolásáról, eredeti nevén a a
      <acronym class="acronym">TCP</acronym> wrapperekrõl.  Azonban csak kevesek
      képesek felfogni ezek valódi hasznát.
      Úgy néz ki, mindenki csak tûzfalakon
      keresztül akarja megoldani a hálózati
      kapcsolatot kezelését.  Habár a
      tûzfalakat sok mindenre fel lehet ugyan használni,
      egyetlen tûzfal nem képes például
      szövegesen válaszolni a kapcsolatok
      kezdeményezõinek.  Ellenben bármelyik
      <acronym class="acronym">TCP</acronym>-wrapper szoftver képes erre,
      sõt még többre is.  A következõ
      néhány szakaszban szemügyre vesszük a
      <acronym class="acronym">TCP</acronym> wrapperek számos
      lehetõségét, és ahol lehetséges,
      ott konfigurációs állományokkal is
      illusztráljuk ezek használatát.</p><p>A <acronym class="acronym">TCP</acronym> burkoló szoftverek
      kiterjesztik az <span class="application">inetd</span>
      képességeit minden alatta dolgozó
      szerverdémon támogatására.  Ezzel a
      módszerrel meg lehet oldani a naplózást,
      üzenetek küldését a kapcsolatokhoz, a
      démonok elérhetõségének
      korlátozását stb.  Noha ezen
      lehetõségek közül néhány
      tûzfallal is megvalósítható, ezzel nem
      csupán egy további védelmi réteget
      húzunk fel a rendszerünk köré, hanem
      túllépjük mindazt, amit egy tûzfallal
      irányítani lehet.</p><p>A <acronym class="acronym">TCP</acronym> burkolók
      használatával hozzáadott
      funkcionalitás azonban nem helyettesít egy jó
      tûzfalat.  A <acronym class="acronym">TCP</acronym> kapcsolatok
      burkolását tûzfallal vagy más
      egyéb biztonsági megoldással együtt
      tudjuk csak eredményesen használni, viszont a
      rendszerünk biztonságában egy újabb
      remek védelmi vonalat képvisel.</p><p>Mivel lényegében ez az
      <span class="application">inetd</span>
      beállításának
      kibõvítése, ezért a szakasz
      elolvasásához feltételezzük az <a class="link" href="network-inetd.html" title="29.2. Az inetd "szuperszerver"">inetd beállításával</a>
      kapcsolatos tudnivalók ismeretét.</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Bár az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> által indított
	programok nem egészen tekinthetõen
	<span class="quote">"<span class="quote">démonoknak</span>"</span>, hagyományosan
	démonnak hívják ezeket.  Ezért
	rájuk ebben a szakaszban is ezt a kifejezést
	használjuk.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp86983760"></a>14.6.1. Kezdeti beállítások</h3></div></div></div><p>FreeBSD alatt a <acronym class="acronym">TCP</acronym> burkolók
	használatának egyetlen feltétele
	csupán annyi, hogy az <span class="application">inetd</span>
	parancsot a <code class="option">-Ww</code> paraméterrel
	indítsuk az <code class="filename">rc.conf</code>
	állományból.  Az egyébként az
	alapbeállítás.  Természetesen nem
	árt, ha helyesen állítjuk be az
	<code class="filename">/etc/hosts.allow</code> állományt
	is, ellenkezõ esetben a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a>
	egyébként dobálni fogja errõl az
	üzeneteket.</p><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Eltérõen a <acronym class="acronym">TCP</acronym>
	  burkolók egyéb
	  implementációitól, a
	  <code class="filename">hosts.deny</code> állományt itt
	  már nem használjuk.  Minden
	  beállítást az
	  <code class="filename">/etc/host.allow</code> állományba
	  kell raknunk.</p></div><p>A legegyszerûbb konfiguráció
	esetén a démonok
	kapcsolódását egyszerûen
	engedélyezhetjük vagy letilthatjuk az
	<code class="filename">/etc/hosts.allow</code> állományban
	szereplõ beállításokkal.  A FreeBSD
	alapértelmezett beállításai szerint
	minden <span class="application">inetd</span> által
	indított démonhoz lehet kapcsolódni.  Ennek
	megváltoztatásával az
	alapkonfiguráció áttekintése
	után foglalkozunk.</p><p>Az alapkonfiguráció általában
	<code class="literal">démon : cím : cselekvés</code>
	alakú.  Itt a <code class="literal">démon</code> egy olyan
	démonra utal, amelyet az <code class="command">inetd</code>
	indított el.  A <code class="literal">cím</code> egy
	érvényes hálózati név,
	IP-cím vagy szögletes zárójelek
	([ ]) között megadott IPv6
	formátumú cím.  A cselekvést
	tartalmazó mezõ (<code class="literal">action</code>) lehet
	<code class="literal">allow</code> vagy <code class="literal">deny</code> annak
	megfelelõen, hogy engedélyezzük vagy tiltjuk a
	megadott címrõl a csatlakozást.  Nem szabad
	elfelejtenünk, hogy az így megadott
	beállítások közül mindig az
	elsõként illeszkedõ
	érvényesül, ami arra utal, hogy a
	konfigurációs állományban
	szereplõ szabályok egymás után
	növekvõ sorrendben értékelõdnek ki.
	Ha valamelyikük illeszkedik, akkor a keresés
	megáll.</p><p>Rengeteg egyéb opció is megadható
	még, de ezekrõl csak a késõbbi
	szakaszokban fogunk szólni.  Egy egyszerû
	konfigurációs állomány már
	ennyi információból is
	könnyedén összeállítható.
	Például, ha engedélyezni szeretnénk
	a <acronym class="acronym">POP</acronym>3 kapcsolatokat a <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/mail/qpopper/pkg-descr">mail/qpopper</a> démonon
	keresztül, akkor a következõ sorral kell
	kiegészítenünk a
	<code class="filename">hosts.allow</code> állományt:</p><pre class="programlisting"># Ez a sor kell a POP3 kapcsolatokhoz:
qpopper : ALL : allow</pre><p>Miután hozzáadtuk ezt a sort, az
	<span class="application">inetd</span> szervert újra kell
	indítanunk.  Ezt vagy a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=kill&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">kill</span>(1)</span></a> paranccsal, vagy
	pedig az <code class="filename">/etc/rc.d/inetd</code> szkript
	<em class="parameter"><code>restart</code></em> paraméterével
	tehetjük meg.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87006288"></a>14.6.2. Komolyabb beállítások</h3></div></div></div><p>A <acronym class="acronym">TCP</acronym> kapcsolatok
	burkolásánál is meg lehet adni
	további opciókat.
	Segítségükkel még jobban
	irányítani tudjuk a kapcsolatok
	kezelésének módját.
	Néhány esetben az is hasznos lehet, ha
	küldünk valamilyen választ az egyes
	gépeknek vagy démonoknak.  Máskor
	szükségünk lehet a csatlakozások
	naplózására vagy e-mailen keresztüli
	jelzésére a rendszergazda felé.  Teljesen
	más helyezetekben csak a helyi
	hálózatunkról engedjük meg a
	csatlakozást.  Ez mind lehetséges a
	<code class="literal">helyettesítõ jelekként</code>
	ismert beállítási opciók,
	kiterjesztõ karakterek és külsõ parancsok
	végrehajtásának
	használatával.  A következõ két
	szakasz az ilyen és ehhez hasonló
	szituációk megoldására
	íródott.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87008208"></a>14.6.2.1. Külsõ parancsok</h4></div></div></div><p>Tegyük fel, hogy olyan helyezetben vagyunk, amikor a
	  kapcsolatot tiltani akarjuk, de közben azért
	  szeretnénk errõl értesíteni a
	  kapcsolatot kezdeményezõ felet is.  Hogyan tudjuk
	  ezt megcsinálni?  Ezt a <code class="option">twist</code>
	  nevû opcióval tehetjük meg.  Amikor
	  megpróbál valaki csatlakozni, akkor a
	  <code class="option">twist</code> hívódik meg és
	  végrehajt egy megadott parancsot vagy szkriptet.  Erre
	  találunk is egy példát a
	  <code class="filename">hosts.allow</code>
	  állományban:</p><pre class="programlisting"># The rest of the daemons are protected.
ALL : ALL \
        : severity auth.info \
        : twist /bin/echo "You are not welcome to use %d from %h."</pre><p>Ez a példa a következõ üzenetet
	  jeleníti meg: <span class="quote">"<span class="quote">You are not allowd to use
	  <code class="literal">a démon neve</code> from
	  <code class="literal">hálózati név</code>.</span>"</span>
	  (Jelentése: <span class="quote">"<span class="quote">A <code class="literal">démon
	  neve</code> démont nem érheti el a
	  <code class="literal">hálózati név</code>
	  helyrõl!</span>"</span>) Ez minden olyan démon
	  esetén megjelenik, amirõl nem nyilatkoztunk
	  korábban az állományban.  Ezzel nagyon
	  könnyen vissza tudunk küldeni egy választ a
	  kapcsolat kezdményezõje felé, miután
	  a kapcsolatot eldobtuk.  Vegyük észre, hogy a
	  visszaküldendõ üzenetet <code class="literal">"</code>
	  karakterek közé <span class="emphasis"><em>kell</em></span>
	  tennünk, ez alól semmi sem kivétel.</p><div xmlns="" class="warning"><h3 class="admontitle">Figyelem: </h3><p xmlns="http://www.w3.org/1999/xhtml">DoS támadást lehet elõidézni
	    azzal, ha egy támadó vagy
	    támadók egy csoportja csatlakozási
	    kérelmekkel kezdi el bombázni a
	    démonainkat.</p></div><p>Ilyen esetekben használhatjuk a
	  <code class="option">spawn</code> opciót is.  A
	  <code class="option">spawn</code> a <code class="option">twist</code>
	  opcióhoz hasonlóan implicit módon tiltja
	  a kapcsolódást és arra
	  használható, hogy lefuttassunk vele egy
	  parancsot vagy szkriptet.  A <code class="option">spawn</code> azonban a
	  <code class="option">twist</code> opciótól
	  eltérõen nem küld vissza semmilyen
	  választ a kapcsolatot létrehozni
	  kívánó egyénnek.  Ehhez
	  példaként vegyük a következõ sort
	  a konfigurációs
	  állományban:</p><pre class="programlisting"># We do not allow connections from example.com:
ALL : .example.com \
	: spawn (/bin/echo %a from %h attempted to access %d &gt;&gt; \
	  /var/log/connections.log) \
	: deny</pre><p>Ezzel a <code class="systemitem">*.example.com</code>
	  címtartományból érkezõ
	  összes kapcsolódási kísérlet
	  sikertelen lesz, miközben ezzel egyidõben a
	  <code class="filename">/var/log/connections.log</code>
	  állományba rögzítjük a
	  csatlakozni akaró egyén hálózati
	  nevét, <acronym class="acronym">IP</acronym>-címét
	  és a démont.</p><p>A korábban már kifejtett
	  helyettesítõ karakterek túl, mint
	  például az <code class="literal">%a</code>, még
	  léteznek továbbiak is.  Róluk a
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a> man oldalon találhatjuk meg a
	  teljes listát.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp87037520"></a>14.6.2.2. Helyettesítõ jelek</h4></div></div></div><p>Az eddigi példákban folyamatosan csak az
	  <code class="literal">ALL</code> opciót adtuk meg.  Azonban rajta
	  kívûl léteznek mások is, amivel a
	  megoldás funkcionalitását még egy
	  kicsivel tovább növelhetjük.
	  Például az <code class="literal">ALL</code>
	  használható egy démon, egy
	  tartomány vagy egy <acronym class="acronym">IP</acronym>-cím
	  illesztésére.  A másik ilyen
	  helyettesítõ jel a <code class="literal">PARANOID</code>,
	  amelyet olyan gépek
	  <acronym class="acronym">IP</acronym>-címének
	  illesztésekor alkalmazhatunk, ami
	  feltételezhetõen hamis.  Más szóval
	  a <code class="literal">PARANOID</code> olyan cselekvések
	  megadását teszi lehetõvé, amelyek
	  akkor hajtódnak végre, amikor a kapcsolatot
	  létrehozó gép
	  <acronym class="acronym">IP</acronym>-címe eltér a
	  hálózati nevétõl.  A most
	  következõ példa
	  valószínûleg segít fényt
	  deríteni ennek lényegére:</p><pre class="programlisting"># Block possibly spoofed requests to sendmail:
sendmail : PARANOID : deny</pre><p>A példában minden olyan
	  kapcsolatkérést elutasítunk, ami a
	  <code class="command">sendmail</code> felé a
	  hálózati névtõl eltérõ
	  <acronym class="acronym">IP</acronym>-címrõl
	  irányul.</p><div xmlns="" class="caution"><h3 class="admontitle">Figyelem: </h3><p xmlns="http://www.w3.org/1999/xhtml">Ha rossz <acronym class="acronym">DNS</acronym>
	    beállításokat használunk, a
	    <code class="literal">PARANOID</code> megadásával
	    súlyosan mozgásképtelenné
	    tehetjük a kliensünket vagy szerverünket.
	    Ezért legyünk óvatosak vele!</p></div><p>A helyettesítõ jelekrõl és
	  hozzájuk tartozó további
	  lehetõségekrõl a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a> man
	  oldalon tájékozódhatunk.</p><p>A <code class="filename">hosts.allow</code>
	  állományból ki kell venni az elsõ
	  sort ahhoz, hogy bármilyen egyéb
	  konfigurációs beállítás
	  mûködõképes legyen.  Ezt
	  említettük a szakasz elején is.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="one-time-passwords.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="kerberosIV.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">14.5. Egyszeri jelszavak </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 14.7. <span class="application">KerberosIV</span></td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>