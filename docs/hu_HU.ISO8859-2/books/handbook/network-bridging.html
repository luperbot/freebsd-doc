<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>31.5. Hálózati hidak</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="advanced-networking.html" title="31. fejezet - Egyéb haladó hálózati témák" /><link rel="prev" href="network-bluetooth.html" title="31.4. Bluetooth" /><link rel="next" href="network-aggregation.html" title="31.6. Linkek összefûzése és hibatûrése" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">31.5. Hálózati hidak</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-bluetooth.html">Vissza</a> </td><th width="60%" align="center">31. fejezet - Egyéb haladó hálózati
    témák</th><td width="20%" align="right"> <a accesskey="n" href="network-aggregation.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-bridging"></a>31.5. Hálózati hidak</h2></div><div><span class="authorgroup">Írta: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Thompson</span>, <span class="firstname">Andrew</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100275536"></a>31.5.1. Bevezetés</h3></div></div></div><a id="idp100276176" class="indexterm"></a><a id="idp100276688" class="indexterm"></a><p>Gyakran hasznos lehet anélkül felosztani egy
	fizikai hálózatot (például egy
	Ethernet szegmenst) két külön
	hálózati szegmensre, hogy külön
	IP-alhálózatot kellene létrehozunk
	és összekötnünk ezeket egy
	útválasztóval.  A két ilyen
	módon kialakított hálózatot
	összekötõ eszközt nevezzük
	<span class="quote">"<span class="quote">hálózati hídnak</span>"</span> (bridge).  A
	legalább két hálózati
	felülettel rendelkezõ FreeBSD rendszerek képesek
	hálózati híd szerepét
	betölteni.</p><p>A hálózati híd az eszközök
	adatkapcsolati rétegben a hozzá tartozó
	felületein megjelenõ (vagyis Ethernet)
	címének megtanulásával
	mûködik.  A két hálózat
	között csak akkor közvetít forgalmat,
	amikor a forrás és cél nem ugyanabban a
	hálózatban található.</p><p>A hálózati hidak bizonyos szempontból
	lényegében nagyon kevés porttal
	rendelkezõ Ethernet switch-ek.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100278992"></a>31.5.2. A hálózati hidak tipikus
	alkalmazásai</h3></div></div></div><p>Napjainkban akad néhány igen jellemzõ
	szituáció, ahol szükség van a
	hálózati hidak alkalmazására.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100280016"></a>31.5.2.1. Hálózatok
	  összekötése</h4></div></div></div><p>A hálózati hidak alapvetõ feladata
	  két vagy több hálózati szegmens
	  összekötése.  Az egyszerû
	  hálózati környezet
	  felállítása helyett több
	  okból is felmerülhet a hidak
	  létrehozása: kábelezési
	  megszorítások, tûzfalazás vagy
	  pszeudo hálózatok, például
	  virtuális gépek felületének
	  csatlakoztatása miatt.  Egy híd
	  használatával ráadásul össze
	  tudunk kötni egy vezeték nélküli
	  hozzáférési pontként
	  üzemelõ felületet egy vezetékes
	  hálózattal.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100281168"></a>31.5.2.2. Szûrés vagy forgalomkorlátozás
	  tûzfallal</h4></div></div></div><a id="idp100281808" class="indexterm"></a><a id="idp100282320" class="indexterm"></a><p>Sokszor elõfordulhat, hogy
	  útválasztás vagy hálózati
	  címfordítás (NAT) nélkül
	  szeretnénk tûzfalat használni.</p><p>Példaként képzeljünk el egy
	  olyan kis méretû céget, amely egy DSL vagy
	  ISDN vonalon kapcsolódik az
	  internet-szolgáltatójához.  A
	  szolgáltatótól 13, mindenki által
	  használható IP-címet kaptak és a
	  hálózatukban 10 gép van.  Ebben a
	  helyzetben egy útválasztást
	  végzõ tûzfal mûködtetése
	  nehézkessé válna az
	  alhálózatok problémái
	  miatt.</p><a id="idp100283600" class="indexterm"></a><a id="idp100284112" class="indexterm"></a><a id="idp100284624" class="indexterm"></a><p>Egy hídként viselkedõ tûzfallal
	  azonban minden IP számozási probléma
	  nélkül egyszerûen be tudjuk dobni a
	  gépeket a DSL/ISDN útválasztó
	  mögé.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100285648"></a>31.5.2.3. A hálózat megcsapolása</h4></div></div></div><p>Egy hálózati híddal úgy
	  kapcsolunk össze két hálózati
	  szegmenst, hogy közben meg tudjuk vizsgálni a
	  kettejük között mozgó Ethernet
	  kereteket.  Ezt a híd felületen a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a>
	  valamint a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a> segítségével
	  tudjuk megoldani, vagy úgy, ha egy másik
	  felületen elküldjük az összes keret
	  másolatát (span, vagyis feszítõ
	  port).</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100288464"></a>31.5.2.4. VPN az adatkapcsolati rétegben</h4></div></div></div><p>A két Ethernet hálózatot egy IP
	  alapú összeköttetésen keresztül
	  is össze tudunk kötni, ha a
	  hálózatokat egy EtherIP járaton
	  keresztül kötjük össze híddal, vagy
	  egy OpenVPN-hez hasonló <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tap&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">tap</span>(4)</span></a> alapú
	  megoldással.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100290384"></a>31.5.2.5. Redundancia az adatkapcsolati rétegben</h4></div></div></div><p>A hálózatokat több linken
	  keresztül kötjük össze és a
	  redundáns útvonalakat a feszítõfa
	  protokollal (Spanning Tree Protocol, STP).  Az Ethernetes
	  hálózatok esetében a megfelelõ
	  mûködéshez a két eszköz
	  között csak egyetlen aktív útvonal
	  létezhet, így a feszítõfa protokoll
	  észleli a hurkokat és a redundáns
	  összeköttetéseket blokkolt állapotba
	  teszi.  Amikor azonban az aktív linkek egyike
	  meghibásodik, akkor a protokoll
	  újraszámolja a fát és a
	  hálózati pontjai közti
	  konnektivitást megpróbálja
	  helyreállítani az addig blokkolt linkek
	  ismételt engedélyezésével.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100291664"></a>31.5.3. A rendszermag beállításai</h3></div></div></div><p>Ebben a szakaszban az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=if_bridge&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">if_bridge</span>(4)</span></a>
	hálózati híd implementációval
	foglalkozunk, de a Netgraph segítségével is
	tudunk hidakat építeni.  Ez
	utóbbiról az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ng_bridge&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ng_bridge</span>(4)</span></a> man oldalon
	olvashatunk.</p><p>Amikor létrehozunk egy hálózati hidat,
	az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> automatikusan betölti a
	hozzá tartozó meghajtót.  Ha viszont a
	rendszermag beállításait tartalmazó
	állományba felvesszük a <code class="literal">device
	if_bridge</code> sort, akkor akár be is
	építhetjük a rendszermagba.</p><p>A csomagszûrés minden olyan tûzfallal
	használható, amely a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pfil&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">pfil</span>(9)</span></a> rendszerre
	kapcsolódik.  Maga a tûzfal is betölthetõ
	modulként, vagy belefordítható a
	rendszermagba.</p><p>A hálózati híddal forgalmat is tudunk
	szabályozni az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=altq&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">altq</span>(4)</span></a> vagy a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dummynet&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">dummynet</span>(4)</span></a>
	segítségével.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100303440"></a>31.5.4. A hálózati híd
	engedélyezése</h3></div></div></div><p>Hálózati hidak felületek
	klónozásával hozhatóak létre.
	A híd létrehozásához
	használjuk az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> programot, és a
	megfelelõ meghajtó automatikusan
	betöltõdik, ha nem lenne még
	elérhetõ a rendszermagban.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge create</code></strong>
bridge0
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0</code></strong>
bridge0: flags=8802&lt;BROADCAST,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        id 00:00:00:00:00:00 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:00:00:00:00:00 priority 0 ifcost 0 port 0</pre><p>Ekkor létrejön a hálózati
	hídhoz tartozó felület és
	véletlenszerûen generálódik
	hozzá egy Ethernetes cím.  A
	<code class="literal">maxaddr</code> és a
	<code class="literal">timeout</code> paraméterek vezérlik,
	hogy a híd mennyi MAC-címet tartson meg a keretek
	továbbításáért felelõs
	táblázatban és mennyi másodperc
	után töröljön automatikusan egy
	bejegyzést a legutolsó használat
	után.  A többi paraméter a
	feszítõfa mûködését
	irányítja.</p><p>Vegyük fel a hídhoz tartozó
	hálózati tagfelületeket.  A híd csak
	akkor fog a tagfelületek között csomagokat
	továbbküldeni, amikor a híd és a tagok
	is <code class="literal">up</code> állapotban vannak:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm fxp0 addm fxp1 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp0 up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig fxp1 up</code></strong></pre><p>A híd most már átküldi az Ethernet
	kereteket a <code class="filename">fxp0</code> és
	<code class="filename">fxp1</code> felületek között.
	Az iméntiekkel megegyezõ konfigurációt
	az <code class="filename">/etc/rc.conf</code> állományban
	így alakíthatjuk ki:</p><pre class="programlisting">cloned_interfaces="bridge0"
ifconfig_bridge0="addm fxp0 addm fxp1 up"
ifconfig_fxp0="up"
ifconfig_fxp1="up"</pre><p>Ha a hídhoz IP-címet is rendelni akarunk,
	akkor inkább magánál a hídnál
	adjuk meg, ne a tagoknál.  Ezt statikusan vagy DHCP
	használatával is megtehetjük:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 inet 192.168.0.1/24</code></strong></pre><p>A hídhoz IPv6 címet is hozzá tudunk
	rendelni.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100319312"></a>31.5.5. Tûzfalazás</h3></div></div></div><a id="idp100320080" class="indexterm"></a><p>Ha engedélyezzük a csomagszûrést, a
	hídon áthaladó csomagok elõször a
	küldõ felület érkezési
	oldalára kerülnek, majd a hídra,
	végül a megfelelõ irányban levõ
	felület küldési oldalára.
	Bármelyik fázis letiltható.  Amikor a
	csomagok áramlásának iránya fontos
	számunkra, akkor jobban járunk, ha nem
	magára a hídra, hanem csak a tagfelületekre
	állítjuk be a tûzfalat.</p><p>A híd számos módosítható
	beállítással rendelkezik a nem-IP és
	ARP csomagok átküldésére, valamint
	arra, hogy az IPFW tûzfal adatkapcsolati réteg
	szintjén mûködhessen.  Az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=if_bridge&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">if_bridge</span>(4)</span></a> man
	oldal ennek részleteit tárja fel.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100322256"></a>31.5.6. Feszítõfák</h3></div></div></div><p>A híd meghajtója a gyors feszítõfa
	protokollt (Rapid Spanning Tree Protocol, RSTP avagy 802.1w)
	valósítja meg, ami visszafelé kompatibilis
	a korábban említett feszítõfa
	protokollal.  A feszítõfákat a
	hálózati topológiában
	felbukkanó hurkok észlelésére
	és eltávolítására
	alkalmazzák.  Az RSTP azonban a hagyományos
	STP-nél valamivel gyorsabb konvergenciát
	ígér, mivel itt a szomszédos switch-ek
	kicserélik egymás között az adataikat,
	és így újabb hurkok
	létrehozása nélkül képesek
	viszonylag gyorsan egyik állapotból
	átváltani a másikba.</p><p>Az alábbi táblázat a támogatott
	mûködési módokat
	láthatjuk:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Operációs rendszer</th><th>STP módok</th><th>Alapértelmezés</th></tr></thead><tbody><tr><td>FreeBSD 5.4-FreeBSD 6.2</td><td>STP</td><td>STP</td></tr><tr><td>FreeBSD 6.3+</td><td>RSTP vagy STP</td><td>STP</td></tr><tr><td>FreeBSD 7.0+</td><td>RSTP vagy STP</td><td>RSTP</td></tr></tbody></table></div><p>A tagfelületeken az <code class="literal">stp</code> paranccsal
	tudjuk engedélyezni a feszítõfák
	használatát.  Az <code class="filename">fxp0</code>
	és <code class="filename">fxp1</code> felületeket
	összekötõ hídfelület esetében
	tehát így:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 stp fxp0 stp fxp1</code></strong>
bridge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether d6:cf:d5:a0:94:6d
        id 00:01:02:4b:d4:50 priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:01:02:4b:d4:50 priority 32768 ifcost 0 port 0
        member: fxp0 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 3 priority 128 path cost 200000 proto rstp
                role designated state forwarding
        member: fxp1 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role designated state forwarding</pre><p>Láthatjuk, hogy a híd a
	feszítõfában megkapta a
	<code class="literal">00:01:02:4b:d4:50</code>-es azonosítót
	és a <code class="literal">32768</code>-as prioritást.
	Mivel <code class="literal">root id</code> értéke is
	ugyanez, elmondhatjuk, hogy ez a fa gyökereként
	funkcionáló híd.</p><p>Ha a hálózaton már valahol
	létezik egy másik híd:</p><pre class="screen">bridge0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        ether 96:3d:4b:f1:79:7a
        id 00:13:d4:9a:06:7a priority 32768 hellotime 2 fwddelay 15
        maxage 20 holdcnt 6 proto rstp maxaddr 100 timeout 1200
        root id 00:01:02:4b:d4:50 priority 32768 ifcost 400000 port 4
        member: fxp0 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 4 priority 128 path cost 200000 proto rstp
                role root state forwarding
        member: fxp1 flags=1c7&lt;LEARNING,DISCOVER,STP,AUTOEDGE,PTP,AUTOPTP&gt;
                port 5 priority 128 path cost 200000 proto rstp
                role designated state forwarding</pre><p>A <code class="literal">root id 00:01:02:4b:d4:50 priority 32768 ifcost
	400000 port 4</code> sor mutatja, hogy a fa
	gyökerét képezõ híd most a
	<code class="literal">00:01:02:4b:d4:50</code> azonosítóval
	rendelkezik, és ezt a hidat <code class="literal">400000</code>-res
	költséggel éri el a <code class="literal">port 4</code>
	(a 4.  porton) keresztül, amely jelen esetben az
	<code class="filename">fxp0</code> felület.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100343632"></a>31.5.7. Komolyabb hidak építése</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100344272"></a>31.5.7.1. A forgalom áramlásának
	  átszerkesztése</h4></div></div></div><p>A hidak támogatják az ún.
	  megfigyelési módot, ahol a csomagokat a
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> feldolgozásuk után eldobja,
	  így nem folytatódik a feldolgozásuk vagy
	  nem haladnak tovább.  Ennek
	  kihasználásával a két vagy
	  több felületen érkezõ adatokat egyetlen
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bpf&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">bpf</span>(4)</span></a> folyammá tudjuk alakítani.  Ez olyan
	  hálózati csapok forgalmának
	  átszerkesztésében hasznos, ahol a
	  két különbözõ felületen
	  keresztül küldjük ki az RX/TX
	  (fogadás/küldés) jeleket.</p><p>Az alábbi paranccsal tudjuk megoldani, hogy
	  négy felületrõl érkezõ adatot
	  legyünk képesek egyetlen folyamként
	  olvasni:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm fxp0 addm fxp1 addm fxp2 addm fxp3 monitor up</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tcpdump -i bridge0</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100353232"></a>31.5.7.2. Feszítõ portok</h4></div></div></div><p>A hídhoz befutó Ethernet keretek
	  mindegyikérõl készül egy
	  másolat, ami egy megadott feszítõ porton
	  keresztül megy tovább.  Hidanként
	  végtelen számú ilyen feszítõ
	  port létezhet, és ha egy felületet
	  feszítõ portnak adtunk meg, akkor
	  hagyományos portként már nem
	  használhatjuk.  Ez leginkább akkor hasznos,
	  amikor passzívan akarjuk megfigyelni a híddal
	  rendelkezõ hálózatot a híd
	  valamelyik feszítõ portjára
	  csatlakozó géprõl.</p><p>Küldessük az összes keretrõl egy
	  másolatot az <code class="filename">fxp4</code>
	  felületre:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 span fxp4</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100356048"></a>31.5.7.3. Privát felületek</h4></div></div></div><p>A privát felületek (private interface) csak
	  más privát felületek felé
	  küldenek tovább adatot.  Így
	  feltétel nélkül tudjuk korlátozni a
	  forgalmat, és sem Ethernet keretek, sem pedig ARP nem
	  megy keresztül rajtuk.  Ha viszont szelektíven
	  akarjuk korlátozni a forgalmat, akkor helyette
	  használjunk tûzfalat.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100357200"></a>31.5.7.4. Tapadós felületek</h4></div></div></div><p>Ha a híd egyik tagfelületét
	  tapadósnak (sticky) adjuk meg, akkor a dinamikusan
	  megtanult címek bejegyzései a
	  gyorsítótárba kerülésük
	  után állandósulnak.  A tapadós
	  bejegyzések soha nem évülnek el vagy
	  cserélõdnek le, még abban az esetben sem,
	  ha utána az adott címet egy másik
	  felületrõl látjuk.  Így a
	  továbbításra vonatkozó
	  táblázatot nem kell elõre
	  feltöltenünk, és a híd egyik
	  oldalán meglátott kliensek nem képesek
	  átvándorolni egy másik
	  hálózati szegmensbe.</p><p>Másik ilyen példa a tapadós
	  címek használatára az lehetne, amikor a
	  hidat VLAN-nal kombináljuk, és így egy
	  olyan útválasztót hozunk létre,
	  ahol az ügyfeleink az IP-címtartomány
	  pocséklása nélkül
	  zárhatóak el egymástól.
	  Tegyük fel, hogy az <code class="systemitem">A-ugyfel</code> a
	  <code class="literal">vlan100</code>, és a <code class="systemitem">B-ugyfel</code> a <code class="literal">vlan101</code>
	  felületen csatlakozik.  A híd IP-címe
	  <code class="systemitem">192.168.0.1</code>, amely maga is egy
	  internet felé mutató
	  útválasztó.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 addm vlan100 sticky vlan100 addm vlan101 sticky vlan101</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 inet 192.168.0.1/24</code></strong></pre><p>Mind a két kliens a <code class="systemitem">192.168.0.1</code> címet látja
	  alapértelmezett átjáróként,
	  és mivel a híd gyorsítótára
	  tapadós bejegyzéseket tartalmaz, a
	  MAC-címeik meghamisításával nem
	  tudják elcsípni a másikuk
	  forgalmát.</p><p>A VLAN-ok közti bárminemû
	  kommunikációt privát felületek
	  létrehozásával akadályozzuk meg
	  (vagy egy tûzfallal):</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 private vlan100 private vlan101</code></strong></pre><p>Ezzel a megoldással az ügyfeleinket teljesen
	  elszigeteljük egymástól úgy, hogy
	  közben az egész <code class="systemitem">/24</code> címtartomány
	  külön alhálózatok
	  kialakítása nélkül
	  kiosztható.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100370128"></a>31.5.7.5. Címek korlátozása</h4></div></div></div><p>Korlátozhatóak az egy felület
	  mögül küldeni képes egyedi
	  MAC-címek.  Amikor ezen a határon felül
	  érkeznek ismeretlen feladótól csomagok,
	  egészen addig eldobjuk ezeket, amíg egy
	  korábban már regisztrált
	  bejegyzést a rendszer ki nem töröl vagy ki
	  nem veszünk a
	  gyorsítótárból.</p><p>A következõ példában az
	  <code class="literal">vlan100</code> felületen csatlakozó
	  <code class="systemitem">A-ugyfel</code>
	  számára korlátozzuk le 10-re az Ethernet
	  eszközök számát:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ifconfig bridge0 ifmaxaddr vlan100 10</code></strong></pre></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp100373584"></a>31.5.7.6. SNMP felügyelet</h4></div></div></div><p>A hidak és az STP paraméterei az alap FreeBSD
	  rendszerben megtalálható SNMP démonnal
	  felügyelhetõek.  A hídhoz exportált
	  felügyeleti információk (Management
	  Information Base, MIB) megfelelnek az IETF által
	  elõírt szabványoknak, így
	  akár tetszõleges SNMP kliens vagy bármilyen
	  más felügyeleti szoftver alkalmas az
	  olvasásukra.</p><p>A hidat mûködtetõ gépen az
	  <code class="filename">/etc/snmp.config</code>
	  állományban engedélyezzük a
	  <code class="literal">begemotSnmpdModulePath."bridge" =
	  "/usr/lib/snmp_bridge.so"</code> sort és
	  indítsuk el a <span class="application">bsnmpd</span>
	  démont.  Itt még szükség lehet
	  más beállítások,
	  például a közösségek
	  nevének (community name) vagy a
	  hozzáférési listák (access list)
	  módosítására is.  Ezzel
	  kapcsolatban a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsnmpd&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">bsnmpd</span>(1)</span></a> és az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=snmp_bridge&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">snmp_bridge</span>(3)</span></a>
	  man oldalakat lapozzuk fel.</p><p>A következõ példában a
	  <span class="application">Net-SNMP</span> nevû szoftver
	  (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/net-snmp/pkg-descr">net-mgmt/net-snmp</a>) fogjuk
	  használni a híd elérésére,
	  de ugyanerre a <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net-mgmt/bsnmptools/pkg-descr">net-mgmt/bsnmptools</a> port is
	  alkalmas.  Az SNMP klienst használó gépen
	  egészítsük ki az
	  <code class="filename">$HOME/.snmp/snmp.conf</code>
	  állományt a híd felügyeleti
	  információinak
	  importálásával az
	  <span class="application">Net-SNMP</span> rendszerébe:</p><pre class="programlisting">mibdirs +/usr/share/snmp/mibs
mibs +BRIDGE-MIB:RSTP-MIB:BEGEMOT-MIB:BEGEMOT-BRIDGE-MIB</pre><p>Az IETF BRIDGE-MIB (RFC 4188)
	  használatán keresztül így tudjuk
	  elindítani egy híd
	  felügyeletét:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>snmpwalk -v 2c -c public bridge1.example.com mib-2.dot1dBridge</code></strong>
BRIDGE-MIB::dot1dBaseBridgeAddress.0 = STRING: 66:fb:9b:6e:5c:44
BRIDGE-MIB::dot1dBaseNumPorts.0 = INTEGER: 1 ports
BRIDGE-MIB::dot1dStpTimeSinceTopologyChange.0 = Timeticks: (189959) 0:31:39.59 centi-seconds
BRIDGE-MIB::dot1dStpTopChanges.0 = Counter32: 2
BRIDGE-MIB::dot1dStpDesignatedRoot.0 = Hex-STRING: 80 00 00 01 02 4B D4 50
...
BRIDGE-MIB::dot1dStpPortState.3 = INTEGER: forwarding(5)
BRIDGE-MIB::dot1dStpPortEnable.3 = INTEGER: enabled(1)
BRIDGE-MIB::dot1dStpPortPathCost.3 = INTEGER: 200000
BRIDGE-MIB::dot1dStpPortDesignatedRoot.3 = Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedCost.3 = INTEGER: 0
BRIDGE-MIB::dot1dStpPortDesignatedBridge.3 = Hex-STRING: 80 00 00 01 02 4B D4 50
BRIDGE-MIB::dot1dStpPortDesignatedPort.3 = Hex-STRING: 03 80
BRIDGE-MIB::dot1dStpPortForwardTransitions.3 = Counter32: 1
RSTP-MIB::dot1dStpVersion.0 = INTEGER: rstp(2)</pre><p>A példában látszik, hogy a
	  <code class="literal">dot1dStpTopChanges.0</code> értéke
	  kettõ, ami arra utal, hogy az STP híd
	  topológiája kétszer változott.  A
	  topológia változása pedig azt jelenti,
	  hogy a hálózaton belül egy vagy több
	  link állapota megváltozott vagy egyszerûen
	  meghibásodott és ezért egy új
	  fát kellett számolni.  A
	  <code class="literal">dot1dStpTimeSinceTopologyChange.0</code>
	  érték adja meg, hogy ez pontosan mikor is
	  történt.</p><p>Több híd felületének
	  felügyeletéhez a belsõ BEGEMOT-BRIDGE-MIB
	  parancsot is használhatjuk:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>snmpwalk -v 2c -c public bridge1.example.com</code></strong>
enterprises.fokus.begemot.begemotBridge
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName."bridge0" = STRING: bridge0
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseName."bridge2" = STRING: bridge2
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress."bridge0" = STRING: e:ce:3b:5a:9e:13
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseAddress."bridge2" = STRING: 12:5e:4d:74:d:fc
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts."bridge0" = INTEGER: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeBaseNumPorts."bridge2" = INTEGER: 1
...
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange."bridge0" = Timeticks: (116927) 0:19:29.27 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTimeSinceTopologyChange."bridge2" = Timeticks: (82773) 0:13:47.73 centi-seconds
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges."bridge0" = Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpTopChanges."bridge2" = Counter32: 1
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot."bridge0" = Hex-STRING: 80 00 00 40 95 30 5E 31
BEGEMOT-BRIDGE-MIB::begemotBridgeStpDesignatedRoot."bridge2" = Hex-STRING: 80 00 00 50 8B B8 C6 A9</pre><p>Így tudjuk megadni, hogy a hidat
	  <code class="literal">mib-2.dot1dBridge</code> részfán
	  keresztül akarjuk megfigyelni:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>snmpset -v 2c -c private bridge1.example.com</code></strong>
BEGEMOT-BRIDGE-MIB::begemotBridgeDefaultBridgeIf.0 s bridge2</pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-bluetooth.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="network-aggregation.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">31.4. Bluetooth </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 31.6. Linkek összefûzése és
      hibatûrése</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>