<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>25.4. A DTrace használata</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="dtrace.html" title="25. fejezet - DTrace" /><link rel="prev" href="dtrace-enable.html" title="25.3. A DTrace támogatásának engedélyezése" /><link rel="next" href="dtrace-language.html" title="25.5. A D nyelv" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">25.4. A DTrace használata</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="dtrace-enable.html">Vissza</a> </td><th width="60%" align="center">25. fejezet - DTrace</th><td width="20%" align="right"> <a accesskey="n" href="dtrace-language.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dtrace-using"></a>25.4. A DTrace használata</h2></div></div></div><p>A DTrace funkcióinak alkalmazásához
      léteznie kell egy DTrace eszköznek.  Ennek
      létrehozásához be kell töltenünk a
      megfelelõ modult:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload dtraceall</code></strong></pre><p>Innentõl már mûködésre
      kész a DTrace.  Rendszeradminisztrátorként a
      következõ módon kérdezhetjük le a
      rendelkezésre álló
      vizsgálatokat:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dtrace -l | more</code></strong></pre><p>Mivel lekérdezés eredménye pillanatok
      alatt betöltené az egész képernyõt,
      ezért az egészet még
      átirányítjuk a <code class="command">more</code>
      parancshoz.  Ha ez rendesen lefut, akkor a DTrace
      ténylegesen használhatónak tekinthetõ.
      Ezt követõen tekintsük át a
      hozzá tartozó eszközkészletet.</p><p>Ez a mellékelt eszközkészlet
      lényegében a rendszerrel kapcsolatos
      információk összegyûjtésére
      alkalmas szkripteket tartalmaz.  Vannak szkriptek, amelyekkel a
      megnyitott állományokat, a memóriát, a
      processzorhasználatot és még sok minden
      mást kérdezhetünk le.  A szkriptek a
      következõ parancs segítségével
      tömöríthetõek ki:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gunzip -c DTraceToolkit* | tar xvf -</code></strong></pre><p>A <code class="command">cd</code> parancs
      segítségével lépjünk be az
      így keletkezõ könyvtárba, és a
      kisbetûs névvel rendelkezõ
      állományok engedélyeit állítsuk
      be a <code class="literal">755</code> módra.</p><p>Mindegyik szkriptben el kell végeznünk némi
      módosítást: a <code class="filename">/usr/bin/ksh</code>
      hivatkozásokat írjuk át mindenhol a
      <code class="filename">/usr/local/bin/ksh</code> névre, illetve a
      <code class="filename">/usr/bin/sh</code> hivatkozásokat
      <code class="filename">/bin/sh</code> névre, majd
      végezetül pedig a <code class="filename">/usr/bin/perl</code>
      hivatkozásokat a <code class="filename">/usr/local/bin/perl</code>
      névre.</p><div xmlns="" class="important"><h3 class="admontitle">Fontos: </h3><p xmlns="http://www.w3.org/1999/xhtml">Itt még egyszer kiemelnénk, hogy a FreeBSD-ben
	jelenleg megtalálható DTrace támogatás
	<span class="emphasis"><em>még nem teljes</em></span> és
	<span class="emphasis"><em>kísérleti jelleggel</em></span> szerepel.
	Ezért bizonyos szkriptek nem fognak mûködni,
	vagy azért, mert túlságosan <span class="trademark">Solaris</span>TM
	lehetõségeihez igazodnak, vagy pedig azért,
	mert a jelenlegi implementáció által
	még nem ismert vizsgálatokra
	támaszkodnak.</p></div><p>Jelenlegi ismereteink szerint a FreeBSD egyelõre csak
      két szkriptet támogat teljes mértékben,
      ezek a <code class="filename">hotkernel</code> és a
      <code class="filename">procsystime</code>.  A szakasz további
      részében ezzel a kettõvel fogunk
      részletesebben foglalkozni.</p><p>A <code class="filename">hotkernel</code> feladata segíteni
      beazonosítani azokat a függvényeket, amelyek a
      legtöbb idõt veszik igénybe a rendszermagon
      belül.  A szkript futtatásakor nagyjából
      a következõt csinálja:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>./hotkernel</code></strong>
Sampling... Hit Ctrl-C to end.</pre><p>A folyamat <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span>
      billentyûkombináció hatására
      állítható meg.  A szkript
      futásának befejezõdésekor
      különbözõ rendszermagbeli
      függvények és a hozzájuk tartozó
      idõk jelennek meg, az utóbbi szerint növekvõ
      sorrendben:</p><pre class="screen">kernel`_thread_lock_flags                                   2   0.0%
0xc1097063                                                  2   0.0%
kernel`sched_userret                                        2   0.0%
kernel`kern_select                                          2   0.0%
kernel`generic_copyin                                       3   0.0%
kernel`_mtx_assert                                          3   0.0%
kernel`vm_fault                                             3   0.0%
kernel`sopoll_generic                                       3   0.0%
kernel`fixup_filename                                       4   0.0%
kernel`_isitmyx                                             4   0.0%
kernel`find_instance                                        4   0.0%
kernel`_mtx_unlock_flags                                    5   0.0%
kernel`syscall                                              5   0.0%
kernel`DELAY                                                5   0.0%
0xc108a253                                                  6   0.0%
kernel`witness_lock                                         7   0.0%
kernel`read_aux_data_no_wait                                7   0.0%
kernel`Xint0x80_syscall                                     7   0.0%
kernel`witness_checkorder                                   7   0.0%
kernel`sse2_pagezero                                        8   0.0%
kernel`strncmp                                              9   0.0%
kernel`spinlock_exit                                       10   0.0%
kernel`_mtx_lock_flags                                     11   0.0%
kernel`witness_unlock                                      15   0.0%
kernel`sched_idletd                                       137   0.3%
0xc10981a5                                              42139  99.3%</pre><p>Ez a szkript modulok esetén is alkalmazható.
      Ezt a módját a <code class="option">-m</code> kapcsoló
      megadásával aktiválhatjuk:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>./hotkernel -m</code></strong>
Sampling... Hit Ctrl-C to end.
^C
MODULE                                                  COUNT   PCNT
0xc107882e                                                  1   0.0%
0xc10e6aa4                                                  1   0.0%
0xc1076983                                                  1   0.0%
0xc109708a                                                  1   0.0%
0xc1075a5d                                                  1   0.0%
0xc1077325                                                  1   0.0%
0xc108a245                                                  1   0.0%
0xc107730d                                                  1   0.0%
0xc1097063                                                  2   0.0%
0xc108a253                                                 73   0.0%
kernel                                                    874   0.4%
0xc10981a5                                             213781  99.6%</pre><p>A <code class="filename">procsystime</code> szkript egy adott
      azonosítóval vagy névvel rendelkezõ
      programhoz tudja megadni az általa kezdeményezett
      rendszerhívások által felhasznált
      idõt.  A most következõ példában
      elindítjuk a <code class="filename">/bin/csh</code> egy újabb
      példányát.  A
      <code class="filename">procsystime</code> elindul, majd megvárja,
      amíg kiadunk néhány parancsot a
      <code class="command">csh</code> frissen indított
      másolatában.  A teszt eredményei tehát
      a következõk lesznek:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>./procsystime -n csh</code></strong>
Tracing... Hit Ctrl-C to end...
^C

Elapsed Times for processes csh,

         SYSCALL          TIME (ns)
          getpid               6131
       sigreturn               8121
           close              19127
           fcntl              19959
             dup              26955
         setpgid              28070
            stat              31899
       setitimer              40938
           wait4              62717
       sigaction              67372
     sigprocmask             119091
    gettimeofday             183710
           write             263242
          execve             492547
           ioctl             770073
           vfork            3258923
      sigsuspend            6985124
            read         3988049784</pre><p>Jól megfigyelhetõ, hogy (nanomásodpercekben
      mérve) a legtöbb idõt a
      <code class="function">read()</code>, a legkevesebb idõt pedig a
      <code class="function">getpid()</code> rendszerhívás vette
      igénybe.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="dtrace-enable.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="dtrace.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="dtrace-language.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">25.3. A DTrace támogatásának
      engedélyezése </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 25.5. A D nyelv</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>