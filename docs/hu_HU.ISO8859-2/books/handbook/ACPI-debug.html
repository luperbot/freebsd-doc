<?xml version="1.0" encoding="iso-8859-2" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" /><title>11.16. A FreeBSD ACPI támogatásának használata és nyomonkövetése</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD kézikönyv" /><link rel="up" href="config-tuning.html" title="11. fejezet - Beállítás és finomhangolás" /><link rel="prev" href="acpi-overview.html" title="11.15. Energia- és erõforrásgazdálkodás" /><link rel="next" href="boot.html" title="12. fejezet - A FreeBSD rendszerindítási folyamata" /><link rel="copyright" href="legalnotice.html" title="Jogi közlemény" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">11.16. A FreeBSD <acronym class="acronym">ACPI</acronym>
      támogatásának használata és
      nyomonkövetése</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="acpi-overview.html">Vissza</a> </td><th width="60%" align="center">11. fejezet - Beállítás és
    finomhangolás</th><td width="20%" align="right"> <a accesskey="n" href="boot.html">Elõre</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="ACPI-debug"></a>11.16. A FreeBSD <acronym class="acronym">ACPI</acronym>
      támogatásának használata és
      nyomonkövetése</h2></div><div><span class="authorgroup">Írta: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Lawson</span>, <span class="firstname">Nate</span></span>. </span></div><div><span class="authorgroup">Segítségére volt még:
	    <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Schultz</span>, <span class="firstname">Peter</span></span> és <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="surname">Rhodes</span>, <span class="firstname">Tom</span></span>. </span></div></div></div><a id="idp85481552" class="indexterm"></a><p>Az <acronym class="acronym">ACPI</acronym> az eszközök
      felderítésének,
      energiagazdálkodásának és a
      korábban a <acronym class="acronym">BIOS</acronym> által kezelt
      hardverek szabványosított
      hozzáférésének alapjaiban új
      módja.  Az <acronym class="acronym">ACPI</acronym> folyamatosan
      fejlõdik, de útját az egyes alaplapok
      <em class="firstterm"><acronym class="acronym">ACPI</acronym> Machine Language</em>
      (<acronym class="acronym">AML</acronym>) bytekód
      implementációjában megjelenõ
      hibák, a FreeBSD rendszermag alrendszereinek
      befejezetlensége és az <span class="trademark">Intel</span>(R)
      <acronym class="acronym">ACPI-CA</acronym> értelmezõjében
      levõ hibák lassítják.</p><p>Ez a leírás azzal a szándékkal
      készült, hogy segítsünk a
      felhasználóknak megtalálni az általuk
      tapasztalt problémák gyökerét és
      ezzel segíteni az <acronym class="acronym">ACPI</acronym> fejlesztõket
      a nyomonkövetésében és
      kijavításában.  A fejlesztõk
      köszönik, hogy ezt elolvassuk és
      segédkezünk a rendszerünkkel kapcsolatban
      felmerülõ problémák
      orvosolásában!</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-submitdebug"></a>11.16.1. A nyomkövetési információk
	beküldése</h3></div></div></div><div xmlns="" class="note"><h3 class="admontitle">Megjegyzés: </h3><p xmlns="http://www.w3.org/1999/xhtml">Mielõtt beküldenénk bármilyen
	  problémát is, gondoskodjunk róla, hogy a
	  <acronym class="acronym">BIOS</acronym>-unk, és ha lehetséges,
	  akkor a beágyazott vezérlõk, legfrissebb
	  verzióját használjuk.</p></div><p>Megkérnénk azokat, akik hibát akarnak
	bejelenteni, hogy a következõ
	információkat küldjék a <a class="link" href="mailto:freebsd-acpi@FreeBSD.org" target="_top">
	freebsd-acpi@FreeBSD.org</a> címre:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A hibás mûködés
	    leírása, beleértve a rendszer
	    típusát és
	    gyártmányát, illetve minden olyat,
	    aminek köze lehet a hibához.  Ha eddig
	    még nem tapasztaltuk, igyekezzünk minél
	    pontosabban leírni a hiba
	    keletkezésének folyamatát.</p></li><li class="listitem"><p>A <code class="command">boot -v</code> paranccsal indított
	    rendszer <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> kimenetét, beleértve a
	    vizsgálni kívánt hiba által
	    okozott összes hibaüzenetet.</p></li><li class="listitem"><p>A <code class="command">boot -v</code> paranccsal és az
	    <acronym class="acronym">ACPI</acronym> használata nélkül
	    indított rendszer <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dmesg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dmesg</span>(8)</span></a> kimenete abban az
	    esetben, ha ez segít megoldani a
	    problémát.</p></li><li class="listitem"><p>A <code class="command">sysctl hw.acpi</code> parancs kimenete.
	    Ezzel egyébként kitûnõen
	    kideríthetõ, milyen lehetõségeket is
	    kínál fel a rendszerünk.</p></li><li class="listitem"><p>Az általunk használt
	    <em class="firstterm"><acronym class="acronym">ACPI</acronym>
	    forrásnyelvének</em>
	    (<acronym class="acronym">ACPI</acronym> Source Language,
	    <acronym class="acronym">ASL</acronym>) elérhetõsége az
	    interneten.  Mivel ezek akár igen nagyok is lehetnek,
	    ezért a listára közvetlenül ne
	    küldjünk <acronym class="acronym">ASL</acronym> kódokat!
	    Az <acronym class="acronym">ASL</acronym> másolatát az
	    alábbi parancs kiadásával hozhatjuk
	    létre:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>acpidump -dt &gt; név-rendszer.asl</code></strong></pre><p>(Adjuk meg a <em class="replaceable"><code>név</code></em>
	    helyett a bejelentkezéshez használt
	    nevünket, a <em class="replaceable"><code>rendszer</code></em> helyett
	    pedig a gyártót/típust.
	    Például:
	    <code class="filename">njl-FooCo6000.asl</code>)</p></li></ul></div><p>Habár a legtöbb fejlesztõ a <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">FreeBSD-CURRENT levelezési lista</a>t
	figyeli, a problémáink
	leírását mindenképpen a
	<a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a> listára küldjük, hogy biztosan
	észrevegyék.  A fejlesztõk azt kérik,
	hogy legyünk türelmesek, hiszen emellett mindannyian
	teljes állásban is dolgoznak.  Ha az
	általunk felfedezett hiba nem teljesen
	egyértelmû, akkor a fejlesztõk
	valószínûleg meg fognak kérni arra,
	hogy a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=send-pr&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">send-pr</span>(1)</span></a> használatával hozzunk
	róla létre egy hivatalos hibajelentést.  A
	hibajelentés készítésekor
	lehetõleg a fentebb megadott információkat
	ugyanúgy adjuk meg.  Ez segít a probléma
	szemmel tartásában és
	elhárításában.  Az <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a>
	lista kihagyása nélkül közvetlenül
	ne küldjünk hibajelentést, mivel a
	hibabejelentõ rendszert elsõsorban
	emlékeztetõnek használjuk, nem pedig a
	hibák tényleges bejelentésére.
	Gyakran elõfordul, hogy valaki korábban már
	találkozott az adott problémával.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-background"></a>11.16.2. Háttér</h3></div></div></div><a id="idp85514192" class="indexterm"></a><p>Az <acronym class="acronym">ACPI</acronym> minden olyan modern
	számítógépben
	megtalálható, mely megfelel az ia32 (x86), ia64
	(Itanium) vagy amd64 (AMD) architektúrának.  A
	teljes szabvány rengeteg lehetõséget
	biztosít, többek közt a processzor
	teljesítményének kezelését,
	az energiaszintek vezérlését,
	hõzónákat, különféle
	akkumulátor rendszereket, beágyazott
	vezérlõk és a buszok
	felsorolását.  A legtöbb rendszer
	általában nem a teljes szabványt
	valósítja meg.  Például egy asztali
	rendszer általában csak a buszok
	felsorolásával kapcsolatos részeket
	tartalmazza, miközben egy laptop felajánlhatja a
	hûtés és az akkumulátor
	kezelését is.  A laptopokban gyakorta
	találunk készenléti üzemmódot a
	maguk elbonyolított formájában.</p><p>Egy <acronym class="acronym">ACPI</acronym>-nak megfelelõ rendszert
	számos összetevõ alkot.  A
	<acronym class="acronym">BIOS</acronym>-ok és chipkészletek
	gyártói a memóriában egy elõre
	rögzített ponton elhelyeznek bizonyos
	táblázatokat (például
	<acronym class="acronym">FADT</acronym>), amelyekkel megadják
	például az <acronym class="acronym">APIC</acronym>
	összerendeléseit (ezt az <acronym class="acronym">SMP</acronym>
	rendszerek használják), a
	konfigurációs regisztereket és az
	egyszerûbb konfigurációs
	értékeket.  Itt ezenkívül még
	bytekódok egy táblázata (amit
	<em class="firstterm">Differenciált rendszerleírtó
	táblának</em>, Differentiated System
	Description Table, <acronym class="acronym">DSDT</acronym> nevezünk) is
	megtalálható, ahol az eszközök és
	módszerek nevei szerepelnek faszerû
	elrendezésben.</p><p>Az <acronym class="acronym">ACPI</acronym>-hoz tartozó
	meghajtónak képesnek kell lennie értelmezni
	ezeket a rögzített táblázatokat,
	implementálni egy bytekód-értelmezõt,
	módosítani az eszközmeghajtókat
	és a rendszermagot az <acronym class="acronym">ACPI</acronym>
	alrendszerbõl érkezõ információk
	befogadásához.  A Linuxszal és a NetBSD-vel
	közösen a FreeBSD kapott egy ilyen értelmezõt
	az <span class="trademark">Intel</span>(R)tõl (<acronym class="acronym">ACPI-CA</acronym>).  Az
	<acronym class="acronym">ACPI-CA</acronym> forráskódja a rendszer
	forrásai között, a <code class="filename">src/sys/dev/acpica</code>
	könyvtárban található.  A <code class="filename">src/sys/dev/acpica/0sd</code>
	könyvtárban található források
	pedig lehetõvé teszik, hogy az
	<acronym class="acronym">ACPI-CA</acronym> mûködhessen FreeBSD-n.
	Végezetül, az <acronym class="acronym">ACPI</acronym>
	eszközöket megvalósító
	meghajtók a <code class="filename">src/sys/dev/acpica</code>
	könyvtárban találhatóak.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-comprob"></a>11.16.3. Gyakori problémák</h3></div></div></div><a id="idp85524048" class="indexterm"></a><p>Az <acronym class="acronym">ACPI</acronym> megfelelõ
	mûködéséhez minden
	alkotórésznek helyesen kell mûködnie.  A
	most következendõkben elõfordulásuk
	gyakorisága szerint felsorolunk néhány
	ismert problémát, valamint a hozzájuk
	tartozó javításokat vagy
	elkerülésük módszerét.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85534288"></a>11.16.3.1. Gondok az egérrel</h4></div></div></div><p>Egyes esetekben felfüggesztett
	  állapotból visszatérve az egerünk
	  nem hajlandó mûködni.  Ezt úgy lehet
	  elkerülni, ha <code class="filename">/boot/loader.conf</code>
	  állományba beírjuk a
	  <code class="literal">hint.psm.0.flags="0x3000"</code> sort.  Ha ez nem
	  segít, akkor a fentieknek megfelelõen
	  küldjünk be egy hibajelentést.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85536208"></a>11.16.3.2. Felfüggesztés/Folytatás</h4></div></div></div><p>Az <acronym class="acronym">ACPI</acronym> három
	  (<acronym class="acronym">STR</acronym>) állapotban képes a
	  fizikai memória segítségével
	  készenléti módba váltani, ezek az
	  <code class="literal">S1</code>-<code class="literal">S3</code>, és egy
	  állapotban használja a lemezt
	  (<code class="literal">STD</code>), amelyet <code class="literal">S4</code>-nek
	  hívnak.  Az <code class="literal">S5</code> neve a
	  <span class="quote">"<span class="quote">szoftveres kikapcsolás</span>"</span>, ami egy olyan
	  állapotot takar, amikor a rendszerünk áram
	  alatt van, de még nem üzemel.  Az
	  <code class="literal">S4</code><acronym class="acronym">BIOS</acronym> állapot a
	  <acronym class="acronym">BIOS</acronym> segítségével a
	  lemezre menti a rendszert, az
	  <code class="literal">S4</code><acronym class="acronym">OS</acronym> állapotot
	  pedig teljes egészében az
	  operációs rendszer valósítja
	  meg.</p><p>A rendszerünk által ismert
	  készenléti módokat a <code class="command">sysctl
	  hw.acpi</code> paranccsal ellenõrizhetjük.
	  Íme mindez egy Thinkpad esetén:</p><pre class="screen">hw.acpi.supported_sleep_state: S3 S4 S5
hw.acpi.s4bios: 0</pre><p>Ez azt jelenti, hogy az <code class="command">acpiconf -s</code>
	  parancs kiadásával kipróbálhatjuk
	  az <code class="literal">S3</code>,
	  <code class="literal">S4</code><acronym class="acronym">OS</acronym>, és
	  <code class="literal">S5</code> állapotokat.  Ha az
	  <code class="option">s4bios</code> értéke egy
	  (<code class="literal">1</code>), akkor az
	  <code class="literal">S4</code><acronym class="acronym">BIOS</acronym>
	  támogatása helyett az <code class="literal">S4</code>
	  <acronym class="acronym">OS</acronym> állapotot kapjuk.</p><p>A felfüggesztés és folytatás
	  kipróbálása során kezdjük az
	  <code class="literal">S1</code> állapottal, már amennyiben
	  az támogatott a rendszerünkön.  Ez az
	  állapot többnyire használható, mivel
	  nem igényel túlságosan sok
	  támogatást a meghajtó
	  részérõl.  Eddig még senki sem
	  implementálta az <code class="literal">S2</code>
	  állapotot, de ha ezt is tudja a rendszerünk, akkor
	  az <code class="literal">S1</code>-hez hasonlót nyerünk
	  vele.  A következõ próba az
	  <code class="literal">S3</code> állapoté.  Ez a
	  legmélyebb <acronym class="acronym">STR</acronym> állapot,
	  és a hardver megfelelõ
	  újraélesztéséhez rengeteg
	  támogatás szükségeltetik a
	  meghajtó részérõl.  Ha gondjaink
	  lennének a rendszerünk
	  felébresztésével, nyugodtan írjunk
	  egy levelet a <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">freebsd-acpi</a> listára, ám a
	  probléma gyors megoldódásában ne
	  reménykedjünk, hiszen ehhez még
	  temérdek meghajtón és hardveren kell
	  tesztelni és kell dolgozni.</p><p>Felfüggesztés és folytatás
	  esetén gyakori probléma, hogy sok
	  eszközmeghajtó nem menti el, nem
	  állítja vissza vagy éppen nem hozza
	  újra rendesen mûködésbe az adott
	  eszközön található firmware-t, a
	  regisztereket vagy memóriát.  Az okok
	  felderítéséhez elõször
	  érdemes a következõket
	  kipróbálni:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sysctl debug.bootverbose=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sysctl debug.acpi.suspend_bounce=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>acpiconf -s 3</code></strong></pre><p>Ezzel a módszerrel tesztelni tudjuk az összes
	  meghajtó felfüggesztési és
	  folytatási rutinjait anélkül, hogy
	  ténylegesen <code class="literal">S3</code> állapotba
	  helyeznénk az eszközt.  Bizonyos esetekben ezzel
	  könnyen elcsíphetõ a hiba
	  (például a firmware állapotának
	  elvesztése, watchdog time out, megállás
	  nélküli
	  újrapróbálkozások).  A rendszer
	  ilyenkor nem vált <code class="literal">S3</code>
	  állapotra, vagyis az eszköz nem kerül
	  energiatakarékos állapotba, és
	  eltérõen a valós <code class="literal">S3</code>
	  állapottól továbbra is mûködik
	  még abban az esetben is, amikor a szükséges
	  felfüggesztési és folytatási rutinok
	  teljesen hiányoznak.</p><p>Komolyabb esetben további
	  segédeszközökre lesz
	  szükségünk, vagyis soros portra és
	  kábelre a soros vonali nyomkövetéshez, vagy
	  Firewire portra és kábelre a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dcons&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">dcons</span>(4)</span></a>
	  használatához, valamint némi
	  tapasztalatra a rendszermagon belüli
	  hibakeresésben.</p><p>A problémát nagy mértékben
	  segíti különválasztani, ha
	  igyekszünk minél több meghajtót
	  kivenni a rendszermagból.  Ha így javul a
	  helyzet, akkor már könnyen le lehet
	  szûkíteni arra a meghajtóra a kört,
	  aminek betöltésével esetleg gondok
	  akadhatnak.  Általában ilyenek a bináris
	  meghajtók, mint például az
	  <code class="filename">nvidia.ko</code>, az X11
	  megjelenítésért felelõs és az
	  <acronym class="acronym">USB</acronym> eszközök meghajtói,
	  miközben az Ethernet eszközök remekül
	  szoktak mûködni.  Ha különösebb gond
	  nélkül képesek vagyunk betölteni
	  és eltávolítani ezeket a
	  meghajtókat, akkor ezt a folyamatot
	  önállósítani is tudjuk úgy,
	  hogy az <code class="filename">/etc/rc.suspend</code> és
	  <code class="filename">/etc/rc.resume</code> szkriptekbe
	  beillesztjük az ehhez szükséges parancsokat.
	  Ezekben egyébként találunk is egy
	  megjegyzésbe rakott példát a
	  meghajtók betöltésérõl
	  és eltávolításáról.
	  Ha az ébresztés után elszemetelõdik
	  a képernyõ tartalma, akkor állítsuk
	  át a <code class="option">hw.acpi.reset_video</code>
	  változó értékét
	  nullára (<code class="literal">0</code>).  Sokat segíthet
	  meg az is, ha a <code class="option">hw.acpi.sleep_delay</code>
	  értékét csökkentjük vagy
	  növeljük.</p><p>Megpróbálhatjuk azt is, hogy
	  elindítunk egy frissebb Linux
	  disztribúciót <acronym class="acronym">ACPI</acronym>
	  támogatással és ugyanazon a hardveren
	  kipróbáljuk az általa
	  felkínált felfüggesztési és
	  folytatási lehetõséget.  Ha Linux alatt ez
	  megbízhatóan mûködik, akkor nagy a
	  valószínûsége, hogy ez FreeBSD alatt az
	  egyik meghajtó hibájából
	  fakadóan nem használható.  Így
	  fokozatosan le is tudjuk szûkíteni, hogy pontosan
	  melyikkel lehet a gond, és ezzel a fejlesztõk
	  munkáját segítjük.
	  Megjegyeznénk, hogy az <acronym class="acronym">ACPI</acronym>-t
	  karbantartó fejlesztõk általában nem
	  foglalkoznak más meghajtókkal
	  (például hangkártya vagy
	  <acronym class="acronym">ATA</acronym> stb.), ezért az adott
	  meghajtóval kapcsolatos hibáról javasolt
	  értesíteni a <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">freebsd-current</a> listát
	  és a meghajtóért felelõs
	  fejlesztõt is.  Ha van egy kis kedvünk és
	  idõnk, mi magunk is belebiggyeszthetünk a
	  meghajtóba néhány <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=printf&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">printf</span>(3)</span></a>
	  függvényt annak kiderítésére,
	  pontosan hol is fagy le a folytatási
	  funkció.</p><p>Végül megpróbálkozhatunk az
	  <acronym class="acronym">ACPI</acronym> kikapcsolásával is,
	  és áttérhetünk helyette az
	  <acronym class="acronym">APM</acronym> használatára.  Ha az
	  <acronym class="acronym">APM</acronym>-mel mûködnek a
	  készenléti állapotok, akkor
	  érdemes inkább azzal dolgozni,
	  különösen a régebbi (2000 elõtti)
	  hardverek esetében.  A gyártóknak
	  eltartott egy ideig, amíg rendes
	  <acronym class="acronym">ACPI</acronym> támogatást voltak
	  képesek adni, ezért a régebbi
	  hardvereknél inkább a
	  <acronym class="acronym">BIOS</acronym>-nak akadnak gondjai az
	  <acronym class="acronym">ACPI</acronym>-val.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85569488"></a>11.16.3.3. A rendszer lemerevedik (ideiglenesen vagy
	  teljesen)</h4></div></div></div><p>A legtöbb rendszer olyankor akad meg, amikor sok
	  megszakítás elveszik, vagy amikor éppen
	  sok megszakítás érkezik egyszerre.  A
	  chipkészleteknek számos baja származik
	  abból, hogy a <acronym class="acronym">BIOS</acronym> milyen
	  módon állítja be a rendszer
	  indítása elõtt a
	  megszakításokat, mennyire helyes az
	  <acronym class="acronym">APIC</acronym> (<acronym class="acronym">MADT</acronym>)
	  táblázata és hogyan vezérli a
	  <em class="firstterm">Rendszervezérlõ
	  megszakítást</em> (System Control
	  Interrupt, <acronym class="acronym">SCI</acronym>).</p><a id="idp85576656" class="indexterm"></a><p>A megszakítás-viharok a <code class="command">vmstat
	  -i</code> parancs kimenetében szereplõ
	  elveszett megszakításokból
	  azonosíthatók be, ahol keressünk rá
	  az <code class="literal">acpi0</code> sorra.  Ha ez a
	  számláló másodpercenként
	  kettõnél többel növekszik, akkor a
	  megszakításaink viharba keveredtek.  Ha a
	  rendszer látszólag lefagyott,
	  próbáljuk meg elõhívni a
	  <acronym class="acronym">DDB</acronym>-t (konzolban a <span class="keycap"><strong>CTRL</strong></span>+<span class="keycap"><strong>ALT</strong></span>+<span class="keycap"><strong>ESC</strong></span>) és gépeljük be, hogy
	  <code class="literal">show interrupts</code>.</p><a id="idp85580496" class="indexterm"></a><p>A megszakítási problémákkal
	  kapcsolatban egyetlen reményünk az
	  <acronym class="acronym">APIC</acronym> támogatás
	  kikapcsolása lehet a <code class="filename">loader.conf</code>
	  állományban a
	  <code class="literal">hint.apic.0.disabled="1"</code> sor
	  hozzáadásával.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85583440"></a>11.16.3.4. Végzetes hibák</h4></div></div></div><p>Az <acronym class="acronym">ACPI</acronym>-vel kapcsolatos végzetes
	  hibák viszonylag ritkák, és
	  javításuk a legfontosabb.  Ilyenkor az elsõ
	  teendõnk elkülöníteni a hiba
	  reprodukálásának egyes
	  lépéseit és (ha lehetséges)
	  lekérni a hívási láncot.
	  Kövessük az <code class="literal">options DDB</code> és
	  a soros vonali konzol
	  beállításához adott
	  tanácsokat (lásd <a class="xref" href="serialconsole-setup.html#serialconsole-ddb" title="26.6.5.3. A DDB elérése a soros vonalról">26.6.5.3. szakasz - A DDB elérése a soros
	  vonalról</a>) vagy hozzunk létre egy
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> partíciót.  A
	  <acronym class="acronym">DDB</acronym>-ben a hívási
	  láncot a <code class="literal">tr</code> parancs
	  segítségével kérhetjük le.
	  Ha kézzel írjuk le láncot, akkor
	  legalább az alsó öt (5) és a
	  felsõ öt (5) sorát mindenképpen
	  jegyezzük fel!</p><p>Ezután próbáljuk meg úgy
	  szûkíteni a probléma
	  lehetõségét, hogy az
	  <acronym class="acronym">ACPI</acronym> használata nélkül
	  indítjuk a rendszert.  Ha ezzel nincs semmi gond, akkor
	  a <code class="option">debug.acpi.disable</code> változó
	  értékének megfelelõ
	  beállításával egyenként meg
	  tudjuk figyelni az <acronym class="acronym">ACPI</acronym> alrendszer egyes
	  részeit.  Ehhez példákat az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a>
	  man oldalon találunk.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85589584"></a>11.16.3.5. Felfüggesztés vagy
	  leállítás után elindul a
	  rendszer</h4></div></div></div><p>Elõször is próbáljuk meg a
	  <code class="literal">hw.acpi.disable_on_poweroff</code>
	  változó értékét
	  <code class="literal">0</code>-ra állítani a
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">loader.conf</span>(5)</span></a> állományban.  Ezzel
	  távoltartjuk az <acronym class="acronym">ACPI</acronym> alrendszert a
	  rendszer leállítási
	  folyamatától.  Egyes rendszereknek valamilyen
	  okból kifolyólag szükségük van
	  itt az <code class="literal">1</code> (az alapértelmezett)
	  értékre.  Ez többnyire megoldja a
	  problémát, amikor a rendszer váratlanul
	  elindul a készenléti mód
	  aktiválásákor vagy
	  kikapcsoláskor.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85597264"></a>11.16.3.6. Egyéb problémák</h4></div></div></div><p>Ha más gondjaink lennének az
	  <acronym class="acronym">ACPI</acronym>-val (dokkoló
	  állomásunk van, egyes eszközöket nem
	  vesz észre stb.), akkor természetesen errõl
	  is küldjünk egy leírást a
	  levelezési listára.  Azonban vegyük
	  figyelembe, hogy egyes problémák a
	  <acronym class="acronym">ACPI</acronym> alrendszer eddig még nem
	  implementált, befejezetlen részeihez
	  kötõdnek, ezért azok megoldása
	  még várat magára.  Kérünk
	  mindenkit, hogy legyen türelemmel és álljon
	  készen a kiküldött javítások
	  tesztelésére!</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-aslanddump"></a>11.16.4. <acronym class="acronym">ASL</acronym>, <code class="command">acpidump</code>
	és <acronym class="acronym">IASL</acronym></h3></div></div></div><a id="idp85600976" class="indexterm"></a><p>A problémák leggyakoribb forrása, hogy
	a <acronym class="acronym">BIOS</acronym>-gyártók rossz (vagy
	kifejezetten hibás!) bytekódokat adnak.  Ez
	általában a következõhöz
	hasonló rendszerüzenetbõl derül ki:</p><pre class="screen">ACPI-1287: *** Error: Method execution failed [\\_SB_.PCI0.LPC0.FIGD._STA] \\
(Node 0xc3f6d160), AE_NOT_FOUND</pre><p>Az ilyen jellegû hibákat gyakran úgy
	lehet orvosolni, ha a <acronym class="acronym">BIOS</acronym>-unkat
	frissítjük a legújabb verzióra.  A
	legtöbb ilyen üzenet teljesen ártalmatlan, de
	ha vannak más problémáink is,
	például az akkumulátor állapota nem
	olvasható le, akkor elõször az
	<acronym class="acronym">AML</acronym> környékén
	érdemes kutakodnunk.  A bytekód, más
	néven <acronym class="acronym">AML</acronym>, az <acronym class="acronym">ASL</acronym>
	elnevezésû forrásnyelvbõl
	származik.  Az <acronym class="acronym">AML</acronym> egy
	<acronym class="acronym">DSDT</acronym> néven ismert
	táblázatban található meg.  Az
	<acronym class="acronym">ASL</acronym> másolatát az
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpidump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">acpidump</span>(8)</span></a> paranccsal készíthetjük el.
	Paraméterként egyaránt adjuk meg a
	<code class="option">-t</code> (megmutatja a rögzített
	táblák tartalmát) és
	<code class="option">-d</code> (visszafejti az <acronym class="acronym">AML</acronym>
	kódokat az <acronym class="acronym">ASL</acronym> nyelvére)
	kapcsolókat.  A felírás pontos
	formátumát a <a class="link" href="ACPI-debug.html#ACPI-submitdebug" title="11.16.1. A nyomkövetési információk beküldése">A
	nyomkövetési információk
	beküldése</a> címû szakaszban
	olvashatjuk.</p><p>Elsõként próbáljuk meg
	újrafordítani az így nyert
	<acronym class="acronym">ASL</acronym> programot és keressünk benne
	hibákat.  A figyelmeztetések
	általában nyugodtan figyelmen kívül
	hagyhatóak, azonban a hibák olyan
	implementációs hibákra utalnak, amelyek
	akadályozzák az <acronym class="acronym">ACPI</acronym> helyes
	mûködését.  Az <acronym class="acronym">ASL</acronym>
	újrafordítását az alábbi
	paranccsal tudjuk elvégezni:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>iasl saját.asl</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-fixasl"></a>11.16.5. Az <acronym class="acronym">ASL</acronym> kijavítása</h3></div></div></div><a id="idp85662928" class="indexterm"></a><p>Végeredményben az a célunk, hogy az
	<acronym class="acronym">ACPI</acronym> megfelelõ
	mûködéséhez senkinek se kelljen
	hozzányúlnia semmihez.  Azonban még mindig
	szükség van
	<acronym class="acronym">BIOS</acronym>-gyártók által
	elkövetett gyakori hibák
	elkerülésének kifejlesztésére.
	A <span class="trademark">Microsoft</span>(R) értelmezõje
	(<code class="filename">acpi.sys</code> és
	<code class="filename">acpiec.sys</code>) nem ellenõrzi
	szigorúan a szabvány szerinti megfelelést,
	ezért számos olyan
	<acronym class="acronym">BIOS</acronym>-gyártó, akik csak
	<span class="trademark">Windows</span>(R) alatt tesztelik az <acronym class="acronym">ACPI</acronym>
	implementációjukat, soha nem fogják
	kijavítani a <acronym class="acronym">ASL</acronym> kódjukban
	ejtett hibáikat.  Reménykedünk, hogy
	folyamatosan sikerül felderíteni és
	dokumentálni a <span class="trademark">Microsoft</span>(R) értelmezõje
	által eltûrt szabványon kívüli
	viselkedést és leutánozni FreeBSD alatt is,
	hogy így ne kelljen a felhasználóknak
	kézzel a saját <acronym class="acronym">ASL</acronym>
	forrásaikat javítgatni.  Az ebbõl
	fakadó hibákat úgy tudjuk elkerülni
	és segíteni a fejlesztõknek
	azonosítani a hozzá társuló
	viselkedést, hogy magunk javítjuk az
	<acronym class="acronym">ASL</acronym>-ben felfedezett hibákat.  Ha ez
	beválik, akkor küldjük el a régi
	és új <acronym class="acronym">ASL</acronym> közti
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a>-et a fejlesztõknek, akik így majd az
	<acronym class="acronym">ACPI-CA</acronym>-ban ki tudnak dolgozni egy
	megoldást a hibás viselkedésre, ezzel a
	javításunk szükségtelenné
	válik.</p><a id="idp85683536" class="indexterm"></a><p>Most pedig következzenek a legismertebb
	hibaüzenetek, az okaik és
	javításuk:</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85685072"></a>11.16.5.1. Operációs rendszeri
	  függõségek</h4></div></div></div><p>Néhány <acronym class="acronym">AML</acronym> úgy
	  gondolja, hogy a világ csak a
	  különbözõ <span class="trademark">Windows</span>(R)
	  verziókból áll.  A FreeBSD-nek
	  megadható, hogy másik operációs
	  rendszernek adja ki magát, és ezzel talán
	  meg is szüntethetõ pár hiba.  Ezt a
	  legegyszerûbb úgy tudjuk megtenni, ha a
	  <code class="filename">/boot/loader.conf</code>
	  állományhoz hozzáfûzzük a
	  <code class="literal">hw.acpi.osname="Windows 2001"</code> sort, vagy
	  itt egy olyan karakterláncot adunk meg, amit az
	  <acronym class="acronym">ASL</acronym> forrásban láttunk.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85688400"></a>11.16.5.2. Hiányzó visszatérési
	  érték</h4></div></div></div><p>Bizonyos módszerek a szabvány szerint
	  elvártaktól eltérõen nem adnak
	  vissza explicit módon értéket.  Mivel az
	  <acronym class="acronym">ACPI-CA</acronym> ezt nem kezeli le, ezért a
	  FreeBSD részérõl tartalmaz egy olyan
	  módosítást, amivel implicit módon
	  is vissza lehet adni értéket.  Ha biztosak
	  akarunk lenni a visszaadni kívánt
	  értékben, akkor helyezzünk el a
	  megfelelõ helyekre explicit Return
	  utasításokat.  Az <code class="command">iasl</code> a
	  <code class="option">-f</code> paraméterrel
	  kényszeríthetõ az ilyen
	  <acronym class="acronym">ASL</acronym> források
	  lefordítására.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp85699408"></a>11.16.5.3. Az alapértelmezett <acronym class="acronym">AML</acronym>
	  felülbírálása</h4></div></div></div><p>Miután módosítottuk a
	  <code class="filename">saját.asl</code>
	  állományunkat, így tudjuk
	  lefordítani:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>iasl saját.asl</code></strong></pre><p>Az <code class="option">-f</code> kapcsoló
	  megadásával
	  kikényszeríthetjük az
	  <acronym class="acronym">AML</acronym> létrehozását
	  még abban az esetben is, amikor hibákat
	  tartalmaz.  Ügyeljünk rá, hogy bizonyos
	  hibákat (például a hiányzó
	  visszatérési értékeket) a
	  fordító magától
	  kikerül.</p><p>Az <code class="command">iasl</code> alapértelmezett kimenete
	  a <code class="filename">DSDT.aml</code> állomány.  A
	  <code class="filename">/boot/loader.conf</code>
	  átírásával így tudjuk ezzel
	  helyettesíteni a <acronym class="acronym">BIOS</acronym>-unk
	  hibás változatát (ami még mindig
	  megtalálható a flash
	  memóriában):</p><pre class="programlisting">acpi_dsdt_load="YES"
acpi_dsdt_name="/boot/DSDT.aml"</pre><p>Ehhez ne felejtsük el a saját
	  <code class="filename">DSDT.aml</code> állományunkat
	  bemásolni a <code class="filename">/boot</code>
	  könyvtárba.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-debugoutput"></a>11.16.6. Nyomkövetési információk
	kinyerése az <acronym class="acronym">ACPI</acronym>-bõl</h3></div></div></div><a id="idp85712592" class="indexterm"></a><a id="idp85713744" class="indexterm"></a><p>Az <acronym class="acronym">ACPI</acronym> meghajtója nagyon rugalmas
	nyomkövetési lehetõségekkel rendelkezik.
	Ennek révén ugyanúgy megadhatjuk a
	nyomonkövetni kívánt alrendszert, mint ahogy
	annak mélységét is.  A nyomkövetni
	kívánt alrendszereket
	<span class="quote">"<span class="quote">rétegekként</span>"</span> adjuk meg, valamint
	ezek <acronym class="acronym">ACPI-CA</acronym> komponensekre
	(ACPI_ALL_COMPONENTS) és <acronym class="acronym">ACPI</acronym>
	hardvertámogatásra (ACPI_ALL_DRIVERS) bomlanak le.
	A nyomkövetéskor keletkezõ kimenet
	részletességét a
	<span class="quote">"<span class="quote">szintként</span>"</span> adjuk meg, ami az
	ACPI_LV_ERROR-tól (csak a hibák)
	ACPI_LV_VERBOSE-ig (minden) terjedhet.  A <span class="quote">"<span class="quote">szint</span>"</span>
	itt egy bitmaszk, ezért szóközzel
	elválasztva egyszerre több
	beállítás megadható.  Ha
	túlságosan sok üzenet érkezik a konzol
	üzenetpufferébe, akkor szükségünk
	lehet a soros konzol keresztüli nyomkövetésre
	is.  Az összes szint és réteg az <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a>
	man oldalon található meg.</p><p>A nyomkövetés alapértelmezés
	szerint nem engedélyezett.  Az
	engedélyezéséhez hozzá kell adnunk
	az <code class="literal">options ACPI_DEBUG</code> sort a rendszermagunk
	beállításait tartalmazó
	állományhoz, amennyiben a rendszermagba
	fordítjuk az <acronym class="acronym">ACPI</acronym>
	támogatást.  Ha az
	<code class="filename">/etc/make.conf</code> állományba
	írjuk bele az <code class="literal">ACPI_DEBUG=1</code> sort, akkor
	azt globálisan engedélyezhetjük.  Ha
	modulként használjuk, elegendõ csak a
	következõ módon újrafordítani az
	<code class="filename">acpi.ko</code> modult:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /sys/modules/acpi/acpi
&amp;&amp; make clean &amp;&amp;
make ACPI_DEBUG=1</code></strong></pre><p>Telepítsük fel a <code class="filename">acpi.ko</code>
	modult a <code class="filename">/boot/kernel</code>
	könyvtárba és állítsuk be a
	számunkra megfelelõ szintet és réteget
	a <code class="filename">loader.conf</code> állományban.
	Az alábbi példában
	engedélyezzük az összes
	<acronym class="acronym">ACPI-CA</acronym> komponens és az összes
	<acronym class="acronym">ACPI</acronym> hardvermeghajtó (processzor,
	<acronym class="acronym">LID</acronym> stb.) nyomkövetését.
	Csak a hibaüzeneteket írja ki
	részletesen.</p><pre class="programlisting">debug.acpi.layer="ACPI_ALL_COMPONENTS ACPI_ALL_DRIVERS"
debug.acpi.level="ACPI_LV_ERROR"</pre><p>Ha az általunk keresett információt egy
	adott esemény váltja ki (például egy
	felfüggesztés vagy egy ébresztés),
	akkor nem is fontos átírnunk hozzá a
	<code class="filename">loader.conf</code> állományt, hanem
	helyette a rendszer indítása után
	használjuk a <code class="command">sysctl</code> parancsot a
	réteg és a szint megadására akkor,
	amikor a rendszert felkészítjük az
	eseményre.  A <code class="command">sysctl</code>
	változókat ugyanúgy nevezték el,
	mint a <code class="filename">loader.conf</code>
	állományban található
	beállításokat.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ACPI-References"></a>11.16.7. Hivatkozások</h3></div></div></div><p>Az <acronym class="acronym">ACPI</acronym>-rõl az alábbi
	helyeken találunk részletesebb
	információkat:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-acpi" target="_top">FreeBSD ACPI levelezési lista</a></p></li><li class="listitem"><p>Az <acronym class="acronym">ACPI</acronym> levelezési lista
	    archívuma: <code class="uri"><a class="uri" href="http://lists.freebsd.org/pipermail/freebsd-acpi/" target="_top">http://lists.freebsd.org/pipermail/freebsd-acpi/</a></code></p></li><li class="listitem"><p>A korábbi <acronym class="acronym">ACPI</acronym>
	    levelezési lista archívuma: <code class="uri"><a class="uri" href="http://home.jp.FreeBSD.org/mail-list/acpi-jp/" target="_top">http://home.jp.FreeBSD.org/mail-list/acpi-jp/</a></code></p></li><li class="listitem"><p>Az <acronym class="acronym">ACPI</acronym> 2.0
	    specifikációja: <code class="uri"><a class="uri" href="http://acpi.info/spec.htm" target="_top">http://acpi.info/spec.htm</a></code></p></li><li class="listitem"><p>A FreeBSD következõ man oldalai: <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi</span>(4)</span></a>,
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpi_thermal&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">acpi_thermal</span>(4)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpidump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">acpidump</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=iasl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">iasl</span>(8)</span></a>,
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=acpidb&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">acpidb</span>(8)</span></a></p></li><li class="listitem"><p><a class="link" href="http://www.cpqlinux.com/acpi-howto.html#fix_broken_dsdt" target="_top">
	    A <acronym class="acronym">DSDT</acronym> nyomkövetése
	    (angolul)</a>.  (Példának a Compaqot hozza
	    fel, de általánosságban véve
	    hasznos.)</p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="acpi-overview.html">Vissza</a> </td><td width="20%" align="center"><a accesskey="u" href="config-tuning.html">Fel</a></td><td width="40%" align="right"> <a accesskey="n" href="boot.html">Elõre</a></td></tr><tr><td width="40%" align="left" valign="top">11.15. Energia- és
      erõforrásgazdálkodás </td><td width="20%" align="center"><a accesskey="h" href="index.html">Fõoldal</a></td><td width="40%" align="right" valign="top"> 12. fejezet - A FreeBSD rendszerindítási folyamata</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ha kérdése van a FreeBSD-vel kapcsolatban, a
    következõ címre írhat (angolul):
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Ha ezzel a dokumentummal kapcsolatban van kérdése, kérjük erre a címre írjon:
    &lt;<a href="mailto:gabor@FreeBSD.org">gabor@FreeBSD.org</a>&gt;.</small></p></body></html>