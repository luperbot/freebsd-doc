<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>29.2. Pasarelas y &#8220;routers&#8221;</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="advanced-networking.html" title="Capítulo 29. Networking avanzado" /><link rel="prev" href="advanced-networking.html" title="Capítulo 29. Networking avanzado" /><link rel="next" href="network-wireless.html" title="29.3. Redes sin cables (&#8220;wireless&#8221;)" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.2. Pasarelas y <span class="quote">&#8220;<span class="quote">routers</span>&#8221;</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="advanced-networking.html">Anterior</a> </td><th width="60%" align="center">Capítulo 29. Networking avanzado</th><td width="20%" align="right"> <a accesskey="n" href="network-wireless.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-routing"></a>29.2. Pasarelas y <span class="quote">&#8220;<span class="quote">routers</span>&#8221;</span></h2></div><div><span class="authorgroup">Escrito por <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Coranth</span> <span class="surname">Gryphon</span></span>. </span></div></div></div><a id="idp81804496" class="indexterm"></a><a id="idp81805008" class="indexterm"></a><a id="idp81805520" class="indexterm"></a><p>Para que una máquina sea capaz de encontrar otra
      máquina remota a través de la red debe existir
      mecanismo que describa cómo llegar del origen al destino.
      Este mecanismo se demonina <em class="firstterm">routing</em> o
      <em class="firstterm">encaminamiento</em>.  Una <span class="quote">&#8220;<span class="quote">ruta</span>&#8221;</span>
      es un par definido de direcciones: una dirección de
      <span class="quote">&#8220;<span class="quote">destino</span>&#8221;</span> y una dirección
      de <span class="quote">&#8220;<span class="quote">pasarela</span>&#8221;</span>.  Éste par indica que para llegar a
      dicho <span class="emphasis"><em>destino</em></span> debe efectuarse  una
      comunicación previa con dicha
      <span class="emphasis"><em>pasarela</em></span>.  Exiten tres tipos distintos
      de destinos: máquinas individuales, subredes y
      <span class="quote">&#8220;<span class="quote">por defecto</span>&#8221;</span>.  La <span class="quote">&#8220;<span class="quote">ruta por defecto</span>&#8221;</span>
      se utiliza sólamente cuando no se puede aplicar ninguna
      de las otras rutas existentes.  El tema de las
      rutas por defecto se tratará más adelante con
      más detalle.  También existen tres tipos de
      pasarelas distintas: máquinas individuales, interfaces
      (también llamados <span class="quote">&#8220;<span class="quote">enlaces</span>&#8221;</span>) y direcciones
      hardware de ethernet (direcciones MAC).</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81810384"></a>29.2.1. Ejemplo</h3></div></div></div><p>Para ilustrar diferentes aspectos del sistema de
        encaminamiento veamos el siguiente ejemplo obtenido mediante
        <code class="command">netstat</code>.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>netstat -r</code></strong>
Routing tables

Destination      Gateway            Flags     Refs     Use     Netif Expire

default          outside-gw         UGSc       37      418      ppp0
localhost        localhost          UH          0      181       lo0
test0            0:e0:b5:36:cf:4f   UHLW        5    63288       ed0     77
10.20.30.255     link#1             UHLW        1     2421
ejemplo.com      link#1             UC          0        0
host1            0:e0:a8:37:8:1e    UHLW        3     4601       lo0
host2            0:e0:a8:37:8:1e    UHLW        0        5       lo0 =&gt;
host2.ejemplo.com link#1            UC          0        0
224              link#1             UC          0        0</pre><a id="idp81812944" class="indexterm"></a><p>Las primeras dos líneas especifican la ruta por
        defecto (la cual se comenta en la
	<a class="link" href="network-routing.html#network-routing-default" title="29.2.2. Rutas por defecto">siguiente
          sección</a>) y la ruta de <code class="systemitem">máquina
          local</code>.</p><a id="idp81814736" class="indexterm"></a><p>La interfaz (columna <code class="literal">Netif</code>) que
        especifica esta tabla de rutas
	para el destino <code class="literal">localhost</code> se denomina
        <code class="filename">lo0</code>,
	y también se conoce como el dispositivo de <span class="quote">&#8220;<span class="quote">
	loopback</span>&#8221;</span> a de bucle de retorno. Esto viene a decir que
        el tráfico no debe entregarse a la red puesto que
        dicho tráfico va destinado a la misma máquina
        que lo originó.</p><a id="idp81817168" class="indexterm"></a><p>Lo siguiente que podemos observar son las direcciones
        que comienzan por
        <code class="systemitem">0:e0:</code>.  Son direcciones hardware de
	Ethernet, llamadas también se direcciones MAC.
        FreeBSD identifica automáticamente cualquier
        máquina (<code class="systemitem">test0</code> en el ejemplo anterior)
        que se encuentre en la red local y
        crea una ruta del estilo que estamos comentando, para entregar
        el tráfico directamente a través del
        correspondiente interfaz Ethernet, en este caso
        <code class="filename">ed0</code>.  Existe también
        un contador (<code class="literal">Expire</code>) asociado con este tipo
        de rutas que se usa para borrarlas cuando dicho contador expira.
        Las rutas para las máquinas de nuestra propia red de
        de área local se crean dinámicamente
        utilizando el protocolo ARP (Address Resolution Protocol o
        Protocolo de Resolución de Direcciones),
        que se encarga de averiguar la dirección MAC que se
        corresponde con la dirección IP de la máquina
        destino.</p><a id="idp81824592" class="indexterm"></a><p>FreeBSD tambíen utiliza rutas de subred para
        direccionar la subred local (<code class="systemitem">10.20.30.255</code> es la dirección
        de broadcast para la subred
	 <code class="systemitem">10.20.30</code>, y
	  <code class="systemitem">ejemplo.com</code> es el nombre de
        dominio asociado con dicha subred.)
        La notación <code class="literal">link#1</code> se refiere a la
        primera tarjeta Ethernet de la máquina.
        En este tipo de redes no se especifica ningún interfaz
        en el campo de <code class="literal">Netif</code>.</p><p>Las rutas de subredes aparecen cuando se asigna una
        dirección IP a una interfaz, utilizando una
        máscara de red.  También se pueden aprender
        dinámicamente utilizando demonios de encaminamiento,
        como <span class="application">routed</span>.  Por último estas
        rutas pueden crearse manualmente de forma explícita;
         es lo que se conoce con el nombre de rutas estáticas.</p><p>La línea de <code class="literal">host1</code> se refiere a
        nuestra máquina, que el sistema identifica por la
        correspondiente dirección Ethernet de la tarjeta de red.
        FreeBSD sabe que debe utilizar la interfaz de loopback
        (<code class="filename">lo0</code>) en vez de enviar los paquetes a
        a través de red.</p><p>Las dos líneas que comienzan por
        <code class="literal">host2</code> son ejemplos del uso de alias de
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a> alias (consultar la sección sobre
        Ethernet para averiguar por qué nos podría
        interesar hacer esto.)  El símbolo
        <code class="literal">=&gt;</code> después de la interfaz
	<code class="filename">lo0</code> especifica que no sólo
        estamos utilizando la interfaz de loopback, si no que
        además especifica que se trata de un alias.  Estas rutas
        sólo aparecen en las máquinas que implementan el
        alias, el resto de las máquinas de la subred local
        solamente poseerán una línea
	<code class="literal">link#1</code> para dichas rutas.</p><p>La última línea (destino de subred <code class="systemitem">224</code>) trata sobre encaminamiento
        multicast, que cubriremos en otra sección.</p><p>Finalmente, se pueden observar varios atributos
        relacionados con las rutas en la columna de
        <code class="literal">Flags</code>. A continuación se muestra una
        pequeña tabla con el significado de algunos de esos
        de los atributos o <span class="quote">&#8220;<span class="quote">flags</span>&#8221;</span>.</p><div class="informaltable"><table border="0"><colgroup><col /><col /></colgroup><tbody><tr><td>U</td><td>Up: La ruta está activa.</td></tr><tr><td>H</td><td>Host: El destino de la ruta es una única
                máquina.</td></tr><tr><td>G</td><td>Gateway: Envía cualquier cosa para éste
                destino a través de la pasarela especificada,
                la cual decidirá cómo encaminar el paquete
                hasta que eventualmente se alcance el destino.</td></tr><tr><td>S</td><td>Static: Esta ruta se configuró
                manualmente, y no se ha generado de forma
                automática por el sistema.</td></tr><tr><td>C</td><td>Clone: Genera una nueva ruta para la
                máquina a la que nos queremos conectar
                basándose en la ruta actual.  Este tipo de ruta se
                utiliza normalmente en redes locales.</td></tr><tr><td>W</td><td>WasCloned: Indica una ruta que se auto-configuró
                basándose en una ruta de red de área local con
                etiqueta Clone.</td></tr><tr><td>L</td><td>Link: Esta ruta posée referencias a hardware de
	        Ethernet.</td></tr></tbody></table></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-routing-default"></a>29.2.2. Rutas por defecto</h3></div></div></div><a id="idp81849424" class="indexterm"></a><p>Cuando el sistema local necesita realizar una conexión con
        una máquina remota se examina la tabla de rutas para determinar
	si se conoce algún camino para llegar al destino.
        Si la máquina remota pertenece a una subred que sabemos
        cómo alcanzar (rutas clonadas) entonces el sistema comprueba si
	se puede conectar utilizando dicho camino.</p><p>Si todos los caminos conocidos fallan al sistema le queda una
         única opción: la <span class="quote">&#8220;<span class="quote">ruta por defecto</span>&#8221;</span>.
         Esta ruta está constituída por un tipo especial de
         pasarela (normalmente el único <span class="quote">&#8220;<span class="quote">router</span>&#8221;</span>
	 presente en la red
         área local) y siempre posée el <span class="quote">&#8220;<span class="quote">flag</span>&#8221;</span>
         <code class="literal">c</code> en el campo de <span class="quote">&#8220;<span class="quote">flags</span>&#8221;</span>.
	 En una LAN, la pasarela es la máquina que posée
         conectividad con el resto de las redes (sea a través de un
         enlace PPP, DSL, cable modem, T1 u otra interfaz de red.)</p><p>Si se configura la ruta por defecto en una máquina que
        está actuando como pasarela hacia el mundo exterior
        la ruta por defecto será el <span class="quote">&#8220;<span class="quote">router</span>&#8221;</span>
	que se encuentre en
        posesión del proveedor de servicios de internet (ISP).</p><p>Vamos a examinar un ejemplo que utiliza rutas por defecto.
        A continuación se muestra una configuración bastante
        común:</p><div class="mediaobject"><img src="advanced-networking/net-routing.png" /></div><p>Las máquinas <code class="systemitem">Local1</code> y
	<code class="systemitem">Local2</code> se encuentran en nuestro sitio u
        organización.  <code class="systemitem">Local1</code> se conecta con un ISP
        a través de una conexión de modem PPP.
        El servidor PPP del ISP se conecta a través de una red de
        área local a otra pasarela utilizando una interfaz
        externa.</p><p>Las rutas por defecto para cada una de las máquinas son
        las siguientes:</p><div class="informaltable"><table border="0"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Host</th><th>Default Gateway</th><th>Interface</th></tr></thead><tbody><tr><td>Local2</td><td>Local1</td><td>Ethernet</td></tr><tr><td>Local1</td><td>T1-GW</td><td>PPP</td></tr></tbody></table></div><p>Una pregunta bastante frecuente es <span class="quote">&#8220;<span class="quote">?Por
         qué (o cómo) hacer que la máquina
 	 <code class="systemitem">T1-GW</code> sea el <span class="quote">&#8216;<span class="quote">router</span>&#8217;</span> por defecto para
	<code class="systemitem">Local1</code> en vez de que sea el servidor del ISP
          al cual se está conectando?</span>&#8221;</span>.</p><p>Recordemos que, como la interfaz PPP está utilizando una
        dirección de la red local del ISP en nuestro lado de la
        las rutas para cualquier otra máquina en la red local del
        proveedor se generarán de forma automática. De este
        ya sabemos el modo de alcanzar la máquina
        <code class="systemitem">T1-GW</code>, de tal forma que no se necesita un paso
        intermedio para enviar tráfico al servidor del ISP.</p><p>Es frecuente utilizar la dirección <code class="systemitem">X.X.X.1</code> como la dirección de
        la pasarela en la red local.  Siguiendo con el ejemplo anterior, si
        nuestro espacio de direccionamiento local fuera la clase C
        <code class="systemitem">10.20.30</code> y nuestro ISP estuviera
	utilizando <code class="systemitem">10.9.9</code> las rutas por
        defecto serían:</p><div class="informaltable"><table border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Host</th><th>Default Route</th></tr></thead><tbody><tr><td>Local2 (10.20.30.2)</td><td>Local1 (10.20.30.1)</td></tr><tr><td>Local1 (10.20.30.1, 10.9.9.30)</td><td>T1-GW (10.9.9.1)</td></tr></tbody></table></div><p>Se puede especificar fácilmente la entrada de la
        ruta por defecto utilizando el fichero
        <code class="filename">/etc/rc.conf</code>.  En nuestro ejemplo
        en la máquina <code class="systemitem">Local2</code>, se añadió
        la siguiente línea en dicho fichero:</p><pre class="programlisting">defaultrouter="10.20.30.1"</pre><p>También se puede hacer directamente desde la línea
        de órdenes mediante <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=route&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">route</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>route add default 10.20.30.1</code></strong></pre><p>Para obtener más información sobre la
        manipulación de tablas de rutas se ruega consultar
         la página de manual <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=route&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">route</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81887824"></a>29.2.3. Máquinas con doble pertenencia (Dual Homed Hosts)</h3></div></div></div><a id="idp81888464" class="indexterm"></a><p>Existe otro tipo de configuración que debemos describir
        y que se produce cuando una máquina se sitúa en dos
        redes distintas al mismo tiempo.  Técnicamente hablando
        cualquier máquina que actúa como pasarela (en el
        caso anterior utilizando un enlace de PPP) pertenece al tipo
        de máquinas con doble pertenencia, pero normalmente el
        término sólo se aplica para describir máquinas
        que se encuentran directamente conectadas con dos redes de área
	local.</p><p>En un caso la máquina posée dos tarjetas de red
        Ethernet, cada una de ellas con una dirección de red
        independiente.  En otro caso la máquina puede tener
        sólo una tarjeta de red, pero utilizar <span class="quote">&#8220;<span class="quote">
	aliasing</span>&#8221;</span> (<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ifconfig&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ifconfig</span>(8)</span></a>).  El primer caso se utiliza cuando
        se necesita usar dos redes Ethernet al mismo tiempo mientras que el
	segundo caso se utiliza cuando se dispone de un único segmento
        de red físico pero se han definido dos redes lógicas
        distintas</p><p>En cualquier caso la tabla de rutas se construye de tal forma
        que cada subred sepa que la máquina es la pasarela definida
        definida (<span class="quote">&#8220;<span class="quote">inbound route</span>&#8221;</span>) para la otra subred.
	Ésta configuración en la que la máquina
        actúa como <span class="quote">&#8220;<span class="quote">router</span>&#8221;</span> entre las dos subredes se
	usa a menudo
        cuando queremos implementar filtrado de paquetes o cortafuegos
	seguridad en un sentido o en ambos.</p><p>Si queremos que dicha máquina encamine paquetes entre las
        dos interfaces es necesario decirle a FreeBSD que active dicha
        funcionalidad.  En la siguiente sección se explica cómo
        hacerlo.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-dedicated-router"></a>29.2.4. Construcción de un <span class="quote">&#8220;<span class="quote">route</span>&#8221;</span></h3></div></div></div><a id="idp81918288" class="indexterm"></a><p>Un <span class="quote">&#8220;<span class="quote">router</span>&#8221;</span> de red, también llamado pasarela o
        <span class="quote">&#8220;<span class="quote">route</span>&#8221;</span>, es simplemente un sistema que reenvía
	paquetes desde un interfaz hacia otro interfaz.  Los estándares
        Internet y el sentido común aplicado a la ingeniería de
        redes impiden que FreeBSD incluya por defecto ésta
	característica. Se puede activar cambiando a
        <code class="literal">YES</code> el valor de la siguiente variable en el fichero
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">rc.conf</span>(5)</span></a>:</p><pre class="programlisting">gateway_enable=YES          # Set to YES if this host will be a gateway</pre><p>Esta opción modificará la variable de
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> <code class="varname">net.inet.ip.forwarding</code> al valor
	<code class="literal">1</code>.  Si en algún momento se necesita
        detener el <span class="quote">&#8220;<span class="quote">router</span>&#8221;</span> de forma temporal basta con
	asignar a dicha
        variable el valor <code class="literal">0</code>. Consulte <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> para
        más detalles.</p><p>Nuestro recién activado <span class="quote">&#8220;<span class="quote">router</span>&#8221;</span>
        necesita rutas para
        saber a dónde debe enviar el tráfico recibido.
        Si nuestra red es ña se pueden definir rutas estáticas.
        FreeBSD incluye por defecto el dæmon de encaminamiento BSD,
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=routed&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">routed</span>(8)</span></a>, que admite RIP (versión 1 y versión 2)
	e IRDP.  El paquete <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net/zebra/pkg-descr">net/zebra</a> le
	permitirá usar otros protocolos de encaminamiento
	dinámico como BGP v4, OSPF v2 y muchos otros.
        En caso de necesitar características avanzadas de
	gestión puede usted recurrir a productos comerciales como
        <span class="application"><span class="trademark">GateD</span>®</span>.</p><a id="idp81931728" class="indexterm"></a><a id="idp81932240" class="indexterm"></a><a id="idp81932752" class="indexterm"></a><p>Incluso cuando FreeBSD se configura del modo descrito no se
        cumple completamente con los estándares de Internet
        respecto a los <span class="quote">&#8220;<span class="quote">routers</span>&#8221;</span>.  Bastará no obstante
	para poder usarse.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81934160"></a>29.2.5. Configuración de rutas estáticas</h3></div><div><span class="authorgroup">Escrito por<span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Al</span> <span class="surname">Hoang</span></span>. </span></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81969744"></a>29.2.5.1. Configuración manual</h4></div></div></div><p>Vamos a suponer que tenemos la siguiente topología de
	  red:</p><pre class="literallayout">
    INTERNET
      | (10.0.0.1/24) Router por defecto para Internet
      |
      |Interfaz xl0
      |10.0.0.10/24
   +------+
   |      | RouterA
   |      | (pasarela FreeBSD)
   +------+
      | Interfaz xl1
      | 192.168.1.1/24
      |
  +--------------------------------+
   Red Interna 1       | 192.168.1.2/24
                       |
                   +------+
                   |      | RouterB
                   |      |
                   +------+
                       | 192.168.2.1/24
                       |
                     Red Interna 2
	</pre><p>En este escenario <code class="systemitem">RouterA</code> es nuestra
          máquina FreeBSD que actúa como pasarela para acceder al
          resto de internet.  Tiene una ruta por defecto que apunta a
	  <code class="systemitem">10.0.0.1</code> que le permite conectarse
          con el mundo exterior.  Vamos a suponer también que
          <code class="systemitem">RouterB</code> se encuentra configurado de forma adecuada
          que sabe cómo llegar a cualquier sitio que necesite.
          Esto es sencillo viendo nuestra topología de red, basta
          con añadir una ruta por defecto en la máquina
          <code class="systemitem">RouterB</code> utilizando
          <code class="systemitem">192.168.1.1</code> como
	  <span class="quote">&#8220;<span class="quote">router</span>&#8221;</span>.</p><p>Si observamos la tabla de rutas de
	  <code class="systemitem">RouterA</code> veremos algo como lo siguiente:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>netstat -nr</code></strong>
Routing tables

Internet:
Destination        Gateway            Flags    Refs      Use  Netif  Expire
default            10.0.0.1           UGS         0    49378    xl0
127.0.0.1          127.0.0.1          UH          0        6    lo0
10.0.0/24          link#1             UC          0        0    xl0
192.168.1/24       link#2             UC          0        0    xl1</pre><p>Con la tabla de rutas actual <code class="systemitem">RouterA</code>
	  no es capaz de alcanzar la red interna 2.  Esto es así
          porque no posee ninguna ruta para la red
          <code class="systemitem">192.168.2.0/24</code>.  Una forma de
          mitigar esto es añadir de forma manual la ruta que falta.  La
          siguiente orden añade la red interna 2 a la tabla  de rutas
          de la máquina <code class="systemitem">RouterA</code>
          utilizando <code class="systemitem">192.168.1.2</code> como siguiente salto:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>route add -net 192.168.2.0/24 192.168.1.2</code></strong></pre><p>Ahora <code class="systemitem">RouterA</code> puede alcanzar cualquier
          máquina en la red
	  <code class="systemitem">192.168.2.0/24</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81984976"></a>29.2.5.2. Cómo hacer la configuración persistente</h4></div></div></div><p>El ejemplo anterior es perfecto en tanto que resuelve el
          problema de encaminamiento entre redes pero existe un problema.
          La información de encaminamiento desaparecerá si se
          reinicia la máquina.  La forma de evitarlo es
          añadir las rutas estáticas a
          <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting"># Añade la red interna 2 como una ruta estática
static_routes="redinterna2"
route_internalnet2="-net 192.168.2.0/24 192.168.1.2"</pre><p>La variable de configuración
          <code class="literal">static_routes</code> es una lista de cadenas
          separadas por espacios.  Cada cadena identifica un nombre para la
          ruta que se desea definir.  En el ejemplo anterior sólamente
          se dispone de una cadena dentro de la variable
	  <code class="literal">static_routes</code>.
          Esta cadena es <em class="replaceable"><code>redinterna2</code></em>.  A
          continuación se añade otra variable de
          configuración denominada
          <code class="literal">route_redinterna2</code>
	  donde se escriben todos los parámetros de
	  configuración que normalmente utilizaríamos
          normalmente utilizaríamos con <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=route&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">route</span>(8)</span></a>.
          En el ejemplo que estamos comentando se utilizaría la
          siguiente orden:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>route add -net 192.168.2.0/24 192.168.1.2</code></strong></pre><p>De tal forma que la variable debería contener
          <code class="literal">"-net 192.168.2.0/24 192.168.1.2"</code>.</p><p>Como ya se ha comentado anteriormente podemos especificar
	  más de una cadena en la variable
	  <code class="literal">static_routes</code>.  Esto nos permite crear varias
          rutas estáticas. Las siguientes línas muestran
          un ejemplo donde se añaden rutas estáticas para las
          redes <code class="systemitem">192.168.0.0/24</code>
          y <code class="systemitem">192.168.1.0/24</code> en un
          <span class="quote">&#8220;<span class="quote">router</span>&#8221;</span>imaginario:</p><pre class="programlisting">static_routes="red1 red2"
route_red1="-net 192.168.0.0/24 192.168.0.1"
route_red2="-net 192.168.1.0/24 192.168.1.1"</pre></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81998416"></a>29.2.6. Propagación de rutas</h3></div></div></div><a id="idp81999056" class="indexterm"></a><p>Ya hemos comentado cómo se definen las rutas para
        el mundo exterior pero no hemos comentado nada sobre cómo
        haremos que el mundo exterior nos encuentre a nosotros.</p><p>También hemos aprendido que las tablas de rutas se
        pueden construír de tal forma que un grupo de tráfico
        (perteneciente a un espacio de direcciones determinado) se
        reenvíe a una máquina específica de la red,
        que se encargará de reenviar los paquetes hacia adentro.</p><p>Cuando se obtiene un espacio de direcciones para la
        organización el proveedor de servicios modifica sus tablas de
        rutas para que todo el tráfico para nuestra subred se encamine
        a través del enlace PPP hasta alcanzarnos.
        Pero ?cómo conocen las organizaciones dispersas
        a través del país que deben enviar los paquetes
        dirigidos a nosotros hacia nuestro ISP?</p><p>Existe un sistema (muy similar al sistema de nombres de
        dominio, DNS) que se encarga de controlar todos los espacios de
        direcciones que se encuentran actualmente repartidos y que
        además define sus puntos de conexión con el
        <span class="quote">&#8220;<span class="quote">backbone</span>&#8221;</span> de internet.  El <span class="quote">&#8220;<span class="quote">backbone</span>&#8221;</span>
	está formado por las principales líneas de
        de comunicacion que se encargan de transportar el tráfico de
        internet a través del país y del mundo entero.
	Cada máquina del <span class="quote">&#8220;<span class="quote">backbone</span>&#8221;</span> dispone de una copia
        de un conjunto maestro de tablas de rutas gracias a las cuales pueden
        dirigir el tráfico para una red particular hacia una
        determinada red de transporte de dicho <span class="quote">&#8220;<span class="quote">backbone</span>&#8221;</span>.
	Una vez en la red de transporte adecuada el tráfico se encamina
        a través de un número indeterminado de redes de
	proveedores de servicio hasta que se alcanza la red de destino
	final.</p><p>Una de las tareas que debe realizar el proveedor de servicio
        servicio consiste en anunciarse a las organizaciones del
        consiste en anunciarse a las organizaciones del
	<span class="quote">&#8220;<span class="quote">backbone</span>&#8221;</span> como el punto de conexión principal
        (y por tanto como el camino de entrada) para alcanzar las redes de
	sus clientes.  Este proceso se denomina propagación de
	rutas.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82003664"></a>29.2.7. Solución de problemas</h3></div></div></div><a id="idp82004304" class="indexterm"></a><p>En algunas ocasiones surgen problemas con la propagación
        de las rutas y algunas organizaciones son incapaces de conectarse con
        nuestra subred. Quizá la orden más útil para
        averiguar dónde se está interrumpiendo el sistema
        de encaminamiento sea <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=traceroute&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">traceroute</span>(8)</span></a>.  Se puede usar
        también cuando somos nosotros los que no podemos alcanzar
        alguna red externa (por ejemplo cuando <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ping&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ping</span>(8)</span></a> falla).</p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=traceroute&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">traceroute</span>(8)</span></a> se ejecuta pasandole como parámetro el
        nombre de la máquina remota a la que nos queremos
        conectar.  Esta orden muestra por pantalla lás máquinas
        que actúan de pasarela a lo largo del camino.  El proceso
        termina bien porque se alcanza el destino o bien porque algún
        <span class="quote">&#8220;<span class="quote">router</span>&#8221;</span> intermedio no puede conectarse con el siguiente
        salto, o lo desconoce.</p><p>Si quiere saber más sobre esto consulte la página
        man de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=traceroute&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">traceroute</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82009808"></a>29.2.8. Rutas multicast</h3></div></div></div><a id="idp82010448" class="indexterm"></a><p>FreeBSD soporta tanto aplicaciones multicast como encaminamiento
        multicast de forma nativa.  Las aplicaciones multicast no necesitan
        ninguna configuración especial en FreeBSD;  estas aplicaciones
        se ejecutan tal cual.  El encaminamiento multicast necesita para
	ser usado que se compile dicho soporte en el núcleo de
	FreeBSD:</p><pre class="programlisting">options MROUTING</pre><p>Se debe configurar además  el dæmon de
        encaminamiento multicast,  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mrouted&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mrouted</span>(8)</span></a>, para establecer
	túneles y ejecutar DVMRP utilizando
	<code class="filename">/etc/mrouted.conf</code>.  Se pueden encontrar
        más detalles sobre cómo realizar una
        configuración de multicast en <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mrouted&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mrouted</span>(8)</span></a>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="advanced-networking.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="network-wireless.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">Capítulo 29. Networking avanzado </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 29.3. Redes sin cables (<span class="quote">&#8220;<span class="quote">wireless</span>&#8221;</span>)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>