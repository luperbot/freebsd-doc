<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>18.11. Bases para respaldos</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="disks.html" title="Capítulo 18. Almacenamiento" /><link rel="prev" href="backups-floppybackups.html" title="18.10. Respaldos en disquetes" /><link rel="next" href="disks-virtual.html" title="18.12. Sistemas de ficheros en red, memoria y respaldados en fichero" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">18.11. Bases para respaldos</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="backups-floppybackups.html">Anterior</a> </td><th width="60%" align="center">Capítulo 18. Almacenamiento</th><td width="20%" align="right"> <a accesskey="n" href="disks-virtual.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="backup-basics"></a>18.11. Bases para respaldos</h2></div></div></div><p>Los tres principales programas para respaldos son
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tar&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a> y <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cpio&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cpio</span>(1)</span></a>.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77939152"></a>18.11.1. Dump y Restore</h3></div></div></div><a id="idp77939792" class="indexterm"></a><a id="idp77940944" class="indexterm"></a><a id="idp77941584" class="indexterm"></a><p>Los programas <span class="trademark">UNIX</span>® que se han usado durante muchos
        años para hacer copias de seguridad son
        <code class="command">dump</code> y <code class="command">restore</code>.
        Operan en las unidades como una colección de bloques de
        disco, bajo la abstracción de ficheros, los enlaces y
        directorios creados por el sistema de ficheros.
        <code class="command">dump</code> respalda un sistema de ficheros completo
        en un dispositivo.  No es capaz de respaldar solamente parte
        de un sistema de ficheros o un árbol de directorios
        que se extienda por más de un sistema de ficheros.
        <code class="command">dump</code> no escribe ficheros y directorios a
        cinta, escribe los bloques de datos <span class="quote">&#8220;<span class="quote">crudos</span>&#8221;</span> (raw)
        que conforman los ficheros y directorios.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si utiliza <code class="command">dump</code> en su directorio
        raíz, no respaldará
        <code class="filename">/home</code>, <code class="filename">/usr</code> ni
        muchos otros directorios, ya que suelen ser puntos de montaje
        de otros sistemas de ficheros o enlaces simbólicos hacia
        dichos sistemas de ficheros.</p></div><p><code class="command">dump</code> tiene peculiaridades que se mantienen
        desde sus primeros días en la Version 6 de AT&amp;T UNIX
        (alrededor de 1975).  Los parámetros por defecto
        son los adecuados para cintas de 9 pistas (6250 bpi), pero no para
        los medios de alta densidad disponibles hoy en día
        (hasta 62,182 ftpi).  Estos valores por defecto deben
        obviarse en la línea de comandos para aprovechar la
        capacidad de las unidades de cinta actuales.</p><a id="idp77947600" class="indexterm"></a><p>También es posible respaldar datos a través de
        la red a una unidad de cinta conectada a otra computadora con
        <code class="command">rdump</code> y <code class="command">rrestore</code>.  Ambos
        programas dependen de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rcmd&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">rcmd</span>(3)</span></a> y <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ruserok&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">ruserok</span>(3)</span></a> para
        acceder a la unidad de cinta remota.  Por consiguiente, el usuario
        que realiza el respaldo debe estar listado en el fichero
        <code class="filename">.rhosts</code> de la computadora remota.  Los
        argumentos para <code class="command">rdump</code> y <code class="command">rrestore</code>
        deben ser adecuados para usarse en la computadora remota.
        Cuando realice un <code class="command">rdump</code> desde FreeBSD
        a una unidad de cinta Exabyte conectada a una Sun llamada
        <code class="systemitem">komodo</code>, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/sbin/rdump 0dsbfu 54000 13000 126 komodo:/dev/nsa8 /dev/da0a 2&gt;&amp;1</code></strong></pre><p>Advertencia: existen implicaciones de seguridad al
        permitir autentificación mediante
        <code class="filename">.rhosts</code>.  Le recomendamos que
        evalúe la situación cuidadosamente.</p><p>También es posible usar <code class="command">dump</code> y
        <code class="command">restore</code> de una forma más segura
        a través de <code class="command">ssh</code>.</p><div class="example"><a id="idp77960272"></a><div class="example-title">Ejemplo 18.1. Utilizando <code class="command">dump</code> a través de
          <span class="application">ssh</span></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/sbin/dump -0uan -f - /usr | gzip -2 | ssh -c blowfish \
          usuario@maquinaobjetivo.ejemplo.com dd of=/misficherosgrandes/dump-usr-l0.gz</code></strong></pre></div></div><br class="example-break" /><p>Uso del método integrado de <code class="command">dump</code>,
        configurando la variable de ambiente <code class="envar">RSH</code>:</p><div class="example"><a id="idp77963856"></a><div class="example-title">Ejemplo 18.2. Uso de <code class="command">dump</code> a través de
           <span class="application">ssh</span> con <code class="envar">RSH</code>
           configurada</div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>RSH=/usr/bin/ssh /sbin/dump -0uan -f usuario@maquinaobjetivo.ejemplo.com:/dev/sa0 /usr</code></strong></pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77966800"></a>18.11.2. <code class="command">tar</code></h3></div></div></div><a id="idp77967568" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tar&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a> también es de la época de
        la Version 6 de AT&amp;T UNIX (alrededor de 1975).
        <code class="command">tar</code> trabaja en cooperación con el
        sistema de ficheros; escribe ficheros y directorios a
        cinta.  <code class="command">tar</code> no soporta el rango completo
        de opciones que ofrece <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cpio&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cpio</span>(1)</span></a>, pero no requiere el
        inusual comando de pipeline que utiliza
        <code class="command">cpio</code>.</p><a id="idp77971792" class="indexterm"></a><p>En FreeBSD 5.3 y posteriores, tiene a su disposición
        GNU <code class="command">tar</code>
        y el comando por defecto <code class="command">bsdtar</code>.
        La versión GNU puede ser invocada mediante
        <code class="command">gtar</code>.  Soporta dispositivos remotos mediante
        la misma sintaxis que <code class="command">rdump</code>.  Para hacer un
        <code class="command">tar</code> a una unidad de cinta conectada a una
        Sun llamada <code class="systemitem">komodo</code>, use:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/usr/bin/gtar cf komodo:/dev/nsa8 . 2&gt;&amp;1</code></strong></pre><p>Puede hacer lo mismo con o con
        <code class="command">bsdtar</code> usando un <span class="quote">&#8220;<span class="quote">pipe</span>&#8221;</span> y
        <code class="command">rsh</code> para mandar los datos a una unidad
        de cinta remota.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>tar cf - . | rsh nombredemaquina dd of=dispositivo-de-cinta obs=20b</code></strong></pre><p>Si le preocupa la seguridad del proceso de hacer un
        respaldo a través de una red debe usar
        <code class="command">ssh</code> en lugar de <code class="command">rsh</code>.
        </p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp77988176"></a>18.11.3. <code class="command">cpio</code></h3></div></div></div><a id="idp77993168" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cpio&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cpio</span>(1)</span></a> es el programa de intercambio de archivos de
        cinta para medios magnéticos.  <code class="command">cpio</code>
        tiene opciones (entre muchas otras) para realizar intercambio de
        bytes, escribir un número diferente de formatos de
        archivo y hacer <span class="quote">&#8220;<span class="quote">pipe</span>&#8221;</span> de datos hacia otros programas.
        Esta última opción hace de <code class="command">cpio</code>
        una elección excelente para medios de instalación.
        <code class="command">cpio</code> no sabe cómo recorrer el árbol
        de directorios, así que debe facilitarle una lista de
        directorios a través de
        <code class="filename">stdin</code>.</p><a id="idp77997392" class="indexterm"></a><p><code class="command">cpio</code> no permite respaldos a través
        de la red.  Puede usar un pipe y <code class="command">rsh</code>
        para mandar los datos a una unidad de cinta remota.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>for f in lista_directorios; do</code></strong>
<strong class="userinput"><code>find $f &lt;&lt; backup.list</code></strong>
<strong class="userinput"><code>done</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cpio -v -o --format=newc &lt; backup.list | ssh usuario@máquina "cat &gt; dispositivo_de_respaldo"</code></strong></pre><p>Donde <em class="replaceable"><code>lista_directorios</code></em> es la lista de
        directorios que desea respaldar,
        <em class="replaceable"><code>usuario</code></em>@<em class="replaceable"><code>máquina</code></em>
        es la combinación  usuario/nombre de equipo que realizará
        el respaldo y <em class="replaceable"><code>dispositivo_de_respaldo</code></em>
        es donde el respaldo se escribirá efectivamente (por ejemplo
        <code class="filename">/dev/nsa0</code>).</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78028624"></a>18.11.4. <code class="command">pax</code></h3></div></div></div><a id="idp78029392" class="indexterm"></a><a id="idp78030672" class="indexterm"></a><a id="idp78031312" class="indexterm"></a><a id="idp78031824" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pax&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">pax</span>(1)</span></a> es la respuesta IEEE/<span class="trademark">POSIX</span>® a
        <code class="command">tar</code> y <code class="command">cpio</code>.
        A través de los años las diversas versiones
        de <code class="command">tar</code> y <code class="command">cpio</code> se han
        vuelto ligeramente incompatibles, así que en lugar
        de pelear por hacerlo completamente estándar,
        <span class="trademark">POSIX</span>® creó una nueva utilidad de archivado.
        <code class="command">pax</code> trata de leer y escribir muchos de
        los diversos formatos de <code class="command">cpio</code> y
        <code class="command">tar</code>, además de nuevos formatos
        propios.  Su conjunto de comandos se parece más a
        <code class="command">cpio</code> que a
	<code class="command">tar</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="backups-programs-amanda"></a>18.11.5. <span class="application">Amanda</span></h3></div></div></div><a id="idp78038992" class="indexterm"></a><a id="idp78040272" class="indexterm"></a><p><span class="application">Amanda</span> (Advanced Maryland
        Network Disk Archiver) es un sistema de respaldos cliente/servidor,
        en lugar de un solo programa.  Un servidor
        <span class="application">Amanda</span>
        respaldará a una sola unidad de cinta cualquier cantidad de
        computadoras que tengan clientes <span class="application">Amanda</span>
        y una conexión de red al servidor
        <span class="application">Amanda</span>.
        Un problema común en sitios con gran cantidad de discos
        grandes es que la cantidad de tiempo requerida para respaldar los
        datos directamente a cinta excede la cantidad de tiempo disponible
        para la tarea.  <span class="application">Amanda</span> resuelve este
        problema.  <span class="application">Amanda</span> puede usar un
        <span class="quote">&#8220;<span class="quote">disco intermedio</span>&#8221;</span> para respaldar varios sistemas de
        ficheros al mismo tiempo.
        <span class="application">Amanda</span> crea
        <span class="quote">&#8220;<span class="quote">conjuntos de archivo</span>&#8221;</span>, esto es, un grupo de cintas
        usadas durante un periodo de tiempo para crear respaldos completos
        de todos los sistemas de ficheros listados en el fichero de
        configuración de <span class="application">Amanda</span>.
        El <span class="quote">&#8220;<span class="quote">conjunto de archivo</span>&#8221;</span> también contiene
        respaldos incrementales nocturnos (o diferenciales) de todos los
        sistemas de ficheros.  Para restaurar un sistema de ficheros
        dañado hace falta el respaldo completo más reciente
        y los respaldos incrementales.</p><p>El fichero de configuración ofrece un control
       exhaustivo de los respaldos y del tráfico de red que
       <span class="application">Amanda</span> genera.
       <span class="application">Amanda</span> usará cualquiera de
       los programas de respaldo mencionados arriba para escribir los
       datos a cinta.  Puede instalar <span class="application">Amanda</span>
       como paquete y como port.  No forma parte del sistema base.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78051536"></a>18.11.6. No hacer nada</h3></div></div></div><p><span class="quote">&#8220;<span class="quote">No hacer nada</span>&#8221;</span> no es un programa, pero
        es la estrategia de respaldo más extendida.  No tiene
        coste.  No hay un calendario de respaldos a seguir.  Simplemente
        hay que decir <span class="emphasis"><em>que no</em></span>.  Si algo le sucediera a
        sus datos <span class="emphasis"><em>sonría y acostúmbrese a su nueva
        situación</em></span>.</p><p>Si su tiempo y sus datos valen poco o nada, entonces
        <span class="quote">&#8220;<span class="quote">no hacer nada</span>&#8221;</span> es el programa de respaldo más
        adecuado para usted.  Pero cuidado, <span class="trademark">UNIX</span>® es una herramienta
        muy poderosa y puede suceder que dentro de seis meses
        tenga un montón de ficheros que sean valiosos para
        usted.</p><p><span class="quote">&#8220;<span class="quote">No hacer nada</span>&#8221;</span> es el método correcto de
        respaldo para <code class="filename">/usr/obj</code> y otros árboles
        de directorios que pueden ser fácilmente recreados por su
        computadora.  Un ejemplo son los archivos que forman la
        versión HTML o <span class="trademark">PostScript</span>® de este manual.
        Estos documentos han sido generados desde ficheros SGML.
        Crear respaldos de los archivos HTML o <span class="trademark">PostScript</span>® no es
        necesario dado que los ficheros SGML se respaldan regularmente.
        </p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78061264"></a>18.11.7. ?Cuál es el mejor programa de respaldos?</h3></div></div></div><a id="idp78061904" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a>.
        <span class="emphasis"><em>Y no hay más que hablar.</em></span>
        Elizabeth D. Zwicky realizó pruebas de estrés a
        a todos los programas de copia de seguridad aquí
        expuestos.  La elección clarísima para preservar
        todos sus datos y todas las peculiaridades de sus sistemas de
        ficheros <span class="trademark">UNIX</span>® es <code class="command">dump</code>.
        Elizabeth creó sistemas de ficheros conteniendo una gran
        variedad de condiciones inusuales (y algunos no tan inusuales)
        y probó cada programa haciendo un respaldo y restaurando
        esos sistemas de ficheros.  Esas peculiaridades incluían:
        ficheros con y un bloque nulo, ficheros con caracteres
        extraños en sus nombres, ficheros que no se podían
        leer ni escribir, dispositivos, ficheros que cambiaban de
        tamaño durante el respaldo, ficheros que eran creados/borrados
        durante el respaldo y cosas así.  Elizabeth presentó los
        resultados en LISA V en octubre de 1991.
        Consulte <a class="link" href="http://berdmann.dyndns.org/zwicky/testdump.doc.html" target="_top">torture-testing
        Backup and Archive Programs</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78065616"></a>18.11.8. Procedimiento de restauración de emergencia</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78074576"></a>18.11.8.1. Antes del desastre</h4></div></div></div><p>Solamente existen cuatro pasos que debe realizar
          en preparación de cualquier desastre que pudiera
          ocurrir.</p><a id="idp78075600" class="indexterm"></a><p>Primero, imprima la etiqueta de disco de cada uno
          de sus discos (<code class="command">disklabel da0 | lpr</code>),
          su tabla de sistemas de ficheros
          (<code class="filename">/etc/fstab</code>) y todos los mensajes de
          arranque, dos copias de cada uno.</p><a id="idp78077648" class="indexterm"></a><p>Segundo, asegúrese que los disquetes de rescate
          (<code class="filename">boot.flp</code> y <code class="filename">fixit.flp</code>)
          tienen todos sus dispositivos.  La manera más fácil
          de revisarlo es reiniciar su máquina con el disquete
          en la unidad y revisar los mensajes de arranque.  Si todos sus
          dispositivos aparecen en la lista y funcionan, pase al tercer
          paso.</p><p>Si ha habido algún problema tiene que crear dos
          disquetes de arranque personalizados, que deben tener un
          kernel que pueda montar todos sus discos y acceder a su
          unidad de cinta.  Estos discos deben contener:
          <code class="command">fdisk</code>, <code class="command">disklabel</code>,
          <code class="command">newfs</code>, <code class="command">mount</code> y
          cualquier programa de respaldo que utilice.  Estos
          programas deben estar enlazados estáticamente.  Si
          usa <code class="command">dump</code>, el disquete debe
          contener <code class="command">restore</code>.</p><p>Tercero, use cintas de respaldo regularmente.  Cualquier
          cambio que haga después de su último respaldo puede
          perderse irremediablemente.  Proteja contra escritura las cintas
          de respaldo.</p><p>Cuarto, pruebe los disquetes (ya sea <code class="filename">boot.flp</code>
          y <code class="filename">fixit.flp</code> o los dos discos personalizados
          que creó en el segundo paso) y las cintas de respaldo.
          Documente el procedimiento.  Almacene estas notas con los
          discos de arranque, las impresiones y las cintas de respaldo.
          Estará tan perturbado cuando restaure su sistema  que las
          notas pueden pueden evitar que destruya sus cintas de respaldo.
          (?Como? en lugar de <code class="command">tar xvf /dev/sa0</code>,
          puede teclear accidentalmente <code class="command">tar cvf /dev/sa0</code>
          y sobreescribir su cinta).</p><p>Como medida adicional de seguridad haga discos de inicio
          y dos cintas de respaldo cada vez.  Almacene una de cada
          en una ubicación remota.  Una ubicación remota
          <span class="emphasis"><em>NO</em></span> es el sótano del mismo edificio.
          Muchas firmas alojadas en el World Trade Center aprendieron esta
          leccón de la manera más difícil.  Esa
          ubicación remota debe estar separada físicamente
          de sus computadoras y unidades de disco por una distancia
          significativa.</p><div class="example"><a id="idp78085328"></a><div class="example-title">Ejemplo 18.3. Un <span class="quote">&#8220;<span class="quote">script</span>&#8221;</span> para la creación de discos
            flexibles de arranque</div><div class="example-contents"><pre class="programlisting">#!/bin/sh
#
# create a restore floppy
#
# format the floppy
#
PATH=/bin:/sbin:/usr/sbin:/usr/bin

fdformat -q fd0
if [ $? -ne 0 ]
then
	 echo "Bad floppy, please use a new one"
	 exit 1
fi

# place boot blocks on the floppy
#
disklabel -w -B /dev/fd0c fd1440

#
# newfs the one and only partition
#
newfs -t 2 -u 18 -l 1 -c 40 -i 5120 -m 5 -o space /dev/fd0a

#
# mount the new floppy
#
mount /dev/fd0a /mnt

#
# create required directories
#
mkdir /mnt/dev
mkdir /mnt/bin
mkdir /mnt/sbin
mkdir /mnt/etc
mkdir /mnt/root
mkdir /mnt/mnt			# for the root partition
mkdir /mnt/tmp
mkdir /mnt/var

#
# populate the directories
#
if [ ! -x /sys/compile/MINI/kernel ]
then
	 cat &amp;lt;&amp;lt; EOM
The MINI kernel does not exist, please create one.
Here is an example config file:
#
# MINI - A kernel to get FreeBSD onto a disk.
#
machine         "i386"
cpu             "I486_CPU"
ident           MINI
maxusers        5

options         INET                    # needed for _tcp _icmpstat _ipstat
                                        #            _udpstat _tcpstat _udb
options         FFS                     #Berkeley Fast File System
options         FAT_CURSOR              #block cursor in syscons or pccons
options         SCSI_DELAY=15           #Be pessimistic about Joe SCSI device
options         NCONS=2                 #1 virtual consoles
options         USERCONFIG              #Allow user configuration with -c XXX

config          kernel	root on da0 swap on da0 and da1 dumps on da0

device          isa0
device          pci0

device          fdc0	at isa? port "IO_FD1" bio irq 6 drq 2 vector fdintr
device          fd0	at fdc0 drive 0

device          ncr0

device          scbus0

device          sc0	at isa? port "IO_KBD" tty irq 1 vector scintr
device          npx0	at isa? port "IO_NPX" irq 13 vector npxintr

device          da0
device          da1
device          da2

device          sa0

pseudo-device   loop            # required by INET
pseudo-device   gzip            # Exec gzipped a.out's
EOM
	 exit 1
fi

cp -f /sys/compile/MINI/kernel /mnt

gzip -c -best /sbin/init &gt; /mnt/sbin/init
gzip -c -best /sbin/fsck &gt; /mnt/sbin/fsck
gzip -c -best /sbin/mount &gt; /mnt/sbin/mount
gzip -c -best /sbin/halt &gt; /mnt/sbin/halt
gzip -c -best /sbin/restore &gt; /mnt/sbin/restore

gzip -c -best /bin/sh &gt; /mnt/bin/sh
gzip -c -best /bin/sync &gt; /mnt/bin/sync

cp /root/.profile /mnt/root

cp -f /dev/MAKEDEV /mnt/dev
chmod 755 /mnt/dev/MAKEDEV

chmod 500 /mnt/sbin/init
chmod 555 /mnt/sbin/fsck /mnt/sbin/mount /mnt/sbin/halt
chmod 555 /mnt/bin/sh /mnt/bin/sync
chmod 6555 /mnt/sbin/restore

#
# create the devices nodes
#
cd /mnt/dev
./MAKEDEV std
./MAKEDEV da0
./MAKEDEV da1
./MAKEDEV da2
./MAKEDEV sa0
./MAKEDEV pty0
cd /

#
# create minimum file system table
#
cat &gt; /mnt/etc/fstab &amp;lt;&amp;lt;EOM
/dev/fd0a    /    ufs    rw  1  1
EOM

#
# create minimum passwd file
#
cat &gt; /mnt/etc/passwd &amp;lt;&amp;lt;EOM
root:*:0:0:Charlie &amp;amp;:/root:/bin/sh
EOM

cat &gt; /mnt/etc/master.passwd &amp;lt;&amp;lt;EOM
root::0:0::0:0:Charlie &amp;amp;:/root:/bin/sh
EOM

chmod 600 /mnt/etc/master.passwd
chmod 644 /mnt/etc/passwd
/usr/sbin/pwd_mkdb -d/mnt/etc /mnt/etc/master.passwd

#
# umount the floppy and inform the user
#
/sbin/umount /mnt
echo "The floppy has been unmounted and is now ready."</pre></div></div><br class="example-break" /></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78087120"></a>18.11.8.2. Después del desastre</h4></div></div></div><p>La pregunta clave es: ?sobrevivió su hardware?
          Ha estado haciendo respaldos regularmente, así que no hay
          necesidad de preocuparse por el software.</p><p>Si el hardware ha sufrido daños los componentes deben
          reemplazarse antes de intentar de usar su sistema.</p><p>Si su hardware está bien revise sus discos de arranque.
          Si usa disquetes de arranque personalizados arranque en modo
          monousuario (teclée <code class="literal">-s</code> en el
          en el <span class="quote">&#8220;<span class="quote">prompt</span>&#8221;</span> de arranque <code class="prompt">boot:</code>).
          Sáltese el siguiente párrafo.</p><p>Si utiliza usando los discos <code class="filename">boot.flp</code>
          y <code class="filename">fixit.flp</code>, siga leyendo.  Inserte el disco
          <code class="filename">boot.flp</code> en la primera unidad de disquete
          y arranque la máquina.  El menú de instalación
          original se desplegará en pantalla.  Seleccione la
          opción <code class="literal">Fixit--Repair mode with CDROM or
          floppy.</code>.  Inserte el disco <code class="filename">fixit.flp</code>
          cuando se le pida.  Tanto <code class="command">restore</code> como los
          demás programas que necesitará están en
          <code class="filename">/mnt2/rescue</code>
          (<code class="filename">/mnt2/stand</code> para versiones
          de FreeBSD anteriores a 5.2).</p><p>Recupere cada sistema de ficheros por separado.</p><a id="idp78098128" class="indexterm"></a><a id="idp78099024" class="indexterm"></a><a id="idp78099536" class="indexterm"></a><a id="idp78100432" class="indexterm"></a><p>Trate de montar (por ejemplo
          <code class="command">mount /dev/da0a /mnt</code>) la partición
          raíz de su primer disco.  Si la etiqueta del disco
          ha sufrido daños use <code class="command">disklabel</code>
          para reparticionar y etiquetar el disco de forma que coincida con
          la etiqueta que imprimió y guardó previamente.   Use
          <code class="command">newfs</code> para crear de nuevo sus sistemas de
          ficheros.  Monte de nuevo la partición raíz del
          disquete en modo lectura/escritura
          (<code class="command">mount -u -o rw /mnt</code>).  Ejecute su programa de
          respaldo y utilice las cintas de respaldo para restaurar sus datos
          en este sistema de ficheros
          (<code class="command">restore vrf /dev/sa0</code>).
          Desmonte el sistema de ficheros (<code class="command">umount /mnt</code>).
          Repita el proceso con cada sistema de ficheros que sufrió
          daños.</p><p>Una vez que su sistema esté en marcha respalde sus
          datos en cintas nuevas.  Cualquiera que haya sido la causa de
          la caída o pérdida de datos puede suceder de nuevo.
          Una hora más que gaste ahora puede ahorrarle mucho
          sufrimiento más adelante.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="backups-floppybackups.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="disks-virtual.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">18.10. Respaldos en disquetes </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 18.12. Sistemas de ficheros en red, memoria y respaldados en fichero</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>