<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>14.8. Kerberos5</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="security.html" title="Capítulo 14. Seguridad" /><link rel="prev" href="kerberosIV.html" title="14.7. KerberosIV" /><link rel="next" href="openssl.html" title="14.9. OpenSSL" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.8. <span class="application">Kerberos5</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kerberosIV.html">Anterior</a> </td><th width="60%" align="center">Capítulo 14. Seguridad</th><td width="20%" align="right"> <a accesskey="n" href="openssl.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="kerberos5"></a>14.8. <span class="application">Kerberos5</span></h2></div><div><span class="authorgroup">Texto de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tillman</span> <span class="surname">Hodgson</span></span>. </span></div><div><span class="authorgroup">Basado en un texto de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Mark</span> <span class="surname">Murray</span></span>. </span></div></div></div><p>Cada versión de FreeBSD posterior a FreeBSD-5.1 incluye
      soporte solamente para <span class="application">Kerberos5</span>.
      Por esta razón <span class="application">Kerberos5</span> es
      la única versión incluida.  Su configuración
      es similar en muchos aspectos a la de
      <span class="application">KerberosIV</span>.
      La siguiente información solo atañe a
      <span class="application">Kerberos5</span> en versiones de
      FreeBSD-5.0 o posteriores.  Los usuarios que deséen
      utilizar <span class="application">KerberosIV</span> pueden
      instalar el port
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/krb4/pkg-descr">security/krb4</a>.</p><p><span class="application">Kerberos</span> es un sistema/protocolo
      agregado para red que permite a los usuarios validar su identidad
      a través de los servicios de un servidor seguro.
      Los servicios como login remoto, copia remota, copias
      de fichero de un sistema a otro y otras tareas generalmente
      consideradas poco seguras pasan a ser considerablemente
      seguras y más controlables.</p><p><span class="application">Kerberos</span> puede describirse como
      un sistema proxy identificador/verificador.  También
      puede describirse como un sistema confiable de autentificación
      de terceros.
      <span class="application">Kerberos</span> solamente ofrece una
      función: la validación segura de usuarios a
      través de una red.  No proporciona funciones de
      autorización (es decir, lo que los usuarios tienen
      permitido hacer) o funciones de auditoría (lo que esos
      usuarios hicieron).  Después de que un servidor y un
      cliente han usado <span class="application">Kerberos</span> para
      demostrar su identidad pueden también cifrar todas sus
      sus comunicaciones, asegurando de este modo su intimidad y la
      integridad de sus datos durante su uso del sistema.</p><p>Es, por tanto, altamente recomendable que se use
      <span class="application">Kerberos</span>
      <span class="emphasis"><em>además</em></span> de otros métodos de
      seguridad que ofrezcan servicios de autorización
      y auditoría.</p><p>Puede usar las siguientes instrucciones como una guía
      para configurar <span class="application">Kerberos</span> tal y como se
      distribuye en FreeBSD.  De todas maneras, debería consultar
      las páginas de manual adecuadas para tener toda la
      información.</p><p>Vamos a mostrar una instalación
      <span class="application">Kerberos</span>, para lo cual usaremos
      los siguientes espacios de nombres:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>El dominio <acronym class="acronym">DNS</acronym> (<span class="quote">&#8220;<span class="quote">zona</span>&#8221;</span>)
          será ejemplo.org.</p></li><li class="listitem"><p>El dominio <span class="application">Kerberos</span> (realm)
          será EJEMPLO.ORG.</p></li></ul></div><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Debe utilizar nombres de dominio reales al
        configurar <span class="application">Kerberos</span> incluso si
        pretende ejecutarlo internamente. Esto le evitará problemas
        de <acronym class="acronym">DNS</acronym> y asegura la interoperación
        con otros dominios <span class="application">Kerberos</span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75722192"></a>14.8.1. Historia</h3></div></div></div><a id="idp75722832" class="indexterm"></a><p><span class="application">Kerberos</span> fué creado
        en el Massachusetts Institute of Technology
	(<acronym class="acronym">MIT</acronym>) como una solución
        a los problemas de seguridad de la red.
        El protocolo <span class="application">Kerberos</span> utiliza
        criptografía fuerte para que un cliente pueda
        demostrar su identidad en un servidor (y viceversa) a
        través de una conexión de red insegura.</p><p><span class="application">Kerberos</span> es el nombre de un
        protocolo de autentificación vía red y un adjetivo
        para describir programas que implementan el programa
        (<span class="application">Kerberos</span> telnet, por ejemplo,
	conocido también como el
	<span class="quote">&#8220;<span class="quote">telnet kerberizado</span>&#8221;</span>).
        La versión actual del protocolo es la 5, descrita en
        <acronym class="acronym">RFC</acronym> 1510.</p><p>Existen diversas implementaciones libres de este protocolo,
        cubriendo un amplio rango de sistemas operativos.
        El <acronym class="acronym">MIT</acronym>, donde <span class="application">Kerberos</span>
        fué desarrollado, continúa desarrollando su
        propio paquete <span class="application">Kerberos</span>.
	Suele usarse en los EEUU como producto criptográfico
        y como tal ha sufrido las regulaciones de exportación
	de los EEUU.  El
        <span class="application">Kerberos</span> del <acronym class="acronym">MIT</acronym>
        existe como un port en
        (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/krb5/pkg-descr">security/krb5</a>).  Heimdal
        <span class="application">Kerberos</span> es otra implementación
        de la versión 5, y fué desarrollada de forma
        intencionada fuera de los <acronym class="acronym">EEUU</acronym> para sortear las
        regulaciones de exportación (y por eso puede incluirse
        en versiones no comerciales de <span class="trademark">UNIX</span>®).  La distribución
        Heimdal <span class="application">Kerberos</span> está en el
        port (<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/heimdal/pkg-descr">security/heimdal</a>), y
        se incluye una instalación mínima en el sistema
        base de FreeBSD.</p><p>Para alcanzar la mayor audiencia estas instrucciones asumen
      el uso de la distribución Heimdal incluída en FreeBSD.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75740752"></a>14.8.2. Configuración de un <acronym class="acronym">KDC</acronym> Heimdal</h3></div></div></div><a id="idp75741776" class="indexterm"></a><p>El centro de distribución de llaves (<acronym class="acronym">KDC</acronym>,
        Key Distribution Center) es el servicio centralizado de
	validación que proporciona
        <span class="application">Kerberos</span>: es el sistema que emite
        tickets <span class="application">Kerberos</span>.
        El <acronym class="acronym">KDC</acronym> goza del estátus de ser
	considerado como <span class="quote">&#8220;<span class="quote">confiable</span>&#8221;</span> por las demás
        computadoras del dominio <span class="application">Kerberos</span>,
        y por eso tiene consideraciones de seguridad más
	elevadas.</p><p>Tenga en cuenta que, aunque la ejecución del servidor
      <span class="application">Kerberos</span> requiere muy pocos recursos,
      se recomienda el uso de una máquina dedicada a
      <acronym class="acronym">KDC</acronym> por razones de seguridad.</p><p>Para empezar a configurar un <acronym class="acronym">KDC</acronym> asegúrese
      de que su <code class="filename">/etc/rc.conf</code> contenga la
      configuración adecuada para actuar como <acronym class="acronym">KDC</acronym>
      (tal vez deba ajustar algunas rutas para que cuadren con su
      sistema):</p><pre class="programlisting">kerberos5_server_enable="YES"
kadmind5_server_enable="YES"
kerberos_stash="YES"</pre><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="option">kerberos_stash</code> solo existe en
          FreeBSD 4.X.</p></div><p>A continuación configuraremos el fichero de
        configuración de <span class="application">Kerberos</span>,
        <code class="filename">/etc/krb5.conf</code>:</p><pre class="programlisting">[libdefaults]
    default_realm = EJEMPLO.ORG [realms]
    EXAMPLE.ORG = {
        kdc = kerberos.ejemplo.org
        admin_server = kerberos.ejemplo.org
    }
[domain_realm]
    .ejemplo.org = EJEMPLO.ORG</pre><p>Tenga en cuenta que este <code class="filename">/etc/krb5.conf</code>
        implica que su <acronym class="acronym">KDC</acronym> tendrá el nombre
        de equipo completo calificado de
	<code class="systemitem">kerberos.ejemplo.org</code>.
        Necesitará añadir una entrada CNAME (alias) a su
        fichero de zona si su <acronym class="acronym">KDC</acronym> tiene un
        nombre de equipo diferente.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">En grandes redes con un servidor <acronym class="acronym">DNS</acronym>
          <acronym class="acronym">BIND</acronym> bien configurado, el ejemplo
          de arriba puede quedar del siguiente modo:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">[libdefaults]
      default_realm = EJEMPLO.ORG</pre><p xmlns="http://www.w3.org/1999/xhtml">Con las siguientes líneas agregadas al
          fichero de zona <code class="systemitem">ejemplo.org</code>:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting">_kerberos._udp      IN  SRV     01 00 88 kerberos.ejemplo.org.
_kerberos._tcp      IN  SRV     01 00 88 kerberos.ejemplo.org.
_kpasswd._udp       IN  SRV     01 00 464 kerberos.ejemplo.org.
_kerberos-adm._tcp  IN  SRV     01 00 749 kerberos.ejemplo.org.
_kerberos           IN  TXT     EJEMPLO.ORG</pre></div><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Para que los clientes sean capaces de encontrar los
          servicios <span class="application">Kerberos</span>
          <span class="emphasis"><em>debe</em></span> tener ya sea un
          <code class="filename">/etc/krb5.conf</code> configurado o
          un <code class="filename">/etc/krb5.conf</code> configurado de forma
          mínima <span class="emphasis"><em>y</em></span> un servidor DNS
          configurado correctamente.</p></div><p>A continuación crearemos la base de datos
        <span class="application">Kerberos</span>.  Esta base de datos contiene
        las llaves de todos los principales cifradas con una
        contraseña maestra.  No es necesario que recuerde
        esta contraseña, pues se almacenará en
        <code class="filename">/var/heimdal/m-key</code>.  Para crear la llave
        maestra ejecute <code class="command">kstash</code> e introduzca una
        contraseña.</p><p>Una vez que se ha creado la llave maestra puede inicializar
        la base de datos usando el programa <code class="command">kadmin</code>
        con la opción <code class="literal">-l</code> (que significa
        <span class="quote">&#8220;<span class="quote">local</span>&#8221;</span>).  Esta opción le dice a
        <code class="command">kadmin</code> que modifique los ficheros de la base
        de datos directamente en lugar de ir a través del servicio
        de red <code class="command">kadmind</code>.  Esto gestiona el problema del
        huevo y la gallina de tratar de conectar a la base de datos
        antes de que ésta exista.  Una vez que tiene el
	<span class="quote">&#8220;<span class="quote">prompt</span>&#8221;</span> de <code class="command">kadmin</code>, utilice
        <code class="command">init</code> para crear su base de datos de
        dominios iniciales.</p><p>Para terminar, mientras está todavía en
        <code class="command">kadmin</code> puede crear su primer principal
        mediante <code class="command">add</code>.  Utilice las opciones por
	defecto por ahora, más tarde puede cambiarlas mediante
        <code class="command">modify</code>.  Recuerde que puede usar
        <code class="literal">?</code> en cualquier <span class="quote">&#8220;<span class="quote">prompt</span>&#8221;</span> para
	consultar las opciones disponibles.</p><p>Veamos un ejemplo de sesión de creación de una
        base de datos:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kstash</code></strong>
Master key: <strong class="userinput"><code>xxxxxxxx</code></strong>
Verifying password - Master key: <strong class="userinput"><code>xxxxxxxx</code></strong>

<code class="prompt">#</code> <strong class="userinput"><code>kadmin -l</code></strong>
kadmin&gt; <strong class="userinput"><code>init EJEMPLO.ORG</code></strong>
Realm max ticket life [unlimited]:
kadmin&gt; <strong class="userinput"><code>add tillman</code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Attributes []:
Password: <strong class="userinput"><code>xxxxxxxx</code></strong>
Verifying password - Password: <strong class="userinput"><code>xxxxxxxx</code></strong></pre><p>Ahora puede arrancar los servicios <acronym class="acronym">KDC</acronym>.
        Ejecute <code class="command">/etc/rc.d/kerberos start</code> y
        <code class="command">/etc/rc.d/kadmind start</code> para levantar dichos
        servicios.  Recuerde que no tendrá ningún
        dæmon kerberizado ejecutándose pero debe
	poder confirmar que <acronym class="acronym">KDC</acronym> funciona por el
        procedimiento de obtener y listar un boleto del principal
        (usuario) que acaba de crear en la línea de órdenes de
        <acronym class="acronym">KDC</acronym>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>k5init tillman</code></strong>
tillman@EJEMPLO.ORG's Password:

<code class="prompt">%</code> <strong class="userinput"><code>k5list</code></strong>
Credentials cache: FILE:<code class="filename">/tmp/krb5cc_500</code>
	Principal: tillman@EJEMPLO.ORG

  Issued           Expires          Principal
Aug 27 15:37:58  Aug 28 01:37:58  krbtgt/EJEMPLO.ORG@EJEMPLO.ORG</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75784400"></a>14.8.3. Creación de un servidor
	  <span class="application">Kerberos</span> con servicios
          Heimdal</h3></div></div></div><a id="idp75789648" class="indexterm"></a><p>Antes de nada necesitaremos una copia del fichero de
	  configuración de <span class="application">Kerberos</span>,
          <code class="filename">/etc/krb5.conf</code>.  Cópielo al cliente
          desde <acronym class="acronym">KDC</acronym> de forma segura (mediante
          <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a>, o usando un disquete).</p><p>A continuación necesitará un fichero
	  <code class="filename">/etc/krb5.keytab</code>.
          Esta es la mayor diferencia entre un servidor que proporciona
          dæmons habilitados con <span class="application">Kerberos</span>
          y una estación de trabajo: el servidor debe
          tener un fichero <code class="filename">keytab</code>.  Dicho fichero
          contiene las llaves de equipo del servidor, las cuales
          le permiten a él y al <acronym class="acronym">KDC</acronym>
          verificar la identidad entre ellos.  Deben transmitirse
          al servidor de forma segura ya que la seguridad del servidor
          puede verse comprometida si la llave se hace pública.
	  Por decirlo más claro, transferirla como texto plano a
	  través de la red (por ejemplo por
          <acronym class="acronym">FTP</acronym>) es una <span class="emphasis"><em>pésima
          idea</em></span>.</p><p>Lo normal es que transmita su <code class="filename">keytab</code>
          al servidor mediante el programa <code class="command">kadmin</code>.
          Esto es práctico porque también debe crear
          el principal del equipo (el <acronym class="acronym">KDC</acronym> que aparece
          al final de <code class="filename">krb5.keytab</code>)
	  usando <code class="command">kadmin</code>.</p><p>Tenga en cuenta que ya debe disponer de un ticket, y que
	  este ticket debe poder usar el interfaz
          <code class="command">kadmin</code> en <code class="filename">kadmind.acl</code>.
           Consulte la sección
          <span class="quote">&#8220;<span class="quote">administración remota</span>&#8221;</span> en la página
          info de Heimdal (<code class="command">info heimdal</code>), donde se
          exponen los detalles de diseño de las listas de control de
	  acceso.  Si no quiere habilitar acceso remoto
          <code class="command">kadmin</code>, puede conectarse de forma segura al
          <acronym class="acronym">KDC</acronym> (por medio de consola
          local, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> o <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnet&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">telnet</span>(1)</span></a>
	  <span class="application">Kerberos</span>) y administrar en local
          mediante <code class="command">kadmin -l</code>.</p><p>Después de instalar el fichero
	  <code class="filename">/etc/krb5.conf</code> puede usar
          <code class="command">kadmin</code> desde el servidor
          <span class="application">Kerberos</span>.
          <code class="command">add --random-key</code> le permitirá
          añadir el principal del equipo servidor, y
	  <code class="command">ext</code> le permitirá extraer el principal
          del equipo servidor a su propio keybat.  Por ejemplo:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt;<strong class="userinput"><code> add --random-key host/myserver.ejemplo.org</code></strong>
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Attributes []:
kadmin&gt;<strong class="userinput"><code> ext host/miservidor.ejemplo.org</code></strong>
kadmin&gt;<strong class="userinput"><code> exit</code></strong></pre><p>Tenga en cuenta que <code class="command">ext</code>
          (contracción de <span class="quote">&#8220;<span class="quote">extract</span>&#8221;</span>) almacena la
	  llave extraída por defecto en
          en <code class="filename">/etc/krb5.keytab</code>.</p><p>Si no tiene <code class="command">kadmind</code>
	  ejecutándose en
          <acronym class="acronym">KDC</acronym> (posiblemente por razones de seguridad)
          y por lo tanto carece de acceso remoto a <code class="command">kadmin</code>
          puede añadir el principal de equipo
          (<code class="systemitem">host/miservidor.EJEMPLO.ORG</code>) directamente
          en el <acronym class="acronym">KDC</acronym> y entonces extraerlo a un fichero
          temporal (para evitar sobreescribir
	  <code class="filename">/etc/krb5.keytab</code> en el
          <acronym class="acronym">KDC</acronym>) mediante algo parecido a esto:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kadmin</code></strong>
kadmin&gt;<strong class="userinput"><code> ext --keytab=/tmp/ejemplo.keytab host/miservidor.ejemplo.org</code></strong>
kadmin&gt;<strong class="userinput"><code> exit</code></strong></pre><p>Puede entonces copiar de forma segura el keytab al
          servidor (usando <code class="command">scp</code> o un diquete).
          Asegúrese de usar un nombre de keytab diferente
          para evitar sobreescribir el keytab en el
          <acronym class="acronym">KDC</acronym>.</p><p>Su servidor puede comunicarse con el
          <acronym class="acronym">KDC</acronym> (gracias a su fichero
          <code class="filename">krb5.conf</code>) y puede probar su propia
          identidad (gracias al fichero <code class="filename">krb5.keytab</code>).
          Ahora está listo para que usted habilite algunos
          servicios <span class="application">Kerberos</span>.
          En este ejemplo habilitaremos el servicio <code class="command">telnet</code>
          poniendo una línea como esta en su
          <code class="filename">/etc/inetd.conf</code> y reiniciando el
          servicio <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> con
          <code class="command">/etc/rc.d/inetd restart</code>:</p><pre class="programlisting">telnet    stream  tcp     nowait  root    /usr/libexec/telnetd  telnetd -a user</pre><p>La parte crítica es <code class="command">-a</code>,
          de autentificación de usuario.  Consulte
          la página de manual <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">telnetd</span>(8)</span></a> para
          más información.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75838160"></a>14.8.4. <span class="application">Kerberos</span> con un cliente
	  Heimdal</h3></div></div></div><a id="idp75839056" class="indexterm"></a><p>Configurar una computadora cliente es extremadamente
	  fácil.  Lo único que necesita es el
          fichero de configuración de
	  <span class="application">Kerberos</span> que encontrará
          en <code class="filename">/etc/krb5.conf</code>.
          Simplemente cópielo de forma segura a la computadora
          cliente desde el <acronym class="acronym">KDC</acronym>.</p><p>Pruebe su computadora cliente mediante
          <code class="command">kinit</code>, <code class="command">klist</code>, y
          <code class="command">kdestroy</code> desde el cliente para obtener,
          mostrar y luego borrar un ticket para el principal que
          creó antes.  Debería poder usar aplicaciones
          <span class="application">Kerberos</span> para conectarse a
          servidores habilitados con <span class="application">Kerberos</span>,
          aunque si no funciona y tiene problemas al intentar obtener
	  el boleto lo más probable es que el problema
          esté en el servidor y no en el cliente o el
	  <acronym class="acronym">KDC</acronym>.</p><p>Al probar una aplicación como <code class="command">telnet</code>,
          trate de usar un <span class="quote">&#8220;<span class="quote">sniffer</span>&#8221;</span> de paquetes
	  ( como <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=tcpdump&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">tcpdump</span>(1)</span></a>) para confirmar que su contraseña
          no viaja en claro por la red.
          Trate de usar <code class="command">telnet</code> con la opción
          <code class="literal">-x</code>, que cifra el flujo de datos por
          entero (algo parecido a lo que hace
	  <code class="command">ssh</code>).</p><p>Las aplicaciones clientes <span class="application">Kerberos</span>
          principales (llamadas tradicionalmente <code class="command">kinit</code>,
          <code class="command">klist</code>, <code class="command">kdestroy</code> y
          <code class="command">kpasswd</code>) están incluidas en
          la instalación base de FreeBSD.  Tenga en cuenta que
	  en las versiones de FreeBSD anteriores a 5.0 reciben los nombres de
          <code class="command">k5init</code>,
          <code class="command">k5list</code>, <code class="command">k5destroy</code>,
          <code class="command">k5passwd</code> y <code class="command">k5stash</code>.</p><p>También se instalan por defecto diversas aplicaciones
          <span class="application">Kerberos</span> que no entran dentro de
	  la categoría de <span class="quote">&#8220;<span class="quote">imprescindibles</span>&#8221;</span>.
          Es aquí donde la naturaleza
          <span class="quote">&#8220;<span class="quote">mínima</span>&#8221;</span> de la instalación base de
          Heimdal salta a la palestra: <code class="command">telnet</code> es el
	  único servicio <span class="application">Kerberos</span>
	  habilitado.</p><p>El port Heimdal añade algunas de las aplicaciones
          cliente que faltan: versiones <span class="application">Kerberos</span>
          de <code class="command">ftp</code>, <code class="command">rsh</code>,
          <code class="command">rcp</code>, <code class="command">rlogin</code> y algunos
          otros programas menos comunes.  El port del <acronym class="acronym">MIT</acronym>
          también contiene una suite completa de aplicaciones
          cliente de <span class="application">Kerberos</span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75861584"></a>14.8.5. Ficheros de configuración de usuario: <code class="filename">.k5login</code> y <code class="filename">.k5users</code></h3></div></div></div><a id="idp75862864" class="indexterm"></a><a id="idp75863760" class="indexterm"></a><p>Suele ser habitual que los usuarios de un dominio
          <span class="application">Kerberos</span> (o <span class="quote">&#8220;<span class="quote">principales</span>&#8221;</span>)
	  tengan su usuario
          (por ejemplo <code class="systemitem">tillman@EJEMPLO.ORG</code>) mapeado
          a una cuenta de usuario local (por ejemplo un usuario llamado
          llamado <code class="systemitem">tillman</code>).  Las aplicaciones cliente
          como <code class="command">telnet</code> normalmente no requieren un
          nombre de usuario o un principal.</p><p>Es posible que de vez en cuando quiera dar acceso a una
          una cuenta de usuario local a alguien que no tiene un
          principal <span class="application">Kerberos</span>.
          Por ejemplo, <code class="systemitem">tillman@EJEMPLO.ORG</code> puede
          necesitar acceso a la cuenta de usuario local
	  <code class="systemitem">webdevelopers</code>.
          Otros principales tal vez necesiten acceso a esas
          cuentas locales.</p><p>Los ficheros <code class="filename">.k5login</code> y
          <code class="filename">.k5users</code>, ubicados en el directorio
          home del usuario, pueden usarse de un modo similar a
          una combinación potente de
          <code class="filename">.hosts</code> y <code class="filename">.rhosts</code>.
          Por ejemplo, si pusiera un fichero
          <code class="filename">.k5login</code> con el siguiente
          contenido</p><pre class="screen">tillman@example.org
jdoe@example.org</pre><p>en el directorio home del usuario local
          <code class="systemitem">webdevelopers</code> ambos
          principales listados tendrían acceso a esa cuenta
          sin requerir una contraseña compartida.</p><p>Le recomendamos encarecidamente la lectura de las
	  páginas de manual de estas órdenes.  Recuerde que
	  la página de manual de
          <code class="command">ksu</code> abarca
          <code class="filename">.k5users</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75874000"></a>14.8.6. <span class="application">Kerberos</span> Sugerencias, trucos y
	   solución de problemas</h3></div></div></div><a id="idp75883216" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Tanto si utiliza el port de Heimdal o
	      el <span class="application">Kerberos</span>
              del <acronym class="acronym">MIT</acronym> asegúrese de que su
              variable de entorno <code class="envar">PATH</code> liste las
              versiones de <span class="application">Kerberos</span> de las
              aplicaciones cliente antes que las versiones del
              sistema.</p></li><li class="listitem"><p>?Todas las computadoras de su dominio Kerberos
              tienen la hora sincronizada? Si no, la autentificación
              puede fallar.
              <a class="xref" href="network-ntp.html" title="29.12. NTP">Sección 29.12, &#8220;NTP&#8221;</a> describe como sincronizar
              los relojes utilizando <acronym class="acronym">NTP</acronym>.</p></li><li class="listitem"><p><acronym class="acronym">MIT</acronym> y Heimdal conviven bien, con la
              excepción de <code class="command">kadmin</code>, protocolo
              no está estandarizado.</p></li><li class="listitem"><p>Si cambia su nombre de equipo debe cambiar también
              el <span class="quote">&#8220;<span class="quote">apellido</span>&#8221;</span> de su principal y actualizar su
              keytab.  Esto también se aplica a entradas especiales
              en keytab como el principal <code class="systemitem">www/</code>
              que usa el <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/mod_auth_kerb/pkg-descr">www/mod_auth_kerb</a>
              de Apache.</p></li><li class="listitem"><p>Todos los equipos en su dominio Kerberos deben poder
              resolverse (tanto en la forma normal normal como en la
	      inversa) en el <acronym class="acronym">DNS</acronym> (o en
              <code class="filename">/etc/hosts</code> como mínimo).
              Los CNAME funcionarán, pero los registros A y PTR
              deben ser correctos y estar en su sitio.  El mensaje de error
              que recibirá de no hacerlo así no es muy
	      intuitivo:
              <span class="errorname">Kerberos5 refuses authentication because Read req
              failed: Key table entry not found</span>.</p></li><li class="listitem"><p>Algunos sistemas operativos que puede usar como clientes
              de su <acronym class="acronym">KDC</acronym> no activan
              los permisos para <code class="command">ksu</code> como
              setuid <code class="systemitem">root</code>.  Esto hará que
              <code class="command">ksu</code> no funcione, lo cual es muy seguro
              pero un tanto molesto.  Tenga en cuenta que no se debe a
              un error de <acronym class="acronym">KDC</acronym>.</p></li><li class="listitem"><p>Si desea permitir que un principal tenga un ticket con
	      una validez más larga que el valor por defecto de diez
	      horas en <span class="application">Kerberos</span> del
              <acronym class="acronym">MIT</acronym> debe usar
              <code class="command">modify_principal</code> en <code class="command">kadmin</code>
              para cambiar <span class="quote">&#8220;<span class="quote">maxlife</span>&#8221;</span> tanto del principal en
	      cuestión como del <code class="systemitem">krbtgt</code> del
	      principal.  Hecho esto,
              el principal puede utilizar la opción
              <code class="literal">-l</code> con <code class="command">kinit</code> para
              solicitar un boleto con más tiempo de vida.</p></li><li class="listitem"><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si ejecuta un <span class="quote">&#8220;<span class="quote">sniffer</span>&#8221;</span> de paquetes en su
              <acronym class="acronym">KDC</acronym> para ayudar con la resolución
              de problemas y ejecuta <code class="command">kinit</code> desde una
              estación de trabajo puede encontrarse con que su
              <acronym class="acronym">TGT</acronym> se envía inmediatamente
              después de ejecutar <code class="command">kinit</code>:
              <span class="emphasis"><em>incluso antes de que escriba su
	      contraseña</em></span> La explicación es que el
              servidor <span class="application">Kerberos</span> transmite
              tranquilamente un <acronym class="acronym">TGT</acronym> (Ticket Granting
              Ticket) a cualquier petición no autorizada; de todas
              maneras, cada <acronym class="acronym">TGT</acronym> está cifrado
              en una llave derivada de la contraseña del usuario.
              Por tanto, cuando un usuario teclea su contraseña
              no la está enviando al <acronym class="acronym">KDC</acronym>,
              se está usando para descifrar el <acronym class="acronym">TGT</acronym>
              que <code class="command">kinit</code> ya obtuvo.  Si el proceso de
              descifrado termina en un ticket válido con
              una marca de tiempo válida, el usuario tiene
              credenciales <span class="application">Kerberos</span> válidas.
              Estas credenciales incluyen una llave de sesión para
              establecer comunicaciones seguras con el servidor
              <span class="application">Kerberos</span> en el futuro, así
              como el TGT en sí, que se cifra con la llave del propio
              servidor <span class="application">Kerberos</span>.
	      Esta segunda capa de cifrado es invisible para el usuario, pero
              es lo que permite al servidor <span class="application">Kerberos</span>
              verificar la autenticidad de cada
	      <acronym class="acronym">TGT</acronym>.</p></div></li><li class="listitem"><p>Si desea utilizar tickets con un tiempo largo de vida (una
              semana, por ejemplo) y está utilizando
	      <span class="application">OpenSSH</span>
              para conectarse a la máquina donde se almacena su
	      boleto asgúrese de que
              <span class="application">Kerberos</span>
              <code class="option">TicketCleanup</code> esté configurado a
	      <code class="literal">no</code> en su <code class="filename">sshd_config</code>
              o de lo contrario sus tickets serán eliminados cuando
              termine la sesión.</p></li><li class="listitem"><p>Recuerde que los principales de equipos también
	      pueden tener tener un tiempo de vida más largo.
              Si su principal de usuario tiene un tiempo de vida de una
	      semana pero el equipo al que se conecta tiene un
              tiempo de vida de nueve horas, tendrá un principal de
              equipo expirado en su caché, y la caché de
              ticket no funcionará como esperaba.</p></li><li class="listitem"><p>Cuando esté configurando un fichero
              <code class="filename">krb5.dict</code> pensando específicamente
              en prevenir el uso de contraseñas defectuosas (la
	      página de manual de
              de <code class="command">kadmind</code> trata el tema brevemente), recuerde
              que solamente se aplica a principales que tienen una
	      política de contraseñas asignada.  El formato
              de los ficheros <code class="filename">krb5.dict</code> es simple:
	      una cadena de texto por línea.  Puede serle
              útil crear un enlace simbólico a
              <code class="filename">/usr/share/dict/words</code>.</p></li></ul></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75919056"></a>14.8.7. Diferencias con el port del <acronym class="acronym">MIT</acronym></h3></div></div></div><p>Las diferencias más grandes entre las instalaciones
          <acronym class="acronym">MIT</acronym> y Heimdal están relacionadas
          con <code class="command">kadmin</code>, que tiene un conjunto
          diferente (pero equivalente) de órdenes y utiliza un protocolo
          diferente.  Esto tiene implicaciones muy grandes si su
          <acronym class="acronym">KDC</acronym> es <acronym class="acronym">MIT</acronym>, ya que no
          podrá utilizar el programa <code class="command">kadmin</code>
          de Heimdal para administrar remotamente su <acronym class="acronym">KDC</acronym>
          (o viceversa).</p><p>Las aplicaciones cliente pueden también disponer de
          diferentes opciones de línea de órdenes para
          lograr lo mismo.  Le recomendamos seguir las instrucciones de
          la página web de <span class="application">Kerberos</span>
          del <acronym class="acronym">MIT</acronym>
          (<code class="uri"><a class="uri" href="http://web.mit.edu/Kerberos/www/" target="_top">http://web.mit.edu/Kerberos/www/</a></code>).
          Sea cuidadoso con los parches: el port
          del <acronym class="acronym">MIT</acronym> se instala por defecto en
          <code class="filename">/usr/local/</code>, y las
          aplicaciones <span class="quote">&#8220;<span class="quote">normales</span>&#8221;</span> del sistema pueden
          ser ejecutadas en lugar de las del <acronym class="acronym">MIT</acronym>
          si su variable de entorno <code class="envar">PATH</code> lista antes los
          directorios del sistema.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si usa el port del <acronym class="acronym">MIT</acronym>
          <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/krb5/pkg-descr">security/krb5</a>
          proporcionado por FreeBSD asegúrese de leer el fichero
          <code class="filename">/usr/local/share/doc/krb5/README.FreeBSD</code>
          instalado por el port si quiere entender por qué los
          login vía <code class="command">telnetd</code> y
          <code class="command">klogind</code> se comportan de un modo un tanto
          extraño.  Más importante aún, corregir la
          conducta de <span class="quote">&#8220;<span class="quote">permisos incorrectos en el fichero
          caché</span>&#8221;</span> requiere que el binario
          <code class="command">login.krb5</code> se use para la
	  validación para que pueda cambiar correctamente los
          permisos de propiedad de credenciales reenviadas.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75938128"></a>14.8.8. Mitigación de limitaciones encontradas en
	  <span class="application">Kerberos</span></h3></div></div></div><a id="idp75939024" class="indexterm"></a><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75940176"></a>14.8.8.1. <span class="application">Kerberos</span> es un enfoque
	   <span class="quote">&#8220;<span class="quote">todo o nada</span>&#8221;</span></h4></div></div></div><p>Cada servicio habilitado en la red debe modificarse
            para funcionar con <span class="application">Kerberos</span> (o
            debe ser asegurado contra ataques de red) o de lo
            contrario las credenciales de usuario pueden robarse y
            reutilizarse.  Un ejemplo de esto podría ser que
            <span class="application">Kerberos</span> habilite todos los shells
            remotos ( vía <code class="command">rsh</code> y
	    <code class="command">telnet</code>, por ejemplo) pero que no cubra
            el servidor de correo <acronym class="acronym">POP3</acronym>, que
	    envía contraseñas en texto plano.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75943760"></a>14.8.8.2. <span class="application">Kerberos</span> está pensado
	    para estaciones de trabajo monousuario</h4></div></div></div><p>En un entorno multiusuario
            <span class="application">Kerberos</span> es menos seguro.
            Esto se debe a que almacena los tickets en el
            directorio <code class="filename">/tmp</code>, que puede
            ser leído por todos los usuarios.  Si un
            usuario está compartiendo una computadora con
            varias personas (esto es, si utiliza un sistema
	    multiusuario)  es posible que los tickets sean robados
            (copiados) por otro usuario.</p><p>Esto puede solventarse con la opción de línea
            de órdenes <code class="literal">-c</code> nombre-de-fichero o
            (mejor aún) la variable de entorno
            <code class="envar">KRB5CCNAME</code>, pero raramente se hace.
            Si almacena los tickets en el directorio home de los
            usuarios y utiliza sin mucha complicación los permisos
	    de fichero puede mitigar este problema.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75947344"></a>14.8.8.3. El KDC es el punto crítico de fallo</h4></div></div></div><p>Por motivos de diseño el <acronym class="acronym">KDC</acronym>
	    es tan seguro como la base de datos principal de
            contraseñas que contiene.  El
            <acronym class="acronym">KDC</acronym> no debe ejecutar ningún
            otro servicio ejecutándose en él y debe ser
	    físicamente seguro.  El peligro es grande debido a que
            <span class="application">Kerberos</span> almacena todas las
            contraseñas cifradas con la misma llave
            (la llave <span class="quote">&#8220;<span class="quote">maestra</span>&#8221;</span>, que a su vez se guarda
            como un fichero en el
            <acronym class="acronym">KDC</acronym>).</p><p>De todos modos una llave maestra comprometida no es
            algo tan terrible como parece a primera vista.  La llave maestra
	    solo se usa para cifrar la base de datos
            <span class="application">Kerberos</span> y como semilla para el
            generador de números aleatorios.  Mientras sea seguro
            el acceso a su <acronym class="acronym">KDC</acronym> un atancante no puede
            hacer demasiado con la llave maestra.</p><p>Además, si el <acronym class="acronym">KDC</acronym> no está
            disponible (quizás debido a un ataque de denegación
            de servicio o problemas de red) no se podrán utilizar
	    los servicios de red ya que no se puede efectuar la
	    validación, lo que hace que esta sea una buena forma de
	    lanzar un ataque de denegación de servicio.
            Este problema puede aliviarse con múltiples
	    <acronym class="acronym">KDC</acronym>s (un maestro y uno o más esclavos)
            y con una implementación cautelosa de secundarios o
            autentificación de respaldo (para esto
	    <acronym class="acronym">PAM</acronym> es excelente).</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75957328"></a>14.8.8.4. Limitaciones de <span class="application">Kerberos</span></h4></div></div></div><p><span class="application">Kerberos</span> le permite a usuarios,
            equipos y servicios validarse entre sí, pero no
            dispone de ningún mecanismo para autentificar el
	    <acronym class="acronym">KDC</acronym> a los usuarios, equipos o servicios.
            Esto significa que una versión
	    (por ejemplo) <span class="quote">&#8220;<span class="quote">troyanizada</span>&#8221;</span>
            <code class="command">kinit</code> puede grabar todos los usuarios y sus
            contraseñas.  Puede usar
            <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/tripwire/pkg-descr">security/tripwire</a> o
            alguna otra herramienta de revisión de integridad
            de sistemas de ficheros para intentar evitar problemas como
	    este.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75960656"></a>14.8.9. Recursos y más información</h3></div></div></div><a id="idp75961296" class="indexterm"></a><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://www.faqs.org/faqs/Kerberos-faq/general/preamble.html" target="_top">
	    Las preguntas frecuentes (FAQ) de
	    <span class="application">Kerberos</span></a></p></li><li class="listitem"><p><a class="link" href="http://web.mit.edu/Kerberos/www/dialogue.html" target="_top">Designing an
	    Authentication System: a Dialog in Four Scenes</a></p></li><li class="listitem"><p><a class="link" href="http://www.ietf.org/rfc/rfc1510.txt?number=1510" target="_top">RFC 1510,
	    The <span class="application">Kerberos</span> Network Authentication Service
	    (V5)</a></p></li><li class="listitem"><p><a class="link" href="http://web.mit.edu/Kerberos/www/" target="_top">Página web de <span class="application">Kerberos</span>
	  del <acronym class="acronym">MIT</acronym></a></p></li><li class="listitem"><p><a class="link" href="http://www.pdc.kth.se/heimdal/" target="_top">Página web de
	  <span class="application">Kerberos</span> Heimdal</a></p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kerberosIV.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="openssl.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">14.7. <span class="application">KerberosIV</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 14.9. OpenSSL</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>