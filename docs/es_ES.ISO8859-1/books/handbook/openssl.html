<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>14.9. OpenSSL</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="security.html" title="Capítulo 14. Seguridad" /><link rel="prev" href="kerberos5.html" title="14.8. Kerberos5" /><link rel="next" href="ipsec.html" title="14.10. VPN sobre IPsec" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.9. OpenSSL</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="kerberos5.html">Anterior</a> </td><th width="60%" align="center">Capítulo 14. Seguridad</th><td width="20%" align="right"> <a accesskey="n" href="ipsec.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="openssl"></a>14.9. OpenSSL</h2></div><div><span class="authorgroup">Escrito por: <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp75976656" class="indexterm"></a><p>El conjunto de herramientas <span class="application">OpenSSL</span>
      es una característica de FreeBSD que muchos usuarios
      pasan por alto.  <span class="application">OpenSSL</span> ofrece una
      capa de cifrada de transporte sobre la capa normal de
      comunicación, permitiendo la combinación con
      con muchas aplicaciones y servicios de red.</p><p>Algunos usos de <span class="application">OpenSSL</span> son
      la validación cifrada de clientes de correo, las
      transacciones basadas en web como pagos con tarjetas de
      crédito, etc.  Muchos ports, como
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/apache13-ssl/pkg-descr">www/apache13-ssl</a> y
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/mail/sylpheed-claws/pkg-descr">mail/sylpheed-claws</a>
      ofrecen soporte de compilación para
      <span class="application">OpenSSL</span>.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">En la mayoría de los casos la colección
        de ports tratará de compilar el port
        <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/openssl/pkg-descr">security/openssl</a> a menos
        que la variable de make <code class="varname">WITH_OPENSSL_BASE</code>
        sea puesta explícitamente a <span class="quote">&#8220;<span class="quote">yes</span>&#8221;</span>.</p></div><p>La versión de <span class="application">OpenSSL</span>
      incluida en FreeBSD soporta los protocolos de seguridad
      de red Secure Sockets Layer v2/v3 (SSLv2/SSLv3) y
      Transport Layer Security v1 (TLSv1) y puede utilizarse como
      biblioteca criptográfica general.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml"><span class="application">OpenSSL</span> soporta el
        algoritmo <acronym class="acronym">IDEA</acronym> pero estáa deshabilitado
        por defecto debido a patentes en vigor en los  Estados Unidos.
        Si quiere usarlo debe revisar la licencia, y si las
        restricciones le parecen aceptables active la variable
        <code class="varname">MAKE_IDEA</code> en
        <code class="filename">make.conf</code>.</p></div><p>Uno de los usos más comunes de
      <span class="application">OpenSSL</span> es ofrecer certificados para
      usar con aplicaciones de software.  Estos certificados aseguran
      que las credenciales de la compañia o individuo son
      válidos y no son fraudulentos.  Si el certificado en
      cuestión no ha sido verificado por uno de las diversas
      <span class="quote">&#8220;<span class="quote">autoridades certificadoras</span>&#8221;</span>
      o <acronym class="acronym">CA</acronym>, suele generarse una advertencia al respecto.
      Una autoridad de certificados es una compañia, como
      <a class="link" href="http://www.verisign.com" target="_top">VeriSign</a>, que
      firma certificados para validar credenciales de individuos
      o compañias.  Este proceso tiene un costo asociado y no es
      un requisito imprescindible para usar certificados, aunque
      puede darle un poco de tranquilidad a los usuarios
      más paranóicos.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp75988048"></a>14.9.1. Generación de certificados</h3></div></div></div><a id="idp75988688" class="indexterm"></a><p>Para generar un certificado ejecute lo siguiente:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -new -nodes -out req.pem -keyout cert.pem</code></strong>
Generating a 1024 bit RSA private key
................++++++
.......................................++++++
writing new private key to 'cert.pem'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:<strong class="userinput"><code>US</code></strong>
State or Province Name (full name) [Some-State]:<strong class="userinput"><code>PA</code></strong>
Locality Name (eg, city) []:<strong class="userinput"><code>Pittsburgh</code></strong>
Organization Name (eg, company) [Internet Widgits Pty Ltd]:<strong class="userinput"><code>Mi compañía</code></strong>
Organizational Unit Name (eg, section) []:<strong class="userinput"><code>Administrador de sistemas</code></strong>
Common Name (eg, YOUR name) []:<strong class="userinput"><code>localhost.ejemplo.org</code></strong>
Email Address []:<strong class="userinput"><code>trhodes@FreeBSD.org</code></strong>

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:<strong class="userinput"><code>UNA CONTRASEÑA</code></strong>
An optional company name []:<strong class="userinput"><code>Otro nombre</code></strong></pre><p>Tenga en cuenta que la respuesta directamente después
        de <span class="quote">&#8220;<span class="quote">prompt</span>&#8221;</span> <span class="quote">&#8220;<span class="quote">Common Name</span>&#8221;</span> muestra un
        nombre de dominio.  Este <span class="quote">&#8220;<span class="quote">prompt</span>&#8221;</span> requiere que se
	introduzca un nombre de servidor para usarlo en la
        verificación; si escribe cualquier otra cosa
        producirá un certificado inválido.
        Otras opciones, por ejemplo el tiempo
        de expiración, alternan algoritmos de cifrado,
        etc.  Puede ver una lista completa en la página
        de manual de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=openssl&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">openssl</span>(1)</span></a>.</p><p>Debería tener dos ficheros en el directorio
        donde ha ejecutado la orden anterior.  La petición
	de certificado,
        <code class="filename">req.pem</code>, es lo que debe enviar a una
	autoridad certificadora para que valide las credenciales que
	introdujo; firmará la petición y le devolverá
        el certificado.  El segundo fichero es
        <code class="filename">cert.pem</code> y es la llave privada para
        el certificado, que debe proteger a toda costa; si  cae en
	malas manos podrí usarse para suplantarle a usted o a
        sus servidores.</p><p>Si no necesita la firma de una <acronym class="acronym">CA</acronym>
        puede crear y firmar usted mismo su certificado.
        Primero, genere la llave <acronym class="acronym">RSA</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl dsaparam -rand -genkey -out myRSA.key 1024</code></strong></pre><p>A continuación genere la llave <acronym class="acronym">CA</acronym>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl gendsa -des3 -out myca.key myRSA.key</code></strong></pre><p>Utilice esta llave para crear el certificado:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>openssl req -new -x509 -days 365 -key myca.key -out new.crt</code></strong></pre><p>Deberín aparecer dos nuevos ficheros en su directorio:
        un fichero de firma de autoridad de certificados
        (<code class="filename">myca.key</code>) y el certificado en sí,
        <code class="filename">new.crt</code>.  Deben ubicarse en un directorio,
        que se recomienda que sea
        <code class="filename">/etc</code>, que es legible
        solo para <code class="systemitem">root</code>.  Para terminar, es recomendable
	asignar permisos 0700 para el fichero con
        <code class="command">chmod</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76022352"></a>14.9.2. Uso de certificados; un ejemplo</h3></div></div></div><p>?Qué pueden hacer estos ficheros?
        Cifrar conexiones al <acronym class="acronym">MTA</acronym>
        <span class="application">Sendmail</span> es un buen sitio para
	usarlos.  De este modo eliminará el uso de validación
        mediante texto en claro para los usuarios que envían
        correo a través del <acronym class="acronym">MTA</acronym>
        local.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">No es el mejor uso en el mundo, ya que algunos
          <acronym class="acronym">MUA</acronym>s enviarán al usuario un
	  mensaje de error si no tiene instalados localmente los
	  certificados.  Consulte la documentación
	  para más datos sobre la
          instalación de certificados.</p></div><p>Debe añadir las siguientes líneas
        en su fichero local <code class="filename">.mc</code>:</p><pre class="programlisting">dnl SSL Options
define(`confCACERT_PATH',`/etc/certs')dnl
define(`confCACERT',`/etc/certs/new.crt')dnl
define(`confSERVER_CERT',`/etc/certs/new.crt')dnl
define(`confSERVER_KEY',`/etc/certs/myca.key')dnl
define(`confTLS_SRV_OPTIONS', `V')dnl</pre><p><code class="filename">/etc/certs/</code>
        es el directorio destinado a almacenamiento de
        los ficheros de certificado y llave en local.
        El último requisito es una reconstrucción
        del fichero <code class="filename">.cf</code> local.  Solo tiene que
        teclear <code class="command">make</code>
        <em class="parameter"><code>install</code></em> en el directorio
        <code class="filename">/etc/mail</code>.
        A continuación ejecute un <code class="command">make</code>
        <em class="parameter"><code>restart</code></em>, que debería reiniciar el
        dæmon <span class="application">Sendmail</span>.</p><p>Si todo fué bien no habrá mensajes de error
        en el fichero <code class="filename">/var/log/maillog</code>
        y <span class="application">Sendmail</span> aparecerá en
        la lista de procesos.</p><p>Puede probarlo todo de una forma muy sencilla;
        conéctese al servidor de correo mediante
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnet&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">telnet</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>telnet ejemplo.com 25</code></strong>
Trying 192.0.34.166...
Connected to <code class="systemitem">ejemplo.com</code>.
Escape character is '^]'.
220 <code class="systemitem">ejemplo.com</code> ESMTP Sendmail 8.12.10/8.12.10; Tue, 31 Aug 2004 03:41:22 -0400 (EDT)
<strong class="userinput"><code>ehlo ejemplo.com</code></strong>
250-ejemplo.com Hello ejemplo.com [192.0.34.166], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH LOGIN PLAIN
250-STARTTLS
250-DELIVERBY
250 HELP
<strong class="userinput"><code>quit</code></strong>
221 2.0.0 <code class="systemitem">ejemplo.com</code> closing connection
Connection closed by foreign host.</pre><p>Si la línea <span class="quote">&#8220;<span class="quote">STARTTLS</span>&#8221;</span> aparece en la
        salida, todo está funcionando correctamente.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kerberos5.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="ipsec.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">14.8. <span class="application">Kerberos5</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 14.10. VPN sobre IPsec</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>