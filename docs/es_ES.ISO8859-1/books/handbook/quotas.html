<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>18.14. Cuotas en sistemas de ficheros</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="disks.html" title="Capítulo 18. Almacenamiento" /><link rel="prev" href="snapshots.html" title="18.13. Instantáneas (&#8220;snapshots&#8221;) de sistemas de ficheros" /><link rel="next" href="disks-encrypting.html" title="18.15. Cifrado de particiones de disco" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">18.14. Cuotas en sistemas de ficheros</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="snapshots.html">Anterior</a> </td><th width="60%" align="center">Capítulo 18. Almacenamiento</th><td width="20%" align="right"> <a accesskey="n" href="disks-encrypting.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="quotas"></a>18.14. Cuotas en sistemas de ficheros</h2></div></div></div><a id="idp78379216" class="indexterm"></a><a id="idp78380368" class="indexterm"></a><p>Las cuotas son una opción del sistema
      operativo que le permite limitar la cantidad de espacio en
      disco y/o el número de fichero que un usuario o
      miembros de un grupo pueden crear en el sistema, pudiendo
      además hacerlo de forma independiente en cada sistema de
      ficheros.
      Suele usarse principalmente en sistemas de tiempo compartido,
      donde se busca limitar la cantidad de recursos que cualquier
      usuario o grupo pueden utilizar.
      Esto evitará que un usuario o un grupo de usuarios
      consuma todos el espacio disponible en disco.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78381264"></a>18.14.1. Configuración del sistema para habilitar
       cuotas de disco</h3></div></div></div><p>Antes de intentar configurar el uso de cuotas de disco
        hay que asegurarse de que las cuotas están activadas en el
        kernel.  La siguiente línea debe estar en el fichero de
        de configuración del kernel:</p><pre class="programlisting">options QUOTA</pre><p>El kernel <code class="filename">GENERIC</code> no lo tiene activado
        por defecto, así que tendrá que configurar,
        compilar e instalar un kernel personalizado para
        poder usar cuotas de disco.  Por favor, consulte el
        <a class="xref" href="kernelconfig.html" title="Capítulo 8. Configuración del kernel de FreeBSD">Capítulo 8, <em>Configuración del kernel de FreeBSD</em></a> para más información
        sobre la configuración del kernel.</p><p>A continuación tendrá que habilitar
        las cuotas de disco en <code class="filename">/etc/rc.conf</code>.
        Añadale la siguiente línea:</p><pre class="programlisting">enable_quotas="YES"</pre><a id="idp78384976" class="indexterm"></a><p>Hay una variable que le permitirá efectuar un
        control más exhaustivo sobre el arranque de cuotas.
        Normalmente se revisa la integridad de cuotas de cada sistema
        de ficheros en el arranque; el responsable es
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a>.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a> se asegura de que los
        datos que hay en su base de datos de cuotas reflejen
        realmente los datos del sistema de ficheros.  Es un proceso
        que lleva mucho tiempo y que afectará significativamente
        al tiempo que tardará su sistema en arrancar.  Si desea
        saltarse ese paso puede usar una variable al efecto en
        <code class="filename">/etc/rc.conf</code>:</p><pre class="programlisting">check_quotas="NO"</pre><p>Para concluir tendrá que editar
        <code class="filename">/etc/fstab</code> para habilitar las cuotas de disco
        para cada sistema de ficheros.  Es aquí donde podrá
        habilitar cuotas por usuario, por grupo, o ambos en todos sus
        sistemas de ficheros.</p><p>Para habilitar cuotas por usuario en un sistema de
        ficheros añada la opción <code class="option">userquota</code> al
        campo de opciones en la entrada de <code class="filename">/etc/fstab</code>
        que corresponda al sistema de ficheros en el que quiere habilitar
        las cuotas.  Veamos un ejemplo:</p><pre class="programlisting">/dev/da1s2g   /home    ufs rw,userquota 1 2</pre><p>En el caso de las cuotas de grupo es muy similar.
        Use la opción <code class="option">groupquota</code> en lugar
        de <code class="option">userquota</code>.  Para habilitar
        cuotas por usuario y por grupo modifique la entrada
        de este modo:</p><pre class="programlisting">/dev/da1s2g    /home    ufs rw,userquota,groupquota 1 2</pre><p>Por defecto los ficheros de cuota se guardan en
        el directorio raíz del sistema de ficheros con los
        nombres <code class="filename">quota.user</code> y
        <code class="filename">quota.group</code>
        para cuotas de usuario y grupo respectivamente.
        Consulte <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> para más información.
        Aunque la página de manual de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> diga que puede
        especificar otra ubicación para los ficheros de
        cuota, no se recomienda hacerlo debido a que las diversas herramientas
        de gestió cuotas no parecen sobrellevar esto
        adecuadamente.</p><p>Hecho todo esto puede reiniciar su sistema con el nuevo
        kernel.  <code class="filename">/etc/rc</code> ejecutará
        automáticamente los comandos apropiados para crear los
        ficheros de cuota iniciales que requieran todas las entradas en
        en <code class="filename">/etc/fstab</code>, así que no hay
        necesidad de crear ficheros de cuota de longitud cero.</p><p>En el curso normal de operaciones no se le debería
        pedir que ejecute <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotaon&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotaon</span>(8)</span></a> o
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotaoff&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotaoff</span>(8)</span></a> manualmente.  Sin embargo, tal vez quiera leer
        sus páginas de manual para familiarizarse con su
        funcionamiento.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78407888"></a>18.14.2. Configuración de límites de cuota</h3></div></div></div><a id="idp78408528" class="indexterm"></a><p>Una vez que tenga configurado su sistema para usar cuotas
        verifique que en realidad estén habilitadas.  Una manera
        sencilla de hacer esto es ejecutar:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>quota -v</code></strong></pre><p>Debe ver un resumen de una sola línea de uso del
        disco y los límites de cuota actuales para cada sistema
        de ficheros donde estén habilitadas las cuotas.</p><p>Ahora puede iniciar la asignación
        de límites de cuota con <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>.</p><p>Tiene varias opciones para imponer límites en el
        espacio de disco que un usuario o grupo puede ocupar, y
        cuántos ficheros pueden crear.  Puede limitar el uso de
        disco basándose en el espacio en disco (cuotas de bloque) o
        en el número de ficheros (cuotas de inodo) o una
        combinación de ambas.  Cada uno de estos límites
        a su vez se divide en dos categorías: límites
        duros y suaves.</p><a id="idp78413008" class="indexterm"></a><p>Un límite duro no puede ser excedido.  Una vez que
        un usuario alcanza su límite duro no puede realizar
        más ubicaciones en el sistema de ficheros en cuestión.
        Por ejemplo, si el usuario tiene un límite duro de
        500 kbytes en un sistema de ficheros y está utilizando
        490 kbytes, el usuario solo puede ocupar
        otros 10 kbytes.  Un intento de ocupar 11 kbytes más
        fallará.</p><a id="idp78413904" class="indexterm"></a><p>Los límites suaves pueden excederse por un periodo
        Este periodo de tiempo recibe el nombre de periodo de gracia, que
        por defecto es una semana.  Si un usuario sobrepasa su periodo de
        gracia el límite suave se convertirá en
        un límite duro y no se permitir´n usos de disco
        adicionales.  Cuando el usuario devuelve su cuota de uso de
        recursos a un punto por debajo de su límite suave
        el periodo de gracia se reinicia.</p><p>Veamos un ejemplo de uso de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>.
        Si se usa <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a> se entra en el el editor declarado en
        la variable de entorno
        <code class="envar">EDITOR</code>, o en el editor <span class="application">vi</span>
        si no ha modificado el valor por defecto de la variable
        <code class="envar">EDITOR</code>, para que pueda editar los
        límites de cuota.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>edquota -u test</code></strong></pre><pre class="programlisting">Quotas for user test:
/usr: kbytes in use: 65, limits (soft = 50, hard = 75)
        inodes in use: 7, limits (soft = 50, hard = 60)
/usr/var: kbytes in use: 0, limits (soft = 50, hard = 75)
        inodes in use: 0, limits (soft = 50, hard = 60)</pre><p>Debería ver dos líneas por cada sistema
        de ficheros que tenga habilitadas las cuotas.  Una línea
        para los límites de bloque y una línea para
        límites de inodo. Por ejemplo, para elevar los límites
        de este usuario de un límite suave de 50 y un límite
        duro de 75 a un límite suave de 500 y un límite
        duro de 600, cambie:</p><pre class="programlisting">/usr: kbytes in use: 65, limits (soft = 50, hard = 75)</pre><p>por:</p><pre class="programlisting">/usr: kbytes in use: 65, limits (soft = 500, hard = 600)</pre><p>Los nuevos límites de cuota se aplicarán en
        cuanto salga del editor.</p><p>Algunas veces se quieren activar límites de cuota
        en un rango de UIDs. Esto puede realizarse con la opción
        <code class="option">-p</code> de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>. Primero asigne el
        límite de cuota deseado a un usuario y luego
        ejecute
        <code class="command">edquota -p protouser startuid-enduid</code>.  Por
        ejemplo, si el usuario <code class="systemitem">test</code> tiene el
        límite de cuota deseado, el siguiente comando puede
        usarse para duplicar esos límites de cuota para los
        UIDs de 10,000 hasta 19,999:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>edquota -p test 10000-19999</code></strong></pre><p>Para más información consulte la página de
        manual <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78434128"></a>18.14.3. Revisión de los límites de cuota y
        uso de disco</h3></div></div></div><a id="idp78439120" class="indexterm"></a><p>Puede usar <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a> o
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=repquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">repquota</span>(8)</span></a> para revisar los límites de
        cuota y uso del disco.  El comando <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a>
        le permitirá revisar cuotas individuales de
        usuario o grupo y uso del disco.  Un usuario puede
        sólamente examinar su propia cuota y la cuota de un
        grupo al que pertenezca.  Sólamente el superusuario
        puede ver las cuotas de todos los usuarios y grupos.
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=repquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">repquota</span>(8)</span></a> permite obtener
        un resumen de todas las cuotas y uso del disco de todos los
        sistemas de ficheros con cuotas habilitadas.</p><p>En el siguiente ejemplo vemos la salida de
        <code class="command">quota -v</code> para un usuario
        que tiene límites de cuota en dos sistemas
        de ficheros.</p><pre class="programlisting">Disk quotas for user test (uid 1002):
     Filesystem  usage    quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</pre><a id="idp78444880" class="indexterm"></a><p>En el sistema de ficheros <code class="filename">/usr</code> del
        ejemplo este usuario está actualmente
        15 kbytes sobre su límite suave de 50 kbytes y le quedan 5
        días de su periodo de gracia.  Observe el asterisco,
        <code class="literal">*</code> que indica que el usuario está
        actualmente por encima de su límite de cuota.</p><p>Normalmente los sistemas de ficheros en los que el usuario
        no esté utilizando espacio en disco no se mostrarán
        en la salida del comando <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a>, incluso si tiene
        un límite de cuota asignado para esos sistemas
        de fichero.  La opción <code class="option">-v</code>
        desplegará esos sistemas de ficheros, en nuestro ejemplo
        el sistema de ficheros <code class="filename">/usr/var</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp78448720"></a>18.14.4. Cuotas en NFS</h3></div></div></div><a id="idp78449360" class="indexterm"></a><p>Las cuotas son impuestas por el subsistema de cuotas en el
        servidor NFS.  El dæmon <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rpc.rquotad&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rpc.rquotad</span>(8)</span></a> facilita la
        información a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a> en los clientes
        NFS, permitiéndoles a los usuarios de esas máquinas
        ver sus estadísticas de cuota.</p><p>Habilite  <code class="command">rpc.rquotad</code> en
	<code class="filename">/etc/inetd.conf</code> del siguiente modo:</p><pre class="programlisting">rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</pre><p>Y reinicie <code class="command">inetd</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP `cat /var/run/inetd.pid`</code></strong></pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="snapshots.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="disks-encrypting.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">18.13. Instantáneas (<span class="quote">&#8220;<span class="quote">snapshots</span>&#8221;</span>) de sistemas
      de ficheros </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 18.15. Cifrado de particiones de disco</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>