<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>14.11. OpenSSH</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="security.html" title="Capítulo 14. Seguridad" /><link rel="prev" href="ipsec.html" title="14.10. VPN sobre IPsec" /><link rel="next" href="fs-acl.html" title="14.12. Listas de control de acceso a sistemas de ficheros" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.11. OpenSSH</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ipsec.html">Anterior</a> </td><th width="60%" align="center">Capítulo 14. Seguridad</th><td width="20%" align="right"> <a accesskey="n" href="fs-acl.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="openssh"></a>14.11. OpenSSH</h2></div><div><span class="authorgroup">Escrito por <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div></div></div><a id="idp76364624" class="indexterm"></a><a id="idp76365136" class="indexterm"></a><p><span class="application">OpenSSH</span> es un conjunto de herramientas
      de conectividad que se usan para acceder a sistemas remotos de
      forma segura.  Puede usarse como sustituto directo de
      <code class="command">rlogin</code>,
      <code class="command">rsh</code>, <code class="command">rcp</code> y
      <code class="command">telnet</code>.  Además cualquier otra conexión
      TCP/IP puede reenviarse o enviarse a través de un túnel a
      través de SSH.
      <span class="application">OpenSSH</span> cifra todo el tráfico para
      eliminar de forma efectiva el espionaje, el secuestro de conexiones, y
      otros ataques en la capa de red.</p><p><span class="application">OpenSSH</span> está a cargo del proyecto
      OpenBSD, y está basado en SSH v1.2.12, con todos los errores
      recientes corregidos y todas las actualizaciones correspondientes.
      Es compatible con los protocolos SSH 1 y 2.
      <span class="application">OpenSSH</span> forma parte del sistema base desde
      FreeBSD 4.0.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76370000"></a>14.11.1. Ventajas de utilizar OpenSSH</h3></div></div></div><p>Normalmente, al utilizar <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=telnet&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">telnet</span>(1)</span></a> o <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rlogin&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rlogin</span>(1)</span></a>
        los datos se envían a través de la red en limpio,
        es decir, sin cifrar.  Cualquier <span class="quote">&#8220;<span class="quote">sniffer</span>&#8221;</span> de red
        entre el cliente y el servidor puede robar la información
        de usuario/contraseña o los datos transferidos durante
        su sesión.  <span class="application">OpenSSH</span> ofrece
        diversos métodos de validación y cifrado para
	evitar que sucedan estas cosas.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76373456"></a>14.11.2. Habilitar sshd</h3></div></div></div><a id="idp76374096" class="indexterm"></a><p>El dæmon <span class="application">sshd</span> está
        habilitado por defecto FreeBSD 4.X y puede elegir habilitarlo
        o no durante la instalación en FreeBSD 5.X.  Si quiere
	saber si está habilitado revise si la siguiente
        línea está en <code class="filename">rc.conf</code>:</p><pre class="screen">sshd_enable="YES"</pre><p>Esta línea  cargará <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a>, el programa
        dæmon de <span class="application">OpenSSH</span>, en el arranque
        de su sistema.  Puede ejecutar el dæmon
        <span class="application">sshd</span> tecleando
        <code class="command">sshd</code> en la línea de órdenes.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76395728"></a>14.11.3. Cliente SSH</h3></div></div></div><a id="idp76396368" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> funciona de manera
        similar a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rlogin&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rlogin</span>(1)</span></a>.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ssh user@example.com</code></strong>
Host key not found from the list of known hosts.
Are you sure you want to continue connecting (yes/no)? <strong class="userinput"><code>yes</code></strong>
Host 'ejemplo.com' added to the list of known hosts.
usuario@ejemplo.com's password: <strong class="userinput"><code>*******</code></strong></pre><p>El login continuará como lo haría si fuera
        una sesión de <code class="command">rlogin</code> o
        <code class="command">telnet</code>.  SSH utiliza un sistema de huellas de
        llaves para verificar la autenticidad del servidor cuando el
        cliente se conecta.  Se le pide al usuario que introduzca
        <code class="literal">yes</code> solamente la primera vez que se
        conecta.  Todos los intentos futuros de login se verifican
        contra la huella de la llave guardada la primera vez.
	El cliente SSH le alertará si la huella guardada difiere
        de la huella recibida en futuros intentos de acceso al sistema.
        Las huellas se guardan en
        <code class="filename">~/.ssh/known_hosts</code>, y en
        <code class="filename">~/.ssh/known_hosts2</code> las huellas
        SSH v2.</p><p>Por defecto las versiones recientes de
        los servidores <span class="application">OpenSSH</span> solamente
        aceptan conexiones SSH v2.  El cliente utilizará la
        versión 2 si es posible y pasará como
        respaldo a la versión 1.  El cliente puede también
        ser obligado a utilizar una u otra pasándole
	<code class="option">-1</code> o <code class="option">-2</code>, respectivamente para
        la versión 1 y la  versión 2.  Se mantiene la
	compatibilidad del cliente con la versión 1 para
        mantener la compatibilidad con versiones antiguas.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76413264"></a>14.11.4. Copia segura</h3></div></div></div><a id="idp76413904" class="indexterm"></a><a id="idp76415056" class="indexterm"></a><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a> funciona de manera muy similar a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rcp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rcp</span>(1)</span></a>;
        copia un fichero desde o hacia un sistema remoto, con la
	diferencia de que lo hace de una forma segura.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code> scp usuario@ejemplo.com:/COPYRIGHT COPYRIGHT</code></strong>
usuario@ejemplo.com's password: <strong class="userinput"><code>*******</code></strong>
COPYRIGHT            100% |*****************************|  4735
00:00
<code class="prompt">#</code></pre><p>Ya que la huella se guardó en este equipo durante
        el ejemplo anterior se verifica ahora al utilizar
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a>.</p><p>Los argumentos de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a> son similares
        a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cp</span>(1)</span></a>, con el fichero o ficheros como primer
        argumento, y el destino como segundo.  Ya que el fichero
        se transfiere a través de la red, a través de
        SSH, uno o más argumentos tienen la estructura
	<code class="option">user@host:&lt;ruta_al_fichero_remoto&gt;</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76422992"></a>14.11.5. Configuración</h3></div></div></div><a id="idp76423760" class="indexterm"></a><p>Los ficheros de configuración del sistema
        tanto para el dæmon <span class="application">OpenSSH</span>
        como para el cliente están en
	<code class="filename">/etc/ssh</code>.</p><p><code class="filename">ssh_config</code> contiene las opciones
        del cliente, mientras que <code class="filename">sshd_config</code>
        configura el dæmon.</p><p>Además las opciones <code class="option">sshd_program</code>
        (<code class="filename">/usr/sbin/sshd</code> por defecto),
        y <code class="option">sshd_flags</code> de <code class="filename">rc.conf</code>
        ofrecer más niveles de configuración.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-ssh-keygen"></a>14.11.6. ssh-keygen</h3></div></div></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a> le permite validar a un usuario sin
        pedirle la contraseña:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh-keygen -t dsa</code></strong>
Generating public/private dsa key pair.
Enter file in which to save the key (/home/user/.ssh/id_dsa):
Created directory '/home/user/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/user/.ssh/id_dsa.
Your public key has been saved in /home/user/.ssh/id_dsa.pub.
The key fingerprint is:
bb:48:db:f2:93:57:80:b6:aa:bc:f5:d5:ba:8f:79:17 usuario@host.ejemplo.com
</pre><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a> creará un par de llaves
        pública y privada para usar en la validación.
        La llave privada se guarda en
        <code class="filename">~/.ssh/id_dsa</code> o en
        <code class="filename">~/.ssh/id_rsa</code>, mientras que la llave
        pública se guarda en <code class="filename">~/.ssh/id_dsa.pub</code>
        o en <code class="filename">~/.ssh/id_rsa.pub</code>, respectivamente para
        llaves DSA y RSA.  La llave pública debe guardarse en
        el <code class="filename">~/.ssh/authorized_keys</code> de la
        máquina remota para que la configuración funcione.
        Las llaves RSA versión 1 deben guardarse en
        <code class="filename">~/.ssh/authorized_keys</code>.</p><p>De este modo permitirá conexiones a la máquina
        remota mediante llaves SSH en lugar de contraseñas.</p><p>Si usa una contraseña al ejecutar <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a>, se
        le pedirá al usuario una contraseña cada
        vez que quiera utilizar la llave privada.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a>
        puede evitar la molestia de introducir repetidamente
        frases largas.   esto se explica  má adelante, en la
        <a class="xref" href="openssh.html#security-ssh-agent" title="14.11.7. ssh-agent y ssh-add">Sección 14.11.7, &#8220;ssh-agent y ssh-add&#8221;</a>.</p><div xmlns="" class="warning"><h3 class="admontitle">Aviso: </h3><p xmlns="http://www.w3.org/1999/xhtml">Las opciones y ficheros pueden ser
        diferentes según la versión de
	<span class="application">OpenSSH</span> que tenga en su sistema;  para
	evitar problemas consulte la página de manual
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-ssh-agent"></a>14.11.7. ssh-agent y ssh-add</h3></div></div></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> y <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-add&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-add</span>(1)</span></a> ofrecen
        métodos para que las llaves <span class="application">SSH</span>
        se puedan cargar en memoria, permitiendo eliminar la necesidad de
	teclear la contraseña cada vez que haga falta.</p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> gestionará la
        validación utilizando la llave (o llaves) privada que
        le cargue.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> se usa para lanzar otras
        aplicaciones.  En el nivel más básico
        puede generar una shell o a un nivel más avanzado un
        gestor de ventanas.</p><p>Para usar <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> en una shell necesitará
        primero ser invocado como argumento por una shell.  Segundo,
        añada la identidad ejecutando <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-add&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-add</span>(1)</span></a> y facilitando
        la contraseña de la llave privada.  Completados estos
        pasos el usuario puede hacer <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> a cualquier equipo
        que tenga instalada la llave pública correspondiente.
        Por ejemplo:</p><pre class="screen"><code class="prompt">%</code> ssh-agent <em class="replaceable"><code>csh</code></em>
<code class="prompt">%</code> ssh-add
Enter passphrase for /home/user/.ssh/id_dsa:
Identity added: /home/user/.ssh/id_dsa (/home/user/.ssh/id_dsa)
<code class="prompt">%</code></pre><p>Para utilizar <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> en X11 tendrá que
        incluir una llamada a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> en
        <code class="filename">~/.xinitrc</code>.  De este modo ofrecerá
        los servicios de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> a todos los programas
	lanzados en X11.  Veamos un ejemplo de
        <code class="filename">~/.xinitrc</code>:</p><pre class="programlisting">exec ssh-agent <em class="replaceable"><code>startxfce4</code></em></pre><p>Esto lanzaría <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a>, que a su
        vez lanzaría <span class="application">XFCE</span> cada
        vez que inicie X11.  Hecho esto y una vez reiniciado X11
        para aplicar los cambios puede ejecutar <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-add&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-add</span>(1)</span></a> para
	cargar todas sus llaves SSH.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="security-ssh-tunneling"></a>14.11.8. Túneles SSH</h3></div></div></div><a id="idp76469200" class="indexterm"></a><p><span class="application">OpenSSH</span> permite crear un túnel
        en el que encapsular otro protocolo en una sesión
	cifrada.</p><p>La siguiente orden le dice a <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> que cree un
        túnel para <span class="application">telnet</span>:</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L 5023:localhost:23 usuario@foo.ejemplo.com</code></strong>
<code class="prompt">%</code></pre><p>Veamos las opciones que se le han suministrado a
        <code class="command">ssh</code>:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-2</code></span></dt><dd><p>Obliga a <code class="command">ssh</code> a utilizar la
              versión 2 del protocolo.  (No la use si
              está trabajando con servidores SSH antiguos)</p></dd><dt><span class="term"><code class="option">-N</code></span></dt><dd><p>Indica que no se ejecutará una orden remota, o
	      solamente túnel.  Si se omite,
              <code class="command">ssh</code> iniciaría una sesión
              normal.</p></dd><dt><span class="term"><code class="option">-f</code></span></dt><dd><p>Obliga a <code class="command">ssh</code> a ejecutarse
              en segundo plano.</p></dd><dt><span class="term"><code class="option">-L</code></span></dt><dd><p>Indica un túnel local según el esquema
              <em class="replaceable"><code>puerto local:equipo remoto:puerto remoto</code></em>.</p></dd><dt><span class="term"><code class="option">usuario@foo.ejemplo.com</code></span></dt><dd><p>El servidor SSH remoto.</p></dd></dl></div><p>Un túnel SSH crea un socket que escucha
         en <code class="systemitem">localhost</code> en el puerto especificado.
         Luego reenvía cualquier conexión
         recibida en el puerto/equipo local vía la
         conexión SSH al puerto o equipo remoto especificado.</p><p>En el ejemplo el puerto <em class="replaceable"><code>5023</code></em> en
        <code class="systemitem">localhost</code> se reenvía al puerto
        <em class="replaceable"><code>23</code></em> del <code class="systemitem">localhost</code>
        de la máquina remota.  Ya que <em class="replaceable"><code>23</code></em>
        es <span class="application">telnet</span>, esto crearía una
	sesión <span class="application">telnet</span> segura a
        través de un túnel SSH.</p><p>Puede usar esto para encapsular cualquier otro
        protocolo TCP inseguro como SMTP, POP3, FTP, etc.</p><div class="example"><a id="idp76497488"></a><div class="example-title">Ejemplo 14.1. Uso de SSH para crear un túnel seguro para SMTP</div><div class="example-contents"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L 5025:localhost:25 usuario@correo.ejemplo.com</code></strong>
usuario@correo.ejemplo.com's password: <strong class="userinput"><code>*****</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>telnet localhost 5025</code></strong>
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
220 correo.ejemplo.com ESMTP</pre><p>Puede usar esta técnica junto con <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a>
	  y cuentas adicionales de usuario para crear un entorno
	  más transparente, esto es, más cómodo.
	  Puede usar llaves en lugar de teclear contraseñas y
	  puede ejecutar los túneles de varios usuarios.</p></div></div><br class="example-break" /><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76501712"></a>14.11.8.1. Ejemplos prácticos de túneles SSH</h4></div></div></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76502352"></a>14.11.8.1.1. Acceso seguro a un servidor POP3</h5></div></div></div><p>En el trabajo hay un servidor SSH que acepta
            conexiones desde el exterior.  En la misma red de la
            oficina reside un servidor de correo que ejecuta un
            servidor POP3.  La red, o ruta de red entre su casa y
            oficina puede o no ser completamente de fiar.  Debido
            a esto necesita revisar su correo electrónico
            de forma segura.  La solución es crear una
            conexión SSH al servidor SSH de su oficina y
            llegar por un túnel al servidor de correo.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L 2110:correo.ejemplo.com:110 usuario@servidor-ssh.ejemplo.com</code></strong>
usuario@servidor-ssh.ejemplo.com's password: <strong class="userinput"><code>******</code></strong></pre><p>cuando el túnel esté funcionando
            haga que su cliente de correo envíe peticiones
            POP3 a <code class="systemitem">localhost</code> en el puerto 2110.
            La conexión será reenviada de forma totalmente
            segura a traveés del túnel a
	    <code class="systemitem">correo.ejemplo.com</code>.</p></div><div class="sect4"><div xmlns="" class="titlepage"><div><div><h5 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76505936"></a>14.11.8.1.2. Saltarse un cortafuegos draconiano</h5></div></div></div><p>Algunos administradores de red imponen reglas de
            cortafuegos extremadamente draconianas, filtrando no
            solo las conexiones entrantes, sino también
            las salientes.  Tal vez solo se le otorgue acceso
            a máquinas remotas a través de los puertos 22
            y 80 para ssh y navegar en web.</p><p>Tal vez quiera acceder a otros servicios
	    (que tal vez ni siquiera estén relacionados con el
	    trabajo), como un servidor Ogg Vorbis para escuchar
	    música.  Si ese servidor Ogg Vorbis transmite en
	    un puerto que no sea el 22 o el 80 no podrá tener
	    acceso a él.</p><p>La solución es crear una conexión SSH
            fuera del cortafuegos de su red y utilizarla para hacer un
            túnel al servidor Ogg Vorbis.</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ssh -2 -N -f -L 8888:musica.ejemplo.com:8000 usuario@sistema-no-filtrado.ejemplo.org</code></strong>
usuario@sistema-no-filtrado.ejemplo.org's password: <strong class="userinput"><code>*******</code></strong></pre><p>Haga que el programa con el que suele escuchar
	    música haga peticiones a
            <code class="systemitem">localhost</code> puerto 8888, que será
            reenviado a <code class="systemitem">musica.ejemplo.com</code>
            puerto 8000, evadiendo con éxito el cortafuegos.</p></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76510800"></a>14.11.9. La opción de usuarios <code class="varname">AllowUsers</code></h3></div></div></div><p>Limitar qué usuarios pueden entrar y desde dónde
        suele ser razonable.  La opción
        <code class="literal">AllowUsers</code> le permite configurarlo, por
        ejemplo, para permitir entrar solamente al usuario
        <code class="systemitem">root</code> desde
        <code class="systemitem">192.168.1.32</code>.  Puede hacerlo
	con algo parecido a esto en
        <code class="filename">/etc/ssh/sshd_config</code>:</p><pre class="programlisting">AllowUsers root@192.168.1.32</pre><p>Para permitir al usuario <code class="systemitem">admin</code> la
        entrada desde cualquier lugar, solamente introduzca el nombre
        de usuario:</p><pre class="programlisting">AllowUsers admin</pre><p>Puede listar múltiples usuarios en la misma
        línea:</p><pre class="programlisting">AllowUsers root@192.168.1.32 admin</pre><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Es importante que incluya a cada usuario que necesite entrar
          a esta máquina o no podrán entrar.</p></div><p>Después de hacer los cambios a b
        <code class="filename">/etc/ssh/sshd_config</code> debe decirle a
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> que cargue de nuevo sus ficheros de
        configuración ejecutando:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/sshd reload</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp76519888"></a>14.11.10. Lecturas complementarias</h3></div></div></div><p><a class="link" href="http://www.openssh.com/" target="_top">OpenSSH</a></p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=scp&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">scp</span>(1)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-keygen</span>(1)</span></a>
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-agent&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-agent</span>(1)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh-add&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ssh-add</span>(1)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ssh_config&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">ssh_config</span>(5)</span></a></p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sshd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sshd</span>(8)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sftp-server&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sftp-server</span>(8)</span></a> <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sshd_config&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">sshd_config</span>(5)</span></a></p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ipsec.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="security.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="fs-acl.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">14.10. VPN sobre IPsec </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 14.12. Listas de control de acceso a sistemas de ficheros</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>