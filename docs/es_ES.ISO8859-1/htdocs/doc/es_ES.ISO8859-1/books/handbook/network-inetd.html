<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>29.14. El &#8220;Superservidor&#8221; inetd</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manual de FreeBSD" /><link rel="up" href="advanced-networking.html" title="Capítulo 29. Networking avanzado" /><link rel="prev" href="network-natd.html" title="29.13. Traducción de direcciones de red" /><link rel="next" href="network-plip.html" title="29.15. Línea IP paralela (PLIP)" /><link rel="copyright" href="legalnotice.html" title="Aviso Legal" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.14. El <span class="quote">&#8220;<span class="quote">Superservidor</span>&#8221;</span> <span class="application">
      inetd</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-natd.html">Anterior</a> </td><th width="60%" align="center">Capítulo 29. Networking avanzado</th><td width="20%" align="right"> <a accesskey="n" href="network-plip.html">Siguiente</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-inetd"></a>29.14. El <span class="quote">&#8220;<span class="quote">Superservidor</span>&#8221;</span> <span class="application">
      inetd</span></h2></div><div><span class="authorgroup">Escrito por <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-overview"></a>29.14.1. Resumen</h3></div></div></div><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> se conoce como el <span class="quote">&#8220;<span class="quote">Super Servidor de
        Internet</span>&#8221;</span> debido a que gestiona las conexiones de
        varios dæmones.  Los dæmones son programas que
	proporcionan servicios de red.
        <span class="application">inetd</span> actúa como un servidor de
        servidor de gestión de otros dæmones.  Cuando
        <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> recibe una conexión se determina qué
        dæmon debería responder a dicha conexión, se lanza
	un proceso que ejecuta dicho dæmon y se le entrega el <span class="quote">&#8220;<span class="quote">
	socket</span>&#8221;</span>.  La ejecución de una única instancia de
        <span class="application">inetd</span> reduce la carga del sistema en
        comparación con lo que significaría ejecutar cada uno de
        los dæmones que gestiona de forma individual.</p><p><span class="application">inetd</span> se utiliza principalmente para
         lanzar procesos que albergan a otros dæmones pero
         <span class="application">inetd</span> también se utiliza para
         gestionar determinados protocolos triviales como
         <span class="application">chargen</span>,
            <span class="application">auth</span> y
            <span class="application">daytime</span>.</p><p>Esta sección trata la configuración básica de
        <span class="application">inetd</span> a través de sus opciones de
        línea de órdenes y utilizando su fichero de
            configuración, denominado
            <code class="filename">/etc/inetd.conf</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-settings"></a>29.14.2. Configuraciones</h3></div></div></div><p><span class="application">inetd</span> se inicializa a través
        del fichero <code class="filename">/etc/rc.conf</code> en tiempo de
        arranque.  La opción <code class="literal">inetd_enable</code> posee el
        valor <code class="literal">NO</code> por defecto, pero a menudo la
        aplicación <span class="application">sysinstall</span> la activa
        cuando se utiliza la configuración de perfil de seguridad
        medio.
	Estableciendo </p><pre class="programlisting">inetd_enable="YES"</pre><p> o
	</p><pre class="programlisting">inetd_enable="NO"</pre><p> dentro de
	<code class="filename">/etc/rc.conf</code> se puede activar o desactivar la
        la ejecución de
        <span class="application">inetd</span> en el arranque del
	sistema.</p><p>Se pueden además aplicar distintas opciones de
        línea de órdenes mediante la opción
        <code class="literal">inetd_flags</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-cmdline"></a>29.14.3. Opciones de línea de órdenes</h3></div></div></div><p><span class="application">sinopsis de inetd</span>:</p><p><code class="option">     inetd [-d] [-l] [-w] [-W] [-c máximo] [-C tasa] [-a dirección | nombre_de_host]
           [-p nombre_de_fichero] [-R tasa] [fichero de configuración ]</code></p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-d</span></dt><dd><p>Activa la depuración.</p></dd><dt><span class="term">-l</span></dt><dd><p>Activa el <span class="quote">&#8220;<span class="quote">logging</span>&#8221;</span> de las conexiones
	      efectuadas con écute.</p></dd><dt><span class="term">-w</span></dt><dd><p>Activa el recubrimiento de TCP para servicios
                  externos (activado por defecto).</p></dd><dt><span class="term">-W</span></dt><dd><p>Activa el recubrimiento de TCP para los servicios
              internos, ejecutados directamente por el dæmon
              <span class="application">inetd</span> (activado por defecto).</p></dd><dt><span class="term">-c máximo</span></dt><dd><p>Especifica el máximo número de invocaciones
              simultáneas de cada servicio; el valor por defecto es
              ilimitado.  Se puede sobreescribir para cada servicio utilizando
              la opción <code class="option">max-child</code>.</p></dd><dt><span class="term">-C tasa</span></dt><dd><p>Especifica el máximo número de veces que se
              puede llamar a un servicio desde un dirección IP
              determinada por minuto; el valor por defecto es ilimitado.  Se
              puede redefinir para cada servicio utilizando la opción
	      <code class="option">max-connections-per-ip-per-minute</code>.</p></dd><dt><span class="term">-R tasa</span></dt><dd><p>Especifica el máximo número de veces que se
              puede invocar un servicio en un minuto; el valor por defecto es
              256.  Un valor de 0 permite un número ilimitado de
              llamadas.</p></dd><dt><span class="term">-a</span></dt><dd><p>Especifica una dirección IP a la cual se asocia y
              sobre la cual se queda esperando recibir conexiones.  Puede
              declararse también un nombre de máquina, en cuyo
              caso se utilizará la dirección (o direcciones si
	      hay más de una) IPv4 o IPv6 que estén tras dicho
              nombre.  Normalmente se usa un nombre de
              máquina cuando <span class="application">inetd</span> se
              ejecuta dentro de un <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>, en cuyo caso el nombre de
              máquina se corresponde con el entorno
              <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=jail&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">jail</span>(8)</span></a>.</p><p>Cuando se desea asociarse tanto a direcciones IPv4 como a
              direcciones IPv6 y se utiliza un nombre de máquina se
              necesita una entrada para cada protocolo (IPv4 o IPv6) para cada
              servicio que se active a través de <code class="filename">
              /etc/inetd.conf</code>.  Por ejemplo un servicio basado en
              TCP necesitaría dos entradas, una utilizando
              <code class="literal">tcp4</code> para el protocolo IPv4 y otra con
              <code class="literal">tcp6</code> para las conexiones a través del
              procolo de red IPv6.</p></dd><dt><span class="term">-p</span></dt><dd><p>Especifica un fichero alternativo en el cual se guarda el
              ID del proceso.</p></dd></dl></div><p>Estas opciones se pueden declarar dentro de las variables
	<code class="literal">inetd_flags</code> del fichero
	<code class="filename">/etc/rc.conf</code>.  Por defecto
	<code class="literal">inetd_flags</code> tiene el valor <code class="literal">-wW</code>,
	lo que activa el recubrimiento de TCP para los servicios internos y
        externos de <span class="application">inetd</span>.  Los usuarios inexpertos
        no suelen introducir estos parámetros y por ello ni siquiera
        necesitan especificarse dentro de <code class="filename">
        /etc/rc.conf</code>.</p><div xmlns="" class="note"><h3 class="admontitle">Nota: </h3><p xmlns="http://www.w3.org/1999/xhtml">Un servicio externo es un dæmon que se ejecuta fuera de
          <span class="application">inetd</span> y que se lanza cuando se recibe
          un intento de conexión.  Un servicio interno es un servicio
          que <span class="application">inetd</span> puede servir directamente sin
          necesidad de lanzar nuevos procesos.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-conf"></a>29.14.4. <code class="filename">inetd.conf</code></h3></div></div></div><p>La configuración de
        <span class="application">inetd</span> se realiza a través del
        ficherode configuración <code class="filename">
	/etc/inetd.conf</code>.</p><p>Cuando se realiza una modificación en el fichero
	<code class="filename">/etc/inetd.conf</code> se debe obligar a
        <span class="application">inetd</span> a releer dicho fichero de
        configuración, lo cual se realiza enviando una señal
        <span class="quote">&#8220;<span class="quote">HANGUP</span>&#8221;</span> al proceso <span class="application">inetd</span>
        como se muestra a continuación:</p><div class="example"><a id="network-inetd-hangup"></a><div class="example-title">Ejemplo 29.4. Envío de una señal HANGUP a
	  <span class="application">inetd</span></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP `cat /var/run/inetd.pid`</code></strong></pre></div></div><br class="example-break" /><p>Cada línea del fichero de configuración especifica un
        dæmon individual.  Los comentarios se preceden por el
        caracter <span class="quote">&#8220;<span class="quote">#</span>&#8221;</span>.  El formato del fichero de
        configuración <code class="filename">/etc/inetd.conf</code> es el
	siguiente:</p><pre class="programlisting">service-name
socket-type
protocol
{wait|nowait}[/max-child[/max-connections-per-ip-per-minute]]
user[:group][/login-class]
server-program
server-program-arguments</pre><p>A continuación se muestra una entrada de ejemplo para el
        dæmon <span class="application">ftpd</span> para IPv4:</p><pre class="programlisting">ftp     stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -l</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">service-name</span></dt><dd><p>Este es el nombre del servicio que proporciona un
              determinado dæmon.  Se debe corresponder con el nombre del
              nombre de servicio que se declara en el fichero
	      <code class="filename">/etc/services</code>.  Este fichero determina sobre
              qué puerto debe ponerse a escuchar
              <span class="application">inetd</span>.  Si se crea un nuevo servicio
              se debe especificar primero en
              <code class="filename">/etc/services</code>.</p></dd><dt><span class="term">socket-type</span></dt><dd><p>Puede ser <code class="literal">stream</code>,
	      <code class="literal">dgram</code>, <code class="literal">raw</code> o
	      <code class="literal">seqpacket</code>.  <code class="literal">stream</code>
	      se debe utilizar obligatoriamente para dæmones orientados
              a conexión (dæmones TCP) mientras que
	      <code class="literal">dgram</code> se utiliza en dæmones basados en
              el protocolo de transporte UDP.</p></dd><dt><span class="term">protocol</span></dt><dd><p>Uno de los siguientes:</p><div class="informaltable"><table border="1"><colgroup><col /><col /></colgroup><thead><tr><th>Protocolo</th><th>Explicación</th></tr></thead><tbody><tr><td>tcp, tcp4</td><td>TCP IPv4</td></tr><tr><td>udp, udp4</td><td>UDP IPv4</td></tr><tr><td>tcp6</td><td>TCP IPv6</td></tr><tr><td>udp6</td><td>UDP IPv6</td></tr><tr><td>tcp46</td><td>TCP IPv4 e IPv6 al mismo tiempo</td></tr><tr><td>udp46</td><td>UDP IPv4 e IPv6 al mismo tiempo</td></tr></tbody></table></div></dd><dt><span class="term">{wait|nowait}[/max-child[/max-connections-per-ip-per-minute]]</span></dt><dd><p><code class="option">wait|nowait</code> indica si el dæmon puede
              gestionar su propio <span class="quote">&#8220;<span class="quote">socket</span>&#8221;</span> o no.  Los <span class="quote">&#8220;<span class="quote">
              sockets</span>&#8221;</span> de tipo <code class="option">dgram</code> deben utilizar
              obigatoriamente la opción <code class="option">wait</code> mientras
	      que los dæmones basados en <span class="quote">&#8220;<span class="quote">sockets</span>&#8221;</span> de tipo
              <span class="quote">&#8220;<span class="quote">stream</span>&#8221;</span>, los cuales se implementan normalmente
              mediante hilos, debería utilizar la opción
              <code class="option">nowait</code>. La opción
              <code class="option">wait</code> normalmente entrega varios <span class="quote">&#8220;<span class="quote">
              sockets</span>&#8221;</span> a un único dæmon, mientras que la
	      opción <code class="option">nowait</code> lanza un dæmon
              <span class="quote">&#8220;<span class="quote">hijo</span>&#8221;</span> por cada nuevo <span class="quote">&#8220;<span class="quote">
	      socket</span>&#8221;</span>.</p><p>El número máximo de dæmones <span class="quote">&#8220;<span class="quote">
	      hijo</span>&#8221;</span> que puede lanzar
	      <span class="application">inetd</span> se puede especificar mediante
              la opción <code class="option">max-child</code>.  Si se necesita por
              ejemplo un límite de diez instancias para un dæmon
              en particular se puede especificar el valor
              <code class="literal">10</code> justo después de la opción
              <code class="option">nowait</code>.</p><p>Además de <code class="option">max-child</code> se puede activar
              otra opción para limitar en número máximo de
              conexiones que se aceptan desde un determinado lugar mediante la
              opción
              <code class="option">max-connections-per-ip-per-minute</code>.
              Esta opción hace justo lo que su nombre indica.  Un
              valor de, por ejemplo, diez en esta opción
	      limitaría cualquier máquina remota a un
              máximo de diez intentos de conexión por
              minuto.  Esto resulta útil para prevenir un consumo
              incontrolado de recursos y ataques de Denegación de
              Servicio (<span class="quote">&#8220;<span class="quote">Denial of Service</span>&#8221;</span> o DoS) sobre nuestra
              máquina.</p><p>Cuando se especifica este campo las opciones
              <code class="option">wait</code> o <code class="option">nowait</code> son
	      obligatorias  <code class="option">max-child</code> y
	      <code class="option">max-connections-per-ip-per-minute</code> son
	      opcionales.</p><p>Un dæmon de tipo <span class="quote">&#8220;<span class="quote">stream</span>&#8221;</span> sin la
              opción <code class="option">max-child</code> y sin la opción
              <code class="option">max-connections-per-ip-per-minute</code>
              simplemente especificaría la opción
	      <code class="literal">nowait</code>.</p><p>El mismo dæmon con el límite máximo de
              diez dæmones <span class="quote">&#8220;<span class="quote">hijos</span>&#8221;</span> sería:
	      <code class="literal">nowait/10</code>.</p><p>La misma configuración con un límite
              de veinte conexiones por dirección IP por minuto y un
              máximo total de diez dæmones <span class="quote">&#8220;<span class="quote">hijos</span>&#8221;</span>
	      sería:
	      <code class="literal">nowait/10/20</code>.</p><p>Todas estas opciones son utilizadas por el dæmon
                  <span class="application">fingerd</span> que se muestra a
                  continuación a modo de ejemplo:</p><pre class="programlisting">finger stream  tcp     nowait/3/10 nobody /usr/libexec/fingerd fingerd -s</pre></dd><dt><span class="term">user</span></dt><dd><p>Este es el nombre de usuario con el que debería
              ejecutarse un determinado dæmon.  Normalmente los
              dæmones se suelen ejectar con permisos de
              <code class="systemitem">root</code>.  Por motivos de seguridad, resulta
              bastante común encontrarse con algunos servidores que se
              ejecutan bajo el usuario <code class="systemitem">daemon</code> o incluso
              por el usuario menos privilegiado de todos que es el usuario
              <code class="systemitem">nobody</code>.</p></dd><dt><span class="term">server-program</span></dt><dd><p>La ruta completa de la localización del dæmon
              que se quiere ejecutar cuando se recibe un intento de
              conexión.  Si el dæmon  es un servicio
              proporcionado por el propio <span class="application">inetd</span> se
              debe utilizar la opcion <code class="option">internal</code> en su
              lugar.</p></dd><dt><span class="term">server-program-arguments</span></dt><dd><p>Esto funciona en conjunción con
	      <code class="option">server-program</code>, ya que especifica los
               argumentos, comenzando por
               <code class="literal">argv[0]</code>, que se pasan al dæmon
               cuando se le invoca.  Si la línea de órdenes es
               <code class="command">mydaemon -d</code>, <code class="literal">midæmon
                -d</code> debería ser el valor de la opción
                <code class="option">server-program-arguments</code>. Si el
               dæmon es un servicio interno se debe utilizar la
               utilizar la opción <code class="option">internal</code> en lugar de
               la que estamos comentando.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-security"></a>29.14.5. Seguridad</h3></div></div></div><p>Dependiendo del perfil de seguridad establecido cuando se
        instaló el sistema FreeBSD  varios dæmones de
        <span class="application">inetd</span> pueden estar desactivados o
        activados.  Si no se necesita un dæmon determinado, <span class="emphasis"><em>
        no lo active</em></span>.  Especifique un <span class="quote">&#8220;<span class="quote">#</span>&#8221;</span> al
	comienzo de la línea del dæmon que quiere desactivar y
        envíe una señal <a class="link" href="network-inetd.html#network-inetd-hangup" title="Ejemplo 29.4. Envío de una señal HANGUP a inetd">hangup</a> a
        <span class="application">inetd</span>.  No se aconseja ejecutar algunos
        dæmones determinados (un caso típico es
        <span class="application">fingerd</span>) porque pueden proporcionar
        información valiosa para un atacante.</p><p>Algunos dæmones no presentan ninguna característica de
        seguridad y poseen grandes o incluso no poseen tiempos de
        expiración para los intentos de conexión.  Esto permite
        que un atacante sature los recursos de nuestra máquina
        realizando intentos de conexión a una tasa relativamente baja
        contra uno de estos ingenuos dæmones.  Pueder ser una buena
        idea protegerse de esto utilizando las opciones
   	<code class="option">max-connections-per-ip-per-minute</code> y <code class="option">
	max-child</code> para este tipo de dæmones.</p><p>El recubrimiento de TCP está activado por defecto tal y como
        ya se ha comentado anteriormente.  Consulte la página
        del manual de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a> para obtener más
        información sobre cómo aplicar restricciones
        relacionadas con TCP a los dæmones invocados por
        <span class="application">inetd</span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-misc"></a>29.14.6. Varios</h3></div></div></div><p><span class="application">daytime</span>,
	<span class="application">time</span>,
	<span class="application">echo</span>,
	<span class="application">discard</span>,
	<span class="application">chargen</span> y
	<span class="application">auth</span> son servicios que
        <span class="application">inetd</span> proporciona de forma
        interna y propia.</p><p>El servicio <span class="application">auth</span> proporciona
        servicios de identificación a través de la red
	(<span class="application">ident</span>,
            <span class="application">identd</span>) y se puede configurar
            hasta en cierto grado.</p><p>Consulte la página del manual de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> si quiere
        conocer todos los detalles.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-natd.html">Anterior</a> </td><td width="20%" align="center"><a accesskey="u" href="advanced-networking.html">Subir</a></td><td width="40%" align="right"> <a accesskey="n" href="network-plip.html">Siguiente</a></td></tr><tr><td width="40%" align="left" valign="top">29.13. Traducción de direcciones de red </td><td width="20%" align="center"><a accesskey="h" href="index.html">Inicio</a></td><td width="40%" align="right" valign="top"> 29.15. Línea IP paralela (PLIP)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Puede descargar éste y muchos otros documentos desde
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Si tiene dudas sobre FreeBSD consulte la
    <a href="http://www.FreeBSD.org/docs.html">documentación</a> antes de escribir a la lista
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Envíe sus preguntas sobre la documentación a
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>