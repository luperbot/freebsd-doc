<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>6.5. Limiter l'environnement de votre programme</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Livre de chevet du développeur FreeBSD" /><link rel="up" href="secure.html" title="Chapitre 6. Programmation sécurisée" /><link rel="prev" href="ch06s04.html" title="6.4. Les problèmes liés à SetUID" /><link rel="next" href="ch06s06.html" title="6.6. La confiance" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.5. Limiter l'environnement de votre programme</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch06s04.html">Précédent</a> </td><th width="60%" align="center">Chapitre 6. Programmation sécurisée</th><td width="20%" align="right"> <a accesskey="n" href="ch06s06.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="chroot"></a>6.5. Limiter l'environnement de votre programme</h2></div></div></div><p>La méthode traditionnelle pour restreindre l'accès d'un processus
      se fait avec l'appel système <code class="function">chroot()</code>. Cet appel
      système change le répertoire racine depuis lequel tous les autres chemins
      sont référencés pour un processus et ses fils. Pour que cet appel
      réussisse, le processus doit avoir exécuté (recherché)
      la permission dans le répertoire référencé. Le nouvel environnement
      environment ne prend pas effet que lorsque vous appelez <code class="function">chdir()</code>
      dans celui-ci.
      Il doit être aussi noté qu'un processus peut facilement s'échapper
      d'un environnement chroot s'il a les privilèges du super-utilisateur.
      Cela devrait être accompli en créant des fichiers spéciaux de
      périphérique pour la mémoire du noyau, en attachant un dévermineur à un
      processus depuis l'extérieur de sa "prison", ou par d'autres manières
      créatrices.</p><p>Le comportement de l'appel système <code class="function">chroot()</code>
      peut être un peu contrôlé avec la commande <code class="command">sysctl</code> et
      la variable kern.chroot_allow_open_directories.
      Quand cette valeur est règlée à 0, <code class="function">chroot()</code> échouera
      avec EPERM s'il y a un répertoire d'ouvert. Si la variable est règlée sur
      la valeur par défaut 1, alors <code class="function">chroot()</code> échouera
      avec EPERM s'il y a un répertoire d'ouvert et que le processus est déjà
      sujet à un appel <code class="function">chroot()</code>. Pour toute autre valeur, la
      vérification des répertoires ouverts sera totalement court-circuitée.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67692368"></a>6.5.1. La fonctionnalité "prison" de FreeBSD</h3></div></div></div><p>Le concept de Prison ("Jail") étend
      <code class="function">chroot()</code> en limitant les droits du
      super-utilisateur pour créer un véritable `serveur virtuel'. Une fois
      qu'une prison est mise en place, toute communication réseau doit avoir lieu
      au travers de l'adresse IP spécifiée, et le droit du
      "privilège super-utilisateur" dans cette prison est sévèrement gêné.</p><p>Tant qu'il se trouve en prison, tout test avec les droits du
      super-utilisateur dans le noyau au travers d'un appel à
      <code class="function">suser()</code> échouera.
      Toutefois, quelques appels à <code class="function">suser()</code> ont été
      changés par la nouvelle interface <code class="function">suser_xxx()</code>.
      Cette fonction est responsable de fournir ou de retirer les accès
      aux droits du super-utilisateur pour les processus emprisonnés.</p><p>Un processus super-utilisateur dans un environnement emprisonné
      a le pouvoir de : </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Manipuler les identitifications avec
        <code class="function">setuid</code>, <code class="function">seteuid</code>,
        <code class="function">setgid</code>, <code class="function">setegid</code>,
        <code class="function">setgroups</code>, <code class="function">setreuid</code>,
        <code class="function">setregid</code>, <code class="function">setlogin</code></li><li class="listitem">Règler les limites en ressources avec <code class="function">setrlimit</code></li><li class="listitem">Modifier quelques variables du noyau par sysctl
        (kern.hostname)</li><li class="listitem"><code class="function">chroot()</code></li><li class="listitem">Règler les paramètres d'un noeud virtuel (vnode):
        <code class="function">chflags</code>,
        <code class="function">fchflags</code></li><li class="listitem">Règler les attributs d'un noeud virtuel comme
      les permissions d'un fichier, le propriétaire, le groupe, la taille,
      la date d'accès, et la date de modification.</li><li class="listitem">Se lier à des ports privilégiés sur Internet
        (ports &lt; 1024)</li></ul></div><p><code class="function">Jail</code> est un outil très utile pour exécuter
      des applications dans un environnement sécurisé mais il a des
      imperfections. Actuellement, les mécanismes IPC (Inter-Process
      Communications) n'ont pas été convertis pour utiliser <code class="function">suser_xxx</code>
      aussi des applications comme MySQL ne peuvent être exécutée dans une prison.
      L'accès super-utilisateur peut avoir un sens très limité dans une prison,
       mais il n'y aucune façon de spécifier exactement ce que très limité
      veut dire.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp67713360"></a>6.5.2. Les capacitès des processus POSIX.1e</h3></div></div></div><p>Posix a réalisé un document de travail qui ajoute l'audit
      d'évènement, les listes de contrôle d'accès, les privilèges fins,
      l'étiquetage d'information, et le contrôle d'accès mandaté.</p><p>Il s'agit d'un travail en cours et c'est l'objectif du projet <a class="link" href="http://www.trustedbsd.org" target="_top">TrustedBSD</a>. Une partie
      du travail initial a été intégré dans FreeBSD-current
      (cap_set_proc(3)).</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch06s04.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="secure.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="ch06s06.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">6.4. Les problèmes liés à SetUID </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 6.6. La confiance</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>