<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>4.12. Le format des fichiers binaires</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="basics.html" title="Chapitre 4. Quelques bases d'UNIX" /><link rel="prev" href="basics-devices.html" title="4.11. Périphériques et fichiers spéciaux de périphérique" /><link rel="next" href="basics-more-information.html" title="4.13. Pour plus d'information" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.12. Le format des fichiers binaires</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="basics-devices.html">Précédent</a> </td><th width="60%" align="center">Chapitre 4. Quelques bases d'UNIX</th><td width="20%" align="right"> <a accesskey="n" href="basics-more-information.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="binary-formats"></a>4.12. Le format des fichiers binaires</h2></div></div></div><p>Afin de comprendre pourquoi FreeBSD utilise le format
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=elf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">elf</span>(5)</span></a>, vous devez d'abord connaître
      quelques détails concernant les trois formats
      &#8220;dominants&#8221; d'exécutables actuellement en vigueur
      sous <span class="trademark">UNIX</span>®:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=a.out&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">a.out</span>(5)</span></a></p><p>Le plus vieux et le format objet &#8220;classique&#8221;
	  d'<span class="trademark">UNIX</span>®.  Il utilise une entête courte et compacte
	  avec un nombre magique au début qui est souvent
	  utilisé pour caractériser le format (voir la
	  page de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=a.out&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">a.out</span>(5)</span></a> pour plus de détails).
	  Il contient trois segments chargés: .text, .data,
	  et .bss plus une table de symboles et une table de
	  chaînes de caractères.</p></li><li class="listitem"><p><acronym class="acronym">COFF</acronym></p><p>Le format objet SVR3.  L'entête comprend une
	  table de section, de telle sorte que vous avez plus de
	  sections qu'uniquement .text, .data et .bss.</p></li><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=elf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">elf</span>(5)</span></a></p><p>Le successeur de <acronym class="acronym">COFF</acronym>, qui
	  permet des sections multiples et des valeurs possibles de 32
	  bits et 64 bits.  Un inconvénient majeur:
	  <acronym class="acronym">ELF</acronym> a aussi été conçu
	  en supposant qu'il y aurait qu'un seul ABI par architecture
	  système.  Cette hypothèse est en fait assez
	  incorrecte, et même dans le monde SYSV (qui a
	  au moins trois ABIs: SVR4, Solaris, SCO) cela ne se
	  vérifie pas.</p><p>FreeBSD essaye de contourner ce problème en
	  fournissant un utilitaire pour <span class="emphasis"><em>marquer</em></span>
	  un exécutable connu <acronym class="acronym">ELF</acronym> avec
	  des informations sur l'ABI qui va avec.  Consultez la page
	  de manuel de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=brandelf&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">brandelf</span>(1)</span></a> pour plus
	  d'informations.</p></li></ul></div><p>FreeBSD vient du camp &#8220;classique&#8221; et a
      utilisé le format <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=a.out&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">a.out</span>(5)</span></a>, une technologie
      employée et éprouvée à travers des
      générations de BSDs, jusqu'aux débuts de la
      branche 3.X.  Bien qu'il fut possible de compiler et
      d'exécuter des binaires natifs <acronym class="acronym">ELF</acronym> (et
      noyaux) sous FreeBSD avant cela, FreeBSD a initialement
      résisté à la &#8220;pression&#8221; de passer
      à <acronym class="acronym">ELF</acronym> comme format par défaut.
      Pourquoi?  Bien, quand le camp Linux ont fait leur
      pénible transition vers <acronym class="acronym">ELF</acronym>, ce n'est pas
      tant fuir le format <code class="filename">a.out</code> qui rendait
      difficile la construction de bibliothèques partagée
      pour les développeurs mais le mécanisme de
      bibliothèques partagées basé sur des tables de
      sauts inflexible.  Puisque les outils <acronym class="acronym">ELF</acronym>
      disponibles offraient une solution au problème
      des bibliothèques partagées et étaient
      perçus comme &#8220;le chemin à suivre&#8221; de toute
      façon, le coût de la migration a été
      accepté comme nécessaire, et la transition a
      été réalisée.  Le mécanisme FreeBSD
      de bibliothèques partagées se rapproche plus
      du style de mécanisme de bibliothèques
      partagées de <span class="trademark">SunOS</span>&#8482; de Sun, et est très simple
      à utiliser.</p><p>Pourquoi existe-t-il tant de formats différents?</p><p>Dans un obscure et lointain passé, il y avait du
      matériel simple.  Ce matériel simple supportait
      un simple petit système.  <code class="filename">a.out</code>
      était complètement adapté pour
      représenter les binaires sur ce système simple
      (un PDP-11).  Au fur et à mesure que des personnes
      portaient <span class="trademark">UNIX</span>® à partir de ce système
      simple, ils ont maintenus le format <code class="filename">a.out</code>
      parce qu'il était suffisant pour les premiers portages
      d'<span class="trademark">UNIX</span>® sur des architectures comme le Motorola 68k, les VAX,
      etc.</p><p>Alors un certain ingénieur matériel brillant
      a décidé qu'il pourrait forcer le matériel
      à faire des choses bizarre, l'autorisant ainsi à
      réduire le nombre de portes logiques et permettant
      au coeur du CPU de fonctionner plus rapidement.
      Bien qu'on l'a fait fonctionner avec ce nouveau
      type de matériel (connu de nos jour sous le nom de
      <acronym class="acronym">RISC</acronym>), <code class="filename">a.out</code> n'était pas adapté
      à ce matériel, aussi beaucoup de formats ont
      été développés
      pour obtenir de meilleures performances de ce matériel
      que ce que pouvait offrir le simple et limité format
      qu'était <code class="filename">a.out</code>.  Des
      choses comme <acronym class="acronym">COFF</acronym>, <acronym class="acronym">ECOFF</acronym>,
      et quelques autres obscures formats ont été
      inventé et leur limites explorées avant que les choses
      ne se fixent sur <acronym class="acronym">ELF</acronym>.</p><p>En outre, les tailles des programmes devenaient
      énormes alors que les disques (et la mémoire
      physique) étaient toujours relativement
      petits, aussi le concept de bibliothèque partagée
      est né.  Le système de VM (mémoire virtuelle)
      est également devenu plus sophistiqué.
      Tandis que chacune de ces avancées était
      faites en utilisant le format <code class="filename">a.out</code>,
      son utilité a été élargie
      de plus en plus avec chaque nouvelle fonction.  De plus les
      gens ont voulu charger dynamiquement des choses à
      l'exécution, ou se débarrasser de partie de
      leur programme après l'initialisation pour économiser
      de l'espace mémoire et de pagination.  Les langages
      sont devenus plus sophistiqués et les gens ont voulu
      du code appelé automatiquement avant la partie
      principale du programme.  Beaucoup de modifications ont
      été apportées au format <code class="filename">a.out</code>
      pour rendre possible toutes ces choses, et cela a
      fonctionné pendant un certain temps.  Avec le temps,
      <code class="filename">a.out</code> n'était plus capable de
      gérer tous ces problèmes sans une augmentation
      toujours croissante du code et de sa complexité.
      Tandis <acronym class="acronym">ELF</acronym> résolvait plusieurs de
      ces problèmes, il aurait été pénible
      de quitter un système qui a fonctionné.
      Ainsi <acronym class="acronym">ELF</acronym> a dû attendre jusqu'au moment
      où il était plus pénible de rester avec
      <code class="filename">a.out</code> que d'émigrer vers
      <acronym class="acronym">ELF</acronym>.</p><p>Cependant, avec le temps, les outils de compilation
      desquels ceux de FreeBSD sont dérivés (l'assembleur
      et le chargeur tout spécialement) ont
      évolué en parallèle.
      Les développeurs FreeBSD ajoutèrent les
      bibliothèques partagées et corrigèrent
      quelques bogues.  Les gens de chez GNU qui ont à
      l'origine écrit ces programmes, les récrivirent
      et ajoutèrent un support plus simple pour la compilation
      multi-plateformes, avec différents formats
      à volonté, et ainsi de suite.  Lorsque beaucoup de personnes
      ont voulu élaborer des compilateurs multi-plateformes
      pour FreeBSD, elles n'eurent pas beaucoup de chance puisque
      les anciennes sources que FreeBSD avait pour
      <span class="application">as</span> et <span class="application">ld</span>
      n'étaient pas adaptées à cette tâche.
      Le nouvel ensemble d'outils de GNU
      (<span class="application">binutils</span>) supporte la compilation
      multi-plateformes, <acronym class="acronym">ELF</acronym>, les
      bibliothèques partagées, les extensions C++, etc.
      De plus, de nombreux vendeurs de logiciels fournissent des
      binaires <acronym class="acronym">ELF</acronym>, et c'est une bonne chose pour
      permettre leur exécution sous FreeBSD.</p><p><acronym class="acronym">ELF</acronym> est plus expressif
      qu'<code class="filename">a.out</code> et permet plus d'extensibilité
      dans le système de base.
      Les outils <acronym class="acronym">ELF</acronym> sont mieux maintenus, et
      offrent un support pour la compilation multi-plateformes, ce qui
      est important pour de nombreuses personnes.
      <acronym class="acronym">ELF</acronym> peut être légèrement plus lent
      qu'<code class="filename">a.out</code>, mais tenter de mesurer cette
      différence n'est pas aisé.  Il y a
      également de nombreux détails qui
      diffèrent entre les deux dans la façon dont
      ils mappent les pages mémoire, gère le code
      d'initialisation, etc.
      Dans le futur, le support <code class="filename">a.out</code> sera
      retiré du noyau <code class="filename">GENERIC</code>, et
      par la suite retiré des sources du noyau une fois que le
      besoin d'exécuter d'anciens programmes
      <code class="filename">a.out</code> aura disparu.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="basics-devices.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="basics.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="basics-more-information.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">4.11. Périphériques et fichiers spéciaux de
      périphérique </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 4.13. Pour plus d'information</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>