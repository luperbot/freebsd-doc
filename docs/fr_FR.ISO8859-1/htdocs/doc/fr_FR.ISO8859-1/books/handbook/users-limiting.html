<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>14.7. Mettre en place des restrictions pour les utilisateurs</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="users.html" title="Chapitre 14. Gestion des comptes et des utilisateurs" /><link rel="prev" href="users-modifying.html" title="14.6. Modifier des comptes" /><link rel="next" href="users-groups.html" title="14.8. Groupes" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.7. Mettre en place des restrictions pour les utilisateurs</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="users-modifying.html">Précédent</a> </td><th width="60%" align="center">Chapitre 14. Gestion des comptes et des utilisateurs</th><td width="20%" align="right"> <a accesskey="n" href="users-groups.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="users-limiting"></a>14.7. Mettre en place des restrictions pour les utilisateurs</h2></div></div></div><a id="idp78074448" class="indexterm"></a><a id="idp78074960" class="indexterm"></a><p>Si vous avez plusieurs utilisateurs sur votre système,
      la possibilité de limiter leur utilisation du système
      peut venir à l'esprit.
      FreeBSD fournit plusieurs méthodes à
      l'administrateur système pour limiter la quantité de
      ressources système qu'un utilisateur peut utiliser.
      Ces limites sont généralement divisées
      en deux parties: les quotas disque, et les autres limites de
      ressource.</p><a id="idp78076496" class="indexterm"></a><a id="idp78077008" class="indexterm"></a><a id="idp78078160" class="indexterm"></a><p>Les quotas limitent l'utilisation des disques par les
      utilisateurs, et
      ils fournissent un moyen de
      vérifier rapidement cette utilisation
      sans avoir à faire des calculs à chaque fois.
      Les quotas sont abordés dans la <a class="xref" href="quotas.html" title="19.15. Quotas d'utilisation des disques">Section 19.15, « Quotas d'utilisation des disques »</a>.</p><p>Les autres limites de ressource comprennent les moyens de
      limiter l'utilisation du CPU, de la mémoire, et les autres
      ressources qu'un utilisateur peut consommer.  Elles sont
      définies en employant des classes de session et sont
      abordées ici.</p><a id="idp78088144" class="indexterm"></a><p>Les classes de session sont définies dans
      <code class="filename">/etc/login.conf</code>.  La sémantique
      précise sort du cadre de cette section, mais est
      décrite en détail dans la page de manuel
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a>.  Il est suffisant de dire que chaque
      utilisateur est assigné à une classe
      (<code class="literal">default</code> par défaut), et que chaque classe
      dispose d'un ensemble de capacités associées.
      La forme utilisée pour ces capacités est une paire
      <code class="literal">nom=valeur</code>
      où <em class="replaceable"><code>nom</code></em> est un identifiant connu et
      <em class="replaceable"><code>valeur</code></em> est une chaîne arbitraire
      dépendante du nom.  Paramétrer des classes et des
      capacités est plutôt direct et également
      décrit dans <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a>.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Le système ne lit normalement pas directement le fichier
	<code class="filename">/etc/login.conf</code>, mais plutôt la
	base de données
	<code class="filename">/etc/login.conf.db</code> qui fournit plus
	rapidement les réponses au système.  Pour
	générer <code class="filename">/etc/login.conf.db</code>
	à partir du fichier
	<code class="filename">/etc/login.conf</code>, exécutez la
	commande suivante:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre></div><p>Les limites de ressource sont différentes des
      capacités standards des classes en deux points.
      Premièrement, pour chaque limite, il existe une limite douce
      (actuelle) et limite dure.  Une limite douce peut être
      ajustée par l'utilisateur ou une application, mais jamais
      dépasser la limite dure.  Cette dernière peut être
      abaissée par l'utilisateur, mais jamais augmentée.
      Deuxièmement, la plupart des limites de ressource s'applique
      par processus à un utilisateur spécifique, et non pas
      à l'utilisateur dans sa totalité.  Notez, cependant, que ces
      différences sont exigées par la manipulation
      spécifique des
      limites, et non pas par l'implémentation du système des
      capacités des classes de session utilisateur (i.e., elles ne sont
      <span class="emphasis"><em>vraiment</em></span> pas un cas particulier des
      capacités des classes de session).</p><p>Sans plus attendre, ci-dessous sont présentées
      les limites de ressource les plus souvent utilisées
      (le reste, avec les autres capacités des classes
      de session, peut être trouvé dans
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a>).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">coredumpsize</code></span></dt><dd><a id="idp78103632" class="indexterm"></a><a id="idp78104144" class="indexterm"></a><p>La limite sur la taille du fichier core
	    généré par un programme est, pour
	    d'évidentes raisons, subordonnée aux autres limites
	    sur l'utilisation du disque (e.g., <code class="literal">filesize</code>,
	    ou les quotas de disque).  Néanmoins, elle est souvent
	    employée comme méthode moins
	    sévère pour contrôler la
	    consommation d'espace disque: puisque les utilisateurs ne
	    génèrent pas de fichier core eux-mêmes,
	    et souvent ne les
	    suppriment pas, paramétrer cela peut leur éviter
	    de manquer d'espace disque si un programme important (e.g.,
	    <span class="application">emacs</span>) plante.</p></dd><dt><span class="term"><code class="literal">cputime</code></span></dt><dd><a id="idp78107856" class="indexterm"></a><a id="idp78108368" class="indexterm"></a><p>C'est la quantité maximale de temps CPU qu'un
	    processus d'un utilisateur peut consommer.  Les processus
	    la dépassant seront tués par le noyau.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">C'est une limite sur le <span class="emphasis"><em>temps</em></span>
		CPU consommé, non sur le pourcentage comme
		affiché par certains champs de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a> et
		<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a>.  Une limite sur ce dernier est, au moment de
		l'écriture de ces lignes, impossible, et serait
		plutôt inutile: un compilateur&#8212;probablement
		une tâche légitime&#8212;peut
		aisément utiliser presque 100% du CPU pendant un certain
		temps.</p></div></dd><dt><span class="term"><code class="literal">filesize</code></span></dt><dd><a id="idp78113872" class="indexterm"></a><a id="idp78114384" class="indexterm"></a><p>C'est la taille maximale du plus gros fichier qu'un utilisateur
	    peut posséder.  Contrairement aux <a class="link" href="quotas.html" title="19.15. Quotas d'utilisation des disques">quotas</a>, cette limite ne s'applique
	    qu'aux fichiers individuellement, et non pas sur l'ensemble
	    lui-même de tous les fichiers que possède
	    un utilisateur.</p></dd><dt><span class="term"><code class="literal">maxproc</code></span></dt><dd><a id="idp78121936" class="indexterm"></a><a id="idp78122448" class="indexterm"></a><p>C'est le nombre maximal de processus que peut exécuter
	    un utilisateur en même temps.  Ceci inclut
	    les processus de premier plan et de tâche de fond.
	    Pour d'évidentes raisons, il ne doit pas être plus
	    grand que les limites du système spécifiées
	    par la variable <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	    <code class="varname">kern.maxproc</code>.  Notez en outre qu'une
	    valeur trop basse peut gêner la productivité
	    de l'utilisateur: il est souvent utile d'ouvrir plusieurs
	    sessions à la fois ou d'exécuter des opérations
	    sous forme de &#8220;pipeline&#8221;.
	    Certaines tâches, comme
	    compiler un gros programme, engendrent également
	    de multiples processus (e.g., <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cc&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cc</span>(1)</span></a>, et
	    autres préprocesseurs).</p></dd><dt><span class="term"><code class="literal">memorylocked</code></span></dt><dd><a id="idp78132176" class="indexterm"></a><a id="idp78132688" class="indexterm"></a><p>C'est la quantité maximale de mémoire
	    qu'un processus peut avoir demandé de verrouiller en
	    mémoire principale (e.g., voir <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mlock&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">mlock</span>(2)</span></a>).
	    Certains programmes système critiques, comme
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=amd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">amd</span>(8)</span></a>, sont verrouillés en mémoire
	    principale de sorte qu'en cas de dépassement de la
	    mémoire de pagination, ils ne contribuent pas aux ennuis
	    du système.</p></dd><dt><span class="term"><code class="literal">memoryuse</code></span></dt><dd><a id="idp78137168" class="indexterm"></a><a id="idp78137680" class="indexterm"></a><p>C'est la quantité maximale de mémoire
	    qu'un processus peut consommer à un instant donné.
	    Cela inclus la mémoire principale et celle de pagination.
	    Ce n'est pas le remède miracle pour restreindre la
	    consommation de mémoire, mais c'est un bon
	    début.</p></dd><dt><span class="term"><code class="literal">openfiles</code></span></dt><dd><a id="idp78140624" class="indexterm"></a><a id="idp78141136" class="indexterm"></a><p>C'est le nombre maximal de fichiers qu'un processus peut
	    avoir ouvert.  Sous FreeBSD, des fichiers sont également
	    employés pour représenter les sockets et
	    les canaux IPC, par conséquent faites attention
	    à ne fixer une valeur trop basse.  La limite
	    générale du système pour cela est
	    définie par la variable <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a>
	    <code class="varname">kern.maxfiles</code>.</p></dd><dt><span class="term"><code class="literal">sbsize</code></span></dt><dd><a id="idp78145104" class="indexterm"></a><a id="idp78145616" class="indexterm"></a><p>C'est une limite sur la quantité de
	    mémoire réseau, et donc de &#8220;mbufs&#8221;,
	    qu'un utilisateur peut consommer.  Ceci est à
	    l'origine une réponse à une vielle attaque par
	    refus de service en créant de nombreuses sockets, mais peut
	    être généralement employée
	    pour limiter les communications réseau.</p></dd><dt><span class="term"><code class="literal">stacksize</code></span></dt><dd><a id="idp78156752" class="indexterm"></a><a id="idp78157264" class="indexterm"></a><p>C'est la taille maximale de la pile d'un processus.
	    Seule, cela n'est pas suffisant pour limiter la quantité
	    de mémoire que peut utiliser un programme, par
	    conséquent, cette limite devra être
	    utilisée en même temps que d'autres
	    limitations.</p></dd></dl></div><p>Il y a quelques éléments
      à se rappeler quand on fixe des
      limites de ressource.  Quelques astuces générales,
      suggestions, et commentaires divers:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Les processus lancés au démarrage
	  du système par <code class="filename">/etc/rc</code>
	  sont assignés à la classe
	  <code class="literal">daemon</code>.</p></li><li class="listitem"><p>Bien que le fichier <code class="filename">/etc/login.conf</code>
	  qui est fourni avec le système est une bonne source
	  de valeurs raisonnables pour la plupart des limites, seul
	  vous, l'administrateur, peut savoir ce qui est approprié
	  à votre système.  Fixer une limite trop haute
	  peut laisser la porte ouverte aux abus, alors qu'une limite
	  trop basse peut être un frein à la
	  productivité.</p></li><li class="listitem"><p>Les utilisateurs du système X Window (X11) devraient
	  se voir allouer plus de ressources que les autres
	  utilisateurs.  X11 par lui-même utilise beaucoup de
	  ressources, mais il encourage également les
	  utilisateurs à exécuter plus de
	  programmes simultanément.</p></li><li class="listitem"><p>Souvenez-vous que de nombreuses limites ne s'appliquent
	  qu'aux processus individuels, et non pas à l'utilisateur
	  globalement.  Par exemple, paramétrer
	  <code class="varname">openfiles</code> à 50 signifie
	  que chaque processus que l'utilisateur exécute pourra ouvrir
	  jusqu'à 50 fichiers.  Ainsi, la quantité totale
	  de fichiers qu'un utilisateur peut ouvrir est la valeur
	  <code class="literal">openfiles</code> multipliée par la valeur
          <code class="literal">maxproc</code>.  Ceci s'applique également
	  à la consommation de mémoire.</p></li></ul></div><p>Pour de plus amples informations sur les limites et les
      classes de session et les capacités en
      général, veuillez consulter les pages de manuel
      appropriées: <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=cap_mkdb&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">cap_mkdb</span>(1)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=getrlimit&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">getrlimit</span>(2)</span></a>,
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a>.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="users-modifying.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="users.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="users-groups.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">14.6. Modifier des comptes </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 14.8. Groupes</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>