<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>19.14. Instantané (&#8220;Snapshot&#8221;) d'un système de fichiers</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="disks.html" title="Chapitre 19. Stockage des données" /><link rel="prev" href="disks-virtual.html" title="19.13. Systèmes de fichiers réseaux, en mémoire et sauvegardés sur fichier" /><link rel="next" href="quotas.html" title="19.15. Quotas d'utilisation des disques" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">19.14. Instantané (&#8220;Snapshot&#8221;) d'un système de fichiers</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="disks-virtual.html">Précédent</a> </td><th width="60%" align="center">Chapitre 19. Stockage des données</th><td width="20%" align="right"> <a accesskey="n" href="quotas.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="snapshots"></a>19.14. Instantané (&#8220;Snapshot&#8221;) d'un système de fichiers</h2></div><div><span class="authorgroup">Contribution de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp80856272" class="indexterm"></a><p>FreeBSD en association avec les
	<a class="link" href="configtuning-disk.html#soft-updates" title="12.12.2. Les &#8220;Soft Updates&#8221;">Soft Updates</a> offre une
	nouvelle caractéristique: les instantanés de
	systèmes de fichiers (&#8220;file system
	snapshots&#8221;).</p><p>Les instantanés permettent à un utilisateur de
	créer des images d'un système de fichiers
	précis, et de les traiter comme un fichier.
	Les instantanés doivent être créés
	dans le système de fichiers sur lequel on veut effectuer
	l'opération, et un utilisateur ne pourra pas créer
	plus de 20 instantanés par système de fichiers.
	Les instantanés actifs sont enregistrés dans le
	superbloc, ils sont donc conservés durant les
	opérations de démontage et de remontage lors des
	redémarrages du système.  Quand un instantané
	n'est plus requis, il peut être supprimé avec
	la commande standard <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rm&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">rm</span>(1)</span></a>.  Les instantanés peuvent
	être supprimés dans n'importe quel ordre,
	cependant tout l'espace utilisé pourra ne pas
	être à nouveau disponible car un autre instantané
	réclamera éventuellement les blocs
	libérés.</p><p>L'indicateur inaltérable <code class="option">snapshot</code>
	est positionné lors de la création initiale de
	l'instantané.  La commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=unlink&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">unlink</span>(1)</span></a> fait une
	exception pour les fichiers d'instantanés puisqu'elle
	autorise leur suppression.</p><p>Les instantanés sont créés avec la commande
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mount&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>.  Pour placer un instantané de
	<code class="filename">/var</code> dans le fichier
	<code class="filename">/var/snapshot/snap</code> utilisez la commande
	suivante:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -u -o snapshot /var/snapshot/snap /var</code></strong></pre><p>Alternativement, vous pouvez utiliser <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mksnap_ffs&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mksnap_ffs</span>(8)</span></a>
	pour créer un instantané:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mksnap_ffs /var /var/snapshot/snap</code></strong></pre><p>Les fichiers d'instantanés peuvent être
	localisés sur un système de fichiers (e.g.
	<code class="filename">/var</code>) en utilisant la
	commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=find&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">find</span>(1)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>find /var -flags snapshot</code></strong></pre><p>Une fois un instantané créé, ce dernier
	pourra avoir de nombreux usages:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Certains administrateurs utiliseront un instantané
	    pour des besoins de sauvegarde, car l'instantané
	    peut être transféré sur CD ou bande.</p></li><li class="listitem"><p>Un contrôle d'intégrité du système fichiers,
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>, pourra être effectué sur
	    l'instantané.  En supposant que le système de
	    fichiers était propre quand il a été
	    monté, vous devriez toujours obtenir un résultat
	    positif (et non différent).  C'est essentiellement
	    que effectue le processus de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a> en tâche
	    de fond (&#8220;background <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fsck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">fsck</span>(8)</span></a>&#8221;).</p></li><li class="listitem"><p>Lancer l'utilitaire <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> sur l'instantané.
	    Une image cohérente du système de fichiers avec
	    les paramètres temporels de l'instantané
	    sera produite.
	    <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=dump&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">dump</span>(8)</span></a> peut également à partir d'un
	    instantané, créer une image et puis supprimer
	    l'instantané en une seule fois en utilisant l'indicateur
	    <code class="option">-L</code> dans la ligne de commande.</p></li><li class="listitem"><p>Monter l'instantané comme une image figée
	    du système de fichiers.  Pour monter l'instantané
	    <code class="filename">/var/snapshot/snap</code> lancer:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mdconfig -a -t vnode -f /var/snapshot/snap -u 4</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -r /dev/md4 /mnt</code></strong></pre></li></ul></div><p>Vous pouvez maintenant parcourir l'arborescence de
	votre système de fichiers <code class="filename">/var</code>
	figé monter sous <code class="filename">/mnt</code>.
	Tout sera au départ dans le même état que lors de la
	création de l'instantané.  La seule exception est que les
	instantanés antérieurs apparaîtront
	sous la forme de fichiers vides.  Quand l'utilisation d'un
	instantané est terminée, il peut être
	démonté avec:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>umount /mnt</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mdconfig -d -u 4</code></strong></pre><p>Pour plus d'informations sur les
	<code class="option">softupdates</code> et les instantanés de
	systèmes de fichiers, et également de la documentation
	technique, vous pouvez consulter le site Web de
	Marshall Kirk McKusick à l'adresse
	<code class="uri"><a class="uri" href="http://www.mckusick.com/" target="_top">http://www.mckusick.com/</a></code></p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="disks-virtual.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="quotas.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">19.13. Systèmes de fichiers réseaux, en mémoire
      et sauvegardés sur fichier </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 19.15. Quotas d'utilisation des disques</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>