<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>29.2. Le &#8220;super-serveur&#8221; inetd</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="network-servers.html" title="Chapitre 29. Serveurs réseau" /><link rel="prev" href="network-servers.html" title="Chapitre 29. Serveurs réseau" /><link rel="next" href="network-nfs.html" title="29.3. Système de fichiers réseau (NFS)" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">29.2. Le &#8220;super-serveur&#8221;
      <span class="application">inetd</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-servers.html">Précédent</a> </td><th width="60%" align="center">Chapitre 29. Serveurs réseau</th><td width="20%" align="right"> <a accesskey="n" href="network-nfs.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-inetd"></a>29.2. Le &#8220;super-serveur&#8221;
      <span class="application">inetd</span></h2></div><div><span class="authorgroup">Contribution de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Chern</span> <span class="surname">Lee</span></span>. </span></div><div><span class="authorgroup">Mise à jour pour FreeBSD 6.1-RELEASE par <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="othername">le projet de documentation de FreeBSD</span></span>. </span></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-overview"></a>29.2.1. Généralités</h3></div></div></div><p>On fait parfois référence à
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> comme étant le &#8220;super-serveur
	Internet&#8221; parce qu'il gère les connexions pour
	plusieurs services.
	Quand une connexion est reçue par
	<span class="application">inetd</span>, ce dernier détermine
	à quel programme la connexion est
	destinée, invoque le processus en question
	et lui délègue la &#8220;socket&#8221; (le
	programme est invoqué avec la &#8220;socket&#8221; service
	comme entrée standard, sortie et descripteurs d'erreur).
	Exécuter
	<span class="application">inetd</span> pour les serveurs qui ne sont
	pas utilisés intensément peut réduire la
	charge système globale quand on compare avec
	l'exécution
	de chaque &#8220;daemon&#8221; individuellement en mode
	autonome.</p><p><span class="application">inetd</span> est utilisé pour
	invoquer d'autres &#8220;daemon&#8221;s, mais plusieurs
	protocoles triviaux sont gérés directement,
	comme <span class="application">chargen</span>,
	<span class="application">auth</span>, et
	<span class="application">daytime</span>.</p><p>Cette section abordera la configuration de base
	d'<span class="application">inetd</span> à travers ses
	options en ligne de commande et son fichier de configuration
	<code class="filename">/etc/inetd.conf</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-settings"></a>29.2.2. Configuration</h3></div></div></div><p><span class="application">inetd</span> est initialisé par
	l'intermédiaire du système
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rc&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rc</span>(8)</span></a>.  L'option
	<code class="literal">inetd_enable</code> est positionnée
	à la valeur <code class="literal">NO</code> par défaut,
	mais peut être activée par
	<span class="application">sysinstall</span> lors de l'installation
	en fonction de la configuration choisie par l'utilisateur.
	Placer</p><pre class="programlisting">inetd_enable="YES"</pre><p>ou</p><pre class="programlisting">inetd_enable="NO"</pre><p>dans
	<code class="filename">/etc/rc.conf</code> activera ou
	désactivera le lancement
	d'<span class="application">inetd</span> à la mise en route
	du système.  La commande:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/inetd rcvar</code></strong></pre><p>peut être lancée pour afficher le
	paramétrage en vigueur.</p><p>De plus, différentes options de ligne de commande
	peuvent être passées à
	<span class="application">inetd</span> par l'intermédiaire de
	l'option <code class="literal">inetd_flags</code>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-cmdline"></a>29.2.3. Options en ligne de commande</h3></div></div></div><p>Comme la plupart des <span class="quote">« <span class="quote">daemons</span> »</span>,
	<span class="application">inetd</span> possède de nombreuses
	options que l'on peut passer à son lancement afin de
	modifier son comportement.  La liste complète des
	options se présente sous la forme:</p><p><code class="command">inetd</code> <code class="option">[-d] [-l] [-w] [-W] [-c maximum] [-C taux] [-a adresse | nom de machine] [-p fichier] [-R taux] [fichier de configuration]</code></p><p>Les options peuvent être passées à
	<span class="application">inetd</span> en utilisant le
	paramètre <code class="literal">inetd_flags</code> dans
	<code class="filename">/etc/rc.conf</code>.  Par défaut,
	<code class="literal">inetd_flags</code> contient <code class="literal">-wW -C
	60</code>, qui active le <span class="quote">« <span class="quote">TCP wrapping</span> »</span> pour
	les services <span class="application">inetd</span>, et
	empêche l'invocation d'un service plus de 60 fois par
	minute à partir d'une unique adresse IP.</p><p>Les novices seront heureux d'apprendre que ce
	paramétrage n'a en général pas besoin
	d'être modifié, cependant nous présentons
	ci-dessous les options de limitation du taux d'invocation
	étant donné que cela peut être utile si
	vous recevez une quantité excessive de connexions.  Une
	liste complète d'options peut être trouvée
	dans la page de manuel de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-c maximum</span></dt><dd><p>Spécifie le nombre maximal par défaut
	      d'invocations simultanées pour chaque service; il
	      n'y a pas de limite par défaut.  Cette option peut
	      être surchargée pour chaque service à
	      l'aide du paramètre
	      <code class="option">nb-max-enfants</code>.</p></dd><dt><span class="term">-C taux</span></dt><dd><p>Précise le nombre maximal de fois qu'un
	      service peut être invoqué à partir
	      d'une unique adresse IP et cela sur une minute.  Ce
	      paramètre peut être configuré
	      différemment pour chaque service avec le
	      paramètre
	      <code class="option">nb-max-connexions-par-ip-par-minute</code>.</p></dd><dt><span class="term">-R taux</span></dt><dd><p>Précise le nombre maximal de fois qu'un
	      service peut être invoqué par minute; la
	      valeur par défaut est 256.  Un taux de 0 autorise
	      un nombre illimité d'invocations.</p></dd><dt><span class="term">-s maximum</span></dt><dd><p>Précise le nombre maximal de fois qu'un
	      service peut être invoqué
	      simultanément à partir d'une adresse IP
	      unique; il n'y a pas de limite par défaut.  Cette
	      option peut-être surchargée pour chaque
	      service individuellement avec le paramètre
	      <code class="option">max-child-per-ip</code>.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-conf"></a>29.2.4. <code class="filename">inetd.conf</code></h3></div></div></div><p>La configuration d'<span class="application">inetd</span> se
	fait par l'intermédiaire du fichier
	<code class="filename">/etc/inetd.conf</code>.</p><p>Quand le fichier <code class="filename">/etc/inetd.conf</code> est
	modifié, <span class="application">inetd</span> peut
	être forcé de relire son fichier de configuration
	en utilisant la commande:</p><div class="example"><a id="network-inetd-reread"></a><div class="example-title">Exemple 29.1. Recharger le fichier de configuration
	  d'<span class="application">inetd</span></div><div class="example-contents"><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>/etc/rc.d/inetd reload</code></strong></pre></div></div><br class="example-break" /><p>Chaque ligne du fichier de configuration ne mentionne
	qu'un seul &#8220;daemon&#8221;.  Les commentaires dans le
	fichier sont précédés par un
	&#8220;#&#8221;.  Le format de chaque entrée du fichier
	<code class="filename">/etc/inetd.conf</code> est le suivant:</p><pre class="programlisting">nom-du-service
type-de-socket
protocole
{wait|nowait}[/nb-max-enfants[/nb-connexions-max-par-minute]]
{wait|nowait}[/nb-max-enfants[/nb-connexions-max-par-minute[/nb-max-enfants-par-ip]]]
utilisateur[:groupe][/classe-session]
programme-serveur
arguments-du-programme-serveur</pre><p>Un exemple d'entrée pour le &#8220;daemon&#8221;
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ftpd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">ftpd</span>(8)</span></a> utilisant l'IPv4 ressemblerait:</p><pre class="programlisting">ftp     stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -l</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">nom-du-service</span></dt><dd><p>C'est le nom de service du &#8220;daemon&#8221; en
	      question.  Il doit correspondre à un des services
	      listés dans le fichier
	      <code class="filename">/etc/services</code>.  Cela détermine
	      quel port <span class="application">inetd</span> doit
	      écouter.  Si un nouveau service est
	      créé, il doit être ajouté en
	      premier lieu dans
	      <code class="filename">/etc/services</code>.</p></dd><dt><span class="term">type-de-socket</span></dt><dd><p>Soit <code class="literal">stream</code>, soit
	      <code class="literal">dgram</code>, soit <code class="literal">raw</code>, ou
	      <code class="literal">seqpacket</code>.  <code class="literal">stream</code>
	      doit être utilisé pour les
	      &#8220;daemon&#8221;s TCP, alors que
	      <code class="literal">dgram</code> est utilisé pour les
	      &#8220;daemon&#8221;s utilisant le protocole UDP.</p></dd><dt><span class="term">protocole</span></dt><dd><p>Un des suivants:</p><div class="informaltable"><table width="100%" border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Protocole</th><th>Explication</th></tr></thead><tbody><tr><td>tcp, tcp4</td><td>TCP IPv4</td></tr><tr><td>udp, udp4</td><td>UDP IPv4</td></tr><tr><td>tcp6</td><td>TCP IPv6</td></tr><tr><td>udp6</td><td>UDP IPv6</td></tr><tr><td>tcp46</td><td>TCP IPv4 et v6</td></tr><tr><td>udp46</td><td>UDP IPv4 et v6</td></tr></tbody></table></div></dd><dt><span class="term">{wait|nowait}[/nb-max-enfants[/nb-max-connexions-par-ip-par-minute[/nb-max-enfants-par-ip]]]</span></dt><dd><p><code class="option">wait|nowait</code> indique si le
	      &#8220;daemon&#8221; invoqué par
	      <span class="application">inetd</span> est capable ou non de
	      gérer sa propre &#8220;socket&#8221;.  Les
	      &#8220;socket&#8221;s de type <code class="option">dgram</code>
	      doivent utiliser l'option <code class="option">wait</code>, alors
	      que les &#8220;daemons à socket stream&#8221;,
	      qui sont généralement
	      multi-threadés, devraient utiliser
	      <code class="option">nowait</code>.  L'option <code class="option">wait</code>
	      a généralement pour conséquence de
	      fournir plusieurs &#8220;socket&#8221;s à un
	      &#8220;daemon&#8221;, tandis que l'option
	      <code class="option">nowait</code> invoquera un
	      &#8220;daemon&#8221; enfant pour chaque nouvelle
	      &#8220;socket&#8221;.</p><p>Le nombre maximal de &#8220;daemon&#8221;s
	      qu'<span class="application">inetd</span> peut invoquer peut
	      être fixé en utilisant l'option
	      <code class="option">nb-max-enfants</code>.  Si une limite de dix
	      instances pour un &#8220;daemon&#8221; est
	      nécessaire, <code class="literal">/10</code> devra
	      être placé après
	      <code class="option">nowait</code>.  Spécifier
	      <code class="literal">/0</code> autorise un nombre illimité
	      d'enfant.</p><p>En plus de <code class="option">nb-max-enfants</code>, deux
	      autres options limitant le nombre maximal de connexions
	      à partir d'un emplacement vers un
	      &#8220;daemon&#8221; particulier peuvent être
	      activéees.  L'option
	      <code class="option">nb-max-connexions-par-ip-par-minute</code>
	      limite le nombre de connexions par minutes à
	      partir d'une adresse IP donnée, par exemple, une
	      valeur de dix limiterait
	      à dix le nombre de tentatives de connexions par
	      minute pour une adresse IP particulière.
	      L'option <code class="option">max-child-per-ip</code> limite le
	      nombre d'enfants qui peuvent être lancés
	      pour une adresse IP unique à un instant
	      donné.  Ces options sont utiles pour
	      empêcher l'abus excessif intentionnel ou par
	      inadvertance des ressources d'une machine et les
	      attaques par déni de service (<span class="quote">« <span class="quote">Denial of
	      Service&#8212;DOS</span> »</span>).</p><p>Dans ce champ, <code class="option">wait</code> ou
	      <code class="option">nowait</code> est obligatoire.
	      <code class="option">nb-max-enfants</code>,
	      <code class="option">nb-max-connexions-par-ip-par-minute</code> et
	      <code class="option">max-child-per-ip</code>
	      sont optionnelles.</p><p>Un &#8220;daemon&#8221; utilisant un flux de type
	      multi-threadé sans limites
	      <code class="option">nb-max-enfants</code>,
	      <code class="option">nb-max-connexions-par-ip-par-minute</code> ou
	      <code class="option">max-child-per-ip</code>
	      sera tout simplement affecté de l'option
	      <code class="literal">nowait</code>.</p><p>Le même &#8220;daemon&#8221; avec une limite
	      maximale de dix &#8220;daemon&#8221; serait:
	      <code class="literal">nowait/10</code>.</p><p>La même configuration avec une limite
	      de vingt connexions par adresse IP par minute et une
	      limite maximale de dix &#8220;daemon&#8221;s enfant
	      serait: <code class="literal">nowait/10/20</code>.</p><p>Ces options sont utilisées comme valeurs par
	      défaut par le &#8220;daemon&#8221;
	      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fingerd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">fingerd</span>(8)</span></a>, comme le montre ce
	      qui suit:</p><pre class="programlisting">finger stream  tcp     nowait/3/10 nobody /usr/libexec/fingerd fingerd -s</pre><p>Et enfin, un exemple de champ avec un maximum de 100
	      enfants en tout, avec un maximum de 5 adresses IP
	      distinctes serait:
	      <code class="literal">nowait/100/0/5</code>.</p></dd><dt><span class="term">utilisateur</span></dt><dd><p>C'est l'utilisateur sous lequel le
	      &#8220;daemon&#8221; en question est
	      exécuté.  En général les
	      &#8220;daemon&#8221;s tournent sous l'utilisateur
	      <code class="systemitem">root</code>.  Pour des questions de
	      sécurité, il est courant de rencontrer des
	      serveurs tournant sous l'utilisateur
	      <code class="systemitem">daemon</code>, ou sous l'utilisateur avec
	      le moins de privilèges:
	      <code class="systemitem">nobody</code>.</p></dd><dt><span class="term">programme-serveur</span></dt><dd><p>Le chemin complet du &#8220;daemon&#8221; qui doit
	      être exécuté quand une requête
	      est reçue.  Si le &#8220;daemon&#8221; est un
	      service fourni en interne par
	      <span class="application">inetd</span>, alors l'option
	      <code class="option">internal</code> devrait être
	      utilisée.</p></dd><dt><span class="term">arguments-programme-serveur</span></dt><dd><p>Cette option va de pair avec
	      <code class="option">programme-serveur</code> en précisant
	      les arguments, en commençant avec
	      <code class="literal">argv[0]</code>, passés au
	      &#8220;daemon&#8221; lors de son invocation.  Si
	      <code class="command">mydaemon -d</code> est la ligne de commande,
	      <code class="literal">mydaemon -d</code> sera la valeur de
	      l'option <code class="option">arguments-programme-serveur</code>.
	      Ici également, si le &#8220;daemon&#8221; est un
	      service interne, utilisez
	      <code class="option">internal</code>.</p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-security"></a>29.2.5. Sécurité</h3></div></div></div><p>En fonction des choix effectués
	à l'installation, plusieurs services
	peuvent être activés par défaut.  S'il n'y
	a pas de raison particulière à l'utilisation
	d'un &#8220;daemon&#8221;, envisagez de le désactiver.  Ajoutez un
	caractère &#8220;#&#8221; devant le
	&#8220;daemon&#8221; en question dans le fichier
	<code class="filename">/etc/inetd.conf</code>, et ensuite
	<a class="link" href="network-inetd.html#network-inetd-reread" title="Exemple 29.1. Recharger le fichier de configuration d'inetd">rechargez la
	configuration
	d'inetd</a>.  Certains <span class="quote">« <span class="quote">daemon</span> »</span>s comme
	<span class="application">fingerd</span>, devraient être
	évités parce qu'ils peuvent fournir des informations
	utiles aux personnes malveillantes.</p><p>Certains &#8220;daemon&#8221;s n'ont aucune conscience des
	problèmes de sécurité, et ont un long
	délai limite, ou pas du tout, d'expiration pour les tentatives de
	connexions.  Cela permet à une personne malveillante
	d'envoyer régulièrement et de manière
	espacée des demandes de connexions à un
	&#8220;daemon&#8221; particulier, avec pour conséquence
	de saturer les ressources disponibles.  Cela peut être
	une bonne idée de placer des limitations
	<code class="option">nb-max-connexions-par-ip-par-minute</code>,
	<code class="option">max-child</code> ou
	<code class="option">nb-max-enfants</code> sur certains
	<span class="quote">« <span class="quote">daemon</span> »</span>s si vous trouvez que vous avez trop de
	connexions.</p><p>Par défaut, le &#8220;TCP wrapping&#8221; est
	activé.  Consultez la page de manuel
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=hosts_access&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">hosts_access</span>(5)</span></a> pour plus d'information sur le placement
	de restrictions TCP pour divers &#8220;daemon&#8221;s
	invoqués par <span class="application">inetd</span>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="network-inetd-misc"></a>29.2.6. Divers</h3></div></div></div><p><span class="application">daytime</span>,
	<span class="application">time</span>,
	<span class="application">echo</span>,
	<span class="application">discard</span>,
	<span class="application">chargen</span>, et
	<span class="application">auth</span> sont des services fournis en
	interne par <span class="application">inetd</span>.</p><p>Le  service <span class="application">auth</span> fournit les
	services réseau d'identification,
	et est configurable
	à un certain degré, alors que les autres
	services ne peuvent être que stoppés ou en
	fonctionnement.</p><p>Consultez la page de manuel de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=inetd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">inetd</span>(8)</span></a> pour plus
	d'informations.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-servers.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="network-servers.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="network-nfs.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">Chapitre 29. Serveurs réseau </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 29.3. Système de fichiers réseau (NFS)</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>