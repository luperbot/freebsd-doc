<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>19.15. Quotas d'utilisation des disques</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="disks.html" title="Chapitre 19. Stockage des données" /><link rel="prev" href="snapshots.html" title="19.14. Instantané (&#8220;Snapshot&#8221;) d'un système de fichiers" /><link rel="next" href="disks-encrypting.html" title="19.16. Chiffrer les partitions d'un disque" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">19.15. Quotas d'utilisation des disques</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="snapshots.html">Précédent</a> </td><th width="60%" align="center">Chapitre 19. Stockage des données</th><td width="20%" align="right"> <a accesskey="n" href="disks-encrypting.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="quotas"></a>19.15. Quotas d'utilisation des disques</h2></div></div></div><a id="idp80891856" class="indexterm"></a><a id="idp80893008" class="indexterm"></a><p>Les quotas sont une option du système d'exploitation
      qui vous permet de limiter la quantité d'espace disque
      et/ou le nombre de fichiers auxquels ont droit un utilisateur
      ou tous les utilisateurs d'un même groupe, sur un système
      de fichiers donné.  On les utilise la plupart du temps
      sur les systèmes en temps partagé où il est
      souhaitable de limiter la quantité de ressources allouée
      à un utilisateur ou à un groupe.  Cela évitera qu'un
      utilisateur ou un groupe d'utilisateur consomme tout l'espace
      disque.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80893904"></a>19.15.1. Configurer votre système pour pouvoir utiliser
	les quotas d'utilisation des disques</h3></div></div></div><p>Avant d'essayer de mettre en place des quotas disque, il
	est nécessaire de s'assurer que le noyau est configuré
	pour les quotas.  Cela se fait en ajoutant la ligne suivante
	dans votre fichier de configuration du noyau:</p><pre class="programlisting">options QUOTA</pre><p>Cette option n'est pas activée par défaut dans le
	noyau <code class="filename">GENERIC</code> de base, vous devrez donc
	configurer, compiler et installer un noyau sur-mesure pour
	utiliser les quotas disque.  Reportez-vous au chapitre <a class="xref" href="kernelconfig.html" title="Chapitre 9. Configurer le noyau de FreeBSD">Chapitre 9, <em>Configurer le noyau de FreeBSD</em></a> pour plus d'informations sur la
	configuration du noyau.</p><p>Ensuite vous devrez activer les quotas disques dans le
	fichier <code class="filename">/etc/rc.conf</code>.  Pour cela, ajoutez
	la ligne:</p><pre class="programlisting">enable_quotas="YES"</pre><a id="idp80934736" class="indexterm"></a><p>Pour un contrôle plus fin des quotas au démarrage
	du système, il existe une variable supplémentaire de
	configuration.  Normalement au démarrage,
	l'intégrité des quotas sur chaque système de
	fichiers est vérifiée par le programme
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a>.  Ce programme s'assure que les données
	de la base de données des quotas correspondent bien aux
	données présentes sur le système de
	fichiers.  C'est un processus consommateur en temps qui
	affectera considérablement la durée de
	démarrage du système.  Si vous désirez passer
	cette étape, une variable dans
	<code class="filename">/etc/rc.conf</code> est prévue à cet
	effet:</p><pre class="programlisting">check_quotas="NO"</pre><p>Vous devez enfin éditer le fichier
	<code class="filename">/etc/fstab</code> pour activer les quotas
	système de fichiers par système de fichiers.  C'est
	là que vous pouvez soit activer les quotas par utilisateur ou
	par groupe soit les pour les deux sur tous vos systèmes
	de fichiers.</p><p>Pour activer les quotas par utilisateur sur un système
	de fichiers, ajouter l'option <code class="option">userquota</code>
	dans le champ d'options sur l'entrée de
	<code class="filename">/etc/fstab</code> pour le système de fichiers
	sur lequel vous voulez activer les quotas.  Par
	exemple:</p><pre class="programlisting">/dev/da1s2g   /home    ufs rw,userquota 1 2</pre><p>De même, pour activer les quotas par groupe, utilisez
	l'option <code class="option">groupquota</code> à la place de
	<code class="option">userquota</code>.  Pour activer à la fois les quotas
	par utilisateur et par groupe, modifiez l'entrée de la
	façon suivante:</p><pre class="programlisting">/dev/da1s2g    /home    ufs rw,userquota,groupquota 1 2</pre><p>Par défaut, les fichiers où sont définis les
	quotas dans le répertoire racine du système de fichiers
	sous les noms <code class="filename">quota.user</code> et
	<code class="filename">quota.group</code>, respectivement pour les
	quotas utilisateur et les quotas par groupe.  Consultez
	la page de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> pour plus d'information.
	Bien que la page de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fstab&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">fstab</span>(5)</span></a> indique que vous
	pouvez spécifier un autre emplacement pour ces fichiers,
	cela n'est pas recommandé parce que les divers utilitaires
	qui gèrent les quotas ne semblent pas les prendre correctement
	en compte.</p><p>A ce point vous devriez redémarrer votre système
	avec votre nouveau noyau.  La procédure
	<code class="filename">/etc/rc</code> exécutera automatiquement les
	commandes nécessaires pour créer les fichiers de quotas
	initiaux pour tous les quotas que vous avez définis
	dans <code class="filename">/etc/fstab</code>, vous n'avez donc pas
	besoin de créer à la main de fichiers de
	quotas vides.</p><p>Vous ne devriez pas avoir à exécuter les
	commandes <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotacheck&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotacheck</span>(8)</span></a>, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotaon&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotaon</span>(8)</span></a>, ou
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quotaoff&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">quotaoff</span>(8)</span></a> manuellement.  Cependant, vous pouvez lire
	leur page de manuel pour vous familiariser avec leur
	rôle.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80948432"></a>19.15.2. Définir les quotas</h3></div></div></div><a id="idp80949072" class="indexterm"></a><p>Une fois que vous avez activé les quotas sur votre
	système, assurez-vous que cela fonctionne correctement.
	Une manière simple de le faire est
	d'exécuter:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>quota -v</code></strong></pre><p>Vous devriez obtenir une ligne résumant l'utilisation
	disque avec les quotas actuellement définis pour chaque
	système de fichiers sur lesquels il y a des quotas.</p><p>Vous êtes maintenant prêt à définir les
	quotas avec la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>.</p><p>Vous disposez de différentes options pour instaurer
	les quotas d'espace disque alloué à un utilisateur
	ou à un groupe, et le nombre de fichiers qu'ils peuvent
	créer.  Vous pouvez baser les limitations sur l'espace disque
	alloué (quotas en nombre de blocs) ou sur le nombre de
	fichiers (quotas en inode) ou les deux.  Ces options
	peuvent être divisées en deux catégories: les
	limites strictes ou souples.</p><a id="idp80957648" class="indexterm"></a><p>Une limite stricte ne peut être dépassée.
	Une fois qu'un utilisateur atteint sa limite stricte, il
	ne pourra plus rien allouer sur le système de fichiers
	en question.  Par exemple, si l'utilisateur a droit à une
	limite stricte de 500 Ko sur un système de fichiers et en
	utilise 490  Ko, il ne pourra allouer que 10 Ko
	supplémentaires.  Une tentative d'allouer 11 Ko
	échouerait.</p><a id="idp80958544" class="indexterm"></a><p>Une limite souple peut être dépassée
	pour une période de temps restreinte.  C'est ce que l'on
	appelle le délai de grâce, qui est d'une semaine
	par défaut.  Si un utilisateur dépasse cette limite
	au delà du délai de grâce, cette limite
	devient stricte, et plus aucune allocation ne sera possible.
	Quand l'utilisateur redescend en dessous de la limite souple,
	le délai de grâce est à nouveau
	réaccordé.</p><p>Ce qui suit est un exemple de ce que vous pourrez voir
	en utilisant la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>.  Quand vous invoquez
	la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>, vous vous retrouvez dans
	l'éditeur défini par la variable d'environnement
	<code class="envar">EDITOR</code>, ou sous <span class="application">vi</span>
	si la variable d'environnement <code class="envar">EDITOR</code> n'est
	pas positionnée, ce qui vous permet d'éditer les
	quotas.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>edquota -u test</code></strong></pre><pre class="programlisting">Quotas for user test:
/usr: kbytes in use: 65, limits (soft = 50, hard = 75)
        inodes in use: 7, limits (soft = 50, hard = 60)
/usr/var: kbytes in use: 0, limits (soft = 50, hard = 75)
        inodes in use: 0, limits (soft = 50, hard = 60)</pre><p>Vous verrez normalement deux lignes pour chaque système
	de fichiers sur lequel il y a des quotas.  Une ligne pour
	les quotas de blocs, et une autre pour la limite d'inode.
	Modifiez simplement les valeurs que vous voulez mettre à jour.
	Par exemple, pour augmenter la limite de blocs accordée
	à cet utilisateur de 50 pour la limite souple et de 75 pour la
	limite stricte à 500 pour la limite souple et 600 pour la
	limite stricte, modifiez:</p><pre class="programlisting">/usr: kbytes in use: 65, limits (soft = 50, hard = 75)</pre><p>en:</p><pre class="programlisting">/usr: kbytes in use: 65, limits (soft = 500, hard = 600)</pre><p>Les nouveaux quotas seront en service dès que vous
	quitterez l'éditeur.</p><p>Il est parfois souhaitable de définir des quotas
	pour une plage d'UIDs (identifiants utilisateur).  Cela
	peut être réalisé avec l'option
	<code class="option">-p</code> de la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>.
	Définissez d'abord les quotas pour un seul utilisateur, et
	puis exécutez
	<code class="command">edquota -p protouser startuid-enduid</code>.
	Par exemple, si l'utilisateur <code class="systemitem">test</code>
	dispose des quotas désirés, la commande suivante peut
	être utilisée pour appliquer ces quotas pour les UIDs
	de 10000 à 19999:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>edquota -p test 10000-19999</code></strong></pre><p>Pour plus d'informations consultez la page de manuel
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=edquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">edquota</span>(8)</span></a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80978768"></a>19.15.3. Consulter les quotas et l'utilisation des disques</h3></div></div></div><a id="idp80979408" class="indexterm"></a><p>Vous pouvez soit utiliser la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a>
	soit la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=repquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">repquota</span>(8)</span></a> pour consulter les quotas
	et l'utilisation des disques.  La commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a>
	peut être employée pour connaître
	les quotas et l'utilisation des disques pour un utilisateur et
	un groupe.  Un utilisateur ne peut consulter que ses propres
	quotas et ceux d'un groupe auquel il appartient.  Seul le
	super-utilisateur peut consulter les quotas et l'usage disque
	de tous les utilisateurs et groupes.  La commande
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=repquota&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">repquota</span>(8)</span></a> permet d'obtenir un résumé de tous
	les quotas et l'utilisation disque pour les systèmes
	de fichiers sur lesquels il y a des quotas.</p><p>Ce qui suit est un extrait de la sortie de la commande
	<code class="command">quota -v</code> pour un utilisateur pour lequel
	on a défini des quotas sur deux systèmes de
	fichiers.</p><pre class="programlisting">Disk quotas for user test (uid 1002):
     Filesystem  usage   quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</pre><a id="idp80985168" class="indexterm"></a><p>Sur le système de fichiers <code class="filename">/usr</code>
	dans l'exemple ci-dessus, l'utilisateur occupe 15 Ko de
	plus que la limite de 50 Ko qui lui est allouée et
	dispose d'un délai de grâce de 5 jours.  Notez
	l'astérisque <code class="literal">*</code> qui indique que
	l'utilisateur dépasse actuellement son quota.</p><p>Normalement les systèmes de fichiers sur lesquels
	l'utilisateur n'occupe pas d'espace n'apparaissent pas
	dans la sortie de la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a>, même s'il a des
	quotas sur ces systèmes de fichiers.  L'option
	<code class="option">-v</code> listera ces systèmes de fichiers, comme
	<code class="filename">/usr/var</code> dans l'exemple ci-dessus.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp80989008"></a>19.15.4. Quotas avec NFS</h3></div></div></div><a id="idp80989648" class="indexterm"></a><p>Les quotas sont gérés par le sous-système
	de gestion des quotas sur le serveur NFS.  Le démon
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=rpc.rquotad&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">rpc.rquotad</span>(8)</span></a> fournit les informations sur les quotas
	à la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=quota&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">quota</span>(1)</span></a> des clients NFS, permettant
	aux utilisateurs sur ces machines de consulter l'utilisation
	des quotas qui leur sont alloués.</p><p>Activez <code class="command">rpc.rquotad</code> dans
	<code class="filename">/etc/inetd.conf</code> de la façon
	suivante:</p><pre class="programlisting">rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</pre><p>Puis redémarrez <code class="command">inetd</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kill -HUP `cat /var/run/inetd.pid`</code></strong></pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="snapshots.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="disks-encrypting.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">19.14. Instantané (&#8220;Snapshot&#8221;) d'un système de fichiers </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 19.16. Chiffrer les partitions d'un disque</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>