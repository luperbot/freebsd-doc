<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>13.3. Le gestionnaire de démarrage et les étapes de démarrage</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="boot.html" title="Chapitre 13. Processus de démarrage de FreeBSD" /><link rel="prev" href="boot-introduction.html" title="13.2. Le problème du démarrage" /><link rel="next" href="boot-kernel.html" title="13.4. Interaction avec le noyau au démarrage" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">13.3. Le gestionnaire de démarrage et les étapes de
      démarrage</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="boot-introduction.html">Précédent</a> </td><th width="60%" align="center">Chapitre 13. Processus de démarrage de FreeBSD</th><td width="20%" align="right"> <a accesskey="n" href="boot-kernel.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="boot-blocks"></a>13.3. Le gestionnaire de démarrage et les étapes de
      démarrage</h2></div></div></div><a id="idp77583184" class="indexterm"></a><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-boot0"></a>13.3.1. Le gestionnaire de démarrage</h3></div></div></div><a id="idp77584464" class="indexterm"></a><p>Le code contenu dans le MBR ou gestionnaire de
	démarrage ou d'amorce est parfois appelé
	<span class="emphasis"><em>étape zéro</em></span> du processus de
	démarrage.  Cette section discute de deux gestionnaires
	de démarrage précédemment
	mentionnés: <span class="application">boot0</span> et
	<span class="application">LILO</span>.</p><p><span class="formalpara-title">Le gestionnaire d'amorce
	<span class="application">boot0</span>: </span>Le MBR installé par l'installateur FreeBSD ou par
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=boot0cfg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">boot0cfg</span>(8)</span></a> est basé sur
	<code class="filename">/boot/boot0</code>.
	(<code class="filename">boot0</code> est très simple, puisque le
	programme dans le <abbr class="abbrev">MBR</abbr> ne peut pas occuper plus
	de 446 octets en raison de la
	table de partition principale et l'identifiant
	<code class="literal">0x55AA</code> à la fin du MBR).
	Si vous avez installé <span class="application">boot0</span>
	et plusieurs systèmes d'exploitation sur vos disques durs alors
	vous verrez un affichage semblable à celui-ci au
	démarrage:</p><div class="example"><a id="boot-boot0-example"></a><div class="example-title">Exemple 13.1. Ecran de <code class="filename">boot0</code></div><div class="example-contents"><pre class="screen">F1 DOS
F2 FreeBSD
F3 Linux
F4 ??
F5 Drive 1

Default: F2</pre></div></div><br class="example-break" /><p>D'autres systèmes d'exploitation, en particulier
	<span class="trademark">Windows</span>®, sont connus pour écraser le MBR existant avec le
	leur.  Si cela vous arrive, ou que vous désirez remplacer
	le MBR existant avec le MBR de FreeBSD alors utilisez la commande
	suivante:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>fdisk -B -b /boot/boot0 device</code></strong></pre><p>où <em class="replaceable"><code>device</code></em> est le
	périphérique à partir duquel vous
	démarrez, comme <code class="filename">ad0</code> pour le premier
	disque IDE, <code class="filename">ad2</code> pour le premier disque
	IDE sur le second contrôleur IDE, <code class="filename">da0</code>
	pour le premier disque SCSI, et ainsi de suite.  Ou, si vous
	voulez une configuration sur mesure du MBR, employez
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=boot0cfg&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">boot0cfg</span>(8)</span></a>.</p><p><span class="formalpara-title">Le gestionnaire de démarrage LILO: </span>Pour installer ce gestionnaire de manière à ce qu'il
	  amorce également FreeBSD, démarrez tout d'abord Linux et
	  ajoutez ce qui suit au fichier de configuration
	  <code class="filename">/etc/lilo.conf</code>:</p><pre class="programlisting">other=/dev/hdXY
table=/dev/hdX
loader=/boot/chain.b
label=FreeBSD</pre><p>Dans ce qui précède, précisez la
	partition primaire et le disque FreeBSD en utilisant les
	paramètres propres à Linux, en remplaçant
	<em class="replaceable"><code>X</code></em> avec la lettre correspondant au
	disque Linux et <em class="replaceable"><code>Y</code></em> avec le
	numéro de la partition primaire Linux.  Si vous
	utilisez un disque <acronym class="acronym">SCSI</acronym>, vous changerez
	<em class="replaceable"><code>/dev/hd</code></em> pour quelque chose de
	semblable à <em class="replaceable"><code>/dev/sd</code></em>.  La ligne
	<code class="option">loader=/boot/chain.b</code> peut être omise si vous
	avez les deux systèmes d'exploitation sur le même disque.
	Lancez maintenant la commande <code class="command">/sbin/lilo -v</code> pour
	entériner vos modifications; des messages de contrôle
	devraient s'afficher, vérifiant ces modifications.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-boot1"></a>13.3.2. Etape une, <code class="filename">/boot/boot1</code>, et étape deux,
	<code class="filename">/boot/boot2</code></h3></div></div></div><p>Conceptuellement la première et la seconde étapes
	font partie du même programme, sur le même emplacement du
	disque.  Mais en raison de contraintes d'espace elles ont
	été divisées en deux, mais vous les installerez
	toujours de paire.  Elles sont copiées, à partir
	du fichier combiné <code class="filename">/boot/boot</code>, par
	l'installateur ou <span class="application">bsdlabel</span> (voir
	plus bas).</p><p>On les trouve en dehors des systèmes de fichiers,
	sur la première piste de la tranche de
	démarrage, à partir du premier secteur.  C'est
	l'endroit où <a class="link" href="boot-blocks.html#boot-boot0" title="13.3.1. Le gestionnaire de démarrage">boot0</a>, ou tout autre gestionnaire
	de démarrage s'attend à trouver le code à
	exécuter pour continuer le processus de démarrage.
	Le nombre de secteurs utilisés est facilement
	déterminé à partir de la taille du
	fichier <code class="filename">/boot/boot</code>.</p><p><code class="filename">boot1</code> est très simple, puisqu'il est
	limité à 512 octets, et en
	sait juste assez du
	<em class="firstterm">bsdlabel</em> de FreeBSD, qui contient
	l'information sur la tranche, pour trouver et lancer
	<code class="filename">boot2</code>.</p><p><code class="filename">boot2</code> est légèrement
	plus sophistiqué, et en connaît assez sur le
	système de fichiers
	de FreeBSD pour y trouver des fichiers, et il peut également
	fournir une interface simple pour sélectionner un noyau ou un
	chargeur à exécuter.</p><p>Comme le <a class="link" href="boot-blocks.html#boot-loader" title="13.3.3. Etape trois, /boot/loader">chargeur</a> est
	beaucoup plus sophistiqué, et dispose d'une interface de
	configuration du démarrage facile d'emploi,
	<code class="filename">boot2</code> l'exécute habituellement, bien que
	précédemment, c'est lui qui
	lançait directement le noyau.</p><div class="example"><a id="boot-boot2-example"></a><div class="example-title">Exemple 13.2. Ecran de <code class="filename">boot2</code></div><div class="example-contents"><pre class="screen">&gt;&gt; FreeBSD/i386 BOOT
Default: 0:ad(0,a)/boot/loader
boot:</pre></div></div><br class="example-break" /><p>Si vous avez un jour besoin de remplacer
	<code class="filename">boot1</code> et <code class="filename">boot2</code>,
	utilisez <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -B diskslice</code></strong></pre><p>où <em class="replaceable"><code>diskslice</code></em> est le disque et la
	tranche à partir de laquelle vous démarrez, comme
	<code class="filename">ad0s1</code> pour la première tranche sur le
	premier disque IDE.</p><div xmlns="" class="warning"><h3 class="admontitle">Mode dangereusement dédié: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si vous utilisez juste le nom du disque, comme
	  <code class="filename">ad0</code>, dans la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a>
	  vous créerez un disque dangereusement dédié,
	  sans tranches.
	  Ce n'est presque certainement pas ce que vous voulez faire,
	  donc vérifiez à deux fois la commande
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a> avant d'appuyer sur
	  <span class="keycap"><strong>Entrée</strong></span>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-loader"></a>13.3.3. Etape trois, <code class="filename">/boot/loader</code></h3></div></div></div><a id="idp77644112" class="indexterm"></a><p>Le chargeur est la dernière étape
      du processus de démarrage en trois temps, et il réside sur
      le système de fichiers, c'est habituellement le fichier
      <code class="filename">/boot/loader</code>.</p><p>Le chargeur a pour objet de fournir une méthode de
      configuration conviviale, en utilisant un jeu de commandes faciles
      d'emploi, doublé d'un interpréteur plus puissant, avec un
      ensemble de commandes plus complexes.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-loader-flow"></a>13.3.3.1. Déroulement des opérations du chargeur</h4></div></div></div><p>A l'initialisation, le chargeur recherchera la console et
	les disques, et déterminera à partir de quel disque
	démarrer.  Il positionnera les variables en
	conséquence, et un interpréteur sera lancé
	pour lequel l'utilisateur pourra passer des commandes par
	l'intermédiaire d'une procédure ou de façon
	interactive.</p><a id="idp77646928" class="indexterm"></a><a id="idp77647440" class="indexterm"></a><p>Le chargeur lira ensuite
	<code class="filename">/boot/loader.rc</code>, qui lui ira lire
	dans <code class="filename">/boot/defaults/loader.conf</code>
	les valeurs par défaut des variables à positionner et dans
	<code class="filename">/boot/loader.conf</code> les variantes locales de
	ces dernières.  <code class="filename">loader.rc</code> se sert de ces
	variables pour charger les modules et le noyau
	sélectionnés.</p><p>Finalement, par défaut, le chargeur attend 10 secondes l'appui
	sur une ou plusieurs touches, et démarre le noyau s'il n'est pas
	interrompu.  S'il est interrompu, une invite est alors affichée
	à l'utilisateur, un jeu de commandes simples permet à
	l'utilisateur de modifier des variables, charger ou décharger des
	modules, et enfin démarrer ou redémarrer.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-loader-commands"></a>13.3.3.2. Commandes intégrées au chargeur</h4></div></div></div><p>Voici les commandes du chargeur les plus utilisées.
	Pour une information complète sur toutes les commandes
	disponibles, veuillez consulter la page <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=loader&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">loader</span>(8)</span></a>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">autoboot <em class="replaceable"><code>secondes</code></em></span></dt><dd><p>Démarre le noyau si elle n'est pas interrompue
	      dans le laps de temps donné en secondes.  Elle affiche
	      un compte à rebours, et le délai par défaut
	      est de 10 secondes.</p></dd><dt><span class="term">boot
	    [<span class="optional">-options</span>]
	    [<span class="optional">nom_du_noyau</span>]</span></dt><dd><p>Démarre immédiatement le noyau dont le nom
	      est indiqué, avec les options données,
	      s'il y en a.</p></dd><dt><span class="term">boot-conf</span></dt><dd><p>Passe par la même configuration automatique
	      des modules basée sur des variables comme ce
	      qui se produit au démarrage.  Cela n'a de sens
	      que si vous utilisez <code class="command">unload</code> en premier,
	      et modifiez certaines variables, généralement
	      <code class="envar">kernel</code>.</p></dd><dt><span class="term">help
	    [<span class="optional">sujet</span>]</span></dt><dd><p>Affiche les messages d'aide contenus dans
	      <code class="filename">/boot/loader.help</code>.  Si le sujet donné
	      est <code class="literal">index</code>, alors c'est la liste de tous les
	      sujets existants qui est donnée.</p></dd><dt><span class="term">include <em class="replaceable"><code>nom_du_fichier</code></em>
	    &#8230;</span></dt><dd><p>Traite le fichier dont le nom est donné.
	      Le fichier est lu, et interprété ligne par ligne.
	      Une erreur stoppe immédiatement le traitement.</p></dd><dt><span class="term">load [<span class="optional">-t
	    type</span>]
	    <em class="replaceable"><code>nom_du_fichier</code></em></span></dt><dd><p>Charge le noyau, le module, ou le fichier du type
	      donné, dont le nom est passé en
	      paramètre.  Les arguments qui suivent le nom du fichier
	      sont passés au fichier.</p></dd><dt><span class="term">ls [<span class="optional">-l</span>]
	    [<span class="optional">chemin_d_accès</span>]</span></dt><dd><p>Affiche la liste des fichiers du répertoire
	      donné, ou du répertoire racine, si le chemin
	      d'accès n'est pas précisé.
	      Si l'option <code class="option">-l</code> est utilisée, les
	      tailles des fichiers seront également
	      listées.</p></dd><dt><span class="term">lsdev [<span class="optional">-v</span>]</span></dt><dd><p>Liste tous les périphériques depuis lesquels
	      il sera possible de charger des modules.  Si l'option
	      <code class="option">-v</code> est utilisée, plus de détails
	      seront donnés.</p></dd><dt><span class="term">lsmod [<span class="optional">-v</span>]</span></dt><dd><p>Affiche la liste des modules chargés.
	      Si l'option <code class="option">-v</code> est utilisée, plus de
	      détails seront donnés.</p></dd><dt><span class="term">more <em class="replaceable"><code>nom_du_fichier</code></em></span></dt><dd><p>Affiche les fichiers indiqués, avec une pause toutes
	      <code class="varname">LINES</code> lignes.</p></dd><dt><span class="term">reboot</span></dt><dd><p>Redémarre immédiatement le
	      système.</p></dd><dt><span class="term">set <em class="replaceable"><code>variable</code></em>, </span><span class="term">set
	    <em class="replaceable"><code>variable</code></em>=<em class="replaceable"><code>value</code></em></span></dt><dd><p>Positionne les variables d'environnement du
	      chargeur.</p></dd><dt><span class="term">unload</span></dt><dd><p>Retire de la mémoire tous les modules
	      chargés.</p></dd></dl></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="boot-loader-examples"></a>13.3.3.3. Exemples d'utilisation du chargeur</h4></div></div></div><p>Voici quelques exemples pratiques d'utilisation du
	chargeur:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Pour simplement démarrer votre noyau habituel,
	    mais en mode mono-utilisateur:<a id="idp77716304" class="indexterm"></a></p><pre class="screen"><strong class="userinput"><code>boot -s</code></strong></pre></li><li class="listitem"><p>Pour décharger votre noyau et modules habituels,
	  puis charger votre ancien (ou un autre) noyau:</p><pre class="screen"><strong class="userinput"><code>unload</code></strong>
<strong class="userinput"><code>load kernel.old</code></strong></pre><p>Vous pouvez utiliser <code class="filename">kernel.GENERIC</code>
	    pour faire référence au noyau
	    générique du disque d'installation, ou
	    <code class="filename">kernel.old</code><a id="idp77719888" class="indexterm"></a> pour désigner votre noyau
	    précédent (quand vous avez mis à jour ou
	    configuré votre propre noyau, par exemple).</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Utilisez ce qui suit pour charger vos modules
	      habituels avec un autre noyau:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><strong class="userinput"><code>unload</code></strong>
<strong class="userinput"><code>set kernel="kernel.old"</code></strong>
<strong class="userinput"><code>boot-conf</code></strong></pre></div></li><li class="listitem"><p>Pour charger une procédure de configuration
	    du noyau (une procédure qui automatise ce que vous faites
	    normalement avec l'outil de configuration du noyau au
	    démarrage):</p><pre class="screen"><strong class="userinput"><code>load -t userconfig_script /boot/kernel.conf</code></strong></pre></li></ul></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="boot-introduction.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="boot.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="boot-kernel.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">13.2. Le problème du démarrage </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 13.4. Interaction avec le noyau au démarrage</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>