<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>19.3. Ajouter des disques</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="disks.html" title="Chapitre 19. Stockage des données" /><link rel="prev" href="disks-naming.html" title="19.2. Noms des périphériques" /><link rel="next" href="raid.html" title="19.4. RAID" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">19.3. Ajouter des disques</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="disks-naming.html">Précédent</a> </td><th width="60%" align="center">Chapitre 19. Stockage des données</th><td width="20%" align="right"> <a accesskey="n" href="raid.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="disks-adding"></a>19.3. Ajouter des disques</h2></div><div><span class="authorgroup">Contribution originale de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">David</span> <span class="surname">O'Brien</span></span>. </span></div></div></div><a id="idp79739856" class="indexterm"></a><p>Supposons que nous voulions ajouter un second disque SCSI
      à une machine qui n'a pour l'instant qu'un seul disque.
      Commençons par arrêter l'ordinateur et installer le disque
      en suivant les instructions données par le constructeur de
      l'ordinateur, du contrôleur et du disque.  Comme il y a de
      nombreuses façon de procéder, ces détails
      dépassent le cadre de ce document.</p><p>Ouvrons maintenant une session sous le compte
      <code class="systemitem">root</code>.  Après avoir installé le disque,
      consultez le fichier <code class="filename">/var/run/dmesg.boot</code>
      pour vérifier que le nouveau disque a été
      reconnu.  Dans notre exemple, le disque que nous venons
      d'ajouter sera le périphérique
      <code class="filename">da1</code> et nous le monterons sur le
      répertoire <code class="filename">/1</code> (si vous ajoutez
      un disque IDE, le nom de périphérique sera
      <code class="filename">ad1</code>).</p><a id="idp79743824" class="indexterm"></a><a id="idp79744336" class="indexterm"></a><a id="idp79744848" class="indexterm"></a><p>FreeBSD tourne sur des ordinateurs compatibles IBM-PC,
      il doit tenir compte des partitions PC BIOS.  Ces dernières
      sont différentes des partitions BSD traditionnelles.
      Un disque PC peut avoir jusqu'à quatre partitions.  Si le
      disque va être réservé uniquement à FreeBSD,
      vous pouvez utiliser le mode <span class="emphasis"><em>dédié</em></span>.
      Sinon, FreeBSD devra utiliser une des partitions PC BIOS.
      FreeBSD appelle les partitions PC BIOS
      <span class="emphasis"><em>tranches</em></span> (&#8220;slices&#8221;) pour
      les distinguer des partitions BSD traditionnelles.
      Vous pouvez aussi des tranches sur un disque dédié
      à FreeBSD, mais utilisé sur une machine où
      un autre système d'exploitation est également
      installé.  C'est une bonne manière pour
      éviter de perturber l'utilitaire <code class="command">fdisk</code>
      des autres système d'exploitation différents de
      FreeBSD.</p><p>Dans le cas d'une tranche, le disque ajouté deviendra
      le périphérique <code class="filename">/dev/da1s1e</code>.
      Ce qui se lit: disque SCSI, numéro d'unité 1 (second disque
      SCSI), tranche 1 (partition PC BIOS 1), et partition BSD
      <code class="filename">e</code>.  Dans le cas du mode dédié,
      le disque sera ajouté en tant que
      <code class="filename">/dev/da1e</code>.</p><p>En raison de l'utilisation d'entiers codés sur 32
      bits pour stocker le nombre de secteurs, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">bsdlabel</span>(8)</span></a>
      est
      limité à 2^32-1 secteurs par disque ou 2TB dans la
      plupart des cas.  Le format <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=fdisk&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">fdisk</span>(8)</span></a> n'autorise pas de
      secteur au delà de 2^32-1 et une largeur de plus de
      2^32-1, limitant donc les partitions à 2TB et les disques
      à 4TB en général.  Le format
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sunlabel&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sunlabel</span>(8)</span></a> est limité à 2^32-1 secteur par
      partition et 8 partitions pour un total de 16TB d'espace.  Pour
      des disques plus importants, les partitions <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gpt&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">gpt</span>(8)</span></a> peuvent
      être utilisées.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79764816"></a>19.3.1. Utiliser <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysinstall&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysinstall</span>(8)</span></a></h3></div></div></div><a id="idp79770320" class="indexterm"></a><a id="idp79771600" class="indexterm"></a><div class="procedure"><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Naviguer dans <span class="application">sysinstall</span></strong></p><p>Vous pouvez utiliser <code class="command">sysinstall</code>
	    et ses menus simples d'emploi pour partitionner et
	    libeller le nouveau disque.  Ouvrez une session sous
	    le compte super-utilisateur <code class="systemitem">root</code> ou
	    utilisez la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=su&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a>.  Lancez
	    <code class="command">sysinstall</code> et sélectionnez
	    <span class="guimenuitem">Configure</span>.  A l'intérieur
	    du menu <span class="guimenuitem">FreeBSD Configuration
	    Menu</span>, descendez et sélectionnez l'option
	    <span class="guimenuitem">Fdisk</span>.</p></li><li class="step"><p class="title"><strong>L'éditeur de partition
	    <span class="application">fdisk</span></strong></p><p>Une fois dans l'utilitaire <span class="application">fdisk</span>,
	    nous pouvons taper <span class="keycap"><strong>A</strong></span> pour utiliser tout
	    le disque pour FreeBSD.  Lorsque l'on vous demande si vous
	    voulez garder la possibilité de pouvoir coopérer avec
	    d'autres systèmes d'exploitation (&#8220;remain
	    cooperative with any future possible operating
	    systems&#8221;), répondez par l'affirmative
	    (<code class="literal">YES</code>).  Enregistrez les modifications
	    sur le disque avec <span class="keycap"><strong>W</strong></span>.  Quittez maintenant
	    l'éditeur <span class="application">fdisk</span> en tapant
	    <span class="keycap"><strong>q</strong></span>.  La prochaine question concernera le
	    secteur de démarrage (&#8220;Master Boot Record&#8221;).
	    Comme vous ajoutez un disque à un système
	    déjà opérationnel, choisissez
	    <span class="guibutton">None</span>.</p></li><li class="step"><p class="title"><strong>L'éditeur de label du disque</strong></p><a id="idp79786192" class="indexterm"></a><p>Ensuite, vous devez quitter puis relancer
	    <span class="application">sysinstall</span>.  Suivez les
	    instructions précédentes, en choisissant cette fois
	    l'option <span class="guimenuitem">Label</span>.  Vous entrerez
	    dans l'éditeur de label du disque (<code class="literal">Disk Label
	    Editor</code>).  C'est là que vous allez créer
	    les partitions BSD traditionnelles.  Un disque peut avoir
	    jusqu'à huit partitions, libellées de
	    <code class="literal">a</code> à <code class="literal">h</code>.  Certains
	    de ces labels ont des significations particulières.
	    La partition <code class="literal">a</code> est la partition racine
	    (<code class="filename">/</code>).  Seul votre disque système
	    (e.g., celui à partir duquel vous démarrez)
	    doit avoir une partition <code class="literal">a</code>.  La
	    partition <code class="literal">b</code> est utilisée pour la
	    pagination, vous pouvez avoir plusieurs disques avec des
	    partitions de pagination.  La partition
	    <code class="literal">c</code> désigne la totalité du
	    disque en mode dédié, ou toute la tranche
	    FreeBSD dans le cas contraire.  Les autres partitions sont
	    à usage général.</p><p>L'éditeur de label de
	    <span class="application">sysinstall</span> définit par
	    défaut
	    la partition <code class="literal">e</code> comme première partition
	    qui n'est ni racine, ni de pagination.  Dans l'éditeur
	    de label, créez un seul système de fichiers avec
	    l'option <span class="keycap"><strong>C</strong></span>.  Quand on vous demande si ce sera un
	    système de fichiers (FS) ou une partition de pagination,
	    choisissez <code class="literal">FS</code> et indiquez un point de
	    montage (e.g., <code class="filename">/mnt</code>).  Lorsque vous
	    ajoutez un disque sur un système déjà
	    installé, <span class="application">sysinstall</span> ne
	    créera
	    pas d'entrées dans <code class="filename">/etc/fstab</code>, donc
	    le nom que vous donnez au point de montage n'a pas
	    d'importance.</p><p>Vous pouvez maintenant écrire le nouveau label sur
	    le disque et y créer un système de fichiers.
	    Faites-le en tapant <span class="keycap"><strong>W</strong></span>.  Ignorez les
	    erreurs de <span class="application">sysinstall</span>
	    disant que la nouvelle partition ne peut être
	    montée.  Quittez maintenant l'éditeur de label et
	    <span class="application">sysinstall</span>.</p></li><li class="step"><p class="title"><strong>Dernière étape</strong></p><p>La dernière étape consiste à éditer
	    le fichier <code class="filename">/etc/fstab</code> pour y
	    ajouter une entrée pour votre nouveau disque.</p></li></ol></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79797968"></a>19.3.2. Utiliser les utilitaires en ligne de commande</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79798608"></a>19.3.2.1. Utiliser les tranches &#8212; &#8220;slices&#8221;</h4></div></div></div><p>Cette configuration permettra de faire fonctionner
	  correctement votre disque dure avec d'autres systèmes
	  d'exploitation qui pourraient être installé
	  sur votre machine, et ne perturbera pas les utilitaires
	  <code class="command">fdisk</code> de ces autres systèmes
	  d'exploitation.  C'est la méthode recommandée
	  pour l'installation de nouveau disques.  N'utilisez le mode
	  <span class="emphasis"><em>dédié</em></span> que si vous avez une bonne
	  raison de le faire!</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/dev/da1 bs=1k count=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>fdisk -BI da1</code></strong> #Initialize your new disk
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -B -w da1s1 auto</code></strong> #Label it.
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -e da1s1</code></strong> # Edit the disklabel just created and add any partitions.
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/da1s1e</code></strong> # Repeat this for every partition you created.
<code class="prompt">#</code> <strong class="userinput"><code>mount /dev/da1s1e /1</code></strong> # Mount the partition(s)
<code class="prompt">#</code> <strong class="userinput"><code>vi /etc/fstab</code></strong> # Add the appropriate entry/entries to your <code class="filename">/etc/fstab</code>.</pre><p>Si vous avez un disque IDE, remplacez <code class="filename">da</code>
	  par <code class="filename">ad</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79816912"></a>19.3.2.2. Mode dédié</h4></div></div></div><a id="idp79817552" class="indexterm"></a><p>Si le nouveau disque n'est pas destiné a être
	  partagé avec un autre système d'exploitation, vous
	  pouvez utiliser le mode <span class="emphasis"><em>dédié</em></span>.
	  Rappelez-vous que ce mode peut perturber les systèmes
	  d'exploitation Microsoft; cependant, ils ne toucheront pas
	  au disque.  <span class="trademark">OS/2</span>® d'IBM, au contraire,
	  &#8220;s'approprie&#8221; toute partition qu'il trouve et ne
	  reconnaît pas.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/dev/da1 bs=1k count=1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -Bw da1 auto</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel -e da1</code></strong>				# create the `e' partition
<code class="prompt">#</code> <strong class="userinput"><code>newfs -d0 /dev/da1e</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>vi /etc/fstab</code></strong>				# add an entry for /dev/da1e
<code class="prompt">#</code> <strong class="userinput"><code>mount /1</code></strong></pre><p>Un autre méthode est:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dd if=/dev/zero of=/dev/da1 count=2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>bsdlabel /dev/da1 | bsdlabel -BR da1 /dev/stdin</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>newfs /dev/da1e</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir -p /1</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>vi /etc/fstab</code></strong>					# add an entry for /dev/da1e
<code class="prompt">#</code> <strong class="userinput"><code>mount /1</code></strong></pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="disks-naming.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="disks.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="raid.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">19.2. Noms des périphériques </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 19.4. RAID</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>