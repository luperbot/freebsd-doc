<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>18.4. Travailler avec les traces d'audit</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="audit.html" title="Chapitre 18. Audit des événements relatifs à la sécurité du système" /><link rel="prev" href="audit-config.html" title="18.3. Configuration de l'audit" /><link rel="next" href="disks.html" title="Chapitre 19. Stockage des données" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">18.4. Travailler avec les traces d'audit</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="audit-config.html">Précédent</a> </td><th width="60%" align="center">Chapitre 18. Audit des événements relatifs à la
    sécurité du système</th><td width="20%" align="right"> <a accesskey="n" href="disks.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="audit-administration"></a>18.4. Travailler avec les traces d'audit</h2></div></div></div><p>Etant donné que les traces d'audit sont stockées sous le format
	binaire <acronym class="acronym">BSM</acronym> (<span class="quote">« <span class="quote">Basic Security Module</span> »</span>),
	plusieurs outils sont disponibles pour modifier ou convertir
	en texte ces fichiers de trace.
	Pour convertir les fichiers de trace en en texte simple,
	utiliser la commande <code class="command">praudit</code>.
	Pour réduire le fichier de trace en vue
	d'une analyse, d'un archivage, ou d'une impression, utiliser
	la commande <code class="command">auditreduce</code>.  Cet utilitaire
	supporte une variété de paramètres de sélection, parmi
	lesquels le type d'événement, la classe de l'événement,
	l'utilisateur, la date ou l'heure de l'événement, et le chemin
	d'accès ou l'objet sur lequel on agit.</p><p>Par exemple, pour afficher
	sous forme de texte brut l'intégralité
	du contenu du fichier journal d'audit
	précisé:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>praudit /var/audit/<em class="replaceable"><code>AUDITFILE</code></em></code></strong></pre><p>Où
	<em class="replaceable"><code>AUDITFILE</code></em> est
	le journal à afficher.</p><p>Les traces d'audit consistent en une série
	d'enregistrements constitués de champs que la commande
	<code class="command">praudit</code> affiche de manière
	séquentielle, un par ligne.  Chaque champ est
	spécifique, comme <code class="literal">header</code>
	(l'entête de l'enregistrement), ou <code class="literal">path</code>
	(le chemin d'accès).  Ce qui suit est un
	exemple d'événement
	<code class="literal">execve</code>:</p><pre class="programlisting">header,133,10,execve(2),0,Mon Sep 25 15:58:03 2006, + 384 msec
exec arg,finger,doug
path,/usr/bin/finger
attribute,555,root,wheel,90,24918,104944
subject,robert,root,wheel,root,wheel,38439,38032,42086,128.232.9.100
return,success,0
trailer,133</pre><p>Cet audit représente un appel réussi
	à <code class="literal">execve</code>, lors de l'exécution
	de la commande <code class="literal">finger doug</code>.  Le champ
	<code class="literal">exec arg</code> contient la ligne de commande
	présentée par l'interpréteur de commandes
	au noyau.  Le champ <code class="literal">path</code> contient le chemin
	d'accès à l'exécutable comme le voit le
	noyau.  Le champ <code class="literal">attribute</code> décrit le
	binaire et précise les permissions sur le fichier.  Le champ
	<code class="literal">subject</code> conserve l'identifiant (ID) de
	l'utilisateur audité, les
	identifiants groupe et utilisateur effectifs, les identifiants
	groupe et utilisateur réels, l'ID du processus, l'ID de
	la session, l'ID du port, et l'adresse correspondant à
	la session.  Notez que l'ID de l'utilisateur pour l'audit
	diffère de l'ID réel de l'utilisateur étant donné que
	l'utilisateur <code class="systemitem">robert</code> est passé en
	<code class="systemitem">root</code> avant l'exécution de la
	commande, mais l'audit se fait par rapport à
	l'utilisateur authentifié original.  Le champ
	<code class="literal">return</code> indique la réussite de
	l'exécution et le champ <code class="literal">trailer</code>
	termine l'enregistrement.</p><p>Le format de sortie <acronym class="acronym">XML</acronym> est également
	supporté et peut être sélectionné en
	utilisant l'argument <code class="option">-x</code>.</p><p>Comme les journaux d'audit peuvent être très
	gros, un sous-ensemble d'enregistrements peut être sélectionné
	en utilisant <code class="command">auditreduce</code>. Cet exemple
	sélectionne tous les enregistrements produits pour
	l'utilisateur <code class="systemitem">trhodes</code> et
	stockés dans le fichier
	<em class="replaceable"><code>AUDITFILE</code></em>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>auditreduce -u <em class="replaceable"><code>trhodes</code></em> /var/audit/<em class="replaceable"><code>AUDITFILE</code></em> | praudit</code></strong></pre><p>Les membres du groupe <code class="systemitem">audit</code> sont
	autorisés à lire les traces d'audit
	présentes dans le répertoire <code class="filename">/var/audit</code>. Par défaut, ce
	groupe est vide, par conséquent seul l'utilisateur
	<code class="systemitem">root</code> peut lire les traces d'audit.  Des
	utilisateurs peuvent être ajoutés au groupe
	<code class="systemitem">audit</code> afin de déléguer
	les droits de lecture des audits.
	Comme la possibilité de suivre le contenu des fichiers
	journaux de l'audit donne un aperçu significatif du
	comportement des utilisateurs et des processus, il est donc
	recommandé de déléguer avec prudence les
	droits de lecture des audits.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79656912"></a>18.4.1. Surveillance en direct à l'aide de tubes
	d'audit</h3></div></div></div><p>Les tubes (<span class="quote">« <span class="quote">pipes</span> »</span>) d'audit sont des
	pseudo-périphériques <span class="quote">« <span class="quote">clonables</span> »</span> qui autorisent
	aux applications l'accès au flux d'enregistrement des audits
	en cours.  C'est de tout premier intérêt pour les auteurs
	d'applications de détection des intrusions et de surveillance
	du système.  Cependant, le tube d'audit est un moyen pratique
	pour l'administrateur pour autoriser la surveillance en direct
	sans avoir à faire face aux problèmes de permissions ou
	de rotation des fichiers journaux interrompant le flux des
	enregistrements des événements.  Pour suivre le flux des
	enregistrements de l'audit en cours:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>praudit /dev/auditpipe</code></strong></pre><p>Par défaut, les fichiers spéciaux de
	périphériques correspondant aux tubes d'audit ne
	sont accessibles qu'à l'utilisateur
	<code class="systemitem">root</code>.  Pour les rendre accessibles aux
	membres du groupe <code class="systemitem">audit</code>, ajoutez une
	règle <code class="literal">devfs</code> au fichier
	<code class="filename">/etc/devfs.rules</code>:</p><pre class="programlisting">add path 'auditpipe*' mode 0440 group audit</pre><p>Consultez la page de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">devfs.rules</span>(5)</span></a> pour plus
	d'information sur la configuration du système de
	fichiers devfs.</p><div xmlns="" class="warning"><h3 class="admontitle">Avertissement: </h3><p xmlns="http://www.w3.org/1999/xhtml">Il est relativement simple de produire un effet de
	  boucle sans fin, dans lequel la consultation de chaque
	  événement enregistré par le
	  système d'audit provoque la génération
	  de nouveaux événements d'audit.  Par exemple,
	  si toutes les entrées/sorties réseau sont
	  surveillées, et que <code class="command">praudit</code> est
	  exécuté depuis une session <acronym class="acronym">SSH</acronym>, alors un flux
	  continu d'événements sera
	  généré suivant une fréquence
	  importante, chaque événement affiché
	  générant un autre événement.  Pour cette raison, il
	  est recommandé d'exécuter <code class="command">praudit</code>
	  sur un tube par
	  l'intermédiaire de sessions sans surveillance
	  précise des entrées/sorties.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79665488"></a>18.4.2. Rotation et compression des fichiers de trace d'audit</h3></div></div></div><p>Les traces d'audit sont écrites par le noyau, et sont
	gérées par le <span class="quote">« <span class="quote">démon</span> »</span> d'audit,
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a>.  Les administrateurs ne
	devraient donc pas tenter d'utiliser <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newsyslog.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">newsyslog.conf</span>(5)</span></a> ou
	tout autre outil pour assurer la rotation directe des journaux
	d'audit.  A la place, l'utilitaire <code class="command">audit</code>
	devrait être employé pour stopper l'audit,
	reconfigurer le système d'audit et effectuer la
	rotation des journaux.  La commande suivante provoque la
	création d'un nouveau fichier journal d'audit par le
	<span class="quote">« <span class="quote">démon</span> »</span> et signale au noyau d'utiliser le
	nouveau fichier pour les enregistrements.  L'ancien fichier
	journal sera fermé et renommé et pourra,
	à partir de cet instant, être manipulé par
	l'administrateur:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>audit -n</code></strong></pre><p>Si <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=auditd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">auditd</span>(8)</span></a> ne tourne pas, cette
	  commande échouera et un message d'erreur sera
	  généré.</p><p>Ajouter la ligne suivante au fichier
	<code class="filename">/etc/crontab</code> provoquera cette rotation
	toutes les douze heures:</p><pre class="programlisting">0     */12       *       *       *       root    /usr/sbin/audit -n</pre><p>La modification sera prise en compte une fois que aurez
	sauvegardé le fichier
	<code class="filename">/etc/crontab</code>.</p><p>La rotation automatique du fichier d'une trace d'audit
	basée sur la taille du fichier est possible à
	l'aide de l'option <code class="option">filesz</code> de
	<code class="filename">audit_control</code> comme décrit dans
	<a class="xref" href="audit-config.html#audit-auditcontrol" title="18.3.2.1. Le fichier audit_control">Section 18.3.2.1, « Le fichier <code class="filename">audit_control</code> »</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp79674960"></a>18.4.3. Compresser les traces d'audit</h3></div></div></div><p>Les fichiers de trace d'audit peuvent devenir très
	gros, il est souvent désirable de les compresser ou
	sinon de les archiver une fois qu'ils ont été
	fermés par le <span class="quote">« <span class="quote">démon</span> »</span> d'audit.  La
	procédure <code class="filename">audit_warn</code> peut
	être employée pour effectuer des
	opérations personnalisées pour une
	variété d'événements relatifs
	à l'audit, y compris l'arrêt propre des traces
	d'audit lors de leur rotation.  Par exemple, ce qui suit peut
	être ajouté au fichier
	<code class="filename">/etc/security/audit_warn</code> pour compresser
	les traces
	d'audit à leur fermeture:</p><pre class="programlisting">#
# Compression des fichiers de trace d'audit à leur fermeture.
#
if [ "$1" = closefile ]; then
        gzip -9 $2
fi</pre><p>D'autres activités d'archivage pourront inclure la
	copie des fichiers de trace vers un serveur central, la
	suppression d'anciennes traces, ou la réduction des
	traces pour supprimer les enregistrements inutiles.  Cette
	procédure ne sera exécutée que lorsque
	les fichiers de trace d'audit auront été
	proprement arrêtés, et ne sera pas
	exécutée sur les traces interrompues en cours
	d'utilisation suite à un arrêt incorrect du
	système.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="audit-config.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="audit.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="disks.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">18.3. Configuration de l'audit </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> Chapitre 19. Stockage des données</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>