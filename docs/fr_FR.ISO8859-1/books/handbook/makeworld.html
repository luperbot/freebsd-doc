<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>24.6. Recompiler le système</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Manuel FreeBSD" /><link rel="up" href="updating-upgrading.html" title="Chapitre 24. Mise à jour de FreeBSD" /><link rel="prev" href="synching.html" title="24.5. Synchroniser vos sources" /><link rel="next" href="small-lan.html" title="24.7. Suivre les mises à jour pour plusieurs machines" /><link rel="copyright" href="legalnotice.html" title="Copyright" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">24.6. Recompiler le système</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="synching.html">Précédent</a> </td><th width="60%" align="center">Chapitre 24. Mise à jour de FreeBSD</th><td width="20%" align="right"> <a accesskey="n" href="small-lan.html">Suivant</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="makeworld"></a>24.6. Recompiler le système</h2></div></div></div><a id="idp82670544" class="indexterm"></a><p>Une fois que vous avez synchronisé votre arborescence des
      sources avec une version donnée de FreeBSD (FreeBSD-STABLE,
      FreeBSD-CURRENT, et ainsi de suite) vous pouvez alors utiliser
      cette arborescence des sources pour recompiler le
      système.</p><div xmlns="" class="warning"><h3 class="admontitle">Faites une sauvegarde: </h3><p xmlns="http://www.w3.org/1999/xhtml">On n'insistera jamais assez sur l'importance de faire une
	sauvegarde de votre système <span class="emphasis"><em>avant</em></span> tout
	autre chose.  Bien qu'il soit facile de &#8220;refaire le
	monde&#8221; (recompiler FreeBSD), si vous suivez ces
	instructions, vous ferez inévitablement des erreurs
	à un moment ou un autre, ou d'autres feront des erreurs
	au niveau de l'arborescence des sources qui empêcheraient
	votre système de redémarrer.</p><p xmlns="http://www.w3.org/1999/xhtml">Assurez-vous que vous avez bien fait une sauvegarde.  Ayez
	une disquette de maintenance, ou un CD démarrable à portée de la main.
	Vous ne l'utiliserez probablement pas, mais prudence est mère
	de sûreté!</p></div><div xmlns="" class="warning"><h3 class="admontitle">S'abonner à la bonne liste de diffusion: </h3><a xmlns="http://www.w3.org/1999/xhtml" id="idp82686672" class="indexterm"></a><p xmlns="http://www.w3.org/1999/xhtml">Les branches FreeBSD-STABLE et FreeBSD-CURRENT sont, par
	nature, <span class="emphasis"><em>en développement</em></span>.  Les personnes
	qui participent à FreeBSD sont des humains, et
	des erreurs se produisent occasionnellement.</p><p xmlns="http://www.w3.org/1999/xhtml">Ces erreurs sont parfois bénignes, provocant
	simplement l'affichage d'un nouveau message d'avertissement
	par votre système.  Elles peuvent aussi être
	catastrophiques, et empêcher votre système de
	redémarrer ou détruire vos systèmes de fichiers
	(ou pire).</p><p xmlns="http://www.w3.org/1999/xhtml">Quand de tels problèmes se produisent, un avertissement
	&#8220;heads up&#8221; est posté sur la liste de diffusion
	appropriée, décrivant la nature du problème et
	quels systèmes sont concernés.  Un message &#8220;all
	clear&#8221; est posté quand le problème est
	résolu.</p><p xmlns="http://www.w3.org/1999/xhtml">Si vous tentez de suivre FreeBSD-STABLE ou FreeBSD-CURRENT et
	que vous ne lisez pas la <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-stable" target="_top">liste de diffusion à propos de la branche FreeBSD-STABLE</a> ou la <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-current" target="_top">liste de diffusion à propos de la branche FreeBSD-CURRENT</a>,
	vous allez au devant d'ennuis.</p></div><div xmlns="" class="warning"><h3 class="admontitle">N'utilisez pas la commande
	<code xmlns="http://www.w3.org/1999/xhtml" class="command">make world</code>: </h3><p xmlns="http://www.w3.org/1999/xhtml">De nombreuses anciennes documentations préconisent
	d'utiliser la commande <code class="command">make world</code>.  Cette
	commande n'effectue pas un certain nombre d'étapes
	importantes et ne devrait être utilisée que si
	vous êtes sûr de ce que vous faites.  Dans presque
	tout les cas <code class="command">make world</code> n'est pas une bonne
	chose à faire, et la procédure décrite
	dans la suite de ce document devrait être
	utilisée à la place.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82692688"></a>24.6.1. La méthode générique de mise
	à jour du système</h3></div></div></div><p>Pour mettre à jour votre système, vous
	devriez consulter <code class="filename">/usr/src/UPDATING</code> pour
	toute opération préliminaire nécessaire
	en fonction de la version de vos sources et ensuite
	utiliser la procédure suivante:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildworld</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildkernel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installkernel</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Dans quelques rares cas, il est nécessaire de
	  lancer un <code class="command">mergemaster -p</code> avant
	  l'étape <code class="buildtarget">buildworld</code>.  Ces cas
	  sont décrits dans le fichier
	  <code class="filename">UPDATING</code>.  Généralement,
	  vous pouvez omettre cette opération si vous ne mettez
	  pas à jour d'une version majeure de FreeBSD à une
	  autre.</p></div><p>Une fois l'opération
	<code class="buildtarget">installkernel</code> terminée avec
	succès,
	vous devrez démarrer en mode mono-utilisateur (en
	utilisant par exemple la commande <code class="command">boot -s</code>
	à l'invite du chargeur).  Exécutez
	ensuite:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -a -t ufs</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mergemaster -p</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mergemaster</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>reboot</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Lisez les explications supplémentaires: </h3><p xmlns="http://www.w3.org/1999/xhtml">La séquence décrite ci-dessus n'est qu'un
	  court résumé pour vous aider à
	  démarrer.  Vous devriez cependant lire les sections
	  suivantes afin de comprendre clairement chaque étape,
	  tout particulièrement si vous désirez utiliser
	  une configuration du noyau personnalisée.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82736336"></a>24.6.2. Lire <code class="filename">/usr/src/UPDATING</code></h3></div></div></div><p>Avant tout autre chose, lisez
	<code class="filename">/usr/src/UPDATING</code> (ou le fichier
	équivalent en fonction de l'endroit où se trouve vos
	sources).  Ce fichier devrait contenir les informations
	importantes au sujet des problèmes que vous pourriez
	rencontrer, ou indique l'ordre dans lequel vous devriez
	exécuter certaines commandes.  Si le fichier
	<code class="filename">UPDATING</code> contredit quelque chose d'écrit
	ici, <code class="filename">UPDATING</code> prime sur tout le
	reste.</p><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">La lecture du fichier <code class="filename">UPDATING</code>
	  n'est pas un substitut à l'abonnement à la liste
	  de diffusion correcte, comme décrit
	  précédemment.  Ces deux prérequis sont
	  complémentaires, et non pas exclusifs.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82740176"></a>24.6.3. Contrôler <code class="filename">/etc/make.conf</code></h3></div></div></div><a id="idp82741072" class="indexterm"></a><p>Contrôlez les fichiers
	<code class="filename">/usr/share/examples/etc/make.conf</code>
	et
	<code class="filename">/etc/make.conf</code>.  Le premier contient
	des paramètres par défaut &#8211; la plupart
	étant placés en commentaires.  Pour les utiliser quand
	vous recompilez votre système à partir des sources,
	rajoutés-les au fichier <code class="filename">/etc/make.conf</code>.
	Gardez à l'esprit que tout ce que vous ajoutez au fichier
	<code class="filename">/etc/make.conf</code> est utilisé chaque fois
	que vous invoquez la commande <code class="command">make</code>, il est
	donc bon de s'assurer que les valeurs par défaut sont
	appropriées à votre système.</p><p>Un utilisateur typique voudra probablement copier
	les lignes <code class="varname">CFLAGS</code> et
	<code class="varname">NO_PROFILE</code> se trouvant dans
	<code class="filename">/usr/share/examples/etc/make.conf</code> vers
	<code class="filename">/etc/make.conf</code> et les décommenter.</p><p>Examinez les autres définitions
	(<code class="varname">COPTFLAGS</code>, <code class="varname">NOPORTDOCS</code>
	et ainsi de suite) et décidez si elles vous conviennent.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82752080"></a>24.6.4. Mettre à jour les fichiers dans <code class="filename">/etc</code></h3></div></div></div><p>Le répertoire <code class="filename">/etc</code> contient la
	plupart des informations de configuration de votre système,
	ainsi que les procédures de démarrage.  Certaines de ces
	procédures changent d'une version à l'autre de
	FreeBSD.</p><p>Certains fichiers de configuration sont également
	utilisés en permanence par le système.  En particulier
	<code class="filename">/etc/group</code>.</p><p>Il est arrivé que la phase d'installation <code class="command">make
	installworld</code> ait besoin que certains utilisateurs et groupes
	existent.  Il y a de fortes chances qu'ils n'aient pas
	été définis avant la mise à jour.
	C'est une source de problèmes.  Dans certains cas
	<code class="command">make buildworld</code> contrôlera si ces
	utilisateurs ou groupes existent.</p><p>Un exemple de cela fut l'addition de l'utilisateur
	<code class="systemitem">smmsp</code>.  Le processus d'installation
	échouait quand <code class="command">mtree</code> tentait de créer
	<code class="filename">/var/spool/clientmqueue</code>.</p><p>La solution est d'exécuter
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> dans le mode pré-&#8220;buildworld&#8221;
	en ajoutant l'option <code class="option">-p</code>.  Cela effectuera la
	comparaison uniquement des fichiers essentiels pour le succès
	de la procédure <code class="buildtarget">buildworld</code> ou
	<code class="buildtarget">installworld</code>.  Si votre vieille
	version de <code class="command">mergemaster</code> ne supporte pas
	l'option <code class="option">-p</code>, utilisez la nouvelle version
	présente dans l'arborescence des sources quand vous
	l'exécutez pour la première fois:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/usr.sbin/mergemaster</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>./mergemaster.sh -p</code></strong></pre><div xmlns="" class="tip"><h3 class="admontitle">Astuce: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si vous êtes particulièrement paranoïaque,
	  vous pouvez contrôler votre système afin de voir quels
	  fichiers appartiennent au groupe que vous renommez ou
	  effacez:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>find / -group GID -print</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">affichera les fichiers appartenant au groupe
	  <em class="replaceable"><code>GID</code></em> (qui peut être soit un nom de
	  groupe ou un identifiant numérique de groupe).</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="makeworld-singleuser"></a>24.6.5. Passer en mode mono-utilisateur</h3></div></div></div><a id="idp82773840" class="indexterm"></a><p>Il vaut mieux recompiler le système en mode
	mono-utilisateur.  En dehors du fait que cela sera
	légèrement plus rapide, la réinstallation
	va modifier un grand nombre de fichiers systèmes
	importants, tous les binaires de base du système, les
	bibliothèques, les fichiers d'include et ainsi de suite.
	Les modifier sur un système en fonctionnement (en
	particulier s'il y a des utilisateurs connectés à
	ce moment là), c'est aller au devant de
	problèmes.</p><a id="idp82774736" class="indexterm"></a><p>Une autre méthode consiste à compiler le
	système en mode multi-utilisateurs, et passer dans le mode
	mono-utilisateur pour l'installation.  Si vous désirez
	utiliser cette méthode, conservez les étapes suivantes
	pour le moment où la compilation sera terminée.  Vous
	pouvez reporter le passage en mode mono-utilisateur jusqu'à
	l'exécution de
	<code class="buildtarget">installkernel</code> ou
	<code class="buildtarget">installworld</code>.</p><p>En tant que super-utilisateur, vous pouvez exécuter la
	commande:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown now</code></strong></pre><p>sur un système en fonctionnement, pour passer en mode
	mono-utilisateur.</p><p>Ou bien, redémarrer le système, et à
	l'invite de démarrage, sélectionnez l'option
	<span class="quote">« <span class="quote">single user</span> »</span>.  Le système démarrera alors
	en mode mono-utilisateur.  A l'invite de l'interpréteur de
	commandes, exécutez alors:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>fsck -p</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -u /</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mount -a -t ufs</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>swapon -a</code></strong></pre><p>Cela effectue une vérification des systèmes
	de fichiers, remonte <code class="filename">/</code> en mode
	lecture/écriture, et monte tous les autres systèmes
	de fichiers UFS listés dans le fichier
	<code class="filename">/etc/fstab</code>, puis active la
	pagination.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si votre horloge CMOS est réglée sur l'heure locale
	  et non pas sur le fuseau GMT (cela est vrai si la sortie
	  de la commande <code class="command">date</code> ne donne pas l'heure
	  et le fuseau correct), vous aurez également peut-être
	  besoin d'exécuter la commande suivante:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>adjkerntz -i</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">Cela permettra de s'assurer que vos paramètres
	  de fuseaux horaires sont correctement configurés &#8212;
	  sans cela, vous risquez de faire face, plus tard, à des
	  problèmes.
	</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82790096"></a>24.6.6. Effacer <code class="filename">/usr/obj</code></h3></div></div></div><p>Au fur et à mesure que les différentes parties
	du système sont recompilées, elles sont
	placées dans des répertoires qui (par défaut) sont
	sous <code class="filename">/usr/obj</code>.  Les répertoires sont
	agencés comme sous <code class="filename">/usr/src</code>.</p><p>Vous pouvez accélérer le processus <code class="command">make
	buildworld</code>, et également vous éviter d'éventuels
	problèmes de dépendances en effaçant ce
	répertoire.</p><p>Certains fichiers dans <code class="filename">/usr/obj</code>
	peuvent avoir l'indicateur immuable positionné (consultez la
	page de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a> pour plus d'informations)
	qui doit être retiré en premier.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/obj</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chflags -R noschg *</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -rf *</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-upgrading-compilebase"></a>24.6.7. Recompiler le système de base</h3></div></div></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82798032"></a>24.6.7.1. Enregistrer la sortie</h4></div></div></div><p>C'est une bonne idée d'enregistrer la sortie de
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> dans un fichier.  Si quelque chose se passe
	  mal, vous aurez une trace des messages d'erreur.  Même
	  si cela ne vous aide pas à diagnostiquer ce qui n'a pas
	  fonctionné, cela peut aider les autres si vous postez
	  votre problème sur une des listes de diffusion de
	  FreeBSD.</p><p>La méthode la plus aisée pour faire cela est
	  d'utiliser la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=script&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">script</span>(1)</span></a>, avec en paramètre
	  le nom du fichier où enregistrer les résultats.
	  Vous devez faire cela immédiatement juste avant de
	  recompiler le système, et taper <strong class="userinput"><code>exit</code></strong>
	  une fois que c'est terminé.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>script /var/tmp/mw.out</code></strong>
Script started, output file is /var/tmp/mw.out
<code class="prompt">#</code> <strong class="userinput"><code>make TARGET</code></strong>
<span class="emphasis"><em>&#8230; compile, compile, compile &#8230;</em></span>
<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong>
Script done, &#8230;</pre><p>Si vous le faites, <span class="emphasis"><em>n'enregistrez pas</em></span>
	  le résultat dans <code class="filename">/tmp</code>.
	  Ce répertoire peut être vidé au prochain
	  redémarrage du système.  Un meilleur endroit de
	  sauvegarde est <code class="filename">/var/tmp</code> (comme dans l'exemple
	  précédent) ou dans le répertoire utilisateur
	  de <code class="systemitem">root</code>.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="make-buildworld"></a>24.6.7.2. Compiler le nouveau système</h4></div></div></div><p>Vous devez être dans le répertoire
	  <code class="filename">/usr/src</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong></pre><p>(à moins, bien sûr, que votre code source ne
	  soit ailleurs, auquel cas vous devrez aller dans le
	  répertoire correspondant).</p><a id="idp82813520" class="indexterm"></a><p>Pour recompiler le système, on utilise la commande
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>.  Cette commande lit ses instructions dans
	  le fichier <code class="filename">Makefile</code>, qui décrit comment
	  devraient être reconstruits les programmes qui constituent
	  FreeBSD, dans quel ordre, et ainsi de suite.</p><p>Le format général de la ligne de commande que
	  vous taperez sera la suivante:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make -x -DVARIABLE cible</code></strong></pre><p>Dans cet exemple,
	  <code class="option">-<em class="replaceable"><code>x</code></em></code> est une
	  option que vous passez à <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>.  Reportez-vous
	  à la page de manuel pour un exemple d'options que vous
	  pouvez passer.</p><p><code class="option">-D<em class="replaceable"><code>VARIABLE</code></em></code>
	  transmet un variable au fichier
	  <code class="filename">Makefile</code>.  Le comportement du
	  <code class="filename">Makefile</code> est défini par ces variables.
	  Ce sont les mêmes variables que l'on trouve dans
	  <code class="filename">/etc/make.conf</code>, et c'est un autre moyen
	  de les positionner.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make -DNO_PROFILE cible</code></strong></pre><p>est une autre manière de dire qu'il ne faut pas compiler
	  les bibliothèques profilées et correspond à
	  la ligne:</p><pre class="programlisting">NO_PROFILE=    true	#    Avoid compiling profiled libraries</pre><p>dans <code class="filename">/etc/make.conf</code>.</p><p><em class="replaceable"><code>cible</code></em> indique à <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>
	  ce que vous voulez faire.  Chaque
	  <code class="filename">Makefile</code> définit un certain nombre de
	  &#8220;cibles&#8221;, et votre choix de cible détermine ce
	  qui se passe.</p><p>Certaines cibles listées dans le fichier
	  <code class="filename">Makefile</code>, ne doivent pas être
	  employées.  Ce sont des étapes intermédiaires
	  utilisées par le processus de recompilation pour
	  décomposer les étapes importantes de la recompilation
	  du système en sous-étapes.</p><p>La plupart du temps, vous n'aurez pas besoin de passer
	  de paramètres à <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>, et votre commande
	  ressemblera à ceci:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make cible</code></strong></pre><p>Où <em class="replaceable"><code>cible</code></em> sera une des
	  nombreuses options de compilation.  La première cible
	  devrait toujours être
	  <code class="varname">buildworld</code>.</p><p>Comme leurs noms l'indiquent,
	  <code class="buildtarget">buildworld</code> reconstruit la nouvelle
	  arborescence dans <code class="filename">/usr/obj</code>, et
	  <code class="buildtarget">installworld</code>, une autre cible, l'installe sur la
	  machine.</p><p>Disposer d'options séparées est très utile pour deux raisons.  Tout d'abord
	  cela vous permet de recompiler en toute sûreté en sachant
	  qu'aucun composant du système actuel ne sera affecté.
	  La compilation est &#8220;autonome&#8221;.  En raison de
	  cela vous pouvez exécuter
	  <code class="buildtarget">buildworld</code> sur une machine en mode
	  multi-utilisateurs sans redouter d'effets fâcheux.  Il est
	  néanmoins recommandé de toujours exécuter
	  l'étape <code class="buildtarget">installworld</code> en mode
	  mono-utilisateur.</p><p>En second lieu, cela vous permet d'utiliser des
	  systèmes montés par NFS pour mettre à
	  jour plusieurs machines de votre réseau.  Si vous avez
	  trois machines <code class="systemitem">A</code>, <code class="systemitem">B</code> et
	  <code class="systemitem">C</code> que vous voulez mettre à jour,
	  exécutez <code class="command">make buildworld</code> et
	  <code class="command">make installworld</code> sur <code class="systemitem">A</code>.
	  <code class="systemitem">B</code> et <code class="systemitem">C</code> doivent
	  ensuite monter par NFS <code class="filename">/usr/src</code>
	  et <code class="filename">/usr/obj</code> depuis <code class="systemitem">A</code>,
	  et vous pouvez alors exécuter
	  <code class="command">make installworld</code> pour installer le
	  système recompilé sur <code class="systemitem">B</code> et
	  <code class="systemitem">C</code>.</p><p>Bien que la cible <code class="buildtarget">world</code> existe
	  toujours, vous êtes fortement encouragé
	  à ne pas l'utiliser.</p><p>Exécutez:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make buildworld</code></strong></pre><p>Il est possible de passer l'option
	  <code class="option">-j</code> à <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> ce qui lui permettra
	  d'exécuter plusieurs processus simultanément.
	  C'est particulièrement utile sur une machine avec plusieurs
	  processeurs.  Cependant, comme la compilation est plus
	  gourmande en E/S plutôt qu'en CPU, c'est également
	  utile sur des machines mono-processeur.</p><p>Typiquement sur une machine mono-processeur, vous
	  exécuteriez:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make -j4 buildworld</code></strong></pre><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> pourra exécuter jusqu'à 4 processus
	  simultanément.  Des constatations empiriques
	  postées sur les listes de diffusion montrent que c'est
	  en général ce qui apporte le plus de gain en
	  performances.</p><p>Si vous avez une machine multi-processeurs et que vous
	  avez configuré un noyau SMP, essayez des valeurs entre 6 et
	  19 et voyez quel bénéfice vous en tirez.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82852560"></a>24.6.7.3. Durée</h4></div></div></div><a id="idp82853200" class="indexterm"></a><p>De nombreux facteurs influencent la durée de
	  compilation, mais les machines récentes devraient
	  mettrent seulement de une à deux heures
	  pour compiler l'arborescence FreeBSD-STABLE,
	  sans modification ni raccourcis durant le processus.
	  Une arborescence FreeBSD-CURRENT nécessitera un peu plus de
	  temps.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82854992"></a>24.6.8. Compiler et installer un nouveau noyau</h3></div></div></div><a id="idp82855632" class="indexterm"></a><p>Pour tirer pleinement parti de votre nouveau système,
	vous devrez recompiler le noyau.  C'est pratiquement
	indispensable, parce que certaines structures mémoires
	peuvent avoir changées, et des programmes comme <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ps&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ps</span>(1)</span></a>
	et <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=top&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">top</span>(1)</span></a> ne fonctionneront pas tant que le système
	et le noyau n'utilisent pas les mêmes versions de code
	source.</p><p>La manière la plus simple et la plus sûre est de
	compiler et installer un noyau basé sur le noyau
	<code class="filename">GENERIC</code>.  Alors que le noyau
	<code class="filename">GENERIC</code> peut ne pas comporter les pilotes
	de périphériques nécessaires pour votre
	système, il devrait contenir tout ce qui est
	nécessaire pour faire démarrer votre système
	en mode mono-utilisateur.  C'est une bonne façon de tester
	le fonctionnement de votre nouveau système.  Après
	avoir démarré à partir du noyau
	<code class="filename">GENERIC</code> et vérifié que
	votre système fonctionne vous pouvez alors compiler un nouveau
	noyau basé sur votre fichier de configuration normal du
	noyau.</p><p>Sur FreeBSD, il est important
	de <a class="link" href="makeworld.html#make-buildworld" title="24.6.7.2. Compiler le nouveau système">recompiler le
	système</a> avant de compiler un nouveau
	noyau.</p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si vous désirez compiler un noyau personnalisé,
	  et que vous avez déjà un fichier de
	  configuration, utilisez juste
	  <code class="buildtarget">KERNCONF=<em class="replaceable"><code>MONNOYAU</code></em></code>
	  comme suit:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make buildkernel KERNCONF=MONNOYAU</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installkernel KERNCONF=MONNOYAU</code></strong></pre></div><p>Notez que si vous avez augmenté la variable
	<code class="literal">kern.securelevel</code> à une valeur
	supérieure à 1 <span class="emphasis"><em>et</em></span> que vous
	avez positionné l'indicateur <code class="literal">noschg</code>
	ou similaire sur votre noyau, il sera intéressant de passer
	en mode mono-utilisateur pour utiliser
	<code class="buildtarget">installkernel</code>.  Sinon vous devriez
	être en mesure d'exécuter ces commandes à
	partir du mode multi-utilisateur sans problèmes.  Voir
	la page de manuel de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=init&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">init</span>(8)</span></a> pour plus de détails
	à propos de <code class="literal">kern.securelevel</code> et la page
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=chflags&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">chflags</span>(1)</span></a> pour des informations sur les différents
	indicateurs de fichiers.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82873296"></a>24.6.9. Redémarrer en mode mono-utilisateur</h3></div></div></div><a id="idp82873936" class="indexterm"></a><p>Vous devriez redémarrer en mode mono-utilisateur pour
	tester le fonctionnement du nouveau noyau.  Pour cela suivez
	les instructions de
	<a class="xref" href="makeworld.html#makeworld-singleuser" title="24.6.5. Passer en mode mono-utilisateur">Section 24.6.5, « Passer en mode mono-utilisateur »</a>.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="make-installworld"></a>24.6.10. Installer les nouveaux binaires système</h3></div></div></div><p>Si vous avez compilé une version de FreeBSD assez
	récente pour avoir utilisé
	<code class="command">make buildworld</code> alors vous devriez
	utiliser maintenant <code class="buildtarget">installworld</code>
	pour installer les nouveaux binaires système.</p><p>Lancez:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make installworld</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si vous spécifiez des variables sur la
	  ligne de commande de <code class="command">make buildworld</code>,
	  vous devez utiliser les mêmes variables avec la commande
	  <code class="command">make installworld</code>.  Cela ne reste
	  pas forcément vrai pour d'autres options; par exemple,
	  <code class="option">-j</code> ne doit jamais être utilisée
	  avec <code class="buildtarget">installworld</code>.</p><p xmlns="http://www.w3.org/1999/xhtml">Par exemple, si vous exécutez:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make -DNO_PROFILE buildworld</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">vous devrez ensuite installer les résultats avec:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make -DNO_PROFILE installworld</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">sinon il essayera d'installer les bibliothèques
	  profilées qui n'ont pas été
	  recompilées à l'étape
	  <code class="command">make buildworld</code>.</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82889296"></a>24.6.11. Mettre à jour les fichiers non modifiés par
	<code class="command">make installworld</code></h3></div></div></div><p>La recompilation du système ne mettra pas à
	jour certains répertoires (en particulier,
	<code class="filename">/etc</code>, <code class="filename">/var</code> et
	<code class="filename">/usr</code>) avec les fichiers nouveaux
	ou modifiés.</p><p>La manière la plus simple de mettre à jour
	ces fichiers est d'utiliser <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a>, bien
	qu'il soit possible de le faire manuellement si vous le
	désirez.  Indépendamment de la manière
	que vous choisissez, assurez-vous de faire une sauvegarde
	du répertoire <code class="filename">/etc</code> au cas
	où quelque chose se passerait mal.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="mergemaster"></a>24.6.11.1. <code class="command">mergemaster</code></h4></div><div><span class="authorgroup">Contribution de <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Tom</span> <span class="surname">Rhodes</span></span>. </span></div></div></div><a id="idp82896080" class="indexterm"></a><p>L'utilitaire <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> est une procédure Bourne
	qui vous aidera à déterminer les différences entre
	vos fichiers de configuration dans le répertoire
	<code class="filename">/etc</code>, et les fichiers de configuration
	dans l'arborescence des sources
	<code class="filename">/usr/src/etc</code>.  C'est la solution
	recommandée pour maintenir à jour les fichiers de
	configuration du système avec ceux situés
	dans l'arborescence des sources.</p><p>Pour commencer, tapez simplement
	<code class="command">mergemaster</code> à l'invite, et observez-le
	travailler.  <code class="command">mergemaster</code> commencera à
	constituer une arborescence temporaire, à partir de
	<code class="filename">/</code>, et la remplira avec divers fichiers
	de configuration.  Ces fichiers sont alors comparés avec
	ceux actuellement installés sur votre système.
	A ce point, les fichiers qui diffèrent seront
	affichés dans le format <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a>, avec le signe
	<code class="option">+</code> représentant les lignes modifiées
	ou ajoutées, et le <code class="option">-</code> représentant
	les lignes qui seront soit complètement supprimées,
	soit remplacées avec une nouvelle ligne.
	Voir la page de manuel <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> pour plus d'informations
	au sujet de la syntaxe <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> et comment sont affichées
	les différences.</p><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> vous affichera ensuite chaque fichier
	présentant des différences, et vous aurez
	à ce moment-là le choix de soit supprimer le
	nouveau fichier (le fichier temporaire), soit d'installer
	le fichier temporaire non modifié, soit de fusionner
	le fichier temporaire et le fichier actuellement installé,
	soit enfin de revoir les résultats de l'opération
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a>.</p><p>Choisir de supprimer le fichier temporaire indiquera à
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> que nous désirons conserver notre
	fichier actuel intacte, et effacera la nouvelle version.
	Cette option n'est pas recommandée, à moins
	que vous ne voyez aucune raison de modifier le fichier actuel.
	Vous pouvez obtenir de l'aide à n'importe quel moment en
	tapant <span class="keycap"><strong>?</strong></span> à l'invite de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a>.
	Si l'utilisateur choisit de passer un fichier, il sera
	présenté à nouveau une fois que tous les
	autres fichiers auront été traités.</p><p>Choisir d'installer un fichier temporaire intact
	remplacera le fichier actuel avec le nouveau.  Pour la plupart
	des fichiers non modifiées, c'est la meilleure option.</p><p>Choisir de fusionner le fichier, vous affichera un éditeur
	de texte, et le contenu des deux fichiers.  Vous pouvez
	maintenant les fusionner en les visionnant côte
	à côte sur l'écran, et en sélectionnant
	des parties des deux fichiers pour créer un fichier final.
	Quand les fichiers sont comparés côte à
	côte, la touche <span class="keycap"><strong>l</strong></span> sélectionnera le
	contenu de gauche et la touche <span class="keycap"><strong>r</strong></span>
	sélectionnera celui de droite.
	Le résultat final sera un fichier constitué des deux
	parties, qui peut alors être installé.
	Cette option est habituellement utilisée pour les fichiers
	où les des paramètres ont été
	modifiés par l'utilisateur.</p><p>Choisir de revoir les résultats de l'opération
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> vous affichera les différences entre fichiers
	tout comme la fait <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> avant de vous demander
	un choix.</p><p>Après que <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> en ait terminé avec
	les fichiers système, il vous proposera de nouvelles
	opérations.  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> vous demandera si vous
	désirez reconstruire le fichier des mots de passe
	et terminera en vous proposant
	de supprimer les fichiers temporaires
	restants.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp82921552"></a>24.6.11.2. Mise à jour manuelle</h4></div></div></div><p>Si vous désirez faire la mise à jour manuellement,
	vous ne pouvez cependant pas vous contenter de copier
	les fichiers de <code class="filename">/usr/src/etc</code> dans
	<code class="filename">/etc</code> pour que cela fonctionne.  Certains
	de ces fichiers doivent d'abord être
	&#8220;installés&#8221;.
	En effet le répertoire <code class="filename">/usr/src/etc</code>
	&#8220;n'est pas&#8221; une copie de ce que devrait contenir
	votre répertoire <code class="filename">/etc</code>.  De plus,
	il a des fichiers qui doivent être dans
	<code class="filename">/etc</code> et qui ne sont pas dans
	<code class="filename">/usr/src/etc</code>.</p><p>Si vous utilisez <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mergemaster&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">mergemaster</span>(8)</span></a> (comme recommandé),
	vous pouvez passer cette section et aller directement à
	la <a class="link" href="makeworld.html#updating-upgrading-rebooting" title="24.6.12. Redémarrer">section
	suivante</a>.</p><p>La façon la plus simple de procéder est
	d'installer les fichiers dans un nouveau répertoire, puis de
	passer en revue les différences.</p><div xmlns="" class="warning"><h3 class="admontitle">Sauvegardez votre répertoire
	  <code xmlns="http://www.w3.org/1999/xhtml" class="filename">/etc</code> actuel: </h3><p xmlns="http://www.w3.org/1999/xhtml">Bien qu'en principe rien ne sera modifié automatiquement
	  dans ce répertoire, prudence est mère de
	  sûreté.  Copiez donc votre répertoire
	  <code class="filename">/etc</code> dans un endroit sûr.  Quelque
	  chose du genre:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp -Rp /etc /etc.old</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">conviendra; l'option <code class="option">-R</code> fait une copie
	  récursive, <code class="option">-p</code> préserve la date, les
	  autorisations des fichiers et ainsi de suite.</p></div><p>Vous devez créer un ensemble de répertoires
	provisoires pour y installer les fichiers du répertoire <code class="filename">/etc</code>
	et autres.  <code class="filename">/var/tmp/root</code> est un bon
	choix, il y a un certain nombre de sous-répertoires
	à créer également:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /var/tmp/root</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/etc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make DESTDIR=/var/tmp/root distrib-dirs distribution</code></strong></pre><p>Cela va créer l'arborescence nécessaire et y
	installera les fichiers.  Un grand nombre des
	sous-répertoires créés dans
	<code class="filename">/var/tmp/root</code>
	sont vides et devront être supprimés.
	La façon la plus simple de le faire est:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /var/tmp/root</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>find -d . -type d | xargs rmdir 2&gt;/dev/null</code></strong></pre><p>Ceci supprimera tous les répertoires vides (la sortie
	d'erreur standard est redirigée vers
	<code class="filename">/dev/null</code> pour empêcher les
	avertissements à propos des répertoires non
	vides).</p><p><code class="filename">/var/tmp/root</code> contient maintenant
	tous les fichiers à installer à l'endroit requis sous
	<code class="filename">/</code>.  Vous devez maintenant examiner chacun
	de ces fichiers pour déterminer en quoi ils diffèrent
	de vos propres fichiers.</p><p>Notez que certains des fichiers qui seront installés
	dans <code class="filename">/var/tmp/root</code> commencent par un
	&#8220;.&#8221;.  Au moment où sont écrites ces
	lignes, les seuls fichiers concernés sont les fichiers
	d'initialisation des interpréteurs de commandes dans
	<code class="filename">/var/tmp/root/</code> et
	<code class="filename">/var/tmp/root/root/</code>, mais il pourrait y
	en avoir d'autres (cela dépend de quand vous lirez ces
	lignes).  Assurez-vous d'utiliser la commande <code class="command">ls
	-a</code> pour ne pas les oublier.</p><p>La manière la plus simple de procéder est
	d'utiliser la commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> pour comparer les deux
	fichiers:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>diff /etc/shells /var/tmp/root/etc/shells</code></strong></pre><p>Cela vous indiquera les différences entre votre fichier
	<code class="filename">/etc/shells</code> et le nouveau fichier
	<code class="filename">/var/tmp/root//etc/shells</code>.  A partir de
	là, décidez si vous aller reporter les modifications
	que vous y avez apportée ou si vous allez simplement
	recopier le nouveau fichier.</p><div xmlns="" class="tip"><h3 class="admontitle">Donnez au nouveau répertoire racine
	  (<code xmlns="http://www.w3.org/1999/xhtml" class="filename">/var/tmp/root</code>) un nom qui inclue une
	  date, pour pouvoir facilement comparer les différentes
	  versions: </h3><p xmlns="http://www.w3.org/1999/xhtml">Si vous recompilez fréquemment votre système,
	  cela signifie que vous devez également souvent
	  mettre à jour le répertoire <code class="filename">/etc</code>,
	  ce qui peut rapidement devenir une corvée.</p><p xmlns="http://www.w3.org/1999/xhtml">Vous pouvez accélérer le processus en
	  conservant une copie du dernier ensemble de fichiers
	  modifiés que vous avez reportés dans
	  <code class="filename">/etc</code>.  La procédure suivante
	  présente une façon de faire.</p><div xmlns="http://www.w3.org/1999/xhtml" class="procedure"><ol class="procedure" type="1"><li class="step"><p>Recompilez le système comme à
	      l'accoutumé.  Au moment de mettre à jour
	      <code class="filename">/etc</code> et les autre répertoires,
	      donnez au répertoire cible un nom basé sur la
	      date du jour.  Si vous faisiez cela le 14 février
	      1998, vous pourriez procéder comme suit:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /var/tmp/root-19980214</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/etc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make DESTDIR=/var/tmp/root-19980214 \
    distrib-dirs distribution</code></strong></pre></li><li class="step"><p>Reporter les modifications depuis ce répertoire
	      comme décrit plus haut.</p><p><span class="emphasis"><em>Ne supprimez pas</em></span> le
	      répertoire <code class="filename">/var/tmp/root-19980214</code>
	      quand vous aurez terminé.</p></li><li class="step"><p>Quand vous récupérez la dernière
	      version des sources et la recompilerez, suivez l'étape
	      1.  Vous aurez alors un nouveau répertoire, qui
	      pourrait s'appeler <code class="filename">/var/tmp/root-19980221</code>
	      (si vous faites une mise à jour chaque semaine).</p></li><li class="step"><p>Vous pouvez maintenant voir les modifications
	      intervenues d'une semaine à l'autre en utilisant
	      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=diff&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">diff</span>(1)</span></a> pour afficher les différences entre tous
	      les fichiers deux répertoires:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /var/tmp</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>diff -r root-19980214 root-19980221</code></strong></pre><p>Généralement, il y aura beaucoup moins de
	      différences qu'entre
	      <code class="filename">/var/tmp/root-19980221/etc</code> et
	      <code class="filename">/etc</code>.  Comme il y a beaucoup
	      moins de différences, il est beaucoup plus facile
	      de les reporter dans le répertoire
	      <code class="filename">/etc</code>.</p></li><li class="step"><p>Vous pouvez maintenant supprimer le plus ancien
	      des deux répertoires
	      <code class="filename">/var/tmp/root-*</code>:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>rm -rf /var/tmp/root-19980214</code></strong></pre></li><li class="step"><p>Répétez l'opération chaque fois que vous devez
	      reporter des modifications dans
	      <code class="filename">/etc</code>.</p></li></ol></div><p xmlns="http://www.w3.org/1999/xhtml">Vous pouvez utiliser <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=date&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">date</span>(1)</span></a> pour automatiser la
	  génération des noms de répertoires:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /var/tmp/root-`date "+%Y%m%d"`</code></strong></pre></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="updating-upgrading-rebooting"></a>24.6.12. Redémarrer</h3></div></div></div><p>Vous en avez terminé.  Après avoir
	vérifié que tout semble être en place, vous
	pouvez alors redémarrez votre système.  Un simple
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=shutdown&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">shutdown</span>(8)</span></a> devrait suffire:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>shutdown -r now</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83000784"></a>24.6.13. C'est fini</h3></div></div></div><p>Vous devriez maintenant avoir mis à jour avec
	succès votre système FreeBSD.  Félicitations.</p><p>Si les choses se sont légèrement mal
	passées, il est facile de recompiler un élément
	particulier du système.  Par exemple, si vous avez
	accidentellement effacé <code class="filename">/etc/magic</code>
	lors de la mise à jour de <code class="filename">/etc</code>, la
	commande <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=file&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">file</span>(1)</span></a> ne fonctionnerait plus.  Dans ce cas,
	la solution serait d'exécuter:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src/usr.bin/file</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make all install</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp83005520"></a>24.6.14. Questions</h3></div></div></div><div class="qandaset"><a id="idp83010384"></a><dl><dt>24.6.14.1. <a href="makeworld.html#idp83010640">Dois-je refaire le monde à chaque
	      évolution?</a></dt><dt>24.6.14.2. <a href="makeworld.html#idp83016912">Ma compilation échoue avec de nombreuses erreurs
	      &#8220;signal 11&#8221; (ou tout
	      autre numéro de signal).  Que s'est-il passé?</a></dt><dt>24.6.14.3. <a href="makeworld.html#idp83036880">Puis-je effacer /usr/obj après
	      avoir fini?</a></dt><dt>24.6.14.4. <a href="makeworld.html#idp83041360">Une recompilation interrompue peut-elle être
	      reprise?</a></dt><dt>24.6.14.5. <a href="makeworld.html#idp83102032">Comment puis-je accélérer la compilation
	      du système?</a></dt><dt>24.6.14.6. <a href="makeworld.html#idp83132752">Que faire si quelque chose se passe mal?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp83010640"></a><a id="idp83010896"></a><p><strong>24.6.14.1.</strong></p></td><td align="left" valign="top"><p>Dois-je refaire le monde à chaque
	      évolution?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Il n'y a pas de réponse toute faite à
	      cette question, tout dépend de la nature des
	      évolutions.  Par exemple, si vous venez juste
	      d'exécuter <span class="application">CVSup</span>, et que
	      les fichiers suivants on été mis à
	      jour:</p><pre class="screen"><code class="filename">src/games/cribbage/instr.c</code>
<code class="filename">src/games/sail/pl_main.c</code>
<code class="filename">src/release/sysinstall/config.c</code>
<code class="filename">src/release/sysinstall/media.c</code>
<code class="filename">src/share/mk/bsd.port.mk</code></pre><p>cela ne vaut probablement pas la peine de recompiler
	      tout le système.  Vous pouvez tout simplement aller dans
	      les sous-répertoires appropriés,
	      exécuter <code class="command">make all install</code>, et
	      c'est à peu près tout.  Mais s'il y a des
	      évolutions importantes, par exemple sur
	      <code class="filename">src/lib/libc/stdlib</code> alors vous
	      devrez soit refaire le monde, ou recompiler au moins
	      toutes les parties du système qui sont liées
	      statiquement (de même que tout ce vous pourriez
	      avoir ajouté qui y serait lié statiquement).</p><p>C'est à vous de voir.  Vous préférerez
	      peut-être recompiler votre système tous les
	      quinze jours, et laisser les modifications s'empiler
	      pendant quinze jours.  Ou bien vous préférerez
	      ne recompiler que ce qui a changé et vous faire
	      confiance pour tout ce qui en dépend.</p><p>Et, bien sûr, cela dépend de la
	      fréquence avec laquelle vous voulez faire vos mises
	      à jour, et de si vous suivez la branche FreeBSD-STABLE
	      ou FreeBSD-CURRENT.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp83016912"></a><a id="idp83017168"></a><p><strong>24.6.14.2.</strong></p></td><td align="left" valign="top"><p>Ma compilation échoue avec de nombreuses erreurs
	      &#8220;signal 11&#8221;<a id="idp83017808" class="indexterm"></a> (ou tout
	      autre numéro de signal).  Que s'est-il passé?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Cela indique généralement un problème
	      matériel.  (Re)compiler le système est un bon
	      moyen de mettre votre matériel sous pression, et
	      mettra souvent en évidence des défaillances
	      de la mémoire vive.  Elles se manifestent normalement
	      d'elles-mêmes, la compilation échouant
	      lors de la réception de mystérieux signaux.</p><p>Un bon indicateur de cet état de fait, est que
	      vous pouvez relancer la compilation et qu'elle échouera
	      en un endroit différent.</p><p>Dans ce cas, vous ne pouvez guère faire autre chose
	      que d'intervertir les différents composants de votre
	      matériel pour déterminer lequel est en cause.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp83036880"></a><a id="idp83037136"></a><p><strong>24.6.14.3.</strong></p></td><td align="left" valign="top"><p>Puis-je effacer <code class="filename">/usr/obj</code> après
	      avoir fini?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Une réponse courte est oui.</p><p><code class="filename">/usr/obj</code> contient tous les
	      fichiers objets générés à la
	      compilation.  Normalement, une des premières
	      étapes de <code class="command">make buildworld</code> est de supprimer ce
	      répertoire et de repartir à zéro.
	      Dans ce cas, conserver le répertoire
	      <code class="filename">/usr/obj</code> après avoir terminé ne
	      sert pas à grand chose, alors que vous
	      économiseriez pas mal d'espace disque (actuellement
	      environ 340 MO).</p><p>Cependant, si vous savez ce que vous faites, vous
	      pouvez faire en sorte que <code class="command">make buildworld</code>
	      saute cette étape.  Cela rendra les compilations
	      ultérieures plus rapides, puisque la plupart des sources
	      n'auront pas besoin d'être recompilées.
	      Le revers de la médaille est que des problèmes
	      subtils de dépendance peuvent se manifester, provoquant
	      l'échec de votre compilation de manière
	      étrange.  Cela génère fréquemment
	      du bruit sur les listes de diffusion de FreeBSD, quand quelqu'un se
	      plaint que sa mise à jour a échoué, sans
	      réaliser que c'est parce qu'il a tenté de
	      brûler les étapes.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp83041360"></a><a id="idp83041616"></a><p><strong>24.6.14.4.</strong></p></td><td align="left" valign="top"><p>Une recompilation interrompue peut-elle être
	      reprise?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Tout dépend de jusqu'où vous êtes
	      aller avant de rencontrer un problème.</p><p><span class="emphasis"><em>En général</em></span> (et ceci n'est
	      pas une règle absolue) <code class="command">make buildworld</code>
	      crée de nouveaux exemplaires des outils indispensables
	      (comme <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gcc&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">gcc</span>(1)</span></a> et <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>) et des bibliothèques
	      système.  Ces outils et bibliothèques sont
	      ensuite installés.  Puis ils sont utilisés pour
	      se reconstruire eux-mêmes, et installés de nouveau.
	      L'intégralité du système (y compris
	      maintenant les programmes utilisateurs classiques, comme
	      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> ou <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=grep&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">grep</span>(1)</span></a>) est alors recompilé avec
	      les nouveaux fichiers système.</p><p>Si vous êtes à cette dernière
	      étape, et que vous le savez (parce que vous avez
	      consulté les résultats que vous avez
	      enregistrés) alors vous pouvez (sans trop de risque)
	      faire:</p><pre class="screen"><span class="emphasis"><em>&#8230; fix the problem &#8230;</em></span>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make -DNO_CLEAN all</code></strong></pre><p>Cela ne détruira pas les résultats du
	      travail qu'à déjà effectué <code class="command">make
	      buildworld</code>.</p><p>Si vous voyez le message:</p><pre class="screen">--------------------------------------------------------------
Building everything..
--------------------------------------------------------------</pre><p>dans les comptes-rendus de <code class="command">make buildworld</code>
	      alors cette façon de procéder est probablement
	      bonne.</p><p>Si vous ne voyez pas ce message, ou que vous doutez
	      de vous, alors prudence est mère de sûreté,
	      et il vaut mieux tout reprendre depuis le début.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp83102032"></a><a id="idp83102288"></a><p><strong>24.6.14.5.</strong></p></td><td align="left" valign="top"><p>Comment puis-je accélérer la compilation
	      du système?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Passez en mode mono-utilisateur.</p></li><li class="listitem"><p>Mettez les répertoires
		  <code class="filename">/usr/src</code> et
		  <code class="filename">/usr/obj</code> sur des systèmes de
		  fichiers et des disques différents.  Si possible,
		  installez ces disques sur des contrôleurs
		  différents.</p></li><li class="listitem"><p>Encore mieux, mettez ces systèmes de fichiers
		  sur plusieurs disques utilisant le système
		  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ccd&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">ccd</span>(4)</span></a> (pilote de disques
		  concaténés).</p></li><li class="listitem"><p>Ne compilez pas les bibliothèques profilées
		  (mettez &#8220;NO_PROFILE=true&#8221; dans le fichier
		  <code class="filename">/etc/make.conf</code>).  Vous n'en
		  avez certainement pas besoin.</p></li><li class="listitem"><p>Egalement dans <code class="filename">/etc/make.conf</code>,
		  positionnez <code class="varname">CFLAGS</code> à quelque
		  chose comme <code class="option">-O -pipe</code>.
		  L'optimisation <code class="option">-O2</code> est bien plus
		  lente, et la différence d'optimisation entre
		  <code class="option">-O</code> et <code class="option">-O2</code> est en
		  général négligeable.
		  <code class="option">-pipe</code> demande au compilateur d'utiliser
		  des tuyaux à la place de fichiers temporaires, ce
		  qui économise des accès disque (mais
		  utilise plus de mémoire).</p></li><li class="listitem"><p>Passez l'option
		  <code class="option">-j<em class="replaceable"><code>n</code></em></code>
		  à <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=make&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> pour permettre l'exécution de
		  plusieurs processus en parallèle.  Cela
		  améliore généralement les choses, que
		  vous ayez une machine mono- ou multi-processeurs.</p></li><li class="listitem"><p>Le système de fichiers qui contient
		  <code class="filename">/usr/src</code> peut être monté
		  (ou remonté) avec l'option <code class="option">noatime</code>.
		  Cela empêche l'enregistrement des dates d'accès
		  aux fichiers par le système de fichiers.  Vous
		  n'avez de toute façon probablement pas besoin de cette
		  information.</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -u -o noatime /usr/src</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Avertissement: </h3><p xmlns="http://www.w3.org/1999/xhtml">Cet exemple suppose que
		      <code class="filename">/usr/src</code> constitue à lui
		      seul un système de fichiers.  Si ce n'est pas
		      le cas (s'il fait partie de
		      <code class="filename">/usr</code> par exemple) vous
		      devez alors indiquer le point de montage de ce
		      système de fichiers, et non
		      <code class="filename">/usr/src</code>.</p></div></li><li class="listitem"><p>Le système de fichiers où se trouve
		  <code class="filename">/usr/obj</code> peut être
		  monté (ou remonté) avec l'option
		  <code class="option">async</code>.  Les écritures sur le
		  disque se feront alors de façon asynchrone.  En
		  d'autres termes, le programme reprend immédiatement
		  la main, et l'écriture des données sur le
		  disque se fait quelques secondes plus tard.  Cela
		  permet le groupement des écritures sur le disque,
		  et le gain en performance peut être
		  spectaculaire.</p><div xmlns="" class="warning"><h3 class="admontitle">Avertissement: </h3><p xmlns="http://www.w3.org/1999/xhtml">Gardez à l'esprit que cette option rend votre
		    système de fichiers plus fragile.  Avec cette
		    option, les risques ne sont accrus qu'en cas de
		    coupure d'alimentation, le système de fichiers
		    soit irrécupérable quand la machine
		    redémarrera.</p><p xmlns="http://www.w3.org/1999/xhtml">S'il n'y a que <code class="filename">/usr/obj</code>
		    sur ce système de fichiers, ce n'est alors pas un
		    problème.  Si vous avez d'autres données
		    importantes sur ce système de fichiers,
		    assurez-vous que vos sauvegardes soient à jour
		    avant d'activer cette option.</p></div><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mount -u -o async /usr/obj</code></strong></pre><div xmlns="" class="warning"><h3 class="admontitle">Avertissement: </h3><p xmlns="http://www.w3.org/1999/xhtml">Comme auparavant, si
		    <code class="filename">/usr/obj</code> ne constitue pas un
		    système de fichiers en soit, remplacez-le dans
		    l'exemple par le nom du point de montage
		    approprié.</p></div></li></ul></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp83132752"></a><a id="idp83165904"></a><p><strong>24.6.14.6.</strong></p></td><td align="left" valign="top"><p>Que faire si quelque chose se passe mal?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Soyez absolument sûr que votre environnement
	      ne contient pas des restes de compilation
	      précédentes.  Cela est plutôt simple:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>chflags -R noschg /usr/obj/usr</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>rm -rf /usr/obj/usr</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/src</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make cleandir</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make cleandir</code></strong></pre><p>En effet, <code class="command">make cleandir</code>
	      doit vraiment être exécutée
	      deux fois.</p><p>Ensuite relancez l'ensemble du processus,
	      en commençant avec
	      <code class="command">make buildworld</code>.</p><p>Si vous avez toujours des problèmes,
	      envoyez l'erreur et le résultat de la commande
	      <code class="command">uname -a</code> à la <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-questions" target="_top">liste de diffusion pour les questions d'ordre général à propos de FreeBSD</a>.
	      Tenez-vous prêt à répondre à d'autres
	      concernant votre configuration!</p></td></tr></tbody></table></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="synching.html">Précédent</a> </td><td width="20%" align="center"><a accesskey="u" href="updating-upgrading.html">Niveau supérieur</a></td><td width="40%" align="right"> <a accesskey="n" href="small-lan.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">24.5. Synchroniser vos sources </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 24.7. Suivre les mises à jour pour plusieurs machines</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>