<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>Livre de chevet du développeur FreeBSD</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="description" content="Bienvenue dans le livre de chevet du développeur Version française de Frédéric Praca frederic.praca@freebsd-fr.org. N.d.T.: La version française est publiée sur le serveur World Wide Web du groupe de traduction en langue française de la documentation de FreeBSD. N.d.T.: Contactez la liste de diffusion du groupe d'utilisateurs francophones de FreeBSD freebsd-questions@FreeBSD-fr.org si vous voulez collaborer à la traduction. La traduction de ce manuel est &#8220;en cours&#8221;. Dans la table des matières ci-dessous: Les chapitres marqués de deux astérisques sont en cours de traduction.Les chapitres marqués de trois astérisques sont à traduire.L'astérisque simple est réservé aux chapitres et sections en cours de rédaction dans la version U.S." /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div xml:lang="fr" class="book" lang="fr"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp61376592"></a>Livre de chevet du développeur FreeBSD</h1></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="author"><h3 class="author"><span class="orgname">Le groupe du projet de documentation FreeBSD</span></h3></div></div><div>Version: <a href="https://svnweb.freebsd.org/changeset/doc/"><span class="svnref"></span></a></div><div><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 2000-2003 Le groupe du projet de documentation FreeBSD</p></div><div><div xmlns="http://www.w3.org/1999/xhtml" class="legalnotice"><a id="legalnotice"></a><p class="legalnotice-title"><strong>Copyright</strong></p><p>Redistribution and use in source (XML DocBook) and 'compiled'
    forms (XML, HTML, PDF, PostScript, RTF and so forth) with or without
    modification, are permitted provided that the following conditions are
    met:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Redistributions of source code (XML DocBook) must retain the
        above copyright notice, this list of conditions and the following
        disclaimer as the first lines of this file unmodified.</p></li><li class="listitem"><p>Redistributions in compiled form (transformed to other DTDs,
        converted to PDF, PostScript, RTF and other formats) must
        reproduce the above copyright notice, this list of conditions and
        the following disclaimer in the documentation and/or other
        materials provided with the distribution.</p></li></ol></div><div xmlns="" class="important"><h3 class="admontitle">Important: </h3><p xmlns="http://www.w3.org/1999/xhtml">THIS DOCUMENTATION IS PROVIDED BY THE FREEBSD DOCUMENTATION
      PROJECT "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
      BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
      FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL
      THE FREEBSD DOCUMENTATION PROJECT BE LIABLE FOR ANY DIRECT, INDIRECT,
      INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
      BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS
      OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
      ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
      TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
      USE OF THIS DOCUMENTATION, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
      DAMAGE.</p></div></div></div><div>  Août 2000 par .</div><div><div xmlns="http://www.w3.org/1999/xhtml" class="abstract"><div class="abstract-title">Résumé</div><p>Bienvenue dans le livre de chevet du développeur</p><p><span class="emphasis"><em>Version française de Frédéric Praca
  <code class="email">&lt;<a xmlns="" class="email" href="mailto:frederic.praca@freebsd-fr.org">frederic.praca@freebsd-fr.org</a>&gt;</code>.</em></span></p><p>N.d.T.: La version française est publiée sur le
    <a class="link" href="../../../../" target="_top">serveur World Wide Web du groupe de
    traduction en langue française de la documentation de
    FreeBSD</a>.</p><p>N.d.T.: Contactez la liste de diffusion du groupe d'utilisateurs francophones de FreeBSD
  <code class="email">&lt;<a xmlns="" class="email" href="mailto:freebsd-questions@FreeBSD-fr.org">freebsd-questions@FreeBSD-fr.org</a>&gt;</code> si vous voulez collaborer
    à la traduction.</p><p>La traduction de ce manuel est &#8220;en cours&#8221;. Dans la
    table des matières ci-dessous:

    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Les chapitres marqués de deux astérisques
              sont en cours de traduction.</p></li><li class="listitem"><p>Les chapitres marqués de trois astérisques
              sont à traduire.</p></li><li class="listitem"><p>L'astérisque simple est réservé aux
              chapitres et sections en cours de rédaction dans la
              version U.S.</p></li></ul></div><p>
	</p></div></div></div><div class="docformatnavi">
      [
      <a href="index.html">Multiples pages HTML</a>
      /
      
	  Page HTML unique
	
      ]
    </div><hr /></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="part"><a href="#introduction">I. Introduction</a></span></dt><dd><dl><dt><span class="chapter"><a href="#developmentplatform">1. Développer sous FreeBSD</a></span></dt><dt><span class="chapter"><a href="#bsdvision">2. La vision BSD</a></span></dt><dt><span class="chapter"><a href="#archoverview">3. Survol de l'architecture</a></span></dt><dt><span class="chapter"><a href="#sourcelayout">4. L'agencement de /usr/src</a></span></dt></dl></dd><dt><span class="part"><a href="#Basics">II. Les fondamentaux</a></span></dt><dd><dl><dt><span class="chapter"><a href="#tools">5. Outils de programmation</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp61923664">5.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#idp61927376">5.2. Introduction</a></span></dt><dt><span class="sect1"><a href="#idp61935440">5.3. Introduction à la programmation</a></span></dt><dt><span class="sect1"><a href="#idp62067408">5.4. Compiler avec <code class="command">cc</code></a></span></dt><dt><span class="sect1"><a href="#idp62573008">5.5. Make</a></span></dt><dt><span class="sect1"><a href="#debugging">5.6. Déverminer</a></span></dt><dt><span class="sect1"><a href="#emacs">5.7. Utiliser Emacs comme environnement de développement</a></span></dt><dt><span class="sect1"><a href="#idp65661648">5.8. Pour aller plus loin</a></span></dt></dl></dd><dt><span class="chapter"><a href="#secure">6. Programmation sécurisée</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp65684176">6.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#secure-philosophy">6.2. Méthodologie de développement
      sécurisé</a></span></dt><dt><span class="sect1"><a href="#idp65687120">6.3. Dépassement de capacité</a></span></dt><dt><span class="sect1"><a href="#idp65784656">6.4. Les problèmes liés à SetUID</a></span></dt><dt><span class="sect1"><a href="#chroot">6.5. Limiter l'environnement de votre programme</a></span></dt><dt><span class="sect1"><a href="#idp65815248">6.6. La confiance</a></span></dt><dt><span class="sect1"><a href="#idp65818192">6.7. Les conditions de course</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#kernel">III. Le noyau</a></span></dt><dd><dl><dt><span class="chapter"><a href="#kernelhistory">7. Histoire du noyau Unix</a></span></dt><dt><span class="chapter"><a href="#locking">8. Notes sur le verrouillage</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp65828048">8.1. Les mutex</a></span></dt><dt><span class="sect1"><a href="#idp65948880">8.2. Les verrous du gestionnaire de verrous (Lock Manager)</a></span></dt><dt><span class="sect1"><a href="#idp65967184">8.3. Variables protégées atomiquement</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#memory">IV. Mémoire et mémoire virtuelle</a></span></dt><dd><dl><dt><span class="chapter"><a href="#virtualmemory">9. La mémoire virtuelle</a></span></dt></dl></dd><dt><span class="part"><a href="#iosystem">V. Système E/S (Entrées/Sorties)</a></span></dt><dd><dl><dt><span class="chapter"><a href="#ufs">10. UFS</a></span></dt></dl></dd><dt><span class="part"><a href="#ipc">VI. Communication InterProcessus (IPC)</a></span></dt><dd><dl><dt><span class="chapter"><a href="#signals">11. Les signaux</a></span></dt></dl></dd><dt><span class="part"><a href="#networking">VII. Le réseau</a></span></dt><dd><dl><dt><span class="chapter"><a href="#sockets">12. Les prises</a></span></dt></dl></dd><dt><span class="part"><a href="#networkfs">VIII. Systèmes de fichiers en réseau</a></span></dt><dd><dl><dt><span class="chapter"><a href="#afs">13. AFS</a></span></dt></dl></dd><dt><span class="part"><a href="#terminal">IX. Gestion du terminal</a></span></dt><dd><dl><dt><span class="chapter"><a href="#syscons">14. Syscons</a></span></dt></dl></dd><dt><span class="part"><a href="#sound">X. Le son</a></span></dt><dd><dl><dt><span class="chapter"><a href="#oss">15. OSS</a></span></dt></dl></dd><dt><span class="part"><a href="#devicedrivers">XI. Pilotes de périphérique</a></span></dt><dd><dl><dt><span class="chapter"><a href="#driverbasics">16. Ecrire des pilotes de périphériques pour FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp66003408">16.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#idp66006096">16.2. L'éditeur de liens dynamiques du noyau - KLD</a></span></dt><dt><span class="sect1"><a href="#idp66019408">16.3. Accéder au pilote d'un périphérique</a></span></dt><dt><span class="sect1"><a href="#idp66024272">16.4. Les périphériques caractères</a></span></dt><dt><span class="sect1"><a href="#idp66037456">16.5. Pilotes Réseau</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pci">17. Les périphériques PCI</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp66045648">17.1. Rechercher et rattacher</a></span></dt><dt><span class="sect1"><a href="#idp66049616">17.2. Les ressources du bus</a></span></dt></dl></dd><dt><span class="chapter"><a href="#scsi">18. Contrôleurs SCSI Common Access Method (CAM) **</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp66078160">18.1. En cours de traduction</a></span></dt></dl></dd><dt><span class="chapter"><a href="#usb">19. Périphériques USB ***</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp66080976">19.1. Introduction</a></span></dt></dl></dd><dt><span class="chapter"><a href="#newbus">20. NewBus</a></span></dt></dl></dd><dt><span class="part"><a href="#architectures">XII. Architectures</a></span></dt><dd><dl><dt><span class="chapter"><a href="#ia32">21. IA-32</a></span></dt><dt><span class="chapter"><a href="#alpha">22. Alpha</a></span></dt><dt><span class="chapter"><a href="#ia64">23. IA-64</a></span></dt></dl></dd><dt><span class="part"><a href="#debuggingpart">XIII. Déverminage</a></span></dt><dd><dl><dt><span class="chapter"><a href="#truss">24. Truss</a></span></dt></dl></dd><dt><span class="part"><a href="#compatibility">XIV. Les couches de compatibilité</a></span></dt><dd><dl><dt><span class="chapter"><a href="#linux">25. Linux</a></span></dt></dl></dd><dt><span class="part"><a href="#appendices">XV. Bibligraphie</a></span></dt><dd><dl><dt><span class="bibliography"><a href="#idp66099152">Bibliographie</a></span></dt></dl></dd></dl></div><div class="list-of-tables"><div class="toc-title">Liste des tableaux</div><dl><dt>8.1. <a href="#idp65860176">Liste du mutex</a></dt><dt>8.2. <a href="#idp65954896">lockmgr(9) List de verrou</a></dt></dl></div><div class="list-of-examples"><div class="toc-title">Liste des exemples</div><dl><dt>5.1. <a href="#idp63187664">Un fichier exemple <code class="filename">.emacs</code></a></dt></dl></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="introduction"></a>Partie I. Introduction</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#developmentplatform">1. Développer sous FreeBSD</a></span></dt><dt><span class="chapter"><a href="#bsdvision">2. La vision BSD</a></span></dt><dt><span class="chapter"><a href="#archoverview">3. Survol de l'architecture</a></span></dt><dt><span class="chapter"><a href="#sourcelayout">4. L'agencement de /usr/src</a></span></dt></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="developmentplatform"></a>Chapitre 1. Développer sous FreeBSD</h2></div></div></div><p>Ce document a pour but de décrire FreeBSD comme une plateforme
        de développement, la vision de BSD, un survol de l'architecture, l'agencement
        de /usr/src, l'histoire, etc.</p><p>Merci d'adopter FreeBSD comme votre plateforme
        de développement !  Nous espérons qu'elle ne vous laissera pas tomber.</p></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="bsdvision"></a>Chapitre 2. La vision BSD</h2></div></div></div><p></p></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="archoverview"></a>Chapitre 3. Survol de l'architecture</h2></div></div></div><p></p></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sourcelayout"></a>Chapitre 4. L'agencement de /usr/src</h2></div></div></div><p>Le code source complet de FreeBSD est disponible depuis notre
    	base CVS publique.  Le code source est normalement installé sous
      <code class="filename">/usr/src</code> qui contient les
      sous-répertoires suivants.</p><p>
      </p><div class="informaltable"><table border="0"><colgroup><col /><col /></colgroup><thead><tr><th>Répertoire</th><th>Description</th></tr></thead><tbody><tr><td><code class="filename">bin/</code></td><td>Sources des fichiers de
            <code class="filename">/bin</code></td></tr><tr><td><code class="filename">contrib/</code></td><td>Sources des fichiers des logiciels fournis ("contributed").</td></tr><tr><td><code class="filename">crypto/</code></td><td>Sources du DES</td></tr><tr><td><code class="filename">etc/</code></td><td>Sources des fichiers de <code class="filename">/etc</code></td></tr><tr><td><code class="filename">games/</code></td><td>Sources des fichiers de <code class="filename">/usr/games</code></td></tr><tr><td><code class="filename">gnu/</code></td><td>Utilitaires sous licence publique GNU</td></tr><tr><td><code class="filename">include/</code></td><td>Sources des fichiers de <code class="filename">/usr/include</code></td></tr><tr><td><code class="filename">kerberosIV/</code></td><td>Sources de Kerbereros version IV</td></tr><tr><td><code class="filename">kerberos5/</code></td><td>Sources de Kerbereros version 5</td></tr><tr><td><code class="filename">lib/</code></td><td>Sources des fichiers de <code class="filename">/usr/lib</code></td></tr><tr><td><code class="filename">libexec/</code></td><td>Sources des fichiers de <code class="filename">/usr/libexec</code></td></tr><tr><td><code class="filename">release/</code></td><td>Fichiers requis pour la production d'une version
            stable de FreeBSD</td></tr><tr><td><code class="filename">sbin/</code></td><td>Sources des fichiers de <code class="filename">/sbin</code></td></tr><tr><td><code class="filename">secure/</code></td><td>Sources de FreeSec</td></tr><tr><td><code class="filename">share/</code></td><td>Sources des fichiers de <code class="filename">/sbin</code></td></tr><tr><td><code class="filename">sys/</code></td><td>Fichiers source du noyau</td></tr><tr><td><code class="filename">tools/</code></td><td>Outils utilisés pour la maintenance et les tests de
	    FreeBSD</td></tr><tr><td><code class="filename">usr.bin/</code></td><td>Sources des fichiers de <code class="filename">/usr/bin</code></td></tr><tr><td><code class="filename">usr.sbin/</code></td><td>Sources des fichiers de <code class="filename">/usr/sbin</code></td></tr></tbody></table></div><p>

      </p></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="Basics"></a>Partie II. Les fondamentaux</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#tools">5. Outils de programmation</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp61923664">5.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#idp61927376">5.2. Introduction</a></span></dt><dt><span class="sect1"><a href="#idp61935440">5.3. Introduction à la programmation</a></span></dt><dt><span class="sect1"><a href="#idp62067408">5.4. Compiler avec <code class="command">cc</code></a></span></dt><dt><span class="sect1"><a href="#idp62573008">5.5. Make</a></span></dt><dt><span class="sect1"><a href="#debugging">5.6. Déverminer</a></span></dt><dt><span class="sect1"><a href="#emacs">5.7. Utiliser Emacs comme environnement de développement</a></span></dt><dt><span class="sect1"><a href="#idp65661648">5.8. Pour aller plus loin</a></span></dt></dl></dd><dt><span class="chapter"><a href="#secure">6. Programmation sécurisée</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp65684176">6.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#secure-philosophy">6.2. Méthodologie de développement
      sécurisé</a></span></dt><dt><span class="sect1"><a href="#idp65687120">6.3. Dépassement de capacité</a></span></dt><dt><span class="sect1"><a href="#idp65784656">6.4. Les problèmes liés à SetUID</a></span></dt><dt><span class="sect1"><a href="#chroot">6.5. Limiter l'environnement de votre programme</a></span></dt><dt><span class="sect1"><a href="#idp65815248">6.6. La confiance</a></span></dt><dt><span class="sect1"><a href="#idp65818192">6.7. Les conditions de course</a></span></dt></dl></dd></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="tools"></a>Chapitre 5. Outils de programmation</h2></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="sect1"><a href="#idp61923664">5.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#idp61927376">5.2. Introduction</a></span></dt><dt><span class="sect1"><a href="#idp61935440">5.3. Introduction à la programmation</a></span></dt><dt><span class="sect1"><a href="#idp62067408">5.4. Compiler avec <code class="command">cc</code></a></span></dt><dt><span class="sect1"><a href="#idp62573008">5.5. Make</a></span></dt><dt><span class="sect1"><a href="#debugging">5.6. Déverminer</a></span></dt><dt><span class="sect1"><a href="#emacs">5.7. Utiliser Emacs comme environnement de développement</a></span></dt><dt><span class="sect1"><a href="#idp65661648">5.8. Pour aller plus loin</a></span></dt></dl></div><p><span class="emphasis"><em>Ce chapître a été écrit par James Raynard.
      Les modifications pour le livre de chevet du développeur par Murray Stokely.
      </em></span></p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp61923664"></a>5.1. Synopsis</h2></div></div></div><p>Ce document est une introduction à l'utilisation de quelques
      outils de programmation fournis avec FreeBSD, toutefois tout sera applicable
      à beaucoup d'autres versions d'Unix. Cette introduction <span class="emphasis"><em>n'essaye</em></span>
      pas de décrire la programmation dans le détail.
      La plupart du document suppose que vous possédez peu ou pas de connaissances
      en programmation, espérant que les programmeurs trouveront un
      intérêt dans ce document.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp61927376"></a>5.2. Introduction</h2></div></div></div><p>FreeBSD offre un excellent environnement de développement.
      Des compilateurs pour C, C++ et Fortran ainsi qu'un assembleur sont fournis avec
      le système de base, sans parler de l'interpréteur PERL ni des
      outils classiques Unix comme <code class="command">sed</code> et <code class="command">awk</code>.
      Si cela n'est pas suffisant, il y a encore plus de compilateurs et
      d'interpréteurs dans la collection des logiciels portés.
      FreeBSD est compatible avec les standards comme <acronym class="acronym">POSIX</acronym> et C
      <acronym class="acronym">ANSI</acronym>, aussi bien qu'avec son propre héritage BSD,
      aussi il est possible d'écrire des applications qui se compileront
      et s'exécuteront avec peu ou pas de modifications sur un grand nombre de
      plateformes.</p><p>Toutefois, toute cette puissance peut être plutôt écrasante
      au premier abord si vous n'avez jamais écrit de programmes sur une
      plateforme Unix auparavant. Ce document a pour but de vous aider à commencer,
      sans entrer trop loin dans des sujets plus avancés. L'intention est
      que ce document devrait vous donner assez de bases pour être capable de
      donner du sens à la documentation.</p><p>La majeure partie du document requiert peu ou pas de connaissance
      de la programmation, bien qu'il suppose une compétence de base dans
      l'utilisation d'Unix et dans la bonne volonté d'apprendre !</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp61935440"></a>5.3. Introduction à la programmation</h2></div></div></div><p>Un programme est un ensemble d'instructions qui disent à l'ordinateur
      de faire diverses choses; quelques fois, l'instruction qu'il a à exécuter
      dépend de ce qui s'est passé lors de l'exécution d'une instruction
      précédente. Cette section donne un aperçu des deux manières par lesquelles
      vous pouvez donner ces instructions, ou
      <span class="quote">« <span class="quote">commandes</span> »</span> comme elles sont habituellement nommées.
      Une façon utilise un <em class="firstterm">interpréteur</em>, l'autre
      un <em class="firstterm">compilateur</em>. Comme les langages humains sont
      trop difficiles à comprendre sans ambiguïté par un ordinateur,
      les commandes sont habituellement écrites dans un langage ou un autre
      spécialement conçus pour cet usage.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp61941072"></a>5.3.1. Les interpréteurs</h3></div></div></div><p>Avec un interpréteur, le langage va avec un environnement
	où vous entrez des commandes à un invite de commandes et l'environnement
	les exécute pour vous. Pour des programmes plus compliqués, vous pouvez
	entrer les commandes dans un fichier et demander à l'interpréteur de charger
	le fichier et d'exécuter les commandes qui sont à l'intérieur.
	Si quoique ce soit se passe mal, beaucoup d'interpréteurs vous enverrons
	dans un dévermineur pour vous aider à débusquer le problème.</p><p>L'avantage de cela est que vous pouvez voir les résultats de
	vos commandes immédiatement, et les erreurs peuvent être corrigées
	facilement. Le plus gros désavantage arrive quand vous voulez partager
	vos programmes avec d'autres personnes. Ils doivent avoir le même
	interpréteur ou bien vous devez avoir un moyen de leur donner,
	et ils doivent comprendre comment l'utiliser. Par ailleurs, les
	utilisateurs pourraient ne pas apprécier d'être renvoyés dans un
	dévermineur s'ils ont appuyé sur la mauvaise touche !
	D'un point de vue performance, les interpréteurs peuvent utiliser
	beaucoup de mémoire et généralement ne génèrent pas un code aussi
	efficace que les compilateurs.</p><p>A mon avis, les langages interprétés sont le meilleur moyen
      	pour démarrer si vous n'avez jamais programmé. Ce genre
      	d'environnement se trouve typiquement avec des langages comme Lisp,
      	Smalltalk, Perl et Basic. Il peut aussi être dit que l'interpréteur de
	commandes Unix (<code class="command">sh</code>, <code class="command">csh</code>) est
	lui-même un interpréteur, et beaucoup de gens écrivent en fait des
	<span class="quote">« <span class="quote">scripts</span> »</span> (procédures) pour l'interpréteur pour les aider
	dans diverses tâches <span class="quote">« <span class="quote">domestiques</span> »</span> sur leur machine.
	En effet, une partie de la philosophie d'origine d'Unix était de
	fournir plein de petits programmes utilitaires qui pouvaient être liés
	ensemble dans des procédures pour effectuer des tâches utiles.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp61950032"></a>5.3.2. Les interpréteurs disponibles avec FreeBSD</h3></div></div></div><p>Voici la liste des interpréteurs qui sont disponibles sous la forme
      de <a class="link" href="ftp://ftp.FreeBSD.org:pub/FreeBSD/packages/" target="_top">
      logiciels pré-compilés pour FreeBSD</a>, avec une brève description
      de quelques uns des langages interprétés les plus populaires.</p><p>Pour obtenir un de ces logiciels pré-compilés, tout ce que vous
      avez à faire est de cliquer sur le lien du logiciel et d'exécuter</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg_add nom du logiciel</code></strong>
      </pre><p>en tant que super-utilisateur. Evidemment, vous aurez besoin d'un
      FreeBSD 2.1.0 ou plus en état de marche pour que le logiciel fonctionne !</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><acronym class="acronym">BASIC</acronym></span></dt><dd><p>Abbréviation de "Beginner's All-purpose Symbolic
	      Instruction Code" (code d'instruction symbolique tout usage
	      pour le débutant). Développé dans les années 50 pour apprendre
	      aux étudiants d'université à programmer et fourni avec tout
	      ordinateur qui se respecte dans les années 80,
	      <acronym class="acronym">BASIC</acronym> a été le premier langage de
	      programmation pour beaucoup de programmeurs. Il est aussi le
	      fondement même du Visual Basic.</p><p>L'interpréteur Basic <a class="link" href="ftp://ftp.FreeBSD.org:pub/FreeBSD/packages/lang/bwbasic-2.10.tgz" target="_top">Bywater
		</a> et l'interpréteur Basic de <a class="link" href="ftp://ftp.FreeBSD.org:pub/FreeBSD/packages/lang/pbasic-2.0.tgz" target="_top">Phil
		Cockroft</a> (anciennement Rabbit
	      Basic) sont disponibles pour FreeBSD sous forme de<a class="link" href="ftp://ftp.FreeBSD.org:pub/FreeBSD/packages/" target="_top"> logiciels pré-compilés
		</a></p></dd><dt><span class="term">Lisp</span></dt><dd><p>Un langage qui a été développé à la fin des années 50 comme
	      une alternative aux langages <span class="quote">« <span class="quote">dévoreurs de calculs</span> »</span>
	      qui étaient très populaires à l'époque. Plutôt qu'être basé
	      sur les nombres, Lisp est basé sur les listes; en fait
	      le nom est l'abbréviation de <span class="quote">« <span class="quote">List Processing</span> »</span>.
	      Très populaire en IA (Intelligence Artificielle).</p><p>Lisp est un langage extrèmement puissant et sophistiqué
	      , mais peut être assez lourd et peu maniable.</p><p>FreeBSD a <a class="link" href="ftp://ftp.FreeBSD.org:pub/FreeBSD/packages/gcl-2.0.tgz" target="_top">GNU
		Common Lisp</a> de disponible sous la forme d'un logiciel pré-compilé.</p></dd><dt><span class="term">Perl</span></dt><dd><p>Très populaire auprès des administrateurs système pour la rédaction
	      de procédures; aussi souvent utilisé sur les serveurs Internet pour
	      l'écriture de procédures <acronym class="acronym">CGI</acronym>.</p><p>La dernière version (version 5) est fournie avec FreeBSD.</p></dd><dt><span class="term">Scheme</span></dt><dd><p>Un dérivé du Lisp qui est plutôt plus compact et
	      plus propre que le Common Lisp. Populaire dans les universités étant
	      suffisamment simple à apprendre aux étudiants comme premier langage
	      , il possède un niveau d'abstraction suffisamment important pour être
	      utilisé dans le travail de recherche.</p><p>On trouve pour FreeBSD les logiciels pré-compilés <a class="link" href="ftp://ftp.FreeBSD.org:pub/FreeBSD/packages/lang/elk-3.0.tgz" target="_top">interpréteur
		Scheme Elk</a>, <a class="link" href="ftp://ftp.FreeBSD.org:pub/FreeBSD/packages/lang/mit-scheme-7.3.tgz" target="_top">l'interpréteur
		Scheme du MIT</a> et <a class="link" href="ftp://ftp.FreeBSD.org:pub/FreeBSD/packages/lang/scm-4e1.tgz" target="_top">l'interpréteur Scheme
		SCM</a>.</p></dd><dt><span class="term">Icon</span></dt><dd><p><a class="link" href="ftp://ftp.FreeBSD.org:pub/FreeBSD/packages/lang/icon-9.0.tgz" target="_top">Le langage
		de programmation Icon</a>.</p></dd><dt><span class="term">Logo</span></dt><dd><p><a class="link" href="ftp://ftp.FreeBSD.org:pub/FreeBSD/packages/lang/ucblogo-3.3.tgz" target="_top">l'interpréteur Logo
		de Brian Harvey</a>.</p></dd><dt><span class="term">Python</span></dt><dd><p><a class="link" href="ftp://ftp.FreeBSD.org:pub/FreeBSD/packages/lang/python-1.2" target="_top">Le
		langage orienté objet Python</a></p></dd></dl></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp62050000"></a>5.3.3. Les compilateurs</h3></div></div></div><p>Les compilateurs sont plutôt différents entre eux. Tout d'abord, vous écrivez
	votre code dans un fichier (ou des fichiers) en utilisant un éditeur de texte. Vous
	exécutez ensuite le compilateur et vérifiez qu'il accepte votre programme. S'il ne
	compile pas, grincez des dents et retournez à l'éditeur; s'il compile et
	vous donne un programme, vous pouvez exécuter ce dernier à l'invite de commande ou
	dans un dévermineur pour voir s'il fonctionne correctement.

	<a href="#ftn.idp62052176" class="footnote" id="idp62052176"><sup class="footnote">[1]</sup></a></p><p>Evidemment, ce n'est pas aussi direct que d'utiliser un interpréteur.
      Toutefois cela vous permet de faire beaucoup de choses qui sont difficiles
      ou même impossibles avec un interpréteur, comme écrire du code qui interagit
      de façon proche du système d'exploitation ou même d'écrire votre propre
      système d'exploitation ! C'est aussi utile si vous avez besoin d'écrire du code
      très efficace, étant donné que le compilateur peut prendre son temps et
      optimiser le code, ce qui ne serait pas acceptable avec un interpréteur.
      Et distribuer un programme écrit pour un compilateur est habituellement
      plus évident qu'un écrit pour un interpréteur&#8212;vous pouvez juste donner
      une copie de l'exécutable, en supposant que l'utilisateur possède le même
      système d'exploitation que vous.</p><p>Les langages compilés incluent Pascal, C et C++. C et C++
	sont des langages plutôt impitoyables et conviennent mieux
	aux programmeurs expérimentés; Pascal, d'autre part, a été
	conçu comme un langage éducatif, et est un assez bon langage
	pour commencer. Malheureusement, FreeBSD ne possède aucun
	support Pascal, excepté pour un convertisseur Pascal vers C
	dans les logiciels portés.</p><p>Le cycle édition-compilation-exécution-déverminage étant relativement pénible
      lors de l'utilisation de programmes séparés, beaucoup de fabricants de compilateur
      ont produit des environnements de développement intégrés (ou <acronym class="acronym">IDE</acronym> pour
      Integrated Development Environments et <acronym class="acronym">EDI</acronym> dans la langue de
      Molière). FreeBSD ne possède pas d'<acronym class="acronym">EDI</acronym>
      tel quel; toutefois il est possible d'utiliser Emacs à cet effet.
      Ceci est vu dans <a class="xref" href="#emacs" title="5.7. Utiliser Emacs comme environnement de développement">Section 5.7, « Utiliser Emacs comme environnement de développement »</a>.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp62067408"></a>5.4. Compiler avec <code class="command">cc</code></h2></div></div></div><p>Cette section traite uniquement du compilateur GNU pour C et C++,
      celui-ci faisant partie du système FreeBSD de base. Il peut être invoqué
      soit par <code class="command">cc</code> ou <code class="command">gcc</code>. Les
      détails de production d'un programme avec un interpréteur varient
      considérablement d'un interpréteur à l'autre, et sont habituellement
      bien couverts par la documentation et l'aide en ligne de l'interpréteur.</p><p>Une fois que vous avez écrit votre chef d'oeuvre, la prochaine étape est
      de le convertir en quelque chose qui s'exécutera (espérons !) sur FreeBSD.
      Cela implique normalement plusieurs étapes, réalisées chacune par un programme
      différent.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Pré-traiter votre code source pour retirer les commentaires et faire
	  d'autres trucs comme développer (expanser) les macros en C.</p></li><li class="step"><p>Vérifier la syntaxe de votre code source pour voir si vous avez
	obéi aux règles du langage. Si vous ne l'avez pas fait, il se plaindra !</p></li><li class="step"><p>Convertir le code source en langage assembleur&#8212;
	cela est vraiment proche du code machine, mais reste
	  compréhensible par des humains. Prétendument.

	  <a href="#ftn.idp62088016" class="footnote" id="idp62088016"><sup class="footnote">[2]</sup></a></p></li><li class="step"><p>Convertir le langage  assembleur en code machine
	  &#8212;ouais, on parle de bits et d'octets, de uns et
	  de zéros.</p></li><li class="step"><p>Vérifier que vous avez utilisé des choses comme des fonctions et
	des variables globales de façon consistente. Par exemple, si vous
	  avez appelé une fonction inexistente, le compilateur se plaindra.</p></li><li class="step"><p>Si vous essayez de produire un exécutable depuis plusieurs
	  fichiers de code source, résoudre comment les faire fonctionner
	  ensemble.</p></li><li class="step"><p>Résoudre comment produire quelque chose que le chargeur au vol
	du système sera capable de charger en mémoire et exécuter.</p></li><li class="step"><p>Finalement, écrire l'exécutable dans le système de fichiers.</p></li></ol></div><p>Le mot <em class="firstterm">compilation</em> est souvent utilisé pour
      les étapes 1 à 4 seules&#8212;les autres correspondent au terme
      <em class="firstterm">liaison</em>. Quelquefois, l'étape 1 est appelée
      <em class="firstterm">pre-traitement</em> et les étapes 3-4 <em class="firstterm">assemblage</em>.</p><p>Heureusement, la plupart de ces détails vous sont cachés, étant donné que
    <code class="command">cc</code> est un frontal qui s'occupe d'appeler tous les
      programmes avec les arguments corrects pour vous; tapez simplement</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc foobar.c</code></strong>
    </pre><p>compilera <code class="filename">foobar.c</code> avec toutes les étapes au-dessus.
    Si vous avez plus d'un fichier à compiler, faites simplement
      quelque chose comme</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc foo.c bar.c</code></strong>
    </pre><p>Notez que la vérification de syntaxe n'est que cela&#8212;vérifier
      la syntaxe. Cela ne vérifiera pas les erreurs de logique que vous pouvez
      avoir faites, comme mettre le programme en boucle infinie ou
      utiliser un tri à bulles quand vous devriez utiliser un tri binaire.

      <a href="#ftn.idp62129360" class="footnote" id="idp62129360"><sup class="footnote">[3]</sup></a></p><p>Il y a beaucoup d'options pour <code class="command">cc</code>, qui
      qui se trouvent toutes dans les pages de manuel en ligne.
      Voici quelques unes des plus importantes, avec des exemples illustrant leur
      utilisation.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-o <em class="replaceable"><code>nom_du_fichier</code></em></code></span></dt><dd><p>Le nom de sortie du fichier.  Si vous n'utilisez pas cette option,
	  <code class="command">cc</code> produira un exécutable appelé
	    <code class="filename">a.out</code>.

	    <a href="#ftn.idp62139216" class="footnote" id="idp62139216"><sup class="footnote">[4]</sup></a></p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc foobar.c</code></strong>               <em class="lineannotation"><span class="lineannotation">l'exécutable est a.out</span></em>
<code class="prompt">%</code> <strong class="userinput"><code>cc -o foobar foobar.c</code></strong>     <em class="lineannotation"><span class="lineannotation">l'exécutable est foobar</span></em>
	    </pre></div></dd><dt><span class="term"><code class="option">-c</code></span></dt><dd><p>Compile juste le fichier, ne le lie pas. Utile pour les
	    programmes jouets dont vous voulez juste vérifier la syntaxe,
	    ou si vous utilisez un <code class="filename">Makefile</code>.</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -c foobar.c</code></strong>
	    </pre></div><p>Cela va produire un <em class="firstterm">fichier objet</em> (pas un
	    exécutable) appelé <code class="filename">foobar.o</code>. Celui-ci
	    peut être lié ensuite avec d'autres fichiers objets pour produire un
	    exécutable.</p></dd><dt><span class="term"><code class="option">-g</code></span></dt><dd><p>Crée une version de déverminage de l'exécutable. Cela oblige
	    le compilateur à placer des informations dans l'exécutable comme
	    telle ligne du fichier source correspond à tel appel de fonction.
	    Un dévermineur peut utiliser cette information pour vous montrer
	    le code source au fur et à mesure que vous avancez pas à pas dans le programme,
	    ce qui est <span class="emphasis"><em>très</em></span> utile; le désavantage est que
	    toutes ces informations supplémentaires rendent le programme plus gros.
	    Normalement, vous compilez avec l'option <code class="option">-g</code> quand vous
	    êtes en train de développer un programme et compilez ensuite une
	    <span class="quote">« <span class="quote">version de production</span> »</span> sans <code class="option">-g</code> quand vous êtes
	    satisfait du fonctionnement.</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -g foobar.c</code></strong>
	    </pre></div><p>Cela va produire une version de déverminage du programme foobar.

	    <a href="#ftn.idp62182224" class="footnote" id="idp62182224"><sup class="footnote">[5]</sup></a></p></dd><dt><span class="term"><code class="option">-O</code></span></dt><dd><p>Crée une version optimisée de l'exécutable. Le compilateur
	    effectue différents trucs malins pour essayer de produire
	    un exécutable qui s'exécute plus rapidement que normal.
	    Vous pouvez ajouter un nombre après l'option <code class="option">-O</code>
	    pour spécifier un niveau d'optimisation plus important, mais cela vous expose
	    souvent aux bogues dans l'optimiseur du compilateur. Par exemple, la version de
	    <code class="command">cc</code> fournit avec la version 2.1.0 FreeBSD est connue
	    pour produire du mauvais code avec l'option <code class="option">-O2</code>
	    dans certaines circonstances.</p><p>L'optimisation est habituellement activée uniquement lors de
	  la compilation d'une version de production.</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -O -o foobar foobar.c</code></strong>
	    </pre></div><p>Cela va produire une version optimisée de
	    <code class="filename">foobar</code>.</p></dd></dl></div><p>Les trois prochaines options vont forcer <code class="command">cc</code>
      à vérifier que votre code est conforme au standard international en cours,
      se référant souvent à la norme <acronym class="acronym">ANSI</acronym>, qui pour dire précisement
      est un standard <acronym class="acronym">ISO</acronym>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-Wall</code></span></dt><dd><p>Active tous les avertissements que les auteurs de
	    <code class="command">cc</code> pensent valoir le coup. Malgré le nom, il
	    n'active pas tous les avertissements dont <code class="command">cc</code>
	    est capable.</p></dd><dt><span class="term"><code class="option">-ansi</code></span></dt><dd><p>Désactive la plupart, mais pas toutes, des caractéristiques
	    du C fournies par <code class="command">cc</code> qui sont non-<acronym class="acronym">ANSI</acronym> . Malgré
	    le nom, cela ne garantit pas strictement que votre code sera conforme au standard.</p></dd><dt><span class="term"><code class="option">-pedantic</code></span></dt><dd><p>Désactive <span class="emphasis"><em>toutes</em></span>
	    les caractéristiques de <code class="command">cc</code> qui ne sont pas <acronym class="acronym">ANSI</acronym> .</p></dd></dl></div><p>Sans ces options, <code class="command">cc</code> vous permettrait d'utiliser
      quelques extensions au standard non-standards. Quelques unes de celles-ci
      sont très utiles, mais ne fonctionneront pas avec d'autres compilateurs
      &#8212;en fait, un des principaux buts du standard est de permettre aux gens
      d'écrire du code qui fonctionnera avec n'importe quel compilateur sur
      n'importe quel système. Cela est connu sous le nom de <em class="firstterm">code portable</em>.</p><p>Generalement, vous devriez essayer de faire votre code aussi portable
    que possible, sinon vous pourriez avoir a ré-écrire totalement votre
    programme plus tard pour le faire fonctionner autre part&#8212;et qui
      sait ce que vous utiliserez dans quelques années?</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -Wall -ansi -pedantic -o foobar foobar.c</code></strong>
      </pre></div><p>Cela produira un exécutable <code class="filename">foobar</code>
      après avoir vérifié que <code class="filename">foobar.c</code> est conforme au standard.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-l<em class="replaceable"><code>librairie</code></em></code></span></dt><dd><p>Spécifie une librairie de fonctions à utiliser lors
	  de l'édition des liens.</p><p>L'exemple le plus commun de cela est lors de la compilation
	  d'un programme qui utilise quelques fonctions mathématiques en C.
	  A l'inverse de la plupart des plateformes, celles-ci se trouvent dans
	  une librairie standard du C et vous devez dire au compilateur de l'ajouter.
	  </p><p>La règle est que si une librairie est appelée
	    <code class="filename">libquelque_chose.a</code>,
	    vous donnez à  <code class="command">cc</code> l'argument
	    <code class="option">-l<em class="replaceable"><code>quelque_chose</code></em></code>.
	    Par exemple, la librairie des fonctions mathématiques est
	    <code class="filename">libm.a</code>, aussi vous donnez à
	    <code class="command">cc</code> le paramètre  <code class="option">-lm</code>.
	    Un <span class="quote">« <span class="quote">piège</span> »</span> habituel avec la librairie math est
	    qu'elle doit être la dernière sur la ligne de commande.</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -o foobar foobar.c -lm</code></strong>
	    </pre></div><p>Cela va lier les fonctions de la librairie math à l'interieur de
	    <code class="filename">foobar</code>.</p><p>Si vous compilez du C++; vous devrez ajouter
	    <code class="option">-lg++</code>, ou <code class="option">-lstdc++</code> si
	    vous utilisez FreeBSD 2.2 ou ultérieur, à la ligne de commande de
	    <code class="command">cc</code> pour lier avec les fonctions de la librairie C++.
	    Alternativement, vous pouvez utiliser <code class="command">c++</code> plutôt
	    que <code class="command">cc</code>, qui fait tout cela pour vous.
	    <code class="command">c++</code> peut aussi être invoqué par
	    <code class="command">g++</code> sur FreeBSD.</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -o foobar foobar.cc -lg++</code></strong>     <em class="lineannotation"><span class="lineannotation">Pour FreeBSD 2.1.6 et antérieur</span></em>
<code class="prompt">%</code> <strong class="userinput"><code>cc -o foobar foobar.cc -lstdc++</code></strong>  <em class="lineannotation"><span class="lineannotation">Pour FreeBSD 2.2 et ultérieur</span></em>
<code class="prompt">%</code> <strong class="userinput"><code>c++ -o foobar foobar.cc</code></strong>
	    </pre></div><p>Chacune de ces commandes va produire un exécutable
	    <code class="filename">foobar</code> à partir du fichier source C++
	    <code class="filename">foobar.cc</code>. Notez que, sur les systèmes Unix
	    , les fichiers source C++ se terminent traditionnellement en
	    <code class="filename">.C</code>, <code class="filename">.cxx</code> ou
	    <code class="filename">.cc</code>, plutôt que le style MS-DOS
	    <code class="filename">.cpp</code> (qui était déjà
	    utilisé pour autre chose).  <code class="command">gcc</code> a utilisé cela
	    pour trouver le type de compilateur à utiliser sur le fichier source;
	    toutefois, cette restriction ne s'applique plus,
	    aussi vous pouvez maintenant appeler vos fichiers C++
	    <code class="filename">.cpp</code> en toute impunité !</p></dd></dl></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp62318800"></a>5.4.1. Questions et problèmes usuels sur <code class="command">cc</code></h3></div></div></div><div class="qandaset"><a id="idp62322000"></a><dl><dt>5.4.1.1. <a href="#idp62323024">J'essaye d'écrire un programme qui utilise la fonction
	      sin() et je reçois l'erreur suivante.
	      Que cela signifie-t-il ?</a></dt><dt>5.4.1.2. <a href="#idp62357328">J'ai écrit un programme simple pour m'exercer à
	    l'utilisation de l'option -lm. Tout ce qu'il fait
	    est d'élever 2,1 à la puissance 6.</a></dt><dt>5.4.1.3. <a href="#idp62376400">Alors comment puis-je le réparer?</a></dt><dt>5.4.1.4. <a href="#idp62399824">J'ai compilé un fichier appelé
	      foobar.c et je ne trouve pas d'exécutable
	      appelé foobar. Où est-il parti?</a></dt><dt>5.4.1.5. <a href="#idp62424016">OK, j'ai un exécutable appelé
	      foobar, je peux le voir en exécutant
	      ls, mais quand je tape
	      foobar à l'invite de commandes, la réponse
	      est qu'il n'y a pas de tel fichier. Pourquoi le système ne le trouve pas?
	    </a></dt><dt>5.4.1.6. <a href="#idp62443088">J'ai appelé mon exécutable test,
	    mais rien ne se passe quand je l'exécute. Que se passe-t-il?
	    </a></dt><dt>5.4.1.7. <a href="#idp62458576">J'ai compilé mon programme et il semble fonctionner au premier abord,
	    puis il y a une erreur et le système a dit quelque chose comme
	    core dumped. Que cela signifie-t-il?</a></dt><dt>5.4.1.8. <a href="#idp62476112">Fascinant, mais que suis-je supposé faire ?</a></dt><dt>5.4.1.9. <a href="#idp62483664">Quand mon programme a généré un fichier core,
	    il a parlé d'une erreur segmentation fault.
	    Qu'est-ce que c'est ?</a></dt><dt>5.4.1.10. <a href="#idp62532176">Des fois quand je reçoit une erreur core dump,
	    il est précisé bus error.
	    Il est dit dans mon livre Unix qu'il s'agit d'un problème matériel
	    mais l'ordinateur semble toujours fonctionner. Est-ce vrai ?
	    </a></dt><dt>5.4.1.11. <a href="#idp62538064">Toute cette affaire de fichier core semble être
	    assez utile, si je peux le faire apparaître quand je le désire.
	    Puis-je faire cela, ou dois-je attendre la prochaine erreur ?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="idp62323024"></a><a id="idp62324048"></a><p><strong>5.4.1.1.</strong></p></td><td align="left" valign="top"><p>J'essaye d'écrire un programme qui utilise la fonction
	      <code class="function">sin()</code> et je reçois l'erreur suivante.
	      Que cela signifie-t-il ?</p><div class="informalexample"><pre class="screen">/var/tmp/cc0143941.o: Undefined symbol `_sin' referenced from text segment
	      </pre></div></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Lors de l'utilisation des fonctions mathématiques comme
	      <code class="function">sin()</code>, vous devez dire à
	      <code class="command">cc</code> de lier avec la librairie math, comme :</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -o foobar foobar.c -lm</code></strong>
	      </pre></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp62357328"></a><a id="idp62358480"></a><p><strong>5.4.1.2.</strong></p></td><td align="left" valign="top"><p>J'ai écrit un programme simple pour m'exercer à
	    l'utilisation de l'option <code class="option">-lm</code>. Tout ce qu'il fait
	    est d'élever 2,1 à la puissance 6.</p><div class="informalexample"><pre class="programlisting">#include &lt;stdio.h&gt;

int main() {
	float f;

	f = pow(2.1, 6);
	printf("2.1 ^ 6 = %f\n", f);
	return 0;
}
	      </pre></div><p>j'ai effectué la compilation comme suit :</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc temp.c -lm</code></strong>
	      </pre></div><p>et comme expliqué ici, mais j'obtiens ceci
	    quand je l'exécute :</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>./a.out</code></strong>
2.1 ^ 6 = 1023.000000
	      </pre></div><p>Ce <span class="emphasis"><em>n'est pas</em></span> la réponse correcte !
	      Que se passe-t-il ?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Quand le compilateur voit que vous appelez une fonction, il
	    vérifie s'il a déjà un prototype pour celle-ci.
	    S'il ne l'a pas vu, il suppose que la fonction retourne un <span class="type">int</span>,
	    ce qui n'est absolument  pas ce que vous voulez ici.
	    </p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp62376400"></a><a id="idp62376656"></a><p><strong>5.4.1.3.</strong></p></td><td align="left" valign="top"><p>Alors comment puis-je le réparer?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Les prototypes des fonctions mathématiques sont dans
	      <code class="filename">math.h</code>. Si vous incluez ce fichier,
	      le compilateur sera capable de trouver le prototype et il
	      arrêtera de faire des trucs étranges à vos calculs!
	      </p><div class="informalexample"><pre class="programlisting">#include &lt;math.h&gt;
#include &lt;stdio.h&gt;

int main() {
...
	      </pre></div><p>Après avoir recompilé comme précédemment,
	    exécutez :
	    </p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>./a.out</code></strong>
2.1 ^ 6 = 85.766121
	      </pre></div><p>Si vous utilisez quelques fonctions mathématiques que ce soit,
	    incluez <span class="emphasis"><em>toujours</em></span> <code class="filename">math.h</code> et n'oubliez pas
	    de lier avec la librairie math.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp62399824"></a><a id="idp62400080"></a><p><strong>5.4.1.4.</strong></p></td><td align="left" valign="top"><p>J'ai compilé un fichier appelé
	      <code class="filename">foobar.c</code> et je ne trouve pas d'exécutable
	      appelé <code class="filename">foobar</code>. Où est-il parti?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Souvenez-vous, <code class="command">cc</code> appellera
	    l'exécutable <code class="filename">a.out</code> sauf si vous lui dites
	    de faire autrement. Utilisez l'option
	      <code class="option">-o <em class="replaceable"><code>nomfichier</code></em></code>:</p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -o foobar foobar.c</code></strong>
	      </pre></div></td></tr><tr class="question"><td align="left" valign="top"><a id="idp62424016"></a><a id="idp62425040"></a><p><strong>5.4.1.5.</strong></p></td><td align="left" valign="top"><p>OK, j'ai un exécutable appelé
	      <code class="filename">foobar</code>, je peux le voir en exécutant
	      <code class="command">ls</code>, mais quand je tape
	      <code class="command">foobar</code> à l'invite de commandes, la réponse
	      est qu'il n'y a pas de tel fichier. Pourquoi le système ne le trouve pas?
	    </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>A l'inverse de MS-DOS, Unix ne regarde pas dans le
	    répertoire courant lorsqu'il essaye de trouver un
	    exécutable que vous voulez exécuter, sauf si
	    vous lui avez dit de le faire.
	    Vous pouvez soit taper <code class="command">./foobar</code>, ce qui
	    signifie <span class="quote">« <span class="quote">exécute le fichier nommé
	    <code class="filename">foobar</code> dans le répertoire courant</span> »</span>,
	    soit changer votre variable d'environnement <code class="envar">PATH</code>
	    de façon à ce qu'elle ressemble à quelque chose comme
	    </p><div class="informalexample"><pre class="screen">bin:/usr/bin:/usr/local/bin:.
	      </pre></div><p>Le point à la fin signifie <span class="quote">« <span class="quote">regarde dans le repertoire
	    courant s'il n'est dans aucun autre</span> »</span>.</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp62443088"></a><a id="idp62443856"></a><p><strong>5.4.1.6.</strong></p></td><td align="left" valign="top"><p>J'ai appelé mon exécutable <code class="filename">test</code>,
	    mais rien ne se passe quand je l'exécute. Que se passe-t-il?
	    </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>La plupart des systèmes Unix ont un programme appelé
	      <code class="command">test</code> dans <code class="filename">/usr/bin</code>
	      et l'interpréteur prend celui-ci avant de vérifier dans
	      le répertoire courant. Soit vous tapez
	      </p><div class="informalexample"><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>./test</code></strong>
	      </pre></div><p>soit vous choisissez un meilleur nom pour votre programme !!
	    </p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp62458576"></a><a id="idp62459472"></a><p><strong>5.4.1.7.</strong></p></td><td align="left" valign="top"><p>J'ai compilé mon programme et il semble fonctionner au premier abord,
	    puis il y a une erreur et le système a dit quelque chose comme
	    <span class="errorname">core dumped</span>. Que cela signifie-t-il?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Le nom <em class="firstterm">core dump</em> date
	    des tous premiers jours d'Unix, quand les machines utilisaient
	    la mémoire centrale<a href="#ftn.idp62472912" class="footnote" id="idp62472912"><sup class="footnote">[6]</sup></a>pour stocker
	    les données.
	    Simplement, si le programme a échoué sous certaines conditions,
	    le système va écrire le contenu de la mémoire centrale
	    sur le disque dans un fichier appelé
	    <code class="filename">core</code>, que le programmeur peut ensuite
	    examiner de près pour trouver ce qui s'est mal passé.
	    </p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp62476112"></a><a id="idp62476368"></a><p><strong>5.4.1.8.</strong></p></td><td align="left" valign="top"><p>Fascinant, mais que suis-je supposé faire ?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Utilisez <code class="command">gdb</code> pour analyser le fichier <code class="filename">core</code>
	    (voir <a class="xref" href="#debugging" title="5.6. Déverminer">Section 5.6, « Déverminer »</a>).</p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp62483664"></a><a id="idp62484560"></a><p><strong>5.4.1.9.</strong></p></td><td align="left" valign="top"><p>Quand mon programme a généré un fichier <code class="filename">core</code>,
	    il a parlé d'une erreur <span class="errorname">segmentation fault</span>.
	    Qu'est-ce que c'est ?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Cela signifie simplement que votre programme a essayé
	    d'effectuer une opération illégale sur la mémoire;
	    Unix est conçu pour protéger le système d'exploitation
	    et les autres programmes des programmes crapuleux.
	    </p><p>Les causes habituelles de cela sont :</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Essayer d'écrire dans un pointeur <span class="symbol">NULL</span>,
		par exemple
		</p><pre class="programlisting">char *foo = NULL;
strcpy(foo, "bang!");
		</pre></li><li class="listitem"><p>Utiliser un pointeur qui n'a pas été initialisé,
		par exemple</p><pre class="programlisting">char *foo;
strcpy(foo, "bang!");
		</pre><p>Le pointeur va avoir une valeur aléatoire qui
		avec de la chance, pointera dans une zone de la mémoire qui
		n'est pas disponible pour votre programme et le noyau va tuer
		votre programme avant qu'il ne fasse des dommages. Si
		vous êtes malchanceux, il pointera quelque part dans votre
		propre programme et altèrera une de vos structures de données,
		faisant planter votre programme mystérieusement.
		</p></li><li class="listitem"><p>Essayer d'accèder la mémoire au-delà de la fin
		d'un tableau,
		par exemple</p><pre class="programlisting">int bar[20];
bar[27] = 6;
		</pre></li><li class="listitem"><p>Essayer de stocker quelque chose dans la mémoire en lecture seule,
		par exemple</p><pre class="programlisting">char *foo = "Ma chaine";
strcpy(foo, "bang!");
		</pre><p>Les compilateurs Unix mettent souvent les chaînes comme
		<code class="literal">"Ma chaine"</code> dans des zones de mémoire
		en lecture seule.
		</p></li><li class="listitem"><p>Faire des trucs sales avec
		  <code class="function">malloc()</code> et
		  <code class="function">free()</code>, par exemple</p><pre class="programlisting">char bar[80];
free(bar);
		</pre><p>ou</p><pre class="programlisting">char *foo = malloc(27);
free(foo);
free(foo);
		</pre></li></ul></div><p>Faire une de ces fautes ne conduit pas toujours
	    à une erreur, mais elles sont toujours de mauvais entrainements.
	    Certains systèmes et compilateurs sont plus tolérants que d'autres,
	    ce qui explique pourquoi des programmes qui fonctionnent bien sur un système
	    peuvent planter si vous les essayer sur un autre.
	    </p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp62532176"></a><a id="idp62532816"></a><p><strong>5.4.1.10.</strong></p></td><td align="left" valign="top"><p>Des fois quand je reçoit une erreur <span class="errorname">core dump</span>,
	    il est précisé <span class="errorname">bus error</span>.
	    Il est dit dans mon livre Unix qu'il s'agit d'un problème matériel
	    mais l'ordinateur semble toujours fonctionner. Est-ce vrai ?
	    </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Non, heureusement non (sauf si bien sûr vous avez réellement
	    un problème matériel&#8230;). Cela est habituellement une
	    manière de dire que vous avez accédé à la mémoire
	    d'une façon que vous n'auriez pas dû.
	    </p></td></tr><tr class="question"><td align="left" valign="top"><a id="idp62538064"></a><a id="idp62547024"></a><p><strong>5.4.1.11.</strong></p></td><td align="left" valign="top"><p>Toute cette affaire de fichier <code class="filename">core</code> semble être
	    assez utile, si je peux le faire apparaître quand je le désire.
	    Puis-je faire cela, ou dois-je attendre la prochaine erreur ?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Oui, ouvrez une autre console ou xterm, faites</p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>ps</code></strong>
	    </pre><p>pour trouver l'identifiant du processus de votre programme, et faites
	    </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>kill -ABRT identifiant</code></strong>
	    </pre><p>où
	      <em class="parameter"><code><em class="replaceable"><code>identifiant</code></em></code></em> est
	      l'identifiant du processus que vous avez trouvé.</p><p>Ceci est utile si votre programme est bloqué dans une boucle
	    infinie, par exemple. Si votre programme arrive à bloquer le signal
	    <span class="symbol">SIGABRT</span>, il y a d'autres signaux qui ont des effets
	    similaires.
	    </p><p>Alternativement, vous pouvez créer un fichier <code class="filename">core</code> depuis
	    votre programme, en appelant la fonction <code class="function">abort()</code>.
	    Voir la page de manuel en ligne de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=abort&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">abort</span>(3)</span></a> pour en savoir plus.
	    </p><p>Si vous voulez créer un fichier <code class="filename">core</code> depuis
	    l'extérieur de votre programme, mais ne voulez pas que le processus
	    s'arrêt,vous pouvez utiliser le programme <code class="command">gcore</code>.
	    Voir la page de manuel en ligne de <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=gcore&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">gcore</span>(1)</span></a> pour plus d'informations.
	    </p></td></tr></tbody></table></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp62573008"></a>5.5. Make</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp62575184"></a>5.5.1. Qu'est-ce que <code class="command">make</code>?</h3></div></div></div><p>Quand vous travaillez sur un programme simple avec seulement
      un ou deux fichiers source, taper
      </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc fichier1.c fichier2.c</code></strong>
      </pre><p>n'est pas si mal, mais cela devient rapidement fastidieux quand
      il y a plusieurs fichiers&#8212;et cela peut prendre du temps à compiler aussi.
      </p><p>Une façon de contourner cela est d'utiliser les fichiers objet
      et de recompiler le fichier source seulement si le code source a changé.
      Aussi, nous pourrions avoir quelque chose comme ça:
      </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc fichier1.o fichier2.o</code></strong> &#8230; <strong class="userinput"><code>fichier37.c</code></strong> &#8230;
      </pre><p>si nous avions changé le fichier <code class="filename">fichier37.c</code> mais aucun
      des autres depuis la dernère compilation. Cela pourrait accélerer assez bien
      la compilation mais cela ne resoud pas le problème de la frappe au clavier.
      </p><p>Ou nous pourrions écrire une procédure pour résoudre ce
      problème de frappe, mais celle-ci devrait tout re-compiler, devenant
      ainsi inefficace sur un gros projet.
      </p><p>Que se passe-t-il si nous avons des centaines de fichiers source ?
      Que se passe-t-il si nous travaillons dans une équipe avec
      d'autres personnes qui oublient de nous dire quand ils ont changé
      un de leurs fichiers source que nous utilisons ?
      </p><p>Peut-être pourrions nous mettre ensemble les deux solutions et
      écrire quelque chose comme une procédure qui contiendrait
      quelque règle magique disant quand notre fichier source doit être
      compilé. Maintenant, tout ce dont nous avons besoin est un programme
      qui comprend ces règles, alors que c'est trop compliqué pour
      l'interpréteur.
      </p><p>Ce programme s'appelle <code class="command">make</code>. Il lit
      dans un fichier, appelé un <em class="firstterm">makefile</em>,
      qui lui dit comment les différents fichiers dépendent les
      uns des autres, et détermine quels fichiers ont besoin d'être
      recompilés et quels n'en ont pas besoin.
      Par exemple, une règle pourrait dire quelque chose comme
      <span class="quote">« <span class="quote">si <code class="filename">fromboz.o</code> est plus ancien que
      <code class="filename">fromboz.c</code>, cela signifie que quelqu'un a dû
      changer <code class="filename">fromboz.c</code>, aussi il a besoin d'être
      recompilé.</span> »</span> Le makefile possède aussi des règles
      pour dire à <code class="command">make</code> <span class="emphasis"><em>comment</em></span>
      re-compiler un fichier source, en faisant ainsi un outil encore plus
      puissant.
      </p><p>Les <code class="filename">Makefile</code>s sont typiquement stockés dans le même
      répertoire que le source auxquels il s'appliquent, et peuvent être
      appelés <code class="filename">makefile</code>, <code class="filename">Makefile</code>
      ou <code class="filename">MAKEFILE</code>. La plupart des programmeurs utilise le nom
      <code class="filename">Makefile</code>, celui-ci se trouvant proche du début de la
      liste du contenu du répertoire où il peut être facilement vu.

	<a href="#ftn.idp62621008" class="footnote" id="idp62621008"><sup class="footnote">[7]</sup></a>
      </p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp62633040"></a>5.5.2. Exemple d'utilisation de <code class="command">make</code></h3></div></div></div><p>Voici un exemple très simple de <code class="filename">Makefile</code>:
      </p><pre class="programlisting">foo: foo.c
	cc -o foo foo.c</pre><p>Il consiste en deux lignes, une ligne de dépendance et une ligne
      de création.
      </p><p>La ligne de dépendance ici consiste en le nom du programme (connu comme
      <em class="firstterm">cible</em>), suivi de deux-points puis un espace et enfin
      le nom du fichier source.
      Quand <code class="command">make</code> lit cette ligne, il vérifie si
       <code class="filename">foo</code> existe; s'il existe, il compare la date à laquelle
       <code class="filename">foo</code> a été modifié la dernière fois
       avec la date de dernière modification de <code class="filename">foo.c</code>.
       Si <code class="filename">foo</code> n'existe pas ou est plus ancien que <code class="filename">foo.c</code>,
       il regarde la ligne de création pour trouver ce qu'il doit faire.
       En d'autres termes, il s'agit de la règle à utiliser quand
       <code class="filename">foo.c</code> a besoin d'être re-compilé.
       </p><p>La ligne de création commence avec un <span class="token">tab</span> (appuyez
      sur la touche <span class="keycap"><strong>tab</strong></span>) suivi de la commande que vous taperiez
      pour créer <code class="filename">foo</code> si vous deviez le faire à l'invite
      de commandes. Si <code class="filename">foo</code> n'est pas à jour ou n'existe
      pas, <code class="command">make</code> exécute alors cette commande pour
      le créer. En d'autres termes, il s'agit de la règle permettant
      à make de re-compiler <code class="filename">foo.c</code>.
      </p><p>Aussi, quand vous tapez <strong class="userinput"><code>make</code></strong>, il vérifiera
      que <code class="filename">foo</code> est à jour en respect de vos derniers
      changements sur <code class="filename">foo.c</code>. Ce principe peut être
      étendu à des <code class="filename">Makefile</code>s de plusieurs
      centaines de cibles&#8212;en fait, sur FreeBSD, il est possible de
      compiler un système d'exploitation entier en tapant juste
      <strong class="userinput"><code>make world</code></strong> dans le répertoire approprié !
      </p><p>Une autre propriété utile des makefiles est que les cibles
      n'ont pas nécessairement besoin d'être des programmes.
      Par exemple, nous pourrions avoir un <code class="filename">Makefile</code>
      qui ressemble à cela:
      </p><pre class="programlisting">foo: foo.c
	cc -o foo foo.c

install:
	cp foo /home/moi</pre><p>Nous pouvons dire à <code class="command">make</code> quelle cible nous
      voulons en tapant:
      </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>make cible</code></strong>
      </pre><p><code class="command">make</code> ira seulement voir cette cible
      et ingorera les autres. Par exemple, si nous tapons
      <strong class="userinput"><code>make foo</code></strong> avec le <code class="filename">Makefile</code> du dessus,
      <code class="command">make</code> ignorera la cible <span class="phrase">install</span>.
      </p><p>Si nous tapons juste <strong class="userinput"><code>make</code></strong>,
      <code class="command">make</code> regardera toujours la première cible et s'arrêtera
      sans regarder aucune autre. Aussi, si nous avions tapé <strong class="userinput"><code>make</code></strong>
      seul, <code class="command">make</code> serait juste allé à la cible <span class="phrase">foo</span>,
      aurait recompilé <code class="filename">foo</code> si nécessaire et se
      serait arrêté sans aller à la cible <span class="phrase">install</span>.
      </p><p>Notez que la cible <span class="phrase">install</span> ne dépend pour l'instant
      de rien ! Cela signifie que la commande qui suit est toujours exécutée
      lorsque nous essayons de créer cette cible en tapant <strong class="userinput"><code>make install</code></strong>.
      Dans ce cas, <code class="command">make</code> va copier <code class="filename">foo</code> dans le
      répertoire de l'utilisateur. Cela est souvent utilisé par les
      <code class="filename">Makefile</code>s des applications, ainsi l'application
      peut être installée dans le répertoire correct
      quand elle a été correctement compilée
      </p><p>Il s'agit d'un sujet légèrement embrouillant à essayer
      et expliquer.
      Si vous ne comprenez pas bien comment <code class="command">make</code>
      fonctionne, la meilleure chose à faire est d'écrire un petit
      programme comme <span class="quote">« <span class="quote">bonjour monde</span> »</span> et un fichier <code class="filename">Makefile</code>
      comme le précédent et de le tester. Ensuite continuez en
      utilisant plus d'un fichier source ou en ayant un fichier source
      incluant un fichier d'en-tête. La commande <code class="command">touch</code> est
      très utile ici&#8212;elle change la date sur un fichier sans avoir
      à l'éditer.
      </p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp62721744"></a>5.5.3. Les <code class="filename">Makefiles</code>de FreeBSD</h3></div></div></div><p>Les <code class="filename">Makefile</code>s peuvent être plutôt compliqués
      à écrire. Heureusement, les systèmes BSD comme FreeBSD sont fournis avec
      des fichiers très puissants comme partie intégrante du système.
      Un très bon exemple est le système des logiciels portés. Voici
      la partie essentielle d'un <code class="filename">Makefile</code> typique des logiciels portés:
      </p><pre class="programlisting">MASTER_SITES=   ftp://freefall.cdrom.com/pub/FreeBSD/LOCAL_PORTS/
DISTFILES=      scheme-microcode+dist-7.3-freebsd.tgz

.include &lt;bsd.port.mk&gt;</pre><p>Maintenant, si nous allons dans le répertoire de ce logiciel porté et
      tapons <strong class="userinput"><code>make</code></strong>, la chose suivante se passe :
      </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Une vérification est faite pour voir si le code source de ce logiciel porté
	  est déjà dans le système.
	  </p></li><li class="step"><p>Si celui-ci n'y est pas, une connexion FTP à l'URL dans
	  <span class="symbol">MASTER_SITES</span> est faite pour télécharger le source.
	  </p></li><li class="step"><p>La somme de contrôle (<code class="literal">checksum</code>) du source est calculée
	  et comparée avec celle d'une bonne et connue copie du source. Cela est fait pour
	  être sûr que le source n'a pas été corrompu pendant le transfert.
	  </p></li><li class="step"><p>Tout changement requis pour faire fonctionner le source sur FreeBSD est appliqué&#8212;
	  cela est connu sous le nom de <em class="firstterm">correctif</em><a href="#ftn.idp62743760" class="footnote" id="idp62743760"><sup class="footnote">[8]</sup></a>.
	  </p></li><li class="step"><p>Toute configuration spéciale nécessaire pour le source est faite.
	  (Beaucoup de distributions de programmes Unix essaye de fonctionner quelle que soit
	  la version d'Unix sur laquelle elles sont compilées et quelles que soient les
	  caractéristiques optionnelles qui sont présentes&#8212;c'est ce qui se trouve
	  dans le scénario des logiciels portés pour FreeBSD).
	  </p></li><li class="step"><p>Le code source pour ce programme est compilé. En effet, nous changeons
	  de répertoire pour le répertoire où le source a été
	  décompressé et faisons <code class="command">make</code>&#8212;le fichier <code class="filename">Makefile</code>
	  du programme contient les informations nécessaires pour construire le programme.
	  </p></li><li class="step"><p>Nous avons maintenant une version compilée du programme. Si nous le désirons,
	  nous pouvons le tester maintenant; quand nous sommes confiant dans le programme, nous pouvons
	  taper <strong class="userinput"><code>make install</code></strong>. Cela va installer le programme et ses fichiers de
	  soutien nécessaires au bon endroit; une entrée est aussi créée dans
	  la <span class="database">base de données des logiciels pré-compilés</span>, ainsi
	  le logiciel porté peut être facilement désinstallé plus tard si
	  nous changeons d'avis sur ce programme.
	  </p></li></ol></div><p>Maintenant je pense que vous serez d'accord que c'est plus impressionnant qu'une
      procédure de quatre lignes !
      </p><p>Le secret réside dans la dernière ligne qui dit à
      <code class="command">make</code> de regarder dans le <code class="filename">Makefile</code> système
      appelé <code class="filename">bsd.port.mk</code>. Il est facile de fermer les yeux sur cette
      ligne mais c'est ici que tous les trucs forts se passent&#8212;quelqu'un a écrit un <code class="filename">Makefile</code>
      qui dit à <code class="command">make</code> de faire tout ce qu'il y a au-dessus (plus un couple d'autres choses
      que je n'ai pas mentionnées, comme la gestion des erreurs) et n'importe qui peut avoir accès
      à cela simplement est ajoutant une simple ligne dans son propre fichier <code class="filename">Makefile</code> !
      </p><p>Si vous voulez jeter un regard sur ces <code class="filename">Makefile</code>s système,
      ils se trouvent <code class="filename">/usr/share/mk</code> mais il est probablement mieux
      d'attendre un moment jusqu'à ce que vous ayez un peu d'entrainement avec les
      <code class="filename">Makefile</code>s car ceux-ci sont très compliqués (et
      si vous les lisez, soyez sûr d'avoir un thermos de café fort à portée
      de main !)
      </p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp62777808"></a>5.5.4. Utilisations plus avancées de <code class="command">make</code></h3></div></div></div><p><code class="command">Make</code> est un outil très puissant et peut
      faire beaucoup plus que le simple exemple précédent ne l'a montré.
      Malheureusement, il y a différentes versions de <code class="command">make</code>
      et elles diffèrent considérablement.
      Le meilleur moyen d'apprendre ce qu'elles peuvent faire est probablement de lire
      la documentation&#8212;heureusement cette introduction vous donnera la base
      à partir de laquelle vous pourrez faire cela.
      </p><p>La version de <code class="command">make</code> fournies avec FreeBSD est le
      <span class="application">Berkeley make</span>(make de Berkeley); il y a un cours d'instruction
      pour celui-ci dans <code class="filename">/usr/share/doc/psd/12.make</code>. Pour le voir, faites
      </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>zmore paper.ascii.gz</code></strong>
      </pre><p>dans ce répertoire.</p><p>Beaucoup d'applications dans les logiciels portés utilisent
      <span class="application">GNU make</span>, qui possède un très bon ensemble de page
      d'<span class="quote">« <span class="quote">info</span> »</span>. Si vous avez installé un de ces logiciels portés,
      <span class="application">GNU make</span> aura été automatiquement installé
      sous le nom de <code class="command">gmake</code>. Il est aussi disponible comme logiciel porté ou
      logiciel pré-compilé seul.
      </p><p>Pour voir les pages d'info pour <span class="application">GNU make</span>, vous devrez
      editer le fichier <code class="filename">dir</code> dans le répertoire
      <code class="filename">/usr/local/info</code> pour ajouter une entrée pour celui-ci.
      Cela implique d'ajouter une ligne
      </p><pre class="programlisting"> * Make: (make).                 l'utilitaire GNU Make.</pre><p>au fichier. Une fois que vous avez fait ceci, vous pouvez taper
	<strong class="userinput"><code>info</code></strong> et ensuite sélectionner
	<span class="guimenuitem">make</span> dans le menu (ou dans <span class="application">Emacs</span>,
	faites <strong class="userinput"><code>C-h i</code></strong>).
      </p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="debugging"></a>5.6. Déverminer</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp62822352"></a>5.6.1. Le dévermineur</h3></div></div></div><p>Le dévermineur fourni avec FreeBSD est appelé
      <code class="command">gdb</code> (<span class="application">GNU
	  debugger</span>). Vous pouvez le démarrer en tapant
      </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>gdb nomprog</code></strong>
      </pre><p>bien que la plupart des gens préfèrent le démarrer au
      sein d'<span class="application">Emacs</span>. Vous pouvez faire cela avec:
      </p><pre class="screen"><strong class="userinput"><code>M-x gdb RET nomprog RET</code></strong>
      </pre><p>Utiliser un dévermineur vous permet d'exécuter le programme
      dans des circonstances plus contrôlées. Typiquement, vous pouvez
      exécuter le programme ligne à ligne, inspecter la valeur des
      variables, changer cette dernière, dire au dévermineur d'exécuter jusqu'à
      un certain point puis de s'arrêter etc... Vous pouvez même vous brancher
      sur un programme en fonctionnement, ou charger un fichier <code class="filename">core</code>
      pour enquêter sur le plantage du programme. Il est même possible de
      déverminer le noyau, quoique ce soit un peu plus rusé que de
      déverminer des applications utilisateur dont nous discuterons
      dans cette section.
      </p><p><code class="command">gdb</code> dispose d'une assez bonne aide en ligne
      comme d'un ensemble de pages d'info, aussi cette section va se concentrer sur
      quelques commandes basiques.
      </p><p>Finalement, si vous trouvez son interface texte non fonctionnelle,
      il y a une interface graphique pour celui-ci, <a class="link" href="../../ports/devel.html" target="_top">xxgdb</a>,
      dans la collection des logiciels portés.
      </p><p>Cette section a pour but d'être une introduction
      à l'utilisation de <code class="command">gdb</code> et ne couvre pas les sujets
      très spécialisés comme le déverminage du noyau.
      </p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp62850384"></a>5.6.2. Exécuter un programme dans le dévermineur</h3></div></div></div><p>Vous devrez avoir compilé le programme avec l'option	<code class="option">-g</code>
      pour avoir la meilleure utilisation de <code class="command">gdb</code>. Il fonctionnera sans
      mais vous ne verrez que le nom de la fonction dans laquelle vous vous trouvez plutôt
      que son code source. Si vous voyez une ligne comme:
      </p><pre class="screen">&#8230; (no debugging symbols found) &#8230;
      </pre><p>quand <code class="command">gdb</code> démarre, vous saurez que le programme
      n'a pas été compilé avec l'option <code class="option">-g</code>.
      </p><p>A l'invite de <code class="command">gdb</code>, tapez
      <strong class="userinput"><code>break main</code></strong>. Cela dira au dévermineur
      de passer le code préliminaire d'initialisation du programme
      et de démarrer au début de votre code. Maintenant tapez
      <strong class="userinput"><code>run</code></strong> pour démarrer le programme&#8212;cela va
      démarrer au début du code d'initialisation et ensuite s'arrêtera
      lors de l'appel à <code class="function">main()</code>.
      (Si vous vous êtes toujours demandé où <code class="function">main()</code>
      était appelé, maintenant vous le savez !).
      </p><p>Vous pouvez maintenant vous déplacer dans le programme ligne par ligne en
      pressant <code class="command">n</code>. Si vous arrivez à l'appel d'une fonction,
      vous pouvez entrer dans celle-ci en appuyant sur <code class="command">s</code>. Une fois
      que vous êtes dans l'appel de la fonction, vous pouvez retourner dans le code
      appelant en appuyant sur <code class="command">f</code>. Vous pouvez aussi utiliser
      <code class="command">up</code> et <code class="command">down</code> pour avoir une vue rapide de l'appelant.
      </p><p>Voici un exemple simple de comment détecter une erreur dans un programme avec
      <code class="command">gdb</code>. Voici notre programme (avec une erreur délibérée):
      </p><pre class="programlisting">#include &lt;stdio.h&gt;

int bazz(int anint);

main() {
	int i;

	printf("C'est mon programme\n");
	bazz(i);
	return 0;
}

int bazz(int anint) {
	printf("Vous m'avez fourni %d\n", anint);
	return anint;
}</pre><p>Le programme met <span class="symbol">i</span> à <code class="literal">5</code> et le passe à une
      fonction <code class="function">bazz()</code> qui imprime le nombre que nous lui avons donné.
      </p><p>Puis nous compilons et exécutons le programme obtenu
      </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cc -g -o temp temp.c</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>./temp</code></strong>
C'est mon programme
Vous m'avez fourni 4231
      </pre><p>Ce n'était pas ce que nous attendions ! Il est temps de voir ce qui se passe !
      </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>gdb temp</code></strong>
GDB is free software and you are welcome to distribute copies of it
 under certain conditions; type "show copying" to see the conditions.
There is absolutely no warranty for GDB; type "show warranty" for details.
GDB 4.13 (i386-unknown-freebsd), Copyright 1994 Free Software Foundation, Inc.
(gdb) <strong class="userinput"><code>break main</code></strong>				<em class="lineannotation"><span class="lineannotation">passe le code d'initialisation</span></em>
Breakpoint 1 at 0x160f: file temp.c, line 9.	<em class="lineannotation"><span class="lineannotation">gdb met un point d'arrêt sur main()</span></em>
(gdb) <strong class="userinput"><code>run</code></strong>					<em class="lineannotation"><span class="lineannotation">Exécute jusqu'à main()</span></em>
Starting program: /home/james/tmp/temp		<em class="lineannotation"><span class="lineannotation">Le programme démarre</span></em>

Breakpoint 1, main () at temp.c:9		<em class="lineannotation"><span class="lineannotation">gdb s'arrête à main()</span></em>
(gdb) <strong class="userinput"><code>n</code></strong>						<em class="lineannotation"><span class="lineannotation">Va à la ligne suivante</span></em>
C'est mon programme				<em class="lineannotation"><span class="lineannotation">Le programme écrit</span></em>
(gdb) <strong class="userinput"><code>s</code></strong>						<em class="lineannotation"><span class="lineannotation">entre dans bazz()</span></em>
bazz (anint=4231) at temp.c:17			<em class="lineannotation"><span class="lineannotation">gdb montre la pile</span></em>
(gdb)
      </pre><p>Arrêtons-nous une minute! Comment <span class="symbol">anint</span> a eu la valeur
      <code class="literal">4231</code>? Ne l'avons-nous pas mis à <code class="literal">5</code>
      dans <code class="function">main()</code>? Remontons dans <code class="function">main()</code>
      et regardons.
      </p><pre class="screen">(gdb) <strong class="userinput"><code>up</code></strong>					<em class="lineannotation"><span class="lineannotation">Remonte la pile des appels</span></em>
#1  0x1625 in main () at temp.c:11		<em class="lineannotation"><span class="lineannotation">gdb montre la pile</span></em>
(gdb) <strong class="userinput"><code>p i</code></strong>					<em class="lineannotation"><span class="lineannotation">Montre la valeur de i</span></em>
$1 = 4231					<em class="lineannotation"><span class="lineannotation">gdb montre 4231</span></em>
      </pre><p>Oh ! En regardant dans le code, nous avons oublié d'initialiser <span class="symbol">i</span>.
      Nous aurions dû mettre
      </p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&#8230;</span></em>
main() {
	int i;

	i = 5;
	printf("C'est mon programme\n");
<em class="lineannotation"><span class="lineannotation">&#8230;</span></em></pre><p>mais nous n'avions pas mis la ligne <code class="literal">i=5;</code>. Comme
      nous n'avons pas initialisé <span class="symbol">i</span>, il a pris le nombre se trouvant
      dans la zone de mémoire quand le programme a démarré,
      ce qui dans ce cas était <code class="literal">4231</code>.
      </p><div xmlns="" class="note"><h3 class="admontitle">Note: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="command">gdb</code> montre la pile chaque fois que nous entrons ou sortons
	d'une fonction, même si nous avons utilisé	<code class="command">up</code> et
	<code class="command">down</code> pour nous déplacer dans la pile des appels.
	Cela montre le nom de la fonction et les valeurs de ses arguments, ce qui nous aide
	à garder une trace d'où nous sommes et de ce qui se passe.
	(La pile est une zone de stockage où le programme stocke les informations
	sur les arguments passés aux fonctions et où il doit aller
	quand il revient d'une fonction).
	</p></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp62955984"></a>5.6.3. Examiner un fichier <code class="filename">core</code></h3></div></div></div><p>Un fichier <code class="filename">core</code> est basiquement un fichier qui contient
      l'état complet du processus quand il s'est planté.
      Dans <span class="quote">« <span class="quote">le bon vieux temps</span> »</span>, les programmeurs devait imprimer des
      listings en hexadécimal de fichiers <code class="filename">core</code> et transpirer
      sur leur manuels de code machine, mais la vie est maintenant un peu plus facile.
      Par chance, sous FreeBSD et les autres systèmes 4.4BSD, un fichier <code class="filename">core</code>
      est appelé <code class="filename">nomprog.core</code>
      plutôt que juste <code class="filename">core</code>, pour mieux savoir à quel
      programme appartient un fichier <code class="filename">core</code>.
      </p><p>Pour examiner un fichier <code class="filename">core</code>, démarrez <code class="command">gdb</code>
      de façon habituel. Plutôt que de taper <code class="command">break</code> ou
      <code class="command">run</code>, tapez
      </p><pre class="screen">(gdb) <strong class="userinput"><code>core nomprog.core</code></strong>
      </pre><p>Si vous n'êtes pas dans le même répertoire que le fichier
      <code class="filename">core</code>, vous devrez faire <strong class="userinput"><code>dir /path/to/core/file</code></strong>
      d'abord.
      </p><p>Vous devriez voir quelque chose comme cela:
      </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>gdb a.out</code></strong>
GDB is free software and you are welcome to distribute copies of it
 under certain conditions; type "show copying" to see the conditions.
There is absolutely no warranty for GDB; type "show warranty" for details.
GDB 4.13 (i386-unknown-freebsd), Copyright 1994 Free Software Foundation, Inc.
(gdb) <strong class="userinput"><code>core a.out.core</code></strong>
Core was generated by `a.out'.
Program terminated with signal 11, Segmentation fault.
Cannot access memory at address 0x7020796d.
#0  0x164a in bazz (anint=0x5) at temp.c:17
(gdb)
      </pre><p>Dans ce cas, le programme a été appelé	<code class="filename">a.out</code>,
      aussi le fichier <code class="filename">core</code> s'appelle <code class="filename">a.out.core</code>.
      Nous pouvons voir que le programme s'est planté car il a essayé
      d'accèder à une zone dans la mémoire qui n'était pas
      disponible dans la fonction appelée <code class="function">bazz</code>.
      </p><p>Quelquefois il est utile de pouvoir voir comment une fonction a été
      appelée car le problème peut avoir eu lieu bien avant
      dans la pile des appels dans un programme complexe. La commande <code class="command">bt</code>
      demande à <code class="command">gdb</code> d'afficher une trace inverse de la pile
      des appels:
      </p><pre class="screen">(gdb) <strong class="userinput"><code>bt</code></strong>
#0  0x164a in bazz (anint=0x5) at temp.c:17
#1  0xefbfd888 in end ()
#2  0x162c in main () at temp.c:11
(gdb)
      </pre><p>La fonction <code class="function">end()</code> est appelée lorsque le programme se plante;
      dans ce cas, la fonction <code class="function">bazz()</code> a été appelée
      <code class="function">main()</code>.
      </p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63021136"></a>5.6.4. Se brancher sur un programme en cours d'exécution</h3></div></div></div><p>Une des plus belles caractéristiques de <code class="command">gdb</code>
      est qu'il peut se brancher sur un programme qui s'exécute déjà.
      Bien sûr, cela suppose que vous ayez les privilèges suffisants pour
      le faire. Un problème habituel est quand vous vous déplacez dans
      un programme qui se dédouble et que vous voulez tracer le programme fils
      cependant le dévermineur ne vous laissera seulement tracer le père.
      </p><p>Ce que vous devez faire est de démarrer un autre <code class="command">gdb</code>,
      utiliser <code class="command">ps</code> pour trouver l'ID du processus fils et faire
      </p><pre class="screen">(gdb) <strong class="userinput"><code>attach identifiant_processus</code></strong>
      </pre><p>dans <code class="command">gdb</code>, et déverminer ensuite comme d'habitude.
      </p><p><span class="quote">« <span class="quote">C'est tout simple,</span> »</span> pensez-vous certainement,<span class="quote">« <span class="quote">
      mais pendant le temps que je faisais ça, le processus fils
      sera déjà parti loin</span> »</span>. Ne vous en faites pas,
      noble lecteur, voici comment faire (avec l'appui des pages d'info
      de <code class="command">gdb</code>):
      </p><pre class="screen"><em class="lineannotation"><span class="lineannotation">&#8230;</span></em>
if ((pid = fork()) &lt; 0)		/* _Toujours_ verifier cela */
	error();
else if (pid == 0) {		/* le fils */
	int PauseMode = 1;

	while (PauseMode)
		sleep(10);	/* Attendre jusqu'a ce que quelqu'un se brache sur nous */
	<em class="lineannotation"><span class="lineannotation">&#8230;</span></em>
} else {			/* le pere */
	<em class="lineannotation"><span class="lineannotation">&#8230;</span></em>
      </pre><p>Maintenant tout ce que nous avons à faire est de nous brancher sur le processus fils,
      de mettre <span class="symbol">PauseMode</span> à <code class="literal">0</code> et d'attendre
      que l'appel à la fonction <code class="function">sleep()</code> retourne !
      </p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="emacs"></a>5.7. Utiliser Emacs comme environnement de développement</h2></div></div></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63055440"></a>5.7.1. Emacs</h3></div></div></div><p>Malheureusement, les systèmes Unix ne sont pas fournis avec des sortes
      d'environnements de développement intégrés
      tout-ce-que-vous-avez-toujours-voulu-et-beaucoup-plus-dans-un-ensemble-gigantesque
      que d'autres sytèmes ont.

	<a href="#ftn.idp63058000" class="footnote" id="idp63058000"><sup class="footnote">[9]</sup></a>

	Toutefois, il est possible de se faire son propre environnement.
	Cela n'est pas forcément aussi joli et il peut ne pas être
	autant intégré mais vous pouvez le personnaliser comme
	vous voulez. Et c'est gratuit. Et vous en avez les sources.
	</p><p>La clé de tout cela est Emacs. Maintenant il y a des gens qui le détestent,
      mais beaucoup l'aiment. Si vous êtes un du premier groupe, j'ai peur que cette section
      ait peu d'intérêt pour vous. Vous aurez besoin d'une quantité
      moyenne de mémoire pour le faire fonctionner&#8212;Je recommenderai 8Mo en mode
      texte et 16Mo dans X pour avoir un minimum de performances.
      </p><p>Emacs est basiquement un éditeur hautement personnalisable
      &#8212;en effet, il a été personnalisé au point de ressembler
      plus à un système d'exploitation qu'à un éditeur!
      Beaucoup de développeurs et d'administrateurs système passent
      en fait pratiquement tout leur temps à travailler dans Emacs,
      en ne le quittant qu'à leur déconnexion.
      </p><p>Il est impossible de dire tout ce qu'Emacs peut faire ici,
      mais voici quelques unes des caractéristiques d'intérêt
      pour les développeurs:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Un très puissant éditeur, permettant le chercher-remplacer sur
	  les chaînes et les expressions régulières (motifs),
	  sauter à la fin ou au début d'un bloc, etc, etc.
	  </p></li><li class="listitem"><p>Menus déroulants et aide en ligne.
	  </p></li><li class="listitem"><p>Colorisation syntaxique en fonction du langage et indentation.
	  </p></li><li class="listitem"><p>Totalement personnalisable.
	  </p></li><li class="listitem"><p>Vous pouvez compiler et déverminer des programmes dans Emacs.
	  </p></li><li class="listitem"><p>Sur erreur de compilation, vous pouvez aller directement
	  à la ligne de code source fautive.
	  </p></li><li class="listitem"><p>Une interface amicale au programme <code class="command">info</code>
	  utilisé pour lire la documentation hypertexte GNU,
	  incluant la documentation sur Emacs elle-même.
	  </p></li><li class="listitem"><p>Une interface agréable à <code class="command">gdb</code>, vous permettant
	  de voir le code source au fur et à mesure que vous vous déplacez
	  dans votre programme.
	  </p></li><li class="listitem"><p>Vous pouvez lire les nouvelles Usenet et envoyer des e-mails pendant que
	  votre programme est en compilation.
	  </p></li></ul></div><p>Et sans doute beaucoup plus que je n'ai survolé.
      </p><p>Emacs peut être installé sur FreeBSD en utilisant Emacs
      <a class="link" href="../../ports/editors.html" target="_top">le logiciel porté Emacs</a>.
      </p><p>Une fois installé, démarrez-le et faites <strong class="userinput"><code>C-h t</code></strong>
      pour lire un cours sur Emacs&#8212;cela signifie maintenir la touche <span class="keycap"><strong>control</strong></span>,
      presser <span class="keycap"><strong>h</strong></span>, relâcher la touche <span class="keycap"><strong>control</strong></span>
      et presser <span class="keycap"><strong>t</strong></span>. (Alternativement, vous pouvez utiliser la souris
      pour sélectionner <span class="guimenuitem">Emacs Tutorial</span> dans le menu
      <span class="guimenu">Help</span>).
      </p><p>Bien que Emacs possède des menus, il est valable d'apprendre les raccourcis
      clavier, étant plus rapide quand vous éditez quelque chose
      d'appuyer sur un couple de touches que de reprendre la souris et de cliquer
      au bon endroit. Et, quand vous discutez avec des utilisateurs expérimentés
      d'Emacs, vous trouverez qu'ils parlent souvent de choses comme
      <span class="quote">« <span class="quote"><code class="literal">M-x replace-s RET foo RET bar RET</code></span> »</span> aussi il est utile
      de savoir ce que cela veut dire. Et dans tous les cas, Emacs possède beaucoup trop
      de fonctions pour qu'elles soient dans les barres de menus.
      </p><p>Heureusement, il est assez simple de récupérer les raccourcis
      clavier car ils sont affichés à côté des éléments
      des menus déroulants. Mon conseil est d'utiliser un élément de menu
      pour, disons, ouvrir un fichier jusqu'à ce que vous sachiez comment cela fonctionne
      et que quand vous vous sentez à l'aise avec, essayez <strong class="userinput"><code>C-x C-f</code></strong>.
      Quand vous serez content avec ça, passez à une autre commande du menu.
      </p><p>Si vous ne pouvez pas vous rappeler de ce qu'une combinaison de touches particulières
      fait, sélectionnez <span class="guimenuitem">Describe Key</span> dans le menu
      <span class="guimenu">Help</span> et tapez-la&#8212;Emacs vous dira ce qu'elle fait.
      Vous pouvez aussi utiliser l'élément de menu <span class="guimenuitem">Command Apropos</span>
      pour trouver toutes les commandes qui contiennent un mot particulier, avec leur
      raccourci clavier.
      </p><p>De cette manière, l'expression ci-dessus signifie maintenir la touche
      <span class="keysym">Meta</span>, taper <span class="keysym">x</span>, relâcher
      la touche <span class="keysym">Meta</span>, taper <strong class="userinput"><code>replace-s</code></strong>
      (raccourci pour <code class="literal">replace-string</code>&#8212;
      une autre caractéristique d'Emacs est que vous pouvez abréger
      les commandes), appuyer sur la touche <span class="keysym">Entrée</span>, taper
      <strong class="userinput"><code>foo</code></strong> (la chaîne que vous voulez remplacer), presser
      la touche <span class="keysym">Entrée</span>, taper <strong class="userinput"><code>bar</code></strong> (la chaîne
      que vous voulez substituer à <code class="literal">foo</code>) puis appuyer sur
      <span class="keysym">Entrée</span> une dernière fois. Emacs va alors faire
      l'opération chercher-remplacer que vous avez demandé.
      </p><p>Si vous vous demandez ce qu'est cette touche <span class="keysym">Meta</span>,
      il s'agit d'une touche spéciale que beaucoup de stations de travail Unix
      possèdent. Malheureusement, les PC n'en ont pas, aussi c'est habituellement
      la touche <span class="keycap"><strong>alt</strong></span> (ou si vous n'avez pas de chance, la touche <span class="keysym">échap</span>).
      </p><p>Oh, et pour sortir d'Emacs, faites <code class="command">C-x C-c</code>
      (ce qui signifie maintenir la touche <span class="keysym">control</span> appuyée,
      appuyer <span class="keysym">c</span> et relâcher la touche <span class="keysym">control</span>.
      Si vous avez des fichiers non sauvegardés ouverts, Emacs vous demandera si
      vous voulez les sauvegarder. (Ignorez le bout de documentation où il est dit
      que <code class="command">C-z</code> est la manière habituelle de quitter Emacs&#8212;
      qui quitte Emacs en le laissant tourner en tâche de fond et qui n'est
      vraiment utile que si vous avez un système sans terminal virtuel).
      </p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63129808"></a>5.7.2. Configurer Emacs</h3></div></div></div><p>Emacs fait des choses merveilleuses; une partie est intégrée
      directement, une autre doit être configurée.
      </p><p>Plutôt que d'utiliser un macro langage propriétaire pour la configuration,
      Emacs utilise une version du Lisp spécialement adaptée pour les
      éditeurs, connue sous le nom d'Emacs Lisp. Celui-ci peut être assez utile si
      vous voulez poursuivre et apprendre quelque chose comme le Common Lisp,
      car il est considérablement plus petit que le Common Lisp (bien que
      déjà assez gros!).
      </p><p>La meilleure façon d'apprendre l'Emacs Lisp est de télécharger
      le <a class="link" href="ftp://prep.ai.mit.edu:pub/gnu/elisp-manual-19-2.4.tar.gz" target="_top">cours d'Emacs</a>
      </p><p>Toutefois, il n'y a pas besoin de connaître le Lisp pour commencer
      la configuration d'Emacs, car j'ai inclus un exemple de fichier <code class="filename">.emacs</code>
      qui devrait être suffisant pour commencer. Copiez juste celui-ci dans votre
      répertoire utilisateur et redémarrez Emacs si celui-ci s'exécute,
      il lira les commandes du fichier et (si tout va bien!) vous donnera une configuration
      basique utile.
      </p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63146320"></a>5.7.3. Un fichier exemple <code class="filename">.emacs</code></h3></div></div></div><p>Malheureusement, il y a beaucoup trop de choses ici pour les expliquer en détail;
      toutefois, il y a un ou deux points qui valent d'être mentionnés.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Tout ce qui commence avec un <code class="literal">;</code> est un commentaire et est
	  ignoré par Emacs.
	  </p></li><li class="listitem"><p>A la première ligne, le <code class="literal">-*- Emacs-Lisp -*-</code>
	  est tel que vous pouvez éditer le fichier <code class="filename">.emacs</code> lui-même
	  à l'intérieur d'Emacs et d'obtenir tous les fantaisistes dispositifs
	  pour l'édition en Emacs Lisp. Emacs essaye habituellement de deviner cela
	  en se basant sur le nom du fichier, et ne trouvera peut-être pas pour
	  <code class="filename">.emacs</code>.
	  </p></li><li class="listitem"><p>La touche <span class="keysym">tab</span> est liée à la fonction d'indentation
	  dans certains modes, aussi quand vous l'enfoncez, cela va indenter la ligne courante
	  de code. Si vous voulez mettre un caractère <span class="token">tab</span> dans quoique ce soit
	  que vous tapiez, maintenez la touche <span class="keysym">control</span> enfoncée pendant
	  que vous appuyez sur <span class="keysym">tab</span>.
	  </p></li><li class="listitem"><p>Ce fichier supporte la colorisation de syntaxe pour les langages C, C++, Perl, Lisp
	  et Scheme en devinant le langage par leur nom.
	  </p></li><li class="listitem"><p>Emacs possède déjà une fonction pré-définie
	  appelée <code class="function">next-error</code>.  Dans la fenêtre de sortie d'une
	  compilation, cela vous permet de vous déplacer d'une erreur de compilation
	  à la suivante en faisant <code class="command">M-n</code>; nous définissons une
	  fonction complémentaire <code class="function">previous-error</code>, qui vous permet
	  d'aller à l'erreur précédente en faisant <code class="command">M-p</code>.
	  Le plus beau dispositif de tous est que <code class="command">C-c C-c</code>
	  va ouvrir le fichier source dans lequel l'erreur a eu lieu et sautera à la ligne
	  appropriée.
	  </p></li><li class="listitem"><p>Nous autorisons la capacité d'Emacs à agir comme un serveur
	  ainsi si vous faites quelque chose en dehors d'Emacs et voulez éditer un
	  fichier, tapez juste
	  </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>emacsclient nomfichier</code></strong>
	  </pre><p>et alors vous pouvez éditer le fichier dans votre Emacs!
	  <a href="#ftn.idp63183568" class="footnote" id="idp63183568"><sup class="footnote">[10]</sup></a>
	  </p></li></ul></div><div class="example"><a id="idp63187664"></a><div class="example-title">Exemple 5.1. Un fichier exemple <code class="filename">.emacs</code></div><div class="example-contents"><pre class="programlisting">;; -*-Emacs-Lisp-*-

;; Ce fichier est concu pour etre reevalue, utiliser la variable first-time
;; pour eviter tout probleme.
(defvar first-time t
  "Valeur signifiant que c'est la premiere fois que .emacs a ete evalue"
  )

;; Meta
(global-set-key "\M- " 'set-mark-command)
(global-set-key "\M-\C-h" 'backward-kill-word)
(global-set-key "\M-\C-r" 'query-replace)
(global-set-key "\M-r" 'replace-string)
(global-set-key "\M-g" 'goto-line)
(global-set-key "\M-h" 'help-command)

;; Function keys
(global-set-key [f1] 'manual-entry)
(global-set-key [f2] 'info)
(global-set-key [f3] 'repeat-complex-command)
(global-set-key [f4] 'advertised-undo)
(global-set-key [f5] 'eval-current-buffer)
(global-set-key [f6] 'buffer-menu)
(global-set-key [f7] 'other-window)
(global-set-key [f8] 'find-file)
(global-set-key [f9] 'save-buffer)
(global-set-key [f10] 'next-error)
(global-set-key [f11] 'compile)
(global-set-key [f12] 'grep)
(global-set-key [C-f1] 'compile)
(global-set-key [C-f2] 'grep)
(global-set-key [C-f3] 'next-error)
(global-set-key [C-f4] 'previous-error)
(global-set-key [C-f5] 'display-faces)
(global-set-key [C-f8] 'dired)
(global-set-key [C-f10] 'kill-compilation)

;; Keypad bindings
(global-set-key [up] "\C-p")
(global-set-key [down] "\C-n")
(global-set-key [left] "\C-b")
(global-set-key [right] "\C-f")
(global-set-key [home] "\C-a")
(global-set-key [end] "\C-e")
(global-set-key [prior] "\M-v")
(global-set-key [next] "\C-v")
(global-set-key [C-up] "\M-\C-b")
(global-set-key [C-down] "\M-\C-f")
(global-set-key [C-left] "\M-b")
(global-set-key [C-right] "\M-f")
(global-set-key [C-home] "\M-&lt;")
(global-set-key [C-end] "\M-&gt;")
(global-set-key [C-prior] "\M-&lt;")
(global-set-key [C-next] "\M-&gt;")

;; Souris
(global-set-key [mouse-3] 'imenu)

;; Divers
(global-set-key [C-tab] "\C-q\t")	; Control tab quotes a tab.
(setq backup-by-copying-when-mismatch t)

;; Traite 'y' ou &lt;CR&gt; comme yes, 'n' comme no.
(fset 'yes-or-no-p 'y-or-n-p)
    (define-key query-replace-map [return] 'act)
    (define-key query-replace-map [?\C-m] 'act)

;; Charge les ajouts
(require 'desktop)
(require 'tar-mode)

;; Diff mode sympa
(autoload 'ediff-buffers "ediff" "Intelligent Emacs interface to diff" t)
(autoload 'ediff-files "ediff" "Intelligent Emacs interface to diff" t)
(autoload 'ediff-files-remote "ediff"
  "Intelligent Emacs interface to diff")

(if first-time
    (setq auto-mode-alist
	  (append '(("\\.cpp$" . c++-mode)
		    ("\\.hpp$" . c++-mode)
                    ("\\.lsp$" . lisp-mode)
		    ("\\.scm$" . scheme-mode)
		    ("\\.pl$" . perl-mode)
		    ) auto-mode-alist)))

;; Mode de verrouillage automatique de la police de caracteres
(defvar font-lock-auto-mode-list
  (list 'c-mode 'c++-mode 'c++-c-mode 'emacs-lisp-mode 'lisp-mode 'perl-mode 'scheme-mode)
  "List of modes to always start in font-lock-mode")

(defvar font-lock-mode-keyword-alist
  '((c++-c-mode . c-font-lock-keywords)
    (perl-mode . perl-font-lock-keywords))
  "Associations between modes and keywords")

(defun font-lock-auto-mode-select ()
  "Automatically select font-lock-mode if the current major mode is
in font-lock-auto-mode-list"
  (if (memq major-mode font-lock-auto-mode-list)
      (progn
	(font-lock-mode t))
    )
  )

(global-set-key [M-f1] 'font-lock-fontify-buffer)

;; New dabbrev stuff
;(require 'new-dabbrev)
(setq dabbrev-always-check-other-buffers t)
(setq dabbrev-abbrev-char-regexp "\\sw\\|\\s_")
(add-hook 'emacs-lisp-mode-hook
	  '(lambda ()
	     (set (make-local-variable 'dabbrev-case-fold-search) nil)
	     (set (make-local-variable 'dabbrev-case-replace) nil)))
(add-hook 'c-mode-hook
	  '(lambda ()
	     (set (make-local-variable 'dabbrev-case-fold-search) nil)
	     (set (make-local-variable 'dabbrev-case-replace) nil)))
(add-hook 'text-mode-hook
	  '(lambda ()
	     (set (make-local-variable 'dabbrev-case-fold-search) t)
	     (set (make-local-variable 'dabbrev-case-replace) t)))

;; mode C++ et C...
(defun my-c++-mode-hook ()
  (setq tab-width 4)
  (define-key c++-mode-map "\C-m" 'reindent-then-newline-and-indent)
  (define-key c++-mode-map "\C-ce" 'c-comment-edit)
  (setq c++-auto-hungry-initial-state 'none)
  (setq c++-delete-function 'backward-delete-char)
  (setq c++-tab-always-indent t)
  (setq c-indent-level 4)
  (setq c-continued-statement-offset 4)
  (setq c++-empty-arglist-indent 4))

(defun my-c-mode-hook ()
  (setq tab-width 4)
  (define-key c-mode-map "\C-m" 'reindent-then-newline-and-indent)
  (define-key c-mode-map "\C-ce" 'c-comment-edit)
  (setq c-auto-hungry-initial-state 'none)
  (setq c-delete-function 'backward-delete-char)
  (setq c-tab-always-indent t)
;; Style d'indentation BSD
  (setq c-indent-level 4)
  (setq c-continued-statement-offset 4)
  (setq c-brace-offset -4)
  (setq c-argdecl-indent 0)
  (setq c-label-offset -4))

;; mode Perl
(defun my-perl-mode-hook ()
  (setq tab-width 4)
  (define-key c++-mode-map "\C-m" 'reindent-then-newline-and-indent)
  (setq perl-indent-level 4)
  (setq perl-continued-statement-offset 4))

;; mode Scheme...
(defun my-scheme-mode-hook ()
  (define-key scheme-mode-map "\C-m" 'reindent-then-newline-and-indent))

;; mode Emacs-Lisp...
(defun my-lisp-mode-hook ()
  (define-key lisp-mode-map "\C-m" 'reindent-then-newline-and-indent)
  (define-key lisp-mode-map "\C-i" 'lisp-indent-line)
  (define-key lisp-mode-map "\C-j" 'eval-print-last-sexp))

;; Ajoute tout le reste...
(add-hook 'c++-mode-hook 'my-c++-mode-hook)
(add-hook 'c-mode-hook 'my-c-mode-hook)
(add-hook 'scheme-mode-hook 'my-scheme-mode-hook)
(add-hook 'emacs-lisp-mode-hook 'my-lisp-mode-hook)
(add-hook 'lisp-mode-hook 'my-lisp-mode-hook)
(add-hook 'perl-mode-hook 'my-perl-mode-hook)

;; Le complement a next-error
(defun previous-error (n)
  "Visit previous compilation error message and corresponding source code."
  (interactive "p")
  (next-error (- n)))

;; Divers...
(transient-mark-mode 1)
(setq mark-even-if-inactive t)
(setq visible-bell nil)
(setq next-line-add-newlines nil)
(setq compile-command "make")
(setq suggest-key-bindings nil)
(put 'eval-expression 'disabled nil)
(put 'narrow-to-region 'disabled nil)
(put 'set-goal-column 'disabled nil)

;; Recherche des archives Elisp
(autoload 'format-lisp-code-directory "lispdir" nil t)
(autoload 'lisp-dir-apropos "lispdir" nil t)
(autoload 'lisp-dir-retrieve "lispdir" nil t)
(autoload 'lisp-dir-verify "lispdir" nil t)

;; Mode de verrouillage de police
(defun my-make-face (face colour &amp;optional bold)
  "Create a face from a colour and optionally make it bold"
  (make-face face)
  (copy-face 'default face)
  (set-face-foreground face colour)
  (if bold (make-face-bold face))
  )

(if (eq window-system 'x)
    (progn
      (my-make-face 'blue "blue")
      (my-make-face 'red "red")
      (my-make-face 'green "dark green")
      (setq font-lock-comment-face 'blue)
      (setq font-lock-string-face 'bold)
      (setq font-lock-type-face 'bold)
      (setq font-lock-keyword-face 'bold)
      (setq font-lock-function-name-face 'red)
      (setq font-lock-doc-string-face 'green)
      (add-hook 'find-file-hooks 'font-lock-auto-mode-select)

      (setq baud-rate 1000000)
      (global-set-key "\C-cmm" 'menu-bar-mode)
      (global-set-key "\C-cms" 'scroll-bar-mode)
      (global-set-key [backspace] 'backward-delete-char)
					;      (global-set-key [delete] 'delete-char)
      (standard-display-european t)
      (load-library "iso-transl")))

;; X11 ou PC utilisant les ecritures directes a l'ecran
(if window-system
    (progn
      ;;      (global-set-key [M-f1] 'hilit-repaint-command)
      ;;      (global-set-key [M-f2] [?\C-u M-f1])
      (setq hilit-mode-enable-list
	    '(not text-mode c-mode c++-mode emacs-lisp-mode lisp-mode
		  scheme-mode)
	    hilit-auto-highlight nil
	    hilit-auto-rehighlight 'visible
	    hilit-inhibit-hooks nil
	    hilit-inhibit-rebinding t)
      (require 'hilit19)
      (require 'paren))
  (setq baud-rate 2400)			; For slow serial connections
  )

;; Terminal de type TTY
(if (and (not window-system)
	 (not (equal system-type 'ms-dos)))
    (progn
      (if first-time
	  (progn
	    (keyboard-translate ?\C-h ?\C-?)
	    (keyboard-translate ?\C-? ?\C-h)))))

;; Sous Unix
(if (not (equal system-type 'ms-dos))
    (progn
      (if first-time
	  (server-start))))

;; Add any face changes here
(add-hook 'term-setup-hook 'my-term-setup-hook)
(defun my-term-setup-hook ()
  (if (eq window-system 'pc)
      (progn
;;	(set-face-background 'default "red")
	)))

;; Restaure le  "desktop" - faire cela le plus tard possible
(if first-time
    (progn
      (desktop-load-default)
      (desktop-read)))

;; Indique que ce fichier a ete lu au moins une fois
(setq first-time nil)

;; Pas besoin de deverminer quoique ce soit maintenant

(setq debug-on-error nil)

;; Tout est fait
(message "All done, %s%s" (user-login-name) ".")
	</pre></div></div><br class="example-break" /></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp63200080"></a>5.7.4. Etendre la palette de langages qu'Emacs comprend</h3></div></div></div><p>Maintenant, Emacs est très bien si vous voulez seulement programmer
      dans des langages déjà fournis dans le fichier <code class="filename">.emacs</code>
      (C, C++, Perl, Lisp et Scheme), mais qu'arrive-t-il si un nouveau langage appelé
      <span class="quote">« <span class="quote">whizbang</span> »</span> sort, plein d'excitantes fonctionnalités ?
      </p><p>La première chose à faire est de savoir si whizbang est fourni avec
      des fichiers de configuration pour Emacs. Ceux-ci se terminent habituellement
      par <code class="filename">.el</code>, raccourci pour <span class="quote">« <span class="quote">Emacs Lisp</span> »</span>.
      Par exemple, si whizbang est un logiciel porté FreeBSD, nous pouvons
      localiser ces fichiers en faisant
      </p><pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>find /usr/ports/lang/whizbang -name "*.el" -print</code></strong>
      </pre><p>et les installer en les copiant dans le répertoire Lisp d'Emacs.
      Sur FreeBSD 2.1.0-RELEASE, il s'agit de <code class="filename">/usr/local/share/emacs/site-lisp</code>
      <a href="#ftn.idp63211216" class="footnote" id="idp63211216"><sup class="footnote">[11]</sup></a>.
      </p><p>Aisni par exemple, si la sortie de la commande <code class="command">find</code> était
      </p><pre class="screen">/usr/ports/lang/whizbang/work/misc/whizbang.el
      </pre><p>nous ferions
      </p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp /usr/ports/lang/whizbang/work/misc/whizbang.el /usr/local/share/emacs/site-lisp</code></strong>
      </pre><p>Ensuite, nous devons décider quel extension les fichiers source whizbang ont. Disons
      qu'il s'agit de fichiers se terminant par <code class="filename">.wiz</code>. Nous devons
      ajouter une entrée dans notre fichier <code class="filename">.emacs</code> pour être sûr
      qu'Emacs sera capable d'utiliser les informations dans <code class="filename">whizbang.el</code>.
      </p><p>Trouvez l'entrée <span class="symbol">auto-mode-alist</span> dans
      <code class="filename">.emacs</code> et ajoutez une ligne pour whizbang, comme :
      </p><pre class="programlisting"><em class="lineannotation"><span class="lineannotation">&#8230;</span></em>
("\\.lsp$" . lisp-mode)
("\\.wiz$" . whizbang-mode)
("\\.scm$" . scheme-mode)
<em class="lineannotation"><span class="lineannotation">&#8230;</span></em></pre><p>Cela signifie qu'Emacs ira automatiquement dans la fonction
      <code class="function">whizbang-mode</code> quand vous éditerez un fichier se terminant
      par <code class="filename">.wiz</code>.
      </p><p>Juste en-dessous, vous trouverez l'entrée <span class="symbol">font-lock-auto-mode-list</span>.
      Ajoutez <code class="function">whizbang-mode</code> à celle-ci comme ceci :
      </p><pre class="programlisting">;; Auto font lock mode
(defvar font-lock-auto-mode-list
  (list 'c-mode 'c++-mode 'c++-c-mode 'emacs-lisp-mode 'whizbang-mode 'lisp-mode 'perl-mode 'scheme-mode)
  "List of modes to always start in font-lock-mode")</pre><p>Cela signifie qu'Emacs autorisera toujours <code class="function">font-lock-mode</code>
      (ie colorisation de la syntaxe) pendant l'édition d'un fichier <code class="filename">.wiz</code>.
      </p><p>Et c'est tout ce qui est nécessaire. S'il y a quoique ce soit que
      vous voulez de fait automatiquement quand vous ouvrez un fichier
      <code class="filename">.wiz</code>, vous pouvez ajouter un	<code class="function">whizbang-mode hook</code>
      (voir <code class="function">my-scheme-mode-hook</code> pour un exemple simple
      qui ajoute <code class="function">auto-indent</code>, l'auto-indentation).
      </p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp65661648"></a>5.8. Pour aller plus loin</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Brian Harvey and Matthew Wright
	  <span class="emphasis"><em>Simply Scheme</em></span>
	  MIT 1994.
	  ISBN 0-262-08226-8</p></li><li class="listitem"><p>Randall Schwartz
	  <span class="emphasis"><em>Learning Perl</em></span>
	  O'Reilly 1993
	  ISBN 1-56592-042-2</p></li><li class="listitem"><p>Patrick Henry Winston and Berthold Klaus Paul Horn
	  <span class="emphasis"><em>Lisp (3rd Edition)</em></span>
	  Addison-Wesley 1989
	  ISBN 0-201-08319-1</p></li><li class="listitem"><p>Brian W. Kernighan and Rob Pike
	  <span class="emphasis"><em>The Unix Programming Environment</em></span>
	  Prentice-Hall 1984
	  ISBN 0-13-937681-X</p></li><li class="listitem"><p>Brian W. Kernighan and Dennis M. Ritchie
	  <span class="emphasis"><em>The C Programming Language (2nd Edition)</em></span>
	  Prentice-Hall 1988
	  ISBN 0-13-110362-8</p></li><li class="listitem"><p>Bjarne Stroustrup
	<span class="emphasis"><em>The C++ Programming Language</em></span>
	Addison-Wesley 1991
	ISBN 0-201-53992-6</p></li><li class="listitem"><p>W. Richard Stevens
	  <span class="emphasis"><em>Advanced Programming in the Unix Environment</em></span>
	  Addison-Wesley 1992
	  ISBN 0-201-56317-7</p></li><li class="listitem"><p>W. Richard Stevens
	  <span class="emphasis"><em>Unix Network Programming</em></span>
	  Prentice-Hall 1990
	  ISBN 0-13-949876-1</p></li></ul></div></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp62052176" class="footnote"><p><a href="#idp62052176" class="para"><sup class="para">[1] </sup></a>Si vous l'exécuter à l'invite de commande, vous pouvez recevoir un fichier
	  d'image mémoire (NDT: le désormais célèbre "core dump").</p></div><div id="ftn.idp62088016" class="footnote"><p><a href="#idp62088016" class="para"><sup class="para">[2] </sup></a>Pour être vraiment précis, <code class="command">cc</code> convertit à ce niveau le
	      code source dans son propre <em class="firstterm">p-code</em> indépendant de la
	      machine plutôt qu'en langage assembleur.</p></div><div id="ftn.idp62129360" class="footnote"><p><a href="#idp62129360" class="para"><sup class="para">[3] </sup></a>Au cas où vous ne le sauriez pas, un tri binaire est un manière
	  efficace de trier les éléments et le tri à bulles n'en est pas une.</p></div><div id="ftn.idp62139216" class="footnote"><p><a href="#idp62139216" class="para"><sup class="para">[4] </sup></a>Les raisons de ceci sont enterrées dans les brumes de l'histoire.</p></div><div id="ftn.idp62182224" class="footnote"><p><a href="#idp62182224" class="para"><sup class="para">[5] </sup></a>Notez, nous n'avons pas utilisé l'option <code class="option">-o</code>
		pour spécifier le nom de l'exécutable, aussi nous obtiendrons un
		exécutable du nom de <code class="filename">a.out</code>.
		Produire une version de déverminage du nom de
		<code class="filename">foobar</code> est laissé en exercice pour le lecteur!</p></div><div id="ftn.idp62472912" class="footnote"><p><a href="#idp62472912" class="para"><sup class="para">[6] </sup></a>NDT: je n'ai pas trouvé
	    de meilleure traduction pour core memory</p></div><div id="ftn.idp62621008" class="footnote"><p><a href="#idp62621008" class="para"><sup class="para">[7] </sup></a>Ils n'utilisent pas la forme <code class="filename">MAKEFILE</code>
	  car les bloques de majuscules sont souvent utilisés pour les
	  fichiers de documentation comme <code class="filename">README</code>.
	  </p></div><div id="ftn.idp62743760" class="footnote"><p><a href="#idp62743760" class="para"><sup class="para">[8] </sup></a>NDT: On entendra plus souvent parler de
	  <code class="literal">patch</code>.</p></div><div id="ftn.idp63058000" class="footnote"><p><a href="#idp63058000" class="para"><sup class="para">[9] </sup></a>Sauf si vous payez des sommes importantes.
	  </p></div><div id="ftn.idp63183568" class="footnote"><p><a href="#idp63183568" class="para"><sup class="para">[10] </sup></a>Beaucoup d'utilisateurs d'Emacs mettent leur variable d'environnement
	  <code class="envar">EDITOR</code> à <code class="literal">emacsclient</code> ainsi cela se passe
	  à chaque fois qu'ils ont besoin d'éditer un fichier.
	  </p></div><div id="ftn.idp63211216" class="footnote"><p><a href="#idp63211216" class="para"><sup class="para">[11] </sup></a>NDT : Sur FreeBSD 4.2-RELEASE aussi.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="secure"></a>Chapitre 6. Programmation sécurisée</h2></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="sect1"><a href="#idp65684176">6.1. Synopsis</a></span></dt><dt><span class="sect1"><a href="#secure-philosophy">6.2. Méthodologie de développement
      sécurisé</a></span></dt><dt><span class="sect1"><a href="#idp65687120">6.3. Dépassement de capacité</a></span></dt><dt><span class="sect1"><a href="#idp65784656">6.4. Les problèmes liés à SetUID</a></span></dt><dt><span class="sect1"><a href="#chroot">6.5. Limiter l'environnement de votre programme</a></span></dt><dt><span class="sect1"><a href="#idp65815248">6.6. La confiance</a></span></dt><dt><span class="sect1"><a href="#idp65818192">6.7. Les conditions de course</a></span></dt></dl></div><p>Ce chapître a été écrit par Murray Stokely.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp65684176"></a>6.1. Synopsis</h2></div></div></div><p>Ce chapître décrit quelques problèmes de sécurité qui
      ont tourmenté les programmeurs Unix depuis des dizaines d'années
      et quelques uns des nouveaux outils disponibles pour aider
      les programmeurs à éviter l'écriture de code non sécurisé.
      </p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="secure-philosophy"></a>6.2. Méthodologie de développement
      sécurisé</h2></div></div></div><p>Ecrire des applications sécurisées demande une très minutieuse
      et pessimiste vision de la vie. Les applications devrait fonctionner
      avec le principe du <span class="quote">« <span class="quote">privilège moindre</span> »</span> de façon à ce
      qu'aucun processus ne fonctionne avec plus que le strict minimum dont
      il a besoin pour accomplir sa tâche. Le code pré-testé devrait être
      réutilisé autant que possible pour éviter les erreurs communes que
      d'autres peuvent déjà avoir réparées.</p><p>Un des pièges de l'environnement Unix est qu'il est facile
      d'affecter la stabilité de l'environnement.
      Les applications ne devraient jamais avoir confiance dans la saisie
      de l'utilisateur (sous toutes ses formes),
      les ressources système, la communication inter-processus, ou l'enchaînement
      des évènements. Les processus Unix n'exécutent pas de manière synchrone
      aussi, logiquement, les opérations sont rarement atomiques.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp65687120"></a>6.3. Dépassement de capacité</h2></div></div></div><p>Les dépassements de capacité ("Buffer Overflows") existent depuis
      les débuts de l'architecture de Von-Neuman <a class="xref" href="#COD">1</a>.
      Ils gagnèrent une grande notoriété en 1988 avec le ver pour Internet
      de Morris. Malheureusement, la même attaque basique reste effective
      aujourd'hui. Des 17 rapports de sécurité du CERT de 1999, 10
      furent causés directement des bogues logiciels de dépassement de
      capacité. De loin la plus commune de types d'attaques par dépassement de
       capacité est basée sur la corruption de la pile.</p><p>La plupart des systèmes informatiques modernes utilise une pile
      pour passer les arguments aux procédures et stocker les variables locales
      Une pile est une zone mémoire dernier entré-premier sorti (Last In-First
       Out : LIFO) dans la zone de mémoire haute de l'image d'un processus.
      Quand un programme invoque une fonction une nouvelle structure pile est
      créée. Cette structure pile consiste dans les arguments passés à la
      fonction aussi bien que dans une quantité dynamique d'espace pour
      la variable locale. Le pointeur de pile est un registre qui référence la
      position courante du sommet de la pile. Etant donné que cette valeur
      change constamment au fur et à mesure que de nouvelles valeurs sont
      ajoutées au sommet de la pile, beaucoup d'implémentations fournissent
      aussi un pointeur de structure qui est positionné dans le voisinage du
      début de la structure pile de façon à ce que les variables locales soient
      plus facilement adressables relativement à cette valeur.
      <a class="xref" href="#COD">1</a> L'adresse de retour des appels de fonction est aussi
      stocké dans la pile, et cela est la cause des découvertes des
      dépassements de pile puisque faire déborder une variable locale dans une
      fonction peut écraser l'adresse de retour de cette fonction, permettant
      potentiellement à un utilisateur malveillant d'exécuter le code qu'il ou
      elle désire.</p><p>Bien que les attaques basées sur les dépassements de pile soient
      de loin les plus communes, il serait aussi possible de faire exploser
      la pile avec une attaque du tas (malloc/free).</p><p>Le langage de programmation C ne réalise pas de vérifications
      automatiques des limites sur les tableaux ou pointeurs comme d'autres
      langages le font. De plus, la librairie standard du C est remplie d'une
      poignée de fonctions très dangereuses.</p><div class="informaltable"><table border="1"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="function">strcpy</code>(char *dest, const char
          *src)</td><td><p>Peut faire déborder le tampon dest</p></td></tr><tr><td><code class="function">strcat</code>(char *dest, const char
          *src)</td><td><p>Peut faire déborder le tampon dest</p></td></tr><tr><td><code class="function">getwd</code>(char *buf)</td><td><p>Peut faire déborder le tampon buf</p></td></tr><tr><td><code class="function">gets</code>(char *s)</td><td><p>Peut faire déborder le tampon s</p></td></tr><tr><td><code class="function">[vf]scanf</code>(const char *format,
          ...)</td><td><p>Peut faire déborder ses arguments.</p></td></tr><tr><td><code class="function">realpath</code>(char *path, char
          resolved_path[])</td><td><p>Peut faire déborder le tampon path</p></td></tr><tr><td><code class="function">[v]sprintf</code>(char *str, const char
          *format, ...)</td><td><p>Peut faire déborder le tampon str.</p></td></tr></tbody></table></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65705424"></a>6.3.1. Exemple de dépassement de capacité</h3></div></div></div><p>L'exemple de code suivant contient un dépassement de capacité
      conçu pour écraser l'adresse de retour et "sauter" l'instruction suivant
      immédiatement l'appel de la fonction. (Inspiré
      par <a class="xref" href="#Phrack">4</a>)</p><pre class="programlisting">#include <code class="sgmltag-element">stdio.h</code>

void manipulate(char *buffer) {
  char newbuffer[80];
  strcpy(newbuffer,buffer);
}

int main() {
  char ch,buffer[4096];
  int i=0;

  while ((buffer[i++] = getchar()) != '\n') {};

  i=1;
  manipulate(buffer);
  i=2;
  printf("La valeur de i est : %d\n",i);
  return 0;
}</pre><p>Examinons quel serait l'aspect de l'image mémoire de ce processus
      si nous avions entré 160 espaces dans notre petit programme avant
      d'appuyer sur <span class="keycap"><strong>Entrée</strong></span>.</p><p>[XXX Schéma ici!]</p><p>Evidemment une entrée plus malveillante pourrait être imaginée pour
      exécuter des instructions déjà compilées (comme exec(/bin/sh)).</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65709136"></a>6.3.2. Eviter les dépassements de capacité</h3></div></div></div><p>La solution la plus simple au problème de débordement de pile
      est de toujours utiliser de la mémoire restreinte en taille et
      les fonctions de copie de chaîne de caractères. <code class="function">strncpy</code>
      et <code class="function">strncat</code> font parties de la libraire standard du
      C. Ces fonctions acceptent une valeur de longueur comme paramètre qui
      qui ne devrait pas être plus grande que la taille du tampon de
      destination. Ces fonctions vont ensuite copier `taille' octets de la
      source vers la destination. Toutefois, il y a un certain nombre de
      problèmes avec ces fonctions. Aucune fonction ne garantit une terminaison
      par le caractère NULL si la taille du tampon d'entrée est aussi grand
      que celui de destination. Le paramètre taille est aussi utilisé de façon
      illogique entre <code class="function">strncpy</code> et <code class="function">strncat</code>
      aussi il est facile pour les programmeurs d'être déroutés sur leur
      utilisation convenable. Il y a aussi une perte significative des
      performances comparé à <code class="function">strcpy</code> lorsque l'on copie
      une courte chaîne dans un grand tampon puisque <code class="function">strncpy</code>
      remplit de caractères NULL jusqu'à la taille spécifiée.</p><p>Dans OpenBSD, une autre implémentation de la copie de mémoire
      a été créée pour contourner ces problèmes. Les fonctions <code class="function">strlcpy</code>
      et <code class="function">strlcat</code> garantissent qu'elles termineront
      toujours le tampon de destination par un caractère NULL losque l'argument
      de taille est différent de zéro. Pour plus d'informations sur ces
      fonctions, voir <a class="xref" href="#OpenBSD">6</a>. Les fonctions <code class="function">strlcpy</code> et
      <code class="function">strlcat</code> d'OpenBSD ont été inclues dans FreeBSD
      depuis la version 3.5.</p><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65739344"></a>6.3.2.1. V#233;rifications des limites en fonctionnement basées sur le compilateur</h4></div></div></div><p>Malheureusement il y a toujours un très important assortiment de
        code en utilisation publique qui copie aveuglément la mémoire sans
        utiliser une des routines de copie limitée dont nous venons juste de
        discuter. Heureusement, il y a une autre solution.  Plusieurs produits
        complémentaires pour compilateur et librairies existent pour faire
        de la vérification de limites pendant le fonctionnement en C/C++.</p><p>StackGuard est un de ces produits qui est implémenté comme un
        petit correctif ("patch") pour le générateur de code gcc. Extrait du
        site Internet de StackGuard, http://immunix.org/stackguard.html :
        </p><div class="blockquote"><blockquote class="blockquote"><p>"StackGuard détecte et fait échouer les attaques
        par débordement de pile en empêchant l'adresse de retour sur la pile
        d'être altérée. StackGuard place un mot "canari"
        <a href="#ftn.idp65741136" class="footnote" id="idp65741136"><sup class="footnote">[12]</sup></a>
        à côté de l'adresse de retour quand la fontion est appelée. Si le mot
        "canari" a été altéré au retour de la fonction, alors une attaque par
        débordement de pile a été tentée et le programme répond en envoyant
        une alerte d'intrusion dans la trace système (syslog) et
        s'arrête alors."</p></blockquote></div><p>

        </p><div class="blockquote"><blockquote class="blockquote"><p>"StackGuard est implémenté comme un petit correctif
        au générateur de code gcc, spécifiquement sur les routines
        function_prolog() et function_epilog().  function_prolog() a été
        amélioré pour laisser des "canaris" sur la pile quand les fonctions
        démarrent, et function_epilog vérifie l'intégrité des "canaris" quand
        la fonction se termine. Tout essai pour corrompre l'adresse de retour
        est alors détectée avant que la fonction ne retourne."</p></blockquote></div><p>
        </p><p>Recompiler votre application avec StackGuard est un
        moyen efficace pour stopper la plupart des attques par dépassement de
        capacité, mais cela peut toujours être compromis.</p></div><div class="sect3"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65742928"></a>6.3.2.2. Vérifications des limites en fonctionnement basées sur les librairies</h4></div></div></div><p>Les mécanismes basés sur le compilateur sont totalement inutiles
        pour logiciel seulement binaire que vous ne pouvez recompiler. Pour
        ces situations, il existe un nombre de librairies qui re-implémente
        les fonctions peu sûres de la librairie C
        (<code class="function">strcpy</code>, <code class="function">fscanf</code>,
        <code class="function">getwd</code>, etc..) et assurent que ces
        fonctions ne peuvent pas écrire plus loin que le pointeur de pile.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">libsafe</li><li class="listitem">libverify</li><li class="listitem">libparnoia</li></ul></div><p>Malheureusement ces défenses basées sur les librairies possèdent
	un certain nombre de défauts. Ces librairies protègent seulement d'un
        très petit ensemble de problèmes liés à la sécurité et oublient de
        réparer le problème actuel. Ces défenses peuvent échouer si
        l'application a été compilée avec -fomit-frame-pointer. De même, les
        variables d'environnement LD_PRELOAD et LD_LIBRARY_PATH peuvent être
        réécrites/non définies par l'utilisateur.</p></div></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp65784656"></a>6.4. Les problèmes liés à SetUID</h2></div></div></div><p>Il y a au moins 6 differents ID (identifiants) associés à un
      processus donné. A cause de cela, vous devez être très attentif avec
      l'accès que votre processus possède à un instant donné. En particulier,
      toutes les applications ayant reçu des privilèges par seteuid doivent
      les abandonnés dès qu'ils ne sont plus nécessaires.</p><p>L'identifiant de l'utilisateur réel (real user ID) peut seulement
      être changé par un processus super-utilisateur. Le programme <span class="application">login</span>
      met celui à jour quand un utilisateur se connecte et il est rarement
      changé.</p><p>L'identifiant de l'utilisateur effectif (effective user ID) est mis
      à jour par les fonctions <code class="function">exec()</code> si un programme
      possède son bit seteuid placé. Une application peut appeler
      <code class="function">seteuid()</code> à n'importe quel moment pour règler
      l'identifiant de l'utilisateur effectif sur l'identifiant d'un
      utilisateur réel ou sur le "set-user-ID" sauvé.
      Quand l'identifiant de l'utilisateur effectif est placé par les
      fonctions <code class="function">exec()</code>, la valeur précédente est sauvée
      dans le "set-user-ID" sauvé.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="chroot"></a>6.5. Limiter l'environnement de votre programme</h2></div></div></div><p>La méthode traditionnelle pour restreindre l'accès d'un processus
      se fait avec l'appel système <code class="function">chroot()</code>. Cet appel
      système change le répertoire racine depuis lequel tous les autres chemins
      sont référencés pour un processus et ses fils. Pour que cet appel
      réussisse, le processus doit avoir exécuté (recherché)
      la permission dans le répertoire référencé. Le nouvel environnement
      environment ne prend pas effet que lorsque vous appelez <code class="function">chdir()</code>
      dans celui-ci.
      Il doit être aussi noté qu'un processus peut facilement s'échapper
      d'un environnement chroot s'il a les privilèges du super-utilisateur.
      Cela devrait être accompli en créant des fichiers spéciaux de
      périphérique pour la mémoire du noyau, en attachant un dévermineur à un
      processus depuis l'extérieur de sa "prison", ou par d'autres manières
      créatrices.</p><p>Le comportement de l'appel système <code class="function">chroot()</code>
      peut être un peu contrôlé avec la commande <code class="command">sysctl</code> et
      la variable kern.chroot_allow_open_directories.
      Quand cette valeur est règlée à 0, <code class="function">chroot()</code> échouera
      avec EPERM s'il y a un répertoire d'ouvert. Si la variable est règlée sur
      la valeur par défaut 1, alors <code class="function">chroot()</code> échouera
      avec EPERM s'il y a un répertoire d'ouvert et que le processus est déjà
      sujet à un appel <code class="function">chroot()</code>. Pour toute autre valeur, la
      vérification des répertoires ouverts sera totalement court-circuitée.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65792208"></a>6.5.1. La fonctionnalité "prison" de FreeBSD</h3></div></div></div><p>Le concept de Prison ("Jail") étend
      <code class="function">chroot()</code> en limitant les droits du
      super-utilisateur pour créer un véritable `serveur virtuel'. Une fois
      qu'une prison est mise en place, toute communication réseau doit avoir lieu
      au travers de l'adresse IP spécifiée, et le droit du
      "privilège super-utilisateur" dans cette prison est sévèrement gêné.</p><p>Tant qu'il se trouve en prison, tout test avec les droits du
      super-utilisateur dans le noyau au travers d'un appel à
      <code class="function">suser()</code> échouera.
      Toutefois, quelques appels à <code class="function">suser()</code> ont été
      changés par la nouvelle interface <code class="function">suser_xxx()</code>.
      Cette fonction est responsable de fournir ou de retirer les accès
      aux droits du super-utilisateur pour les processus emprisonnés.</p><p>Un processus super-utilisateur dans un environnement emprisonné
      a le pouvoir de : </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Manipuler les identitifications avec
        <code class="function">setuid</code>, <code class="function">seteuid</code>,
        <code class="function">setgid</code>, <code class="function">setegid</code>,
        <code class="function">setgroups</code>, <code class="function">setreuid</code>,
        <code class="function">setregid</code>, <code class="function">setlogin</code></li><li class="listitem">Règler les limites en ressources avec <code class="function">setrlimit</code></li><li class="listitem">Modifier quelques variables du noyau par sysctl
        (kern.hostname)</li><li class="listitem"><code class="function">chroot()</code></li><li class="listitem">Règler les paramètres d'un noeud virtuel (vnode):
        <code class="function">chflags</code>,
        <code class="function">fchflags</code></li><li class="listitem">Règler les attributs d'un noeud virtuel comme
      les permissions d'un fichier, le propriétaire, le groupe, la taille,
      la date d'accès, et la date de modification.</li><li class="listitem">Se lier à des ports privilégiés sur Internet
        (ports &lt; 1024)</li></ul></div><p><code class="function">Jail</code> est un outil très utile pour exécuter
      des applications dans un environnement sécurisé mais il a des
      imperfections. Actuellement, les mécanismes IPC (Inter-Process
      Communications) n'ont pas été convertis pour utiliser <code class="function">suser_xxx</code>
      aussi des applications comme MySQL ne peuvent être exécutée dans une prison.
      L'accès super-utilisateur peut avoir un sens très limité dans une prison,
       mais il n'y aucune façon de spécifier exactement ce que très limité
      veut dire.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp65813072"></a>6.5.2. Les capacitès des processus POSIX.1e</h3></div></div></div><p>Posix a réalisé un document de travail qui ajoute l'audit
      d'évènement, les listes de contrôle d'accès, les privilèges fins,
      l'étiquetage d'information, et le contrôle d'accès mandaté.</p><p>Il s'agit d'un travail en cours et c'est l'objectif du projet <a class="link" href="http://www.trustedbsd.org" target="_top">TrustedBSD</a>. Une partie
      du travail initial a été intégré dans FreeBSD-current
      (cap_set_proc(3)).</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp65815248"></a>6.6. La confiance</h2></div></div></div><p>Une application ne devrait jamais supposer que tout est sain
      dans l'environnement des utilisateurs. Cela inclut (mais n'est
      certainement pas limité à) : la saisie de l'utilisateur, les signaux,
      les variables d'environnement, les ressources, les communication
      inter-processus, les mmaps, le répertoire de travail du système de
      fichiers, les descripteurs de fichier, le nombre de fichiers ouverts,
      etc.</p><p>Vous ne devriez jamais supposer que vous pouvez gérer toutes les
      formes de saisie invalide qu'un utilisateur peut entrer. Votre
      application devrait plutôt utiliser un filtrage positif pour
      seulement permettre un sous-ensemble spécifique que vous jugez
      sain. Une mauvaise validation des entrées a été la cause de beaucoup
      découvertes de bogues, spécialement avec les scripts CGI sur le web.
       Pour les noms de fichier, vous devez être tout particulièrement attentif
      aux chemins ("../", "/"), liens symboliques et caractères d'échappement
      de l'interpréteur de commandes.</p><p>Perl possède une caractéristique tès sympathique appelée mode
      "Taint" qui peut être utilisée pour empêcher les scripts d'utiliser
      des données externes au programme par un moyen non sûr. Ce mode vérifiera
      les arguments de la ligne de commandes, les variables d'environnement,
      les informations localisées (propres aux pays), les résultats de certains
      appels système (<code class="function">readdir()</code>,
      <code class="function">readlink()</code>,
      <code class="function">getpwxxx()</code>) et toute entrée de fichier.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp65818192"></a>6.7. Les conditions de course</h2></div></div></div><p>Une condition de course est un comportement anormal causé par
      une dépendance inattendue sur le séquencement relatif des évènements. En
      d'autres mots, un programmeur a supposé à tort qu'un évènement
      particulier se passerait avant un autre.</p><p>Quelques causes habituelles de conditions de course sont les
      signaux, les vérifications d'accès et les fichiers ouverts.
      Les signaux sont des évènements asynchrones par nature aussi un soin
      particulier doit être pris pour les utiliser.
      Vérifier les accès avec <code class="function">access(2)</code> puis
      <code class="function">open(2)</code> n'est clairement pas atomique.
      Les utilisateurs peuvent déplacer des fichiers entre les deux appels.
      Les applications privilégiées devraient plutôt faire un appel à
      <code class="function">seteuid()</code> puis appeler <code class="function">open()</code>
      directement. Dans le même esprit, une application devrait toujours règler
      un umask correct avant un appel à <code class="function">open()</code> pour
      prévenir le besoin d'appels non valides à <code class="function">chmod()</code>.</p></div><div class="footnotes"><br /><hr class="footnote-hr" /><div id="ftn.idp65741136" class="footnote"><p><a href="#idp65741136" class="para"><sup class="para">[12] </sup></a>NDT : Jaune de préférence pour être bien visible</p></div></div></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="kernel"></a>Partie III. Le noyau</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#kernelhistory">7. Histoire du noyau Unix</a></span></dt><dt><span class="chapter"><a href="#locking">8. Notes sur le verrouillage</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp65828048">8.1. Les mutex</a></span></dt><dt><span class="sect1"><a href="#idp65948880">8.2. Les verrous du gestionnaire de verrous (Lock Manager)</a></span></dt><dt><span class="sect1"><a href="#idp65967184">8.3. Variables protégées atomiquement</a></span></dt></dl></dd></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="kernelhistory"></a>Chapitre 7. Histoire du noyau Unix</h2></div></div></div><p>Un peu d'histoire sur le noyau Unix/BSD, les appels système, comment
        fonctionnent les processus, bloquer, planifier, les threads (noyau),
        le basculement de contexte, les signaux, les interruptions, les modules, etc.</p><p></p></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="locking"></a>Chapitre 8. Notes sur le verrouillage</h2></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="sect1"><a href="#idp65828048">8.1. Les mutex</a></span></dt><dt><span class="sect1"><a href="#idp65948880">8.2. Les verrous du gestionnaire de verrous (Lock Manager)</a></span></dt><dt><span class="sect1"><a href="#idp65967184">8.3. Variables protégées atomiquement</a></span></dt></dl></div><p><span class="emphasis"><em>Ce chapître est maintenu par The FreeBSD SMP Next
    Generation Project. Envoyez leur directement les commentaires et
    les suggestions à <a class="link" href="http://lists.FreeBSD.org/mailman/listinfo/freebsd-smp" target="_top">liste de diffusion concernant le traitement symétrique multiprocesseurs (SMP) sous FreeBSD</a>.</em></span></p><p>Ce document souligne le verrouillage utilisé dans le noyau FreeBSD
    pour permettre d'utiliser du vrai multi-processeur à l'intérieur du noyau.
    Le verrouillage peut être réalisé par différents moyens.
    Les structures de données puvent être protégées par des mutex ou <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lockmgr&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">lockmgr</span>(9)</span></a> verrous.
    Quelques variables sont protégées simplement par l'utilisation continuelle d'opérations
    atomiques pour y accéder.
   </p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp65828048"></a>8.1. Les mutex</h2></div></div></div><p>Un mutex est simplement un verrou utilisé pour garantir exclusion mutuelle.
      Spécifiquement, un mutex ne peut appartenir qu'à une entité à la fois.
      Si une autre entité désire obtenir un mutex déjà pris
      , elle doit attendre jusqu'à ce que le mutex soit relaché. Dans le noyau
      FreeBSD, les mutex appartiennent aux processus.</p><p>Les mutex peuvent être acquis récursivement, mais ils sont conçus
      pour n'être pris que pendant une courte période. Spécifiquement, le détenteur
      ne doit pas se suspendre pendant qu'il retient un mutex. Si vous avez besoin de
      maintenir un verrouillage pendant une suspension, utilisez un <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lockmgr&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">lockmgr</span>(9)</span></a> verrou ("lock").</p><p>Chaque mutex a plusieurs intérêts :</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Nom de la variable</span></dt><dd><p>Nom de la variable <span class="type">struct mtx</span> dans
	    le code source du noyau.</p></dd><dt><span class="term">Nom logique</span></dt><dd><p>Le nom du mutex lui est assigné par
	    <code class="function">mtx_init</code>. Ce nom est affiché dans
	    les messages de trace KTR, témoigne des erreurs et avertissements et est
	    utilisé pour distinguer les mutex dans les traces.</p></dd><dt><span class="term">Type</span></dt><dd><p>Le type du mutex en termes de constantes nommées
	    <code class="constant">MTX_*</code>.  La signification de chaque
	    constante nommée est documentée dans <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mutex&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">mutex</span>(9)</span></a>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="constant">MTX_DEF</code></span></dt><dd><p>Un mutex endormi</p></dd><dt><span class="term"><code class="constant">MTX_SPIN</code></span></dt><dd><p>Un mutex tournant</p></dd><dt><span class="term"><code class="constant">MTX_COLD</code></span></dt><dd><p>Ce mutex est initialisé très tard.  Toutefois, il
		  doit être déclaré via
		  <code class="function">MUTEX_DECLARE</code>, et la constante nommée
		  <code class="constant">MTX_COLD</code> doit être passée à
		  <code class="function">mtx_init</code>.</p></dd><dt><span class="term"><code class="constant">MTX_TOPHALF</code></span></dt><dd><p>Ce mutex tournant ne désactive pas les
		  interruptions.</p></dd><dt><span class="term"><code class="constant">MTX_NORECURSE</code></span></dt><dd><p>Ce mutex n'a pas la permission d'être recursif.</p></dd></dl></div></dd><dt><span class="term">Protégés</span></dt><dd><p>Une liste de structures de données ou des membres de structure de données
	    que cette entrée protège.  Pour les membres de structures de données,
	    le nom sera de la forme <code class="varname">structure name</code>.<code class="varname">member name</code>.</p></dd><dt><span class="term">Fonctions dépendantes</span></dt><dd><p>Les fonctions qui peuvent seulement être appelées si ce mutex est
	    pris.</p></dd></dl></div><div class="table"><a id="idp65860176"></a><div class="table-title">Tableau 8.1. Liste du mutex</div><div class="table-contents"><table summary="Liste du mutex" width="100%" border="1"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th>Nom de la variable</th><th>Nom logique</th><th>Type</th><th>Protégés</th><th>Fonctions dépendantes</th></tr></thead><tbody><tr><td>sched_lock</td><td><span class="quote">« <span class="quote">sched lock</span> »</span></td><td>
	      <code class="constant">MTX_SPIN</code> |
	      <code class="constant">MTX_COLD</code>
	    </td><td>
	      <code class="varname">_gmonparam</code>,
	      <code class="varname">cnt.v_swtch</code>,
	      <code class="varname">cp_time</code>,
	      <code class="varname">curpriority</code>,
	      <code class="varname">mtx</code>.<code class="varname">mtx_blocked</code>,
	      <code class="varname">mtx</code>.<code class="varname">mtx_contested</code>,
	      <code class="varname">proc</code>.<code class="varname">p_contested</code>,
	      <code class="varname">proc</code>.<code class="varname">p_blocked</code>,
	      <code class="varname">proc</code>.<code class="varname">p_flag</code>
		(<code class="constant">P_PROFIL</code> XXX,
		 <code class="constant">P_INMEM</code>,
	         <code class="constant">P_SINTR</code>,
	         <code class="constant">P_TIMEOUT</code>,
	         <code class="constant">P_SWAPINREQ</code> XXX,
	         <code class="constant">P_INMEN</code> XXX),
	      <code class="varname">proc</code>.<code class="varname">p_nice</code>,
	      <code class="varname">proc</code>.<code class="varname">p_procq</code>,
	      <code class="varname">proc</code>.<code class="varname">p_blocked</code>,
	      <code class="varname">proc</code>.<code class="varname">p_estcpu</code>,
	      <code class="varname">proc</code>.<code class="varname">p_nativepri</code>,
	      <code class="varname">proc</code>.<code class="varname">p_priority</code>,
	      <code class="varname">proc</code>.<code class="varname">p_usrpri</code>,
	      <code class="varname">proc</code>.<code class="varname">p_rtprio</code>,
	      <code class="varname">proc</code>.<code class="varname">p_rqindex</code>,
	      <code class="varname">proc</code>.<code class="varname">p_stats-&gt;p_prof</code>,
	      <code class="varname">proc</code>.<code class="varname">p_stats-&gt;p_ru</code>,
	      <code class="varname">proc</code>.<code class="varname">p_stat</code>,
	      <code class="varname">proc</code>.<code class="varname">p_cpticks</code>,
	      <code class="varname">proc</code>.<code class="varname">p_iticks</code>,
	      <code class="varname">proc</code>.<code class="varname">p_uticks</code>,
	      <code class="varname">proc</code>.<code class="varname">p_sticks</code>,
	      <code class="varname">proc</code>.<code class="varname">p_swtime</code>,
	      <code class="varname">proc</code>.<code class="varname">p_slptime</code>,
	      <code class="varname">proc</code>.<code class="varname">p_runtime</code>,
	      <code class="varname">proc</code>.<code class="varname">p_pctcpu</code>,
	      <code class="varname">proc</code>.<code class="varname">p_oncpu</code>,
	      <code class="varname">proc</code>.<code class="varname">p_asleep</code>,
	      <code class="varname">proc</code>.<code class="varname">p_wchan</code>,
	      <code class="varname">proc</code>.<code class="varname">p_wmesg</code>,
	      <code class="varname">proc</code>.<code class="varname">p_slpq</code>,
	      <code class="varname">proc</code>.<code class="varname">p_vmspace</code>
		(XXX - in <code class="function">statclock</code>),
	      <code class="varname">pscnt</code>,
	      <code class="varname">slpque</code>,
	      <code class="varname">itqueuebits</code>,
	      <code class="varname">itqueues</code>,
	      <code class="varname">rtqueuebits</code>,
	      <code class="varname">rtqueues</code>,
	      <code class="varname">queuebits</code>,
	      <code class="varname">queues</code>,
	      <code class="varname">idqueuebits</code>,
	      <code class="varname">idqueues</code>,
	      <code class="varname">switchtime</code>,
	    </td><td>
	      <code class="function">setrunqueue</code>,
	      <code class="function">remrunqueue</code>,
	      <code class="function">mi_switch</code>,
	      <code class="function">chooseproc</code>,
	      <code class="function">schedclock</code>,
	      <code class="function">resetpriority</code>,
	      <code class="function">updatepri</code>,
	      <code class="function">maybe_resched</code>,
	      <code class="function">cpu_switch</code>,
	      <code class="function">cpu_throw</code>
	    </td></tr><tr><td>vm86pcb_lock</td><td><span class="quote">« <span class="quote">vm86pcb lock</span> »</span></td><td>
	      <code class="constant">MTX_DEF</code> |
	      <code class="constant">MTX_COLD</code>
	    </td><td>
	      <code class="varname">vm86pcb</code>
	    </td><td>
	      <code class="function">vm86_bioscall</code>
	    </td></tr><tr><td>Giant</td><td><span class="quote">« <span class="quote">Giant</span> »</span></td><td>
	      <code class="constant">MTX_DEF</code> |
	      <code class="constant">MTX_COLD</code>
	    </td><td>nearly everything</td><td>lots</td></tr><tr><td>callout_lock</td><td><span class="quote">« <span class="quote">callout lock</span> »</span></td><td>
	      <code class="constant">MTX_SPIN</code>
	    </td><td>
	      <code class="varname">callfree</code>,
	      <code class="varname">callwheel</code>,
	      <code class="varname">nextsoftcheck</code>,
	      <code class="varname">proc</code>.<code class="varname">p_itcallout</code>,
	      <code class="varname">proc</code>.<code class="varname">p_slpcallout</code>,
	      <code class="varname">softticks</code>,
	      <code class="varname">ticks</code>
	    </td><td>
	    </td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp65948880"></a>8.2. Les verrous du gestionnaire de verrous (Lock Manager)</h2></div></div></div><p>Les verrous qui sont fournis par l'interface <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lockmgr&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">lockmgr</span>(9)</span></a>
      sont les verrous du gestionnaire de verrous. Ces verrous sont des verrous
       lecture-écriture et peuvent être retenus par un process suspendu.
    </p><div class="table"><a id="idp65954896"></a><div class="table-title">Tableau 8.2. <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=lockmgr&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">lockmgr</span>(9)</span></a> List de verrou</div><div class="table-contents"><table summary="lockmgr9 List de verrou" border="1"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>Nom de la variable</th><th>Protégés</th><th> </th><th> </th></tr></thead><tbody><tr><td><code class="varname">allproc_lock</code></td><td>
	      <code class="varname">allproc</code>
	      <code class="varname">zombproc</code>
	      <code class="varname">pidhashtbl</code>
	      <code class="varname">proc</code>.<code class="varname">p_list</code>
	      <code class="varname">proc</code>.<code class="varname">p_hash</code>
	      <code class="varname">nextpid</code>
	    </td><td><code class="varname">proctree_lock</code></td><td>
	      <code class="varname">proc</code>.<code class="varname">p_children</code>
	      <code class="varname">proc</code>.<code class="varname">p_sibling</code>
	    </td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp65967184"></a>8.3. Variables protégées atomiquement</h2></div></div></div><p>Une variable protégée atomiquement est une variable spéciale qui
      n'est pas protégé par un verrou explicite. Toutefois, tous les accès de
      données aux variables utilisent des opérations atomiques spéciales
      comme décrit dans <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=atomic&amp;sektion=9"><span class="citerefentry"><span class="refentrytitle">atomic</span>(9)</span></a>. Très peu de variables sont traitées
      de cette façon, bien que les autres primitives de synchronisation comme
      les mutex soient implémentées avec des variables protégées atomiquement.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">astpending</code></p></li><li class="listitem"><p><code class="varname">mtx</code>.<code class="varname">mtx_lock</code></p></li></ul></div></div></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="memory"></a>Partie IV. Mémoire et mémoire virtuelle</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#virtualmemory">9. La mémoire virtuelle</a></span></dt></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="virtualmemory"></a>Chapitre 9. La mémoire virtuelle</h2></div></div></div><p>MV, gestion par page, gestion sur disque, allouer de la mémoire, tester les
        fuites de mémoires, mmap, vnodes, etc.</p><p></p></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="iosystem"></a>Partie V. Système E/S (Entrées/Sorties)</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#ufs">10. UFS</a></span></dt></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ufs"></a>Chapitre 10. UFS</h2></div></div></div><p>UFS, FFS, Ext2FS, JFS, inodes, mémoire tampon, mettre à jour les données d'un disque,
        verrouillage, metadata, soft-updates, LFS, portalfs, procfs,
        vnodes, partage de mémoire, objets en mémoire, TLBs, mettre en cache</p></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ipc"></a>Partie VI. Communication InterProcessus (IPC)</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#signals">11. Les signaux</a></span></dt></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="signals"></a>Chapitre 11. Les signaux</h2></div></div></div><p>Signaux, tubes, sémaphores, files de message, segments de mémoire partagée,
        ports, prises, portes</p></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="networking"></a>Partie VII. Le réseau</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#sockets">12. Les prises</a></span></dt></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sockets"></a>Chapitre 12. Les prises</h2></div></div></div><p>Prises, bpf, IP, TCP, UDP, ICMP, OSI, ponts,
        pare-feux, translation d'adresses (NAT), séparation de réseaux, etc</p></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="networkfs"></a>Partie VIII. Systèmes de fichiers en réseau</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#afs">13. AFS</a></span></dt></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="afs"></a>Chapitre 13. AFS</h2></div></div></div><p>AFS, NFS, SANs etc]</p></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="terminal"></a>Partie IX. Gestion du terminal</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#syscons">14. Syscons</a></span></dt></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="syscons"></a>Chapitre 14. Syscons</h2></div></div></div><p>Syscons, tty, PCVT, console en liaison série, économiseurs d'écran,
        etc</p></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="sound"></a>Partie X. Le son</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#oss">15. OSS</a></span></dt></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="oss"></a>Chapitre 15. OSS</h2></div></div></div><p>OSS, formes d'ondes, etc</p></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="devicedrivers"></a>Partie XI. Pilotes de périphérique</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#driverbasics">16. Ecrire des pilotes de périphériques pour FreeBSD</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp66003408">16.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#idp66006096">16.2. L'éditeur de liens dynamiques du noyau - KLD</a></span></dt><dt><span class="sect1"><a href="#idp66019408">16.3. Accéder au pilote d'un périphérique</a></span></dt><dt><span class="sect1"><a href="#idp66024272">16.4. Les périphériques caractères</a></span></dt><dt><span class="sect1"><a href="#idp66037456">16.5. Pilotes Réseau</a></span></dt></dl></dd><dt><span class="chapter"><a href="#pci">17. Les périphériques PCI</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp66045648">17.1. Rechercher et rattacher</a></span></dt><dt><span class="sect1"><a href="#idp66049616">17.2. Les ressources du bus</a></span></dt></dl></dd><dt><span class="chapter"><a href="#scsi">18. Contrôleurs SCSI Common Access Method (CAM) **</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp66078160">18.1. En cours de traduction</a></span></dt></dl></dd><dt><span class="chapter"><a href="#usb">19. Périphériques USB ***</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp66080976">19.1. Introduction</a></span></dt></dl></dd><dt><span class="chapter"><a href="#newbus">20. NewBus</a></span></dt></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="driverbasics"></a>Chapitre 16. Ecrire des pilotes de périphériques pour FreeBSD</h2></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="sect1"><a href="#idp66003408">16.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#idp66006096">16.2. L'éditeur de liens dynamiques du noyau - KLD</a></span></dt><dt><span class="sect1"><a href="#idp66019408">16.3. Accéder au pilote d'un périphérique</a></span></dt><dt><span class="sect1"><a href="#idp66024272">16.4. Les périphériques caractères</a></span></dt><dt><span class="sect1"><a href="#idp66037456">16.5. Pilotes Réseau</a></span></dt></dl></div><p>Ce chapitre a été écrit par Murray Stokely avec des sélections
    depuis une variété de codes source inclus dans la page de manuel d'<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=intro&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">intro</span>(4)</span></a> de Joerg
    Wunsch.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp66003408"></a>16.1. Introduction</h2></div></div></div><p>Ce chapitre fournit une brève introduction sur l'écriture
      de pilotes de périphériques pour FreeBSD.
      Un périphérique, dans ce contexte, est un terme utilisé
      le plus souvent pour tout ce qui est lié au matériel et qui dépend
      du système, comme les disques, imprimantes, ou un écran avec son clavier.
      Un pilote de périphérique est un composant logiciel du système
      d'exploitation qui contrôle un périphérique spécifique.  Il y a aussi
      ce que l'on appelle les pseudo-périphériques (&#8220;pseudo-devices&#8221;) où un pilote
      de périphérique émule le comportement d'un périphérique dans un logiciel sans
      matériel particulier sous-jacent. Les pilotes de périphériques peuvent être compilés
      dans le système statiquement ou chargé à la demande via l'éditeur de liens dynamique du
      noyau &#8220;kld&#8221;.</p><p>La plupart des périphériques dans un système d'exploitation de type Unix
      sont accessibles au travers de fichiers spéciaux de périphérique (device-nodes), appelés parfois
      fichiers spéciaux. Ces fichiers sont habituellement stockés dans le répertoire
      <code class="filename">/dev</code> de la hiérarchie du système de fichiers. Jusqu'à ce que
      devfs soit totalement intégré dans FreeBSD, chaque fichier spécial de périphérique doit être
      créé statiquement et indépendamment de l'existence du pilote de périphérique associé.
      La plupart des fichiers spéciaux de périphérique du système sont créés en exécutant <code class="command">MAKEDEV</code>.</p><p>Les pilotes de périphérique peuvent être en gros séparés en deux catégories;
      les pilotes de périphérique en mode caractère et les pilotes de périphériques réseau.</p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp66006096"></a>16.2. L'éditeur de liens dynamiques du noyau - KLD</h2></div></div></div><p>L'interface kld permet aux administrateurs système d'ajouter
      et d'enlever dynamiquement une fonctionnalité à un système en marche.
      Cela permet aux développeurs de pilote de périphérique de charger leurs nouveaux changements
      dans le noyau en fonctionnement sans redémarrer constamment pour tester ces derniers.
    </p><p>L'interface kld est utilisé au travers des commandes d'administrateur suivantes :

    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="command">kldload</code> - charge un nouveau module dans le noyau</li><li class="listitem"><code class="command">kldunload</code> - décharge un module du noyau</li><li class="listitem"><code class="command">kldstat</code> - liste les modules chargés dans le noyau</li></ul></div><p>
    </p><p>Structure squelettique d'un module de noyau</p><pre class="programlisting">/*
 * Squelette KLD
 * Inspiré de l'article d'Andrew Reiter paru sur Daemonnews
 */

#include &lt;sys/types.h&gt;
#include &lt;sys/module.h&gt;
#include &lt;sys/systm.h&gt;  /* uprintf */
#include &lt;sys/errno.h&gt;
#include &lt;sys/param.h&gt;  /* defines utilise dans kernel.h */
#include &lt;sys/kernel.h&gt; /* types utilise dans le module d'initialisation */

/*
 * charge le gestionnaire quit traite du chargement et déchargement d'un KLD.
 */

static int
skel_loader(struct module *m, int what, void *arg)
{
  int err = 0;

  switch (what) {
  case MOD_LOAD:                /* kldload */
    
    uprintf("Skeleton KLD charge.\n");
    break;
  case MOD_UNLOAD:
    uprintf("Skeleton KLD decharge.\n");
    break;
  default:
    err = EINVAL;
    break;
  }
  return(err);
}

/* Declare ce module au reste du noyau */

DECLARE_MODULE(skeleton, skel_loader, SI_SUB_KLD, SI_ORDER_ANY);</pre><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66015696"></a>16.2.1. Makefile</h3></div></div></div><p>FreeBSD fournit un fichier d'inclusion "makefile" que vous pouvez utiliser pour
	compiler rapidement votre ajout au noyau.</p><pre class="programlisting">SRCS=skeleton.c
KMOD=skeleton

.include &lt;bsd.kmod.mk&gt;</pre><p>Lancer simplement la commande <code class="command">make</code> avec ce fichier Makefile
        créera un fichier <code class="filename">skeleton.ko</code> qui peut
        être chargé dans votre système en tapant :
</p><pre class="screen"> <code class="prompt">#</code>
	  kldload -v ./skeleton.ko
</pre><p>
      </p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp66019408"></a>16.3. Accéder au pilote d'un périphérique</h2></div></div></div><p>Unix fournit un ensemble d'appels système communs utilisable par
      les applications de l'utilisateur. Les couches supérieures du noyau renvoient
      ces appels au pilote de périphérique correspondant quand un utilisateur
      accède au fichier spécial de périphérique.  Le script <code class="command">/dev/MAKEDEV</code>
      crée la plupart des fichiers spéciaux de périphérique pour votre système mais si vous
      faites votre propre développement de pilote, il peut être nécessaire de créer
      vos propres fichiers spéciaux de périphérique avec la commande <code class="command">mknod</code>
    </p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66021328"></a>16.3.1. Créer des fichiers spéciaux de périphériques statiques</h3></div></div></div><p>La commande <code class="command">mknod</code> nécessite quatre
	arguments pou créer un fichier spécial de périphérique.  Vous devez spécifier le nom
	de ce fichier spécial de périphérique, le type de périphérique, le numéro majeur
	et le numéro mineur du périphérique.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66022992"></a>16.3.2. Les fichiers spéciaux de périphérique dynamiques</h3></div></div></div><p>Le périphérique système de fichiers, ou devfs, fournit l'accès à
	l'espace des noms des périphériques du noyau dans l'espace du système de fichiers global.
	Ceci élimine les problèmes de pilote sans fichier spécial statique, ou de fichier spécial sans pilote installé.
	Devfs est toujours un travail en cours mais il fonctionne déjà assez bien.</p></div></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp66024272"></a>16.4. Les périphériques caractères</h2></div></div></div><p>Un pilote de périphérique caractère est un pilote qui transfère les données
      directement au processus utilisateur ou vers celui-ci. Il s'agit du plus commun
      des types de pilote de périphérique et il y en a plein d'exemples simples dans
      l'arbre des sources.</p><p>Cet exemple simple de pseudo-périphérique enregistre toutes les valeurs
      que vous lui avez écrites et peut vous les renvoyer quand vous les lui
      demandez.</p><pre class="programlisting">/*
 * un simple pseudo-périphérique `echo' KLD
 *
 * Murray Stokely
 */

#define MIN(a,b) (((a) &lt; (b)) ? (a) : (b))

#include &lt;sys/types.h&gt;
#include &lt;sys/module.h&gt;
#include &lt;sys/systm.h&gt; /* uprintf */
#include &lt;sys/errno.h&gt;
#include &lt;sys/param.h&gt;  /* defines utilises dans kernel.h */
#include &lt;sys/kernel.h&gt; /* types utilises dans me module d'initialisation */
#include &lt;sys/conf.h&gt;   /* cdevsw struct */
#include &lt;sys/uio.h&gt;    /* uio struct */
#include &lt;sys/malloc.h&gt;

#define BUFFERSIZE 256

/* Prototypes des fonctions */
d_open_t      echo_open;
d_close_t     echo_close;
d_read_t      echo_read;
d_write_t     echo_write;

/* Points d'entrée du périphérique Caractère */
static struct cdevsw echo_cdevsw = {
  echo_open,
  echo_close,
  echo_read,
  echo_write,
  noioctl,
  nopoll,
  nommap,
  nostrategy,
  "echo",
  33,                   /* reserve pour lkms - /usr/src/sys/conf/majors */
  nodump,
  nopsize,
  D_TTY,
  -1
};

typedef struct s_echo {
  char msg[BUFFERSIZE];
  int len;
} t_echo;

/* variables */
static dev_t sdev;
static int len;
static int count;
static t_echo *echomsg;

MALLOC_DECLARE(M_ECHOBUF);
MALLOC_DEFINE(M_ECHOBUF, "echobuffer", "cache pour le module echo");

/*
 * Cette fonction est appelee par les appels systeme kld[un]load(2) pour
 * determiner quelles actions doivent etre faites quand le
 * module est charge ou decharge
 */

static int
echo_loader(struct module *m, int what, void *arg)
{
  int err = 0;

  switch (what) {
  case MOD_LOAD:                /* kldload */
    sdev = make_dev(<code class="literal">&amp;</code>echo_cdevsw,
		    0,
		    UID_ROOT,
		    GID_WHEEL,
		    0600,
		    "echo");
    /* aloocation de mémoire noyau pour l'utilisation de ce module */
    /*    malloc(256,M_ECHOBUF,M_WAITOK); */
    MALLOC(echomsg, t_echo *, sizeof(t_echo), M_ECHOBUF, M_WAITOK);
    printf("Peripherique Echo charge.\n");
    break;
  case MOD_UNLOAD:
    destroy_dev(sdev);
    FREE(echomsg,M_ECHOBUF);
    printf("Peripherique Echo decharge.\n");
    break;
  default:
    err = EINVAL;
    break;
  }
  return(err);
}

int
echo_open(dev_t dev, int oflags, int devtype, struct proc *p)
{
  int err = 0;

  uprintf("Peripherique \"echo\" ouvert avec succes.\n");
  return(err);
}

int
echo_close(dev_t dev, int fflag, int devtype, struct proc *p)
{
  uprintf("Fermeture du peripherique \"echo.\"\n");
  return(0);
}

/*
 * La fonction read prend juste comme parametre
 * le cache qui a ete sauve par l'appel à echo_write()
 * et le retourne a l'utilisateur pour acces.
 * uio(9)
 */

int
echo_read(dev_t dev, struct uio *uio, int ioflag)
{
  int err = 0;
  int amt;

  /* De quelle taille est cette operation read ?  Aussi grande que l'utilisateur le veut,
     ou aussi grande que les donnees restantes */
  amt = MIN(uio-&gt;uio_resid, (echomsg-&gt;len - uio-&gt;uio_offset &gt; 0) ? echomsg-&gt;len - uio-&gt;uio_offset : 0);
  if ((err = uiomove(echomsg-&gt;msg + uio-&gt;uio_offset,amt,uio)) != 0) {
    uprintf("uiomove echoue!\n");
  }

  return err;
}

/*
 * echo_write prend un caractere en entree et le sauve
 * dans le cache pour une utilisation ulterieure.
 */

int
echo_write(dev_t dev, struct uio *uio, int ioflag)
{
  int err = 0;

  /* Copie la chaine d'entree de la memoire de l'utilisateur a la memoire du noyau*/
  err = copyin(uio-&gt;uio_iov-&gt;iov_base, echomsg-&gt;msg, MIN(uio-&gt;uio_iov-&gt;iov_len,BUFFERSIZE));

  /* Maintenant nous avons besoin de terminer la chaine par NULL */
  *(echomsg-&gt;msg + MIN(uio-&gt;uio_iov-&gt;iov_len,BUFFERSIZE)) = 0;
  /* Enregistre la taille */
  echomsg-&gt;len = MIN(uio-&gt;uio_iov-&gt;iov_len,BUFFERSIZE);

  if (err != 0) {
    uprintf("Ecriture echouee: mauvaise adresse!\n");
  }

  count++;
  return(err);
}

DEV_MODULE(echo,echo_loader,NULL);</pre><p>Pour installer ce pilote, vous devrez d'abord créer un fichier spécial dans
      votre système de fichiers avec une commande comme : </p><pre class="screen">
	<code class="prompt">#</code> mknod /dev/echo c 33 0
</pre><p>Avec ce pilote chargé, vous devriez maintenant être capable de taper
      quelque chose comme :</p><pre class="screen">
        <code class="prompt">#</code> echo -n "Test Donnees" &gt; /dev/echo
        <code class="prompt">#</code> cat /dev/echo
	Test Donnees
</pre><p>Périphériques réels dans le chapitre suivant.</p><p>Informations additionnelles
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="http://www.daemonnews.org/200010/blueprints.html" target="_top">Dynamic
	Kernel Linker (KLD) Facility Programming Tutorial</a> -
	<a class="link" href="http://www.daemonnews.org" target="_top">Daemonnews</a> October 2000</li><li class="listitem"><a class="link" href="http://www.daemonnews.org/200007/newbus-intro.html" target="_top">How
	to Write Kernel Drivers with NEWBUS</a> - <a class="link" href="http://www.daemonnews.org" target="_top">Daemonnews</a> July
	2000</li></ul></div><p>
    </p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp66037456"></a>16.5. Pilotes Réseau</h2></div></div></div><p>Les pilotes pour périphérique réseau n'utilisent pas les fichiers spéciaux pour
      pouvoir être accessibles.  Leur sélection est basée sur d'autres décisions
      faites à l'intérieur du noyau et plutôt que d'appeler open(), l'utilisation
      d'un périphérique réseau se fait généralement en se servant de l'appel système
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=socket&amp;sektion=2"><span class="citerefentry"><span class="refentrytitle">socket</span>(2)</span></a>.</p><p>man ifnet(), périphérique "en boucle", drivers de Bill Paul,
      etc..</p></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pci"></a>Chapitre 17. Les périphériques PCI</h2></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="sect1"><a href="#idp66045648">17.1. Rechercher et rattacher</a></span></dt><dt><span class="sect1"><a href="#idp66049616">17.2. Les ressources du bus</a></span></dt></dl></div><p>Ce chapître traitera des mécanismes de FreeBSD pour
    écrire un pilote de périphérique pour un périphérique sur
    bus PCI.</p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp66045648"></a>17.1. Rechercher et rattacher</h2></div></div></div><p>Informations ici sur comment le code du bus PCI fait un cycle
      sur les périphériques non rattachés et voir si le nouvellement chargé
      pilote de périphérique chargeable dans le noyau (kld)
       sera rattaché à l'un d'eux.</p><pre class="programlisting">/*
 * Simple KLD pour jouer avec les fonctions PCI.
 *
 * Murray Stokely
 */

#define MIN(a,b) (((a) &lt; (b)) ? (a) : (b))

#include &lt;sys/types.h&gt;
#include &lt;sys/module.h&gt;
#include &lt;sys/systm.h&gt;  /* uprintf */
#include &lt;sys/errno.h&gt;
#include &lt;sys/param.h&gt;  /* defines used in kernel.h */
#include &lt;sys/kernel.h&gt; /* types used in module initialization */
#include &lt;sys/conf.h&gt;   /* cdevsw struct */
#include &lt;sys/uio.h&gt;    /* uio struct */
#include &lt;sys/malloc.h&gt;
#include &lt;sys/bus.h&gt;	/* structs, prototypes for pci bus stuff */

#include &lt;pci/pcivar.h&gt; /* For get_pci macros! */

/* Prototypes des fonctions */
d_open_t      mypci_open;
d_close_t     mypci_close;
d_read_t      mypci_read;
d_write_t     mypci_write;

/* Points d'entrée du pilote de périphérique caractère */

static struct cdevsw mypci_cdevsw = {
  mypci_open,
  mypci_close,
  mypci_read,
  mypci_write,
  noioctl,
  nopoll,
  nommap,
  nostrategy,
  "mypci",
  36,                   /* reserved for lkms - /usr/src/sys/conf/majors */
  nodump,
  nopsize,
  D_TTY,
  -1
};

/* variables */
static dev_t sdev;

/* Nous sommes plus interresses dans la recherche/attachement
que dans l'ouverture/fermeture/lecture/ecriture a ce point */

int
mypci_open(dev_t dev, int oflags, int devtype, struct proc *p)
{
  int err = 0;

  uprintf("Peripherique \"monpci\" ouvert avec succes.\n");
  return(err);
}

int
mypci_close(dev_t dev, int fflag, int devtype, struct proc *p)
{
  int err=0;

  uprintf("Peripherique \"monpci.\ "ferme\n");
  return(err);
}

int
mypci_read(dev_t dev, struct uio *uio, int ioflag)
{
  int err = 0;

  uprintf("lecture dans monpci!\n");
  return err;
}

int
mypci_write(dev_t dev, struct uio *uio, int ioflag)
{
  int err = 0;

  uprintf("Ecriture dans monpci!\n");
  return(err);
}

/* PCI Support Functions */

/*
 * Retourne la chaine d'identification si ce peripherique est le notre
 */
static int
mypci_probe(device_t dev)
{
  uprintf("MonPCI Probe\n"
	  "ID Fabricant: 0x%x\n"
	  "ID Peripherique : 0x%x\n",pci_get_vendor(dev),pci_get_device(dev));

  if (pci_get_vendor(dev) == 0x11c1) {
    uprintf("Nous avons le WinModem, recherche reussi!\n");
    return 0;
  }

  return ENXIO;
}

/* La fonction Attach n'est appelée que si
la recherche est reussie*/

static int
mypci_attach(device_t dev)
{
  uprintf("Rattachement de MonPCI pour: ID Peripherique: 0x%x\n",pci_get_vendor(dev));
  sdev = make_dev(<code class="literal">&amp;</code>mypci_cdevsw,
		  0,
		  UID_ROOT,
		  GID_WHEEL,
		  0600,
		  "monpci");
  uprintf("Peripherique Monpci charge.\n");
  return ENXIO;
}

/* Detach le peripherique. */

static int
mypci_detach(device_t dev)
{
  uprintf("Monpci detache!\n");
  return 0;
}

/* Appele lors de l'arret du systeme apres sync. */

static int
mypci_shutdown(device_t dev)
{
  uprintf("Monpci arrete!\n");
  return 0;
}

/*
 * routine de suspension du peripherique
 */
static int
mypci_suspend(device_t dev)
{
  uprintf("Monpci suspendu!\n");
  return 0;
}

/*
 * routine de reprise du peripherique
 */

static int
mypci_resume(device_t dev)
{
  uprintf("Monpci resume!\n");
  return 0;
}

static device_method_t mypci_methods[] = {
	/* Interface Peripherique*/
	DEVMETHOD(device_probe,		mypci_probe),
	DEVMETHOD(device_attach,	mypci_attach),
	DEVMETHOD(device_detach,	mypci_detach),
	DEVMETHOD(device_shutdown,	mypci_shutdown),
	DEVMETHOD(device_suspend,	mypci_suspend),
	DEVMETHOD(device_resume,	mypci_resume),

	{ 0, 0 }
};

static driver_t mypci_driver = {
	"monpci",
	mypci_methods,
	0,
	/*	sizeof(struct mypci_softc), */
};

static devclass_t mypci_devclass;

DRIVER_MODULE(mypci, pci, mypci_driver, mypci_devclass, 0, 0);</pre><p>Informations complémentaires
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="http://www.pcisig.org" target="_top">PCI
	Special Interest Group</a></li><li class="listitem">PCI System Architecture, Fourth Edition by
	Tom Shanley, et al.</li></ul></div><p>
    </p></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp66049616"></a>17.2. Les ressources du bus</h2></div></div></div><p>FreeBSD fournit un mécanisme orienté objet pour demander
      des ressources du bus parent.  Pratiquement tous les périphériques
      seront un fils membre d'un type de bus (PCI, ISA, USB, SCSI, etc)
      et ces périphériques nécessite des ressources issues de leur bus parent
      (comme des segments de mémoire, des interruptions or des canaux DMA).</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66050640"></a>17.2.1. Registres d'adresse de base</h3></div></div></div><p>Pour faire de particulièrement utile avec un périphérique PCI,
      vous aurez besoin d'obtenir les <span class="emphasis"><em>registres d'adresse de base</em></span>
       (Base Address Registers ou BARs) de l'espace de configuration PCI.
      Les détails spécifiques au PCI sur l'obtention du registre d'adresse de base
      sont masqués dans la fonction <code class="function">bus_alloc_resource()</code>.</p><p>Par exemple, un pilote typique aura sa fonction <code class="function">attach()</code>
      similaire à ceci : </p><pre class="programlisting">    sc-&gt;bar0id = 0x10;
    sc-&gt;bar0res = bus_alloc_resource(dev, SYS_RES_MEMORY, &amp;(sc-&gt;bar0id),
				  0, ~0, 1, RF_ACTIVE);
    if (sc-&gt;bar0res == NULL) {
        uprintf("Allocation memoire du registre PCI de base 0 echouee!\n");
        error = ENXIO;
        goto fail1;
    }

    sc-&gt;bar1id = 0x14;
    sc-&gt;bar1res = bus_alloc_resource(dev, SYS_RES_MEMORY, &amp;(sc-&gt;bar1id),
				  0, ~0, 1, RF_ACTIVE);
    if (sc-&gt;bar1res == NULL) {
        uprintf("Allocation memoire du registre PCI de base 1 echouee!\n");
        error =  ENXIO;
        goto fail2;
    }
    sc-&gt;bar0_bt = rman_get_bustag(sc-&gt;bar0res);
    sc-&gt;bar0_bh = rman_get_bushandle(sc-&gt;bar0res);
    sc-&gt;bar1_bt = rman_get_bustag(sc-&gt;bar1res);
    sc-&gt;bar1_bh = rman_get_bushandle(sc-&gt;bar1res);

</pre><p>Des références pour chaque registre d'adresse de base sont gardées
      dans la structure <code class="varname">softc</code> afin qu'elle puisse
      être utilisée pour écrire dans le périphérique plus tard.</p><p>Ces références peuvent alors être utilisées pour lire ou écrire
      	dans les registres du périphérique avec les fonctions <code class="function">bus_space_*</code>.
      	Par exemple, un pilote peut contenir une fonction raccourci
        pour lire dans un registre spécifique à une carte comme cela :
        </p><pre class="programlisting">uint16_t
board_read(struct ni_softc *sc, uint16_t address) {
    return bus_space_read_2(sc-&gt;bar1_bt, sc-&gt;bar1_bh, address);
}
</pre><p>De façon similaire, une autre peut écrire dans les registres avec : </p><pre class="programlisting">void
board_write(struct ni_softc *sc, uint16_t address, uint16_t value) {
    bus_space_write_2(sc-&gt;bar1_bt, sc-&gt;bar1_bh, address, value);
}
</pre><p>Ces fonctions existent en versions 8bit, 16bit et 32bit
        et vous devriez utiliser
        <code class="function">bus_space_{read|write}_{1|2|4}</code>
        en conséquence.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66069712"></a>17.2.2. Les interruptions</h3></div></div></div><p>Les interruptions sont alloués à partir du code orienté objet du
         bus de façon similaire aux ressources mémoire. D'abord une ressource
         IRQ doit être allouée à partir du bus parent, et alors le
        gestionnaire d'interruption doit être règlé pour traiter cet IRQ.</p><p>A nouveau, un exemple de fonction
        <code class="function">attach()</code> en dit plusqu'un long discours.</p><pre class="programlisting">/* Recupere la ressource IRQ */

    sc-&gt;irqid = 0x0;
    sc-&gt;irqres = bus_alloc_resource(dev, SYS_RES_IRQ, &amp;(sc-&gt;irqid),
				  0, ~0, 1, RF_SHAREABLE | RF_ACTIVE);
    if (sc-&gt;irqres == NULL) {
	uprintf("Allocation IRQ echouee!\n");
	error = ENXIO;
	goto fail3;
    }

    /* Maitnenant nous choisissons notre gestionnaire d'interruption */

    error = bus_setup_intr(dev, sc-&gt;irqres, INTR_TYPE_MISC,
			   my_handler, sc, &amp;(sc-&gt;handler));
    if (error) {
	printf("Ne peut regler l'IRQ\n");
	goto fail4;
    }

    sc-&gt;irq_bt = rman_get_bustag(sc-&gt;irqres);
    sc-&gt;irq_bh = rman_get_bushandle(sc-&gt;irqres);
</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66072016"></a>17.2.3. DMA</h3></div></div></div><p>Sur les PC, les périphériques qui veulent utiliser la gestion de
      bus DMA doivent travailler avec des adresses physiques. C'est un problème
      puisque FreeBSD utilise une mémoire virtuelle et travaille presque
      exclusivement avec des adresses virtuelles. Heureusement, il y a une
      fonction <code class="function">vtophys()</code> pour nous aider.</p><pre class="programlisting">#include &lt;vm/vm.h&gt;
#include &lt;vm/pmap.h&gt;

#define vtophys(virtual_address) (...)
</pre><p>La solution est toutefois un peu différente sur Alpha, et
        ce que nous voulons réellement est une fonction appelée
        <code class="function">vtobus()</code>.</p><pre class="programlisting">#if defined(__alpha__)
#define vtobus(va)      alpha_XXX_dmamap((vm_offset_t)va)
#else
#define vtobus(va)      vtophys(va)
#endif
</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66075216"></a>17.2.4. Désallouer les resources</h3></div></div></div><p>Il est très important de désallouer toutes les ressources
        qui furent allouées pendant <code class="function">attach()</code>.
        Unsoin tout particulier doit être pris pour désallouer
        les bonnes choses même lors d'un échec afin que le système reste
        utilisable lorsque votre driver meurt.</p></div></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="scsi"></a>Chapitre 18. Contrôleurs SCSI Common Access Method (CAM) **</h2></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="sect1"><a href="#idp66078160">18.1. En cours de traduction</a></span></dt></dl></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp66078160"></a>18.1. En cours de traduction</h2></div></div></div><p>En cours de traduction</p></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="usb"></a>Chapitre 19. Périphériques USB ***</h2></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="sect1"><a href="#idp66080976">19.1. Introduction</a></span></dt></dl></div><p><span class="emphasis"><em>Ce chapître a été écrit par Nick Hibma. Les modifications pour le
  manuel par Murray Stokely.</em></span></p><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="idp66080976"></a>19.1. Introduction</h2></div></div></div><p>Chapître à traduire.</p></div></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="newbus"></a>Chapitre 20. NewBus</h2></div></div></div><p>Ce chapître traitera de l'architecture NewBus de FreeBSD.</p></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="architectures"></a>Partie XII. Architectures</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#ia32">21. IA-32</a></span></dt><dt><span class="chapter"><a href="#alpha">22. Alpha</a></span></dt><dt><span class="chapter"><a href="#ia64">23. IA-64</a></span></dt></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ia32"></a>Chapitre 21. IA-32</h2></div></div></div><p>Traite des spécificités de l'architecture x86 sous FreeBSD.</p></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="alpha"></a>Chapitre 22. Alpha</h2></div></div></div><p>Traite des spécificités de l'architecture Alpha sous FreeBSD.</p><p>Explication des erreurs d'alignements, comment les réparer,
      comment les ignorer.</p><p>Exemple de code assembleur pour FreeBSD/alpha.</p></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="ia64"></a>Chapitre 23. IA-64</h2></div></div></div><p>Traite des spécificités de l'architecture IA-64 sous FreeBSD.</p></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="debuggingpart"></a>Partie XIII. Déverminage</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#truss">24. Truss</a></span></dt></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="truss"></a>Chapitre 24. Truss</h2></div></div></div><p>diverses descriptions sur les méthodes de déverminage de certains aspects
       du système utilisant truss, ktrace, gdb, kgdb, etc</p></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="compatibility"></a>Partie XIV. Les couches de compatibilité</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="chapter"><a href="#linux">25. Linux</a></span></dt></dl></div><div class="chapter"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="linux"></a>Chapitre 25. Linux</h2></div></div></div><p>Linux, SVR4, etc</p></div></div><div class="part"><div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="appendices"></a>Partie XV. Bibligraphie</h1></div></div></div><div class="toc"><div class="toc-title">Table des matières</div><dl class="toc"><dt><span class="bibliography"><a href="#idp66099152">Bibliographie</a></span></dt></dl></div><div class="bibliography"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp66099152"></a>Bibliographie</h2></div></div></div><div class="biblioentry"><a id="COD"></a><p>[1] <span class="authorgroup"><span class="firstname">Dave</span> <span class="othername">A</span> <span class="surname">Patterson</span> et <span class="firstname">John</span> <span class="othername">L</span> <span class="surname">Hennessy</span>. </span><span class="copyright">Copyright © 1998 Morgan Kaufmann Publishers,
        Inc.. </span><span class="biblioid">1-55860-428-6. </span><span class="publisher"><span class="publishername">Morgan Kaufmann Publishers, Inc.. </span></span><span class="citetitle"><em class="citetitle">Computer Organization and Design</em>. </span><span class="subtitle">The Hardware / Software Interface. </span><span class="pagenums">1-2. </span></p></div><div class="biblioentry"><a id="idp66110416"></a><p>[2] <span class="authorgroup"><span class="firstname">W.</span> <span class="othername">Richard</span> <span class="surname">Stevens</span>. </span><span class="copyright">Copyright © 1993 Addison Wesley Longman,
        Inc.. </span><span class="biblioid">0-201-56317-7. </span><span class="publisher"><span class="publishername">Addison Wesley Longman, Inc.. </span></span><span class="citetitle"><em class="citetitle">Advanced Programming in the Unix Environment</em>. </span><span class="pagenums">1-2. </span></p></div><div class="biblioentry"><a id="idp66115536"></a><p>[3] <span class="authorgroup"><span class="firstname">Marshall</span> <span class="othername">Kirk</span> <span class="surname">McKusick</span>, <span class="firstname">Keith</span> <span class="surname">Bostic</span>, <span class="firstname">Michael</span> <span class="othername">J</span> <span class="surname">Karels</span>, et <span class="firstname">John</span> <span class="othername">S</span> <span class="surname">Quarterman</span>. </span><span class="copyright">Copyright © 1996 Addison-Wesley Publishing Company,
        Inc.. </span><span class="biblioid">0-201-54979-4. </span><span class="publisher"><span class="publishername">Addison-Wesley Publishing Company, Inc.. </span></span><span class="citetitle"><em class="citetitle">The Design and Implementation of the 4.4 BSD Operating System</em>. </span><span class="pagenums">1-2. </span></p></div><div class="biblioentry"><a id="Phrack"></a><p>[4] <span class="authorgroup"><span class="firstname">Aleph</span> <span class="surname">One</span>. </span><span class="citetitle"><em class="citetitle">Phrack 49; "Smashing the Stack for Fun and Profit"</em>. </span></p></div><div class="biblioentry"><a id="StackGuard"></a><p>[5] <span class="authorgroup"><span class="firstname">Chrispin</span> <span class="surname">Cowan</span>, <span class="firstname">Calton</span> <span class="surname">Pu</span>, et <span class="firstname">Dave</span> <span class="surname">Maier</span>. </span><span class="citetitle"><em class="citetitle">StackGuard; Automatic Adaptive Detection and Prevention of
        Buffer-Overflow Attacks</em>. </span></p></div><div class="biblioentry"><a id="OpenBSD"></a><p>[6] <span class="authorgroup"><span class="firstname">Todd</span> <span class="surname">Miller</span> et <span class="firstname">Theo</span> <span class="surname">de Raadt</span>. </span><span class="citetitle"><em class="citetitle">strlcpy and strlcat -- consistent, safe string copy and
	concatenation.</em>. </span></p></div></div></div></div></body></html>