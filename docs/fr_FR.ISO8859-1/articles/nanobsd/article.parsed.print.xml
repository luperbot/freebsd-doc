<?xml version="1.0" encoding="iso-8859-1"?>
<!--
    The FreeBSD Documentation Project
    The FreeBSD French Documentation Project

    $FreeBSD$
    Original revision: 1.2
-->
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:lang="fr">

  <info><title xmlns:xlink="http://www.w3.org/1999/xlink">Introduction à NanoBSD</title>
    

    <authorgroup xmlns:xlink="http://www.w3.org/1999/xlink">
      <author xmlns:xlink="http://www.w3.org/1999/xlink"><personname xmlns:xlink="http://www.w3.org/1999/xlink"><firstname xmlns:xlink="http://www.w3.org/1999/xlink">Daniel</firstname><surname xmlns:xlink="http://www.w3.org/1999/xlink">Gerzo</surname></personname></author>
    </authorgroup>

    <copyright xmlns:xlink="http://www.w3.org/1999/xlink">
      <year xmlns:xlink="http://www.w3.org/1999/xlink">2006</year>
      <holder xmlns:xlink="http://www.w3.org/1999/xlink">The FreeBSD Documentation Project</holder>
    </copyright>

    <legalnotice xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="trademarks" role="trademarks">
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">FreeBSD is a registered trademark of
  the FreeBSD Foundation.</para>
      <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">Many of the designations used by
  manufacturers and sellers to distinguish their products are claimed
  as trademarks.  Where those designations appear in this document,
  and the FreeBSD Project was aware of the trademark claim, the
  designations have been followed by the <quote xmlns:xlink="http://www.w3.org/1999/xlink">&#8482;</quote> or the
  <quote xmlns:xlink="http://www.w3.org/1999/xlink">®</quote> symbol.</para>
    </legalnotice>

    <pubdate xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</pubdate>

    <releaseinfo xmlns:xlink="http://www.w3.org/1999/xlink">$FreeBSD$</releaseinfo>

    <abstract xmlns:xlink="http://www.w3.org/1999/xlink">
      <para xmlns:xlink="http://www.w3.org/1999/xlink">Ce document fournit des informations à propos des
	outils <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>, qui peuvent
	être utilisés pour créer des images du
	système FreeBSD pour des applications embarquées,
	adaptées pour utiliser comme support une carte Compact
	Flash (ou tout autre support de stockage).</para>
        <para xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><emphasis xmlns:xlink="http://www.w3.org/1999/xlink">Version française de Jean-Loic Tignon
  <email xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">loic@vigilan.net</email>.</emphasis></para>
    </abstract>
  </info>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="intro">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Introduction à NanoBSD</title>

    <indexterm xmlns:xlink="http://www.w3.org/1999/xlink"><primary xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</primary></indexterm>

    <para xmlns:xlink="http://www.w3.org/1999/xlink"><application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application> est un outil actuellement
      développé par Poul-Henning Kamp.  Il permet de créer
      une image du système FreeBSD pour des applications
      embarquées, pouvant utiliser une carte Compact Flash
      comme support (ou un autre support de stockage)</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Il peut être utilisé pour créer des
      images d'installation spécialisées, conçues
      pour une installation et une maintenance aisées de
      systèmes communément appelés
      <quote xmlns:xlink="http://www.w3.org/1999/xlink">appliances</quote>.  Les appliances ont leur
      matériel et leur logiciel intégrés dans le
      produit, ce qui signifie que toutes les applications sont
      pré-installées.  L'appliance est connectée
      à un réseau existant et peut entrer en fonction
      (presque) immédiatement.</para>

    <para xmlns:xlink="http://www.w3.org/1999/xlink">Les fonctionnalités de
      <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application> incluent:</para>

    <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Les logiciels portés et les paquetages
	  fonctionnent comme sous FreeBSD &#8212; Chaque application peut
	  être installée et utilisée dans une
	  image <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>, de la même
	  façon que sous FreeBSD.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Aucune fonctionnalité ne manque &#8212; S'il est
	  possible de faire quelque chose avec FreeBSD, il sera possible
	  de faire la même chose avec
	  <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>, sauf si la
	  fonctionnalité spécifique ou des
	  fonctionnalités ont été explicitement
	  supprimées de l'image
	  <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application> lors de sa
	  création.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Tout est en lecture seule pendant l'exécution
	  &#8212; Débrancher le cordon d'alimentation est sans
	  danger.  Il n'est pas nécessaire d'exécuter
	  <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">fsck</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> après un arrêt inopiné du
	  système.</para>
      </listitem>

      <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">Facile à créer et à personnaliser
	  &#8212; A l'aide d'une seule procédure et d'un
	  fichier de configuration il est possible de créer des
	  images personnalisées et de taille réduite
	  répondant à n'importe quel type de
	  besoin.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="howto">
    <title xmlns:xlink="http://www.w3.org/1999/xlink">Comment utiliser NanoBSD</title>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="design">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">L'organisation de NanoBSD</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Une fois que l'image est présente sur le support,
	il est possible de démarrer
	<application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>.  Le
	périphérique de stockage est divisé en
	trois parties par défaut:</para>

      <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Deux partitions image: <literal xmlns:xlink="http://www.w3.org/1999/xlink">code#1</literal>
	    et <literal xmlns:xlink="http://www.w3.org/1999/xlink">code#2</literal>.</para>
	</listitem>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">La partition de configuration, qui peut être
	    montée sur le répertoire <filename xmlns:xlink="http://www.w3.org/1999/xlink">/cfg</filename> à
	    l'exécution.</para>
	</listitem>
      </itemizedlist>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Ces partitions sont normalement montées en lecture
	seule.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Les répertoires <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc</filename> et <filename xmlns:xlink="http://www.w3.org/1999/xlink">/var</filename> sont des disques <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">md</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">4</manvolnum></citerefentry>
	(malloc).</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">La partition de configuration est montée sur le
	répertoire <filename xmlns:xlink="http://www.w3.org/1999/xlink">/cfg</filename>.
	Elle contient les fichiers du répertoire <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc</filename> et est brièvement
	montée en lecture seule juste après le
	démarrage du système, par conséquent il
	est nécessaire de recopier les fichiers modifiés
	de <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc</filename> vers le
	répertoire <filename xmlns:xlink="http://www.w3.org/1999/xlink">/cfg</filename>
	si l'on souhaite que les changements soient encore effectifs
	après le redémarrage du système.</para>

      <example xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Apporter des changements permanents à
	  <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc/resolv.conf</filename></title>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">vi /etc/resolv.conf</userinput>
[...]
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">mount /cfg</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">cp /etc/resolv.conf /cfg</userinput>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">umount /cfg</userinput></screen>
      </example>

      <note xmlns:xlink="http://www.w3.org/1999/xlink">
	<para xmlns:xlink="http://www.w3.org/1999/xlink">La partition qui abrite <filename xmlns:xlink="http://www.w3.org/1999/xlink">/cfg</filename> doit être
	  montée uniquement au démarrage et lors de la
	  copie des fichiers de configuration.</para>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Garder <filename xmlns:xlink="http://www.w3.org/1999/xlink">/cfg</filename>
	  monté en permanence n'est pas une bonne idée,
	  en particulier si le système
	  <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application> tourne sur un
	  périphérique de stockage qui peut être
	  endommagé par un grand nombre d'écritures sur
	  la partition (c'est à dire quand le contenu des
	  tampons de données est transféré sur
	  les disques).</para>
      </note>
    </sect2>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Créer une image NanoBSD</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Une image <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application> est
	créée à l'aide d'une simple
	procédure <filename xmlns:xlink="http://www.w3.org/1999/xlink">nanobsd.sh</filename>, qui peut
	être trouvée dans le répertoire <filename xmlns:xlink="http://www.w3.org/1999/xlink">/usr/src/tools/tools/nanobsd</filename>.
	Ce programme crée une image, qui peut être
	copiée sur le support de stockage à l'aide de
	<citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">dd</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry>.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Les commandes nécessaires à la
	création d'une image <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>
	sont:</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">cd /usr/src/tools/tools/nanobsd</userinput> <co xml:id="nbsd-cd"/>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">sh nanobsd.sh</userinput> <co xml:id="nbsd-sh"/>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">cd /usr/obj/nanobsd.full</userinput> <co xml:id="nbsd-cd2"/>
<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">dd if=_.disk.full of=/dev/da0 bs=64k</userinput> <co xml:id="nbsd-dd"/></screen>

      <calloutlist xmlns:xlink="http://www.w3.org/1999/xlink">
	<callout arearefs="nbsd-cd">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Se placer dans le répertoire de base du
	    programme de création de
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>.</para>
	</callout>

	<callout arearefs="nbsd-sh">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Démarrer le processus de
	    création.</para>
	</callout>

	<callout arearefs="nbsd-cd2">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Se placer dans le répertoire où les
	    images ont été créees.</para>
	</callout>

	<callout arearefs="nbsd-dd">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Installer <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application> sur le
	    support de stockage.</para>
	</callout>
      </calloutlist>
    </sect2>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Personnaliser une image NanoBSD</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">C'est probablement la fonctionnalité la plus
	importante et la plus intéressante de
	<application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>.  C'est aussi là
	où vous passerez le plus de temps lors de vos
	développements avec
	<application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">L'invocation de la commande suivante va obliger
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">nanobsd.sh</filename> à lire sa configuration
	dans le fichier <filename xmlns:xlink="http://www.w3.org/1999/xlink">myconf.nano</filename> situé
	dans le répertoire courant:</para>

      <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">sh nanobsd.sh -c myconf.nano</userinput></screen>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">La personnalisation est effectuée de 2
	façons:</para>

      <itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">à l'aide d'options de configuration</para>
	</listitem>

	<listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">à l'aide de fonctions de
	    personnalisation</para>
	</listitem>
      </itemizedlist>

      <sect3 xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Les options de configuration</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Grace aux paramètres de configuration, il est
	  possible de configurer des options qui sont passées
	  aux étapes <literal xmlns:xlink="http://www.w3.org/1999/xlink">buildworld</literal> et
	  <literal xmlns:xlink="http://www.w3.org/1999/xlink">installworld</literal> du processus de compilation
	  de <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>, ainsi que des options
	  internes qui sont passées au processus principal de
	  compilation de <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>.  A l'aide
	  de ces options, il est possible de diminuer la taille du
	  système, de façon à ce qu'il tienne
	  dans 64Mo.  Vous pouvez utiliser les options de
	  configuration pour réduire encore plus FreeBSD,
	  jusqu'à ce qu'il ne consiste plus qu'en un noyau et 2
	  ou 3 fichiers dans le système de base.</para>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Le fichier de configuration consiste en une série
	  d'options de configuration, qui surchargent les valeurs par
	  défaut.  Les directives les plus importantes
	  sont:</para>

	<itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">NANO_NAME</literal> &#8212; Nom de
	      compilation (utilisé pour créer le nom des
	      répertoires de travail).</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">NANO_SRC</literal> &#8212; Chemin de
	      l'arbre des sources utilisé pour construire
	      l'image.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">NANO_KERNEL</literal> &#8212; Nom du
	      fichier de configuration utilisé pour compiler le
	      noyau.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">CONF_BUILD</literal> &#8212; Options
	      passées à la phase
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">buildworld</literal> de la compilation.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">CONF_INSTALL</literal> &#8212; Options
	      passées à la phase
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">installworld</literal> de la
	      compilation.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">CONF_WORLD</literal> &#8212; Options
	      passées aux étapes
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">buildworld</literal> et
	      <literal xmlns:xlink="http://www.w3.org/1999/xlink">installworld</literal>.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">FlashDevice</literal> &#8212;
	      Définit le type de support à utiliser.
	      Consulter le fichier
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">FlashDevice.sub</filename> pour plus de
	      détails.</para>
	  </listitem>
	</itemizedlist>
      </sect3>

      <sect3 xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Les fonctions de personnalisation</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Il est possible d'optimiser
	  <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application> en utilisant des
	  fonctions d'interpréteur de commandes dans le fichier
	  de configuration.  L'exemple suivant présente la
	  trame de base des fonctions de personnalisation:</para>

	  <programlisting xmlns:xlink="http://www.w3.org/1999/xlink">cust_foo () (
	echo "bar=topless" &gt; \
		${NANO_WORLDDIR}/etc/foo
)
customize_cmd cust_foo</programlisting>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Un exemple plus utile de fonction de personnalisation
	  est le suivant, qui change la taille par défaut du
	  répertoire <filename xmlns:xlink="http://www.w3.org/1999/xlink">/etc</filename>
	  de 5Mo à 30Mo:</para>

	<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">cust_etc_size () (
	cd ${NANO_WORLDDIR}/conf
	echo 30000 &gt; default/etc/md_size
)
customize_cmd cust_etc_size</programlisting>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Il existe par défaut quelques fonctions de
	  personnalisation prédéfinies et prêtes
	  à être utilisées:</para>

	<itemizedlist xmlns:xlink="http://www.w3.org/1999/xlink">
	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">cust_comconsole</literal> &#8212;
	      Désactive <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">getty</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry> sur les consoles VGA (les
	      périphériques
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">/dev/ttyv*</filename>) et paramètre la
	      console système sur le port série
	      COM1.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">cust_allow_ssh_root</literal> &#8212;
	      Autorise l'ouverture de sessions
	      <systemitem xmlns:xlink="http://www.w3.org/1999/xlink" class="username">root</systemitem> via <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">sshd</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry>.</para>
	  </listitem>

	  <listitem xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink"><literal xmlns:xlink="http://www.w3.org/1999/xlink">cust_install_files</literal> &#8212;
	      Installe les fichiers du répertoire <filename xmlns:xlink="http://www.w3.org/1999/xlink">nanobsd/Files</filename>, qui contient
	      des programmes utiles pour l'administration
	      système.</para>
	  </listitem>
	</itemizedlist>
      </sect3>

      <sect3 xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Exemple de fichier de configuration</title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Un exemple complet de fichier de configuration pour
	  créer une image <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>
	  personnalisée peut être:</para>

	<programlisting xmlns:xlink="http://www.w3.org/1999/xlink">NANO_NAME=custom
NANO_SRC=/usr/src
NANO_KERNEL=MYKERNEL
NANO_IMAGES=2

CONF_BUILD='
NO_KLDLOAD=YES
NO_NETGRAPH=YES
NO_PAM=YES
'

CONF_INSTALL='
NO_ACPI=YES
NO_BLUETOOTH=YES
NO_CVS=YES
NO_FORTRAN=YES
NO_HTML=YES
NO_LPR=YES
NO_MAN=YES
NO_SENDMAIL=YES
NO_SHAREDOCS=YES
NO_EXAMPLES=YES
NO_INSTALLLIB=YES
NO_CALENDAR=YES
NO_MISC=YES
NO_SHARE=YES
'

CONF_WORLD='
NO_BIND=YES
NO_MODULES=YES
NO_KERBEROS=YES
NO_GAMES=YES
NO_RESCUE=YES
NO_LOCALES=YES
NO_SYSCONS=YES
NO_INFO=YES
'

FlashDevice SanDisk 1G

cust_nobeastie() (
	touch ${NANO_WORLDDIR}/boot/loader.conf
	echo "beastie_disable=\"YES\"" &gt;&gt; ${NANO_WORLDDIR}/boot/loader.conf
)

customize_cmd cust_comconsole
customize_cmd cust_install_files
customize_cmd cust_allow_ssh_root
customize_cmd cust_nobeastie</programlisting>
      </sect3>
    </sect2>

    <sect2 xmlns:xlink="http://www.w3.org/1999/xlink">
      <title xmlns:xlink="http://www.w3.org/1999/xlink">Mettre à jour NanoBSD</title>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Le processus de mise à jour de
	<application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application> est relativement
	simple:</para>

      <procedure xmlns:xlink="http://www.w3.org/1999/xlink">
	<step xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Créer une nouvelle image
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>, comme
	    d'habitude.</para>
	</step>

	<step xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Télécharger la nouvelle image dans une
	    partition inutilisée d'une appliance
	    <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>
	    opérationnelle.</para>

	  <para xmlns:xlink="http://www.w3.org/1999/xlink">La différence la plus importante de cette
	    étape par rapport à l'installation initiale
	    de <application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application> est que maintenant
	    au lieu d'utiliser le fichier
	    <filename xmlns:xlink="http://www.w3.org/1999/xlink">_.disk.full</filename> (qui contient une image
	    de la totalité du disque), l'image
	    <filename xmlns:xlink="http://www.w3.org/1999/xlink">_.disk.image</filename> est installée
	    (qui contient seulement l'image d'une seule partition
	    système).</para>
	</step>

	<step xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Redémarrer le système sur la nouvelle
	    partition.</para>
	</step>

	<step xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Si tout s'est bien passé, la mise à jour
	    est terminée.</para>
	</step>

	<step xmlns:xlink="http://www.w3.org/1999/xlink">
	  <para xmlns:xlink="http://www.w3.org/1999/xlink">Si quelque chose s'est mal passé,
	    redémarrez de nouveau sur la partition
	    précédente (qui contient l'ancienne image,
	    fonctionnelle celle-ci), pour remettre le système
	    en état de marche le plus rapidement possible.
	    Corriger les problèmes de la nouvelle image, et
	    répéter le processus.</para>
	</step>
      </procedure>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">Pour installer la nouvelle image sur le système
	<application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application> opérationnel, il est
	possible d'utiliser la procédure
	<filename xmlns:xlink="http://www.w3.org/1999/xlink">updatep1</filename> ou <filename xmlns:xlink="http://www.w3.org/1999/xlink">updatep2</filename>
	située dans le répertoire <filename xmlns:xlink="http://www.w3.org/1999/xlink">/root</filename>, en fonction de la partition
	qui est en cours d'utilisation sur le système.</para>

      <para xmlns:xlink="http://www.w3.org/1999/xlink">En fonction des services disponibles sur la machine qui
	dispose de la nouvelle image
	<application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application> et du type de transfert qui
	est préféré, il est possible d'utiliser
	une de ces trois méthodes:</para>

      <sect3 xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Utiliser <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">ftp</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry></title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Si la vitesse de transfert est la priorité,
	  utiliser cet exemple:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ftp myhost
get _.disk.image "| sh updatep1"</userinput></screen>
      </sect3>

      <sect3 xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Utiliser <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">ssh</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry></title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Si un transfert sécurisé est
	  préférable, considérer l'utilisation de
	  cet exemple:</para>

	<screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">ssh myhost cat _.disk.image.gz | zcat | sh updatep1</userinput></screen>
      </sect3>

      <sect3 xmlns:xlink="http://www.w3.org/1999/xlink">
	<title xmlns:xlink="http://www.w3.org/1999/xlink">Utiliser <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">nc</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry></title>

	<para xmlns:xlink="http://www.w3.org/1999/xlink">Utiliser cet exemple si la machine distante n'utilise ni
	  <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">ftp</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">1</manvolnum></citerefentry> ni <citerefentry xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"><refentrytitle xmlns:xlink="http://www.w3.org/1999/xlink">sshd</refentrytitle><manvolnum xmlns:xlink="http://www.w3.org/1999/xlink">8</manvolnum></citerefentry>:</para>

	<procedure xmlns:xlink="http://www.w3.org/1999/xlink">
	  <step xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Tout d'abord, ouvrez un écouteur TCP sur la
	      machine qui dispose de l'image et faites-lui envoyer
	      l'image au client:</para>

	    <screen xmlns:xlink="http://www.w3.org/1999/xlink">myhost<prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">nc -l 2222 &lt; _.disk.image</userinput></screen>

	    <note xmlns:xlink="http://www.w3.org/1999/xlink">
	      <para xmlns:xlink="http://www.w3.org/1999/xlink">Assurez vous que le port utilisé n'est pas
		bloqué par un pare-feu afin de recevoir les
		connexions entrantes de la machine
		<application xmlns:xlink="http://www.w3.org/1999/xlink">NanoBSD</application>.</para>
	    </note>
	  </step>
	  <step xmlns:xlink="http://www.w3.org/1999/xlink">
	    <para xmlns:xlink="http://www.w3.org/1999/xlink">Se connecter à la machine qui dispose de la
	      nouvelle image et exécuter la procédure
	      <filename xmlns:xlink="http://www.w3.org/1999/xlink">updatep1</filename>:</para>

	    <screen xmlns:xlink="http://www.w3.org/1999/xlink"><prompt xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">#</prompt> <userinput xmlns:xlink="http://www.w3.org/1999/xlink">nc myhost 2222 | sh updatep1</userinput></screen>
	  </step>
	</procedure>
      </sect3>
    </sect2>
  </sect1>

  <index xmlns:xlink="http://www.w3.org/1999/xlink"/>
</article>
