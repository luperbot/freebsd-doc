<?xml version="1.0" encoding="iso-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /><title>3. Les bases de PAM</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Pluggable Authentication Modules" /><link rel="up" href="index.html" title="Pluggable Authentication Modules" /><link rel="prev" href="pam-terms.html" title="2. Termes et conventions" /><link rel="next" href="pam-config.html" title="4. Configuration de PAM" /><link rel="copyright" href="pam-legalnotice.html" title="Note légale" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. Les bases de PAM</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="pam-terms.html">Précédent</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="pam-config.html">Suivant</a></td></tr></table><hr /></div><div class="section"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="pam-essentials"></a>3. Les bases de PAM</h2></div></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-facilities-primitives"></a>3.1. Mécanismes et primitives</h3></div></div></div><p>L'API   PAM  fournit  six   primitives  d'authentification
		différentes  regroupées dans quatre  mécanismes qui  seront décrits
		dans la partie suivante.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">auth</code></span></dt><dd><p><span class="emphasis"><em>Authentification.</em></span>    Ce   mécanisme
	      concerne  l'authentification  du  demandeur  et  établit  les
	      droits du compte. Il fournit deux primitives :</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_authenticate&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_authenticate</span>(3)</span></a>    authentifie    le   demandeur,
		généralement  en demandant  un jeton  d'identification et  en le
		comparant  a une  valeur stockée  dans une  base de  données ou
		obtenue par le biais d'un serveur d'authentification.</p></li><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_setcred&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_setcred</span>(3)</span></a>  établi les  paramètres du  compte tel
		que l'uid, les groupes dont  le compte fait parti ou les limites
		sur l'utilisation des ressources.</p></li></ul></div></dd><dt><span class="term"><code class="literal">account</code></span></dt><dd><p><span class="emphasis"><em>Gestion  de  compte.</em></span>  Ce  mécanisme
	    concerne la  disponibilité du  compte pour des raisons autres que
	    l'authentification.  Par exemple  les  restrictions basées  sur
	    l'heure courante ou la charge  du serveur. Il fournit une seule
	    primitive:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_acct_mgmt&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_acct_mgmt</span>(3)</span></a>  vérifie que  le compte  demandé est
		disponible.</p></li></ul></div></dd><dt><span class="term"><code class="literal">session</code></span></dt><dd><p><span class="emphasis"><em>Gestion  de  session.</em></span> Ce  mécanisme
	    concerne la mise en place de la session  et sa terminaison, par
	    exemple l'enregistrement  de la  session dans les  journaux. Il
	    fournit deux primitives:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_open_session&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_open_session</span>(3)</span></a> accomplie  les tâches associées à
		la mise  en place  d'une session :  ajouter une entrée  dans les
		bases  <code class="filename">utmp</code>  et  <code class="filename">wtmp</code>,
		démarrer un agent SSH...</p></li><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_close_session&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_close_session</span>(3)</span></a> accomplie les tâches associées à
		la terminaison d'une session : ajouter une entrée dans les bases
		<code class="filename">utmp</code>  et <code class="filename">wtmp</code>, arrêter
		l'agent SSH...</p></li></ul></div></dd><dt><span class="term"><code class="literal">password</code></span></dt><dd><p><span class="emphasis"><em>Gestion   des  mots  de   passe.</em></span>  Ce
	 mécanisme est  utilisé pour modifier  le jeton d'authentification
	 associé à un  compte, soit parce qu'il a expiré,  soit parce que
	 l'utilisateur   désire   le   changer.   Il  fournit   une   seule
	 primitive:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_chauthtok&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_chauthtok</span>(3)</span></a> modifie le jeton d'authentification,
		et éventuellement vérifie que celui-ci est assez robuste pour ne
		pas  être  deviné  facilement  ou  qu'il  n'a  pas  déjà utilisé.
		</p></li></ul></div></dd></dl></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-modules"></a>3.2. Modules</h3></div></div></div><p>Les modules  sont le concept  clef de PAM; après  tout ils
      constituent  le  <span class="quote">« <span class="quote">M</span> »</span>  de  PAM. Un  module  PAM  est
      lui-même un  morceau de code qui implémente  les primitives d'un
      ou   plusieurs   mécanismes    pour   une   forme   particulière
      d'authentification; par  exemple, les bases de mots  de passe UNIX
      que sont NIS, LDAP et Radius.</p><div class="section"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-module-naming"></a>3.2.1. Nom des modules</h4></div></div></div><p>FreeBSD implémente chaque  mécanismes dans un module distinct
	  nommé
	  <code class="literal">pam_mécanisme.so</code>
	  (par  exemple  <code class="literal">pam_unix.so</code>  pour le  mécanisme
	  Unix  .)   Les autres  implementations  possèdent  parfois des  modules
	  séparés pour  des mécanismes séparés et incluent aussi  bien le
	  nom du service  que celui du mécanisme dans le  nom du module. Un
	  exemple  est le  module  <code class="literal">pam_dial_auth.so.1</code> de
	  Solaris  qui  est  utilisé  pour  authentifier  les  utilisateurs
	  dialup.</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-module-versioning"></a>3.2.2. Gestion des versions de module </h4></div></div></div><p>L'implémentation  originale  de PAM  par  FreeBSD, basée  sur
	Linux-PAM, n'utilisait  pas de numéro  de version pour  les modules
	PAM. Ceci peut poser des  problèmes avec les applications tiers qui
	peuvent être liées avec  d'anciennes bibliothèques systèmes, puisqu'il
	n'y  a pas  possibilité  de charger  la  version correspondante  du
	module désiré.</p><p>Pour  sa part,  OpenPAM cherche  les  modules qui  ont la  même
	version que la bibliothèque PAM (pour le moment 2) et se rabat sur
	un module  sans version si aucun  module avec version  n'a put être
	chargé.  Ainsi les anciens  modules peuvent  être fournis  pour les
	anciennes  applications,   tout  en  permettant   aux  nouvelles applications
	(ou  bien nouvellement  compilées)  de  tirer parti  des
	modules les plus récents.</p><p>Bien que les modules PAM de Solaris possèdent généralement un
	numéro de version, ils ne sont pas réellement versionnés car
	le numéro  correspond à une  partie du nom  du module et  doit être
	inclus dans la configuration.</p></div></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-chains-policies"></a>3.3. Chaînes et politiques</h3></div></div></div><p>Lorsqu'un   serveur  initie   une   transaction  PAM,   la
      bibliothèque PAM essaie de  charger une politique pour le service
      spécifié  dans  l'appel  a  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_start&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_start</span>(3)</span></a>  .   La  politique
      indique comment la requête d'authentification doit être traitée
      et est définie dans un  fichier de configuration. Il  s'agit de
      l'autre   concept    clef   de   PAM :    la   possibilité   pour
      l'administrateur  de  configurer  la  politique de  sécurité  d'un
      système en éditant simplement une fichier texte.</p><p>Une politique consiste en quatre chaînes, une pour chacune
      des  quatre mécanismes  de PAM. Chaque  chaîne est  une  suite de
      règles  de  configuration,  chacune  spécifiant un  module  à
      invoquer, des paramètres, options,  à passer au module et un
      drapeau de  contrôle qui décrit  comment interpréter le  code de
      retour du module.</p><p>Comprendre  le  drapeau  de  contrôle est  essentiel  pour
      comprendre  les  fichiers de  configuration  de  PAM. Il  existe
      quatre drapeaux de contrôle différents :</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">binding</code></span></dt><dd><p>Si le  module réussit et qu'aucun module  précédent de la
	    chaîne n'a  échoué, la chaîne s'interrompt  immédiatement et la
	    requête  est autorisée.  Si le  module échoue  le reste  de la
	    chaîne   est  exécuté,   mais   la  requête   est  rejetée   au
	    final.</p><p>Ce drapeau  de contrôle a  été introduit par  Sun Solaris
	    dans la  version 9  (SunOS 5.9);  il est aussi  supporté par
	    OpenPAM.</p></dd><dt><span class="term"><code class="literal">required</code></span></dt><dd><p>Si le module réussit, le  reste de la chaîne est exécuté,
	    et  la  requête est  autorisée  si  aucun  des autres  modules
	    n'échoue.  Si le  module  échoue,  le reste  de  la chaîne  est
	    exécuté, mais au final la requête est rejetée.</p></dd><dt><span class="term"><code class="literal">requisite</code></span></dt><dd><p>Si le module  réussit le reste de la  chaîne est exécuté,
	    et  la   requête  est   autorisée  sauf  si   d'autres  modules
	    échoués.  Si  le  module  échoue la  chaîne  est  immédiatement
	    terminée et la requête est rejetée.</p></dd><dt><span class="term"><code class="literal">sufficient</code></span></dt><dd><p>Si le  module réussit  et qu'aucun des  modules précédent
	    n'a échoué  la chaîne est immédiatement terminée  et la requête
	    est allouée. Si  le module échoue il est ignore  et le reste de
	    la chaîne est exécuté.</p><p>Puisque  la sémantique  de  ce drapeau  peut  être un  peu
	    confuse,  spécialement  lorsqu'il s'agit  de  celui du  dernier
	    module de  la chaîne, il  est recommandé d'utiliser  le drapeau
	    <code class="literal">binding</code>   à   la   place  de   celui-ci   sous la condition que
	    l'implémentation le supporte.</p></dd><dt><span class="term"><code class="literal">optional</code></span></dt><dd><p>Le  module est exécuté  mais le  résultat est  ignoré. Si
	    tout    les    modules    de    la    chaîne    sont    marqués
	    <code class="literal">optional</code>,   toutes   les   requêtes   seront
	    toujours acceptées.</p></dd></dl></div><p>Lorsqu'un  serveur invoque l'une  des six  primitives PAM,
       PAM  récupère  la chaîne  du  mécanisme  à  laquelle la  requête
      correspond et  invoque chaque module de la  chaîne dans l'ordre
      indiqué,  jusqu'à  ce que  la  fin  soit  atteinte ou  qu'aucune
      exécution  supplémentaire ne  soit nécessaire  (soit à  cause du
      succès    d'un   module    en    <code class="literal">binding</code>   ou
      <code class="literal">sufficient</code>,  soit  à  cause de  l'échec  d'un
      module <code class="literal">requisite</code>). La requête est acceptée si
      et seulement  si au moins un  module a été invoqué,  et que tout
      les modules non optionnels ont réussi.</p><p>Notez qu'il est possible, bien que peu courant, d'avoir le
      même  module  listé plusieurs  fois  dans  la  même chaîne.  Par
      exemple un module qui détermine  le nom utilisateur et le mot de
      passe  à  l'aide  d'un   serveur  directory  peut  être  invoqué
      plusieurs  fois   avec  des  paramètres   spécifiant  différents
      serveurs a contacter.  PAM considère les différentes occurrences
      d'un  même  module  dans  une  même  chaîne  comme  des  modules
      différents et non liés.</p></div><div class="section"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="pam-transactions"></a>3.4. Transactions</h3></div></div></div><p>Le cycle  de vie d'une transaction PAM  typique est décrit
      ci-dessous. Notez que si l'une  de ces étapes échoue, le serveur
      devrait  reporter un message  d'erreur au  client et  arrêter la
      transaction.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Si  nécessaire,  le   serveur  obtient  les  privilèges  de
	  l'arbitre par le biais d'un mécanisme indépendant de PAM &#8212;
	  généralement en ayant  été démarré par <code class="literal">root</code> ou
	  en étant setuid <code class="literal">root</code>.</p></li><li class="listitem"><p>Le  serveur appel  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_start&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_start</span>(3)</span></a> afin  d'initialiser la
	  bibliothèque PAM  et indique  le service et  le compte  cible, et
	  enregistre une fonction de conversation appropriée.</p></li><li class="listitem"><p>Le  serveur  obtient  diverses informations  concernant  la
	  transaction (tel que le nom  d'utilisateur du demandeur et le nom
	  d'hôte de la machine sur  lequel le client tourne) et les soumet
	  à PAM en utilisant la fonction <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_set_item&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_set_item</span>(3)</span></a>.</p></li><li class="listitem"><p>Le serveur appel  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_authenticate&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_authenticate</span>(3)</span></a> pour authentifier le demandeur.</p></li><li class="listitem"><p>Le  serveur  appel  la fonction  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_acct_mgmt&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_acct_mgmt</span>(3)</span></a>  qui
	  vérifie  que le compte  est valide  et disponible.  Si le  mot de
	  passe est correct mais a expiré, <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_acct_mgmt&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_acct_mgmt</span>(3)</span></a> retournera
	  <code class="literal">PAM_NEW_AUTHTOK_REQD</code>    à    la    place    de
	  <code class="literal">PAM_SUCCESS</code>.</p></li><li class="listitem"><p>Si        l'étape        précédente       a        retourné
	  <code class="literal">PAM_NEW_AUTHTOK_REQD</code>,    le    serveur   appel
	  maintenant  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_chauthtok&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_chauthtok</span>(3)</span></a>  pour  obliger l'utilisateur  à
	  changer le jeton d'authentification du compte désiré.</p></li><li class="listitem"><p>Maintenant que le demandeur a été correctement authentifié,
	  le serveur appelle  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_setcred&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_setcred</span>(3)</span></a> pour obtenir les privilèges
	  du compte désiré. Il lui est  possible de faire ceci parce qu'il
	  agit au nom de l'arbitre dont il possède les privilèges.</p></li><li class="listitem"><p>Lorsque les privilèges corrects  ont été établi le serveur
	  appelle   <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_open_session&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_open_session</span>(3)</span></a>   pour   mettre  en   place   la
	  session.</p></li><li class="listitem"><p>Maintenant le serveur effectue les services demandés par le
	  client &#8212; par exemple fournir un shell au demandeur.</p></li><li class="listitem"><p>Lorsque le  serveur a  fini de servir  le client,  il appelle
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_close_session&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_close_session</span>(3)</span></a> afin de  terminer la session.</p></li><li class="listitem"><p>Pour finir, le  serveur appelle <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=pam_end&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">pam_end</span>(3)</span></a> afin signaler
	  à la bibliothèque  PAM que la transaction se termine et qu'elle peut libérer
	  les   ressources    qu'elle   a    alloué   au   cours    de   la
	  transaction.</p></li></ol></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pam-terms.html">Précédent</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="pam-config.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">2. Termes et conventions </td><td width="20%" align="center"><a accesskey="h" href="index.html">Sommaire</a></td><td width="40%" align="right" valign="top"> 4. Configuration de PAM</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Ce document, ainsi que d'autres peut être téléchargé sur
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a></small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Pour toutes questions à propos de FreeBSD, lisez la
    <a href="http://www.FreeBSD.org/docs.html">documentation</a> avant de contacter
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;.<br></br>
    Pour les questions sur cette documentation, contactez
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;.</small></p></body></html>