<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>17.15. MAC Шорон дахь Nagios</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD гарын авлага" /><link rel="up" href="mac.html" title="Бүлэг 17. Mandatory Access Control буюу Албадмал Хандалтын хяналт" /><link rel="prev" href="mac-lomac.html" title="17.14. MAC LOMAC модуль" /><link rel="next" href="mac-userlocked.html" title="17.16. Хэрэглэгчийг түгжих" /><link rel="copyright" href="legalnotice.html" title="Хуулийн заалт" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">17.15. MAC Шорон дахь Nagios</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="mac-lomac.html">Өмнөх</a> </td><th width="60%" align="center">Бүлэг 17. Mandatory Access Control буюу Албадмал Хандалтын хяналт</th><td width="20%" align="right"> <a accesskey="n" href="mac-userlocked.html">Дараах</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="mac-implementing"></a>17.15. MAC Шорон дахь Nagios</h2></div></div></div><a id="idp81357904" class="indexterm"></a><p>Дараах нь зөв тохируулсан бодлогуудын хамтаар төрөл бүрийн
	<acronym class="acronym">MAC</acronym> модулиудыг ашиглан аюулгүй орчинг
	үүсгэхийг харуулах болно. Энэ нь зөвхөн тест бөгөөд хүн бүгдийн
	аюулгүй байдлын асуудалд бүрэн хариулт болно гэж тооцох ёсгүй
	юм. Бодлогыг зөвхөн шийдэж түүнийг орхигдуулах нь хэзээ ч
	ажиллахгүй бөгөөд жинхэнэ ажиллаж байгаа үйлдвэрлэлийн
	орчинд сүйрлийн болж болох юм.</p><p>Энэ процессийг эхлүүлэхээсээ өмнө <code class="literal">multilabel</code>
	тохируулга файлын систем бүр дээр энэ бүлгийн эхэнд дурдсаны дагуу
	тавигдах ёстой. Ингэж хийхгүй бол алдаа гарах болно. Энд байхдаа
	<a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net-mngt/nagios-plugins/pkg-descr">net-mngt/nagios-plugins</a>,
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/net-mngt/nagios/pkg-descr">net-mngt/nagios</a>, болон
      <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/www/apache22/pkg-descr">www/apache22</a> портууд
	бүгд суулгагдаж тохируулагдаж зөв ажиллаж байгаа эсэхийг шалгаарай.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81361488"></a>17.15.1. Хэрэглэгчийн insecure ангилал үүсгэнэ</h3></div></div></div><p>Дараах хэрэглэгчийн ангиллыг <code class="filename">/etc/login.conf</code>
	файлд нэмж:</p><pre class="programlisting">insecure:\
:copyright=/etc/COPYRIGHT:\
:welcome=/etc/motd:\
:setenv=MAIL=/var/mail/$,BLOCKSIZE=K:\
:path=~/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin
:manpath=/usr/share/man /usr/local/man:\
:nologin=/usr/sbin/nologin:\
:cputime=1h30m:\
:datasize=8M:\
:vmemoryuse=100M:\
:stacksize=2M:\
:memorylocked=4M:\
:memoryuse=8M:\
:filesize=8M:\
:coredumpsize=8M:\
:openfiles=24:\
:maxproc=32:\
:priority=0:\
:requirehome:\
:passwordtime=91d:\
:umask=022:\
:ignoretime@:\
:label=biba/10(10-10):</pre><p>мөн дараах мөрийг анхдагч хэрэглэгчийн ангилалд нэмж процедурыг эхэлнэ:</p><pre class="programlisting">:label=biba/high:</pre><p>Энэ хийгдсэний дараа мэдээллийн баазыг дахин бүтээхийн тулд
	дараах тушаалыг ажиллуулах ёстой:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cap_mkdb /etc/login.conf</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81365456"></a>17.15.2. Ачаалалтын тохиргоо</h3></div></div></div><p>Дахин ачаалах гэсний хэрэггүй, шаардлагатай модулиудыг
	систем эхлүүлэхэд дуудахын тулд дараах мөрүүдийг
	<code class="filename">/boot/loader.conf</code> файлд нэмнэ:</p><pre class="programlisting">mac_biba_load="YES"
mac_seeotheruids_load="YES"</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81367376"></a>17.15.3. Хэрэглэгчдийг тохируулна</h3></div></div></div><p><code class="systemitem">root</code> хэрэглэгчийг анхдагч ангилалд
	доор дурдсаныг ашиглан тохируулна:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw usermod root -L default</code></strong></pre><p><code class="systemitem">root</code> эсвэл системийн хэрэглэгчид биш
	бүх хэрэглэгчийн бүртгэлүүд одоо нэвтрэлийн ангилал шаардах болно.
	Нэвтрэлтийн ангилал шаардлагатай, түүнгүй бол хэрэглэгчид  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=vi&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">vi</span>(1)</span></a>
	зэрэг нийтлэг тушаалд хандах боломжгүй болно.
	Дараах <code class="command">sh</code> скрипт үүнийг хийх болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>for x in `awk -F: '($3 &gt;= 1001) &amp;&amp; ($3 != 65534) { print $1 }' \</code></strong>
	<strong class="userinput"><code>/etc/passwd`; do pw usermod $x -L default; done;</code></strong></pre><p><code class="systemitem">nagios</code> болон <code class="systemitem">www</code>
	хэрэглэгчдийг insecure ангилалд оруулна:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw usermod nagios -L insecure</code></strong></pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pw usermod www -L insecure</code></strong></pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81384528"></a>17.15.4. Contexts буюу Сэдвийн файл үүсгэнэ</h3></div></div></div><p>Сэдвийн файл нь одоо үүсгэгдсэн байх ёстой; дараах жишээ файлыг
	<code class="filename">/etc/policy.contexts</code>-д
	байрлуулах ёстой.</p><pre class="programlisting"># This is the default BIBA policy for this system.

# System:
/var/run                        biba/equal
/var/run/*                      biba/equal

/dev                            biba/equal
/dev/*                          biba/equal

/var				biba/equal
/var/spool                      biba/equal
/var/spool/*                    biba/equal

/var/log                        biba/equal
/var/log/*                      biba/equal

/tmp				biba/equal
/tmp/*				biba/equal
/var/tmp			biba/equal
/var/tmp/*			biba/equal

/var/spool/mqueue		biba/equal
/var/spool/clientmqueue		biba/equal

# For Nagios:
/usr/local/etc/nagios
/usr/local/etc/nagios/*         biba/10

/var/spool/nagios               biba/10
/var/spool/nagios/*             biba/10

# For apache
/usr/local/etc/apache           biba/10
/usr/local/etc/apache/*         biba/10</pre><p>Энэ бодлого нь мэдээллийн урсгалд хязгаарлалтуудыг тавьж аюулгүй
	байдлыг хангадаг. Энэ тусгайлсан тохиргооны хувьд хэрэглэгчид,
	<code class="systemitem">root</code> болон бусад хэрэглэгчид
	<span class="application">Nagios</span> програмд хандахаар хэзээ ч
	зөвшөөрөгдсөн байх ёсгүй. <span class="application">Nagios</span>-ийн
	тохиргооны файлууд болон процессууд нь бүр мөсөн өөртөө багтсан буюу
	шоронд хийгдсэн байх болно.</p><p>Одоо энэ файлыг өөрийн систем уруу уншуулахдаа дараах тушаалыг
	ажиллуулна:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setfsmac -ef /etc/policy.contexts /</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>setfsmac -ef /etc/policy.contexts /</code></strong></pre><div xmlns="" class="note"><h3 class="admontitle">Тэмдэглэл: </h3><p xmlns="http://www.w3.org/1999/xhtml">Дээрх файлын системийн байршил орчноосоо хамааран өөр байж
	болно; гэхдээ үүнийг файлын систем бүр дээр ажиллуулах
	ёстой.</p></div><p><code class="filename">/etc/mac.conf</code> файл гол хэсэгт
	дараах өөрчлөлтүүдийг шаарддаг:</p><pre class="programlisting">default_labels file ?biba
default_labels ifnet ?biba
default_labels process ?biba
default_labels socket ?biba</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81437392"></a>17.15.5. Сүлжээг идэвхжүүлнэ</h3></div></div></div><p>Дараах мөрийг <code class="filename">/boot/loader.conf</code>-д
	нэмнэ:</p><pre class="programlisting">security.mac.biba.trust_all_interfaces=1</pre><p>Тэгээд дараа нь доор дурдсаныг <code class="filename">rc.conf</code> файлд
	хадгалагдсан сүлжээний картны тохиргоонд нэмнэ. Хэрэв анхдагч Интернэтийн
	тохиргоо <acronym class="acronym">DHCP</acronym>-ээр хийгдсэн бол системийг
	ачаалах болгоны дараа үүнийг гараараа тохируулах хэрэгтэй болох юм:</p><pre class="programlisting">maclabel biba/equal</pre></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp81440848"></a>17.15.6. Тохиргоог тест хийх нь</h3></div></div></div><a id="idp81441488" class="indexterm"></a><p>Вэб сервер болон <span class="application">Nagios</span>
	нь системийг эхлүүлэхэд ажиллахааргүй байгаа эсэхийг шалгаад дахин ачаална.
	<code class="systemitem">root</code> хэрэглэгч <span class="application">Nagios</span>-ийн
	тохиргооны сан дахь ямар ч файлд хандаж чадах ёсгүйг баталгаажуулна.
	Хэрэв <code class="systemitem">root</code> нь <code class="filename">/var/spool/nagios</code>-д
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=ls&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a>-ийг ажиллуулж чадаж байвал ямар нэг юм буруу байна гэсэн үг.
	Зөв бол <span class="quote">«<span class="quote">permission denied</span>»</span> алдаа буцаагдах
	ёстой.</p><p>Хэрэв бүгд зүгээр юм шиг санагдвал <span class="application">Nagios</span>,
	<span class="application">Apache</span>, болон
	<span class="application">Sendmail</span>-ийг одоо аюулгүй байдлын бодлогод
	тааруулж ажиллуулж болно. Үүнийг дараах тушаал хийх болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /etc/mail &amp;&amp; make stop &amp;&amp; \
setpmac biba/equal make start &amp;&amp; setpmac biba/10\(10-10\) apachectl start &amp;&amp; \
setpmac biba/10\(10-10\) /usr/local/etc/rc.d/nagios.sh forcestart</code></strong></pre><p>Бүгд зөв ажиллаж байгаа эсэхийг баталгаажуулж дахин
	шалгаарай. Хэрэв үгүй бол бүртгэлийн файлуудаас алдааны мэдэгдлүүд байгаа эсэхийг
	шалгана. <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=sysctl&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">sysctl</span>(8)</span></a> хэрэгсэл ашиглаж <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=mac_biba&amp;sektion=4"><span class="citerefentry"><span class="refentrytitle">mac_biba</span>(4)</span></a> аюулгүй байдлын
	бодлогын модулийн үйлчлэлийг хааж бүгдийг эхнээс нь эхлэхийг
	оролдоорой.</p><div xmlns="" class="note"><h3 class="admontitle">Тэмдэглэл: </h3><p xmlns="http://www.w3.org/1999/xhtml"><code class="systemitem">root</code> хэрэглэгч аюулгүй байдлын үйлчлэлийг өөрчилж
	тохиргооны файлыг айлгүйгээр засварлаж чадна. Дараах тушаал нь шинээр үүсгэсэн
	бүрхүүлийн хувьд аюулгүй байдлын бодлогыг доод зэрэг уруу орж буурахыг
	зөвшөөрөх болно:</p><pre xmlns="http://www.w3.org/1999/xhtml" class="screen"><code class="prompt">#</code> <strong class="userinput"><code>setpmac biba/10 csh</code></strong></pre><p xmlns="http://www.w3.org/1999/xhtml">Үүнийг болгохгүй байлгахын тулд <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=login.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">login.conf</span>(5)</span></a>-оор
	хэрэглэгчийг хүрээнд оруулна. Хэрэв <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=setpmac&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">setpmac</span>(8)</span></a> тушаалыг
	тасалгааных нь хүрээнээс гадна ажиллуулах гэж оролдвол алдаа буцаагдах
	бөгөөд тушаал ажиллахгүй байх болно. Энэ тохиолдолд root-ийг
	<code class="literal">biba/high(high-high)</code> болгож
	тохируулна.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="mac-lomac.html">Өмнөх</a> </td><td width="20%" align="center"><a accesskey="u" href="mac.html">Дээш</a></td><td width="40%" align="right"> <a accesskey="n" href="mac-userlocked.html">Дараах</a></td></tr><tr><td width="40%" align="left" valign="top">17.14. MAC LOMAC модуль </td><td width="20%" align="center"><a accesskey="h" href="index.html">Эхлэл</a></td><td width="40%" align="right" valign="top"> 17.16. Хэрэглэгчийг түгжих</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Энэ болон бусад баримтуудыг
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    хаягаас татаж авч болно.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD-ийн талаар
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;
    хаягтай холбоо барихаасаа өмнө
    <a href="http://www.FreeBSD.org/docs.html">баримтыг</a> уншина уу.<br></br>
    Энэ бичиг баримттай холбоотой асуулт байвал
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;
    хаягаар цахим захидал явуулна уу.<br></br>
    Энэ бичиг баримтын орчуулгатай холбоотой асуулт байвал
    &lt;<a href="mailto:admin@mnbsd.org">admin@mnbsd.org</a>&gt;
    хаягаар цахим захидал явуулна уу.</small></p></body></html>