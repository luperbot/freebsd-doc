<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>30.11. syslogd ашиглан алсын хост руу бүртгэх нь</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD гарын авлага" /><link rel="up" href="network-servers.html" title="Бүлэг 30. Сүлжээний орчны Серверүүд" /><link rel="prev" href="network-ntp.html" title="30.10. ntpd-р Цаг Тааруулах нь" /><link rel="next" href="firewalls.html" title="Бүлэг 31. Галт хана" /><link rel="copyright" href="legalnotice.html" title="Хуулийн заалт" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">30.11. <code class="command">syslogd</code> ашиглан алсын хост руу бүртгэх нь</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="network-ntp.html">Өмнөх</a> </td><th width="60%" align="center">Бүлэг 30. Сүлжээний орчны Серверүүд</th><td width="20%" align="right"> <a accesskey="n" href="firewalls.html">Дараах</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="network-syslogd"></a>30.11. <code class="command">syslogd</code> ашиглан алсын хост руу бүртгэх нь</h2></div><div><span class="authorgroup">Хувь нэмэр болгон оруулсан <span xmlns="http://www.w3.org/1999/xhtml" class="author"><span class="firstname">Том</span> <span class="surname">Рөүдс</span></span>. </span></div></div></div><p>Системийн бүртгэлтэй ажиллах нь аюулгүй байдлын болоод системийг
      удирдах ажиллагааны чухал асуудал юм. Хостууд дунд зэргийн эсвэл том
      сүлжээнд тархсан эсвэл тэдгээр нь төрөл бүрийн олон янзын сүлжээний хэсэг
      болсон байх тохиолдолд эдгээр олон хостын бүртгэлийн файлуудыг
      монитор хийх нь ихээхэн төвөгтэй болдог. Энэ тохиолдолд алсаас бүртгэхийг
      тохируулах нь бүх л процессийг илүү тухтай болгодог.</p><p>Тусгайлан заасан бүртгэх хост руу төвлөрүүлэн бүртгэх нь бүртгэлийн
      файлын удирдлагатай холбоотой зарим хүндрэлүүдийг багасгаж чаддаг.
      <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> болон <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newsyslog&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newsyslog</span>(8)</span></a> зэрэг FreeBSD-ийн эх хэрэгслүүдийг
      ашиглан бүртгэлийн файлын цуглуулга, нийлүүлэлт болон багасгалтыг нэг газар тохируулж
      болдог. Дараах жишээ тохиргоонд <code class="systemitem">logserv.example.com</code>
      гэж нэрлэгдсэн хост <code class="systemitem">A</code> локал сүлжээнээс бүртгэлийн мэдээллийг
      цуглуулах болно. <code class="systemitem">logclient.example.com</code> гэж
      нэрлэгдсэн хост <code class="systemitem">B</code> бүртгэлийн мэдээллийг сервер систем рүү
      дамжуулах болно. Жинхэнэ тохиргоонд эдгээр хостууд зохих дамжуулах болон буцах
      <acronym class="acronym">DNS</acronym> эсвэл <code class="filename">/etc/hosts</code> файлд
      оруулгууд шаардана. Тэгэхгүй бол өгөгдлийг сервер хүлээн авахгүй татгалзах
      болно.</p><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91530576"></a>30.11.1. Бүртгэлийн серверийн тохиргоо</h3></div></div></div><p>Бүртгэлийн серверүүд нь алсын хостуудаас бүртгэлийн мэдээллийг хүлээн
	авахаар тохируулагдсан машинууд юм. Ихэнх тохиолдолд энэ нь тохиргоог
	хялбар болгох зорилготой бөгөөд зарим тохиолдолд энэ нь удирдлагыг арай
	сайжруулж байгаа хэлбэр байж болох юм. Аль ч шалтгаан байсан гэсэн
	үргэлжлүүлэхээсээ өмнө цөөн хэдэн шаардлагыг дурдъя.</p><p>Зөв тохируулсан бүртгэлийн сервер дараах хамгийн бага шаардлагыг хангасан
	байх шаардлагатай:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Клиент болон сервер дээр 514-р порт руу
	    <acronym class="acronym">UDP</acronym>-г дамжуулах боломжийг бүрдүүлэх галт хананы
	    дүрэм;</p></li><li class="listitem"><p>Клиент машинаас алсын мэдэгдлүүдийг хүлээн авахаар syslogd
	    тохируулагдсан байх;</p></li><li class="listitem"><p>syslogd сервер болон бүх клиент машинууд нь дамжуулах
	    болон буцах <acronym class="acronym">DNS</acronym>-ийн хувьд зөв оруулгуудтай
	    эсвэл <code class="filename">/etc/hosts</code> файлд зөв тохируулсан
	    байх шаардлагатай.</p></li></ul></div><p>Бүртгэлийн серверийг тохируулахын тулд клиент нь
	<code class="filename">/etc/syslog.conf</code>-д нэмэгдсэн байх
	ёстой бөгөөд бүртгэх боломжийг зааж өгсөн байх шаардлагатай:</p><pre class="programlisting">+logclient.example.com
*.*     /var/log/logclient.log</pre><div xmlns="" class="note"><h3 class="admontitle">Тэмдэглэл: </h3><p xmlns="http://www.w3.org/1999/xhtml">Төрөл бүрийн дэмжигдсэн, байгаа <span class="emphasis"><em>facility</em></span>
	  буюу <span class="emphasis"><em>боломжуудын</em></span> талаарх дэлгэрэнгүй мэдээллийг
	  <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslog.conf&amp;sektion=5"><span class="citerefentry"><span class="refentrytitle">syslog.conf</span>(5)</span></a> гарын авлагын хуудаснаас олж болно.</p></div><p>Нэмсэний дараа бүх <code class="literal">facility</code> мэдэгдлүүд
	өмнө заасан <code class="filename">/var/log/logclient.log</code> файл руу
	бүртгэгдэх болно.</p><p>Сервер машин дараах тохиргоог бас <code class="filename">/etc/rc.conf</code>
	файлдаа хийсэн байх шаардлагатай:</p><pre class="programlisting">syslogd_enable="YES"
syslogd_flags="-a logclient.example.com -v -v"</pre><p>Эхний тохиргоо нь <code class="command">syslogd</code> демоныг эхлүүлэхийг
	заах бөгөөд хоёр дахь нь клиетийн өгөгдлийг энэ сервер дээр хүлээн авахыг
	зөвшөөрнө. Сүүлийн <code class="option">-v -v</code> хэсэг нь бүртгэж байгаа
	мэдэгдлүүдийн гаралтыг илүү дэлгэрэнгүй болгоно. Энэ нь facility-г
	тохируулахад ихээхэн ашигтай байдаг. Администраторууд ямар төрлийн
	мэдэгдлүүд ямар facility-р бүртгэгдэж байгааг хянах боломжийг энэ нь
	бүрдүүлдэг.</p><p>Олон клиентээс бүртгэлийг хүлээн авахын тулд олон <code class="option">-a</code>
	сонголтыг зааж өгч болно. <acronym class="acronym">IP</acronym> хаягууд болон
	бүхэл сүлжээний блокийг бас зааж өгч болох бөгөөд боломжит сонголтуудын
	бүх жагсаалтыг <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslog&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a> гарын авлагын хуудаснаас үзнэ үү.</p><p>Төгсгөлд нь бүртгэлийн файлыг үүсгэх хэрэгтэй. Хэрэглэгсэн арга нь
	хамаагүй боловч <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=touch&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">touch</span>(1)</span></a> үүнтэй адил тохиолдлуудад сайн
	ажилладаг:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>touch /var/log/logclient.log</code></strong></pre><p>Энэ үед <code class="command">syslogd</code> демоныг дахин
	ажиллуулж шалгах ёстой:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pgrep syslog</code></strong></pre><p>Хэрэв <acronym class="acronym">PID</acronym> буцаагдвал сервер нь амжилттай
	дахин эхэлсэн гэсэн үг бөгөөд клиентийн тохиргоо ажиллаж эхэлнэ. Хэрэв
	сервер дахин эхлээгүй бол ямар нэг зүйл болсон эсэхийг
	<code class="filename">/var/log/messages</code> файл дахь мэдэгдлүүдээс
	шалгаарай.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91559248"></a>30.11.2. Клиентийн бүртгэлийн тохиргоо</h3></div></div></div><p>Бүртгэл илгээгч клиент нь өөр дээрээ хуулбараа үлдээхээс гадна
	бас бүртгэлийн сервер рүү бүртгэлийн мэдээллийг явуулдаг машин юм.</p><p>Бүртгэлийн серверүүдийн нэгэн адил клиентүүд нь бас хамгийн бага
	шаардлагыг хангасан байх ёстой:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslogd&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">syslogd</span>(8)</span></a> нь бүртгэлийн сервер хүлээн авах ёстой
	    заасан төрлийн мэдэгдлүүдийг бүртгэлийн сервер рүү илгээхээр
	    тохируулагдсан байх ёстой;</p></li><li class="listitem"><p>Галт хана <acronym class="acronym">UDP</acronym> пакетуудыг
	    514-р порт руу зөвшөөрөх ёстой;</p></li><li class="listitem"><p>Дамжуулах болон буцах <acronym class="acronym">DNS</acronym>
	    тохируулагдсан эсвэл <code class="filename">/etc/hosts</code> файл зохих
	    оруулгуудтай байх шаардлагатай.</p></li></ul></div><p>Клиентийн тохиргоо нь серверийнхтэй харьцуулах юм бол арай зөөлөн
	байдаг. Клиент машин нь <code class="filename">/etc/rc.conf</code> файлдаа
	дараахийг нэмж өгсөн байх шаардлагатай байдаг:</p><pre class="programlisting">syslogd_enable="YES"
syslogd_flags="-s -v -v"</pre><p>Өмнө дурдсаны адил эдгээр тохиргоонууд нь
	<code class="command">syslogd</code> демоныг ачаалж эхлэхэд эхлүүлэхийг
	заах бөгөөд бүртгэх мэдэгдлүүдийг дэлгэрэнгүйгээр харуулах болно.
	<code class="option">-s</code> сонголт нь бусад хостуудаас бүртгэлийг энэ
	клиент хүлээн авахаас сэргийлдэг.</p><p>Facility нь мэдэгдэл үүсгэгдэж байгаа тэр системийн хэсгийг
	тайлбарладаг. Жишээ нь <acronym class="acronym">ftp</acronym> болон
	<acronym class="acronym">ipfw</acronym> нь хоёулаа facility юм. Эдгээр хоёр
	үйлчилгээний хувьд бүртгэлийн мэдэгдлүүд үүсэхэд ихэвчлэн дээрх
	хоёр хэрэгслийг бүртгэлийн мэдэгдэл бүртээ агуулсан байдаг.
	Facility нь бүртгэлийн мэдэгдэл ямар чухлыг тэмдэглэхэд хэрэглэгдэх
	дараалал эсвэл түвшинтэй байдаг. Хамгийн түгээмэл нь
	<code class="literal">warning</code> ба <code class="literal">info</code> юм.
	Боломжит бүх facilty болон дарааллуудын жагсаалтыг
	<a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=syslog&amp;sektion=3"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a> гарын авлагын хуудаснаас үзнэ үү.</p><p>Бүртгэлийн серверийг клиентийн <code class="filename">/etc/syslog.conf</code>
	файлд заасан байх шаардлагатай. Энэ жишээн дээр алсын сервер рүү
	бүртгэлийн өгөгдлийг илгээхийн тулд <code class="literal">@</code>
	тэмдгийг ашигласан бөгөөд доор дурдсан мөртэй төстэй
	харагдана:</p><pre class="programlisting">*.*		@logserv.example.com</pre><p>Нэмсэний дараа өөрчлөлтийг хүчинтэй болгохын тулд
	<code class="command">syslogd</code>-г дахин эхлүүлэх шаардлагатай:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong></pre><p>Сүлжээгээр бүртгэлийн мэдэгдлүүдийг илгээж байгаа эсэхийг
	тест хийхийн тулд клиент дээр <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=logger&amp;sektion=1"><span class="citerefentry"><span class="refentrytitle">logger</span>(1)</span></a>-г ашиглаж мэдэгдлийг
	<code class="command">syslogd</code> руу илгээнэ:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>logger "Test message from logclient"</code></strong></pre><p>Энэ мэдэгдэл клиент дээрх
	<code class="filename">/var/log/messages</code> болон
	сервер дээрх <code class="filename">/var/log/logclient.log</code>
	файлд одоо орсон байх ёстой.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91598032"></a>30.11.3. Бүртгэлийн серверүүдийг дибаг хийх</h3></div></div></div><p>Зарим тохиолдолд хэрэв бүртгэлийн сервер дээр мэдэгдлүүд нь
	хүлээн авагдаагүй бол дибаг хийх шаардлагатай байж болох юм.
	Хэд хэдэн шалтгаанаас болж ийм байдалд хүрч болох юм. Хамгийн
	түгээмэл хоёр нь сүлжээний холболтын болон <acronym class="acronym">DNS</acronym>-тэй
	холбоотой асуудлууд юм. Эдгээр тохиолдлуудыг тест хийхийн тулд
	хоёр хост хоёулаа <code class="filename">/etc/rc.conf</code> файлд заагдсан
	хостын нэрээрээ нэг нэгэн рүүгээ хүрч чадаж байгааг шалгах
	хэрэгтэй. Хэрэв энэ зөв ажиллаж байгаа бол <code class="filename">/etc/rc.conf</code>
	файлд <code class="literal">syslogd_flags</code> тохиргоог өөрчлөх
	шаардлагатай болно.</p><p>Дараах жишээн дээр <code class="filename">/var/log/logclient.log</code> нь хоосон
	бөгөөд <code class="filename">/var/log/messages</code> файл нь амжилтгүй болсон
	шалтгааныг харуулна. Дибаг хийж байгаа гаралтыг илүү дэлгэрэнгүй харуулахын
	тулд дараах жишээтэй төстэйгөөр <code class="literal">syslogd_flags</code>
	тохируулгыг өөрчилж дахин ачаалах хэрэгтэй:</p><pre class="programlisting">syslogd_flags="-d -a logclien.example.com -v -v"</pre><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong></pre><p>Доор дурдсантай төстэй дибаг өгөгдөл дахин ачаалсны дараа
	дэлгэц дээр хурдан гарч өнгөрнө:</p><pre class="screen">logmsg: pri 56, flags 4, from logserv.example.com, msg syslogd: restart
syslogd: restarted
logmsg: pri 6, flags 4, from logserv.example.com, msg syslogd: kernel boot file is /boot/kernel/kernel
Logging to FILE /var/log/messages
syslogd: kernel boot file is /boot/kernel/kernel
cvthname(192.168.1.10)
validate: dgram from IP 192.168.1.10, port 514, name logclient.example.com;
rejected in rule 0 due to name mismatch.</pre><p>Мэдэгдлүүд нэр зөрснөөс болоод дамжихгүй байгааг эндээс
	харж болно. Тохиргоог алхам алхмаар дахин шалгасны дараа
	<code class="filename">/etc/rc.conf</code> дахь дараах мөр
	буруу бичигдсэн бөгөөд асуудалтай байгааг олж харна:</p><pre class="programlisting">syslogd_flags="-d -a logclien.example.com -v -v"</pre><p>Энэ мөр <code class="literal">logclien</code> биш
	<code class="literal">logclient</code> гэдгийг агуулсан байх ёстой.
	Зөв болгож засан дахин ачаалсны дараа хүлээж байсан үр
	дүнгээ харах болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>service syslogd restart</code></strong>
logmsg: pri 56, flags 4, from logserv.example.com, msg syslogd: restart
syslogd: restarted
logmsg: pri 6, flags 4, from logserv.example.com, msg syslogd: kernel boot file is /boot/kernel/kernel
syslogd: kernel boot file is /boot/kernel/kernel
logmsg: pri 166, flags 17, from logserv.example.com,
msg Dec 10 20:55:02 &lt;syslog.err&gt; logserv.example.com syslogd: exiting on signal 2
cvthname(192.168.1.10)
validate: dgram from IP 192.168.1.10, port 514, name logclient.example.com;
accepted in rule 0.
logmsg: pri 15, flags 0, from logclient.example.com, msg Dec 11 02:01:28 trhodes: Test message 2
Logging to FILE /var/log/logclient.log
Logging to FILE /var/log/messages</pre><p>Энэ үед мэдэгдлүүдийг зөв хүлээн аван зөв
	файлд бичих болно.</p></div><div class="sect2"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="idp91612240"></a>30.11.4. Аюулгүй байдлын хувьд бодолцох зүйлс</h3></div></div></div><p>Сүлжээний аль ч үйлчилгээний нэгэн адил энэ тохиргоог
	хийхээсээ өмнө аюулгүй байдлын шаардлагуудыг бодолцох ёстой. Заримдаа
	бүртгэлийн файлууд нь локал хост дээр идэвхжүүлсэн үйлчилгээнүүд,
	хэрэглэгчдийн бүртгэл болон тохиргооны өгөгдлийн талаарх эмзэг
	өгөгдлүүдийг агуулсан байж болох юм. Клиентээс сервер рүү илгээсэн
	сүлжээний өгөгдөл нь шифрлэгдээгүй эсвэл нууц үгээр хамгаалагдаагүй
	байдаг. Хэрэв шифрлэх шаардлагатай бол өгөгдлийг шифрлэсэн хоолойгоор
	дамжуулах <a xmlns="" class="package" href="http://www.freebsd.org/cgi/url.cgi?ports/security/stunnel/pkg-descr">security/stunnel</a>
	хэрэгслийг ашиглаж болох юм.</p><p>Локал аюулгүй байдал нь бас л асуудал юм. Бүртгэлийн файлууд нь
	хэрэглэж байхад юм уу эсвэл бүртгэлийн багасгах үед шифрлэгддэггүй.
	Локал хэрэглэгчид эдгээр файлуудад хандаж системийн тохиргооны талаар
	нэмэлт мэдээлэл олж авч болох юм. Ийм тохиолдолд эдгээр файлууд дээр
	зөв зөвшөөрлүүдийг тавих нь чухал юм. <a class="citerefentry" href="http://www.FreeBSD.org/cgi/man.cgi?query=newsyslog&amp;sektion=8"><span class="citerefentry"><span class="refentrytitle">newsyslog</span>(8)</span></a> хэрэгсэл нь
	шинээр үүсгэгдсэн болон багасгагдсан бүртгэлийн файлууд дээр зөвшөөрөл
	тавихыг дэмждэг. Бүртгэлийн файлууд дээр <code class="literal">600</code>
	горимыг тавьснаар хүсээгүй локал хэрэглэгчид тэдгээрийг шиншлэх
	боломжийг хаах юм.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="network-ntp.html">Өмнөх</a> </td><td width="20%" align="center"><a accesskey="u" href="network-servers.html">Дээш</a></td><td width="40%" align="right"> <a accesskey="n" href="firewalls.html">Дараах</a></td></tr><tr><td width="40%" align="left" valign="top">30.10. <span class="application">ntpd</span>-р Цаг Тааруулах нь </td><td width="20%" align="center"><a accesskey="h" href="index.html">Эхлэл</a></td><td width="40%" align="right" valign="top"> Бүлэг 31. Галт хана</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Энэ болон бусад баримтуудыг
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    хаягаас татаж авч болно.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD-ийн талаар
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;
    хаягтай холбоо барихаасаа өмнө
    <a href="http://www.FreeBSD.org/docs.html">баримтыг</a> уншина уу.<br></br>
    Энэ бичиг баримттай холбоотой асуулт байвал
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;
    хаягаар цахим захидал явуулна уу.<br></br>
    Энэ бичиг баримтын орчуулгатай холбоотой асуулт байвал
    &lt;<a href="mailto:admin@mnbsd.org">admin@mnbsd.org</a>&gt;
    хаягаар цахим захидал явуулна уу.</small></p></body></html>