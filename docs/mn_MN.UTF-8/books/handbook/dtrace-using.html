<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>26.4. DTrace-г ашиглах</title><link rel="stylesheet" type="text/css" href="docbook.css" /><link rev="made" href="mailto:doc@FreeBSD.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="FreeBSD гарын авлага" /><link rel="up" href="dtrace.html" title="Бүлэг 26. DTrace" /><link rel="prev" href="dtrace-enable.html" title="26.3. DTrace дэмжлэгийг идэвхжүүлэх" /><link rel="next" href="dtrace-language.html" title="26.5. D хэл" /><link rel="copyright" href="legalnotice.html" title="Хуулийн заалт" /><script xmlns="" type="text/javascript" src="/layout/js/google.js"></script></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">26.4. DTrace-г ашиглах</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="dtrace-enable.html">Өмнөх</a> </td><th width="60%" align="center">Бүлэг 26. DTrace</th><td width="20%" align="right"> <a accesskey="n" href="dtrace-language.html">Дараах</a></td></tr></table><hr /></div><div class="sect1"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both"><a id="dtrace-using"></a>26.4. DTrace-г ашиглах</h2></div></div></div><p>DTrace боломжийг ашиглахаас өмнө DTrace төхөөрөмж байх хэрэгтэй.
      Төхөөрөмжийг дуудахын тулд дараах тушаалыг ажиллуулна:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>kldload dtraceall</code></strong></pre><p>DTrace дэмжлэг одоо боломжтой болсон байх ёстой. Бүх шалгалтыг
      харахын тулд администратор дараах тушаалыг одоо ажиллуулж болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>dtrace -l | more</code></strong></pre><p>Дэлгэцийн буфферийг түргэн дүүргэх болохоор бүх гаралтыг
      <code class="command">more</code> хэрэгсэл рүү дамжуулдаг. Энд хүрэхэд
      DTrace-ийг ажиллаж байна гэж үзнэ. Одоо уг хэрэгслийг шалгаж үзэх
      цаг боллоо.</p><p>Уг хэрэгсэл нь системийн мэдээллийг цуглуулахын тулд DTrace-тэй цуг
      ажиллуулж болох ашиглахад бэлэн скриптүүдийн цуглуулга юм. Нээлттэй
      файлууд, санах ой,<acronym class="acronym">CPU</acronym>-ийн хэрэглээ болон өөр олон
      зүйлсийг шалгах скриптүүд байдаг. Скриптүүдийг дараах тушаалаар
      задалж болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>gunzip -c DTraceToolkit* | tar xvf -</code></strong></pre><p><code class="command">cd</code> ашиглан тэр сан руу өөрчилж жижиг үсгээр бичигдсэн
      нэртэй бүх файлууд дээр ажиллуулах зөвшөөрлүүдийг <code class="literal">755</code>
      руу өөрчлөх хэрэгтэй.</p><p>Эдгээр бүх скриптүүдийн агуулгад өөрчлөлт хийх хэрэгтэй
      болно. <code class="filename">/usr/bin/ksh</code> гэснийг
      <code class="filename">/usr/local/bin/ksh</code> болгох ёстой
      бөгөөд <code class="filename">/usr/bin/sh</code>-ийг
      <code class="filename">/bin/sh</code> болгон ашиглахаар, төгсгөлд нь
      <code class="filename">/usr/bin/perl</code>-г
      <code class="filename">/usr/local/bin/perl</code> болгон
      ашиглахаар болгож өөрчлөх хэрэгтэй.</p><div xmlns="" class="important"><h3 class="admontitle">Чухал: </h3><p xmlns="http://www.w3.org/1999/xhtml">FreeBSD дээрх DTrace дэмжлэг нь <span class="emphasis"><em>бүрэн бус</em></span>
	бөгөөд <span class="emphasis"><em>туршилтын</em></span> гэдгийг уншигчид
	сануулах нь ухаалаг болох юм. Эдгээр скриптүүдийн олонхи нь
	ажиллахгүй бөгөөд тэдгээр нь хэтэрхий <span class="trademark">Solaris</span>™-д тусгайлан
	зориулсан эсвэл одоо дэмжигдээгүй байгаа шалгалтуудыг
	ашигладаг.</p></div><p>Үүнийг бичиж байх үед DTrace хэрэгслийн зөвхөн хоёр скрипт
      FreeBSD дээр бүрэн дэмжигдсэн: эдгээр нь <code class="filename">hotkernel</code>
      болон <code class="filename">procsystime</code> скриптүүд юм.
      Эдгээр хоёрыг бид энэ бүлгийн дараагийн хэсгүүдэд авч үзэх
      болно.</p><p><code class="filename">hotkernel</code> нь аль функц цөмийн ихэнх хугацааг
      ашиглаж байгааг илрүүлэхээр хийгдсэн. Хэвийнээр ажиллуулахад
      энэ нь дараахтай төстэй гаралтыг харуулах болно:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/share/dtrace/toolkit</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>./hotkernel</code></strong>
Sampling... Hit Ctrl-C to end.</pre><p>Системийн администратор процессийг зогсоохын тулд
      <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span> товчлуурын хослолыг ашиглах ёстой. Зогсоосны дараа скрипт нь
      цөмийн функцуудын жагсаалт болон хугацааны мэдээллийг харуулах бөгөөд
      гаралтыг хугацааны ихэссэн дарааллаар эрэмбэлж харуулна:</p><pre class="screen">kernel`_thread_lock_flags                                   2   0.0%
0xc1097063                                                  2   0.0%
kernel`sched_userret                                        2   0.0%
kernel`kern_select                                          2   0.0%
kernel`generic_copyin                                       3   0.0%
kernel`_mtx_assert                                          3   0.0%
kernel`vm_fault                                             3   0.0%
kernel`sopoll_generic                                       3   0.0%
kernel`fixup_filename                                       4   0.0%
kernel`_isitmyx                                             4   0.0%
kernel`find_instance                                        4   0.0%
kernel`_mtx_unlock_flags                                    5   0.0%
kernel`syscall                                              5   0.0%
kernel`DELAY                                                5   0.0%
0xc108a253                                                  6   0.0%
kernel`witness_lock                                         7   0.0%
kernel`read_aux_data_no_wait                                7   0.0%
kernel`Xint0x80_syscall                                     7   0.0%
kernel`witness_checkorder                                   7   0.0%
kernel`sse2_pagezero                                        8   0.0%
kernel`strncmp                                              9   0.0%
kernel`spinlock_exit                                       10   0.0%
kernel`_mtx_lock_flags                                     11   0.0%
kernel`witness_unlock                                      15   0.0%
kernel`sched_idletd                                       137   0.3%
0xc10981a5                                              42139  99.3%</pre><p>Энэ скрипт нь цөмийн модулиудтай бас ажилладаг. Энэ боломжийг
      ашиглахын тулд скриптийг <code class="option">-m</code> өгөгдөлтэй ажиллуулах хэрэгтэй:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>./hotkernel -m</code></strong>
Sampling... Hit Ctrl-C to end.
^C
MODULE                                                  COUNT   PCNT
0xc107882e                                                  1   0.0%
0xc10e6aa4                                                  1   0.0%
0xc1076983                                                  1   0.0%
0xc109708a                                                  1   0.0%
0xc1075a5d                                                  1   0.0%
0xc1077325                                                  1   0.0%
0xc108a245                                                  1   0.0%
0xc107730d                                                  1   0.0%
0xc1097063                                                  2   0.0%
0xc108a253                                                 73   0.0%
kernel                                                    874   0.4%
0xc10981a5                                             213781  99.6%</pre><p><code class="filename">procsystime</code> скрипт нь өгөгдсөн
      <acronym class="acronym">PID</acronym> эсвэл процессийн хувьд системийн дуудлагын
      цагийн хэрэглээг авч хэвлэн харуулдаг. Дараах жишээн дээр
      <code class="filename">/bin/csh</code>-ийн шинэ хуулбар ажиллуулсан.
      <code class="filename">procsystime</code>-ийг ажиллуулсан бөгөөд
      өөр нэг <code class="command">csh</code> дээр цөөн хэдэн тушаалыг бичтэл
      энэ нь хүлээх горимд орсон. Энэ тестийн үр дүн энд байна:</p><pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>./procsystime -n csh</code></strong>
Tracing... Hit Ctrl-C to end...
^C

Elapsed Times for processes csh,

         SYSCALL          TIME (ns)
          getpid               6131
       sigreturn               8121
           close              19127
           fcntl              19959
             dup              26955
         setpgid              28070
            stat              31899
       setitimer              40938
           wait4              62717
       sigaction              67372
     sigprocmask             119091
    gettimeofday             183710
           write             263242
          execve             492547
           ioctl             770073
           vfork            3258923
      sigsuspend            6985124
            read         3988049784</pre><p>Энд үзүүлснээр <code class="function">read()</code> системийн дуудлага ихэнх цагийг,
      <code class="function">getpid()</code> системийн дуудлага хамгийн
      бага хугацааг ашигласныг наносекундаар харуулж байна.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="dtrace-enable.html">Өмнөх</a> </td><td width="20%" align="center"><a accesskey="u" href="dtrace.html">Дээш</a></td><td width="40%" align="right"> <a accesskey="n" href="dtrace-language.html">Дараах</a></td></tr><tr><td width="40%" align="left" valign="top">26.3. DTrace дэмжлэгийг идэвхжүүлэх </td><td width="20%" align="center"><a accesskey="h" href="index.html">Эхлэл</a></td><td width="40%" align="right" valign="top"> 26.5. D хэл</td></tr></table></div><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>Энэ болон бусад баримтуудыг
    <a href="ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/">ftp://ftp.FreeBSD.org/pub/FreeBSD/doc/</a>
    хаягаас татаж авч болно.</small></p><p xmlns="http://www.w3.org/TR/xhtml1/transitional" align="center"><small>FreeBSD-ийн талаар
    &lt;<a href="mailto:questions@FreeBSD.org">questions@FreeBSD.org</a>&gt;
    хаягтай холбоо барихаасаа өмнө
    <a href="http://www.FreeBSD.org/docs.html">баримтыг</a> уншина уу.<br></br>
    Энэ бичиг баримттай холбоотой асуулт байвал
    &lt;<a href="mailto:doc@FreeBSD.org">doc@FreeBSD.org</a>&gt;
    хаягаар цахим захидал явуулна уу.<br></br>
    Энэ бичиг баримтын орчуулгатай холбоотой асуулт байвал
    &lt;<a href="mailto:admin@mnbsd.org">admin@mnbsd.org</a>&gt;
    хаягаар цахим захидал явуулна уу.</small></p></body></html>